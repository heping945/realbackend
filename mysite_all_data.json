[{"model": "contenttypes.contenttype", "pk": 1, "fields": {"app_label": "admin", "model": "logentry"}}, {"model": "contenttypes.contenttype", "pk": 2, "fields": {"app_label": "auth", "model": "permission"}}, {"model": "contenttypes.contenttype", "pk": 3, "fields": {"app_label": "auth", "model": "group"}}, {"model": "contenttypes.contenttype", "pk": 4, "fields": {"app_label": "contenttypes", "model": "contenttype"}}, {"model": "contenttypes.contenttype", "pk": 5, "fields": {"app_label": "sessions", "model": "session"}}, {"model": "contenttypes.contenttype", "pk": 6, "fields": {"app_label": "accounts", "model": "userprofile"}}, {"model": "contenttypes.contenttype", "pk": 7, "fields": {"app_label": "blog", "model": "category"}}, {"model": "contenttypes.contenttype", "pk": 8, "fields": {"app_label": "blog", "model": "post"}}, {"model": "contenttypes.contenttype", "pk": 9, "fields": {"app_label": "blog", "model": "tag"}}, {"model": "contenttypes.contenttype", "pk": 10, "fields": {"app_label": "fileserver", "model": "postimg"}}, {"model": "contenttypes.contenttype", "pk": 11, "fields": {"app_label": "subject", "model": "chapter"}}, {"model": "contenttypes.contenttype", "pk": 12, "fields": {"app_label": "subject", "model": "topic"}}, {"model": "contenttypes.contenttype", "pk": 13, "fields": {"app_label": "operation", "model": "userfav"}}, {"model": "contenttypes.contenttype", "pk": 14, "fields": {"app_label": "operation", "model": "uservote"}}, {"model": "contenttypes.contenttype", "pk": 15, "fields": {"app_label": "comment", "model": "comment"}}, {"model": "contenttypes.contenttype", "pk": 16, "fields": {"app_label": "comment", "model": "message"}}, {"model": "contenttypes.contenttype", "pk": 17, "fields": {"app_label": "info", "model": "info"}}, {"model": "contenttypes.contenttype", "pk": 18, "fields": {"app_label": "xadmin", "model": "bookmark"}}, {"model": "contenttypes.contenttype", "pk": 19, "fields": {"app_label": "xadmin", "model": "usersettings"}}, {"model": "contenttypes.contenttype", "pk": 20, "fields": {"app_label": "xadmin", "model": "userwidget"}}, {"model": "contenttypes.contenttype", "pk": 21, "fields": {"app_label": "xadmin", "model": "log"}}, {"model": "contenttypes.contenttype", "pk": 22, "fields": {"app_label": "social_django", "model": "association"}}, {"model": "contenttypes.contenttype", "pk": 23, "fields": {"app_label": "social_django", "model": "code"}}, {"model": "contenttypes.contenttype", "pk": 24, "fields": {"app_label": "social_django", "model": "nonce"}}, {"model": "contenttypes.contenttype", "pk": 25, "fields": {"app_label": "social_django", "model": "usersocialauth"}}, {"model": "contenttypes.contenttype", "pk": 26, "fields": {"app_label": "social_django", "model": "partial"}}, {"model": "sessions.session", "pk": "0zxjvqah3v6ms6n70yhwflfdjwxev80t", "fields": {"session_data": "YzE2YTc0Y2NhYThmMjA4N2U3ODM3MDUxZTc1ZDc2MjNhMDBiMDE2OTp7Il9hdXRoX3VzZXJfaWQiOiI0MzU1ZGI5YS1mMGU2LTQ0MDctYmM5OC1mZWMxM2QyYmUyZmYiLCJfYXV0aF91c2VyX2JhY2tlbmQiOiJhY2NvdW50cy5hdXRoLkN1c3RvbUJhY2tlbmQiLCJfYXV0aF91c2VyX2hhc2giOiJiNjdjYzNkMGFhMDI0YTk5MzU1YTViYjk5ZTJmNzcwYmUyZjdiNzdkIiwibmF2X21lbnUiOiJbe1widGl0bGVcIjogXCJcdTRlMTNcdTk4OThcIiwgXCJtZW51c1wiOiBbe1widGl0bGVcIjogXCJcdTRlM2JcdTk4OThcIiwgXCJ1cmxcIjogXCIveGFkbWluL3N1YmplY3QvdG9waWMvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDEwfSwge1widGl0bGVcIjogXCJcdTdhZTBcdTgyODJcIiwgXCJ1cmxcIjogXCIveGFkbWluL3N1YmplY3QvY2hhcHRlci9cIiwgXCJpY29uXCI6IG51bGwsIFwib3JkZXJcIjogMTF9XSwgXCJmaXJzdF91cmxcIjogXCIveGFkbWluL3N1YmplY3QvdG9waWMvXCJ9LCB7XCJ0aXRsZVwiOiBcIlx1NGZlMVx1NjA2ZlwiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1NGZlMVx1NjA2ZlwiLCBcInVybFwiOiBcIi94YWRtaW4vaW5mby9pbmZvL1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiAxNn1dLCBcImZpcnN0X3VybFwiOiBcIi94YWRtaW4vaW5mby9pbmZvL1wifSwge1widGl0bGVcIjogXCJcdTUzNWFcdTViYTJcIiwgXCJtZW51c1wiOiBbe1widGl0bGVcIjogXCJcdTUyMDZcdTdjN2JcIiwgXCJ1cmxcIjogXCIveGFkbWluL2Jsb2cvY2F0ZWdvcnkvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDZ9LCB7XCJ0aXRsZVwiOiBcIlx1NjU4N1x1N2FlMFwiLCBcInVybFwiOiBcIi94YWRtaW4vYmxvZy9wb3N0L1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiA3fSwge1widGl0bGVcIjogXCJcdTY4MDdcdTdiN2VcIiwgXCJ1cmxcIjogXCIveGFkbWluL2Jsb2cvdGFnL1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiA4fV0sIFwiZmlyc3RfdXJsXCI6IFwiL3hhZG1pbi9ibG9nL2NhdGVnb3J5L1wifSwge1widGl0bGVcIjogXCJcdTUzY2RcdTk5ODhcdThiYzRcdThiYmFcIiwgXCJtZW51c1wiOiBbe1widGl0bGVcIjogXCJcdThiYzRcdThiYmFcIiwgXCJ1cmxcIjogXCIveGFkbWluL2NvbW1lbnQvY29tbWVudC9cIiwgXCJpY29uXCI6IG51bGwsIFwib3JkZXJcIjogMTR9LCB7XCJ0aXRsZVwiOiBcIlx1NTNjZFx1OTk4OFx1NmQ4OFx1NjA2ZlwiLCBcInVybFwiOiBcIi94YWRtaW4vY29tbWVudC9tZXNzYWdlL1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiAxNX1dLCBcImZpcnN0X3VybFwiOiBcIi94YWRtaW4vY29tbWVudC9jb21tZW50L1wifSwge1widGl0bGVcIjogXCJcdTY0Y2RcdTRmNWNcIiwgXCJtZW51c1wiOiBbe1widGl0bGVcIjogXCJcdTc1MjhcdTYyMzdcdTYyOTVcdTc5NjhcIiwgXCJ1cmxcIjogXCIveGFkbWluL29wZXJhdGlvbi91c2Vydm90ZS9cIiwgXCJpY29uXCI6IG51bGwsIFwib3JkZXJcIjogMTJ9LCB7XCJ0aXRsZVwiOiBcIlx1NzUyOFx1NjIzN1x1NjUzNlx1ODVjZlwiLCBcInVybFwiOiBcIi94YWRtaW4vb3BlcmF0aW9uL3VzZXJmYXYvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDEzfV0sIFwiZmlyc3RfdXJsXCI6IFwiL3hhZG1pbi9vcGVyYXRpb24vdXNlcnZvdGUvXCJ9LCB7XCJ0aXRsZVwiOiBcIlx1NjU4N1x1NGVmNlx1NjcwZFx1NTJhMVx1NTY2OFwiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1NjU4N1x1N2FlMFx1NTZmZVx1NzI0N1wiLCBcInVybFwiOiBcIi94YWRtaW4vZmlsZXNlcnZlci9wb3N0aW1nL1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiA5fV0sIFwiZmlyc3RfdXJsXCI6IFwiL3hhZG1pbi9maWxlc2VydmVyL3Bvc3RpbWcvXCJ9LCB7XCJ0aXRsZVwiOiBcIlx1NzUyOFx1NjIzN1x1N2JhMVx1NzQwNlwiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1NzUyOFx1NjIzN1x1OGQyNlx1NjIzN1wiLCBcInVybFwiOiBcIi94YWRtaW4vYWNjb3VudHMvdXNlcnByb2ZpbGUvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDV9XSwgXCJmaXJzdF91cmxcIjogXCIveGFkbWluL2FjY291bnRzL3VzZXJwcm9maWxlL1wifSwge1widGl0bGVcIjogXCJcdTdiYTFcdTc0MDZcIiwgXCJtZW51c1wiOiBbe1widGl0bGVcIjogXCJcdTY1ZTVcdTVmZDdcdThiYjBcdTVmNTVcIiwgXCJ1cmxcIjogXCIveGFkbWluL3hhZG1pbi9sb2cvXCIsIFwiaWNvblwiOiBcImZhIGZhLWNvZ1wiLCBcIm9yZGVyXCI6IDE4fV0sIFwiZmlyc3RfaWNvblwiOiBcImZhIGZhLWNvZ1wiLCBcImZpcnN0X3VybFwiOiBcIi94YWRtaW4veGFkbWluL2xvZy9cIn0sIHtcInRpdGxlXCI6IFwiXHU4YmE0XHU4YmMxXHU1NDhjXHU2Mzg4XHU2NzQzXCIsIFwibWVudXNcIjogW3tcInRpdGxlXCI6IFwiXHU3ZWM0XCIsIFwidXJsXCI6IFwiL3hhZG1pbi9hdXRoL2dyb3VwL1wiLCBcImljb25cIjogXCJmYSBmYS1ncm91cFwiLCBcIm9yZGVyXCI6IDJ9LCB7XCJ0aXRsZVwiOiBcIlx1Njc0M1x1OTY1MFwiLCBcInVybFwiOiBcIi94YWRtaW4vYXV0aC9wZXJtaXNzaW9uL1wiLCBcImljb25cIjogXCJmYSBmYS1sb2NrXCIsIFwib3JkZXJcIjogNH1dLCBcImZpcnN0X2ljb25cIjogXCJmYSBmYS1ncm91cFwiLCBcImZpcnN0X3VybFwiOiBcIi94YWRtaW4vYXV0aC9ncm91cC9cIn1dIiwiTElTVF9RVUVSWSI6W1sic3ViamVjdCIsImNoYXB0ZXIiXSwiX3BfdG9waWNfX2lkX19leGFjdD00Jl9jb2xzPXRpdGxlLnRvcGljLm1kNS5tZF9GaWxlLmNyZWF0ZV9kYXRlLm9yZGVyLm1kX2JvZHkiXX0=", "expire_date": "2020-03-08T02:33:08.853"}}, {"model": "sessions.session", "pk": "e8ddh9v1jmtvavl0ehyrcp3o2cklyy51", "fields": {"session_data": "ZjM1MDNlYzRmMDhhOGZiMDVlYzUxZmVmM2MyZWQ2ODE2NWUyZTNjMTp7Il9hdXRoX3VzZXJfaWQiOiI0MzU1ZGI5YS1mMGU2LTQ0MDctYmM5OC1mZWMxM2QyYmUyZmYiLCJfYXV0aF91c2VyX2JhY2tlbmQiOiJhY2NvdW50cy5hdXRoLkN1c3RvbUJhY2tlbmQiLCJfYXV0aF91c2VyX2hhc2giOiI0OTRmMWVmNmU5ZmJiN2NjYjA4NjIxMTE3MTM3YmYyNTQ0MmQwNGU4IiwiTElTVF9RVUVSWSI6W1sic3ViamVjdCIsInRvcGljIl0sIiJdLCJuYXZfbWVudSI6Ilt7XCJ0aXRsZVwiOiBcIlx1NGUxM1x1OTg5OFwiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1NGUzYlx1OTg5OFwiLCBcInVybFwiOiBcIi94YWRtaW4vc3ViamVjdC90b3BpYy9cIiwgXCJpY29uXCI6IG51bGwsIFwib3JkZXJcIjogMTB9LCB7XCJ0aXRsZVwiOiBcIlx1N2FlMFx1ODI4MlwiLCBcInVybFwiOiBcIi94YWRtaW4vc3ViamVjdC9jaGFwdGVyL1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiAxMX1dLCBcImZpcnN0X3VybFwiOiBcIi94YWRtaW4vc3ViamVjdC90b3BpYy9cIn0sIHtcInRpdGxlXCI6IFwiXHU0ZmUxXHU2MDZmXCIsIFwibWVudXNcIjogW3tcInRpdGxlXCI6IFwiXHU0ZmUxXHU2MDZmXCIsIFwidXJsXCI6IFwiL3hhZG1pbi9pbmZvL2luZm8vXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDE2fV0sIFwiZmlyc3RfdXJsXCI6IFwiL3hhZG1pbi9pbmZvL2luZm8vXCJ9LCB7XCJ0aXRsZVwiOiBcIlx1NTM1YVx1NWJhMlwiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1NTIwNlx1N2M3YlwiLCBcInVybFwiOiBcIi94YWRtaW4vYmxvZy9jYXRlZ29yeS9cIiwgXCJpY29uXCI6IG51bGwsIFwib3JkZXJcIjogNn0sIHtcInRpdGxlXCI6IFwiXHU2NTg3XHU3YWUwXCIsIFwidXJsXCI6IFwiL3hhZG1pbi9ibG9nL3Bvc3QvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDd9LCB7XCJ0aXRsZVwiOiBcIlx1NjgwN1x1N2I3ZVwiLCBcInVybFwiOiBcIi94YWRtaW4vYmxvZy90YWcvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDh9XSwgXCJmaXJzdF91cmxcIjogXCIveGFkbWluL2Jsb2cvY2F0ZWdvcnkvXCJ9LCB7XCJ0aXRsZVwiOiBcIlx1NTNjZFx1OTk4OFx1OGJjNFx1OGJiYVwiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1OGJjNFx1OGJiYVwiLCBcInVybFwiOiBcIi94YWRtaW4vY29tbWVudC9jb21tZW50L1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiAxNH0sIHtcInRpdGxlXCI6IFwiXHU1M2NkXHU5OTg4XHU2ZDg4XHU2MDZmXCIsIFwidXJsXCI6IFwiL3hhZG1pbi9jb21tZW50L21lc3NhZ2UvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDE1fV0sIFwiZmlyc3RfdXJsXCI6IFwiL3hhZG1pbi9jb21tZW50L2NvbW1lbnQvXCJ9LCB7XCJ0aXRsZVwiOiBcIlx1NjRjZFx1NGY1Y1wiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1NzUyOFx1NjIzN1x1NjI5NVx1Nzk2OFwiLCBcInVybFwiOiBcIi94YWRtaW4vb3BlcmF0aW9uL3VzZXJ2b3RlL1wiLCBcImljb25cIjogbnVsbCwgXCJvcmRlclwiOiAxMn0sIHtcInRpdGxlXCI6IFwiXHU3NTI4XHU2MjM3XHU2NTM2XHU4NWNmXCIsIFwidXJsXCI6IFwiL3hhZG1pbi9vcGVyYXRpb24vdXNlcmZhdi9cIiwgXCJpY29uXCI6IG51bGwsIFwib3JkZXJcIjogMTN9XSwgXCJmaXJzdF91cmxcIjogXCIveGFkbWluL29wZXJhdGlvbi91c2Vydm90ZS9cIn0sIHtcInRpdGxlXCI6IFwiXHU2NTg3XHU0ZWY2XHU2NzBkXHU1MmExXHU1NjY4XCIsIFwibWVudXNcIjogW3tcInRpdGxlXCI6IFwiXHU2NTg3XHU3YWUwXHU1NmZlXHU3MjQ3XCIsIFwidXJsXCI6IFwiL3hhZG1pbi9maWxlc2VydmVyL3Bvc3RpbWcvXCIsIFwiaWNvblwiOiBudWxsLCBcIm9yZGVyXCI6IDl9XSwgXCJmaXJzdF91cmxcIjogXCIveGFkbWluL2ZpbGVzZXJ2ZXIvcG9zdGltZy9cIn0sIHtcInRpdGxlXCI6IFwiXHU3NTI4XHU2MjM3XHU3YmExXHU3NDA2XCIsIFwibWVudXNcIjogW3tcInRpdGxlXCI6IFwiXHU3NTI4XHU2MjM3XHU4ZDI2XHU2MjM3XCIsIFwidXJsXCI6IFwiL3hhZG1pbi9hY2NvdW50cy91c2VycHJvZmlsZS9cIiwgXCJpY29uXCI6IG51bGwsIFwib3JkZXJcIjogNX1dLCBcImZpcnN0X3VybFwiOiBcIi94YWRtaW4vYWNjb3VudHMvdXNlcnByb2ZpbGUvXCJ9LCB7XCJ0aXRsZVwiOiBcIlx1N2JhMVx1NzQwNlwiLCBcIm1lbnVzXCI6IFt7XCJ0aXRsZVwiOiBcIlx1NjVlNVx1NWZkN1x1OGJiMFx1NWY1NVwiLCBcInVybFwiOiBcIi94YWRtaW4veGFkbWluL2xvZy9cIiwgXCJpY29uXCI6IFwiZmEgZmEtY29nXCIsIFwib3JkZXJcIjogMTh9XSwgXCJmaXJzdF9pY29uXCI6IFwiZmEgZmEtY29nXCIsIFwiZmlyc3RfdXJsXCI6IFwiL3hhZG1pbi94YWRtaW4vbG9nL1wifSwge1widGl0bGVcIjogXCJcdThiYTRcdThiYzFcdTU0OGNcdTYzODhcdTY3NDNcIiwgXCJtZW51c1wiOiBbe1widGl0bGVcIjogXCJcdTdlYzRcIiwgXCJ1cmxcIjogXCIveGFkbWluL2F1dGgvZ3JvdXAvXCIsIFwiaWNvblwiOiBcImZhIGZhLWdyb3VwXCIsIFwib3JkZXJcIjogMn0sIHtcInRpdGxlXCI6IFwiXHU2NzQzXHU5NjUwXCIsIFwidXJsXCI6IFwiL3hhZG1pbi9hdXRoL3Blcm1pc3Npb24vXCIsIFwiaWNvblwiOiBcImZhIGZhLWxvY2tcIiwgXCJvcmRlclwiOiA0fV0sIFwiZmlyc3RfaWNvblwiOiBcImZhIGZhLWdyb3VwXCIsIFwiZmlyc3RfdXJsXCI6IFwiL3hhZG1pbi9hdXRoL2dyb3VwL1wifV0ifQ==", "expire_date": "2020-03-27T03:06:07.259"}}, {"model": "sessions.session", "pk": "gwtxzykcap8ynbed4be7jfjvsbir9euq", "fields": {"session_data": "ZGJmYmU1ZjFiYTlhZTE2YTdhNDdmZDRkMjI1YjgxZjBhNzAxM2Q2ZDp7InFxX3N0YXRlIjoiUG1oaVpENk9ldkVxTmlCNnlCUURuRTVTajM1V3dWeFAifQ==", "expire_date": "2020-04-01T10:04:57.322"}}, {"model": "sessions.session", "pk": "klhk0caieuyw5rgqx1kyew8e3hc6us26", "fields": {"session_data": "MWNiYWJlYjg0ZmVmMzIyNGIzY2FmMzIyN2NlZGU3MWZkNTU3NzhhMzp7InFxX3N0YXRlIjoiaEZVZ0ZUUUl1ZEVuaDFTMFpqOGk4M25iOGNQZzJMZGIifQ==", "expire_date": "2020-02-22T21:14:42.478"}}, {"model": "sessions.session", "pk": "r1pw2yl0qimbdj5zbeot772wsjk3h8my", "fields": {"session_data": "ZjgwZmE1OWU0MDg5MjcxOTQ5ZTU5NWU2NzdmODE4Y2IwNzM0OThjNzp7IndlaWJvX3N0YXRlIjoiRDY3UXIxVVl0MmNGbnVYSHFVbkhNTHNMWnhab3FmZmYiLCJxcV9zdGF0ZSI6ImF4MUJGNWhWYmt4UXVsVVloRngzemxvWU5rYklkSThKIiwid2VpeGluX3N0YXRlIjoiQlVRWlFLQzZlYUdXMWc0Sm5CdVh0d3dJM0dnVUpwbmoifQ==", "expire_date": "2020-04-21T10:58:34.629"}}, {"model": "blog.category", "pk": 1, "fields": {"name": "\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5", "slug": "shu-ju-jie-gou-yu-suan-fa", "parent_category": null}}, {"model": "blog.category", "pk": 2, "fields": {"name": "\u524d\u7aef", "slug": "qian-duan", "parent_category": null}}, {"model": "blog.category", "pk": 3, "fields": {"name": "javascript", "slug": "javascri", "parent_category": 2}}, {"model": "blog.category", "pk": 4, "fields": {"name": "vue", "slug": "vue", "parent_category": 3}}, {"model": "blog.category", "pk": 5, "fields": {"name": "django", "slug": "django", "parent_category": 7}}, {"model": "blog.category", "pk": 6, "fields": {"name": "\u540e\u7aef", "slug": "hou-duan", "parent_category": null}}, {"model": "blog.category", "pk": 7, "fields": {"name": "python", "slug": "python", "parent_category": 6}}, {"model": "blog.tag", "pk": 1, "fields": {"name": "\u961f\u5217", "slug": "dui-lie"}}, {"model": "blog.tag", "pk": 2, "fields": {"name": "\u9879\u76ee\u914d\u7f6e", "slug": "xiang-mu-pei-zhi"}}, {"model": "blog.tag", "pk": 3, "fields": {"name": "\u90e8\u7f72", "slug": "bu-shu"}}, {"model": "blog.tag", "pk": 4, "fields": {"name": "\u77ed\u7f51\u5740", "slug": "duan-wang-zhi"}}, {"model": "blog.tag", "pk": 5, "fields": {"name": "\u7cfb\u7edf\u8bbe\u8ba1", "slug": "xi-tong-she-ji"}}, {"model": "blog.tag", "pk": 6, "fields": {"name": "\u9762\u8bd5", "slug": "mian-shi"}}, {"model": "blog.tag", "pk": 7, "fields": {"name": "\u8de8\u57df", "slug": "kua-yu"}}, {"model": "blog.tag", "pk": 8, "fields": {"name": "redis", "slug": "redis"}}, {"model": "blog.tag", "pk": 9, "fields": {"name": "bug\u89e3\u51b3", "slug": "bugjie-jue"}}, {"model": "blog.tag", "pk": 10, "fields": {"name": "py\u57fa\u672c\u5e93", "slug": "pyji-ben-ku"}}, {"model": "blog.tag", "pk": 11, "fields": {"name": "nginx", "slug": "nginx"}}, {"model": "blog.tag", "pk": 12, "fields": {"name": "leetcode", "slug": "leetcode"}}, {"model": "blog.tag", "pk": 13, "fields": {"name": "docker", "slug": "docker"}}, {"model": "fileserver.postimg", "pk": "11b2d378-cd42-458b-8c56-cf4444166a73", "fields": {"name": "20200323005935-859", "imgMd5": "bfcea69b9567ece22ef9b396a5b4640b", "img": "postserver/img/20200323005935-859.png", "created_time": "2020-03-23T00:59:35.240"}}, {"model": "fileserver.postimg", "pk": "14e81565-291f-49e6-ad2f-a3277d50fd72", "fields": {"name": "20200323010207-314", "imgMd5": "bd81ad19e5c7b547410758efb17e8e3c", "img": "postserver/img/20200323010207-314.png", "created_time": "2020-03-23T01:02:07.464"}}, {"model": "fileserver.postimg", "pk": "3e61f797-8811-43fe-a786-070ba81f9c1c", "fields": {"name": "20200323021639-804", "imgMd5": "c7d796bdf5e3734ac88fe7ad0ce15bd3", "img": "postserver/img/20200323021639-804.png", "created_time": "2020-03-23T02:16:39.598"}}, {"model": "fileserver.postimg", "pk": "7ad72527-36c8-4cf4-b10d-daddf1316f8a", "fields": {"name": "20200323192405-267", "imgMd5": "39af85f1011fe075d442077e2208bcee", "img": "postserver/img/20200323192405-267.png", "created_time": "2020-03-23T19:24:05.329"}}, {"model": "subject.topic", "pk": 1, "fields": {"title": "\u8fdb\u9636\u4e4b\u8def1.0", "urltag": "\u57fa\u672c\u5e93", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-16T03:54:57.490", "codestyle": "github", "desc": "\u4e00\u4e9b\u5f88\u5c0f\u5f88\u5c0f\u7684\u5185\u5bb9\u8bb0\u5f55", "img": "", "ifshow": true}}, {"model": "subject.topic", "pk": 2, "fields": {"title": "Redis \u6df1\u5ea6\u5386\u9669", "urltag": "redis \u5b9e\u6218", "reproduce": true, "reproduce_source": "https://juejin.im/book/5afc2e5f6fb9a07a9b362527", "create_date": "2020-02-18T02:40:21.669", "codestyle": "solarized-dark", "desc": "\u5927\u578b\u4e92\u8054\u7f51\u4f01\u4e1a Redis \u5b9e\u8df5\u603b\u7ed3\uff0c\u7ed3\u5408\u5b9e\u9645\u95ee\u9898\u6df1\u5165\u8bb2\u89e3 Redis \u5185\u90e8\u673a\u5236", "img": "", "ifshow": true}}, {"model": "subject.topic", "pk": 3, "fields": {"title": "\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357", "urltag": "docker \u5bb9\u5668\u5316", "reproduce": true, "reproduce_source": "https://juejin.im/book/5b7ba116e51d4556f30b476c", "create_date": "2020-02-18T21:16:57.618", "codestyle": "monokai", "desc": "\u5e26\u4f60\u5feb\u901f\u638c\u63e1 Docker \u8fd9\u9879\u65b0\u65f6\u4ee3\u5f00\u53d1\u8005\u5fc5\u5907\u7684\u5de5\u5177", "img": "", "ifshow": true}}, {"model": "subject.topic", "pk": 4, "fields": {"title": "\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1", "urltag": "python RPC", "reproduce": true, "reproduce_source": "https://juejin.im/book/5af56a3c518825426642e004", "create_date": "2020-02-18T21:23:18.551", "codestyle": "monokai", "desc": "\u901a\u8fc7\u300c\u9020\u8f6e\u5b50\u300d\u81ea\u5efa Python RPC \u670d\u52a1\uff0c\u6df1\u5165\u7406\u89e3\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1\u539f\u7406\u4e0e\u5b9e\u8df5", "img": "", "ifshow": true}}, {"model": "subject.topic", "pk": 5, "fields": {"title": "Vue.js \u7ec4\u4ef6\u7cbe\u8bb2", "urltag": "vue \u7ec4\u4ef6", "reproduce": true, "reproduce_source": "https://juejin.im/book/5bc844166fb9a05cd676ebca", "create_date": "2020-02-18T21:34:27.037", "codestyle": "monokai", "desc": "iView \u4f5c\u8005 3 \u5e74\u7684 Vue.js \u7ec4\u4ef6\u5f00\u6e90\u79ef\u7d2f\uff0cVue.js \u7ec4\u4ef6\u77e5\u8bc6\u6df1\u5165\u5256\u6790", "img": "", "ifshow": true}}, {"model": "subject.topic", "pk": 6, "fields": {"title": "\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1", "urltag": "Go Restful", "reproduce": true, "reproduce_source": "https://juejin.im/book/5b0778756fb9a07aa632301e", "create_date": "2020-02-18T21:35:46.110", "codestyle": "monokai", "desc": "Go \u670d\u52a1\u5668\u5f00\u53d1\u5927\u578b\u5b9e\u6218\uff0c\u5e26\u4f60\u4e00\u6b65\u6b65\u6784\u5efa API \u5f00\u53d1\u4e2d\u7684\u5404\u4e2a\u529f\u80fd\u70b9\uff0c\u6700\u7ec8\u5b8c\u6210\u4e00\u4e2a\u4f01\u4e1a\u7ea7\u7684 API \u670d\u52a1\u5668", "img": "", "ifshow": true}}, {"model": "subject.topic", "pk": 7, "fields": {"title": "django-rest-framework-api-guide", "urltag": "drf djnago", "reproduce": true, "reproduce_source": "http://drf.jiuyou.info/#/", "create_date": "2020-02-20T13:09:06.260", "codestyle": "atom-one-dark", "desc": "django-rest-framework-api-guide", "img": "", "ifshow": true}}, {"model": "subject.chapter", "pk": 1, "fields": {"title": "drf.search.sort", "topic": 1, "md5": "8bfdc975daea024c4e5286a599c21d8d", "md_body": "# drf \u7684\u641c\u7d22\u548c\u6392\u5e8f \u529f\u80fd\r\n\r\n```py\r\n\r\n# \u5f15\u5165\r\nfrom rest_framework import filters\r\n#\r\nfilter_backends = (DjangoFilterBackend,filters.SearchFilter)\r\nsearch_fields =('name','goods_brief')\r\n\r\n# \u652f\u6301\u6b63\u5219\r\n```\r\n\r\n# \u6392\u5e8f\r\n\r\n```py\r\nfilter_backends = (DjangoFilterBackend,filters.SearchFilter,filters.OrderingFilter)\r\nordering_fields =('name','xx')\r\n```\r\n", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/drf.search.sort.md", "create_date": "2020-02-16T03:57:51.364", "order": 0}}, {"model": "subject.chapter", "pk": 2, "fields": {"title": "timeit_\u7edf\u8ba1\u65f6\u95f4\u6a21\u5757", "topic": 1, "md5": "d55a1ba144e661a040e88b7256e6fbab", "md_body": "> timeit\u662fpython\u5185\u7f6e\u7684\u7edf\u8ba1\u4ee3\u7801\u8fd0\u884c\u65f6\u95f4\u7684\u6a21\u5757\r\n### \u793a\u4f8b\r\n```py\r\nfrom timeit import Timer\r\n\r\n# \u4ee3\u7801\u6267\u884c\u65f6\u95f4\u6d4b\u91cf:\r\n# timeit\u6a21\u5757 : \u7528\u6765\u6d4b\u8bd5python\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4\r\n\r\ndef test1():\r\n    li = []\r\n    for i in range(0, 10000):\r\n        li.append(i)\r\n\r\ndef test2():\r\n    li = []\r\n    for i in range(0, 10000):\r\n        li += [i]\r\n\r\ndef test3():\r\n    li = [i for i in range(0, 10000)]\r\n\r\ndef test4():\r\n    li = list(range(0, 10000))\r\n\r\ndef test5():\r\n    li = []\r\n    for i in range(0, 10000):\r\n        li.extend([i])\r\n\r\n\r\n# \u7b2c\u4e00\u4e2a\u53c2\u6570: \u9700\u8981\u6267\u884c\u7684\u51fd\u6570 , \u7b2c\u4e8c\u4e2a\u53c2\u6570: \u51fd\u6570\u9700\u8981\u5bfc\u5165\u7684\u5305\r\ntimer1 = Timer(test1, \"from __main__ import test1\")\r\nprint(\"timer1:\", timer1.timeit(1000))\r\n\r\ntimer2 = Timer(\"test2()\", \"from __main__ import test2\")\r\nprint(\"timer2:\", timer1.timeit(1000))\r\n\r\ntimer3 = Timer(\"test3()\", \"from __main__ import test3\")\r\nprint(\"timer3:\", timer3.timeit(1000))\r\n\r\ntimer4 = Timer(\"test4()\", \"from __main__ import test4\")\r\nprint(\"timer4:\", timer4.timeit(1000))\r\n\r\ntimer5 = Timer(\"test5()\", \"from __main__ import test5\")\r\nprint(\"timer5:\", timer5.timeit(1000))\r\n\r\n## \u7ed3\u679c\r\n'''\r\ntimer1: 0.7598853\r\ntimer2: 0.7501497999999999\r\ntimer3: 0.3395074\r\ntimer4: 0.21682160000000006\r\ntimer5: 0.9891466000000002\r\n'''\r\n```\r\n\u4e0a\u8ff0\u4f8b\u5b50\u91cc\uff0c\u4ecetimeit\u6a21\u5757\u5bfc\u5165Timer\u7c7b\uff0c\u5e76\u4e14\u5b9e\u4f8b\u5316\u3002Timer()\u7c7b\u5b9e\u4f8b\u53c2\u6570\uff1a\r\n- stmt\uff1a\u7528\u4e8e\u4f20\u5165\u8981\u6d4b\u8bd5\u65f6\u95f4\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u76f4\u63a5\u63a5\u53d7\u5b57\u7b26\u4e32\u7684\u8868\u8fbe\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u63a5\u53d7\u5355\u4e2a\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u63a5\u53d7\u51fd\u6570\u3002\u4f20\u5165\u51fd\u6570\u65f6\u8981\u628a\u51fd\u6570\u7533\u660e\u5728\u5f53\u524d\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u5728 stmt = func() \u6267\u884c\u51fd\u6570\uff0c\u7136\u540e\u4f7f\u7528 setup = from __main__ import func\r\n\r\n- setup\uff1a\u4f20\u5165stmt\u7684\u8fd0\u884c\u73af\u5883\uff0c\u6bd4\u5982stmt\u4e2d\u4f7f\u7528\u5230\u7684\u53c2\u6570\u3001\u53d8\u91cf\uff0c\u8981\u5bfc\u5165\u7684\u6a21\u5757\u7b49\u3002\u53ef\u4ee5\u5199\u4e00\u884c\u8bed\u53e5\uff0c\u4e5f\u53ef\u4ee5\u5199\u591a\u884c\u8bed\u53e5\uff0c\u5199\u591a\u884c\u8bed\u53e5\u65f6\u8981\u7528\u5206\u53f7\uff1b\u9694\u5f00\u8bed\u53e5\u3002\r\n\r\n- number\uff1a\u8981\u6d4b\u8bd5\u7684\u4ee3\u7801\u7684\u8fd0\u884c\u6b21\u6570\uff0c\u9ed8\u8ba4100000\u6b21\uff0c\u5bf9\u4e8e\u8017\u65f6\u7684\u4ee3\u7801\uff0c\u8fd0\u884c\u592a\u591a\u6b21\u4f1a\u6bd4\u8f83\u6162\uff0c\u6b64\u65f6\u5efa\u8bae\u81ea\u5df1\u4fee\u6539\u4e00\u4e0b\u8fd0\u884c\u6b21\u6570\r\n\r\n- repeat\uff1a\u6307\u6d4b\u8bd5\u8981\u91cd\u590d\u51e0\u6b21\uff0c\u6bcf\u6b21\u7684\u7ed3\u679c\u6784\u6210\u5217\u8868\u8fd4\u56de\uff0c\u9ed8\u8ba43\u6b21\u3002\r\n\r\nTimer\u7c7b\u6709\u4e24\u4e2a\u5b9e\u4f8b\u65b9\u6cd5\uff1atimeit \u548c repeat\r\n\u5176\u4e2d timeit()\u51fd\u6570\u63a5\u6536\u4e00\u4e2aint\u53c2\u6570\uff0c\u8868\u793aTimer()\u7c7b\u5faa\u73af\u65f6\u95f4\uff0c\u9ed8\u8ba4\u53c2\u6570100 0000 ,\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5efa\u8bae\u586b\u53c2\u6570\u59821000,\u8fd4\u56de\u503c\u4e3a\u8fd0\u884c\u65f6\u95f4\r\n> ipython \u89e3\u91ca\u5668\u91cc  \u53ef\u4ee5\u76f4\u63a5 timeit \u65b9\u6cd5 \u67e5\u770b\u8fd0\u884c\u65f6\u95f4 \u5982\r\n` timeit  y=map(lambda x:x**10,range(32))`\r\n", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/timeit_\u7edf\u8ba1\u65f6\u95f4\u6a21\u5757.md", "create_date": "2020-02-16T03:57:51.366", "order": 0}}, {"model": "subject.chapter", "pk": 3, "fields": {"title": "python\u7684\u683c\u5f0f\u5316", "topic": 1, "md5": "2a47dd066466ee10a0e6a19b96a476d0", "md_body": "> \u53d8\u91cf\u683c\u5f0f\u5316\u8f93\u51fa\u662f\u6bcf\u4e2a\u7f16\u7a0b\u8bed\u8a00\u5fc5\u5907\u7684\u6280\u80fd\uff0cpython\u7ecf\u5386\u4e86\u65e9\u671f\u7684%s,\u5230\u540e\u6765\u7684format\u51fd\u6570\uff0c\u5230\u65b0\u7248\u672c\u6dfb\u52a0\u7684f''\uff0c\u66f4\u52a0\u5b9e\u7528\u7b80\u6d01\u3002\r\n\r\n## %\r\n\r\n\u65e9\u671f\u8d77\u6b65\u65f6\u5b66python\uff0c\u6700\u5b9e\u7528\u7684\u4fbf\u662f`%`\u8bed\u6cd5\r\n```py\r\nprice = 108\r\nprint (\"the book's price is %s\" % price)\r\n```\r\n> \u4e0a\u8ff0\u60c5\u51b5\uff0c`'the book's price is %s'`\u662f\u6a21\u677f\u5b57\u7b26\u4e32,\u5176\u4e2d`%s`\u505a\u5360\u4f4d\u7b26\uff0c\u540e\u9762\u8ddf`%`\u5206\u9694\u7b26\uff0c\u6700\u540e\u662f\u66ff\u4ee3\u53d8\u91cf\u3002\r\n> \u5f53\u7136\uff0c\u53ef\u4ee5\u8ddf\u591a\u4e2a\u53d8\u91cf\uff1a\r\n\r\n```py\r\nuser = \"zhp\"\r\nage = 24\r\n# \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u6709\u4e24\u4e2a\u5360\u4f4d\u7b26\uff0c\u7b2c\u4e09\u90e8\u5206\u63d0\u4f9b2\u4e2a\u53d8\u91cf\r\nprint(\"%s is a %s years old boy\" % (user , age))\r\n\r\n```\r\n\u8f6c\u6362\u8bf4\u660e\u7b26`%s`\u4e0d\u6b62\u8fd9\u4e00\u79cd\u60c5\u51b5\uff0c\u9488\u5bf9\u6570\u5b57\uff0c\u5c0f\u6570\uff0c\u8fd8\u6709\u66f4\u591a\uff1a\r\n| \u8f6c\u6362\u8bf4\u660e\u7b26 | \u8bf4\u660e                                                       |\r\n| ---------- | ---------------------------------------------------------- |\r\n| %r         | \u4f7f\u7528 repr() \u5c06\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32                     |\r\n| %s         | \u4f7f\u7528 str() \u5c06\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32                      |\r\n| %G         | \u667a\u80fd\u9009\u62e9\u4f7f\u7528 %F \u6216 %E \u683c\u5f0f                                 |\r\n| %g         | \u667a\u80fd\u9009\u62e9\u4f7f\u7528 %f \u6216 %e \u683c\u5f0f                                 |\r\n| %c         | \u683c\u5f0f\u5316\u5b57\u7b26\u53ca\u5176 [ASCII](http://c.biancheng.net/c/ascii/) \u7801 |\r\n| %f\uff0c%F     | \u8f6c\u5316\u4e3a\u5341\u8fdb\u5236\u5f62\u5f0f\u7684\u6d6e\u70b9\u6570                                   |\r\n| %E         | \u8f6c\u5316\u4e3a\u79d1\u5b66\u8ba1\u6570\u6cd5\u8868\u793a\u7684\u6d6e\u70b9\u6570\uff08E \u5927\u5199\uff09                     |\r\n| %e         | \u8f6c\u5316\u4e3a\u79d1\u5b66\u8ba1\u6570\u6cd5\u8868\u793a\u7684\u6d6e\u70b9\u6570\uff08e \u5c0f\u5199\uff09                     |\r\n| %o         | \u8f6c\u6362\u4e3a\u5e26\u7b26\u53f7\u7684\u516b\u8fdb\u5236\u5f62\u5f0f\u7684\u6574\u6570                             |\r\n| %x\uff0c%X     | \u8f6c\u6362\u4e3a\u5e26\u7b26\u53f7\u7684\u5341\u516d\u8fdb\u5236\u5f62\u5f0f\u7684\u6574\u6570                           |\r\n| %d\uff0c%i     | \u8f6c\u6362\u4e3a\u5e26\u7b26\u53f7\u7684\u5341\u8fdb\u5236\u5f62\u5f0f\u7684\u6574\u6570                             |\r\n\r\n> %\u8bed\u6cd5\u7684\u683c\u5f0f\u5316\uff0c\u5728\u5bf9\u591a\u4e2a\u53d8\u91cf\u590d\u7528\u65f6\u4e0d\u65b9\u4fbf\uff0c\u540c\u65f6\u4f4d\u7f6e\u7684\u5c40\u9650\u6027\uff0c\u4e5f\u5bfc\u81f4\u8fd9\u4e00\u8bed\u6cd5\u9010\u6e10\u843d\u540e\r\n\r\n## format\u51fd\u6570\r\n\r\n>Python2.6 \u5f00\u59cb\uff0c\u65b0\u589e\u4e86\u4e00\u79cd\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u51fd\u6570 `str.format()`\uff0c\u5b83\u589e\u5f3a\u4e86\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u7684\u529f\u80fd\u3002\r\n\u57fa\u672c\u8bed\u6cd5\u662f\u901a\u8fc7 {} \u548c : \u6765\u4ee3\u66ff\u4ee5\u524d\u7684 % \u3002\r\nformat \u51fd\u6570\u53ef\u4ee5\u63a5\u53d7\u4e0d\u9650\u4e2a\u53c2\u6570\uff0c\u4f4d\u7f6e\u53ef\u4ee5\u4e0d\u6309\u987a\u5e8f\u3002\r\n\r\n```py\r\n>>>\"{} {}\".format(\"hello\", \"world\")    # \u4e0d\u8bbe\u7f6e\u6307\u5b9a\u4f4d\u7f6e\uff0c\u6309\u9ed8\u8ba4\u987a\u5e8f\r\n'hello world'\r\n \r\n>>> \"{0} {1}\".format(\"hello\", \"world\")  # \u8bbe\u7f6e\u6307\u5b9a\u4f4d\u7f6e\r\n'hello world'\r\n \r\n>>> \"{1} {0} {1}\".format(\"hello\", \"world\")  # \u8bbe\u7f6e\u6307\u5b9a\u4f4d\u7f6e\r\n'world hello world'\r\n\r\n>>> \"\u7f51\u7ad9\u540d\uff1a{name}, \u5730\u5740 {url}\".format(name=\"zhp\", url=\"zhaoheping.com\")\r\n'\u7f51\u7ad9\u540d\uff1azhp, \u5730\u5740 zhaoheping.com'\r\n \r\n# \u901a\u8fc7\u5b57\u5178\u8bbe\u7f6e\u53c2\u6570\r\n>>> site = {\"name\": \"zhp\", \"url\": \"zhaoheping.com\"}\r\n>>> \"\u7f51\u7ad9\u540d\uff1a{name}, \u5730\u5740 {url}\".format(**site)\r\n'\u7f51\u7ad9\u540d\uff1azhp, \u5730\u5740 zhaoheping.com'\r\n \r\n# \u901a\u8fc7\u5217\u8868\u7d22\u5f15\u8bbe\u7f6e\u53c2\u6570\r\n>>> my_list = ['zhp', 'zhaoheping.com']\r\n>>>\"\u7f51\u7ad9\u540d\uff1a{0[0]}, \u5730\u5740 {0[1]}\".format(my_list)  # \"0\" \u662f\u5fc5\u987b\u7684\r\n'\u7f51\u7ad9\u540d\uff1azhp, \u5730\u5740 zhaoheping.com'\r\n```\r\n> format\u51fd\u6570\u7684\u4f7f\u7528\uff0c\u66f4\u65b9\u4fbf\u4e86\u5b57\u7b26\u4e32\u7684\u683c\u5f0f\u5316\u3002\r\n\r\n## f-string\r\n> f-string\u5728\u529f\u80fd\u65b9\u9762\u4e0d\u900a\u4e8e\u4f20\u7edf\u7684%-formatting\u8bed\u53e5\u548cstr.format()\u51fd\u6570\uff0c\u540c\u65f6\u6027\u80fd\u53c8\u4f18\u4e8e\u4e8c\u8005\uff0c\u4e14\u4f7f\u7528\u8d77\u6765\u4e5f\u66f4\u52a0\u7b80\u6d01\u660e\u4e86\uff0c\u56e0\u6b64\u5bf9\u4e8ePython3.6\u53ca\u4ee5\u540e\u7684\u7248\u672c\uff0c\u63a8\u8350\u4f7f\u7528f-string\u8fdb\u884c\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u3002\r\n\r\n```py\r\n# \u53d8\u91cf\u76f4\u63a5\u66ff\u4ee3\r\n>>> number = 7\r\n>>> f'My lucky number is {number}'\r\n'My lucky number is 7'\r\n\r\n# \u51fd\u6570\u8868\u8fbe\u5f0f\r\n>>> f'A total number of {24 * 8 + 4}'\r\n'A total number of 196\r\n```", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/python\u7684\u683c\u5f0f\u5316.md", "create_date": "2020-02-16T03:57:51.388", "order": 0}}, {"model": "subject.chapter", "pk": 4, "fields": {"title": "os,shutil\u548cglob", "topic": 1, "md5": "b7d52f9e81779e8bf5ef383461d7bfd1", "md_body": "## \u6253\u5f00\u6587\u4ef6\r\n\r\n\u5982\u679c\u4f60\u8981\u5bf9\u4e00\u4e2a\u6587\u4ef6\u8fdb\u884c\u8bfb\u6216\u5199\uff0c\u4f60\u5fc5\u9700\u5148\u7528Python\u5185\u7f6e\u7684open\u51fd\u6570\u6253\u5f00\u5b83\uff0c\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61File Object\uff0c\u4f60\u540c\u65f6\u5fc5\u9700\u6307\u5b9a\u6587\u4ef6\u6253\u5f00\u6a21\u5f0f(\u8bfb\uff0c\u5199\uff0c\u8fd8\u662f\u8bfb\u548c\u5199)\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\u5f53\u4f60\u6253\u5f00\u975e\u6587\u672c\u6587\u4ef6\u5982\u56fe\u7247\u6216PDF\u65f6\u4faf\uff0c\u5fc5\u9700\u7528rb\u6216wb\u6a21\u5f0f\u3002b\u4ee3\u8868\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002\u4f8b\u5b50\u5982\u4e0b\u3002\r\n\r\n\r\n\r\n\r\n\r\n```py\r\n# \u4ee5\u8bfb\u6a21\u5f0f\u6253\u5f00\u6587\u672c\u6587\u4ef6\r\ntxtFileObj = open('some.txt', 'r')\r\n\r\n# \u4ee5\u8bfb\u6a21\u5f0f\u6253\u5f00\u975e\u6587\u672c\u6587\u4ef6\r\npdfFileObj = open('some.pdf', 'rb')\r\n```\r\n\r\n\u5e38\u7528\u6587\u4ef6\u6253\u5f00\u6a21\u5f0f\u5982\u4e0b:\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n| \u6a21\u5f0f | \u63cf\u8ff0                                                         |\r\n| :--- | :----------------------------------------------------------- |\r\n| r    | \u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\u3002\u6587\u4ef6\u7684\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u5f00\u5934\u3002\u8fd9\u662f\u9ed8\u8ba4\u6a21\u5f0f\u3002 |\r\n| rb   | \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u53ea\u8bfb\u3002\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u5f00\u5934\u3002\u8fd9\u662f\u9ed8\u8ba4\u6a21\u5f0f\u3002\u4e00\u822c\u7528\u4e8e\u975e\u6587\u672c\u6587\u4ef6\u5982\u56fe\u7247\u7b49\u3002 |\r\n| r+   | \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u5f00\u5934\u3002           |\r\n| rb+  | \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u5f00\u5934\u3002\u4e00\u822c\u7528\u4e8e\u975e\u6587\u672c\u6587\u4ef6\u5982\u56fe\u7247\u7b49\u3002 |\r\n| w    | \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u53ea\u7528\u4e8e\u5199\u5165\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002 |\r\n| wb   | \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u53ea\u7528\u4e8e\u5199\u5165\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002\u4e00\u822c\u7528\u4e8e\u975e\u6587\u672c\u6587\u4ef6\u5982\u56fe\u7247\u7b49\u3002 |\r\n| w+   | \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002 |\r\n| wb+  | \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\u5219\u5c06\u5176\u8986\u76d6\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u3002\u4e00\u822c\u7528\u4e8e\u975e\u6587\u672c\u6587\u4ef6\u5982\u56fe\u7247\u7b49\u3002 |\r\n| a    | \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8ffd\u52a0\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u65b0\u7684\u5185\u5bb9\u5c06\u4f1a\u88ab\u5199\u5165\u5230\u5df2\u6709\u5185\u5bb9\u4e4b\u540e\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u8fdb\u884c\u5199\u5165\u3002 |\r\n| ab   | \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8ffd\u52a0\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u65b0\u7684\u5185\u5bb9\u5c06\u4f1a\u88ab\u5199\u5165\u5230\u5df2\u6709\u5185\u5bb9\u4e4b\u540e\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u8fdb\u884c\u5199\u5165\u3002 |\r\n| a+   | \u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u6587\u4ef6\u6253\u5f00\u65f6\u4f1a\u662f\u8ffd\u52a0\u6a21\u5f0f\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002 |\r\n| ab+  | \u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u8ffd\u52a0\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u6307\u9488\u5c06\u4f1a\u653e\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002\u5982\u679c\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u6587\u4ef6\u7528\u4e8e\u8bfb\u5199\u3002 |\r\n\r\n##  File\u5bf9\u8c61\u7684\u5c5e\u6027\r\n\r\n\u4e00\u4e2a\u6587\u4ef6\u88ab\u6253\u5f00\u540e\uff0c\u4f60j\u5c31\u6709\u4e86\u4e00\u4e2afile\u5bf9\u8c61\uff0c\u8fd9\u65f6\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u5c5e\u6027\u5f97\u5230\u6709\u5173\u8be5\u6587\u4ef6\u7684\u5404\u79cd\u4fe1\u606f\uff0c\u6bd4\u5982\u540d\u5b57\uff0c\u8bbf\u95ee\u6a21\u5f0f\u3002\r\n\r\n| \u5c5e\u6027           | \u63cf\u8ff0                                                         |\r\n| :------------- | :----------------------------------------------------------- |\r\n| file.closed    | \u8fd4\u56detrue\u5982\u679c\u6587\u4ef6\u5df2\u88ab\u5173\u95ed\uff0c\u5426\u5219\u8fd4\u56defalse\u3002                    |\r\n| file.mode      | \u8fd4\u56de\u88ab\u6253\u5f00\u6587\u4ef6\u7684\u8bbf\u95ee\u6a21\u5f0f\u3002                                   |\r\n| file.name      | \u8fd4\u56de\u6587\u4ef6\u7684\u540d\u79f0\u3002                                             |\r\n| file.softspace | \u5982\u679c\u7528print\u8f93\u51fa\u540e\uff0c\u5fc5\u987b\u8ddf\u4e00\u4e2a\u7a7a\u683c\u7b26\uff0c\u5219\u8fd4\u56defalse\u3002\u5426\u5219\u8fd4\u56detrue\u3002 |\r\n\r\n\r\n\r\n## \u9605\u8bfb\u6587\u4ef6\r\n\r\n\u9605\u8bfb\u6587\u4ef6\uff0c\u4f60\u53ef\u4ee5\u7528file\u5bf9\u8c61\u81ea\u5e26\u7684read\u65b9\u6cd5\u3002\u4f8b\u5b50\u5982\u4e0b:\r\n\r\n```py\r\n# \u6253\u5f00\u975e\u6587\u672c\u6587\u4ef6\r\ntxtFileObj = open('some.txt', 'r')\r\nprint(txtFileObj.read())\r\n\r\n# \u6253\u5f00\u975e\u6587\u672c\u6587\u4ef6\r\npdfFileObj = open('original.pdf', 'rb')\r\npdfFileObj.read()\r\n```\r\n\r\n\u5f53\u4f60\u7684\u6587\u672c\u6587\u4ef6\u6709\u591a\u884c\u65f6\uff0c\u800c\u4f60\u4e0d\u60f3\u4e00\u6b21\u6027\u6253\u5370\u51fa\u6240\u6709\u5185\u5bb9\uff0c\u4f60\u53ef\u4ee5\u8fd9\u4e48\u505a\u3002\r\n\r\n```py\r\n# \u4ee5\u8bfb\u6a21\u5f0f\u6253\u5f00\u975e\u6587\u672c\u6587\u4ef6\r\ntxtFileObj = open('some.txt', 'r')\r\n# \u6253\u5370\u7b2c5\u884c\r\nprint(txtFileObj.read(5))\r\n# \u9010\u884c\u6253\u5370\r\nprint(txtFileObj.readlines())\r\n# \u6216\u8005\u5982\u4e0b\u64cd\u4f5c\r\nfor line in txtFileObj: \r\n    print(line)\r\n```\r\n\r\n\r\n\r\n## \u5199\u5165\u6587\u4ef6\r\n\r\n\u8981\u5c06\u6570\u636e\u5199\u5165\u4e00\u4e2a\u6587\u4ef6\uff0c\u4f60\u5fc5\u9700\u4ee5\u5199\u6216\u8bfb\u5199\u7684\u6a21\u5f0f\u5148\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61\uff0c\u7136\u540e\u4f7f\u7528write\u65b9\u6cd5\u5199\u5165\u3002\u4e0b\u9762\u662f\u4e24\u4e2a\u4f8b\u5b50\u3002\r\n\r\n\r\n\r\n```py\r\n# \u4ee5\u5199\u6a21\u5f0f\u521b\u5efa\u6587\u4ef6\u5bf9\u8c61\uff0c\u7136\u540e\u5199\u5165\r\ntxtFileObj = open('some.txt', 'r+')\r\ntxtFileObj.write(\"Hello, world\")\r\ntxtFileObj.close()\r\n\r\n# \u4ee5\u5199\u6a21\u5f0f\u6253\u5f00\u975e\u6587\u672c\u6587\u4ef6\uff0c\u7136\u540e\u5199\u5165\r\nf = some_data\r\nwith open('some.pdf', 'wb+') as pdfFileObj:\r\n    for chunk in f.chunks():\r\n        pdfFileObj.write(chunk))\r\n```\r\n\r\n\r\n\r\n\r\n\r\n## \u5173\u95ed\u6587\u4ef6\u4e0ewith\u58f0\u660e\r\n\r\n\u5f53\u4f60\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8c61\u540e\uff0c\u4f60\u4e00\u5b9a\u8981\u8bb0\u4f4f\u7528f.close()\u5173\u95ed\u8fd9\u4e2a\u6587\u4ef6\u5bf9\u8c61\uff0c\u8fd9\u6837\u624d\u4f1a\u91ca\u653e\u7cfb\u7edf\u8d44\u6e90\u3002\u5982\u679c\u4f60\u8001\u662f\u5fd8\u8bb0\u5173\u95ed\u4e00\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528python\u7684with\u58f0\u660e\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u3002\u8fd9\u6837\u5728\u4f60\u5b8c\u6210\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c\u540e\uff0cpython\u4f1a\u81ea\u52a8\u5173\u95ed\u6587\u4ef6\u5bf9\u8c61\u3002\u4f8b\u5b50\u5982\u4e0b:\r\n\r\n\r\n\r\n```py\r\n\r\n# \u4ee5\u5199\u6a21\u5f0f\u521b\u5efa\u6587\u4ef6\u5bf9\u8c61\uff0c\u7136\u540e\u5199\u5165\r\nwith open('some.txt', 'r+') as txtFileObj:\r\n    txtFileObj.write(\"Hello, world\")\r\n```\r\n\r\n\r\n\r\n## python\u7684os\u6a21\u5757, shutil\u6a21\u5757\u548cglob\u6a21\u5757\r\n\r\npython\u81ea\u5e26\u7684open\uff0cread, write\u662f\u975e\u5e38\u57fa\u672c\u7684\u6587\u4ef6\u64cd\u4f5c\u3002\u5bf9\u4e8e\u590d\u6742\u70b9\u7684\u6587\u4ef6\u5939\u548c\u6587\u4ef6\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u501f\u52a9python\u7684os\u6a21\u5757\uff0cshutil\u6a21\u5757\u548cglob\u6a21\u5757\u3002\u8fd9\u4e9b\u6a21\u5757\u90fd\u4e0d\u9700\u8981\u989d\u5916\u7684\u5b89\u88c5\uff0c\u53ea\u9700\u8981import\u5373\u53ef\u3002\r\n\r\n\r\n\r\n## os\u6a21\u5757\u7684\u5e38\u89c1\u529f\u80fd \r\n\r\nos\u6a21\u5757\u81ea\u5e26\u7684\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u64cd\u4f5c\u65b9\u6cd5\u90fd\u975e\u5e38\u6709\u7528\u3002\r\n\r\n- \u5f97\u5230\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u7684\u8def\u5f84: ==os.getcwd()==\r\n\r\n- \u6539\u53d8\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55: ==os.chdir(path)==\r\n\r\n  \r\n\r\n- \u8fd4\u56de\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\u540d:==os.listdir(path)==\r\n\r\n- \u51fd\u6570\u7528\u6765\u5220\u9664\u4e00\u4e2a\u6587\u4ef6:==os.remove(path)==\u548c==os.unlink(path)==\r\n\r\n- \u68c0\u9a8c\u7ed9\u51fa\u7684\u8def\u5f84\u662f\u5426\u662f\u4e00\u4e2a\u6587\u4ef6\uff1a==os.path.isfile(path)==\r\n\r\n- \u68c0\u9a8c\u7ed9\u51fa\u7684\u8def\u5f84\u662f\u5426\u662f\u4e00\u4e2a\u76ee\u5f55\uff1a==os.path.isdir(path)==\r\n\r\n  \r\n\r\n- \u5224\u65ad\u662f\u5426\u662f\u7edd\u5bf9\u8def\u5f84\uff1a==os.path.isabs()==\r\n\r\n- \u68c0\u67e5\u662f\u5426\u5feb\u6377\u65b9\u5f0f==os.path.islink (filename )==\r\n\r\n- \u68c0\u9a8c\u7ed9\u51fa\u7684\u8def\u5f84\u662f\u5426\u771f\u5730\u5b58\u5728:==os.path.exists(path)==\r\n\r\n- \u8fd4\u56de\u4e00\u4e2a\u8def\u5f84\u7684\u76ee\u5f55\u540d\u548c\u6587\u4ef6\u540d:os.path.split() eg os.path.split('/home/python/django.html') \u7ed3\u679c\uff1a('/home/python', 'django.html')\r\n\r\n- \u62fc\u63a5\u5de5\u4f5c\u8def\u5f84: ==os.path.join(str1, str2, str3..)==\r\n\r\n- \u5206\u79bb\u6269\u5c55\u540d\uff1a==os.path.splitext()==\r\n\r\n-== \u83b7\u53d6\u8def\u5f84\u540d==\uff1a==os.path.dirname(path)==\r\n\r\n- ==\u83b7\u53d6\u6587\u4ef6\u540d==\uff1a==os.path.basename()==\r\n\r\n- \u8fd0\u884cshell\u547d\u4ee4: ==os.system()==\r\n\r\n- \u8bfb\u53d6\u548c\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf:==os.getenv()== \u4e0e==os.putenv()==\r\n\r\n- \u7ed9\u51fa\u5f53\u524d\u5e73\u53f0\u4f7f\u7528\u7684\u884c\u7ec8\u6b62\u7b26:os.linesep Windows\u4f7f\u7528'\\r\\n'\uff0cLinux\u4f7f\u7528'\\n'\u800cMac\u4f7f\u7528'\\r'\r\n\r\n- \u6307\u793a\u4f60\u6b63\u5728\u4f7f\u7528\u7684\u5e73\u53f0\uff1aos.name \u5bf9\u4e8eWindows\uff0c\u5b83\u662f'nt'\uff0c\u800c\u5bf9\u4e8eLinux/Unix\u7528\u6237\uff0c\u5b83\u662f'posix'\r\n\r\n- ==\u91cd\u547d\u540d==\uff1a==os.rename(old, new\uff09==\r\n\r\n- ==\u521b\u5efa\u591a\u7ea7\u76ee\u5f55==\uff1a==os.makedirs\uff08r\u201cc\uff1a\\python\\test\u201d\uff09==\r\n\r\n- ==\u521b\u5efa\u5355\u4e2a\u76ee\u5f55==\uff1aos.mkdir\uff08\u201ctest\u201d\uff09\r\n\r\n- ==\u5220\u9664\u5355\u4e2a\u76ee\u5f55==: os.rmdir\uff08\u201ctest\")\r\n\r\n- \u5220\u9664\u591a\u4e2a\u76ee\u5f55\uff1aos.removedirs\uff08r\u201cc:\\folder\u201d\uff09\r\n\r\n- \u83b7\u53d6\u6587\u4ef6\u5c5e\u6027\uff1aos.stat()\r\n\r\n- ==\u4fee\u6539\u6587\u4ef6\u6743\u9650\u4e0e\u65f6\u95f4\u6233==\uff1a==os.chmod()==\r\n\r\n- ==\u7ec8\u6b62\u5f53\u524d\u8fdb\u7a0b==\uff1a==os.exit()==\r\n\r\n- \u83b7\u53d6\u6587\u4ef6\u5927\u5c0f\uff1a==os.path.getsize(filename\uff09==\r\n\r\n\u503c\u5f97\u6ce8\u610f\u7684\u662fwindows\u548cLinux\u91c7\u7528\u4e86\u4e0d\u540c\u7684\u8def\u5f84\u5206\u9694\u7b26(\u201c/\u201d\u548c\"\\\"\u3002\u6211\u6700\u559c\u6b22\u7684\u65b9\u6cd5\u662f==os.path.join==\u65b9\u6cd5\uff0c\u63d0\u9ad8\u4e86\u6211\u4eec\u4ee3\u7801\u53ef\u79fb\u690d\u6027\u3002\u6bd4\u5982\u4e0b\u9762\u4ee3\u7801:\r\n\r\n\r\n\r\n```py\r\nos.path.join(\"python\", \"django\", \"some.py\")\r\n```\r\n\r\n- \u5728windows\u4e0b\u8fd4\u56depython\\django\\some.py\r\n\r\n- \u5728linux\u4e0b\u8fd4\u56depython/django/some.py\r\n\r\n  \r\n\r\n  \r\n\r\n\r\n\r\n\u53e6\u5916\u8bf7\u8bb0\u4f4f\u5220\u9664\u5355\u4e2a\u6587\u4ef6\u7528os.remove()\u6216os.unlink()\u3002\u5728Windows\u7cfb\u7edf\u4e0b\u5220\u9664\u4e00\u4e2a\u6b63\u5728\u4f7f\u7528\u7684\u6587\u4ef6\u4f1a\u51fa\u73b0\u9519\u8bef\u3002\u5220\u9664\u5355\u4e2a\u6587\u4ef6\u5939\u8bf7\u7528os.rmdir(), \u4f46\u662f\u8be5\u65b9\u6cd5\u53ea\u80fd\u7528\u4e8e\u5220\u9664\u4e00\u4e2a\u7a7a\u7684\u76ee\u5f55\u3002 \u5220\u9664\u591a\u4e2a\u76ee\u5f55\u7528os.removedirs()\uff0c\u5982\u679c\u5b50\u76ee\u5f55\u5220\u9664\u4e0d\u6210\u529f\uff08\u6bd4\u5982\u4e0d\u4e3a\u7a7a)\uff0c\u4e5f\u4f1a\u51fa\u73b0\u9519\u8bef\u3002\r\n\r\n\r\n\r\n\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u770b\u51e0\u4e2a\u5229\u7528os\u6a21\u5757\u64cd\u4f5c\u6587\u4ef6\u7684\u5b9e\u9645\u6848\u4f8b\uff0c\u8fd9\u4e9b\u9762\u8bd5\u548c\u5b9e\u9645\u5de5\u4f5c\u4e2d\u90fd\u9700\u8981\u4e86\u89e3\u7684\u77e5\u8bc6\u3002\r\n\r\n\r\n\r\n## \u67e5\u627e\u67d0\u4e2a\u76ee\u5f55\u4e0b\u7684\u5168\u90e8txt\u6587\u4ef6\u5e76\u5220\u9664\u3002\r\n\r\n\u5047\u8bbe\u6211\u4eec\u5728\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u4e0b\u6709\u4e2a\u53ebtutorial\u7684\u6587\u4ef6\u5939\uff0c\u6211\u4eec\u8981\u628a\u91cc\u9762\u7684txt\u6587\u4ef6\uff0c\u5220\u9664\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u505a\uff1a\r\n\r\n\r\n\r\n```py\r\n>>> import os\r\n>>> os.getcwd() # \u83b7\u53d6\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\r\n'C:\\\\Users\\\\MissEnka\\\\Python'\r\n>>> os.listdir('tutorial') # \u67e5\u770btutorial\u6587\u4ef6\u5939\r\n['notes.txt', 'pdf docs', 'txtfiles']\r\n>>> for filename in os.listdir('tutorial'):\r\n    if filename.endswith('.txt'):\r\n        os.remove(os.path.join('tutorial', filename))\r\n        print(\"{} deleted.\".format(filename))\r\n\r\nnotes.txt deleted.\r\n```\r\n\r\n\u4e0a\u6bb5\u4ee3\u7801\u67092\u70b9\u9700\u8981\u4f60\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u4f60\u53d1\u73b0\u6ca1\u6709?\r\n\r\n- \u6211\u4eec\u53ea\u5220\u9664\u4e86tutorial\u6587\u4ef6\u4e0b\u7684notes.txt\u6587\u4ef6\uff0c\u5e76\u6ca1\u6709\u5220\u9664\u5b50\u6587\u4ef6\u5939txtfiles\u91cc\u7684.txt\u6587\u4ef6\u3002\u60f3\u8981\u904d\u5386\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u67e5\u627e\u6240\u6709\u76ee\u5f55\u5305\u62ec\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230\u4e0b\u9762\u4f1a\u63d0\u5230\u7684==os.walk()==\u65b9\u6cd5\u3002\r\n- \u6211\u4eec\u7528\u7684os.remove(==os.path.join(\"tutorial\"), filename)==)\u800c\u4e0d\u662f\u7b80\u5355\u7528os.remove(filename)\u6765\u5220\u9664\u6587\u4ef6\uff0c\u8fd9\u662f\u56e0\u4e3anotes.txt\u76f8\u5bf9\u4e8e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u7684\u8def\u5f84\u662f/tutorial/notes.txt, \u800c\u4e0d\u662fnotes.txt\u3002\r\n\r\n\r\n\r\n## \u4f7f\u7528os.walk()\u904d\u5386\u4e00\u4e2a\u6587\u4ef6\u5939\u5b50\u76ee\u5f55\u67e5\u627e\u6240\u6709txt\u6587\u4ef6\u5e76\u5220\u9664 \r\n\r\n\r\n\r\n```py\r\n>>> for foldName, subfolders, filenames in os.walk('tutorial'):\r\n    for filename in filenames:\r\n      if filename.endswith('.txt'):\r\n         os.remove(os.path.join(foldName, filename))\r\n         print(\"{} deleted.\".format(filename))\r\n```\r\n\r\n\u7528os.walk(\uff09\u6253\u5370\u51fa\u67d0\u4e2a\u6587\u4ef6\u5939\u4e0b\u6240\u6709\u5b50\u76ee\u5f55\u548c\u6587\u4ef6\u540d\u79f0\u65b9\u6cd5\u5982\u4e0b\u3002\u6765\u6e90: Automate the boring stuff with Python\u3002\r\n\r\n```py\r\nimport os\r\nfolderName, subfolders, filenames in os.walk('directory'):\r\n    print('The current folder is ' + folderName)\r\n\r\n    for subfolder in subfolders:\r\n        print('SUBFOLDER OF ' + folderName + ': ' + subfolder)\r\n    for filename in filenames:\r\n        print('FILE INSIDE ' + folderName + ': '+ filename)\r\n\r\n    print('')\r\n```\r\n\r\n\r\n\r\n## \u5229\u7528shutil\u6a21\u5757\u590d\u5236\u548c\u79fb\u52a8\u6587\u4ef6\r\n\r\nshutil\u6a21\u5757\u53ef\u4ee5\u7528\u6765\u590d\u5236\u548c\u79fb\u52a8\u4e00\u4e2a\u6587\u4ef6\u3002==shutil.copy==()\u7528\u6765\u590d\u5236\u6587\u4ef6\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u9700\u8981\u590d\u5236\u7684\u6587\u4ef6\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u53ef\u4ee5\u662f\u6587\u4ef6\u5939\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e2a\u6587\u4ef6\u540d\u3002\u5982\u679c\u662f\u6587\u4ef6\u5939\uff0c\u65b0\u6587\u4ef6\u5c06\u5b58\u50a8\u5728\u65b0\u6587\u4ef6\u5939\u91cc\uff0c\u6587\u4ef6\u540d\u4e0d\u53d8\u3002\u5982\u679c\u662f\u6587\u4ef6\u540d\uff0c\u5219\u65b0\u6587\u4ef6\u76f4\u63a5\u4ee5\u6587\u4ef6\u540d\u547d\u540d\u3002==shutil.copyfile==()\u4e0eshutil.copy()\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc72\u4e2a\u53c2\u6570\u90fd\u5fc5\u9700\u662f\u6587\u4ef6\u540d\u3002\r\n\r\n\r\n\r\n```py\r\n>> import shutil\r\n>> import os\r\n>> os.chdir('C:\\\\')\r\n>> shutil.copy('C:\\\\spam.txt', 'C:\\\\delicious')\r\n'C:\\\\delicious\\\\spam.txt'\r\n>> shutil.copy('eggs.txt', 'C:\\\\delicious\\\\eggs2.txt')\r\n'C:\\\\delicious\\\\eggs2.txt'\r\n```\r\n\r\nshutil\u8fd8\u5e38\u7528\u6765\u590d\u5236\u6587\u4ef6\u5939\u6216\u79fb\u52a8\u6587\u4ef6\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\r\n\r\n```py\r\n# \u590d\u5236\u6587\u4ef6\u5939. olddir\u548cnewdir\u90fd\u53ea\u80fd\u662f\u76ee\u5f55\uff0c\u4e14newdir\u5fc5\u987b\u4e0d\u5b58\u5728\r\nshutil.copytree(\"\u8001\u76ee\u5f55\", \"\u65b0\u76ee\u5f55\")\r\n\r\n# \u79fb\u52a8\u6587\u4ef6\uff08\u76ee\u5f55\uff09\r\nshutil.move(\"\u8001\u4f4d\u7f6e\", \"\u65b0\u4f4d\u7f6e\") \r\n```\r\n\r\n\r\n\r\n## \u5229\u7528glob\u6a21\u5757\u5feb\u901f\u67e5\u627e\u5f53\u524d\u6587\u4ef6\u5939\u6587\u4ef6\r\n\r\nglob\u6a21\u5757\u662f\u6700\u7b80\u5355\u7684python\u6a21\u5757\u3002\u5b83\u53ef\u4ee5\u67e5\u627e\u7b26\u5408\u7279\u5b9a\u89c4\u5219\u7684\u6587\u4ef6\u8def\u5f84\u540d\uff0c\u5e76\u8fd4\u56de\u6240\u6709\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84\u5217\u8868\u3002\u7c7b\u4f3c\u6b63\u5219\u8868\u8fbe\u5f0f\uff0cglob\u652f\u6301\u4e09\u4e2a\u5339\u914d\u7b26\uff1a\u201d*\u201d, \u201c?\u201d, \u201c[]\u201d\u3002\u201d*\u201d\u5339\u914d0\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\uff1b\u201d?\u201d\u5339\u914d\u5355\u4e2a\u5b57\u7b26\uff1b\u201d[]\u201d\u5339\u914d\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5b57\u7b26.\r\n\r\n```py\r\n>>> import os\r\n>>> os.getcwd()\r\n'C:\\\\Users\\\\MissEnka\\\\Python'\r\n>>> import glob\r\n>>> glob.glob('*.txt')\r\n['LICENSE.txt', 'list.txt', 'NEWS.txt']\r\n>>> glob.glob('tutorial/.txt')\r\n[]\r\n>>> glob.glob('tutorial/*.txt')\r\n['tutorial\\\\new.txt']\r\n```\r\n\r\nglob\u4e00\u822c\u53ea\u641c\u7d22\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u6216\u6307\u5b9a\u76ee\u5f55\u91cc\u7684\u6587\u4ef6, \u4e0d\u80fd\u505a\u6587\u4ef6\u5939\u904d\u5386, \u7528\u65f6\u9700\u6ce8\u610f.", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/41--osshutil\u548cglob.md", "create_date": "2020-02-17T12:57:05.857", "order": 1}}, {"model": "subject.chapter", "pk": 5, "fields": {"title": "Python\uff1a\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b", "topic": 1, "md5": "2c880c090b2fb968ba215b79bceccdf5", "md_body": "## \u7c7b(Class)\u4e0e\u5bf9\u8c61(Object)\r\n>\u7c7b(Class)\u662f\u7528\u6765\u63cf\u8ff0\u5177\u6709\u76f8\u540c\u5c5e\u6027(Attribute)\u548c\u65b9\u6cd5(Method)\u5bf9\u8c61\u7684\u96c6\u5408\u3002\u5bf9\u8c61(Object)\u662f\u7c7b(Class)\u7684\u5177\u4f53\u5b9e\u4f8b\u3002\u6bd4\u5982\u5b66\u751f\u90fd\u6709\u540d\u5b57\u548c\u5206\u6570\uff0c\u4ed6\u4eec\u6709\u7740\u5171\u540c\u7684\u5c5e\u6027\u3002\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u8bbe\u8ba1\u4e00\u4e2a\u5b66\u751f\u7c7b, \u7528\u4e8e\u8bb0\u5f55\u5b66\u751f\u7684\u540d\u5b57\u548c\u5206\u6570\uff0c\u5e76\u81ea\u5b9a\u4e49\u65b9\u6cd5\u6253\u5370\u51fa\u4ed6\u4eec\u7684\u540d\u5b57\u548c\u65b9\u6cd5\u3002\r\n\r\n - ==\u5c5e\u6027(Attribute)==: \u7c7b\u91cc\u9762\u7528\u4e8e\u63cf\u8ff0\u6240\u6709\u5bf9\u8c61\u5171\u540c\u7279\u5f81\u7684\u53d8\u91cf\u6216\u6570\u636e\u3002\u6bd4\u5982\u5b66\u751f\u7684\u540d\u5b57\u548c\u5206\u6570\u3002\r\n - ==\u65b9\u6cd5(Method)==: \u7c7b\u91cc\u9762\u7684\u51fd\u6570\uff0c\u7528\u6765\u533a\u522b\u7c7b\u5916\u9762\u7684\u51fd\u6570, \u7528\u6765\u5b9e\u73b0\u67d0\u4e9b\u529f\u80fd\u3002\u6bd4\u5982\u6253\u5370\u51fa\u5b66\u751f\u7684\u540d\u5b57\u548c\u5206\u6570\u3002\r\n\u8981\u521b\u5efa\u4e00\u4e2a\u7c7b\u6211\u4eec\u9700\u8981\u4f7f\u7528\u5173\u952e\u8bcdclass. \u8fd9\u4e2a\u5b66\u751f\u7c7bStudent\u770b\u4e0a\u53bb\u5e94\u8be5\u662f\u8fd9\u6837\u7684:\r\n```py\r\n# \u521b\u5efa\u4e00\u4e2a\u5b66\u751f\u7c7b\r\nclass Student:\r\n    # \u5b9a\u4e49\u5b66\u751f\u5c5e\u6027\uff0c\u521d\u59cb\u5316\u65b9\u6cd5\r\n    def __init__(self, name, score):\r\n        self.name = name\r\n        self.score = score\r\n    # \u5b9a\u4e49\u6253\u5370\u5b66\u751f\u4fe1\u606f\u7684\u65b9\u6cd5\r\n    def show(self):\r\n        print(\"Name: {}. Score: {}\".format(self.name, self.score))\r\n\r\n```\r\n\r\n\u5728\u8fd9\u4e2a\u6848\u4f8b\u4e2d\uff0c\u6211\u4eec\u53ea\u5b9a\u4e49\u4e86\u4e00\u4e2a\u62bd\u8c61\u7684\u7c7b\uff0c\u7535\u8111\u5e76\u6ca1\u6709\u521b\u5efa\u4ec0\u4e48\u5b58\u50a8\u7a7a\u95f4\u3002==\u53ea\u6709\u5f53\u6211\u4eec\u5b8c\u6210\u7c7b\u7684\u5b9e\u4f8b\u5316(Instance)\u65f6\uff0c\u7535\u8111\u624d\u4f1a\u521b\u5efa\u4e00\u4e2a\u5177\u4f53\u7684\u5bf9\u8c61\uff08Object\uff09\uff0c\u5e76\u4e3a\u4e4b\u5206\u914d\u5b58\u50a8\u7a7a\u95f4\u3002== \u6240\u4ee5\u5bf9\u8c61\uff08Object)\u662f\u7c7b\uff08Class)\u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002\r\n\r\n\u8981\u521b\u5efa\u4e00\u4e2a\u5177\u4f53\u7684\u5b66\u751f\u5bf9\u8c61(Object)\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u8f93\u5165:\r\n\r\n```py\r\nstudent1 = Student(\"John\", 100)\r\nstudent2 = Student(\"Lucy\", 99)\r\n```\r\n\u5728\u8fd9\u4e2a\u6848\u4f8b\u4e2d\uff0cStudent\u662f\u7c7b\uff0cstudent1\u548cstudent2\u662f\u6211\u4eec\u521b\u5efa\u7684\u5177\u4f53\u7684\u5b66\u751f\u5bf9\u8c61\u3002\u5f53\u6211\u4eec\u8f93\u5165\u4e0a\u8ff0\u4ee3\u7801\u65f6\uff0cPython\u4f1a\u81ea\u52a8\u8c03\u7528\u9ed8\u8ba4\u7684 ==__init__== \u521d\u59cb\u6784\u9020\u51fd\u6570\u6765\u751f\u6210\u5177\u4f53\u7684\u5bf9\u8c61\u3002\u5173\u952e\u5b57 ==self== \u662f\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u53c2\u6570\uff0c\u4ee3\u8868\u521b\u5efa\u7684\u5bf9\u8c61\u672c\u8eab\u3002\r\n\r\n\u5f53\u4f60\u521b\u5efa\u5177\u4f53\u7684\u5bf9\u8c61\u540e\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7==student1.name==\u548c==student1.score==\u6765\u5206\u522b\u83b7\u53d6\u5b66\u751f\u7684\u540d\u5b57\u548c\u5206\u6570\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7==student1.show()==\u6765\u76f4\u63a5\u6253\u5370\u5b66\u751f\u7684\u540d\u5b57\u548c\u5206\u6570\r\n\r\n## \u7c7b\u53d8\u91cf(class variables)\u4e0e\u5b9e\u4f8b\u53d8\u91cf\uff08instance variables\uff09\r\n\u5047\u8bbe\u6211\u4eec\u9700\u8981\u5728Student\u7c7b\u91cc\u589e\u52a0\u4e00\u4e2a\u8ba1\u6570\u5668number\uff0c\u6bcf\u5f53\u4e00\u4e2a\u65b0\u7684\u5b66\u751f\u5bf9\u8c61(Object)\u88ab\u521b\u5efa\u65f6\uff0c\u8fd9\u4e2a\u8ba1\u6570\u5668\u5c31\u81ea\u52a8\u52a01\u3002\u7531\u4e8e\u8fd9\u4e2a\u8ba1\u6570\u5668\u4e0d\u5c5e\u4e8e\u67d0\u4e2a\u5177\u4f53\u5b66\u751f\uff0c\u800c\u5c5e\u4e8eStudent\u7c7b\u7684\uff0c\u6240\u4ee5\u88ab\u79f0\u4e3a==\u7c7b\u53d8\u91cf(class variables)==\u3002\u800c\u59d3\u540d\u548c\u5206\u6570\u5c5e\u4e8e\u6bcf\u4e2a\u5b66\u751f\u5bf9\u8c61\u7684\uff0c\u6240\u4ee5\u5c5e\u4e8e==\u5b9e\u4f8b\u53d8\u91cf(instance variables)==\uff0c\u4e5f\u88ab\u79f0\u4e3a\u5bf9\u8c61\u53d8\u91cf(object variables)\u3002\r\n\r\n\u8fd9\u4e2a\u65b0Student\u7c7b\u770b\u4e0a\u53bb\u5e94\u8be5\u662f\u8fd9\u6837\u7684:\r\n```py\r\n# \u521b\u5efa\u4e00\u4e2a\u5b66\u751f\u7c7b\r\nclass Student:\r\n\r\n    # number\u5c5e\u4e8e\u7c7b\u53d8\u91cf\uff0c\u5b9a\u4e49\u5728\u65b9\u6cd5\u5916\uff0c\u4e0d\u5c5e\u4e8e\u5177\u4f53\u5b9e\u4f8b\r\n    number = 0\r\n\r\n    # \u5b9a\u4e49\u5b66\u751f\u5c5e\u6027\uff0c\u521d\u59cb\u5316\u65b9\u6cd5\r\n    # name\u548cscore\u5c5e\u4e8e\u5b9e\u4f8b\u53d8\u91cf\uff0c\u5b9a\u4e49\u5728\u65b9\u6cd5\u91cc\r\n    def __init__(self, name, score):\r\n        self.name = name\r\n        self.score = score\r\n        # \u6b64\u5904\u6709\u9519\u8bef\r\n        number = number + 1\r\n\r\n    # \u5b9a\u4e49\u6253\u5370\u5b66\u751f\u4fe1\u606f\u7684\u65b9\u6cd5\r\n    def show(self):\r\n        print(\"Name: {}. Score: {}\".format(self.name, self.score))\r\n\r\n```\r\n\u7c7b\u53d8\u91cf\u548c\u5b9e\u4f8b\u53d8\u91cf\u7684\u533a\u522b\u5f88\u5927\uff0c\u8bbf\u95ee\u65b9\u5f0f\u4e5f\u4e5f\u4e0d\u4e00\u6837\u3002\r\n- \u7c7b\u53d8\u91cf\uff1a==\u7c7b\u53d8\u91cf\u5728\u6574\u4e2a\u5b9e\u4f8b\u5316\u7684\u5bf9\u8c61\u4e2d\u662f\u516c\u7528\u7684\u3002\u7c7b\u53d8\u91cf\u5b9a\u4e49\u5728\u7c7b\u4e2d\u4e14\u5728\u51fd\u6570\u4f53\u4e4b\u5916==\u3002\u8bbf\u95ee\u6216\u8c03\u7528\u7c7b\u53d8\u91cf\u7684\u6b63\u786e\u65b9\u5f0f\u662f==\u7c7b\u540d.\u53d8\u91cf\u540d==\u6216\u8005==self.__class__.\u53d8\u91cf\u540d==\u3002self.__class__\u81ea\u52a8\u8fd4\u56de\u6bcf\u4e2a\u5bf9\u8c61\u7684\u7c7b\u540d\u3002\r\n\r\n- \u5b9e\u4f8b\u53d8\u91cf\uff1a==\u5b9a\u4e49\u5728\u65b9\u6cd5\u4e2d\u7684\u53d8\u91cf==\uff0c\u5c5e\u4e8e\u67d0\u4e2a\u5177\u4f53\u7684\u5bf9\u8c61\u3002\u8bbf\u95ee\u6216\u8c03\u7528\u5b9e\u4f8b\u53d8\u91cf\u7684\u6b63\u786e\u65b9\u5f0f\u662f==\u5bf9\u8c61\u540d.\u53d8\u91cf\u540d==\u6216\u8005==self.\u53d8\u91cf\u540d==.\r\n\r\n\r\n\u6ce8\u610f\u5230\u4e0a\u8ff0Student\u7c7b\u6709\u4e2a\u9519\u8bef\u6ca1? \u6211\u4eec\u8bd5\u56fe\u76f4\u63a5\u4f7f\u7528number = number + 1\u8c03\u7528\u5c5e\u4e8e\u7c7b\u7684\u53d8\u91cfnumber\u3002\u6b63\u786e\u7684\u65b9\u5f0f\u662f\u4f7f\u7528Student.number\u6216self.__class__.number\u8bbf\u95ee\u5c5e\u4e8e\u7c7b\u7684\u53d8\u91cf\u3002\u4e0b\u9762\u7684\u4ee3\u7801\u624d\u662f\u6b63\u786e\u7684:\r\n\r\n\r\n```py\r\n# \u521b\u5efa\u4e00\u4e2a\u5b66\u751f\u7c7b\r\nclass Student:\r\n\r\n    # number\u5c5e\u4e8e\u7c7b\u53d8\u91cf\uff0c\u4e0d\u5c5e\u4e8e\u67d0\u4e2a\u5177\u4f53\u7684\u5b66\u751f\u5b9e\u4f8b\r\n    number = 0\r\n\r\n    # \u5b9a\u4e49\u5b66\u751f\u5c5e\u6027\uff0c\u521d\u59cb\u5316\u65b9\u6cd5\r\n    # name\u548cscore\u5c5e\u4e8e\u5b9e\u4f8b\u53d8\u91cf\r\n    def __init__(self, name, score):\r\n        self.name = name\r\n        self.score = score\r\n        Student.number = Student.number + 1\r\n\r\n    # \u5b9a\u4e49\u6253\u5370\u5b66\u751f\u4fe1\u606f\u7684\u65b9\u6cd5\r\n    def show(self):\r\n        print(\"Name: {}. Score: {}\".format(self.name, self.score))\r\n\r\n# \u5b9e\u4f8b\u5316\uff0c\u521b\u5efa\u5bf9\u8c61\r\nstudent1 = Student(\"John\", 100)\r\nstudent2 = Student(\"Lucy\", 99)\r\n\r\nprint(Student.number)  # \u6253\u53702\r\nprint(student1.__class__.number) # \u6253\u53702\r\n```\r\n\r\n## \u7c7b\u65b9\u6cd5(Class method)\r\n\r\n\r\n\r\n\u6b63\u5982\u540c==\u6709\u4e9b\u53d8\u91cf\u53ea\u5c5e\u4e8e\u7c7b\uff0c\u6709\u4e9b\u65b9\u6cd5\u4e5f\u53ea\u5c5e\u4e8e\u7c7b\uff0c\u4e0d\u5c5e\u4e8e\u5177\u4f53\u7684\u5bf9\u8c61==\u3002\u4f60\u6709\u6ca1\u6709\u6ce8\u610f\u5230\u5c5e\u4e8e\u5bf9\u8c61\u7684\u65b9\u6cd5\u91cc\u9762\u90fd\u6709\u4e00\u4e2a==self==\u53c2\u6570, \u6bd4\u5982__init__(self), show(self)? ==self==\u662f\u6307\u5bf9\u8c61\u672c\u8eab\u3002\u5c5e\u4e8e\u7c7b\u7684\u65b9\u6cd5\u4e0d\u4f7f\u7528self\u53c2\u6570\uff0c \u800c\u4f7f\u7528\u53c2\u6570==cls==\uff0c\u4ee3\u8868\u7c7b\u672c\u8eab\u3002\u53e6\u5916\u4e60\u60ef\u4e0a\u5bf9\u7c7b\u65b9\u6cd5\u6211\u4eec\u4f1a\u52a0\u4e0a==@classmethod==\u7684\u4fee\u9970\u7b26\u505a\u8bf4\u660e\u3002\r\n\r\n\r\n\r\n\u540c\u6837\u62ffStudent\u4e3a\u4f8b\u5b50\uff0c\u6211\u4eec\u4e0d\u7528print\u51fd\u6570\u6253\u5370\u51fa\u5df2\u521b\u5efa\u5b66\u751f\u5bf9\u8c61\u7684\u6570\u91cf\uff0c\u800c\u662f\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u65b9\u6cd5\u6765\u6253\u5370\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u505a:\r\n\r\n\r\n```py\r\nclass Student:\r\n\r\n    # number\u5c5e\u4e8e\u7c7b\u53d8\u91cf\uff0c\u4e0d\u5c5e\u4e8e\u67d0\u4e2a\u5177\u4f53\u7684\u5b66\u751f\u5b9e\u4f8b\r\n    number = 0\r\n\r\n    # \u5b9a\u4e49\u5b66\u751f\u5c5e\u6027\uff0c\u521d\u59cb\u5316\u65b9\u6cd5\r\n    # name\u548cscore\u5c5e\u4e8e\u5b9e\u4f8b\u53d8\u91cf\r\n    def __init__(self, name, score):\r\n        self.name = name\r\n        self.score = score\r\n        Student.number = Student.number + 1\r\n\r\n    # \u5b9a\u4e49\u6253\u5370\u5b66\u751f\u4fe1\u606f\u7684\u65b9\u6cd5\r\n    def show(self):\r\n        print(\"Name: {}. Score: {}\".format(self.name, self.score))\r\n\r\n    # \u5b9a\u4e49\u7c7b\u65b9\u6cd5\uff0c\u6253\u5370\u5b66\u751f\u7684\u6570\u91cf\r\n    @classmethod\r\n    def total(cls):\r\n        print(\"Total: {0}\".format(cls.number))\r\n\r\n\r\n# \u5b9e\u4f8b\u5316\uff0c\u521b\u5efa\u5bf9\u8c61\r\nstudent1 = Student(\"John\", 100)\r\nstudent2 = Student(\"Lucy\", 99)\r\n\r\nStudent.total()  # \u6253\u5370 Total: 2\r\n\r\n```\r\n## \u7c7b\u7684\u79c1\u6709\u5c5e\u6027(private attribute)\u548c\u79c1\u6709\u65b9\u6cd5(private method)\r\n\r\n\r\n\r\n\u7c7b\u91cc\u9762\u7684==\u79c1\u6709\u5c5e\u6027==\u548c==\u79c1\u6709\u65b9\u6cd5==\u4ee5\u53cc\u4e0b\u5212\u7ebf==__==\u5f00\u5934\u3002==\u79c1\u6709\u5c5e\u6027\u6216\u65b9\u6cd5\u4e0d\u80fd\u5728\u7c7b\u7684\u5916\u90e8\u88ab\u4f7f\u7528\u6216\u76f4\u63a5\u8bbf\u95ee==\u3002\u6211\u4eec\u540c\u6837\u770b\u770b\u5b66\u751f\u7c7b\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u628a\u5206\u6570score\u53d8\u4e3a\u79c1\u6709\u5c5e\u6027\uff0c\u770b\u770b\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002\r\n\r\n\r\n```py\r\n# \u521b\u5efa\u4e00\u4e2a\u5b66\u751f\u7c7b\r\nclass Student:\r\n\r\n    # \u5b9a\u4e49\u5b66\u751f\u5c5e\u6027\uff0c\u521d\u59cb\u5316\u65b9\u6cd5\r\n    # name\u548cscore\u5c5e\u4e8e\u5b9e\u4f8b\u53d8\u91cf, \u5176\u4e2d__score\u5c5e\u4e8e\u79c1\u6709\u53d8\u91cf\r\n    def __init__(self, name, score):\r\n        self.name = name\r\n        self.__score = score\r\n\r\n    # \u5b9a\u4e49\u6253\u5370\u5b66\u751f\u4fe1\u606f\u7684\u65b9\u6cd5\r\n    def show(self):\r\n        print(\"Name: {}. Score: {}\".format(self.name, self.__score))\r\n\r\n# \u5b9e\u4f8b\u5316\uff0c\u521b\u5efa\u5bf9\u8c61\r\nstudent1 = Student(\"John\", 100)\r\n\r\nstudent1.show()  # \u6253\u5370 Name: John, Score: 100\r\nstudent1.__score  # \u6253\u5370\u51fa\u9519\uff0c\u8be5\u5c5e\u6027\u4e0d\u80fd\u4ece\u5916\u90e8\u8bbf\u95ee\u3002\r\n\r\n```\r\n\u5982\u679c\u4f60\u5c06score\u53d8\u6210__score, \u4f60\u5c06\u4e0d\u80fd\u76f4\u63a5\u901a\u8fc7student1.__score\u83b7\u53d6\u8be5\u5b66\u751f\u7684\u5206\u6570\u3002show()\u53ef\u4ee5\u6b63\u5e38\u663e\u793a\u5206\u6570\uff0c\u662f\u56e0\u4e3a\u5b83\u662f\u7c7b\u91cc\u9762\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u8bbf\u95ee\u79c1\u6709\u53d8\u91cf\u3002\r\n\r\n\r\n\r\n\u79c1\u6709\u65b9\u6cd5\u662f\u540c\u6837\u7684\u9053\u7406\u3002\u5f53\u6211\u4eec\u628ashow()\u53d8\u6210\uff0c__show()\u4f60\u5c06\u4e0d\u80fd\u518d\u901a\u8fc7student1.__show()\u6253\u5370\u51fa\u5b66\u751f\u7684\u540d\u5b57\u548c\u5206\u6570\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f==\u79c1\u6709\u65b9\u6cd5\u5fc5\u9700\u542b\u6709self\u8fd9\u4e2a\u53c2\u6570\uff0c\u4e14\u628a\u5b83\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570==\u3002\r\n\r\n\r\n\r\n> \u5728\u9762\u5411\u5bf9\u8c61\u7684\u7f16\u7a0b\u4e2d,\u901a\u5e38\u60c5\u51b5\u4e0b\u5f88\u5c11\u8ba9\u5916\u90e8\u7c7b\u76f4\u63a5\u8bbf\u95ee\u7c7b\u5185\u90e8\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u800c\u662f\u5411\u5916\u90e8\u7c7b\u63d0\u4f9b\u4e00\u4e9b\u6309\u94ae,\u5bf9\u5176\u5185\u90e8\u7684\u6210\u5458\u8fdb\u884c\u8bbf\u95ee,\u4ee5\u4fdd\u8bc1\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\uff0c\u8fd9\u5c31\u662f\u5c01\u88c5\u3002\r\n\r\n\r\n\r\n## @property\u7684\u7528\u6cd5\u4e0e\u795e\u5947\u4e4b\u5904\r\n\r\n\r\n\r\n\u5728\u4e0a\u8ff0\u6848\u4f8b\u4e2d\u7528\u6237\u4e0d\u80fd\u7528student1.__score\u65b9\u5f0f\u8bbf\u95ee\u5b66\u751f\u5206\u6570\uff0c\u7136\u800c\u7528\u6237\u4e5f\u5c31\u77e5\u9053\u4e86__score\u662f\u4e2a\u79c1\u6709\u53d8\u91cf\u3002\u6211\u4eec\u6709\u6ca1\u6709\u4e00\u79cd\u65b9\u6cd5\u8ba9\u7528\u6237\u901a\u8fc7student1.score\u6765\u8bbf\u95ee\u5b66\u751f\u5206\u6570\u800c\u7ee7\u7eed\u4fdd\u6301__score\u79c1\u6709\u53d8\u91cf\u7684\u5c5e\u6027\u5462\uff1f\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u501f\u52a9python\u7684==@property\u88c5\u9970\u5668==\u4e86\u3002\u6211\u4eec\u53ef\u4ee5\u5148\u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5score(), \u7136\u540e==\u5229\u7528@property\u628a\u8fd9\u4e2a\u51fd\u6570\u4f2a\u88c5\u6210\u5c5e\u6027==\u3002\u89c1\u4e0b\u9762\u4f8b\u5b50:\r\n\r\n\r\n\r\n```py\r\n# \u521b\u5efa\u4e00\u4e2a\u5b66\u751f\u7c7b\r\nclass Student:\r\n\r\n    # \u5b9a\u4e49\u5b66\u751f\u5c5e\u6027\uff0c\u521d\u59cb\u5316\u65b9\u6cd5\r\n    # name\u548cscore\u5c5e\u4e8e\u5b9e\u4f8b\u53d8\u91cf, \u5176\u4e2dscore\u5c5e\u4e8e\u79c1\u6709\u53d8\u91cf\r\n    def __init__(self, name, score):\r\n        self.name = name\r\n        self.__score = score\r\n\r\n    # \u5229\u7528property\u88c5\u9970\u5668\u628a\u51fd\u6570\u4f2a\u88c5\u6210\u5c5e\u6027\r\n    @property\r\n    def score(self):\r\n        print(\"Name: {}. Score: {}\".format(self.name, self.__score))\r\n\r\n# \u5b9e\u4f8b\u5316\uff0c\u521b\u5efa\u5bf9\u8c61\r\n\r\nstudent1 = Student(\"John\", 100)\r\n\r\nstudent1.score  # \u6253\u5370 Name: John. Score: 100\r\n\r\n```\r\n\u6ce8\u610f\uff1a ==\u4e00\u65e6\u7ed9\u51fd\u6570\u52a0\u4e0a\u4e00\u4e2a\u88c5\u9970\u5668@property,\u8c03\u7528\u51fd\u6570\u7684\u65f6\u5019\u4e0d\u7528\u52a0\u62ec\u53f7\u5c31\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u51fd\u6570\u4e86== \r\n\r\n\r\n\r\n## \u7c7b\u7684\u7ee7\u627f(Inheritance)\r\n\r\n\r\n\r\n\u9762\u5411\u5bf9\u8c61\u7684\u7f16\u7a0b\u5e26\u6765\u7684\u6700\u5927\u597d\u5904\u4e4b\u4e00\u5c31\u662f\u4ee3\u7801\u7684\u91cd\u7528\uff0c\u5b9e\u73b0\u8fd9\u79cd\u91cd\u7528\u7684\u65b9\u6cd5\u4e4b\u4e00\u662f\u901a\u8fc7==\u7ee7\u627f(Inheritance)==\u3002\u4f60\u53ef\u4ee5\u5148\u5b9a\u4e49\u4e00\u4e2a\u57fa\u7c7b(Base class)\u6216\u7236\u7c7b(Parent class)\uff0c\u518d\u6309\u901a\u8fc7class \u5b50\u7c7b\u540d\uff08\u7236\u7c7b\u540d)\u6765\u521b\u5efa\u5b50\u7c7b(Child class)\u3002\u8fd9\u6837==\u5b50\u7c7b\u5c31\u53ef\u4ee5\u4ece\u7236\u7c7b\u90a3\u91cc\u83b7\u5f97\u5176\u5df2\u6709\u7684\u5c5e\u6027\u4e0e\u65b9\u6cd5\uff0c\u8fd9\u79cd\u73b0\u8c61\u53eb\u505a\u7c7b\u7684\u7ee7\u627f==\u3002\r\n\r\n\r\n\r\n\u6211\u4eec\u518d\u770b\u53e6\u4e00\u4e2a\u4f8b\u5b50\uff0c\u8001\u5e08\u548c\u5b66\u751f\u540c\u5c5e\u5b66\u6821\u6210\u5458\uff0c\u90fd\u6709\u59d3\u540d\u548c\u5e74\u9f84\u7684\u5c5e\u6027\uff0c\u7136\u800c\u8001\u5e08\u6709\u5de5\u8d44\u8fd9\u4e2a\u4e13\u6709\u5c5e\u6027\uff0c\u5b66\u751f\u6709\u5206\u6570\u8fd9\u4e2a\u4e13\u6709\u5c5e\u6027\u3002\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e491\u4e00\u4e2a\u5b66\u6821\u6210\u5458\u7236\u7c7b\uff0c2\u4e2a\u5b50\u7c7b\u3002\r\n\r\n\r\n```py\r\n# \u521b\u5efa\u7236\u7c7b\u5b66\u6821\u6210\u5458SchoolMember\r\nclass SchoolMember:\r\n\r\n    def __init__(self, name, age):\r\n        self.name = name\r\n        self.age = age\r\n\r\n    def tell(self):\r\n        # \u6253\u5370\u4e2a\u4eba\u4fe1\u606f\r\n        print('Name:\"{}\" Age:\"{}\"'.format(self.name, self.age), end=\" \")\r\n\r\n\r\n# \u521b\u5efa\u5b50\u7c7b\u8001\u5e08 Teacher\r\nclass Teacher(SchoolMember):\r\n\r\n    def __init__(self, name, age, salary):\r\n        SchoolMember.__init__(self, name, age) # \u5229\u7528\u7236\u7c7b\u8fdb\u884c\u521d\u59cb\u5316\r\n        self.salary = salary\r\n\r\n    # \u65b9\u6cd5\u91cd\u5199\r\n    def tell(self):\r\n        SchoolMember.tell(self)\r\n        print('Salary: {}'.format(self.salary))\r\n\r\n\r\n# \u521b\u5efa\u5b50\u7c7b\u5b66\u751fStudent\r\nclass Student(SchoolMember):\r\n\r\n    def __init__(self, name, age, score):\r\n        SchoolMember.__init__(self, name, age)\r\n        self.score = score\r\n\r\n    def tell(self):\r\n        SchoolMember.tell(self)\r\n        print('score: {}'.format(self.score))\r\n\r\n\r\nteacher1 = Teacher(\"John\", 44, \"$60000\")\r\nstudent1 = Student(\"Mary\", 12, 99)\r\n\r\nteacher1.tell()  # \u6253\u5370 Name:\"John\" Age:\"44\" Salary: $60000\r\nstudent1.tell()  # Name:\"Mary\" Age:\"12\" score: 99\r\n\r\n```\r\n\u4e0a\u8ff0\u4ee3\u7801\u4e2d\uff0c\u4f60\u6ce8\u610f\u5230\u4ee5\u4e0b\u51e0\u70b9\u4e86\u5417\uff1f\r\n\r\n\r\n\r\n- \u5728\u521b\u5efa\u5b50\u7c7b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u9700\u8981==\u624b\u52a8\u8c03\u7528\u7236\u7c7b\u7684\u6784\u9020\u51fd\u6570__init__==\u6765\u5b8c\u6210\u5b50\u7c7b\u7684\u6784\u9020\u3002\r\n\r\n- ==\u5728\u5b50\u7c7b\u4e2d\u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5\u65f6\uff0c\u9700\u8981\u52a0\u4e0a\u7236\u7c7b\u7684\u7c7b\u540d\u524d\u7f00\uff0c\u4e14\u9700\u8981\u5e26\u4e0aself\u53c2\u6570\u53d8\u91cf==\u3002\u6bd4\u5982SchoolMember.tell(self), \u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528super\u5173\u952e\u8bcd\u7b80\u5316\u4ee3\u7801\u3002\r\n\r\n- \u5982\u679c\u5b50\u7c7b\u8c03\u7528\u4e86\u67d0\u4e2a\u65b9\u6cd5(\u5982tell())\u6216\u5c5e\u6027\uff0c==Python\u4f1a\u5148\u5728\u5b50\u7c7b\u4e2d\u627e\uff0c\u5982\u679c\u627e\u5230\u4e86\u4f1a\u76f4\u63a5\u8c03\u7528\u3002\u5982\u679c\u627e\u4e0d\u5230\u624d\u4f1a\u53bb\u7236\u7c7b\u627e==\u3002\u8fd9\u4e3a\u65b9\u6cd5\u91cd\u5199\u5e26\u6765\u4e86\u4fbf\u5229\u3002\r\n\r\n\r\n\r\n\u5b9e\u9645Python\u7f16\u7a0b\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u4e2a\u5b50\u7c7b\u53ef\u4ee5\u7ee7\u627f\u591a\u4e2a\u7236\u7c7b\uff0c\u539f\u7406\u662f\u4e00\u6837\u7684\u3002\u7b2c\u4e00\u6b65\u603b\u662f\u8981\u624b\u52a8\u8c03\u7528__init__\u6784\u9020\u51fd\u6570\u3002\r\n\r\n\r\n\r\n## super()\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u65b9\u6cd5\r\n\r\n\r\n\r\n\u5728\u5b50\u7c7b\u5f53\u4e2d\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528super\u5173\u952e\u5b57\u6765\u76f4\u63a5\u8c03\u7528\u7236\u7c7b\u7684\u4e2d\u76f8\u5e94\u7684\u65b9\u6cd5\uff0c\u7b80\u5316\u4ee3\u7801\u3002\u5728\u4e0b\u9762\u4f8b\u5b50\u4e2d\uff0c\u5b66\u751f\u5b50\u7c7b\u8c03\u7528\u4e86\u7236\u7c7b\u7684tell()\u65b9\u6cd5\u3002super().tell()\u7b49\u540c\u4e8eSchoolMember.tell(self)\u3002\u5f53==\u4f60\u4f7f\u7528Python super()\u5173\u952e\u5b57\u8c03\u7528\u7236\u7c7b\u65b9\u6cd5\u65f6\u65f6\uff0c\u6ce8\u610f\u53bb\u6389\u62ec\u53f7\u91ccself\u8fd9\u4e2a\u53c2\u6570==\u3002\r\n\r\n```py\r\n\r\n# \u521b\u5efa\u5b50\u7c7b\u5b66\u751fStudent\r\nclass Student(SchoolMember):\r\n\r\n    def __init__(self, name, age, score):\r\n        SchoolMember.__init__(self, name, age)\r\n        self.score = score\r\n\r\n    def tell(self):\r\n        super().tell() # \u7b49\u540c\u4e8e SchoolMember.tell(self)\r\n        print('score: {}'.format(self.score))\r\n\r\n```", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/31--Python\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b.md", "create_date": "2020-02-17T12:57:05.859", "order": 2}}, {"model": "subject.chapter", "pk": 6, "fields": {"title": "Python\u7684re\u6a21\u5757\u53ca\u6b63\u5219\u8868\u8fbe\u5f0f(regex)", "topic": 1, "md5": "b7440740731196fa5962fa23468fe735", "md_body": "## re\u6a21\u5757\u7684\u4e3b\u8981\u65b9\u6cd5\r\n\r\nPython\u81ea\u5e26\u7684re\u6a21\u5757\u4e3b\u8981\u5305\u542b\u5982\u4e0b6\u79cd\u65b9\u6cd5\uff0c\u6211\u4eec\u7a0d\u540e\u4f1a\u9010\u4e00\u4ecb\u7ecd\u3002\u5728\u4f7f\u7528\u8fd9\u4e9b\u65b9\u6cd5\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8981\u5b66\u4f1a\u5982\u4f55\u7f16\u5199\u5b57\u7b26\u4e32\u6a21\u5f0f(pattern)\u3002\r\n\r\n- re.compile: \u7f16\u8bd1\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f(pattern)\r\n- re.match: \u4ece\u5934\u5f00\u59cb\u5339\u914d, \u4f7f\u7528group()\u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6==\u7b2c\u4e00\u4e2a\u5339\u914d\u503c==\r\n- re.search: \u7528\u5305\u542b\u65b9\u5f0f\u5339\u914d\uff0c\u4f7f\u7528group()\u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6==\u7b2c\u4e00\u4e2a\u5339\u914d\u503c==\r\n- re.findall: \u7528\u5305\u542b\u65b9\u5f0f\u5339\u914d\uff0c\u628a\u6240\u6709\u5339\u914d\u5230\u7684\u5b57\u7b26\u653e\u5230\u4ee5\u5217\u8868\u4e2d\u7684\u5143\u7d20\u8fd4\u56de\u591a==\u4e2a\u5339\u914d\u503c==\r\n- re.sub: \u5339\u914d\u5b57\u7b26\u5e76\u66ff\u6362\r\n- re.split: \u4ee5\u5339\u914d\u5230\u7684\u5b57\u7b26\u5f53\u505a\u5217\u8868\u5206\u9694\u7b26\uff0c\u8fd4\u56de\u5217\u8868\r\n\r\n\r\n\r\n## Python\u6b63\u5219\u8868\u8fbe\u5f0f\u7b26\u53f7\u610f\u4e49\r\n\r\n| \u6a21\u5f0f    | \u63cf\u8ff0                                                         |\r\n| :------ | :----------------------------------------------------------- |\r\n| ^       | \u5339\u914d\u5b57\u7b26\u4e32\u7684\u5f00\u5934                                             |\r\n| $       | \u5339\u914d\u5b57\u7b26\u4e32\u7684\u672b\u5c3e\u3002                                           |\r\n| .       | \u5339\u914d\u4efb\u610f\u5b57\u7b26\uff0c\u9664\u4e86\u6362\u884c\u7b26\u3002                                   |\r\n| [...]   | \u7528\u6765\u8868\u793a\u4e00\u7ec4\u5b57\u7b26,\u5355\u72ec\u5217\u51fa\uff1a[amk] \u5339\u914d 'a'\uff0c'm'\u6216'k'          |\r\n| [^...]  | \u4e0d\u5728[]\u4e2d\u7684\u5b57\u7b26\uff1a[^abc] \u5339\u914d\u9664\u4e86a,b,c\u4e4b\u5916\u7684\u5b57\u7b26\u3002             |\r\n| *       | \u5339\u914d0\u4e2a\u6216\u591a\u4e2a\u7684\u8868\u8fbe\u5f0f\u3002                                      |\r\n| +       | \u5339\u914d1\u4e2a\u6216\u591a\u4e2a\u7684\u8868\u8fbe\u5f0f\u3002                                      |\r\n| ?       | \u5339\u914d0\u4e2a\u62161\u4e2a\u7531\u524d\u9762\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5b9a\u4e49\u7684\u7247\u6bb5\uff0c\u975e\u8d2a\u5a6a\u65b9\u5f0f         |\r\n| { n}    | \u7cbe\u786e\u5339\u914d n \u4e2a\u524d\u9762\u8868\u8fbe\u5f0f\u3002\u4f8b\u5982\uff0c **o{2}** \u80fd\u5339\u914d \"food\" \u4e2d\u7684\u4e24\u4e2a o\u3002 |\r\n| { n,}   | \u5339\u914d n \u4e2a\u524d\u9762\u8868\u8fbe\u5f0f\u3002\u4f8b\u5982\uff0c o{2,} \u80fd\u5339\u914d \"foooood\"\u4e2d\u7684\u6240\u6709 o\u3002\"o{1,}\" \u7b49\u4ef7\u4e8e \"o+\"\u3002\"o{0,}\" \u5219\u7b49\u4ef7\u4e8e \"o*\"\u3002 |\r\n| { n, m} | \u5339\u914d n \u5230 m \u6b21\u7531\u524d\u9762\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5b9a\u4e49\u7684\u7247\u6bb5\uff0c\u8d2a\u5a6a\u65b9\u5f0f         |\r\n| a\\| b   | \u5339\u914da\u6216b                                                     |\r\n| ()      | \u5339\u914d\u62ec\u53f7\u5185\u7684\u8868\u8fbe\u5f0f\uff0c\u4e5f\u8868\u793a\u4e00\u4e2a\u7ec4                             |\r\n\r\n\r\n\r\n\u6211\u4eec.\u53f7\u5339\u914d\u6240\u6709\u5b57\u7b26\u3002\u9664\u6b64\u4ee5\u5916\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5b57\u7b26\u5339\u914d\u5b57\u6bcd\uff0c\u7a7a\u767d\u7b26\u6216\u6570\u5b57\u3002\u5982\\d\u4ee3\u8868\u4e00\u4f4d\u6574\u6570\uff0c\\d+\u4ee3\u8868\u4e00\u4f4d\u6216\u591a\u4f4d\u6574\u6570\uff0c\\d{4}\u4ee3\u8868\u56db\u4f4d\u6574\u6570\uff0c\u5982\u5e74\u4efd\u3002\r\n\r\n\r\n\r\n\r\n\r\n| \\w   | \u5339\u914d\u5b57\u6bcd\u6570\u5b57\u53ca\u4e0b\u5212\u7ebf                                         |\r\n| ---- | ------------------------------------------------------------ |\r\n| \\W   | \u5339\u914d\u975e\u5b57\u6bcd\u6570\u5b57\u53ca\u4e0b\u5212\u7ebf                                       |\r\n| \\s   | \u5339\u914d\u4efb\u610f\u7a7a\u767d\u5b57\u7b26\uff0c\u7b49\u4ef7\u4e8e [\\t\\n\\r\\f].                         |\r\n| \\S   | \u5339\u914d\u4efb\u610f\u975e\u7a7a\u5b57\u7b26                                             |\r\n| \\d   | \u5339\u914d\u4efb\u610f\u6570\u5b57\uff0c\u7b49\u4ef7\u4e8e [0-9].                                  |\r\n| \\D   | \u5339\u914d\u4efb\u610f\u975e\u6570\u5b57                                               |\r\n| \\A   | \u5339\u914d\u5b57\u7b26\u4e32\u5f00\u59cb                                               |\r\n| \\Z   | \u5339\u914d\u5b57\u7b26\u4e32\u7ed3\u675f\uff0c\u5982\u679c\u662f\u5b58\u5728\u6362\u884c\uff0c\u53ea\u5339\u914d\u5230\u6362\u884c\u524d\u7684\u7ed3\u675f\u5b57\u7b26\u4e32\u3002 |\r\n| \\z   | \u5339\u914d\u5b57\u7b26\u4e32\u7ed3\u675f                                               |\r\n\r\n**\r\n**\r\n\r\n## re.compile\u65b9\u6cd5 \r\n\r\ncompile \u51fd\u6570\u7528\u4e8e\u7f16\u8bd1\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u751f\u6210\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\uff08 Pattern \uff09\u5bf9\u8c61\uff0c\u4f9b match() \u548c search() \u8fd9\u4e24\u4e2a\u51fd\u6570\u4f7f\u7528\u3002\u5176\u51fd\u6570\u5305\u542b\u4e24\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2apattern\uff0c\u4e00\u4e2a\u53ef\u9009\u53c2\u6570flags\u3002\r\n\r\n```\r\nre.compile(pattern[, flags])\r\n```\r\n\r\n\u53c2\u6570\uff1a\r\n\r\n- **pattern** : \u4e00\u4e2a\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\r\n\r\n- **flags** : \u53ef\u9009\uff0c\u8868\u793a\u5339\u914d\u6a21\u5f0f\uff0c\u6bd4\u5982\u5ffd\u7565\u5927\u5c0f\u5199\uff0c\u591a\u884c\u6a21\u5f0f\u7b49\uff0c\u5177\u4f53\u53c2\u6570\u4e3a\uff1a\r\n\r\n- - **re.I** \u5ffd\u7565\u5927\u5c0f\u5199\r\n  - **re.L** \u8868\u793a\u7279\u6b8a\u5b57\u7b26\u96c6 \\w, \\W, \\b, \\B, \\s, \\S \u4f9d\u8d56\u4e8e\u5f53\u524d\u73af\u5883\r\n  - **re.M** \u591a\u884c\u6a21\u5f0f\r\n  - **re.S** \u5373\u4e3a **.** \u5e76\u4e14\u5305\u62ec\u6362\u884c\u7b26\u5728\u5185\u7684\u4efb\u610f\u5b57\u7b26\uff08**.** \u4e0d\u5305\u62ec\u6362\u884c\u7b26\uff09\r\n  - **re.U** \u8868\u793a\u7279\u6b8a\u5b57\u7b26\u96c6 \\w, \\W, \\b, \\B, \\d, \\D, \\s, \\S \u4f9d\u8d56\u4e8e Unicode \u5b57\u7b26\u5c5e\u6027\u6570\u636e\u5e93\r\n  - **re.X** \u4e3a\u4e86\u589e\u52a0\u53ef\u8bfb\u6027\uff0c\u5ffd\u7565\u7a7a\u683c\u548c **#** \u540e\u9762\u7684\u6ce8\u91ca\r\n\r\n\u4e0a\u8ff0flags re.I\u548cre.M\u662f\u975e\u5e38\u5e38\u7528\u7684\u3002\u5982\u679c\u8981\u540c\u65f6\u4f7f\u7528\u4e24\u4e2aflags\uff0c\u53ef\u4ee5\u4f7f\u7528==re.I | re.M==\u3002\r\n\r\n\r\n\r\n\u4e0b\u4f8b\u4e2d\u6211\u4eec\u7f16\u5199\u4e86\u4e00\u4e2a\u7535\u5b50\u90ae\u7bb1\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5e76\u7528\u5b83\u6765\u9a8c\u8bc1\u7528\u6237\u8f93\u5165\u7684\u90ae\u7bb1\u662f\u5426\u6709\u6548\u3002\u4f60\u53ef\u4ee5\u770b\u5230\u6709\u5339\u914d\u7684\u5bf9\u8c61\u5b58\u5728\u3002\u5982\u679c\u6ca1\u6709\u5339\u914d\u5230\u5b57\u7b26\u4e32\uff0cre.match\u65b9\u6cd5\u4f1a\u8fd4\u56deNone\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528if re.match(pattern, string)\u6765\u5224\u65ad\u6765\u68c0\u67e5\u662f\u5426\u6709\u5339\u914d\u3002\u4f60\u6216\u8bb8\u8981\u95ee\u4e86\uff0c\u6211\u4eec\u5982\u4f55\u4ece\u6709\u5339\u914d\u7684\u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\u5462? \u6211\u4eec\u9a6c\u4e0a\u8bb2\u5230\u3002\r\n\r\n```py\r\n>>> import re\r\n>>> email_pattern = re.compile(r'^[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+){0,4}\r\n@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+){0,4}$')\r\n>>> re.match(email_pattern, 'django@pyghon.org')\r\n<_sre.SRE_Match object; span=(0, 17), match='django@pyghon.org'>\r\n```\r\n\r\n\r\n\r\n## re.match\u548cre.search\u65b9\u6cd5\r\n\r\nre.match\u548cre.search\u65b9\u6cd5\u7c7b\u4f3c\uff0c\u552f\u4e00\u4e0d\u540c\u7684\u662fre.match\u4ece\u5934\u5339\u914d\uff0cre.search\u53ef\u4ee5\u4ece\u5b57\u7b26\u4e32\u4e2d\u4efb\u4e00\u4f4d\u7f6e\u5339\u914d\u3002==\u5982\u679c\u6709\u5339\u914d\u5bf9\u8c61match\u8fd4\u56de\uff0c\u53ef\u4ee5\u4f7f\u7528match.group()\u63d0\u53d6\u5339\u914d\u5b57\u7b26\u4e32==\u3002\r\n\r\n- re.match(pattern, string)\r\n- re.search(pattern, string)\r\n\r\n\r\n\r\n\r\n\r\n\u6211\u4eec\u6765\u770b\u4e2a\u5b9e\u9645\u6848\u4f8b\u3002\u4e0b\u4f8b\u4e2d\u6211\u4eec\u7f16\u5199\u4e86\u4e00\u4e2a\u5e74\u4efd\u7684\u6b63\u5219\u8868\u8fbe\u5f0f, \u8bd5\u56fe\u7528\u5b83\u4ece\"\u6211\u72311998\u548c1999\u5e74\"\u4e2d\u63d0\u53d6\u5e74\u4efd\u4fe1\u606f\u3002'\\d+{4}'\u4ee3\u8868\u4e00\u4e2a\u6b63\u6574\u6570\u91cd\u590d4\u6b21\uff0c\u5373\u56db\u4f4d\u6574\u6570\u3002\u4f60\u53ef\u4ee5\u770b\u5230re.match\u6ca1\u6709\u4efb\u4f55\u5339\u914d\uff0c\u800cre.search\u4e5f\u53ea\u662f\u5339\u914d\u52301998\u5e74\uff0c\u800c\u6ca1\u6709\u5339\u914d\u52301999\u5e74\u3002\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1fr==e.match\u662f\u4ece\u5934\u5339\u914d\u7684\uff0c\u4ece\u5934\u6ca1\u6709\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5c31\u8fd4\u56deNone==\u3002==re.search\u65b9\u6cd5\u867d\u7136\u53ef\u4ee5\u4ece\u5b57\u7b26\u4e32\u4efb\u4f55\u4f4d\u7f6e\u5f00\u59cb\u641c\u7d22\u5339\u914d\uff0c\u4f46\u4e00\u65e6\u627e\u5230\u7b2c\u4e00\u4e2a\u5339\u914d\u5bf9\u8c61\uff0c\u5176\u5c31\u505c\u6b62\u5de5\u4f5c\u4e86==\u3002\u5982\u679c\u60f3\u4ece\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u6240\u9700\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u6a21\u5f0f\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u4f60\u9700\u8981\u4f7f\u7528re.findall\u65b9\u6cd5\u3002\r\n\r\n```py\r\n>>> year_pattern = re.compile(r'\\d{4}$') # \u56db\u4f4d\u6574\u6570\uff0c\u5339\u914d\u5e74\u4efd\r\n>>> string1 = '\u6211\u72311998\u548c1999\u5e74'\r\n>>> match1 = re.match(year_pattern, string1)\r\n>>> print(match1)\r\nNone\r\n>>> match2 = re.search(year_pattern, string1)\r\n>>> print(match2)\r\n<_sre.SRE_Match object; span=(2, 6), match='1998'>\r\n>>> print(match2.group())\r\n1998\r\n```\r\n\r\n\r\n\r\nre.match\u548cre.search\u65b9\u6cd5\u867d\u7136\u4e00\u6b21\u6700\u591a\u53ea\u80fd\u8fd4\u56de\u4e00\u4e2a\u5339\u914d\u5bf9\u8c61\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5728pattern\u91cc\u52a0\u62ec\u53f7\u6784\u9020\u5339\u914d\u7ec4\u8fd4\u56de\u591a\u4e2a\u5b57\u7b26\u4e32\u3002\u4e0b\u4f8b\u5c55\u793a\u4e86\u6211\u4eec\u5982\u4f55\u4ece\"Elephants are bigger than rats\"\u91cc\u63d0\u53d6Elephants\u548cbigger\u4e24\u4e2a\u5355\u8bcd\u3002\u6ce8\u610f\u4e00\u4e2a\u62ec\u53f7\u5bf9\u4e8e\u4e00\u4e2agroup\uff0c\u800cmatch.group\u7684\u7f16\u53f7\u662f\u4ece1\u5f00\u59cb\u7684\uff0c\u800c\u4e0d\u662f\u50cf\u5217\u8868\u4e00\u6837\u4ece0\u5f00\u59cb\u3002\r\n\r\n```py\r\n>>> string3 = \"Elephants are bigger than rats\";\r\n>>> match3 = re.search( r'(.*) are (.*?) .*', string3, re.M|re.I)\r\n>>>  print(match3.group())\r\nElephants are bigger than rats\r\n>>>  print(match3.group(1))\r\nElephants\r\n>>> print(macth3.group(2))\r\nbigger\r\n```\r\n\r\n\r\n\r\n\u6709\u7684\u7b26\u53f7\u5982\", ', )\u672c\u8eab\u5c31\u6709\u7279\u6b8a\u7684\u542b\u4e49\uff0c\u6211\u4eec\u5728\u6b63\u5219\u8868\u8fbe\u4e2d\u4f7f\u7528\u65f6\u5fc5\u9700\u5148\u5bf9\u5b83\u4eec\u8fdb\u884c\u8f6c\u4e49\uff0c\u65b9\u6cd5\u5c31\u662f\u5728\u5176\u7b26\u53f7\u524d\u4ef6\u53cd\u659c\u6760\\\u3002\u4e0b\u4f8b\u5c55\u793a\u4e86\u6211\u4eec\u5982\u4f55\u4ece\u201c\u603b\u5171\u697c\u5c42(\u51717\u5c42)\"\u63d0\u53d6\u51717\u5c42\u4e09\u4e2a\u5b57\uff0c\u6211\u4eec\u9700\u8981\u7ed9\u62ec\u53f7\u8f6c\u4e49\u3002\u6211\u4eecpattern5\u548cpattern6\u4e2d\u90fd\u5bf9\u5916\u9762\u53cc\u62ec\u53f7\u90fd\u52a0\u4e86\u53cd\u659c\u6760\\\uff0c\u8868\u660e\u8fd9\u662f\u62ec\u53f7\u7b26\u53f7\u672c\u8eab\u3002\u5728pattern6\u4e2d\u6211\u4eec\u8fd8\u4f7f\u7528\u4e86\u4e00\u5bf9\u6ca1\u52a0\u53cd\u659c\u6760\u7684\u62ec\u53f7\uff0c\u8868\u660e\u8fd9\u662f\u4e00\u4e2amatch group\u3002\r\n\r\n```py\r\n>>> string4 = \"\u603b\u5171\u697c\u5c42(\u51717\u5c42)\"\r\n>>> pattern5 = re.compile(r'\\(.*\\)')\r\n>>> match5 = re.search(pattern5, string4)\r\n>>> print(match5.group())\r\n(\u51717\u5c42)\r\n>>> pattern6 = re.compile(r'\\((.*)\\)')\r\n>>> match6 = re.search(pattern6, string4)\r\n>>> print(match6.group())\r\n(\u51717\u5c42)\r\n>>> print(match6.group(1))\r\n\u51717\u5c42\r\n```\r\n\r\n\r\n\r\n\u90a3\u4f60\u80af\u4f1a\u95ee\u4e86\uff0c\u5982\u679c\u6211\u4eec\u6709\u201d\u603b\u5171\u697c\u5c42(\u51717\u5c42)\u5e72\u6270)\u697c\u5c42\"\u8fd9\u6837\u7684\u5b57\u7b26\u4e32\uff0c\u52a0\u4e86\u4e2a\u5e72\u6270\u95ee\u53f7\uff0c\u90a3\u6211\u4eec\u8be5\u5982\u4f55\u5339\u914d(\u51717\u5c42)\u5462\uff1fPython\u91cc\u6b63\u5219\u5339\u914d\u9ed8\u8ba4\u662f\u8d2a\u5a6a\u7684\uff0c\u603b\u662f\u5c1d\u8bd5\u5339\u914d\u5c3d\u53ef\u80fd\u591a\u7684\u5b57\u7b26\u3002\u975e\u8d2a\u5a6a\u7684\u5219\u76f8\u53cd\uff0c\u603b\u662f\u5c1d\u8bd5\u5339\u914d\u5c3d\u53ef\u80fd\u5c11\u7684\u5b57\u7b26\u3002\u5982\u679c\u8981\u4f7f\u7528\u975e\u8d2a\u5a6a\u6a21\u5f0f\uff0c\u6211\u4eec\u9700\u8981\u5728., *, ?\u53f7\u540e\u9762\u518d\u52a0\u4e2a\u95ee\u597d?\u5373\u53ef\u3002\r\n\r\n```py\r\n>>> string10 = \"\u603b\u5171\u697c\u5c42(\u51717\u5c42)\u5e72\u6270)\u95ee\u53f7\"\r\n>>> pattern10 = re.compile(r'\\(.*\\)') # \u9ed8\u8ba4\u8d2a\u5a6a\u6a21\u5f0f\r\n>>> pattern11 = re.compile(r'\\(.*?\\)') # \u52a0\u95ee\u53f7?\u53d8\u975e\u8d2a\u5a6a\u6a21\u5f0f\r\n>>> print(re.search(pattern10, string10).group())\r\n(\u51717\u5c42)\u5e72\u6270)\r\n>>> print(re.search(pattern11, string10).group())\r\n(\u51717\u5c42)\r\n```\r\n\r\n\r\n\r\n## re.findall\u65b9\u6cd5\r\n\r\n\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u63d0\u5230\u8fc7\uff0c\u5f53\u60a8\u8bd5\u56fe\u4ece\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u6240\u6709\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5b57\u7b26\u4e32\u5217\u8868\u65f6\u9700\u8981\u4f7f\u7528re.findall\u65b9\u6cd5\u3002findall\u65b9\u6cd5\u4f7f\u7528\u65b9\u6cd5\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u662fpattern.findall(string) \uff0c\u53e6\u4e00\u79cd\u662fre.findall(pattern, string)\u3002re.findall\u65b9\u6cd5\u7ecf\u5e38\u7528\u4e8e\u4ece\u722c\u866b\u722c\u6765\u7684\u6587\u672c\u4e2d\u63d0\u53d6\u6709\u7528\u4fe1\u606f\u3002**\r\n**\r\n\r\n\r\n\r\n\\# \u4f8b1: pattern.findall(string) - \u63d0\u53d6\u5e74\u4efd\u5217\u8868\r\n\r\n```py\r\n>>> year_pattern = re.compile(r'\\d{4}$') # \u56db\u4f4d\u6574\u6570\uff0c\u5339\u914d\u5e74\u4efd\r\n>>> string1 = '\u6211\u72311998\u548c1999\u5e74'\r\nyear_pattern.findall(string1)\r\n['1998', '1999']\r\n```\r\n\r\n\r\n\r\n\\# \u4f8b2: re.findall(pattern, string) - \u63d0\u53d6\u767e\u5ea6\u9996\u9875\u5e26\u6709\u94fe\u63a5\u7684\u5173\u952e\u8bcd\r\n\r\n```py\r\nimport requests\r\nresponse = requests.get('https://www.baidu.com')\r\nurls = re.findall(r'<a.*>(.*)</a>', response.text,) # \u83b7\u53d6\u5e26\u94fe\u63a5\u7684\u5173\u952e\u8bcd\r\nfor url in urls:\r\n    print(url)\r\n```\r\n\r\n\r\n\r\n\r\n\r\n## re.sub\u65b9\u6cd5\r\n\r\nre.sub\u7684\u4f7f\u7528\u65b9\u6cd5\u662fre.sub(pattern, new_string, current_string)\u3002\u4e0b\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u628a\u5e74\u4efd\u66ff\u6362\u4e3a****\u3002\u8be5\u65b9\u6cd5\u7ecf\u5e38\u7528\u4e8e\u53bb\u9664\u7a7a\u683c\uff0c\u65e0\u5173\u5b57\u7b26\u6216\u9690\u85cf\u654f\u611f\u5b57\u7b26\u3002\r\n\r\n```py\r\n>>> year_pattern = re.compile(r'\\d{4}$') # \u56db\u4f4d\u6574\u6570\uff0c\u5339\u914d\u5e74\u4efd\r\n>>> string1 = '\u6211\u72311998\u548c1999\u5e74'\r\n>>> replaced_str = re.sub(year_pattern, '****', string1)\r\n>>> print(replaced_str)\r\n\u6211\u7231****\u548c****\u5e74\r\n```\r\n\r\n\r\n\r\n## re.split\u65b9\u6cd5\r\n\r\nre.split\u7684\u4f7f\u7528\u65b9\u6cd5\u662fre.split(pattern, string)\uff0c\u8fd4\u56de\u5206\u5272\u540e\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002re.split\u65b9\u6cd5\u5e76\u4e0d\u5b8c\u7f8e\uff0c\u6bd4\u5982\u4e0b\u4f8b\u4e2d\u5206\u5272\u540e\u7684\u5b57\u7b26\u4e32\u5217\u8868\u9996\u5c3e\u90fd\u591a\u4e86\u7a7a\u683c\uff0c\u9700\u8981\u624b\u52a8\u53bb\u9664\u3002\r\n\r\n```py\r\n>>> string1 = \"1cat2dogs3cats4\"\r\n>>> import re\r\n>>> list1 = re.split(r'\\d+', string1)\r\n>>> print(list1)\r\n['', 'cat', 'dogs', 'cats', '']\r\n```", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/44--Python\u7684re\u6a21\u5757\u53ca\u6b63\u5219\u8868\u8fbe\u5f0fregex.md", "create_date": "2020-02-17T12:57:05.893", "order": 3}}, {"model": "subject.chapter", "pk": 7, "fields": {"title": "Python\u591a\u8fdb\u7a0b\u4e0e\u591a\u7ebf\u7a0b\u7f16\u7a0b", "topic": 1, "md5": "fc2a4e881f51f5e12d1965dc05c66b54", "md_body": "## \u5bfc\u8bfb\r\n>\u8fdb\u7a0b(process)\u548c\u7ebf\u7a0b(thread)\u662f\u975e\u5e38\u62bd\u8c61\u7684\u6982\u5ff5, \u4e5f\u662f\u7a0b\u5e8f\u5458\u5fc5\u9700\u638c\u63e1\u7684\u6838\u5fc3\u77e5\u8bc6\u3002\u591a\u8fdb\u7a0b\u548c\u591a\u7ebf\u7a0b\u7f16\u7a0b\u5bf9\u4e8e\u4ee3\u7801\u7684\u5e76\u53d1\u6267\u884c\uff0c\u63d0\u5347\u4ee3\u7801\u6548\u7387\u548c\u7f29\u77ed\u8fd0\u884c\u65f6\u95f4\u81f3\u5173\u91cd\u8981\u3002\r\n\r\n\r\n\r\n## \u4ec0\u4e48\u662f\u8fdb\u7a0b(process)\u548c\u7ebf\u7a0b(thread)\r\n\r\n\r\n\r\n- \u8fdb\u7a0b\u662f\u64cd\u4f5c\u7cfb\u7edf==\u5206\u914d\u8d44\u6e90==\u7684\u6700\u5c0f\u5355\u5143, \u7ebf\u7a0b\u662f==\u64cd\u4f5c\u7cfb\u7edf\u8c03\u5ea6==\u7684\u6700\u5c0f\u5355\u5143\u3002\r\n- \u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u81f3\u5c11\u5305\u62ec1\u4e2a\u8fdb\u7a0b\uff0c\u800c1\u4e2a\u8fdb\u7a0b\u5305\u62ec1\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u7684\u5c3a\u5ea6\u66f4\u5c0f\u3002\r\n- \u6bcf\u4e2a\u8fdb\u7a0b\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u62e5\u6709\u72ec\u7acb\u7684\u5185\u5b58\u5355\u5143\uff0c\u800c\u4e00\u4e2a\u7ebf\u7a0b\u7684\u591a\u4e2a\u7ebf\u7a0b\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u5171\u4eab\u5185\u5b58\u3002\r\n\r\n\r\n\r\n\u7f51\u4e0a\u6709\u7bc7\u962e\u4e00\u5cf0\u7684\u535a\u5ba2\u66fe\u5bf9\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u505a\u51fa\u4e86\u4e00\u4e2a\u975e\u5e38\u6d45\u663e\u7684\u89e3\u91ca\uff0c\u6211\u5728\u8fd9\u91cc\u8d34\u51fa\u6765\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\u3002\r\n\r\n-  \u8ba1\u7b97\u673a\u7684\u6838\u5fc3\u662fCPU\uff0c\u5b83\u627f\u62c5\u4e86\u6240\u6709\u7684\u8ba1\u7b97\u4efb\u52a1\u3002\u5b83\u5c31\u50cf\u4e00\u5ea7\u5de5\u5382\uff0c\u65f6\u523b\u5728\u8fd0\u884c\u3002\r\n- \u5047\u5b9a\u5de5\u5382\u7684\u7535\u529b\u6709\u9650\uff0c\u4e00\u6b21\u53ea\u80fd\u4f9b\u7ed9\u4e00\u4e2a\u8f66\u95f4\u4f7f\u7528\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u8f66\u95f4\u5f00\u5de5\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u8f66\u95f4\u90fd\u5fc5\u987b\u505c\u5de5\u3002\u80cc\u540e\u7684\u542b\u4e49\u5c31\u662f\uff0c\u5355\u4e2aCPU\u4e00\u6b21\u53ea\u80fd\u8fd0\u884c\u4e00\u4e2a\u4efb\u52a1\u3002\u7f16\u8005\u6ce8: \u591a\u6838\u7684CPU\u5c31\u50cf\u6709\u4e86\u591a\u4e2a\u53d1\u7535\u5382\uff0c\u4f7f\u591a\u5de5\u5382(\u591a\u8fdb\u7a0b)\u5b9e\u73b0\u53ef\u80fd\u3002\r\n- \u8fdb\u7a0b\u5c31\u597d\u6bd4\u5de5\u5382\u7684\u8f66\u95f4\uff0c\u5b83\u4ee3\u8868CPU\u6240\u80fd\u5904\u7406\u7684\u5355\u4e2a\u4efb\u52a1\u3002\u4efb\u4e00\u65f6\u523b\uff0cCPU\u603b\u662f\u8fd0\u884c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5176\u4ed6\u8fdb\u7a0b\u5904\u4e8e\u975e\u8fd0\u884c\u72b6\u6001\u3002\r\n- \u4e00\u4e2a\u8f66\u95f4\u91cc\uff0c\u53ef\u4ee5\u6709\u5f88\u591a\u5de5\u4eba\u3002\u4ed6\u4eec\u534f\u540c\u5b8c\u6210\u4e00\u4e2a\u4efb\u52a1\u3002\r\n- \u7ebf\u7a0b\u5c31\u597d\u6bd4\u8f66\u95f4\u91cc\u7684\u5de5\u4eba\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u5305\u62ec\u591a\u4e2a\u7ebf\u7a0b\u3002\r\n- \u8f66\u95f4\u7684\u7a7a\u95f4\u662f\u5de5\u4eba\u4eec\u5171\u4eab\u7684\uff0c\u6bd4\u5982\u8bb8\u591a\u623f\u95f4\u662f\u6bcf\u4e2a\u5de5\u4eba\u90fd\u53ef\u4ee5\u8fdb\u51fa\u7684\u3002\u8fd9\u8c61\u5f81\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u662f\u5171\u4eab\u7684\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u5171\u4eab\u5185\u5b58\u3002\r\n- \u53ef\u662f\uff0c\u6bcf\u95f4\u623f\u95f4\u7684\u5927\u5c0f\u4e0d\u540c\uff0c\u6709\u4e9b\u623f\u95f4\u6700\u591a\u53ea\u80fd\u5bb9\u7eb3\u4e00\u4e2a\u4eba\uff0c\u6bd4\u5982\u5395\u6240\u3002\u91cc\u9762\u6709\u4eba\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u4eba\u5c31\u4e0d\u80fd\u8fdb\u53bb\u4e86\u3002\u8fd9\u4ee3\u8868\u4e00\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u67d0\u4e9b\u5171\u4eab\u5185\u5b58\u65f6\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5fc5\u987b\u7b49\u5b83\u7ed3\u675f\uff0c\u624d\u80fd\u4f7f\u7528\u8fd9\u4e00\u5757\u5185\u5b58\u3002\r\n- \u4e00\u4e2a\u9632\u6b62\u4ed6\u4eba\u8fdb\u5165\u7684\u7b80\u5355\u65b9\u6cd5\uff0c\u5c31\u662f\u95e8\u53e3\u52a0\u4e00\u628a\u9501\u3002\u5148\u5230\u7684\u4eba\u9501\u4e0a\u95e8\uff0c\u540e\u5230\u7684\u4eba\u770b\u5230\u4e0a\u9501\uff0c\u5c31\u5728\u95e8\u53e3\u6392\u961f\uff0c\u7b49\u9501\u6253\u5f00\u518d\u8fdb\u53bb\u3002\u8fd9\u5c31\u53eb\"\u4e92\u65a5\u9501\"\uff08Mutual exclusion\uff0c\u7f29\u5199 Mutex\uff09\uff0c\u9632\u6b62\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u5199\u67d0\u4e00\u5757\u5185\u5b58\u533a\u57df\u3002\r\n- \u8fd8\u6709\u4e9b\u623f\u95f4\uff0c\u53ef\u4ee5\u540c\u65f6\u5bb9\u7eb3n\u4e2a\u4eba\uff0c\u6bd4\u5982\u53a8\u623f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4eba\u6570\u5927\u4e8en\uff0c\u591a\u51fa\u6765\u7684\u4eba\u53ea\u80fd\u5728\u5916\u9762\u7b49\u7740\u3002\u8fd9\u597d\u6bd4\u67d0\u4e9b\u5185\u5b58\u533a\u57df\uff0c\u53ea\u80fd\u4f9b\u7ed9\u56fa\u5b9a\u6570\u76ee\u7684\u7ebf\u7a0b\u4f7f\u7528\u3002\r\n- \u8fd9\u65f6\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u5c31\u662f\u5728\u95e8\u53e3\u6302n\u628a\u94a5\u5319\u3002\u8fdb\u53bb\u7684\u4eba\u5c31\u53d6\u4e00\u628a\u94a5\u5319\uff0c\u51fa\u6765\u65f6\u518d\u628a\u94a5\u5319\u6302\u56de\u539f\u5904\u3002\u540e\u5230\u7684\u4eba\u53d1\u73b0\u94a5\u5319\u67b6\u7a7a\u4e86\uff0c\u5c31\u77e5\u9053\u5fc5\u987b\u5728\u95e8\u53e3\u6392\u961f\u7b49\u7740\u4e86\u3002\u8fd9\u79cd\u505a\u6cd5\u53eb\u505a\"\u4fe1\u53f7\u91cf\"\uff08Semaphore\uff09\uff0c\u7528\u6765\u4fdd\u8bc1\u591a\u4e2a\u7ebf\u7a0b\u4e0d\u4f1a\u4e92\u76f8\u51b2\u7a81\u3002\r\n- \u4e0d\u96be\u770b\u51fa\uff0cmutex\u662fsemaphore\u7684\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff08n=1\u65f6\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b8c\u5168\u53ef\u4ee5\u7528\u540e\u8005\u66ff\u4ee3\u524d\u8005\u3002\u4f46\u662f\uff0c\u56e0\u4e3amutex\u8f83\u4e3a\u7b80\u5355\uff0c\u4e14\u6548\u7387\u9ad8\uff0c\u6240\u4ee5\u5728\u5fc5\u987b\u4fdd\u8bc1\u8d44\u6e90\u72ec\u5360\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd8\u662f\u91c7\u7528\u8fd9\u79cd\u8bbe\u8ba1\u3002\r\n\r\n\r\n\r\n\r\n\r\n\u539f\u6587\u5730\u5740\u89c1\r\n\r\n- http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html\r\n\r\n\r\n\r\n## Python\u7684\u591a\u8fdb\u7a0b\u7f16\u7a0b\u4e0emultiprocess\u6a21\u5757\r\n\r\npython\u7684\u591a\u8fdb\u7a0b\u7f16\u7a0b\u4e3b\u8981\u4f9d\u9760multiprocess\u6a21\u5757\u3002\u6211\u4eec\u5148\u5bf9\u6bd4\u4e24\u6bb5\u4ee3\u7801\uff0c\u770b\u770b\u591a\u8fdb\u7a0b\u7f16\u7a0b\u7684\u4f18\u52bf\u3002\u6211\u4eec\u6a21\u62df\u4e86\u4e00\u4e2a\u975e\u5e38\u8017\u65f6\u7684\u4efb\u52a1\uff0c\u8ba1\u7b978\u768420\u6b21\u65b9\uff0c\u4e3a\u4e86\u4f7f\u8fd9\u4e2a\u4efb\u52a1\u663e\u5f97\u66f4\u8017\u65f6\uff0c\u6211\u4eec\u8fd8\u8ba9\u5b83sleep 2\u79d2\u3002\u7b2c\u4e00\u6bb5\u4ee3\u7801\u662f\u5355\u8fdb\u7a0b\u8ba1\u7b97(\u4ee3\u7801\u5982\u4e0b\u6240\u793a)\uff0c\u6211\u4eec\u6309\u987a\u5e8f\u6267\u884c\u4ee3\u7801\uff0c\u91cd\u590d\u8ba1\u7b972\u6b21\uff0c\u5e76\u6253\u5370\u51fa\u603b\u5171\u8017\u65f6\u3002\r\n\r\n```py\r\nimport time\r\nimport os\r\n\r\ndef long_time_task():\r\n    print('\u5f53\u524d\u8fdb\u7a0b: {}'.format(os.getpid()))\r\n    time.sleep(2)\r\n    print(\"\u7ed3\u679c: {}\".format(8 ** 20))\r\n\r\nif __name__ == \"__main__\":\r\n    print('\u5f53\u524d\u6bcd\u8fdb\u7a0b: {}'.format(os.getpid()))\r\n    start = time.time()\r\n    for i in range(2):\r\n        long_time_task()\r\n\r\n    end = time.time()\r\n    print(\"\u7528\u65f6{}\u79d2\".format((end-start)))\r\n```\r\n\r\n\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u603b\u5171\u8017\u65f64\u79d2\uff0c\u81f3\u59cb\u81f3\u7ec8\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b14236\u3002\u770b\u6765\u7535\u8111\u8ba1\u7b978\u768420\u6b21\u65b9\u57fa\u672c\u4e0d\u8d39\u65f6\u3002\r\n\r\n```py\r\n\u5f53\u524d\u6bcd\u8fdb\u7a0b: 14236\r\n\u5f53\u524d\u8fdb\u7a0b: 14236\r\n\u7ed3\u679c: 1152921504606846976\r\n\u5f53\u524d\u8fdb\u7a0b: 14236\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7528\u65f64.01080060005188\u79d2\r\n```\r\n\r\n\r\n\r\n\u7b2c2\u6bb5\u4ee3\u7801\u662f\u591a\u8fdb\u7a0b\u8ba1\u7b97\u4ee3\u7801\u3002\u6211\u4eec\u5229\u7528multiprocess\u6a21\u5757\u7684Process\u65b9\u6cd5\u521b\u5efa\u4e86\u4e24\u4e2a\u65b0\u7684\u8fdb\u7a0bp1\u548cp2\u6765\u8fdb\u884c\u5e76\u884c\u8ba1\u7b97\u3002==Process\u65b9\u6cd5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570, \u7b2c\u4e00\u4e2a\u662ftarget\uff0c\u4e00\u822c\u6307\u5411\u51fd\u6570\u540d\uff0c\u7b2c\u4e8c\u4e2a\u65f6args\uff0c\u9700\u8981\u5411\u51fd\u6570\u4f20\u9012\u7684\u53c2\u6570==\u3002\u5bf9\u4e8e\u521b\u5efa\u7684\u65b0\u8fdb\u7a0b\uff0c\u8c03\u7528start()\u65b9\u6cd5\u5373\u53ef\u8ba9\u5176\u5f00\u59cb\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528==os.getpid==()\u6253\u5370\u51fa\u5f53\u524d\u8fdb\u7a0b\u7684\u540d\u5b57\u3002\r\n\r\n\r\n\r\n```py\r\nfrom multiprocessing import Process\r\nimport os\r\nimport time\r\n\r\n\r\ndef long_time_task(i):\r\n    print('\u5b50\u8fdb\u7a0b: {} - \u4efb\u52a1{}'.format(os.getpid(), i))\r\n    time.sleep(2)\r\n    print(\"\u7ed3\u679c: {}\".format(8 ** 20))\r\n\r\n\r\nif __name__=='__main__':\r\n    print('\u5f53\u524d\u6bcd\u8fdb\u7a0b: {}'.format(os.getpid()))\r\n    start = time.time()\r\n    p1 = Process(target=long_time_task, args=(1,))\r\n    p2 = Process(target=long_time_task, args=(2,))\r\n    print('\u7b49\u5f85\u6240\u6709\u5b50\u8fdb\u7a0b\u5b8c\u6210\u3002')\r\n    p1.start()\r\n    p2.start()\r\n    p1.join()\r\n    p2.join()\r\n    end = time.time()\r\n    print(\"\u603b\u5171\u7528\u65f6{}\u79d2\".format((end - start)))\r\n```\r\n\r\n\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff0c\u8017\u65f6\u53d8\u4e3a2\u79d2\uff0c\u65f6\u95f4\u51cf\u4e86\u4e00\u534a\uff0c\u53ef\u89c1\u5e76\u53d1\u6267\u884c\u7684\u65f6\u95f4\u660e\u663e\u6bd4\u987a\u5e8f\u6267\u884c\u8981\u5feb\u5f88\u591a\u3002\u4f60\u8fd8\u53ef\u4ee5\u770b\u5230\u5c3d\u7ba1\u6211\u4eec\u53ea\u521b\u5efa\u4e86\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u53ef\u5b9e\u9645\u8fd0\u884c\u4e2d\u5374\u5305\u542b\u91cc1\u4e2a\u6bcd\u8fdb\u7a0b\u548c2\u4e2a\u5b50\u8fdb\u7a0b\u3002\u4e4b\u6240\u4ee5\u6211\u4eec==\u4f7f\u7528join()\u65b9\u6cd5\u5c31\u662f\u4e3a\u4e86\u8ba9\u6bcd\u8fdb\u7a0b\u963b\u585e\uff0c\u7b49\u5f85\u5b50\u8fdb\u7a0b\u90fd\u5b8c\u6210\u540e\u624d\u6253\u5370\u51fa\u603b\u5171\u8017\u65f6==\uff0c\u5426\u5219\u8f93\u51fa\u65f6\u95f4\u53ea\u662f\u6bcd\u8fdb\u7a0b\u6267\u884c\u7684\u65f6\u95f4\u3002\r\n\r\n```py\r\n\u5f53\u524d\u6bcd\u8fdb\u7a0b: 6920\r\n\u7b49\u5f85\u6240\u6709\u5b50\u8fdb\u7a0b\u5b8c\u6210\u3002\r\n\u5b50\u8fdb\u7a0b: 17020 - \u4efb\u52a11\r\n\u5b50\u8fdb\u7a0b: 5904 - \u4efb\u52a12\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u679c: 1152921504606846976\r\n\u603b\u5171\u7528\u65f62.131091356277466\u79d2\r\n```\r\n\r\n\r\n\r\n\u77e5\u8bc6\u70b9:\r\n\r\n- \u65b0\u521b\u5efa\u7684\u8fdb\u7a0b\u4e0e\u8fdb\u7a0b\u7684\u5207\u6362\u90fd\u662f\u8981\u8017\u8d44\u6e90\u7684\uff0c\u6240\u4ee5\u5e73\u65f6\u5de5\u4f5c\u4e2d\u8fdb\u7a0b\u6570\u4e0d\u80fd\u5f00\u592a\u5927\u3002\r\n- \u540c\u65f6\u53ef\u4ee5\u8fd0\u884c\u7684\u8fdb\u7a0b\u6570\u4e00\u822c\u53d7\u5236\u4e8eCPU\u7684\u6838\u6570\u3002\r\n- \u9664\u4e86\u4f7f\u7528Process\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528Pool\u7c7b\u521b\u5efa\u591a\u8fdb\u7a0b\u3002\r\n\r\n\r\n\r\n## \u5229\u7528multiprocess\u6a21\u5757\u7684Pool\u7c7b\u521b\u5efa\u591a\u8fdb\u7a0b\r\n\r\n\r\n\r\n\u5f88\u591a\u65f6\u5019\u7cfb\u7edf\u90fd\u9700\u8981\u521b\u5efa\u591a\u4e2a\u8fdb\u7a0b\u4ee5\u63d0\u9ad8CPU\u7684\u5229\u7528\u7387\uff0c\u5f53\u6570\u91cf\u8f83\u5c11\u65f6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\u4e00\u4e2a\u4e2aProcess\u5b9e\u4f8b\u3002\u5f53\u8fdb\u7a0b\u6570\u91cf\u5f88\u591a\u65f6\uff0c\u6216\u8bb8\u53ef\u4ee5\u5229\u7528\u5faa\u73af\uff0c\u4f46\u662f\u8fd9\u9700\u8981\u7a0b\u5e8f\u5458\u624b\u52a8\u7ba1\u7406\u7cfb\u7edf\u4e2d\u5e76\u53d1\u8fdb\u7a0b\u7684\u6570\u91cf\uff0c\u6709\u65f6\u4f1a\u5f88\u9ebb\u70e6\u3002\u8fd9\u65f6\u8fdb\u7a0b\u6c60Pool\u5c31\u53ef\u4ee5\u53d1\u6325\u5176\u529f\u6548\u4e86\u3002\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012\u53c2\u6570\u9650\u5236\u5e76\u53d1\u8fdb\u7a0b\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3aCPU\u7684\u6838\u6570\u3002 \r\n\r\n\r\n\r\nPool\u7c7b\u53ef\u4ee5\u63d0\u4f9b\u6307\u5b9a\u6570\u91cf\u7684\u8fdb\u7a0b\u4f9b\u7528\u6237\u8c03\u7528\uff0c\u5f53\u6709\u65b0\u7684\u8bf7\u6c42\u63d0\u4ea4\u5230Pool\u4e2d\u65f6\uff0c\u5982\u679c\u8fdb\u7a0b\u6c60\u8fd8\u6ca1\u6709\u6ee1\uff0c\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\u6765\u6267\u884c\u8bf7\u6c42\u3002\u5982\u679c\u6c60\u6ee1\uff0c\u8bf7\u6c42\u5c31\u4f1a\u544a\u77e5\u5148\u7b49\u5f85\uff0c\u76f4\u5230\u6c60\u4e2d\u6709\u8fdb\u7a0b\u7ed3\u675f\uff0c\u624d\u4f1a\u521b\u5efa\u65b0\u7684\u8fdb\u7a0b\u6765\u6267\u884c\u8fd9\u4e9b\u8bf7\u6c42\u3002 \r\n\r\n\r\n\r\n\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0bmultiprocessing \u6a21\u5757\u4e0b\u7684Pool\u7c7b\u7684\u51e0\u4e2a\u65b9\u6cd5\uff1a\r\n\r\n1.==apply_async==\r\n\r\n\u51fd\u6570\u539f\u578b\uff1aapply_async(func[, args=()[, kwds={}[, callback=None]]])\r\n\r\n\u5176\u4f5c\u7528\u662f\u5411\u8fdb\u7a0b\u6c60\u63d0\u4ea4\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\u53ca\u53c2\u6570\uff0c \u5404\u4e2a\u8fdb\u7a0b\u91c7\u7528\u975e\u963b\u585e\uff08\u5f02\u6b65\uff09\u7684\u8c03\u7528\u65b9\u5f0f\uff0c\u5373\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u53ea\u7ba1\u8fd0\u884c\u81ea\u5df1\u7684\uff0c\u4e0d\u7ba1\u5176\u5b83\u8fdb\u7a0b\u662f\u5426\u5df2\u7ecf\u5b8c\u6210\u3002\r\n\r\n2.==map==()\r\n\r\n\u51fd\u6570\u539f\u578b\uff1amap(func, iterable[, chunksize=None])\r\n\r\nPool\u7c7b\u4e2d\u7684map\u65b9\u6cd5\uff0c\u4e0e\u5185\u7f6e\u7684map\u51fd\u6570\u7528\u6cd5\u884c\u4e3a\u57fa\u672c\u4e00\u81f4\uff0c\u5b83\u4f1a\u4f7f\u8fdb\u7a0b\u963b\u585e\u76f4\u5230\u7ed3\u679c\u8fd4\u56de\u3002 \u6ce8\u610f\uff1a\u867d\u7136\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u4f46\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u5fc5\u987b\u5728\u6574\u4e2a\u961f\u5217\u90fd\u5c31\u7eea\u540e\uff0c\u7a0b\u5e8f\u624d\u4f1a\u8fd0\u884c\u5b50\u8fdb\u7a0b\u3002\r\n\r\n3.==map_async==()\r\n\r\n\u51fd\u6570\u539f\u578b\uff1amap_async(func, iterable[, chunksize[, callback]])\r\n\u4e0emap\u7528\u6cd5\u4e00\u81f4\uff0c\u4f46\u662f\u5b83\u662f\u975e\u963b\u585e\u7684\u3002\u5176\u6709\u5173\u4e8b\u9879\u89c1apply_async\u3002\r\n\r\n4.==close==()\r\n\r\n\u5173\u95ed\u8fdb\u7a0b\u6c60\uff08pool\uff09\uff0c\u4f7f\u5176\u4e0d\u5728\u63a5\u53d7\u65b0\u7684\u4efb\u52a1\u3002\r\n\r\n5. ==terminate==()\r\n\r\n\u7ed3\u675f\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u4e0d\u5728\u5904\u7406\u672a\u5904\u7406\u7684\u4efb\u52a1\u3002\r\n\r\n6.==join==()\r\n\r\n\u4e3b\u8fdb\u7a0b\u963b\u585e\u7b49\u5f85\u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\uff0c join\u65b9\u6cd5\u8981\u5728close\u6216terminate\u4e4b\u540e\u4f7f\u7528\u3002\r\n\r\n\r\n\r\n\u4e0b\u4f8b\u662f\u4e00\u4e2a\u7b80\u5355\u7684multiprocessing.Pool\u7c7b\u7684\u5b9e\u4f8b\u3002\u56e0\u4e3a\u5c0f\u7f16\u6211\u7684CPU\u662f4\u6838\u7684\uff0c\u4e00\u6b21\u6700\u591a\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c4\u4e2a\u8fdb\u7a0b\uff0c\u6240\u4ee5\u6211\u5f00\u542f\u4e86\u4e00\u4e2a\u5bb9\u91cf\u4e3a4\u7684\u8fdb\u7a0b\u6c60\u30024\u4e2a\u8fdb\u7a0b\u9700\u8981\u8ba1\u7b975\u6b21\uff0c\u4f60\u53ef\u4ee5\u60f3\u8c614\u4e2a\u8fdb\u7a0b\u5e76\u884c4\u6b21\u8ba1\u7b97\u4efb\u52a1\u540e\uff0c\u8fd8\u5269\u4e00\u6b21\u8ba1\u7b97\u4efb\u52a1(\u4efb\u52a14)\u6ca1\u6709\u5b8c\u6210\uff0c\u7cfb\u7edf\u4f1a\u7b49\u5f854\u4e2a\u8fdb\u7a0b\u5b8c\u6210\u540e\u91cd\u65b0\u5b89\u6392\u4e00\u4e2a\u8fdb\u7a0b\u6765\u8ba1\u7b97\u3002\r\n\r\n\r\n\r\n```py\r\nfrom multiprocessing import Pool, cpu_count\r\nimport os\r\nimport time\r\n\r\n\r\ndef long_time_task(i):\r\n    print('\u5b50\u8fdb\u7a0b: {} - \u4efb\u52a1{}'.format(os.getpid(), i))\r\n    time.sleep(2)\r\n    print(\"\u7ed3\u679c: {}\".format(8 ** 20))\r\n\r\n\r\nif __name__=='__main__':\r\n    print(\"CPU\u5185\u6838\u6570:{}\".format(cpu_count()))\r\n    print('\u5f53\u524d\u6bcd\u8fdb\u7a0b: {}'.format(os.getpid()))\r\n    start = time.time()\r\n    p = Pool(4)\r\n    for i in range(5):\r\n        p.apply_async(long_time_task, args=(i,))\r\n    print('\u7b49\u5f85\u6240\u6709\u5b50\u8fdb\u7a0b\u5b8c\u6210\u3002')\r\n    p.close()\r\n    p.join()\r\n    end = time.time()\r\n    print(\"\u603b\u5171\u7528\u65f6{}\u79d2\".format((end - start)))\r\n```\r\n\r\n\u77e5\u8bc6\u70b9: \r\n\r\n- \u5bf9Pool\u5bf9\u8c61\u8c03\u7528join()\u65b9\u6cd5\u4f1a\u7b49\u5f85\u6240\u6709\u5b50\u8fdb\u7a0b\u6267\u884c\u5b8c\u6bd5\uff0c\u8c03\u7528join()\u4e4b\u524d\u5fc5\u987b\u5148\u8c03\u7528close()\u6216terminate()\u65b9\u6cd5\uff0c\u8ba9\u5176\u4e0d\u518d\u63a5\u53d7\u65b0\u7684Process\u4e86\u3002\r\n\r\n\r\n\r\n\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\u6240\u793a\uff0c5\u4e2a\u4efb\u52a1\uff08\u6bcf\u4e2a\u4efb\u52a1\u5927\u7ea6\u8017\u65f62\u79d2)\u4f7f\u7528\u591a\u8fdb\u7a0b\u5e76\u884c\u8ba1\u7b97\u53ea\u97004.37\u79d2,, \u8017\u65f6\u51cf\u5c11\u4e8660%\u3002\r\n\r\n```py\r\nCPU\u5185\u6838\u6570:4\r\n\u5f53\u524d\u6bcd\u8fdb\u7a0b: 2556\r\n\u7b49\u5f85\u6240\u6709\u5b50\u8fdb\u7a0b\u5b8c\u6210\u3002\r\n\u5b50\u8fdb\u7a0b: 16480 - \u4efb\u52a10\r\n\u5b50\u8fdb\u7a0b: 15216 - \u4efb\u52a11\r\n\u5b50\u8fdb\u7a0b: 15764 - \u4efb\u52a12\r\n\u5b50\u8fdb\u7a0b: 10176 - \u4efb\u52a13\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u679c: 1152921504606846976\r\n\u5b50\u8fdb\u7a0b: 15216 - \u4efb\u52a14\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u679c: 1152921504606846976\r\n\u603b\u5171\u7528\u65f64.377134561538696\u79d2\r\n```\r\n\r\n\r\n\r\n\u76f8\u4fe1\u5927\u5bb6\u90fd\u77e5\u9053python\u89e3\u91ca\u5668\u4e2d\u5b58\u5728GIL(\u5168\u5c40\u89e3\u91ca\u5668\u9501), \u5b83\u7684\u4f5c\u7528\u5c31\u662f\u4fdd\u8bc1\u540c\u4e00\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u3002==\u7531\u4e8eGIL\u7684\u5b58\u5728\uff0c\u5f88\u591a\u4eba\u8ba4\u4e3apython\u4e2d\u7684\u591a\u7ebf\u7a0b\u5176\u5b9e\u5e76\u4e0d\u662f\u771f\u6b63\u7684\u591a\u7ebf\u7a0b\uff0c\u5982\u679c\u60f3\u8981\u5145\u5206\u5730\u4f7f\u7528\u591a\u6838CPU\u7684\u8d44\u6e90\uff0c\u5728python\u4e2d\u5927\u90e8\u5206\u60c5\u51b5\u9700\u8981\u4f7f\u7528\u591a\u8fdb\u7a0b==\u3002\u7136\u800c\u8fd9\u5e76\u610f\u5473\u7740python\u591a\u7ebf\u7a0b\u7f16\u7a0b\u6ca1\u6709\u610f\u4e49\u54e6\uff0c\u8bf7\u7ee7\u7eed\u9605\u8bfb\u4e0b\u6587\u3002\r\n\r\n\r\n\r\n## \u591a\u8fdb\u7a0b\u95f4\u7684\u6570\u636e\u5171\u4eab\u4e0e\u901a\u4fe1\r\n\r\n\r\n\r\n\u901a\u5e38\uff0c\u8fdb\u7a0b\u4e4b\u95f4\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u72ec\u7acb\u7684\u5185\u5b58\u3002\u901a\u8fc7\u5171\u4eab\u5185\u5b58(nmap\u6a21\u5757)\uff0c\u8fdb\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u5171\u4eab\u5bf9\u8c61\uff0c\u4f7f\u591a\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u540c\u4e00\u4e2a\u53d8\u91cf(\u5730\u5740\u76f8\u540c\uff0c\u53d8\u91cf\u540d\u53ef\u80fd\u4e0d\u540c)\u3002\u591a\u8fdb\u7a0b\u5171\u4eab\u8d44\u6e90\u5fc5\u7136\u4f1a\u5bfc\u81f4\u8fdb\u7a0b\u95f4\u76f8\u4e92\u7ade\u4e89\uff0c\u6240\u4ee5\u5e94\u8be5\u5c3d\u6700\u5927\u53ef\u80fd\u9632\u6b62\u4f7f\u7528\u5171\u4eab\u72b6\u6001\u3002\u8fd8\u6709\u4e00\u79cd\u65b9\u5f0f\u5c31\u662f\u4f7f\u7528\u961f\u5217queue\u6765\u5b9e\u73b0\u4e0d\u540c\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u6216\u6570\u636e\u5171\u4eab\uff0c\u8fd9\u4e00\u70b9\u548c\u591a\u7ebf\u7a0b\u7f16\u7a0b\u7c7b\u4f3c\u3002\r\n\r\n\r\n\r\n\u4e0b\u4f8b\u8fd9\u6bb5\u4ee3\u7801\u4e2d\u4e2d\u521b\u5efa\u4e862\u4e2a\u72ec\u7acb\u8fdb\u7a0b\uff0c\u4e00\u4e2a\u8d1f\u8d23\u5199(pw), \u4e00\u4e2a\u8d1f\u8d23\u8bfb(pr), \u5b9e\u73b0\u4e86\u5171\u4eab\u4e00\u4e2a\u961f\u5217queue\u3002\r\n\r\n```py\r\nfrom multiprocessing import Process, Queue\r\nimport os, time, random\r\n\r\n# \u5199\u6570\u636e\u8fdb\u7a0b\u6267\u884c\u7684\u4ee3\u7801:\r\ndef write(q):\r\n    print('Process to write: {}'.format(os.getpid()))\r\n    for value in ['A', 'B', 'C']:\r\n        print('Put %s to queue...' % value)\r\n        q.put(value)\r\n        time.sleep(random.random())\r\n\r\n# \u8bfb\u6570\u636e\u8fdb\u7a0b\u6267\u884c\u7684\u4ee3\u7801:\r\ndef read(q):\r\n    print('Process to read:{}'.format(os.getpid()))\r\n    while True:\r\n        value = q.get(True)\r\n        print('Get %s from queue.' % value)\r\n\r\nif __name__=='__main__':\r\n    # \u7236\u8fdb\u7a0b\u521b\u5efaQueue\uff0c\u5e76\u4f20\u7ed9\u5404\u4e2a\u5b50\u8fdb\u7a0b\uff1a\r\n   q = Queue()\r\n    pw = Process(target=write, args=(q,))\r\n    pr = Process(target=read, args=(q,))\r\n    # \u542f\u52a8\u5b50\u8fdb\u7a0bpw\uff0c\u5199\u5165:\r\n    pw.start()\r\n    # \u542f\u52a8\u5b50\u8fdb\u7a0bpr\uff0c\u8bfb\u53d6:\r\n    pr.start()\r\n    # \u7b49\u5f85pw\u7ed3\u675f:\r\n    pw.join()\r\n    # pr\u8fdb\u7a0b\u91cc\u662f\u6b7b\u5faa\u73af\uff0c\u65e0\u6cd5\u7b49\u5f85\u5176\u7ed3\u675f\uff0c\u53ea\u80fd\u5f3a\u884c\u7ec8\u6b62:\r\n    pr.terminate()\r\n```\r\n\r\n\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\u6240\u793a:\r\n\r\n```py\r\nProcess to write: 3036\r\nPut A to queue...\r\nProcess to read:9408\r\nGet A from queue.\r\nPut B to queue...\r\nGet B from queue.\r\nPut C to queue...\r\nGet C from queue.\r\n\r\n```\r\n\r\n\r\n\r\n## Python\u7684\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e0ethreading\u6a21\u5757\r\n\r\n\r\n\r\npython 3\u4e2d\u7684\u591a\u8fdb\u7a0b\u7f16\u7a0b\u4e3b\u8981\u4f9d\u9760threading\u6a21\u5757\u3002\u521b\u5efa\u65b0\u7ebf\u7a0b\u4e0e\u521b\u5efa\u65b0\u8fdb\u7a0b\u7684\u65b9\u6cd5\u975e\u5e38\u7c7b\u4f3c\u3002t==hreading.Thread\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570, \u7b2c\u4e00\u4e2a\u662ftarget\uff0c\u4e00\u822c\u6307\u5411\u51fd\u6570\u540d\uff0c\u7b2c\u4e8c\u4e2a\u65f6args\uff0c\u9700\u8981\u5411\u51fd\u6570\u4f20\u9012\u7684\u53c2\u6570==\u3002\u5bf9\u4e8e\u521b\u5efa\u7684\u65b0\u7ebf\u7a0b\uff0c\u8c03\u7528start()\u65b9\u6cd5\u5373\u53ef\u8ba9\u5176\u5f00\u59cb\u3002\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528==current_thread().name==\u6253\u5370\u51fa\u5f53\u524d\u7ebf\u7a0b\u7684\u540d\u5b57\u3002 \u4e0b\u4f8b\u4e2d\u6211\u4eec\u4f7f\u7528\u591a\u7ebf\u7a0b\u6280\u672f\u91cd\u6784\u4e4b\u524d\u7684\u8ba1\u7b97\u4ee3\u7801\u3002\r\n\r\n```py\r\nimport threading\r\nimport time\r\n\r\n\r\ndef long_time_task(i):\r\n    print('\u5f53\u524d\u5b50\u7ebf\u7a0b: {} - \u4efb\u52a1{}'.format(threading.current_thread().name, i))\r\n    time.sleep(2)\r\n    print(\"\u7ed3\u679c: {}\".format(8 ** 20))\r\n\r\n\r\nif __name__=='__main__':\r\n    start = time.time()\r\n    print('\u8fd9\u662f\u4e3b\u7ebf\u7a0b\uff1a{}'.format(threading.current_thread().name))\r\n    t1 = threading.Thread(target=long_time_task, args=(1,))\r\n    t2 = threading.Thread(target=long_time_task, args=(2,))\r\n    t1.start()\r\n    t2.start()\r\n\r\n    end = time.time()\r\n    print(\"\u603b\u5171\u7528\u65f6{}\u79d2\".format((end - start)))\r\n```\r\n\r\n\r\n\r\n\u4e0b\u9762\u662f\u8f93\u51fa\u7ed3\u679c\u3002\u4e3a\u4ec0\u4e48\u603b\u8017\u65f6\u5c45\u7136\u662f0\u79d2? ==\u6211\u4eec\u53ef\u4ee5\u660e\u663e\u770b\u5230\u4e3b\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u5176\u5b9e\u662f\u72ec\u7acb\u8fd0\u884c\u7684\uff0c\u4e3b\u7ebf\u7a0b\u6839\u672c\u6ca1\u6709\u7b49\u5b50\u7ebf\u7a0b\u5b8c\u6210\uff0c\u800c\u662f\u81ea\u5df1\u7ed3\u675f\u540e\u5c31\u6253\u5370\u4e86\u6d88\u8017\u65f6\u95f4==\u3002\u4e3b\u7ebf\u7a0b\u7ed3\u675f\u540e\uff0c\u5b50\u7ebf\u7a0b\u4ecd\u5728\u72ec\u7acb\u8fd0\u884c\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002\r\n\r\n```py\r\n\u8fd9\u662f\u4e3b\u7ebf\u7a0b\uff1aMainThread\r\n\u5f53\u524d\u5b50\u7ebf\u7a0b: Thread-1 - \u4efb\u52a11\r\n\u5f53\u524d\u5b50\u7ebf\u7a0b: Thread-2 - \u4efb\u52a12\r\n\u603b\u5171\u7528\u65f60.0017192363739013672\u79d2\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u679c: 1152921504606846976\r\n```\r\n\r\n\r\n\r\n==\u5982\u679c\u8981\u5b9e\u73b0\u4e3b\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u7684\u540c\u6b65\uff0c\u6211\u4eec\u5fc5\u9700\u4f7f\u7528join\u65b9\u6cd5==\uff08\u4ee3\u7801\u5982\u4e0b\u6240\u793a)\u3002\r\n\r\n```py\r\nimport threading\r\nimport time\r\n\r\n\r\ndef long_time_task(i):\r\n    print('\u5f53\u524d\u5b50\u7ebf\u7a0b: {} \u4efb\u52a1{}'.format(threading.current_thread().name, i))\r\n    time.sleep(2)\r\n    print(\"\u7ed3\u679c: {}\".format(8 ** 20))\r\n\r\n\r\nif __name__=='__main__':\r\n    start = time.time()\r\n    print('\u8fd9\u662f\u4e3b\u7ebf\u7a0b\uff1a{}'.format(threading.current_thread().name))\r\n    thread_list = []\r\n    for i in range(1, 3):\r\n        t = threading.Thread(target=long_time_task, args=(i, ))\r\n        thread_list.append(t)\r\n\r\n    for t in thread_list:\r\n        t.start()\r\n\r\n    for t in thread_list:\r\n        t.join()\r\n\r\n    end = time.time()\r\n    print(\"\u603b\u5171\u7528\u65f6{}\u79d2\".format((end - start)))\r\n```\r\n\r\n\u4fee\u6539\u4ee3\u7801\u540e\u7684\u8f93\u51fa\u5982\u4e0b\u6240\u793a\u3002\u8fd9\u65f6\u4f60\u53ef\u4ee5\u770b\u5230\u4e3b\u7ebf\u7a0b\u5728\u7b49\u5b50\u7ebf\u7a0b\u5b8c\u6210\u540e\u624d\u7b54\u5e94\u51fa\u603b\u6d88\u8017\u65f6\u95f4(2\u79d2)\uff0c\u6bd4\u6b63\u5e38\u987a\u5e8f\u6267\u884c\u4ee3\u7801(4\u79d2)\u8fd8\u662f\u8282\u7701\u4e86\u4e0d\u5c11\u65f6\u95f4\u3002\r\n\r\n```py\r\n\u8fd9\u662f\u4e3b\u7ebf\u7a0b\uff1aMainThread\r\n\u5f53\u524d\u5b50\u7ebf\u7a0b: Thread - 1 \u4efb\u52a11\r\n\u5f53\u524d\u5b50\u7ebf\u7a0b: Thread - 2 \u4efb\u52a12\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u679c: 1152921504606846976\r\n\u603b\u5171\u7528\u65f62.0166890621185303\u79d2\r\n```\r\n\r\n\r\n\r\n\u5f53\u6211\u4eec\u8bbe\u7f6e\u591a\u7ebf\u7a0b\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u521b\u5efa\u591a\u4e2a\u5b50\u7ebf\u7a0b\uff0c==\u5728python\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3b\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u72ec\u7acb\u8fd0\u884c\u4e92\u4e0d\u5e72\u6d89\u3002\u5982\u679c\u5e0c\u671b\u8ba9\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u5b50\u7ebf\u7a0b\u5b9e\u73b0\u7ebf\u7a0b\u7684\u540c\u6b65\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528join()\u65b9\u6cd5\u3002\u5982\u679c\u6211\u4eec\u5e0c\u671b\u4e00\u4e2a\u4e3b\u7ebf\u7a0b\u7ed3\u675f\u65f6\u4e0d\u518d\u6267\u884c\u5b50\u7ebf\u7a0b\uff0c\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u529e\u5462? \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528t.setDaemon(True)==\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\u3002\r\n\r\n```py\r\nimport threading\r\nimport time\r\n\r\n\r\ndef long_time_task():\r\n    print('\u5f53\u5b50\u7ebf\u7a0b: {}'.format(threading.current_thread().name))\r\n    time.sleep(2)\r\n    print(\"\u7ed3\u679c: {}\".format(8 ** 20))\r\n\r\n\r\nif __name__=='__main__':\r\n    start = time.time()\r\n    print('\u8fd9\u662f\u4e3b\u7ebf\u7a0b\uff1a{}'.format(threading.current_thread().name))\r\n    for i in range(5):\r\n        t = threading.Thread(target=long_time_task, args=())\r\n        t.setDaemon(True)\r\n        t.start()\r\n\r\n    end = time.time()\r\n    print(\"\u603b\u5171\u7528\u65f6{}\u79d2\".format((end - start)))\r\n```\r\n\r\n\r\n\r\n## \u901a\u8fc7\u7ee7\u627fThread\u7c7b\u91cd\u5199run\u65b9\u6cd5\u521b\u5efa\u65b0\u8fdb\u7a0b\r\n\r\n\r\n\r\n\u9664\u4e86\u4f7f\u7528Thread()\u65b9\u6cd5\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627fThread\u7c7b\u91cd\u5199run\u65b9\u6cd5\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\uff0c\u8fd9\u79cd\u65b9\u6cd5\u66f4\u7075\u6d3b\u3002\u4e0b\u4f8b\u4e2d\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u7c7b\u4e3aMyThread, \u968f\u540e\u6211\u4eec\u901a\u8fc7\u8be5\u7c7b\u7684\u5b9e\u4f8b\u5316\u521b\u5efa\u4e862\u4e2a\u5b50\u7ebf\u7a0b\u3002\r\n\r\n```py\r\n#-*- encoding:utf-8 -*-\r\nimport threading\r\nimport time\r\n\r\n\r\ndef long_time_task(i):\r\n    time.sleep(2)\r\n    return 8**20\r\n\r\n\r\nclass MyThread(threading.Thread):\r\n    def __init__(self, func, args , name='', ):\r\n        threading.Thread.__init__(self)\r\n        self.func = func\r\n        self.args = args\r\n        self.name = name\r\n        self.result = None\r\n\r\n    def run(self):\r\n        print('\u5f00\u59cb\u5b50\u8fdb\u7a0b{}'.format(self.name))\r\n        self.result = self.func(self.args[0],)\r\n        print(\"\u7ed3\u679c: {}\".format(self.result))\r\n        print('\u7ed3\u675f\u5b50\u8fdb\u7a0b{}'.format(self.name))\r\n\r\n\r\nif __name__=='__main__':\r\n    start = time.time()\r\n    threads = []\r\n    for i in range(1, 3):\r\n        t = MyThread(long_time_task, (i,), str(i))\r\n        threads.append(t)\r\n\r\n    for t in threads:\r\n        t.start()\r\n    for t in threads:\r\n        t.join()\r\n\r\n    end = time.time()\r\n    print(\"\u603b\u5171\u7528\u65f6{}\u79d2\".format((end - start)))\r\n```\r\n\r\n\r\n\r\n\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\u6240\u793a:\r\n\r\n```py\r\n\u5f00\u59cb\u5b50\u8fdb\u7a0b1\r\n\u5f00\u59cb\u5b50\u8fdb\u7a0b2\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u679c: 1152921504606846976\r\n\u7ed3\u675f\u5b50\u8fdb\u7a0b1\r\n\u7ed3\u675f\u5b50\u8fdb\u7a0b2\r\n\u603b\u5171\u7528\u65f62.005445718765259\u79d2\r\n```\r\n\r\n\r\n\r\n## \u4e0d\u540c\u7ebf\u7a0b\u95f4\u7684\u6570\u636e\u5171\u4eab\r\n\r\n\r\n\r\n==\u4e00\u4e2a\u8fdb\u7a0b\u6240\u542b\u7684\u4e0d\u540c\u7ebf\u7a0b\u95f4\u5171\u4eab\u5185\u5b58\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u4efb\u4f55\u4e00\u4e2a\u53d8\u91cf\u90fd\u53ef\u4ee5\u88ab\u4efb\u4f55\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539==\uff0c\u56e0\u6b64\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u6570\u636e\u6700\u5927\u7684\u5371\u9669\u5728\u4e8e\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6539\u4e00\u4e2a\u53d8\u91cf\uff0c\u628a\u5185\u5bb9\u7ed9\u6539\u4e71\u4e86\u3002\u5982\u679c\u4e0d\u540c\u7ebf\u7a0b\u95f4\u6709\u5171\u4eab\u7684\u53d8\u91cf\uff0c\u5176\u4e2d\u4e00\u4e2a\u65b9\u6cd5\u5c31\u662f\u5728\u4fee\u6539\u524d\u7ed9\u5176\u4e0a\u4e00\u628a\u9501lock\uff0c\u786e\u4fdd\u4e00\u6b21\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u4fee\u6539\u5b83\u3002threading.lock()\u65b9\u6cd5\u53ef\u4ee5\u8f7b\u6613\u5b9e\u73b0\u5bf9\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\u7684\u9501\u5b9a\uff0c\u4fee\u6539\u5b8c\u540erelease\u4f9b\u5176\u5b83\u7ebf\u7a0b\u4f7f\u7528\u3002\u6bd4\u5982\u4e0b\u4f8b\u4e2d\u8d26\u6237\u4f59\u989dbalance\u662f\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\uff0c\u4f7f\u7528lock\u53ef\u4ee5\u4f7f\u5176\u4e0d\u88ab\u6539\u4e71\u3002\r\n\r\n```py\r\n# -*- coding: utf-8 -*\r\n\r\nimport threading\r\n\r\n\r\nclass Account:\r\n    def __init__(self):\r\n        self.balance = 0\r\n\r\n    def add(self, lock):\r\n        # \u83b7\u5f97\u9501\r\n        lock.acquire()\r\n        for i in range(0, 100000):\r\n            self.balance += 1\r\n        # \u91ca\u653e\u9501\r\n        lock.release()\r\n\r\n    def delete(self, lock):\r\n        # \u83b7\u5f97\u9501\r\n        lock.acquire()\r\n        for i in range(0, 100000):\r\n            self.balance -= 1\r\n            # \u91ca\u653e\u9501\r\n        lock.release()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    account = Account()\r\n    lock = threading.Lock()\r\n    # \u521b\u5efa\u7ebf\u7a0b\r\n   thread_add = threading.Thread(target=account.add, args=(lock,), name='Add')\r\n    thread_delete = threading.Thread(target=account.delete, args=(lock,), name='Delete')\r\n\r\n    # \u542f\u52a8\u7ebf\u7a0b\r\n   thread_add.start()\r\n    thread_delete.start()\r\n\r\n    # \u7b49\u5f85\u7ebf\u7a0b\u7ed3\u675f\r\n   thread_add.join()\r\n    thread_delete.join()\r\n\r\n    print('The final balance is: {}'.format(account.balance))\r\n```\r\n\r\n\u53e6\u4e00\u79cd\u5b9e\u73b0\u4e0d\u540c\u7ebf\u7a0b\u95f4\u6570\u636e\u5171\u4eab\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528\u6d88\u606f\u961f\u5217queue\u3002\u4e0d\u50cf\u5217\u8868\uff0cqueue\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u653e\u5fc3\u4f7f\u7528\uff0c\u89c1\u4e0b\u6587\u3002\r\n\r\n\r\n\r\n## \u4f7f\u7528queue\u961f\u5217\u901a\u4fe1-\u7ecf\u5178\u7684\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u6a21\u578b\r\n\r\n\u4e0b\u4f8b\u4e2d\u521b\u5efa\u4e86\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u8d1f\u8d23\u751f\u6210\uff0c\u4e00\u4e2a\u8d1f\u8d23\u6d88\u8d39\uff0c\u6240\u751f\u6210\u7684\u4ea7\u54c1\u5b58\u653e\u5728queue\u91cc\uff0c\u5b9e\u73b0\u4e86\u4e0d\u540c\u7ebf\u7a0b\u95f4\u6c9f\u901a\u3002\r\n\r\n```py\r\nfrom queue import Queue\r\nimport random, threading, time\r\n\r\n\r\n# \u751f\u4ea7\u8005\u7c7b\r\nclass Producer(threading.Thread):\r\n    def __init__(self, name, queue):\r\n        threading.Thread.__init__(self, name=name)\r\n        self.queue = queue\r\n\r\n    def run(self):\r\n        for i in range(1, 5):\r\n            print(\"{} is producing {} to the queue!\".format(self.getName(), i))\r\n            self.queue.put(i)\r\n            time.sleep(random.randrange(10) / 5)\r\n        print(\"%s finished!\" % self.getName())\r\n\r\n\r\n# \u6d88\u8d39\u8005\u7c7b\r\nclass Consumer(threading.Thread):\r\n    def __init__(self, name, queue):\r\n        threading.Thread.__init__(self, name=name)\r\n        self.queue = queue\r\n\r\n    def run(self):\r\n        for i in range(1, 5):\r\n            val = self.queue.get()\r\n            print(\"{} is consuming {} in the queue.\".format(self.getName(), val))\r\n            time.sleep(random.randrange(10))\r\n        print(\"%s finished!\" % self.getName())\r\n\r\n\r\ndef main():\r\n    queue = Queue()\r\n    producer = Producer('Producer', queue)\r\n    consumer = Consumer('Consumer', queue)\r\n\r\n    producer.start()\r\n    consumer.start()\r\n\r\n    producer.join()\r\n    consumer.join()\r\n    print('All threads finished!')\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\n\r\n\r\n\u961f\u5217queue\u7684put\u65b9\u6cd5\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5bf9\u8c61obj\u653e\u5165\u961f\u5217\u4e2d\u3002\u5982\u679c\u961f\u5217\u5df2\u6ee1\uff0c\u6b64\u65b9\u6cd5\u5c06\u963b\u585e\u81f3\u961f\u5217\u6709\u7a7a\u95f4\u53ef\u7528\u4e3a\u6b62\u3002queue\u7684get\u65b9\u6cd5\u4e00\u6b21\u8fd4\u56de\u961f\u5217\u4e2d\u7684\u4e00\u4e2a\u6210\u5458\u3002\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c\u6b64\u65b9\u6cd5\u5c06\u963b\u585e\u81f3\u961f\u5217\u4e2d\u6709\u6210\u5458\u53ef\u7528\u4e3a\u6b62\u3002queue\u540c\u65f6\u8fd8\u81ea\u5e26emtpy(), full()\u7b49\u65b9\u6cd5\u6765\u5224\u65ad\u4e00\u4e2a\u961f\u5217\u662f\u5426\u4e3a\u7a7a\u6216\u5df2\u6ee1\uff0c\u4f46\u662f\u8fd9\u4e9b\u65b9\u6cd5\u5e76\u4e0d\u53ef\u9760\uff0c\u56e0\u4e3a\u591a\u7ebf\u7a0b\u548c\u591a\u8fdb\u7a0b\uff0c\u5728\u8fd4\u56de\u7ed3\u679c\u548c\u4f7f\u7528\u7ed3\u679c\u4e4b\u95f4\uff0c\u961f\u5217\u4e2d\u53ef\u80fd\u6dfb\u52a0/\u5220\u9664\u4e86\u6210\u5458\u3002\r\n\r\n\r\n\r\n## Python\u591a\u8fdb\u7a0b\u548c\u591a\u7ebf\u7a0b\u54ea\u4e2a\u5feb?\r\n\r\n\r\n\r\n\u7531\u4e8eGIL\u7684\u5b58\u5728\uff0c\u5f88\u591a\u4eba\u8ba4\u4e3aPython\u591a\u8fdb\u7a0b\u7f16\u7a0b\u66f4\u5feb\uff0c\u9488\u5bf9\u591a\u6838CPU\uff0c\u7406\u8bba\u4e0a\u6765\u8bf4\u4e5f\u662f\u91c7\u7528\u591a\u8fdb\u7a0b\u66f4\u80fd\u6709\u6548\u5229\u7528\u8d44\u6e90\u3002\u7f51\u4e0a\u5f88\u591a\u4eba\u5df2\u505a\u8fc7\u6bd4\u8f83\uff0c\u6211\u76f4\u63a5\u544a\u8bc9\u4f60\u7ed3\u8bba\u5427\u3002\r\n\r\n- \u5bf9CPU\u5bc6\u96c6\u578b\u4ee3\u7801(\u6bd4\u5982\u5faa\u73af\u8ba1\u7b97) - \u591a\u8fdb\u7a0b\u6548\u7387\u66f4\u9ad8\r\n\r\n- \u5bf9IO\u5bc6\u96c6\u578b\u4ee3\u7801(\u6bd4\u5982\u6587\u4ef6\u64cd\u4f5c\uff0c\u7f51\u7edc\u722c\u866b) - \u591a\u7ebf\u7a0b\u6548\u7387\u66f4\u9ad8\u3002\r\n\r\n  \r\n\r\n\u4e3a\u4ec0\u4e48\u662f\u8fd9\u6837\u5462\uff1f\u5176\u5b9e\u4e5f\u4e0d\u96be\u7406\u89e3\u3002\u5bf9\u4e8eIO\u5bc6\u96c6\u578b\u64cd\u4f5c\uff0c\u5927\u90e8\u5206\u6d88\u8017\u65f6\u95f4\u5176\u5b9e\u662f\u7b49\u5f85\u65f6\u95f4\uff0c\u5728\u7b49\u5f85\u65f6\u95f4\u4e2dCPU\u662f\u4e0d\u9700\u8981\u5de5\u4f5c\u7684\uff0c\u90a3\u4f60\u5728\u6b64\u671f\u95f4\u63d0\u4f9b\u53ccCPU\u8d44\u6e90\u4e5f\u662f\u5229\u7528\u4e0d\u4e0a\u7684\uff0c\u76f8\u53cd\u5bf9\u4e8eCPU\u5bc6\u96c6\u578b\u4ee3\u7801\uff0c2\u4e2aCPU\u5e72\u6d3b\u80af\u5b9a\u6bd4\u4e00\u4e2aCPU\u5feb\u5f88\u591a\u3002\u90a3\u4e48\u4e3a\u4ec0\u4e48\u591a\u7ebf\u7a0b\u4f1a\u5bf9IO\u5bc6\u96c6\u578b\u4ee3\u7801\u6709\u7528\u5462\uff1f\u8fd9\u65f6\u56e0\u4e3apython\u78b0\u5230\u7b49\u5f85\u4f1a\u91ca\u653eGIL\u4f9b\u65b0\u7684\u7ebf\u7a0b\u4f7f\u7528\uff0c\u5b9e\u73b0\u4e86\u7ebf\u7a0b\u95f4\u7684\u5207\u6362\u3002", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/42--Python\u591a\u8fdb\u7a0b\u4e0e\u591a\u7ebf\u7a0b\u7f16\u7a0b.md", "create_date": "2020-02-17T12:57:05.899", "order": 5}}, {"model": "subject.chapter", "pk": 8, "fields": {"title": "Python\u7684\u5e8f\u5217\u5316", "topic": 1, "md5": "92e71a5784a88e4db2dde10da885742e", "md_body": ">\u73b0\u4ee3\u7f51\u7edc\u5e94\u7528Web APP\u6216\u5927\u578b\u7f51\u7ad9\u7684\u540e\u53f0\u4e00\u822c\u53ea\u6709\u4e00\u4e2a\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u5374\u662f\u5404\u79cd\u5404\u6837\u7684(iOS, android, \u6d4f\u89c8\u5668), \u800c\u4e14\u5ba2\u6237\u7aef\u7684\u5f00\u53d1\u8bed\u8a00\u5f88\u53ef\u80fd\u4e0e\u540e\u53f0\u7684\u5f00\u53d1\u8bed\u8a00\u4e0d\u4e00\u6837\u3002\u8fd9\u65f6\u6211\u4eec\u9700\u8981\u540e\u53f0\u80fd\u591f\u63d0\u4f9b\u53ef\u4ee5\u8de8\u5e73\u53f0\u8de8\u8bed\u8a00\u7684\u4e00\u79cd\u6807\u51c6\u7684\u6570\u636e\u4ea4\u6362\u683c\u5f0f\u4f9b\u524d\u540e\u7aef\u6c9f\u901a(\u8fd9\u5c31\u662fWeb API\u7684\u4f5c\u7528)\u3002\u5982\u4eca\u5927\u5bb6\u6700\u5e38\u7528\u7684\u8de8\u5e73\u53f0\u8de8\u8bed\u8a00\u6570\u636e\u4ea4\u6362\u683c\u5f0f\u5c31\u662fJSON\uff08JavaScript Object Notation\uff09\u4e86\u3002JSON\u662f\u4e00\u79cd\u6587\u672c\u5e8f\u5217\u5316\u683c\u5f0f\uff08\u5b83\u8f93\u51fa\u7684\u662funicode\u6587\u4ef6\uff0c\u5927\u591a\u6570\u65f6\u5019\u4f1a\u88ab\u7f16\u7801\u4e3autf-8\uff09\uff0c\u4eba\u4eec\u5f88\u5bb9\u6613\u8fdb\u884c\u9605\u8bfb\u548c\u7f16\u5199\u3002python\u81ea\u5e26\u7684dumps\u65b9\u6cd5\u5f88\u6709\u7528\uff0c\u80fd\u5f88\u5bb9\u6613\u5c06\u5b57\u5178dict\u7c7b\u578b\u6570\u636e\u8f6c\u5316\u4e3ajson\u683c\u5f0f\uff0c\u7136\u540e\u8fd8\u6709\u5f88\u591a\u7c7b\u578b\u7684\u6570\u636e(\u5982\u65e5\u671f\uff0c\u96c6\u5408, \u81ea\u5b9a\u4e49\u7684\u7c7b\u548cDjango\u7684QuerySet\u7c7b\u578b)\uff0c\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u65b9\u6cd5\u624d\u80fd\u5c06\u5b83\u4eec\u8f6c\u5316\u4e3ajson\u683c\u5f0f\u3002\u4eca\u5929\u5c0f\u7f16\u6211\u5c31\u6765\u5bf9python\u7684json\u6a21\u5757\u505a\u4e0b\u603b\u7ed3\uff0c\u5e76\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u628a\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636ejson\u5e8f\u5217\u5316\u3002\r\n\r\n\r\n\r\n\r\n## \u4f55\u8c13\u5e8f\u5217\u5316(serialization)\r\n\r\n\u6bcf\u79cd\u7f16\u7a0b\u8bed\u8a00\u90fd\u6709\u5404\u81ea\u7684\u6570\u636e\u7c7b\u578b, \u5c06\u5c5e\u4e8e\u81ea\u5df1\u8bed\u8a00\u7684\u6570\u636e\u7c7b\u578b\u6216\u5bf9\u8c61\u8f6c\u6362\u4e3a\u53ef\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u6216\u53ef\u4ee5\u5b58\u50a8\u5230\u672c\u5730\u78c1\u76d8\u7684\u6570\u636e\u683c\u5f0f\uff08\u5982\uff1aXML\u3001JSON\u6216\u7279\u5b9a\u683c\u5f0f\u7684\u5b57\u8282\u4e32\uff09\u7684\u8fc7\u7a0b\u79f0\u4e3a\u5e8f\u5217\u5316(seralization)\uff1b\u53cd\u4e4b\u5219\u79f0\u4e3a\u53cd\u5e8f\u5217\u5316\u3002\r\n\r\n\r\n\r\n## Python\u7684JSON\u6a21\u5757\r\n\r\n\r\n\r\npython\u81ea\u5e26\u7684json\u5e93(\u65e0\u9700\u989d\u5916\u5b89\u88c5), \u4e3b\u8981\u5305\u542b\u4e86==dumps, loads, dump==\u548c==load==\u56db\u79cd\u65b9\u6cd5\u5176\u4f5c\u7528\u5206\u522b\u5982\u4e0b\u6240\u793a\u3002\r\n\r\n- ==json.loads()== - \u5c06json\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3apython\u6570\u636e\u7c7b\u578b\r\n\r\n- ==json.dumps()== - \u5c06python\u6570\u636e\u7c7b\u578b\u8f6c\u5316\u4e3ajson\u5b57\u7b26\u4e32\r\n\r\n- ==json.dump()== - \u5c06python\u8f93\u5165\u8f6c\u5316\u4e3ajson\u683c\u5f0f\u5b58\u5165\u78c1\u76d8\u6587\u4ef6\r\n\r\n- ==json.load()== - \u5c06\u78c1\u76d8\u6587\u4ef6\u4e2djson\u683c\u5f0f\u6570\u636e\u8f6c\u6362\u4e3apython\u6570\u636e\u7c7b\u578b\r\n\r\n  \r\n\r\npython\u6570\u636e\u683c\u5f0f\u4e0ejson\u6570\u636e\u683c\u5f0f\u5bf9\u5e94\u8f6c\u6362\u5173\u7cfb\u5982\u4e0b:\r\n\r\n| Python      | JSON    |\r\n| ----------- | ------- |\r\n| dict        | Object  |\r\n| list, tuple | array   |\r\n| str         | string  |\r\n| int, float, | numbers |\r\n| True        | true    |\r\n| False       | false   |\r\n| None        | null    |\r\n\r\n\u4f60\u6ce8\u610f\u5230\u4e86\u5417\uff1f \u8fd8\u6709\u5f88\u591apython\u6570\u636e\u7c7b\u578b(set, datetime)\u4e0d\u5728\u4e0a\u8868\u4e2d\u54e6\u3002\r\n\r\n\r\n\r\n## json\u7684\u6a21\u5757dumps\u65b9\u6cd5\u4ecb\u7ecd - python\u6570\u636e\u7684\u5e8f\u5217\u5316\r\n\r\n\r\n\r\njson\u6a21\u5757\u7684==dumps==\u65b9\u6cd5\u53ef\u4ee5\u5c06python\u5e38\u7528\u6570\u636e\u683c\u5f0f\u8f6c\u5316\u4e3ajson\u683c\u5f0f\u3002\u8be5\u65b9\u6cd5\u8fd8\u63d0\u4f9b\u4e86\u5f88\u591a\u53ef\u9009\u53c2\u6570\u5982==ident==, ==separators==, ==ensure_ascii==, ==sort_keys==\u548c==default==\u53c2\u6570\u3002\u8fd9\u4e9b\u53c2\u6570\u90fd\u975e\u5e38\u6709\u7528\uff0c\u6211\u4eec\u4f1a\u7a0d\u540e\u9010\u4e00\u4ecb\u7ecd\u3002\r\n\r\n```py\r\ndumps(obj, skipkeys=False, ensure_ascii=True, \r\n      check_circular=True, allow_nan=True, \r\n      cls=None, indent=None, separators=None,\r\n      default=None, sort_keys=False, **kw)\r\n```\r\n\r\n\u6211\u4eec\u5148\u6765\u770b\u770b\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\u3002\u4f60\u6ce8\u610f\u5230\u4e86\u5417? ==\u751f\u6210\u7684json\u683c\u5f0f\u6570\u636e\u5916\u9762\u90fd\u52a0\u4e86\u5355\u5f15\u53f7==\uff0c\u8fd9\u8bf4\u660edict\u7c7b\u578b\u6570\u636e\u5df2\u7ecf\u8f6c\u5316\u6210\u4e86json\u5b57\u7b26\u4e32\u3002\r\n\r\n```py\r\n>>> import json\r\n>>> json.dumps({\"name\":\"John\", \"score\": 112})\r\n'{\"name\": \"John\", \"score\": 112}'\r\n```\r\n\r\n\u5982\u679c\u4e00\u4e2adict\u5f88\u957f\uff0c\u751f\u6210\u7684json\u5b57\u7b26\u4e32\u4f1a\u975e\u5e38\u957f\uff0c\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u8bbe==\u7f6eindent\u53c2\u6570\u4f7f\u751f\u6210\u7684json\u683c\u5f0f\u6570\u636e\u66f4\u4f18\u7f8e\uff0c\u66f4\u5bb9\u6613\u4eba\u4eec\u9605\u8bfb==\u3002\u4ee3\u7801\u5982\u4e0b\u6240\u793a:\r\n\r\n```py\r\n>>> import json\r\n>>> json.dumps({\"name\":\"John\", \"score\": 112}, indent=4)\r\n'{\\n    \"name\": \"John\",\\n    \"score\": 112\\n}'\r\n>>> print(json.dumps({\"name\":\"John\", \"score\": 112}, indent=4))\r\n{\r\n    \"name\": \"John\",\r\n    \"score\": 112\r\n}\r\n```\r\n\r\n\u7136\u800c\u4f7f\u7528indent\u53c2\u6570\u7684\u4ee3\u4ef7\u662fjson\u5b57\u7b26\u4e32\u91cc\u589e\u52a0\u4e86\u989d\u5916\u7684\u7a7a\u767d\uff0c\u673a\u5668\u9605\u8bfb\u6839\u672c\u4e0d\u9700\u8981\u5b83\u4eec\uff0c\r\n\r\n\u5373\u4f7f\u4e0d\u7528indent\u53c2\u6570\uff0c\u4f60\u4f1a\u53d1\u73b0dumps\u751f\u6210\u7684json\u5b57\u7b26\u4e32\u4e2d\u7684','\u53f7\u548c':'\u53f7\u5206\u9694\u7b26\u540e\u90fd\u4f1a\u9644\u52a0\u4e00\u4e2a\u9ed8\u8ba4\u7a7a\u767d\u5b57\u7b26\uff0c\u6211\u4eec\u53ef\u4ee5==\u901a\u8fc7separators\u53c2\u6570\u91cd\u65b0\u6307\u5b9a\u5206\u9694\u7b26\uff0c\u4ece\u800c\u53bb\u9664\u65e0\u7528\u7684\u7a7a\u767d\u5b57\u7b26==\uff0c\u5982\u4e0b\u6240\u793a\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u65e0\u7528\u6570\u636e\u7684\u7684\u4f20\u8f93\uff0c\u8282\u7701\u5e26\u5bbd\u589e\u52a0\u6570\u636e\u4f20\u8f93\u901f\u5ea6\u3002\r\n\r\n```py\r\n>>> import json\r\n>>> json.dumps({\"name\":\"John\", \"score\": 112})\r\n'{\"name\": \"John\", \"score\": 112}'\r\n\r\n# \u4f7f\u7528separators\u9009\u9879\r\n>>> json.dumps({\"name\":\"John\", \"score\": 112}, separators=(',',':'))\r\n'{\"name\":\"John\",\"score\":112}'\r\n```\r\n\r\n\u5982\u679c\u5b57\u7b26\u4e32\u6709\u975eASCII\u5b57\u7b26\uff08\u6bd4\u5982\u4e2d\u6587\uff09\uff0c\u5b83\u4eec\u5728json\u5e8f\u5217\u5316\u65f6\u90fd\u4f1a\u88ab\u8f6c\u4e49\u6210'\\uXXXX'\u7ec4\u6210\u7684ascii\u5b57\u7b26\u4e32\u3002\u5982\u679c\u60f3\u5f97\u5230\u66f4\u52a0\u6613\u8bfb\u7684\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5==\u8bbe\u7f6eensure_ascii=False==\u3002\r\n\r\n```py\r\n>>> import json\r\n>>> json.dumps({\"Name\":\"\u5c0f\u660e\", \"Age\": 16})\r\n'{\"Name\": \"\\\\u5c0f\\\\u660e\", \"Age\": 16}'\r\n\r\n# \u8bbe\u7f6eensure_ascii=False\r\n>>> json.dumps({\"Name\":\"\u5c0f\u660e\", \"Age\": 16}, ensure_ascii=False)\r\n'{\"Name\": \"\u5c0f\u660e\", \"Age\": 16}'\r\n```\r\n\r\n\r\n\r\n\u4e00\u822c\u7684dict\u9ed8\u8ba4\u662f\u65e0\u5e8f\u7684\uff0c\u4f60\u8fd8\u53ef\u4ee5\u8bbe\u7f6e==sort_keys = True==\u5bf9\u751f\u6210\u7684json\u683c\u5f0f\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6f14\u793a\u4e86\u3002default\u53c2\u6570\u6211\u4eec\u540e\u9762\u4f1a\u91cd\u70b9\u4ecb\u7ecd\u3002\r\n\r\n\r\n\r\n## json\u6a21\u5757\u7684dump\uff0cloads\u548cload\u65b9\u6cd5\u4ecb\u7ecd\r\n\r\n\r\n\r\n\u4e0edumps\u65b9\u6cd5\u4e0d\u540c\uff0cjson\u6a21\u5757\u7684dump\u65b9\u6cd5\u7528\u4e8e\u5c06\u751f\u6210\u7684json\u6570\u636e\u5199\u5165\u78c1\u76d8\u6587\u4ef6\u3002\u5176\u7528\u6cd5\u548cdumps\u7c7b\u4f3c\uff0c\u552f\u4e00\u4e0d\u540c\u7684\u662f\u9700\u8981\u6307\u5b9a\u9700\u8981\u5199\u5165\u7684\u6587\u4ef6\uff0c\u5177\u4f53\u7528\u6cd5\u5982\u4e0b\u6240\u793a:\r\n\r\n```py\r\nimport json\r\nwith open(\"json.txt\", 'w') as f:\r\n   json.dump({\"Name\":\"\u5c0f\u660e\", \"Age\": 16}, f, ensure_ascii=True)\r\n```\r\n\r\njson\u7684loads\u65b9\u6cd5\u7528\u4e8e\u5c06json\u683c\u5f0f\u6570\u636e\u8f6c\u5316\u4e3apython\u683c\u5f0f\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u53cd\u5e8f\u5217\u5316\uff0c\u5982\u4e0b\u6240\u793a\u3002\u5343\u4e07\u522b\u5fd8\u4e86\u5728json\u7b26\u4e32\u5916\u7684\u5355\u5f15\u53f7\u54e6\u3002\r\n\r\n```py\r\n>>> import json\r\n>>> json.loads('{\"Name\": \"\u5c0f\u660e\", \"Age\": 16}')\r\n{'Name': '\u5c0f\u660e', 'Age': 16}\r\n```\r\n\r\njson\u7684load\u65b9\u6cd5\u4e0eloads\u7528\u6cd5\u76f8\u4f3c\uff0c\u4e0d\u8fc7\u5b83\u9700\u8981\u6307\u5b9a\u5b58\u6709json\u6570\u636e\u7684\u6587\u4ef6\u3002\r\n\r\n```py\r\n>>> import json\r\n>>> with open(\"json.txt\", 'r') as f:\r\n    json.load(f)\r\n```\r\n\r\n\r\n\r\n## \u5f88\u591apython\u683c\u5f0f\u6570\u636e\u4e0d\u80fd\u76f4\u63a5\u88abdumps\u65b9\u6cd5\u5e8f\u5217\u5316\r\n\r\n\r\n\r\n\u5f88\u591apython\u6570\u636e\u7c7b\u578b(\u6bd4\u5982\u65e5\u671f\uff0c\u96c6\u5408\u548c\u81ea\u5b9a\u4e49\u7684\u7c7b)\u5e76\u4e0d\u80fd\u76f4\u63a5\u88abdumps\u65b9\u6cd5\u5e8f\u5217\u5316\uff0c\u8fd9\u65f6\u4f1a\u51fa\u73b0 xxx is not JSON serializable\u7684\u9519\u8bef\uff0c\u5982\u4e0b\u9762\u4ee3\u7801\u6240\u793a\u3002\u5f53\u51fa\u73b0\u7c7b\u4f3c\u9519\u8bef\u65f6\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\u3002\r\n\r\n- \u901a\u8fc7\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\u5b9e\u73b0\r\n- \u901a\u8fc7\u7ee7\u627fJSONEncoder\u548cJSONDecoder\u7c7b\u5b9e\u73b0\r\n\r\n```py\r\n>>> import json\r\n>>> from datetime import datetime\r\n\r\n# DateTime\u7c7b\u578b\r\n>>> json.dumps({\"date\":datetime.now()})\r\nTraceback (most recent call last):\r\nTypeError: Object of type 'datetime' is not JSON serializable\r\n\r\n# \u81ea\u5b9a\u4e49\u7684User\u7c7b\r\n>>> class User(object):\r\n        def __init__(self, name):\r\n            self.name = name\r\n\r\n>>> json.dumps(User(\"John\"))\r\n\r\nTraceback (most recent call last):\r\nTypeError: Object of type 'User' is not JSON serializable\r\n```\r\n\r\n\r\n\r\n### \u89e3\u51b3\u65b9\u6848\u4e00: \u7f16\u5199\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u51fd\u6570\r\n\r\n\r\n\r\n\u8be5\u65b9\u6cd5\u7684\u5de5\u4f5c\u539f\u7406\u662f\u5148\u7f16\u5199\u6570\u636e\u7c7b\u578b\u8f6c\u5316\u51fd\u6570\uff0c\u901a\u8fc7\u8bbe\u7f6edumps\u65b9\u6cd5\u91cc\u7684==default==\u53c2\u6570\u8c03\u7528\u683c\u5f0f\u8f6c\u5316\u51fd\u6570\uff0c\u5c06dumps\u65b9\u6cd5\u4e0d\u652f\u6301\u7684\u6570\u7c7b\u578b\u5148\u8f6c\u5316\u4e3a\u5b57\u7b26\u4e32\u683c\u5f0f\uff0c\u518d\u5b9e\u73b0json\u5e8f\u5217\u5316\u3002\r\n\r\n```py\r\n# \u5c06datetime\u683c\u5f0f\u6570\u636ejson\u5316\r\n>> > import json\r\n>> > from datetime import datetime\r\n>> > def date_to_str(obj):\r\n        if isinstance(obj, datetime):\r\n            return obj.strftime('%Y-%m-%d %H:%M:%S')\r\n        elif isinstance(obj, date):\r\n            return obj.strftime('%Y-%m-%d')\r\n        return TypeError\r\n\r\n>> > json.dumps({\"date\": datetime.now()}, default=date_to_str)\r\n'{\"date\": \"2018-09-22 21:25:42\"}'\r\n\r\n# \u5c06set\u7c7b\u578b\u6570\u636ejson\u5316\r\n>> > import json\r\n>> > set_data = {'my_set': {1, 2, 3}}\r\n\r\n>> > def set_to_list(obj):\r\n        if isinstance(obj, set):\r\n            return list(obj)\r\n        raise TypeError\r\n\r\n>> > result = json.dumps(set_data, default=set_to_list)\r\n```\r\n\r\n\r\n\r\n\u5bf9\u4e8e\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u7c7b, \u4f7f\u7528dumps\u65b9\u6cd5\u65f6\u6211\u4eec\u4e00\u822c\u8981\u5148\u7f16\u5199==obj_to_dict==\u65b9\u6cd5\uff0c\u5c06object\u8f6c\u5316\u4e3a\u5b57\u5178dict\u518dJSON\u5e8f\u5217\u5316\u3002\u540c\u7406\uff0c\u4f7f\u7528loads\u65b9\u6cd5\u5bf9json\u6570\u636e\u53cd\u5e8f\u5217\u5316\u65f6\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u7f16\u5199dict_to_obj\u65b9\u6cd5\uff0c\u901a\u8fc7default\u53c2\u6570\u8c03\u7528\u3002\u4e0b\u9762\u8fd92\u6bb5\u4ee3\u7801\u662f\u6bd4\u8f83\u901a\u7528\u7684\u5bf9\u8c61(object)\u4e0e\u5b57\u5178(dict)\u4e92\u8f6c\u7684\u7ecf\u5178\u4ee3\u7801\uff0c\u8bf7\u7528\u5fae\u4fe1\u6536\u85cf\u540e\u518d\u770b\u3002\r\n\r\n```py\r\n# \u5c06\u81ea\u5b9a\u4e49\u7684\u7c7b\u8f6c\u5316\u4e3a\u5b57\u5178\uff0cdumps\u65b9\u6cd5\u4f7f\u7528\r\ndef obj_to_dict(obj):\r\n    d = {}\r\n    d['__class__'] = obj.__class__.__name__\r\n    d['__module__'] = obj.__module__\r\n    d.update(obj.__dict__)\r\n    return d\r\n\r\n# \u5c06\u5b57\u5178\u8f6c\u5316\u4e3a\u81ea\u5b9a\u4e49\u7684\u7c7b\uff0cloads\u65b9\u6cd5\u4f7f\u7528\r\ndef dict_to_obj(d):\r\n    if '__class__' in d:\r\n        class_name = d.pop('__class__')\r\n        module_name = d.pop('__module__')\r\n        module = __import__(module_name)\r\n        class_ = getattr(module, class_name)\r\n        args = dict((key.encode('ascii'), value) for key, value in d.items())\r\n        instance = class_(**args)\r\n    else:\r\n        instance = d\r\n    return instance\r\n```\r\n\r\n\r\n\r\n### \u89e3\u51b3\u65b9\u6848\u4e8c: \u7ee7\u627fJSONEncoder\u7c7b\u548cJSONDecode\u7c7b\r\n\r\n\r\n\r\n\u53e6\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\u7ee7\u627fJSONEncoder\u7c7b\u548cJSONDecode\u7c7b\u5b9a\u4e49\u81ea\u5df1\u7684\u7f16\u7801Encoder\u7c7b\uff0c\u7136\u540e\u4f7f\u7528==cls=MyEncoder==,\u6765\u8c03\u7528\u7f16\u7801\u5668\u3002\u6bd4\u5982\u4e0b\u4f8b\u4e2d\u6211\u4eec\u5b9a\u4e49\u4e86\u81ea\u5df1\u7684DateTimeEncoder\uff0c\u5c06\u65e5\u671f\u7c7b\u578b\u6570\u636e\u5e8f\u5217\u5316\u3002\r\n\r\n```py\r\nfrom datetime import datetime, date\r\nimport json\r\n\r\n\r\nclass DateTimeEncoder(json.JSONEncoder):\r\n    def default(self, obj):\r\n        if isinstance(obj, datetime):\r\n            return obj.strftime('%Y-%m-%d %H:%M:%S')\r\n        elif isinstance(obj, date):\r\n            return obj.strftime('%Y-%m-%d')\r\n        return json.JSONEncoder.default(self, obj)\r\n\r\n\r\njson_data = {'num': 1, 'date': datetime.now()}\r\nprint(json.dumps(json_data, cls=DateTimeEncoder))\r\n```\r\n\r\n\u5bf9\u4e8e\u81ea\u5b9a\u4e49\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627fJSONEncoder\u7c7b\u5b9e\u73b0\u5b83\u7684\u5e8f\u5217\u5316\uff0c\u5982\u4e0b\u6240\u793a:\r\n\r\n```py\r\nimport json\r\nclass User(object):\r\n    def __init__(self, name):\r\n        self.name = name\r\n\r\nclass MyJSONEncoder(json.JSONEncoder):\r\n    def default(self, obj):\r\n        d = {}\r\n        d['__class__'] = obj.__class__.__name__\r\n        d['__module__'] = obj.__module__\r\n        d.update(obj.__dict__)\r\n        return d\r\n\r\nuser = User(\"John\")\r\njson.dumps(user, cls=MyJSONEncoder))\r\n```\r\n\r\n\u5bf9\u4e8e\u7b80\u5355\u7684\u6570\u636e\u5e8f\u5217\u5316\uff0c\u65b9\u6848\u4e00\u66f4\u5bb9\u6613\u7406\u89e3\uff0c\u4ee3\u7801\u4e5f\u66f4\u5c11\u3002\u4f46\u5f53\u9700\u8981\u4f20\u8f93\u7684\u6570\u636e\u5f88\u5927\u65f6\uff0c\u4f7f\u7528\u7ee7\u627fJSONEncoder\u7c7b\u6765\u5b9e\u73b0\u5e8f\u5217\u5316\u65f6\u6709\u4e2a\u5f88\u5927\u7684\u597d\u5904\uff0c\u5c31\u662f\u53ef\u4ee5\u901a\u8fc7iterencode()\u65b9\u6cd5\u628a\u4e00\u4e2a\u5f88\u5927\u7684\u6570\u636e\u5bf9\u8c61\u5206\u591a\u6b21\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u8fd9\u5bf9\u4e8e\u7f51\u7edc\u6301\u7eed\u4f20\u8f93\u6216\u5199\u5165\u5927\u7684\u6587\u4ef6\u975e\u5e38\u6709\u7528\u3002\u5982\u4e0b\u6240\u793a\u3002\r\n\r\n```py\r\n>>> for chunk in MyJSONEncoder().iterencode(big_object):\r\n...     print(chunk)\r\n```\r\n\r\n\r\n\r\n## Django\u7279\u6709\u6570\u636e\u7c7b\u578b\u5e8f\u5217\u5316\r\n\r\n\r\n\r\nDjango\u7f16\u7a0b\u5c31\u662f\u662fpython\u7f16\u7a0b\uff0c\u4ee5\u4e0a\u6240\u4ecb\u7ecd\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\u5bf9django\u4e5f\u662f\u9002\u7528\u7684\u3002\u4e0d\u540c\u7684\u662fDjango\u8fd8\u6709\u81ea\u5df1\u4e13\u5c5e\u7684\u6570\u636e\u7c7b\u578b\u6bd4\u5982QuerySet\u548cValueQuerySet\u7c7b\u578b\u6570\u636e\uff0c\u8fd8\u63d0\u4f9b\u4e86\u66f4\u4fbf\u6377\u7684serializers\u7c7b\u3002==\u4f7f\u7528serializers\u7c7b\u53ef\u4ee5\u8f7b\u6613\u5c06QuerySet\u683c\u5f0f\u7684\u6570\u636e\u8f6c\u5316\u4e3ajson\u683c\u5f0f==\u3002\r\n\r\n```py\r\n# Django Queryset\u6570\u636e to Json\r\nfrom django.core import serializers\r\ndata = serializers.serialize(\"json\", SomeModel.objects.all())\r\ndata1 = serializers.serialize(\"json\", SomeModel.objects.all(), fields=('name','id'))\r\ndata2 = serializers.serialize(\"json\", SomeModel.objects.filter(field = some_value))\r\n```\r\n\r\n\u6709\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u67e5\u8be2\u7ed3\u679c\u96c6\u7684\u90e8\u5206\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4f7f\u7528values('\u5b57\u6bb5\u540d','\u5b57\u6bb5\u540d2')\u6765\u8981\u6c42\u8fd4\u56de\u7684\u662f\u54ea\u4e9b\u5217\u7684\u6570\u636e.\u4f46\u662f\u8fd4\u56de\u6765\u7684\u662fValuesQuerySet\u5bf9\u8c61\u800c\u4e0d\u662fQuerySet\u5bf9\u8c61\u3002==ValuesQuerySet\u5bf9\u8c61\u4e0d\u80fd\u7528 serializers.serialize() \u65b9\u6cd5\u5e8f\u5217\u5316\u6210json, \u9700\u8981\u5148\u8f6c\u6362\u6210list\u518d\u7528 json.dumps()\u65b9\u6cd5\u5e8f\u5217\u5316\u6210json\u683c\u5f0f==\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u6240\u793a:\r\n\r\n```py\r\nimport json\r\nfrom django.core.serializers.json import DjangoJSONEncoder\r\n\r\nqueryset = myModel.objects.filter(foo_icontains=bar).values('f1', 'f2', 'f3')\r\ndata4 = json.dumps(list(queryset), cls=DjangoJSONEncoder)\r\n```", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/48--Python\u7684\u5e8f\u5217\u5316.md", "create_date": "2020-02-17T12:57:05.917", "order": 4}}, {"model": "subject.chapter", "pk": 9, "fields": {"title": "Python\u5217\u8868\u8868\u8fbe\u5f0f\u53ca\u9ad8\u9636\u51fd\u6570\u5982lamda, zip, enumerate, map\u548cfilter\u65b9\u6cd5", "topic": 1, "md5": "361e4cd9a9c5449127455c7fc0ea43d0", "md_body": "## \u5217\u8868\u8868\u8fbe\u5f0f[List Comprehension]\r\n\r\n> \u6bb5\u843d\u5f15\u7528\u987e\u540d\u601d\u4e49\uff0c\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u4f5c\u7528\u662f\u4ee5\u4e00\u4e2a\u5feb\u6377\u7684\u65b9\u6cd5\u5bf9\u5217\u8868\u8fdb\u884c\u64cd\u4f5c\u6216\u8fd0\u7b97\uff0c\u8fd4\u56de\u65b0\u7684**\u5217\u8868**\u3002\u5176\u4f7f\u7528\u65b9\u5f0f\u4e3a[\u8868\u8fbe\u5f0f for \u53d8\u91cf in \u5217\u8868] \u6216\u8005  [\u8868\u8fbe\u5f0f for \u53d8\u91cf in \u5217\u8868 if \u6761\u4ef6]\u3002\r\n\r\n\r\n\r\n\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u5217\u8868\u8868\u8fbe\u5f0f\u7684\u4f8b\u5b50\u5982\u4e0b\u3002\r\n\r\n\r\n\r\n```py\r\n>>> list1 = [1, 2, 3, 4]\r\n>>> list2 = [ i*i for i in list1]\r\n>>> list3 = [ i*i for i in list1 if i>2]\r\n>>> print(list2)\r\n[1, 4, 9, 16]\r\n>>> print(list3)\r\n[9, 16]\r\n```\r\n\r\n\u5217\u8868\u8868\u8fbe\u5f0f\u4e5f\u53ef\u4ee5\u904d\u5386\u5143\u7ec4\u751f\u6210\u65b0\u7684\u5217\u8868(\u5982list5)\uff0c\u7136\u800c\u5374\u4e0d\u80fd\u76f4\u63a5\u751f\u6210\u65b0\u7684\u5143\u7ec4\u3002\u6bd4\u5982list6\u5b9e\u9645\u4e0a\u662f\u4e2a\u751f\u6210\u5668\u8868\u8fbe\u5f0f\uff0c\u4e0d\u5c5e\u4e8e\u5217\u8868\u8868\u8fbe\u5f0f\u4e86\u3002\u5bf9\u4e8e\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528list6.__next__()\u65b9\u6cd5\u4e00\u6b21\u4e00\u6b21\u53d6\u503c\u3002\r\n\r\n```py\r\n>>> tuple1 = (1, 2, 3, 4)\r\n>>> list5 = [ i*i for i in tuple1 ]\r\n>>> print(list5)\r\n[1, 4, 9, 16]\r\n>>> list6 = ( i*i for i in tuple1 )\r\n>>> print(list6)\r\n<generator object <genexpr> at 0x03559E10>\r\n```\r\n\r\n\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e0b3\u4e2a\u5e38\u8003\u7684\u5173\u4e8e\u5217\u8868\u8868\u8fbe\u5f0f\u5e94\u7528\u7684\u4f8b\u5b50\u3002\r\n\r\n1.\u7edf\u8ba1\u5b57\u7b26\u4e32\u5217\u8868\u4e2d\u6bcf\u4e2a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\r\n\r\n```py\r\n>>> words = ['abc','defg','I love python', 'Django']\r\n>>> len_list = [ len(word) for word in words ]\r\n>>> print(len_list)\r\n[3, 4, 13, 6]\r\n```\r\n\r\n2. \u5229\u4e8e\u5217\u8868\u8868\u8fbe\u5f0f\u6c42\u4e24\u4e2a\u5217\u8868\u7684\u4ea4\u96c6\u3002\r\n\r\n```py\r\n>>> a = [ 3, 5, 6, 8]\r\n>>> b = [ 5, 6]\r\n>>> a_b = [ i for i in a if i in b]\r\n>>> print(a_b)\r\n[5, 6]\r\n```\r\n\r\n3. \u6253\u5370\u51fa100\u4ee5\u5185\u6240\u6709\u5341\u4f4d\u6570\u6bd4\u4e2a\u4f4d\u6570\u59271\u4f4d\u7684\u6570\u5b57\u3002\r\n\r\n```py\r\n>>> num = [ n1*10+n2 for n1 in range(0, 10) \r\n        for n2 in range(0, 10) if n1 == n2+1 ]\r\n>>> print(num)\r\n[10, 21, 32, 43, 54, 65, 76, 87, 98]\r\n```\r\n\r\n\r\n\r\n## \u533f\u540d\u51fd\u6570lambda\u51fd\u6570\r\n\r\nLambda\u51fd\u6570\u53c8\u79f0\u533f\u540d\u51fd\u6570\uff0c\u4e5f\u6709\u4eba\u79f0\u4e3alambda\u8868\u8fbe\u5f0f\u3002\u987e\u540d\u601d\u4e49\uff0c\u533f\u540d\u51fd\u6570\u5c31\u662f\u6ca1\u6709\u540d\u5b57\u7684\u51fd\u6570\u3002\u51fd\u6570\u6ca1\u6709\u540d\u5b57\u4e5f\u884c\uff1f\u5f53\u7136\u53ef\u4ee5\u5566\u3002\u6709\u4e9b\u51fd\u6570\u5982\u679c\u53ea\u662f\u4e34\u65f6\u4e00\u7528\uff0c\u800c\u4e14\u5b83\u7684\u4e1a\u52a1\u903b\u8f91\u4e5f\u5f88\u7b80\u5355\u65f6\uff0c\u5c31\u6ca1\u5fc5\u8981\u975e\u7ed9\u5b83\u53d6\u4e2a\u540d\u5b57\u4e0d\u53ef\u3002\r\n\r\n\r\n\r\nlambda\u533f\u540d\u51fd\u6570\u7684\u683c\u5f0f\u662f lambda \u53c2\u6570: \u8868\u8fbe\u5f0f\u3002\u5192\u53f7\u524d\u662f\u53c2\u6570\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u7528\u9017\u53f7\u9694\u5f00\uff0c\u5192\u53f7\u53f3\u8fb9\u7684\u4e3a\u8868\u8fbe\u5f0f\u3002\u5176\u5b9elambda\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u51fd\u6570\u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u51fd\u6570\u5bf9\u8c61\u3002\u4e0b\u9762\u662f\u4e2a\u6700\u7b80\u5355\u7684lambda\u51fd\u6570\u7684\u4f8b\u5b50\u3002\r\n\r\n```py\r\n>>> add = lambda x, y: x+y\r\n>>> type(add)\r\n<class 'function'>\r\n>>> print(add(3,5))\r\n8\r\n```\r\n\r\n\u65e2\u7136\u662f\u533f\u540d\u51fd\u6570\uff0c\u6211\u4eec\u4e3a\u4ec0\u4e48\u8fd8\u8981\u7ed9\u5b83\u53d6\u4e2a\u53ebadd\u7684\u540d\u5b57\uff1f\u8fd9\u7684\u786e\u662f\u591a\u6b21\u4e00\u4e3e\u3002\u5176\u5b9elambda\u6700\u5e38\u7528\u7684\u8fd8\u662f\u548csorted, map\u3001reduce\u3001filter\u8fd9\u4e9b\u9ad8\u7ea7\u51fd\u6570\u7ed3\u5408\u4f7f\u7528\u3002\u6211\u4eec\u518d\u6765\u770b\u4e0b2\u4e2a\u4f7f\u7528lambda\u51fd\u6570\u7ed3\u5408sorted\u65b9\u6cd5\u6392\u5e8f\u7684\u7ecf\u5178\u4f8b\u5b50\u3002\u4e00\u4e2a\u6309\u7edd\u5bf9\u503c\u5927\u5c0f\u6392\u5e8f\uff0c\u4e00\u4e2a\u6309\u5b57\u7b26\u4e32\u957f\u5ea6\u6392\u5e8f\u3002\r\n\r\n```py\r\n>>> list1 = [ 5, -3, 1, 8, -4 ]\r\n>>> list2 = sorted(list1, key=lambda x:abs(x))\r\n>>> print(list2)\r\n[1, -3, -4, 5, 8]\r\n\r\n>>> list3 = [ 'to', 'python', 'ABC' ]\r\n>>> list4 = sorted(list3, key=lambda x:len(x))\r\n>>> print(list4)\r\n['to', 'ABC', 'python']\r\n```\r\n\r\n\u4e0b\u9762\u662f\u4e00\u9053\u5173\u4e8elambda\u51fd\u6570\u7684\u7ecf\u5178\u9762\u8bd5\u9898\u3002flist[0]\u80fd\u8f93\u51fa\u4ec0\u4e48\uff1f\u8fd9\u4e2a\u4e3b\u8981\u8003\u51fd\u6570\u5bf9\u8c61\u5217\u8868\uff0c\u5343\u4e07\u4e0d\u8981\u548c\u5217\u8868\u8868\u8fbe\u5f0f\u641e\u6df7\u4e86\u554a\u3002\u7b54: flist[0]\u8f93\u51fa\u7684\u662f\u51fd\u6570\u5bf9\u8c61\u3002\r\n\r\n```py\r\n>>> flist = [ lambda x:x*x for x in range(1, 3)]\r\n>>> print(flist)\r\n[<function <listcomp>.<lambda> at 0x03ADE2B8>, <function <listcomp>.<lambda> at 0x03ADE300>]\r\n>>> flist[0]\r\n<function <listcomp>.<lambda> at 0x03ADE2B8>\r\n>>> flist[0](2)\r\n4\r\n```\r\n\r\n\r\n\r\n## zip\u51fd\u6570\r\n\r\nzip()\u51fd\u6570\u6765\u53ef\u4ee5\u628a2\u4e2a\u6216\u591a\u4e2a\u5217\u8868\u5408\u5e76\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u5143\u7ec4\u5bf9\u7684\u5217\u8868\u3002\u5143\u7ec4\u5bf9\u7684\u6570\u91cf\u4ee5\u5408\u5e76\u5217\u8868\u7684\u6700\u77ed\u957f\u5ea6\u4e3a\u51c6\u3002python 3\u4e2dzip\u65b9\u6cd5\u5408\u5e76\u5217\u8868\u540e\u751f\u6210\u7684\u662fzip\u5bf9\u8c61\uff0c\u4f7f\u7528list\u65b9\u6cd5\u53ef\u4ee5\u5c06\u5176\u53d8\u6210\u5217\u8868\uff0c\u4f7f\u7528dict\u65b9\u6cd5\u53ef\u4ee5\u5c06\u5176\u53d8\u6210\u5b57\u5178\u3002\r\n\r\n```py\r\n>>> l1 = [ 1, 2, 3 ]\r\n>>> l2 = [ 'x', 'y', 'z']\r\n>>> l3 = [ 'x', 'y' ]\r\n>>> zip(l1, l2)\r\n<zip object at 0x031D6828>\r\n>>> print(list(zip(l1, l2)))\r\n[(1, 'x'), (2, 'y'), (3, 'z')]\r\n>>> print(list(zip(l1, l3)))\r\n[(1, 'x'), (2, 'y')]\r\n>>> print(dict(zip(l1,l3)))\r\n{1: 'x', 2: 'y'}\r\n```\r\n\r\n\u5b9e\u9645\u4e0azip\u65b9\u6cd5\u652f\u6301\u6240\u6709\u53ef\u8fed\u4ee3\u5bf9\u8c61\uff08\u5b57\u7b26\u4e32\u3001\u5217\u8868\u3001\u5143\u7956\u3001\u5b57\u5178), \u800c\u4e0d\u4ec5\u4ec5\u662f\u5217\u8868\u3002\u5229\u7528\u8fd9\u4e2a\u7279\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u521b\u5efa\u5404\u79cd\u5b57\u5178\uff0c\u5305\u62ec\u5f88\u590d\u6742\u7684\u5b57\u5178\u3002\u6211\u4eec\u6765\u770b\u4e0b\u97622\u4e2a\u7ecf\u5178\u4f8b\u5b50\u3002\u6ce8\u610fzip\u5bf9\u8c61\u652f\u6301\u76f4\u63a5\u904d\u5386\u54e6\uff0c\u4e0d\u9700\u8981\u5148\u8f6c\u6210list\u6216dict\u54e6\u3002\r\n\r\n```py\r\n>> > l1 = [1, 2, 3]\r\n>> > str1 = \"abc\"\r\n>> > print(dict(zip(l1, str1)))\r\n{1: 'a', 2: 'b', 3: 'c'}\r\n>> > name = [\"John\", \"Jim\", \"Lucy\"]\r\n>> > year = [1983, 1985, 1995]\r\n>> > birth_year = dict(zip(name, year))\r\n>> > print(birth_year)\r\n{'John': 1983, 'Jim': 1985, 'Lucy': 1995}\r\n>> > for name, year in zip(name, year):\r\n    print(\"{} - {}\".format(name, year))\r\n\r\nJohn - 1983\r\nJim - 1985\r\nLucy - 1995\r\n```\r\n\r\n\u5229\u7528zip(*some_list)\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u5143\u7ec4\u5217\u8868\u7684\u53cd\u5411\u89e3\u538b\uff0c\u89c1\u4e0b\u9762\u6848\u4f8b\u3002\u6ce8\u610funzip\u53ea\u652f\u6301\u5143\u7ec4\u5217\u8868\uff0c\u4e0d\u652f\u6301dict\u76f4\u63a5\u89e3\u538b\u54e6\u3002\u8fd9\u4e5f\u662f\u9762\u8bd5\u5e38\u8003\u5185\u5bb9\u3002\r\n\r\n```py\r\n>>> l1 = [(\"John\", 1995), (\"Lucy\", 2000), (\"Max\", 1985)]\r\n>>> name, year = zip(*l1)\r\n>>> print(name)\r\n('John', 'Lucy', 'Max')\r\n>>> print(year)\r\n(1995, 2000, 1985)\r\n>>> l2 = dict(l1)\r\n>>> print(l2)\r\n{'John': 1995, 'Lucy': 2000, 'Max': 1985}\r\n>>> name1, year1 = zip(*l2)\r\nTraceback (most recent call last):\r\n  File \"<pyshell#6>\", line 1, in <module>\r\n    name1, year1 = zip(*l2)\r\nValueError: too many values to unpack (expected 2)\r\n```\r\n\r\n\r\n\r\n## enumerate() \u51fd\u6570\r\n\r\nenumerate() \u51fd\u6570\u7528\u4e8e\u5c06\u4e00\u4e2a\u53ef\u904d\u5386\u7684\u6570\u636e\u5bf9\u8c61(\u5982\u5217\u8868\u3001\u5143\u7ec4\u6216\u5b57\u7b26\u4e32)\u7ec4\u5408\u4e3a\u4e00\u4e2a\u7d22\u5f15\u5e8f\u5217\uff0c\u540c\u65f6\u5217\u51fa\u6570\u636e\u548c\u6570\u636e\u4e0b\u6807\uff0c\u5e38\u89c1\u7528\u4e8efor\u5faa\u73af\u3002\u4e00\u822c\u53ea\u6709\u9700\u8981\u540c\u65f6\u7528\u5230\u7d22\u5f15index\u548cvalue\u503c\u7684\u65f6\u5019\u624d\u7528enumerate\u65b9\u6cd5\u3002\u6ce8\u610f\u76f4\u63a5\u4f7f\u7528enumerate\u65b9\u6cd5\u751f\u6210\u662f\u4e2aenumerate\u5bf9\u8c61\uff0c\u53ef\u4ee5\u904d\u5386\u7684\u3002\r\n\r\n```py\r\n>> > name = [\"John\", \"Lucy\", \"Mary\"]\r\n>> > name1 = enumerate(name)\r\n>> > print(name1)\r\n< enumerate object at 0x030D0FA8 >\r\n>> > for index, name in enumerate(name):\r\n    print(\"{}-{}\".format(index, name))\r\n\r\n0 - John\r\n1 - Lucy\r\n2 - Mary\r\n```\r\n\r\n\r\n\r\n## map\u51fd\u6570\r\n\r\nmap\u51fd\u6570\u662f\u4e2a\u975e\u5e38\u6709\u7528\u7684\u65b9\u6cd5\uff0c\u5176\u8bed\u6cd5\u662f map(function, iterable, ...)\u3002map\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u51fd\u6570\u4f5c\u4e3a\u53c2\u6570\uff0c\u5e76\u5c06\u5176\u6620\u5c04\u4e8e\u5217\u8868\u7684\u591a\u4e2a\u5143\u7d20\u3002python 2\u4e2d\u8fd4\u56de\u5217\u8868\uff0cpython 3\u4e2d\u8fd4\u56de\u8fed\u4ee3\u5668\uff0c\u9700\u8981\u4f7f\u7528list\u65b9\u6cd5\u518d\u751f\u6210\u5217\u8868\u3002map\u51fd\u6570\u4e0d\u4ec5\u652f\u6301\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u548clambda\u51fd\u6570\uff0c\u8fd8\u652f\u6301python\u81ea\u5e26\u7684\u51fd\u6570\u3002\r\n\r\n\r\n\r\n\u4e0b\u9762\u662fmap\u51fd\u6570\u5e94\u7528\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\u3002\u8be5\u4f8b\u5b50\u5c06\u8ba1\u7b97\u5e73\u65b9\u7684lambda\u51fd\u6570\u6620\u5c04\u4e8e\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u3002\r\n\r\n```py\r\n>>> l = map(lambda x: x ** 2, [1, 2, 3, 4, 5])\r\n>>> print(l)\r\n<map object at 0x03553790>\r\n>>> print(list(l))\r\n[1, 4, 9, 16, 25]\r\n```\r\n\r\nmap\u51fd\u6570\u8fd8\u652f\u6301\u591a\u4e2a\u5217\u8868\u7684\u6620\u5c04\u548c\u8ba1\u7b97\uff0c\u5982\u4e0b\u6240\u793a\u3002lambda\u51fd\u6570\u4e2d\u7684x, y, z\u5206\u522b\u5bf9\u5e94\u5217\u8868l1, l2\u548cl3\u4e2d\u7684\u5143\u7d20\u3002\u8ba1\u7b97\u540e\u7684\u751f\u6210\u7684\u5217\u8868\u957f\u5ea6\u53d6\u51b3\u4e8e\u5404\u4e2a\u5217\u8868\u7684\u6700\u77ed\u957f\u5ea6\u3002\r\n\r\n```py\r\n>>> l1 = [1, 2, 3]\r\n>>> l2 = [4, 5, 6, 7]\r\n>>> l3 = [8, 9]\r\n>>> print(list(map(lambda x,y,z:x+y+z, l1, l2, l3)))\r\n[13, 16]\r\n```\r\n\r\n\u6211\u4eec\u4e0b\u9762\u6765\u770b\u4e0b\u4e00\u9053\u5173\u4e8emap\u51fd\u6570\u7684\u7ecf\u5178\u8003\u9898\u3002\u6211\u4eec\u6709\u4e24\u4e2a\u5b57\u7b26\u4e32A\u548cB\uff0c\u73b0\u5728\u8981\u7edf\u8ba1\u5b57\u7b26\u4e32A\u4e2d\u6709\u591a\u5c11\u4e2a\u5b57\u7b26\u4e5f\u5728\u5b57\u7b26\u4e32B\u4e2d\u53ef\u4ee5\u627e\u5230\u3002\u5e38\u89c4\u51fd\u6570\u89e3\u6cd5\u5982\u4e0b:\r\n\r\n```py\r\n>>> strA = \"aAAAbBCC\"\r\n>>> strB = \"aA\"\r\n>>> def count1(str1, str2):\r\n   a = 0\r\n   for c in str1:\r\n      if c in str2:\r\n         a += 1\r\n   return a\r\n\r\n>>> count1(strA, strB)\r\n4\r\n```\r\n\r\n\u4f7f\u7528map\u51fd\u6570\u7ecf\u5178\u89e3\u6cd5\u5982\u4e0b\uff0c\u662f\u4e0d\u662f\u597d\u7b80\u5355\u597d\u725b\u53c9\u7684\u6837\u5b50?\r\n\r\n```py\r\n>>> strA = \"aAAAbBCC\"\r\n>>> strB = \"aA\"\r\n>>> print(sum(map(strA.count, strB)))\r\n4\r\n```\r\n\r\n\u6211\u4eec\u73b0\u5728\u6765\u5206\u6790\u4e0b\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u3002python\u81ea\u5e26\u7684string.count(char)\u51fd\u6570\u7684\u4f5c\u7528\u662f\u7edf\u8ba1\u4e00\u4e2a\u5b57\u7b26\u4e32string\u542b\u6709\u5b57\u7b26char\u7684\u6570\u91cf\u3002\u5728\u672c\u4f8b\u4e2dstrB\u76f8\u5f53\u4e8echar\u7684\u4e00\u4e2a\u53c2\u6570\u5217\u8868[\"a\", \"A\"], map\u51fd\u6570\u5148\u7edf\u8ba1strA\u4e2d\u5b57\u7b26a\u7684\u6570\u91cf\uff0c\u518d\u7edf\u8ba1strA\u4e2d\u5b57\u7b26A\u7684\u6570\u91cf\uff0c\u83b7\u5f97\u5217\u8868[1, 3], \u7136\u540e\u5c06\u5b83\u4eec\u76f8\u52a0\uff0c\u5373\u53ef\u83b7\u5f97\u5b57\u7b26\u4e32A\u4e2d\u603b\u5171\u6709\u591a\u5c11\u5b57\u7b26\u53ef\u4ee5\u5728B\u4e2d\u627e\u5230\u3002\r\n\r\n\r\n\r\n## reduce\u51fd\u6570\r\n\r\n**reduce()** \u51fd\u6570\u4f1a\u5bf9\u53c2\u6570\u5e8f\u5217\u4e2d\u5143\u7d20\u8fdb\u884c\u7d2f\u79ef\u3002\u8be5\u65b9\u6cd5\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u9700\u662f\u51fd\u6570\uff0c\u800c\u4e14\u4f20\u5165\u7684\u51fd\u6570\u5fc5\u9700\u8981\u67092\u4e2a\u53c2\u6570\uff0c\u5426\u5219\u51fa\u73b0\u9519\u8bef\u3002\u8be5\u65b9\u6cd5\u5c06\u4e00\u4e2a\u6570\u636e\u96c6\u5408\uff08\u5217\u8868\uff0c\u5143\u7ec4\u7b49\uff09\u4e2d\u7684\u6240\u6709\u6570\u636e\u8fdb\u884c\u4e0b\u5217\u64cd\u4f5c\uff1a\u7528\u4f20\u7ed9 reduce \u4e2d\u7684\u51fd\u6570 function\u5148\u5bf9\u96c6\u5408\u4e2d\u7684\u7b2c 1\u30012 \u4e2a\u5143\u7d20\u8fdb\u884c\u64cd\u4f5c\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u518d\u4e0e\u7b2c\u4e09\u4e2a\u6570\u636e\u7528 function \u51fd\u6570\u8fd0\u7b97\uff0c\u6700\u540e\u5f97\u5230\u4e00\u4e2a\u7ed3\u679c\u3002\r\n\r\n\r\n\r\nreduce\u51fd\u6570\u5f88\u9002\u5408\u8fde\u7eed\u8ba1\u7b97(\u6bd4\u5982\u5217\u8868\u6c42\u548c\u6216\u8fde\u4e58\u8ba1\u7b97\u9636\u4e58)\uff0c\u7ecf\u5178\u4ee3\u7801\u5982\u4e0b\u3002\r\n\r\n```py\r\n>>> from functools import reduce\r\n>>> reduce(lambda x, y: x+y, [1,2,3,4,5])\r\n15\r\n>>> reduce(lambda x,y:x*y,range(1,5))\r\n24\r\n```\r\n\r\n\u6ce8\u610f: python 3\u4e2dreduce() \u51fd\u6570\u5df2\u7ecf\u88ab\u4ece\u5168\u5c40\u540d\u5b57\u7a7a\u95f4\u91cc\u79fb\u9664\u4e86\uff0c\u5b83\u73b0\u5728\u88ab\u653e\u7f6e\u5728 fucntools \u6a21\u5757\u91cc\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u5b83\uff0c\u5219\u9700\u8981\u901a\u8fc7\u5f15\u5165 functools \u6a21\u5757\u6765\u8c03\u7528 reduce() \u51fd\u6570\u3002\r\n\r\n\r\n\r\n## filter\u51fd\u6570\r\n\r\nPython\u7684 filter() \u51fd\u6570\u7528\u4e8e\u8fc7\u6ee4\u5e8f\u5217\uff0c\u8fc7\u6ee4\u6389\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u5143\u7d20\uff0c\u8fd4\u56de\u7531\u7b26\u5408\u6761\u4ef6\u5143\u7d20\u7ec4\u6210\u7684\u65b0\u5217\u8868\u3002\u8be5\u65b9\u6cd5\u4e0emap\u548creduce\u7c7b\u4f3c\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u90fd\u662f\u51fd\u6570\uff0c\u4f5c\u7528\u4e8e\u53ef\u4ee5\u8fed\u4ee3\u7684\u5bf9\u8c61\u6bd4\u5982\u5217\u8868\u548c\u5143\u7ec4\uff0c\u4f46\u4e0d\u540c\u7684\u662ffilter\u65b9\u6cd5\u4f20\u5165\u7684\u51fd\u6570\u662f\u5224\u65ad\u6027\u51fd\u6570, \u53ea\u6709\u7b26\u5408\u6761\u4ef6\u7684\u5217\u8868\u5143\u7d20\u624d\u4f1a\u52a0\u5165\u65b0\u7684\u5217\u8868\u3002Python 2\u4e2d\u8fd4\u56de\u5217\u8868\uff0cpython 3\u4e2d\u8fd4\u56defilter\u5bf9\u8c61\uff0c\u4f7f\u7528list\u65b9\u6cd5\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5217\u8868\u3002\r\n\r\n\r\n\r\n\u4e0b\u9762\u662f\u4f7f\u7528filter\u65b9\u6cd5\u6253\u5370\u51fa10\u4ee5\u5185\u5076\u6570\u7684\u7ecf\u5178\u4ee3\u7801\u3002\u53ea\u6709\u6ee1\u8db3x % 2 == 0 \u7684\u5217\u8868\u5143\u7d20\u624d\u4f1a\u52a0\u5165\u65b0\u7684\u5217\u8868\u3002\r\n\r\n```py\r\n>>> l = filter(lambda x: x % 2 == 0, range(10))\r\n>>> print(l)\r\n<filter object at 0x02C0BBF0>\r\n>>> print(list(l))\r\n[0, 2, 4, 6, 8]\r\n```\r\n\r\n\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u5229\u7528filter\u65b9\u6cd5\u5220\u9664\u5b57\u7b26\u4e32\u5217\u8868\u91cc\u7684\u7a7a\u767d\u5b57\u7b26\u4e32\u3002\u53ea\u6709\u6ee1\u8db3s and s.strip() = True\u7684\u5b57\u7b26\u4e32\u624d\u4f1a\u52a0\u5165\u65b0\u7684\u5217\u8868\u3002\r\n\r\n```py\r\ndef not_empty(s):\r\n    return s and s.strip()\r\n\r\nlist(filter(not_empty, ['A', '', 'B', None, 'C', '  ']))\r\n# \u7ed3\u679c: ['A', 'B', 'C']\r\n```\r\n\r\n\u6700\u597d\u4e00\u9053\u662f\u5173\u4e8efilter\u65b9\u6cd5\u7684\u7ecf\u5178\u9762\u8bd5\u9898\uff0c\u5229\u7528filter\u65b9\u6cd5\u7b5b\u9009\u51fa\u4e00\u4e2a\u5217\u8868\u4e2d\u7684\u7d20\u6570\u3002\u7f51\u4e0a\u5927\u591a\u6570\u4ee3\u7801\u90fd\u4e0d\u5b8c\u7f8e\uff0c\u4e00\u662f\u4e0d\u80fd\u5bf9\u5c0f\u4e8e\u7b49\u4e8e2\u7684\u6570(\u5305\u62ec0, 1\u548c2)\u505a\u51fa\u51c6\u786e\u5224\u65ad\uff0c\u4e8c\u662f\u4f7f\u7528\u4e86for i in range(2, n+1)\uff0c\u505a\u4e86\u5f88\u591a\u65e0\u6548\u5faa\u73af\u3002\r\n\r\n```py\r\n>>> import math\r\n>>> def isPrime(n):\r\n       if n <= 1:\r\n          return False\r\n       elif n == 2:\r\n          return True\r\n       else:\r\n          for i in range(2, int(math.sqrt(n))+1):\r\n             if n%i == 0:\r\n                return False\r\n          return True\r\n\r\n>>> l1 = [-1, 0, 2, 3, 6, 7, 8]\r\n>>> l2 = list(filter(isPrime, l1))\r\n>>> print(l2)\r\n[2, 3, 7]\r\n```", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/43--Python\u5217\u8868\u8868\u8fbe\u5f0f\u53ca\u9ad8\u9636\u51fd\u6570\u5982lamda_zip_enumerate_map\u548cfilter\u65b9\u6cd5.md", "create_date": "2020-02-17T12:57:05.936", "order": 6}}, {"model": "subject.chapter", "pk": 10, "fields": {"title": "Python\u7cfb\u5217\u4e4b\u88c5\u9970\u5668(decorator)", "topic": 1, "md5": "7c42e96402db36fe8839b46ae020fdfc", "md_body": "## Python\u88c5\u9970\u5668\u7684\u672c\u8d28\r\n\r\nPython\u7684\u88c5\u9970\u5668\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u5d4c\u5957\u51fd\u6570\uff0c\u5b83\u63a5\u53d7\u88ab\u88c5\u9970\u7684\u51fd\u6570(func)\u4f5c\u4e3a\u53c2\u6570\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u5305\u88c5\u8fc7\u7684\u51fd\u6570\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5728\u4e0d\u6539\u53d8\u88ab\u88c5\u9970\u51fd\u6570\u7684\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u7ed9\u88ab\u88c5\u9970\u51fd\u6570\u6216\u7a0b\u5e8f\u6dfb\u52a0\u65b0\u7684\u529f\u80fd\u3002Python\u7684\u88c5\u9970\u5668\u5e7f\u6cdb\u5e94\u7528\u4e8e\u7f13\u5b58\u3001\u6743\u9650\u6821\u9a8c(\u5982django\u4e2d\u7684@login_required\u548c@permission_required\u88c5\u9970\u5668)\u3001\u6027\u80fd\u6d4b\u8bd5(\u6bd4\u5982\u7edf\u8ba1\u4e00\u6bb5\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\u95f4)\u548c\u63d2\u5165\u65e5\u5fd7\u7b49\u5e94\u7528\u573a\u666f\u3002\u6709\u4e86\u88c5\u9970\u5668\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u62bd\u79bb\u51fa\u5927\u91cf\u4e0e\u51fd\u6570\u529f\u80fd\u672c\u8eab\u65e0\u5173\u7684\u4ee3\u7801\uff0c\u589e\u52a0\u4e00\u4e2a\u51fd\u6570\u7684\u91cd\u7528\u6027\u3002\r\n\r\n\r\n\r\n\u8bd5\u60f3\u4f60\u5199\u4e86\u5f88\u591a\u7a0b\u5e8f\uff0c\u4e00\u76f4\u8fd0\u884c\u4e5f\u6ca1\u5565\u95ee\u9898\u3002\u6709\u4e00\u5929\u8001\u677f\u7a81\u7136\u8ba9\u4f60\u7edf\u8ba1\u6bcf\u4e2a\u7a0b\u5e8f\u90fd\u8fd0\u884c\u4e86\u591a\u957f\u65f6\u95f4\u5e76\u6bd4\u8f83\u4e0b\u8fd0\u884c\u6548\u7387\u3002\u6b64\u65f6\u5982\u679c\u4f60\u53bb\u624b\u52a8\u4fee\u6539\u6bcf\u4e2a\u7a0b\u5e8f\u7684\u4ee3\u7801\u4e00\u5b9a\u4f1a\u8ba9\u4f60\u6293\u72c2\uff0c\u800c\u4e14\u8fd8\u7834\u574f\u4e86\u90a3\u4e9b\u7a0b\u5e8f\u7684\u91cd\u7528\u6027\u3002\u806a\u660e\u7684\u7a0b\u5e8f\u5458\u662f\u7edd\u4e0d\u80fd\u5e72\u8fd9\u79cd\u8822\u4e8b\u7684\u3002\u6b64\u65f6\u4f60\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a@time_it\u7684\u88c5\u9970\u5668(\u4ee3\u7801\u5982\u4e0b\u6240\u793a)\u3002\u5982\u679c\u4f60\u60f3\u6253\u5370\u51fa\u67d0\u4e2a\u51fd\u6570\u6216\u7a0b\u5e8f\u8fd0\u884c\u65f6\u95f4\uff0c\u53ea\u9700\u5728\u51fd\u6570\u524d\u9762@\u4e00\u4e0b\uff0c\u662f\u4e0d\u662f\u5f88\u5e05?\r\n\r\n```py\r\nimport time\r\n\r\ndef time_it(func):\r\n    def inner():\r\n        start = time.time()\r\n        func()\r\n        end = time.time()\r\n        print('\u7528\u65f6:{}\u79d2'.format(end-start))\r\n    return inner\r\n\r\n@time_it\r\ndef func1():\r\n    time.sleep(2)\r\n    print(\"Func1 is running.\")\r\n\r\nif __name__ == '__main__':\r\n    func1()\r\n```\r\n\r\n\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b:\r\n\r\n\r\n<font color=red size=2 face='\u5fae\u8f6f\u96c5\u9ed1'>\r\nFunc1 is running.\r\n\r\n\u7528\u65f6:2.0056326389312744\r\n</font>\r\n\r\n\r\n\r\n\u7531\u4e8ePython\u88c5\u9970\u5668\u7684\u5de5\u4f5c\u539f\u7406\u4e3b\u8981\u4f9d\u8d56\u4e8e\u5d4c\u5957\u51fd\u6570\u548c\u95ed\u5305\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u5148\u5bf9\u5d4c\u5957\u51fd\u6570\u548c\u95ed\u5305\u6709\u6df1\u5165\u7684\u4e86\u89e3\u3002\u5d4c\u5957\u51fd\u6570\u548c\u95ed\u5305\u51e0\u4e4e\u662fPython\u5de5\u4f5c\u9762\u8bd5\u5fc5\u8003\u9898\u54e6\u3002\r\n\r\n\r\n\r\n## \u5d4c\u5957\u51fd\u6570\r\n\r\n\u5982\u679c\u5728\u4e00\u4e2a\u51fd\u6570\u7684\u5185\u90e8\u8fd8\u5b9a\u4e49\u4e86\u53e6\u4e00\u4e2a\u51fd\u6570(\u6ce8\u610f: <font color=#0099ff size=3 face=\"\u9ed1\u4f53\">\u662f\u5b9a\u4e49\uff0c\u4e0d\u662f\u5f15\u7528</font>!\uff09\uff0c\u8fd9\u4e2a\u51fd\u6570\u5c31\u53eb\u5d4c\u5957\u51fd\u6570\u3002\u5916\u90e8\u7684\u6211\u4eec\u53eb\u5b83\u5916\u51fd\u6570\uff0c\u5185\u90e8\u7684\u6211\u4eec\u53eb\u4ed6\u5185\u51fd\u6570\u3002\r\n\r\n\r\n\r\n\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u5d4c\u5957\u51fd\u6570\u7684\u4f8b\u5b50\u3002\u6211\u4eec\u5728outer\u51fd\u6570\u91cc\u53c8\u5b9a\u4e49\u4e86\u4e00\u4e2ainner\u51fd\u6570\uff0c\u5e76\u8c03\u7528\u4e86\u5b83\u3002\u4f60\u6ce8\u610f\u5230\u4e86\u5417? ==\u5185\u51fd\u6570\u5728\u81ea\u5df1\u4f5c\u7528\u57df\u5185\u67e5\u627e\u5c40\u90e8\u53d8\u91cf\u5931\u8d25\u540e\uff0c\u4f1a\u8fdb\u4e00\u6b65\u5411\u4e0a\u4e00\u5c42\u4f5c\u7528\u57df\u91cc\u67e5\u627e==\u3002\r\n\r\n```py\r\ndef outer():\r\n    x = 1\r\n    def inner():\r\n        y = x + 1\r\n        print(y)\r\n    inner()\r\n\r\nouter() #\u8f93\u51fa\u7ed3\u679c 2\r\n```\r\n\r\n\u5982\u679c\u6211\u4eec\u5728\u5916\u51fd\u6570\u91cc\u4e0d\u76f4\u63a5\u8c03\u7528\u5185\u51fd\u6570\uff0c\u800c\u662f\u901a\u8fc7return inner\u8fd4\u56de\u4e00\u4e2a\u5185\u51fd\u6570\u7684\u5f15\u7528 \u8fd9\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462? ==\u4f60\u5c06\u4f1a\u5f97\u5230\u4e00\u4e2a\u5185\u51fd\u6570\u5bf9\u8c61\uff0c\u800c\u4e0d\u662f\u8fd0\u884c\u7ed3\u679c==\u3002\r\n\r\n```py\r\ndef outer():\r\n    x = 1\r\n    def inner():\r\n        y = x + 1\r\n        print(y)\r\n    return inner\r\n\r\nouter() # \u8f93\u51fa<function outer.<locals>.inner at 0x039248E8>\r\nf1 = outer()\r\nf1() # \u8f93\u51fa2\r\n```\r\n\r\n\u4e0a\u8ff0\u8fd9\u4e2a\u6848\u4f8b\u6bd4\u8f83\u7b80\u5355\uff0c\u56e0\u4e3aouter\u548cinner\u51fd\u6570\u90fd\u662f\u6ca1\u6709\u53c2\u6570\u7684\u3002\u6211\u4eec\u73b0\u5728\u5bf9\u4e0a\u8ff0\u4ee3\u7801\u505a\u70b9\u6539\u52a8\uff0c\u52a0\u5165\u53c2\u6570\u3002\u4f60\u53ef\u4ee5\u770b\u5230==\u5916\u51fd\u6570\u7684\u53c2\u6570\u6216\u53d8\u91cf\u53ef\u4ee5\u5f88\u5bb9\u6613\u4f20\u9012\u5230\u5185\u51fd\u6570==\u3002\r\n\r\n```py\r\ndef outer(x):\r\n    a = x\r\n\r\n    def inner(y):\r\n        b = y\r\n        print(a+b)\r\n\r\n    return inner\r\n\r\nf1 = outer(1) # \u8fd4\u56deinner\u51fd\u6570\u5bf9\u8c61\r\nf1(10) # \u76f8\u5f53\u4e8einner(10)\u3002\u8f93\u51fa11\r\n```\r\n\r\n\u5982\u679c\u4e0a\u4f8b\u4e2d\u5916\u51fd\u6570\u7684\u53d8\u91cfx\u6362\u6210\u88ab\u88c5\u9970\u51fd\u6570\u5bf9\u8c61(func)\uff0c\u5185\u51fd\u6570\u7684\u53d8\u91cfy\u6362\u6210\u88ab\u88c5\u9970\u51fd\u6570\u7684\u53c2\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u901a\u7528\u7684\u88c5\u9970\u5668\u5566(\u5982\u4e0b\u6240\u793a)\u3002\u4f60\u6ce8\u610f\u5230\u4e86\u5417? \u6211\u4eec\u5728\u6ca1\u5bf9func\u672c\u8eab\u505a\u4efb\u4f55\u4fee\u6539\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u4e86\u5176\u5b83\u529f\u80fd, \u4ece\u800c\u5b9e\u73b0\u4e86\u5bf9\u51fd\u6570\u7684\u88c5\u9970\u3002\r\n\r\n```py\r\ndef decorator(func):\r\n    def inner(*args, **kwargs):\r\n        add_other_actions()\r\n        return func(*args, **kwargs)\r\n    return inner\r\n```\r\n\r\n\u8bf7\u4f60\u4ed4\u7ec6\u518d\u8bfb\u8bfb\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\uff0c\u6211\u4eec\u7684decorator\u8fd4\u56de\u7684\u4ec5\u4ec5\u662finner\u51fd\u6570\u5417? \u7b54\u6848\u662f\u4e0d\u3002\u5b83\u8fd4\u56de\u7684\u5176\u5b9e\u662f\u4e2a\u95ed\u5305(Closure)\u3002\u6574\u4e2a\u88c5\u9970\u5668\u7684\u5de5\u4f5c\u90fd\u4f9d\u8d56\u4e8ePython\u7684\u95ed\u5305\u539f\u7406\u3002\r\n\r\n\r\n\r\n## \u95ed\u5305(Closure)\r\n\r\n\u95ed\u5305\u662fPython\u7f16\u7a0b\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\u3002\u5982\u679c\u4e00\u4e2a\u5916\u51fd\u6570\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5185\u51fd\u6570\uff0c\u4e14\u5185\u51fd\u6570\u4f53\u5185\u5f15\u7528\u5230\u4e86\u4f53\u5916\u7684\u53d8\u91cf\uff0c\u8fd9\u65f6\u5916\u51fd\u6570\u901a\u8fc7return\u8fd4\u56de\u5185\u51fd\u6570\u7684\u5f15\u7528\u65f6\uff0c\u4f1a\u628a\u5b9a\u4e49\u65f6\u6d89\u53ca\u5230\u7684\u5916\u90e8\u5f15\u7528\u53d8\u91cf\u548c\u5185\u51fd\u6570\u6253\u5305\u6210\u4e00\u4e2a\u6574\u4f53\uff08\u95ed\u5305\uff09\u8fd4\u56de\u3002\u6211\u4eec\u5728\u770b\u4e0b\u4e4b\u95f4\u6848\u4f8b\u3002\u6211\u4eec\u7684outer\u65b9\u6cd5\u8fd4\u56de\u7684\u53ea\u662f\u5185\u51fd\u6570\u5bf9\u8c61\u5417? \u9519\u3002==\u6211\u4eec\u7684outer\u51fd\u6570\u8fd4\u56de\u7684\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u7531inner\u51fd\u6570\u548c\u5916\u90e8\u5f15\u7528\u53d8\u91cf(a)\u7ec4\u6210\u7684\u95ed\u5305==!\r\n\r\n```py\r\ndef outer(x):\r\n    a = x\r\n\r\n    def inner(y):\r\n        b = y\r\n        print(a+b)\r\n\r\n    return inner\r\n\r\n\r\nf1 = outer(1) # \u8fd4\u56deinner\u51fd\u6570\u5bf9\u8c61+\u5c40\u90e8\u53d8\u91cf1(\u95ed\u5305)\r\nf1(10) # \u76f8\u5f53\u4e8einner(10)\u3002\u8f93\u51fa11\r\n```\r\n\r\n\r\n\r\n\u4e00\u822c\u4e00\u4e2a\u51fd\u6570\u8fd0\u884c\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u4e34\u65f6\u53d8\u91cf\u4f1a\u88ab\u9500\u6bc1\u3002\u4f46\u662f\u95ed\u5305\u662f\u4e00\u4e2a\u7279\u522b\u7684\u60c5\u51b5\u3002\u5f53\u5916\u51fd\u6570\u53d1\u73b0\uff0c\u81ea\u5df1\u7684\u4e34\u65f6\u53d8\u91cf\u4f1a\u5728\u5c06\u6765\u7684\u5185\u51fd\u6570\u4e2d\u7528\u5230\uff0c\u81ea\u5df1\u5728\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u5185\u51fd\u6570\u7684\u540c\u65f6\uff0c\u4f1a\u628a\u5916\u51fd\u6570\u7684\u4e34\u65f6\u53d8\u91cf\u540c\u5185\u51fd\u6570\u7ed1\u5b9a\u5728\u4e00\u8d77\u3002\u8fd9\u6837\u5373\u4f7f\u5916\u51fd\u6570\u5df2\u7ecf\u7ed3\u675f\u4e86\uff0c\u5185\u51fd\u6570\u4ecd\u7136\u80fd\u591f\u4f7f\u7528\u5916\u51fd\u6570\u7684\u4e34\u65f6\u53d8\u91cf\u3002\u8fd9\u5c31\u662f\u95ed\u5305\u7684\u5f3a\u5927\u4e4b\u5904\u3002\r\n\r\n\r\n\r\n## \u5982\u4f55\u7f16\u5199\u4e00\u4e2a\u901a\u7528\u7684\u88c5\u9970\u5668\r\n\r\n\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u5f00\u59cb\u52a8\u624b\u5199\u4e2a\u540d\u4e3a==hint==\u7684\u88c5\u9970\u5668\u4e86\uff0c\u5176\u4f5c\u7528\u662f\u5728\u67d0\u4e2a\u51fd\u6570\u8fd0\u884c\u524d\u7ed9\u6211\u4eec\u63d0\u793a\u3002\u8fd9\u91cc\u5916\u51fd\u6570\u4ee5==hint==\u547d\u540d\uff0c\u5185\u51fd\u6570\u4ee5\u5e38\u7528\u7684==wrapper==(\u5305\u88f9\u51fd\u6570)\u547d\u540d\u3002\r\n\r\n```py\r\ndef hint(func):\r\n    def wrapper(*args, **kwargs):\r\n        print('{} is running'.format(func.__name__))\r\n        return func(*args, **kwargs)\r\n    return wrapper\r\n\r\n@hint\r\ndef hello():\r\n    print(\"Hello!\")\r\n```\r\n\r\n\u6211\u4eec\u73b0\u5728\u5bf9hello\u5df2\u7ecf\u8fdb\u884c\u4e86\u88c5\u9970\uff0c\u5f53\u6211\u4eec\u8c03\u7528hello()\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7ed3\u679c\u3002\r\n\r\n```\r\n>>> hello()\r\nhello is running.\r\nHello!\r\n```\r\n\r\n==\u503c\u5f97\u4e00\u63d0\u7684\u662f\u88ab\u88c5\u9970\u5668\u88c5\u9970\u8fc7\u7684\u51fd\u6570\u770b\u4e0a\u53bb\u540d\u5b57\u6ca1\u53d8\uff0c\u5176\u5b9e\u5df2\u7ecf\u53d8\u4e86==\u3002\u5f53\u4f60\u8fd0\u884chello()\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u7684\u540d\u5b57\u5df2\u7ecf\u6084\u6084\u53d8\u6210\u4e86<font color=#0099ff size=4 face=\"\u9ed1\u4f53\">wrapper</font>\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684(\u5982\u4e0b\u56fe\u6240\u793a)\u3002\u8fd9\u4e00\u70b9\u4e5f\u4e0d\u5947\u602a\uff0c\u56e0\u4e3a\u5916\u51fd\u6570\u8fd4\u56de\u7684\u662f\u7531wrapper\u51fd\u6570\u548c\u5176\u5916\u90e8\u5f15\u7528\u53d8\u91cf\u7ec4\u6210\u7684\u95ed\u5305\u3002\r\n\r\n```\r\n>>> hello.__name__\r\n'wrapper'\r\n```\r\n\r\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4fdd\u8bc1\u88c5\u9970\u8fc7\u7684\u51fd\u6570==__name__==\u5c5e\u6027\u4e0d\u53d8\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528==functools==\u6a21\u5757\u91cc\u7684==wraps==\u65b9\u6cd5\uff0c\u5148\u5bf9func\u53d8\u91cf\u8fdb\u884cwraps\u3002\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u53ef\u4ee5\u4f5c\u4e3a\u7f16\u5199\u4e00\u4e2a\u901a\u7528\u88c5\u9970\u5668\u7684\u793a\u8303\u4ee3\u7801\uff0c\u6ce8\u610f\u6536\u85cf\u54e6\u3002\r\n\r\n```py\r\nfrom functools import wraps\r\n\r\ndef hint(func):\r\n    @wraps(func)\r\n    def wrapper(*args, **kwargs):\r\n        print('{} is running'.format(func.__name__))\r\n        return func(*args, **kwargs)\r\n    return wrapper\r\n\r\n\r\n@hint\r\ndef hello():\r\n    print(\"Hello!\")\r\n```\r\n\r\n\u606d\u559c\u4f60\uff0c\u4f60\u5df2\u7ecf\u5b66\u4f1a\u5199\u4e00\u4e2a\u6bd4\u8f83\u901a\u7528\u7684\u88c5\u9970\u5668\u5566\uff0c\u5e76\u4fdd\u8bc1\u88c5\u9970\u8fc7\u7684\u51fd\u6570__name__\u5c5e\u6027\u4e0d\u53d8\u5566\u3002\u5f53\u7136\u4f7f\u7528\u5d4c\u5957\u51fd\u6570\u4e5f\u6709\u7f3a\u70b9\uff0c\u6bd4\u5982\u4e0d\u76f4\u89c2\u3002\u8fd9\u65f6\u4f60\u53ef\u4ee5\u501f\u52a9Python\u7684decorator\u6a21\u5757(\u9700\u4e8b\u5148\u5b89\u88c5)\u53ef\u4ee5\u7b80\u5316\u88c5\u9970\u5668\u7684\u7f16\u5199\u548c\u4f7f\u7528\u3002\u5982\u4e0b\u6240\u793a\u3002\r\n\r\n```py\r\nfrom decorator import decorator\r\n\r\n@decorator\r\ndef hint(func, *args, **kwargs):\r\n    print('{} is running'.format(func.__name__))\r\n    return func(*args, **kwargs)\r\n```\r\n\r\n\r\n\r\n## \u7f16\u5199\u5e26\u53c2\u6570\u7684\u9ad8\u7ea7\u88c5\u9970\u5668\r\n\r\n\u524d\u9762\u51e0\u4e2a\u88c5\u9970\u5668\u4e00\u822c\u662f\u5185\u5916\u4e24\u5c42\u5d4c\u5957\u51fd\u6570\u3002==\u5982\u679c\u6211\u4eec\u9700\u8981\u7f16\u5199\u7684\u88c5\u9970\u5668\u672c\u8eab\u662f\u5e26\u53c2\u6570\u7684\uff0c\u6211\u4eec\u9700\u8981\u7f16\u5199\u4e09\u5c42\u7684\u5d4c\u5957\u51fd\u6570\uff0c\u5176\u4e2d\u6700\u5916\u4e00\u5c42\u7528\u6765\u4f20\u9012\u88c5\u9970\u5668\u7684\u53c2\u6570==\u3002\u73b0\u5728\u6211\u4eec\u8981\u5bf9@hint\u88c5\u9970\u5668\u505a\u70b9\u6539\u8fdb\uff0c\u4f7f\u5176\u80fd\u901a\u8fc7@hint(coder=\"John\")\u4f20\u9012\u53c2\u6570\u3002\u8be5\u88c5\u9970\u5668\u5728\u51fd\u6570\u8fd0\u884c\u524d\u7ed9\u51fa\u63d0\u793a\u7684\u65f6\u5019\u8fd8\u663e\u793a\u51fd\u6570\u7f16\u5199\u4eba\u5458\u7684\u540d\u5b57\u3002\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\u6240\u793a:\r\n\r\n```py\r\nfrom functools import wraps\r\n\r\n\r\ndef hint(coder):\r\n    def wrapper(func):\r\n        @wraps(func)\r\n        def inner_wrapper(*args, **kwargs):\r\n            print('{} is running'.format(func.__name__))\r\n            print('Coder: {}'.format(coder))\r\n            return func(*args, **kwargs)\r\n        return inner_wrapper\r\n    return wrapper\r\n\r\n\r\n@hint(coder=\"John\")\r\ndef hello():\r\n    print(\"Hello!\")\r\n```\r\n\r\n\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u662f\u4e00\u6bb5\u7ecf\u5178\u7684Python\u88c5\u9970\u5668\u4ee3\u7801\uff0c\u663e\u793a\u4e86@==cache==\u8fd9\u4e2a\u88c5\u9970\u5668\u600e\u4e48\u7f16\u5199\u548c\u5de5\u4f5c\u7684\u3002\u5b83\u9700\u8981\u4f7f\u7528\u7f13\u5b58\u5b9e\u4f8b\u505a\u4e3a\u4e00\u4e2a\u53c2\u6570\uff0c\u6240\u4ee5\u4e5f\u662f\u4e09\u5c42\u5d4c\u5957\u51fd\u6570\u3002\r\n\r\n```py\r\nimport time\r\nfrom functools import wraps\r\n\r\n\r\n# \u88c5\u9970\u5668\u589e\u52a0\u7f13\u5b58\u529f\u80fd\r\ndef cache(instance):\r\n    def wrapper(func):\r\n        @wraps(func)\r\n        def inner_wrapper(*args, **kwargs):\r\n            # \u6784\u5efakey: key => func_name::args::kwargs\r\n            joint_args = ','.join((str(x) for x in args))\r\n            joint_kwargs = ','.join('{}={}'.format(k, v) for k, v in sorted(kwargs.items()))\r\n            key = '{}::{}::{}'.format(func.__name__,joint_args, joint_kwargs)\r\n            # \u6839\u636ekey\u83b7\u53d6\u7ed3\u679c\u3002\u5982\u679ckey\u5df2\u5b58\u5728\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\uff0c\u4e0d\u7528\u91cd\u590d\u8ba1\u7b97\u3002\r\n         result = instance.get(key)\r\n            if result is not None:\r\n                return result\r\n            # \u5982\u679c\u7ed3\u679c\u4e0d\u5b58\u5728\uff0c\u91cd\u65b0\u8ba1\u7b97\uff0c\u7f13\u5b58\u3002\r\n         result = func(*args, **kwargs)\r\n            instance.set(key, result)\r\n            return result\r\n        return inner_wrapper\r\n    return wrapper\r\n\r\n\r\n# \u521b\u5efa\u5b57\u5178\u6784\u9020\u51fd\u6570\uff0c\u7528\u6237\u7f13\u5b58K/V\u952e\u503c\u5bf9\r\nclass DictCache:\r\n    def __init__(self):\r\n        self.cache = dict()\r\n\r\n    def get(self, key):\r\n        return self.cache.get(key)\r\n\r\n    def set(self, key, value):\r\n        self.cache[key] = value\r\n\r\n    def __str__(self):\r\n        return str(self.cache)\r\n\r\n    def __repr__(self):\r\n        return repr(self.cache)\r\n\r\n\r\n# \u521b\u5efa\u7f13\u5b58\u5bf9\u8c61\r\ncache_instance = DictCache()\r\n\r\n\r\n# Python\u8bed\u6cd5\u7cd6\u8c03\u7528\u88c5\u9970\u5668\r\n@cache(cache_instance)\r\ndef long_time_func(x):\r\n    time.sleep(x)\r\n    return x\r\n\r\n# \u8c03\u7528\u88c5\u9970\u8fc7\u51fd\u6570\r\nlong_time_func(3)\r\n```\r\n\r\n\r\n\r\n## \u57fa\u4e8e\u7c7b\u5b9e\u73b0\u7684\u88c5\u9970\u5668\r\n\r\nPython\u7684\u88c5\u9970\u5668\u4e0d\u4ec5\u53ef\u4ee5\u7528\u5d4c\u5957\u51fd\u6570\u6765\u7f16\u5199\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u7c7b\u6765\u7f16\u5199\u3002\u5176\u8c03\u7528__init__\u65b9\u6cd5\u521b\u5efa\u5b9e\u4f8b\uff0c\u4f20\u9012\u53c2\u6570\uff0c\u5e76\u8c03\u7528__call__\u65b9\u6cd5\u5b9e\u73b0\u5bf9\u88ab\u88c5\u9970\u51fd\u6570\u529f\u80fd\u7684\u6dfb\u52a0\u3002\r\n\r\n```py\r\nfrom functools import wraps\r\n\r\n\r\n#\u7c7b\u7684\u88c5\u9970\u5668\u5199\u6cd5\uff0c \u4e0d\u5e26\u53c2\u6570\r\nclass Hint(object):\r\n    def __init__(self, func):\r\n        self.func = func\r\n\r\n    def __call__(self, *args, **kwargs):\r\n        print('{} is running'.format(self.func.__name__))\r\n        return self.func(*args, **kwargs)\r\n\r\n\r\n#\u7c7b\u7684\u88c5\u9970\u5668\u5199\u6cd5\uff0c \u5e26\u53c2\u6570\r\nclass Hint(object):\r\n    def __init__(self, coder=None):\r\n        self.coder = coder\r\n\r\n    def __call__(self, func):\r\n        @wraps(func)\r\n        def wrapper(*args, **kwargs):\r\n            print('{} is running'.format(func.__name__))\r\n            print('Coder: {}'.format(self.coder))\r\n            return func(*args, **kwargs)     # \u6b63\u5f0f\u8c03\u7528\u4e3b\u8981\u5904\u7406\u51fd\u6570\r\n        return wrapper\r\n```", "md_File": "subject/\u8fdb\u9636\u4e4b\u8def1.0/45--Python\u7cfb\u5217\u4e4b\u88c5\u9970\u5668decorator.md", "create_date": "2020-02-17T12:57:05.955", "order": 7}}, {"model": "subject.chapter", "pk": 11, "fields": {"title": "1\u57fa\u7840\uff1a\u4e07\u4e08\u9ad8\u697c\u5e73\u5730\u8d77 \u2014\u2014 Redis \u57fa\u7840\u6570\u636e\u7ed3\u6784", "topic": 2, "md5": "9db1cc90108ebf381b2427071f4cb177", "md_body": "# \u57fa\u7840\uff1a\u4e07\u4e08\u9ad8\u697c\u5e73\u5730\u8d77 \u2014\u2014 Redis \u57fa\u7840\u6570\u636e\u7ed3\u6784\n\n\u5343\u91cc\u4e4b\u884c\uff0c\u59cb\u4e8e\u8db3\u4e0b\u3002\u672c\u8282\u6211\u4eec\u7684\u5b66\u4e60\u76ee\u6807\u662f\uff1a\u5feb\u901f\u7406\u89e3\u5e76\u638c\u63e1 Redis \u7684\u57fa\u7840\u77e5\u8bc6\u3002\n\n\u7531\u4e8e\u672c\u8282\u5185\u5bb9\u662f Redis \u6700\u7b80\u5355\u6700\u5bb9\u6613\u638c\u63e1\u7684\u77e5\u8bc6\uff0c\u5982\u679c\u8bfb\u8005\u5df2\u7ecf\u5f88\u719f\u6089 Redis \u7684\u57fa\u7840\u6570\u636e\u7ed3\u6784\uff0c\u4ece\u73cd\u60dc\u751f\u547d\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u4f60\u53ef\u4ee5\u7565\u8fc7\u672c\u8282\u5185\u5bb9\uff0c\u8df3\u5230\u4e0b\u4e00\u8282\u7ee7\u7eed\u9605\u8bfb\u3002\u5982\u679c\u4f60\u89c9\u5f97\u672c\u8282\u7684\u52a8\u753b\u6709\u70b9\u6643\u773c\uff0c\u9605\u8bfb\u8d77\u6765\u4e0d\u90a3\u4e48\u8212\u670d\uff0c\u53ef\u4ee5\u770b\u770b\u4f5c\u8005\u7684\u53e6\u4e00\u7bc7\u6587\u7ae0[\u300aRedis \u6570\u636e\u7ed3\u6784\u57fa\u7840\u6559\u7a0b\u300b](https://juejin.im/post/5b53ee7e5188251aaa2d2e16)\u3002\n\n\u8981\u4f53\u9a8c Redis\uff0c\u6211\u4eec\u5148\u4ece Redis \u5b89\u88c5\u8bf4\u8d77\u3002\n\n## Redis \u5b89\u88c5\n\u4f53\u9a8c Redis \u9700\u8981\u4f7f\u7528 Linux \u6216\u8005 Mac \u73af\u5883\uff0c\u5982\u679c\u662f Windows \u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u865a\u62df\u673a\u3002\u4e3b\u8981\u65b9\u5f0f\u6709\u56db\u79cd\uff1a\n1. \u4f7f\u7528 Docker \u5b89\u88c5\u3002\n2. \u901a\u8fc7 Github \u6e90\u7801\u7f16\u8bd1\u3002\n3. \u76f4\u63a5\u5b89\u88c5 apt-get install(Ubuntu)\u3001yum install(RedHat) \u6216\u8005 brew install(Mac)\u3002\n4. \u5982\u679c\u8bfb\u8005\u61d2\u4e8e\u5b89\u88c5\u64cd\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7f51\u9875\u7248\u7684 [Web Redis](https://try.redis.io/) \u76f4\u63a5\u4f53\u9a8c\u3002\n\n\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a\n\n**Docker \u65b9\u5f0f**\n```\n# \u62c9\u53d6 redis \u955c\u50cf\n> docker pull redis\n# \u8fd0\u884c redis \u5bb9\u5668\n> docker run --name myredis -d -p6379:6379 redis\n# \u6267\u884c\u5bb9\u5668\u4e2d\u7684 redis-cli\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u547d\u4ee4\u884c\u64cd\u4f5c redis\n> docker exec -it myredis redis-cli\n```\n\n**Github \u6e90\u7801\u7f16\u8bd1\u65b9\u5f0f**\n```\n# \u4e0b\u8f7d\u6e90\u7801\n> git clone --branch 2.8 --depth 1 git@github.com:antirez/redis.git\n> cd redis\n# \u7f16\u8bd1\n> make\n> cd src\n# \u8fd0\u884c\u670d\u52a1\u5668\uff0cdaemonize\u8868\u793a\u5728\u540e\u53f0\u8fd0\u884c\n> ./redis-server --daemonize yes\n# \u8fd0\u884c\u547d\u4ee4\u884c\n> ./redis-cli\n```\n\n**\u76f4\u63a5\u5b89\u88c5\u65b9\u5f0f**\n```\n# mac\n> brew install redis\n# ubuntu\n> apt-get install redis\n# redhat\n> yum install redis\n# \u8fd0\u884c\u5ba2\u6237\u7aef\n> redis-cli\n```\n\n## Redis \u57fa\u7840\u6570\u636e\u7ed3\u6784\nRedis \u6709 5 \u79cd\u57fa\u7840\u6570\u636e\u7ed3\u6784\uff0c\u5206\u522b\u4e3a\uff1astring (\u5b57\u7b26\u4e32)\u3001list (\u5217\u8868)\u3001set (\u96c6\u5408)\u3001hash (\u54c8\u5e0c) \u548c zset (\u6709\u5e8f\u96c6\u5408)\u3002\u719f\u7ec3\u638c\u63e1\u8fd9 5 \u79cd\u57fa\u672c\u6570\u636e\u7ed3\u6784\u7684\u4f7f\u7528\u662f Redis \u77e5\u8bc6\u6700\u57fa\u7840\u4e5f\u6700\u91cd\u8981\u7684\u90e8\u5206\uff0c\u5b83\u4e5f\u662f\u5728 Redis \u9762\u8bd5\u9898\u4e2d\u95ee\u5230\u6700\u591a\u7684\u5185\u5bb9\u3002\n\n\u672c\u8282\u5c06\u5e26\u9886 Redis \u521d\u5b66\u8005\u5feb\u901f\u901a\u5173\u8fd9 5 \u79cd\u57fa\u672c\u6570\u636e\u7ed3\u6784\u3002\u8003\u8651\u5230 Redis \u7684\u547d\u4ee4\u975e\u5e38\u591a\uff0c\u8fd9\u91cc\u53ea\u9009\u53d6\u90a3\u4e9b\u6700\u5e38\u89c1\u7684\u6307\u4ee4\u8fdb\u884c\u8bb2\u89e3\uff0c\u5982\u679c\u6709\u9057\u6f0f\u5e38\u89c1\u6307\u4ee4\uff0c\u8bfb\u8005\u53ef\u4ee5\u5728\u8bc4\u8bba\u53bb\u7559\u8a00\u3002\n\n\n## string (\u5b57\u7b26\u4e32)\n\n\u5b57\u7b26\u4e32 string \u662f Redis \u6700\u7b80\u5355\u7684\u6570\u636e\u7ed3\u6784\u3002Redis \u6240\u6709\u7684\u6570\u636e\u7ed3\u6784\u90fd\u662f\u4ee5\u552f\u4e00\u7684 key \u5b57\u7b26\u4e32\u4f5c\u4e3a\u540d\u79f0\uff0c\u7136\u540e\u901a\u8fc7\u8fd9\u4e2a\u552f\u4e00 key \u503c\u6765\u83b7\u53d6\u76f8\u5e94\u7684 value \u6570\u636e\u3002\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u7ed3\u6784\u7684\u5dee\u5f02\u5c31\u5728\u4e8e value \u7684\u7ed3\u6784\u4e0d\u4e00\u6837\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/16458d666d851a12?w=400&h=90&f=gif&s=8003)\n\n\u5b57\u7b26\u4e32\u7ed3\u6784\u4f7f\u7528\u975e\u5e38\u5e7f\u6cdb\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u9014\u5c31\u662f\u7f13\u5b58\u7528\u6237\u4fe1\u606f\u3002\u6211\u4eec\u5c06\u7528\u6237\u4fe1\u606f\u7ed3\u6784\u4f53\u4f7f\u7528 JSON \u5e8f\u5217\u5316\u6210\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5c06\u5e8f\u5217\u5316\u540e\u7684\u5b57\u7b26\u4e32\u585e\u8fdb Redis \u6765\u7f13\u5b58\u3002\u540c\u6837\uff0c\u53d6\u7528\u6237\u4fe1\u606f\u4f1a\u7ecf\u8fc7\u4e00\u6b21\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/24/164caaff402d2617?w=572&h=169&f=png&s=8854)\n\nRedis \u7684\u5b57\u7b26\u4e32\u662f\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u662f\u53ef\u4ee5\u4fee\u6539\u7684\u5b57\u7b26\u4e32\uff0c\u5185\u90e8\u7ed3\u6784\u5b9e\u73b0\u4e0a\u7c7b\u4f3c\u4e8e Java \u7684 ArrayList\uff0c\u91c7\u7528\u9884\u5206\u914d\u5197\u4f59\u7a7a\u95f4\u7684\u65b9\u5f0f\u6765\u51cf\u5c11\u5185\u5b58\u7684\u9891\u7e41\u5206\u914d\uff0c\u5982\u56fe\u4e2d\u6240\u793a\uff0c\u5185\u90e8\u4e3a\u5f53\u524d\u5b57\u7b26\u4e32\u5b9e\u9645\u5206\u914d\u7684\u7a7a\u95f4 capacity \u4e00\u822c\u8981\u9ad8\u4e8e\u5b9e\u9645\u5b57\u7b26\u4e32\u957f\u5ea6 len\u3002\u5f53\u5b57\u7b26\u4e32\u957f\u5ea6\u5c0f\u4e8e 1M \u65f6\uff0c\u6269\u5bb9\u90fd\u662f\u52a0\u500d\u73b0\u6709\u7684\u7a7a\u95f4\uff0c\u5982\u679c\u8d85\u8fc7  1M\uff0c\u6269\u5bb9\u65f6\u4e00\u6b21\u53ea\u4f1a\u591a\u6269 1M \u7684\u7a7a\u95f4\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u5b57\u7b26\u4e32\u6700\u5927\u957f\u5ea6\u4e3a 512M\u3002\n\n**\u952e\u503c\u5bf9**\n```\n> set name codehole\nOK\n> get name\n\"codehole\"\n> exists name\n(integer) 1\n> del name\n(integer) 1\n> get name\n(nil)\n```\n\n**\u6279\u91cf\u952e\u503c\u5bf9**\n\n\u53ef\u4ee5\u6279\u91cf\u5bf9\u591a\u4e2a\u5b57\u7b26\u4e32\u8fdb\u884c\u8bfb\u5199\uff0c\u8282\u7701\u7f51\u7edc\u8017\u65f6\u5f00\u9500\u3002\n```\n> set name1 codehole\nOK\n> set name2 holycoder\nOK\n> mget name1 name2 name3 # \u8fd4\u56de\u4e00\u4e2a\u5217\u8868\n1) \"codehole\"\n2) \"holycoder\"\n3) (nil)\n> mset name1 boy name2 girl name3 unknown\n> mget name1 name2 name3\n1) \"boy\"\n2) \"girl\"\n3) \"unknown\"\n```\n\n**\u8fc7\u671f\u548c set \u547d\u4ee4\u6269\u5c55** \n\n\u53ef\u4ee5\u5bf9 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5230\u70b9\u81ea\u52a8\u5220\u9664\uff0c\u8fd9\u4e2a\u529f\u80fd\u5e38\u7528\u6765\u63a7\u5236\u7f13\u5b58\u7684\u5931\u6548\u65f6\u95f4\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u300c\u81ea\u52a8\u5220\u9664\u300d\u7684\u673a\u5236\u662f\u6bd4\u8f83\u590d\u6742\u7684\uff0c\u5982\u679c\u4f60\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u7ee7\u7eed\u6df1\u5165\u9605\u8bfb\u7b2c 26 \u8282[\u300a\u671d\u751f\u66ae\u6b7b\u2014\u2014\u8fc7\u671f\u7b56\u7565\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b4c42405188251b3950d251)\n```\n> set name codehole\n> get name\n\"codehole\"\n> expire name 5  # 5s \u540e\u8fc7\u671f\n...  # wait for 5s\n> get name\n(nil)\n\n> setex name 5 codehole  # 5s \u540e\u8fc7\u671f\uff0c\u7b49\u4ef7\u4e8e set+expire\n> get name\n\"codehole\"\n... # wait for 5s\n> get name\n(nil)\n\n> setnx name codehole  # \u5982\u679c name \u4e0d\u5b58\u5728\u5c31\u6267\u884c set \u521b\u5efa\n(integer) 1\n> get name\n\"codehole\"\n> setnx name holycoder\n(integer) 0  # \u56e0\u4e3a name \u5df2\u7ecf\u5b58\u5728\uff0c\u6240\u4ee5 set \u521b\u5efa\u4e0d\u6210\u529f\n> get name\n\"codehole\"  # \u6ca1\u6709\u6539\u53d8\n```\n\n**\u8ba1\u6570** \n\n\u5982\u679c value \u503c\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c\u81ea\u589e\u64cd\u4f5c\u3002\u81ea\u589e\u662f\u6709\u8303\u56f4\u7684\uff0c\u5b83\u7684\u8303\u56f4\u662f signed long \u7684\u6700\u5927\u6700\u5c0f\u503c\uff0c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u503c\uff0cRedis \u4f1a\u62a5\u9519\u3002\n\n```\n> set age 30\nOK\n> incr age\n(integer) 31\n> incrby age 5\n(integer) 36\n> incrby age -5\n(integer) 31\n> set codehole 9223372036854775807  # Long.Max\nOK\n> incr codehole\n(error) ERR increment or decrement would overflow\n```\n\n\u5b57\u7b26\u4e32\u662f\u7531\u591a\u4e2a\u5b57\u8282\u7ec4\u6210\uff0c\u6bcf\u4e2a\u5b57\u8282\u53c8\u662f\u7531 8 \u4e2a bit \u7ec4\u6210\uff0c\u5982\u6b64\u4fbf\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u770b\u6210\u5f88\u591a bit \u7684\u7ec4\u5408\uff0c\u8fd9\u4fbf\u662f bitmap\u300c\u4f4d\u56fe\u300d\u6570\u636e\u7ed3\u6784\uff0c\u4f4d\u56fe\u7684\u5177\u4f53\u4f7f\u7528\u4f1a\u653e\u5230\u540e\u9762\u7684\u7ae0\u8282\u6765\u8bb2\u3002\n\n\u5173\u4e8e\u5b57\u7b26\u4e32\u7684\u5185\u90e8\u7ed3\u6784\u5b9e\u73b0\uff0c\u8bf7\u9605\u8bfb\u7b2c 32 \u8282[\u300a\u6781\u5ea6\u6df1\u5bd2 \u2014\u2014 \u63a2\u7d22\u300c\u5b57\u7b26\u4e32\u300d\u5185\u90e8\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b5af9d96fb9a04f83465ada)\n\n## list (\u5217\u8868)\n\nRedis \u7684\u5217\u8868\u76f8\u5f53\u4e8e Java \u8bed\u8a00\u91cc\u9762\u7684 LinkedList\uff0c\u6ce8\u610f\u5b83\u662f\u94fe\u8868\u800c\u4e0d\u662f\u6570\u7ec4\u3002\u8fd9\u610f\u5473\u7740 list \u7684\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u975e\u5e38\u5feb\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff0c\u4f46\u662f\u7d22\u5f15\u5b9a\u4f4d\u5f88\u6162\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n)\uff0c\u8fd9\u70b9\u8ba9\u4eba\u975e\u5e38\u610f\u5916\u3002\n\n\u5f53\u5217\u8868\u5f39\u51fa\u4e86\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e4b\u540e\uff0c\u8be5\u6570\u636e\u7ed3\u6784\u81ea\u52a8\u88ab\u5220\u9664\uff0c\u5185\u5b58\u88ab\u56de\u6536\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/1645918c2cdf772e?w=484&h=120&f=gif&s=122736)\n\nRedis \u7684\u5217\u8868\u7ed3\u6784\u5e38\u7528\u6765\u505a\u5f02\u6b65\u961f\u5217\u4f7f\u7528\u3002\u5c06\u9700\u8981\u5ef6\u540e\u5904\u7406\u7684\u4efb\u52a1\u7ed3\u6784\u4f53\u5e8f\u5217\u5316\u6210\u5b57\u7b26\u4e32\u585e\u8fdb Redis \u7684\u5217\u8868\uff0c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4ece\u8fd9\u4e2a\u5217\u8868\u4e2d\u8f6e\u8be2\u6570\u636e\u8fdb\u884c\u5904\u7406\u3002\n\n**\u53f3\u8fb9\u8fdb\u5de6\u8fb9\u51fa\uff1a\u961f\u5217**\n```\n> rpush books python java golang\n(integer) 3\n> llen books\n(integer) 3\n> lpop books\n\"python\"\n> lpop books\n\"java\"\n> lpop books\n\"golang\"\n> lpop books\n(nil)\n```\n\n**\u53f3\u8fb9\u8fdb\u53f3\u8fb9\u51fa\uff1a\u6808**\n```\n> rpush books python java golang\n(integer) 3\n> rpop books\n\"golang\"\n> rpop books\n\"java\"\n> rpop books\n\"python\"\n> rpop books\n(nil)\n```\n\n**\u6162\u64cd\u4f5c**\n\nlindex \u76f8\u5f53\u4e8e Java \u94fe\u8868\u7684```get(int index)```\u65b9\u6cd5\uff0c\u5b83\u9700\u8981\u5bf9\u94fe\u8868\u8fdb\u884c\u904d\u5386\uff0c\u6027\u80fd\u968f\u7740\u53c2\u6570```index```\u589e\u5927\u800c\u53d8\u5dee\u3002\n\nltrim \u548c\u5b57\u9762\u4e0a\u7684\u542b\u4e49\u4e0d\u592a\u4e00\u6837\uff0c\u4e2a\u4eba\u89c9\u5f97\u5b83\u53eb lretain(\u4fdd\u7559) \u66f4\u5408\u9002\u4e00\u4e9b\uff0c\u56e0\u4e3a ltrim \u8ddf\u7684\u4e24\u4e2a\u53c2\u6570```start_index```\u548c```end_index```\u5b9a\u4e49\u4e86\u4e00\u4e2a\u533a\u95f4\uff0c\u5728\u8fd9\u4e2a\u533a\u95f4\u5185\u7684\u503c\uff0cltrim \u8981\u4fdd\u7559\uff0c\u533a\u95f4\u4e4b\u5916\u7edf\u7edf\u780d\u6389\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7ltrim\u6765\u5b9e\u73b0\u4e00\u4e2a\u5b9a\u957f\u7684\u94fe\u8868\uff0c\u8fd9\u4e00\u70b9\u975e\u5e38\u6709\u7528\u3002\n\nindex \u53ef\u4ee5\u4e3a\u8d1f\u6570\uff0c```index=-1```\u8868\u793a\u5012\u6570\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u540c\u6837```index=-2```\u8868\u793a\u5012\u6570\u7b2c\u4e8c\u4e2a\u5143\u7d20\u3002\n\n```\n> rpush books python java golang\n(integer) 3\n> lindex books 1  # O(n) \u614e\u7528\n\"java\"\n> lrange books 0 -1  # \u83b7\u53d6\u6240\u6709\u5143\u7d20\uff0cO(n) \u614e\u7528\n1) \"python\"\n2) \"java\"\n3) \"golang\"\n> ltrim books 1 -1 # O(n) \u614e\u7528\nOK\n> lrange books 0 -1\n1) \"java\"\n2) \"golang\"\n> ltrim books 1 0 # \u8fd9\u5176\u5b9e\u662f\u6e05\u7a7a\u4e86\u6574\u4e2a\u5217\u8868\uff0c\u56e0\u4e3a\u533a\u95f4\u8303\u56f4\u957f\u5ea6\u4e3a\u8d1f\nOK\n> llen books\n(integer) 0\n```\n**\u5feb\u901f\u5217\u8868**\n\n![](https://user-gold-cdn.xitu.io/2018/7/27/164d975cac9559c5?w=1568&h=148&f=png&s=17643)\n\n\u5982\u679c\u518d\u6df1\u5165\u4e00\u70b9\uff0c\u4f60\u4f1a\u53d1\u73b0 Redis \u5e95\u5c42\u5b58\u50a8\u7684\u8fd8\u4e0d\u662f\u4e00\u4e2a\u7b80\u5355\u7684 `linkedlist`\uff0c\u800c\u662f\u79f0\u4e4b\u4e3a\u5feb\u901f\u94fe\u8868 `quicklist` \u7684\u4e00\u4e2a\u7ed3\u6784\u3002\n\n\u9996\u5148\u5728\u5217\u8868\u5143\u7d20\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\u4f1a\u4f7f\u7528\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u5b58\u50a8\uff0c\u8fd9\u4e2a\u7ed3\u6784\u662f `ziplist`\uff0c\u4e5f\u5373\u662f\u538b\u7f29\u5217\u8868\u3002\u5b83\u5c06\u6240\u6709\u7684\u5143\u7d20\u7d27\u6328\u7740\u4e00\u8d77\u5b58\u50a8\uff0c\u5206\u914d\u7684\u662f\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u3002\u5f53\u6570\u636e\u91cf\u6bd4\u8f83\u591a\u7684\u65f6\u5019\u624d\u4f1a\u6539\u6210 `quicklist`\u3002\u56e0\u4e3a\u666e\u901a\u7684\u94fe\u8868\u9700\u8981\u7684\u9644\u52a0\u6307\u9488\u7a7a\u95f4\u592a\u5927\uff0c\u4f1a\u6bd4\u8f83\u6d6a\u8d39\u7a7a\u95f4\uff0c\u800c\u4e14\u4f1a\u52a0\u91cd\u5185\u5b58\u7684\u788e\u7247\u5316\u3002\u6bd4\u5982\u8fd9\u4e2a\u5217\u8868\u91cc\u5b58\u7684\u53ea\u662f `int` \u7c7b\u578b\u7684\u6570\u636e\uff0c\u7ed3\u6784\u4e0a\u8fd8\u9700\u8981\u4e24\u4e2a\u989d\u5916\u7684\u6307\u9488 `prev` \u548c `next` \u3002\u6240\u4ee5 Redis \u5c06\u94fe\u8868\u548c `ziplist` \u7ed3\u5408\u8d77\u6765\u7ec4\u6210\u4e86 `quicklist`\u3002\u4e5f\u5c31\u662f\u5c06\u591a\u4e2a `ziplist` \u4f7f\u7528\u53cc\u5411\u6307\u9488\u4e32\u8d77\u6765\u4f7f\u7528\u3002\u8fd9\u6837\u65e2\u6ee1\u8db3\u4e86\u5feb\u901f\u7684\u63d2\u5165\u5220\u9664\u6027\u80fd\uff0c\u53c8\u4e0d\u4f1a\u51fa\u73b0\u592a\u5927\u7684\u7a7a\u95f4\u5197\u4f59\u3002\n\n\u5173\u4e8e\u5217\u8868\u7684\u5185\u90e8\u7ed3\u6784\u5b9e\u73b0\uff0c\u8bf7\u9605\u8bfb\u7b2c 34 \u8282[\u300a\u6781\u5ea6\u6df1\u5bd2 \u2014\u2014 \u63a2\u7d22\u300c\u538b\u7f29\u5217\u8868\u300d\u5185\u90e8\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b5c95226fb9a04fa42fc3f6)\u548c\u7b2c 35 \u8282[\u300a\u6781\u5ea6\u6df1\u5bd2 \u2014\u2014 \u63a2\u7d22\u300c\u5feb\u901f\u5217\u8868\u300d\u5185\u90e8\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b5c963be51d45199154e82e)\n\n## hash (\u5b57\u5178)\n\nRedis \u7684\u5b57\u5178\u76f8\u5f53\u4e8e Java \u8bed\u8a00\u91cc\u9762\u7684 HashMap\uff0c\u5b83\u662f\u65e0\u5e8f\u5b57\u5178\u3002\u5185\u90e8\u5b9e\u73b0\u7ed3\u6784\u4e0a\u540c Java \u7684 HashMap \u4e5f\u662f\u4e00\u81f4\u7684\uff0c\u540c\u6837\u7684\u6570\u7ec4 + \u94fe\u8868\u4e8c\u7ef4\u7ed3\u6784\u3002\u7b2c\u4e00\u7ef4 hash \u7684\u6570\u7ec4\u4f4d\u7f6e\u78b0\u649e\u65f6\uff0c\u5c31\u4f1a\u5c06\u78b0\u649e\u7684\u5143\u7d20\u4f7f\u7528\u94fe\u8868\u4e32\u63a5\u8d77\u6765\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/9/1647e419af9e3a87?w=579&h=277&f=png&s=11839)\n\n\u4e0d\u540c\u7684\u662f\uff0cRedis \u7684\u5b57\u5178\u7684\u503c\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\uff0c\u53e6\u5916\u5b83\u4eec rehash \u7684\u65b9\u5f0f\u4e0d\u4e00\u6837\uff0c\u56e0\u4e3a Java \u7684 HashMap \u5728\u5b57\u5178\u5f88\u5927\u65f6\uff0crehash \u662f\u4e2a\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u4e00\u6b21\u6027\u5168\u90e8 rehash\u3002Redis \u4e3a\u4e86\u9ad8\u6027\u80fd\uff0c\u4e0d\u80fd\u5835\u585e\u670d\u52a1\uff0c\u6240\u4ee5\u91c7\u7528\u4e86\u6e10\u8fdb\u5f0f rehash \u7b56\u7565\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/28/164dc873b2a899a8?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)\n\n\u6e10\u8fdb\u5f0f rehash \u4f1a\u5728 rehash \u7684\u540c\u65f6\uff0c\u4fdd\u7559\u65b0\u65e7\u4e24\u4e2a hash \u7ed3\u6784\uff0c\u67e5\u8be2\u65f6\u4f1a\u540c\u65f6\u67e5\u8be2\u4e24\u4e2a hash \u7ed3\u6784\uff0c\u7136\u540e\u5728\u540e\u7eed\u7684\u5b9a\u65f6\u4efb\u52a1\u4e2d\u4ee5\u53ca hash \u64cd\u4f5c\u6307\u4ee4\u4e2d\uff0c\u5faa\u5e8f\u6e10\u8fdb\u5730\u5c06\u65e7 hash \u7684\u5185\u5bb9\u4e00\u70b9\u70b9\u8fc1\u79fb\u5230\u65b0\u7684 hash \u7ed3\u6784\u4e2d\u3002\u5f53\u642c\u8fc1\u5b8c\u6210\u4e86\uff0c\u5c31\u4f1a\u4f7f\u7528\u65b0\u7684hash\u7ed3\u6784\u53d6\u800c\u4ee3\u4e4b\u3002\n\n\n\n\u5f53 hash \u79fb\u9664\u4e86\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e4b\u540e\uff0c\u8be5\u6570\u636e\u7ed3\u6784\u81ea\u52a8\u88ab\u5220\u9664\uff0c\u5185\u5b58\u88ab\u56de\u6536\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/16458ef82907e5e1?w=450&h=160&f=gif&s=100250)\n\nhash \u7ed3\u6784\u4e5f\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u7528\u6237\u4fe1\u606f\uff0c\u4e0d\u540c\u4e8e\u5b57\u7b26\u4e32\u4e00\u6b21\u6027\u9700\u8981\u5168\u90e8\u5e8f\u5217\u5316\u6574\u4e2a\u5bf9\u8c61\uff0chash \u53ef\u4ee5\u5bf9\u7528\u6237\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\u5355\u72ec\u5b58\u50a8\u3002\u8fd9\u6837\u5f53\u6211\u4eec\u9700\u8981\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u65f6\u53ef\u4ee5\u8fdb\u884c\u90e8\u5206\u83b7\u53d6\u3002\u800c\u4ee5\u6574\u4e2a\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u53bb\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u7684\u8bdd\u5c31\u53ea\u80fd\u4e00\u6b21\u6027\u5168\u90e8\u8bfb\u53d6\uff0c\u8fd9\u6837\u5c31\u4f1a\u6bd4\u8f83\u6d6a\u8d39\u7f51\u7edc\u6d41\u91cf\u3002\n\nhash \u4e5f\u6709\u7f3a\u70b9\uff0chash \u7ed3\u6784\u7684\u5b58\u50a8\u6d88\u8017\u8981\u9ad8\u4e8e\u5355\u4e2a\u5b57\u7b26\u4e32\uff0c\u5230\u5e95\u8be5\u4f7f\u7528 hash \u8fd8\u662f\u5b57\u7b26\u4e32\uff0c\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u518d\u4e09\u6743\u8861\u3002\n\n```\n> hset books java \"think in java\"  # \u547d\u4ee4\u884c\u7684\u5b57\u7b26\u4e32\u5982\u679c\u5305\u542b\u7a7a\u683c\uff0c\u8981\u7528\u5f15\u53f7\u62ec\u8d77\u6765\n(integer) 1\n> hset books golang \"concurrency in go\"\n(integer) 1\n> hset books python \"python cookbook\"\n(integer) 1\n> hgetall books  # entries()\uff0ckey \u548c value \u95f4\u9694\u51fa\u73b0\n1) \"java\"\n2) \"think in java\"\n3) \"golang\"\n4) \"concurrency in go\"\n5) \"python\"\n6) \"python cookbook\"\n> hlen books\n(integer) 3\n> hget books java\n\"think in java\"\n> hset books golang \"learning go programming\"  # \u56e0\u4e3a\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u6240\u4ee5\u8fd4\u56de 0\n(integer) 0\n> hget books golang\n\"learning go programming\"\n> hmset books java \"effective java\" python \"learning python\" golang \"modern golang programming\"  # \u6279\u91cf set\nOK\n```\n\n\u540c\u5b57\u7b26\u4e32\u5bf9\u8c61\u4e00\u6837\uff0chash \u7ed3\u6784\u4e2d\u7684\u5355\u4e2a\u5b50 key \u4e5f\u53ef\u4ee5\u8fdb\u884c\u8ba1\u6570\uff0c\u5b83\u5bf9\u5e94\u7684\u6307\u4ee4\u662f `hincrby`\uff0c\u548c `incr` \u4f7f\u7528\u57fa\u672c\u4e00\u6837\u3002\n```\n# \u8001\u94b1\u53c8\u8001\u4e86\u4e00\u5c81\n> hincrby user-laoqian age 1\n(integer) 30\n```\n\n\u5173\u4e8e\u5b57\u5178\u7684\u5185\u90e8\u7ed3\u6784\u5b9e\u73b0\uff0c\u8bf7\u9605\u8bfb\u7b2c 33 \u8282[\u300a\u6781\u5ea6\u6df1\u5bd2 \u2014\u2014 \u63a2\u7d22\u300c\u5b57\u5178\u300d\u5185\u90e8\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b5bdbbd5188251ac22b5bf7)\u3002\n\n## set (\u96c6\u5408)\n\nRedis \u7684\u96c6\u5408\u76f8\u5f53\u4e8e Java \u8bed\u8a00\u91cc\u9762\u7684 HashSet\uff0c\u5b83\u5185\u90e8\u7684\u952e\u503c\u5bf9\u662f\u65e0\u5e8f\u7684\u552f\u4e00\u7684\u3002\u5b83\u7684\u5185\u90e8\u5b9e\u73b0\u76f8\u5f53\u4e8e\u4e00\u4e2a\u7279\u6b8a\u7684\u5b57\u5178\uff0c\u5b57\u5178\u4e2d\u6240\u6709\u7684 value \u90fd\u662f\u4e00\u4e2a\u503c`NULL`\u3002\n\n\u5f53\u96c6\u5408\u4e2d\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u79fb\u9664\u4e4b\u540e\uff0c\u6570\u636e\u7ed3\u6784\u81ea\u52a8\u5220\u9664\uff0c\u5185\u5b58\u88ab\u56de\u6536\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/16458e2da04f1a2d?w=484&h=200&f=gif&s=127699)\n\nset \u7ed3\u6784\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u6d3b\u52a8\u4e2d\u5956\u7684\u7528\u6237 ID\uff0c\u56e0\u4e3a\u6709\u53bb\u91cd\u529f\u80fd\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u540c\u4e00\u4e2a\u7528\u6237\u4e0d\u4f1a\u4e2d\u5956\u4e24\u6b21\u3002\n\n```\n> sadd books python\n(integer) 1\n> sadd books python  #  \u91cd\u590d\n(integer) 0\n> sadd books java golang\n(integer) 2\n> smembers books  # \u6ce8\u610f\u987a\u5e8f\uff0c\u548c\u63d2\u5165\u7684\u5e76\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a set \u662f\u65e0\u5e8f\u7684\n1) \"java\"\n2) \"python\"\n3) \"golang\"\n> sismember books java  # \u67e5\u8be2\u67d0\u4e2a value \u662f\u5426\u5b58\u5728\uff0c\u76f8\u5f53\u4e8e contains(o)\n(integer) 1\n> sismember books rust\n(integer) 0\n> scard books  # \u83b7\u53d6\u957f\u5ea6\u76f8\u5f53\u4e8e count()\n(integer) 3\n> spop books  # \u5f39\u51fa\u4e00\u4e2a\n\"java\"\n```\n\n# zset (\u6709\u5e8f\u96c6\u5408)\n\nzset \u53ef\u80fd\u662f Redis \u63d0\u4f9b\u7684\u6700\u4e3a\u7279\u8272\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u4e5f\u662f\u5728\u9762\u8bd5\u4e2d\u9762\u8bd5\u5b98\u6700\u7231\u95ee\u7684\u6570\u636e\u7ed3\u6784\u3002\u5b83\u7c7b\u4f3c\u4e8e Java \u7684 SortedSet \u548c HashMap \u7684\u7ed3\u5408\u4f53\uff0c\u4e00\u65b9\u9762\u5b83\u662f\u4e00\u4e2a set\uff0c\u4fdd\u8bc1\u4e86\u5185\u90e8 value \u7684\u552f\u4e00\u6027\uff0c\u53e6\u4e00\u65b9\u9762\u5b83\u53ef\u4ee5\u7ed9\u6bcf\u4e2a value \u8d4b\u4e88\u4e00\u4e2a score\uff0c\u4ee3\u8868\u8fd9\u4e2a value \u7684\u6392\u5e8f\u6743\u91cd\u3002\u5b83\u7684\u5185\u90e8\u5b9e\u73b0\u7528\u7684\u662f\u4e00\u79cd\u53eb\u505a\u300c\u8df3\u8dc3\u5217\u8868\u300d\u7684\u6570\u636e\u7ed3\u6784\u3002\n\nzset \u4e2d\u6700\u540e\u4e00\u4e2a value \u88ab\u79fb\u9664\u540e\uff0c\u6570\u636e\u7ed3\u6784\u81ea\u52a8\u5220\u9664\uff0c\u5185\u5b58\u88ab\u56de\u6536\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/16458f9f679a8bb0?w=400&h=160&f=gif&s=68631)\n\nzset \u53ef\u4ee5\u7528\u6765\u5b58\u7c89\u4e1d\u5217\u8868\uff0cvalue \u503c\u662f\u7c89\u4e1d\u7684\u7528\u6237 ID\uff0cscore \u662f\u5173\u6ce8\u65f6\u95f4\u3002\u6211\u4eec\u53ef\u4ee5\u5bf9\u7c89\u4e1d\u5217\u8868\u6309\u5173\u6ce8\u65f6\u95f4\u8fdb\u884c\u6392\u5e8f\u3002\n\nzset \u8fd8\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u5b66\u751f\u7684\u6210\u7ee9\uff0cvalue \u503c\u662f\u5b66\u751f\u7684 ID\uff0cscore \u662f\u4ed6\u7684\u8003\u8bd5\u6210\u7ee9\u3002\u6211\u4eec\u53ef\u4ee5\u5bf9\u6210\u7ee9\u6309\u5206\u6570\u8fdb\u884c\u6392\u5e8f\u5c31\u53ef\u4ee5\u5f97\u5230\u4ed6\u7684\u540d\u6b21\u3002\n\n```\n> zadd books 9.0 \"think in java\"\n(integer) 1\n> zadd books 8.9 \"java concurrency\"\n(integer) 1\n> zadd books 8.6 \"java cookbook\"\n(integer) 1\n> zrange books 0 -1  # \u6309 score \u6392\u5e8f\u5217\u51fa\uff0c\u53c2\u6570\u533a\u95f4\u4e3a\u6392\u540d\u8303\u56f4\n1) \"java cookbook\"\n2) \"java concurrency\"\n3) \"think in java\"\n> zrevrange books 0 -1  # \u6309 score \u9006\u5e8f\u5217\u51fa\uff0c\u53c2\u6570\u533a\u95f4\u4e3a\u6392\u540d\u8303\u56f4\n1) \"think in java\"\n2) \"java concurrency\"\n3) \"java cookbook\"\n> zcard books  # \u76f8\u5f53\u4e8e count()\n(integer) 3\n> zscore books \"java concurrency\"  # \u83b7\u53d6\u6307\u5b9a value \u7684 score\n\"8.9000000000000004\"  # \u5185\u90e8 score \u4f7f\u7528 double \u7c7b\u578b\u8fdb\u884c\u5b58\u50a8\uff0c\u6240\u4ee5\u5b58\u5728\u5c0f\u6570\u70b9\u7cbe\u5ea6\u95ee\u9898\n> zrank books \"java concurrency\"  # \u6392\u540d\n(integer) 1\n> zrangebyscore books 0 8.91  # \u6839\u636e\u5206\u503c\u533a\u95f4\u904d\u5386 zset\n1) \"java cookbook\"\n2) \"java concurrency\"\n> zrangebyscore books -inf 8.91 withscores # \u6839\u636e\u5206\u503c\u533a\u95f4 (-\u221e, 8.91] \u904d\u5386 zset\uff0c\u540c\u65f6\u8fd4\u56de\u5206\u503c\u3002inf \u4ee3\u8868 infinite\uff0c\u65e0\u7a77\u5927\u7684\u610f\u601d\u3002\n1) \"java cookbook\"\n2) \"8.5999999999999996\"\n3) \"java concurrency\"\n4) \"8.9000000000000004\"\n> zrem books \"java concurrency\"  # \u5220\u9664 value\n(integer) 1\n> zrange books 0 -1\n1) \"java cookbook\"\n2) \"think in java\"\n```\n\n**\u8df3\u8dc3\u5217\u8868**\n\nzset \u5185\u90e8\u7684\u6392\u5e8f\u529f\u80fd\u662f\u901a\u8fc7\u300c\u8df3\u8dc3\u5217\u8868\u300d\u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u7684\u7ed3\u6784\u975e\u5e38\u7279\u6b8a\uff0c\u4e5f\u6bd4\u8f83\u590d\u6742\u3002\n\n\u56e0\u4e3a zset \u8981\u652f\u6301\u968f\u673a\u7684\u63d2\u5165\u548c\u5220\u9664\uff0c\u6240\u4ee5\u5b83\u4e0d\u597d\u4f7f\u7528\u6570\u7ec4\u6765\u8868\u793a\u3002\u6211\u4eec\u5148\u770b\u4e00\u4e2a\u666e\u901a\u7684\u94fe\u8868\u7ed3\u6784\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/23/164c5a90442cd51a?w=2032&h=174&f=png&s=25070)\n\n\u6211\u4eec\u9700\u8981\u8fd9\u4e2a\u94fe\u8868\u6309\u7167 score \u503c\u8fdb\u884c\u6392\u5e8f\u3002\u8fd9\u610f\u5473\u7740\u5f53\u6709\u65b0\u5143\u7d20\u9700\u8981\u63d2\u5165\u65f6\uff0c\u8981\u5b9a\u4f4d\u5230\u7279\u5b9a\u4f4d\u7f6e\u7684\u63d2\u5165\u70b9\uff0c\u8fd9\u6837\u624d\u53ef\u4ee5\u7ee7\u7eed\u4fdd\u8bc1\u94fe\u8868\u662f\u6709\u5e8f\u7684\u3002\u901a\u5e38\u6211\u4eec\u4f1a\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u6765\u627e\u5230\u63d2\u5165\u70b9\uff0c\u4f46\u662f\u4e8c\u5206\u67e5\u627e\u7684\u5bf9\u8c61\u5fc5\u987b\u662f\u6570\u7ec4\uff0c\u53ea\u6709\u6570\u7ec4\u624d\u53ef\u4ee5\u652f\u6301\u5feb\u901f\u4f4d\u7f6e\u5b9a\u4f4d\uff0c\u94fe\u8868\u505a\u4e0d\u5230\uff0c\u90a3\u8be5\u600e\u4e48\u529e\uff1f\n\n\u60f3\u60f3\u4e00\u4e2a\u521b\u4e1a\u516c\u53f8\uff0c\u521a\u5f00\u59cb\u53ea\u6709\u51e0\u4e2a\u4eba\uff0c\u56e2\u961f\u6210\u5458\u4e4b\u95f4\u4eba\u4eba\u5e73\u7b49\uff0c\u90fd\u662f\u8054\u5408\u521b\u59cb\u4eba\u3002\u968f\u7740\u516c\u53f8\u7684\u6210\u957f\uff0c\u4eba\u6570\u6e10\u6e10\u53d8\u591a\uff0c\u56e2\u961f\u6c9f\u901a\u6210\u672c\u968f\u4e4b\u589e\u52a0\u3002\u8fd9\u65f6\u5019\u5c31\u4f1a\u5f15\u5165\u7ec4\u957f\u5236\uff0c\u5bf9\u56e2\u961f\u8fdb\u884c\u5212\u5206\u3002\u6bcf\u4e2a\u56e2\u961f\u4f1a\u6709\u4e00\u4e2a\u7ec4\u957f\u3002\u5f00\u4f1a\u7684\u65f6\u5019\u5206\u56e2\u961f\u8fdb\u884c\uff0c\u591a\u4e2a\u7ec4\u957f\u4e4b\u95f4\u8fd8\u4f1a\u6709\u81ea\u5df1\u7684\u4f1a\u8bae\u5b89\u6392\u3002\u516c\u53f8\u89c4\u6a21\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u9700\u8981\u518d\u589e\u52a0\u4e00\u4e2a\u5c42\u7ea7 \u2014\u2014 \u90e8\u95e8\uff0c\u6bcf\u4e2a\u90e8\u95e8\u4f1a\u4ece\u7ec4\u957f\u5217\u8868\u4e2d\u63a8\u9009\u51fa\u4e00\u4e2a\u4ee3\u8868\u6765\u4f5c\u4e3a\u90e8\u957f\u3002\u90e8\u957f\u4eec\u4e4b\u95f4\u8fd8\u4f1a\u6709\u81ea\u5df1\u7684\u9ad8\u5c42\u4f1a\u8bae\u5b89\u6392\u3002\n\n\u8df3\u8dc3\u5217\u8868\u5c31\u662f\u7c7b\u4f3c\u4e8e\u8fd9\u79cd\u5c42\u7ea7\u5236\uff0c\u6700\u4e0b\u9762\u4e00\u5c42\u6240\u6709\u7684\u5143\u7d20\u90fd\u4f1a\u4e32\u8d77\u6765\u3002\u7136\u540e\u6bcf\u9694\u51e0\u4e2a\u5143\u7d20\u6311\u9009\u51fa\u4e00\u4e2a\u4ee3\u8868\u6765\uff0c\u518d\u5c06\u8fd9\u51e0\u4e2a\u4ee3\u8868\u4f7f\u7528\u53e6\u5916\u4e00\u7ea7\u6307\u9488\u4e32\u8d77\u6765\u3002\u7136\u540e\u5728\u8fd9\u4e9b\u4ee3\u8868\u91cc\u518d\u6311\u51fa\u4e8c\u7ea7\u4ee3\u8868\uff0c\u518d\u4e32\u8d77\u6765\u3002\u6700\u7ec8\u5c31\u5f62\u6210\u4e86\u91d1\u5b57\u5854\u7ed3\u6784\u3002\n\n\u60f3\u60f3\u4f60\u8001\u5bb6\u5728\u4e16\u754c\u5730\u56fe\u4e2d\u7684\u4f4d\u7f6e\uff1a\u4e9a\u6d32-->\u4e2d\u56fd->\u5b89\u5fbd\u7701->\u5b89\u5e86\u5e02->\u679e\u9633\u53bf->\u6c64\u6c9f\u9547->\u7530\u95f4\u6751->xxxx\u53f7\uff0c\u4e5f\u662f\u8fd9\u6837\u4e00\u4e2a\u7c7b\u4f3c\u7684\u7ed3\u6784\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/23/164c5bb13c6da230?w=1151&h=225&f=png&s=17916)\n\n\u300c\u8df3\u8dc3\u5217\u8868\u300d\u4e4b\u6240\u4ee5\u300c\u8df3\u8dc3\u300d\uff0c\u662f\u56e0\u4e3a\u5185\u90e8\u7684\u5143\u7d20\u53ef\u80fd\u300c\u8eab\u517c\u6570\u804c\u300d\uff0c\u6bd4\u5982\u4e0a\u56fe\u4e2d\u95f4\u7684\u8fd9\u4e2a\u5143\u7d20\uff0c\u540c\u65f6\u5904\u4e8e L0\u3001L1 \u548c L2 \u5c42\uff0c\u53ef\u4ee5\u5feb\u901f\u5728\u4e0d\u540c\u5c42\u6b21\u4e4b\u95f4\u8fdb\u884c\u300c\u8df3\u8dc3\u300d\u3002\n\n\u5b9a\u4f4d\u63d2\u5165\u70b9\u65f6\uff0c\u5148\u5728\u9876\u5c42\u8fdb\u884c\u5b9a\u4f4d\uff0c\u7136\u540e\u4e0b\u6f5c\u5230\u4e0b\u4e00\u7ea7\u5b9a\u4f4d\uff0c\u4e00\u76f4\u4e0b\u6f5c\u5230\u6700\u5e95\u5c42\u627e\u5230\u5408\u9002\u7684\u4f4d\u7f6e\uff0c\u5c06\u65b0\u5143\u7d20\u63d2\u8fdb\u53bb\u3002\u4f60\u4e5f\u8bb8\u4f1a\u95ee\uff0c\u90a3\u65b0\u63d2\u5165\u7684\u5143\u7d20\u5982\u4f55\u624d\u6709\u673a\u4f1a\u300c\u8eab\u517c\u6570\u804c\u300d\u5462\uff1f\n\n\u8df3\u8dc3\u5217\u8868\u91c7\u53d6\u4e00\u4e2a\u968f\u673a\u7b56\u7565\u6765\u51b3\u5b9a\u65b0\u5143\u7d20\u53ef\u4ee5\u517c\u804c\u5230\u7b2c\u51e0\u5c42\u3002\n\n\u9996\u5148 L0 \u5c42\u80af\u5b9a\u662f 100% \u4e86\uff0cL1 \u5c42\u53ea\u6709 50% \u7684\u6982\u7387\uff0cL2 \u5c42\u53ea\u6709 25% \u7684\u6982\u7387\uff0cL3 \u5c42\u53ea\u6709 12.5% \u7684\u6982\u7387\uff0c\u4e00\u76f4\u968f\u673a\u5230\u6700\u9876\u5c42 L31 \u5c42\u3002\u7edd\u5927\u591a\u6570\u5143\u7d20\u90fd\u8fc7\u4e0d\u4e86\u51e0\u5c42\uff0c\u53ea\u6709\u6781\u5c11\u6570\u5143\u7d20\u53ef\u4ee5\u6df1\u5165\u5230\u9876\u5c42\u3002\u5217\u8868\u4e2d\u7684\u5143\u7d20\u8d8a\u591a\uff0c\u80fd\u591f\u6df1\u5165\u7684\u5c42\u6b21\u5c31\u8d8a\u6df1\uff0c\u80fd\u8fdb\u5165\u5230\u9876\u5c42\u7684\u6982\u7387\u5c31\u4f1a\u8d8a\u5927\u3002\n\n\u8fd9\u8fd8\u633a\u516c\u5e73\u7684\uff0c\u80fd\u4e0d\u80fd\u8fdb\u5165\u4e2d\u592e\u4e0d\u662f\u9760\u62fc\u7239\uff0c\u800c\u662f\u770b\u8fd0\u6c14\u3002\n\n\u5173\u4e8e\u8df3\u8dc3\u5217\u8868\u7684\u5185\u90e8\u7ed3\u6784\u5b9e\u73b0\uff0c\u8bf7\u9605\u8bfb\u7b2c 36 \u8282[\u300a\u6781\u5ea6\u6df1\u5bd2 \u2014\u2014 \u63a2\u7d22\u300c\u8df3\u8dc3\u5217\u8868\u300d\u5185\u90e8\u7ed3\u6784\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b5ac63d5188256255299d9c)\n\n## \u5bb9\u5668\u578b\u6570\u636e\u7ed3\u6784\u7684\u901a\u7528\u89c4\u5219\n\nlist/set/hash/zset \u8fd9\u56db\u79cd\u6570\u636e\u7ed3\u6784\u662f\u5bb9\u5668\u578b\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u4eec\u5171\u4eab\u4e0b\u9762\u4e24\u6761\u901a\u7528\u89c4\u5219\uff1a\n\n1. create if not exists \n\n    \u5982\u679c\u5bb9\u5668\u4e0d\u5b58\u5728\uff0c\u90a3\u5c31\u521b\u5efa\u4e00\u4e2a\uff0c\u518d\u8fdb\u884c\u64cd\u4f5c\u3002\u6bd4\u5982 rpush \u64cd\u4f5c\u521a\u5f00\u59cb\u662f\u6ca1\u6709\u5217\u8868\u7684\uff0cRedis \u5c31\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\uff0c\u7136\u540e\u518d rpush \u8fdb\u53bb\u65b0\u5143\u7d20\u3002\n\n2. drop if no elements\n\n    \u5982\u679c\u5bb9\u5668\u91cc\u5143\u7d20\u6ca1\u6709\u4e86\uff0c\u90a3\u4e48\u7acb\u5373\u5220\u9664\u5143\u7d20\uff0c\u91ca\u653e\u5185\u5b58\u3002\u8fd9\u610f\u5473\u7740 lpop \u64cd\u4f5c\u5230\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u5217\u8868\u5c31\u6d88\u5931\u4e86\u3002\n    \n## \u8fc7\u671f\u65f6\u95f4\n\nRedis \u6240\u6709\u7684\u6570\u636e\u7ed3\u6784\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u65f6\u95f4\u5230\u4e86\uff0cRedis \u4f1a\u81ea\u52a8\u5220\u9664\u76f8\u5e94\u7684\u5bf9\u8c61\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u8fc7\u671f\u662f\u4ee5\u5bf9\u8c61\u4e3a\u5355\u4f4d\uff0c\u6bd4\u5982\u4e00\u4e2a hash \u7ed3\u6784\u7684\u8fc7\u671f\u662f\u6574\u4e2a hash \u5bf9\u8c61\u7684\u8fc7\u671f\uff0c\u800c\u4e0d\u662f\u5176\u4e2d\u7684\u67d0\u4e2a\u5b50 key\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u5730\u65b9\u662f\u5982\u679c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u7136\u540e\u4f60\u8c03\u7528\u4e86 set \u65b9\u6cd5\u4fee\u6539\u4e86\u5b83\uff0c\u5b83\u7684\u8fc7\u671f\u65f6\u95f4\u4f1a\u6d88\u5931\u3002\n\n```\n127.0.0.1:6379> set codehole yoyo\nOK\n127.0.0.1:6379> expire codehole 600\n(integer) 1\n127.0.0.1:6379> ttl codehole\n(integer) 597\n127.0.0.1:6379> set codehole yoyo\nOK\n127.0.0.1:6379> ttl codehole\n(integer) -1\n```\n\n## \u601d\u8003 & \u4f5c\u4e1a\n\n1. \u5982\u679c\u4f60\u662f Java \u7528\u6237\uff0c\u8bf7\u5b9a\u4e49\u4e00\u4e2a\u7528\u6237\u4fe1\u606f\u7ed3\u6784\u4f53\uff0c\u7136\u540e\u4f7f\u7528 `fastjson` \u5bf9\u7528\u6237\u4fe1\u606f\u5bf9\u8c61\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\uff0c\u518d\u4f7f\u7528 Jedis \u5bf9 Redis \u7f13\u5b58\u7684\u7528\u6237\u4fe1\u606f\u8fdb\u884c\u5b58\u548c\u53d6\u3002\n\n2. \u5982\u679c\u4f60\u662f Python \u7528\u6237\uff0c\u4f7f\u7528\u5185\u7f6e\u7684 JSON \u5305\u5c31\u53ef\u4ee5\u4e86\u3002\u7136\u540e\u901a\u8fc7 redis-py \u6765\u5bf9 Redis \u7f13\u5b58\u7684\u7528\u6237\u4fe1\u606f\u8fdb\u884c\u5b58\u548c\u53d6\u3002\n\n3. \u60f3\u60f3\u5982\u679c\u8981\u6539\u6210\u7528 hash \u7ed3\u6784\u6765\u7f13\u5b58\u7528\u6237\u4fe1\u606f\uff0c\u4f60\u8be5\u5982\u4f55\u5c01\u88c5\u6bd4\u8f83\u5408\u9002\uff1f\n\n4. \u60f3\u60f3\u5e73\u65f6\u8fd8\u6709\u54ea\u4e9b\u6307\u4ee4\u4f60\u5e73\u65f6\u7528\u8fc7\u800c\u672c\u5c0f\u8282\u6ca1\u6709\u63d0\u5230\u7684\uff1f\n\n5. \u56de\u60f3\u4e00\u4e0b\u6398\u91d1\u793e\u533a\u7684\u529f\u80fd\u6a21\u5757\u4e2d\u5206\u522b\u4f1a\u4f7f\u7528\u5230\u54ea\u4e9b\u6570\u636e\u7ed3\u6784\uff1f\n\n\n## \u6269\u5c55\u9605\u8bfb\n- [\u300a\u5b58\u7ed3\u6784\u4f53\u4fe1\u606f\u5230\u5e95\u8be5\u4f7f\u7528 hash \u8fd8\u662f string\uff1f\u300b](https://stackoverflow.com/questions/16375188/redis-strings-vs-redis-hashes-to-represent-json-efficiency)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/1\u57fa\u7840\u4e07\u4e08\u9ad8\u697c\u5e73\u5730\u8d77__Redis_\u57fa\u7840\u6570\u636e\u7ed3\u6784.md", "create_date": "2020-02-18T03:00:09.403", "order": 2}}, {"model": "subject.chapter", "pk": 12, "fields": {"title": "2\u5e94\u7528 1\uff1a\u5343\u5e06\u7ade\u53d1 \u2014\u2014 \u5206\u5e03\u5f0f\u9501", "topic": 2, "md5": "17364c942146b60c56a8b73e01017f59", "md_body": "# \u5e94\u7528 1\uff1a\u5343\u5e06\u7ade\u53d1 \u2014\u2014 \u5206\u5e03\u5f0f\u9501\n\n\u5206\u5e03\u5f0f\u5e94\u7528\u8fdb\u884c\u903b\u8f91\u5904\u7406\u65f6\u7ecf\u5e38\u4f1a\u9047\u5230\u5e76\u53d1\u95ee\u9898\u3002\n\n\u6bd4\u5982\u4e00\u4e2a\u64cd\u4f5c\u8981\u4fee\u6539\u7528\u6237\u7684\u72b6\u6001\uff0c\u4fee\u6539\u72b6\u6001\u9700\u8981\u5148\u8bfb\u51fa\u7528\u6237\u7684\u72b6\u6001\uff0c\u5728\u5185\u5b58\u91cc\u8fdb\u884c\u4fee\u6539\uff0c\u6539\u5b8c\u4e86\u518d\u5b58\u56de\u53bb\u3002\u5982\u679c\u8fd9\u6837\u7684\u64cd\u4f5c\u540c\u65f6\u8fdb\u884c\u4e86\uff0c\u5c31\u4f1a\u51fa\u73b0\u5e76\u53d1\u95ee\u9898\uff0c\u56e0\u4e3a\u8bfb\u53d6\u548c\u4fdd\u5b58\u72b6\u6001\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e0d\u662f\u539f\u5b50\u7684\u3002\uff08Wiki \u89e3\u91ca\uff1a\u6240\u8c13**\u539f\u5b50\u64cd\u4f5c**\u662f\u6307\u4e0d\u4f1a\u88ab\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\u6253\u65ad\u7684\u64cd\u4f5c\uff1b\u8fd9\u79cd\u64cd\u4f5c\u4e00\u65e6\u5f00\u59cb\uff0c\u5c31\u4e00\u76f4\u8fd0\u884c\u5230\u7ed3\u675f\uff0c\u4e2d\u95f4\u4e0d\u4f1a\u6709\u4efb\u4f55 context switch \u7ebf\u7a0b\u5207\u6362\u3002\uff09\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164824791aa796fa?w=1156&h=482&f=png&s=48904)\n\n\u8fd9\u4e2a\u65f6\u5019\u5c31\u8981\u4f7f\u7528\u5230\u5206\u5e03\u5f0f\u9501\u6765\u9650\u5236\u7a0b\u5e8f\u7684\u5e76\u53d1\u6267\u884c\u3002Redis \u5206\u5e03\u5f0f\u9501\u4f7f\u7528\u975e\u5e38\u5e7f\u6cdb\uff0c\u5b83\u662f\u9762\u8bd5\u7684\u91cd\u8981\u8003\u70b9\u4e4b\u4e00\uff0c\u5f88\u591a\u540c\u5b66\u90fd\u77e5\u9053\u8fd9\u4e2a\u77e5\u8bc6\uff0c\u4e5f\u5927\u81f4\u77e5\u9053\u5206\u5e03\u5f0f\u9501\u7684\u539f\u7406\uff0c\u4f46\u662f\u5177\u4f53\u5230\u7ec6\u8282\u7684\u4f7f\u7528\u4e0a\u5f80\u5f80\u5e76\u4e0d\u5b8c\u5168\u6b63\u786e\u3002\n\n\u5206\u5e03\u5f0f\u9501\n--\n\u5206\u5e03\u5f0f\u9501\u672c\u8d28\u4e0a\u8981\u5b9e\u73b0\u7684\u76ee\u6807\u5c31\u662f\u5728 Redis \u91cc\u9762\u5360\u4e00\u4e2a\u201c\u8305\u5751\u201d\uff0c\u5f53\u522b\u7684\u8fdb\u7a0b\u4e5f\u8981\u6765\u5360\u65f6\uff0c\u53d1\u73b0\u5df2\u7ecf\u6709\u4eba\u8e72\u5728\u90a3\u91cc\u4e86\uff0c\u5c31\u53ea\u597d\u653e\u5f03\u6216\u8005\u7a0d\u540e\u518d\u8bd5\u3002\n\n\u5360\u5751\u4e00\u822c\u662f\u4f7f\u7528 setnx(set if not exists) \u6307\u4ee4\uff0c\u53ea\u5141\u8bb8\u88ab\u4e00\u4e2a\u5ba2\u6237\u7aef\u5360\u5751\u3002\u5148\u6765\u5148\u5360\uff0c\n\u7528\u5b8c\u4e86\uff0c\u518d\u8c03\u7528 del \u6307\u4ee4\u91ca\u653e\u8305\u5751\u3002\n```\n// \u8fd9\u91cc\u7684\u5192\u53f7:\u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u5b57\u7b26\uff0c\u6ca1\u7279\u522b\u542b\u4e49\uff0c\u5b83\u53ef\u4ee5\u662f\u4efb\u610f\u5176\u5b83\u5b57\u7b26\uff0c\u4e0d\u8981\u8bef\u89e3\n> setnx lock:codehole true\nOK\n... do something critical ...\n> del lock:codehole\n(integer) 1\n```\n\n\u4f46\u662f\u6709\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u903b\u8f91\u6267\u884c\u5230\u4e2d\u95f4\u51fa\u73b0\u5f02\u5e38\u4e86\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4 del \u6307\u4ee4\u6ca1\u6709\u88ab\u8c03\u7528\uff0c\u8fd9\u6837\u5c31\u4f1a\u9677\u5165\u6b7b\u9501\uff0c\u9501\u6c38\u8fdc\u5f97\u4e0d\u5230\u91ca\u653e\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5728\u62ff\u5230\u9501\u4e4b\u540e\uff0c\u518d\u7ed9\u9501\u52a0\u4e0a\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u6bd4\u5982 5s\uff0c\u8fd9\u6837\u5373\u4f7f\u4e2d\u95f4\u51fa\u73b0\u5f02\u5e38\u4e5f\u53ef\u4ee5\u4fdd\u8bc1 5 \u79d2\u4e4b\u540e\u9501\u4f1a\u81ea\u52a8\u91ca\u653e\u3002\n```\n> setnx lock:codehole true\nOK\n> expire lock:codehole 5\n... do something critical ...\n> del lock:codehole\n(integer) 1\n```\n\u4f46\u662f\u4ee5\u4e0a\u903b\u8f91\u8fd8\u6709\u95ee\u9898\u3002\u5982\u679c\u5728 setnx \u548c expire \u4e4b\u95f4\u670d\u52a1\u5668\u8fdb\u7a0b\u7a81\u7136\u6302\u6389\u4e86\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u673a\u5668\u6389\u7535\u6216\u8005\u662f\u88ab\u4eba\u4e3a\u6740\u6389\u7684\uff0c\u5c31\u4f1a\u5bfc\u81f4 expire \u5f97\u4e0d\u5230\u6267\u884c\uff0c\u4e5f\u4f1a\u9020\u6210\u6b7b\u9501\u3002\n\n\u8fd9\u79cd\u95ee\u9898\u7684\u6839\u6e90\u5c31\u5728\u4e8e setnx \u548c expire \u662f\u4e24\u6761\u6307\u4ee4\u800c\u4e0d\u662f\u539f\u5b50\u6307\u4ee4\u3002\u5982\u679c\u8fd9\u4e24\u6761\u6307\u4ee4\u53ef\u4ee5\u4e00\u8d77\u6267\u884c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u4e5f\u8bb8\u4f60\u4f1a\u60f3\u5230\u7528 Redis \u4e8b\u52a1\u6765\u89e3\u51b3\u3002\u4f46\u662f\u8fd9\u91cc\u4e0d\u884c\uff0c\u56e0\u4e3a expire \u662f\u4f9d\u8d56\u4e8e setnx \u7684\u6267\u884c\u7ed3\u679c\u7684\uff0c\u5982\u679c setnx \u6ca1\u62a2\u5230\u9501\uff0cexpire \u662f\u4e0d\u5e94\u8be5\u6267\u884c\u7684\u3002\u4e8b\u52a1\u91cc\u6ca1\u6709 if-else \u5206\u652f\u903b\u8f91\uff0c\u4e8b\u52a1\u7684\u7279\u70b9\u662f\u4e00\u53e3\u6c14\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u8981\u4e48\u4e00\u4e2a\u90fd\u4e0d\u6267\u884c\u3002\n\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u7591\u96be\uff0cRedis \u5f00\u6e90\u793e\u533a\u6d8c\u73b0\u4e86\u4e00\u5806\u5206\u5e03\u5f0f\u9501\u7684 library\uff0c\u4e13\u95e8\u7528\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u5b9e\u73b0\u65b9\u6cd5\u6781\u4e3a\u590d\u6742\uff0c\u5c0f\u767d\u7528\u6237\u4e00\u822c\u8981\u8d39\u5f88\u5927\u7684\u7cbe\u529b\u624d\u53ef\u4ee5\u641e\u61c2\u3002\u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\uff0c\u610f\u5473\u7740\u4f60\u4e0d\u80fd\u4ec5\u4ec5\u4f7f\u7528 Jedis \u6216\u8005 redis-py \u5c31\u884c\u4e86\uff0c\u8fd8\u5f97\u5f15\u5165\u5206\u5e03\u5f0f\u9501\u7684 library\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/16459b393843f7ae?w=512&h=200&f=gif&s=218111)\n\n\u4e3a\u4e86\u6cbb\u7406\u8fd9\u4e2a\u4e71\u8c61\uff0cRedis 2.8 \u7248\u672c\u4e2d\u4f5c\u8005\u52a0\u5165\u4e86 set \u6307\u4ee4\u7684\u6269\u5c55\u53c2\u6570\uff0c\u4f7f\u5f97 setnx \u548c expire \u6307\u4ee4\u53ef\u4ee5\u4e00\u8d77\u6267\u884c\uff0c\u5f7b\u5e95\u89e3\u51b3\u4e86\u5206\u5e03\u5f0f\u9501\u7684\u4e71\u8c61\u3002\u4ece\u6b64\u4ee5\u540e\u6240\u6709\u7684\u7b2c\u4e09\u65b9\u5206\u5e03\u5f0f\u9501 library \u53ef\u4ee5\u4f11\u606f\u4e86\u3002\n```\n> set lock:codehole true ex 5 nx\nOK\n... do something critical ...\n> del lock:codehole\n```\n\u4e0a\u9762\u8fd9\u4e2a\u6307\u4ee4\u5c31\u662f setnx \u548c expire \u7ec4\u5408\u5728\u4e00\u8d77\u7684\u539f\u5b50\u6307\u4ee4\uff0c\u5b83\u5c31\u662f\u5206\u5e03\u5f0f\u9501\u7684\u5965\u4e49\u6240\u5728\u3002\n\n## \u8d85\u65f6\u95ee\u9898\n\nRedis \u7684\u5206\u5e03\u5f0f\u9501\u4e0d\u80fd\u89e3\u51b3\u8d85\u65f6\u95ee\u9898\uff0c\u5982\u679c\u5728\u52a0\u9501\u548c\u91ca\u653e\u9501\u4e4b\u95f4\u7684\u903b\u8f91\u6267\u884c\u7684\u592a\u957f\uff0c\u4ee5\u81f3\u4e8e\u8d85\u51fa\u4e86\u9501\u7684\u8d85\u65f6\u9650\u5236\uff0c\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u56e0\u4e3a\u8fd9\u65f6\u5019\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u7684\u9501\u8fc7\u671f\u4e86\uff0c\u4e34\u754c\u533a\u7684\u903b\u8f91\u8fd8\u6ca1\u6709\u6267\u884c\u5b8c\uff0c\u8fd9\u4e2a\u65f6\u5019\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u5c31\u63d0\u524d\u91cd\u65b0\u6301\u6709\u4e86\u8fd9\u628a\u9501\uff0c\u5bfc\u81f4\u4e34\u754c\u533a\u4ee3\u7801\u4e0d\u80fd\u5f97\u5230\u4e25\u683c\u7684\u4e32\u884c\u6267\u884c\u3002\n\n\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u5206\u5e03\u5f0f\u9501\u4e0d\u8981\u7528\u4e8e\u8f83\u957f\u65f6\u95f4\u7684\u4efb\u52a1\u3002\u5982\u679c\u771f\u7684\u5076\u5c14\u51fa\u73b0\u4e86\uff0c\u6570\u636e\u51fa\u73b0\u7684\u5c0f\u6ce2\u9519\u4e71\u53ef\u80fd\u9700\u8981\u4eba\u5de5\u4ecb\u5165\u89e3\u51b3\u3002\n\n```py\ntag = random.nextint()  # \u968f\u673a\u6570\nif redis.set(key, tag, nx=True, ex=5):\n    do_something()\n    redis.delifequals(key, tag)  # \u5047\u60f3\u7684 delifequals \u6307\u4ee4\n```\n\n\u6709\u4e00\u4e2a\u7a0d\u5fae\u5b89\u5168\u4e00\u70b9\u7684\u65b9\u6848\u662f\u4e3a set \u6307\u4ee4\u7684 value \u53c2\u6570\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u91ca\u653e\u9501\u65f6\u5148\u5339\u914d\u968f\u673a\u6570\u662f\u5426\u4e00\u81f4\uff0c\u7136\u540e\u518d\u5220\u9664 key\uff0c\u8fd9\u662f\u4e3a\u4e86\u786e\u4fdd\u5f53\u524d\u7ebf\u7a0b\u5360\u6709\u7684\u9501\u4e0d\u4f1a\u88ab\u5176\u5b83\u7ebf\u7a0b\u91ca\u653e\uff0c\u9664\u975e\u8fd9\u4e2a\u9501\u662f\u8fc7\u671f\u4e86\u88ab\u670d\u52a1\u5668\u81ea\u52a8\u91ca\u653e\u7684\u3002\n\u4f46\u662f\u5339\u914d value \u548c\u5220\u9664 key \u4e0d\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff0cRedis \u4e5f\u6ca1\u6709\u63d0\u4f9b\u7c7b\u4f3c\u4e8e```delifequals```\u8fd9\u6837\u7684\u6307\u4ee4\uff0c\u8fd9\u5c31\u9700\u8981\u4f7f\u7528 Lua \u811a\u672c\u6765\u5904\u7406\u4e86\uff0c\u56e0\u4e3a Lua \u811a\u672c\u53ef\u4ee5\u4fdd\u8bc1\u8fde\u7eed\u591a\u4e2a\u6307\u4ee4\u7684\u539f\u5b50\u6027\u6267\u884c\u3002\n```lua\n# delifequals\nif redis.call(\"get\",KEYS[1]) == ARGV[1] then\n    return redis.call(\"del\",KEYS[1])\nelse\n    return 0\nend\n```\n\u4f46\u662f\u8fd9\u4e5f\u4e0d\u662f\u4e00\u4e2a\u5b8c\u7f8e\u7684\u65b9\u6848\uff0c\u5b83\u53ea\u662f\u76f8\u5bf9\u5b89\u5168\u4e00\u70b9\uff0c\u56e0\u4e3a\u5982\u679c\u771f\u7684\u8d85\u65f6\u4e86\uff0c\u5f53\u524d\u7ebf\u7a0b\u7684\u903b\u8f91\u6ca1\u6709\u6267\u884c\u5b8c\uff0c\u5176\u5b83\u7ebf\u7a0b\u4e5f\u4f1a\u4e58\u865a\u800c\u5165\u3002\n\n## \u53ef\u91cd\u5165\u6027\n\n\u53ef\u91cd\u5165\u6027\u662f\u6307\u7ebf\u7a0b\u5728\u6301\u6709\u9501\u7684\u60c5\u51b5\u4e0b\u518d\u6b21\u8bf7\u6c42\u52a0\u9501\uff0c\u5982\u679c\u4e00\u4e2a\u9501\u652f\u6301\u540c\u4e00\u4e2a\u7ebf\u7a0b\u7684\u591a\u6b21\u52a0\u9501\uff0c\u90a3\u4e48\u8fd9\u4e2a\u9501\u5c31\u662f\u53ef\u91cd\u5165\u7684\u3002\u6bd4\u5982 Java \u8bed\u8a00\u91cc\u6709\u4e2a ReentrantLock \u5c31\u662f\u53ef\u91cd\u5165\u9501\u3002Redis \u5206\u5e03\u5f0f\u9501\u5982\u679c\u8981\u652f\u6301\u53ef\u91cd\u5165\uff0c\u9700\u8981\u5bf9\u5ba2\u6237\u7aef\u7684 set \u65b9\u6cd5\u8fdb\u884c\u5305\u88c5\uff0c\u4f7f\u7528\u7ebf\u7a0b\u7684 Threadlocal \u53d8\u91cf\u5b58\u50a8\u5f53\u524d\u6301\u6709\u9501\u7684\u8ba1\u6570\u3002\n```py\n# -*- coding: utf-8\nimport redis\nimport threading\n\n\nlocks = threading.local()\nlocks.redis = {}\n\ndef key_for(user_id):\n    return \"account_{}\".format(user_id)\n\ndef _lock(client, key):\n    return bool(client.set(key, True, nx=True, ex=5))\n\ndef _unlock(client, key):\n    client.delete(key)\n\ndef lock(client, user_id):\n    key = key_for(user_id)\n    if key in locks.redis:\n        locks.redis[key] += 1\n        return True\n    ok = _lock(client, key)\n    if not ok:\n        return False\n    locks.redis[key] = 1\n    return True\n\ndef unlock(client, user_id):\n    key = key_for(user_id)\n    if key in locks.redis:\n        locks.redis[key] -= 1\n        if locks.redis[key] <= 0:\n            del locks.redis[key]\n            self._unlock(key)\n        return True\n    return False\n\nclient = redis.StrictRedis()\nprint \"lock\", lock(client, \"codehole\")\nprint \"lock\", lock(client, \"codehole\")\nprint \"unlock\", unlock(client, \"codehole\")\nprint \"unlock\", unlock(client, \"codehole\")\n\n```\n\u4ee5\u4e0a\u8fd8\u4e0d\u662f\u53ef\u91cd\u5165\u9501\u7684\u5168\u90e8\uff0c\u7cbe\u786e\u4e00\u70b9\u8fd8\u9700\u8981\u8003\u8651\u5185\u5b58\u9501\u8ba1\u6570\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee3\u7801\u590d\u6742\u5ea6\u5c06\u4f1a\u7ee7\u7eed\u5347\u9ad8\u3002\u8001\u94b1\u4e0d\u63a8\u8350\u4f7f\u7528\u53ef\u91cd\u5165\u9501\uff0c\u5b83\u52a0\u91cd\u4e86\u5ba2\u6237\u7aef\u7684\u590d\u6742\u6027\uff0c\u5728\u7f16\u5199\u4e1a\u52a1\u65b9\u6cd5\u65f6\u6ce8\u610f\u5728\u903b\u8f91\u7ed3\u6784\u4e0a\u8fdb\u884c\u8c03\u6574\u5b8c\u5168\u53ef\u4ee5\u4e0d\u4f7f\u7528\u53ef\u91cd\u5165\u9501\u3002\u4e0b\u9762\u662f Java \u7248\u672c\u7684\u53ef\u91cd\u5165\u9501\u3002\n```java\npublic class RedisWithReentrantLock {\n\n  private ThreadLocal<Map<String, Integer>> lockers = new ThreadLocal<>();\n\n  private Jedis jedis;\n\n  public RedisWithReentrantLock(Jedis jedis) {\n    this.jedis = jedis;\n  }\n\n  private boolean _lock(String key) {\n    return jedis.set(key, \"\", \"nx\", \"ex\", 5L) != null;\n  }\n\n  private void _unlock(String key) {\n    jedis.del(key);\n  }\n\n  private Map<String, Integer> currentLockers() {\n    Map<String, Integer> refs = lockers.get();\n    if (refs != null) {\n      return refs;\n    }\n    lockers.set(new HashMap<>());\n    return lockers.get();\n  }\n\n  public boolean lock(String key) {\n    Map<String, Integer> refs = currentLockers();\n    Integer refCnt = refs.get(key);\n    if (refCnt != null) {\n      refs.put(key, refCnt + 1);\n      return true;\n    }\n    boolean ok = this._lock(key);\n    if (!ok) {\n      return false;\n    }\n    refs.put(key, 1);\n    return true;\n  }\n\n  public boolean unlock(String key) {\n    Map<String, Integer> refs = currentLockers();\n    Integer refCnt = refs.get(key);\n    if (refCnt == null) {\n      return false;\n    }\n    refCnt -= 1;\n    if (refCnt > 0) {\n      refs.put(key, refCnt);\n    } else {\n      refs.remove(key);\n      this._unlock(key);\n    }\n    return true;\n  }\n\n  public static void main(String[] args) {\n    Jedis jedis = new Jedis();\n    RedisWithReentrantLock redis = new RedisWithReentrantLock(jedis);\n    System.out.println(redis.lock(\"codehole\"));\n    System.out.println(redis.lock(\"codehole\"));\n    System.out.println(redis.unlock(\"codehole\"));\n    System.out.println(redis.unlock(\"codehole\"));\n  }\n\n}\n```\n\u8ddf Python \u7248\u672c\u533a\u522b\u4e0d\u5927\uff0c\u4e5f\u662f\u57fa\u4e8e ThreadLocal \u548c\u5f15\u7528\u8ba1\u6570\u3002\n\n\u4ee5\u4e0a\u8fd8\u4e0d\u662f\u5206\u5e03\u5f0f\u9501\u7684\u5168\u90e8\uff0c\u5728\u5c0f\u518c\u7684\u62d3\u5c55\u7bc7[\u300a\u62fe\u9057\u6f0f\u8865 \u2014\u2014 \u518d\u8c08\u5206\u5e03\u5f0f\u9501\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b4c19216fb9a04fb8773ed1)\uff0c\u6211\u4eec\u8fd8\u4f1a\u7ee7\u7eed\u5bf9\u5206\u5e03\u5f0f\u9501\u505a\u8fdb\u4e00\u6b65\u7684\u6df1\u5165\u7406\u89e3\u3002\n\n## \u601d\u8003\u9898\n1. Review \u4e0b\u4f60\u81ea\u5df1\u7684\u9879\u76ee\u4ee3\u7801\u4e2d\u7684\u5206\u5e03\u5f0f\u9501\uff0c\u5b83\u7684\u4f7f\u7528\u65b9\u5f0f\u662f\u5426\u6807\u51c6\u6b63\u786e\uff1f\n2. \u5982\u679c\u4f60\u8fd8\u6ca1\u7528\u8fc7\u5206\u5e03\u5f0f\u9501\uff0c\u60f3\u60f3\u81ea\u5df1\u7684\u9879\u76ee\u4e2d\u662f\u5426\u53ef\u4ee5\u7528\u4e0a\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/2\u5e94\u7528_1\u5343\u5e06\u7ade\u53d1__\u5206\u5e03\u5f0f\u9501.md", "create_date": "2020-02-18T03:00:17.870", "order": 3}}, {"model": "subject.chapter", "pk": 13, "fields": {"title": "3\u5e94\u7528 2\uff1a\u7f13\u5175\u4e4b\u8ba1 \u2014\u2014 \u5ef6\u65f6\u961f\u5217", "topic": 2, "md5": "8fb89f477510d72debf7a42618ef9245", "md_body": "# \u5e94\u7528 2\uff1a\u7f13\u5175\u4e4b\u8ba1 \u2014\u2014 \u5ef6\u65f6\u961f\u5217\n\n\u6211\u4eec\u5e73\u65f6\u4e60\u60ef\u4e8e\u4f7f\u7528 Rabbitmq \u548c Kafka \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u4e2d\u95f4\u4ef6\uff0c\u6765\u7ed9\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u589e\u52a0\u5f02\u6b65\u6d88\u606f\u4f20\u9012\u529f\u80fd\u3002\u8fd9\u4e24\u4e2a\u4e2d\u95f4\u4ef6\u90fd\u662f\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\u4e2d\u95f4\u4ef6\uff0c\u7279\u6027\u4e4b\u591a\u8d85\u51fa\u4e86\u5927\u591a\u6570\u4eba\u7684\u7406\u89e3\u80fd\u529b\u3002\n\n\u4f7f\u7528\u8fc7 Rabbitmq \u7684\u540c\u5b66\u77e5\u9053\u5b83\u4f7f\u7528\u8d77\u6765\u6709\u591a\u590d\u6742\uff0c\u53d1\u6d88\u606f\u4e4b\u524d\u8981\u521b\u5efa Exchange\uff0c\u518d\u521b\u5efa Queue\uff0c\u8fd8\u8981\u5c06 Queue \u548c Exchange \u901a\u8fc7\u67d0\u79cd\u89c4\u5219\u7ed1\u5b9a\u8d77\u6765\uff0c\u53d1\u6d88\u606f\u7684\u65f6\u5019\u8981\u6307\u5b9a routing-key\uff0c\u8fd8\u8981\u63a7\u5236\u5934\u90e8\u4fe1\u606f\u3002\u6d88\u8d39\u8005\u5728\u6d88\u8d39\u6d88\u606f\u4e4b\u524d\u4e5f\u8981\u8fdb\u884c\u4e0a\u9762\u4e00\u7cfb\u5217\u7684\u7e41\u7410\u8fc7\u7a0b\u3002\u4f46\u662f\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u867d\u7136\u6211\u4eec\u7684\u6d88\u606f\u961f\u5217\u53ea\u6709\u4e00\u7ec4\u6d88\u8d39\u8005\uff0c\u4f46\u8fd8\u662f\u9700\u8981\u7ecf\u5386\u4e0a\u9762\u8fd9\u4e9b\u7e41\u7410\u7684\u8fc7\u7a0b\u3002\n\n\u6709\u4e86 Redis\uff0c\u5b83\u5c31\u53ef\u4ee5\u8ba9\u6211\u4eec\u89e3\u8131\u51fa\u6765\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u53ea\u6709\u4e00\u7ec4\u6d88\u8d39\u8005\u7684\u6d88\u606f\u961f\u5217\uff0c\u4f7f\u7528 Redis \u5c31\u53ef\u4ee5\u975e\u5e38\u8f7b\u677e\u7684\u641e\u5b9a\u3002Redis \u7684\u6d88\u606f\u961f\u5217\u4e0d\u662f\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\uff0c\u5b83\u6ca1\u6709\u975e\u5e38\u591a\u7684\u9ad8\u7ea7\u7279\u6027\uff0c\u6ca1\u6709 ack \u4fdd\u8bc1\uff0c\u5982\u679c\u5bf9\u6d88\u606f\u7684\u53ef\u9760\u6027\u6709\u7740\u6781\u81f4\u7684\u8ffd\u6c42\uff0c\u90a3\u4e48\u5b83\u5c31\u4e0d\u9002\u5408\u4f7f\u7528\u3002\n\n\u5f02\u6b65\u6d88\u606f\u961f\u5217\n--\nRedis \u7684 list(\u5217\u8868) \u6570\u636e\u7ed3\u6784\u5e38\u7528\u6765\u4f5c\u4e3a\u5f02\u6b65\u6d88\u606f\u961f\u5217\u4f7f\u7528\uff0c\u4f7f\u7528```rpush/lpush```\u64cd\u4f5c\u5165\u961f\u5217\uff0c\u4f7f\u7528```lpop \u548c rpop```\u6765\u51fa\u961f\u5217\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/1648229e1dbfd776?w=862&h=179&f=png&s=17012)\n```\n> rpush notify-queue apple banana pear\n(integer) 3\n> llen notify-queue\n(integer) 3\n> lpop notify-queue\n\"apple\"\n> llen notify-queue\n(integer) 2\n> lpop notify-queue\n\"banana\"\n> llen notify-queue\n(integer) 1\n> lpop notify-queue\n\"pear\"\n> llen notify-queue\n(integer) 0\n> lpop notify-queue\n(nil)\n```\n\n\u4e0a\u9762\u662f rpush \u548c lpop \u7ed3\u5408\u4f7f\u7528\u7684\u4f8b\u5b50\u3002\u8fd8\u53ef\u4ee5\u4f7f\u7528 lpush \u548c rpop \u7ed3\u5408\u4f7f\u7528\uff0c\u6548\u679c\u662f\u4e00\u6837\u7684\u3002\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u961f\u5217\u7a7a\u4e86\u600e\u4e48\u529e\uff1f\n--\n\u5ba2\u6237\u7aef\u662f\u901a\u8fc7\u961f\u5217\u7684 pop \u64cd\u4f5c\u6765\u83b7\u53d6\u6d88\u606f\uff0c\u7136\u540e\u8fdb\u884c\u5904\u7406\u3002\u5904\u7406\u5b8c\u4e86\u518d\u63a5\u7740\u83b7\u53d6\u6d88\u606f\uff0c\u518d\u8fdb\u884c\u5904\u7406\u3002\u5982\u6b64\u5faa\u73af\u5f80\u590d\uff0c\u8fd9\u4fbf\u662f\u4f5c\u4e3a\u961f\u5217\u6d88\u8d39\u8005\u7684\u5ba2\u6237\u7aef\u7684\u751f\u547d\u5468\u671f\u3002\n\n\u53ef\u662f\u5982\u679c\u961f\u5217\u7a7a\u4e86\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u9677\u5165 pop \u7684\u6b7b\u5faa\u73af\uff0c\u4e0d\u505c\u5730 pop\uff0c\u6ca1\u6709\u6570\u636e\uff0c\u63a5\u7740\u518d pop\uff0c\u53c8\u6ca1\u6709\u6570\u636e\u3002\u8fd9\u5c31\u662f\u6d6a\u8d39\u751f\u547d\u7684\u7a7a\u8f6e\u8be2\u3002\u7a7a\u8f6e\u8be2\u4e0d\u4f46\u62c9\u9ad8\u4e86\u5ba2\u6237\u7aef\u7684 CPU\uff0credis \u7684 QPS \u4e5f\u4f1a\u88ab\u62c9\u9ad8\uff0c\u5982\u679c\u8fd9\u6837\u7a7a\u8f6e\u8be2\u7684\u5ba2\u6237\u7aef\u6709\u51e0\u5341\u6765\u4e2a\uff0cRedis \u7684\u6162\u67e5\u8be2\u53ef\u80fd\u4f1a\u663e\u8457\u589e\u591a\u3002\n\n\u901a\u5e38\u6211\u4eec\u4f7f\u7528 sleep \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8ba9\u7ebf\u7a0b\u7761\u4e00\u4f1a\uff0c\u7761\u4e2a 1s \u949f\u5c31\u53ef\u4ee5\u4e86\u3002\u4e0d\u4f46\u5ba2\u6237\u7aef\u7684 CPU \u80fd\u964d\u4e0b\u6765\uff0cRedis \u7684 QPS \u4e5f\u964d\u4e0b\u6765\u4e86\u3002\n```\ntime.sleep(1)  # python \u7761 1s\nThread.sleep(1000)  # java \u7761 1s\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164822ccec7ccb85?w=808&h=266&f=png&s=31608)\n\n\u961f\u5217\u5ef6\u8fdf\n--\n\u7528\u4e0a\u9762\u7761\u7720\u7684\u529e\u6cd5\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u3002\u4f46\u662f\u6709\u4e2a\u5c0f\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u7761\u7720\u4f1a\u5bfc\u81f4\u6d88\u606f\u7684\u5ef6\u8fdf\u589e\u5927\u3002\u5982\u679c\u53ea\u6709 1 \u4e2a\u6d88\u8d39\u8005\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5ef6\u8fdf\u5c31\u662f 1s\u3002\u5982\u679c\u6709\u591a\u4e2a\u6d88\u8d39\u8005\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u4f1a\u6709\u6240\u4e0b\u964d\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u6d88\u8d39\u8005\u7684\u7761\u89c9\u65f6\u95f4\u662f\u5c94\u5f00\u6765\u7684\u3002\n\n\u6709\u6ca1\u6709\u4ec0\u4e48\u529e\u6cd5\u80fd\u663e\u8457\u964d\u4f4e\u5ef6\u8fdf\u5462\uff1f\u4f60\u5f53\u7136\u53ef\u4ee5\u5f88\u5feb\u60f3\u5230\uff1a\u90a3\u5c31\u628a\u7761\u89c9\u7684\u65f6\u95f4\u7f29\u77ed\u70b9\u3002\u8fd9\u79cd\u65b9\u5f0f\u5f53\u7136\u53ef\u4ee5\uff0c\u4e0d\u8fc7\u6709\u6ca1\u6709\u66f4\u597d\u7684\u89e3\u51b3\u65b9\u6848\u5462\uff1f\u5f53\u7136\u4e5f\u6709\uff0c\u90a3\u5c31\u662f blpop/brpop\u3002\n\n\u8fd9\u4e24\u4e2a\u6307\u4ee4\u7684\u524d\u7f00\u5b57\u7b26```b```\u4ee3\u8868\u7684\u662f```blocking```\uff0c\u4e5f\u5c31\u662f\u963b\u585e\u8bfb\u3002\n\n\u963b\u585e\u8bfb\u5728\u961f\u5217\u6ca1\u6709\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u7acb\u5373\u8fdb\u5165\u4f11\u7720\u72b6\u6001\uff0c\u4e00\u65e6\u6570\u636e\u5230\u6765\uff0c\u5219\u7acb\u523b\u9192\u8fc7\u6765\u3002\u6d88\u606f\u7684\u5ef6\u8fdf\u51e0\u4e4e\u4e3a\u96f6\u3002\u7528```blpop/brpop```\u66ff\u4ee3\u524d\u9762\u7684```lpop/rpop```\uff0c\u5c31\u5b8c\u7f8e\u89e3\u51b3\u4e86\u4e0a\u9762\u7684\u95ee\u9898\u3002\n\n\u7a7a\u95f2\u8fde\u63a5\u81ea\u52a8\u65ad\u5f00\n--\n\u4f60\u4ee5\u4e3a\u4e0a\u9762\u7684\u65b9\u6848\u771f\u7684\u5f88\u5b8c\u7f8e\u4e48\uff1f\u5148\u522b\u6025\u7740\u5f00\u5fc3\uff0c\u5176\u5b9e\u4ed6\u8fd8\u6709\u4e2a\u95ee\u9898\u9700\u8981\u89e3\u51b3\u3002\n\n\u4ec0\u4e48\u95ee\u9898\uff1f\u2014\u2014 **\u7a7a\u95f2\u8fde\u63a5**\u7684\u95ee\u9898\u3002\n\n\u5982\u679c\u7ebf\u7a0b\u4e00\u76f4\u963b\u585e\u5728\u54ea\u91cc\uff0cRedis \u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u5c31\u6210\u4e86\u95f2\u7f6e\u8fde\u63a5\uff0c\u95f2\u7f6e\u8fc7\u4e45\uff0c\u670d\u52a1\u5668\u4e00\u822c\u4f1a\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\uff0c\u51cf\u5c11\u95f2\u7f6e\u8d44\u6e90\u5360\u7528\u3002\u8fd9\u4e2a\u65f6\u5019```blpop/brpop```\u4f1a\u629b\u51fa\u5f02\u5e38\u6765\u3002\n\n\u6240\u4ee5\u7f16\u5199\u5ba2\u6237\u7aef\u6d88\u8d39\u8005\u7684\u65f6\u5019\u8981\u5c0f\u5fc3\uff0c\u6ce8\u610f\u6355\u83b7\u5f02\u5e38\uff0c\u8fd8\u8981\u91cd\u8bd5\u3002\n\n\u9501\u51b2\u7a81\u5904\u7406\n--\n\u4e0a\u8282\u8bfe\u6211\u4eec\u8bb2\u4e86\u5206\u5e03\u5f0f\u9501\u7684\u95ee\u9898\uff0c\u4f46\u662f\u6ca1\u6709\u63d0\u5230\u5ba2\u6237\u7aef\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u52a0\u9501\u6ca1\u52a0\u6210\u529f\u600e\u4e48\u529e\u3002\u4e00\u822c\u6709 3 \u79cd\u7b56\u7565\u6765\u5904\u7406\u52a0\u9501\u5931\u8d25\uff1a\n1. \u76f4\u63a5\u629b\u51fa\u5f02\u5e38\uff0c\u901a\u77e5\u7528\u6237\u7a0d\u540e\u91cd\u8bd5\uff1b\n2. sleep \u4e00\u4f1a\u518d\u91cd\u8bd5\uff1b\n3. \u5c06\u8bf7\u6c42\u8f6c\u79fb\u81f3\u5ef6\u65f6\u961f\u5217\uff0c\u8fc7\u4e00\u4f1a\u518d\u8bd5\uff1b\n\n**\u76f4\u63a5\u629b\u51fa\u7279\u5b9a\u7c7b\u578b\u7684\u5f02\u5e38**\n\n\u8fd9\u79cd\u65b9\u5f0f\u6bd4\u8f83\u9002\u5408\u7531\u7528\u6237\u76f4\u63a5\u53d1\u8d77\u7684\u8bf7\u6c42\uff0c\u7528\u6237\u770b\u5230\u9519\u8bef\u5bf9\u8bdd\u6846\u540e\uff0c\u4f1a\u5148\u9605\u8bfb\u5bf9\u8bdd\u6846\u7684\u5185\u5bb9\uff0c\u518d\u70b9\u51fb\u91cd\u8bd5\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8d77\u5230\u4eba\u5de5\u5ef6\u65f6\u7684\u6548\u679c\u3002\u5982\u679c\u8003\u8651\u5230\u7528\u6237\u4f53\u9a8c\uff0c\u53ef\u4ee5\u7531\u524d\u7aef\u7684\u4ee3\u7801\u66ff\u4ee3\u7528\u6237\u81ea\u5df1\u6765\u8fdb\u884c\u5ef6\u65f6\u91cd\u8bd5\u63a7\u5236\u3002\u5b83\u672c\u8d28\u4e0a\u662f\u5bf9\u5f53\u524d\u8bf7\u6c42\u7684\u653e\u5f03\uff0c\u7531\u7528\u6237\u51b3\u5b9a\u662f\u5426\u91cd\u65b0\u53d1\u8d77\u65b0\u7684\u8bf7\u6c42\u3002\n\n**sleep**\n\nsleep \u4f1a\u963b\u585e\u5f53\u524d\u7684\u6d88\u606f\u5904\u7406\u7ebf\u7a0b\uff0c\u4f1a\u5bfc\u81f4\u961f\u5217\u7684\u540e\u7eed\u6d88\u606f\u5904\u7406\u51fa\u73b0\u5ef6\u8fdf\u3002\u5982\u679c\u78b0\u649e\u7684\u6bd4\u8f83\u9891\u7e41\u6216\u8005\u961f\u5217\u91cc\u6d88\u606f\u6bd4\u8f83\u591a\uff0csleep \u53ef\u80fd\u5e76\u4e0d\u5408\u9002\u3002\u5982\u679c\u56e0\u4e3a\u4e2a\u522b\u6b7b\u9501\u7684 key \u5bfc\u81f4\u52a0\u9501\u4e0d\u6210\u529f\uff0c\u7ebf\u7a0b\u4f1a\u5f7b\u5e95\u5835\u6b7b\uff0c\u5bfc\u81f4\u540e\u7eed\u6d88\u606f\u6c38\u8fdc\u5f97\u4e0d\u5230\u53ca\u65f6\u5904\u7406\u3002\n\n**\u5ef6\u65f6\u961f\u5217**\n\n\u8fd9\u79cd\u65b9\u5f0f\u6bd4\u8f83\u9002\u5408\u5f02\u6b65\u6d88\u606f\u5904\u7406\uff0c\u5c06\u5f53\u524d\u51b2\u7a81\u7684\u8bf7\u6c42\u6254\u5230\u53e6\u4e00\u4e2a\u961f\u5217\u5ef6\u540e\u5904\u7406\u4ee5\u907f\u5f00\u51b2\u7a81\u3002\n\n\u5ef6\u65f6\u961f\u5217\u7684\u5b9e\u73b0\n--\n\u5ef6\u65f6\u961f\u5217\u53ef\u4ee5\u901a\u8fc7 Redis \u7684 zset(\u6709\u5e8f\u5217\u8868) \u6765\u5b9e\u73b0\u3002\u6211\u4eec\u5c06\u6d88\u606f\u5e8f\u5217\u5316\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\u4f5c\u4e3a zset \u7684```value```\uff0c\u8fd9\u4e2a\u6d88\u606f\u7684\u5230\u671f\u5904\u7406\u65f6\u95f4\u4f5c\u4e3a```score```\uff0c\u7136\u540e\u7528\u591a\u4e2a\u7ebf\u7a0b\u8f6e\u8be2 zset \u83b7\u53d6\u5230\u671f\u7684\u4efb\u52a1\u8fdb\u884c\u5904\u7406\uff0c\u591a\u4e2a\u7ebf\u7a0b\u662f\u4e3a\u4e86\u4fdd\u969c\u53ef\u7528\u6027\uff0c\u4e07\u4e00\u6302\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u8fd8\u6709\u5176\u5b83\u7ebf\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u5904\u7406\u3002\u56e0\u4e3a\u6709\u591a\u4e2a\u7ebf\u7a0b\uff0c\u6240\u4ee5\u9700\u8981\u8003\u8651\u5e76\u53d1\u4e89\u62a2\u4efb\u52a1\uff0c\u786e\u4fdd\u4efb\u52a1\u4e0d\u80fd\u88ab\u591a\u6b21\u6267\u884c\u3002\n\n```py\ndef delay(msg):\n    msg.id = str(uuid.uuid4())  # \u4fdd\u8bc1 value \u503c\u552f\u4e00\n    value = json.dumps(msg)\n    retry_ts = time.time() + 5  # 5 \u79d2\u540e\u91cd\u8bd5\n    redis.zadd(\"delay-queue\", retry_ts, value)\n\n\ndef loop():\n    while True:\n        # \u6700\u591a\u53d6 1 \u6761\n        values = redis.zrangebyscore(\"delay-queue\", 0, time.time(), start=0, num=1)\n        if not values:\n            time.sleep(1)  # \u5ef6\u65f6\u961f\u5217\u7a7a\u7684\uff0c\u4f11\u606f 1s\n            continue\n        value = values[0]  # \u62ff\u7b2c\u4e00\u6761\uff0c\u4e5f\u53ea\u6709\u4e00\u6761\n        success = redis.zrem(\"delay-queue\", value)  # \u4ece\u6d88\u606f\u961f\u5217\u4e2d\u79fb\u9664\u8be5\u6d88\u606f\n        if success:  # \u56e0\u4e3a\u6709\u591a\u8fdb\u7a0b\u5e76\u53d1\u7684\u53ef\u80fd\uff0c\u6700\u7ec8\u53ea\u4f1a\u6709\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u62a2\u5230\u6d88\u606f\n            msg = json.loads(value)\n            handle_msg(msg)\n```\nRedis \u7684 zrem \u65b9\u6cd5\u662f\u591a\u7ebf\u7a0b\u591a\u8fdb\u7a0b\u4e89\u62a2\u4efb\u52a1\u7684\u5173\u952e\uff0c\u5b83\u7684\u8fd4\u56de\u503c\u51b3\u5b9a\u4e86\u5f53\u524d\u5b9e\u4f8b\u6709\u6ca1\u6709\u62a2\u5230\u4efb\u52a1\uff0c\u56e0\u4e3a loop \u65b9\u6cd5\u53ef\u80fd\u4f1a\u88ab\u591a\u4e2a\u7ebf\u7a0b\u3001\u591a\u4e2a\u8fdb\u7a0b\u8c03\u7528\uff0c\u540c\u4e00\u4e2a\u4efb\u52a1\u53ef\u80fd\u4f1a\u88ab\u591a\u4e2a\u8fdb\u7a0b\u7ebf\u7a0b\u62a2\u5230\uff0c\u901a\u8fc7 zrem \u6765\u51b3\u5b9a\u552f\u4e00\u7684\u5c5e\u4e3b\u3002\n\n\u540c\u65f6\uff0c\u6211\u4eec\u8981\u6ce8\u610f\u4e00\u5b9a\u8981\u5bf9 handle_msg \u8fdb\u884c\u5f02\u5e38\u6355\u83b7\uff0c\u907f\u514d\u56e0\u4e3a\u4e2a\u522b\u4efb\u52a1\u5904\u7406\u95ee\u9898\u5bfc\u81f4\u5faa\u73af\u5f02\u5e38\u9000\u51fa\u3002\u4ee5\u4e0b\u662f Java \u7248\u672c\u7684\u5ef6\u65f6\u961f\u5217\u5b9e\u73b0\uff0c\u56e0\u4e3a\u8981\u4f7f\u7528\u5230 Json \u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u8fd8\u9700\u8981 fastjson \u5e93\u7684\u652f\u6301\u3002\n```java\nimport java.lang.reflect.Type;\nimport java.util.Set;\nimport java.util.UUID;\n\nimport com.alibaba.fastjson.JSON;\nimport com.alibaba.fastjson.TypeReference;\n\nimport redis.clients.jedis.Jedis;\n\npublic class RedisDelayingQueue<T> {\n\n  static class TaskItem<T> {\n    public String id;\n    public T msg;\n  }\n\n  // fastjson \u5e8f\u5217\u5316\u5bf9\u8c61\u4e2d\u5b58\u5728 generic \u7c7b\u578b\u65f6\uff0c\u9700\u8981\u4f7f\u7528 TypeReference\n  private Type TaskType = new TypeReference<TaskItem<T>>() {\n  }.getType();\n\n  private Jedis jedis;\n  private String queueKey;\n\n  public RedisDelayingQueue(Jedis jedis, String queueKey) {\n    this.jedis = jedis;\n    this.queueKey = queueKey;\n  }\n\n  public void delay(T msg) {\n    TaskItem<T> task = new TaskItem<T>();\n    task.id = UUID.randomUUID().toString(); // \u5206\u914d\u552f\u4e00\u7684 uuid\n    task.msg = msg;\n    String s = JSON.toJSONString(task); // fastjson \u5e8f\u5217\u5316\n    jedis.zadd(queueKey, System.currentTimeMillis() + 5000, s); // \u585e\u5165\u5ef6\u65f6\u961f\u5217 ,5s \u540e\u518d\u8bd5\n  }\n\n  public void loop() {\n    while (!Thread.interrupted()) {\n      // \u53ea\u53d6\u4e00\u6761\n      Set<String> values = jedis.zrangeByScore(queueKey, 0, System.currentTimeMillis(), 0, 1);\n      if (values.isEmpty()) {\n        try {\n          Thread.sleep(500); // \u6b47\u4f1a\u7ee7\u7eed\n        } catch (InterruptedException e) {\n          break;\n        }\n        continue;\n      }\n      String s = values.iterator().next();\n      if (jedis.zrem(queueKey, s) > 0) { // \u62a2\u5230\u4e86\n        TaskItem<T> task = JSON.parseObject(s, TaskType); // fastjson \u53cd\u5e8f\u5217\u5316\n        this.handleMsg(task.msg);\n      }\n    }\n  }\n\n  public void handleMsg(T msg) {\n    System.out.println(msg);\n  }\n\n  public static void main(String[] args) {\n    Jedis jedis = new Jedis();\n    RedisDelayingQueue<String> queue = new RedisDelayingQueue<>(jedis, \"q-demo\");\n    Thread producer = new Thread() {\n\n      public void run() {\n        for (int i = 0; i < 10; i++) {\n          queue.delay(\"codehole\" + i);\n        }\n      }\n\n    };\n    Thread consumer = new Thread() {\n\n      public void run() {\n        queue.loop();\n      }\n\n    };\n    producer.start();\n    consumer.start();\n    try {\n      producer.join();\n      Thread.sleep(6000);\n      consumer.interrupt();\n      consumer.join();\n    } catch (InterruptedException e) {\n    }\n  }\n}\n```\n\n## \u8fdb\u4e00\u6b65\u4f18\u5316\n\u4e0a\u9762\u7684\u7b97\u6cd5\u4e2d\u540c\u4e00\u4e2a\u4efb\u52a1\u53ef\u80fd\u4f1a\u88ab\u591a\u4e2a\u8fdb\u7a0b\u53d6\u5230\u4e4b\u540e\u518d\u4f7f\u7528 zrem \u8fdb\u884c\u4e89\u62a2\uff0c\u90a3\u4e9b\u6ca1\u62a2\u5230\u7684\u8fdb\u7a0b\u90fd\u662f\u767d\u53d6\u4e86\u4e00\u6b21\u4efb\u52a1\uff0c\u8fd9\u662f\u6d6a\u8d39\u3002\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 lua scripting \u6765\u4f18\u5316\u4e00\u4e0b\u8fd9\u4e2a\u903b\u8f91\uff0c\u5c06 zrangebyscore \u548c zrem \u4e00\u540c\u632a\u5230\u670d\u52a1\u5668\u7aef\u8fdb\u884c\u539f\u5b50\u5316\u64cd\u4f5c\uff0c\u8fd9\u6837\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u4e89\u62a2\u4efb\u52a1\u65f6\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u6d6a\u8d39\u4e86\u3002\n\n\u601d\u8003\n--\n1. Redis \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u4fdd\u8bc1 100% \u7684\u53ef\u9760\u6027\uff1f\n2. \u4f7f\u7528 Lua Scripting \u6765\u4f18\u5316\u5ef6\u65f6\u961f\u5217\u7684\u903b\u8f91\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/3\u5e94\u7528_2\u7f13\u5175\u4e4b\u8ba1__\u5ef6\u65f6\u961f\u5217.md", "create_date": "2020-02-18T03:00:32.805", "order": 4}}, {"model": "subject.chapter", "pk": 14, "fields": {"title": "4\u5e94\u7528 3\uff1a\u8282\u8863\u7f29\u98df \u2014\u2014 \u4f4d\u56fe", "topic": 2, "md5": "b82cb82696567620e6204debc7f2e2db", "md_body": "# \u5e94\u7528 3\uff1a\u8282\u8863\u7f29\u98df \u2014\u2014 \u4f4d\u56fe\n\n\u5728\u6211\u4eec\u5e73\u65f6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u6709\u4e00\u4e9b bool \u578b\u6570\u636e\u9700\u8981\u5b58\u53d6\uff0c\u6bd4\u5982\u7528\u6237\u4e00\u5e74\u7684\u7b7e\u5230\u8bb0\u5f55\uff0c\u7b7e\u4e86\u662f 1\uff0c\u6ca1\u7b7e\u662f 0\uff0c\u8981\u8bb0\u5f55 365 \u5929\u3002\u5982\u679c\u4f7f\u7528\u666e\u901a\u7684 key/value\uff0c\u6bcf\u4e2a\u7528\u6237\u8981\u8bb0\u5f55 365 \u4e2a\uff0c\u5f53\u7528\u6237\u4e0a\u4ebf\u7684\u65f6\u5019\uff0c\u9700\u8981\u7684\u5b58\u50a8\u7a7a\u95f4\u662f\u60ca\u4eba\u7684\u3002\n\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u63d0\u4f9b\u4e86\u4f4d\u56fe\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u6837\u6bcf\u5929\u7684\u7b7e\u5230\u8bb0\u5f55\u53ea\u5360\u636e\u4e00\u4e2a\u4f4d\uff0c365 \u5929\u5c31\u662f 365 \u4e2a\u4f4d\uff0c46 \u4e2a\u5b57\u8282 (\u4e00\u4e2a\u7a0d\u957f\u4e00\u70b9\u7684\u5b57\u7b26\u4e32) \u5c31\u53ef\u4ee5\u5b8c\u5168\u5bb9\u7eb3\u4e0b\uff0c\u8fd9\u5c31\u5927\u5927\u8282\u7ea6\u4e86\u5b58\u50a8\u7a7a\u95f4\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/1645926f4520d0ce?w=512&h=64&f=gif&s=28880)\n\n\u4f4d\u56fe\u4e0d\u662f\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u7684\u5185\u5bb9\u5176\u5b9e\u5c31\u662f\u666e\u901a\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u5c31\u662f byte \u6570\u7ec4\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u666e\u901a\u7684 get/set \u76f4\u63a5\u83b7\u53d6\u548c\u8bbe\u7f6e\u6574\u4e2a\u4f4d\u56fe\u7684\u5185\u5bb9\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4f4d\u56fe\u64cd\u4f5c getbit/setbit \u7b49\u5c06 byte \u6570\u7ec4\u770b\u6210\u300c\u4f4d\u6570\u7ec4\u300d\u6765\u5904\u7406\u3002\n\n\u5f53\u6211\u4eec\u8981\u7edf\u8ba1\u6708\u6d3b\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u9700\u8981\u53bb\u91cd\uff0c\u9700\u8981\u4f7f\u7528 set \u6765\u8bb0\u5f55\u6240\u6709\u6d3b\u8dc3\u7528\u6237\u7684 id\uff0c\u8fd9\u975e\u5e38\u6d6a\u8d39\u5185\u5b58\u3002\u8fd9\u65f6\u5c31\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u4f4d\u56fe\u6765\u6807\u8bb0\u7528\u6237\u7684\u6d3b\u8dc3\u72b6\u6001\u3002\u6bcf\u4e2a\u7528\u6237\u4f1a\u90fd\u5728\u8fd9\u4e2a\u4f4d\u56fe\u7684\u4e00\u4e2a\u786e\u5b9a\u4f4d\u7f6e\u4e0a\uff0c0 \u8868\u793a\u4e0d\u6d3b\u8dc3\uff0c1 \u8868\u793a\u6d3b\u8dc3\u3002\u7136\u540e\u5230\u6708\u5e95\u904d\u5386\u4e00\u6b21\u4f4d\u56fe\u5c31\u53ef\u4ee5\u5f97\u5230\u6708\u5ea6\u6d3b\u8dc3\u7528\u6237\u6570\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u662f\u6709\u6761\u4ef6\u7684\uff0c\u90a3\u5c31\u662f userid \u662f\u6574\u6570\u8fde\u7eed\u7684\uff0c\u5e76\u4e14\u6d3b\u8dc3\u5360\u6bd4\u8f83\u9ad8\uff0c\u5426\u5219\u53ef\u80fd\u5f97\u4e0d\u507f\u5931\u3002\n\n\u672c\u8282\u7565\u663e\u67af\u71e5\uff0c\u5982\u679c\u8bfb\u8005\u770b\u7684\u6709\u70b9\u8499\uff0c\u8fd9\u662f\u6b63\u5e38\u73b0\u8c61\uff0c\u8bfb\u8005\u53ef\u4ee5\u8df3\u8fc7\u9605\u8bfb\u4e0b\u4e00\u8282\u3002\u4ee5\u8001\u94b1\u7684\u7ecf\u9a8c\uff0c\u5728\u9762\u8bd5\u4e2d\u6709 Redis \u4f4d\u56fe\u4f7f\u7528\u7ecf\u9a8c\u7684\u540c\u5b66\u5f88\u5c11\uff0c\u5982\u679c\u4f60\u5bf9 Redis \u7684\u4f4d\u56fe\u6709\u6240\u4e86\u89e3\uff0c\u5b83\u5c06\u4f1a\u662f\u4f60\u7684\u9762\u8bd5\u52a0\u5206\u9879\u3002\n\n## \u57fa\u672c\u4f7f\u7528\nRedis \u7684\u4f4d\u6570\u7ec4\u662f\u81ea\u52a8\u6269\u5c55\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u67d0\u4e2a\u504f\u79fb\u4f4d\u7f6e\u8d85\u51fa\u4e86\u73b0\u6709\u7684\u5185\u5bb9\u8303\u56f4\uff0c\u5c31\u4f1a\u81ea\u52a8\u5c06\u4f4d\u6570\u7ec4\u8fdb\u884c\u96f6\u6269\u5145\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528\u4f4d\u64cd\u4f5c\u5c06\u5b57\u7b26\u4e32\u8bbe\u7f6e\u4e3a hello (\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528 set \u6307\u4ee4)\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u5f97\u5230 hello \u7684 ASCII \u7801\uff0c\u7528 Python \u547d\u4ee4\u884c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5f97\u5230\u6bcf\u4e2a\u5b57\u7b26\u7684 ASCII \u7801\u7684\u4e8c\u8fdb\u5236\u503c\u3002\n```\n>>> bin(ord('h'))\n'0b1101000'   # \u9ad8\u4f4d -> \u4f4e\u4f4d\n>>> bin(ord('e'))\n'0b1100101'\n>>> bin(ord('l'))\n'0b1101100'\n>>> bin(ord('l'))\n'0b1101100'\n>>> bin(ord('o'))\n'0b1101111'\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/16459860644097de?w=512&h=300&f=gif&s=291045)\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528 redis-cli \u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u4e5f\u5c31\u662f\u4f4d\u6570\u7ec4\u7684\u524d 8 \u4f4d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8bbe\u7f6e\u503c\u4e3a 1 \u7684\u4f4d\uff0c\u5982\u4e0a\u56fe\u6240\u793a\uff0ch \u5b57\u7b26\u53ea\u6709 1/2/4 \u4f4d\u9700\u8981\u8bbe\u7f6e\uff0ce \u5b57\u7b26\u53ea\u6709 9/10/13/15 \u4f4d\u9700\u8981\u8bbe\u7f6e\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\u4f4d\u6570\u7ec4\u7684\u987a\u5e8f\u548c\u5b57\u7b26\u7684\u4f4d\u987a\u5e8f\u662f\u76f8\u53cd\u7684\u3002\n```\n127.0.0.1:6379> setbit s 1 1\n(integer) 0\n127.0.0.1:6379> setbit s 2 1\n(integer) 0\n127.0.0.1:6379> setbit s 4 1\n(integer) 0\n127.0.0.1:6379> setbit s 9 1\n(integer) 0\n127.0.0.1:6379> setbit s 10 1\n(integer) 0\n127.0.0.1:6379> setbit s 13 1\n(integer) 0\n127.0.0.1:6379> setbit s 15 1\n(integer) 0\n127.0.0.1:6379> get s\n\"he\"\n```\n\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u7406\u89e3\u4e3a\u300c\u96f6\u5b58\u6574\u53d6\u300d\uff0c\u540c\u6837\u6211\u4eec\u8fd8\u4e5f\u53ef\u4ee5\u300c\u96f6\u5b58\u96f6\u53d6\u300d\uff0c\u300c\u6574\u5b58\u96f6\u53d6\u300d\u3002\u300c\u96f6\u5b58\u300d\u5c31\u662f\u4f7f\u7528 setbit \u5bf9\u4f4d\u503c\u8fdb\u884c\u9010\u4e2a\u8bbe\u7f6e\uff0c\u300c\u6574\u5b58\u300d\u5c31\u662f\u4f7f\u7528\u5b57\u7b26\u4e32\u4e00\u6b21\u6027\u586b\u5145\u6240\u6709\u4f4d\u6570\u7ec4\uff0c\u8986\u76d6\u6389\u65e7\u503c\u3002\n\n**\u96f6\u5b58\u96f6\u53d6**\n```\n127.0.0.1:6379> setbit w 1 1\n(integer) 0\n127.0.0.1:6379> setbit w 2 1\n(integer) 0\n127.0.0.1:6379> setbit w 4 1\n(integer) 0\n127.0.0.1:6379> getbit w 1  # \u83b7\u53d6\u67d0\u4e2a\u5177\u4f53\u4f4d\u7f6e\u7684\u503c 0/1\n(integer) 1\n127.0.0.1:6379> getbit w 2\n(integer) 1\n127.0.0.1:6379> getbit w 4\n(integer) 1\n127.0.0.1:6379> getbit w 5\n(integer) 0\n```\n\n**\u6574\u5b58\u96f6\u53d6**\n\n```\n127.0.0.1:6379> set w h  # \u6574\u5b58\n(integer) 0\n127.0.0.1:6379> getbit w 1\n(integer) 1\n127.0.0.1:6379> getbit w 2\n(integer) 1\n127.0.0.1:6379> getbit w 4\n(integer) 1\n127.0.0.1:6379> getbit w 5\n(integer) 0\n```\n\n\u5982\u679c\u5bf9\u5e94\u4f4d\u7684\u5b57\u8282\u662f\u4e0d\u53ef\u6253\u5370\u5b57\u7b26\uff0credis-cli \u4f1a\u663e\u793a\u8be5\u5b57\u7b26\u7684 16 \u8fdb\u5236\u5f62\u5f0f\u3002\n```\n127.0.0.1:6379> setbit x 0 1\n(integer) 0\n127.0.0.1:6379> setbit x 1 1\n(integer) 0\n127.0.0.1:6379> get x\n\"\\xc0\"\n```\n\n## \u7edf\u8ba1\u548c\u67e5\u627e\nRedis \u63d0\u4f9b\u4e86\u4f4d\u56fe\u7edf\u8ba1\u6307\u4ee4 bitcount \u548c\u4f4d\u56fe\u67e5\u627e\u6307\u4ee4 bitpos\uff0cbitcount \u7528\u6765\u7edf\u8ba1\u6307\u5b9a\u4f4d\u7f6e\u8303\u56f4\u5185 1 \u7684\u4e2a\u6570\uff0cbitpos \u7528\u6765\u67e5\u627e\u6307\u5b9a\u8303\u56f4\u5185\u51fa\u73b0\u7684\u7b2c\u4e00\u4e2a 0 \u6216 1\u3002\n\n\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 bitcount \u7edf\u8ba1\u7528\u6237\u4e00\u5171\u7b7e\u5230\u4e86\u591a\u5c11\u5929\uff0c\u901a\u8fc7 bitpos \u6307\u4ee4\u67e5\u627e\u7528\u6237\u4ece\u54ea\u4e00\u5929\u5f00\u59cb\u7b2c\u4e00\u6b21\u7b7e\u5230\u3002\u5982\u679c\u6307\u5b9a\u4e86\u8303\u56f4\u53c2\u6570` [start, end]`\uff0c\u5c31\u53ef\u4ee5\u7edf\u8ba1\u5728\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\u7528\u6237\u7b7e\u5230\u4e86\u591a\u5c11\u5929\uff0c\u7528\u6237\u81ea\u67d0\u5929\u4ee5\u540e\u7684\u54ea\u5929\u5f00\u59cb\u7b7e\u5230\u3002\n\n\u9057\u61be\u7684\u662f\uff0c start \u548c end \u53c2\u6570\u662f\u5b57\u8282\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u8bf4\u6307\u5b9a\u7684\u4f4d\u8303\u56f4\u5fc5\u987b\u662f 8 \u7684\u500d\u6570\uff0c\u800c\u4e0d\u80fd\u4efb\u610f\u6307\u5b9a\u3002\u8fd9\u5f88\u5947\u602a\uff0c\u6211\u8868\u793a\u4e0d\u662f\u5f88\u80fd\u7406\u89e3 Antirez \u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u8bbe\u8ba1\u3002\u56e0\u4e3a\u8fd9\u4e2a\u8bbe\u8ba1\uff0c\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u8ba1\u7b97\u67d0\u4e2a\u6708\u5185\u7528\u6237\u7b7e\u5230\u4e86\u591a\u5c11\u5929\uff0c\u800c\u5fc5\u987b\u8981\u5c06\u8fd9\u4e2a\u6708\u6240\u8986\u76d6\u7684\u5b57\u8282\u5185\u5bb9\u5168\u90e8\u53d6\u51fa\u6765 (getrange \u53ef\u4ee5\u53d6\u51fa\u5b57\u7b26\u4e32\u7684\u5b50\u4e32) \u7136\u540e\u5728\u5185\u5b58\u91cc\u8fdb\u884c\u7edf\u8ba1\uff0c\u8fd9\u4e2a\u975e\u5e38\u7e41\u7410\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u7b80\u5355\u8bd5\u7528\u4e00\u4e0b bitcount \u6307\u4ee4\u548c bitpos \u6307\u4ee4:\n```\n127.0.0.1:6379> set w hello\nOK\n127.0.0.1:6379> bitcount w\n(integer) 21\n127.0.0.1:6379> bitcount w 0 0  # \u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e2d 1 \u7684\u4f4d\u6570\n(integer) 3\n127.0.0.1:6379> bitcount w 0 1  # \u524d\u4e24\u4e2a\u5b57\u7b26\u4e2d 1 \u7684\u4f4d\u6570\n(integer) 7\n127.0.0.1:6379> bitpos w 0  # \u7b2c\u4e00\u4e2a 0 \u4f4d\n(integer) 0\n127.0.0.1:6379> bitpos w 1  # \u7b2c\u4e00\u4e2a 1 \u4f4d\n(integer) 1\n127.0.0.1:6379> bitpos w 1 1 1  # \u4ece\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u7b97\u8d77\uff0c\u7b2c\u4e00\u4e2a 1 \u4f4d\n(integer) 9\n127.0.0.1:6379> bitpos w 1 2 2  # \u4ece\u7b2c\u4e09\u4e2a\u5b57\u7b26\u7b97\u8d77\uff0c\u7b2c\u4e00\u4e2a 1 \u4f4d\n(integer) 17\n```\n\n## \u9b54\u672f\u6307\u4ee4 bitfield\n\u524d\u6587\u6211\u4eec\u8bbe\u7f6e (setbit) \u548c\u83b7\u53d6 (getbit) \u6307\u5b9a\u4f4d\u7684\u503c\u90fd\u662f\u5355\u4e2a\u4f4d\u7684\uff0c\u5982\u679c\u8981\u4e00\u6b21\u64cd\u4f5c\u591a\u4e2a\u4f4d\uff0c\u5c31\u5fc5\u987b\u4f7f\u7528\u7ba1\u9053\u6765\u5904\u7406\u3002\n\n\u4e0d\u8fc7 Redis \u7684 3.2 \u7248\u672c\u4ee5\u540e\u65b0\u589e\u4e86\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684\u6307\u4ee4\uff0c\u6709\u4e86\u8fd9\u6761\u6307\u4ee4\uff0c\u4e0d\u7528\u7ba1\u9053\u4e5f\u53ef\u4ee5\u4e00\u6b21\u8fdb\u884c\u591a\u4e2a\u4f4d\u7684\u64cd\u4f5c\u3002\n\nbitfield \u6709\u4e09\u4e2a\u5b50\u6307\u4ee4\uff0c\u5206\u522b\u662f get/set/incrby\uff0c\u5b83\u4eec\u90fd\u53ef\u4ee5\u5bf9\u6307\u5b9a\u4f4d\u7247\u6bb5\u8fdb\u884c\u8bfb\u5199\uff0c\u4f46\u662f\u6700\u591a\u53ea\u80fd\u5904\u7406 64 \u4e2a\u8fde\u7eed\u7684\u4f4d\uff0c\u5982\u679c\u8d85\u8fc7 64 \u4f4d\uff0c\u5c31\u5f97\u4f7f\u7528\u591a\u4e2a\u5b50\u6307\u4ee4\uff0cbitfield \u53ef\u4ee5\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u5b50\u6307\u4ee4\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/1645987653a2b337?w=732&h=400&f=png&s=24057)\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5bf9\u7167\u7740\u4e0a\u9762\u7684\u56fe\u770b\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50:\n```\n127.0.0.1:6379> set w hello\nOK\n127.0.0.1:6379> bitfield w get u4 0  # \u4ece\u7b2c\u4e00\u4e2a\u4f4d\u5f00\u59cb\u53d6 4 \u4e2a\u4f4d\uff0c\u7ed3\u679c\u662f\u65e0\u7b26\u53f7\u6570 (u)\n(integer) 6\n127.0.0.1:6379> bitfield w get u3 2  # \u4ece\u7b2c\u4e09\u4e2a\u4f4d\u5f00\u59cb\u53d6 3 \u4e2a\u4f4d\uff0c\u7ed3\u679c\u662f\u65e0\u7b26\u53f7\u6570 (u)\n(integer) 5\n127.0.0.1:6379> bitfield w get i4 0  # \u4ece\u7b2c\u4e00\u4e2a\u4f4d\u5f00\u59cb\u53d6 4 \u4e2a\u4f4d\uff0c\u7ed3\u679c\u662f\u6709\u7b26\u53f7\u6570 (i)\n1) (integer) 6\n127.0.0.1:6379> bitfield w get i3 2  # \u4ece\u7b2c\u4e09\u4e2a\u4f4d\u5f00\u59cb\u53d6 3 \u4e2a\u4f4d\uff0c\u7ed3\u679c\u662f\u6709\u7b26\u53f7\u6570 (i)\n1) (integer) -3\n```\n\u6240\u8c13\u6709\u7b26\u53f7\u6570\u662f\u6307\u83b7\u53d6\u7684\u4f4d\u6570\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u4f4d\u662f\u7b26\u53f7\u4f4d\uff0c\u5269\u4e0b\u7684\u624d\u662f\u503c\u3002\u5982\u679c\u7b2c\u4e00\u4f4d\u662f 1\uff0c\u90a3\u5c31\u662f\u8d1f\u6570\u3002\u65e0\u7b26\u53f7\u6570\u8868\u793a\u975e\u8d1f\u6570\uff0c\u6ca1\u6709\u7b26\u53f7\u4f4d\uff0c\u83b7\u53d6\u7684\u4f4d\u6570\u7ec4\u5168\u90e8\u90fd\u662f\u503c\u3002\u6709\u7b26\u53f7\u6570\u6700\u591a\u53ef\u4ee5\u83b7\u53d6 64 \u4f4d\uff0c\u65e0\u7b26\u53f7\u6570\u53ea\u80fd\u83b7\u53d6 63 \u4f4d (\u56e0\u4e3a Redis \u534f\u8bae\u4e2d\u7684 integer \u662f\u6709\u7b26\u53f7\u6570\uff0c\u6700\u5927 64 \u4f4d\uff0c\u4e0d\u80fd\u4f20\u9012 64 \u4f4d\u65e0\u7b26\u53f7\u503c)\u3002\u5982\u679c\u8d85\u51fa\u4f4d\u6570\u9650\u5236\uff0cRedis \u5c31\u4f1a\u544a\u8bc9\u4f60\u53c2\u6570\u9519\u8bef\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u5b50\u6307\u4ee4:\n```\n127.0.0.1:6379> bitfield w get u4 0 get u3 2 get i4 0 get i3 2\n1) (integer) 6\n2) (integer) 5\n3) (integer) 6\n4) (integer) -3\n```\nwow\uff0c\u5f88\u9b54\u6cd5\u6709\u6ca1\u6709\uff01\n\n\u7136\u540e\u6211\u4eec\u4f7f\u7528 set \u5b50\u6307\u4ee4\u5c06\u7b2c\u4e8c\u4e2a\u5b57\u7b26 e \u6539\u6210 a\uff0ca \u7684 ASCII \u7801\u662f 97\uff0c\u8fd4\u56de\u65e7\u503c\u3002\n```\n127.0.0.1:6379> bitfield w set u8 8 97  # \u4ece\u7b2c 9 \u4e2a\u4f4d\u5f00\u59cb\uff0c\u5c06\u63a5\u4e0b\u6765\u7684 8 \u4e2a\u4f4d\u7528\u65e0\u7b26\u53f7\u6570 97 \u66ff\u6362\n1) (integer) 101\n127.0.0.1:6379> get w\n\"hallo\"\n```\n\n\u518d\u770b\u7b2c\u4e09\u4e2a\u5b50\u6307\u4ee4 incrby\uff0c\u5b83\u7528\u6765\u5bf9\u6307\u5b9a\u8303\u56f4\u7684\u4f4d\u8fdb\u884c\u81ea\u589e\u64cd\u4f5c\u3002\u65e2\u7136\u63d0\u5230\u81ea\u589e\uff0c\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u6ea2\u51fa\u3002\u5982\u679c\u589e\u52a0\u4e86\u6b63\u6570\uff0c\u4f1a\u51fa\u73b0\u4e0a\u6ea2\uff0c\u5982\u679c\u589e\u52a0\u7684\u662f\u8d1f\u6570\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0b\u6ea2\u51fa\u3002Redis \u9ed8\u8ba4\u7684\u5904\u7406\u662f\u6298\u8fd4\u3002\u5982\u679c\u51fa\u73b0\u4e86\u6ea2\u51fa\uff0c\u5c31\u5c06\u6ea2\u51fa\u7684\u7b26\u53f7\u4f4d\u4e22\u6389\u3002\u5982\u679c\u662f 8 \u4f4d\u65e0\u7b26\u53f7\u6570 255\uff0c\u52a0 1 \u540e\u5c31\u4f1a\u6ea2\u51fa\uff0c\u4f1a\u5168\u90e8\u53d8\u96f6\u3002\u5982\u679c\u662f 8 \u4f4d\u6709\u7b26\u53f7\u6570 127\uff0c\u52a0 1 \u540e\u5c31\u4f1a\u6ea2\u51fa\u53d8\u6210 -128\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5b9e\u8df5\u4e00\u4e0b\u8fd9\u4e2a\u5b50\u6307\u4ee4 incrby :\n```\n127.0.0.1:6379> set w hello\nOK\n127.0.0.1:6379> bitfield w incrby u4 2 1  # \u4ece\u7b2c\u4e09\u4e2a\u4f4d\u5f00\u59cb\uff0c\u5bf9\u63a5\u4e0b\u6765\u7684 4 \u4f4d\u65e0\u7b26\u53f7\u6570 +1\n1) (integer) 11\n127.0.0.1:6379> bitfield w incrby u4 2 1\n1) (integer) 12\n127.0.0.1:6379> bitfield w incrby u4 2 1\n1) (integer) 13\n127.0.0.1:6379> bitfield w incrby u4 2 1\n1) (integer) 14\n127.0.0.1:6379> bitfield w incrby u4 2 1\n1) (integer) 15\n127.0.0.1:6379> bitfield w incrby u4 2 1  # \u6ea2\u51fa\u6298\u8fd4\u4e86\n1) (integer) 0\n```\n\nbitfield \u6307\u4ee4\u63d0\u4f9b\u4e86\u6ea2\u51fa\u7b56\u7565\u5b50\u6307\u4ee4 overflow\uff0c\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u6ea2\u51fa\u884c\u4e3a\uff0c\u9ed8\u8ba4\u662f\u6298\u8fd4 (wrap)\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u5931\u8d25 (fail) \u62a5\u9519\u4e0d\u6267\u884c\uff0c\u4ee5\u53ca\u9971\u548c\u622a\u65ad (sat)\uff0c\u8d85\u8fc7\u4e86\u8303\u56f4\u5c31\u505c\u7559\u5728\u6700\u5927\u6700\u5c0f\u503c\u3002overflow \u6307\u4ee4\u53ea\u5f71\u54cd\u63a5\u4e0b\u6765\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\uff0c\u8fd9\u6761\u6307\u4ee4\u6267\u884c\u5b8c\u540e\u6ea2\u51fa\u7b56\u7565\u4f1a\u53d8\u6210\u9ed8\u8ba4\u503c\u6298\u8fd4 (wrap)\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5206\u522b\u8bd5\u8bd5\u8fd9\u4e24\u4e2a\u7b56\u7565\u7684\u884c\u4e3a\n\n**\u9971\u548c\u622a\u65ad SAT**\n```\n127.0.0.1:6379> set w hello\nOK\n127.0.0.1:6379> bitfield w overflow sat incrby u4 2 1\n1) (integer) 11\n127.0.0.1:6379> bitfield w overflow sat incrby u4 2 1\n1) (integer) 12\n127.0.0.1:6379> bitfield w overflow sat incrby u4 2 1\n1) (integer) 13\n127.0.0.1:6379> bitfield w overflow sat incrby u4 2 1\n1) (integer) 14\n127.0.0.1:6379> bitfield w overflow sat incrby u4 2 1\n1) (integer) 15\n127.0.0.1:6379> bitfield w overflow sat incrby u4 2 1  # \u4fdd\u6301\u6700\u5927\u503c\n1) (integer) 15\n```\n**\u5931\u8d25\u4e0d\u6267\u884c FAIL**\n```\n127.0.0.1:6379> set w hello\nOK\n127.0.0.1:6379> bitfield w overflow fail incrby u4 2 1\n1) (integer) 11\n127.0.0.1:6379> bitfield w overflow fail incrby u4 2 1\n1) (integer) 12\n127.0.0.1:6379> bitfield w overflow fail incrby u4 2 1\n1) (integer) 13\n127.0.0.1:6379> bitfield w overflow fail incrby u4 2 1\n1) (integer) 14\n127.0.0.1:6379> bitfield w overflow fail incrby u4 2 1\n1) (integer) 15\n127.0.0.1:6379> bitfield w overflow fail incrby u4 2 1  # \u4e0d\u6267\u884c\n1) (nil)\n```\n\n\u601d\u8003 & \u4f5c\u4e1a\n--\n1. \u6587\u4e2d\u6211\u4eec\u4f7f\u7528\u4f4d\u64cd\u4f5c\u8bbe\u7f6e\u4e86 he \u4e24\u4e2a\u5b57\u7b26\uff0c\u8bf7\u8bfb\u8005\u5c06\u5b8c\u6574\u7684 hello \u5355\u8bcd\u4e2d 5 \u4e2a\u5b57\u7b26\u90fd\u4f7f\u7528\u4f4d\u64cd\u4f5c\u8bbe\u7f6e\u4e00\u4e0b\u3002\n2. bitfield \u53ef\u4ee5\u540c\u65f6\u6df7\u5408\u6267\u884c\u591a\u4e2a set/get/incrby \u5b50\u6307\u4ee4\uff0c\u8bf7\u8bfb\u8005\u5c1d\u8bd5\u5b8c\u6210\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/4\u5e94\u7528_3\u8282\u8863\u7f29\u98df__\u4f4d\u56fe.md", "create_date": "2020-02-18T03:00:32.840", "order": 5}}, {"model": "subject.chapter", "pk": 15, "fields": {"title": "7\u5e94\u7528 6\uff1a\u65ad\u5c3e\u6c42\u751f \u2014\u2014 \u7b80\u5355\u9650\u6d41", "topic": 2, "md5": "87eb5b97ff220e0be9ac3e574ad79af0", "md_body": "# \u5e94\u7528 6\uff1a\u65ad\u5c3e\u6c42\u751f \u2014\u2014 \u7b80\u5355\u9650\u6d41\n\n\u9650\u6d41\u7b97\u6cd5\u5728\u5206\u5e03\u5f0f\u9886\u57df\u662f\u4e00\u4e2a\u7ecf\u5e38\u88ab\u63d0\u8d77\u7684\u8bdd\u9898\uff0c\u5f53\u7cfb\u7edf\u7684\u5904\u7406\u80fd\u529b\u6709\u9650\u65f6\uff0c\u5982\u4f55\u963b\u6b62\u8ba1\u5212\u5916\u7684\u8bf7\u6c42\u7ee7\u7eed\u5bf9\u7cfb\u7edf\u65bd\u538b\uff0c\u8fd9\u662f\u4e00\u4e2a\u9700\u8981\u91cd\u89c6\u7684\u95ee\u9898\u3002\u8001\u94b1\u5728\u8fd9\u91cc\u7528 \u201c\u65ad\u5c3e\u6c42\u751f\u201d \u5f62\u5bb9\u9650\u6d41\u80cc\u540e\u7684\u601d\u60f3\uff0c\u5f53\u7136\u8fd8\u6709\u5f88\u591a\u6210\u8bed\u4e5f\u8868\u8fbe\u4e86\u7c7b\u4f3c\u7684\u610f\u601d\uff0c\u5982\u5f03\u5352\u4fdd\u8f66\u3001\u58ee\u58eb\u65ad\u8155\u7b49\u7b49\u3002\n\n\u9664\u4e86\u63a7\u5236\u6d41\u91cf\uff0c\u9650\u6d41\u8fd8\u6709\u4e00\u4e2a\u5e94\u7528\u76ee\u7684\u662f\u7528\u4e8e\u63a7\u5236\u7528\u6237\u884c\u4e3a\uff0c\u907f\u514d\u5783\u573e\u8bf7\u6c42\u3002\u6bd4\u5982\u5728 UGC \u793e\u533a\uff0c\u7528\u6237\u7684\u53d1\u5e16\u3001\u56de\u590d\u3001\u70b9\u8d5e\u7b49\u884c\u4e3a\u90fd\u8981\u4e25\u683c\u53d7\u63a7\uff0c\u4e00\u822c\u8981\u4e25\u683c\u9650\u5b9a\u67d0\u884c\u4e3a\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u5141\u8bb8\u7684\u6b21\u6570\uff0c\u8d85\u8fc7\u4e86\u6b21\u6570\u90a3\u5c31\u662f\u975e\u6cd5\u884c\u4e3a\u3002\u5bf9\u975e\u6cd5\u884c\u4e3a\uff0c\u4e1a\u52a1\u5fc5\u987b\u89c4\u5b9a\u9002\u5f53\u7684\u60e9\u5904\u7b56\u7565\u3002\n\n## \u5982\u4f55\u4f7f\u7528 Redis \u6765\u5b9e\u73b0\u7b80\u5355\u9650\u6d41\u7b56\u7565\uff1f\n\n\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5e38\u89c1 \u7684\u7b80\u5355\u7684\u9650\u6d41\u7b56\u7565\u3002\u7cfb\u7edf\u8981\u9650\u5b9a\u7528\u6237\u7684\u67d0\u4e2a\u884c\u4e3a\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u91cc\u53ea\u80fd\u5141\u8bb8\u53d1\u751f N \u6b21\uff0c\u5982\u4f55\u4f7f\u7528 Redis \u7684\u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u8fd9\u4e2a\u9650\u6d41\u7684\u529f\u80fd\uff1f\n\n\u6211\u4eec\u5148\u5b9a\u4e49\u8fd9\u4e2a\u63a5\u53e3\uff0c\u7406\u89e3\u4e86\u8fd9\u4e2a\u63a5\u53e3\u7684\u5b9a\u4e49\uff0c\u8bfb\u8005\u5c31\u5e94\u8be5\u80fd\u660e\u767d\u6211\u4eec\u671f\u671b\u8fbe\u5230\u7684\u529f\u80fd\u3002\n```\n# \u6307\u5b9a\u7528\u6237 user_id \u7684\u67d0\u4e2a\u884c\u4e3a action_key \u5728\u7279\u5b9a\u7684\u65f6\u95f4\u5185 period \u53ea\u5141\u8bb8\u53d1\u751f\u4e00\u5b9a\u7684\u6b21\u6570 max_count\ndef is_action_allowed(user_id, action_key, period, max_count):\n    return True\n# \u8c03\u7528\u8fd9\u4e2a\u63a5\u53e3 , \u4e00\u5206\u949f\u5185\u53ea\u5141\u8bb8\u6700\u591a\u56de\u590d 5 \u4e2a\u5e16\u5b50\ncan_reply = is_action_allowed(\"laoqian\", \"reply\", 60, 5)\nif can_reply:\n    do_reply()\nelse:\n    raise ActionThresholdOverflow()\n```\n\n\u5148\u4e0d\u8981\u7ee7\u7eed\u5f80\u540e\u770b\uff0c\u60f3\u60f3\u5982\u679c\u8ba9\u4f60\u6765\u5b9e\u73b0\uff0c\u4f60\u8be5\u600e\u4e48\u505a\uff1f\n\n### \u89e3\u51b3\u65b9\u6848\n\n\u8fd9\u4e2a\u9650\u6d41\u9700\u6c42\u4e2d\u5b58\u5728\u4e00\u4e2a\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\uff0c\u60f3\u60f3 zset \u6570\u636e\u7ed3\u6784\u7684 score \u503c\uff0c\u662f\u4e0d\u662f\u53ef\u4ee5\u901a\u8fc7 score \u6765\u5708\u51fa\u8fd9\u4e2a\u65f6\u95f4\u7a97\u53e3\u6765\u3002\u800c\u4e14\u6211\u4eec\u53ea\u9700\u8981\u4fdd\u7559\u8fd9\u4e2a\u65f6\u95f4\u7a97\u53e3\uff0c\u7a97\u53e3\u4e4b\u5916\u7684\u6570\u636e\u90fd\u53ef\u4ee5\u780d\u6389\u3002\u90a3\u8fd9\u4e2a zset \u7684 value \u586b\u4ec0\u4e48\u6bd4\u8f83\u5408\u9002\u5462\uff1f\u5b83\u53ea\u9700\u8981\u4fdd\u8bc1\u552f\u4e00\u6027\u5373\u53ef\uff0c\u7528 uuid \u4f1a\u6bd4\u8f83\u6d6a\u8d39\u7a7a\u95f4\uff0c\u90a3\u5c31\u6539\u7528\u6beb\u79d2\u65f6\u95f4\u6233\u5427\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16483c2609601098?w=711&h=463&f=png&s=21910)\n\n\u5982\u56fe\u6240\u793a\uff0c\u7528\u4e00\u4e2a zset \u7ed3\u6784\u8bb0\u5f55\u7528\u6237\u7684\u884c\u4e3a\u5386\u53f2\uff0c\u6bcf\u4e00\u4e2a\u884c\u4e3a\u90fd\u4f1a\u4f5c\u4e3a zset \u4e2d\u7684\u4e00\u4e2a key \u4fdd\u5b58\u4e0b\u6765\u3002\u540c\u4e00\u4e2a\u7528\u6237\u540c\u4e00\u79cd\u884c\u4e3a\u7528\u4e00\u4e2a zset \u8bb0\u5f55\u3002\n\n\u4e3a\u8282\u7701\u5185\u5b58\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4fdd\u7559\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u884c\u4e3a\u8bb0\u5f55\uff0c\u540c\u65f6\u5982\u679c\u7528\u6237\u662f\u51b7\u7528\u6237\uff0c\u6ed1\u52a8\u65f6\u95f4\u7a97\u53e3\u5185\u7684\u884c\u4e3a\u662f\u7a7a\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a zset \u5c31\u53ef\u4ee5\u4ece\u5185\u5b58\u4e2d\u79fb\u9664\uff0c\u4e0d\u518d\u5360\u7528\u7a7a\u95f4\u3002\n\n\u901a\u8fc7\u7edf\u8ba1\u6ed1\u52a8\u7a97\u53e3\u5185\u7684\u884c\u4e3a\u6570\u91cf\u4e0e\u9608\u503c max_count \u8fdb\u884c\u6bd4\u8f83\u5c31\u53ef\u4ee5\u5f97\u51fa\u5f53\u524d\u7684\u884c\u4e3a\u662f\u5426\u5141\u8bb8\u3002\u7528\u4ee3\u7801\u8868\u793a\u5982\u4e0b\uff1a\n```py\n# coding: utf8\n\nimport time\nimport redis\n\nclient = redis.StrictRedis()\n\ndef is_action_allowed(user_id, action_key, period, max_count):\n    key = 'hist:%s:%s' % (user_id, action_key)\n    now_ts = int(time.time() * 1000)  # \u6beb\u79d2\u65f6\u95f4\u6233\n    with client.pipeline() as pipe:  # client \u662f StrictRedis \u5b9e\u4f8b\n        # \u8bb0\u5f55\u884c\u4e3a\n        pipe.zadd(key, now_ts, now_ts)  # value \u548c score \u90fd\u4f7f\u7528\u6beb\u79d2\u65f6\u95f4\u6233\n        # \u79fb\u9664\u65f6\u95f4\u7a97\u53e3\u4e4b\u524d\u7684\u884c\u4e3a\u8bb0\u5f55\uff0c\u5269\u4e0b\u7684\u90fd\u662f\u65f6\u95f4\u7a97\u53e3\u5185\u7684\n        pipe.zremrangebyscore(key, 0, now_ts - period * 1000)\n        # \u83b7\u53d6\u7a97\u53e3\u5185\u7684\u884c\u4e3a\u6570\u91cf\n        pipe.zcard(key)\n        # \u8bbe\u7f6e zset \u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u51b7\u7528\u6237\u6301\u7eed\u5360\u7528\u5185\u5b58\n        # \u8fc7\u671f\u65f6\u95f4\u5e94\u8be5\u7b49\u4e8e\u65f6\u95f4\u7a97\u53e3\u7684\u957f\u5ea6\uff0c\u518d\u591a\u5bbd\u9650 1s\n        pipe.expire(key, period + 1)\n        # \u6279\u91cf\u6267\u884c\n        _, _, current_count, _ = pipe.execute()\n    # \u6bd4\u8f83\u6570\u91cf\u662f\u5426\u8d85\u6807\n    return current_count <= max_count\n\n\nfor i in range(20):\n    print is_action_allowed(\"laoqian\", \"reply\", 60, 5)\n```\nJava \u7248\uff1a\n```java\npublic class SimpleRateLimiter {\n\n  private Jedis jedis;\n\n  public SimpleRateLimiter(Jedis jedis) {\n    this.jedis = jedis;\n  }\n\n  public boolean isActionAllowed(String userId, String actionKey, int period, int maxCount) {\n    String key = String.format(\"hist:%s:%s\", userId, actionKey);\n    long nowTs = System.currentTimeMillis();\n    Pipeline pipe = jedis.pipelined();\n    pipe.multi();\n    pipe.zadd(key, nowTs, \"\" + nowTs);\n    pipe.zremrangeByScore(key, 0, nowTs - period * 1000);\n    Response<Long> count = pipe.zcard(key);\n    pipe.expire(key, period + 1);\n    pipe.exec();\n    pipe.close();\n    return count.get() <= maxCount;\n  }\n\n  public static void main(String[] args) {\n    Jedis jedis = new Jedis();\n    SimpleRateLimiter limiter = new SimpleRateLimiter(jedis);\n    for(int i=0;i<20;i++) {\n      System.out.println(limiter.isActionAllowed(\"laoqian\", \"reply\", 60, 5));\n    }\n  }\n\n}\n```\n\n\u8fd9\u6bb5\u4ee3\u7801\u8fd8\u662f\u7565\u663e\u590d\u6742\uff0c\u9700\u8981\u8bfb\u8005\u82b1\u4e00\u5b9a\u7684\u65f6\u95f4\u597d\u597d\u5543\u3002\u5b83\u7684\u6574\u4f53\u601d\u8def\u5c31\u662f\uff1a\u6bcf\u4e00\u4e2a\u884c\u4e3a\u5230\u6765\u65f6\uff0c\u90fd\u7ef4\u62a4\u4e00\u6b21\u65f6\u95f4\u7a97\u53e3\u3002\u5c06\u65f6\u95f4\u7a97\u53e3\u5916\u7684\u8bb0\u5f55\u5168\u90e8\u6e05\u7406\u6389\uff0c\u53ea\u4fdd\u7559\u7a97\u53e3\u5185\u7684\u8bb0\u5f55\u3002zset \u96c6\u5408\u4e2d\u53ea\u6709 score \u503c\u975e\u5e38\u91cd\u8981\uff0cvalue \u503c\u6ca1\u6709\u7279\u522b\u7684\u610f\u4e49\uff0c\u53ea\u9700\u8981\u4fdd\u8bc1\u5b83\u662f\u552f\u4e00\u7684\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u56e0\u4e3a\u8fd9\u51e0\u4e2a\u8fde\u7eed\u7684 Redis \u64cd\u4f5c\u90fd\u662f\u9488\u5bf9\u540c\u4e00\u4e2a key \u7684\uff0c\u4f7f\u7528 pipeline \u53ef\u4ee5\u663e\u8457\u63d0\u5347 Redis \u5b58\u53d6\u6548\u7387\u3002\u4f46\u8fd9\u79cd\u65b9\u6848\u4e5f\u6709\u7f3a\u70b9\uff0c\u56e0\u4e3a\u5b83\u8981\u8bb0\u5f55\u65f6\u95f4\u7a97\u53e3\u5185\u6240\u6709\u7684\u884c\u4e3a\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u91cf\u5f88\u5927\uff0c\u6bd4\u5982\u9650\u5b9a 60s \u5185\u64cd\u4f5c\u4e0d\u5f97\u8d85\u8fc7 100w \u6b21\u8fd9\u6837\u7684\u53c2\u6570\uff0c\u5b83\u662f\u4e0d\u9002\u5408\u505a\u8fd9\u6837\u7684\u9650\u6d41\u7684\uff0c\u56e0\u4e3a\u4f1a\u6d88\u8017\u5927\u91cf\u7684\u5b58\u50a8\u7a7a\u95f4\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u8282\u4ecb\u7ecd\u7684\u662f\u9650\u6d41\u7b56\u7565\u7684\u7b80\u5355\u5e94\u7528\uff0c\u5b83\u4ecd\u7136\u6709\u8f83\u5927\u7684\u63d0\u5347\u7a7a\u95f4\uff0c\u9002\u7528\u7684\u573a\u666f\u4e5f\u6709\u9650\u3002\u4e3a\u4e86\u89e3\u51b3\u7b80\u5355\u9650\u6d41\u7684\u7f3a\u70b9\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u5f15\u5165\u9ad8\u7ea7\u9650\u6d41\u7b97\u6cd5\u2014\u2014\u6f0f\u6597\u9650\u6d41\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/7\u5e94\u7528_6\u65ad\u5c3e\u6c42\u751f__\u7b80\u5355\u9650\u6d41.md", "create_date": "2020-02-18T03:00:32.860", "order": 8}}, {"model": "subject.chapter", "pk": 16, "fields": {"title": "6\u5e94\u7528 5\uff1a\u5c42\u5ce6\u53e0\u5d82 \u2014\u2014 \u5e03\u9686\u8fc7\u6ee4\u5668", "topic": 2, "md5": "f5e8c78e854a241d782c28ee8c7cd5c3", "md_body": "# \u5e94\u7528 5\uff1a\u5c42\u5ce6\u53e0\u5d82 \u2014\u2014 \u5e03\u9686\u8fc7\u6ee4\u5668\n\n\u4e0a\u4e00\u8282\u6211\u4eec\u5b66\u4f1a\u4e86\u4f7f\u7528 HyperLogLog \u6570\u636e\u7ed3\u6784\u6765\u8fdb\u884c\u4f30\u6570\uff0c\u5b83\u975e\u5e38\u6709\u4ef7\u503c\uff0c\u53ef\u4ee5\u89e3\u51b3\u5f88\u591a\u7cbe\u786e\u5ea6\u4e0d\u9ad8\u7684\u7edf\u8ba1\u9700\u6c42\u3002\n\n\u4f46\u662f\u5982\u679c\u6211\u4eec\u60f3\u77e5\u9053\u67d0\u4e00\u4e2a\u503c\u662f\u4e0d\u662f\u5df2\u7ecf\u5728 HyperLogLog \u7ed3\u6784\u91cc\u9762\u4e86\uff0c\u5b83\u5c31\u65e0\u80fd\u4e3a\u529b\u4e86\uff0c\u5b83\u53ea\u63d0\u4f9b\u4e86 pfadd \u548c pfcount \u65b9\u6cd5\uff0c\u6ca1\u6709\u63d0\u4f9b pfcontains \u8fd9\u79cd\u65b9\u6cd5\u3002\n\n\u8bb2\u4e2a\u4f7f\u7528\u573a\u666f\uff0c\u6bd4\u5982\u6211\u4eec\u5728\u4f7f\u7528\u65b0\u95fb\u5ba2\u6237\u7aef\u770b\u65b0\u95fb\u65f6\uff0c\u5b83\u4f1a\u7ed9\u6211\u4eec\u4e0d\u505c\u5730\u63a8\u8350\u65b0\u7684\u5185\u5bb9\uff0c\u5b83\u6bcf\u6b21\u63a8\u8350\u65f6\u8981\u53bb\u91cd\uff0c\u53bb\u6389\u90a3\u4e9b\u5df2\u7ecf\u770b\u8fc7\u7684\u5185\u5bb9\u3002\u95ee\u9898\u6765\u4e86\uff0c\u65b0\u95fb\u5ba2\u6237\u7aef\u63a8\u8350\u7cfb\u7edf\u5982\u4f55\u5b9e\u73b0\u63a8\u9001\u53bb\u91cd\u7684\uff1f\n\n\u4f60\u4f1a\u60f3\u5230\u670d\u52a1\u5668\u8bb0\u5f55\u4e86\u7528\u6237\u770b\u8fc7\u7684\u6240\u6709\u5386\u53f2\u8bb0\u5f55\uff0c\u5f53\u63a8\u8350\u7cfb\u7edf\u63a8\u8350\u65b0\u95fb\u65f6\u4f1a\u4ece\u6bcf\u4e2a\u7528\u6237\u7684\u5386\u53f2\u8bb0\u5f55\u91cc\u8fdb\u884c\u7b5b\u9009\uff0c\u8fc7\u6ee4\u6389\u90a3\u4e9b\u5df2\u7ecf\u5b58\u5728\u7684\u8bb0\u5f55\u3002\u95ee\u9898\u662f\u5f53\u7528\u6237\u91cf\u5f88\u5927\uff0c\u6bcf\u4e2a\u7528\u6237\u770b\u8fc7\u7684\u65b0\u95fb\u53c8\u5f88\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u79cd\u65b9\u5f0f\uff0c\u63a8\u8350\u7cfb\u7edf\u7684\u53bb\u91cd\u5de5\u4f5c\u5728\u6027\u80fd\u4e0a\u8ddf\u7684\u4e0a\u4e48\uff1f\n\n![](https://user-gold-cdn.xitu.io/2018/7/2/164599f30fae2a7f?w=512&h=100&f=gif&s=237335)\n\n\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u5386\u53f2\u8bb0\u5f55\u5b58\u50a8\u5728\u5173\u7cfb\u6570\u636e\u5e93\u91cc\uff0c\u53bb\u91cd\u5c31\u9700\u8981\u9891\u7e41\u5730\u5bf9\u6570\u636e\u5e93\u8fdb\u884c exists \u67e5\u8be2\uff0c\u5f53\u7cfb\u7edf\u5e76\u53d1\u91cf\u5f88\u9ad8\u65f6\uff0c\u6570\u636e\u5e93\u662f\u5f88\u96be\u625b\u4f4f\u538b\u529b\u7684\u3002\n\n\u4f60\u53ef\u80fd\u53c8\u60f3\u5230\u4e86\u7f13\u5b58\uff0c\u4f46\u662f\u5982\u6b64\u591a\u7684\u5386\u53f2\u8bb0\u5f55\u5168\u90e8\u7f13\u5b58\u8d77\u6765\uff0c\u90a3\u5f97\u6d6a\u8d39\u591a\u5927\u5b58\u50a8\u7a7a\u95f4\u554a\uff1f\u800c\u4e14\u8fd9\u4e2a\u5b58\u50a8\u7a7a\u95f4\u662f\u968f\u7740\u65f6\u95f4\u7ebf\u6027\u589e\u957f\uff0c\u4f60\u6491\u5f97\u4f4f\u4e00\u4e2a\u6708\uff0c\u4f60\u80fd\u6491\u5f97\u4f4f\u51e0\u5e74\u4e48\uff1f\u4f46\u662f\u4e0d\u7f13\u5b58\u7684\u8bdd\uff0c\u6027\u80fd\u53c8\u8ddf\u4e0d\u4e0a\uff0c\u8fd9\u8be5\u600e\u4e48\u529e\uff1f\n\n\u8fd9\u65f6\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668 (Bloom Filter)  \u95ea\u4eae\u767b\u573a\u4e86\uff0c\u5b83\u5c31\u662f\u4e13\u95e8\u7528\u6765\u89e3\u51b3\u8fd9\u79cd\u53bb\u91cd\u95ee\u9898\u7684\u3002\u5b83\u5728\u8d77\u5230\u53bb\u91cd\u7684\u540c\u65f6\uff0c\u5728\u7a7a\u95f4\u4e0a\u8fd8\u80fd\u8282\u7701 90% \u4ee5\u4e0a\uff0c\u53ea\u662f\u7a0d\u5fae\u6709\u90a3\u4e48\u70b9\u4e0d\u7cbe\u786e\uff0c\u4e5f\u5c31\u662f\u6709\u4e00\u5b9a\u7684\u8bef\u5224\u6982\u7387\u3002\n\n## \u5e03\u9686\u8fc7\u6ee4\u5668\u662f\u4ec0\u4e48\uff1f\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u4e0d\u600e\u4e48\u7cbe\u786e\u7684 set \u7ed3\u6784\uff0c\u5f53\u4f60\u4f7f\u7528\u5b83\u7684 contains \u65b9\u6cd5\u5224\u65ad\u67d0\u4e2a\u5bf9\u8c61\u662f\u5426\u5b58\u5728\u65f6\uff0c\u5b83\u53ef\u80fd\u4f1a\u8bef\u5224\u3002\u4f46\u662f\u5e03\u9686\u8fc7\u6ee4\u5668\u4e5f\u4e0d\u662f\u7279\u522b\u4e0d\u7cbe\u786e\uff0c\u53ea\u8981\u53c2\u6570\u8bbe\u7f6e\u7684\u5408\u7406\uff0c\u5b83\u7684\u7cbe\u786e\u5ea6\u53ef\u4ee5\u63a7\u5236\u7684\u76f8\u5bf9\u8db3\u591f\u7cbe\u786e\uff0c\u53ea\u4f1a\u6709\u5c0f\u5c0f\u7684\u8bef\u5224\u6982\u7387\u3002\n\n\u5f53\u5e03\u9686\u8fc7\u6ee4\u5668\u8bf4\u67d0\u4e2a\u503c\u5b58\u5728\u65f6\uff0c\u8fd9\u4e2a\u503c\u53ef\u80fd\u4e0d\u5b58\u5728\uff1b\u5f53\u5b83\u8bf4\u4e0d\u5b58\u5728\u65f6\uff0c\u90a3\u5c31\u80af\u5b9a\u4e0d\u5b58\u5728\u3002\u6253\u4e2a\u6bd4\u65b9\uff0c\u5f53\u5b83\u8bf4\u4e0d\u8ba4\u8bc6\u4f60\u65f6\uff0c\u80af\u5b9a\u5c31\u4e0d\u8ba4\u8bc6\uff1b\u5f53\u5b83\u8bf4\u89c1\u8fc7\u4f60\u65f6\uff0c\u53ef\u80fd\u6839\u672c\u5c31\u6ca1\u89c1\u8fc7\u9762\uff0c\u4e0d\u8fc7\u56e0\u4e3a\u4f60\u7684\u8138\u8ddf\u5b83\u8ba4\u8bc6\u7684\u4eba\u4e2d\u67d0\u8138\u6bd4\u8f83\u76f8\u4f3c (\u67d0\u4e9b\u719f\u8138\u7684\u7cfb\u6570\u7ec4\u5408)\uff0c\u6240\u4ee5\u8bef\u5224\u4ee5\u524d\u89c1\u8fc7\u4f60\u3002\n\n\u5957\u5728\u4e0a\u9762\u7684\u4f7f\u7528\u573a\u666f\u4e2d\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u80fd\u51c6\u786e\u8fc7\u6ee4\u6389\u90a3\u4e9b\u5df2\u7ecf\u770b\u8fc7\u7684\u5185\u5bb9\uff0c\u90a3\u4e9b\u6ca1\u6709\u770b\u8fc7\u7684\u65b0\u5185\u5bb9\uff0c\u5b83\u4e5f\u4f1a\u8fc7\u6ee4\u6389\u6781\u5c0f\u4e00\u90e8\u5206 (\u8bef\u5224)\uff0c\u4f46\u662f\u7edd\u5927\u591a\u6570\u65b0\u5185\u5bb9\u5b83\u90fd\u80fd\u51c6\u786e\u8bc6\u522b\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b8c\u5168\u4fdd\u8bc1\u63a8\u8350\u7ed9\u7528\u6237\u7684\u5185\u5bb9\u90fd\u662f\u65e0\u91cd\u590d\u7684\u3002\n\n## Redis \u4e2d\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\n\nRedis \u5b98\u65b9\u63d0\u4f9b\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\u5230\u4e86 Redis 4.0 \u63d0\u4f9b\u4e86\u63d2\u4ef6\u529f\u80fd\u4e4b\u540e\u624d\u6b63\u5f0f\u767b\u573a\u3002\u5e03\u9686\u8fc7\u6ee4\u5668\u4f5c\u4e3a\u4e00\u4e2a\u63d2\u4ef6\u52a0\u8f7d\u5230 Redis Server \u4e2d\uff0c\u7ed9 Redis \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u5e03\u9686\u53bb\u91cd\u529f\u80fd\u3002\n\n\u4e0b\u9762\u6211\u4eec\u6765\u4f53\u9a8c\u4e00\u4e0b Redis 4.0 \u7684\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u4e3a\u4e86\u7701\u53bb\u7e41\u7410\u5b89\u88c5\u8fc7\u7a0b\uff0c\u6211\u4eec\u76f4\u63a5\u7528 Docker \u5427\u3002\n\n```\n> docker pull redislabs/rebloom  # \u62c9\u53d6\u955c\u50cf\n> docker run -p6379:6379 redislabs/rebloom  # \u8fd0\u884c\u5bb9\u5668\n> redis-cli  # \u8fde\u63a5\u5bb9\u5668\u4e2d\u7684 redis \u670d\u52a1\n```\n\n\u5982\u679c\u4e0a\u9762\u4e09\u6761\u6307\u4ee4\u6267\u884c\u6ca1\u6709\u95ee\u9898\uff0c\u4e0b\u9762\u5c31\u53ef\u4ee5\u4f53\u9a8c\u5e03\u9686\u8fc7\u6ee4\u5668\u4e86\u3002\n\n## \u5e03\u9686\u8fc7\u6ee4\u5668\u57fa\u672c\u4f7f\u7528\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u6709\u4e8c\u4e2a\u57fa\u672c\u6307\u4ee4\uff0c`bf.add` \u6dfb\u52a0\u5143\u7d20\uff0c`bf.exists` \u67e5\u8be2\u5143\u7d20\u662f\u5426\u5b58\u5728\uff0c\u5b83\u7684\u7528\u6cd5\u548c set \u96c6\u5408\u7684 sadd \u548c sismember \u5dee\u4e0d\u591a\u3002\u6ce8\u610f `bf.add` \u53ea\u80fd\u4e00\u6b21\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u60f3\u8981\u4e00\u6b21\u6dfb\u52a0\u591a\u4e2a\uff0c\u5c31\u9700\u8981\u7528\u5230 `bf.madd` \u6307\u4ee4\u3002\u540c\u6837\u5982\u679c\u9700\u8981\u4e00\u6b21\u67e5\u8be2\u591a\u4e2a\u5143\u7d20\u662f\u5426\u5b58\u5728\uff0c\u5c31\u9700\u8981\u7528\u5230 `bf.mexists` \u6307\u4ee4\u3002\n\n```\n127.0.0.1:6379> bf.add codehole user1\n(integer) 1\n127.0.0.1:6379> bf.add codehole user2\n(integer) 1\n127.0.0.1:6379> bf.add codehole user3\n(integer) 1\n127.0.0.1:6379> bf.exists codehole user1\n(integer) 1\n127.0.0.1:6379> bf.exists codehole user2\n(integer) 1\n127.0.0.1:6379> bf.exists codehole user3\n(integer) 1\n127.0.0.1:6379> bf.exists codehole user4\n(integer) 0\n127.0.0.1:6379> bf.madd codehole user4 user5 user6\n1) (integer) 1\n2) (integer) 1\n3) (integer) 1\n127.0.0.1:6379> bf.mexists codehole user4 user5 user6 user7\n1) (integer) 1\n2) (integer) 1\n3) (integer) 1\n4) (integer) 0\n```\n\n\u4f3c\u4e4e\u5f88\u51c6\u786e\u554a\uff0c\u4e00\u4e2a\u90fd\u6ca1\u8bef\u5224\u3002\u4e0b\u9762\u6211\u4eec\u7528 Python  \u811a\u672c\u52a0\u5165\u5f88\u591a\u5143\u7d20\uff0c\u770b\u770b\u52a0\u5230\u7b2c\u51e0\u4e2a\u5143\u7d20\u7684\u65f6\u5019\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u4f1a\u51fa\u73b0\u8bef\u5224\u3002\n\n```py\n# coding: utf-8\n\nimport redis\n\nclient = redis.StrictRedis()\n\nclient.delete(\"codehole\")\nfor i in range(100000):\n    client.execute_command(\"bf.add\", \"codehole\", \"user%d\" % i)\n    ret = client.execute_command(\"bf.exists\", \"codehole\", \"user%d\" % i)\n    if ret == 0:\n        print i\n        break\n```\nJava \u5ba2\u6237\u7aef Jedis-2.x \u6ca1\u6709\u63d0\u4f9b\u6307\u4ee4\u6269\u5c55\u673a\u5236\uff0c\u6240\u4ee5\u4f60\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528 Jedis \u6765\u8bbf\u95ee Redis Module \u63d0\u4f9b\u7684 bf.xxx \u6307\u4ee4\u3002RedisLabs \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5355\u72ec\u7684\u5305 [JReBloom](https://github.com/RedisLabs/JReBloom)\uff0c\u4f46\u662f\u5b83\u662f\u57fa\u4e8e Jedis-3.0\uff0cJedis-3.0 \u8fd9\u4e2a\u5305\u76ee\u524d\u8fd8\u6ca1\u6709\u8fdb\u5165 release\uff0c\u6ca1\u6709\u8fdb\u5165 maven \u7684\u4e2d\u592e\u4ed3\u5e93\uff0c\u9700\u8981\u5728 Github \u4e0a\u4e0b\u8f7d\u3002\u5728\u4f7f\u7528\u4e0a\u5f88\u4e0d\u65b9\u4fbf\uff0c\u5982\u679c\u6015\u9ebb\u70e6\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528 [lettuce](https://github.com/lettuce-io/lettuce-core)\uff0c\u5b83\u662f\u53e6\u4e00\u4e2a Redis \u7684\u5ba2\u6237\u7aef\uff0c\u76f8\u6bd4 Jedis \u800c\u8a00\uff0c\u5b83\u5f88\u65e9\u5c31\u652f\u6301\u4e86\u6307\u4ee4\u6269\u5c55\u3002\n\n```java\npublic class BloomTest {\n\n  public static void main(String[] args) {\n    Client client = new Client();\n\n    client.delete(\"codehole\");\n    for (int i = 0; i < 100000; i++) {\n      client.add(\"codehole\", \"user\" + i);\n      boolean ret = client.exists(\"codehole\", \"user\" + i);\n      if (!ret) {\n        System.out.println(i);\n        break;\n      }\n    }\n\n    client.close();\n  }\n\n}\n```\n\u6267\u884c\u4e0a\u9762\u7684\u4ee3\u7801\u540e\uff0c\u4f60\u4f1a\u5f20\u5927\u4e86\u5634\u5df4\u53d1\u73b0\u5c45\u7136\u6ca1\u6709\u8f93\u51fa\uff0c\u585e\u8fdb\u53bb\u4e86 100000 \u4e2a\u5143\u7d20\uff0c\u8fd8\u662f\u6ca1\u6709\u8bef\u5224\uff0c\u8fd9\u662f\u600e\u4e48\u56de\u4e8b\uff1f\u5982\u679c\u4f60\u4e0d\u6b7b\u5fc3\u7684\u8bdd\uff0c\u53ef\u4ee5\u5c06\u6570\u5b57\u518d\u52a0\u4e00\u4e2a 0 \u8bd5\u8bd5\uff0c\u4f60\u4f1a\u53d1\u73b0\u4f9d\u7136\u6ca1\u6709\u8bef\u5224\u3002\n\n\u539f\u56e0\u5c31\u5728\u4e8e\u5e03\u9686\u8fc7\u6ee4\u5668\u5bf9\u4e8e\u5df2\u7ecf\u89c1\u8fc7\u7684\u5143\u7d20\u80af\u5b9a\u4e0d\u4f1a\u8bef\u5224\uff0c\u5b83\u53ea\u4f1a\u8bef\u5224\u90a3\u4e9b\u6ca1\u89c1\u8fc7\u7684\u5143\u7d20\u3002\u6240\u4ee5\u6211\u4eec\u8981\u7a0d\u5fae\u6539\u4e00\u4e0b\u4e0a\u9762\u7684\u811a\u672c\uff0c\u4f7f\u7528 bf.exists \u53bb\u67e5\u627e\u6ca1\u89c1\u8fc7\u7684\u5143\u7d20\uff0c\u770b\u770b\u5b83\u662f\u4e0d\u662f\u4ee5\u4e3a\u81ea\u5df1\u89c1\u8fc7\u4e86\u3002\n\n```py\n# coding: utf-8\n\nimport redis\n\nclient = redis.StrictRedis()\n\nclient.delete(\"codehole\")\nfor i in range(100000):\n    client.execute_command(\"bf.add\", \"codehole\", \"user%d\" % i)\n    # \u6ce8\u610f i+1\uff0c\u8fd9\u4e2a\u662f\u5f53\u524d\u5e03\u9686\u8fc7\u6ee4\u5668\u6ca1\u89c1\u8fc7\u7684\n    ret = client.execute_command(\"bf.exists\", \"codehole\", \"user%d\" % (i+1))\n    if ret == 1:\n        print i\n        break\n```\nJava \u7248:\n\n```java\npublic class BloomTest {\n\n  public static void main(String[] args) {\n    Client client = new Client();\n\n    client.delete(\"codehole\");\n    for (int i = 0; i < 100000; i++) {\n      client.add(\"codehole\", \"user\" + i);\n      boolean ret = client.exists(\"codehole\", \"user\" + (i + 1));\n      if (ret) {\n        System.out.println(i);\n        break;\n      }\n    }\n\n    client.close();\n  }\n\n}\n```\n\n\u8fd0\u884c\u540e\uff0c\u6211\u4eec\u770b\u5230\u4e86\u8f93\u51fa\u662f 214\uff0c\u4e5f\u5c31\u662f\u5230\u7b2c 214 \u7684\u65f6\u5019\uff0c\u5b83\u51fa\u73b0\u4e86\u8bef\u5224\u3002\n\n\u90a3\u5982\u4f55\u6765\u6d4b\u91cf\u8bef\u5224\u7387\u5462\uff1f\u6211\u4eec\u5148\u968f\u673a\u51fa\u4e00\u5806\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5207\u5206\u4e3a 2 \u7ec4\uff0c\u5c06\u5176\u4e2d\u4e00\u7ec4\u585e\u5165\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u7136\u540e\u518d\u5224\u65ad\u53e6\u5916\u4e00\u7ec4\u7684\u5b57\u7b26\u4e32\u5b58\u5728\u4e0e\u5426\uff0c\u53d6\u8bef\u5224\u7684\u4e2a\u6570\u548c\u5b57\u7b26\u4e32\u603b\u91cf\u4e00\u534a\u7684\u767e\u5206\u6bd4\u4f5c\u4e3a\u8bef\u5224\u7387\u3002\n\n```py\n# coding: utf-8\n\nimport redis\nimport random\n\nclient = redis.StrictRedis()\n\nCHARS = ''.join([chr(ord('a') + i) for i in range(26)])\n\ndef random_string(n):\n    chars = []\n    for i in range(n):\n        idx = random.randint(0, len(CHARS) - 1)\n        chars.append(CHARS[idx])\n    return ''.join(chars)\n\n\nusers = list(set([random_string(64) for i in range(100000)]))\nprint 'total users', len(users)\nusers_train = users[:len(users)/2]\nusers_test = users[len(users)/2:]\n\nclient.delete(\"codehole\")\nfalses = 0\n\nfor user in users_train:\n    client.execute_command(\"bf.add\", \"codehole\", user)\nprint 'all trained'\nfor user in users_test:\n    ret = client.execute_command(\"bf.exists\", \"codehole\", user)\n    if ret == 1:\n        falses += 1\n\nprint falses, len(users_test)\n```\n\nJava \u7248:\n\n```java\npublic class BloomTest {\n\n  private String chars;\n  {\n    StringBuilder builder = new StringBuilder();\n    for (int i = 0; i < 26; i++) {\n      builder.append((char) ('a' + i));\n    }\n    chars = builder.toString();\n  }\n\n  private String randomString(int n) {\n    StringBuilder builder = new StringBuilder();\n    for (int i = 0; i < n; i++) {\n      int idx = ThreadLocalRandom.current().nextInt(chars.length());\n      builder.append(chars.charAt(idx));\n    }\n    return builder.toString();\n  }\n\n  private List<String> randomUsers(int n) {\n    List<String> users = new ArrayList<>();\n    for (int i = 0; i < 100000; i++) {\n      users.add(randomString(64));\n    }\n    return users;\n  }\n\n  public static void main(String[] args) {\n    BloomTest bloomer = new BloomTest();\n    List<String> users = bloomer.randomUsers(100000);\n    List<String> usersTrain = users.subList(0, users.size() / 2);\n    List<String> usersTest = users.subList(users.size() / 2, users.size());\n\n    Client client = new Client();\n    client.delete(\"codehole\");\n    for (String user : usersTrain) {\n      client.add(\"codehole\", user);\n    }\n    int falses = 0;\n    for (String user : usersTest) {\n      boolean ret = client.exists(\"codehole\", user);\n      if (ret) {\n        falses++;\n      }\n    }\n    System.out.printf(\"%d %d\\n\", falses, usersTest.size());\n    client.close();\n  }\n\n}\n```\n\u8fd0\u884c\u4e00\u4e0b\uff0c\u7b49\u5f85\u5927\u7ea6\u4e00\u5206\u949f\uff0c\u8f93\u51fa:\n```\ntotal users 100000\nall trained\n628 50000\n```\n\u53ef\u4ee5\u770b\u5230\u8bef\u5224\u7387\u5927\u7ea6 1% \u591a\u70b9\u3002\u4f60\u4e5f\u8bb8\u4f1a\u95ee\u8fd9\u4e2a\u8bef\u5224\u7387\u8fd8\u662f\u6709\u70b9\u9ad8\u554a\uff0c\u6709\u6ca1\u6709\u529e\u6cd5\u964d\u4f4e\u4e00\u70b9\uff1f\u7b54\u6848\u662f\u6709\u7684\u3002\n\n\u6211\u4eec\u4e0a\u9762\u4f7f\u7528\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\u53ea\u662f\u9ed8\u8ba4\u53c2\u6570\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u5b83\u5728\u6211\u4eec\u7b2c\u4e00\u6b21 add \u7684\u65f6\u5019\u81ea\u52a8\u521b\u5efa\u3002Redis \u5176\u5b9e\u8fd8\u63d0\u4f9b\u4e86\u81ea\u5b9a\u4e49\u53c2\u6570\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u9700\u8981\u6211\u4eec\u5728 add \u4e4b\u524d\u4f7f\u7528```bf.reserve```\u6307\u4ee4\u663e\u5f0f\u521b\u5efa\u3002\u5982\u679c\u5bf9\u5e94\u7684 key \u5df2\u7ecf\u5b58\u5728\uff0c```bf.reserve```\u4f1a\u62a5\u9519\u3002```bf.reserve```\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f key, ```error_rate```\u548c```initial_size```\u3002\u9519\u8bef\u7387\u8d8a\u4f4e\uff0c\u9700\u8981\u7684\u7a7a\u95f4\u8d8a\u5927\u3002```initial_size```\u53c2\u6570\u8868\u793a\u9884\u8ba1\u653e\u5165\u7684\u5143\u7d20\u6570\u91cf\uff0c\u5f53\u5b9e\u9645\u6570\u91cf\u8d85\u51fa\u8fd9\u4e2a\u6570\u503c\u65f6\uff0c\u8bef\u5224\u7387\u4f1a\u4e0a\u5347\u3002\n\n\u6240\u4ee5\u9700\u8981\u63d0\u524d\u8bbe\u7f6e\u4e00\u4e2a\u8f83\u5927\u7684\u6570\u503c\u907f\u514d\u8d85\u51fa\u5bfc\u81f4\u8bef\u5224\u7387\u5347\u9ad8\u3002\u5982\u679c\u4e0d\u4f7f\u7528 bf.reserve\uff0c\u9ed8\u8ba4\u7684```error_rate```\u662f 0.01\uff0c\u9ed8\u8ba4\u7684```initial_size```\u662f 100\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528 bf.reserve \u6539\u9020\u4e00\u4e0b\u4e0a\u9762\u7684\u811a\u672c\uff1a\n```py\n# coding: utf-8\n\nimport redis\nimport random\n\nclient = redis.StrictRedis()\n\nCHARS = ''.join([chr(ord('a') + i) for i in range(26)])\n\ndef random_string(n):\n    chars = []\n    for i in range(n):\n        idx = random.randint(0, len(CHARS) - 1)\n        chars.append(CHARS[idx])\n    return ''.join(chars)\n\n\nusers = list(set([random_string(64) for i in range(100000)]))\nprint 'total users', len(users)\nusers_train = users[:len(users)/2]\nusers_test = users[len(users)/2:]\n\n\nfalses = 0\nclient.delete(\"codehole\")\n# \u589e\u52a0\u4e86\u4e0b\u9762\u8fd9\u4e00\u53e5\nclient.execute_command(\"bf.reserve\", \"codehole\", 0.001, 50000)\nfor user in users_train:\n    client.execute_command(\"bf.add\", \"codehole\", user)\nprint 'all trained'\nfor user in users_test:\n    ret = client.execute_command(\"bf.exists\", \"codehole\", user)\n    if ret == 1:\n        falses += 1\n\nprint falses, len(users_test)\n```\nJava \u7248\u672c\uff1a\n```java\npublic class BloomTest {\n\n  private String chars;\n  {\n    StringBuilder builder = new StringBuilder();\n    for (int i = 0; i < 26; i++) {\n      builder.append((char) ('a' + i));\n    }\n    chars = builder.toString();\n  }\n\n  private String randomString(int n) {\n    StringBuilder builder = new StringBuilder();\n    for (int i = 0; i < n; i++) {\n      int idx = ThreadLocalRandom.current().nextInt(chars.length());\n      builder.append(chars.charAt(idx));\n    }\n    return builder.toString();\n  }\n\n  private List<String> randomUsers(int n) {\n    List<String> users = new ArrayList<>();\n    for (int i = 0; i < 100000; i++) {\n      users.add(randomString(64));\n    }\n    return users;\n  }\n\n  public static void main(String[] args) {\n    BloomTest bloomer = new BloomTest();\n    List<String> users = bloomer.randomUsers(100000);\n    List<String> usersTrain = users.subList(0, users.size() / 2);\n    List<String> usersTest = users.subList(users.size() / 2, users.size());\n\n    Client client = new Client();\n    client.delete(\"codehole\");\n    // \u5bf9\u5e94 bf.reserve \u6307\u4ee4\n    client.createFilter(\"codehole\", 50000, 0.001);\n    for (String user : usersTrain) {\n      client.add(\"codehole\", user);\n    }\n    int falses = 0;\n    for (String user : usersTest) {\n      boolean ret = client.exists(\"codehole\", user);\n      if (ret) {\n        falses++;\n      }\n    }\n    System.out.printf(\"%d %d\\n\", falses, usersTest.size());\n    client.close();\n  }\n\n}\n```\n\n\u8fd0\u884c\u4e00\u4e0b\uff0c\u7b49\u5f85\u7ea6 1 \u5206\u949f\uff0c\u8f93\u51fa\u5982\u4e0b\uff1a\n\n```\ntotal users 100000\nall trained\n6 50000\n```\n\n\u6211\u4eec\u770b\u5230\u4e86\u8bef\u5224\u7387\u5927\u7ea6 0.012%\uff0c\u6bd4\u9884\u8ba1\u7684 0.1% \u4f4e\u5f88\u591a\uff0c\u4e0d\u8fc7\u5e03\u9686\u7684\u6982\u7387\u662f\u6709\u8bef\u5dee\u7684\uff0c\u53ea\u8981\u4e0d\u6bd4\u9884\u8ba1\u8bef\u5224\u7387\u9ad8\u592a\u591a\uff0c\u90fd\u662f\u6b63\u5e38\u73b0\u8c61\u3002\n\n## \u6ce8\u610f\u4e8b\u9879\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u7684```initial_size```\u4f30\u8ba1\u7684\u8fc7\u5927\uff0c\u4f1a\u6d6a\u8d39\u5b58\u50a8\u7a7a\u95f4\uff0c\u4f30\u8ba1\u7684\u8fc7\u5c0f\uff0c\u5c31\u4f1a\u5f71\u54cd\u51c6\u786e\u7387\uff0c\u7528\u6237\u5728\u4f7f\u7528\u4e4b\u524d\u4e00\u5b9a\u8981\u5c3d\u53ef\u80fd\u5730\u7cbe\u786e\u4f30\u8ba1\u597d\u5143\u7d20\u6570\u91cf\uff0c\u8fd8\u9700\u8981\u52a0\u4e0a\u4e00\u5b9a\u7684\u5197\u4f59\u7a7a\u95f4\u4ee5\u907f\u514d\u5b9e\u9645\u5143\u7d20\u53ef\u80fd\u4f1a\u610f\u5916\u9ad8\u51fa\u4f30\u8ba1\u503c\u5f88\u591a\u3002\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u7684```error_rate```\u8d8a\u5c0f\uff0c\u9700\u8981\u7684\u5b58\u50a8\u7a7a\u95f4\u5c31\u8d8a\u5927\uff0c\u5bf9\u4e8e\u4e0d\u9700\u8981\u8fc7\u4e8e\u7cbe\u786e\u7684\u573a\u5408\uff0c```error_rate```\u8bbe\u7f6e\u7a0d\u5927\u4e00\u70b9\u4e5f\u65e0\u4f24\u5927\u96c5\u3002\u6bd4\u5982\u5728\u65b0\u95fb\u53bb\u91cd\u4e0a\u800c\u8a00\uff0c\u8bef\u5224\u7387\u9ad8\u4e00\u70b9\u53ea\u4f1a\u8ba9\u5c0f\u90e8\u5206\u6587\u7ae0\u4e0d\u80fd\u8ba9\u5408\u9002\u7684\u4eba\u770b\u5230\uff0c\u6587\u7ae0\u7684\u6574\u4f53\u9605\u8bfb\u91cf\u4e0d\u4f1a\u56e0\u4e3a\u8fd9\u70b9\u8bef\u5224\u7387\u5c31\u5e26\u6765\u5de8\u5927\u7684\u6539\u53d8\u3002\n\n## \u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u539f\u7406\n\n\u5b66\u4f1a\u4e86\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u4f7f\u7528\uff0c\u4e0b\u9762\u6709\u5fc5\u8981\u628a\u539f\u7406\u89e3\u91ca\u4e00\u4e0b\uff0c\u4e0d\u7136\u8bfb\u8005\u8fd8\u4f1a\u7ee7\u7eed\u8499\u5728\u9f13\u91cc\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/16464301a0e26416?w=662&h=244&f=png&s=19146)\n\n\u6bcf\u4e2a\u5e03\u9686\u8fc7\u6ee4\u5668\u5bf9\u5e94\u5230 Redis \u7684\u6570\u636e\u7ed3\u6784\u91cc\u9762\u5c31\u662f\u4e00\u4e2a\u5927\u578b\u7684\u4f4d\u6570\u7ec4\u548c\u51e0\u4e2a\u4e0d\u4e00\u6837\u7684\u65e0\u504f hash \u51fd\u6570\u3002\u6240\u8c13\u65e0\u504f\u5c31\u662f\u80fd\u591f\u628a\u5143\u7d20\u7684 hash \u503c\u7b97\u5f97\u6bd4\u8f83\u5747\u5300\u3002\n\n\u5411\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\u6dfb\u52a0 key \u65f6\uff0c\u4f1a\u4f7f\u7528\u591a\u4e2a hash \u51fd\u6570\u5bf9 key \u8fdb\u884c hash \u7b97\u5f97\u4e00\u4e2a\u6574\u6570\u7d22\u5f15\u503c\u7136\u540e\u5bf9\u4f4d\u6570\u7ec4\u957f\u5ea6\u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\u5f97\u5230\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u6bcf\u4e2a hash \u51fd\u6570\u90fd\u4f1a\u7b97\u5f97\u4e00\u4e2a\u4e0d\u540c\u7684\u4f4d\u7f6e\u3002\u518d\u628a\u4f4d\u6570\u7ec4\u7684\u8fd9\u51e0\u4e2a\u4f4d\u7f6e\u90fd\u7f6e\u4e3a 1 \u5c31\u5b8c\u6210\u4e86 add \u64cd\u4f5c\u3002\n\n\u5411\u5e03\u9686\u8fc7\u6ee4\u5668\u8be2\u95ee key \u662f\u5426\u5b58\u5728\u65f6\uff0c\u8ddf add \u4e00\u6837\uff0c\u4e5f\u4f1a\u628a hash \u7684\u51e0\u4e2a\u4f4d\u7f6e\u90fd\u7b97\u51fa\u6765\uff0c\u770b\u770b\u4f4d\u6570\u7ec4\u4e2d\u8fd9\u51e0\u4e2a\u4f4d\u7f6e\u662f\u5426\u90fd\u4e3a 1\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u4f4d\u4e3a 0\uff0c\u90a3\u4e48\u8bf4\u660e\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\u8fd9\u4e2a key \u4e0d\u5b58\u5728\u3002\u5982\u679c\u90fd\u662f 1\uff0c\u8fd9\u5e76\u4e0d\u80fd\u8bf4\u660e\u8fd9\u4e2a key \u5c31\u4e00\u5b9a\u5b58\u5728\uff0c\u53ea\u662f\u6781\u6709\u53ef\u80fd\u5b58\u5728\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4f4d\u88ab\u7f6e\u4e3a 1 \u53ef\u80fd\u662f\u56e0\u4e3a\u5176\u5b83\u7684 key \u5b58\u5728\u6240\u81f4\u3002\u5982\u679c\u8fd9\u4e2a\u4f4d\u6570\u7ec4\u6bd4\u8f83\u7a00\u758f\uff0c\u5224\u65ad\u6b63\u786e\u7684\u6982\u7387\u5c31\u4f1a\u5f88\u5927\uff0c\u5982\u679c\u8fd9\u4e2a\u4f4d\u6570\u7ec4\u6bd4\u8f83\u62e5\u6324\uff0c\u5224\u65ad\u6b63\u786e\u7684\u6982\u7387\u5c31\u4f1a\u964d\u4f4e\u3002\u5177\u4f53\u7684\u6982\u7387\u8ba1\u7b97\u516c\u5f0f\u6bd4\u8f83\u590d\u6742\uff0c\u611f\u5174\u8da3\u53ef\u4ee5\u9605\u8bfb\u6269\u5c55\u9605\u8bfb\uff0c\u975e\u5e38\u70e7\u8111\uff0c\u4e0d\u5efa\u8bae\u8bfb\u8005\u7ec6\u770b\u3002\n\n\u4f7f\u7528\u65f6\u4e0d\u8981\u8ba9\u5b9e\u9645\u5143\u7d20\u8fdc\u5927\u4e8e\u521d\u59cb\u5316\u5927\u5c0f\uff0c\u5f53\u5b9e\u9645\u5143\u7d20\u5f00\u59cb\u8d85\u51fa\u521d\u59cb\u5316\u5927\u5c0f\u65f6\uff0c\u5e94\u8be5\u5bf9\u5e03\u9686\u8fc7\u6ee4\u5668\u8fdb\u884c\u91cd\u5efa\uff0c\u91cd\u65b0\u5206\u914d\u4e00\u4e2a size \u66f4\u5927\u7684\u8fc7\u6ee4\u5668\uff0c\u518d\u5c06\u6240\u6709\u7684\u5386\u53f2\u5143\u7d20\u6279\u91cf add \u8fdb\u53bb (\u8fd9\u5c31\u8981\u6c42\u6211\u4eec\u5728\u5176\u5b83\u7684\u5b58\u50a8\u5668\u4e2d\u8bb0\u5f55\u6240\u6709\u7684\u5386\u53f2\u5143\u7d20)\u3002\u56e0\u4e3a error_rate \u4e0d\u4f1a\u56e0\u4e3a\u6570\u91cf\u8d85\u51fa\u5c31\u6025\u5267\u589e\u52a0\uff0c\u8fd9\u5c31\u7ed9\u6211\u4eec\u91cd\u5efa\u8fc7\u6ee4\u5668\u63d0\u4f9b\u4e86\u8f83\u4e3a\u5bbd\u677e\u7684\u65f6\u95f4\u3002\n\n## \u7a7a\u95f4\u5360\u7528\u4f30\u8ba1\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u7a7a\u95f4\u5360\u7528\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u7b97\u516c\u5f0f\uff0c\u4f46\u662f\u63a8\u5bfc\u6bd4\u8f83\u7e41\u7410\uff0c\u8fd9\u91cc\u5c31\u7701\u53bb\u63a8\u5bfc\u8fc7\u7a0b\u4e86\uff0c\u76f4\u63a5\u5f15\u51fa\u8ba1\u7b97\u516c\u5f0f\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u70b9\u51fb\u300c\u6269\u5c55\u9605\u8bfb\u300d\u6df1\u5165\u7406\u89e3\u516c\u5f0f\u7684\u63a8\u5bfc\u8fc7\u7a0b\u3002\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u9884\u8ba1\u5143\u7d20\u7684\u6570\u91cf n\uff0c\u7b2c\u4e8c\u4e2a\u662f\u9519\u8bef\u7387 f\u3002\u516c\u5f0f\u6839\u636e\u8fd9\u4e24\u4e2a\u8f93\u5165\u5f97\u5230\u4e24\u4e2a\u8f93\u51fa\uff0c\u7b2c\u4e00\u4e2a\u8f93\u51fa\u662f\u4f4d\u6570\u7ec4\u7684\u957f\u5ea6 l\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u7684\u5b58\u50a8\u7a7a\u95f4\u5927\u5c0f (bit)\uff0c\u7b2c\u4e8c\u4e2a\u8f93\u51fa\u662f hash \u51fd\u6570\u7684\u6700\u4f73\u6570\u91cf k\u3002hash \u51fd\u6570\u7684\u6570\u91cf\u4e5f\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u9519\u8bef\u7387\uff0c\u6700\u4f73\u7684\u6570\u91cf\u4f1a\u6709\u6700\u4f4e\u7684\u9519\u8bef\u7387\u3002\n\n```\nk=0.7*(l/n)  # \u7ea6\u7b49\u4e8e\nf=0.6185^(l/n)  # ^ \u8868\u793a\u6b21\u65b9\u8ba1\u7b97\uff0c\u4e5f\u5c31\u662f math.pow\n```\n\u4ece\u516c\u5f0f\u4e2d\u53ef\u4ee5\u770b\u51fa\n1. \u4f4d\u6570\u7ec4\u76f8\u5bf9\u8d8a\u957f (l/n)\uff0c\u9519\u8bef\u7387 f \u8d8a\u4f4e\uff0c\u8fd9\u4e2a\u548c\u76f4\u89c2\u4e0a\u7406\u89e3\u662f\u4e00\u81f4\u7684\n2. \u4f4d\u6570\u7ec4\u76f8\u5bf9\u8d8a\u957f (l/n)\uff0chash \u51fd\u6570\u9700\u8981\u7684\u6700\u4f73\u6570\u91cf\u4e5f\u8d8a\u591a\uff0c\u5f71\u54cd\u8ba1\u7b97\u6548\u7387\n3. \u5f53\u4e00\u4e2a\u5143\u7d20\u5e73\u5747\u9700\u8981 1 \u4e2a\u5b57\u8282 (8bit) \u7684\u6307\u7eb9\u7a7a\u95f4\u65f6 (l/n=8)\uff0c\u9519\u8bef\u7387\u5927\u7ea6\u4e3a 2%\n4. \u9519\u8bef\u7387\u4e3a 10%\uff0c\u4e00\u4e2a\u5143\u7d20\u9700\u8981\u7684\u5e73\u5747\u6307\u7eb9\u7a7a\u95f4\u4e3a 4.792 \u4e2a bit\uff0c\u5927\u7ea6\u4e3a 5bit\n5. \u9519\u8bef\u7387\u4e3a 1%\uff0c\u4e00\u4e2a\u5143\u7d20\u9700\u8981\u7684\u5e73\u5747\u6307\u7eb9\u7a7a\u95f4\u4e3a 9.585 \u4e2a bit\uff0c\u5927\u7ea6\u4e3a 10bit\n6. \u9519\u8bef\u7387\u4e3a 0.1%\uff0c\u4e00\u4e2a\u5143\u7d20\u9700\u8981\u7684\u5e73\u5747\u6307\u7eb9\u7a7a\u95f4\u4e3a 14.377 \u4e2a bit\uff0c\u5927\u7ea6\u4e3a 15bit\n\n\u4f60\u4e5f\u8bb8\u4f1a\u60f3\uff0c\u5982\u679c\u4e00\u4e2a\u5143\u7d20\u9700\u8981\u5360\u636e 15 \u4e2a bit\uff0c\u90a3\u76f8\u5bf9 set \u96c6\u5408\u7684\u7a7a\u95f4\u4f18\u52bf\u662f\u4e0d\u662f\u5c31\u6ca1\u6709\u90a3\u4e48\u660e\u663e\u4e86\uff1f\u8fd9\u91cc\u9700\u8981\u660e\u786e\u7684\u662f\uff0cset \u4e2d\u4f1a\u5b58\u50a8\u6bcf\u4e2a\u5143\u7d20\u7684\u5185\u5bb9\uff0c\u800c\u5e03\u9686\u8fc7\u6ee4\u5668\u4ec5\u4ec5\u5b58\u50a8\u5143\u7d20\u7684\u6307\u7eb9\u3002\u5143\u7d20\u7684\u5185\u5bb9\u5927\u5c0f\u5c31\u662f\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u5b83\u4e00\u822c\u4f1a\u6709\u591a\u4e2a\u5b57\u8282\uff0c\u751a\u81f3\u662f\u51e0\u5341\u4e2a\u4e0a\u767e\u4e2a\u5b57\u8282\uff0c\u6bcf\u4e2a\u5143\u7d20\u672c\u8eab\u8fd8\u9700\u8981\u4e00\u4e2a\u6307\u9488\u88ab set \u96c6\u5408\u6765\u5f15\u7528\uff0c\u8fd9\u4e2a\u6307\u9488\u53c8\u4f1a\u5360\u53bb 4 \u4e2a\u5b57\u8282\u6216 8 \u4e2a\u5b57\u8282\uff0c\u53d6\u51b3\u4e8e\u7cfb\u7edf\u662f 32bit \u8fd8\u662f 64bit\u3002\u800c\u6307\u7eb9\u7a7a\u95f4\u53ea\u6709\u63a5\u8fd1 2 \u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u7a7a\u95f4\u4f18\u52bf\u8fd8\u662f\u975e\u5e38\u660e\u663e\u7684\u3002\n\n\u5982\u679c\u8bfb\u8005\u89c9\u5f97\u516c\u5f0f\u8ba1\u7b97\u8d77\u6765\u592a\u9ebb\u70e6\uff0c\u4e5f\u6ca1\u6709\u5173\u7cfb\uff0c\u6709\u5f88\u591a\u73b0\u6210\u7684\u7f51\u7ad9\u5df2\u7ecf\u652f\u6301\u8ba1\u7b97\u7a7a\u95f4\u5360\u7528\u7684\u529f\u80fd\u4e86\uff0c\u6211\u4eec\u53ea\u8981\u628a\u53c2\u6570\u8f93\u8fdb\u53bb\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u770b\u5230\u7ed3\u679c\uff0c\u6bd4\u5982 [\u5e03\u9686\u8ba1\u7b97\u5668](https://krisives.github.io/bloom-calculator/)\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/16464885cf1f74c2?w=735&h=541&f=png&s=72897)\n\n## \u5b9e\u9645\u5143\u7d20\u8d85\u51fa\u65f6\uff0c\u8bef\u5224\u7387\u4f1a\u600e\u6837\u53d8\u5316\n\n\u5f53\u5b9e\u9645\u5143\u7d20\u8d85\u51fa\u9884\u8ba1\u5143\u7d20\u65f6\uff0c\u9519\u8bef\u7387\u4f1a\u6709\u591a\u5927\u53d8\u5316\uff0c\u5b83\u4f1a\u6025\u5267\u4e0a\u5347\u4e48\uff0c\u8fd8\u662f\u5e73\u7f13\u5730\u4e0a\u5347\uff0c\u8fd9\u5c31\u9700\u8981\u53e6\u5916\u4e00\u4e2a\u516c\u5f0f\uff0c\u5f15\u5165\u53c2\u6570 t \u8868\u793a\u5b9e\u9645\u5143\u7d20\u548c\u9884\u8ba1\u5143\u7d20\u7684\u500d\u6570 t\n```\nf=(1-0.5^t)^k  # \u6781\u9650\u8fd1\u4f3c\uff0ck \u662f hash \u51fd\u6570\u7684\u6700\u4f73\u6570\u91cf\n```\n\u5f53 t \u589e\u5927\u65f6\uff0c\u9519\u8bef\u7387\uff0cf \u4e5f\u4f1a\u8ddf\u7740\u589e\u5927\uff0c\u5206\u522b\u9009\u62e9\u9519\u8bef\u7387\u4e3a 10%,1%,0.1% \u7684 k \u503c\uff0c\u753b\u51fa\u5b83\u7684\u66f2\u7ebf\u8fdb\u884c\u76f4\u89c2\u89c2\u5bdf\n\n![](https://user-gold-cdn.xitu.io/2018/7/5/164685454156e8e2?w=944&h=904&f=png&s=101584)\n\n\u4ece\u8fd9\u4e2a\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\u66f2\u7ebf\u8fd8\u662f\u6bd4\u8f83\u9661\u5ced\u7684\n\n1. \u9519\u8bef\u7387\u4e3a 10% \u65f6\uff0c\u500d\u6570\u6bd4\u4e3a 2 \u65f6\uff0c\u9519\u8bef\u7387\u5c31\u4f1a\u5347\u81f3\u63a5\u8fd1 40%\uff0c\u8fd9\u4e2a\u5c31\u6bd4\u8f83\u5371\u9669\u4e86\n2. \u9519\u8bef\u7387\u4e3a 1% \u65f6\uff0c\u500d\u6570\u6bd4\u4e3a 2 \u65f6\uff0c\u9519\u8bef\u7387\u5347\u81f3 15%\uff0c\u4e5f\u633a\u53ef\u6015\u7684\n3. \u9519\u8bef\u7387\u4e3a 0.1%\uff0c\u500d\u6570\u6bd4\u4e3a 2 \u65f6\uff0c\u9519\u8bef\u7387\u5347\u81f3 5%\uff0c\u4e5f\u6bd4\u8f83\u60ac\u4e86\n\n## \u7528\u4e0d\u4e0a Redis4.0 \u600e\u4e48\u529e\uff1f\n\nRedis 4.0 \u4e4b\u524d\u4e5f\u6709\u7b2c\u4e09\u65b9\u7684\u5e03\u9686\u8fc7\u6ee4\u5668 lib \u4f7f\u7528\uff0c\u53ea\u4e0d\u8fc7\u5728\u5b9e\u73b0\u4e0a\u4f7f\u7528 redis \u7684\u4f4d\u56fe\u6765\u5b9e\u73b0\u7684\uff0c\u6027\u80fd\u4e0a\u4e5f\u8981\u5dee\u4e0d\u5c11\u3002\u6bd4\u5982\u4e00\u6b21 exists \u67e5\u8be2\u4f1a\u6d89\u53ca\u5230\u591a\u6b21 getbit \u64cd\u4f5c\uff0c\u7f51\u7edc\u5f00\u9500\u76f8\u6bd4\u800c\u8a00\u4f1a\u9ad8\u51fa\u4e0d\u5c11\u3002\u53e6\u5916\u5728\u5b9e\u73b0\u4e0a\u8fd9\u4e9b\u7b2c\u4e09\u65b9 lib \u4e5f\u4e0d\u5c3d\u5b8c\u7f8e\uff0c\u6bd4\u5982 pyrebloom \u5e93\u5c31\u4e0d\u652f\u6301\u91cd\u8fde\u548c\u91cd\u8bd5\uff0c\u5728\u4f7f\u7528\u65f6\u9700\u8981\u5bf9\u5b83\u505a\u4e00\u5c42\u5c01\u88c5\u540e\u624d\u80fd\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u3002\n\n1. [Python Redis Bloom Filter](https://github.com/robinhoodmarkets/pyreBloom)\n2. [Java Redis Bloom Filter](https://github.com/Baqend/Orestes-Bloomfilter)\n\n## \u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u5176\u5b83\u5e94\u7528\n\n\u5728\u722c\u866b\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u5bf9 URL \u8fdb\u884c\u53bb\u91cd\uff0c\u5df2\u7ecf\u722c\u8fc7\u7684\u7f51\u9875\u5c31\u53ef\u4ee5\u4e0d\u7528\u722c\u4e86\u3002\u4f46\u662f URL \u592a\u591a\u4e86\uff0c\u51e0\u5343\u4e07\u51e0\u4e2a\u4ebf\uff0c\u5982\u679c\u7528\u4e00\u4e2a\u96c6\u5408\u88c5\u4e0b\u8fd9\u4e9b URL \u5730\u5740\u90a3\u662f\u975e\u5e38\u6d6a\u8d39\u7a7a\u95f4\u7684\u3002\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u3002\u5b83\u53ef\u4ee5\u5927\u5e45\u964d\u4f4e\u53bb\u91cd\u5b58\u50a8\u6d88\u8017\uff0c\u53ea\u4e0d\u8fc7\u4e5f\u4f1a\u4f7f\u5f97\u722c\u866b\u7cfb\u7edf\u9519\u8fc7\u5c11\u91cf\u7684\u9875\u9762\u3002\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u5728 NoSQL \u6570\u636e\u5e93\u9886\u57df\u4f7f\u7528\u975e\u5e38\u5e7f\u6cdb\uff0c\u6211\u4eec\u5e73\u65f6\u7528\u5230\u7684 HBase\u3001Cassandra \u8fd8\u6709 LevelDB\u3001RocksDB \u5185\u90e8\u90fd\u6709\u5e03\u9686\u8fc7\u6ee4\u5668\u7ed3\u6784\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u53ef\u4ee5\u663e\u8457\u964d\u4f4e\u6570\u636e\u5e93\u7684 IO \u8bf7\u6c42\u6570\u91cf\u3002\u5f53\u7528\u6237\u6765\u67e5\u8be2\u67d0\u4e2a row \u65f6\uff0c\u53ef\u4ee5\u5148\u901a\u8fc7\u5185\u5b58\u4e2d\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\u8fc7\u6ee4\u6389\u5927\u91cf\u4e0d\u5b58\u5728\u7684 row \u8bf7\u6c42\uff0c\u7136\u540e\u518d\u53bb\u78c1\u76d8\u8fdb\u884c\u67e5\u8be2\u3002\n\n\u90ae\u7bb1\u7cfb\u7edf\u7684\u5783\u573e\u90ae\u4ef6\u8fc7\u6ee4\u529f\u80fd\u4e5f\u666e\u904d\u7528\u5230\u4e86\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u56e0\u4e3a\u7528\u4e86\u8fd9\u4e2a\u8fc7\u6ee4\u5668\uff0c\u6240\u4ee5\u5e73\u65f6\u4e5f\u4f1a\u9047\u5230\u67d0\u4e9b\u6b63\u5e38\u7684\u90ae\u4ef6\u88ab\u653e\u8fdb\u4e86\u5783\u573e\u90ae\u4ef6\u76ee\u5f55\u4e2d\uff0c\u8fd9\u4e2a\u5c31\u662f\u8bef\u5224\u6240\u81f4\uff0c\u6982\u7387\u5f88\u4f4e\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u539f\u7406\u6d89\u53ca\u5230\u8f83\u4e3a\u590d\u6742\u7684\u6570\u5b66\u77e5\u8bc6\uff0c\u611f\u5174\u8da3\u53ef\u4ee5\u9605\u8bfb\u4e0b\u9762\u7684\u94fe\u63a5\u6587\u7ae0\u7ee7\u7eed\u6df1\u5165\u4e86\u89e3\u5185\u90e8\u539f\u7406\uff1a[\u5e03\u9686\u8fc7\u6ee4\u5668](http://www.cnblogs.com/allensun/archive/2011/02/16/1956532.html)\u3002\n\n\u540c\u6837\uff0c\u5982\u679c\u4f60\u662f\u4e2a\u6570\u5b66\u5b66\u6e23\uff0c\u90a3\u8001\u5e08\u6211\u5efa\u8bae\u4f60\u8c28\u614e\u89c2\u770b\uff0c\u8981\u6ce8\u610f\u4fdd\u62a4\u597d\u81ea\u5df1\u7684 24K \u949b\u5408\u91d1\u72d7\u773c\uff0c\u907f\u514d\u95ea\u778e\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/6\u5e94\u7528_5\u5c42\u5ce6\u53e0\u5d82__\u5e03\u9686\u8fc7\u6ee4\u5668.md", "create_date": "2020-02-18T03:00:33.031", "order": 7}}, {"model": "subject.chapter", "pk": 17, "fields": {"title": "9\u5e94\u7528 8\uff1a\u8fd1\u6c34\u697c\u53f0 \u2014\u2014 GeoHash", "topic": 2, "md5": "fc90751e344c691671fa333131d4678e", "md_body": "# \u5e94\u7528 8\uff1a\u8fd1\u6c34\u697c\u53f0 \u2014\u2014 GeoHash\n\nRedis \u5728 3.2 \u7248\u672c\u4ee5\u540e\u589e\u52a0\u4e86\u5730\u7406\u4f4d\u7f6e GEO \u6a21\u5757\uff0c\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Redis \u6765\u5b9e\u73b0\u6469\u62dc\u5355\u8f66\u300c\u9644\u8fd1\u7684 Mobike\u300d\u3001\u7f8e\u56e2\u548c\u997f\u4e86\u4e48\u300c\u9644\u8fd1\u7684\u9910\u9986\u300d\u8fd9\u6837\u7684\u529f\u80fd\u4e86\u3002\n\n## \u7528\u6570\u636e\u5e93\u6765\u7b97\u9644\u8fd1\u7684\u4eba\n\n\u5730\u56fe\u5143\u7d20\u7684\u4f4d\u7f6e\u6570\u636e\u4f7f\u7528\u4e8c\u7ef4\u7684\u7ecf\u7eac\u5ea6\u8868\u793a\uff0c\u7ecf\u5ea6\u8303\u56f4 (-180, 180]\uff0c\u7eac\u5ea6\u8303\u56f4 (-90, 90]\uff0c\u7eac\u5ea6\u6b63\u8d1f\u4ee5\u8d64\u9053\u4e3a\u754c\uff0c\u5317\u6b63\u5357\u8d1f\uff0c\u7ecf\u5ea6\u6b63\u8d1f\u4ee5\u672c\u521d\u5b50\u5348\u7ebf (\u82f1\u56fd\u683c\u6797\u5c3c\u6cbb\u5929\u6587\u53f0) \u4e3a\u754c\uff0c\u4e1c\u6b63\u897f\u8d1f\u3002\u6bd4\u5982\u6398\u91d1\u529e\u516c\u5ba4\u5728\u671b\u4eac SOHO\uff0c\u5b83\u7684\u7ecf\u7eac\u5ea6\u5750\u6807\u662f (116.48105,39.996794)\uff0c\u90fd\u662f\u6b63\u6570\uff0c\u56e0\u4e3a\u4e2d\u56fd\u4f4d\u4e8e\u4e1c\u5317\u534a\u7403\u3002\n\n\u5f53\u4e24\u4e2a\u5143\u7d20\u7684\u8ddd\u79bb\u4e0d\u662f\u5f88\u8fdc\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u52fe\u80a1\u5b9a\u7406\u5c31\u80fd\u7b97\u5f97\u5143\u7d20\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\u6211\u4eec\u5e73\u65f6\u4f7f\u7528\u7684\u300c\u9644\u8fd1\u7684\u4eba\u300d\u7684\u529f\u80fd\uff0c\u5143\u7d20\u8ddd\u79bb\u90fd\u4e0d\u662f\u5f88\u5927\uff0c\u52fe\u80a1\u5b9a\u7406\u7b97\u8ddd\u79bb\u8db3\u77e3\u3002\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7ecf\u7eac\u5ea6\u5750\u6807\u7684\u5bc6\u5ea6\u4e0d\u4e00\u6837 (\u5730\u7403\u662f\u4e00\u4e2a\u692d\u5706)\uff0c\u52fe\u80a1\u5b9a\u5f8b\u8ba1\u7b97\u5e73\u65b9\u5dee\u65f6\u4e4b\u540e\u518d\u6c42\u548c\u65f6\uff0c\u9700\u8981\u6309\u4e00\u5b9a\u7684\u7cfb\u6570\u6bd4\u52a0\u6743\u6c42\u548c\uff0c\u5982\u679c\u4e0d\u6c42\u7cbe\u786e\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u5fc5\u52a0\u6743\u3002\n\n\u95ee\u9898\uff1a\u7ecf\u5ea6\u603b\u5171360\u5ea6\uff0c\u7ef4\u5ea6\u603b\u5171\u53ea\u6709180\u5ea6\uff0c\u4e3a\u4ec0\u4e48\u8ddd\u79bb\u5bc6\u5ea6\u4e0d\u662f2:1\uff1f\n\n\u73b0\u5728\uff0c\u5982\u679c\u8981\u8ba1\u7b97\u300c\u9644\u8fd1\u7684\u4eba\u300d\uff0c\u4e5f\u5c31\u662f\u7ed9\u5b9a\u4e00\u4e2a\u5143\u7d20\u7684\u5750\u6807\uff0c\u7136\u540e\u8ba1\u7b97\u8fd9\u4e2a\u5750\u6807\u9644\u8fd1\u7684\u5176\u5b83\u5143\u7d20\uff0c\u6309\u7167\u8ddd\u79bb\u8fdb\u884c\u6392\u5e8f\uff0c\u8be5\u5982\u4f55\u4e0b\u624b\uff1f\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/1646385f96a0f91f?w=657&h=334&f=png&s=17950)\n\n\u5982\u679c\u73b0\u5728\u5143\u7d20\u7684\u7ecf\u7eac\u5ea6\u5750\u6807\u4f7f\u7528\u5173\u7cfb\u6570\u636e\u5e93 (\u5143\u7d20 id, \u7ecf\u5ea6 x, \u7eac\u5ea6 y) \u5b58\u50a8\uff0c\u4f60\u8be5\u5982\u4f55\u8ba1\u7b97\uff1f\n\n\u9996\u5148\uff0c\u4f60\u4e0d\u53ef\u80fd\u901a\u8fc7\u904d\u5386\u6765\u8ba1\u7b97\u6240\u6709\u7684\u5143\u7d20\u548c\u76ee\u6807\u5143\u7d20\u7684\u8ddd\u79bb\u7136\u540e\u518d\u8fdb\u884c\u6392\u5e8f\uff0c\u8fd9\u4e2a\u8ba1\u7b97\u91cf\u592a\u5927\u4e86\uff0c\u6027\u80fd\u6307\u6807\u80af\u5b9a\u65e0\u6cd5\u6ee1\u8db3\u3002\u4e00\u822c\u7684\u65b9\u6cd5\u90fd\u662f\u901a\u8fc7\u77e9\u5f62\u533a\u57df\u6765\u9650\u5b9a\u5143\u7d20\u7684\u6570\u91cf\uff0c\u7136\u540e\u5bf9\u533a\u57df\u5185\u7684\u5143\u7d20\u8fdb\u884c\u5168\u91cf\u8ddd\u79bb\u8ba1\u7b97\u518d\u6392\u5e8f\u3002\u8fd9\u6837\u53ef\u4ee5\u660e\u663e\u51cf\u5c11\u8ba1\u7b97\u91cf\u3002\u5982\u4f55\u5212\u5206\u77e9\u5f62\u533a\u57df\u5462\uff1f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u534a\u5f84 r\uff0c\u4f7f\u7528\u4e00\u6761 SQL \u5c31\u53ef\u4ee5\u5708\u51fa\u6765\u3002\u5f53\u7528\u6237\u5bf9\u7b5b\u51fa\u6765\u7684\u7ed3\u679c\u4e0d\u6ee1\u610f\uff0c\u90a3\u5c31\u6269\u5927\u534a\u5f84\u7ee7\u7eed\u7b5b\u9009\u3002\n\n```\nselect id from positions where x0-r < x < x0+r and y0-r < y < y0+r\n```\n\n\u4e3a\u4e86\u6ee1\u8db3\u9ad8\u6027\u80fd\u7684\u77e9\u5f62\u533a\u57df\u7b97\u6cd5\uff0c\u6570\u636e\u8868\u9700\u8981\u5728\u7ecf\u7eac\u5ea6\u5750\u6807\u52a0\u4e0a\u53cc\u5411\u590d\u5408\u7d22\u5f15 (x, y)\uff0c\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u4f18\u5316\u67e5\u8be2\u6027\u80fd\u3002\n\n\u4f46\u662f\u6570\u636e\u5e93\u67e5\u8be2\u6027\u80fd\u6bd5\u7adf\u6709\u9650\uff0c\u5982\u679c\u300c\u9644\u8fd1\u7684\u4eba\u300d\u67e5\u8be2\u8bf7\u6c42\u975e\u5e38\u591a\uff0c\u5728\u9ad8\u5e76\u53d1\u573a\u5408\uff0c\u8fd9\u53ef\u80fd\u5e76\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u65b9\u6848\u3002\n\n## GeoHash \u7b97\u6cd5\n\n\u4e1a\u754c\u6bd4\u8f83\u901a\u7528\u7684\u5730\u7406\u4f4d\u7f6e\u8ddd\u79bb\u6392\u5e8f\u7b97\u6cd5\u662f GeoHash \u7b97\u6cd5\uff0cRedis \u4e5f\u4f7f\u7528 GeoHash \u7b97\u6cd5\u3002GeoHash \u7b97\u6cd5\u5c06\u4e8c\u7ef4\u7684\u7ecf\u7eac\u5ea6\u6570\u636e\u6620\u5c04\u5230\u4e00\u7ef4\u7684\u6574\u6570\uff0c\u8fd9\u6837\u6240\u6709\u7684\u5143\u7d20\u90fd\u5c06\u5728\u6302\u8f7d\u5230\u4e00\u6761\u7ebf\u4e0a\uff0c\u8ddd\u79bb\u9760\u8fd1\u7684\u4e8c\u7ef4\u5750\u6807\u6620\u5c04\u5230\u4e00\u7ef4\u540e\u7684\u70b9\u4e4b\u95f4\u8ddd\u79bb\u4e5f\u4f1a\u5f88\u63a5\u8fd1\u3002\u5f53\u6211\u4eec\u60f3\u8981\u8ba1\u7b97\u300c\u9644\u8fd1\u7684\u4eba\u65f6\u300d\uff0c\u9996\u5148\u5c06\u76ee\u6807\u4f4d\u7f6e\u6620\u5c04\u5230\u8fd9\u6761\u7ebf\u4e0a\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u4e00\u7ef4\u7684\u7ebf\u4e0a\u83b7\u53d6\u9644\u8fd1\u7684\u70b9\u5c31\u884c\u4e86\u3002\n\n\u90a3\u8fd9\u4e2a\u6620\u5c04\u7b97\u6cd5\u5177\u4f53\u662f\u600e\u6837\u7684\u5462\uff1f\u5b83\u5c06\u6574\u4e2a\u5730\u7403\u770b\u6210\u4e00\u4e2a\u4e8c\u7ef4\u5e73\u9762\uff0c\u7136\u540e\u5212\u5206\u6210\u4e86\u4e00\u7cfb\u5217\u6b63\u65b9\u5f62\u7684\u65b9\u683c\uff0c\u5c31\u597d\u6bd4\u56f4\u68cb\u68cb\u76d8\u3002\u6240\u6709\u7684\u5730\u56fe\u5143\u7d20\u5750\u6807\u90fd\u5c06\u653e\u7f6e\u4e8e\u552f\u4e00\u7684\u65b9\u683c\u4e2d\u3002\u65b9\u683c\u8d8a\u5c0f\uff0c\u5750\u6807\u8d8a\u7cbe\u786e\u3002\u7136\u540e\u5bf9\u8fd9\u4e9b\u65b9\u683c\u8fdb\u884c\u6574\u6570\u7f16\u7801\uff0c\u8d8a\u662f\u9760\u8fd1\u7684\u65b9\u683c\u7f16\u7801\u8d8a\u662f\u63a5\u8fd1\u3002\u90a3\u5982\u4f55\u7f16\u7801\u5462\uff1f\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u65b9\u6848\u5c31\u662f\u5207\u86cb\u7cd5\u6cd5\u3002\u8bbe\u60f3\u4e00\u4e2a\u6b63\u65b9\u5f62\u7684\u86cb\u7cd5\u6446\u5728\u4f60\u9762\u524d\uff0c\u4e8c\u5200\u4e0b\u53bb\u5747\u5206\u5206\u6210\u56db\u5757\u5c0f\u6b63\u65b9\u5f62\uff0c\u8fd9\u56db\u4e2a\u5c0f\u6b63\u65b9\u5f62\u53ef\u4ee5\u5206\u522b\u6807\u8bb0\u4e3a 00,01,10,11 \u56db\u4e2a\u4e8c\u8fdb\u5236\u6574\u6570\u3002\u7136\u540e\u5bf9\u6bcf\u4e00\u4e2a\u5c0f\u6b63\u65b9\u5f62\u7ee7\u7eed\u7528\u4e8c\u5200\u6cd5\u5207\u5272\u4e00\u4e0b\uff0c\u8fd9\u65f6\u6bcf\u4e2a\u5c0f\u5c0f\u6b63\u65b9\u5f62\u5c31\u53ef\u4ee5\u4f7f\u7528 4bit \u7684\u4e8c\u8fdb\u5236\u6574\u6570\u4e88\u4ee5\u8868\u793a\u3002\u7136\u540e\u7ee7\u7eed\u5207\u4e0b\u53bb\uff0c\u6b63\u65b9\u5f62\u5c31\u4f1a\u8d8a\u6765\u8d8a\u5c0f\uff0c\u4e8c\u8fdb\u5236\u6574\u6570\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u957f\uff0c\u7cbe\u786e\u5ea6\u5c31\u4f1a\u8d8a\u6765\u8d8a\u9ad8\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/1646397a223e2019?w=400&h=400&f=gif&s=172282)\n\n\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u4f7f\u7528\u7684\u662f\u4e8c\u5200\u6cd5\uff0c\u771f\u5b9e\u7b97\u6cd5\u4e2d\u8fd8\u4f1a\u6709\u5f88\u591a\u5176\u5b83\u5200\u6cd5\uff0c\u6700\u7ec8\u7f16\u7801\u51fa\u6765\u7684\u6574\u6570\u6570\u5b57\u4e5f\u90fd\u4e0d\u4e00\u6837\u3002\n\n\u7f16\u7801\u4e4b\u540e\uff0c\u6bcf\u4e2a\u5730\u56fe\u5143\u7d20\u7684\u5750\u6807\u90fd\u5c06\u53d8\u6210\u4e00\u4e2a\u6574\u6570\uff0c\u901a\u8fc7\u8fd9\u4e2a\u6574\u6570\u53ef\u4ee5\u8fd8\u539f\u51fa\u5143\u7d20\u7684\u5750\u6807\uff0c\u6574\u6570\u8d8a\u957f\uff0c\u8fd8\u539f\u51fa\u6765\u7684\u5750\u6807\u503c\u7684\u635f\u5931\u7a0b\u5ea6\u5c31\u8d8a\u5c0f\u3002\u5bf9\u4e8e\u300c\u9644\u8fd1\u7684\u4eba\u300d\u8fd9\u4e2a\u529f\u80fd\u800c\u8a00\uff0c\u635f\u5931\u7684\u4e00\u70b9\u7cbe\u786e\u5ea6\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u3002\n\nGeoHash \u7b97\u6cd5\u4f1a\u7ee7\u7eed\u5bf9\u8fd9\u4e2a\u6574\u6570\u505a\u4e00\u6b21 base32 \u7f16\u7801 (0-9,a-z \u53bb\u6389 a,i,l,o \u56db\u4e2a\u5b57\u6bcd) \u53d8\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u5728 Redis \u91cc\u9762\uff0c\u7ecf\u7eac\u5ea6\u4f7f\u7528 52 \u4f4d\u7684\u6574\u6570\u8fdb\u884c\u7f16\u7801\uff0c\u653e\u8fdb\u4e86 zset \u91cc\u9762\uff0czset \u7684 value \u662f\u5143\u7d20\u7684 key\uff0cscore \u662f GeoHash \u7684 52 \u4f4d\u6574\u6570\u503c\u3002zset \u7684 score \u867d\u7136\u662f\u6d6e\u70b9\u6570\uff0c\u4f46\u662f\u5bf9\u4e8e 52 \u4f4d\u7684\u6574\u6570\u503c\uff0c\u5b83\u53ef\u4ee5\u65e0\u635f\u5b58\u50a8\u3002\n\n\u5728\u4f7f\u7528 Redis \u8fdb\u884c Geo \u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u8981\u65f6\u523b\u60f3\u5230\u5b83\u7684\u5185\u90e8\u7ed3\u6784\u5b9e\u9645\u4e0a\u53ea\u662f\u4e00\u4e2a zset(skiplist)\u3002\u901a\u8fc7 zset \u7684 score \u6392\u5e8f\u5c31\u53ef\u4ee5\u5f97\u5230\u5750\u6807\u9644\u8fd1\u7684\u5176\u5b83\u5143\u7d20 (\u5b9e\u9645\u60c5\u51b5\u8981\u590d\u6742\u4e00\u4e9b\uff0c\u4e0d\u8fc7\u8fd9\u6837\u7406\u89e3\u8db3\u591f\u4e86)\uff0c\u901a\u8fc7\u5c06 score \u8fd8\u539f\u6210\u5750\u6807\u503c\u5c31\u53ef\u4ee5\u5f97\u5230\u5143\u7d20\u7684\u539f\u59cb\u5750\u6807\u3002\n\n## Redis \u7684 Geo \u6307\u4ee4\u57fa\u672c\u4f7f\u7528\n\nRedis \u63d0\u4f9b\u7684 Geo \u6307\u4ee4\u53ea\u6709 6 \u4e2a\uff0c\u8bfb\u8005\u4eec\u77ac\u95f4\u5c31\u53ef\u4ee5\u638c\u63e1\u3002\u4f7f\u7528\u65f6\uff0c\u8bfb\u8005\u52a1\u5fc5\u518d\u6b21\u60f3\u8d77\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u666e\u901a\u7684 zset \u7ed3\u6784\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/1646429f124a8aac?w=484&h=247&f=png&s=21537)\n\n**\u589e\u52a0** \n\ngeoadd \u6307\u4ee4\u643a\u5e26\u96c6\u5408\u540d\u79f0\u4ee5\u53ca\u591a\u4e2a\u7ecf\u7eac\u5ea6\u540d\u79f0\u4e09\u5143\u7ec4\uff0c\u6ce8\u610f\u8fd9\u91cc\u53ef\u4ee5\u52a0\u5165\u591a\u4e2a\u4e09\u5143\u7ec4\n```\n127.0.0.1:6379> geoadd company 116.48105 39.996794 juejin\n(integer) 1\n127.0.0.1:6379> geoadd company 116.514203 39.905409 ireader\n(integer) 1\n127.0.0.1:6379> geoadd company 116.489033 40.007669 meituan\n(integer) 1\n127.0.0.1:6379> geoadd company 116.562108 39.787602 jd 116.334255 40.027400 xiaomi\n(integer) 2\n```\n\u4e5f\u8bb8\u4f60\u4f1a\u95ee\u4e3a\u4ec0\u4e48 Redis \u6ca1\u6709\u63d0\u4f9b geo \u5220\u9664\u6307\u4ee4\uff1f\u524d\u9762\u6211\u4eec\u63d0\u5230 geo \u5b58\u50a8\u7ed3\u6784\u4e0a\u4f7f\u7528\u7684\u662f zset\uff0c\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 zset \u76f8\u5173\u7684\u6307\u4ee4\u6765\u64cd\u4f5c geo \u6570\u636e\uff0c\u6240\u4ee5\u5220\u9664\u6307\u4ee4\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 zrem \u6307\u4ee4\u5373\u53ef\u3002\n\n**\u8ddd\u79bb** \n\ngeodist \u6307\u4ee4\u53ef\u4ee5\u7528\u6765\u8ba1\u7b97\u4e24\u4e2a\u5143\u7d20\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u643a\u5e26\u96c6\u5408\u540d\u79f0\u30012 \u4e2a\u540d\u79f0\u548c\u8ddd\u79bb\u5355\u4f4d\u3002\n```\n127.0.0.1:6379> geodist company juejin ireader km\n\"10.5501\"\n127.0.0.1:6379> geodist company juejin meituan km\n\"1.3878\"\n127.0.0.1:6379> geodist company juejin jd km\n\"24.2739\"\n127.0.0.1:6379> geodist company juejin xiaomi km\n\"12.9606\"\n127.0.0.1:6379> geodist company juejin juejin km\n\"0.0000\"\n```\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6398\u91d1\u79bb\u7f8e\u56e2\u6700\u8fd1\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u5728\u671b\u4eac\u3002\u8ddd\u79bb\u5355\u4f4d\u53ef\u4ee5\u662f m\u3001km\u3001ml\u3001ft\uff0c\u5206\u522b\u4ee3\u8868\u7c73\u3001\u5343\u7c73\u3001\u82f1\u91cc\u548c\u5c3a\u3002\n\n**\u83b7\u53d6\u5143\u7d20\u4f4d\u7f6e** \n\ngeopos \u6307\u4ee4\u53ef\u4ee5\u83b7\u53d6\u96c6\u5408\u4e2d\u4efb\u610f\u5143\u7d20\u7684\u7ecf\u7eac\u5ea6\u5750\u6807\uff0c\u53ef\u4ee5\u4e00\u6b21\u83b7\u53d6\u591a\u4e2a\u3002\n\n```\n127.0.0.1:6379> geopos company juejin\n1) 1) \"116.48104995489120483\"\n   2) \"39.99679348858259686\"\n127.0.0.1:6379> geopos company ireader\n1) 1) \"116.5142020583152771\"\n   2) \"39.90540918662494363\"\n127.0.0.1:6379> geopos company juejin ireader\n1) 1) \"116.48104995489120483\"\n   2) \"39.99679348858259686\"\n2) 1) \"116.5142020583152771\"\n   2) \"39.90540918662494363\"\n```\n\u6211\u4eec\u89c2\u5bdf\u5230\u83b7\u53d6\u7684\u7ecf\u7eac\u5ea6\u5750\u6807\u548c geoadd \u8fdb\u53bb\u7684\u5750\u6807\u6709\u8f7b\u5fae\u7684\u8bef\u5dee\uff0c\u539f\u56e0\u662f geohash \u5bf9\u4e8c\u7ef4\u5750\u6807\u8fdb\u884c\u7684\u4e00\u7ef4\u6620\u5c04\u662f\u6709\u635f\u7684\uff0c\u901a\u8fc7\u6620\u5c04\u518d\u8fd8\u539f\u56de\u6765\u7684\u503c\u4f1a\u51fa\u73b0\u8f83\u5c0f\u7684\u5dee\u522b\u3002\u5bf9\u4e8e\u300c\u9644\u8fd1\u7684\u4eba\u300d\u8fd9\u79cd\u529f\u80fd\u6765\u8bf4\uff0c\u8fd9\u70b9\u8bef\u5dee\u6839\u672c\u4e0d\u662f\u4e8b\u3002\n\n**\u83b7\u53d6\u5143\u7d20\u7684 hash \u503c** \n\ngeohash \u53ef\u4ee5\u83b7\u53d6\u5143\u7d20\u7684\u7ecf\u7eac\u5ea6\u7f16\u7801\u5b57\u7b26\u4e32\uff0c\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\uff0c\u5b83\u662f base32 \u7f16\u7801\u3002\n\u4f60\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7f16\u7801\u503c\u53bb http://geohash.org/${hash}\u4e2d\u8fdb\u884c\u76f4\u63a5\u5b9a\u4f4d\uff0c\u5b83\u662f geohash \u7684\u6807\u51c6\u7f16\u7801\u503c\u3002\n```\n127.0.0.1:6379> geohash company ireader\n1) \"wx4g52e1ce0\"\n127.0.0.1:6379> geohash company juejin\n1) \"wx4gd94yjn0\"\n```\n\u8ba9\u6211\u4eec\u6253\u5f00\u5730\u5740 http://geohash.org/wx4g52e1ce0\uff0c\u89c2\u5bdf\u5730\u56fe\u6307\u5411\u7684\u4f4d\u7f6e\u662f\u5426\u6b63\u786e\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/16463ea81a176326?w=716&h=693&f=png&s=307562)\n\n\u5f88\u597d\uff0c\u5c31\u662f\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u975e\u5e38\u51c6\u786e\u3002\n\n**\u9644\u8fd1\u7684\u516c\u53f8**\n\ngeoradiusbymember \u6307\u4ee4\u662f\u6700\u4e3a\u5173\u952e\u7684\u6307\u4ee4\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u6307\u5b9a\u5143\u7d20\u9644\u8fd1\u7684\u5176\u5b83\u5143\u7d20\uff0c\u5b83\u7684\u53c2\u6570\u975e\u5e38\u590d\u6742\u3002\n```\n# \u8303\u56f4 20 \u516c\u91cc\u4ee5\u5185\u6700\u591a 3 \u4e2a\u5143\u7d20\u6309\u8ddd\u79bb\u6b63\u6392\uff0c\u5b83\u4e0d\u4f1a\u6392\u9664\u81ea\u8eab\n127.0.0.1:6379> georadiusbymember company ireader 20 km count 3 asc\n1) \"ireader\"\n2) \"juejin\"\n3) \"meituan\"\n# \u8303\u56f4 20 \u516c\u91cc\u4ee5\u5185\u6700\u591a 3 \u4e2a\u5143\u7d20\u6309\u8ddd\u79bb\u5012\u6392\n127.0.0.1:6379> georadiusbymember company ireader 20 km count 3 desc\n1) \"jd\"\n2) \"meituan\"\n3) \"juejin\"\n# \u4e09\u4e2a\u53ef\u9009\u53c2\u6570 withcoord withdist withhash \u7528\u6765\u643a\u5e26\u9644\u52a0\u53c2\u6570\n# withdist \u5f88\u6709\u7528\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u663e\u793a\u8ddd\u79bb\n127.0.0.1:6379> georadiusbymember company ireader 20 km withcoord withdist withhash count 3 asc\n1) 1) \"ireader\"\n   2) \"0.0000\"\n   3) (integer) 4069886008361398\n   4) 1) \"116.5142020583152771\"\n      2) \"39.90540918662494363\"\n2) 1) \"juejin\"\n   2) \"10.5501\"\n   3) (integer) 4069887154388167\n   4) 1) \"116.48104995489120483\"\n      2) \"39.99679348858259686\"\n3) 1) \"meituan\"\n   2) \"11.5748\"\n   3) (integer) 4069887179083478\n   4) 1) \"116.48903220891952515\"\n      2) \"40.00766997707732031\"\n```\n\n\u9664\u4e86 georadiusbymember \u6307\u4ee4\u6839\u636e\u5143\u7d20\u67e5\u8be2\u9644\u8fd1\u7684\u5143\u7d20\uff0cRedis \u8fd8\u63d0\u4f9b\u4e86\u6839\u636e\u5750\u6807\u503c\u6765\u67e5\u8be2\u9644\u8fd1\u7684\u5143\u7d20\uff0c\u8fd9\u4e2a\u6307\u4ee4\u66f4\u52a0\u6709\u7528\uff0c\u5b83\u53ef\u4ee5\u6839\u636e\u7528\u6237\u7684\u5b9a\u4f4d\u6765\u8ba1\u7b97\u300c\u9644\u8fd1\u7684\u8f66\u300d\uff0c\u300c\u9644\u8fd1\u7684\u9910\u9986\u300d\u7b49\u3002\u5b83\u7684\u53c2\u6570\u548c georadiusbymember \u57fa\u672c\u4e00\u81f4\uff0c\u9664\u4e86\u5c06\u76ee\u6807\u5143\u7d20\u6539\u6210\u7ecf\u7eac\u5ea6\u5750\u6807\u503c\u3002\n```\n127.0.0.1:6379> georadius company 116.514202 39.905409 20 km withdist count 3 asc\n1) 1) \"ireader\"\n   2) \"0.0000\"\n2) 1) \"juejin\"\n   2) \"10.5501\"\n3) 1) \"meituan\"\n   2) \"11.5748\"\n```\n\n## \u5c0f\u7ed3 & \u6ce8\u610f\u4e8b\u9879\n\n\u5728\u4e00\u4e2a\u5730\u56fe\u5e94\u7528\u4e2d\uff0c\u8f66\u7684\u6570\u636e\u3001\u9910\u9986\u7684\u6570\u636e\u3001\u4eba\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u6709\u767e\u4e07\u5343\u4e07\u6761\uff0c\u5982\u679c\u4f7f\u7528 Redis \u7684 Geo \u6570\u636e\u7ed3\u6784\uff0c\u5b83\u4eec\u5c06\u5168\u90e8\u653e\u5728\u4e00\u4e2a zset \u96c6\u5408\u4e2d\u3002\u5728 Redis \u7684\u96c6\u7fa4\u73af\u5883\u4e2d\uff0c\u96c6\u5408\u53ef\u80fd\u4f1a\u4ece\u4e00\u4e2a\u8282\u70b9\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u8282\u70b9\uff0c\u5982\u679c\u5355\u4e2a key \u7684\u6570\u636e\u8fc7\u5927\uff0c\u4f1a\u5bf9\u96c6\u7fa4\u7684\u8fc1\u79fb\u5de5\u4f5c\u9020\u6210\u8f83\u5927\u7684\u5f71\u54cd\uff0c\u5728\u96c6\u7fa4\u73af\u5883\u4e2d\u5355\u4e2a key \u5bf9\u5e94\u7684\u6570\u636e\u91cf\u4e0d\u5b9c\u8d85\u8fc7 1M\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u8fc1\u79fb\u51fa\u73b0\u5361\u987f\u73b0\u8c61\uff0c\u5f71\u54cd\u7ebf\u4e0a\u670d\u52a1\u7684\u6b63\u5e38\u8fd0\u884c\u3002\n\n\u6240\u4ee5\uff0c\u8fd9\u91cc\u5efa\u8bae Geo \u7684\u6570\u636e\u4f7f\u7528\u5355\u72ec\u7684 Redis \u5b9e\u4f8b\u90e8\u7f72\uff0c\u4e0d\u4f7f\u7528\u96c6\u7fa4\u73af\u5883\u3002\n\n\u5982\u679c\u6570\u636e\u91cf\u8fc7\u4ebf\u751a\u81f3\u66f4\u5927\uff0c\u5c31\u9700\u8981\u5bf9 Geo \u6570\u636e\u8fdb\u884c\u62c6\u5206\uff0c\u6309\u56fd\u5bb6\u62c6\u5206\u3001\u6309\u7701\u62c6\u5206\uff0c\u6309\u5e02\u62c6\u5206\uff0c\u5728\u4eba\u53e3\u7279\u5927\u57ce\u5e02\u751a\u81f3\u53ef\u4ee5\u6309\u533a\u62c6\u5206\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u663e\u8457\u964d\u4f4e\u5355\u4e2a zset \u96c6\u5408\u7684\u5927\u5c0f\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/9\u5e94\u7528_8\u8fd1\u6c34\u697c\u53f0__GeoHash.md", "create_date": "2020-02-18T03:01:05.590", "order": 10}}, {"model": "subject.chapter", "pk": 18, "fields": {"title": "11\u539f\u7406 1\uff1a\u97ad\u8f9f\u5165\u91cc \u2014\u2014 \u7ebf\u7a0b IO \u6a21\u578b", "topic": 2, "md5": "718576cff18a54fca29be515a6a1424c", "md_body": "# \u539f\u7406 1\uff1a\u97ad\u8f9f\u5165\u91cc \u2014\u2014 \u7ebf\u7a0b IO \u6a21\u578b\n\n**Redis \u662f\u4e2a\u5355\u7ebf\u7a0b\u7a0b\u5e8f**\uff01\u8fd9\u70b9\u5fc5\u987b\u94ed\u8bb0\u3002\n\n\u4e5f\u8bb8\u4f60\u4f1a\u6000\u7591\u9ad8\u5e76\u53d1\u7684 Redis \u4e2d\u95f4\u4ef6\u600e\u4e48\u53ef\u80fd\u662f\u5355\u7ebf\u7a0b\u3002\u5f88\u62b1\u6b49\uff0c\u5b83\u5c31\u662f\u5355\u7ebf\u7a0b\uff0c\u4f60\u7684\u6000\u7591\u66b4\u9732\u4e86\u4f60\u57fa\u7840\u77e5\u8bc6\u7684\u4e0d\u8db3\u3002\u83ab\u8981\u77a7\u4e0d\u8d77\u5355\u7ebf\u7a0b\uff0c\u9664\u4e86 Redis \u4e4b\u5916\uff0cNode.js \u4e5f\u662f\u5355\u7ebf\u7a0b\uff0cNginx \u4e5f\u662f\u5355\u7ebf\u7a0b\uff0c\u4f46\u662f\u5b83\u4eec\u90fd\u662f\u670d\u52a1\u5668\u9ad8\u6027\u80fd\u7684\u5178\u8303\u3002\n\n**Redis \u5355\u7ebf\u7a0b\u4e3a\u4ec0\u4e48\u8fd8\u80fd\u8fd9\u4e48\u5feb\uff1f**\n\n\u56e0\u4e3a\u5b83\u6240\u6709\u7684\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\uff0c\u6240\u6709\u7684\u8fd0\u7b97\u90fd\u662f\u5185\u5b58\u7ea7\u522b\u7684\u8fd0\u7b97\u3002\u6b63\u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b\uff0c\u6240\u4ee5\u8981\u5c0f\u5fc3\u4f7f\u7528 Redis \u6307\u4ee4\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n) \u7ea7\u522b\u7684\u6307\u4ee4\uff0c\u4e00\u5b9a\u8981\u8c28\u614e\u4f7f\u7528\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4 Redis \u5361\u987f\u3002\n\n**Redis \u5355\u7ebf\u7a0b\u5982\u4f55\u5904\u7406\u90a3\u4e48\u591a\u7684\u5e76\u53d1\u5ba2\u6237\u7aef\u8fde\u63a5\uff1f**\n\n\u8fd9\u4e2a\u95ee\u9898\uff0c\u6709\u5f88\u591a\u4e2d\u9ad8\u7ea7\u7a0b\u5e8f\u5458\u90fd\u65e0\u6cd5\u56de\u7b54\uff0c\u56e0\u4e3a\u4ed6\u4eec\u6ca1\u542c\u8fc7**\u591a\u8def\u590d\u7528**\u8fd9\u4e2a\u8bcd\u6c47\uff0c\u4e0d\u77e5\u9053 select \u7cfb\u5217\u7684\u4e8b\u4ef6\u8f6e\u8be2 API\uff0c\u6ca1\u7528\u8fc7\u975e\u963b\u585e IO\u3002\n\n\u975e\u963b\u585e IO\n--\n\u5f53\u6211\u4eec\u8c03\u7528\u5957\u63a5\u5b57\u7684\u8bfb\u5199\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u5b83\u4eec\u662f\u963b\u585e\u7684\uff0c\u6bd4\u5982```read```\u65b9\u6cd5\u8981\u4f20\u9012\u8fdb\u53bb\u4e00\u4e2a\u53c2\u6570```n```\uff0c\u8868\u793a\u6700\u591a\u8bfb\u53d6\u8fd9\u4e48\u591a\u5b57\u8282\u540e\u518d\u8fd4\u56de\uff0c\u5982\u679c\u4e00\u4e2a\u5b57\u8282\u90fd\u6ca1\u6709\uff0c\u90a3\u4e48\u7ebf\u7a0b\u5c31\u4f1a\u5361\u5728\u90a3\u91cc\uff0c\u76f4\u5230\u65b0\u7684\u6570\u636e\u5230\u6765\u6216\u8005\u8fde\u63a5\u5173\u95ed\u4e86\uff0c```read```\u65b9\u6cd5\u624d\u53ef\u4ee5\u8fd4\u56de\uff0c\u7ebf\u7a0b\u624d\u80fd\u7ee7\u7eed\u5904\u7406\u3002\u800c```write```\u65b9\u6cd5\u4e00\u822c\u6765\u8bf4\u4e0d\u4f1a\u963b\u585e\uff0c\u9664\u975e\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u5199\u7f13\u51b2\u533a\u5df2\u7ecf\u6ee1\u4e86\uff0c```write```\u65b9\u6cd5\u5c31\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u7f13\u5b58\u533a\u4e2d\u6709\u7a7a\u95f2\u7a7a\u95f4\u632a\u51fa\u6765\u4e86\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/8/26/165739c849e21857?w=1850&h=894&f=png&s=194143)\n\n\u975e\u963b\u585e IO \u5728\u5957\u63a5\u5b57\u5bf9\u8c61\u4e0a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9009\u9879```Non_Blocking```\uff0c\u5f53\u8fd9\u4e2a\u9009\u9879\u6253\u5f00\u65f6\uff0c\u8bfb\u5199\u65b9\u6cd5\u4e0d\u4f1a\u963b\u585e\uff0c\u800c\u662f\u80fd\u8bfb\u591a\u5c11\u8bfb\u591a\u5c11\uff0c\u80fd\u5199\u591a\u5c11\u5199\u591a\u5c11\u3002\u80fd\u8bfb\u591a\u5c11\u53d6\u51b3\u4e8e\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u8bfb\u7f13\u51b2\u533a\u5185\u90e8\u7684\u6570\u636e\u5b57\u8282\u6570\uff0c\u80fd\u5199\u591a\u5c11\u53d6\u51b3\u4e8e\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u5199\u7f13\u51b2\u533a\u7684\u7a7a\u95f2\u7a7a\u95f4\u5b57\u8282\u6570\u3002\u8bfb\u65b9\u6cd5\u548c\u5199\u65b9\u6cd5\u90fd\u4f1a\u901a\u8fc7\u8fd4\u56de\u503c\u6765\u544a\u77e5\u7a0b\u5e8f\u5b9e\u9645\u8bfb\u5199\u4e86\u591a\u5c11\u5b57\u8282\u3002\n\n\u6709\u4e86\u975e\u963b\u585e IO \u610f\u5473\u7740\u7ebf\u7a0b\u5728\u8bfb\u5199 IO \u65f6\u53ef\u4ee5\u4e0d\u5fc5\u518d\u963b\u585e\u4e86\uff0c\u8bfb\u5199\u53ef\u4ee5\u77ac\u95f4\u5b8c\u6210\u7136\u540e\u7ebf\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u5e72\u522b\u7684\u4e8b\u4e86\u3002\n\n\u4e8b\u4ef6\u8f6e\u8be2 (\u591a\u8def\u590d\u7528)\n--\n\u975e\u963b\u585e IO \u6709\u4e2a\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u7ebf\u7a0b\u8981\u8bfb\u6570\u636e\uff0c\u7ed3\u679c\u8bfb\u4e86\u4e00\u90e8\u5206\u5c31\u8fd4\u56de\u4e86\uff0c\u7ebf\u7a0b\u5982\u4f55\u77e5\u9053\u4f55\u65f6\u624d\u5e94\u8be5\u7ee7\u7eed\u8bfb\u3002\u4e5f\u5c31\u662f\u5f53\u6570\u636e\u5230\u6765\u65f6\uff0c\u7ebf\u7a0b\u5982\u4f55\u5f97\u5230\u901a\u77e5\u3002\u5199\u4e5f\u662f\u4e00\u6837\uff0c\u5982\u679c\u7f13\u51b2\u533a\u6ee1\u4e86\uff0c\u5199\u4e0d\u5b8c\uff0c\u5269\u4e0b\u7684\u6570\u636e\u4f55\u65f6\u624d\u5e94\u8be5\u7ee7\u7eed\u5199\uff0c\u7ebf\u7a0b\u4e5f\u5e94\u8be5\u5f97\u5230\u901a\u77e5\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164821ee63cfc36f?w=762&h=508&f=png&s=51094)\n\n\u4e8b\u4ef6\u8f6e\u8be2 API \u5c31\u662f\u7528\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\uff0c\u6700\u7b80\u5355\u7684\u4e8b\u4ef6\u8f6e\u8be2 API \u662f```select```\u51fd\u6570\uff0c\u5b83\u662f\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7ed9\u7528\u6237\u7a0b\u5e8f\u7684 API\u3002\u8f93\u5165\u662f\u8bfb\u5199\u63cf\u8ff0\u7b26\u5217\u8868```read_fds & write_fds```\uff0c\u8f93\u51fa\u662f\u4e0e\u4e4b\u5bf9\u5e94\u7684\u53ef\u8bfb\u53ef\u5199\u4e8b\u4ef6\u3002\u540c\u65f6\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a```timeout```\u53c2\u6570\uff0c\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u4e8b\u4ef6\u5230\u6765\uff0c\u90a3\u4e48\u5c31\u6700\u591a\u7b49\u5f85```timeout```\u65f6\u95f4\uff0c\u7ebf\u7a0b\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002\u4e00\u65e6\u671f\u95f4\u6709\u4efb\u4f55\u4e8b\u4ef6\u5230\u6765\uff0c\u5c31\u53ef\u4ee5\u7acb\u5373\u8fd4\u56de\u3002\u65f6\u95f4\u8fc7\u4e86\u4e4b\u540e\u8fd8\u662f\u6ca1\u6709\u4efb\u4f55\u4e8b\u4ef6\u5230\u6765\uff0c\u4e5f\u4f1a\u7acb\u5373\u8fd4\u56de\u3002\u62ff\u5230\u4e8b\u4ef6\u540e\uff0c\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6328\u4e2a\u5904\u7406\u76f8\u5e94\u7684\u4e8b\u4ef6\u3002\u5904\u7406\u5b8c\u4e86\u7ee7\u7eed\u8fc7\u6765\u8f6e\u8be2\u3002\u4e8e\u662f\u7ebf\u7a0b\u5c31\u8fdb\u5165\u4e86\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u6b7b\u5faa\u73af\u79f0\u4e3a\u4e8b\u4ef6\u5faa\u73af\uff0c\u4e00\u4e2a\u5faa\u73af\u4e3a\u4e00\u4e2a\u5468\u671f\u3002\n\n\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5957\u63a5\u5b57```socket```\u90fd\u6709\u5bf9\u5e94\u7684\u8bfb\u5199\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\n\n```py\nread_events, write_events = select(read_fds, write_fds, timeout)\nfor event in read_events:\n    handle_read(event.fd)\nfor event in write_events:\n    handle_write(event.fd)\nhandle_others()  # \u5904\u7406\u5176\u5b83\u4e8b\u60c5\uff0c\u5982\u5b9a\u65f6\u4efb\u52a1\u7b49\n```\n\n\u56e0\u4e3a\u6211\u4eec\u901a\u8fc7```select```\u7cfb\u7edf\u8c03\u7528\u540c\u65f6\u5904\u7406\u591a\u4e2a\u901a\u9053\u63cf\u8ff0\u7b26\u7684\u8bfb\u5199\u4e8b\u4ef6\uff0c\u56e0\u6b64\u6211\u4eec\u5c06\u8fd9\u7c7b\u7cfb\u7edf\u8c03\u7528\u79f0\u4e3a\u591a\u8def\u590d\u7528 API\u3002\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u7684\u591a\u8def\u590d\u7528 API \u5df2\u7ecf\u4e0d\u518d\u4f7f\u7528```select```\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u6539\u7528```epoll(linux)```\u548c```kqueue(freebsd & macosx)```\uff0c\u56e0\u4e3a select \u7cfb\u7edf\u8c03\u7528\u7684\u6027\u80fd\u5728\u63cf\u8ff0\u7b26\u7279\u522b\u591a\u65f6\u6027\u80fd\u4f1a\u975e\u5e38\u5dee\u3002\u5b83\u4eec\u4f7f\u7528\u8d77\u6765\u53ef\u80fd\u5728\u5f62\u5f0f\u4e0a\u7565\u6709\u5dee\u5f02\uff0c\u4f46\u662f\u672c\u8d28\u4e0a\u90fd\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u4f2a\u4ee3\u7801\u903b\u8f91\u8fdb\u884c\u7406\u89e3\u3002\n\n\u670d\u52a1\u5668\u5957\u63a5\u5b57```serversocket```\u5bf9\u8c61\u7684\u8bfb\u64cd\u4f5c\u662f\u6307\u8c03\u7528```accept```\u63a5\u53d7\u5ba2\u6237\u7aef\u65b0\u8fde\u63a5\u3002\u4f55\u65f6\u6709\u65b0\u8fde\u63a5\u5230\u6765\uff0c\u4e5f\u662f\u901a\u8fc7```select```\u7cfb\u7edf\u8c03\u7528\u7684\u8bfb\u4e8b\u4ef6\u6765\u5f97\u5230\u901a\u77e5\u7684\u3002\n\n**\u4e8b\u4ef6\u8f6e\u8be2 API \u5c31\u662f Java \u8bed\u8a00\u91cc\u9762\u7684 NIO \u6280\u672f**\n\nJava \u7684 NIO \u5e76\u4e0d\u662f Java \u7279\u6709\u7684\u6280\u672f\uff0c\u5176\u5b83\u8ba1\u7b97\u673a\u8bed\u8a00\u90fd\u6709\u8fd9\u4e2a\u6280\u672f\uff0c\u53ea\u4e0d\u8fc7\u6362\u4e86\u4e00\u4e2a\u8bcd\u6c47\uff0c\u4e0d\u53eb NIO \u800c\u5df2\u3002\n\n\u6307\u4ee4\u961f\u5217\n--\nRedis \u4f1a\u5c06\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u90fd\u5173\u8054\u4e00\u4e2a\u6307\u4ee4\u961f\u5217\u3002\u5ba2\u6237\u7aef\u7684\u6307\u4ee4\u901a\u8fc7\u961f\u5217\u6765\u6392\u961f\u8fdb\u884c\u987a\u5e8f\u5904\u7406\uff0c\u5148\u5230\u5148\u670d\u52a1\u3002\n\n\u54cd\u5e94\u961f\u5217\n--\nRedis \u540c\u6837\u4e5f\u4f1a\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u5173\u8054\u4e00\u4e2a\u54cd\u5e94\u961f\u5217\u3002Redis \u670d\u52a1\u5668\u901a\u8fc7\u54cd\u5e94\u961f\u5217\u6765\u5c06\u6307\u4ee4\u7684\u8fd4\u56de\u7ed3\u679c\u56de\u590d\u7ed9\u5ba2\u6237\u7aef\u3002\n\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c\u90a3\u4e48\u610f\u5473\u7740\u8fde\u63a5\u6682\u65f6\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff0c\u4e0d\u9700\u8981\u53bb\u83b7\u53d6\u5199\u4e8b\u4ef6\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u5c06\u5f53\u524d\u7684\u5ba2\u6237\u7aef\u63cf\u8ff0\u7b26\u4ece```write_fds```\u91cc\u9762\u79fb\u51fa\u6765\u3002\u7b49\u5230\u961f\u5217\u6709\u6570\u636e\u4e86\uff0c\u518d\u5c06\u63cf\u8ff0\u7b26\u653e\u8fdb\u53bb\u3002\u907f\u514d```select```\u7cfb\u7edf\u8c03\u7528\u7acb\u5373\u8fd4\u56de\u5199\u4e8b\u4ef6\uff0c\u7ed3\u679c\u53d1\u73b0\u6ca1\u4ec0\u4e48\u6570\u636e\u53ef\u4ee5\u5199\u3002\u51fa\u8fd9\u79cd\u60c5\u51b5\u7684\u7ebf\u7a0b\u4f1a\u98d9\u9ad8 CPU\u3002\n\n\u5b9a\u65f6\u4efb\u52a1\n--\n\u670d\u52a1\u5668\u5904\u7406\u8981\u54cd\u5e94 IO \u4e8b\u4ef6\u5916\uff0c\u8fd8\u8981\u5904\u7406\u5176\u5b83\u4e8b\u60c5\u3002\u6bd4\u5982\u5b9a\u65f6\u4efb\u52a1\u5c31\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4ef6\u4e8b\u3002\u5982\u679c\u7ebf\u7a0b\u963b\u585e\u5728 select \u7cfb\u7edf\u8c03\u7528\u4e0a\uff0c\u5b9a\u65f6\u4efb\u52a1\u5c06\u65e0\u6cd5\u5f97\u5230\u51c6\u65f6\u8c03\u5ea6\u3002\u90a3 Redis \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u5462\uff1f\n\nRedis \u7684\u5b9a\u65f6\u4efb\u52a1\u4f1a\u8bb0\u5f55\u5728\u4e00\u4e2a\u79f0\u4e3a```\u6700\u5c0f\u5806```\u7684\u6570\u636e\u7ed3\u6784\u4e2d\u3002\u8fd9\u4e2a\u5806\u4e2d\uff0c\u6700\u5feb\u8981\u6267\u884c\u7684\u4efb\u52a1\u6392\u5728\u5806\u7684\u6700\u4e0a\u65b9\u3002\u5728\u6bcf\u4e2a\u5faa\u73af\u5468\u671f\uff0cRedis \u90fd\u4f1a\u5c06\u6700\u5c0f\u5806\u91cc\u9762\u5df2\u7ecf\u5230\u70b9\u7684\u4efb\u52a1\u7acb\u5373\u8fdb\u884c\u5904\u7406\u3002\u5904\u7406\u5b8c\u6bd5\u540e\uff0c\u5c06\u6700\u5feb\u8981\u6267\u884c\u7684\u4efb\u52a1\u8fd8\u9700\u8981\u7684\u65f6\u95f4\u8bb0\u5f55\u4e0b\u6765\uff0c\u8fd9\u4e2a\u65f6\u95f4\u5c31\u662f```select```\u7cfb\u7edf\u8c03\u7528\u7684```timeout```\u53c2\u6570\u3002\u56e0\u4e3a Redis \u77e5\u9053\u672a\u6765```timeout```\u65f6\u95f4\u5185\uff0c\u6ca1\u6709\u5176\u5b83\u5b9a\u65f6\u4efb\u52a1\u9700\u8981\u5904\u7406\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b89\u5fc3\u7761\u7720```timeout```\u7684\u65f6\u95f4\u3002\n\n**Nginx \u548c Node \u7684\u4e8b\u4ef6\u5904\u7406\u539f\u7406\u548c Redis \u4e5f\u662f\u7c7b\u4f3c\u7684**\n\n## \u6269\u5c55\u9605\u8bfb\n\n\u8bf7\u9605\u8bfb\u8001\u94b1\u7684\u53e6\u4e00\u7bc7\u706b\u7206\u7684\u6587\u7ae0[\u300a\u8ddf\u7740\u52a8\u753b\u6765\u5b66\u4e60TCP\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u300b](https://juejin.im/post/5b29d2c4e51d4558b80b1d8c)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/11\u539f\u7406_1\u97ad\u8f9f\u5165\u91cc__\u7ebf\u7a0b_IO_\u6a21\u578b.md", "create_date": "2020-02-18T03:01:05.594", "order": 12}}, {"model": "subject.chapter", "pk": 19, "fields": {"title": "13\u539f\u7406 3\uff1a\u672a\u96e8\u7ef8\u7f2a \u2014\u2014 \u6301\u4e45\u5316", "topic": 2, "md5": "66cf0ff42a03da708bb2cc64f90560fe", "md_body": "# \u539f\u7406 3\uff1a\u672a\u96e8\u7ef8\u7f2a \u2014\u2014 \u6301\u4e45\u5316\n\nRedis \u7684\u6570\u636e\u5168\u90e8\u5728\u5185\u5b58\u91cc\uff0c\u5982\u679c\u7a81\u7136\u5b95\u673a\uff0c\u6570\u636e\u5c31\u4f1a\u5168\u90e8\u4e22\u5931\uff0c\u56e0\u6b64\u5fc5\u987b\u6709\u4e00\u79cd\u673a\u5236\u6765\u4fdd\u8bc1 Redis \u7684\u6570\u636e\u4e0d\u4f1a\u56e0\u4e3a\u6545\u969c\u800c\u4e22\u5931\uff0c\u8fd9\u79cd\u673a\u5236\u5c31\u662f Redis \u7684\u6301\u4e45\u5316\u673a\u5236\u3002\n\nRedis \u7684\u6301\u4e45\u5316\u673a\u5236\u6709\u4e24\u79cd\uff0c\u7b2c\u4e00\u79cd\u662f\u5feb\u7167\uff0c\u7b2c\u4e8c\u79cd\u662f AOF \u65e5\u5fd7\u3002\u5feb\u7167\u662f\u4e00\u6b21\u5168\u91cf\u5907\u4efd\uff0cAOF \u65e5\u5fd7\u662f\u8fde\u7eed\u7684\u589e\u91cf\u5907\u4efd\u3002\u5feb\u7167\u662f\u5185\u5b58\u6570\u636e\u7684\u4e8c\u8fdb\u5236\u5e8f\u5217\u5316\u5f62\u5f0f\uff0c\u5728\u5b58\u50a8\u4e0a\u975e\u5e38\u7d27\u51d1\uff0c\u800c AOF \u65e5\u5fd7\u8bb0\u5f55\u7684\u662f\u5185\u5b58\u6570\u636e\u4fee\u6539\u7684\u6307\u4ee4\u8bb0\u5f55\u6587\u672c\u3002AOF \u65e5\u5fd7\u5728\u957f\u671f\u7684\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u53d8\u7684\u65e0\u6bd4\u5e9e\u5927\uff0c\u6570\u636e\u5e93\u91cd\u542f\u65f6\u9700\u8981\u52a0\u8f7d AOF \u65e5\u5fd7\u8fdb\u884c\u6307\u4ee4\u91cd\u653e\uff0c\u8fd9\u4e2a\u65f6\u95f4\u5c31\u4f1a\u65e0\u6bd4\u6f2b\u957f\u3002\u6240\u4ee5\u9700\u8981\u5b9a\u671f\u8fdb\u884c AOF \u91cd\u5199\uff0c\u7ed9 AOF \u65e5\u5fd7\u8fdb\u884c\u7626\u8eab\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164820eb27b6a97e?w=667&h=259&f=png&s=19059)\n\n\u5feb\u7167\u539f\u7406\n--\n\u6211\u4eec\u77e5\u9053 Redis \u662f\u5355\u7ebf\u7a0b\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u8981\u540c\u65f6\u8d1f\u8d23\u591a\u4e2a\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u7684\u5e76\u53d1\u8bfb\u5199\u64cd\u4f5c\u548c\u5185\u5b58\u6570\u636e\u7ed3\u6784\u7684\u903b\u8f91\u8bfb\u5199\u3002\n\n\u5728\u670d\u52a1\u7ebf\u4e0a\u8bf7\u6c42\u7684\u540c\u65f6\uff0cRedis \u8fd8\u9700\u8981\u8fdb\u884c\u5185\u5b58\u5feb\u7167\uff0c\u5185\u5b58\u5feb\u7167\u8981\u6c42 Redis \u5fc5\u987b\u8fdb\u884c\u6587\u4ef6 IO \u64cd\u4f5c\uff0c\u53ef\u6587\u4ef6 IO \u64cd\u4f5c\u662f\u4e0d\u80fd\u4f7f\u7528\u591a\u8def\u590d\u7528 API\u3002\n\n\u8fd9\u610f\u5473\u7740\u5355\u7ebf\u7a0b\u540c\u65f6\u5728\u670d\u52a1\u7ebf\u4e0a\u7684\u8bf7\u6c42\u8fd8\u8981\u8fdb\u884c\u6587\u4ef6 IO \u64cd\u4f5c\uff0c\u6587\u4ef6 IO \u64cd\u4f5c\u4f1a\u4e25\u91cd\u62d6\u57ae\u670d\u52a1\u5668\u8bf7\u6c42\u7684\u6027\u80fd\u3002\u8fd8\u6709\u4e2a**\u91cd\u8981\u7684\u95ee\u9898\u662f\u4e3a\u4e86\u4e0d\u963b\u585e\u7ebf\u4e0a\u7684\u4e1a\u52a1\uff0c\u5c31\u9700\u8981\u8fb9\u6301\u4e45\u5316\u8fb9\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42**\u3002\u6301\u4e45\u5316\u7684\u540c\u65f6\uff0c\u5185\u5b58\u6570\u636e\u7ed3\u6784\u8fd8\u5728\u6539\u53d8\uff0c\u6bd4\u5982\u4e00\u4e2a\u5927\u578b\u7684 hash \u5b57\u5178\u6b63\u5728\u6301\u4e45\u5316\uff0c\u7ed3\u679c\u4e00\u4e2a\u8bf7\u6c42\u8fc7\u6765\u628a\u5b83\u7ed9\u5220\u6389\u4e86\uff0c\u8fd8\u6ca1\u6301\u4e45\u5316\u5b8c\u5462\uff0c\u8fd9\u5c3c\u739b\u8981\u600e\u4e48\u641e\uff1f\n\n**\u90a3\u8be5\u600e\u4e48\u529e\u5462\uff1f**\n\nRedis \u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u591a\u8fdb\u7a0b COW(Copy On Write) \u673a\u5236\u6765\u5b9e\u73b0\u5feb\u7167\u6301\u4e45\u5316\uff0c\u8fd9\u4e2a\u673a\u5236\u5f88\u6709\u610f\u601d\uff0c\u4e5f\u5f88\u5c11\u4eba\u77e5\u9053\u3002\u591a\u8fdb\u7a0b COW \u4e5f\u662f\u9274\u5b9a\u7a0b\u5e8f\u5458\u77e5\u8bc6\u5e7f\u5ea6\u7684\u4e00\u4e2a\u91cd\u8981\u6307\u6807\u3002\n\nfork(\u591a\u8fdb\u7a0b)\n--\nRedis \u5728\u6301\u4e45\u5316\u65f6\u4f1a\u8c03\u7528 glibc \u7684\u51fd\u6570```fork```\u4ea7\u751f\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5feb\u7167\u6301\u4e45\u5316\u5b8c\u5168\u4ea4\u7ed9\u5b50\u8fdb\u7a0b\u6765\u5904\u7406\uff0c\u7236\u8fdb\u7a0b\u7ee7\u7eed\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002\u5b50\u8fdb\u7a0b\u521a\u521a\u4ea7\u751f\u65f6\uff0c\u5b83\u548c\u7236\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\u91cc\u9762\u7684\u4ee3\u7801\u6bb5\u548c\u6570\u636e\u6bb5\u3002\u8fd9\u65f6\u4f60\u53ef\u4ee5\u5c06\u7236\u5b50\u8fdb\u7a0b\u60f3\u50cf\u6210\u4e00\u4e2a\u8fde\u4f53\u5a74\u513f\uff0c\u5171\u4eab\u8eab\u4f53\u3002\u8fd9\u662f Linux \u64cd\u4f5c\u7cfb\u7edf\u7684\u673a\u5236\uff0c\u4e3a\u4e86\u8282\u7ea6\u5185\u5b58\u8d44\u6e90\uff0c\u6240\u4ee5\u5c3d\u53ef\u80fd\u8ba9\u5b83\u4eec\u5171\u4eab\u8d77\u6765\u3002\u5728\u8fdb\u7a0b\u5206\u79bb\u7684\u4e00\u77ac\u95f4\uff0c\u5185\u5b58\u7684\u589e\u957f\u51e0\u4e4e\u6ca1\u6709\u660e\u663e\u53d8\u5316\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/18/163712a9f9d0c3cf?w=493&h=255&f=png&s=212826)\n\n\u7528 Python \u8bed\u8a00\u63cf\u8ff0\u8fdb\u7a0b\u5206\u79bb\u7684\u903b\u8f91\u5982\u4e0b\u3002```fork```\u51fd\u6570\u4f1a\u5728\u7236\u5b50\u8fdb\u7a0b\u540c\u65f6\u8fd4\u56de\uff0c\u5728\u7236\u8fdb\u7a0b\u91cc\u8fd4\u56de\u5b50\u8fdb\u7a0b\u7684 pid\uff0c\u5728\u5b50\u8fdb\u7a0b\u91cc\u8fd4\u56de\u96f6\u3002\u5982\u679c\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u8d44\u6e90\u4e0d\u8db3\uff0cpid \u5c31\u4f1a\u662f\u8d1f\u6570\uff0c\u8868\u793a```fork```\u5931\u8d25\u3002\n\n```py\npid = os.fork()\nif pid > 0:\n    handle_client_requests()  # \u7236\u8fdb\u7a0b\u7ee7\u7eed\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\nif pid == 0:\n    handle_snapshot_write()  # \u5b50\u8fdb\u7a0b\u5904\u7406\u5feb\u7167\u5199\u78c1\u76d8\nif pid < 0:\n    # fork error\n```\n\n\u5b50\u8fdb\u7a0b\u505a\u6570\u636e\u6301\u4e45\u5316\uff0c\u5b83\u4e0d\u4f1a\u4fee\u6539\u73b0\u6709\u7684\u5185\u5b58\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u53ea\u662f\u5bf9\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u904d\u5386\u8bfb\u53d6\uff0c\u7136\u540e\u5e8f\u5217\u5316\u5199\u5230\u78c1\u76d8\u4e2d\u3002\u4f46\u662f\u7236\u8fdb\u7a0b\u4e0d\u4e00\u6837\uff0c\u5b83\u5fc5\u987b\u6301\u7eed\u670d\u52a1\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u7136\u540e\u5bf9\u5185\u5b58\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u4e0d\u95f4\u65ad\u7684\u4fee\u6539\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684 COW \u673a\u5236\u6765\u8fdb\u884c\u6570\u636e\u6bb5\u9875\u9762\u7684\u5206\u79bb\u3002\u6570\u636e\u6bb5\u662f\u7531\u5f88\u591a\u64cd\u4f5c\u7cfb\u7edf\u7684\u9875\u9762\u7ec4\u5408\u800c\u6210\uff0c\u5f53\u7236\u8fdb\u7a0b\u5bf9\u5176\u4e2d\u4e00\u4e2a\u9875\u9762\u7684\u6570\u636e\u8fdb\u884c\u4fee\u6539\u65f6\uff0c\u4f1a\u5c06\u88ab\u5171\u4eab\u7684\u9875\u9762\u590d\u5236\u4e00\u4efd\u5206\u79bb\u51fa\u6765\uff0c\u7136\u540e\u5bf9\u8fd9\u4e2a\u590d\u5236\u7684\u9875\u9762\u8fdb\u884c\u4fee\u6539\u3002\u8fd9\u65f6\u5b50\u8fdb\u7a0b\u76f8\u5e94\u7684\u9875\u9762\u662f\u6ca1\u6709\u53d8\u5316\u7684\uff0c\u8fd8\u662f\u8fdb\u7a0b\u4ea7\u751f\u65f6\u90a3\u4e00\u77ac\u95f4\u7684\u6570\u636e\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/18/163711de3e2b6cb8?w=461&h=364&f=png&s=20109)\n\n\u968f\u7740\u7236\u8fdb\u7a0b\u4fee\u6539\u64cd\u4f5c\u7684\u6301\u7eed\u8fdb\u884c\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u5171\u4eab\u9875\u9762\u88ab\u5206\u79bb\u51fa\u6765\uff0c\u5185\u5b58\u5c31\u4f1a\u6301\u7eed\u589e\u957f\u3002\u4f46\u662f\u4e5f\u4e0d\u4f1a\u8d85\u8fc7\u539f\u6709\u6570\u636e\u5185\u5b58\u7684 2 \u500d\u5927\u5c0f\u3002\u53e6\u5916\u4e00\u4e2a Redis \u5b9e\u4f8b\u91cc\u51b7\u6570\u636e\u5360\u7684\u6bd4\u4f8b\u5f80\u5f80\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u6240\u4ee5\u5f88\u5c11\u4f1a\u51fa\u73b0\u6240\u6709\u7684\u9875\u9762\u90fd\u4f1a\u88ab\u5206\u79bb\uff0c\u88ab\u5206\u79bb\u7684\u5f80\u5f80\u53ea\u6709\u5176\u4e2d\u4e00\u90e8\u5206\u9875\u9762\u3002\u6bcf\u4e2a\u9875\u9762\u7684\u5927\u5c0f\u53ea\u6709 4K\uff0c\u4e00\u4e2a Redis \u5b9e\u4f8b\u91cc\u9762\u4e00\u822c\u90fd\u4f1a\u6709\u6210\u5343\u4e0a\u4e07\u7684\u9875\u9762\u3002\n\n\u5b50\u8fdb\u7a0b\u56e0\u4e3a\u6570\u636e\u6ca1\u6709\u53d8\u5316\uff0c\u5b83\u80fd\u770b\u5230\u7684\u5185\u5b58\u91cc\u7684\u6570\u636e\u5728\u8fdb\u7a0b\u4ea7\u751f\u7684\u4e00\u77ac\u95f4\u5c31\u51dd\u56fa\u4e86\uff0c\u518d\u4e5f\u4e0d\u4f1a\u6539\u53d8\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48 Redis \u7684\u6301\u4e45\u5316\u53eb\u300c\u5feb\u7167\u300d\u7684\u539f\u56e0\u3002\u63a5\u4e0b\u6765\u5b50\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u975e\u5e38\u5b89\u5fc3\u7684\u904d\u5386\u6570\u636e\u4e86\u8fdb\u884c\u5e8f\u5217\u5316\u5199\u78c1\u76d8\u4e86\u3002\n\nAOF \u539f\u7406\n--\nAOF \u65e5\u5fd7\u5b58\u50a8\u7684\u662f Redis \u670d\u52a1\u5668\u7684\u987a\u5e8f\u6307\u4ee4\u5e8f\u5217\uff0cAOF \u65e5\u5fd7\u53ea\u8bb0\u5f55\u5bf9\u5185\u5b58\u8fdb\u884c\u4fee\u6539\u7684\u6307\u4ee4\u8bb0\u5f55\u3002\n\n\u5047\u8bbe AOF \u65e5\u5fd7\u8bb0\u5f55\u4e86\u81ea Redis \u5b9e\u4f8b\u521b\u5efa\u4ee5\u6765\u6240\u6709\u7684\u4fee\u6539\u6027\u6307\u4ee4\u5e8f\u5217\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u5bf9\u4e00\u4e2a\u7a7a\u7684 Redis \u5b9e\u4f8b\u987a\u5e8f\u6267\u884c\u6240\u6709\u7684\u6307\u4ee4\uff0c\u4e5f\u5c31\u662f\u300c\u91cd\u653e\u300d\uff0c\u6765\u6062\u590d Redis \u5f53\u524d\u5b9e\u4f8b\u7684\u5185\u5b58\u6570\u636e\u7ed3\u6784\u7684\u72b6\u6001\u3002\n\nRedis \u4f1a\u5728\u6536\u5230\u5ba2\u6237\u7aef\u4fee\u6539\u6307\u4ee4\u540e\uff0c\u8fdb\u884c\u53c2\u6570\u6821\u9a8c\u8fdb\u884c\u903b\u8f91\u5904\u7406\u540e\uff0c\u5982\u679c\u6ca1\u95ee\u9898\uff0c\u5c31\u7acb\u5373\u5c06\u8be5\u6307\u4ee4\u6587\u672c\u5b58\u50a8\u5230 AOF \u65e5\u5fd7\u4e2d\uff0c\u4e5f\u5c31\u662f\u5148\u6267\u884c\u6307\u4ee4\u624d\u5c06\u65e5\u5fd7\u5b58\u76d8\u3002\u8fd9\u70b9\u4e0d\u540c\u4e8eleveldb\u3001hbase\u7b49\u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u4eec\u90fd\u662f\u5148\u5b58\u50a8\u65e5\u5fd7\u518d\u505a\u903b\u8f91\u5904\u7406\u3002\n\nRedis \u5728\u957f\u671f\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0cAOF \u7684\u65e5\u5fd7\u4f1a\u8d8a\u53d8\u8d8a\u957f\u3002\u5982\u679c\u5b9e\u4f8b\u5b95\u673a\u91cd\u542f\uff0c\u91cd\u653e\u6574\u4e2a AOF \u65e5\u5fd7\u4f1a\u975e\u5e38\u8017\u65f6\uff0c\u5bfc\u81f4\u957f\u65f6\u95f4 Redis \u65e0\u6cd5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u6240\u4ee5\u9700\u8981\u5bf9 AOF \u65e5\u5fd7\u7626\u8eab\u3002\n\nAOF \u91cd\u5199\n--\nRedis \u63d0\u4f9b\u4e86 bgrewriteaof \u6307\u4ee4\u7528\u4e8e\u5bf9 AOF \u65e5\u5fd7\u8fdb\u884c\u7626\u8eab\u3002\u5176\u539f\u7406\u5c31\u662f\u5f00\u8f9f\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u5bf9\u5185\u5b58\u8fdb\u884c\u904d\u5386\u8f6c\u6362\u6210\u4e00\u7cfb\u5217 Redis \u7684\u64cd\u4f5c\u6307\u4ee4\uff0c\u5e8f\u5217\u5316\u5230\u4e00\u4e2a\u65b0\u7684 AOF \u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002\u5e8f\u5217\u5316\u5b8c\u6bd5\u540e\u518d\u5c06\u64cd\u4f5c\u671f\u95f4\u53d1\u751f\u7684\u589e\u91cf AOF \u65e5\u5fd7\u8ffd\u52a0\u5230\u8fd9\u4e2a\u65b0\u7684 AOF \u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u8ffd\u52a0\u5b8c\u6bd5\u540e\u5c31\u7acb\u5373\u66ff\u4ee3\u65e7\u7684 AOF \u65e5\u5fd7\u6587\u4ef6\u4e86\uff0c\u7626\u8eab\u5de5\u4f5c\u5c31\u5b8c\u6210\u4e86\u3002\n\nfsync\n--\nAOF \u65e5\u5fd7\u662f\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u5728\u7684\uff0c\u5f53\u7a0b\u5e8f\u5bf9 AOF \u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5c06\u5185\u5bb9\u5199\u5230\u4e86\u5185\u6838\u4e3a\u6587\u4ef6\u63cf\u8ff0\u7b26\u5206\u914d\u7684\u4e00\u4e2a\u5185\u5b58\u7f13\u5b58\u4e2d\uff0c\u7136\u540e\u5185\u6838\u4f1a\u5f02\u6b65\u5c06\u810f\u6570\u636e\u5237\u56de\u5230\u78c1\u76d8\u7684\u3002\n\n\u8fd9\u5c31\u610f\u5473\u7740\u5982\u679c\u673a\u5668\u7a81\u7136\u5b95\u673a\uff0cAOF \u65e5\u5fd7\u5185\u5bb9\u53ef\u80fd\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5b8c\u5168\u5237\u5230\u78c1\u76d8\u4e2d\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u51fa\u73b0\u65e5\u5fd7\u4e22\u5931\u3002\u90a3\u8be5\u600e\u4e48\u529e\uff1f\n\nLinux \u7684```glibc```\u63d0\u4f9b\u4e86```fsync(int fd)```\u51fd\u6570\u53ef\u4ee5\u5c06\u6307\u5b9a\u6587\u4ef6\u7684\u5185\u5bb9\u5f3a\u5236\u4ece\u5185\u6838\u7f13\u5b58\u5237\u5230\u78c1\u76d8\u3002\u53ea\u8981 Redis \u8fdb\u7a0b\u5b9e\u65f6\u8c03\u7528 fsync \u51fd\u6570\u5c31\u53ef\u4ee5\u4fdd\u8bc1 aof \u65e5\u5fd7\u4e0d\u4e22\u5931\u3002\u4f46\u662f fsync \u662f\u4e00\u4e2a\u78c1\u76d8 IO \u64cd\u4f5c\uff0c\u5b83\u5f88\u6162\uff01\u5982\u679c Redis \u6267\u884c\u4e00\u6761\u6307\u4ee4\u5c31\u8981 fsync \u4e00\u6b21\uff0c\u90a3\u4e48 Redis \u9ad8\u6027\u80fd\u7684\u5730\u4f4d\u5c31\u4e0d\u4fdd\u4e86\u3002\n\n\u6240\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u7684\u670d\u52a1\u5668\u4e2d\uff0cRedis \u901a\u5e38\u662f\u6bcf\u9694 1s \u5de6\u53f3\u6267\u884c\u4e00\u6b21 fsync \u64cd\u4f5c\uff0c\u5468\u671f 1s \u662f\u53ef\u4ee5\u914d\u7f6e\u7684\u3002\u8fd9\u662f\u5728\u6570\u636e\u5b89\u5168\u6027\u548c\u6027\u80fd\u4e4b\u95f4\u505a\u4e86\u4e00\u4e2a\u6298\u4e2d\uff0c\u5728\u4fdd\u6301\u9ad8\u6027\u80fd\u7684\u540c\u65f6\uff0c\u5c3d\u53ef\u80fd\u4f7f\u5f97\u6570\u636e\u5c11\u4e22\u5931\u3002\n\nRedis \u540c\u6837\u4e5f\u63d0\u4f9b\u4e86\u53e6\u5916\u4e24\u79cd\u7b56\u7565\uff0c\u4e00\u4e2a\u662f\u6c38\u4e0d fsync\u2014\u2014\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u6765\u51b3\u5b9a\u4f55\u65f6\u540c\u6b65\u78c1\u76d8\uff0c\u5f88\u4e0d\u5b89\u5168\uff0c\u53e6\u4e00\u4e2a\u662f\u6765\u4e00\u4e2a\u6307\u4ee4\u5c31 fsync \u4e00\u6b21\u2014\u2014\u975e\u5e38\u6162\u3002\u4f46\u662f\u5728\u751f\u4ea7\u73af\u5883\u57fa\u672c\u4e0d\u4f1a\u4f7f\u7528\uff0c\u4e86\u89e3\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u8fd0\u7ef4\n--\n\u5feb\u7167\u662f\u901a\u8fc7\u5f00\u542f\u5b50\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fdb\u884c\u7684\uff0c\u5b83\u662f\u4e00\u4e2a\u6bd4\u8f83\u8017\u8d44\u6e90\u7684\u64cd\u4f5c\u3002\n1. \u904d\u5386\u6574\u4e2a\u5185\u5b58\uff0c\u5927\u5757\u5199\u78c1\u76d8\u4f1a\u52a0\u91cd\u7cfb\u7edf\u8d1f\u8f7d\n2. AOF \u7684 fsync \u662f\u4e00\u4e2a\u8017\u65f6\u7684 IO \u64cd\u4f5c\uff0c\u5b83\u4f1a\u964d\u4f4e Redis \u6027\u80fd\uff0c\u540c\u65f6\u4e5f\u4f1a\u589e\u52a0\u7cfb\u7edf IO \u8d1f\u62c5\n\n\u6240\u4ee5\u901a\u5e38 Redis \u7684\u4e3b\u8282\u70b9\u662f\u4e0d\u4f1a\u8fdb\u884c\u6301\u4e45\u5316\u64cd\u4f5c\uff0c\u6301\u4e45\u5316\u64cd\u4f5c\u4e3b\u8981\u5728\u4ece\u8282\u70b9\u8fdb\u884c\u3002\u4ece\u8282\u70b9\u662f\u5907\u4efd\u8282\u70b9\uff0c\u6ca1\u6709\u6765\u81ea\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u538b\u529b\uff0c\u5b83\u7684\u64cd\u4f5c\u7cfb\u7edf\u8d44\u6e90\u5f80\u5f80\u6bd4\u8f83\u5145\u6c9b\u3002\n\n\u4f46\u662f\u5982\u679c\u51fa\u73b0\u7f51\u7edc\u5206\u533a\uff0c\u4ece\u8282\u70b9\u957f\u671f\u8fde\u4e0d\u4e0a\u4e3b\u8282\u70b9\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u7279\u522b\u662f\u5728\u7f51\u7edc\u5206\u533a\u51fa\u73b0\u7684\u60c5\u51b5\u4e0b\u53c8\u4e0d\u5c0f\u5fc3\u4e3b\u8282\u70b9\u5b95\u673a\u4e86\uff0c\u90a3\u4e48\u6570\u636e\u5c31\u4f1a\u4e22\u5931\uff0c\u6240\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u8981\u505a\u597d\u5b9e\u65f6\u76d1\u63a7\u5de5\u4f5c\uff0c\u4fdd\u8bc1\u7f51\u7edc\u7545\u901a\u6216\u8005\u80fd\u5feb\u901f\u4fee\u590d\u3002\u53e6\u5916\u8fd8\u5e94\u8be5\u518d\u589e\u52a0\u4e00\u4e2a\u4ece\u8282\u70b9\u4ee5\u964d\u4f4e\u7f51\u7edc\u5206\u533a\u7684\u6982\u7387\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u4ece\u8282\u70b9\u6570\u636e\u540c\u6b65\u6b63\u5e38\uff0c\u6570\u636e\u4e5f\u5c31\u4e0d\u4f1a\u8f7b\u6613\u4e22\u5931\u3002\n\nRedis 4.0 \u6df7\u5408\u6301\u4e45\u5316\n--\n\u91cd\u542f Redis \u65f6\uff0c\u6211\u4eec\u5f88\u5c11\u4f7f\u7528 rdb \u6765\u6062\u590d\u5185\u5b58\u72b6\u6001\uff0c\u56e0\u4e3a\u4f1a\u4e22\u5931\u5927\u91cf\u6570\u636e\u3002\u6211\u4eec\u901a\u5e38\u4f7f\u7528 AOF \u65e5\u5fd7\u91cd\u653e\uff0c\u4f46\u662f\u91cd\u653e AOF \u65e5\u5fd7\u6027\u80fd\u76f8\u5bf9 rdb \u6765\u8bf4\u8981\u6162\u5f88\u591a\uff0c\u8fd9\u6837\u5728 Redis \u5b9e\u4f8b\u5f88\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u542f\u52a8\u9700\u8981\u82b1\u8d39\u5f88\u957f\u7684\u65f6\u95f4\u3002\n\nRedis 4.0 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5e26\u6765\u4e86\u4e00\u4e2a\u65b0\u7684\u6301\u4e45\u5316\u9009\u9879\u2014\u2014\u6df7\u5408\u6301\u4e45\u5316\u3002\u5c06 rdb \u6587\u4ef6\u7684\u5185\u5bb9\u548c\u589e\u91cf\u7684 AOF \u65e5\u5fd7\u6587\u4ef6\u5b58\u5728\u4e00\u8d77\u3002\u8fd9\u91cc\u7684 AOF \u65e5\u5fd7\u4e0d\u518d\u662f\u5168\u91cf\u7684\u65e5\u5fd7\uff0c\u800c\u662f\u81ea\u6301\u4e45\u5316\u5f00\u59cb\u5230\u6301\u4e45\u5316\u7ed3\u675f\u7684\u8fd9\u6bb5\u65f6\u95f4\u53d1\u751f\u7684\u589e\u91cf AOF \u65e5\u5fd7\uff0c\u901a\u5e38\u8fd9\u90e8\u5206 AOF \u65e5\u5fd7\u5f88\u5c0f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164821272ae19ebb?w=816&h=382&f=png&s=21479)\n\n\u4e8e\u662f\u5728 Redis \u91cd\u542f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5148\u52a0\u8f7d rdb \u7684\u5185\u5bb9\uff0c\u7136\u540e\u518d\u91cd\u653e\u589e\u91cf AOF \u65e5\u5fd7\u5c31\u53ef\u4ee5\u5b8c\u5168\u66ff\u4ee3\u4e4b\u524d\u7684 AOF \u5168\u91cf\u6587\u4ef6\u91cd\u653e\uff0c\u91cd\u542f\u6548\u7387\u56e0\u6b64\u5927\u5e45\u5f97\u5230\u63d0\u5347\u3002\n\n## \u601d\u8003\u9898\n\n1. \u6709\u4eba\u8bf4 Redis \u53ea\u9002\u5408\u7528\u6765\u505a\u7f13\u5b58\uff0c\u5f53\u6570\u636e\u5e93\u6765\u7528\u5e76\u4e0d\u5408\u9002\uff0c\u4f60\u600e\u4e48\u770b\uff1f\n2. \u4e3a\u4ec0\u4e48 Redis \u5148\u6267\u884c\u6307\u4ee4\u518d\u8bb0\u5f55aof\u65e5\u5fd7\u800c\u4e0d\u662f\u50cf\u5176\u5b83\u5b58\u50a8\u5f15\u64ce\u4e00\u6837\u53cd\u8fc7\u6765\u5462\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/13\u539f\u7406_3\u672a\u96e8\u7ef8\u7f2a__\u6301\u4e45\u5316.md", "create_date": "2020-02-18T03:01:05.597", "order": 14}}, {"model": "subject.chapter", "pk": 20, "fields": {"title": "10\u5e94\u7528 9\uff1a\u5927\u6d77\u635e\u9488 \u2014\u2014 Scan", "topic": 2, "md5": "c5b6264adaa37af6ea54d9954c911270", "md_body": "# \u5e94\u7528 9\uff1a\u5927\u6d77\u635e\u9488 \u2014\u2014 Scan\n\n\u5728\u5e73\u65f6\u7ebf\u4e0a Redis \u7ef4\u62a4\u5de5\u4f5c\u4e2d\uff0c\u6709\u65f6\u5019\u9700\u8981\u4ece Redis \u5b9e\u4f8b\u6210\u5343\u4e0a\u4e07\u7684 key \u4e2d\u627e\u51fa\u7279\u5b9a\u524d\u7f00\u7684 key \u5217\u8868\u6765\u624b\u52a8\u5904\u7406\u6570\u636e\uff0c\u53ef\u80fd\u662f\u4fee\u6539\u5b83\u7684\u503c\uff0c\u4e5f\u53ef\u80fd\u662f\u5220\u9664 key\u3002\u8fd9\u91cc\u5c31\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u4f55\u4ece\u6d77\u91cf\u7684 key \u4e2d\u627e\u51fa\u6ee1\u8db3\u7279\u5b9a\u524d\u7f00\u7684 key \u5217\u8868\u6765\uff1f\n\nRedis \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u66b4\u529b\u7684\u6307\u4ee4 `keys` \u7528\u6765\u5217\u51fa\u6240\u6709\u6ee1\u8db3\u7279\u5b9a\u6b63\u5219\u5b57\u7b26\u4e32\u89c4\u5219\u7684 key\u3002\n\n```\n127.0.0.1:6379> set codehole1 a\nOK\n127.0.0.1:6379> set codehole2 b\nOK\n127.0.0.1:6379> set codehole3 c\nOK\n127.0.0.1:6379> set code1hole a\nOK\n127.0.0.1:6379> set code2hole b\nOK\n127.0.0.1:6379> set code3hole b\nOK\n127.0.0.1:6379> keys *\n1) \"codehole1\"\n2) \"code3hole\"\n3) \"codehole3\"\n4) \"code2hole\"\n5) \"codehole2\"\n6) \"code1hole\"\n127.0.0.1:6379> keys codehole*\n1) \"codehole1\"\n2) \"codehole3\"\n3) \"codehole2\"\n127.0.0.1:6379> keys code*hole\n1) \"code3hole\"\n2) \"code2hole\"\n3) \"code1hole\"\n```\n\u8fd9\u4e2a\u6307\u4ee4\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u63d0\u4f9b\u4e00\u4e2a\u7b80\u5355\u7684\u6b63\u5219\u5b57\u7b26\u4e32\u5373\u53ef\uff0c\u4f46\u662f\u6709\u5f88\u660e\u663e\u7684\u4e24\u4e2a**\u7f3a\u70b9**\u3002\n1. \u6ca1\u6709 offset\u3001limit \u53c2\u6570\uff0c\u4e00\u6b21\u6027\u5410\u51fa\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684 key\uff0c\u4e07\u4e00\u5b9e\u4f8b\u4e2d\u6709\u51e0\u767e w \u4e2a key \u6ee1\u8db3\u6761\u4ef6\uff0c\u5f53\u4f60\u770b\u5230\u6ee1\u5c4f\u7684\u5b57\u7b26\u4e32\u5237\u7684\u6ca1\u6709\u5c3d\u5934\u65f6\uff0c\u4f60\u5c31\u77e5\u9053\u96be\u53d7\u4e86\u3002\n2. keys \u7b97\u6cd5\u662f\u904d\u5386\u7b97\u6cd5\uff0c\u590d\u6742\u5ea6\u662f O(n)\uff0c\u5982\u679c\u5b9e\u4f8b\u4e2d\u6709\u5343\u4e07\u7ea7\u4ee5\u4e0a\u7684 key\uff0c\u8fd9\u4e2a\u6307\u4ee4\u5c31\u4f1a\u5bfc\u81f4 Redis \u670d\u52a1\u5361\u987f\uff0c\u6240\u6709\u8bfb\u5199 Redis \u7684\u5176\u5b83\u7684\u6307\u4ee4\u90fd\u4f1a\u88ab\u5ef6\u540e\u751a\u81f3\u4f1a\u8d85\u65f6\u62a5\u9519\uff0c\u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b\u7a0b\u5e8f\uff0c\u987a\u5e8f\u6267\u884c\u6240\u6709\u6307\u4ee4\uff0c\u5176\u5b83\u6307\u4ee4\u5fc5\u987b\u7b49\u5230\u5f53\u524d\u7684 keys \u6307\u4ee4\u6267\u884c\u5b8c\u4e86\u624d\u53ef\u4ee5\u7ee7\u7eed\u3002\n\n\u9762\u5bf9\u8fd9\u4e24\u4e2a\u663e\u8457\u7684\u7f3a\u70b9\u8be5\u600e\u4e48\u529e\u5462\uff1f\n\nRedis \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u5728 2.8 \u7248\u672c\u4e2d\u52a0\u5165\u4e86\u5927\u6d77\u635e\u9488\u7684\u6307\u4ee4\u2014\u2014`scan`\u3002`scan` \u76f8\u6bd4 `keys` \u5177\u5907\u6709\u4ee5\u4e0b\u7279\u70b9:\n\n1. \u590d\u6742\u5ea6\u867d\u7136\u4e5f\u662f O(n)\uff0c\u4f46\u662f\u5b83\u662f\u901a\u8fc7\u6e38\u6807\u5206\u6b65\u8fdb\u884c\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b;\n2. \u63d0\u4f9b limit \u53c2\u6570\uff0c\u53ef\u4ee5\u63a7\u5236\u6bcf\u6b21\u8fd4\u56de\u7ed3\u679c\u7684\u6700\u5927\u6761\u6570\uff0climit \u53ea\u662f\u4e00\u4e2a hint\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u53ef\u591a\u53ef\u5c11;\n3. \u540c keys \u4e00\u6837\uff0c\u5b83\u4e5f\u63d0\u4f9b\u6a21\u5f0f\u5339\u914d\u529f\u80fd;\n4. \u670d\u52a1\u5668\u4e0d\u9700\u8981\u4e3a\u6e38\u6807\u4fdd\u5b58\u72b6\u6001\uff0c\u6e38\u6807\u7684\u552f\u4e00\u72b6\u6001\u5c31\u662f scan \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u6e38\u6807\u6574\u6570;\n5. \u8fd4\u56de\u7684\u7ed3\u679c\u53ef\u80fd\u4f1a\u6709\u91cd\u590d\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u53bb\u91cd\u590d\uff0c\u8fd9\u70b9\u975e\u5e38\u91cd\u8981;\n6. \u904d\u5386\u7684\u8fc7\u7a0b\u4e2d\u5982\u679c\u6709\u6570\u636e\u4fee\u6539\uff0c\u6539\u52a8\u540e\u7684\u6570\u636e\u80fd\u4e0d\u80fd\u904d\u5386\u5230\u662f\u4e0d\u786e\u5b9a\u7684;\n7. \u5355\u6b21\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u7a7a\u7684\u5e76\u4e0d\u610f\u5473\u7740\u904d\u5386\u7ed3\u675f\uff0c\u800c\u8981\u770b\u8fd4\u56de\u7684\u6e38\u6807\u503c\u662f\u5426\u4e3a\u96f6;\n\n## scan \u57fa\u7840\u4f7f\u7528\n\u5728\u4f7f\u7528\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5f80 Redis \u91cc\u63d2\u5165 10000 \u6761\u6570\u636e\u6765\u8fdb\u884c\u6d4b\u8bd5\n\n```\nimport redis\n\nclient = redis.StrictRedis()\nfor i in range(10000):\n    client.set(\"key%d\" % i, i)\n```\n\u597d\uff0cRedis \u4e2d\u73b0\u5728\u6709\u4e86 10000 \u6761\u6570\u636e\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u627e\u51fa\u4ee5 key99 \u5f00\u5934 key \u5217\u8868\u3002\n\nscan \u53c2\u6570\u63d0\u4f9b\u4e86\u4e09\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f `cursor \u6574\u6570\u503c`\uff0c\u7b2c\u4e8c\u4e2a\u662f `key \u7684\u6b63\u5219\u6a21\u5f0f`\uff0c\u7b2c\u4e09\u4e2a\u662f`\u904d\u5386\u7684 limit hint`\u3002\u7b2c\u4e00\u6b21\u904d\u5386\u65f6\uff0ccursor \u503c\u4e3a 0\uff0c\u7136\u540e\u5c06\u8fd4\u56de\u7ed3\u679c\u4e2d\u7b2c\u4e00\u4e2a\u6574\u6570\u503c\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u904d\u5386\u7684 cursor\u3002\u4e00\u76f4\u904d\u5386\u5230\u8fd4\u56de\u7684 cursor \u503c\u4e3a 0 \u65f6\u7ed3\u675f\u3002\n```\n127.0.0.1:6379> scan 0 match key99* count 1000\n1) \"13976\"\n2)  1) \"key9911\"\n    2) \"key9974\"\n    3) \"key9994\"\n    4) \"key9910\"\n    5) \"key9907\"\n    6) \"key9989\"\n    7) \"key9971\"\n    8) \"key99\"\n    9) \"key9966\"\n   10) \"key992\"\n   11) \"key9903\"\n   12) \"key9905\"\n127.0.0.1:6379> scan 13976 match key99* count 1000\n1) \"1996\"\n2)  1) \"key9982\"\n    2) \"key9997\"\n    3) \"key9963\"\n    4) \"key996\"\n    5) \"key9912\"\n    6) \"key9999\"\n    7) \"key9921\"\n    8) \"key994\"\n    9) \"key9956\"\n   10) \"key9919\"\n127.0.0.1:6379> scan 1996 match key99* count 1000\n1) \"12594\"\n2) 1) \"key9939\"\n   2) \"key9941\"\n   3) \"key9967\"\n   4) \"key9938\"\n   5) \"key9906\"\n   6) \"key999\"\n   7) \"key9909\"\n   8) \"key9933\"\n   9) \"key9992\"\n......\n127.0.0.1:6379> scan 11687 match key99* count 1000\n1) \"0\"\n2)  1) \"key9969\"\n    2) \"key998\"\n    3) \"key9986\"\n    4) \"key9968\"\n    5) \"key9965\"\n    6) \"key9990\"\n    7) \"key9915\"\n    8) \"key9928\"\n    9) \"key9908\"\n   10) \"key9929\"\n   11) \"key9944\"\n```\n\u4ece\u4e0a\u9762\u7684\u8fc7\u7a0b\u53ef\u4ee5\u770b\u5230\u867d\u7136\u63d0\u4f9b\u7684 limit \u662f 1000\uff0c\u4f46\u662f\u8fd4\u56de\u7684\u7ed3\u679c\u53ea\u6709 10 \u4e2a\u5de6\u53f3\u3002\u56e0\u4e3a\u8fd9\u4e2a limit \u4e0d\u662f\u9650\u5b9a\u8fd4\u56de\u7ed3\u679c\u7684\u6570\u91cf\uff0c\u800c\u662f\u9650\u5b9a\u670d\u52a1\u5668\u5355\u6b21\u904d\u5386\u7684\u5b57\u5178\u69fd\u4f4d\u6570\u91cf(\u7ea6\u7b49\u4e8e)\u3002\u5982\u679c\u5c06 limit \u8bbe\u7f6e\u4e3a 10\uff0c\u4f60\u4f1a\u53d1\u73b0\u8fd4\u56de\u7ed3\u679c\u662f\u7a7a\u7684\uff0c\u4f46\u662f\u6e38\u6807\u503c\u4e0d\u4e3a\u96f6\uff0c\u610f\u5473\u7740\u904d\u5386\u8fd8\u6ca1\u7ed3\u675f\u3002\n\n```\n127.0.0.1:6379> scan 0 match key99* count 10\n1) \"3072\"\n2) (empty list or set)\n```\n\n## \u5b57\u5178\u7684\u7ed3\u6784\n\u5728 Redis \u4e2d\u6240\u6709\u7684 key \u90fd\u5b58\u50a8\u5728\u4e00\u4e2a\u5f88\u5927\u7684\u5b57\u5178\u4e2d\uff0c\u8fd9\u4e2a\u5b57\u5178\u7684\u7ed3\u6784\u548c Java \u4e2d\u7684 HashMap \u4e00\u6837\uff0c\u662f\u4e00\u7ef4\u6570\u7ec4 + \u4e8c\u7ef4\u94fe\u8868\u7ed3\u6784\uff0c\u7b2c\u4e00\u7ef4\u6570\u7ec4\u7684\u5927\u5c0f\u603b\u662f 2^n(n>=0)\uff0c\u6269\u5bb9\u4e00\u6b21\u6570\u7ec4\u5927\u5c0f\u7a7a\u95f4\u52a0\u500d\uff0c\u4e5f\u5c31\u662f n++\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/5/164695b9f06c757e?w=579&h=277&f=png&s=11839)\n\nscan \u6307\u4ee4\u8fd4\u56de\u7684\u6e38\u6807\u5c31\u662f\u7b2c\u4e00\u7ef4\u6570\u7ec4\u7684\u4f4d\u7f6e\u7d22\u5f15\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a\u4f4d\u7f6e\u7d22\u5f15\u79f0\u4e3a\u69fd (slot)\u3002\u5982\u679c\u4e0d\u8003\u8651\u5b57\u5178\u7684\u6269\u5bb9\u7f29\u5bb9\uff0c\u76f4\u63a5\u6309\u6570\u7ec4\u4e0b\u6807\u6328\u4e2a\u904d\u5386\u5c31\u884c\u4e86\u3002limit \u53c2\u6570\u5c31\u8868\u793a\u9700\u8981\u904d\u5386\u7684\u69fd\u4f4d\u6570\uff0c\u4e4b\u6240\u4ee5\u8fd4\u56de\u7684\u7ed3\u679c\u53ef\u80fd\u591a\u53ef\u80fd\u5c11\uff0c\u662f\u56e0\u4e3a\u4e0d\u662f\u6240\u6709\u7684\u69fd\u4f4d\u4e0a\u90fd\u4f1a\u6302\u63a5\u94fe\u8868\uff0c\u6709\u4e9b\u69fd\u4f4d\u53ef\u80fd\u662f\u7a7a\u7684\uff0c\u8fd8\u6709\u4e9b\u69fd\u4f4d\u4e0a\u6302\u63a5\u7684\u94fe\u8868\u4e0a\u7684\u5143\u7d20\u53ef\u80fd\u4f1a\u6709\u591a\u4e2a\u3002\u6bcf\u4e00\u6b21\u904d\u5386\u90fd\u4f1a\u5c06 limit \u6570\u91cf\u7684\u69fd\u4f4d\u4e0a\u6302\u63a5\u7684\u6240\u6709\u94fe\u8868\u5143\u7d20\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u8fc7\u6ee4\u540e\uff0c\u4e00\u6b21\u6027\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\n\n## scan \u904d\u5386\u987a\u5e8f\nscan \u7684\u904d\u5386\u987a\u5e8f\u975e\u5e38\u7279\u522b\u3002\u5b83\u4e0d\u662f\u4ece\u7b2c\u4e00\u7ef4\u6570\u7ec4\u7684\u7b2c 0 \u4f4d\u4e00\u76f4\u904d\u5386\u5230\u672b\u5c3e\uff0c\u800c\u662f\u91c7\u7528\u4e86\u9ad8\u4f4d\u8fdb\u4f4d\u52a0\u6cd5\u6765\u904d\u5386\u3002\u4e4b\u6240\u4ee5\u4f7f\u7528\u8fd9\u6837\u7279\u6b8a\u7684\u65b9\u5f0f\u8fdb\u884c\u904d\u5386\uff0c\u662f\u8003\u8651\u5230\u5b57\u5178\u7684\u6269\u5bb9\u548c\u7f29\u5bb9\u65f6\u907f\u514d\u69fd\u4f4d\u7684\u904d\u5386\u91cd\u590d\u548c\u9057\u6f0f\u3002\n\n\u9996\u5148\u6211\u4eec\u7528\u52a8\u753b\u6f14\u793a\u4e00\u4e0b\u666e\u901a\u52a0\u6cd5\u548c\u9ad8\u4f4d\u8fdb\u4f4d\u52a0\u6cd5\u7684\u533a\u522b\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/5/16469760d12e0cbd?w=400&h=200&f=gif&s=70783)\n\n\u4ece\u52a8\u753b\u4e2d\u53ef\u4ee5\u770b\u51fa\u9ad8\u4f4d\u8fdb\u4f4d\u6cd5\u4ece\u5de6\u8fb9\u52a0\uff0c\u8fdb\u4f4d\u5f80\u53f3\u8fb9\u79fb\u52a8\uff0c\u540c\u666e\u901a\u52a0\u6cd5\u6b63\u597d\u76f8\u53cd\u3002\u4f46\u662f\u6700\u7ec8\u5b83\u4eec\u90fd\u4f1a\u904d\u5386\u6240\u6709\u7684\u69fd\u4f4d\u5e76\u4e14\u6ca1\u6709\u91cd\u590d\u3002\n\n## \u5b57\u5178\u6269\u5bb9\nJava \u4e2d\u7684 HashMap \u6709\u6269\u5bb9\u7684\u6982\u5ff5\uff0c\u5f53 loadFactor \u8fbe\u5230\u9608\u503c\u65f6\uff0c\u9700\u8981\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u65b0\u7684 2 \u500d\u5927\u5c0f\u7684\u6570\u7ec4\uff0c\u7136\u540e\u5c06\u6240\u6709\u7684\u5143\u7d20\u5168\u90e8 rehash \u6302\u5230\u65b0\u7684\u6570\u7ec4\u4e0b\u9762\u3002rehash \u5c31\u662f\u5c06\u5143\u7d20\u7684 hash \u503c\u5bf9\u6570\u7ec4\u957f\u5ea6\u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\uff0c\u56e0\u4e3a\u957f\u5ea6\u53d8\u4e86\uff0c\u6240\u4ee5\u6bcf\u4e2a\u5143\u7d20\u6302\u63a5\u7684\u69fd\u4f4d\u53ef\u80fd\u4e5f\u53d1\u751f\u4e86\u53d8\u5316\u3002\u53c8\u56e0\u4e3a\u6570\u7ec4\u7684\u957f\u5ea6\u662f 2^n \u6b21\u65b9\uff0c\u6240\u4ee5\u53d6\u6a21\u8fd0\u7b97\u7b49\u4ef7\u4e8e\u4f4d\u4e0e\u64cd\u4f5c\u3002\n\n```\na mod 8 = a & (8-1) = a & 7\na mod 16 = a & (16-1) = a & 15\na mod 32 = a & (32-1) = a & 31\n```\n\u8fd9\u91cc\u7684 7, 15, 31 \u79f0\u4e4b\u4e3a\u5b57\u5178\u7684 mask \u503c\uff0cmask \u7684\u4f5c\u7528\u5c31\u662f\u4fdd\u7559 hash \u503c\u7684\u4f4e\u4f4d\uff0c\u9ad8\u4f4d\u90fd\u88ab\u8bbe\u7f6e\u4e3a 0\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b rehash \u524d\u540e\u5143\u7d20\u69fd\u4f4d\u7684\u53d8\u5316\u3002\n\n\u5047\u8bbe\u5f53\u524d\u7684\u5b57\u5178\u7684\u6570\u7ec4\u957f\u5ea6\u7531 8 \u4f4d\u6269\u5bb9\u5230 16 \u4f4d\uff0c\u90a3\u4e48 3 \u53f7\u69fd\u4f4d 011 \u5c06\u4f1a\u88ab rehash \u5230 3 \u53f7\u69fd\u4f4d\u548c 11 \u53f7\u69fd\u4f4d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5\u69fd\u4f4d\u94fe\u8868\u4e2d\u5927\u7ea6\u6709\u4e00\u534a\u7684\u5143\u7d20\u8fd8\u662f 3 \u53f7\u69fd\u4f4d\uff0c\u5176\u5b83\u7684\u5143\u7d20\u4f1a\u653e\u5230 11 \u53f7\u69fd\u4f4d\uff0c11 \u8fd9\u4e2a\u6570\u5b57\u7684\u4e8c\u8fdb\u5236\u662f 1011\uff0c\u5c31\u662f\u5bf9 3 \u7684\u4e8c\u8fdb\u5236 011 \u589e\u52a0\u4e86\u4e00\u4e2a\u9ad8\u4f4d 1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/5/164698cd0d3eec33?w=534&h=268&f=png&s=12978)\n\n\u62bd\u8c61\u4e00\u70b9\u8bf4\uff0c\u5047\u8bbe\u5f00\u59cb\u69fd\u4f4d\u7684\u4e8c\u8fdb\u5236\u6570\u662f xxx\uff0c\u90a3\u4e48\u8be5\u69fd\u4f4d\u4e2d\u7684\u5143\u7d20\u5c06\u88ab rehash \u5230 0xxx \u548c 1xxx(xxx+8) \u4e2d\u3002\n\u5982\u679c\u5b57\u5178\u957f\u5ea6\u7531 16 \u4f4d\u6269\u5bb9\u5230 32 \u4f4d\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e8c\u8fdb\u5236\u69fd\u4f4d xxxx \u4e2d\u7684\u5143\u7d20\u5c06\u88ab rehash \u5230 0xxxx \u548c 1xxxx(xxxx+16) \u4e2d\u3002\n\n## \u5bf9\u6bd4\u6269\u5bb9\u7f29\u5bb9\u524d\u540e\u7684\u904d\u5386\u987a\u5e8f\n\n![](https://user-gold-cdn.xitu.io/2018/7/5/164699dae277cc19?w=1428&h=310&f=png&s=48575)\n\n\u89c2\u5bdf\u8fd9\u5f20\u56fe\uff0c\u6211\u4eec\u53d1\u73b0\u91c7\u7528\u9ad8\u4f4d\u8fdb\u4f4d\u52a0\u6cd5\u7684\u904d\u5386\u987a\u5e8f\uff0crehash \u540e\u7684\u69fd\u4f4d\u5728\u904d\u5386\u987a\u5e8f\u4e0a\u662f\u76f8\u90bb\u7684\u3002\n\n\u5047\u8bbe\u5f53\u524d\u8981\u5373\u5c06\u904d\u5386 110 \u8fd9\u4e2a\u4f4d\u7f6e (\u6a59\u8272)\uff0c\u90a3\u4e48\u6269\u5bb9\u540e\uff0c\u5f53\u524d\u69fd\u4f4d\u4e0a\u6240\u6709\u7684\u5143\u7d20\u5bf9\u5e94\u7684\u65b0\u69fd\u4f4d\u662f 0110 \u548c 1110(\u6df1\u7eff\u8272)\uff0c\u4e5f\u5c31\u662f\u5728\u69fd\u4f4d\u7684\u4e8c\u8fdb\u5236\u6570\u589e\u52a0\u4e00\u4e2a\u9ad8\u4f4d 0 \u6216 1\u3002\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4ece 0110 \u8fd9\u4e2a\u69fd\u4f4d\u5f00\u59cb\u5f80\u540e\u7ee7\u7eed\u904d\u5386\uff0c0110 \u69fd\u4f4d\u4e4b\u524d\u7684\u6240\u6709\u69fd\u4f4d\u90fd\u662f\u5df2\u7ecf\u904d\u5386\u8fc7\u7684\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u6269\u5bb9\u540e\u5bf9\u5df2\u7ecf\u904d\u5386\u8fc7\u7684\u69fd\u4f4d\u8fdb\u884c\u91cd\u590d\u904d\u5386\u3002\n\n\u518d\u8003\u8651\u7f29\u5bb9\uff0c\u5047\u8bbe\u5f53\u524d\u5373\u5c06\u904d\u5386 110 \u8fd9\u4e2a\u4f4d\u7f6e (\u6a59\u8272)\uff0c\u90a3\u4e48\u7f29\u5bb9\u540e\uff0c\u5f53\u524d\u69fd\u4f4d\u6240\u6709\u7684\u5143\u7d20\u5bf9\u5e94\u7684\u65b0\u69fd\u4f4d\u662f 10(\u6df1\u7eff\u8272)\uff0c\u4e5f\u5c31\u662f\u53bb\u6389\u69fd\u4f4d\u4e8c\u8fdb\u5236\u6700\u9ad8\u4f4d\u3002\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4ece 10 \u8fd9\u4e2a\u69fd\u4f4d\u7ee7\u7eed\u5f80\u540e\u904d\u5386\uff0c10 \u69fd\u4f4d\u4e4b\u524d\u7684\u6240\u6709\u69fd\u4f4d\u90fd\u662f\u5df2\u7ecf\u904d\u5386\u8fc7\u7684\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u7f29\u5bb9\u7684\u91cd\u590d\u904d\u5386\u3002\u4e0d\u8fc7\u7f29\u5bb9\u8fd8\u662f\u4e0d\u592a\u4e00\u6837\uff0c\u5b83\u4f1a\u5bf9\u56fe\u4e2d 010 \u8fd9\u4e2a\u69fd\u4f4d\u4e0a\u7684\u5143\u7d20\u8fdb\u884c\u91cd\u590d\u904d\u5386\uff0c\u56e0\u4e3a\u7f29\u878d\u540e 10 \u69fd\u4f4d\u7684\u5143\u7d20\u662f 010 \u548c 110 \u4e0a\u6302\u63a5\u7684\u5143\u7d20\u7684\u878d\u5408\u3002\n\n## \u6e10\u8fdb\u5f0f rehash\nJava \u7684 HashMap \u5728\u6269\u5bb9\u65f6\u4f1a\u4e00\u6b21\u6027\u5c06\u65e7\u6570\u7ec4\u4e0b\u6302\u63a5\u7684\u5143\u7d20\u5168\u90e8\u8f6c\u79fb\u5230\u65b0\u6570\u7ec4\u4e0b\u9762\u3002\u5982\u679c HashMap \u4e2d\u5143\u7d20\u7279\u522b\u591a\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u51fa\u73b0\u5361\u987f\u73b0\u8c61\u3002Redis \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u91c7\u7528**\u6e10\u8fdb\u5f0f rehash**\u3002\n\n\u5b83\u4f1a\u540c\u65f6\u4fdd\u7559\u65e7\u6570\u7ec4\u548c\u65b0\u6570\u7ec4\uff0c\u7136\u540e\u5728\u5b9a\u65f6\u4efb\u52a1\u4e2d\u4ee5\u53ca\u540e\u7eed\u5bf9 hash \u7684\u6307\u4ee4\u64cd\u4f5c\u4e2d\u6e10\u6e10\u5730\u5c06\u65e7\u6570\u7ec4\u4e2d\u6302\u63a5\u7684\u5143\u7d20\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\u4e0a\u3002\u8fd9\u610f\u5473\u7740\u8981\u64cd\u4f5c\u5904\u4e8e rehash \u4e2d\u7684\u5b57\u5178\uff0c\u9700\u8981\u540c\u65f6\u8bbf\u95ee\u65b0\u65e7\u4e24\u4e2a\u6570\u7ec4\u7ed3\u6784\u3002\u5982\u679c\u5728\u65e7\u6570\u7ec4\u4e0b\u9762\u627e\u4e0d\u5230\u5143\u7d20\uff0c\u8fd8\u9700\u8981\u53bb\u65b0\u6570\u7ec4\u4e0b\u9762\u53bb\u5bfb\u627e\u3002\n\nscan \u4e5f\u9700\u8981\u8003\u8651\u8fd9\u4e2a\u95ee\u9898\uff0c\u5bf9\u4e0e rehash \u4e2d\u7684\u5b57\u5178\uff0c\u5b83\u9700\u8981\u540c\u65f6\u626b\u63cf\u65b0\u65e7\u69fd\u4f4d\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u878d\u5408\u540e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\n\n## \u66f4\u591a\u7684 scan \u6307\u4ee4\nscan \u6307\u4ee4\u662f\u4e00\u7cfb\u5217\u6307\u4ee4\uff0c\u9664\u4e86\u53ef\u4ee5\u904d\u5386\u6240\u6709\u7684 key \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u6307\u5b9a\u7684\u5bb9\u5668\u96c6\u5408\u8fdb\u884c\u904d\u5386\u3002\u6bd4\u5982 zscan \u904d\u5386 zset \u96c6\u5408\u5143\u7d20\uff0chscan \u904d\u5386 hash \u5b57\u5178\u7684\u5143\u7d20\u3001sscan \u904d\u5386 set \u96c6\u5408\u7684\u5143\u7d20\u3002\n\n\u5b83\u4eec\u7684\u539f\u7406\u540c scan \u90fd\u4f1a\u7c7b\u4f3c\u7684\uff0c\u56e0\u4e3a hash \u5e95\u5c42\u5c31\u662f\u5b57\u5178\uff0cset \u4e5f\u662f\u4e00\u4e2a\u7279\u6b8a\u7684 hash(\u6240\u6709\u7684 value \u6307\u5411\u540c\u4e00\u4e2a\u5143\u7d20)\uff0czset \u5185\u90e8\u4e5f\u4f7f\u7528\u4e86\u5b57\u5178\u6765\u5b58\u50a8\u6240\u6709\u7684\u5143\u7d20\u5185\u5bb9\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\n\n## \u5927 key \u626b\u63cf\n\u6709\u65f6\u5019\u4f1a\u56e0\u4e3a\u4e1a\u52a1\u4eba\u5458\u4f7f\u7528\u4e0d\u5f53\uff0c\u5728 Redis \u5b9e\u4f8b\u4e2d\u4f1a\u5f62\u6210\u5f88\u5927\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982\u4e00\u4e2a\u5f88\u5927\u7684 hash\uff0c\u4e00\u4e2a\u5f88\u5927\u7684 zset \u8fd9\u90fd\u662f\u7ecf\u5e38\u51fa\u73b0\u7684\u3002\u8fd9\u6837\u7684\u5bf9\u8c61\u5bf9 Redis \u7684\u96c6\u7fa4\u6570\u636e\u8fc1\u79fb\u5e26\u6765\u4e86\u5f88\u5927\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u5728\u96c6\u7fa4\u73af\u5883\u4e0b\uff0c\u5982\u679c\u67d0\u4e2a key \u592a\u5927\uff0c\u4f1a\u6570\u636e\u5bfc\u81f4\u8fc1\u79fb\u5361\u987f\u3002\u53e6\u5916\u5728\u5185\u5b58\u5206\u914d\u4e0a\uff0c\u5982\u679c\u4e00\u4e2a key \u592a\u5927\uff0c\u90a3\u4e48\u5f53\u5b83\u9700\u8981\u6269\u5bb9\u65f6\uff0c\u4f1a\u4e00\u6b21\u6027\u7533\u8bf7\u66f4\u5927\u7684\u4e00\u5757\u5185\u5b58\uff0c\u8fd9\u4e5f\u4f1a\u5bfc\u81f4\u5361\u987f\u3002\u5982\u679c\u8fd9\u4e2a\u5927 key \u88ab\u5220\u9664\uff0c\u5185\u5b58\u4f1a\u4e00\u6b21\u6027\u56de\u6536\uff0c\u5361\u987f\u73b0\u8c61\u4f1a\u518d\u4e00\u6b21\u4ea7\u751f\u3002\n\n**\u5728\u5e73\u65f6\u7684\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u5927 key \u7684\u4ea7\u751f**\u3002\n\n\u5982\u679c\u4f60\u89c2\u5bdf\u5230 Redis \u7684\u5185\u5b58\u5927\u8d77\u5927\u843d\uff0c\u8fd9\u6781\u6709\u53ef\u80fd\u662f\u56e0\u4e3a\u5927 key \u5bfc\u81f4\u7684\uff0c\u8fd9\u65f6\u5019\u4f60\u5c31\u9700\u8981\u5b9a\u4f4d\u51fa\u5177\u4f53\u662f\u90a3\u4e2a key\uff0c\u8fdb\u4e00\u6b65\u5b9a\u4f4d\u51fa\u5177\u4f53\u7684\u4e1a\u52a1\u6765\u6e90\uff0c\u7136\u540e\u518d\u6539\u8fdb\u76f8\u5173\u4e1a\u52a1\u4ee3\u7801\u8bbe\u8ba1\u3002\n\n**\u90a3\u5982\u4f55\u5b9a\u4f4d\u5927 key \u5462\uff1f**\n\n\u4e3a\u4e86\u907f\u514d\u5bf9\u7ebf\u4e0a Redis \u5e26\u6765\u5361\u987f\uff0c\u8fd9\u5c31\u8981\u7528\u5230 scan \u6307\u4ee4\uff0c\u5bf9\u4e8e\u626b\u63cf\u51fa\u6765\u7684\u6bcf\u4e00\u4e2a key\uff0c\u4f7f\u7528 type \u6307\u4ee4\u83b7\u5f97 key \u7684\u7c7b\u578b\uff0c\u7136\u540e\u4f7f\u7528\u76f8\u5e94\u6570\u636e\u7ed3\u6784\u7684 size \u6216\u8005 len \u65b9\u6cd5\u6765\u5f97\u5230\u5b83\u7684\u5927\u5c0f\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u7c7b\u578b\uff0c\u4fdd\u7559\u5927\u5c0f\u7684\u524d N \u540d\u4f5c\u4e3a\u626b\u63cf\u7ed3\u679c\u5c55\u793a\u51fa\u6765\u3002\n\n\u4e0a\u9762\u8fd9\u6837\u7684\u8fc7\u7a0b\u9700\u8981\u7f16\u5199\u811a\u672c\uff0c\u6bd4\u8f83\u7e41\u7410\uff0c\u4e0d\u8fc7 Redis \u5b98\u65b9\u5df2\u7ecf\u5728 redis-cli \u6307\u4ee4\u4e2d\u63d0\u4f9b\u4e86\u8fd9\u6837\u7684\u626b\u63cf\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u5373\u7528\u3002\n```\nredis-cli -h 127.0.0.1 -p 7001 \u2013-bigkeys\n```\n\u5982\u679c\u4f60\u62c5\u5fc3\u8fd9\u4e2a\u6307\u4ee4\u4f1a\u5927\u5e45\u62ac\u5347 Redis \u7684 ops \u5bfc\u81f4\u7ebf\u4e0a\u62a5\u8b66\uff0c\u8fd8\u53ef\u4ee5\u589e\u52a0\u4e00\u4e2a\u4f11\u7720\u53c2\u6570\u3002\n```\nredis-cli -h 127.0.0.1 -p 7001 \u2013-bigkeys -i 0.1\n```\n\u4e0a\u9762\u8fd9\u4e2a\u6307\u4ee4\u6bcf\u9694 100 \u6761 scan \u6307\u4ee4\u5c31\u4f1a\u4f11\u7720 0.1s\uff0cops \u5c31\u4e0d\u4f1a\u5267\u70c8\u62ac\u5347\uff0c\u4f46\u662f\u626b\u63cf\u7684\u65f6\u95f4\u4f1a\u53d8\u957f\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n\u611f\u5174\u8da3\u53ef\u4ee5\u7ee7\u7eed\u6df1\u5165\u9605\u8bfb [\u7f8e\u56e2\u8fd1\u671f\u4fee\u590d\u7684Scan\u7684\u4e00\u4e2abug](https://mp.weixin.qq.com/s/ufoLJiXE0wU4Bc7ZbE9cDQ)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/10\u5e94\u7528_9\u5927\u6d77\u635e\u9488__Scan.md", "create_date": "2020-02-18T03:01:05.620", "order": 11}}, {"model": "subject.chapter", "pk": 21, "fields": {"title": "12\u539f\u7406 2\uff1a\u4ea4\u5934\u63a5\u8033 \u2014\u2014 \u901a\u4fe1\u534f\u8bae", "topic": 2, "md5": "6666ecd1ef2c2dbc93e534f708443440", "md_body": "# \u539f\u7406 2\uff1a\u4ea4\u5934\u63a5\u8033 \u2014\u2014 \u901a\u4fe1\u534f\u8bae\n\nRedis \u7684\u4f5c\u8005\u8ba4\u4e3a\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u74f6\u9888\u4e00\u822c\u4e0d\u5728\u4e8e\u7f51\u7edc\u6d41\u91cf\uff0c\u800c\u662f\u6570\u636e\u5e93\u81ea\u8eab\u5185\u90e8\u903b\u8f91\u5904\u7406\u4e0a\u3002\u6240\u4ee5\u5373\u4f7f Redis \u4f7f\u7528\u4e86\u6d6a\u8d39\u6d41\u91cf\u7684\u6587\u672c\u534f\u8bae\uff0c\u4f9d\u7136\u53ef\u4ee5\u53d6\u5f97\u6781\u9ad8\u7684\u8bbf\u95ee\u6027\u80fd\u3002Redis \u5c06\u6240\u6709\u6570\u636e\u90fd\u653e\u5728\u5185\u5b58\uff0c\u7528\u4e00\u4e2a\u5355\u7ebf\u7a0b\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5355\u4e2a\u8282\u70b9\u5728\u8dd1\u6ee1\u4e00\u4e2a CPU \u6838\u5fc3\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u8fbe\u5230\u4e86 10w/s \u7684\u8d85\u9ad8 QPS\u3002\n\nRESP(Redis Serialization Protocol)\n--\nRESP \u662f Redis \u5e8f\u5217\u5316\u534f\u8bae\u7684\u7b80\u5199\u3002\u5b83\u662f\u4e00\u79cd\u76f4\u89c2\u7684\u6587\u672c\u534f\u8bae\uff0c\u4f18\u52bf\u5728\u4e8e\u5b9e\u73b0\u5f02\u5e38\u7b80\u5355\uff0c\u89e3\u6790\u6027\u80fd\u6781\u597d\u3002\n\nRedis \u534f\u8bae\u5c06\u4f20\u8f93\u7684\u7ed3\u6784\u6570\u636e\u5206\u4e3a 5 \u79cd\u6700\u5c0f\u5355\u5143\u7c7b\u578b\uff0c\u5355\u5143\u7ed3\u675f\u65f6\u7edf\u4e00\u52a0\u4e0a\u56de\u8f66\u6362\u884c\u7b26\u53f7`\\r\\n`\u3002\n1. \u5355\u884c\u5b57\u7b26\u4e32 \u4ee5 `+` \u7b26\u53f7\u5f00\u5934\u3002\n2. \u591a\u884c\u5b57\u7b26\u4e32 \u4ee5 `$` \u7b26\u53f7\u5f00\u5934\uff0c\u540e\u8ddf\u5b57\u7b26\u4e32\u957f\u5ea6\u3002\n3. \u6574\u6570\u503c \u4ee5 `:` \u7b26\u53f7\u5f00\u5934\uff0c\u540e\u8ddf\u6574\u6570\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u3002\n4. \u9519\u8bef\u6d88\u606f \u4ee5 `-` \u7b26\u53f7\u5f00\u5934\u3002\n5. \u6570\u7ec4 \u4ee5 `*` \u53f7\u5f00\u5934\uff0c\u540e\u8ddf\u6570\u7ec4\u7684\u957f\u5ea6\u3002\n\n**\u5355\u884c\u5b57\u7b26\u4e32** hello world\n```\n+hello world\\r\\n\n```\n\n**\u591a\u884c\u5b57\u7b26\u4e32** hello world\n```\n$11\\r\\nhello world\\r\\n\n```\n\u591a\u884c\u5b57\u7b26\u4e32\u5f53\u7136\u4e5f\u53ef\u4ee5\u8868\u793a\u5355\u884c\u5b57\u7b26\u4e32\u3002\n\n**\u6574\u6570** 1024\n```\n:1024\\r\\n\n```\n\n**\u9519\u8bef** \u53c2\u6570\u7c7b\u578b\u9519\u8bef\n```\n-WRONGTYPE Operation against a key holding the wrong kind of value\\r\\n\n```\n\n**\u6570\u7ec4** [1,2,3]\n```\n*3\\r\\n:1\\r\\n:2\\r\\n:3\\r\\n\n```\n\n**NULL** \u7528\u591a\u884c\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u4e0d\u8fc7\u957f\u5ea6\u8981\u5199\u6210-1\u3002\n```\n$-1\\r\\n\n```\n\n**\u7a7a\u4e32** \u7528\u591a\u884c\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u957f\u5ea6\u586b 0\u3002\n```\n$0\\r\\n\\r\\n\n```\n\u6ce8\u610f\u8fd9\u91cc\u6709\u4e24\u4e2a`\\r\\n`\u3002\u4e3a\u4ec0\u4e48\u662f\u4e24\u4e2a?\u56e0\u4e3a\u4e24\u4e2a`\\r\\n`\u4e4b\u95f4,\u9694\u7684\u662f\u7a7a\u4e32\u3002\n\n\n\u5ba2\u6237\u7aef -> \u670d\u52a1\u5668\n--\n\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u7684\u6307\u4ee4\u53ea\u6709\u4e00\u79cd\u683c\u5f0f\uff0c\u591a\u884c\u5b57\u7b26\u4e32\u6570\u7ec4\u3002\u6bd4\u5982\u4e00\u4e2a\u7b80\u5355\u7684 set \u6307\u4ee4```set author codehole```\u4f1a\u88ab\u5e8f\u5217\u5316\u6210\u4e0b\u9762\u7684\u5b57\u7b26\u4e32\u3002\n\n```\n*3\\r\\n$3\\r\\nset\\r\\n$6\\r\\nauthor\\r\\n$8\\r\\ncodehole\\r\\n\n```\n\n\u5728\u63a7\u5236\u53f0\u8f93\u51fa\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u51fa\u8fd9\u662f\u5f88\u597d\u9605\u8bfb\u7684\u4e00\u79cd\u683c\u5f0f\u3002\n```\n*3\n$3\nset\n$6\nauthor\n$8\ncodehole\n\n```\n\n\u670d\u52a1\u5668 -> \u5ba2\u6237\u7aef\n--\n\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u56de\u590d\u7684\u54cd\u5e94\u8981\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u6240\u4ee5\u6d88\u606f\u54cd\u5e94\u5728\u7ed3\u6784\u4e0a\u8981\u590d\u6742\u4e0d\u5c11\u3002\u4e0d\u8fc7\u518d\u590d\u6742\u7684\u54cd\u5e94\u6d88\u606f\u4e5f\u662f\u4ee5\u4e0a 5 \u4e2d\u57fa\u672c\u7c7b\u578b\u7684\u7ec4\u5408\u3002\n\n**\u5355\u884c\u5b57\u7b26\u4e32\u54cd\u5e94**\n```\n127.0.0.1:6379> set author codehole\nOK\n```\n\u8fd9\u91cc\u7684 OK \u5c31\u662f\u5355\u884c\u54cd\u5e94\uff0c\u6ca1\u6709\u4f7f\u7528\u5f15\u53f7\u62ec\u8d77\u6765\u3002\n```\n+OK\n\n```\n**\u9519\u8bef\u54cd\u5e94**\n```\n127.0.0.1:6379> incr author\n(error) ERR value is not an integer or out of range\n```\n\u8bd5\u56fe\u5bf9\u4e00\u4e2a\u5b57\u7b26\u4e32\u8fdb\u884c\u81ea\u589e\uff0c\u670d\u52a1\u5668\u629b\u51fa\u4e00\u4e2a\u901a\u7528\u7684\u9519\u8bef\u3002\n```\n-ERR value is not an integer or out of range\n\n```\n**\u6574\u6570\u54cd\u5e94**\n```\n127.0.0.1:6379> incr books\n(integer) 1\n```\n\u8fd9\u91cc\u7684```1```\u5c31\u662f\u6574\u6570\u54cd\u5e94\n```\n:1\n\n```\n**\u591a\u884c\u5b57\u7b26\u4e32\u54cd\u5e94**\n```\n127.0.0.1:6379> get author\n\"codehole\"\n```\n\u8fd9\u91cc\u4f7f\u7528\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u5c31\u662f\u591a\u884c\u5b57\u7b26\u4e32\u54cd\u5e94\n```\n$8\ncodehole\n\n```\n**\u6570\u7ec4\u54cd\u5e94**\n```\n127.0.0.1:6379> hset info name laoqian\n(integer) 1\n127.0.0.1:6379> hset info age 30\n(integer) 1\n127.0.0.1:6379> hset info sex male\n(integer) 1\n127.0.0.1:6379> hgetall info\n1) \"name\"\n2) \"laoqian\"\n3) \"age\"\n4) \"30\"\n5) \"sex\"\n6) \"male\"\n```\n\u8fd9\u91cc\u7684 hgetall \u547d\u4ee4\u8fd4\u56de\u7684\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u7b2c 0|2|4 \u4f4d\u7f6e\u7684\u5b57\u7b26\u4e32\u662f hash \u8868\u7684 key\uff0c\u7b2c 1|3|5 \u4f4d\u7f6e\u7684\u5b57\u7b26\u4e32\u662f value\uff0c\u5ba2\u6237\u7aef\u8d1f\u8d23\u5c06\u6570\u7ec4\u7ec4\u88c5\u6210\u5b57\u5178\u518d\u8fd4\u56de\u3002\n```\n*6\n$4\nname\n$6\nlaoqian\n$3\nage\n$2\n30\n$3\nsex\n$4\nmale\n\n```\n\n**\u5d4c\u5957**\n```\n127.0.0.1:6379> scan 0\n1) \"0\"\n2) 1) \"info\"\n   2) \"books\"\n   3) \"author\"\n```\nscan \u547d\u4ee4\u7528\u6765\u626b\u63cf\u670d\u52a1\u5668\u5305\u542b\u7684\u6240\u6709 key \u5217\u8868\uff0c\u5b83\u662f\u4ee5\u6e38\u6807\u7684\u5f62\u5f0f\u83b7\u53d6\uff0c\u4e00\u6b21\u53ea\u83b7\u53d6\u4e00\u90e8\u5206\u3002\n\nscan \u547d\u4ee4\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5d4c\u5957\u6570\u7ec4\u3002\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u503c\u8868\u793a\u6e38\u6807\u7684\u503c\uff0c\u5982\u679c\u8fd9\u4e2a\u503c\u4e3a\u96f6\uff0c\u8bf4\u660e\u5df2\u7ecf\u904d\u5386\u5b8c\u6bd5\u3002\u5982\u679c\u4e0d\u4e3a\u96f6\uff0c\u4f7f\u7528\u8fd9\u4e2a\u503c\u4f5c\u4e3a scan \u547d\u4ee4\u7684\u53c2\u6570\u8fdb\u884c\u4e0b\u4e00\u6b21\u904d\u5386\u3002\u6570\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u503c\u53c8\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u8fd9\u4e2a\u6570\u7ec4\u5c31\u662f key \u5217\u8868\u3002\n```\n*2\n$1\n0\n*3\n$4\ninfo\n$5\nbooks\n$6\nauthor\n```\n\n\u5c0f\u7ed3\n--\nRedis \u534f\u8bae\u91cc\u6709\u5927\u91cf\u5197\u4f59\u7684\u56de\u8f66\u6362\u884c\u7b26\uff0c\u4f46\u662f\u8fd9\u4e0d\u5f71\u54cd\u5b83\u6210\u4e3a\u4e92\u8054\u7f51\u6280\u672f\u9886\u57df\u975e\u5e38\u53d7\u6b22\u8fce\u7684\u4e00\u4e2a\u6587\u672c\u534f\u8bae\u3002\u6709\u5f88\u591a\u5f00\u6e90\u9879\u76ee\u4f7f\u7528 RESP \u4f5c\u4e3a\u5b83\u7684\u901a\u8baf\u534f\u8bae\u3002\u5728\u6280\u672f\u9886\u57df\u6027\u80fd\u5e76\u4e0d\u603b\u662f\u4e00\u5207\uff0c\u8fd8\u6709\u7b80\u5355\u6027\u3001\u6613\u7406\u89e3\u6027\u548c\u6613\u5b9e\u73b0\u6027\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u8fdb\u884c\u9002\u5f53\u6743\u8861\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n\u5982\u679c\u4f60\u60f3\u81ea\u5df1\u5b9e\u73b0\u4e00\u5957Redis\u534f\u8bae\u7684\u89e3\u7801\u5668\uff0c\u8bf7\u9605\u8bfb\u8001\u94b1\u7684\u53e6\u4e00\u7bc7\u6587\u7ae0[\u300a\u57fa\u4e8eNetty\u5b9e\u73b0Redis\u534f\u8bae\u7684\u7f16\u7801\u89e3\u7801\u5668\u300b](https://juejin.im/post/5aaf1e0af265da2381556c0e)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/12\u539f\u7406_2\u4ea4\u5934\u63a5\u8033__\u901a\u4fe1\u534f\u8bae.md", "create_date": "2020-02-18T03:01:05.643", "order": 13}}, {"model": "subject.chapter", "pk": 22, "fields": {"title": "14\u539f\u7406 4\uff1a\u96f7\u5389\u98ce\u884c \u2014\u2014 \u7ba1\u9053", "topic": 2, "md5": "03df31be9c00183215fef7119fc75faf", "md_body": "# \u539f\u7406 4\uff1a\u96f7\u5389\u98ce\u884c \u2014\u2014 \u7ba1\u9053\n\n\u5927\u591a\u6570\u540c\u5b66\u4e00\u76f4\u4ee5\u6765\u5bf9 Redis \u7ba1\u9053\u6709\u4e00\u4e2a\u8bef\u89e3\uff0c\u4ed6\u4eec\u4ee5\u4e3a\u8fd9\u662f Redis \u670d\u52a1\u5668\u63d0\u4f9b\u7684\u4e00\u79cd\u7279\u522b\u7684\u6280\u672f\uff0c\u6709\u4e86\u8fd9\u79cd\u6280\u672f\u5c31\u53ef\u4ee5\u52a0\u901f Redis \u7684\u5b58\u53d6\u6548\u7387\u3002\u4f46\u662f\u5b9e\u9645\u4e0a Redis \u7ba1\u9053 (Pipeline) \u672c\u8eab\u5e76\u4e0d\u662f Redis \u670d\u52a1\u5668\u76f4\u63a5\u63d0\u4f9b\u7684\u6280\u672f\uff0c\u8fd9\u4e2a\u6280\u672f\u672c\u8d28\u4e0a\u662f\u7531\u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\uff0c\u8ddf\u670d\u52a1\u5668\u6ca1\u6709\u4ec0\u4e48\u76f4\u63a5\u7684\u5173\u7cfb\u3002\u4e0b\u9762\u6211\u4eec\u5bf9\u8fd9\u5757\u505a\u4e00\u4e2a\u6df1\u5165\u63a2\u7a76\u3002\n\nRedis \u7684\u6d88\u606f\u4ea4\u4e92\n--\n\u5f53\u6211\u4eec\u4f7f\u7528\u5ba2\u6237\u7aef\u5bf9 Redis \u8fdb\u884c\u4e00\u6b21\u64cd\u4f5c\u65f6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5ba2\u6237\u7aef\u5c06\u8bf7\u6c42\u4f20\u9001\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u5904\u7406\u5b8c\u6bd5\u540e\uff0c\u518d\u5c06\u54cd\u5e94\u56de\u590d\u7ed9\u5ba2\u6237\u7aef\u3002\u8fd9\u8981\u82b1\u8d39\u4e00\u4e2a\u7f51\u7edc\u6570\u636e\u5305\u6765\u56de\u7684\u65f6\u95f4\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/1648204d4930cc08?w=718&h=164&f=png&s=13399)\n\n\u5982\u679c\u8fde\u7eed\u6267\u884c\u591a\u6761\u6307\u4ee4\uff0c\u90a3\u5c31\u4f1a\u82b1\u8d39\u591a\u4e2a\u7f51\u7edc\u6570\u636e\u5305\u6765\u56de\u7684\u65f6\u95f4\u3002\u5982\u4e0b\u56fe\u6240\u793a\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/1648205b22725764?w=687&h=218&f=png&s=16830)\n\n\u56de\u5230\u5ba2\u6237\u7aef\u4ee3\u7801\u5c42\u9762\uff0c\u5ba2\u6237\u7aef\u662f\u7ecf\u5386\u4e86\u5199-\u8bfb-\u5199-\u8bfb\u56db\u4e2a\u64cd\u4f5c\u624d\u5b8c\u6574\u5730\u6267\u884c\u4e86\u4e24\u6761\u6307\u4ee4\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164820734e963482?w=722&h=83&f=png&s=7258)\n\n\u73b0\u5728\u5982\u679c\u6211\u4eec\u8c03\u6574\u8bfb\u5199\u987a\u5e8f\uff0c\u6539\u6210\u5199\u2014\u5199-\u8bfb-\u8bfb\uff0c\u8fd9\u4e24\u4e2a\u6307\u4ee4\u540c\u6837\u53ef\u4ee5\u6b63\u5e38\u5b8c\u6210\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16482078e3ea3ece?w=745&h=113&f=png&s=7829)\n\n\u4e24\u4e2a\u8fde\u7eed\u7684\u5199\u64cd\u4f5c\u548c\u4e24\u4e2a\u8fde\u7eed\u7684\u8bfb\u64cd\u4f5c\u603b\u5171\u53ea\u4f1a\u82b1\u8d39\u4e00\u6b21\u7f51\u7edc\u6765\u56de\uff0c\u5c31\u597d\u6bd4\u8fde\u7eed\u7684 write \u64cd\u4f5c\u5408\u5e76\u4e86\uff0c\u8fde\u7eed\u7684 read \u64cd\u4f5c\u4e5f\u5408\u5e76\u4e86\u4e00\u6837\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/1648209937f6d508?w=732&h=207&f=png&s=16994)\n\n\u8fd9\u4fbf\u662f\u7ba1\u9053\u64cd\u4f5c\u7684\u672c\u8d28\uff0c\u670d\u52a1\u5668\u6839\u672c\u6ca1\u6709\u4efb\u4f55\u533a\u522b\u5bf9\u5f85\uff0c\u8fd8\u662f\u6536\u5230\u4e00\u6761\u6d88\u606f\uff0c\u6267\u884c\u4e00\u6761\u6d88\u606f\uff0c\u56de\u590d\u4e00\u6761\u6d88\u606f\u7684\u6b63\u5e38\u7684\u6d41\u7a0b\u3002\u5ba2\u6237\u7aef\u901a\u8fc7\u5bf9\u7ba1\u9053\u4e2d\u7684\u6307\u4ee4\u5217\u8868\u6539\u53d8\u8bfb\u5199\u987a\u5e8f\u5c31\u53ef\u4ee5\u5927\u5e45\u8282\u7701 IO \u65f6\u95f4\u3002\u7ba1\u9053\u4e2d\u6307\u4ee4\u8d8a\u591a\uff0c\u6548\u679c\u8d8a\u597d\u3002\n\n\u7ba1\u9053\u538b\u529b\u6d4b\u8bd5\n--\n\u63a5\u4e0b\u6765\u6211\u4eec\u5b9e\u8df5\u4e00\u4e0b\u7ba1\u9053\u7684\u529b\u91cf\u3002\n\nRedis \u81ea\u5e26\u4e86\u4e00\u4e2a\u538b\u529b\u6d4b\u8bd5\u5de5\u5177```redis-benchmark```\uff0c\u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\u5c31\u53ef\u4ee5\u8fdb\u884c\u7ba1\u9053\u6d4b\u8bd5\u3002\n\n\u9996\u5148\u6211\u4eec\u5bf9\u4e00\u4e2a\u666e\u901a\u7684 set \u6307\u4ee4\u8fdb\u884c\u538b\u6d4b\uff0cQPS \u5927\u7ea6 5w/s\u3002\n```\n> redis-benchmark -t set -q\nSET: 51975.05 requests per second\n```\n\u6211\u4eec\u52a0\u5165\u7ba1\u9053\u9009\u9879```-P```\u53c2\u6570\uff0c\u5b83\u8868\u793a\u5355\u4e2a\u7ba1\u9053\u5185\u5e76\u884c\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u770b\u4e0b\u9762```P=2```\uff0cQPS \u8fbe\u5230\u4e86 9w/s\u3002\n```\n> redis-benchmark -t set -P 2 -q\nSET: 91240.88 requests per second\n```\n\u518d\u770b\u770b```P=3```\uff0cQPS \u8fbe\u5230\u4e86 10w/s\u3002\n```\nSET: 102354.15 requests per second\n```\n\u4f46\u5982\u679c\u518d\u7ee7\u7eed\u63d0\u5347 P \u53c2\u6570\uff0c\u53d1\u73b0 QPS \u5df2\u7ecf\u4e0a\u4e0d\u53bb\u4e86\u3002\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\n\n\u56e0\u4e3a\u8fd9\u91cc CPU \u5904\u7406\u80fd\u529b\u5df2\u7ecf\u8fbe\u5230\u4e86\u74f6\u9888\uff0cRedis \u7684\u5355\u7ebf\u7a0b CPU \u5df2\u7ecf\u98d9\u5230\u4e86 100%\uff0c\u6240\u4ee5\u65e0\u6cd5\u518d\u7ee7\u7eed\u63d0\u5347\u4e86\u3002\n\n\u6df1\u5165\u7406\u89e3\u7ba1\u9053\u672c\u8d28\n--\n\u63a5\u4e0b\u6765\u6211\u4eec\u6df1\u5165\u5206\u6790\u4e00\u4e2a\u8bf7\u6c42\u4ea4\u4e92\u7684\u6d41\u7a0b\uff0c\u771f\u5b9e\u7684\u60c5\u51b5\u662f\u5b83\u5f88\u590d\u6742\uff0c\u56e0\u4e3a\u8981\u7ecf\u8fc7\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u8fd9\u4e2a\u5c31\u5f97\u6df1\u5165\u5185\u6838\u4e86\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/8/28/1657e7a5a0a24ce3?w=1850&h=894&f=png&s=194143)\n\n\u4e0a\u56fe\u5c31\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u8bf7\u6c42\u4ea4\u4e92\u6d41\u7a0b\u56fe\u3002\u6211\u7528\u6587\u5b57\u6765\u4ed4\u7ec6\u63cf\u8ff0\u4e00\u904d\uff1a\n1. \u5ba2\u6237\u7aef\u8fdb\u7a0b\u8c03\u7528```write```\u5c06\u6d88\u606f\u5199\u5230\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u53d1\u9001\u7f13\u51b2```send buffer```\u3002\n2. \u5ba2\u6237\u7aef\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5c06\u53d1\u9001\u7f13\u51b2\u7684\u5185\u5bb9\u53d1\u9001\u5230\u7f51\u5361\uff0c\u7f51\u5361\u786c\u4ef6\u5c06\u6570\u636e\u901a\u8fc7\u300c\u7f51\u9645\u8def\u7531\u300d\u9001\u5230\u670d\u52a1\u5668\u7684\u7f51\u5361\u3002\n3. \u670d\u52a1\u5668\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5c06\u7f51\u5361\u7684\u6570\u636e\u653e\u5230\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u63a5\u6536\u7f13\u51b2```recv buffer```\u3002\n4. \u670d\u52a1\u5668\u8fdb\u7a0b\u8c03\u7528```read```\u4ece\u63a5\u6536\u7f13\u51b2\u4e2d\u53d6\u51fa\u6d88\u606f\u8fdb\u884c\u5904\u7406\u3002\n5. \u670d\u52a1\u5668\u8fdb\u7a0b\u8c03\u7528```write```\u5c06\u54cd\u5e94\u6d88\u606f\u5199\u5230\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u53d1\u9001\u7f13\u51b2```send buffer```\u3002\n6. \u670d\u52a1\u5668\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5c06\u53d1\u9001\u7f13\u51b2\u7684\u5185\u5bb9\u53d1\u9001\u5230\u7f51\u5361\uff0c\u7f51\u5361\u786c\u4ef6\u5c06\u6570\u636e\u901a\u8fc7\u300c\u7f51\u9645\u8def\u7531\u300d\u9001\u5230\u5ba2\u6237\u7aef\u7684\u7f51\u5361\u3002\n7. \u5ba2\u6237\u7aef\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5c06\u7f51\u5361\u7684\u6570\u636e\u653e\u5230\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u63a5\u6536\u7f13\u51b2```recv buffer```\u3002\n8. \u5ba2\u6237\u7aef\u8fdb\u7a0b\u8c03\u7528```read```\u4ece\u63a5\u6536\u7f13\u51b2\u4e2d\u53d6\u51fa\u6d88\u606f\u8fd4\u56de\u7ed9\u4e0a\u5c42\u4e1a\u52a1\u903b\u8f91\u8fdb\u884c\u5904\u7406\u3002\n9. \u7ed3\u675f\u3002\n\n\u5176\u4e2d\u6b65\u9aa4 5~8 \u548c 1~4 \u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u8fc7\u65b9\u5411\u662f\u53cd\u8fc7\u6765\u7684\uff0c\u4e00\u4e2a\u662f\u8bf7\u6c42\uff0c\u4e00\u4e2a\u662f\u54cd\u5e94\u3002\n\n\u6211\u4eec\u5f00\u59cb\u4ee5\u4e3a `write` \u64cd\u4f5c\u662f\u8981\u7b49\u5230\u5bf9\u65b9\u6536\u5230\u6d88\u606f\u624d\u4f1a\u8fd4\u56de\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e0d\u662f\u8fd9\u6837\u7684\u3002`write` \u64cd\u4f5c\u53ea\u8d1f\u8d23\u5c06\u6570\u636e\u5199\u5230\u672c\u5730\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u53d1\u9001\u7f13\u51b2\u7136\u540e\u5c31\u8fd4\u56de\u4e86\u3002\u5269\u4e0b\u7684\u4e8b\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5f02\u6b65\u5c06\u6570\u636e\u9001\u5230\u76ee\u6807\u673a\u5668\u3002\u4f46\u662f\u5982\u679c\u53d1\u9001\u7f13\u51b2\u6ee1\u4e86\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7b49\u5f85\u7f13\u51b2\u7a7a\u51fa\u7a7a\u95f2\u7a7a\u95f4\u6765\uff0c\u8fd9\u4e2a\u5c31\u662f\u5199\u64cd\u4f5c IO \u64cd\u4f5c\u7684\u771f\u6b63\u8017\u65f6\u3002\n\n\u6211\u4eec\u5f00\u59cb\u4ee5\u4e3a `read` \u64cd\u4f5c\u662f\u4ece\u76ee\u6807\u673a\u5668\u62c9\u53d6\u6570\u636e\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e0d\u662f\u8fd9\u6837\u7684\u3002`read` \u64cd\u4f5c\u53ea\u8d1f\u8d23\u5c06\u6570\u636e\u4ece\u672c\u5730\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u63a5\u6536\u7f13\u51b2\u4e2d\u53d6\u51fa\u6765\u5c31\u4e86\u4e8b\u4e86\u3002\u4f46\u662f\u5982\u679c\u7f13\u51b2\u662f\u7a7a\u7684\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7b49\u5f85\u6570\u636e\u5230\u6765\uff0c\u8fd9\u4e2a\u5c31\u662f\u8bfb\u64cd\u4f5c IO \u64cd\u4f5c\u7684\u771f\u6b63\u8017\u65f6\u3002\n\n\u6240\u4ee5\u5bf9\u4e8e```value = redis.get(key)```\u8fd9\u6837\u4e00\u4e2a\u7b80\u5355\u7684\u8bf7\u6c42\u6765\u8bf4\uff0c```write```\u64cd\u4f5c\u51e0\u4e4e\u6ca1\u6709\u8017\u65f6\uff0c\u76f4\u63a5\u5199\u5230\u53d1\u9001\u7f13\u51b2\u5c31\u8fd4\u56de\uff0c\u800c```read```\u5c31\u4f1a\u6bd4\u8f83\u8017\u65f6\u4e86\uff0c\u56e0\u4e3a\u5b83\u8981\u7b49\u5f85\u6d88\u606f\u7ecf\u8fc7\u7f51\u7edc\u8def\u7531\u5230\u76ee\u6807\u673a\u5668\u5904\u7406\u540e\u7684\u54cd\u5e94\u6d88\u606f,\u518d\u56de\u9001\u5230\u5f53\u524d\u7684\u5185\u6838\u8bfb\u7f13\u51b2\u624d\u53ef\u4ee5\u8fd4\u56de\u3002**\u8fd9\u624d\u662f\u4e00\u4e2a\u7f51\u7edc\u6765\u56de\u7684\u771f\u6b63\u5f00\u9500**\u3002\n\n\u800c\u5bf9\u4e8e\u7ba1\u9053\u6765\u8bf4\uff0c\u8fde\u7eed\u7684```write```\u64cd\u4f5c\u6839\u672c\u5c31\u6ca1\u6709\u8017\u65f6\uff0c\u4e4b\u540e\u7b2c\u4e00\u4e2a```read```\u64cd\u4f5c\u4f1a\u7b49\u5f85\u4e00\u4e2a\u7f51\u7edc\u7684\u6765\u56de\u5f00\u9500\uff0c\u7136\u540e\u6240\u6709\u7684\u54cd\u5e94\u6d88\u606f\u5c31\u90fd\u5df2\u7ecf\u56de\u9001\u5230\u5185\u6838\u7684\u8bfb\u7f13\u51b2\u4e86\uff0c\u540e\u7eed\u7684 `read` \u64cd\u4f5c\u76f4\u63a5\u5c31\u53ef\u4ee5\u4ece\u7f13\u51b2\u62ff\u5230\u7ed3\u679c\uff0c\u77ac\u95f4\u5c31\u8fd4\u56de\u4e86\u3002\n\n## \u5c0f\u7ed3\n\n\u8fd9\u5c31\u662f\u7ba1\u9053\u7684\u672c\u8d28\u4e86\uff0c\u5b83\u5e76\u4e0d\u662f\u670d\u52a1\u5668\u7684\u4ec0\u4e48\u7279\u6027\uff0c\u800c\u662f\u5ba2\u6237\u7aef\u901a\u8fc7\u6539\u53d8\u4e86\u8bfb\u5199\u7684\u987a\u5e8f\u5e26\u6765\u7684\u6027\u80fd\u7684\u5de8\u5927\u63d0\u5347\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/14\u539f\u7406_4\u96f7\u5389\u98ce\u884c__\u7ba1\u9053.md", "create_date": "2020-02-18T03:01:05.660", "order": 15}}, {"model": "subject.chapter", "pk": 23, "fields": {"title": "19\u96c6\u7fa4 1\uff1a\u674e\u4ee3\u6843\u50f5 \u2014\u2014 Sentinel", "topic": 2, "md5": "25269a261001077f38b8e0c6a0213409", "md_body": "# \u96c6\u7fa4 1\uff1a\u674e\u4ee3\u6843\u50f5 \u2014\u2014 Sentinel\n\n\u76ee\u524d\u6211\u4eec\u8bb2\u7684 Redis \u8fd8\u53ea\u662f\u4e3b\u4ece\u65b9\u6848\uff0c\u6700\u7ec8\u4e00\u81f4\u6027\u3002\u8bfb\u8005\u4eec\u53ef\u601d\u8003\u8fc7\uff0c\u5982\u679c\u4e3b\u8282\u70b9\u51cc\u6668 3 \u70b9\u7a81\u53d1\u5b95\u673a\u600e\u4e48\u529e\uff1f\u5c31\u5750\u7b49\u8fd0\u7ef4\u4ece\u5e8a\u4e0a\u722c\u8d77\u6765\uff0c\u7136\u540e\u624b\u5de5\u8fdb\u884c\u4ece\u4e3b\u5207\u6362\uff0c\u518d\u901a\u77e5\u6240\u6709\u7684\u7a0b\u5e8f\u628a\u5730\u5740\u7edf\u7edf\u6539\u4e00\u904d\u91cd\u65b0\u4e0a\u7ebf\u4e48\uff1f\u6beb\u65e0\u7591\u95ee\uff0c\u8fd9\u6837\u7684\u4eba\u5de5\u8fd0\u7ef4\u6548\u7387\u592a\u4f4e\uff0c\u4e8b\u6545\u53d1\u751f\u65f6\u4f30\u8ba1\u5f97\u81f3\u5c11 1 \u4e2a\u5c0f\u65f6\u624d\u80fd\u7f13\u8fc7\u6765\u3002\u5982\u679c\u662f\u4e00\u4e2a\u5927\u578b\u516c\u53f8\uff0c\u8fd9\u6837\u7684\u4e8b\u6545\u8db3\u4ee5\u4e0a\u65b0\u95fb\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/11/164879368601d822?w=275&h=144&f=png&s=14038)\n\n\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u6709\u4e00\u4e2a\u9ad8\u53ef\u7528\u65b9\u6848\u6765\u62b5\u6297\u8282\u70b9\u6545\u969c\uff0c\u5f53\u6545\u969c\u53d1\u751f\u65f6\u53ef\u4ee5\u81ea\u52a8\u8fdb\u884c\u4ece\u4e3b\u5207\u6362\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u4e0d\u7528\u91cd\u542f\uff0c\u8fd0\u7ef4\u53ef\u4ee5\u7ee7\u7eed\u7761\u5927\u89c9\uff0c\u4eff\u4f5b\u4ec0\u4e48\u4e8b\u4e5f\u6ca1\u53d1\u751f\u4e00\u6837\u3002Redis \u5b98\u65b9\u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u79cd\u65b9\u6848 \u2014\u2014 Redis Sentinel(\u54e8\u5175)\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/16464072b3430480?w=719&h=404&f=png&s=38461)\n\n\u6211\u4eec\u53ef\u4ee5\u5c06 Redis Sentinel \u96c6\u7fa4\u770b\u6210\u662f\u4e00\u4e2a ZooKeeper \u96c6\u7fa4\uff0c\u5b83\u662f\u96c6\u7fa4\u9ad8\u53ef\u7528\u7684\u5fc3\u810f\uff0c\u5b83\u4e00\u822c\u662f\u7531 3\uff5e5 \u4e2a\u8282\u70b9\u7ec4\u6210\uff0c\u8fd9\u6837\u6302\u4e86\u4e2a\u522b\u8282\u70b9\u96c6\u7fa4\u8fd8\u53ef\u4ee5\u6b63\u5e38\u8fd0\u8f6c\u3002\n\n\u5b83\u8d1f\u8d23\u6301\u7eed\u76d1\u63a7\u4e3b\u4ece\u8282\u70b9\u7684\u5065\u5eb7\uff0c\u5f53\u4e3b\u8282\u70b9\u6302\u6389\u65f6\uff0c\u81ea\u52a8\u9009\u62e9\u4e00\u4e2a\u6700\u4f18\u7684\u4ece\u8282\u70b9\u5207\u6362\u4e3a\u4e3b\u8282\u70b9\u3002\u5ba2\u6237\u7aef\u6765\u8fde\u63a5\u96c6\u7fa4\u65f6\uff0c\u4f1a\u9996\u5148\u8fde\u63a5 sentinel\uff0c\u901a\u8fc7 sentinel \u6765\u67e5\u8be2\u4e3b\u8282\u70b9\u7684\u5730\u5740\uff0c\u7136\u540e\u518d\u53bb\u8fde\u63a5\u4e3b\u8282\u70b9\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u3002\u5f53\u4e3b\u8282\u70b9\u53d1\u751f\u6545\u969c\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u91cd\u65b0\u5411 sentinel \u8981\u5730\u5740\uff0csentinel \u4f1a\u5c06\u6700\u65b0\u7684\u4e3b\u8282\u70b9\u5730\u5740\u544a\u8bc9\u5ba2\u6237\u7aef\u3002\u5982\u6b64\u5e94\u7528\u7a0b\u5e8f\u5c06\u65e0\u9700\u91cd\u542f\u5373\u53ef\u81ea\u52a8\u5b8c\u6210\u8282\u70b9\u5207\u6362\u3002\u6bd4\u5982\u4e0a\u56fe\u7684\u4e3b\u8282\u70b9\u6302\u6389\u540e\uff0c\u96c6\u7fa4\u5c06\u53ef\u80fd\u81ea\u52a8\u8c03\u6574\u4e3a\u4e0b\u56fe\u6240\u793a\u7ed3\u6784\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/164640d92239dacf?w=806&h=464&f=png&s=52086)\n\n\u4ece\u8fd9\u5f20\u56fe\u4e2d\u6211\u4eec\u80fd\u770b\u5230\u4e3b\u8282\u70b9\u6302\u6389\u4e86\uff0c\u539f\u5148\u7684\u4e3b\u4ece\u590d\u5236\u4e5f\u65ad\u5f00\u4e86\uff0c\u5ba2\u6237\u7aef\u548c\u635f\u574f\u7684\u4e3b\u8282\u70b9\u4e5f\u65ad\u5f00\u4e86\u3002\u4ece\u8282\u70b9\u88ab\u63d0\u5347\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u5176\u5b83\u4ece\u8282\u70b9\u5f00\u59cb\u548c\u65b0\u7684\u4e3b\u8282\u70b9\u5efa\u7acb\u590d\u5236\u5173\u7cfb\u3002\u5ba2\u6237\u7aef\u901a\u8fc7\u65b0\u7684\u4e3b\u8282\u70b9\u7ee7\u7eed\u8fdb\u884c\u4ea4\u4e92\u3002Sentinel \u4f1a\u6301\u7eed\u76d1\u63a7\u5df2\u7ecf\u6302\u6389\u4e86\u4e3b\u8282\u70b9\uff0c\u5f85\u5b83\u6062\u590d\u540e\uff0c\u96c6\u7fa4\u4f1a\u8c03\u6574\u4e3a\u4e0b\u9762\u8fd9\u5f20\u56fe\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/1646410c0581795a?w=730&h=420&f=png&s=42217)\n\n\u6b64\u65f6\u539f\u5148\u6302\u6389\u7684\u4e3b\u8282\u70b9\u73b0\u5728\u53d8\u6210\u4e86\u4ece\u8282\u70b9\uff0c\u4ece\u65b0\u7684\u4e3b\u8282\u70b9\u90a3\u91cc\u5efa\u7acb\u590d\u5236\u5173\u7cfb\u3002\n\n\u6d88\u606f\u4e22\u5931\n--\nRedis \u4e3b\u4ece\u91c7\u7528\u5f02\u6b65\u590d\u5236\uff0c\u610f\u5473\u7740\u5f53\u4e3b\u8282\u70b9\u6302\u6389\u65f6\uff0c\u4ece\u8282\u70b9\u53ef\u80fd\u6ca1\u6709\u6536\u5230\u5168\u90e8\u7684\u540c\u6b65\u6d88\u606f\uff0c\u8fd9\u90e8\u5206\u672a\u540c\u6b65\u7684\u6d88\u606f\u5c31\u4e22\u5931\u4e86\u3002\u5982\u679c\u4e3b\u4ece\u5ef6\u8fdf\u7279\u522b\u5927\uff0c\u90a3\u4e48\u4e22\u5931\u7684\u6570\u636e\u5c31\u53ef\u80fd\u4f1a\u7279\u522b\u591a\u3002Sentinel \u65e0\u6cd5\u4fdd\u8bc1\u6d88\u606f\u5b8c\u5168\u4e0d\u4e22\u5931\uff0c\u4f46\u662f\u4e5f\u5c3d\u53ef\u80fd\u4fdd\u8bc1\u6d88\u606f\u5c11\u4e22\u5931\u3002\u5b83\u6709\u4e24\u4e2a\u9009\u9879\u53ef\u4ee5\u9650\u5236\u4e3b\u4ece\u5ef6\u8fdf\u8fc7\u5927\u3002\n```\nmin-slaves-to-write 1\nmin-slaves-max-lag 10\n```\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u4e3b\u8282\u70b9\u5fc5\u987b\u81f3\u5c11\u6709\u4e00\u4e2a\u4ece\u8282\u70b9\u5728\u8fdb\u884c\u6b63\u5e38\u590d\u5236\uff0c\u5426\u5219\u5c31\u505c\u6b62\u5bf9\u5916\u5199\u670d\u52a1\uff0c\u4e27\u5931\u53ef\u7528\u6027\u3002\n\n\u4f55\u4e3a\u6b63\u5e38\u590d\u5236\uff0c\u4f55\u4e3a\u5f02\u5e38\u590d\u5236\uff1f\u8fd9\u4e2a\u5c31\u662f\u7531\u7b2c\u4e8c\u4e2a\u53c2\u6570\u63a7\u5236\u7684\uff0c\u5b83\u7684\u5355\u4f4d\u662f\u79d2\uff0c\u8868\u793a\u5982\u679c 10s \u6ca1\u6709\u6536\u5230\u4ece\u8282\u70b9\u7684\u53cd\u9988\uff0c\u5c31\u610f\u5473\u7740\u4ece\u8282\u70b9\u540c\u6b65\u4e0d\u6b63\u5e38\uff0c\u8981\u4e48\u7f51\u7edc\u65ad\u5f00\u4e86\uff0c\u8981\u4e48\u4e00\u76f4\u6ca1\u6709\u7ed9\u53cd\u9988\u3002\n\nSentinel \u57fa\u672c\u4f7f\u7528\n--\n\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u5ba2\u6237\u7aef\u5982\u4f55\u4f7f\u7528 sentinel\uff0c\u6807\u51c6\u7684\u6d41\u7a0b\u5e94\u8be5\u662f\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7 sentinel \u53d1\u73b0\u4e3b\u4ece\u8282\u70b9\u7684\u5730\u5740\uff0c\u7136\u540e\u5728\u901a\u8fc7\u8fd9\u4e9b\u5730\u5740\u5efa\u7acb\u76f8\u5e94\u7684\u8fde\u63a5\u6765\u8fdb\u884c\u6570\u636e\u5b58\u53d6\u64cd\u4f5c\u3002\u6211\u4eec\u6765\u770b\u770b Python \u5ba2\u6237\u7aef\u662f\u5982\u4f55\u505a\u7684\u3002\n\n```\n>>> from redis.sentinel import Sentinel\n>>> sentinel = Sentinel([('localhost', 26379)], socket_timeout=0.1)\n>>> sentinel.discover_master('mymaster')\n('127.0.0.1', 6379)\n>>> sentinel.discover_slaves('mymaster')\n[('127.0.0.1', 6380)]\n```\nsentinel \u7684\u9ed8\u8ba4\u7aef\u53e3\u662f 26379\uff0c\u4e0d\u540c\u4e8e Redis \u7684\u9ed8\u8ba4\u7aef\u53e3 6379\uff0c\u901a\u8fc7 sentinel \u5bf9\u8c61\u7684 discover_xxx \u65b9\u6cd5\u53ef\u4ee5\u53d1\u73b0\u4e3b\u4ece\u5730\u5740\uff0c\u4e3b\u5730\u5740\u53ea\u6709\u4e00\u4e2a\uff0c\u4ece\u5730\u5740\u53ef\u4ee5\u6709\u591a\u4e2a\u3002\n```\n>>> master = sentinel.master_for('mymaster', socket_timeout=0.1)\n>>> slave = sentinel.slave_for('mymaster', socket_timeout=0.1)\n>>> master.set('foo', 'bar')\n>>> slave.get('foo')\n'bar'\n```\n\u901a\u8fc7 xxx_for \u65b9\u6cd5\u53ef\u4ee5\u4ece\u8fde\u63a5\u6c60\u4e2d\u62ff\u51fa\u4e00\u4e2a\u8fde\u63a5\u6765\u4f7f\u7528\uff0c\u56e0\u4e3a\u4ece\u5730\u5740\u6709\u591a\u4e2a\uff0credis \u5ba2\u6237\u7aef\u5bf9\u4ece\u5730\u5740\u91c7\u7528\u8f6e\u8be2\u65b9\u6848\uff0c\u4e5f\u5c31\u662f RoundRobin \u8f6e\u7740\u6765\u3002\n\n\u6709\u4e2a\u95ee\u9898\u662f\uff0c\u4f46 sentinel \u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u65f6\uff0c\u5ba2\u6237\u7aef\u5982\u4f55\u77e5\u9053\u5730\u5740\u53d8\u66f4\u4e86 ? \u901a\u8fc7\u5206\u6790\u6e90\u7801\uff0c\u6211\u53d1\u73b0 redis-py \u5728\u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\u8fdb\u884c\u4e86\u4e3b\u5e93\u5730\u5740\u53d8\u66f4\u5224\u65ad\u3002\n\n\u8fde\u63a5\u6c60\u5efa\u7acb\u65b0\u8fde\u63a5\u65f6\uff0c\u4f1a\u53bb\u67e5\u8be2\u4e3b\u5e93\u5730\u5740\uff0c\u7136\u540e\u8ddf\u5185\u5b58\u4e2d\u7684\u4e3b\u5e93\u5730\u5740\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u53d8\u66f4\u4e86\uff0c\u5c31\u65ad\u5f00\u6240\u6709\u8fde\u63a5\uff0c\u91cd\u65b0\u4f7f\u7528\u65b0\u5730\u5740\u5efa\u7acb\u65b0\u8fde\u63a5\u3002\u5982\u679c\u662f\u65e7\u7684\u4e3b\u5e93\u6302\u6389\u4e86\uff0c\u90a3\u4e48\u6240\u6709\u6b63\u5728\u4f7f\u7528\u7684\u8fde\u63a5\u90fd\u4f1a\u88ab\u5173\u95ed\uff0c\u7136\u540e\u5728\u91cd\u8fde\u65f6\u5c31\u4f1a\u7528\u4e0a\u65b0\u5730\u5740\u3002\n\n\u4f46\u662f\u8fd9\u6837\u8fd8\u4e0d\u591f\uff0c\u5982\u679c\u662f sentinel \u4e3b\u52a8\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u4e3b\u5e93\u5e76\u6ca1\u6709\u6302\u6389\uff0c\u800c\u4e4b\u524d\u7684\u4e3b\u5e93\u8fde\u63a5\u5df2\u7ecf\u5efa\u7acb\u4e86\u5728\u4f7f\u7528\u4e86\uff0c\u6ca1\u6709\u65b0\u8fde\u63a5\u9700\u8981\u5efa\u7acb\uff0c\u90a3\u8fd9\u4e2a\u8fde\u63a5\u662f\u4e0d\u662f\u4e00\u81f4\u5207\u6362\u4e0d\u4e86\uff1f\n\n\u7ee7\u7eed\u6df1\u5165\u7814\u7a76\u6e90\u7801\uff0c\u6211\u53d1\u73b0 redis-py \u5728\u53e6\u5916\u4e00\u4e2a\u70b9\u4e5f\u505a\u4e86\u63a7\u5236\u3002\u90a3\u5c31\u662f\u5728\u5904\u7406\u547d\u4ee4\u7684\u65f6\u5019\u6355\u83b7\u4e86\u4e00\u4e2a\u7279\u6b8a\u7684\u5f02\u5e38```ReadOnlyError```\uff0c\u5728\u8fd9\u4e2a\u5f02\u5e38\u91cc\u5c06\u6240\u6709\u7684\u65e7\u8fde\u63a5\u5168\u90e8\u5173\u95ed\u4e86\uff0c\u540e\u7eed\u6307\u4ee4\u5c31\u4f1a\u8fdb\u884c\u91cd\u8fde\u3002\n\n\u4e3b\u4ece\u5207\u6362\u540e\uff0c\u4e4b\u524d\u7684\u4e3b\u5e93\u88ab\u964d\u7ea7\u5230\u4ece\u5e93\uff0c\u6240\u6709\u7684\u4fee\u6539\u6027\u7684\u6307\u4ee4\u90fd\u4f1a\u629b\u51fa```ReadonlyError```\u3002\u5982\u679c\u6ca1\u6709\u4fee\u6539\u6027\u6307\u4ee4\uff0c\u867d\u7136\u8fde\u63a5\u4e0d\u4f1a\u5f97\u5230\u5207\u6362\uff0c\u4f46\u662f\u6570\u636e\u4e0d\u4f1a\u88ab\u7834\u574f\uff0c\u6240\u4ee5\u5373\u4f7f\u4e0d\u5207\u6362\u4e5f\u6ca1\u5173\u7cfb\u3002\n\n\u4f5c\u4e1a\n--\n1. \u5c1d\u8bd5\u81ea\u5df1\u642d\u5efa\u4e00\u5957 redis-sentinel \u96c6\u7fa4\uff1b\n2. \u4f7f\u7528 Python \u6216\u8005 Java \u7684\u5ba2\u6237\u7aef\u5bf9\u96c6\u7fa4\u8fdb\u884c\u4e00\u4e9b\u5e38\u89c4\u64cd\u4f5c\uff1b\n3. \u8bd5\u8bd5\u4e3b\u4ece\u5207\u6362\uff0c\u4e3b\u52a8\u5207\u6362\u548c\u88ab\u52a8\u5207\u6362\u90fd\u8bd5\u4e00\u8bd5\uff0c\u770b\u770b\u5ba2\u6237\u7aef\u80fd\u5426\u6b63\u5e38\u5207\u6362\u8fde\u63a5\uff1b", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/19\u96c6\u7fa4_1\u674e\u4ee3\u6843\u50f5__Sentinel.md", "create_date": "2020-02-18T03:01:05.692", "order": 20}}, {"model": "subject.chapter", "pk": 24, "fields": {"title": "15\u539f\u7406 5\uff1a\u540c\u821f\u5171\u6d4e \u2014\u2014 \u4e8b\u52a1", "topic": 2, "md5": "7af3065554e775139a2847eb8e5087b6", "md_body": "# \u539f\u7406 5\uff1a\u540c\u821f\u5171\u6d4e \u2014\u2014 \u4e8b\u52a1\n\n\u4e3a\u4e86\u786e\u4fdd\u8fde\u7eed\u591a\u4e2a\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u4e00\u4e2a\u6210\u719f\u7684\u6570\u636e\u5e93\u901a\u5e38\u90fd\u4f1a\u6709\u4e8b\u52a1\u652f\u6301\uff0cRedis \u4e5f\u4e0d\u4f8b\u5916\u3002Redis \u7684\u4e8b\u52a1\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u4e0d\u540c\u4e8e\u5173\u7cfb\u6570\u636e\u5e93\uff0c\u6211\u4eec\u65e0\u987b\u7406\u89e3\u90a3\u4e48\u591a\u590d\u6742\u7684\u4e8b\u52a1\u6a21\u578b\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002\u4e0d\u8fc7\u4e5f\u6b63\u662f\u56e0\u4e3a\u8fd9\u79cd\u7b80\u5355\u6027\uff0c\u5b83\u7684\u4e8b\u52a1\u6a21\u578b\u5f88\u4e0d\u4e25\u683c\uff0c\u8fd9\u8981\u6c42\u6211\u4eec\u4e0d\u80fd\u50cf\u4f7f\u7528\u5173\u7cfb\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u4e00\u6837\u6765\u4f7f\u7528 Redis\u3002\n\nRedis \u4e8b\u52a1\u7684\u57fa\u672c\u4f7f\u7528\n--\n\u6bcf\u4e2a\u4e8b\u52a1\u7684\u64cd\u4f5c\u90fd\u6709 begin\u3001commit \u548c rollback\uff0cbegin \u6307\u793a\u4e8b\u52a1\u7684\u5f00\u59cb\uff0ccommit \u6307\u793a\u4e8b\u52a1\u7684\u63d0\u4ea4\uff0crollback \u6307\u793a\u4e8b\u52a1\u7684\u56de\u6eda\u3002\u5b83\u5927\u81f4\u7684\u5f62\u5f0f\u5982\u4e0b\u3002\n```java\nbegin();\ntry {\n    command1();\n    command2();\n    ....\n    commit();\n} catch(Exception e) {\n    rollback();\n}\n```\nRedis \u5728\u5f62\u5f0f\u4e0a\u770b\u8d77\u6765\u4e5f\u5dee\u4e0d\u591a\uff0c\u5206\u522b\u662f multi/exec/discard\u3002multi \u6307\u793a\u4e8b\u52a1\u7684\u5f00\u59cb\uff0cexec \u6307\u793a\u4e8b\u52a1\u7684\u6267\u884c\uff0cdiscard \u6307\u793a\u4e8b\u52a1\u7684\u4e22\u5f03\u3002\n```\n> multi\nOK\n> incr books\nQUEUED\n> incr books\nQUEUED\n> exec\n(integer) 1\n(integer) 2\n```\n\u4e0a\u9762\u7684\u6307\u4ee4\u6f14\u793a\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684\u4e8b\u52a1\u8fc7\u7a0b\uff0c\u6240\u6709\u7684\u6307\u4ee4\u5728 exec \u4e4b\u524d\u4e0d\u6267\u884c\uff0c\u800c\u662f\u7f13\u5b58\u5728\u670d\u52a1\u5668\u7684\u4e00\u4e2a\u4e8b\u52a1\u961f\u5217\u4e2d\uff0c\u670d\u52a1\u5668\u4e00\u65e6\u6536\u5230 exec \u6307\u4ee4\uff0c\u624d\u5f00\u6267\u884c\u6574\u4e2a\u4e8b\u52a1\u961f\u5217\uff0c\u6267\u884c\u5b8c\u6bd5\u540e\u4e00\u6b21\u6027\u8fd4\u56de\u6240\u6709\u6307\u4ee4\u7684\u8fd0\u884c\u7ed3\u679c\u3002\u56e0\u4e3a Redis \u7684\u5355\u7ebf\u7a0b\u7279\u6027\uff0c\u5b83\u4e0d\u7528\u62c5\u5fc3\u81ea\u5df1\u5728\u6267\u884c\u961f\u5217\u7684\u65f6\u5019\u88ab\u5176\u5b83\u6307\u4ee4\u6253\u6405\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u4ed6\u4eec\u80fd\u5f97\u5230\u7684\u300c\u539f\u5b50\u6027\u300d\u6267\u884c\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/1648203d1d8ec347?w=810&h=386&f=png&s=26366)\n\u4e0a\u56fe\u663e\u793a\u4e86\u4ee5\u4e0a\u4e8b\u52a1\u8fc7\u7a0b\u5b8c\u6574\u7684\u4ea4\u4e92\u6548\u679c\u3002QUEUED \u662f\u4e00\u4e2a\u7b80\u5355\u5b57\u7b26\u4e32\uff0c\u540c OK \u662f\u4e00\u4e2a\u5f62\u5f0f\uff0c\u5b83\u8868\u793a\u6307\u4ee4\u5df2\u7ecf\u88ab\u670d\u52a1\u5668\u7f13\u5b58\u5230\u961f\u5217\u91cc\u4e86\u3002\n\n\u539f\u5b50\u6027\n--\n\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u662f\u6307\u8981\u4e48\u4e8b\u52a1\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\uff0c\u90a3\u4e48 Redis \u4e8b\u52a1\u6267\u884c\u662f\u539f\u5b50\u6027\u7684\u4e48\uff1f\n\n\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u7279\u522b\u7684\u4f8b\u5b50\u3002\n```\n> multi\nOK\n> set books iamastring\nQUEUED\n> incr books\nQUEUED\n> set poorman iamdesperate\nQUEUED\n> exec\n1) OK\n2) (error) ERR value is not an integer or out of range\n3) OK\n> get books\n\"iamastring\"\n>  get poorman\n\"iamdesperate\n```\n\u4e0a\u9762\u7684\u4f8b\u5b50\u662f\u4e8b\u52a1\u6267\u884c\u5230\u4e2d\u95f4\u9047\u5230\u5931\u8d25\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u4e0d\u80fd\u5bf9\u4e00\u4e2a\u5b57\u7b26\u4e32\u8fdb\u884c\u6570\u5b66\u8fd0\u7b97\uff0c\u4e8b\u52a1\u5728\u9047\u5230\u6307\u4ee4\u6267\u884c\u5931\u8d25\u540e\uff0c\u540e\u9762\u7684\u6307\u4ee4\u8fd8\u7ee7\u7eed\u6267\u884c\uff0c\u6240\u4ee5 poorman \u7684\u503c\u80fd\u7ee7\u7eed\u5f97\u5230\u8bbe\u7f6e\u3002\n\n\u5230\u8fd9\u91cc\uff0c\u4f60\u5e94\u8be5\u660e\u767d Redis \u7684\u4e8b\u52a1\u6839\u672c\u4e0d\u80fd\u7b97\u300c\u539f\u5b50\u6027\u300d\uff0c\u800c\u4ec5\u4ec5\u662f\u6ee1\u8db3\u4e86\u4e8b\u52a1\u7684\u300c\u9694\u79bb\u6027\u300d\uff0c\u9694\u79bb\u6027\u4e2d\u7684\u4e32\u884c\u5316\u2014\u2014\u5f53\u524d\u6267\u884c\u7684\u4e8b\u52a1\u6709\u7740\u4e0d\u88ab\u5176\u5b83\u4e8b\u52a1\u6253\u65ad\u7684\u6743\u5229\u3002\n\ndiscard(\u4e22\u5f03)\n--\nRedis \u4e3a\u4e8b\u52a1\u63d0\u4f9b\u4e86\u4e00\u4e2a discard \u6307\u4ee4\uff0c\u7528\u4e8e\u4e22\u5f03\u4e8b\u52a1\u7f13\u5b58\u961f\u5217\u4e2d\u7684\u6240\u6709\u6307\u4ee4\uff0c\u5728 exec \u6267\u884c\u4e4b\u524d\u3002\n```\n> get books\n(nil)\n> multi\nOK\n> incr books\nQUEUED\n> incr books\nQUEUED\n> discard\nOK\n> get books\n(nil)\n```\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230 discard \u4e4b\u540e\uff0c\u961f\u5217\u4e2d\u7684\u6240\u6709\u6307\u4ee4\u90fd\u6ca1\u6267\u884c\uff0c\u5c31\u597d\u50cf multi \u548c discard \u4e2d\u95f4\u7684\u6240\u6709\u6307\u4ee4\u4ece\u672a\u53d1\u751f\u8fc7\u4e00\u6837\u3002\n\n\u4f18\u5316\n--\n\u4e0a\u9762\u7684 Redis \u4e8b\u52a1\u5728\u53d1\u9001\u6bcf\u4e2a\u6307\u4ee4\u5230\u4e8b\u52a1\u7f13\u5b58\u961f\u5217\u65f6\u90fd\u8981\u7ecf\u8fc7\u4e00\u6b21\u7f51\u7edc\u8bfb\u5199\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5185\u90e8\u7684\u6307\u4ee4\u8f83\u591a\u65f6\uff0c\u9700\u8981\u7684\u7f51\u7edc IO \u65f6\u95f4\u4e5f\u4f1a\u7ebf\u6027\u589e\u957f\u3002\u6240\u4ee5\u901a\u5e38 Redis \u7684\u5ba2\u6237\u7aef\u5728\u6267\u884c\u4e8b\u52a1\u65f6\u90fd\u4f1a\u7ed3\u5408 pipeline \u4e00\u8d77\u4f7f\u7528\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c06\u591a\u6b21 IO \u64cd\u4f5c\u538b\u7f29\u4e3a\u5355\u6b21 IO \u64cd\u4f5c\u3002\u6bd4\u5982\u6211\u4eec\u5728\u4f7f\u7528 Python \u7684 Redis \u5ba2\u6237\u7aef\u65f6\u6267\u884c\u4e8b\u52a1\u65f6\u662f\u8981\u5f3a\u5236\u4f7f\u7528 pipeline \u7684\u3002\n```py\npipe = redis.pipeline(transaction=true)\npipe.multi()\npipe.incr(\"books\")\npipe.incr(\"books\")\nvalues = pipe.execute()\n```\n\nWatch\n--\n\u8003\u8651\u5230\u4e00\u4e2a\u4e1a\u52a1\u573a\u666f\uff0cRedis \u5b58\u50a8\u4e86\u6211\u4eec\u7684\u8d26\u6237\u4f59\u989d\u6570\u636e\uff0c\u5b83\u662f\u4e00\u4e2a\u6574\u6570\u3002\u73b0\u5728\u6709\u4e24\u4e2a\u5e76\u53d1\u7684\u5ba2\u6237\u7aef\u8981\u5bf9\u8d26\u6237\u4f59\u989d\u8fdb\u884c\u4fee\u6539\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u4fee\u6539\u4e0d\u662f\u4e00\u4e2a\u7b80\u5355\u7684 incrby \u6307\u4ee4\uff0c\u800c\u662f\u8981\u5bf9\u4f59\u989d\u4e58\u4ee5\u4e00\u4e2a\u500d\u6570\u3002Redis \u53ef\u6ca1\u6709\u63d0\u4f9b multiplyby \u8fd9\u6837\u7684\u6307\u4ee4\u3002\u6211\u4eec\u9700\u8981\u5148\u53d6\u51fa\u4f59\u989d\u7136\u540e\u5728\u5185\u5b58\u91cc\u4e58\u4ee5\u500d\u6570\uff0c\u518d\u5c06\u7ed3\u679c\u5199\u56de Redis\u3002\n\n\u8fd9\u5c31\u4f1a\u51fa\u73b0\u5e76\u53d1\u95ee\u9898\uff0c\u56e0\u4e3a\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u4f1a\u5e76\u53d1\u8fdb\u884c\u64cd\u4f5c\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Redis \u7684\u5206\u5e03\u5f0f\u9501\u6765\u907f\u514d\u51b2\u7a81\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002**\u5206\u5e03\u5f0f\u9501\u662f\u4e00\u79cd\u60b2\u89c2\u9501\uff0c\u90a3\u662f\u4e0d\u662f\u53ef\u4ee5\u4f7f\u7528\u4e50\u89c2\u9501\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u51b2\u7a81\u5462\uff1f**\n\nRedis \u63d0\u4f9b\u4e86\u8fd9\u79cd watch \u7684\u673a\u5236\uff0c\u5b83\u5c31\u662f\u4e00\u79cd\u4e50\u89c2\u9501\u3002\u6709\u4e86 watch \u6211\u4eec\u53c8\u591a\u4e86\u4e00\u79cd\u53ef\u4ee5\u7528\u6765\u89e3\u51b3\u5e76\u53d1\u4fee\u6539\u7684\u65b9\u6cd5\u3002\nwatch \u7684\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a\n```py\nwhile True:\n    do_watch()\n    commands()\n    multi()\n    send_commands()\n    try:\n        exec()\n        break\n    except WatchError:\n        continue\n```\nwatch \u4f1a\u5728\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u76ef\u4f4f 1 \u4e2a\u6216\u591a\u4e2a\u5173\u952e\u53d8\u91cf\uff0c\u5f53\u4e8b\u52a1\u6267\u884c\u65f6\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u5668\u6536\u5230\u4e86 exec \u6307\u4ee4\u8981\u987a\u5e8f\u6267\u884c\u7f13\u5b58\u7684\u4e8b\u52a1\u961f\u5217\u65f6\uff0cRedis \u4f1a\u68c0\u67e5\u5173\u952e\u53d8\u91cf\u81ea watch \u4e4b\u540e\uff0c\u662f\u5426\u88ab\u4fee\u6539\u4e86 (\u5305\u62ec\u5f53\u524d\u4e8b\u52a1\u6240\u5728\u7684\u5ba2\u6237\u7aef)\u3002\u5982\u679c\u5173\u952e\u53d8\u91cf\u88ab\u4eba\u52a8\u8fc7\u4e86\uff0cexec \u6307\u4ee4\u5c31\u4f1a\u8fd4\u56de null \u56de\u590d\u544a\u77e5\u5ba2\u6237\u7aef\u4e8b\u52a1\u6267\u884c\u5931\u8d25\uff0c\u8fd9\u4e2a\u65f6\u5019\u5ba2\u6237\u7aef\u4e00\u822c\u4f1a\u9009\u62e9\u91cd\u8bd5\u3002\n```\n> watch books\nOK\n> incr books  # \u88ab\u4fee\u6539\u4e86\n(integer) 1\n> multi\nOK\n> incr books\nQUEUED\n> exec  # \u4e8b\u52a1\u6267\u884c\u5931\u8d25\n(nil)\n```\n\u5f53\u670d\u52a1\u5668\u7ed9 exec \u6307\u4ee4\u8fd4\u56de\u4e00\u4e2a null \u56de\u590d\u65f6\uff0c\u5ba2\u6237\u7aef\u77e5\u9053\u4e86\u4e8b\u52a1\u6267\u884c\u662f\u5931\u8d25\u7684\uff0c\u901a\u5e38\u5ba2\u6237\u7aef (redis-py) \u90fd\u4f1a\u629b\u51fa\u4e00\u4e2a WatchError \u8fd9\u79cd\u9519\u8bef\uff0c\u4e0d\u8fc7\u4e5f\u6709\u4e9b\u8bed\u8a00 (jedis) \u4e0d\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u800c\u662f\u901a\u8fc7\u5728 exec \u65b9\u6cd5\u91cc\u8fd4\u56de\u4e00\u4e2a null\uff0c\u8fd9\u6837\u5ba2\u6237\u7aef\u9700\u8981\u68c0\u67e5\u4e00\u4e0b\u8fd4\u56de\u7ed3\u679c\u662f\u5426\u4e3a null \u6765\u786e\u5b9a\u4e8b\u52a1\u662f\u5426\u6267\u884c\u5931\u8d25\u3002\n\n**\u6ce8\u610f\u4e8b\u9879**\n\nRedis \u7981\u6b62\u5728 multi \u548c exec \u4e4b\u95f4\u6267\u884c watch \u6307\u4ee4\uff0c\u800c\u5fc5\u987b\u5728 multi \u4e4b\u524d\u505a\u597d\u76ef\u4f4f\u5173\u952e\u53d8\u91cf\uff0c\u5426\u5219\u4f1a\u51fa\u9519\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528 Python \u8bed\u8a00\u6765\u5b9e\u73b0\u5bf9\u4f59\u989d\u7684\u52a0\u500d\u64cd\u4f5c\u3002\n\n```py\n# -*- coding: utf-8\nimport redis\n\ndef key_for(user_id):\n    return \"account_{}\".format(user_id)\n\ndef double_account(client, user_id):\n    key = key_for(user_id)\n    while True:\n        client.watch(key)\n        value = int(client.get(key))\n        value *= 2  # \u52a0\u500d\n        pipe = client.pipeline(transaction=True)\n        pipe.multi()\n        pipe.set(key, value)\n        try:\n            pipe.execute()\n            break  # \u603b\u7b97\u6210\u529f\u4e86\n        except redis.WatchError:\n            continue  # \u4e8b\u52a1\u88ab\u6253\u65ad\u4e86\uff0c\u91cd\u8bd5\n    return int(client.get(key))  # \u91cd\u65b0\u83b7\u53d6\u4f59\u989d\n\nclient = redis.StrictRedis()\nuser_id = \"abc\"\nclient.setnx(key_for(user_id), 5)  # setnx \u505a\u521d\u59cb\u5316\nprint double_account(client, user_id)\n```\n\n\u4e0b\u9762\u6211\u4eec\u518d\u4f7f\u7528 Java \u8bed\u8a00\u5b9e\u73b0\u4e00\u904d\u3002\n\n```java\nimport java.util.List;\nimport redis.clients.jedis.Jedis;\nimport redis.clients.jedis.Transaction;\n\npublic class TransactionDemo {\n\n  public static void main(String[] args) {\n    Jedis jedis = new Jedis();\n    String userId = \"abc\";\n    String key = keyFor(userId);\n    jedis.setnx(key, String.valueOf(5));  # setnx \u505a\u521d\u59cb\u5316\n    System.out.println(doubleAccount(jedis, userId));\n    jedis.close();\n  }\n\n  public static int doubleAccount(Jedis jedis, String userId) {\n    String key = keyFor(userId);\n    while (true) {\n      jedis.watch(key);\n      int value = Integer.parseInt(jedis.get(key));\n      value *= 2; // \u52a0\u500d\n      Transaction tx = jedis.multi();\n      tx.set(key, String.valueOf(value));\n      List<Object> res = tx.exec();\n      if (res != null) {\n        break; // \u6210\u529f\u4e86\n      }\n    }\n    return Integer.parseInt(jedis.get(key)); // \u91cd\u65b0\u83b7\u53d6\u4f59\u989d\n  }\n\n  public static String keyFor(String userId) {\n    return String.format(\"account_%s\", userId);\n  }\n\n}\n```\n\n\u6211\u4eec\u5e38\u5e38\u542c\u8bf4 Python \u7684\u4ee3\u7801\u8981\u6bd4 Java \u7b80\u77ed\u592a\u591a\uff0c\u4f46\u662f\u4ece\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6211\u4eec\u770b\u5230 Java \u7684\u4ee3\u7801\u6bd4 python \u7684\u4ee3\u7801\u4e5f\u591a\u4e0d\u4e86\u591a\u5c11\uff0c\u5927\u7ea6\u53ea\u591a\u51fa 50%\u3002\n\n## \u601d\u8003\u9898\n\n\u4e3a\u4ec0\u4e48 Redis \u7684\u4e8b\u52a1\u4e0d\u80fd\u652f\u6301\u56de\u6eda\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/15\u539f\u7406_5\u540c\u821f\u5171\u6d4e__\u4e8b\u52a1.md", "create_date": "2020-02-18T03:01:05.693", "order": 16}}, {"model": "subject.chapter", "pk": 25, "fields": {"title": "16\u539f\u7406 6\uff1a\u5c0f\u9053\u6d88\u606f \u2014\u2014 PubSub", "topic": 2, "md5": "d65e92cc9dc348a7b51b97dc465f99b0", "md_body": "# \u539f\u7406 6\uff1a\u5c0f\u9053\u6d88\u606f \u2014\u2014 PubSub\n\n\u524d\u9762\u6211\u4eec\u8bb2\u4e86 Redis \u6d88\u606f\u961f\u5217\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u4f46\u662f\u6ca1\u6709\u63d0\u5230 **Redis \u6d88\u606f\u961f\u5217\u7684\u4e0d\u8db3\u4e4b\u5904\uff0c\u90a3\u5c31\u662f\u5b83\u4e0d\u652f\u6301\u6d88\u606f\u7684\u591a\u64ad\u673a\u5236**\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16481fd5b8bff9d0?w=927&h=284&f=png&s=32458)\n\n## \u6d88\u606f\u591a\u64ad\n\n\u6d88\u606f\u591a\u64ad\u5141\u8bb8\u751f\u4ea7\u8005\u751f\u4ea7\u4e00\u6b21\u6d88\u606f\uff0c\u4e2d\u95f4\u4ef6\u8d1f\u8d23\u5c06\u6d88\u606f\u590d\u5236\u5230\u591a\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u6bcf\u4e2a\u6d88\u606f\u961f\u5217\u7531\u76f8\u5e94\u7684\u6d88\u8d39\u7ec4\u8fdb\u884c\u6d88\u8d39\u3002\u5b83\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u5e38\u7528\u7684\u4e00\u79cd\u89e3\u8026\u65b9\u5f0f\uff0c\u7528\u4e8e\u5c06\u591a\u4e2a\u6d88\u8d39\u7ec4\u7684\u903b\u8f91\u8fdb\u884c\u62c6\u5206\u3002\u652f\u6301\u4e86\u6d88\u606f\u591a\u64ad\uff0c\u591a\u4e2a\u6d88\u8d39\u7ec4\u7684\u903b\u8f91\u5c31\u53ef\u4ee5\u653e\u5230\u4e0d\u540c\u7684\u5b50\u7cfb\u7edf\u4e2d\u3002\n\n\u5982\u679c\u662f\u666e\u901a\u7684\u6d88\u606f\u961f\u5217\uff0c\u5c31\u5f97\u5c06\u591a\u4e2a\u4e0d\u540c\u7684\u6d88\u8d39\u7ec4\u903b\u8f91\u4e32\u63a5\u8d77\u6765\u653e\u5728\u4e00\u4e2a\u5b50\u7cfb\u7edf\u4e2d\uff0c\u8fdb\u884c\u8fde\u7eed\u6d88\u8d39\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16481fe345c36b70?w=857&h=142&f=png&s=16701)\n\nPubSub\n--\n\u4e3a\u4e86\u652f\u6301\u6d88\u606f\u591a\u64ad\uff0cRedis \u4e0d\u80fd\u518d\u4f9d\u8d56\u4e8e\u90a3 5 \u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4e86\u3002\u5b83\u5355\u72ec\u4f7f\u7528\u4e86\u4e00\u4e2a\u6a21\u5757\u6765\u652f\u6301\u6d88\u606f\u591a\u64ad\uff0c\u8fd9\u4e2a\u6a21\u5757\u7684\u540d\u5b57\u53eb\u7740 PubSub\uff0c\u4e5f\u5c31\u662f PublisherSubscriber\uff0c\u53d1\u5e03\u8005\u8ba2\u9605\u8005\u6a21\u578b\u3002\u6211\u4eec\u4f7f\u7528 Python \u8bed\u8a00\u6765\u6f14\u793a\u4e00\u4e0b PubSub \u5982\u4f55\u4f7f\u7528\u3002\n```python\n# -*- coding: utf-8 -*-\nimport time\nimport redis\n\nclient = redis.StrictRedis()\np = client.pubsub()\np.subscribe(\"codehole\")\ntime.sleep(1)\nprint p.get_message()\nclient.publish(\"codehole\", \"java comes\")\ntime.sleep(1)\nprint p.get_message()\nclient.publish(\"codehole\", \"python comes\")\ntime.sleep(1)\nprint p.get_message()\nprint p.get_message()\n```\n```\n{'pattern': None, 'type': 'subscribe', 'channel': 'codehole', 'data': 1L}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'java comes'}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'python comes'}\nNone\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164820151073c5ce?w=730&h=316&f=png&s=22845)\n\u5ba2\u6237\u7aef\u53d1\u8d77\u8ba2\u9605\u547d\u4ee4\u540e\uff0cRedis \u4f1a\u7acb\u5373\u7ed9\u4e88\u4e00\u4e2a\u53cd\u9988\u6d88\u606f\u901a\u77e5\u8ba2\u9605\u6210\u529f\u3002\u56e0\u4e3a\u6709\u7f51\u7edc\u4f20\u8f93\u5ef6\u8fdf\uff0c\u5728 `subscribe` \u547d\u4ee4\u53d1\u51fa\u540e\uff0c\u9700\u8981\u4f11\u7720\u4e00\u4f1a\uff0c\u518d\u901a\u8fc7 `get\\_message` \u624d\u80fd\u62ff\u5230\u53cd\u9988\u6d88\u606f\u3002\u5ba2\u6237\u7aef\u63a5\u4e0b\u6765\u6267\u884c\u53d1\u5e03\u547d\u4ee4\uff0c\u53d1\u5e03\u4e86\u4e00\u6761\u6d88\u606f\u3002\u540c\u6837\u56e0\u4e3a\u7f51\u7edc\u5ef6\u8fdf\uff0c\u5728 `publish` \u547d\u4ee4\u53d1\u51fa\u540e\uff0c\u9700\u8981\u4f11\u7720\u4e00\u4f1a\uff0c\u518d\u901a\u8fc7 `get\\_message` \u624d\u80fd\u62ff\u5230\u53d1\u5e03\u7684\u6d88\u606f\u3002\u5982\u679c\u5f53\u524d\u6ca1\u6709\u6d88\u606f\uff0c`get\\_message` \u4f1a\u8fd4\u56de\u7a7a\uff0c\u544a\u77e5\u5f53\u524d\u6ca1\u6709\u6d88\u606f\uff0c\u6240\u4ee5\u5b83\u4e0d\u662f\u963b\u585e\u7684\u3002\n\nRedis PubSub \u7684\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u662f\u4e0d\u540c\u7684\u8fde\u63a5\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u5b9e\u9645\u4e0a\u4f7f\u7528\u4e86\u4e24\u4e2a Redis \u7684\u8fde\u63a5\u3002\u8fd9\u662f\u5fc5\u987b\u7684\uff0c\u56e0\u4e3a Redis \u4e0d\u5141\u8bb8\u8fde\u63a5\u5728 subscribe \u7b49\u5f85\u6d88\u606f\u65f6\u8fd8\u8981\u8fdb\u884c\u5176\u5b83\u7684\u64cd\u4f5c\u3002\n\n**\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u5f88\u5c11\u5c06\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u653e\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u91cc**\u3002\u5982\u679c\u5b83\u4eec\u771f\u8981\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u91cc\uff0c\u4f55\u5fc5\u901a\u8fc7\u4e2d\u95f4\u4ef6\u6765\u6d41\u8f6c\uff0c\u76f4\u63a5\u4f7f\u7528\u51fd\u6570\u8c03\u7528\u5c31\u884c\u3002\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u5c06\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u5206\u79bb\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u5206\u79bb\u540e\u7684\u4ee3\u7801\u8981\u600e\u4e48\u5199\u3002\n\n**\u6d88\u8d39\u8005**\n```py\n# -*- coding: utf-8 -*-\nimport time\nimport redis\n\nclient = redis.StrictRedis()\np = client.pubsub()\np.subscribe(\"codehole\")\nwhile True:\n    msg = p.get_message()\n    if not msg:\n        time.sleep(1)\n        continue\n    print msg\n```\n**\u751f\u4ea7\u8005**\n```py\n# -*- coding: utf-8 -*-\nimport redis\n\nclient = redis.StrictRedis()\nclient.publish(\"codehole\", \"python comes\")\nclient.publish(\"codehole\", \"java comes\")\nclient.publish(\"codehole\", \"golang comes\")\n```\n\u5fc5\u987b\u5148\u542f\u52a8\u6d88\u8d39\u8005\uff0c\u7136\u540e\u518d\u6267\u884c\u751f\u4ea7\u8005\uff0c\u6d88\u8d39\u8005\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a\uff0cpubsub \u4f1a\u4fdd\u8bc1\u5b83\u4eec\u6536\u5230\u7684\u662f\u76f8\u540c\u7684\u6d88\u606f\u5e8f\u5217\u3002\n```\n{'pattern': None, 'type': 'subscribe', 'channel': 'codehole', 'data': 1L}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'python comes'}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'java comes'}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'golang comes'}\n```\n\u6211\u4eec\u4ece\u6d88\u8d39\u8005\u7684\u63a7\u5236\u53f0\u7a97\u53e3\u53ef\u4ee5\u770b\u5230\u4e0a\u9762\u7684\u8f93\u51fa\uff0c\u6bcf\u4e2a\u6d88\u8d39\u8005\u7a97\u53e3\u90fd\u662f\u540c\u6837\u7684\u8f93\u51fa\u3002\u7b2c\u4e00\u884c\u662f\u8ba2\u9605\u6210\u529f\u6d88\u606f\uff0c\u5b83\u5f88\u5feb\u5c31\u4f1a\u8f93\u51fa\uff0c\u540e\u9762\u7684\u4e09\u884c\u4f1a\u5728\u751f\u4ea7\u8005\u8fdb\u7a0b\u6267\u884c\u7684\u65f6\u5019\u7acb\u5373\u8f93\u51fa\u3002\n\u4e0a\u9762\u7684\u6d88\u8d39\u8005\u662f\u901a\u8fc7\u8f6e\u8be2 `get_message` \u6765\u6536\u53d6\u6d88\u606f\u7684\uff0c\u5982\u679c\u6536\u53d6\u4e0d\u5230\u5c31\u4f11\u7720 1s\u3002\u8fd9\u8ba9\u6211\u4eec\u60f3\u8d77\u4e86\u7b2c 3 \u8282\u7684\u6d88\u606f\u961f\u5217\u6a21\u578b\uff0c\u6211\u4eec\u4f7f\u7528 blpop \u6765\u4ee3\u66ff\u4f11\u7720\u6765\u63d0\u9ad8\u6d88\u606f\u5904\u7406\u7684\u53ca\u65f6\u6027\u3002\n\nPubSub \u7684\u6d88\u8d39\u8005\u5982\u679c\u4f7f\u7528\u4f11\u7720\u7684\u65b9\u5f0f\u6765\u8f6e\u8be2\u6d88\u606f\uff0c\u4e5f\u4f1a\u906d\u9047\u6d88\u606f\u5904\u7406\u4e0d\u53ca\u65f6\u7684\u95ee\u9898\u3002\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 listen \u6765\u963b\u585e\u76d1\u542c\u6d88\u606f\u6765\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u70b9\u540c blpop \u539f\u7406\u662f\u4e00\u6837\u7684\u3002\u4e0b\u9762\u6211\u4eec\u6539\u9020\u4e00\u4e0b\u6d88\u8d39\u8005\n\n**\u963b\u585e\u6d88\u8d39\u8005**\n```py\n# -*- coding: utf-8 -*-\nimport time\nimport redis\n\nclient = redis.StrictRedis()\np = client.pubsub()\np.subscribe(\"codehole\")\nfor msg in p.listen():\n    print msg\n```\n\u4ee3\u7801\u7b80\u77ed\u4e86\u5f88\u591a\uff0c\u4e0d\u9700\u8981\u518d\u4f11\u7720\u4e86\uff0c\u6d88\u606f\u5904\u7406\u4e5f\u53ca\u65f6\u4e86\u3002\n\n\u6a21\u5f0f\u8ba2\u9605\n--\n\u4e0a\u9762\u63d0\u5230\u7684\u8ba2\u9605\u6a21\u5f0f\u662f\u57fa\u4e8e\u540d\u79f0\u8ba2\u9605\u7684\uff0c\u6d88\u8d39\u8005\u8ba2\u9605\u4e00\u4e2a\u4e3b\u9898\u662f\u5fc5\u987b\u660e\u786e\u6307\u5b9a\u4e3b\u9898\u7684\u540d\u79f0\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u8ba2\u9605\u591a\u4e2a\u4e3b\u9898\uff0c\u90a3\u5c31 subscribe \u591a\u4e2a\u540d\u79f0\u3002\n```sh\n> subscribe codehole.image codehole.text codehole.blog  # \u540c\u65f6\u8ba2\u9605\u4e09\u4e2a\u4e3b\u9898\uff0c\u4f1a\u6709\u4e09\u6761\u8ba2\u9605\u6210\u529f\u53cd\u9988\u4fe1\u606f\n1) \"subscribe\"\n2) \"codehole.image\"\n3) (integer) 1\n1) \"subscribe\"\n2) \"codehole.text\"\n3) (integer) 2\n1) \"subscribe\"\n2) \"codehole.blog\"\n3) (integer) 3\n```\n\u8fd9\u6837\u751f\u4ea7\u8005\u5411\u8fd9\u4e09\u4e2a\u4e3b\u9898\u53d1\u5e03\u7684\u6d88\u606f\uff0c\u8fd9\u4e2a\u6d88\u8d39\u8005\u90fd\u53ef\u4ee5\u63a5\u6536\u5230\u3002\n```sh\n> publish codehole.image https://www.google.com/dudo.png\n(integer) 1\n> publish codehole.text \" \u4f60\u597d\uff0c\u6b22\u8fce\u52a0\u5165\u7801\u6d1e \"\n(integer) 1\n> publish codehole.blog '{\"content\": \"hello, everyone\", \"title\": \"welcome\"}'\n(integer) 1\n```\n\u5982\u679c\u73b0\u5728\u8981\u589e\u52a0\u4e00\u4e2a\u4e3b\u9898```codehole.group```\uff0c\u5ba2\u6237\u7aef\u5fc5\u987b\u4e5f\u8ddf\u7740\u589e\u52a0\u4e00\u4e2a\u8ba2\u9605\u6307\u4ee4\u624d\u53ef\u4ee5\u6536\u5230\u65b0\u5f00\u4e3b\u9898\u7684\u6d88\u606f\u63a8\u9001\u3002\n\n\u4e3a\u4e86\u7b80\u5316\u8ba2\u9605\u7684\u7e41\u7410\uff0credis \u63d0\u4f9b\u4e86\u6a21\u5f0f\u8ba2\u9605\u529f\u80fd```Pattern Subscribe```\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e00\u6b21\u8ba2\u9605\u591a\u4e2a\u4e3b\u9898\uff0c\u5373\u4f7f\u751f\u4ea7\u8005\u65b0\u589e\u52a0\u4e86\u540c\u6a21\u5f0f\u7684\u4e3b\u9898\uff0c\u6d88\u8d39\u8005\u4e5f\u53ef\u4ee5\u7acb\u5373\u6536\u5230\u6d88\u606f\n```\n> psubscribe codehole.*  # \u7528\u6a21\u5f0f\u5339\u914d\u4e00\u6b21\u8ba2\u9605\u591a\u4e2a\u4e3b\u9898\uff0c\u4e3b\u9898\u4ee5 codehole. \u5b57\u7b26\u5f00\u5934\u7684\u6d88\u606f\u90fd\u53ef\u4ee5\u6536\u5230\n1) \"psubscribe\"\n2) \"codehole.*\"\n3) (integer) 1\n```\n\n\n\u6d88\u606f\u7ed3\u6784\n--\n\u524d\u9762\u7684\u6d88\u8d39\u8005\u6d88\u606f\u8f93\u51fa\u65f6\u90fd\u662f\u4e0b\u9762\u7684\u8fd9\u6837\u4e00\u4e2a\u5b57\u5178\u5f62\u5f0f\n```\n{'pattern': None, 'type': 'subscribe', 'channel': 'codehole', 'data': 1L}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'python comes'}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'java comes'}\n{'pattern': None, 'type': 'message', 'channel': 'codehole', 'data': 'golang comes'}\n```\n\u90a3\u8fd9\u51e0\u4e2a\u5b57\u6bb5\u662f\u4ec0\u4e48\u542b\u4e49\u5462\uff1f\n\n**data**\n\u8fd9\u4e2a\u6beb\u65e0\u7591\u95ee\u5c31\u662f\u6d88\u606f\u7684\u5185\u5bb9\uff0c\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\n\n**channel**\n\u8fd9\u4e2a\u4e5f\u5f88\u660e\u663e\uff0c\u5b83\u8868\u793a\u5f53\u524d\u8ba2\u9605\u7684\u4e3b\u9898\u540d\u79f0\u3002\n\n**type**\n\u5b83\u8868\u793a\u6d88\u606f\u7684\u7c7b\u578b\uff0c\u5982\u679c\u662f\u4e00\u4e2a\u666e\u901a\u7684\u6d88\u606f\uff0c\u90a3\u4e48\u7c7b\u578b\u5c31\u662f message\uff0c\u5982\u679c\u662f\u63a7\u5236\u6d88\u606f\uff0c\u6bd4\u5982\u8ba2\u9605\u6307\u4ee4\u7684\u53cd\u9988\uff0c\u5b83\u7684\u7c7b\u578b\u5c31\u662f subscribe\uff0c\u5982\u679c\u662f\u6a21\u5f0f\u8ba2\u9605\u7684\u53cd\u9988\uff0c\u5b83\u7684\u7c7b\u578b\u5c31\u662f psubscribe\uff0c\u8fd8\u6709\u53d6\u6d88\u8ba2\u9605\u6307\u4ee4\u7684\u53cd\u9988 unsubscribe \u548c punsubscribe\u3002\n\n**pattern**\n\u5b83\u8868\u793a\u5f53\u524d\u6d88\u606f\u662f\u4f7f\u7528\u54ea\u79cd\u6a21\u5f0f\u8ba2\u9605\u5230\u7684\uff0c\u5982\u679c\u662f\u901a\u8fc7 subscribe \u6307\u4ee4\u8ba2\u9605\u7684\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5b57\u6bb5\u5c31\u662f\u7a7a\u3002\n\nPubSub \u7f3a\u70b9\n--\nPubSub \u7684\u751f\u4ea7\u8005\u4f20\u9012\u8fc7\u6765\u4e00\u4e2a\u6d88\u606f\uff0cRedis \u4f1a\u76f4\u63a5\u627e\u5230\u76f8\u5e94\u7684\u6d88\u8d39\u8005\u4f20\u9012\u8fc7\u53bb\u3002\u5982\u679c\u4e00\u4e2a\u6d88\u8d39\u8005\u90fd\u6ca1\u6709\uff0c\u90a3\u4e48\u6d88\u606f\u76f4\u63a5\u4e22\u5f03\u3002\u5982\u679c\u5f00\u59cb\u6709\u4e09\u4e2a\u6d88\u8d39\u8005\uff0c\u4e00\u4e2a\u6d88\u8d39\u8005\u7a81\u7136\u6302\u6389\u4e86\uff0c\u751f\u4ea7\u8005\u4f1a\u7ee7\u7eed\u53d1\u9001\u6d88\u606f\uff0c\u53e6\u5916\u4e24\u4e2a\u6d88\u8d39\u8005\u53ef\u4ee5\u6301\u7eed\u6536\u5230\u6d88\u606f\u3002\u4f46\u662f\u6302\u6389\u7684\u6d88\u8d39\u8005\u91cd\u65b0\u8fde\u4e0a\u7684\u65f6\u5019\uff0c\u8fd9\u65ad\u8fde\u671f\u95f4\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u6d88\u8d39\u8005\u6765\u8bf4\u5c31\u662f\u5f7b\u5e95\u4e22\u5931\u4e86\u3002\n\n\u5982\u679c Redis \u505c\u673a\u91cd\u542f\uff0cPubSub \u7684\u6d88\u606f\u662f\u4e0d\u4f1a\u6301\u4e45\u5316\u7684\uff0c\u6bd5\u7adf Redis \u5b95\u673a\u5c31\u76f8\u5f53\u4e8e\u4e00\u4e2a\u6d88\u8d39\u8005\u90fd\u6ca1\u6709\uff0c\u6240\u6709\u7684\u6d88\u606f\u76f4\u63a5\u88ab\u4e22\u5f03\u3002\n\n\u6b63\u662f\u56e0\u4e3a PubSub \u6709\u8fd9\u4e9b\u7f3a\u70b9\uff0c\u5b83\u51e0\u4e4e\u627e\u4e0d\u5230\u5408\u9002\u7684\u5e94\u7528\u573a\u666f\u3002\u6240\u4ee5 Redis \u7684\u4f5c\u8005\u5355\u72ec\u5f00\u542f\u4e86\u4e00\u4e2a\u9879\u76ee Disque \u4e13\u95e8\u7528\u6765\u505a\u591a\u64ad\u6d88\u606f\u961f\u5217\u3002\u8be5\u9879\u76ee\u76ee\u524d\u6ca1\u6709\u6210\u719f\uff0c\u4e00\u76f4\u957f\u671f\u5904\u4e8e Beta \u7248\u672c\uff0c\u4f46\u662f\u76f8\u5e94\u7684\u5ba2\u6237\u7aef sdk \u5df2\u7ecf\u975e\u5e38\u4e30\u5bcc\u4e86\uff0c\u5c31\u5f85 Redis \u4f5c\u8005\u4e34\u95e8\u4e00\u811a\u53d1\u5e03\u4e00\u4e2a Release \u7248\u672c\u3002\u5173\u4e8e Disque \u7684\u66f4\u591a\u7ec6\u8282\uff0c\u672c\u5c0f\u518c\u4e0d\u4f1a\u591a\u505a\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u53bb\u9605\u8bfb\u76f8\u5173\u6587\u6863\u3002\n\n## \u8865\u5145\n\n\u8fd1\u671f Redis5.0 \u65b0\u589e\u4e86 Stream \u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u4e2a\u529f\u80fd\u7ed9 Redis \u5e26\u6765\u4e86\u6301\u4e45\u5316\u6d88\u606f\u961f\u5217\uff0c\u4ece\u6b64 PubSub \u53ef\u4ee5\u6d88\u5931\u4e86\uff0cDisqueue \u4f30\u8ba1\u4e5f\u6c38\u8fdc\u53d1\u4e0d\u51fa\u5b83\u7684 Release \u7248\u672c\u4e86\u3002\u5177\u4f53\u5185\u5bb9\u8bf7\u8bfb\u8005\u9605\u8bfb Stream \u7ae0\u8282\u5185\u5bb9\uff08\u7b2c 23 \u8282\uff09\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/16\u539f\u7406_6\u5c0f\u9053\u6d88\u606f__PubSub.md", "create_date": "2020-02-18T03:01:05.714", "order": 17}}, {"model": "subject.chapter", "pk": 26, "fields": {"title": "17\u539f\u7406 7\uff1a\u5f00\u6e90\u8282\u6d41 \u2014\u2014 \u5c0f\u5bf9\u8c61\u538b\u7f29", "topic": 2, "md5": "7e94060cad1bfbae1916c956bf325eb5", "md_body": "# \u539f\u7406 7\uff1a\u5f00\u6e90\u8282\u6d41 \u2014\u2014 \u5c0f\u5bf9\u8c61\u538b\u7f29\n\nRedis \u662f\u4e00\u4e2a\u975e\u5e38\u8017\u8d39\u5185\u5b58\u7684\u6570\u636e\u5e93\uff0c\u5b83\u6240\u6709\u7684\u6570\u636e\u90fd\u653e\u5728\u5185\u5b58\u91cc\u3002\u5982\u679c\u6211\u4eec\u4e0d\u6ce8\u610f\u8282\u7ea6\u4f7f\u7528\u5185\u5b58\uff0cRedis \u5c31\u4f1a\u56e0\u4e3a\u6211\u4eec\u7684\u65e0\u8282\u5236\u4f7f\u7528\u51fa\u73b0\u5185\u5b58\u4e0d\u8db3\u800c\u5d29\u6e83\u3002Redis \u4f5c\u8005\u4e3a\u4e86\u4f18\u5316\u6570\u636e\u7ed3\u6784\u7684\u5185\u5b58\u5360\u7528\uff0c\u4e5f\u82e6\u5fc3\u5b64\u8be3\u589e\u52a0\u4e86\u975e\u5e38\u591a\u7684\u4f18\u5316\u70b9\uff0c\u8fd9\u4e9b\u4f18\u5316\u4e5f\u662f\u4ee5\u727a\u7272\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u4e3a\u4ee3\u4ef7\u7684\uff0c\u4f46\u662f\u6beb\u65e0\u7591\u95ee\u8fd9\u662f\u975e\u5e38\u503c\u5f97\u7684\uff0c\u5c24\u5176\u50cf Redis \u8fd9\u79cd\u6570\u636e\u5e93\u3002\n\n32bit vs 64bit\n--\nRedis \u5982\u679c\u4f7f\u7528 32bit \u8fdb\u884c\u7f16\u8bd1\uff0c\u5185\u90e8\u6240\u6709\u6570\u636e\u7ed3\u6784\u6240\u4f7f\u7528\u7684\u6307\u9488\u7a7a\u95f4\u5360\u7528\u4f1a\u5c11\u4e00\u534a\uff0c\u5982\u679c\u4f60\u5bf9 Redis \u4f7f\u7528\u5185\u5b58\u4e0d\u8d85\u8fc7 4G\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 32bit \u8fdb\u884c\u7f16\u8bd1\uff0c\u53ef\u4ee5\u8282\u7ea6\u5927\u91cf\u5185\u5b58\u30024G \u7684\u5bb9\u91cf\u4f5c\u4e3a\u4e00\u4e9b\u5c0f\u578b\u7ad9\u70b9\u7684\u7f13\u5b58\u6570\u636e\u5e93\u662f\u7ef0\u7ef0\u6709\u4f59\u4e86\uff0c\u5982\u679c\u4e0d\u8db3\u8fd8\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u5b9e\u4f8b\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u3002\n\n\u5c0f\u5bf9\u8c61\u538b\u7f29\u5b58\u50a8 (ziplist)\n--\n\u5982\u679c Redis \u5185\u90e8\u7ba1\u7406\u7684\u96c6\u5408\u6570\u636e\u7ed3\u6784\u5f88\u5c0f\uff0c\u5b83\u4f1a\u4f7f\u7528\u7d27\u51d1\u5b58\u50a8\u5f62\u5f0f\u538b\u7f29\u5b58\u50a8\u3002\n\n\u8fd9\u5c31\u597d\u6bd4 HashMap \u672c\u6765\u662f\u4e8c\u7ef4\u7ed3\u6784\uff0c\u4f46\u662f\u5982\u679c\u5185\u90e8\u5143\u7d20\u6bd4\u8f83\u5c11\uff0c\u4f7f\u7528\u4e8c\u7ef4\u7ed3\u6784\u53cd\u800c\u6d6a\u8d39\u7a7a\u95f4\uff0c\u8fd8\u4e0d\u5982\u4f7f\u7528\u4e00\u7ef4\u6570\u7ec4\u8fdb\u884c\u5b58\u50a8\uff0c\u9700\u8981\u67e5\u627e\u65f6\uff0c\u56e0\u4e3a\u5143\u7d20\u5c11\u8fdb\u884c\u904d\u5386\u4e5f\u5f88\u5feb\uff0c\u751a\u81f3\u53ef\u4ee5\u6bd4 HashMap \u672c\u8eab\u7684\u67e5\u627e\u8fd8\u8981\u5feb\u3002\u6bd4\u5982\u4e0b\u9762\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6570\u7ec4\u6765\u6a21\u62df HashMap \u7684\u589e\u5220\u6539\u64cd\u4f5c\u3002\n\n```java\npublic class ArrayMap<K, V> {\n\n  private List<K> keys = new ArrayList<>();\n  private List<V> values = new ArrayList<>();\n\n  public V put(K k, V v) {\n    for (int i = 0; i < keys.size(); i++) {\n      if (keys.get(i).equals(k)) {\n        V oldv = values.get(i);\n        values.set(i, v);\n        return oldv;\n      }\n    }\n    keys.add(k);\n    values.add(v);\n    return null;\n  }\n\n  public V get(K k) {\n    for (int i = 0; i < keys.size(); i++) {\n      if (keys.get(i).equals(k)) {\n        return values.get(i);\n      }\n    }\n    return null;\n  }\n\n  public V delete(K k) {\n    for (int i = 0; i < keys.size(); i++) {\n      if (keys.get(i).equals(k)) {\n        keys.remove(i);\n        return values.remove(i);\n      }\n    }\n    return null;\n  }\n\n}\n```\n\nRedis \u7684 ziplist \u662f\u4e00\u4e2a\u7d27\u51d1\u7684\u5b57\u8282\u6570\u7ec4\u7ed3\u6784\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6bcf\u4e2a\u5143\u7d20\u4e4b\u95f4\u90fd\u662f\u7d27\u6328\u7740\u7684\u3002\u6211\u4eec\u4e0d\u7528\u8fc7\u4e8e\u5173\u5fc3 `zlbytes/zltail` \u548c `zlend` \u7684\u542b\u4e49\uff0c\u7a0d\u5fae\u4e86\u89e3\u4e00\u4e0b\u5c31\u597d\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16481f85c83f803e?w=844&h=309&f=png&s=29412)\n\n\u5982\u679c\u5b83\u5b58\u50a8\u7684\u662f hash \u7ed3\u6784\uff0c\u90a3\u4e48 key \u548c value \u4f1a\u4f5c\u4e3a\u4e24\u4e2a entry \u76f8\u90bb\u5b58\u5728\u4e00\u8d77\u3002\n```\n127.0.0.1:6379> hset hello a 1\n(integer) 1\n127.0.0.1:6379> hset hello b 2\n(integer) 1\n127.0.0.1:6379> hset hello c 3\n(integer) 1\n127.0.0.1:6379> object encoding hello\n\"ziplist\"\n```\n\u5982\u679c\u5b83\u5b58\u50a8\u7684\u662f zset\uff0c\u90a3\u4e48 value \u548c score \u4f1a\u4f5c\u4e3a\u4e24\u4e2a entry \u76f8\u90bb\u5b58\u5728\u4e00\u8d77\u3002\n```\n127.0.0.1:6379> zadd world 1 a\n(integer) 1\n127.0.0.1:6379> zadd world 2 b\n(integer) 1\n127.0.0.1:6379> zadd world 3 c\n(integer) 1\n127.0.0.1:6379> object encoding world\n\"ziplist\"\n```\n\u5173\u4e8e\u538b\u7f29\u5217\u8868\u66f4\u591a\u7ec6\u8282\uff0c\u8bf7\u9605\u8bfb\u7b2c34\u8282[\u300a\u6781\u5ea6\u6df1\u5bd2 \u2014\u2014 \u63a2\u7d22\u300c\u5217\u8868\u300d\u5185\u90e8\u7ed3\u6784\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b5c95226fb9a04fa42fc3f6)\u548c\u7b2c35\u8282[\u300a\u6781\u5ea6\u6df1\u5bd2 \u2014\u2014 \u63a2\u7d22\u300c\u7d27\u51d1\u5217\u8868\u300d\u5185\u90e8\u300b](https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5b5d3ec0f265da0f91561c33)\n\nRedis \u7684 `intset` \u662f\u4e00\u4e2a\u7d27\u51d1\u7684\u6574\u6570\u6570\u7ec4\u7ed3\u6784\uff0c\u5b83\u7528\u4e8e\u5b58\u653e\u5143\u7d20\u90fd\u662f\u6574\u6570\u7684\u5e76\u4e14\u5143\u7d20\u4e2a\u6570\u8f83\u5c11\u7684 set \u96c6\u5408\u3002\n\n\u5982\u679c\u6574\u6570\u53ef\u4ee5\u7528 uint16 \u8868\u793a\uff0c\u90a3\u4e48 intset \u7684\u5143\u7d20\u5c31\u662f 16 \u4f4d\u7684\u6570\u7ec4\uff0c\u5982\u679c\u65b0\u52a0\u5165\u7684\u6574\u6570\u8d85\u8fc7\u4e86 uint16 \u7684\u8868\u793a\u8303\u56f4\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528 uint32 \u8868\u793a\uff0c\u5982\u679c\u65b0\u52a0\u5165\u7684\u5143\u7d20\u8d85\u8fc7\u4e86 uint32 \u7684\u8868\u793a\u8303\u56f4\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528 uint64 \u8868\u793a\uff0cRedis \u652f\u6301 set \u96c6\u5408\u52a8\u6001\u4ece uint16 \u5347\u7ea7\u5230 uint32\uff0c\u518d\u5347\u7ea7\u5230 uint64\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16481f959cf105bc?w=742&h=207&f=png&s=16520)\n\n```\n127.0.0.1:6379> sadd hello 1 2 3\n(integer) 3\n127.0.0.1:6379> object encoding hello\n\"intset\"\n```\n\u5982\u679c set \u91cc\u5b58\u50a8\u7684\u662f\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48 sadd \u7acb\u5373\u5347\u7ea7\u4e3a hashtable \u7ed3\u6784\u3002\u8fd8\u8bb0\u5f97 Java \u7684 HashSet \u4e48\uff0c\u5b83\u5185\u90e8\u662f\u4f7f\u7528 HashMap \u5b9e\u73b0\u7684\u3002\n\n```\n127.0.0.1:6379> sadd hello yes no\n(integer) 2\n127.0.0.1:6379> object encoding hello\n\"hashtable\"\n```\n\n**\u5b58\u50a8\u754c\u9650**\n\u5f53\u96c6\u5408\u5bf9\u8c61\u7684\u5143\u7d20\u4e0d\u65ad\u589e\u52a0\uff0c\u6216\u8005\u67d0\u4e2a value \u503c\u8fc7\u5927\uff0c\u8fd9\u79cd\u5c0f\u5bf9\u8c61\u5b58\u50a8\u4e5f\u4f1a\u88ab\u5347\u7ea7\u4e3a\u6807\u51c6\u7ed3\u6784\u3002Redis \u89c4\u5b9a\u5728\u5c0f\u5bf9\u8c61\u5b58\u50a8\u7ed3\u6784\u7684\u9650\u5236\u6761\u4ef6\u5982\u4e0b\uff1a\n```\nhash-max-ziplist-entries 512  # hash \u7684\u5143\u7d20\u4e2a\u6570\u8d85\u8fc7 512 \u5c31\u5fc5\u987b\u7528\u6807\u51c6\u7ed3\u6784\u5b58\u50a8\nhash-max-ziplist-value 64  # hash \u7684\u4efb\u610f\u5143\u7d20\u7684 key/value \u7684\u957f\u5ea6\u8d85\u8fc7 64 \u5c31\u5fc5\u987b\u7528\u6807\u51c6\u7ed3\u6784\u5b58\u50a8\nlist-max-ziplist-entries 512  # list \u7684\u5143\u7d20\u4e2a\u6570\u8d85\u8fc7 512 \u5c31\u5fc5\u987b\u7528\u6807\u51c6\u7ed3\u6784\u5b58\u50a8\nlist-max-ziplist-value 64  # list \u7684\u4efb\u610f\u5143\u7d20\u7684\u957f\u5ea6\u8d85\u8fc7 64 \u5c31\u5fc5\u987b\u7528\u6807\u51c6\u7ed3\u6784\u5b58\u50a8\nzset-max-ziplist-entries 128  # zset \u7684\u5143\u7d20\u4e2a\u6570\u8d85\u8fc7 128 \u5c31\u5fc5\u987b\u7528\u6807\u51c6\u7ed3\u6784\u5b58\u50a8\nzset-max-ziplist-value 64  # zset \u7684\u4efb\u610f\u5143\u7d20\u7684\u957f\u5ea6\u8d85\u8fc7 64 \u5c31\u5fc5\u987b\u7528\u6807\u51c6\u7ed3\u6784\u5b58\u50a8\nset-max-intset-entries 512  # set \u7684\u6574\u6570\u5143\u7d20\u4e2a\u6570\u8d85\u8fc7 512 \u5c31\u5fc5\u987b\u7528\u6807\u51c6\u7ed3\u6784\u5b58\u50a8\n```\n\u63a5\u4e0b\u6765\u6211\u4eec\u505a\u4e00\u4e2a\u5c0f\u5b9e\u9a8c\uff0c\u770b\u770b\u8fd9\u91cc\u7684\u754c\u9650\u662f\u4e0d\u662f\u771f\u7684\u8d77\u5230\u4f5c\u7528\u4e86\u3002\n```\nimport redis\nclient = redis.StrictRedis()\nclient.delete(\"hello\")\nfor i in range(512):\n    client.hset(\"hello\", str(i), str(i))\nprint client.object(\"encoding\", \"hello\")  # \u83b7\u53d6\u5bf9\u8c61\u7684\u5b58\u50a8\u7ed3\u6784\nclient.hset(\"hello\", \"512\", \"512\")\nprint client.object(\"encoding\", \"hello\") # \u518d\u6b21\u83b7\u53d6\u5bf9\u8c61\u7684\u5b58\u50a8\u7ed3\u6784\n```\n\u8f93\u51fa\uff1a\n```\nziplist\nhashtable\n```\n\u53ef\u4ee5\u770b\u51fa\u6765\u5f53 hash \u7ed3\u6784\u7684\u5143\u7d20\u4e2a\u6570\u8d85\u8fc7 512 \u7684\u65f6\u5019\uff0c\u5b58\u50a8\u7ed3\u6784\u5c31\u53d1\u751f\u4e86\u53d8\u5316\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u8bd5\u8bd5\u9012\u589e value \u7684\u957f\u5ea6\uff0c\u5728 Python \u91cc\u9762\u5bf9\u5b57\u7b26\u4e32\u4e58\u4ee5\u4e00\u4e2a\u6574\u6570 n \u76f8\u5f53\u4e8e\u91cd\u590d n \u6b21\u3002\n```\nimport redis\nclient = redis.StrictRedis()\nclient.delete(\"hello\")\nfor i in range(64):\n    client.hset(\"hello\", str(i), \"0\" * (i+1))\nprint client.object(\"encoding\", \"hello\")  # \u83b7\u53d6\u5bf9\u8c61\u7684\u5b58\u50a8\u7ed3\u6784\nclient.hset(\"hello\", \"512\", \"0\" * 65)\nprint client.object(\"encoding\", \"hello\") # \u518d\u6b21\u83b7\u53d6\u5bf9\u8c61\u7684\u5b58\u50a8\u7ed3\u6784\n```\n\u8f93\u51fa\uff1a\n```\nziplist\nhashtable\n```\n\u53ef\u4ee5\u770b\u51fa\u6765\u5f53 hash \u7ed3\u6784\u7684\u4efb\u610f entry \u7684 value \u503c\u8d85\u8fc7\u4e86 64\uff0c\u5b58\u50a8\u7ed3\u6784\u5c31\u5347\u7ea7\u6210\u6807\u51c6\u7ed3\u6784\u4e86\u3002\n\n\u5185\u5b58\u56de\u6536\u673a\u5236\n--\nRedis \u5e76\u4e0d\u603b\u662f\u53ef\u4ee5\u5c06\u7a7a\u95f2\u5185\u5b58\u7acb\u5373\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u3002\n\n\u5982\u679c\u5f53\u524d Redis \u5185\u5b58\u6709 10G\uff0c\u5f53\u4f60\u5220\u9664\u4e86 1GB \u7684 key \u540e\uff0c\u518d\u53bb\u89c2\u5bdf\u5185\u5b58\uff0c\u4f60\u4f1a\u53d1\u73b0\u5185\u5b58\u53d8\u5316\u4e0d\u4f1a\u592a\u5927\u3002\u539f\u56e0\u662f\u64cd\u4f5c\u7cfb\u7edf\u56de\u6536\u5185\u5b58\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\uff0c\u5982\u679c\u8fd9\u4e2a\u9875\u4e0a\u53ea\u8981\u6709\u4e00\u4e2a key \u8fd8\u5728\u4f7f\u7528\uff0c\u90a3\u4e48\u5b83\u5c31\u4e0d\u80fd\u88ab\u56de\u6536\u3002Redis \u867d\u7136\u5220\u9664\u4e86 1GB \u7684 key\uff0c\u4f46\u662f\u8fd9\u4e9b key \u5206\u6563\u5230\u4e86\u5f88\u591a\u9875\u9762\u4e2d\uff0c\u6bcf\u4e2a\u9875\u9762\u90fd\u8fd8\u6709\u5176\u5b83 key \u5b58\u5728\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u5185\u5b58\u4e0d\u4f1a\u7acb\u5373\u88ab\u56de\u6536\u3002\n\n\u4e0d\u8fc7\uff0c\u5982\u679c\u4f60\u6267\u884c `flushdb`\uff0c\u7136\u540e\u518d\u89c2\u5bdf\u5185\u5b58\u4f1a\u53d1\u73b0\u5185\u5b58\u786e\u5b9e\u88ab\u56de\u6536\u4e86\u3002\u539f\u56e0\u662f\u6240\u6709\u7684 key \u90fd\u5e72\u6389\u4e86\uff0c\u5927\u90e8\u5206\u4e4b\u524d\u4f7f\u7528\u7684\u9875\u9762\u90fd\u5b8c\u5168\u5e72\u51c0\u4e86\uff0c\u4f1a\u7acb\u5373\u88ab\u64cd\u4f5c\u7cfb\u7edf\u56de\u6536\u3002\n\nRedis \u867d\u7136\u65e0\u6cd5\u4fdd\u8bc1\u7acb\u5373\u56de\u6536\u5df2\u7ecf\u5220\u9664\u7684 key \u7684\u5185\u5b58\uff0c\u4f46\u662f\u5b83\u4f1a\u91cd\u7528\u90a3\u4e9b\u5c1a\u672a\u56de\u6536\u7684\u7a7a\u95f2\u5185\u5b58\u3002\u8fd9\u5c31\u597d\u6bd4\u7535\u5f71\u9662\u91cc\u867d\u7136\u4eba\u8d70\u4e86\uff0c\u4f46\u662f\u5ea7\u4f4d\u8fd8\u5728\uff0c\u4e0b\u4e00\u6ce2\u89c2\u4f17\u6765\u4e86\uff0c\u76f4\u63a5\u5750\u5c31\u884c\u3002\u800c\u64cd\u4f5c\u7cfb\u7edf\u56de\u6536\u5185\u5b58\u5c31\u597d\u6bd4\u628a\u5ea7\u4f4d\u90fd\u7ed9\u642c\u8d70\u4e86\u3002\u8fd9\u4e2a\u6bd4\u55bb\u662f\u4e0d\u662f\u5f88 6\uff1f\n\n\u5185\u5b58\u5206\u914d\u7b97\u6cd5\n--\n\u5185\u5b58\u5206\u914d\u662f\u4e00\u4e2a\u975e\u5e38\u590d\u6742\u7684\u8bfe\u9898\uff0c\u9700\u8981\u9002\u5f53\u7684\u7b97\u6cd5\u5212\u5206\u5185\u5b58\u9875\uff0c\u9700\u8981\u8003\u8651\u5185\u5b58\u788e\u7247\uff0c\u9700\u8981\u5e73\u8861\u6027\u80fd\u548c\u6548\u7387\u3002\n\nRedis \u4e3a\u4e86\u4fdd\u6301\u81ea\u8eab\u7ed3\u6784\u7684\u7b80\u5355\u6027\uff0c\u5728\u5185\u5b58\u5206\u914d\u8fd9\u91cc\u76f4\u63a5\u505a\u4e86\u7529\u624b\u638c\u67dc\uff0c\u5c06\u5185\u5b58\u5206\u914d\u7684\u7ec6\u8282\u4e22\u7ed9\u4e86\u7b2c\u4e09\u65b9\u5185\u5b58\u5206\u914d\u5e93\u53bb\u5b9e\u73b0\u3002\u76ee\u524d Redis \u53ef\u4ee5\u4f7f\u7528 jemalloc(facebook) \u5e93\u6765\u7ba1\u7406\u5185\u5b58\uff0c\u4e5f\u53ef\u4ee5\u5207\u6362\u5230tcmalloc(google)\u3002\u56e0\u4e3a jemalloc \u76f8\u6bd4 tcmalloc\u7684\u6027\u80fd\u8981\u7a0d\u597d\u4e00\u4e9b\uff0c\u6240\u4ee5Redis\u9ed8\u8ba4\u4f7f\u7528\u4e86jemalloc\u3002 \n```\n127.0.0.1:6379> info memory\n# Memory\nused_memory:809608\nused_memory_human:790.63K\nused_memory_rss:8232960\nused_memory_peak:566296608\nused_memory_peak_human:540.06M\nused_memory_lua:36864\nmem_fragmentation_ratio:10.17\nmem_allocator:jemalloc-3.6.0\n```\n\u901a\u8fc7```info memory```\u6307\u4ee4\u53ef\u4ee5\u770b\u5230 Redis \u7684```mem_allocator```\u4f7f\u7528\u4e86 jemalloc\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n[jemalloc \u2014\u2014 \u5185\u5b58\u5206\u914d\u7684\u5965\u4e49](http://tinylab.org/memory-allocation-mystery-%C2%B7-jemalloc-a/)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/17\u539f\u7406_7\u5f00\u6e90\u8282\u6d41__\u5c0f\u5bf9\u8c61\u538b\u7f29.md", "create_date": "2020-02-18T03:01:05.730", "order": 18}}, {"model": "subject.chapter", "pk": 27, "fields": {"title": "18\u539f\u7406 8\uff1a\u6709\u5907\u65e0\u60a3 \u2014\u2014 \u4e3b\u4ece\u540c\u6b65", "topic": 2, "md5": "2bd9cc29dd930a1739029e88def262c4", "md_body": "# \u539f\u7406 8\uff1a\u6709\u5907\u65e0\u60a3 \u2014\u2014 \u4e3b\u4ece\u540c\u6b65\n\n\u5f88\u591a\u4f01\u4e1a\u90fd\u6ca1\u6709\u4f7f\u7528\u5230 Redis \u7684\u96c6\u7fa4\uff0c\u4f46\u662f\u81f3\u5c11\u90fd\u505a\u4e86\u4e3b\u4ece\u3002\u6709\u4e86\u4e3b\u4ece\uff0c\u5f53 master \u6302\u6389\u7684\u65f6\u5019\uff0c\u8fd0\u7ef4\u8ba9\u4ece\u5e93\u8fc7\u6765\u63a5\u7ba1\uff0c\u670d\u52a1\u5c31\u53ef\u4ee5\u7ee7\u7eed\uff0c\u5426\u5219 master \u9700\u8981\u7ecf\u8fc7\u6570\u636e\u6062\u590d\u548c\u91cd\u542f\u7684\u8fc7\u7a0b\uff0c\u8fd9\u5c31\u53ef\u80fd\u4f1a\u62d6\u5f88\u957f\u7684\u65f6\u95f4\uff0c\u5f71\u54cd\u7ebf\u4e0a\u4e1a\u52a1\u7684\u6301\u7eed\u670d\u52a1\u3002\n\n\u5728\u4e86\u89e3 Redis \u7684\u4e3b\u4ece\u590d\u5236\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5148\u6765\u7406\u89e3\u4e00\u4e0b\u73b0\u4ee3\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u7406\u8bba\u57fa\u77f3\u2014\u2014CAP \u539f\u7406\u3002\n\nCAP \u539f\u7406\n--\nCAP \u539f\u7406\u5c31\u597d\u6bd4\u5206\u5e03\u5f0f\u9886\u57df\u7684\u725b\u987f\u5b9a\u5f8b\uff0c\u5b83\u662f\u5206\u5e03\u5f0f\u5b58\u50a8\u7684\u7406\u8bba\u57fa\u77f3\u3002\u81ea\u6253 CAP \u7684\u8bba\u6587\u53d1\u8868\u4e4b\u540e\uff0c\u5206\u5e03\u5f0f\u5b58\u50a8\u4e2d\u95f4\u4ef6\u72b9\u5982\u96e8\u540e\u6625\u7b0b\u822c\u4e00\u4e2a\u4e00\u4e2a\u6d8c\u73b0\u51fa\u6765\u3002\u7406\u89e3\u8fd9\u4e2a\u539f\u7406\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u672c\u8282\u6211\u4eec\u9996\u5148\u5bf9\u8fd9\u4e2a\u539f\u7406\u8fdb\u884c\u4e00\u4e9b\u7b80\u5355\u7684\u8bb2\u89e3\u3002\n\n* **C** - Consistent \uff0c\u4e00\u81f4\u6027\n* **A** - Availability \uff0c\u53ef\u7528\u6027\n* **P** - Partition tolerance \uff0c\u5206\u533a\u5bb9\u5fcd\u6027\n\n\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u8282\u70b9\u5f80\u5f80\u90fd\u662f\u5206\u5e03\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u8fdb\u884c\u7f51\u7edc\u9694\u79bb\u5f00\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5fc5\u7136\u4f1a\u6709\u7f51\u7edc\u65ad\u5f00\u7684\u98ce\u9669\uff0c\u8fd9\u4e2a\u7f51\u7edc\u65ad\u5f00\u7684\u573a\u666f\u7684\u4e13\u4e1a\u8bcd\u6c47\u53eb\u7740\u300c**\u7f51\u7edc\u5206\u533a**\u300d\u3002\n\n\u5728\u7f51\u7edc\u5206\u533a\u53d1\u751f\u65f6\uff0c\u4e24\u4e2a\u5206\u5e03\u5f0f\u8282\u70b9\u4e4b\u95f4\u65e0\u6cd5\u8fdb\u884c\u901a\u4fe1\uff0c\u6211\u4eec\u5bf9\u4e00\u4e2a\u8282\u70b9\u8fdb\u884c\u7684\u4fee\u6539\u64cd\u4f5c\u5c06\u65e0\u6cd5\u540c\u6b65\u5230\u53e6\u5916\u4e00\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u6570\u636e\u7684\u300c**\u4e00\u81f4\u6027**\u300d\u5c06\u65e0\u6cd5\u6ee1\u8db3\uff0c\u56e0\u4e3a\u4e24\u4e2a\u5206\u5e03\u5f0f\u8282\u70b9\u7684\u6570\u636e\u4e0d\u518d\u4fdd\u6301\u4e00\u81f4\u3002\u9664\u975e\u6211\u4eec\u727a\u7272\u300c**\u53ef\u7528\u6027**\u300d\uff0c\u4e5f\u5c31\u662f\u6682\u505c\u5206\u5e03\u5f0f\u8282\u70b9\u670d\u52a1\uff0c\u5728\u7f51\u7edc\u5206\u533a\u53d1\u751f\u65f6\uff0c\u4e0d\u518d\u63d0\u4f9b\u4fee\u6539\u6570\u636e\u7684\u529f\u80fd\uff0c\u76f4\u5230\u7f51\u7edc\u72b6\u51b5\u5b8c\u5168\u6062\u590d\u6b63\u5e38\u518d\u7ee7\u7eed\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/164642389477ff9e?w=538&h=391&f=png&s=25993)\n\n\u4e00\u53e5\u8bdd\u6982\u62ec CAP \u539f\u7406\u5c31\u662f\u2014\u2014**\u7f51\u7edc\u5206\u533a\u53d1\u751f\u65f6\uff0c\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u4e24\u96be\u5168**\u3002\n\n\u6700\u7ec8\u4e00\u81f4\n--\nRedis \u7684\u4e3b\u4ece\u6570\u636e\u662f\u5f02\u6b65\u540c\u6b65\u7684\uff0c\u6240\u4ee5\u5206\u5e03\u5f0f\u7684 Redis \u7cfb\u7edf\u5e76\u4e0d\u6ee1\u8db3\u300c**\u4e00\u81f4\u6027**\u300d\u8981\u6c42\u3002\u5f53\u5ba2\u6237\u7aef\u5728 Redis \u7684\u4e3b\u8282\u70b9\u4fee\u6539\u4e86\u6570\u636e\u540e\uff0c\u7acb\u5373\u8fd4\u56de\uff0c\u5373\u4f7f\u5728\u4e3b\u4ece\u7f51\u7edc\u65ad\u5f00\u7684\u60c5\u51b5\u4e0b\uff0c\u4e3b\u8282\u70b9\u4f9d\u65e7\u53ef\u4ee5\u6b63\u5e38\u5bf9\u5916\u63d0\u4f9b\u4fee\u6539\u670d\u52a1\uff0c\u6240\u4ee5 Redis \u6ee1\u8db3\u300c**\u53ef\u7528\u6027**\u300d\u3002\n\nRedis \u4fdd\u8bc1\u300c**\u6700\u7ec8\u4e00\u81f4\u6027**\u300d\uff0c\u4ece\u8282\u70b9\u4f1a\u52aa\u529b\u8ffd\u8d76\u4e3b\u8282\u70b9\uff0c\u6700\u7ec8\u4ece\u8282\u70b9\u7684\u72b6\u6001\u4f1a\u548c\u4e3b\u8282\u70b9\u7684\u72b6\u6001\u5c06\u4fdd\u6301\u4e00\u81f4\u3002\u5982\u679c\u7f51\u7edc\u65ad\u5f00\u4e86\uff0c\u4e3b\u4ece\u8282\u70b9\u7684\u6570\u636e\u5c06\u4f1a\u51fa\u73b0\u5927\u91cf\u4e0d\u4e00\u81f4\uff0c\u4e00\u65e6\u7f51\u7edc\u6062\u590d\uff0c\u4ece\u8282\u70b9\u4f1a\u91c7\u7528\u591a\u79cd\u7b56\u7565\u52aa\u529b\u8ffd\u8d76\u4e0a\u843d\u540e\u7684\u6570\u636e\uff0c\u7ee7\u7eed\u5c3d\u529b\u4fdd\u6301\u548c\u4e3b\u8282\u70b9\u4e00\u81f4\u3002\n\n\u4e3b\u4ece\u540c\u6b65\n--\nRedis \u540c\u6b65\u652f\u6301\u4e3b\u4ece\u540c\u6b65\u548c\u4ece\u4ece\u540c\u6b65\uff0c\u4ece\u4ece\u540c\u6b65\u529f\u80fd\u662f Redis \u540e\u7eed\u7248\u672c\u589e\u52a0\u7684\u529f\u80fd\uff0c\u4e3a\u4e86\u51cf\u8f7b\u4e3b\u5e93\u7684\u540c\u6b65\u8d1f\u62c5\u3002\u540e\u9762\u4e3a\u4e86\u63cf\u8ff0\u4e0a\u7684\u65b9\u4fbf\uff0c\u7edf\u4e00\u7406\u89e3\u4e3a\u4e3b\u4ece\u540c\u6b65\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/164641d454a0e67a?w=575&h=238&f=png&s=23174)\n\n\u589e\u91cf\u540c\u6b65\n--\nRedis \u540c\u6b65\u7684\u662f\u6307\u4ee4\u6d41\uff0c\u4e3b\u8282\u70b9\u4f1a\u5c06\u90a3\u4e9b\u5bf9\u81ea\u5df1\u7684\u72b6\u6001\u4ea7\u751f\u4fee\u6539\u6027\u5f71\u54cd\u7684\u6307\u4ee4\u8bb0\u5f55\u5728\u672c\u5730\u7684\u5185\u5b58 buffer \u4e2d\uff0c\u7136\u540e\u5f02\u6b65\u5c06 buffer \u4e2d\u7684\u6307\u4ee4\u540c\u6b65\u5230\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u4e00\u8fb9\u6267\u884c\u540c\u6b65\u7684\u6307\u4ee4\u6d41\u6765\u8fbe\u5230\u548c\u4e3b\u8282\u70b9\u4e00\u6837\u7684\u72b6\u6001\uff0c\u4e00\u8fb9\u5411\u4e3b\u8282\u70b9\u53cd\u9988\u81ea\u5df1\u540c\u6b65\u5230\u54ea\u91cc\u4e86 (\u504f\u79fb\u91cf)\u3002\n\n\u56e0\u4e3a\u5185\u5b58\u7684 buffer \u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5 Redis \u4e3b\u5e93\u4e0d\u80fd\u5c06\u6240\u6709\u7684\u6307\u4ee4\u90fd\u8bb0\u5f55\u5728\u5185\u5b58 buffer \u4e2d\u3002Redis \u7684\u590d\u5236\u5185\u5b58 buffer \u662f\u4e00\u4e2a\u5b9a\u957f\u7684\u73af\u5f62\u6570\u7ec4\uff0c\u5982\u679c\u6570\u7ec4\u5185\u5bb9\u6ee1\u4e86\uff0c\u5c31\u4f1a\u4ece\u5934\u5f00\u59cb\u8986\u76d6\u524d\u9762\u7684\u5185\u5bb9\u3002\n![](https://user-gold-cdn.xitu.io/2018/5/21/16381ba1db76a768?w=217&h=211&f=png&s=22717)\n\n\u5982\u679c\u56e0\u4e3a\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u4ece\u8282\u70b9\u5728\u77ed\u65f6\u95f4\u5185\u65e0\u6cd5\u548c\u4e3b\u8282\u70b9\u8fdb\u884c\u540c\u6b65\uff0c\u90a3\u4e48\u5f53\u7f51\u7edc\u72b6\u51b5\u6062\u590d\u65f6\uff0cRedis \u7684\u4e3b\u8282\u70b9\u4e2d\u90a3\u4e9b\u6ca1\u6709\u540c\u6b65\u7684\u6307\u4ee4\u5728 buffer \u4e2d\u6709\u53ef\u80fd\u5df2\u7ecf\u88ab\u540e\u7eed\u7684\u6307\u4ee4\u8986\u76d6\u6389\u4e86\uff0c\u4ece\u8282\u70b9\u5c06\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u6307\u4ee4\u6d41\u6765\u8fdb\u884c\u540c\u6b65\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u7528\u5230\u66f4\u52a0\u590d\u6742\u7684\u540c\u6b65\u673a\u5236 \u2014\u2014 \u5feb\u7167\u540c\u6b65\u3002\n\n\u5feb\u7167\u540c\u6b65\n--\n\u5feb\u7167\u540c\u6b65\u662f\u4e00\u4e2a\u975e\u5e38\u8017\u8d39\u8d44\u6e90\u7684\u64cd\u4f5c\uff0c\u5b83\u9996\u5148\u9700\u8981\u5728\u4e3b\u5e93\u4e0a\u8fdb\u884c\u4e00\u6b21 bgsave \u5c06\u5f53\u524d\u5185\u5b58\u7684\u6570\u636e\u5168\u90e8\u5feb\u7167\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u518d\u5c06\u5feb\u7167\u6587\u4ef6\u7684\u5185\u5bb9\u5168\u90e8\u4f20\u9001\u5230\u4ece\u8282\u70b9\u3002\u4ece\u8282\u70b9\u5c06\u5feb\u7167\u6587\u4ef6\u63a5\u53d7\u5b8c\u6bd5\u540e\uff0c\u7acb\u5373\u6267\u884c\u4e00\u6b21\u5168\u91cf\u52a0\u8f7d\uff0c\u52a0\u8f7d\u4e4b\u524d\u5148\u8981\u5c06\u5f53\u524d\u5185\u5b58\u7684\u6570\u636e\u6e05\u7a7a\u3002\u52a0\u8f7d\u5b8c\u6bd5\u540e\u901a\u77e5\u4e3b\u8282\u70b9\u7ee7\u7eed\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u3002\n\n\u5728\u6574\u4e2a\u5feb\u7167\u540c\u6b65\u8fdb\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8282\u70b9\u7684\u590d\u5236 buffer \u8fd8\u5728\u4e0d\u505c\u7684\u5f80\u524d\u79fb\u52a8\uff0c\u5982\u679c\u5feb\u7167\u540c\u6b65\u7684\u65f6\u95f4\u8fc7\u957f\u6216\u8005\u590d\u5236 buffer \u592a\u5c0f\uff0c\u90fd\u4f1a\u5bfc\u81f4\u540c\u6b65\u671f\u95f4\u7684\u589e\u91cf\u6307\u4ee4\u5728\u590d\u5236 buffer \u4e2d\u88ab\u8986\u76d6\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u5feb\u7167\u540c\u6b65\u5b8c\u6210\u540e\u65e0\u6cd5\u8fdb\u884c\u589e\u91cf\u590d\u5236\uff0c\u7136\u540e\u4f1a\u518d\u6b21\u53d1\u8d77\u5feb\u7167\u540c\u6b65\uff0c\u5982\u6b64\u6781\u6709\u53ef\u80fd\u4f1a\u9677\u5165\u5feb\u7167\u540c\u6b65\u7684\u6b7b\u5faa\u73af\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/164641fbae932002?w=610&h=258&f=png&s=17606)\n\n\u6240\u4ee5\u52a1\u5fc5\u914d\u7f6e\u4e00\u4e2a\u5408\u9002\u7684\u590d\u5236 buffer \u5927\u5c0f\u53c2\u6570\uff0c\u907f\u514d\u5feb\u7167\u590d\u5236\u7684\u6b7b\u5faa\u73af\u3002\n\n\u589e\u52a0\u4ece\u8282\u70b9\n--\n\u5f53\u4ece\u8282\u70b9\u521a\u521a\u52a0\u5165\u5230\u96c6\u7fa4\u65f6\uff0c\u5b83\u5fc5\u987b\u5148\u8981\u8fdb\u884c\u4e00\u6b21\u5feb\u7167\u540c\u6b65\uff0c\u540c\u6b65\u5b8c\u6210\u540e\u518d\u7ee7\u7eed\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u3002\n\n\u65e0\u76d8\u590d\u5236\n--\n\u4e3b\u8282\u70b9\u5728\u8fdb\u884c\u5feb\u7167\u540c\u6b65\u65f6\uff0c\u4f1a\u8fdb\u884c\u5f88\u91cd\u7684\u6587\u4ef6 IO \u64cd\u4f5c\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u975e SSD \u78c1\u76d8\u5b58\u50a8\u65f6\uff0c\u5feb\u7167\u4f1a\u5bf9\u7cfb\u7edf\u7684\u8d1f\u8f7d\u4ea7\u751f\u8f83\u5927\u5f71\u54cd\u3002\u7279\u522b\u662f\u5f53\u7cfb\u7edf\u6b63\u5728\u8fdb\u884c AOF \u7684 fsync \u64cd\u4f5c\u65f6\u5982\u679c\u53d1\u751f\u5feb\u7167\uff0cfsync \u5c06\u4f1a\u88ab\u63a8\u8fdf\u6267\u884c\uff0c\u8fd9\u5c31\u4f1a\u4e25\u91cd\u5f71\u54cd\u4e3b\u8282\u70b9\u7684\u670d\u52a1\u6548\u7387\u3002\n\n\u6240\u4ee5\u4ece Redis 2.8.18 \u7248\u5f00\u59cb\u652f\u6301\u65e0\u76d8\u590d\u5236\u3002\u6240\u8c13\u65e0\u76d8\u590d\u5236\u662f\u6307\u4e3b\u670d\u52a1\u5668\u76f4\u63a5\u901a\u8fc7\u5957\u63a5\u5b57\u5c06\u5feb\u7167\u5185\u5bb9\u53d1\u9001\u5230\u4ece\u8282\u70b9\uff0c\u751f\u6210\u5feb\u7167\u662f\u4e00\u4e2a\u904d\u5386\u7684\u8fc7\u7a0b\uff0c\u4e3b\u8282\u70b9\u4f1a\u4e00\u8fb9\u904d\u5386\u5185\u5b58\uff0c\u4e00\u8fb9\u5c06\u5e8f\u5217\u5316\u7684\u5185\u5bb9\u53d1\u9001\u5230\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u8fd8\u662f\u8ddf\u4e4b\u524d\u4e00\u6837\uff0c\u5148\u5c06\u63a5\u6536\u5230\u7684\u5185\u5bb9\u5b58\u50a8\u5230\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u6027\u52a0\u8f7d\u3002\n\nWait \u6307\u4ee4\n--\nRedis \u7684\u590d\u5236\u662f\u5f02\u6b65\u8fdb\u884c\u7684\uff0cwait \u6307\u4ee4\u53ef\u4ee5\u8ba9\u5f02\u6b65\u590d\u5236\u53d8\u8eab\u540c\u6b65\u590d\u5236\uff0c\u786e\u4fdd\u7cfb\u7edf\u7684\u5f3a\u4e00\u81f4\u6027 (\u4e0d\u4e25\u683c)\u3002wait \u6307\u4ee4\u662f Redis3.0 \u7248\u672c\u4ee5\u540e\u624d\u51fa\u73b0\u7684\u3002\n```\n> set key value\nOK\n> wait 1 0\n(integer) 1\n```\nwait \u63d0\u4f9b\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4ece\u5e93\u7684\u6570\u91cf N\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u65f6\u95f4 t\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002\u5b83\u8868\u793a\u7b49\u5f85 wait \u6307\u4ee4\u4e4b\u524d\u7684\u6240\u6709\u5199\u64cd\u4f5c\u540c\u6b65\u5230 N \u4e2a\u4ece\u5e93 (\u4e5f\u5c31\u662f\u786e\u4fdd N \u4e2a\u4ece\u5e93\u7684\u540c\u6b65\u6ca1\u6709\u6ede\u540e)\uff0c\u6700\u591a\u7b49\u5f85\u65f6\u95f4 t\u3002\u5982\u679c\u65f6\u95f4 t=0\uff0c\u8868\u793a\u65e0\u9650\u7b49\u5f85\u76f4\u5230 N \u4e2a\u4ece\u5e93\u540c\u6b65\u5b8c\u6210\u8fbe\u6210\u4e00\u81f4\u3002\n\n\u5047\u8bbe\u6b64\u65f6\u51fa\u73b0\u4e86\u7f51\u7edc\u5206\u533a\uff0cwait \u6307\u4ee4\u7b2c\u4e8c\u4e2a\u53c2\u6570\u65f6\u95f4 t=0\uff0c\u4e3b\u4ece\u540c\u6b65\u65e0\u6cd5\u7ee7\u7eed\u8fdb\u884c\uff0cwait \u6307\u4ee4\u4f1a\u6c38\u8fdc\u963b\u585e\uff0cRedis \u670d\u52a1\u5668\u5c06\u4e27\u5931\u53ef\u7528\u6027\u3002\n\n## \u5c0f\u7ed3\n\n\u4e3b\u4ece\u590d\u5236\u662f Redis \u5206\u5e03\u5f0f\u7684\u57fa\u7840\uff0cRedis \u7684\u9ad8\u53ef\u7528\u79bb\u5f00\u4e86\u4e3b\u4ece\u590d\u5236\u5c06\u65e0\u4ece\u8fdb\u884c\u3002\u540e\u9762\u7684\u7ae0\u8282\u6211\u4eec\u4f1a\u5f00\u59cb\u8bb2\u89e3 Redis \u7684\u96c6\u7fa4\u6a21\u5f0f\uff0c\u8fd9\u51e0\u79cd\u96c6\u7fa4\u6a21\u5f0f\u90fd\u4f9d\u8d56\u4e8e\u672c\u8282\u6240\u8bb2\u7684\u4e3b\u4ece\u590d\u5236\u3002\n\n\u4e0d\u8fc7\u590d\u5236\u529f\u80fd\u4e5f\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u5982\u679c\u4f60\u5c06 Redis \u53ea\u7528\u6765\u505a\u7f13\u5b58\uff0c\u8ddf memcache \u4e00\u6837\u6765\u5bf9\u5f85\uff0c\u4e5f\u5c31\u65e0\u9700\u8981\u4ece\u5e93\u505a\u5907\u4efd\uff0c\u6302\u6389\u4e86\u91cd\u65b0\u542f\u52a8\u4e00\u4e0b\u5c31\u884c\u3002\u4f46\u662f\u53ea\u8981\u4f60\u4f7f\u7528\u4e86 Redis \u7684\u6301\u4e45\u5316\u529f\u80fd\uff0c\u5c31\u5fc5\u987b\u8ba4\u771f\u5bf9\u5f85\u4e3b\u4ece\u590d\u5236\uff0c\u5b83\u662f\u7cfb\u7edf\u6570\u636e\u5b89\u5168\u7684\u57fa\u7840\u4fdd\u969c\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/18\u539f\u7406_8\u6709\u5907\u65e0\u60a3__\u4e3b\u4ece\u540c\u6b65.md", "create_date": "2020-02-18T03:01:05.750", "order": 19}}, {"model": "subject.chapter", "pk": 28, "fields": {"title": "24\u62d3\u5c55 3\uff1a\u62fe\u9057\u8865\u6f0f \u2014\u2014 \u518d\u8c08\u5206\u5e03\u5f0f\u9501", "topic": 2, "md5": "8614af0d148b970eb37a79f69206aeea", "md_body": "# \u62d3\u5c55 3\uff1a\u62fe\u9057\u6f0f\u8865 \u2014\u2014 \u518d\u8c08\u5206\u5e03\u5f0f\u9501\n\n\u5728\u7b2c\u4e09\u8282\uff0c\u6211\u4eec\u7ec6\u81f4\u8bb2\u89e3\u4e86\u5206\u5e03\u5f0f\u9501\u7684\u539f\u7406\uff0c\u5b83\u7684\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u4e00\u6761\u6307\u4ee4\u5c31\u53ef\u4ee5\u5b8c\u6210\u52a0\u9501\u64cd\u4f5c\u3002\u4e0d\u8fc7\u5728\u96c6\u7fa4\u73af\u5883\u4e0b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u6709\u7f3a\u9677\u7684\uff0c\u5b83\u4e0d\u662f\u7edd\u5bf9\u5b89\u5168\u7684\u3002\n\n\u6bd4\u5982\u5728 Sentinel \u96c6\u7fa4\u4e2d\uff0c\u4e3b\u8282\u70b9\u6302\u6389\u65f6\uff0c\u4ece\u8282\u70b9\u4f1a\u53d6\u800c\u4ee3\u4e4b\uff0c\u5ba2\u6237\u7aef\u4e0a\u5374\u5e76\u6ca1\u6709\u660e\u663e\u611f\u77e5\u3002\u539f\u5148\u7b2c\u4e00\u4e2a\u5ba2\u6237\u7aef\u5728\u4e3b\u8282\u70b9\u4e2d\u7533\u8bf7\u6210\u529f\u4e86\u4e00\u628a\u9501\uff0c\u4f46\u662f\u8fd9\u628a\u9501\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u540c\u6b65\u5230\u4ece\u8282\u70b9\uff0c\u4e3b\u8282\u70b9\u7a81\u7136\u6302\u6389\u4e86\u3002\u7136\u540e\u4ece\u8282\u70b9\u53d8\u6210\u4e86\u4e3b\u8282\u70b9\uff0c\u8fd9\u4e2a\u65b0\u7684\u8282\u70b9\u5185\u90e8\u6ca1\u6709\u8fd9\u4e2a\u9501\uff0c\u6240\u4ee5\u5f53\u53e6\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fc7\u6765\u8bf7\u6c42\u52a0\u9501\u65f6\uff0c\u7acb\u5373\u5c31\u6279\u51c6\u4e86\u3002\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u4e2d\u540c\u6837\u4e00\u628a\u9501\u88ab\u4e24\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u6301\u6709\uff0c\u4e0d\u5b89\u5168\u6027\u7531\u6b64\u4ea7\u751f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/16/164a15b65d4cd15a?w=738&h=313&f=png&s=29799)\n\n\u4e0d\u8fc7\u8fd9\u79cd\u4e0d\u5b89\u5168\u4e5f\u4ec5\u4ec5\u662f\u5728\u4e3b\u4ece\u53d1\u751f failover \u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u4ea7\u751f\uff0c\u800c\u4e14\u6301\u7eed\u65f6\u95f4\u6781\u77ed\uff0c\u4e1a\u52a1\u7cfb\u7edf\u591a\u6570\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5bb9\u5fcd\u3002\n\n## Redlock \u7b97\u6cd5\n\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cAntirez \u53d1\u660e\u4e86 Redlock \u7b97\u6cd5\uff0c\u5b83\u7684\u6d41\u7a0b\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u8fc7\u5df2\u7ecf\u6709\u4e86\u5f88\u591a\u5f00\u6e90\u7684 library \u505a\u4e86\u826f\u597d\u7684\u5c01\u88c5\uff0c\u7528\u6237\u53ef\u4ee5\u62ff\u6765\u5373\u7528\uff0c\u6bd4\u5982 redlock-py\u3002\n\n```py\nimport redlock\n\naddrs = [{\n    \"host\": \"localhost\",\n    \"port\": 6379,\n    \"db\": 0\n}, {\n    \"host\": \"localhost\",\n    \"port\": 6479,\n    \"db\": 0\n}, {\n    \"host\": \"localhost\",\n    \"port\": 6579,\n    \"db\": 0\n}]\ndlm = redlock.Redlock(addrs)\nsuccess = dlm.lock(\"user-lck-laoqian\", 5000)\nif success:\n    print 'lock success'\n    dlm.unlock('user-lck-laoqian')\nelse:\n    print 'lock failed'\n```\n\u4e3a\u4e86\u4f7f\u7528 Redlock\uff0c\u9700\u8981\u63d0\u4f9b\u591a\u4e2a Redis \u5b9e\u4f8b\uff0c\u8fd9\u4e9b\u5b9e\u4f8b\u4e4b\u524d\u76f8\u4e92\u72ec\u7acb\u6ca1\u6709\u4e3b\u4ece\u5173\u7cfb\u3002\u540c\u5f88\u591a\u5206\u5e03\u5f0f\u7b97\u6cd5\u4e00\u6837\uff0credlock \u4e5f\u4f7f\u7528\u300c\u5927\u591a\u6570\u673a\u5236\u300d\u3002\n\n\u52a0\u9501\u65f6\uff0c\u5b83\u4f1a\u5411\u8fc7\u534a\u8282\u70b9\u53d1\u9001 `set(key, value, nx=True, ex=xxx)` \u6307\u4ee4\uff0c\u53ea\u8981\u8fc7\u534a\u8282\u70b9 `set` \u6210\u529f\uff0c\u90a3\u5c31\u8ba4\u4e3a\u52a0\u9501\u6210\u529f\u3002\u91ca\u653e\u9501\u65f6\uff0c\u9700\u8981\u5411\u6240\u6709\u8282\u70b9\u53d1\u9001 `del` \u6307\u4ee4\u3002\u4e0d\u8fc7 Redlock \u7b97\u6cd5\u8fd8\u9700\u8981\u8003\u8651\u51fa\u9519\u91cd\u8bd5\u3001\u65f6\u949f\u6f02\u79fb\u7b49\u5f88\u591a\u7ec6\u8282\u95ee\u9898\uff0c\u540c\u65f6\u56e0\u4e3a Redlock \u9700\u8981\u5411\u591a\u4e2a\u8282\u70b9\u8fdb\u884c\u8bfb\u5199\uff0c\u610f\u5473\u7740\u76f8\u6bd4\u5355\u5b9e\u4f8b Redis \u6027\u80fd\u4f1a\u4e0b\u964d\u4e00\u4e9b\u3002\n\n## Redlock \u4f7f\u7528\u573a\u666f\n\n\u5982\u679c\u4f60\u5f88\u5728\u4e4e\u9ad8\u53ef\u7528\u6027\uff0c\u5e0c\u671b\u6302\u4e86\u4e00\u53f0 redis \u5b8c\u5168\u4e0d\u53d7\u5f71\u54cd\uff0c\u90a3\u5c31\u5e94\u8be5\u8003\u8651 redlock\u3002\u4e0d\u8fc7\u4ee3\u4ef7\u4e5f\u662f\u6709\u7684\uff0c\u9700\u8981\u66f4\u591a\u7684 redis \u5b9e\u4f8b\uff0c\u6027\u80fd\u4e5f\u4e0b\u964d\u4e86\uff0c\u4ee3\u7801\u4e0a\u8fd8\u9700\u8981\u5f15\u5165\u989d\u5916\u7684 library\uff0c\u8fd0\u7ef4\u4e0a\u4e5f\u9700\u8981\u7279\u6b8a\u5bf9\u5f85\uff0c\u8fd9\u4e9b\u90fd\u662f\u9700\u8981\u8003\u8651\u7684\u6210\u672c\uff0c\u4f7f\u7528\u524d\u8bf7\u518d\u4e09\u659f\u914c\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n#### 1. [\u4f60\u4ee5\u4e3a Redlock \u7b97\u6cd5\u771f\u7684\u5f88\u5b8c\u7f8e\uff1f](http://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html)\n#### 2. Redlock-py \u7684\u4f5c\u8005\u5176\u4eba\u8da3\u4e8b\n\n![](https://user-gold-cdn.xitu.io/2018/7/16/164a1a0f66dcffb2?w=211&h=211&f=jpeg&s=8166)\n\n\u770b\u5934\u50cf\u975e\u5e38\u9177\uff0c\u8fd9\u4f4d\u8001\u54e5\u7684 Github \u5730\u5740\u662f [https://github.com/optimuspaul](https://github.com/optimuspaul)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/24\u62d3\u5c55_3\u62fe\u9057\u8865\u6f0f__\u518d\u8c08\u5206\u5e03\u5f0f\u9501.md", "create_date": "2020-02-18T03:01:05.847", "order": 25}}, {"model": "subject.chapter", "pk": 29, "fields": {"title": "21\u96c6\u7fa4 3\uff1a\u4f17\u5fd7\u6210\u57ce \u2014\u2014 Cluster", "topic": 2, "md5": "499d88e7a7945ee44e749319460f5f24", "md_body": "\n# \u96c6\u7fa4 3\uff1a\u4f17\u5fd7\u6210\u57ce \u2014\u2014 Cluster\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163afa911c3118fa?w=299&h=194&f=png&s=27566)\nRedisCluster \u662f Redis \u7684\u4eb2\u513f\u5b50\uff0c\u5b83\u662f Redis \u4f5c\u8005\u81ea\u5df1\u63d0\u4f9b\u7684 Redis \u96c6\u7fa4\u5316\u65b9\u6848\u3002\n\n\u76f8\u5bf9\u4e8e Codis \u7684\u4e0d\u540c\uff0c\u5b83\u662f\u53bb\u4e2d\u5fc3\u5316\u7684\uff0c\u5982\u56fe\u6240\u793a\uff0c\u8be5\u96c6\u7fa4\u6709\u4e09\u4e2a Redis \u8282\u70b9\u7ec4\u6210\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u6574\u4e2a\u96c6\u7fa4\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u7684\u6570\u636e\u591a\u5c11\u53ef\u80fd\u4e0d\u4e00\u6837\u3002\u8fd9\u4e09\u4e2a\u8282\u70b9\u76f8\u4e92\u8fde\u63a5\u7ec4\u6210\u4e00\u4e2a\u5bf9\u7b49\u7684\u96c6\u7fa4\uff0c\u5b83\u4eec\u4e4b\u95f4\u901a\u8fc7\u4e00\u79cd\u7279\u6b8a\u7684\u4e8c\u8fdb\u5236\u534f\u8bae\u76f8\u4e92\u4ea4\u4e92\u96c6\u7fa4\u4fe1\u606f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16481f3bd5ca1577?w=915&h=446&f=png&s=28479)\n\nRedis Cluster \u5c06\u6240\u6709\u6570\u636e\u5212\u5206\u4e3a 16384 \u7684 slots\uff0c\u5b83\u6bd4 Codis \u7684 1024 \u4e2a\u69fd\u5212\u5206\u7684\u66f4\u4e3a\u7cbe\u7ec6\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u5176\u4e2d\u4e00\u90e8\u5206\u69fd\u4f4d\u3002\u69fd\u4f4d\u7684\u4fe1\u606f\u5b58\u50a8\u4e8e\u6bcf\u4e2a\u8282\u70b9\u4e2d\uff0c\u5b83\u4e0d\u50cf Codis\uff0c\u5b83\u4e0d\u9700\u8981\u53e6\u5916\u7684\u5206\u5e03\u5f0f\u5b58\u50a8\u6765\u5b58\u50a8\u8282\u70b9\u69fd\u4f4d\u4fe1\u606f\u3002\n\n\u5f53 Redis Cluster \u7684\u5ba2\u6237\u7aef\u6765\u8fde\u63a5\u96c6\u7fa4\u65f6\uff0c\u5b83\u4e5f\u4f1a\u5f97\u5230\u4e00\u4efd\u96c6\u7fa4\u7684\u69fd\u4f4d\u914d\u7f6e\u4fe1\u606f\u3002\u8fd9\u6837\u5f53\u5ba2\u6237\u7aef\u8981\u67e5\u627e\u67d0\u4e2a key \u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u5b9a\u4f4d\u5230\u76ee\u6807\u8282\u70b9\u3002\n\n\u8fd9\u70b9\u4e0d\u540c\u4e8e Codis\uff0cCodis \u9700\u8981\u901a\u8fc7 Proxy \u6765\u5b9a\u4f4d\u76ee\u6807\u8282\u70b9\uff0cRedisCluster \u662f\u76f4\u63a5\u5b9a\u4f4d\u3002\u5ba2\u6237\u7aef\u4e3a\u4e86\u53ef\u4ee5\u76f4\u63a5\u5b9a\u4f4d\u67d0\u4e2a\u5177\u4f53\u7684 key \u6240\u5728\u7684\u8282\u70b9\uff0c\u5b83\u5c31\u9700\u8981\u7f13\u5b58\u69fd\u4f4d\u76f8\u5173\u4fe1\u606f\uff0c\u8fd9\u6837\u624d\u53ef\u4ee5\u51c6\u786e\u5feb\u901f\u5730\u5b9a\u4f4d\u5230\u76f8\u5e94\u7684\u8282\u70b9\u3002\u540c\u65f6\u56e0\u4e3a\u69fd\u4f4d\u7684\u4fe1\u606f\u53ef\u80fd\u4f1a\u5b58\u5728\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u8fd8\u9700\u8981\u7ea0\u6b63\u673a\u5236\u6765\u5b9e\u73b0\u69fd\u4f4d\u4fe1\u606f\u7684\u6821\u9a8c\u8c03\u6574\u3002\n\n\u53e6\u5916\uff0cRedisCluster \u7684\u6bcf\u4e2a\u8282\u70b9\u4f1a\u5c06\u96c6\u7fa4\u7684\u914d\u7f6e\u4fe1\u606f\u6301\u4e45\u5316\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6240\u4ee5\u5fc5\u987b\u786e\u4fdd\u914d\u7f6e\u6587\u4ef6\u662f\u53ef\u5199\u7684\uff0c\u800c\u4e14\u5c3d\u91cf\u4e0d\u8981\u4f9d\u9760\u4eba\u5de5\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u3002\n\n\u69fd\u4f4d\u5b9a\u4f4d\u7b97\u6cd5\n--\nCluster \u9ed8\u8ba4\u4f1a\u5bf9 key \u503c\u4f7f\u7528 crc16 \u7b97\u6cd5\u8fdb\u884c hash \u5f97\u5230\u4e00\u4e2a\u6574\u6570\u503c\uff0c\u7136\u540e\u7528\u8fd9\u4e2a\u6574\u6570\u503c\u5bf9 16384 \u8fdb\u884c\u53d6\u6a21\u6765\u5f97\u5230\u5177\u4f53\u69fd\u4f4d\u3002\n\nCluster \u8fd8\u5141\u8bb8\u7528\u6237\u5f3a\u5236\u67d0\u4e2a key \u6302\u5728\u7279\u5b9a\u69fd\u4f4d\u4e0a\uff0c\u901a\u8fc7\u5728 key \u5b57\u7b26\u4e32\u91cc\u9762\u5d4c\u5165 tag \u6807\u8bb0\uff0c\u8fd9\u5c31\u53ef\u4ee5\u5f3a\u5236 key \u6240\u6302\u5728\u7684\u69fd\u4f4d\u7b49\u4e8e tag \u6240\u5728\u7684\u69fd\u4f4d\u3002\n\n```ruby\ndef HASH_SLOT(key)\n    s = key.index \"{\"\n    if s\n        e = key.index \"}\",s+1\n        if e && e != s+1\n            key = key[s+1..e-1]\n        end\n    end\n    crc16(key) % 16384\nend\n```\n\n\u8df3\u8f6c\n--\n\u5f53\u5ba2\u6237\u7aef\u5411\u4e00\u4e2a\u9519\u8bef\u7684\u8282\u70b9\u53d1\u51fa\u4e86\u6307\u4ee4\uff0c\u8be5\u8282\u70b9\u4f1a\u53d1\u73b0\u6307\u4ee4\u7684 key \u6240\u5728\u7684\u69fd\u4f4d\u5e76\u4e0d\u5f52\u81ea\u5df1\u7ba1\u7406\uff0c\u8fd9\u65f6\u5b83\u4f1a\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u7279\u6b8a\u7684\u8df3\u8f6c\u6307\u4ee4\u643a\u5e26\u76ee\u6807\u64cd\u4f5c\u7684\u8282\u70b9\u5730\u5740\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u53bb\u8fde\u8fd9\u4e2a\u8282\u70b9\u53bb\u83b7\u53d6\u6570\u636e\u3002\n\n```\nGET x\n-MOVED 3999 127.0.0.1:6381\n```\nMOVED \u6307\u4ee4\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 3999 \u662f key \u5bf9\u5e94\u7684\u69fd\u4f4d\u7f16\u53f7\uff0c\u540e\u9762\u662f\u76ee\u6807\u8282\u70b9\u5730\u5740\u3002MOVED \u6307\u4ee4\u524d\u9762\u6709\u4e00\u4e2a\u51cf\u53f7\uff0c\u8868\u793a\u8be5\u6307\u4ee4\u662f\u4e00\u4e2a\u9519\u8bef\u6d88\u606f\u3002\n\n\u5ba2\u6237\u7aef\u6536\u5230 MOVED \u6307\u4ee4\u540e\uff0c\u8981\u7acb\u5373\u7ea0\u6b63\u672c\u5730\u7684\u69fd\u4f4d\u6620\u5c04\u8868\u3002\u540e\u7eed\u6240\u6709 key \u5c06\u4f7f\u7528\u65b0\u7684\u69fd\u4f4d\u6620\u5c04\u8868\u3002\n\n## \u8fc1\u79fb\n\nRedis Cluster \u63d0\u4f9b\u4e86\u5de5\u5177 redis-trib \u53ef\u4ee5\u8ba9\u8fd0\u7ef4\u4eba\u5458\u624b\u52a8\u8c03\u6574\u69fd\u4f4d\u7684\u5206\u914d\u60c5\u51b5\uff0c\u5b83\u4f7f\u7528 Ruby \u8bed\u8a00\u8fdb\u884c\u5f00\u53d1\uff0c\u901a\u8fc7\u7ec4\u5408\u5404\u79cd\u539f\u751f\u7684 Redis Cluster \u6307\u4ee4\u6765\u5b9e\u73b0\u3002\u8fd9\u70b9 Codis \u505a\u7684\u66f4\u52a0\u4eba\u6027\u5316\uff0c\u5b83\u4e0d\u4f46\u63d0\u4f9b\u4e86 UI \u754c\u9762\u53ef\u4ee5\u8ba9\u6211\u4eec\u65b9\u4fbf\u7684\u8fc1\u79fb\uff0c\u8fd8\u63d0\u4f9b\u4e86\u81ea\u52a8\u5316\u5e73\u8861\u69fd\u4f4d\u5de5\u5177\uff0c\u65e0\u9700\u4eba\u5de5\u5e72\u9884\u5c31\u53ef\u4ee5\u5747\u8861\u96c6\u7fa4\u8d1f\u8f7d\u3002\u4e0d\u8fc7 Redis \u5b98\u65b9\u5411\u6765\u7684\u7b56\u7565\u5c31\u662f\u63d0\u4f9b\u6700\u5c0f\u53ef\u7528\u7684\u5de5\u5177\uff0c\u5176\u5b83\u90fd\u4ea4\u7531\u793e\u533a\u5b8c\u6210\u3002\n\n**\u8fc1\u79fb\u8fc7\u7a0b**\n\n![](https://user-gold-cdn.xitu.io/2018/7/31/164f0ac2cd2a1c9f?w=1256&h=698&f=png&s=121551)\n\nRedis \u8fc1\u79fb\u7684\u5355\u4f4d\u662f\u69fd\uff0cRedis \u4e00\u4e2a\u69fd\u4e00\u4e2a\u69fd\u8fdb\u884c\u8fc1\u79fb\uff0c\u5f53\u4e00\u4e2a\u69fd\u6b63\u5728\u8fc1\u79fb\u65f6\uff0c\u8fd9\u4e2a\u69fd\u5c31\u5904\u4e8e\u4e2d\u95f4\u8fc7\u6e21\u72b6\u6001\u3002\u8fd9\u4e2a\u69fd\u5728\u539f\u8282\u70b9\u7684\u72b6\u6001\u4e3a```migrating```\uff0c\u5728\u76ee\u6807\u8282\u70b9\u7684\u72b6\u6001\u4e3a```importing```\uff0c\u8868\u793a\u6570\u636e\u6b63\u5728\u4ece\u6e90\u6d41\u5411\u76ee\u6807\u3002\n\n\u8fc1\u79fb\u5de5\u5177 redis-trib \u9996\u5148\u4f1a\u5728\u6e90\u548c\u76ee\u6807\u8282\u70b9\u8bbe\u7f6e\u597d\u4e2d\u95f4\u8fc7\u6e21\u72b6\u6001\uff0c\u7136\u540e\u4e00\u6b21\u6027\u83b7\u53d6\u6e90\u8282\u70b9\u69fd\u4f4d\u7684\u6240\u6709 key \u5217\u8868(keysinslot\u6307\u4ee4\uff0c\u53ef\u4ee5\u90e8\u5206\u83b7\u53d6)\uff0c\u518d\u6328\u4e2akey\u8fdb\u884c\u8fc1\u79fb\u3002\u6bcf\u4e2a key \u7684\u8fc1\u79fb\u8fc7\u7a0b\u662f\u4ee5\u539f\u8282\u70b9\u4f5c\u4e3a\u76ee\u6807\u8282\u70b9\u7684\u300c\u5ba2\u6237\u7aef\u300d\uff0c\u539f\u8282\u70b9\u5bf9\u5f53\u524d\u7684key\u6267\u884cdump\u6307\u4ee4\u5f97\u5230\u5e8f\u5217\u5316\u5185\u5bb9\uff0c\u7136\u540e\u901a\u8fc7\u300c\u5ba2\u6237\u7aef\u300d\u5411\u76ee\u6807\u8282\u70b9\u53d1\u9001\u6307\u4ee4restore\u643a\u5e26\u5e8f\u5217\u5316\u7684\u5185\u5bb9\u4f5c\u4e3a\u53c2\u6570\uff0c\u76ee\u6807\u8282\u70b9\u518d\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u5c31\u53ef\u4ee5\u5c06\u5185\u5bb9\u6062\u590d\u5230\u76ee\u6807\u8282\u70b9\u7684\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u8fd4\u56de\u300c\u5ba2\u6237\u7aef\u300dOK\uff0c\u539f\u8282\u70b9\u300c\u5ba2\u6237\u7aef\u300d\u6536\u5230\u540e\u518d\u628a\u5f53\u524d\u8282\u70b9\u7684key\u5220\u9664\u6389\u5c31\u5b8c\u6210\u4e86\u5355\u4e2akey\u8fc1\u79fb\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002\n\n**\u4ece\u6e90\u8282\u70b9\u83b7\u53d6\u5185\u5bb9 => \u5b58\u5230\u76ee\u6807\u8282\u70b9 => \u4ece\u6e90\u8282\u70b9\u5220\u9664\u5185\u5bb9**\u3002\n\n\u6ce8\u610f\u8fd9\u91cc\u7684\u8fc1\u79fb\u8fc7\u7a0b\u662f\u540c\u6b65\u7684\uff0c\u5728\u76ee\u6807\u8282\u70b9\u6267\u884crestore\u6307\u4ee4\u5230\u539f\u8282\u70b9\u5220\u9664key\u4e4b\u95f4\uff0c\u539f\u8282\u70b9\u7684\u4e3b\u7ebf\u7a0b\u4f1a\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u76f4\u5230key\u88ab\u6210\u529f\u5220\u9664\u3002\n\n\u5982\u679c\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u7a81\u7136\u51fa\u73b0\u7f51\u7edc\u6545\u969c\uff0c\u6574\u4e2aslot\u7684\u8fc1\u79fb\u53ea\u8fdb\u884c\u4e86\u4e00\u534a\u3002\u8fd9\u65f6\u4e24\u4e2a\u8282\u70b9\u4f9d\u65e7\u5904\u4e8e\u4e2d\u95f4\u8fc7\u6e21\u72b6\u6001\u3002\u5f85\u4e0b\u6b21\u8fc1\u79fb\u5de5\u5177\u91cd\u65b0\u8fde\u4e0a\u65f6\uff0c\u4f1a\u63d0\u793a\u7528\u6237\u7ee7\u7eed\u8fdb\u884c\u8fc1\u79fb\u3002\n\n\u5728\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6bcf\u4e2akey\u7684\u5185\u5bb9\u90fd\u5f88\u5c0f\uff0cmigrate\u6307\u4ee4\u6267\u884c\u4f1a\u5f88\u5feb\uff0c\u5b83\u5c31\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5ba2\u6237\u7aef\u7684\u6b63\u5e38\u8bbf\u95ee\u3002\u5982\u679ckey\u7684\u5185\u5bb9\u5f88\u5927\uff0c\u56e0\u4e3amigrate\u6307\u4ee4\u662f\u963b\u585e\u6307\u4ee4\u4f1a\u540c\u65f6\u5bfc\u81f4\u539f\u8282\u70b9\u548c\u76ee\u6807\u8282\u70b9\u5361\u987f\uff0c\u5f71\u54cd\u96c6\u7fa4\u7684\u7a33\u5b9a\u578b\u3002\u6240\u4ee5\u5728\u96c6\u7fa4\u73af\u5883\u4e0b\u4e1a\u52a1\u903b\u8f91\u8981\u5c3d\u53ef\u80fd\u907f\u514d\u5927key\u7684\u4ea7\u751f\u3002\n\n\u5728\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u6d41\u7a0b\u4f1a\u6709\u5f88\u5927\u7684\u53d8\u5316\u3002\n\n\u9996\u5148\u65b0\u65e7\u4e24\u4e2a\u8282\u70b9\u5bf9\u5e94\u7684\u69fd\u4f4d\u90fd\u5b58\u5728\u90e8\u5206 key \u6570\u636e\u3002\u5ba2\u6237\u7aef\u5148\u5c1d\u8bd5\u8bbf\u95ee\u65e7\u8282\u70b9\uff0c\u5982\u679c\u5bf9\u5e94\u7684\u6570\u636e\u8fd8\u5728\u65e7\u8282\u70b9\u91cc\u9762\uff0c\u90a3\u4e48\u65e7\u8282\u70b9\u6b63\u5e38\u5904\u7406\u3002\u5982\u679c\u5bf9\u5e94\u7684\u6570\u636e\u4e0d\u5728\u65e7\u8282\u70b9\u91cc\u9762\uff0c\u90a3\u4e48\u6709\u4e24\u79cd\u53ef\u80fd\uff0c\u8981\u4e48\u8be5\u6570\u636e\u5728\u65b0\u8282\u70b9\u91cc\uff0c\u8981\u4e48\u6839\u672c\u5c31\u4e0d\u5b58\u5728\u3002\u65e7\u8282\u70b9\u4e0d\u77e5\u9053\u662f\u54ea\u79cd\u60c5\u51b5\uff0c\u6240\u4ee5\u5b83\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a```-ASK targetNodeAddr```\u7684\u91cd\u5b9a\u5411\u6307\u4ee4\u3002\u5ba2\u6237\u7aef\u6536\u5230\u8fd9\u4e2a\u91cd\u5b9a\u5411\u6307\u4ee4\u540e\uff0c\u5148\u53bb\u76ee\u6807\u8282\u70b9\u6267\u884c\u4e00\u4e2a\u4e0d\u5e26\u4efb\u4f55\u53c2\u6570\u7684```asking```\u6307\u4ee4\uff0c\u7136\u540e\u5728\u76ee\u6807\u8282\u70b9\u518d\u91cd\u65b0\u6267\u884c\u539f\u5148\u7684\u64cd\u4f5c\u6307\u4ee4\u3002\n\n\u4e3a\u4ec0\u4e48\u9700\u8981\u6267\u884c\u4e00\u4e2a\u4e0d\u5e26\u53c2\u6570\u7684```asking```\u6307\u4ee4\u5462\uff1f\n\n\u56e0\u4e3a\u5728\u8fc1\u79fb\u6ca1\u6709\u5b8c\u6210\u4e4b\u524d\uff0c\u6309\u7406\u8bf4\u8fd9\u4e2a\u69fd\u4f4d\u8fd8\u662f\u4e0d\u5f52\u65b0\u8282\u70b9\u7ba1\u7406\u7684\uff0c\u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u5411\u76ee\u6807\u8282\u70b9\u53d1\u9001\u8be5\u69fd\u4f4d\u7684\u6307\u4ee4\uff0c\u8282\u70b9\u662f\u4e0d\u8ba4\u7684\uff0c\u5b83\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a```-MOVED```\u91cd\u5b9a\u5411\u6307\u4ee4\u544a\u8bc9\u5b83\u53bb\u6e90\u8282\u70b9\u53bb\u6267\u884c\u3002\u5982\u6b64\u5c31\u4f1a\u5f62\u6210 **\u91cd\u5b9a\u5411\u5faa\u73af**\u3002```asking```\u6307\u4ee4\u7684\u76ee\u6807\u5c31\u662f\u6253\u5f00\u76ee\u6807\u8282\u70b9\u7684\u9009\u9879\uff0c\u544a\u8bc9\u5b83\u4e0b\u4e00\u6761\u6307\u4ee4\u4e0d\u80fd\u4e0d\u7406\uff0c\u800c\u8981\u5f53\u6210\u81ea\u5df1\u7684\u69fd\u4f4d\u6765\u5904\u7406\u3002\n\n\u4ece\u4ee5\u4e0a\u8fc7\u7a0b\u53ef\u4ee5\u770b\u51fa\uff0c\u8fc1\u79fb\u662f\u4f1a\u5f71\u54cd\u670d\u52a1\u6548\u7387\u7684\uff0c\u540c\u6837\u7684\u6307\u4ee4\u5728\u6b63\u5e38\u60c5\u51b5\u4e0b\u4e00\u4e2a ttl \u5c31\u80fd\u5b8c\u6210\uff0c\u800c\u5728\u8fc1\u79fb\u4e2d\u5f97 3 \u4e2a ttl \u624d\u80fd\u641e\u5b9a\u3002\n\n## \u5bb9\u9519\n\nRedis Cluster \u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u4e3b\u8282\u70b9\u8bbe\u7f6e\u82e5\u5e72\u4e2a\u4ece\u8282\u70b9\uff0c\u5355\u4e3b\u8282\u70b9\u6545\u969c\u65f6\uff0c\u96c6\u7fa4\u4f1a\u81ea\u52a8\u5c06\u5176\u4e2d\u67d0\u4e2a\u4ece\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\u8282\u70b9\u3002\u5982\u679c\u67d0\u4e2a\u4e3b\u8282\u70b9\u6ca1\u6709\u4ece\u8282\u70b9\uff0c\u90a3\u4e48\u5f53\u5b83\u53d1\u751f\u6545\u969c\u65f6\uff0c\u96c6\u7fa4\u5c06\u5b8c\u5168\u5904\u4e8e\u4e0d\u53ef\u7528\u72b6\u6001\u3002\u4e0d\u8fc7 Redis \u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53c2\u6570```cluster-require-full-coverage```\u53ef\u4ee5\u5141\u8bb8\u90e8\u5206\u8282\u70b9\u6545\u969c\uff0c\u5176\u5b83\u8282\u70b9\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u63d0\u4f9b\u5bf9\u5916\u8bbf\u95ee\u3002\n\n## \u7f51\u7edc\u6296\u52a8\n\n\u771f\u5b9e\u4e16\u754c\u7684\u673a\u623f\u7f51\u7edc\u5f80\u5f80\u5e76\u4e0d\u662f\u98ce\u5e73\u6d6a\u9759\u7684\uff0c\u5b83\u4eec\u7ecf\u5e38\u4f1a\u53d1\u751f\u5404\u79cd\u5404\u6837\u7684\u5c0f\u95ee\u9898\u3002\u6bd4\u5982\u7f51\u7edc\u6296\u52a8\u5c31\u662f\u975e\u5e38\u5e38\u89c1\u7684\u4e00\u79cd\u73b0\u8c61\uff0c\u7a81\u7136\u4e4b\u95f4\u90e8\u5206\u8fde\u63a5\u53d8\u5f97\u4e0d\u53ef\u8bbf\u95ee\uff0c\u7136\u540e\u5f88\u5feb\u53c8\u6062\u590d\u6b63\u5e38\u3002\n\n\u4e3a\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\uff0cRedis Cluster \u63d0\u4f9b\u4e86\u4e00\u79cd\u9009\u9879```cluster-node-timeout```\uff0c\u8868\u793a\u5f53\u67d0\u4e2a\u8282\u70b9\u6301\u7eed timeout \u7684\u65f6\u95f4\u5931\u8054\u65f6\uff0c\u624d\u53ef\u4ee5\u8ba4\u5b9a\u8be5\u8282\u70b9\u51fa\u73b0\u6545\u969c\uff0c\u9700\u8981\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u9009\u9879\uff0c\u7f51\u7edc\u6296\u52a8\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u9891\u7e41\u5207\u6362 (\u6570\u636e\u7684\u91cd\u65b0\u590d\u5236)\u3002\n\n\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u9009\u9879```\ncluster-slave-validity-factor```\u4f5c\u4e3a\u500d\u4e58\u7cfb\u6570\u6765\u653e\u5927\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u6765\u5bbd\u677e\u5bb9\u9519\u7684\u7d27\u6025\u7a0b\u5ea6\u3002\u5982\u679c\u8fd9\u4e2a\u7cfb\u6570\u4e3a\u96f6\uff0c\u90a3\u4e48\u4e3b\u4ece\u5207\u6362\u662f\u4e0d\u4f1a\u6297\u62d2\u7f51\u7edc\u6296\u52a8\u7684\u3002\u5982\u679c\u8fd9\u4e2a\u7cfb\u6570\u5927\u4e8e 1\uff0c\u5b83\u5c31\u6210\u4e86\u4e3b\u4ece\u5207\u6362\u7684\u677e\u5f1b\u7cfb\u6570\u3002\n\n## \u53ef\u80fd\u4e0b\u7ebf (PFAIL-Possibly Fail) \u4e0e\u786e\u5b9a\u4e0b\u7ebf (Fail)\n\n\u56e0\u4e3a Redis Cluster \u662f\u53bb\u4e2d\u5fc3\u5316\u7684\uff0c\u4e00\u4e2a\u8282\u70b9\u8ba4\u4e3a\u67d0\u4e2a\u8282\u70b9\u5931\u8054\u4e86\u5e76\u4e0d\u4ee3\u8868\u6240\u6709\u7684\u8282\u70b9\u90fd\u8ba4\u4e3a\u5b83\u5931\u8054\u4e86\u3002\u6240\u4ee5\u96c6\u7fa4\u8fd8\u5f97\u7ecf\u8fc7\u4e00\u6b21\u534f\u5546\u7684\u8fc7\u7a0b\uff0c\u53ea\u6709\u5f53\u5927\u591a\u6570\u8282\u70b9\u90fd\u8ba4\u5b9a\u4e86\u67d0\u4e2a\u8282\u70b9\u5931\u8054\u4e86\uff0c\u96c6\u7fa4\u624d\u8ba4\u4e3a\u8be5\u8282\u70b9\u9700\u8981\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u6765\u5bb9\u9519\u3002\n\nRedis \u96c6\u7fa4\u8282\u70b9\u91c7\u7528 Gossip \u534f\u8bae\u6765\u5e7f\u64ad\u81ea\u5df1\u7684\u72b6\u6001\u4ee5\u53ca\u81ea\u5df1\u5bf9\u6574\u4e2a\u96c6\u7fa4\u8ba4\u77e5\u7684\u6539\u53d8\u3002\u6bd4\u5982\u4e00\u4e2a\u8282\u70b9\u53d1\u73b0\u67d0\u4e2a\u8282\u70b9\u5931\u8054\u4e86 (PFail)\uff0c\u5b83\u4f1a\u5c06\u8fd9\u6761\u4fe1\u606f\u5411\u6574\u4e2a\u96c6\u7fa4\u5e7f\u64ad\uff0c\u5176\u5b83\u8282\u70b9\u4e5f\u5c31\u53ef\u4ee5\u6536\u5230\u8fd9\u70b9\u5931\u8054\u4fe1\u606f\u3002\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u6536\u5230\u4e86\u67d0\u4e2a\u8282\u70b9\u5931\u8054\u7684\u6570\u91cf (PFail Count) \u5df2\u7ecf\u8fbe\u5230\u4e86\u96c6\u7fa4\u7684\u5927\u591a\u6570\uff0c\u5c31\u53ef\u4ee5\u6807\u8bb0\u8be5\u8282\u70b9\u4e3a\u786e\u5b9a\u4e0b\u7ebf\u72b6\u6001 (Fail)\uff0c\u7136\u540e\u5411\u6574\u4e2a\u96c6\u7fa4\u5e7f\u64ad\uff0c\u5f3a\u8feb\u5176\u5b83\u8282\u70b9\u4e5f\u63a5\u6536\u8be5\u8282\u70b9\u5df2\u7ecf\u4e0b\u7ebf\u7684\u4e8b\u5b9e\uff0c\u5e76\u7acb\u5373\u5bf9\u8be5\u5931\u8054\u8282\u70b9\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u3002\n\n## Cluster \u57fa\u672c\u4f7f\u7528\nredis-py \u5ba2\u6237\u7aef\u4e0d\u652f\u6301 Cluster \u6a21\u5f0f\uff0c\u8981\u4f7f\u7528 Cluster\uff0c\u5fc5\u987b\u5b89\u88c5\u53e6\u5916\u4e00\u4e2a\u5305\uff0c\u8fd9\u4e2a\u5305\u662f\u4f9d\u8d56 redis-py \u5305\u7684\u3002\n```\npip install redis-py-cluster\n```\n\u4e0b\u9762\u6211\u4eec\u770b\u770b redis-py-cluster \u5982\u4f55\u4f7f\u7528\u3002\n```\n>>> from rediscluster import StrictRedisCluster\n>>> # Requires at least one node for cluster discovery. Multiple nodes is recommended.\n>>> startup_nodes = [{\"host\": \"127.0.0.1\", \"port\": \"7000\"}]\n>>> rc = StrictRedisCluster(startup_nodes=startup_nodes, decode_responses=True)\n>>> rc.set(\"foo\", \"bar\")\nTrue\n>>> print(rc.get(\"foo\"))\n'bar'\n```\nCluster \u662f\u53bb\u4e2d\u5fc3\u5316\u7684\uff0c\u5b83\u6709\u591a\u4e2a\u8282\u70b9\u7ec4\u6210\uff0c\u6784\u9020 StrictRedisCluster \u5b9e\u4f8b\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u7528\u4e00\u4e2a\u8282\u70b9\u5730\u5740\uff0c\u5176\u5b83\u5730\u5740\u53ef\u4ee5\u81ea\u52a8\u901a\u8fc7\u8fd9\u4e2a\u8282\u70b9\u6765\u53d1\u73b0\u3002\u4e0d\u8fc7\u5982\u679c\u63d0\u4f9b\u591a\u4e2a\u8282\u70b9\u5730\u5740\uff0c\u5b89\u5168\u6027\u4f1a\u66f4\u597d\u3002\u5982\u679c\u53ea\u63d0\u4f9b\u4e00\u4e2a\u8282\u70b9\u5730\u5740\uff0c\u90a3\u4e48\u5f53\u8fd9\u4e2a\u8282\u70b9\u6302\u4e86\uff0c\u5ba2\u6237\u7aef\u5c31\u5fc5\u987b\u66f4\u6362\u5730\u5740\u624d\u53ef\u4ee5\u7ee7\u7eed\u8bbf\u95ee Cluster\u3002\n\u7b2c\u4e8c\u4e2a\u53c2\u6570 `decode_responses` \u8868\u793a\u662f\u5426\u8981\u5c06\u8fd4\u56de\u7ed3\u679c\u4e2d\u7684 byte \u6570\u7ec4\u8f6c\u6362\u6210 unicode\u3002\n\nCluster \u4f7f\u7528\u8d77\u6765\u975e\u5e38\u65b9\u4fbf\uff0c\u7528\u8d77\u6765\u548c\u666e\u901a\u7684 redis-py \u5dee\u522b\u4e0d\u5927\uff0c\u4ec5\u4ec5\u662f\u6784\u9020\u65b9\u5f0f\u4e0d\u540c\u3002\u4f46\u662f\u5b83\u4eec\u4e5f\u6709\u76f8\u5f53\u5927\u7684\u4e0d\u4e00\u6837\u4e4b\u5904\uff0c\u6bd4\u5982 Cluster \u4e0d\u652f\u6301\u4e8b\u52a1\uff0cCluster \u7684 `mget` \u65b9\u6cd5\u76f8\u6bd4 Redis \u8981\u6162\u5f88\u591a\uff0c\u88ab\u62c6\u5206\u6210\u4e86\u591a\u4e2a `get` \u6307\u4ee4\uff0cCluster \u7684 `rename` \u65b9\u6cd5\u4e0d\u518d\u662f\u539f\u5b50\u7684\uff0c\u5b83\u9700\u8981\u5c06\u6570\u636e\u4ece\u539f\u8282\u70b9\u8f6c\u79fb\u5230\u76ee\u6807\u8282\u70b9\u3002\n\n##  \u69fd\u4f4d\u8fc1\u79fb\u611f\u77e5\n\n\u5982\u679c Cluster \u4e2d\u67d0\u4e2a\u69fd\u4f4d\u6b63\u5728\u8fc1\u79fb\u6216\u8005\u5df2\u7ecf\u8fc1\u79fb\u5b8c\u4e86\uff0cclient \u5982\u4f55\u80fd\u611f\u77e5\u5230\u69fd\u4f4d\u7684\u53d8\u5316\u5462\uff1f\u5ba2\u6237\u7aef\u4fdd\u5b58\u4e86\u69fd\u4f4d\u548c\u8282\u70b9\u7684\u6620\u5c04\u5173\u7cfb\u8868\uff0c\u5b83\u9700\u8981\u5373\u65f6\u5f97\u5230\u66f4\u65b0\uff0c\u624d\u53ef\u4ee5\u6b63\u5e38\u5730\u5c06\u67d0\u6761\u6307\u4ee4\u53d1\u5230\u6b63\u786e\u7684\u8282\u70b9\u4e2d\u3002\n\n\u6211\u4eec\u524d\u9762\u63d0\u5230 Cluster \u6709\u4e24\u4e2a\u7279\u6b8a\u7684 `error` \u6307\u4ee4\uff0c\u4e00\u4e2a\u662f `moved`\uff0c\u4e00\u4e2a\u662f `asking`\u3002\n\n\u7b2c\u4e00\u4e2a `moved` \u662f\u7528\u6765\u7ea0\u6b63\u69fd\u4f4d\u7684\u3002\u5982\u679c\u6211\u4eec\u5c06\u6307\u4ee4\u53d1\u9001\u5230\u4e86\u9519\u8bef\u7684\u8282\u70b9\uff0c\u8be5\u8282\u70b9\u53d1\u73b0\u5bf9\u5e94\u7684\u6307\u4ee4\u69fd\u4f4d\u4e0d\u5f52\u81ea\u5df1\u7ba1\u7406\uff0c\u5c31\u4f1a\u5c06\u76ee\u6807\u8282\u70b9\u7684\u5730\u5740\u968f\u540c `moved` \u6307\u4ee4\u56de\u590d\u7ed9\u5ba2\u6237\u7aef\u901a\u77e5\u5ba2\u6237\u7aef\u53bb\u76ee\u6807\u8282\u70b9\u53bb\u8bbf\u95ee\u3002\u8fd9\u4e2a\u65f6\u5019\u5ba2\u6237\u7aef\u5c31\u4f1a\u5237\u65b0\u81ea\u5df1\u7684\u69fd\u4f4d\u5173\u7cfb\u8868\uff0c\u7136\u540e\u91cd\u8bd5\u6307\u4ee4\uff0c\u540e\u7eed\u6240\u6709\u6253\u5728\u8be5\u69fd\u4f4d\u7684\u6307\u4ee4\u90fd\u4f1a\u8f6c\u5230\u76ee\u6807\u8282\u70b9\u3002\n\n\u7b2c\u4e8c\u4e2a `asking` \u6307\u4ee4\u548c `moved` \u4e0d\u4e00\u6837\uff0c\u5b83\u662f\u7528\u6765\u4e34\u65f6\u7ea0\u6b63\u69fd\u4f4d\u7684\u3002\u5982\u679c\u5f53\u524d\u69fd\u4f4d\u6b63\u5904\u4e8e\u8fc1\u79fb\u4e2d\uff0c\u6307\u4ee4\u4f1a\u5148\u88ab\u53d1\u9001\u5230\u69fd\u4f4d\u6240\u5728\u7684\u65e7\u8282\u70b9\uff0c\u5982\u679c\u65e7\u8282\u70b9\u5b58\u5728\u6570\u636e\uff0c\u90a3\u5c31\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\u4e86\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u5b83\u53ef\u80fd\u771f\u7684\u4e0d\u5b58\u5728\u4e5f\u53ef\u80fd\u5728\u8fc1\u79fb\u76ee\u6807\u8282\u70b9\u4e0a\u3002\u6240\u4ee5\u65e7\u8282\u70b9\u4f1a\u901a\u77e5\u5ba2\u6237\u7aef\u53bb\u65b0\u8282\u70b9\u5c1d\u8bd5\u4e00\u4e0b\u62ff\u6570\u636e\uff0c\u770b\u770b\u65b0\u8282\u70b9\u6709\u6ca1\u6709\u3002\u8fd9\u65f6\u5019\u5c31\u4f1a\u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u4e00\u4e2a `asking error` \u643a\u5e26\u4e0a\u76ee\u6807\u8282\u70b9\u7684\u5730\u5740\u3002\u5ba2\u6237\u7aef\u6536\u5230\u8fd9\u4e2a `asking error` \u540e\uff0c\u5c31\u4f1a\u53bb\u76ee\u6807\u8282\u70b9\u53bb\u5c1d\u8bd5\u3002\u5ba2\u6237\u7aef\u4e0d\u4f1a\u5237\u65b0\u69fd\u4f4d\u6620\u5c04\u5173\u7cfb\u8868\uff0c\u56e0\u4e3a\u5b83\u53ea\u662f\u4e34\u65f6\u7ea0\u6b63\u8be5\u6307\u4ee4\u7684\u69fd\u4f4d\u4fe1\u606f\uff0c\u4e0d\u5f71\u54cd\u540e\u7eed\u6307\u4ee4\u3002\n\n**\u91cd\u8bd5 2 \u6b21**\n\n`moved` \u548c `asking` \u6307\u4ee4\u90fd\u662f\u91cd\u8bd5\u6307\u4ee4\uff0c\u5ba2\u6237\u7aef\u4f1a\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u6307\u4ee4\u591a\u91cd\u8bd5\u4e00\u6b21\u3002\u8bfb\u8005\u6709\u6ca1\u6709\u60f3\u8fc7\u4f1a\u4e0d\u4f1a\u5b58\u5728\u4e00\u79cd\u60c5\u51b5\uff0c\u5ba2\u6237\u7aef\u6709\u53ef\u80fd\u91cd\u8bd5 2 \u6b21\u5462\uff1f\u8fd9\u79cd\u60c5\u51b5\u662f\u5b58\u5728\u7684\uff0c\u6bd4\u5982\u4e00\u6761\u6307\u4ee4\u88ab\u53d1\u9001\u5230\u9519\u8bef\u7684\u8282\u70b9\uff0c\u8fd9\u4e2a\u8282\u70b9\u4f1a\u5148\u7ed9\u4f60\u4e00\u4e2a `moved` \u9519\u8bef\u544a\u77e5\u4f60\u53bb\u53e6\u5916\u4e00\u4e2a\u8282\u70b9\u91cd\u8bd5\u3002\u6240\u4ee5\u5ba2\u6237\u7aef\u5c31\u53bb\u53e6\u5916\u4e00\u4e2a\u8282\u70b9\u91cd\u8bd5\u4e86\uff0c\u7ed3\u679c\u521a\u597d\u8fd9\u4e2a\u65f6\u5019\u8fd0\u7ef4\u4eba\u5458\u8981\u5bf9\u8fd9\u4e2a\u69fd\u4f4d\u8fdb\u884c\u8fc1\u79fb\u64cd\u4f5c\uff0c\u4e8e\u662f\u7ed9\u5ba2\u6237\u7aef\u56de\u590d\u4e86\u4e00\u4e2a `asking` \u6307\u4ee4\u544a\u77e5\u5ba2\u6237\u7aef\u53bb\u76ee\u6807\u8282\u70b9\u53bb\u91cd\u8bd5\u6307\u4ee4\u3002\u6240\u4ee5\u8fd9\u91cc\u5ba2\u6237\u7aef\u91cd\u8bd5\u4e86 2 \u6b21\u3002\n\n**\u91cd\u8bd5\u591a\u6b21**\n\n\u5728\u67d0\u4e9b\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u751a\u81f3\u4f1a\u91cd\u8bd5\u591a\u6b21\uff0c\u8bfb\u8005\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e0b\u81ea\u5df1\u7684\u8111\u6d1e\u60f3\u4e00\u60f3\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u91cd\u8bd5\u591a\u6b21\u3002\n\n\u6b63\u662f\u56e0\u4e3a\u5b58\u5728\u591a\u6b21\u91cd\u8bd5\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u7684\u6e90\u7801\u91cc\u5728\u6267\u884c\u6307\u4ee4\u65f6\u90fd\u4f1a\u6709\u4e00\u4e2a\u5faa\u73af\uff0c\u7136\u540e\u4f1a\u8bbe\u7f6e\u4e00\u4e2a\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0cJava \u548c Python \u90fd\u6709\u8fd9\u4e2a\u53c2\u6570\uff0c\u53ea\u662f\u8bbe\u7f6e\u7684\u503c\u4e0d\u4e00\u6837\u3002\u5f53\u91cd\u8bd5\u6b21\u6570\u8d85\u8fc7\u8fd9\u4e2a\u503c\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u76f4\u63a5\u5411\u4e1a\u52a1\u5c42\u629b\u51fa\u5f02\u5e38\u3002\n\n## \u96c6\u7fa4\u53d8\u66f4\u611f\u77e5\n\n\u5f53\u670d\u52a1\u5668\u8282\u70b9\u53d8\u66f4\u65f6\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\u5373\u65f6\u5f97\u5230\u901a\u77e5\u4ee5\u5b9e\u65f6\u5237\u65b0\u81ea\u5df1\u7684\u8282\u70b9\u5173\u7cfb\u8868\u3002\u90a3\u5ba2\u6237\u7aef\u662f\u5982\u4f55\u5f97\u5230\u901a\u77e5\u7684\u5462\uff1f\u8fd9\u91cc\u8981\u5206 2 \u79cd\u60c5\u51b5\uff1a\n\n1. \u76ee\u6807\u8282\u70b9\u6302\u6389\u4e86\uff0c\u5ba2\u6237\u7aef\u4f1a\u629b\u51fa\u4e00\u4e2a `ConnectionError`\uff0c\u7d27\u63a5\u7740\u4f1a\u968f\u673a\u6311\u4e00\u4e2a\u8282\u70b9\u6765\u91cd\u8bd5\uff0c\u8fd9\u65f6\u88ab\u91cd\u8bd5\u7684\u8282\u70b9\u4f1a\u901a\u8fc7 `moved error` \u544a\u77e5\u76ee\u6807\u69fd\u4f4d\u88ab\u5206\u914d\u5230\u7684\u65b0\u7684\u8282\u70b9\u5730\u5740\u3002\n2. \u8fd0\u7ef4\u624b\u52a8\u4fee\u6539\u4e86\u96c6\u7fa4\u4fe1\u606f\uff0c\u5c06 master \u5207\u6362\u5230\u5176\u5b83\u8282\u70b9\uff0c\u5e76\u5c06\u65e7\u7684 master \u79fb\u9664\u96c6\u7fa4\u3002\u8fd9\u65f6\u6253\u5728\u65e7\u8282\u70b9\u4e0a\u7684\u6307\u4ee4\u4f1a\u6536\u5230\u4e00\u4e2a `ClusterDown` \u7684\u9519\u8bef\uff0c\u544a\u77e5\u5f53\u524d\u8282\u70b9\u6240\u5728\u96c6\u7fa4\u4e0d\u53ef\u7528 (\u5f53\u524d\u8282\u70b9\u5df2\u7ecf\u88ab\u5b64\u7acb\u4e86\uff0c\u5b83\u4e0d\u518d\u5c5e\u4e8e\u4e4b\u524d\u7684\u96c6\u7fa4)\u3002\u8fd9\u65f6\u5ba2\u6237\u7aef\u5c31\u4f1a\u5173\u95ed\u6240\u6709\u7684\u8fde\u63a5\uff0c\u6e05\u7a7a\u69fd\u4f4d\u6620\u5c04\u5173\u7cfb\u8868\uff0c\u7136\u540e\u5411\u4e0a\u5c42\u629b\u9519\u3002\u5f85\u4e0b\u4e00\u6761\u6307\u4ee4\u8fc7\u6765\u65f6\uff0c\u5c31\u4f1a\u91cd\u65b0\u5c1d\u8bd5\u521d\u59cb\u5316\u8282\u70b9\u4fe1\u606f\u3002\n\n\n## \u601d\u8003 & \u4f5c\u4e1a\n1. \u8bf7\u8bfb\u8005\u81ea\u5df1\u5c1d\u8bd5\u642d\u5efa Cluster \u96c6\u7fa4\u3002\n2. \u4f7f\u7528\u5ba2\u6237\u7aef\u8fde\u63a5\u96c6\u7fa4\u8fdb\u884c\u4e00\u4e9b\u5e38\u89c4\u6307\u4ee4\u7684\u64cd\u4f5c\u4f53\u9a8c\u3002\n", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/21\u96c6\u7fa4_3\u4f17\u5fd7\u6210\u57ce__Cluster.md", "create_date": "2020-02-18T03:01:05.868", "order": 22}}, {"model": "subject.chapter", "pk": 30, "fields": {"title": "25\u62d3\u5c55 4\uff1a\u671d\u751f\u66ae\u6b7b \u2014\u2014 \u8fc7\u671f\u7b56\u7565", "topic": 2, "md5": "a6a848b8bb84cacc854d44a37a2b6e54", "md_body": "# \u62d3\u5c55 4\uff1a\u671d\u751f\u66ae\u6b7b \u2014\u2014 \u8fc7\u671f\u7b56\u7565\n\nRedis \u6240\u6709\u7684\u6570\u636e\u7ed3\u6784\u90fd\u53ef\u4ee5\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u65f6\u95f4\u4e00\u5230\uff0c\u5c31\u4f1a\u81ea\u52a8\u5220\u9664\u3002\u4f60\u53ef\u4ee5\u60f3\u8c61 Redis \u5185\u90e8\u6709\u4e00\u4e2a\u6b7b\u795e\uff0c\u65f6\u523b\u76ef\u7740\u6240\u6709\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key\uff0c\u5bff\u547d\u4e00\u5230\u5c31\u4f1a\u7acb\u5373\u6536\u5272\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/19/164b156918d00bbd?w=526&h=353&f=png&s=25188)\n\n\u4f60\u8fd8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7ad9\u5728\u6b7b\u795e\u7684\u89d2\u5ea6\u601d\u8003\uff0c\u4f1a\u4e0d\u4f1a\u56e0\u4e3a\u540c\u4e00\u65f6\u95f4\u592a\u591a\u7684 key \u8fc7\u671f\uff0c\u4ee5\u81f3\u4e8e\u5fd9\u4e0d\u8fc7\u6765\u3002\u540c\u65f6\u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u6536\u5272\u7684\u65f6\u95f4\u4e5f\u4f1a\u5360\u7528\u7ebf\u7a0b\u7684\u5904\u7406\u65f6\u95f4\uff0c\u5982\u679c\u6536\u5272\u7684\u592a\u8fc7\u4e8e\u7e41\u5fd9\uff0c\u4f1a\u4e0d\u4f1a\u5bfc\u81f4\u7ebf\u4e0a\u8bfb\u5199\u6307\u4ee4\u51fa\u73b0\u5361\u987f\u3002\n\n\u8fd9\u4e9b\u95ee\u9898 Antirez \u65e9\u5c31\u60f3\u5230\u4e86\uff0c\u6240\u6709\u5728\u8fc7\u671f\u8fd9\u4ef6\u4e8b\u4e0a\uff0cRedis \u975e\u5e38\u5c0f\u5fc3\u3002\n\n## \u8fc7\u671f\u7684 key \u96c6\u5408\n\nredis \u4f1a\u5c06\u6bcf\u4e2a\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key \u653e\u5165\u5230\u4e00\u4e2a\u72ec\u7acb\u7684\u5b57\u5178\u4e2d\uff0c\u4ee5\u540e\u4f1a\u5b9a\u65f6\u904d\u5386\u8fd9\u4e2a\u5b57\u5178\u6765\u5220\u9664\u5230\u671f\u7684 key\u3002\u9664\u4e86\u5b9a\u65f6\u904d\u5386\u4e4b\u5916\uff0c\u5b83\u8fd8\u4f1a\u4f7f\u7528\u60f0\u6027\u7b56\u7565\u6765\u5220\u9664\u8fc7\u671f\u7684 key\uff0c\u6240\u8c13\u60f0\u6027\u7b56\u7565\u5c31\u662f\u5728\u5ba2\u6237\u7aef\u8bbf\u95ee\u8fd9\u4e2a key \u7684\u65f6\u5019\uff0credis \u5bf9 key \u7684\u8fc7\u671f\u65f6\u95f4\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u8fc7\u671f\u4e86\u5c31\u7acb\u5373\u5220\u9664\u3002\u5b9a\u65f6\u5220\u9664\u662f\u96c6\u4e2d\u5904\u7406\uff0c\u60f0\u6027\u5220\u9664\u662f\u96f6\u6563\u5904\u7406\u3002\n\n## \u5b9a\u65f6\u626b\u63cf\u7b56\u7565\n\nRedis \u9ed8\u8ba4\u4f1a\u6bcf\u79d2\u8fdb\u884c\u5341\u6b21\u8fc7\u671f\u626b\u63cf\uff0c\u8fc7\u671f\u626b\u63cf\u4e0d\u4f1a\u904d\u5386\u8fc7\u671f\u5b57\u5178\u4e2d\u6240\u6709\u7684 key\uff0c\u800c\u662f\u91c7\u7528\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u8d2a\u5fc3\u7b56\u7565\u3002\n\n1. \u4ece\u8fc7\u671f\u5b57\u5178\u4e2d\u968f\u673a 20 \u4e2a key\uff1b\n2. \u5220\u9664\u8fd9 20 \u4e2a key \u4e2d\u5df2\u7ecf\u8fc7\u671f\u7684 key\uff1b\n3. \u5982\u679c\u8fc7\u671f\u7684 key \u6bd4\u7387\u8d85\u8fc7 1/4\uff0c\u90a3\u5c31\u91cd\u590d\u6b65\u9aa4 1\uff1b\n\n\u540c\u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8fc7\u671f\u626b\u63cf\u4e0d\u4f1a\u51fa\u73b0\u5faa\u73af\u8fc7\u5ea6\uff0c\u5bfc\u81f4\u7ebf\u7a0b\u5361\u6b7b\u73b0\u8c61\uff0c\u7b97\u6cd5\u8fd8\u589e\u52a0\u4e86\u626b\u63cf\u65f6\u95f4\u7684\u4e0a\u9650\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u8d85\u8fc7 25ms\u3002\n\n\u8bbe\u60f3\u4e00\u4e2a\u5927\u578b\u7684 Redis \u5b9e\u4f8b\u4e2d\u6240\u6709\u7684 key \u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\u4e86\uff0c\u4f1a\u51fa\u73b0\u600e\u6837\u7684\u7ed3\u679c\uff1f\n\n\u6beb\u65e0\u7591\u95ee\uff0cRedis \u4f1a\u6301\u7eed\u626b\u63cf\u8fc7\u671f\u5b57\u5178 (\u5faa\u73af\u591a\u6b21)\uff0c\u76f4\u5230\u8fc7\u671f\u5b57\u5178\u4e2d\u8fc7\u671f\u7684 key \u53d8\u5f97\u7a00\u758f\uff0c\u624d\u4f1a\u505c\u6b62 (\u5faa\u73af\u6b21\u6570\u660e\u663e\u4e0b\u964d)\u3002\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u7ebf\u4e0a\u8bfb\u5199\u8bf7\u6c42\u51fa\u73b0\u660e\u663e\u7684\u5361\u987f\u73b0\u8c61\u3002\u5bfc\u81f4\u8fd9\u79cd\u5361\u987f\u7684\u53e6\u5916\u4e00\u79cd\u539f\u56e0\u662f\u5185\u5b58\u7ba1\u7406\u5668\u9700\u8981\u9891\u7e41\u56de\u6536\u5185\u5b58\u9875\uff0c\u8fd9\u4e5f\u4f1a\u4ea7\u751f\u4e00\u5b9a\u7684 CPU \u6d88\u8017\u3002\n\n\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u5230\u6765\u65f6\uff0c\u670d\u52a1\u5668\u5982\u679c\u6b63\u597d\u8fdb\u5165\u8fc7\u671f\u626b\u63cf\u72b6\u6001\uff0c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5c06\u4f1a\u7b49\u5f85\u81f3\u5c11 25ms \u540e\u624d\u4f1a\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5c06\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u7684\u6bd4\u8f83\u77ed\uff0c\u6bd4\u5982 10ms\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u94fe\u63a5\u56e0\u4e3a\u8d85\u65f6\u800c\u5173\u95ed\uff0c\u4e1a\u52a1\u7aef\u5c31\u4f1a\u51fa\u73b0\u5f88\u591a\u5f02\u5e38\u3002\u800c\u4e14\u8fd9\u65f6\u4f60\u8fd8\u65e0\u6cd5\u4ece Redis \u7684 slowlog \u4e2d\u770b\u5230\u6162\u67e5\u8be2\u8bb0\u5f55\uff0c\u56e0\u4e3a\u6162\u67e5\u8be2\u6307\u7684\u662f\u903b\u8f91\u5904\u7406\u8fc7\u7a0b\u6162\uff0c\u4e0d\u5305\u542b\u7b49\u5f85\u65f6\u95f4\u3002\n\n\u6240\u4ee5\u4e1a\u52a1\u5f00\u53d1\u4eba\u5458\u4e00\u5b9a\u8981\u6ce8\u610f\u8fc7\u671f\u65f6\u95f4\uff0c\u5982\u679c\u6709\u5927\u6279\u91cf\u7684 key \u8fc7\u671f\uff0c\u8981\u7ed9\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e00\u4e2a\u968f\u673a\u8303\u56f4\uff0c\u800c\u4e0d\u5b9c\u5168\u90e8\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff0c\u5206\u6563\u8fc7\u671f\u5904\u7406\u7684\u538b\u529b\u3002\n```py\n# \u5728\u76ee\u6807\u8fc7\u671f\u65f6\u95f4\u4e0a\u589e\u52a0\u4e00\u5929\u7684\u968f\u673a\u65f6\u95f4\nredis.expire_at(key, random.randint(86400) + expire_ts)\n```\n\n\u5728\u4e00\u4e9b\u6d3b\u52a8\u7cfb\u7edf\u4e2d\uff0c\u56e0\u4e3a\u6d3b\u52a8\u662f\u4e00\u671f\u4e00\u4f1a\uff0c\u4e0b\u4e00\u671f\u6d3b\u52a8\u4e3e\u529e\u65f6\uff0c\u524d\u9762\u51e0\u671f\u7684\u5f88\u591a\u6570\u636e\u90fd\u53ef\u4ee5\u4e22\u5f03\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u7ed9\u76f8\u5173\u7684\u6d3b\u52a8\u6570\u636e\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684 Redis \u5185\u5b58\u5360\u7528\u3002\u5982\u679c\u4e0d\u52a0\u6ce8\u610f\uff0c\u4f60\u53ef\u80fd\u4f1a\u5c06\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u6d3b\u52a8\u7ed3\u675f\u65f6\u95f4\u518d\u589e\u52a0\u4e00\u4e2a\u5e38\u91cf\u7684\u5197\u4f59\u65f6\u95f4\uff0c\u5982\u679c\u53c2\u4e0e\u6d3b\u52a8\u7684\u4eba\u6570\u592a\u591a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5927\u91cf\u7684 key \u540c\u65f6\u8fc7\u671f\u3002\n\n\u638c\u9605\u670d\u52a1\u7aef\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5c31\u66fe\u51fa\u73b0\u8fc7\u591a\u6b21\u56e0\u4e3a\u5927\u91cf key \u540c\u65f6\u8fc7\u671f\u5bfc\u81f4\u7684\u5361\u987f\u62a5\u8b66\u73b0\u8c61\uff0c\u901a\u8fc7\u5c06\u8fc7\u671f\u65f6\u95f4\u968f\u673a\u5316\u603b\u662f\u80fd\u5f88\u597d\u5730\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u5e0c\u671b\u8bfb\u8005\u4eec\u4eca\u540e\u80fd\u5c11\u72af\u8fd9\u6837\u7684\u9519\u8bef\u3002\n\n## \u4ece\u5e93\u7684\u8fc7\u671f\u7b56\u7565\n\n\u4ece\u5e93\u4e0d\u4f1a\u8fdb\u884c\u8fc7\u671f\u626b\u63cf\uff0c\u4ece\u5e93\u5bf9\u8fc7\u671f\u7684\u5904\u7406\u662f\u88ab\u52a8\u7684\u3002\u4e3b\u5e93\u5728 key \u5230\u671f\u65f6\uff0c\u4f1a\u5728 AOF \u6587\u4ef6\u91cc\u589e\u52a0\u4e00\u6761 `del` \u6307\u4ee4\uff0c\u540c\u6b65\u5230\u6240\u6709\u7684\u4ece\u5e93\uff0c\u4ece\u5e93\u901a\u8fc7\u6267\u884c\u8fd9\u6761 `del` \u6307\u4ee4\u6765\u5220\u9664\u8fc7\u671f\u7684 key\u3002\n\n\u56e0\u4e3a\u6307\u4ee4\u540c\u6b65\u662f\u5f02\u6b65\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u4e3b\u5e93\u8fc7\u671f\u7684 key \u7684 `del` \u6307\u4ee4\u6ca1\u6709\u53ca\u65f6\u540c\u6b65\u5230\u4ece\u5e93\u7684\u8bdd\uff0c\u4f1a\u51fa\u73b0\u4e3b\u4ece\u6570\u636e\u7684\u4e0d\u4e00\u81f4\uff0c\u4e3b\u5e93\u6ca1\u6709\u7684\u6570\u636e\u5728\u4ece\u5e93\u91cc\u8fd8\u5b58\u5728\uff0c\u6bd4\u5982\u4e0a\u4e00\u8282\u7684\u96c6\u7fa4\u73af\u5883\u5206\u5e03\u5f0f\u9501\u7684\u7b97\u6cd5\u6f0f\u6d1e\u5c31\u662f\u56e0\u4e3a\u8fd9\u4e2a\u540c\u6b65\u5ef6\u8fdf\u4ea7\u751f\u7684\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/25\u62d3\u5c55_4\u671d\u751f\u66ae\u6b7b__\u8fc7\u671f\u7b56\u7565.md", "create_date": "2020-02-18T03:01:05.884", "order": 26}}, {"model": "subject.chapter", "pk": 31, "fields": {"title": "23\u62d3\u5c55 2\uff1a\u65e0\u6240\u4e0d\u77e5 \u2014\u2014 Info \u6307\u4ee4", "topic": 2, "md5": "fddc85e64d285f822fd12484284384a8", "md_body": "# \u62d3\u5c55 2\uff1a\u65e0\u6240\u4e0d\u77e5 \u2014\u2014 Info \u6307\u4ee4\n\n\u5728\u4f7f\u7528 Redis \u65f6\uff0c\u65f6\u5e38\u4f1a\u9047\u5230\u5f88\u591a\u95ee\u9898\u9700\u8981\u8bca\u65ad\uff0c\u5728\u8bca\u65ad\u4e4b\u524d\u9700\u8981\u4e86\u89e3 Redis \u7684\u8fd0\u884c\u72b6\u6001\uff0c\u901a\u8fc7\u5f3a\u5927\u7684 Info \u6307\u4ee4\uff0c\u4f60\u53ef\u4ee5\u6e05\u6670\u5730\u77e5\u9053 Redis \u5185\u90e8\u4e00\u7cfb\u5217\u8fd0\u884c\u53c2\u6570\u3002\n\nInfo \u6307\u4ee4\u663e\u793a\u7684\u4fe1\u606f\u975e\u5e38\u7e41\u591a\uff0c\u5206\u4e3a 9 \u5927\u5757\uff0c\u6bcf\u4e2a\u5757\u90fd\u6709\u975e\u5e38\u591a\u7684\u53c2\u6570\uff0c\u8fd9 9 \u4e2a\u5757\u5206\u522b\u662f:\n1. Server  \u670d\u52a1\u5668\u8fd0\u884c\u7684\u73af\u5883\u53c2\u6570\n2. Clients \u5ba2\u6237\u7aef\u76f8\u5173\u4fe1\u606f\n3. Memory \u670d\u52a1\u5668\u8fd0\u884c\u5185\u5b58\u7edf\u8ba1\u6570\u636e\n4. Persistence \u6301\u4e45\u5316\u4fe1\u606f\n5. Stats \u901a\u7528\u7edf\u8ba1\u6570\u636e\n6. Replication \u4e3b\u4ece\u590d\u5236\u76f8\u5173\u4fe1\u606f\n7. CPU CPU \u4f7f\u7528\u60c5\u51b5\n8. Cluster \u96c6\u7fa4\u4fe1\u606f\n9. KeySpace \u952e\u503c\u5bf9\u7edf\u8ba1\u6570\u91cf\u4fe1\u606f\n\nInfo \u53ef\u4ee5\u4e00\u6b21\u6027\u83b7\u53d6\u6240\u6709\u7684\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u6309\u5757\u53d6\u4fe1\u606f\u3002\n```\n# \u83b7\u53d6\u6240\u6709\u4fe1\u606f\n> info\n# \u83b7\u53d6\u5185\u5b58\u76f8\u5173\u4fe1\u606f\n> info memory\n# \u83b7\u53d6\u590d\u5236\u76f8\u5173\u4fe1\u606f\n> info replication\n```\n\u8003\u8651\u5230\u53c2\u6570\u975e\u5e38\u7e41\u591a\uff0c\u4e00\u4e00\u8bf4\u660e\u5de5\u4f5c\u91cf\u5de8\u5927\uff0c\u4e0b\u9762\u6211\u53ea\u6311\u4e00\u4e9b\u5173\u952e\u6027\u7684\u3001\u975e\u5e38\u5b9e\u7528\u548c\u6700\u5e38\u7528\u7684\u53c2\u6570\u8fdb\u884c\u8be6\u7ec6\u8bb2\u89e3\u3002\u5982\u679c\u8bfb\u8005\u60f3\u8981\u4e86\u89e3\u6240\u6709\u7684\u53c2\u6570\u7ec6\u8282\uff0c\u8bf7\u53c2\u8003\u9605\u8bfb [Redis \u5b98\u7f51\u6587\u6863](https://redis.io/commands/info)\u3002\n\n## Redis \u6bcf\u79d2\u6267\u884c\u591a\u5c11\u6b21\u6307\u4ee4\uff1f\n\n![](https://user-gold-cdn.xitu.io/2018/7/16/164a14ce6633c24a?w=345&h=220&f=png&s=19427)\n\n\u8fd9\u4e2a\u4fe1\u606f\u5728 Stats \u5757\u91cc\uff0c\u53ef\u4ee5\u901a\u8fc7 `info stats` \u770b\u5230\u3002\n```\n# ops_per_sec: operations per second\uff0c\u4e5f\u5c31\u662f\u6bcf\u79d2\u64cd\u4f5c\u6570\n> redis-cli info stats |grep ops\ninstantaneous_ops_per_sec:789\n```\n![](https://user-gold-cdn.xitu.io/2018/7/13/1649181bd00bed33?w=306&h=147&f=png&s=20852)\n\u4ee5\u4e0a\uff0c\u8868\u793a ops \u662f 789\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u5ba2\u6237\u7aef\u6bcf\u79d2\u4f1a\u53d1\u9001 789 \u6761\u6307\u4ee4\u5230\u670d\u52a1\u5668\u6267\u884c\u3002\u6781\u9650\u60c5\u51b5\u4e0b\uff0cRedis \u53ef\u4ee5\u6bcf\u79d2\u6267\u884c 10w \u6b21\u6307\u4ee4\uff0cCPU \u51e0\u4e4e\u5b8c\u5168\u69a8\u5e72\u3002\u5982\u679c qps \u8fc7\u9ad8\uff0c\u53ef\u4ee5\u8003\u8651\u901a\u8fc7 `monitor` \u6307\u4ee4\u5feb\u901f\u89c2\u5bdf\u4e00\u4e0b\u7a76\u7adf\u662f\u54ea\u4e9b key \u8bbf\u95ee\u6bd4\u8f83\u9891\u7e41\uff0c\u4ece\u800c\u5728\u76f8\u5e94\u7684\u4e1a\u52a1\u4e0a\u8fdb\u884c\u4f18\u5316\uff0c\u4ee5\u51cf\u5c11 IO \u6b21\u6570\u3002`monitor` \u6307\u4ee4\u4f1a\u77ac\u95f4\u5410\u51fa\u6765\u5de8\u91cf\u7684\u6307\u4ee4\u6587\u672c\uff0c\u6240\u4ee5\u4e00\u822c\u5728\u6267\u884c `monitor` \u540e\u7acb\u5373 `ctrl+c `\u4e2d\u65ad\u8f93\u51fa\u3002\n\n```\n> redis-cli monitor\n```\n\n## Redis \u8fde\u63a5\u4e86\u591a\u5c11\u5ba2\u6237\u7aef\uff1f\n\n\u8fd9\u4e2a\u4fe1\u606f\u5728 Clients \u5757\u91cc\uff0c\u53ef\u4ee5\u901a\u8fc7 `info clients` \u770b\u5230\u3002\n```\n> redis-cli info clients\n# Clients\nconnected_clients:124  # \u8fd9\u4e2a\u5c31\u662f\u6b63\u5728\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u6570\u91cf\nclient_longest_output_list:0\nclient_biggest_input_buf:0\nblocked_clients:0\n```\n\u8fd9\u4e2a\u4fe1\u606f\u4e5f\u662f\u6bd4\u8f83\u6709\u7528\u7684\uff0c\u901a\u8fc7\u89c2\u5bdf\u8fd9\u4e2a\u6570\u91cf\u53ef\u4ee5\u786e\u5b9a\u662f\u5426\u5b58\u5728\u610f\u6599\u4e4b\u5916\u7684\u8fde\u63a5\u3002\u5982\u679c\u53d1\u73b0\u8fd9\u4e2a\u6570\u91cf\u4e0d\u5bf9\u52b2\uff0c\u63a5\u7740\u5c31\u53ef\u4ee5\u4f7f\u7528```client list```\u6307\u4ee4\u5217\u51fa\u6240\u6709\u7684\u5ba2\u6237\u7aef\u94fe\u63a5\u5730\u5740\u6765\u786e\u5b9a\u6e90\u5934\u3002\n\n\u5173\u4e8e\u5ba2\u6237\u7aef\u7684\u6570\u91cf\u8fd8\u6709\u4e2a\u91cd\u8981\u7684\u53c2\u6570\u9700\u8981\u89c2\u5bdf\uff0c\u90a3\u5c31\u662f```rejected_connections```\uff0c\u5b83\u8868\u793a\u56e0\u4e3a\u8d85\u51fa\u6700\u5927\u8fde\u63a5\u6570\u9650\u5236\u800c\u88ab\u62d2\u7edd\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u6b21\u6570\uff0c\u5982\u679c\u8fd9\u4e2a\u6570\u5b57\u5f88\u5927\uff0c\u610f\u5473\u7740\u670d\u52a1\u5668\u7684\u6700\u5927\u8fde\u63a5\u6570\u8bbe\u7f6e\u7684\u8fc7\u4f4e\u9700\u8981\u8c03\u6574 `maxclients` \u53c2\u6570\u3002\n```\n> redis-cli info stats |grep reject\nrejected_connections:0\n```\n\n## Redis \u5185\u5b58\u5360\u7528\u591a\u5927 ?\n\n![](https://user-gold-cdn.xitu.io/2018/7/16/164a14efc8e3e44b?w=362&h=216&f=png&s=13620)\n\n\u8fd9\u4e2a\u4fe1\u606f\u5728 Memory \u5757\u91cc\uff0c\u53ef\u4ee5\u901a\u8fc7 `info memory` \u770b\u5230\u3002\n```\n> redis-cli info memory | grep used | grep human\nused_memory_human:827.46K # \u5185\u5b58\u5206\u914d\u5668 (jemalloc) \u4ece\u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7684\u5185\u5b58\u603b\u91cf\nused_memory_rss_human:3.61M  # \u64cd\u4f5c\u7cfb\u7edf\u770b\u5230\u7684\u5185\u5b58\u5360\u7528 ,top \u547d\u4ee4\u770b\u5230\u7684\u5185\u5b58\nused_memory_peak_human:829.41K  # Redis \u5185\u5b58\u6d88\u8017\u7684\u5cf0\u503c\nused_memory_lua_human:37.00K # lua \u811a\u672c\u5f15\u64ce\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\n```\n\u5982\u679c\u5355\u4e2a Redis \u5185\u5b58\u5360\u7528\u8fc7\u5927\uff0c\u5e76\u4e14\u5728\u4e1a\u52a1\u4e0a\u6ca1\u6709\u592a\u591a\u538b\u7f29\u7684\u7a7a\u95f4\u7684\u8bdd\uff0c\u53ef\u4ee5\u8003\u8651\u96c6\u7fa4\u5316\u4e86\u3002\n\n## \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u591a\u5927\uff1f\n\n\u8fd9\u4e2a\u4fe1\u606f\u5728 Replication \u5757\u91cc\uff0c\u53ef\u4ee5\u901a\u8fc7 `info replication` \u770b\u5230\u3002\n```\n> redis-cli info replication |grep backlog\nrepl_backlog_active:0\nrepl_backlog_size:1048576  # \u8fd9\u4e2a\u5c31\u662f\u79ef\u538b\u7f13\u51b2\u533a\u5927\u5c0f\nrepl_backlog_first_byte_offset:0\nrepl_backlog_histlen:0\n```\n\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5927\u5c0f\u975e\u5e38\u91cd\u8981\uff0c\u5b83\u4e25\u91cd\u5f71\u54cd\u5230\u4e3b\u4ece\u590d\u5236\u7684\u6548\u7387\u3002\u5f53\u4ece\u5e93\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\u4e34\u65f6\u65ad\u5f00\u4e86\u4e3b\u5e93\u7684\u590d\u5236\uff0c\u7136\u540e\u7f51\u7edc\u6062\u590d\u4e86\uff0c\u53c8\u91cd\u65b0\u8fde\u4e0a\u7684\u65f6\u5019\uff0c\u8fd9\u6bb5\u65ad\u5f00\u7684\u65f6\u95f4\u5185\u53d1\u751f\u5728 master \u4e0a\u7684\u4fee\u6539\u64cd\u4f5c\u6307\u4ee4\u90fd\u4f1a\u653e\u5728\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\uff0c\u8fd9\u6837\u4ece\u5e93\u53ef\u4ee5\u901a\u8fc7\u79ef\u538b\u7f13\u51b2\u533a\u6062\u590d\u4e2d\u65ad\u7684\u4e3b\u4ece\u540c\u6b65\u8fc7\u7a0b\u3002\n\n\u79ef\u538b\u7f13\u51b2\u533a\u662f\u73af\u5f62\u7684\uff0c\u540e\u6765\u7684\u6307\u4ee4\u4f1a\u8986\u76d6\u6389\u524d\u9762\u7684\u5185\u5bb9\u3002\u5982\u679c\u4ece\u5e93\u65ad\u5f00\u7684\u65f6\u95f4\u8fc7\u957f\uff0c\u6216\u8005\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u8bbe\u7f6e\u7684\u592a\u5c0f\uff0c\u90fd\u4f1a\u5bfc\u81f4\u4ece\u5e93\u65e0\u6cd5\u5feb\u901f\u6062\u590d\u4e2d\u65ad\u7684\u4e3b\u4ece\u540c\u6b65\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u4e2d\u95f4\u7684\u4fee\u6539\u6307\u4ee4\u88ab\u8986\u76d6\u6389\u4e86\u3002\u8fd9\u65f6\u5019\u4ece\u5e93\u5c31\u4f1a\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u6a21\u5f0f\uff0c\u975e\u5e38\u8017\u8d39 CPU \u548c\u7f51\u7edc\u8d44\u6e90\u3002\n\n\u5982\u679c\u6709\u591a\u4e2a\u4ece\u5e93\u590d\u5236\uff0c\u79ef\u538b\u7f13\u51b2\u533a\u662f\u5171\u4eab\u7684\uff0c\u5b83\u4e0d\u4f1a\u56e0\u4e3a\u4ece\u5e93\u8fc7\u591a\u800c\u7ebf\u6027\u589e\u957f\u3002\u5982\u679c\u5b9e\u4f8b\u7684\u4fee\u6539\u6307\u4ee4\u8bf7\u6c42\u5f88\u9891\u7e41\uff0c\u90a3\u5c31\u628a\u79ef\u538b\u7f13\u51b2\u533a\u8c03\u5927\u4e00\u4e9b\uff0c\u51e0\u5341\u4e2a M \u5927\u5c0f\u5dee\u4e0d\u591a\u4e86\uff0c\u5982\u679c\u5f88\u95f2\uff0c\u90a3\u5c31\u8bbe\u7f6e\u4e3a\u51e0\u4e2a M\u3002\n```\n> redis-cli info stats | grep sync\nsync_full:0\nsync_partial_ok:0\nsync_partial_err:0  # \u534a\u540c\u6b65\u5931\u8d25\u6b21\u6570\n```\n\u901a\u8fc7\u67e5\u770b```sync_partial_err```\u53d8\u91cf\u7684\u6b21\u6570\u6765\u51b3\u5b9a\u662f\u5426\u9700\u8981\u6269\u5927\u79ef\u538b\u7f13\u51b2\u533a\uff0c\u5b83\u8868\u793a\u4e3b\u4ece\u534a\u540c\u6b65\u590d\u5236\u5931\u8d25\u7684\u6b21\u6570\u3002\n\n## \u601d\u8003\n\n\u5e73\u65f6\u4f60\u4eec\u5728\u4f7f\u7528 Redis \u65f6\u8fd8\u9700\u8981\u67e5\u770b\u54ea\u4e9b\u91cd\u8981\u7684\u4fe1\u606f\uff0c\u80fd\u4e0d\u80fd\u76f4\u63a5\u5728 Info \u4fe1\u606f\u91cc\u83b7\u53d6\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/23\u62d3\u5c55_2\u65e0\u6240\u4e0d\u77e5__Info_\u6307\u4ee4.md", "create_date": "2020-02-18T03:01:05.893", "order": 24}}, {"model": "subject.chapter", "pk": 32, "fields": {"title": "26\u62d3\u5c55 5\uff1a\u4f18\u80dc\u52a3\u6c70 \u2014\u2014 LRU", "topic": 2, "md5": "52765d51318921d85d3eccde54aff115", "md_body": "# \u62d3\u5c55 5\uff1a\u4f18\u80dc\u52a3\u6c70 \u2014\u2014 LRU\n\n\u5f53 Redis \u5185\u5b58\u8d85\u51fa\u7269\u7406\u5185\u5b58\u9650\u5236\u65f6\uff0c\u5185\u5b58\u7684\u6570\u636e\u4f1a\u5f00\u59cb\u548c\u78c1\u76d8\u4ea7\u751f\u9891\u7e41\u7684\u4ea4\u6362 (swap)\u3002\u4ea4\u6362\u4f1a\u8ba9 Redis \u7684\u6027\u80fd\u6025\u5267\u4e0b\u964d\uff0c\u5bf9\u4e8e\u8bbf\u95ee\u91cf\u6bd4\u8f83\u9891\u7e41\u7684 Redis \u6765\u8bf4\uff0c\u8fd9\u6837\u9f9f\u901f\u7684\u5b58\u53d6\u6548\u7387\u57fa\u672c\u4e0a\u7b49\u4e8e\u4e0d\u53ef\u7528\u3002\n\n\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6211\u4eec\u662f\u4e0d\u5141\u8bb8 Redis \u51fa\u73b0\u4ea4\u6362\u884c\u4e3a\u7684\uff0c\u4e3a\u4e86\u9650\u5236\u6700\u5927\u4f7f\u7528\u5185\u5b58\uff0cRedis \u63d0\u4f9b\u4e86\u914d\u7f6e\u53c2\u6570 `maxmemory` \u6765\u9650\u5236\u5185\u5b58\u8d85\u51fa\u671f\u671b\u5927\u5c0f\u3002\n\n\u5f53\u5b9e\u9645\u5185\u5b58\u8d85\u51fa `maxmemory` \u65f6\uff0cRedis \u63d0\u4f9b\u4e86\u51e0\u79cd\u53ef\u9009\u7b56\u7565 (maxmemory-policy) \u6765\u8ba9\u7528\u6237\u81ea\u5df1\u51b3\u5b9a\u8be5\u5982\u4f55\u817e\u51fa\u65b0\u7684\u7a7a\u95f4\u4ee5\u7ee7\u7eed\u63d0\u4f9b\u8bfb\u5199\u670d\u52a1\u3002\n\n**noeviction**\n\u4e0d\u4f1a\u7ee7\u7eed\u670d\u52a1\u5199\u8bf7\u6c42 (DEL \u8bf7\u6c42\u53ef\u4ee5\u7ee7\u7eed\u670d\u52a1)\uff0c\u8bfb\u8bf7\u6c42\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c\u3002\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u4f46\u662f\u4f1a\u8ba9\u7ebf\u4e0a\u7684\u4e1a\u52a1\u4e0d\u80fd\u6301\u7eed\u8fdb\u884c\u3002\u8fd9\u662f\u9ed8\u8ba4\u7684\u6dd8\u6c70\u7b56\u7565\u3002\n\n**volatile-lru**\n\u5c1d\u8bd5\u6dd8\u6c70\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key\uff0c\u6700\u5c11\u4f7f\u7528\u7684 key \u4f18\u5148\u88ab\u6dd8\u6c70\u3002\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684 key \u4e0d\u4f1a\u88ab\u6dd8\u6c70\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u9700\u8981\u6301\u4e45\u5316\u7684\u6570\u636e\u4e0d\u4f1a\u7a81\u7136\u4e22\u5931\u3002\n\n**volatile-ttl**\n\u8ddf\u4e0a\u9762\u4e00\u6837\uff0c\u9664\u4e86\u6dd8\u6c70\u7684\u7b56\u7565\u4e0d\u662f LRU\uff0c\u800c\u662f key \u7684\u5269\u4f59\u5bff\u547d ttl \u7684\u503c\uff0cttl \u8d8a\u5c0f\u8d8a\u4f18\u5148\u88ab\u6dd8\u6c70\u3002\n\n**volatile-random**\n\u8ddf\u4e0a\u9762\u4e00\u6837\uff0c\u4e0d\u8fc7\u6dd8\u6c70\u7684 key \u662f\u8fc7\u671f key \u96c6\u5408\u4e2d\u968f\u673a\u7684 key\u3002\n\n**allkeys-lru**\n\u533a\u522b\u4e8e volatile-lru\uff0c\u8fd9\u4e2a\u7b56\u7565\u8981\u6dd8\u6c70\u7684 key \u5bf9\u8c61\u662f\u5168\u4f53\u7684 key \u96c6\u5408\uff0c\u800c\u4e0d\u53ea\u662f\u8fc7\u671f\u7684 key \u96c6\u5408\u3002\u8fd9\u610f\u5473\u7740\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684 key \u4e5f\u4f1a\u88ab\u6dd8\u6c70\u3002\n\n**allkeys-random**\n\u8ddf\u4e0a\u9762\u4e00\u6837\uff0c\u4e0d\u8fc7\u6dd8\u6c70\u7684\u7b56\u7565\u662f\u968f\u673a\u7684 key\u3002\n\nvolatile-xxx \u7b56\u7565\u53ea\u4f1a\u9488\u5bf9\u5e26\u8fc7\u671f\u65f6\u95f4\u7684 key \u8fdb\u884c\u6dd8\u6c70\uff0callkeys-xxx \u7b56\u7565\u4f1a\u5bf9\u6240\u6709\u7684 key \u8fdb\u884c\u6dd8\u6c70\u3002\u5982\u679c\u4f60\u53ea\u662f\u62ff Redis \u505a\u7f13\u5b58\uff0c\u90a3\u5e94\u8be5\u4f7f\u7528 allkeys-xxx\uff0c\u5ba2\u6237\u7aef\u5199\u7f13\u5b58\u65f6\u4e0d\u5fc5\u643a\u5e26\u8fc7\u671f\u65f6\u95f4\u3002\u5982\u679c\u4f60\u8fd8\u60f3\u540c\u65f6\u4f7f\u7528 Redis \u7684\u6301\u4e45\u5316\u529f\u80fd\uff0c\u90a3\u5c31\u4f7f\u7528 volatile-xxx \u7b56\u7565\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u7559\u6ca1\u6709\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684 key\uff0c\u5b83\u4eec\u662f\u6c38\u4e45\u7684 key \u4e0d\u4f1a\u88ab LRU \u7b97\u6cd5\u6dd8\u6c70\u3002\n\n## LRU \u7b97\u6cd5\n\n\u5b9e\u73b0 LRU \u7b97\u6cd5\u9664\u4e86\u9700\u8981 key/value \u5b57\u5178\u5916\uff0c\u8fd8\u9700\u8981\u9644\u52a0\u4e00\u4e2a\u94fe\u8868\uff0c\u94fe\u8868\u4e2d\u7684\u5143\u7d20\u6309\u7167\u4e00\u5b9a\u7684\u987a\u5e8f\u8fdb\u884c\u6392\u5217\u3002\u5f53\u7a7a\u95f4\u6ee1\u7684\u65f6\u5019\uff0c\u4f1a\u8e22\u6389\u94fe\u8868\u5c3e\u90e8\u7684\u5143\u7d20\u3002\u5f53\u5b57\u5178\u7684\u67d0\u4e2a\u5143\u7d20\u88ab\u8bbf\u95ee\u65f6\uff0c\u5b83\u5728\u94fe\u8868\u4e2d\u7684\u4f4d\u7f6e\u4f1a\u88ab\u79fb\u52a8\u5230\u8868\u5934\u3002\u6240\u4ee5\u94fe\u8868\u7684\u5143\u7d20\u6392\u5217\u987a\u5e8f\u5c31\u662f\u5143\u7d20\u6700\u8fd1\u88ab\u8bbf\u95ee\u7684\u65f6\u95f4\u987a\u5e8f\u3002\n\n\u4f4d\u4e8e\u94fe\u8868\u5c3e\u90e8\u7684\u5143\u7d20\u5c31\u662f\u4e0d\u88ab\u91cd\u7528\u7684\u5143\u7d20\uff0c\u6240\u4ee5\u4f1a\u88ab\u8e22\u6389\u3002\u4f4d\u4e8e\u8868\u5934\u7684\u5143\u7d20\u5c31\u662f\u6700\u8fd1\u521a\u521a\u88ab\u4eba\u7528\u8fc7\u7684\u5143\u7d20\uff0c\u6240\u4ee5\u6682\u65f6\u4e0d\u4f1a\u88ab\u8e22\u3002\n\n\u4e0b\u9762\u6211\u4eec\u4f7f\u7528 Python \u7684 OrderedDict(\u53cc\u5411\u94fe\u8868 + \u5b57\u5178) \u6765\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 LRU \u7b97\u6cd5\u3002\n```py\nfrom collections import OrderedDict\n\nclass LRUDict(OrderedDict):\n\n    def __init__(self, capacity):\n        self.capacity = capacity\n        self.items = OrderedDict()\n\n    def __setitem__(self, key, value):\n        old_value = self.items.get(key)\n        if old_value is not None:\n            self.items.pop(key)\n            self.items[key] = value\n        elif len(self.items) < self.capacity:\n            self.items[key] = value\n        else:\n            self.items.popitem(last=True)\n            self.items[key] = value\n\n    def __getitem__(self, key):\n        value = self.items.get(key)\n        if value is not None:\n            self.items.pop(key)\n            self.items[key] = value\n        return value\n\n    def __repr__(self):\n        return repr(self.items)\n\n\nd = LRUDict(10)\n\nfor i in range(15):\n    d[i] = i\nprint d\n```\n\n## \u8fd1\u4f3c LRU \u7b97\u6cd5\n\nRedis \u4f7f\u7528\u7684\u662f\u4e00\u79cd\u8fd1\u4f3c LRU \u7b97\u6cd5\uff0c\u5b83\u8ddf LRU \u7b97\u6cd5\u8fd8\u4e0d\u592a\u4e00\u6837\u3002\u4e4b\u6240\u4ee5\u4e0d\u4f7f\u7528 LRU \u7b97\u6cd5\uff0c\u662f\u56e0\u4e3a\u9700\u8981\u6d88\u8017\u5927\u91cf\u7684\u989d\u5916\u7684\u5185\u5b58\uff0c\u9700\u8981\u5bf9\u73b0\u6709\u7684\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u8f83\u5927\u7684\u6539\u9020\u3002\u8fd1\u4f3c LRU \u7b97\u6cd5\u5219\u5f88\u7b80\u5355\uff0c\u5728\u73b0\u6709\u6570\u636e\u7ed3\u6784\u7684\u57fa\u7840\u4e0a\u4f7f\u7528\u968f\u673a\u91c7\u6837\u6cd5\u6765\u6dd8\u6c70\u5143\u7d20\uff0c\u80fd\u8fbe\u5230\u548c LRU \u7b97\u6cd5\u975e\u5e38\u8fd1\u4f3c\u7684\u6548\u679c\u3002Redis \u4e3a\u5b9e\u73b0\u8fd1\u4f3c LRU \u7b97\u6cd5\uff0c\u5b83\u7ed9\u6bcf\u4e2a key \u589e\u52a0\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u5c0f\u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u7684\u957f\u5ea6\u662f 24 \u4e2a bit\uff0c\u4e5f\u5c31\u662f\u6700\u540e\u4e00\u6b21\u88ab\u8bbf\u95ee\u7684\u65f6\u95f4\u6233\u3002\n\n\u4e0a\u4e00\u8282\u63d0\u5230\u5904\u7406 key \u8fc7\u671f\u65b9\u5f0f\u5206\u4e3a\u96c6\u4e2d\u5904\u7406\u548c\u61d2\u60f0\u5904\u7406\uff0cLRU \u6dd8\u6c70\u4e0d\u4e00\u6837\uff0c\u5b83\u7684\u5904\u7406\u65b9\u5f0f\u53ea\u6709\u61d2\u60f0\u5904\u7406\u3002\u5f53 Redis \u6267\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u53d1\u73b0\u5185\u5b58\u8d85\u51fa maxmemory\uff0c\u5c31\u4f1a\u6267\u884c\u4e00\u6b21 LRU \u6dd8\u6c70\u7b97\u6cd5\u3002\u8fd9\u4e2a\u7b97\u6cd5\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u968f\u673a\u91c7\u6837\u51fa 5(\u53ef\u4ee5\u914d\u7f6e) \u4e2a key\uff0c\u7136\u540e\u6dd8\u6c70\u6389\u6700\u65e7\u7684 key\uff0c\u5982\u679c\u6dd8\u6c70\u540e\u5185\u5b58\u8fd8\u662f\u8d85\u51fa maxmemory\uff0c\u90a3\u5c31\u7ee7\u7eed\u968f\u673a\u91c7\u6837\u6dd8\u6c70\uff0c\u76f4\u5230\u5185\u5b58\u4f4e\u4e8e maxmemory \u4e3a\u6b62\u3002\n\n\u5982\u4f55\u91c7\u6837\u5c31\u662f\u770b maxmemory-policy \u7684\u914d\u7f6e\uff0c\u5982\u679c\u662f allkeys \u5c31\u662f\u4ece\u6240\u6709\u7684 key \u5b57\u5178\u4e2d\u968f\u673a\uff0c\u5982\u679c\u662f volatile \u5c31\u4ece\u5e26\u8fc7\u671f\u65f6\u95f4\u7684 key \u5b57\u5178\u4e2d\u968f\u673a\u3002\u6bcf\u6b21\u91c7\u6837\u591a\u5c11\u4e2a key \u770b\u7684\u662f maxmemory_samples \u7684\u914d\u7f6e\uff0c\u9ed8\u8ba4\u4e3a 5\u3002\n\n\u4e0b\u9762\u662f\u968f\u673a LRU \u7b97\u6cd5\u548c\u4e25\u683c LRU \u7b97\u6cd5\u7684\u6548\u679c\u5bf9\u6bd4\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/7/17/164a60daf989f5e2?w=854&h=449&f=png&s=435399)\n\n\u56fe\u4e2d\u7eff\u8272\u90e8\u5206\u662f\u65b0\u52a0\u5165\u7684 key\uff0c\u6df1\u7070\u8272\u90e8\u5206\u662f\u8001\u65e7\u7684 key\uff0c\u6d45\u7070\u8272\u90e8\u5206\u662f\u901a\u8fc7 LRU \u7b97\u6cd5\u6dd8\u6c70\u6389\u7684 key\u3002\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\u91c7\u6837\u6570\u91cf\u8d8a\u5927\uff0c\u8fd1\u4f3c LRU \u7b97\u6cd5\u7684\u6548\u679c\u8d8a\u63a5\u8fd1\u4e25\u683c LRU \u7b97\u6cd5\u3002\u540c\u65f6 Redis3.0 \u5728\u7b97\u6cd5\u4e2d\u589e\u52a0\u4e86\u6dd8\u6c70\u6c60\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u8fd1\u4f3c LRU \u7b97\u6cd5\u7684\u6548\u679c\u3002\n\n\u6dd8\u6c70\u6c60\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5b83\u7684\u5927\u5c0f\u662f maxmemory_samples\uff0c\u5728\u6bcf\u4e00\u6b21\u6dd8\u6c70\u5faa\u73af\u4e2d\uff0c\u65b0\u968f\u673a\u51fa\u6765\u7684 key \u5217\u8868\u4f1a\u548c\u6dd8\u6c70\u6c60\u4e2d\u7684 key \u5217\u8868\u8fdb\u884c\u878d\u5408\uff0c\u6dd8\u6c70\u6389\u6700\u65e7\u7684\u4e00\u4e2a key \u4e4b\u540e\uff0c\u4fdd\u7559\u5269\u4f59\u8f83\u65e7\u7684 key \u5217\u8868\u653e\u5165\u6dd8\u6c70\u6c60\u4e2d\u7559\u5f85\u4e0b\u4e00\u4e2a\u5faa\u73af\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n- [\u300aRedis \u4f5c\u4e3a LRU Cache \u7684\u5b9e\u73b0\u300b](https://yq.aliyun.com/articles/63034)\n- [\u300aRedis LRU \u5b9e\u73b0\u7b56\u7565\u300b](https://blog.csdn.net/mysqldba23/article/details/68482894)\n\n## \u601d\u8003 & \u4f5c\u4e1a\n\n1. \u5982\u679c\u4f60\u662f Java \u7528\u6237\uff0c\u8bd5\u4e00\u8bd5\u7528 LinkedHashMap \u5b9e\u73b0\u4e00\u4e2a LRU \u5b57\u5178\u3002\n2. \u5982\u679c\u4f60\u662f Golang \u7528\u6237\uff0c\u9605\u8bfb\u4e00\u4e0b [golang-lru](https://github.com/hashicorp/golang-lru) \u7684\u6e90\u7801\u3002\n\n", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/26\u62d3\u5c55_5\u4f18\u80dc\u52a3\u6c70__LRU.md", "create_date": "2020-02-18T03:01:05.913", "order": 27}}, {"model": "subject.chapter", "pk": 33, "fields": {"title": "22\u62d3\u5c55 1\uff1a\u8033\u542c\u516b\u65b9 \u2014\u2014 Stream", "topic": 2, "md5": "956c1606d5020667c7a3209d897a1297", "md_body": "# \u62d3\u5c55 1\uff1a\u8033\u542c\u516b\u65b9 \u2014\u2014 Stream\n\n> \u8fd9\u7bc7\u6587\u7ae0\u7684\u4e3b\u8981\u90e8\u5206\u662f\u6211\u5728 2018 \u5e74 6 \u6708 1 \u65e5 \u53d1\u8868\u7684\u5185\u5bb9\uff0c\u5f53\u65f6 Redis5.0 \u521a\u521a\u88ab Antirez \u653e\u51fa\u6765\uff0c\u8001\u94b1\u62a2\u5148\u5206\u6790\u4e86 Redis5.0 \u6700\u91cd\u8981\u7684\u7279\u6027 Stream\uff0c\u4e5f\u88ab\u6280\u672f\u5708\u5927\u53f7\u300c\u9ad8\u53ef\u7528\u67b6\u6784\u300d\u6536\u5f55\u8f6c\u8f7d\uff0c\u53d7\u5230\u4e86\u5e7f\u6cdb\u5173\u6ce8\u3002\u4e8b\u540e\u6211\u53c8\u5bf9\u6587\u7ae0\u7684\u5185\u5bb9\u505a\u4e86\u8fdb\u4e00\u6b65\u4f18\u5316\uff0c\u5e76\u6574\u5408\u4e86\u4e00\u4e9b\u8bfb\u8005\u7684\u7591\u96be\u95ee\u9898\u89e3\u7b54\u3002\n\nRedis5.0 \u88ab\u4f5c\u8005 Antirez \u7a81\u7136\u653e\u4e86\u51fa\u6765\uff0c\u589e\u52a0\u4e86\u5f88\u591a\u65b0\u7684\u7279\u8272\u529f\u80fd\u3002\u800c Redis5.0 \u6700\u5927\u7684\u65b0\u7279\u6027\u5c31\u662f\u591a\u51fa\u4e86\u4e00\u4e2a\u6570\u636e\u7ed3\u6784 **Stream**\uff0c\u5b83\u662f\u4e00\u4e2a\u65b0\u7684\u5f3a\u5927\u7684\u652f\u6301\u591a\u64ad\u7684\u53ef\u6301\u4e45\u5316\u7684\u6d88\u606f\u961f\u5217\uff0c\u4f5c\u8005\u5766\u8a00 Redis Stream \u72e0\u72e0\u5730\u501f\u9274\u4e86 Kafka \u7684\u8bbe\u8ba1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/1/163bae206a809d56?w=880&h=645&f=png&s=55565)\n\nRedis Stream \u7684\u7ed3\u6784\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5b83\u6709\u4e00\u4e2a\u6d88\u606f\u94fe\u8868\uff0c\u5c06\u6240\u6709\u52a0\u5165\u7684\u6d88\u606f\u90fd\u4e32\u8d77\u6765\uff0c\u6bcf\u4e2a\u6d88\u606f\u90fd\u6709\u4e00\u4e2a\u552f\u4e00\u7684 ID \u548c\u5bf9\u5e94\u7684\u5185\u5bb9\u3002\u6d88\u606f\u662f\u6301\u4e45\u5316\u7684\uff0cRedis \u91cd\u542f\u540e\uff0c\u5185\u5bb9\u8fd8\u5728\u3002\n\n\u6bcf\u4e2a Stream \u90fd\u6709\u552f\u4e00\u7684\u540d\u79f0\uff0c\u5b83\u5c31\u662f Redis \u7684 key\uff0c\u5728\u6211\u4eec\u9996\u6b21\u4f7f\u7528```xadd```\u6307\u4ee4\u8ffd\u52a0\u6d88\u606f\u65f6\u81ea\u52a8\u521b\u5efa\u3002\n\n\u6bcf\u4e2a Stream \u90fd\u53ef\u4ee5\u6302\u591a\u4e2a\u6d88\u8d39\u7ec4\uff0c\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u4f1a\u6709\u4e2a\u6e38\u6807```last_delivered_id```\u5728 Stream \u6570\u7ec4\u4e4b\u4e0a\u5f80\u524d\u79fb\u52a8\uff0c\u8868\u793a\u5f53\u524d\u6d88\u8d39\u7ec4\u5df2\u7ecf\u6d88\u8d39\u5230\u54ea\u6761\u6d88\u606f\u4e86\u3002\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u90fd\u6709\u4e00\u4e2a Stream \u5185\u552f\u4e00\u7684\u540d\u79f0\uff0c\u6d88\u8d39\u7ec4\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efa\uff0c\u5b83\u9700\u8981\u5355\u72ec\u7684\u6307\u4ee4```xgroup create```\u8fdb\u884c\u521b\u5efa\uff0c\u9700\u8981\u6307\u5b9a\u4ece Stream \u7684\u67d0\u4e2a\u6d88\u606f ID \u5f00\u59cb\u6d88\u8d39\uff0c\u8fd9\u4e2a ID \u7528\u6765\u521d\u59cb\u5316```last_delivered_id```\u53d8\u91cf\u3002\n\n\u6bcf\u4e2a\u6d88\u8d39\u7ec4 (Consumer Group) \u7684\u72b6\u6001\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u76f8\u4e92\u4e0d\u53d7\u5f71\u54cd\u3002\u4e5f\u5c31\u662f\u8bf4\u540c\u4e00\u4efd Stream \u5185\u90e8\u7684\u6d88\u606f\u4f1a\u88ab\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u90fd\u6d88\u8d39\u5230\u3002\n\n\u540c\u4e00\u4e2a\u6d88\u8d39\u7ec4 (Consumer Group) \u53ef\u4ee5\u6302\u63a5\u591a\u4e2a\u6d88\u8d39\u8005 (Consumer)\uff0c\u8fd9\u4e9b\u6d88\u8d39\u8005\u4e4b\u95f4\u662f\u7ade\u4e89\u5173\u7cfb\uff0c\u4efb\u610f\u4e00\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\u6d88\u606f\u90fd\u4f1a\u4f7f\u6e38\u6807```last_delivered_id```\u5f80\u524d\u79fb\u52a8\u3002\u6bcf\u4e2a\u6d88\u8d39\u8005\u6709\u4e00\u4e2a\u7ec4\u5185\u552f\u4e00\u540d\u79f0\u3002\n\n\u6d88\u8d39\u8005 (Consumer) \u5185\u90e8\u4f1a\u6709\u4e2a\u72b6\u6001\u53d8\u91cf```pending_ids```\uff0c\u5b83\u8bb0\u5f55\u4e86\u5f53\u524d\u5df2\u7ecf\u88ab\u5ba2\u6237\u7aef\u8bfb\u53d6\u7684\u6d88\u606f\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709 ack\u3002\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709 ack\uff0c\u8fd9\u4e2a\u53d8\u91cf\u91cc\u9762\u7684\u6d88\u606f ID \u4f1a\u8d8a\u6765\u8d8a\u591a\uff0c\u4e00\u65e6\u67d0\u4e2a\u6d88\u606f\u88ab ack\uff0c\u5b83\u5c31\u5f00\u59cb\u51cf\u5c11\u3002\u8fd9\u4e2a pending_ids \u53d8\u91cf\u5728 Redis \u5b98\u65b9\u88ab\u79f0\u4e4b\u4e3a```PEL```\uff0c\u4e5f\u5c31\u662f```Pending Entries List```\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u6838\u5fc3\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u7528\u6765\u786e\u4fdd\u5ba2\u6237\u7aef\u81f3\u5c11\u6d88\u8d39\u4e86\u6d88\u606f\u4e00\u6b21\uff0c\u800c\u4e0d\u4f1a\u5728\u7f51\u7edc\u4f20\u8f93\u7684\u4e2d\u9014\u4e22\u5931\u4e86\u6ca1\u5904\u7406\u3002\n\n\n**\u6d88\u606f ID**\n--\n\n\u6d88\u606f ID \u7684\u5f62\u5f0f\u662f```timestampInMillis-sequence```\uff0c\u4f8b\u5982```1527846880572-5```\uff0c\u5b83\u8868\u793a\u5f53\u524d\u7684\u6d88\u606f\u5728\u6beb\u7c73\u65f6\u95f4\u6233```1527846880572```\u65f6\u4ea7\u751f\uff0c\u5e76\u4e14\u662f\u8be5\u6beb\u79d2\u5185\u4ea7\u751f\u7684\u7b2c 5 \u6761\u6d88\u606f\u3002\u6d88\u606f ID \u53ef\u4ee5\u7531\u670d\u52a1\u5668\u81ea\u52a8\u751f\u6210\uff0c\u4e5f\u53ef\u4ee5\u7531\u5ba2\u6237\u7aef\u81ea\u5df1\u6307\u5b9a\uff0c\u4f46\u662f\u5f62\u5f0f\u5fc5\u987b\u662f```\u6574\u6570-\u6574\u6570```\uff0c\u800c\u4e14\u5fc5\u987b\u662f\u540e\u9762\u52a0\u5165\u7684\u6d88\u606f\u7684 ID \u8981\u5927\u4e8e\u524d\u9762\u7684\u6d88\u606f ID\u3002\n\n**\u6d88\u606f\u5185\u5bb9**\n--\n\n\u6d88\u606f\u5185\u5bb9\u5c31\u662f\u952e\u503c\u5bf9\uff0c\u5f62\u5982 hash \u7ed3\u6784\u7684\u952e\u503c\u5bf9\uff0c\u8fd9\u6ca1\u4ec0\u4e48\u7279\u522b\u4e4b\u5904\u3002\n\n**\u589e\u5220\u6539\u67e5**\n--\n\n1. `xadd` \u8ffd\u52a0\u6d88\u606f\n2. `xdel` \u5220\u9664\u6d88\u606f\uff0c\u8fd9\u91cc\u7684\u5220\u9664\u4ec5\u4ec5\u662f\u8bbe\u7f6e\u4e86\u6807\u5fd7\u4f4d\uff0c\u4e0d\u5f71\u54cd\u6d88\u606f\u603b\u957f\u5ea6\n3. `xrange` \u83b7\u53d6\u6d88\u606f\u5217\u8868\uff0c\u4f1a\u81ea\u52a8\u8fc7\u6ee4\u5df2\u7ecf\u5220\u9664\u7684\u6d88\u606f\n4. `xlen` \u6d88\u606f\u957f\u5ea6\n5. `del` \u5220\u9664 Stream\n\n```\n# * \u53f7\u8868\u793a\u670d\u52a1\u5668\u81ea\u52a8\u751f\u6210 ID\uff0c\u540e\u9762\u987a\u5e8f\u8ddf\u7740\u4e00\u5806 key/value\n#  \u540d\u5b57\u53eb laoqian\uff0c\u5e74\u9f84 30 \u5c81\n127.0.0.1:6379> xadd codehole * name laoqian age 30  \n1527849609889-0  # \u751f\u6210\u7684\u6d88\u606f ID\n127.0.0.1:6379> xadd codehole * name xiaoyu age 29\n1527849629172-0\n127.0.0.1:6379> xadd codehole * name xiaoqian age 1\n1527849637634-0\n127.0.0.1:6379> xlen codehole\n(integer) 3\n# -\u8868\u793a\u6700\u5c0f\u503c , + \u8868\u793a\u6700\u5927\u503c\n127.0.0.1:6379> xrange codehole - +\n127.0.0.1:6379> xrange codehole - +\n1) 1) 1527849609889-0\n   2) 1) \"name\"\n      2) \"laoqian\"\n      3) \"age\"\n      4) \"30\"\n2) 1) 1527849629172-0\n   2) 1) \"name\"\n      2) \"xiaoyu\"\n      3) \"age\"\n      4) \"29\"\n3) 1) 1527849637634-0\n   2) 1) \"name\"\n      2) \"xiaoqian\"\n      3) \"age\"\n      4) \"1\"\n# \u6307\u5b9a\u6700\u5c0f\u6d88\u606f ID \u7684\u5217\u8868\n127.0.0.1:6379> xrange codehole 1527849629172-0 +  \n1) 1) 1527849629172-0\n   2) 1) \"name\"\n      2) \"xiaoyu\"\n      3) \"age\"\n      4) \"29\"\n2) 1) 1527849637634-0\n   2) 1) \"name\"\n      2) \"xiaoqian\"\n      3) \"age\"\n      4) \"1\"\n# \u6307\u5b9a\u6700\u5927\u6d88\u606f ID \u7684\u5217\u8868\n127.0.0.1:6379> xrange codehole - 1527849629172-0\n1) 1) 1527849609889-0\n   2) 1) \"name\"\n      2) \"laoqian\"\n      3) \"age\"\n      4) \"30\"\n2) 1) 1527849629172-0\n   2) 1) \"name\"\n      2) \"xiaoyu\"\n      3) \"age\"\n      4) \"29\"\n127.0.0.1:6379> xdel codehole 1527849609889-0\n(integer) 1\n# \u957f\u5ea6\u4e0d\u53d7\u5f71\u54cd\n127.0.0.1:6379> xlen codehole\n(integer) 3\n# \u88ab\u5220\u9664\u7684\u6d88\u606f\u6ca1\u4e86\n127.0.0.1:6379> xrange codehole - +\n1) 1) 1527849629172-0\n   2) 1) \"name\"\n      2) \"xiaoyu\"\n      3) \"age\"\n      4) \"29\"\n2) 1) 1527849637634-0\n   2) 1) \"name\"\n      2) \"xiaoqian\"\n      3) \"age\"\n      4) \"1\"\n# \u5220\u9664\u6574\u4e2a Stream\n127.0.0.1:6379> del codehole\n(integer) 1\n```\n\n**\u72ec\u7acb\u6d88\u8d39**\n--\n\n\u6211\u4eec\u53ef\u4ee5\u5728\u4e0d\u5b9a\u4e49\u6d88\u8d39\u7ec4\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c Stream \u6d88\u606f\u7684\u72ec\u7acb\u6d88\u8d39\uff0c\u5f53 Stream \u6ca1\u6709\u65b0\u6d88\u606f\u65f6\uff0c\u751a\u81f3\u53ef\u4ee5\u963b\u585e\u7b49\u5f85\u3002Redis \u8bbe\u8ba1\u4e86\u4e00\u4e2a\u5355\u72ec\u7684\u6d88\u8d39\u6307\u4ee4```xread```\uff0c\u53ef\u4ee5\u5c06 Stream \u5f53\u6210\u666e\u901a\u7684\u6d88\u606f\u961f\u5217 (list) \u6765\u4f7f\u7528\u3002\u4f7f\u7528 `xread` \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5b8c\u5168\u5ffd\u7565\u6d88\u8d39\u7ec4 (Consumer Group) \u7684\u5b58\u5728\uff0c\u5c31\u597d\u6bd4 Stream \u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u5217\u8868 (list)\u3002\n```\n# \u4ece Stream \u5934\u90e8\u8bfb\u53d6\u4e24\u6761\u6d88\u606f\n127.0.0.1:6379> xread count 2 streams codehole 0-0\n1) 1) \"codehole\"\n   2) 1) 1) 1527851486781-0\n         2) 1) \"name\"\n            2) \"laoqian\"\n            3) \"age\"\n            4) \"30\"\n      2) 1) 1527851493405-0\n         2) 1) \"name\"\n            2) \"yurui\"\n            3) \"age\"\n            4) \"29\"\n# \u4ece Stream \u5c3e\u90e8\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\uff0c\u6beb\u65e0\u7591\u95ee\uff0c\u8fd9\u91cc\u4e0d\u4f1a\u8fd4\u56de\u4efb\u4f55\u6d88\u606f\n127.0.0.1:6379> xread count 1 streams codehole $\n(nil)\n# \u4ece\u5c3e\u90e8\u963b\u585e\u7b49\u5f85\u65b0\u6d88\u606f\u5230\u6765\uff0c\u4e0b\u9762\u7684\u6307\u4ee4\u4f1a\u5835\u4f4f\uff0c\u76f4\u5230\u65b0\u6d88\u606f\u5230\u6765\n127.0.0.1:6379> xread block 0 count 1 streams codehole $\n# \u6211\u4eec\u4ece\u65b0\u6253\u5f00\u4e00\u4e2a\u7a97\u53e3\uff0c\u5728\u8fd9\u4e2a\u7a97\u53e3\u5f80 Stream \u91cc\u585e\u6d88\u606f\n127.0.0.1:6379> xadd codehole * name youming age 60\n1527852774092-0\n# \u518d\u5207\u6362\u5230\u524d\u9762\u7684\u7a97\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u963b\u585e\u89e3\u9664\u4e86\uff0c\u8fd4\u56de\u4e86\u65b0\u7684\u6d88\u606f\u5185\u5bb9\n# \u800c\u4e14\u8fd8\u663e\u793a\u4e86\u4e00\u4e2a\u7b49\u5f85\u65f6\u95f4\uff0c\u8fd9\u91cc\u6211\u4eec\u7b49\u5f85\u4e86 93s\n127.0.0.1:6379> xread block 0 count 1 streams codehole $\n1) 1) \"codehole\"\n   2) 1) 1) 1527852774092-0\n         2) 1) \"name\"\n            2) \"youming\"\n            3) \"age\"\n            4) \"60\"\n(93.11s)\n```\n\u5ba2\u6237\u7aef\u5982\u679c\u60f3\u8981\u4f7f\u7528 `xread` \u8fdb\u884c\u987a\u5e8f\u6d88\u8d39\uff0c\u4e00\u5b9a\u8981\u8bb0\u4f4f\u5f53\u524d\u6d88\u8d39\u5230\u54ea\u91cc\u4e86\uff0c\u4e5f\u5c31\u662f\u8fd4\u56de\u7684\u6d88\u606f ID\u3002\u4e0b\u6b21\u7ee7\u7eed\u8c03\u7528 `xread` \u65f6\uff0c\u5c06\u4e0a\u6b21\u8fd4\u56de\u7684\u6700\u540e\u4e00\u4e2a\u6d88\u606f ID \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6d88\u8d39\u540e\u7eed\u7684\u6d88\u606f\u3002\n\nblock 0 \u8868\u793a\u6c38\u8fdc\u963b\u585e\uff0c\u76f4\u5230\u6d88\u606f\u5230\u6765\uff0cblock 1000 \u8868\u793a\u963b\u585e 1s\uff0c\u5982\u679c 1s \u5185\u6ca1\u6709\u4efb\u4f55\u6d88\u606f\u5230\u6765\uff0c\u5c31\u8fd4\u56de `nil`\u3002\n\n```\n127.0.0.1:6379> xread block 1000 count 1 streams codehole $\n(nil)\n(1.07s)\n```\n\n**\u521b\u5efa\u6d88\u8d39\u7ec4**\n--\n![](https://user-gold-cdn.xitu.io/2018/6/1/163bbe4d6f601f8e?w=1594&h=710&f=png&s=146592)\nStream \u901a\u8fc7```xgroup create```\u6307\u4ee4\u521b\u5efa\u6d88\u8d39\u7ec4 (Consumer Group)\uff0c\u9700\u8981\u4f20\u9012\u8d77\u59cb\u6d88\u606f ID \u53c2\u6570\u7528\u6765\u521d\u59cb\u5316```last_delivered_id```\u53d8\u91cf\u3002\n```\n#  \u8868\u793a\u4ece\u5934\u5f00\u59cb\u6d88\u8d39\n127.0.0.1:6379> xgroup create codehole cg1 0-0\nOK\n# $ \u8868\u793a\u4ece\u5c3e\u90e8\u5f00\u59cb\u6d88\u8d39\uff0c\u53ea\u63a5\u53d7\u65b0\u6d88\u606f\uff0c\u5f53\u524d Stream \u6d88\u606f\u4f1a\u5168\u90e8\u5ffd\u7565\n127.0.0.1:6379> xgroup create codehole cg2 $\nOK\n# \u83b7\u53d6 Stream \u4fe1\u606f\n127.0.0.1:6379> xinfo stream codehole\n 1) length\n 2) (integer) 3  # \u5171 3 \u4e2a\u6d88\u606f\n 3) radix-tree-keys\n 4) (integer) 1\n 5) radix-tree-nodes\n 6) (integer) 2\n 7) groups\n 8) (integer) 2  # \u4e24\u4e2a\u6d88\u8d39\u7ec4\n 9) first-entry  # \u7b2c\u4e00\u4e2a\u6d88\u606f\n10) 1) 1527851486781-0\n    2) 1) \"name\"\n       2) \"laoqian\"\n       3) \"age\"\n       4) \"30\"\n11) last-entry  # \u6700\u540e\u4e00\u4e2a\u6d88\u606f\n12) 1) 1527851498956-0\n    2) 1) \"name\"\n       2) \"xiaoqian\"\n       3) \"age\"\n       4) \"1\"\n# \u83b7\u53d6 Stream \u7684\u6d88\u8d39\u7ec4\u4fe1\u606f\n127.0.0.1:6379> xinfo groups codehole\n1) 1) name\n   2) \"cg1\"\n   3) consumers\n   4) (integer) 0  # \u8be5\u6d88\u8d39\u7ec4\u8fd8\u6ca1\u6709\u6d88\u8d39\u8005\n   5) pending\n   6) (integer) 0  # \u8be5\u6d88\u8d39\u7ec4\u6ca1\u6709\u6b63\u5728\u5904\u7406\u7684\u6d88\u606f\n2) 1) name\n   2) \"cg2\"\n   3) consumers  # \u8be5\u6d88\u8d39\u7ec4\u8fd8\u6ca1\u6709\u6d88\u8d39\u8005\n   4) (integer) 0\n   5) pending\n   6) (integer) 0  # \u8be5\u6d88\u8d39\u7ec4\u6ca1\u6709\u6b63\u5728\u5904\u7406\u7684\u6d88\u606f\n```\n\n**\u6d88\u8d39**\n--\n\nStream \u63d0\u4f9b\u4e86 `xreadgroup` \u6307\u4ee4\u53ef\u4ee5\u8fdb\u884c\u6d88\u8d39\u7ec4\u7684\u7ec4\u5185\u6d88\u8d39\uff0c\u9700\u8981\u63d0\u4f9b\u6d88\u8d39\u7ec4\u540d\u79f0\u3001\u6d88\u8d39\u8005\u540d\u79f0\u548c\u8d77\u59cb\u6d88\u606f ID\u3002\u5b83\u540c `xread` \u4e00\u6837\uff0c\u4e5f\u53ef\u4ee5\u963b\u585e\u7b49\u5f85\u65b0\u6d88\u606f\u3002\u8bfb\u5230\u65b0\u6d88\u606f\u540e\uff0c\u5bf9\u5e94\u7684\u6d88\u606f ID \u5c31\u4f1a\u8fdb\u5165\u6d88\u8d39\u8005\u7684 PEL(\u6b63\u5728\u5904\u7406\u7684\u6d88\u606f) \u7ed3\u6784\u91cc\uff0c\u5ba2\u6237\u7aef\u5904\u7406\u5b8c\u6bd5\u540e\u4f7f\u7528 `xack` \u6307\u4ee4\u901a\u77e5\u670d\u52a1\u5668\uff0c\u672c\u6761\u6d88\u606f\u5df2\u7ecf\u5904\u7406\u5b8c\u6bd5\uff0c\u8be5\u6d88\u606f ID \u5c31\u4f1a\u4ece PEL \u4e2d\u79fb\u9664\u3002\n```\n# > \u53f7\u8868\u793a\u4ece\u5f53\u524d\u6d88\u8d39\u7ec4\u7684 last_delivered_id \u540e\u9762\u5f00\u59cb\u8bfb\n# \u6bcf\u5f53\u6d88\u8d39\u8005\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\uff0clast_delivered_id \u53d8\u91cf\u5c31\u4f1a\u524d\u8fdb\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 1 streams codehole >\n1) 1) \"codehole\"\n   2) 1) 1) 1527851486781-0\n         2) 1) \"name\"\n            2) \"laoqian\"\n            3) \"age\"\n            4) \"30\"\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 1 streams codehole >\n1) 1) \"codehole\"\n   2) 1) 1) 1527851493405-0\n         2) 1) \"name\"\n            2) \"yurui\"\n            3) \"age\"\n            4) \"29\"\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 2 streams codehole >\n1) 1) \"codehole\"\n   2) 1) 1) 1527851498956-0\n         2) 1) \"name\"\n            2) \"xiaoqian\"\n            3) \"age\"\n            4) \"1\"\n      2) 1) 1527852774092-0\n         2) 1) \"name\"\n            2) \"youming\"\n            3) \"age\"\n            4) \"60\"\n# \u518d\u7ee7\u7eed\u8bfb\u53d6\uff0c\u5c31\u6ca1\u6709\u65b0\u6d88\u606f\u4e86\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 count 1 streams codehole >\n(nil)\n# \u90a3\u5c31\u963b\u585e\u7b49\u5f85\u5427\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 block 0 count 1 streams codehole >\n# \u5f00\u542f\u53e6\u4e00\u4e2a\u7a97\u53e3\uff0c\u5f80\u91cc\u585e\u6d88\u606f\n127.0.0.1:6379> xadd codehole * name lanying age 61\n1527854062442-0\n# \u56de\u5230\u524d\u4e00\u4e2a\u7a97\u53e3\uff0c\u53d1\u73b0\u963b\u585e\u89e3\u9664\uff0c\u6536\u5230\u65b0\u6d88\u606f\u4e86\n127.0.0.1:6379> xreadgroup GROUP cg1 c1 block 0 count 1 streams codehole >\n1) 1) \"codehole\"\n   2) 1) 1) 1527854062442-0\n         2) 1) \"name\"\n            2) \"lanying\"\n            3) \"age\"\n            4) \"61\"\n(36.54s)\n# \u89c2\u5bdf\u6d88\u8d39\u7ec4\u4fe1\u606f\n127.0.0.1:6379> xinfo groups codehole\n1) 1) name\n   2) \"cg1\"\n   3) consumers\n   4) (integer) 1  # \u4e00\u4e2a\u6d88\u8d39\u8005\n   5) pending\n   6) (integer) 5  # \u5171 5 \u6761\u6b63\u5728\u5904\u7406\u7684\u4fe1\u606f\u8fd8\u6709\u6ca1\u6709 ack\n2) 1) name\n   2) \"cg2\"\n   3) consumers\n   4) (integer) 0  # \u6d88\u8d39\u7ec4 cg2 \u6ca1\u6709\u4efb\u4f55\u53d8\u5316\uff0c\u56e0\u4e3a\u524d\u9762\u6211\u4eec\u4e00\u76f4\u5728\u64cd\u7eb5 cg1\n   5) pending\n   6) (integer) 0\n# \u5982\u679c\u540c\u4e00\u4e2a\u6d88\u8d39\u7ec4\u6709\u591a\u4e2a\u6d88\u8d39\u8005\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 xinfo consumers \u6307\u4ee4\u89c2\u5bdf\u6bcf\u4e2a\u6d88\u8d39\u8005\u7684\u72b6\u6001\n127.0.0.1:6379> xinfo consumers codehole cg1  # \u76ee\u524d\u8fd8\u6709 1 \u4e2a\u6d88\u8d39\u8005\n1) 1) name\n   2) \"c1\"\n   3) pending\n   4) (integer) 5  # \u5171 5 \u6761\u5f85\u5904\u7406\u6d88\u606f\n   5) idle\n   6) (integer) 418715  # \u7a7a\u95f2\u4e86\u591a\u957f\u65f6\u95f4 ms \u6ca1\u6709\u8bfb\u53d6\u6d88\u606f\u4e86\n# \u63a5\u4e0b\u6765\u6211\u4eec ack \u4e00\u6761\u6d88\u606f\n127.0.0.1:6379> xack codehole cg1 1527851486781-0\n(integer) 1\n127.0.0.1:6379> xinfo consumers codehole cg1\n1) 1) name\n   2) \"c1\"\n   3) pending\n   4) (integer) 4  # \u53d8\u6210\u4e86 5 \u6761\n   5) idle\n   6) (integer) 668504\n# \u4e0b\u9762 ack \u6240\u6709\u6d88\u606f\n127.0.0.1:6379> xack codehole cg1 1527851493405-0 1527851498956-0 1527852774092-0 1527854062442-0\n(integer) 4\n127.0.0.1:6379> xinfo consumers codehole cg1\n1) 1) name\n   2) \"c1\"\n   3) pending\n   4) (integer) 0  # pel \u7a7a\u4e86\n   5) idle\n   6) (integer) 745505\n```\n\n**Stream \u6d88\u606f\u592a\u591a\u600e\u4e48\u529e?**\n--\n\n\u8bfb\u8005\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u8981\u662f\u6d88\u606f\u79ef\u7d2f\u592a\u591a\uff0cStream \u7684\u94fe\u8868\u5c82\u4e0d\u662f\u5f88\u957f\uff0c\u5185\u5bb9\u4f1a\u4e0d\u4f1a\u7206\u6389?`xdel` \u6307\u4ee4\u53c8\u4e0d\u4f1a\u5220\u9664\u6d88\u606f\uff0c\u5b83\u53ea\u662f\u7ed9\u6d88\u606f\u505a\u4e86\u4e2a\u6807\u5fd7\u4f4d\u3002\n\nRedis \u81ea\u7136\u8003\u8651\u5230\u4e86\u8fd9\u4e00\u70b9\uff0c\u6240\u4ee5\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9a\u957f Stream \u529f\u80fd\u3002\u5728 `xadd` \u7684\u6307\u4ee4\u63d0\u4f9b\u4e00\u4e2a\u5b9a\u957f\u957f\u5ea6 `maxlen`\uff0c\u5c31\u53ef\u4ee5\u5c06\u8001\u7684\u6d88\u606f\u5e72\u6389\uff0c\u786e\u4fdd\u6700\u591a\u4e0d\u8d85\u8fc7\u6307\u5b9a\u957f\u5ea6\u3002\n\n```\n127.0.0.1:6379> xlen codehole\n(integer) 5\n127.0.0.1:6379> xadd codehole maxlen 3 * name xiaorui age 1\n1527855160273-0\n127.0.0.1:6379> xlen codehole\n(integer) 3\n```\n\n\u6211\u4eec\u770b\u5230 Stream \u7684\u957f\u5ea6\u88ab\u780d\u6389\u4e86\u3002\u5982\u679c Stream \u5728\u672a\u6765\u53ef\u4ee5\u63d0\u4f9b\u6309\u65f6\u95f4\u6233\u6e05\u7406\u6d88\u606f\u7684\u89c4\u5219\u90a3\u5c31\u66f4\u52a0\u5b8c\u7f8e\u4e86\uff0c\u4f46\u662f\u76ee\u524d\u8fd8\u6ca1\u6709\u3002\n\n**\u6d88\u606f\u5982\u679c\u5fd8\u8bb0 ACK \u4f1a\u600e\u6837?**\n--\nStream \u5728\u6bcf\u4e2a\u6d88\u8d39\u8005\u7ed3\u6784\u4e2d\u4fdd\u5b58\u4e86\u6b63\u5728\u5904\u7406\u4e2d\u7684\u6d88\u606f ID \u5217\u8868 PEL\uff0c\u5982\u679c\u6d88\u8d39\u8005\u6536\u5230\u4e86\u6d88\u606f\u5904\u7406\u5b8c\u4e86\u4f46\u662f\u6ca1\u6709\u56de\u590d ack\uff0c\u5c31\u4f1a\u5bfc\u81f4 PEL \u5217\u8868\u4e0d\u65ad\u589e\u957f\uff0c\u5982\u679c\u6709\u5f88\u591a\u6d88\u8d39\u7ec4\u7684\u8bdd\uff0c\u90a3\u4e48\u8fd9\u4e2a PEL \u5360\u7528\u7684\u5185\u5b58\u5c31\u4f1a\u653e\u5927\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/16/164a2a4cd39eb25e?w=498&h=403&f=png&s=31017)\n\n**PEL \u5982\u4f55\u907f\u514d\u6d88\u606f\u4e22\u5931?**\n--\n\u5728\u5ba2\u6237\u7aef\u6d88\u8d39\u8005\u8bfb\u53d6 Stream \u6d88\u606f\u65f6\uff0cRedis \u670d\u52a1\u5668\u5c06\u6d88\u606f\u56de\u590d\u7ed9\u5ba2\u6237\u7aef\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u7a81\u7136\u65ad\u5f00\u4e86\u8fde\u63a5\uff0c\u6d88\u606f\u5c31\u4e22\u5931\u4e86\u3002\u4f46\u662f PEL \u91cc\u5df2\u7ecf\u4fdd\u5b58\u4e86\u53d1\u51fa\u53bb\u7684\u6d88\u606f ID\u3002\u5f85\u5ba2\u6237\u7aef\u91cd\u65b0\u8fde\u4e0a\u4e4b\u540e\uff0c\u53ef\u4ee5\u518d\u6b21\u6536\u5230 PEL \u4e2d\u7684\u6d88\u606f ID \u5217\u8868\u3002\u4e0d\u8fc7\u6b64\u65f6 `xreadgroup` \u7684\u8d77\u59cb\u6d88\u606f ID \u4e0d\u80fd\u4e3a\u53c2\u6570>\uff0c\u800c\u5fc5\u987b\u662f\u4efb\u610f\u6709\u6548\u7684\u6d88\u606f ID\uff0c\u4e00\u822c\u5c06\u53c2\u6570\u8bbe\u4e3a 0-0\uff0c\u8868\u793a\u8bfb\u53d6\u6240\u6709\u7684 PEL \u6d88\u606f\u4ee5\u53ca\u81ea```last_delivered_id```\u4e4b\u540e\u7684\u65b0\u6d88\u606f\u3002\n\n**Stream \u7684\u9ad8\u53ef\u7528**\n--\nStream \u7684\u9ad8\u53ef\u7528\u662f\u5efa\u7acb\u4e3b\u4ece\u590d\u5236\u57fa\u7840\u4e0a\u7684\uff0c\u5b83\u548c\u5176\u5b83\u6570\u636e\u7ed3\u6784\u7684\u590d\u5236\u673a\u5236\u6ca1\u6709\u533a\u522b\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728 Sentinel \u548c Cluster \u96c6\u7fa4\u73af\u5883\u4e0b Stream \u662f\u53ef\u4ee5\u652f\u6301\u9ad8\u53ef\u7528\u7684\u3002\u4e0d\u8fc7\u9274\u4e8e Redis \u7684\u6307\u4ee4\u590d\u5236\u662f\u5f02\u6b65\u7684\uff0c\u5728 `failover` \u53d1\u751f\u65f6\uff0cRedis \u53ef\u80fd\u4f1a\u4e22\u5931\u6781\u5c0f\u90e8\u5206\u6570\u636e\uff0c\u8fd9\u70b9 Redis \u7684\u5176\u5b83\u6570\u636e\u7ed3\u6784\u4e5f\u662f\u4e00\u6837\u7684\u3002\n\n**\u5206\u533a Partition**\n--\nRedis \u7684\u670d\u52a1\u5668\u6ca1\u6709\u539f\u751f\u652f\u6301\u5206\u533a\u80fd\u529b\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u5206\u533a\uff0c\u90a3\u5c31\u9700\u8981\u5206\u914d\u591a\u4e2a Stream\uff0c\u7136\u540e\u5728\u5ba2\u6237\u7aef\u4f7f\u7528\u4e00\u5b9a\u7684\u7b56\u7565\u6765\u751f\u4ea7\u6d88\u606f\u5230\u4e0d\u540c\u7684 Stream\u3002\u4f60\u4e5f\u8bb8\u4f1a\u8ba4\u4e3a Kafka \u8981\u5148\u8fdb\u5f88\u591a\uff0c\u5b83\u662f\u539f\u751f\u652f\u6301 Partition \u7684\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u6211\u5e76\u4e0d\u8ba4\u540c\u3002\u8bb0\u5f97 Kafka \u7684\u5ba2\u6237\u7aef\u4e5f\u5b58\u5728 HashStrategy \u4e48\uff0c\u56e0\u4e3a\u5b83\u4e5f\u662f\u901a\u8fc7\u5ba2\u6237\u7aef\u7684 hash \u7b97\u6cd5\u6765\u5c06\u4e0d\u540c\u7684\u6d88\u606f\u585e\u5165\u4e0d\u540c\u5206\u533a\u7684\u3002\n\n\u53e6\u5916,Kafka \u8fd8\u652f\u6301\u52a8\u6001\u589e\u52a0\u5206\u533a\u6570\u91cf\u7684\u80fd\u529b\uff0c\u4f46\u662f\u8fd9\u79cd\u8c03\u6574\u80fd\u529b\u4e5f\u662f\u5f88\u8e69\u811a\u7684\uff0c\u5b83\u4e0d\u4f1a\u628a\u4e4b\u524d\u5df2\u7ecf\u5b58\u5728\u7684\u5185\u5bb9\u8fdb\u884c rehash\uff0c\u4e0d\u4f1a\u91cd\u65b0\u5206\u533a\u5386\u53f2\u6570\u636e\u3002\u8fd9\u79cd\u7b80\u5355\u7684\u52a8\u6001\u8c03\u6574\u7684\u80fd\u529b Redis Stream \u901a\u8fc7\u589e\u52a0\u65b0\u7684 Stream \u5c31\u53ef\u4ee5\u505a\u5230\u3002\n\n\u5c0f\u7ed3\n--\nStream \u7684\u6d88\u8d39\u6a21\u578b\u501f\u9274\u4e86 Kafka \u7684\u6d88\u8d39\u5206\u7ec4\u7684\u6982\u5ff5\uff0c\u5b83\u5f25\u8865\u4e86 Redis Pub/Sub \u4e0d\u80fd\u6301\u4e45\u5316\u6d88\u606f\u7684\u7f3a\u9677\u3002\u4f46\u662f\u5b83\u53c8\u4e0d\u540c\u4e8e kafka\uff0cKafka \u7684\u6d88\u606f\u53ef\u4ee5\u5206 partition\uff0c\u800c Stream \u4e0d\u884c\u3002\u5982\u679c\u975e\u8981\u5206 parition \u7684\u8bdd\uff0c\u5f97\u5728\u5ba2\u6237\u7aef\u505a\uff0c\u63d0\u4f9b\u4e0d\u540c\u7684 Stream \u540d\u79f0\uff0c\u5bf9\u6d88\u606f\u8fdb\u884c hash \u53d6\u6a21\u6765\u9009\u62e9\u5f80\u54ea\u4e2a Stream \u91cc\u585e\u3002\n\n\u5982\u679c\u8bfb\u8005\u7a0d\u5fae\u7814\u7a76\u8fc7 Redis \u4f5c\u8005\u7684\u53e6\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee Disque \u7684\u8bdd\uff0c\u8fd9\u6781\u53ef\u80fd\u662f\u4f5c\u8005\u610f\u8bc6\u5230 Disque \u9879\u76ee\u7684\u6d3b\u8dc3\u7a0b\u5ea6\u4e0d\u591f\uff0c\u6240\u4ee5\u5c06 Disque \u7684\u5185\u5bb9\u79fb\u690d\u5230\u4e86 Redis \u91cc\u9762\u3002\u8fd9\u53ea\u662f\u672c\u4eba\u7684\u731c\u6d4b\uff0c\u672a\u5fc5\u662f\u4f5c\u8005\u7684\u521d\u8877\u3002\u5982\u679c\u8bfb\u8005\u6709\u4ec0\u4e48\u4e0d\u540c\u7684\u60f3\u6cd5\uff0c\u53ef\u4ee5\u5728\u8bc4\u8bba\u533a\u4e00\u8d77\u53c2\u4e0e\u8ba8\u8bba\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/22\u62d3\u5c55_1\u8033\u542c\u516b\u65b9__Stream.md", "create_date": "2020-02-18T03:01:05.924", "order": 23}}, {"model": "subject.chapter", "pk": 34, "fields": {"title": "27\u62d3\u5c55 6\uff1a\u5e73\u6ce2\u7f13\u8fdb \u2014\u2014 \u61d2\u60f0\u5220\u9664", "topic": 2, "md5": "37b02619fce0ca4437ad581372c59e08", "md_body": "# \u62d3\u5c55 6\uff1a\u5e73\u6ce2\u7f13\u8fdb \u2014\u2014 \u61d2\u60f0\u5220\u9664\n\n\u4e00\u76f4\u4ee5\u6765\u6211\u4eec\u8ba4\u4e3a Redis \u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u5355\u7ebf\u7a0b\u4e3a Redis \u5e26\u6765\u4e86\u4ee3\u7801\u7684\u7b80\u6d01\u6027\u548c\u4e30\u5bcc\u591a\u6837\u7684\u6570\u636e\u7ed3\u6784\u3002\u4e0d\u8fc7Redis\u5185\u90e8\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u53ea\u6709\u4e00\u4e2a\u4e3b\u7ebf\u7a0b\uff0c\u5b83\u8fd8\u6709\u51e0\u4e2a\u5f02\u6b65\u7ebf\u7a0b\u4e13\u95e8\u7528\u6765\u5904\u7406\u4e00\u4e9b\u8017\u65f6\u7684\u64cd\u4f5c\u3002\n\n## Redis \u4e3a\u4ec0\u4e48\u8981\u61d2\u60f0\u5220\u9664(lazy free)\uff1f\n\n\u5220\u9664\u6307\u4ee4 `del` \u4f1a\u76f4\u63a5\u91ca\u653e\u5bf9\u8c61\u7684\u5185\u5b58\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u6307\u4ee4\u975e\u5e38\u5feb\uff0c\u6ca1\u6709\u660e\u663e\u5ef6\u8fdf\u3002\u4e0d\u8fc7\u5982\u679c\u5220\u9664\u7684 key \u662f\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982\u4e00\u4e2a\u5305\u542b\u4e86\u5343\u4e07\u5143\u7d20\u7684 hash\uff0c\u90a3\u4e48\u5220\u9664\u64cd\u4f5c\u5c31\u4f1a\u5bfc\u81f4\u5355\u7ebf\u7a0b\u5361\u987f\u3002\n\nRedis \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u5361\u987f\u95ee\u9898\uff0c\u5728 4.0 \u7248\u672c\u5f15\u5165\u4e86 `unlink` \u6307\u4ee4\uff0c\u5b83\u80fd\u5bf9\u5220\u9664\u64cd\u4f5c\u8fdb\u884c\u61d2\u5904\u7406\uff0c\u4e22\u7ed9\u540e\u53f0\u7ebf\u7a0b\u6765\u5f02\u6b65\u56de\u6536\u5185\u5b58\u3002\n```\n> unlink key\nOK\n```\n\u5982\u679c\u6709\u591a\u7ebf\u7a0b\u7684\u5f00\u53d1\u7ecf\u9a8c\uff0c\u4f60\u80af\u5b9a\u4f1a\u62c5\u5fc3\u8fd9\u91cc\u7684\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5e76\u53d1\u4fee\u6539\u6570\u636e\u7ed3\u6784\u7684\u60c5\u51b5\u5b58\u5728\u3002\n\n\u5173\u4e8e\u8fd9\u70b9\uff0c\u6211\u6253\u4e2a\u6bd4\u65b9\u3002\u53ef\u4ee5\u5c06\u6574\u4e2a Redis \u5185\u5b58\u91cc\u9762\u6240\u6709\u6709\u6548\u7684\u6570\u636e\u60f3\u8c61\u6210\u4e00\u68f5\u5927\u6811\u3002\u5f53 `unlink` \u6307\u4ee4\u53d1\u51fa\u65f6\uff0c\u5b83\u53ea\u662f\u628a\u5927\u6811\u4e2d\u7684\u4e00\u4e2a\u6811\u679d\u522b\u65ad\u4e86\uff0c\u7136\u540e\u6254\u5230\u65c1\u8fb9\u7684\u706b\u5806\u91cc\u711a\u70e7 (\u5f02\u6b65\u7ebf\u7a0b\u6c60)\u3002\u6811\u679d\u79bb\u5f00\u5927\u6811\u7684\u4e00\u77ac\u95f4\uff0c\u5b83\u5c31\u518d\u4e5f\u65e0\u6cd5\u88ab\u4e3b\u7ebf\u7a0b\u4e2d\u7684\u5176\u5b83\u6307\u4ee4\u8bbf\u95ee\u5230\u4e86\uff0c\u56e0\u4e3a\u4e3b\u7ebf\u7a0b\u53ea\u4f1a\u6cbf\u7740\u8fd9\u9897\u5927\u6811\u6765\u8bbf\u95ee\u3002\n\n## flush\nRedis \u63d0\u4f9b\u4e86 `flushdb` \u548c `flushall` \u6307\u4ee4\uff0c\u7528\u6765\u6e05\u7a7a\u6570\u636e\u5e93\uff0c\u8fd9\u4e5f\u662f\u6781\u5176\u7f13\u6162\u7684\u64cd\u4f5c\u3002Redis 4.0 \u540c\u6837\u7ed9\u8fd9\u4e24\u4e2a\u6307\u4ee4\u4e5f\u5e26\u6765\u4e86\u5f02\u6b65\u5316\uff0c\u5728\u6307\u4ee4\u540e\u9762\u589e\u52a0 `async` \u53c2\u6570\u5c31\u53ef\u4ee5\u5c06\u6574\u68f5\u5927\u6811\u8fde\u6839\u62d4\u8d77\uff0c\u6254\u7ed9\u540e\u53f0\u7ebf\u7a0b\u6162\u6162\u711a\u70e7\u3002\n\n```\n> flushall async\nOK\n```\n\n## \u5f02\u6b65\u961f\u5217\n\u4e3b\u7ebf\u7a0b\u5c06\u5bf9\u8c61\u7684\u5f15\u7528\u4ece\u300c\u5927\u6811\u300d\u4e2d\u6458\u9664\u540e\uff0c\u4f1a\u5c06\u8fd9\u4e2a key \u7684\u5185\u5b58\u56de\u6536\u64cd\u4f5c\u5305\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u585e\u8fdb\u5f02\u6b65\u4efb\u52a1\u961f\u5217\uff0c\u540e\u53f0\u7ebf\u7a0b\u4f1a\u4ece\u8fd9\u4e2a\u5f02\u6b65\u961f\u5217\u4e2d\u53d6\u4efb\u52a1\u3002\u4efb\u52a1\u961f\u5217\u88ab\u4e3b\u7ebf\u7a0b\u548c\u5f02\u6b65\u7ebf\u7a0b\u540c\u65f6\u64cd\u4f5c\uff0c\u6240\u4ee5\u5fc5\u987b\u662f\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684\u961f\u5217\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/2/164fa17ba5f2d88e?w=771&h=138&f=png&s=18045)\n\n\u4e0d\u662f\u6240\u6709\u7684 `unlink` \u64cd\u4f5c\u90fd\u4f1a\u5ef6\u540e\u5904\u7406\uff0c\u5982\u679c\u5bf9\u5e94 key \u6240\u5360\u7528\u7684\u5185\u5b58\u5f88\u5c0f\uff0c\u5ef6\u540e\u5904\u7406\u5c31\u6ca1\u6709\u5fc5\u8981\u4e86\uff0c\u8fd9\u65f6\u5019 Redis \u4f1a\u5c06\u5bf9\u5e94\u7684 key \u5185\u5b58\u7acb\u5373\u56de\u6536\uff0c\u8ddf `del` \u6307\u4ee4\u4e00\u6837\u3002\n\n## AOF Sync\u4e5f\u5f88\u6162\nRedis\u9700\u8981\u6bcf\u79d2\u4e00\u6b21(\u53ef\u914d\u7f6e)\u540c\u6b65AOF\u65e5\u5fd7\u5230\u78c1\u76d8\uff0c\u786e\u4fdd\u6d88\u606f\u5c3d\u91cf\u4e0d\u4e22\u5931\uff0c\u9700\u8981\u8c03\u7528sync\u51fd\u6570\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u6bd4\u8f83\u8017\u65f6\uff0c\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u7684\u6548\u7387\u4e0b\u964d\uff0c\u6240\u4ee5Redis\u4e5f\u5c06\u8fd9\u4e2a\u64cd\u4f5c\u79fb\u5230\u5f02\u6b65\u7ebf\u7a0b\u6765\u5b8c\u6210\u3002\u6267\u884cAOF Sync\u64cd\u4f5c\u7684\u7ebf\u7a0b\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5f02\u6b65\u7ebf\u7a0b\uff0c\u548c\u524d\u9762\u7684\u61d2\u60f0\u5220\u9664\u7ebf\u7a0b\u4e0d\u662f\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u540c\u6837\u5b83\u4e5f\u6709\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u7684\u4efb\u52a1\u961f\u5217\uff0c\u961f\u5217\u91cc\u53ea\u7528\u6765\u5b58\u653eAOF Sync\u4efb\u52a1\u3002\n\n## \u66f4\u591a\u5f02\u6b65\u5220\u9664\u70b9\nRedis \u56de\u6536\u5185\u5b58\u9664\u4e86 `del` \u6307\u4ee4\u548c `flush` \u4e4b\u5916\uff0c\u8fd8\u4f1a\u5b58\u5728\u4e8e\u5728 key \u7684\u8fc7\u671f\u3001LRU \u6dd8\u6c70\u3001rename \u6307\u4ee4\u4ee5\u53ca\u4ece\u5e93\u5168\u91cf\u540c\u6b65\u65f6\u63a5\u53d7\u5b8c rdb \u6587\u4ef6\u540e\u4f1a\u7acb\u5373\u8fdb\u884c\u7684 flush \u64cd\u4f5c\u3002\n\nRedis4.0 \u4e3a\u8fd9\u4e9b\u5220\u9664\u70b9\u4e5f\u5e26\u6765\u4e86\u5f02\u6b65\u5220\u9664\u673a\u5236\uff0c\u6253\u5f00\u8fd9\u4e9b\u70b9\u9700\u8981\u989d\u5916\u7684\u914d\u7f6e\u9009\u9879\u3002\n1. `slave-lazy-flush`  \u4ece\u5e93\u63a5\u53d7\u5b8c rdb \u6587\u4ef6\u540e\u7684 flush \u64cd\u4f5c\n2. `lazyfree-lazy-eviction` \u5185\u5b58\u8fbe\u5230 maxmemory \u65f6\u8fdb\u884c\u6dd8\u6c70\n3. `lazyfree-lazy-expire key` \u8fc7\u671f\u5220\u9664\n4. `lazyfree-lazy-server-del` rename \u6307\u4ee4\u5220\u9664 destKey\n\n## \u6269\u5c55\u9605\u8bfb\n - [Redis \u61d2\u60f0\u5904\u7406\u7684\u7ec6\u8282](https://yq.aliyun.com/articles/205504)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/27\u62d3\u5c55_6\u5e73\u6ce2\u7f13\u8fdb__\u61d2\u60f0\u5220\u9664.md", "create_date": "2020-02-18T03:01:05.945", "order": 28}}, {"model": "subject.chapter", "pk": 35, "fields": {"title": "28\u62d3\u5c55 7\uff1a\u5999\u624b\u4ec1\u5fc3 \u2014\u2014 \u4f18\u96c5\u5730\u4f7f\u7528 Jedis", "topic": 2, "md5": "76a6399eca3a3009ce25a7af60e3075d", "md_body": "# \u62d3\u5c55 7\uff1a\u5999\u624b\u4ec1\u5fc3 \u2014\u2014 \u4f18\u96c5\u5730\u4f7f\u7528 Jedis\n\n\u672c\u8282\u9762\u5411 Java \u7528\u6237\uff0c\u4e3b\u9898\u662f\u5982\u4f55\u4f18\u96c5\u5730\u4f7f\u7528 Jedis \u7f16\u5199\u5e94\u7528\u7a0b\u5e8f\uff0c\u65e2\u53ef\u4ee5\u8ba9\u4ee3\u7801\u770b\u8d77\u6765\u8d4f\u5fc3\u60a6\u76ee\uff0c\u53c8\u53ef\u4ee5\u907f\u514d\u4f7f\u7528\u8005\u72af\u9519\u3002\n\nJedis \u662f Java \u7528\u6237\u6700\u5e38\u7528\u7684 Redis \u5f00\u6e90\u5ba2\u6237\u7aef\u3002\u5b83\u975e\u5e38\u5c0f\u5de7\uff0c\u5b9e\u73b0\u539f\u7406\u4e5f\u5f88\u7b80\u5355\uff0c\u6700\u91cd\u8981\u7684\u662f\u5f88\u7a33\u5b9a\uff0c\u800c\u4e14\u4f7f\u7528\u7684\u65b9\u6cd5\u53c2\u6570\u540d\u79f0\u548c\u5b98\u65b9\u7684\u6587\u6863\u975e\u5e38 match\uff0c\u5982\u679c\u6709\u4ec0\u4e48\u65b9\u6cd5\u4e0d\u4f1a\u7528\uff0c\u76f4\u63a5\u53c2\u8003\u5b98\u65b9\u7684\u6307\u4ee4\u6587\u6863\u9605\u8bfb\u4e00\u4e0b\u5c31\u4f1a\u4e86\uff0c\u7701\u53bb\u4e86\u975e\u5fc5\u8981\u7684\u91cd\u590d\u5b66\u4e60\u6210\u672c\u3002\u4e0d\u50cf\u6709\u4e9b\u5ba2\u6237\u7aef\u628a\u65b9\u6cd5\u540d\u79f0\u90fd\u6362\u4e86\uff0c\u867d\u7136\u8868\u9762\u4e0a\u7ed9\u8bfb\u8005\u5e26\u6765\u4e86\u4fbf\u6377\uff0c\u4f46\u662f\u9700\u8981\u6328\u4e2a\u91cd\u65b0\u5b66\u4e60\u8fd9\u4e9b API\uff0c\u63d0\u9ad8\u4e86\u5b66\u4e60\u6210\u672c\u3002\n\nJava \u7a0b\u5e8f\u4e00\u822c\u90fd\u662f\u591a\u7ebf\u7a0b\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u610f\u5473\u7740\u6211\u4eec\u5f88\u5c11\u76f4\u63a5\u4f7f\u7528 Jedis\uff0c\u800c\u662f\u8981\u7528\u5230 Jedis \u7684\u8fde\u63a5\u6c60 \u2014\u2014 JedisPool\u3002\u540c\u65f6\u56e0\u4e3a Jedis \u5bf9\u8c61\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5f53\u6211\u4eec\u8981\u4f7f\u7528 Jedis \u5bf9\u8c61\u65f6\uff0c\u9700\u8981\u4ece\u8fde\u63a5\u6c60\u4e2d\u62ff\u51fa\u4e00\u4e2a Jedis \u5bf9\u8c61\u72ec\u5360\uff0c\u4f7f\u7528\u5b8c\u6bd5\u540e\u518d\u5c06\u8fd9\u4e2a\u5bf9\u8c61\u8fd8\u7ed9\u8fde\u63a5\u6c60\u3002\n\n\u7528\u4ee3\u7801\u8868\u793a\u5982\u4e0b\uff1a\n```java\nimport redis.clients.jedis.Jedis;\nimport redis.clients.jedis.JedisPool;\n\npublic class JedisTest {\n\n  public static void main(String[] args) {\n    JedisPool pool = new JedisPool();\n    Jedis jedis = pool.getResource(); // \u62ff\u51fa Jedis \u94fe\u63a5\u5bf9\u8c61\n    doSomething(jedis);\n    jedis.close(); // \u5f52\u8fd8\u94fe\u63a5\n  }\n\n  private static void doSomething(Jedis jedis) {\n    // code it here\n  }\n\n}\n```\n\n\u4e0a\u9762\u7684\u4ee3\u7801\u6709\u4e2a\u95ee\u9898\uff0c\u5982\u679c `doSomething` \u65b9\u6cd5\u629b\u51fa\u4e86\u5f02\u5e38\u7684\u8bdd\uff0c\u4ece\u8fde\u63a5\u6c60\u4e2d\u62ff\u51fa\u6765\u7684 Jedis \u5bf9\u8c61\u5c06\u65e0\u6cd5\u5f52\u8fd8\u7ed9\u8fde\u63a5\u6c60\u3002\u5982\u679c\u8fd9\u6837\u7684\u5f02\u5e38\u53d1\u751f\u4e86\u597d\u51e0\u6b21\uff0c\u8fde\u63a5\u6c60\u4e2d\u7684\u6240\u6709\u94fe\u63a5\u90fd\u88ab\u6301\u4e45\u5360\u7528\u4e86\uff0c\u65b0\u7684\u8bf7\u6c42\u8fc7\u6765\u65f6\u5c31\u4f1a\u963b\u585e\u7b49\u5f85\u7a7a\u95f2\u7684\u94fe\u63a5\uff0c\u8fd9\u6837\u7684\u963b\u585e\u4e00\u822c\u4f1a\u76f4\u63a5\u5bfc\u81f4\u5e94\u7528\u7a0b\u5e8f\u5361\u6b7b\u3002\n\n\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u7a0b\u5e8f\u5458\u9700\u8981\u5728\u4f7f\u7528 JedisPool \u91cc\u9762\u7684 Jedis \u94fe\u63a5\u65f6\uff0c\u5e94\u8be5\u4f7f\u7528 `try-with-resource` \u8bed\u53e5\u6765\u4fdd\u62a4 Jedis \u5bf9\u8c61\u3002\n\n```java\nimport redis.clients.jedis.Jedis;\nimport redis.clients.jedis.JedisPool;\n\npublic class JedisTest {\n\n  public static void main(String[] args) {\n    JedisPool pool = new JedisPool();\n    try (Jedis jedis = pool.getResource()) { // \u7528\u5b8c\u81ea\u52a8 close\n      doSomething(jedis);\n    }\n  }\n\n  private static void doSomething(Jedis jedis) {\n    // code it here\n  }\n\n}\n```\n\u8fd9\u6837 Jedis \u5bf9\u8c61\u80af\u5b9a\u4f1a\u5f52\u8fd8\u7ed9\u8fde\u63a5\u6c60 (\u6b7b\u5faa\u73af\u9664\u5916)\uff0c\u907f\u514d\u5e94\u7528\u7a0b\u5e8f\u5361\u6b7b\u7684\u60e8\u5267\u53d1\u751f\u3002\n\n\u4f46\u662f\u5f53\u4e00\u4e2a\u56e2\u961f\u591f\u5927\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684\u7a0b\u5e8f\u5458\u90fd\u4f1a\u975e\u5e38\u6709\u7ecf\u9a8c\uff0c\u4ed6\u4eec\u53ef\u80fd\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\u5fd8\u8bb0\u4e86\u4f7f\u7528 `try-with-resource` \u8bed\u53e5\uff0c\u60e8\u5267\u5c31\u4f1a\u7a81\u7136\u5192\u51fa\u6765\u8ba9\u8fd0\u7ef4\u4eba\u5458\u63aa\u624b\u4e0d\u53ca\u3002\u6211\u4eec\u9700\u8981\u5728\u4ee3\u7801\u4e0a\u52a0\u4e0a\u4e00\u5c42\u786c\u7ea6\u675f\uff0c\u901a\u8fc7\u8fd9\u5c42\u7ea6\u675f\uff0c\u5f53\u7a0b\u5e8f\u5458\u60f3\u8981\u8bbf\u95ee Jedis \u5bf9\u8c61\u65f6\uff0c\u4e0d\u4f1a\u518d\u51fa\u73b0\u4f7f\u7528\u4e86 Jedis \u5bf9\u8c61\u800c\u4e0d\u5f52\u8fd8\u3002\n```java\nimport redis.clients.jedis.Jedis;\nimport redis.clients.jedis.JedisPool;\n\ninterface CallWithJedis {\n  public void call(Jedis jedis);\n}\n\nclass RedisPool {\n\n  private JedisPool pool;\n\n  public RedisPool() {\n    this.pool = new JedisPool();\n  }\n\n  public void execute(CallWithJedis caller) {\n    try (Jedis jedis = pool.getResource()) {\n      caller.call(jedis);\n    }\n  }\n\n}\n\npublic class JedisTest {\n\n  public static void main(String[] args) {\n    RedisPool redis = new RedisPool();\n    redis.execute(new CallWithJedis() {\n\n      @Override\n      public void call(Jedis jedis) {\n        // do something with jedis\n      }\n\n    });\n  }\n\n}\n```\n\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u7279\u6b8a\u7684\u81ea\u5b9a\u4e49\u7684 RedisPool \u5bf9\u8c61\u5c06 JedisPool \u5bf9\u8c61\u9690\u85cf\u8d77\u6765\uff0c\u907f\u514d\u7a0b\u5e8f\u5458\u76f4\u63a5\u4f7f\u7528\u5b83\u7684 `getResource` \u65b9\u6cd5\u800c\u5fd8\u8bb0\u4e86\u5f52\u8fd8\u3002\u7a0b\u5e8f\u5458\u4f7f\u7528 RedisPool \u5bf9\u8c61\u65f6\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u56de\u8c03\u7c7b\u6765\u624d\u80fd\u4f7f\u7528 Jedis \u5bf9\u8c61\u3002\n\n\u4f46\u662f\u6bcf\u6b21\u8bbf\u95ee Redis \u90fd\u9700\u8981\u5199\u4e00\u4e2a\u56de\u8c03\u7c7b\uff0c\u771f\u662f\u7279\u522b\u7e41\u7410\uff0c\u4ee3\u7801\u4e5f\u663e\u5f97\u975e\u5e38\u81c3\u80bf\u3002\u5e78\u597d Java8 \u5e26\u6765\u4e86 Lambda \u8868\u8fbe\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Lambda \u8868\u8fbe\u5f0f\u7b80\u5316\u4e0a\u9762\u7684\u4ee3\u7801\u3002\n\n```java\npublic class JedisTest {\n\n  public static void main(String[] args) {\n    Redis redis = new Redis();\n    redis.execute(jedis -> {\n      // do something with jedis\n    });\n  }\n\n}\n```\n\u8fd9\u6837\u770b\u8d77\u6765\u5c31\u7b80\u6d01\u4f18\u96c5\u591a\u4e86\u3002\u4f46\u662f\u8fd8\u6709\u4e2a\u95ee\u9898\uff0cJava \u4e0d\u5141\u8bb8\u5728\u95ed\u5305\u91cc\u4fee\u6539\u95ed\u5305\u5916\u9762\u7684\u53d8\u91cf\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u60f3\u4ece Redis \u91cc\u9762\u62ff\u5230\u67d0\u4e2a zset \u5bf9\u8c61\u7684\u957f\u5ea6\uff0c\u7f16\u8bd1\u5668\u4f1a\u76f4\u63a5\u62a5\u9519\u3002\n\n```java\npublic class JedisTest {\n\n  public static void main(String[] args) {\n    Redis redis = new Redis();\n    long count = 0;\n    redis.execute(jedis -> {\n      count = jedis.zcard(\"codehole\");  // \u6b64\u5904\u5e94\u8be5\u62a5\u9519\n    });\n    System.out.println(count);\n  }\n\n}\n```\n\u7f16\u8bd1\u5668\u66b4\u9732\u51fa\u6765\u7684\u9519\u8bef\u65f6\uff1a`Local variable count defined in an enclosing scope must be final or effectively final`\uff0c\u544a\u8bc9\u6211\u4eec count \u53d8\u91cf\u5fc5\u987b\u8bbe\u7f6e\u6210 final \u7c7b\u578b\u624d\u53ef\u4ee5\u8ba9\u95ed\u5305\u6765\u8bbf\u95ee\u3002\n\n\u5982\u679c\u8fd9\u65f6\u6211\u4eec\u5c06 count \u8bbe\u7f6e\u6210 final \u7c7b\u578b\uff0c\u7ed3\u679c\u7f16\u8f91\u5668\u53c8\u62a5\u9519\u4e86\uff1a`The final local variable count cannot be assigned. It must be blank and not using a compound assignment`\uff0c\u544a\u8bc9\u6211\u4eec final \u7c7b\u578b\u7684\u53d8\u91cf\u5728\u95ed\u5305\u91cc\u9762\u4e0d\u80fd\u88ab\u4fee\u6539\u3002\n\n\u90a3\u8be5\u600e\u4e48\u529e\u5462\uff1f\n\n\u8fd9\u91cc\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a Holder \u7c7b\u578b\uff0c\u5c06\u9700\u8981\u4fee\u6539\u7684\u53d8\u91cf\u5305\u88c5\u8d77\u6765\u3002\n```java\nclass Holder<T> {\n  private T value;\n\n  public Holder() {\n  }\n\n  public Holder(T value) {\n    this.value = value;\n  }\n\n  public void value(T value) {\n    this.value = value;\n  }\n\n  public T value() {\n    return value;\n  }\n}\n\npublic class JedisTest {\n\n  public static void main(String[] args) {\n    Redis redis = new Redis();\n    Holder<Long> countHolder = new Holder<>();\n    redis.execute(jedis -> {\n      long count = jedis.zcard(\"codehole\");\n      countHolder.value(count);\n    });\n    System.out.println(countHolder.value());\n  }\n\n}\n```\n\u6709\u4e86\u4e0a\u9762\u5b9a\u4e49\u7684 Holder \u5305\u88c5\u7c7b\uff0c\u5c31\u53ef\u4ee5\u7ed5\u8fc7\u95ed\u5305\u5bf9\u53d8\u91cf\u4fee\u6539\u7684\u9650\u5236\u3002\u53ea\u4e0d\u8fc7\u4ee3\u7801\u4e0a\u8981\u591a\u4e00\u5c42\u7565\u663e\u7e41\u7410\u7684\u53d8\u91cf\u5305\u88c5\u8fc7\u7a0b\u3002\u8fd9\u4e9b\u90fd\u662f\u5bf9\u7a0b\u5e8f\u5458\u7684\u786c\u7ea6\u675f\uff0c\u4ed6\u4eec\u5fc5\u987b\u8fd9\u4e48\u505a\u624d\u53ef\u4ee5\u5f97\u5230\u81ea\u5df1\u60f3\u8981\u7684\u6570\u636e\u3002\n\n## \u91cd\u8bd5\n\n\u6211\u4eec\u77e5\u9053 Jedis \u9ed8\u8ba4\u6ca1\u6709\u63d0\u4f9b\u91cd\u8bd5\u673a\u5236\uff0c\u610f\u5473\u7740\u5982\u679c\u7f51\u7edc\u51fa\u73b0\u4e86\u6296\u52a8\uff0c\u5c31\u4f1a\u5927\u8303\u56f4\u62a5\u9519\uff0c\u6216\u8005\u4e00\u4e2a\u540e\u53f0\u5e94\u7528\u56e0\u4e3a\u94fe\u63a5\u8fc7\u4e8e\u7a7a\u95f2\u88ab\u670d\u52a1\u7aef\u5f3a\u5236\u5173\u95ed\u4e86\u94fe\u63a5\uff0c\u5f53\u91cd\u65b0\u53d1\u8d77\u65b0\u8bf7\u6c42\u65f6\u5c31\u7b2c\u4e00\u4e2a\u6307\u4ee4\u4f1a\u51fa\u9519\u3002\u800c Redis \u7684 Python \u5ba2\u6237\u7aef redis-py \u63d0\u4f9b\u4e86\u8fd9\u79cd\u91cd\u8bd5\u673a\u5236\uff0credis-py \u5728\u9047\u5230\u94fe\u63a5\u9519\u8bef\u65f6\u4f1a\u5c1d\u8bd5\u8fdb\u884c\u91cd\u8fde\uff0c\u7136\u540e\u518d\u91cd\u53d1\u6307\u4ee4\u3002\n\n\u90a3\u5982\u679c\u6211\u4eec\u5e0c\u671b\u5728 Jedis \u4e0a\u9762\u589e\u52a0\u91cd\u8bd5\u673a\u5236\uff0c\u8be5\u5982\u4f55\u505a\u5462\uff1f\u6709\u4e86\u4e0a\u9762\u7684 RedisPool \u5bf9\u8c61\uff0c\u91cd\u8bd5\u5c31\u975e\u5e38\u5bb9\u6613\u8fdb\u884c\u4e86\u3002\n\n```java\nclass Redis {\n\n  private JedisPool pool;\n\n  public Redis() {\n    this.pool = new JedisPool();\n  }\n\n  public void execute(CallWithJedis caller) {\n    Jedis jedis = pool.getResource();\n    try {\n      caller.call(jedis);\n    } catch (JedisConnectionException e) {\n      caller.call(jedis);  // \u91cd\u8bd5\u4e00\u6b21\n    } finally {\n      jedis.close();\n    }\n  }\n\n}\n```\n\u4e0a\u9762\u7684\u4ee3\u7801\u6211\u4eec\u53ea\u91cd\u8bd5\u4e86\u4e00\u6b21\uff0c\u5982\u6709\u9700\u8981\u4e5f\u53ef\u4ee5\u91cd\u8bd5\u591a\u6b21\uff0c\u4f46\u662f\u4e5f\u4e0d\u80fd\u65e0\u9650\u91cd\u8bd5\uff0c\u5c31\u597d\u6bd4\u4eba\u901d\u4e0d\u53ef\u590d\u751f\uff0c\u8981\u8282\u54c0\u987a\u53d8\u3002\n\n## \u4f5c\u4e1a\n\n\u56ff\u4e8e\u7cbe\u529b\uff0c\u4ee5\u4e0a\u4ee3\u7801\u5e76\u6ca1\u6709\u505a\u5230\u975e\u5e38\u7ec6\u81f4\uff0c\u6bd4\u5982 Redis \u7684\u94fe\u63a5\u53c2\u6570\u90fd\u6ca1\u6709\u63d0\u53ca\uff0c\u8fde\u63a5\u6c60\u7684\u5927\u5c0f\u4ee5\u53ca\u8d85\u65f6\u53c2\u6570\u7b49\u4e5f\u6ca1\u6709\u914d\u7f6e\uff0c\u8fd9\u4e9b\u7ec6\u8282\u5de5\u4f5c\u5c31\u7559\u7ed9\u8bfb\u8005\u4eec\u4f5c\u4e3a\u672c\u8282\u7684\u4f5c\u4e1a\uff0c\u81ea\u5df1\u52a8\u624b\u5b8c\u6210\u4e00\u4e2a\u5b8c\u5584\u7684\u5c01\u88c5\u5427\u3002\n\n\n\n", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/28\u62d3\u5c55_7\u5999\u624b\u4ec1\u5fc3__\u4f18\u96c5\u5730\u4f7f\u7528_Jedis.md", "create_date": "2020-02-18T03:01:05.963", "order": 29}}, {"model": "subject.chapter", "pk": 36, "fields": {"title": "29\u62d3\u5c55 8\uff1a\u5c45\u5b89\u601d\u5371 \u2014\u2014 \u4fdd\u62a4 Redis", "topic": 2, "md5": "42d5f2f8b15eb50dcc5c17160bea6564", "md_body": "# \u62d3\u5c55 8\uff1a\u5c45\u5b89\u601d\u5371 \u2014\u2014 \u4fdd\u62a4 Redis\n\n\u672c\u8282\u6211\u4eec\u6765\u8c08\u8c08\u4f7f\u7528 Redis \u9700\u8981\u6ce8\u610f\u7684\u5b89\u5168\u98ce\u9669\u4ee5\u53ca\u9632\u8303\u63aa\u65bd\uff0c\u907f\u514d\u6570\u636e\u6cc4\u9732\u548c\u4e22\u5931\uff0c\u907f\u514d\u6240\u5728\u4e3b\u673a\u6743\u9650\u88ab\u9ed1\u5ba2\u7a83\u53d6\uff0c\u4ee5\u53ca\u907f\u514d\u4eba\u4e3a\u64cd\u4f5c\u5931\u8bef\u3002\n\n\n## \u6307\u4ee4\u5b89\u5168\n\nRedis \u6709\u4e00\u4e9b\u975e\u5e38\u5371\u9669\u7684\u6307\u4ee4\uff0c\u8fd9\u4e9b\u6307\u4ee4\u4f1a\u5bf9 Redis \u7684\u7a33\u5b9a\u4ee5\u53ca\u6570\u636e\u5b89\u5168\u9020\u6210\u975e\u5e38\u4e25\u91cd\u7684\u5f71\u54cd\u3002\u6bd4\u5982 `keys` \u6307\u4ee4\u4f1a\u5bfc\u81f4 Redis \u5361\u987f\uff0c`flushdb` \u548c `flushall` \u4f1a\u8ba9 Redis \u7684\u6240\u6709\u6570\u636e\u5168\u90e8\u6e05\u7a7a\u3002\u5982\u4f55\u907f\u514d\u4eba\u4e3a\u64cd\u4f5c\u5931\u8bef\u5bfc\u81f4\u8fd9\u4e9b\u707e\u96be\u6027\u7684\u540e\u679c\u4e5f\u662f\u8fd0\u7ef4\u4eba\u5458\u7279\u522b\u9700\u8981\u6ce8\u610f\u7684\u98ce\u9669\u70b9\u4e4b\u4e00\u3002\n\nRedis \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u63d0\u4f9b\u4e86 `rename-command` \u6307\u4ee4\u7528\u4e8e\u5c06\u67d0\u4e9b\u5371\u9669\u7684\u6307\u4ee4\u4fee\u6539\u6210\u7279\u522b\u7684\u540d\u79f0\uff0c\u7528\u6765\u907f\u514d\u4eba\u4e3a\u8bef\u64cd\u4f5c\u3002\u6bd4\u5982\u5728\u914d\u7f6e\u6587\u4ef6\u7684 security \u5757\u589e\u52a0\u4e0b\u9762\u7684\u5185\u5bb9:\n\n```\nrename-command keys abckeysabc\n```\n\u5982\u679c\u8fd8\u60f3\u6267\u884c keys \u65b9\u6cd5\uff0c\u90a3\u5c31\u4e0d\u80fd\u76f4\u63a5\u6572 `keys` \u547d\u4ee4\u4e86\uff0c\u800c\u9700\u8981\u952e\u5165`abckeysabc`\u3002\n\u5982\u679c\u60f3\u5b8c\u5168\u5c01\u6740\u67d0\u6761\u6307\u4ee4\uff0c\u53ef\u4ee5\u5c06\u6307\u4ee4 `rename` \u6210\u7a7a\u4e32\uff0c\u5c31\u65e0\u6cd5\u901a\u8fc7\u4efb\u4f55\u5b57\u7b26\u4e32\u6307\u4ee4\u6765\u6267\u884c\u8fd9\u6761\u6307\u4ee4\u4e86\u3002\n```\nrename-command flushall \"\"\n```\n\n## \u7aef\u53e3\u5b89\u5168\n\nRedis \u9ed8\u8ba4\u4f1a\u76d1\u542c `*:6379`\uff0c\u5982\u679c\u5f53\u524d\u7684\u670d\u52a1\u5668\u4e3b\u673a\u6709\u5916\u7f51\u5730\u5740\uff0cRedis \u7684\u670d\u52a1\u5c06\u4f1a\u76f4\u63a5\u66b4\u9732\u5728\u516c\u7f51\u4e0a\uff0c\u4efb\u4f55\u4e00\u4e2a\u521d\u7ea7\u9ed1\u5ba2\u4f7f\u7528\u9002\u5f53\u7684\u5de5\u5177\u5bf9 IP \u5730\u5740\u8fdb\u884c\u7aef\u53e3\u626b\u63cf\u5c31\u53ef\u4ee5\u63a2\u6d4b\u51fa\u6765\u3002\n\nRedis \u7684\u670d\u52a1\u5730\u5740\u4e00\u65e6\u53ef\u4ee5\u88ab\u5916\u7f51\u76f4\u63a5\u8bbf\u95ee\uff0c\u5185\u90e8\u7684\u6570\u636e\u5c31\u5f7b\u5e95\u4e27\u5931\u4e86\u5b89\u5168\u6027\u3002\u9ad8\u7ea7\u4e00\u70b9\u7684\u9ed1\u5ba2\u4eec\u53ef\u4ee5\u901a\u8fc7 Redis \u6267\u884c Lua \u811a\u672c\u62ff\u5230\u670d\u52a1\u5668\u6743\u9650\uff0c\u6076\u610f\u7684\u7ade\u4e89\u5bf9\u624b\u4eec\u751a\u81f3\u4f1a\u76f4\u63a5\u6e05\u7a7a\u4f60\u7684 Redis \u6570\u636e\u5e93\u3002\n```\nbind 10.100.20.13\n```\n\u6240\u4ee5\uff0c\u8fd0\u7ef4\u4eba\u5458\u52a1\u5fc5\u5728 Redis \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u76d1\u542c\u7684 IP \u5730\u5740\uff0c\u907f\u514d\u8fd9\u6837\u7684\u60e8\u5267\u53d1\u751f\u3002\u66f4\u8fdb\u4e00\u6b65\uff0c\u8fd8\u53ef\u4ee5\u589e\u52a0 Redis \u7684\u5bc6\u7801\u8bbf\u95ee\u9650\u5236\uff0c\u5ba2\u6237\u7aef\u5fc5\u987b\u4f7f\u7528 `auth` \u6307\u4ee4\u4f20\u5165\u6b63\u786e\u7684\u5bc6\u7801\u624d\u53ef\u4ee5\u8bbf\u95ee Redis\uff0c\u8fd9\u6837\u5373\u4f7f\u5730\u5740\u66b4\u9732\u51fa\u53bb\u4e86\uff0c\u666e\u901a\u9ed1\u5ba2\u4e5f\u65e0\u6cd5\u5bf9 Redis \u8fdb\u884c\u4efb\u4f55\u6307\u4ee4\u64cd\u4f5c\u3002\n```\nrequirepass yoursecurepasswordhereplease\n```\n\u5bc6\u7801\u63a7\u5236\u4e5f\u4f1a\u5f71\u54cd\u5230\u4ece\u5e93\u590d\u5236\uff0c\u4ece\u5e93\u5fc5\u987b\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u4f7f\u7528 masterauth \u6307\u4ee4\u914d\u7f6e\u76f8\u5e94\u7684\u5bc6\u7801\u624d\u53ef\u4ee5\u8fdb\u884c\u590d\u5236\u64cd\u4f5c\u3002\n```\nmasterauth yoursecurepasswordhereplease\n```\n\n## Lua \u811a\u672c\u5b89\u5168\n\n\u5f00\u53d1\u8005\u5fc5\u987b\u7981\u6b62 Lua \u811a\u672c\u7531\u7528\u6237\u8f93\u5165\u7684\u5185\u5bb9 (UGC) \u751f\u6210\uff0c\u8fd9\u53ef\u80fd\u4f1a\u88ab\u9ed1\u5ba2\u5229\u7528\u4ee5\u690d\u5165\u6076\u610f\u7684\u653b\u51fb\u4ee3\u7801\u6765\u5f97\u5230 Redis \u7684\u4e3b\u673a\u6743\u9650\u3002\n\n\u540c\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u8ba9 Redis \u4ee5\u666e\u901a\u7528\u6237\u7684\u8eab\u4efd\u542f\u52a8\uff0c\u8fd9\u6837\u5373\u4f7f\u5b58\u5728\u6076\u610f\u4ee3\u7801\u9ed1\u5ba2\u4e5f\u65e0\u6cd5\u62ff\u5230 root \u6743\u9650\u3002\n\n## SSL \u4ee3\u7406\n\nRedis \u5e76\u4e0d\u652f\u6301 SSL \u94fe\u63a5\uff0c\u610f\u5473\u7740\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4ea4\u4e92\u7684\u6570\u636e\u4e0d\u5e94\u8be5\u76f4\u63a5\u66b4\u9732\u5728\u516c\u7f51\u4e0a\u4f20\u8f93\uff0c\u5426\u5219\u4f1a\u6709\u88ab\u7a83\u542c\u7684\u98ce\u9669\u3002\u5982\u679c\u5fc5\u987b\u8981\u7528\u5728\u516c\u7f51\u4e0a\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 SSL \u4ee3\u7406\u3002\n\nSSL \u4ee3\u7406\u6bd4\u8f83\u5e38\u89c1\u7684\u6709 ssh\uff0c\u4e0d\u8fc7 Redis \u5b98\u65b9\u63a8\u8350\u4f7f\u7528 [spiped](http://www.tarsnap.com/spiped.html) \u5de5\u5177\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a spiped \u7684\u529f\u80fd\u76f8\u5bf9\u6bd4\u8f83\u5355\u4e00\uff0c\u4f7f\u7528\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u6613\u4e8e\u7406\u89e3\u3002\u4e0b\u9762\u8fd9\u5f20\u56fe\u662f\u4f7f\u7528 spiped \u5bf9 ssh \u901a\u9053\u8fdb\u884c\u4e8c\u6b21\u52a0\u5bc6 (\u56e0\u4e3a ssh \u901a\u9053\u4e5f\u53ef\u80fd\u5b58\u5728 bug)\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/24/164cb6b701b80b96?w=711&h=329&f=png&s=54119)\n\n\u540c\u6837 SSL \u4ee3\u7406\u4e5f\u53ef\u4ee5\u7528\u5728\u4e3b\u4ece\u590d\u5236\u4e0a\uff0c\u5982\u679c Redis \u4e3b\u4ece\u5b9e\u4f8b\u9700\u8981\u8de8\u673a\u623f\u590d\u5236\uff0cspiped \u4e5f\u53ef\u4ee5\u6d3e\u4e0a\u7528\u573a\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u8282\u8bb2\u89e3\u4e86\u6700\u57fa\u672c\u7684 Redis \u5b89\u5168\u9632\u62a4\u601d\u8def\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u6765\u8be6\u7ec6\u8bb2\u89e3 spiped \u7684\u539f\u7406\u548c\u4f7f\u7528\u3002\n", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/29\u62d3\u5c55_8\u5c45\u5b89\u601d\u5371__\u4fdd\u62a4_Redis.md", "create_date": "2020-02-18T03:01:05.985", "order": 30}}, {"model": "subject.chapter", "pk": 37, "fields": {"title": "30\u62d3\u5c55 9\uff1a\u9694\u5899\u6709\u8033 \u2014\u2014 Redis \u5b89\u5168\u901a\u4fe1", "topic": 2, "md5": "e5a4203620c37596f2d950939ffb66de", "md_body": "# \u62d3\u5c55 9\uff1a\u9694\u5899\u6709\u8033 \u2014\u2014 Redis \u5b89\u5168\u901a\u4fe1\n\n\u60f3\u8c61\u8fd9\u6837\u4e00\u4e2a\u5e94\u7528\u573a\u666f\uff0c\u516c\u53f8\u6709\u4e24\u4e2a\u673a\u623f\u3002\u56e0\u4e3a\u4e00\u4e2a\u7d27\u6025\u9700\u6c42\uff0c\u9700\u8981\u8de8\u673a\u623f\u8bfb\u53d6 Redis \u6570\u636e\u3002\u5e94\u7528\u90e8\u7f72\u5728 A \u673a\u623f\uff0c\u5b58\u50a8\u90e8\u7f72\u5728 B \u673a\u623f\u3002\u5982\u679c\u4f7f\u7528\u666e\u901a tcp \u76f4\u63a5\u8bbf\u95ee\uff0c\u56e0\u4e3a\u8de8\u673a\u623f\u6240\u4ee5\u4f20\u8f93\u6570\u636e\u4f1a\u66b4\u9732\u5728\u516c\u7f51\uff0c\u8fd9\u975e\u5e38\u4e0d\u5b89\u5168\uff0c\u5ba2\u6237\u7aef\u670d\u52a1\u5668\u4ea4\u4e92\u7684\u6570\u636e\u5b58\u5728\u88ab\u7a83\u542c\u7684\u98ce\u9669\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/24/164cb8fec86c373c?w=813&h=336&f=png&s=34055)\n\nRedis \u672c\u8eab\u5e76\u4e0d\u652f\u6301 SSL \u5b89\u5168\u94fe\u63a5\uff0c\u4e0d\u8fc7\u6709\u4e86 SSL \u4ee3\u7406\u8f6f\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u901a\u4fe1\u6570\u636e\u900f\u660e\u5730\u5f97\u5230\u52a0\u5bc6\uff0c\u5c31\u597d\u50cf Redis \u7a7f\u4e0a\u4e86\u4e00\u5c42\u9690\u8eab\u5916\u5957\u4e00\u6837\u3002spiped \u5c31\u662f\u8fd9\u6837\u7684\u4e00\u6b3e SSL \u4ee3\u7406\u8f6f\u4ef6\uff0c\u5b83\u662f Redis \u5b98\u65b9\u63a8\u8350\u7684\u4ee3\u7406\u8f6f\u4ef6\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/24/164cbbfbafa6f005?w=783&h=377&f=png&s=41300)\n\n## spiped \u539f\u7406\n\n\u8ba9\u6211\u4eec\u653e\u5927\u7ec6\u8282\uff0c\u4ed4\u7ec6\u89c2\u5bdf spiped \u5b9e\u73b0\u539f\u7406\u3002spiped \u4f1a\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5404\u542f\u52a8\u4e00\u4e2a spiped \u8fdb\u7a0b\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/24/164cbb6b2ce179eb?w=844&h=319&f=png&s=38059)\n\n\u5de6\u8fb9\u7684 spiped \u8fdb\u7a0b A \u8d1f\u8d23\u63a5\u53d7\u6765\u81ea Redis Client \u53d1\u9001\u8fc7\u6765\u7684\u8bf7\u6c42\u6570\u636e\uff0c\u52a0\u5bc6\u540e\u4f20\u9001\u5230\u53f3\u8fb9\u7684 spiped \u8fdb\u7a0b B\u3002spiped B \u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u89e3\u5bc6\u540e\u4f20\u9012\u5230 Redis Server\u3002\u7136\u540e Redis Server \u518d\u8d70\u4e00\u4e2a\u53cd\u5411\u7684\u6d41\u7a0b\u5c06\u54cd\u5e94\u56de\u590d\u7ed9 Redis Client\u3002\n\n\u6bcf\u4e00\u4e2a spiped \u8fdb\u7a0b\u90fd\u4f1a\u6709\u4e00\u4e2a\u76d1\u542c\u7aef\u53e3 (server socket) \u7528\u6765\u63a5\u6536\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u5ba2\u6237\u7aef (socket client) \u5c06\u6570\u636e\u8f6c\u53d1\u5230\u76ee\u6807\u5730\u5740\u3002\n\nspiped \u8fdb\u7a0b\u9700\u8981\u6210\u5bf9\u51fa\u73b0\uff0c\u76f8\u4e92\u4e4b\u95f4\u9700\u8981\u4f7f\u7528\u76f8\u540c\u7684\u5171\u4eab\u5bc6\u94a5\u6765\u52a0\u5bc6\u6d88\u606f\u3002\n\n## spiped \u4f7f\u7528\u5165\u95e8\n\u5b89\u88c5 spiped\uff0c\u6211\u7528\u7684\u662f Mac\u3002\n```\n> brew install spiped\n```\n\u5982\u679c\u662f Linux\uff0c\u53ef\u4ee5\u4f7f\u7528 apt-get \u6216\u8005 yum \u5b89\u88c5\uff1a\n```\n> apt-get install spiped\n> yum install spiped\n```\n\n1. \u4f7f\u7528 Docker \u542f\u52a8 redis-server\uff0c\u6ce8\u610f\u8981\u7ed1\u5b9a\u672c\u673a\u7684\u56de\u73af`127.0.0.1`\uff1b\n```\n> docker run -d -p127.0.0.1:6379:6379 --name redis-server-6379 redis\n12781661ec47faa8a8a967234365192f4da58070b791262afb8d9f64fce61835\n> docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED                  STATUS              PORTS                      NAMES\n12781661ec47        redis               \"docker-entrypoint.s\u2026\"   Less than a second ago   Up 1 second         127.0.0.1:6379->6379/tcp   redis-server-6379\n```\n\n2. \u751f\u6210\u968f\u673a\u7684\u5bc6\u94a5\u6587\u4ef6\uff1b\n```\n# \u968f\u673a\u7684 32 \u4e2a\u5b57\u8282\n> dd if=/dev/urandom bs=32 count=1 of=spiped.key\n1+0 records in\n1+0 records out\n32 bytes transferred in 0.000079 secs (405492 bytes/sec)\n> ls -l\nrw-r--r--  1 qianwp  staff  32  7 24 18:13 spiped.key\n```\n\n3. \u4f7f\u7528\u5bc6\u94a5\u6587\u4ef6\u542f\u52a8\u670d\u52a1\u5668 spiped \u8fdb\u7a0b\uff0c`172.16.128.81`\u662f\u6211\u672c\u673a\u7684\u516c\u7f51 IP \u5730\u5740\uff1b\n```\n# -d \u8868\u793a decrypt(\u5bf9\u8f93\u5165\u6570\u636e\u8fdb\u884c\u89e3\u5bc6)\uff0c-s \u4e3a\u6e90\u76d1\u542c\u5730\u5740\uff0c-t \u4e3a\u8f6c\u53d1\u76ee\u6807\u5730\u5740\n> spiped -d -s '[172.16.128.81]:6479' -t '[127.0.0.1]:6379' -k spiped.key\n> ps -ef|grep spiped\n501 30673     1   0  7:29 \u4e0b\u5348 ??         0:00.04 spiped -d -s [172.16.128.81]:6479 -t [127.0.0.1]:6379 -k spiped.key\n```\n\u8fd9\u4e2a spiped \u8fdb\u7a0b\u76d1\u542c\u516c\u7f51 IP \u7684 6479 \u7aef\u53e3\u63a5\u6536\u516c\u7f51\u4e0a\u7684\u6570\u636e\uff0c\u5c06\u6570\u636e\u89e3\u5bc6\u540e\u8f6c\u53d1\u5230\u672c\u673a\u56de\u73af\u5730\u5740\u7684 6379 \u7aef\u53e3\uff0c\u4e5f\u5c31\u662f redis-server \u76d1\u542c\u7684\u7aef\u53e3\u3002\n\n4. \u4f7f\u7528\u5bc6\u94a5\u6587\u4ef6\u542f\u52a8\u5ba2\u6237\u7aef spiped \u8fdb\u7a0b\uff0c`172.16.128.81`\u662f\u6211\u672c\u673a\u7684\u516c\u7f51 IP \u5730\u5740\uff1b\n```\n# -e \u8868\u793a encrypt\uff0c\u5bf9\u8f93\u5165\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\n> spiped -e -s '[127.0.0.1]:6579' -t '[172.16.128.81]:6479' -k spiped.key\n> ps -ef|grep spiped\n501 30673     1   0  7:29 \u4e0b\u5348 ??         0:00.04 spiped -d -s [172.16.128.81]:6479 -t [127.0.0.1]:6379 -k spiped.key\n501 30696     1   0  7:30 \u4e0b\u5348 ??         0:00.03 spiped -e -s [127.0.0.1]:6579 -t [172.16.128.81]:6479 -k spiped.key\n```\n\u5ba2\u6237\u7aef spiped \u8fdb\u7a0b\u76d1\u542c\u4e86\u672c\u5730\u56de\u73af\u5730\u5740\u7684 6579 \u7aef\u53e3\uff0c\u5c06\u8be5\u7aef\u53e3\u4e0a\u6536\u5230\u7684\u6570\u636e\u52a0\u5bc6\u8f6c\u53d1\u5230\u670d\u52a1\u5668 spiped \u8fdb\u7a0b\u3002\n\n5. \u542f\u52a8\u5ba2\u6237\u7aef\u94fe\u63a5\uff0c\u56e0\u4e3a Docker \u91cc\u9762\u7684\u5ba2\u6237\u7aef\u4e0d\u597d\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7684\u56de\u73af\u5730\u5740\uff0c\u6240\u4ee5 Redis \u7684\u5ba2\u6237\u7aef\u6211\u4eec\u4f7f\u7528 Python \u4ee3\u7801\u6765\u542f\u52a8\uff1b\n```py\n>> import redis\n>> c=redis.StrictRedis(host=\"localhost\", port=6579)\n>> c.ping()\n>> c.info('cpu')\n{'used_cpu_sys': 4.83,\n 'used_cpu_sys_children': 0.0,\n 'used_cpu_user': 0.93,\n 'used_cpu_user_children': 0.0}\n```\n\u53ef\u4ee5\u770b\u51fa\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5df2\u7ecf\u901a\u4e86\uff0c\u5982\u679c\u6211\u4eec\u5c1d\u8bd5\u76f4\u63a5\u94fe\u63a5\u670d\u52a1\u5668 spiped \u8fdb\u7a0b (\u52a0\u5bc6\u7684\u7aef\u53e3 6379)\uff0c\u770b\u770b\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002\n```\n>>> import redis\n>>> c=redis.StrictRedis(host=\"172.16.128.81\", port=6479)\n>>> c.ping()\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/Users/qianwp/source/animate/juejin-redis/.py/lib/python2.7/site-packages/redis/client.py\", line 777, in ping\n    return self.execute_command('PING')\n  File \"/Users/qianwp/source/animate/juejin-redis/.py/lib/python2.7/site-packages/redis/client.py\", line 674, in execute_command\n    return self.parse_response(connection, command_name, **options)\n  File \"/Users/qianwp/source/animate/juejin-redis/.py/lib/python2.7/site-packages/redis/client.py\", line 680, in parse_response\n    response = connection.read_response()\n  File \"/Users/qianwp/source/animate/juejin-redis/.py/lib/python2.7/site-packages/redis/connection.py\", line 624, in read_response\n    response = self._parser.read_response()\n  File \"/Users/qianwp/source/animate/juejin-redis/.py/lib/python2.7/site-packages/redis/connection.py\", line 284, in read_response\n    response = self._buffer.readline()\n  File \"/Users/qianwp/source/animate/juejin-redis/.py/lib/python2.7/site-packages/redis/connection.py\", line 216, in readline\n    self._read_from_socket()\n  File \"/Users/qianwp/source/animate/juejin-redis/.py/lib/python2.7/site-packages/redis/connection.py\", line 191, in _read_from_socket\n    (e.args,))\nredis.exceptions.ConnectionError: Error while reading from socket: ('Connection closed by server.',)\n```\n\u4ece\u8f93\u51fa\u4e2d\u53ef\u4ee5\u770b\u51fa\u6765\u8bf7\u6c42\u662f\u53d1\u9001\u8fc7\u53bb\u4e86\uff0c\u4f46\u662f\u5374\u51fa\u73b0\u4e86\u8bfb\u8d85\u65f6\uff0c\u8981\u4e48\u662f\u670d\u52a1\u5668\u5728\u9ed8\u8ba4\u7684\u8d85\u65f6\u65f6\u95f4\u5185\u6ca1\u6709\u8fd4\u56de\u6570\u636e\uff0c\u8981\u4e48\u662f\u670d\u52a1\u5668\u6ca1\u6709\u8fd4\u56de\u5ba2\u6237\u7aef\u60f3\u8981\u7684\u6570\u636e\u3002\n\nspiped \u53ef\u4ee5\u540c\u65f6\u652f\u6301\u591a\u4e2a\u5ba2\u6237\u7aef\u94fe\u63a5\u7684\u6570\u636e\u8f6c\u53d1\u5de5\u4f5c\uff0c\u5b83\u8fd8\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6765\u9650\u5b9a\u5141\u8bb8\u7684\u6700\u5927\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002\u4f46\u662f\u5bf9\u4e8e\u670d\u52a1\u5668 spiped\uff0c\u5b83\u4e0d\u80fd\u540c\u65f6\u652f\u6301\u591a\u4e2a\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u8f6c\u53d1\u3002\u610f\u5473\u7740\u5728\u96c6\u7fa4\u73af\u5883\u4e0b\uff0c\u9700\u8981\u4e3a\u6bcf\u4e00\u4e2a server \u8282\u70b9\u542f\u52a8\u4e00\u4e2a spiped \u8fdb\u7a0b\u6765\u4ee3\u6536\u6d88\u606f\uff0c\u5728\u8fd0\u7ef4\u5b9e\u8df5\u4e0a\u8fd9\u53ef\u80fd\u4f1a\u6bd4\u8f83\u7e41\u7410\u3002\n\n## \u4f5c\u4e1a\n\u8bf7\u8bfb\u8005\u5c06 Redis \u66ff\u6362\u6210 MySQL \u6765\u4f53\u9a8c\u4e00\u4e0b spiped \u7684\u795e\u5947\u9b54\u529b\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/30\u62d3\u5c55_9\u9694\u5899\u6709\u8033__Redis_\u5b89\u5168\u901a\u4fe1.md", "create_date": "2020-02-18T03:01:06.003", "order": 31}}, {"model": "subject.chapter", "pk": 38, "fields": {"title": "31\u62d3\u5c55 10\uff1a\u6cd5\u529b\u65e0\u8fb9 \u2014\u2014 Redis Lua \u811a\u672c\u6267\u884c\u539f\u7406", "topic": 2, "md5": "1aaa0f2853cbb8c8c11960adaee21693", "md_body": "Redis \u63d0\u4f9b\u4e86\u975e\u5e38\u4e30\u5bcc\u7684\u6307\u4ee4\u96c6\uff0c\u4f46\u662f\u7528\u6237\u4f9d\u7136\u4e0d\u6ee1\u8db3\uff0c\u5e0c\u671b\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6269\u5145\u82e5\u5e72\u6307\u4ee4\u6765\u5b8c\u6210\u4e00\u4e9b\u7279\u5b9a\u9886\u57df\u7684\u95ee\u9898\u3002Redis \u4e3a\u8fd9\u6837\u7684\u7528\u6237\u573a\u666f\u63d0\u4f9b\u4e86 lua \u811a\u672c\u652f\u6301\uff0c\u7528\u6237\u53ef\u4ee5\u5411\u670d\u52a1\u5668\u53d1\u9001 lua \u811a\u672c\u6765\u6267\u884c\u81ea\u5b9a\u4e49\u52a8\u4f5c\uff0c\u83b7\u53d6\u811a\u672c\u7684\u54cd\u5e94\u6570\u636e\u3002Redis \u670d\u52a1\u5668\u4f1a\u5355\u7ebf\u7a0b\u539f\u5b50\u6027\u6267\u884c lua \u811a\u672c\uff0c\u4fdd\u8bc1 lua \u811a\u672c\u5728\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u88ab\u4efb\u610f\u5176\u5b83\u8bf7\u6c42\u6253\u65ad\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/10/23/1669e9fd24688358?w=558&h=192&f=png&s=15922)\n\n\u6bd4\u5982\u5728\u5206\u5e03\u5f0f\u9501\u5c0f\u8282\uff0c\u6211\u4eec\u63d0\u5230\u4e86 del_if_equals \u4f2a\u6307\u4ee4\uff0c\u5b83\u53ef\u4ee5\u5c06\u5339\u914d key \u548c\u5220\u9664 key \u5408\u5e76\u5728\u4e00\u8d77\u539f\u5b50\u6027\u6267\u884c\uff0cRedis \u539f\u751f\u6ca1\u6709\u63d0\u4f9b\u8fd9\u6837\u529f\u80fd\u7684\u6307\u4ee4\uff0c\u5b83\u53ef\u4ee5\u4f7f\u7528 lua \u811a\u672c\u6765\u5b8c\u6210\u3002\n```\nif redis.call(\"get\",KEYS[1]) == ARGV[1] then\n    return redis.call(\"del\",KEYS[1])\nelse\n    return 0\nend\n```\n\u90a3\u4e0a\u9762\u8fd9\u4e2a\u811a\u672c\u5982\u4f55\u6267\u884c\u5462\uff1f\u4f7f\u7528 EVAL \u6307\u4ee4\n```\n127.0.0.1:6379> set foo bar\nOK\n127.0.0.1:6379> eval 'if redis.call(\"get\",KEYS[1]) == ARGV[1] then return redis.call(\"del\",KEYS[1]) else return 0 end' 1 foo bar\n(integer) 1\n127.0.0.1:6379> eval 'if redis.call(\"get\",KEYS[1]) == ARGV[1] then return redis.call(\"del\",KEYS[1]) else return 0 end' 1 foo bar\n(integer) 0\n```\nEVAL \u6307\u4ee4\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u811a\u672c\u5185\u5bb9\u5b57\u7b26\u4e32\uff0c\u4e0a\u9762\u7684\u4f8b\u5b50\u6211\u4eec\u5c06 lua \u811a\u672c\u538b\u7f29\u6210\u4e00\u884c\u4ee5\u5355\u5f15\u53f7\u56f4\u8d77\u6765\u662f\u4e3a\u4e86\u65b9\u4fbf\u547d\u4ee4\u884c\u6267\u884c\u3002\u7136\u540e\u662f key \u7684\u6570\u91cf\u4ee5\u53ca\u6bcf\u4e2a key \u4e32\uff0c\u6700\u540e\u662f\u4e00\u7cfb\u5217\u9644\u52a0\u53c2\u6570\u5b57\u7b26\u4e32\u3002\u9644\u52a0\u53c2\u6570\u7684\u6570\u91cf\u4e0d\u9700\u8981\u548c key \u4fdd\u6301\u4e00\u81f4\uff0c\u53ef\u4ee5\u5b8c\u5168\u6ca1\u6709\u9644\u52a0\u53c2\u6570\u3002\n```\nEVAL SCRIPT KEY_NUM KEY1 KEY2 ... KEYN ARG1 ARG2 ....\n```\n\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u53ea\u6709 1 \u4e2a key\uff0c\u5b83\u5c31\u662f foo\uff0c\u7d27\u63a5\u7740 bar \u662f\u552f\u4e00\u7684\u9644\u52a0\u53c2\u6570\u3002\u5728 lua \u811a\u672c\u4e2d\uff0c\u6570\u7ec4\u4e0b\u6807\u662f\u4ece 1 \u5f00\u59cb\uff0c\u6240\u4ee5\u901a\u8fc7 KEYS[1] \u5c31\u53ef\u4ee5\u5f97\u5230 \u7b2c\u4e00\u4e2a key\uff0c\u901a\u8fc7 ARGV[1] \u5c31\u53ef\u4ee5\u5f97\u5230\u7b2c\u4e00\u4e2a\u9644\u52a0\u53c2\u6570\u3002redis.call  \u51fd\u6570\u53ef\u4ee5\u8ba9\u6211\u4eec\u8c03\u7528 Redis \u7684\u539f\u751f\u6307\u4ee4\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u5206\u522b\u8c03\u7528\u4e86 get \u6307\u4ee4\u548c del \u6307\u4ee4\u3002return \u8fd4\u56de\u7684\u7ed3\u679c\u5c06\u4f1a\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\n\n### SCRIPT LOAD \u548c EVALSHA \u6307\u4ee4\n\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u811a\u672c\u7684\u5185\u5bb9\u5f88\u77ed\u3002\u5982\u679c\u811a\u672c\u7684\u5185\u5bb9\u5f88\u957f\uff0c\u800c\u4e14\u5ba2\u6237\u7aef\u9700\u8981\u9891\u7e41\u6267\u884c\uff0c\u90a3\u4e48\u6bcf\u6b21\u90fd\u9700\u8981\u4f20\u9012\u5197\u957f\u7684\u811a\u672c\u5185\u5bb9\u52bf\u5fc5\u6bd4\u8f83\u6d6a\u8d39\u7f51\u7edc\u6d41\u91cf\u3002\u6240\u4ee5 Redis \u8fd8\u63d0\u4f9b\u4e86 SCRIPT LOAD \u548c EVALSHA \u6307\u4ee4\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/23/1669ea023d4b887d?w=581&h=239&f=png&s=25126)\nSCRIPT LOAD \u6307\u4ee4\u7528\u4e8e\u5c06\u5ba2\u6237\u7aef\u63d0\u4f9b\u7684 lua \u811a\u672c\u4f20\u9012\u5230\u670d\u52a1\u5668\u800c\u4e0d\u6267\u884c\uff0c\u4f46\u662f\u4f1a\u5f97\u5230\u811a\u672c\u7684\u552f\u4e00 ID\uff0c\u8fd9\u4e2a\u552f\u4e00 ID \u662f\u7528\u6765\u552f\u4e00\u6807\u8bc6\u670d\u52a1\u5668\u7f13\u5b58\u7684\u8fd9\u6bb5 lua \u811a\u672c\uff0c\u5b83\u662f\u7531 Redis \u4f7f\u7528 sha1 \u7b97\u6cd5\u63c9\u634f\u811a\u672c\u5185\u5bb9\u800c\u5f97\u5230\u7684\u4e00\u4e2a\u5f88\u957f\u7684\u5b57\u7b26\u4e32\u3002\u6709\u4e86\u8fd9\u4e2a\u552f\u4e00 ID\uff0c\u540e\u9762\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u901a\u8fc7 EVALSHA \u6307\u4ee4\u53cd\u590d\u6267\u884c\u8fd9\u4e2a\u811a\u672c\u4e86\u3002\n\u6211\u4eec\u77e5\u9053 Redis \u6709 incrby \u6307\u4ee4\u53ef\u4ee5\u5b8c\u6210\u6574\u6570\u7684\u81ea\u589e\u64cd\u4f5c\uff0c\u4f46\u662f\u6ca1\u6709\u63d0\u4f9b\u81ea\u4e58\u8fd9\u6837\u7684\u6307\u4ee4\u3002\n```\nincrby key value  ==> $key = $key + value\nmulby key value ==> $key = $key * value\n```\n\u4e0b\u9762\u6211\u4eec\u4f7f\u7528 SCRIPT LOAD \u548c EVALSHA \u6307\u4ee4\u6765\u5b8c\u6210\u81ea\u4e58\u8fd0\u7b97\u3002\n```\nlocal curVal = redis.call(\"get\", KEYS[1])\nif curVal == false then\n  curVal = 0\nelse\n  curVal = tonumber(curVal)\nend\ncurVal = curVal * tonumber(ARGV[1])\nredis.call(\"set\", KEYS[1], curVal)\nreturn curVal\n```\n\u5148\u5c06\u4e0a\u9762\u7684\u811a\u672c\u5355\u884c\u5316\uff0c\u8bed\u53e5\u4e4b\u95f4\u4f7f\u7528\u5206\u53f7\u9694\u5f00\n```\nlocal curVal = redis.call(\"get\", KEYS[1]); if curVal == false then curVal = 0 else curVal = tonumber(curVal) end; curVal = curVal * tonumber(ARGV[1]); redis.call(\"set\", KEYS[1], curVal); return curVal\n```\n\u52a0\u8f7d\u811a\u672c\n```\n127.0.0.1:6379> script load 'local curVal = redis.call(\"get\", KEYS[1]); if curVal == false then curVal = 0 else curVal = tonumber(curVal) end; curVal = curVal * tonumber(ARGV[1]); redis.call(\"set\", KEYS[1], curVal); return curVal'\n\"be4f93d8a5379e5e5b768a74e77c8a4eb0434441\"\n```\n\u547d\u4ee4\u884c\u8f93\u51fa\u4e86\u5f88\u957f\u7684\u5b57\u7b26\u4e32\uff0c\u5b83\u5c31\u662f\u811a\u672c\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u4e0b\u9762\u6211\u4eec\u4f7f\u7528\u8fd9\u4e2a\u552f\u4e00\u6807\u8bc6\u6765\u6267\u884c\u6307\u4ee4\n```\n127.0.0.1:6379> evalsha be4f93d8a5379e5e5b768a74e77c8a4eb0434441 1 notexistskey 5\n(integer) 0\n127.0.0.1:6379> evalsha be4f93d8a5379e5e5b768a74e77c8a4eb0434441 1 notexistskey 5\n(integer) 0\n127.0.0.1:6379> set foo 1\nOK\n127.0.0.1:6379> evalsha be4f93d8a5379e5e5b768a74e77c8a4eb0434441 1 foo 5\n(integer) 5\n127.0.0.1:6379> evalsha be4f93d8a5379e5e5b768a74e77c8a4eb0434441 1 foo 5\n(integer) 25\n```\n\n### \u9519\u8bef\u5904\u7406\n\u4e0a\u9762\u7684\u811a\u672c\u53c2\u6570\u8981\u6c42\u4f20\u5165\u7684\u9644\u52a0\u53c2\u6570\u5fc5\u987b\u662f\u6574\u6570\uff0c\u5982\u679c\u6ca1\u6709\u4f20\u9012\u6574\u6570\u4f1a\u600e\u6837\u5462\uff1f\n```\n127.0.0.1:6379> evalsha be4f93d8a5379e5e5b768a74e77c8a4eb0434441 1 foo bar\n(error) ERR Error running script (call to f_be4f93d8a5379e5e5b768a74e77c8a4eb0434441): @user_script:1: user_script:1: attempt to perform arithmetic on a nil value\n```\n\u53ef\u4ee5\u770b\u5230\u5ba2\u6237\u7aef\u8f93\u51fa\u4e86\u670d\u52a1\u5668\u8fd4\u56de\u7684\u901a\u7528\u9519\u8bef\u6d88\u606f\uff0c\u6ce8\u610f\u8fd9\u662f\u4e00\u4e2a\u52a8\u6001\u629b\u51fa\u7684\u5f02\u5e38\uff0cRedis \u4f1a\u4fdd\u62a4\u4e3b\u7ebf\u7a0b\u4e0d\u4f1a\u56e0\u4e3a\u811a\u672c\u7684\u9519\u8bef\u800c\u5bfc\u81f4\u670d\u52a1\u5668\u5d29\u6e83\uff0c\u8fd1\u4f3c\u4e8e\u5728\u811a\u672c\u7684\u5916\u56f4\u6709\u4e00\u4e2a\u5f88\u5927\u7684 try catch \u8bed\u53e5\u5305\u88f9\u3002\u5728 lua \u811a\u672c\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u9519\u8bef\uff0c\u540c redis \u7684\u4e8b\u52a1\u4e00\u6837\uff0c\u90a3\u4e9b\u901a\u8fc7  redis.call  \u51fd\u6570\u5df2\u7ecf\u6267\u884c\u8fc7\u7684\u6307\u4ee4\u5bf9\u670d\u52a1\u5668\u72b6\u6001\u4ea7\u751f\u5f71\u54cd\u662f\u65e0\u6cd5\u64a4\u9500\u7684\uff0c\u5728\u7f16\u5199 lua \u4ee3\u7801\u65f6\u4e00\u5b9a\u8981\u5c0f\u5fc3\uff0c\u907f\u514d\u6ca1\u6709\u8003\u8651\u5230\u7684\u5224\u65ad\u6761\u4ef6\u5bfc\u81f4\u811a\u672c\u6ca1\u6709\u5b8c\u5168\u6267\u884c\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/23/1669ea063212e897?w=388&h=196&f=png&s=15462)\n\u5982\u679c\u8bfb\u8005\u5bf9 lua \u8bed\u8a00\u6709\u6240\u4e86\u89e3\u5c31\u77e5\u9053 lua \u539f\u751f\u6ca1\u6709\u63d0\u4f9b try catch \u8bed\u53e5\uff0c\u90a3\u4e0a\u9762\u63d0\u5230\u7684\u5f02\u5e38\u5305\u88f9\u8bed\u53e5\u7a76\u7adf\u662f\u7528\u4ec0\u4e48\u6765\u5b9e\u73b0\u7684\u5462\uff1flua \u7684\u66ff\u4ee3\u65b9\u6848\u662f\u5185\u7f6e\u4e86 pcall(f) \u51fd\u6570\u8c03\u7528\u3002pcall \u7684\u610f\u601d\u662f protected call\uff0c\u5b83\u4f1a\u8ba9 f \u51fd\u6570\u8fd0\u884c\u5728\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0cf \u5982\u679c\u51fa\u73b0\u4e86\u9519\u8bef\uff0cpcall \u8c03\u7528\u4f1a\u8fd4\u56de false \u548c\u9519\u8bef\u4fe1\u606f\u3002\u800c\u666e\u901a\u7684 call(f) \u8c03\u7528\u5728\u9047\u5230\u9519\u8bef\u65f6\u53ea\u4f1a\u5411\u4e0a\u629b\u51fa\u5f02\u5e38\u3002\u5728 Redis \u7684\u6e90\u7801\u4e2d\u53ef\u4ee5\u770b\u5230 lua \u811a\u672c\u7684\u6267\u884c\u88ab\u5305\u88f9\u5728 pcall \u51fd\u6570\u8c03\u7528\u4e2d\u3002\n```\n// \u7f16\u8bd1\u671f\nint luaCreateFunction(client *c, lua_State *lua, char *funcname, robj *body) {\n  ...\n  if (lua_pcall(lua,0,0,0)) {\n    addReplyErrorFormat(c,\"Error running script (new function): %s\\n\",\n            lua_tostring(lua,-1));\n    lua_pop(lua,1);\n    return C_ERR;\n  }\n  ...\n}\n\n// \u8fd0\u884c\u671f\nvoid evalGenericCommand(client *c, int evalsha) {\n  ...\n  err = lua_pcall(lua,0,1,-2);\n  ...\n}\n```\nRedis \u5728 lua \u811a\u672c\u4e2d\u9664\u4e86\u63d0\u4f9b\u4e86 redis.call \u51fd\u6570\u5916\uff0c\u540c\u6837\u4e5f\u63d0\u4f9b\u4e86 redis.pcall \u51fd\u6570\u3002\u524d\u8005\u9047\u5230\u9519\u8bef\u5411\u4e0a\u629b\u51fa\u5f02\u5e38\uff0c\u540e\u8005\u4f1a\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u3002\u4f7f\u7528\u65f6\u4e00\u5b9a\u8981\u6ce8\u610f call \u51fd\u6570\u51fa\u9519\u65f6\u4f1a\u4e2d\u65ad\u811a\u672c\u7684\u6267\u884c\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u811a\u672c\u7684\u539f\u5b50\u6027\uff0c\u8981\u8c28\u614e\u4f7f\u7528\u3002\n\n### \u9519\u8bef\u4f20\u9012\nredis.call \u51fd\u6570\u8c03\u7528\u4f1a\u4ea7\u751f\u9519\u8bef\uff0c\u811a\u672c\u9047\u5230\u8fd9\u79cd\u9519\u8bef\u4f1a\u8fd4\u56de\u600e\u6837\u7684\u4fe1\u606f\u5462\uff1f\u6211\u4eec\u518d\u770b\u4e2a\u4f8b\u5b50\n```\n127.0.0.1:6379> hset foo x 1 y 2\n(integer) 2\n127.0.0.1:6379> eval 'return redis.call(\"incr\", \"foo\")' 0\n(error) ERR Error running script (call to f_8727c9c34a61783916ca488b366c475cb3a446cc): @user_script:1: WRONGTYPE Operation against a key holding the wrong kind of value\n```\n\u5ba2\u6237\u7aef\u8f93\u51fa\u7684\u4f9d\u7136\u662f\u4e00\u4e2a\u901a\u7528\u7684\u9519\u8bef\u6d88\u606f\uff0c\u800c\u4e0d\u662f incr \u8c03\u7528\u672c\u5e94\u8be5\u8fd4\u56de\u7684 WRONGTYPE \u7c7b\u578b\u7684\u9519\u8bef\u6d88\u606f\u3002Redis \u5185\u90e8\u5728\u5904\u7406 redis.call \u9047\u5230\u9519\u8bef\u65f6\u662f\u5411\u4e0a\u629b\u51fa\u5f02\u5e38\uff0c\u5916\u56f4\u7684\u7528\u6237\u770b\u4e0d\u89c1\u7684 pcall\u8c03\u7528\u6355\u83b7\u5230\u811a\u672c\u5f02\u5e38\u65f6\u4f1a\u5411\u5ba2\u6237\u7aef\u56de\u590d\u901a\u7528\u7684\u9519\u8bef\u4fe1\u606f\u3002\u5982\u679c\u6211\u4eec\u5c06\u4e0a\u9762\u7684 call \u6539\u6210 pcall\uff0c\u7ed3\u679c\u5c31\u4f1a\u4e0d\u4e00\u6837\uff0c\u5b83\u53ef\u4ee5\u5c06\u5185\u90e8\u6307\u4ee4\u8fd4\u56de\u7684\u7279\u5b9a\u9519\u8bef\u5411\u4e0a\u4f20\u9012\u3002\n```\n127.0.0.1:6379> eval 'return redis.pcall(\"incr\", \"foo\")' 0\n(error) WRONGTYPE Operation against a key holding the wrong kind of value\n```\n\n### \u811a\u672c\u6b7b\u5faa\u73af\u600e\u4e48\u529e\uff1f\nRedis \u7684\u6307\u4ee4\u6267\u884c\u662f\u4e2a\u5355\u7ebf\u7a0b\uff0c\u8fd9\u4e2a\u5355\u7ebf\u7a0b\u8fd8\u8981\u6267\u884c\u6765\u81ea\u5ba2\u6237\u7aef\u7684 lua \u811a\u672c\u3002\u5982\u679c lua \u811a\u672c\u4e2d\u6765\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u662f\u4e0d\u662f Redis \u5c31\u5b8c\u86cb\u4e86\uff1fRedis \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u63d0\u4f9b\u4e86 script kill \u6307\u4ee4\u7528\u4e8e\u52a8\u6001\u6740\u6b7b\u4e00\u4e2a\u6267\u884c\u65f6\u95f4\u8d85\u65f6\u7684 lua \u811a\u672c\u3002\u4e0d\u8fc7 script kill \u7684\u6267\u884c\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u524d\u63d0\uff0c\u90a3\u5c31\u662f\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u811a\u672c\u6ca1\u6709\u5bf9 Redis \u7684\u5185\u90e8\u6570\u636e\u72b6\u6001\u8fdb\u884c\u4fee\u6539\uff0c\u56e0\u4e3a Redis \u4e0d\u5141\u8bb8 script kill \u7834\u574f\u811a\u672c\u6267\u884c\u7684\u539f\u5b50\u6027\u3002\u6bd4\u5982\u811a\u672c\u5185\u90e8\u4f7f\u7528\u4e86 redis.call(\"set\", key, value) \u4fee\u6539\u4e86\u5185\u90e8\u7684\u6570\u636e\uff0c\u90a3\u4e48 script kill \u6267\u884c\u65f6\u670d\u52a1\u5668\u4f1a\u8fd4\u56de\u9519\u8bef\u3002\u4e0b\u9762\u6211\u4eec\u6765\u5c1d\u8bd5\u4ee5\u4e0b script kill \u6307\u4ee4\u3002\n```\n127.0.0.1:6379> eval 'while(true) do print(\"hello\") end' 0\n```\neval \u6307\u4ee4\u6267\u884c\u540e\uff0c\u53ef\u4ee5\u660e\u663e\u770b\u51fa\u6765 redis \u5361\u6b7b\u4e86\uff0c\u6b7b\u6d3b\u6ca1\u6709\u4efb\u4f55\u54cd\u5e94\uff0c\u5982\u679c\u53bb\u89c2\u5bdf Redis \u670d\u52a1\u5668\u65e5\u5fd7\u53ef\u4ee5\u770b\u5230\u65e5\u5fd7\u5728\u75af\u72c2\u8f93\u51fa hello \u5b57\u7b26\u4e32\u3002\u8fd9\u65f6\u5019\u5c31\u5fc5\u987b\u91cd\u65b0\u5f00\u542f\u4e00\u4e2a redis-cli \u6765\u6267\u884c script kill \u6307\u4ee4\u3002\n```\n127.0.0.1:6379> script kill\nOK\n(2.58s)\n```\n\u518d\u56de\u8fc7\u5934\u770b eval \u6307\u4ee4\u7684\u8f93\u51fa\n```\n127.0.0.1:6379> eval 'while(true) do print(\"hello\") end' 0\n(error) ERR Error running script (call to f_d395649372f578b1a0d3a1dc1b2389717cadf403): @user_script:1: Script killed by user with SCRIPT KILL...\n(6.99s)\n```\n\u770b\u5230\u8fd9\u91cc\u7ec6\u5fc3\u7684\u540c\u5b66\u4f1a\u6ce8\u610f\u5230\u4e24\u4e2a\u7591\u70b9\uff0c\u7b2c\u4e00\u4e2a\u662f script kill \u6307\u4ee4\u4e3a\u4ec0\u4e48\u6267\u884c\u4e86 2.58 \u79d2\uff0c\u7b2c\u4e8c\u4e2a\u662f\u811a\u672c\u90fd\u5361\u6b7b\u4e86\uff0cRedis \u54ea\u91cc\u6765\u7684\u95f2\u529f\u592b\u63a5\u53d7 script kill \u6307\u4ee4\u3002\u5982\u679c\u4f60\u81ea\u5df1\u5c1d\u8bd5\u4e86\u5728\u7b2c\u4e8c\u4e2a\u7a97\u53e3\u6267\u884c redis-cli \u53bb\u8fde\u63a5\u670d\u52a1\u5668\uff0c\u4f60\u8fd8\u4f1a\u53d1\u73b0\u7b2c\u4e09\u4e2a\u7591\u70b9\uff0credis-cli \u5efa\u7acb\u8fde\u63a5\u6709\u70b9\u6162\uff0c\u5927\u7ea6\u987f\u4e86\u6709 1 \u79d2\u5de6\u53f3\u3002\n\n### Script Kill \u7684\u539f\u7406\n\u4e0b\u9762\u6211\u5c31\u8981\u5f00\u59cb\u63ed\u79d8 kill \u7684\u539f\u7406\u4e86\uff0clua \u811a\u672c\u5f15\u64ce\u529f\u80fd\u592a\u5f3a\u5927\u4e86\uff0c\u5b83\u63d0\u4f9b\u4e86\u5404\u5f0f\u5404\u6837\u7684\u94a9\u5b50\u51fd\u6570\uff0c\u5b83\u5141\u8bb8\u5728\u5185\u90e8\u865a\u62df\u673a\u6267\u884c\u6307\u4ee4\u65f6\u8fd0\u884c\u94a9\u5b50\u4ee3\u7801\u3002\u6bd4\u5982\u6bcf\u6267\u884c N \u6761\u6307\u4ee4\u6267\u884c\u4e00\u6b21\u67d0\u4e2a\u94a9\u5b50\u51fd\u6570\uff0cRedis \u6b63\u662f\u4f7f\u7528\u4e86\u8fd9\u4e2a\u94a9\u5b50\u51fd\u6570\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/23/1669ea098ad61009?w=519&h=355&f=png&s=17167)\n```\nvoid evalGenericCommand(client *c, int evalsha) {\n  ...\n  // lua\u5f15\u64ce\u6bcf\u6267\u884c10w\u6761\u6307\u4ee4\uff0c\u6267\u884c\u4e00\u6b21\u94a9\u5b50\u51fd\u6570 luaMaskCountHook\n  lua_sethook(lua,luaMaskCountHook,LUA_MASKCOUNT,100000);\n  ...\n}\n```\nRedis \u5728\u94a9\u5b50\u51fd\u6570\u91cc\u4f1a\u5fd9\u91cc\u5077\u95f2\u53bb\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u4e14\u53ea\u6709\u5728\u53d1\u73b0 lua \u811a\u672c\u6267\u884c\u8d85\u65f6\u4e4b\u540e\u624d\u4f1a\u53bb\u5904\u7406\u8bf7\u6c42\uff0c\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u9ed8\u8ba4\u662f 5 \u79d2\u3002\u4e8e\u662f\u4e0a\u9762\u63d0\u51fa\u7684\u4e09\u4e2a\u7591\u70b9\u4e5f\u5c31\u70df\u6d88\u4e91\u6563\u4e86\u3002\n\n### \u601d\u8003\u9898\n\u5728\u5ef6\u65f6\u961f\u5217\u5c0f\u8282\uff0c\u6211\u4eec\u4f7f\u7528 zrangebyscore  \u548c zdel \u4e24\u6761\u6307\u4ee4\u6765\u4e89\u62a2\u5ef6\u65f6\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff0c\u901a\u8fc7 zdel \u7684\u8fd4\u56de\u503c\u6765\u51b3\u5b9a\u662f\u54ea\u4e2a\u5ba2\u6237\u7aef\u62a2\u5230\u4e86\u4efb\u52a1\uff0c\u8fd9\u610f\u5473\u7740\u90a3\u4e9b\u6ca1\u6709\u62a2\u5230\u4efb\u52a1\u7684\u5ba2\u6237\u7aef\u4f1a\u6709\u8fd9\u6837\u4e00\u79cd\u611f\u53d7 \u2014\u2014 \u5230\u4e86\u5634\u8fb9\u7684\u8089(\u4efb\u52a1)\u6700\u540e\u8fd8\u88ab\u522b\u4eba\u62a2\u8d70\u4e86\uff0c\u4f1a\u5f88\u4e0d\u723d\u3002\u5982\u679c\u53ef\u4ee5\u4f7f\u7528 lua \u811a\u672c\u6765\u5b9e\u73b0\u4e89\u62a2\u903b\u8f91\uff0c\u5c06 zrangebyscore \u548c zdel \u6307\u4ee4\u539f\u5b50\u6027\u6267\u884c\u5c31\u4e0d\u4f1a\u5b58\u5728\u8fd9\u79cd\u95ee\u9898\uff0c\u8bfb\u8005\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e0b\u3002\n\n\u6ce8\uff1a\u5982\u679c\u8bfb\u8005\u4e0d\u719f\u6089 lua\uff0c\u5efa\u8bae\u5148\u5b66\u4e60 lua \u8bed\u8a00\uff0clua \u8bed\u8a00\u7b80\u5355\u6613\u5b66\uff0c\u4f46\u662f\u4e5f\u4e0d\u662f\u51e0\u5206\u949f\u5c31\u53ef\u4ee5\u5b66\u4f1a\u7684\u4e8b\uff0c\u9700\u8981\u518d\u6765\u4e00\u672c\u5c0f\u518c\u7684\u5185\u5bb9\u3002\u672c\u5c0f\u518c\u4e13\u6ce8 Redis\uff0c\u6240\u4ee5\u5c31\u4e0d\u5f00\u5927\u7bc7\u5185\u5bb9\u6765\u7ec6\u8bb2 lua \u8bed\u8a00\u4e86\uff0c\u6709\u9700\u8981\u7684\u670b\u53cb\u53ef\u4ee5\u641c\u7d22\u76f8\u5173\u5728\u7ebf\u6559\u7a0b\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/31\u62d3\u5c55_10\u6cd5\u529b\u65e0\u8fb9__Redis_Lua_\u811a\u672c\u6267\u884c\u539f\u7406.md", "create_date": "2020-02-18T03:01:06.023", "order": 32}}, {"model": "subject.chapter", "pk": 39, "fields": {"title": "32\u62d3\u5c55 11\uff1a\u77ed\u5c0f\u7cbe\u608d \u2014\u2014 \u547d\u4ee4\u884c\u5de5\u5177\u7684\u5999\u7528", "topic": 2, "md5": "fae43a97cf353a241b3738f9b469046a", "md_body": "\u6211\u4eec\u5929\u5929\u90fd\u5728\u4f7f\u7528 Redis \u5185\u7f6e\u7684\u547d\u4ee4\u884c\u5de5\u5177 redis-cli\uff0c\u4e45\u800c\u4e45\u4e4b\u4ee5\u4e3a\u5b83\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4ea4\u4e92\u5f0f Redis \u6570\u636e\u7ed3\u6784\u624b\u5de5\u64cd\u4f5c\u7a0b\u5e8f\uff0c\u4f46\u662f\u5b83\u80cc\u540e\u5f3a\u5927\u7684\u529f\u80fd\u7edd\u5927\u591a\u6570\u540c\u5b66\u53ef\u80fd\u95fb\u6240\u672a\u95fb\u3002\u672c\u8282\u6211\u4eec\u4e00\u8d77\u6765\u6316\u6398\u8fd9\u4e9b\u9c9c\u4e3a\u4eba\u77e5\u7684\u6709\u8da3\u7528\u6cd5\u3002\n\n### \u6267\u884c\u5355\u6761\u547d\u4ee4\n\u5e73\u65f6\u5728\u8bbf\u95ee Redis \u670d\u52a1\u5668\uff0c\u4e00\u822c\u90fd\u4f1a\u4f7f\u7528 redis-cli \u8fdb\u5165\u4ea4\u4e92\u6a21\u5f0f\uff0c\u7136\u540e\u4e00\u95ee\u4e00\u7b54\u6765\u8bfb\u5199\u670d\u52a1\u5668\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u4f7f\u7528\u7684\u662f\u5b83\u7684\u300c\u4ea4\u4e92\u6a21\u5f0f\u300d\u3002\u8fd8\u6709\u53e6\u5916\u4e00\u79cd\u300c\u76f4\u63a5\u6a21\u5f0f\u300d\uff0c\u901a\u8fc7\u5c06\u547d\u4ee4\u53c2\u6570\u76f4\u63a5\u4f20\u9012\u7ed9 redis-cli \u6765\u6267\u884c\u6307\u4ee4\u5e76\u83b7\u53d6\u8f93\u51fa\u7ed3\u679c\u3002\n```\n$ redis-cli incrby foo 5\n(integer) 5\n$ redis-cli incrby foo 5\n(integer) 10\n```\n\u5982\u679c\u8f93\u51fa\u7684\u5185\u5bb9\u8f83\u5927\uff0c\u8fd8\u53ef\u4ee5\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u5916\u90e8\u6587\u4ef6\n```\n$ redis-cli info > info.txt\n$ wc -l info.txt\n\u00a0 \u00a0 \u00a0120 info.txt\n```\n\u4e0a\u9762\u7684\u547d\u4ee4\u6307\u5411\u7684\u670d\u52a1\u5668\u662f\u9ed8\u8ba4\u670d\u52a1\u5668\u5730\u5740\uff0c\u5982\u679c\u60f3\u6307\u5411\u7279\u5b9a\u7684\u670d\u52a1\u5668\u53ef\u4ee5\u8fd9\u6837\n```\n// -n 2 \u8868\u793a\u4f7f\u7528\u7b2c2\u4e2a\u5e93\uff0c\u76f8\u5f53\u4e8e select 2\n$ redis-cli -h localhost -p 6379 -n 2 ping\nPONG\n```\n\n### \u6279\u91cf\u6267\u884c\u547d\u4ee4\n\u5728\u5e73\u65f6\u7ebf\u4e0a\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6709\u65f6\u5019\u6211\u4eec\u514d\u4e0d\u4e86\u8981\u624b\u5de5\u9020\u6570\u636e\uff0c\u7136\u540e\u5bfc\u5165 Redis\u3002\u901a\u5e38\u6211\u4eec\u4f1a\u7f16\u5199\u811a\u672c\u7a0b\u5e8f\u6765\u505a\u8fd9\u4ef6\u4e8b\u3002\u4e0d\u8fc7\u8fd8\u6709\u53e6\u5916\u4e00\u79cd\u6bd4\u8f83\u4fbf\u6377\u7684\u65b9\u5f0f\uff0c\u90a3\u5c31\u662f\u76f4\u63a5\u4f7f\u7528 redis-cli \u6765\u6279\u91cf\u6267\u884c\u4e00\u7cfb\u5217\u6307\u4ee4\u3002\n```\n$ cat cmds.txt\nset foo1 bar1\nset foo2 bar2\nset foo3 bar3\n......\n$ cat cmds.txt | redis-cli\nOK\nOK\nOK\n...\n```\n\u4e0a\u9762\u7684\u6307\u4ee4\u4f7f\u7528\u4e86 Unix \u7ba1\u9053\u5c06 cat \u6307\u4ee4\u7684\u6807\u51c6\u8f93\u51fa\u8fde\u63a5\u5230 redis-cli \u7684\u6807\u51c6\u8f93\u5165\u3002\u5176\u5b9e\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8f93\u5165\u91cd\u5b9a\u5411\u6765\u6279\u91cf\u6267\u884c\u6307\u4ee4\u3002\n```\n$ redis-cli < cmds.txt\nOK\nOK\nOK\n...\n```\n\n### set \u591a\u884c\u5b57\u7b26\u4e32\n\u5982\u679c\u4e00\u4e2a\u5b57\u7b26\u4e32\u6709\u591a\u884c\uff0c\u4f60\u5e0c\u671b\u5c06\u5b83\u4f20\u5165 set \u6307\u4ee4\uff0credis-cli \u8981\u5982\u4f55\u505a\uff1f\u53ef\u4ee5\u4f7f\u7528 -x \u9009\u9879\uff0c\u8be5\u9009\u9879\u4f1a\u4f7f\u7528\u6807\u51c6\u8f93\u5165\u7684\u5185\u5bb9\u4f5c\u4e3a\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u3002\n```\n$ cat str.txt\nErnest Hemingway once wrote,\n\"The world is a fine place and worth fighting for.\"\nI agree with the second part.\n$ redis-cli -x set foo < str.txt\nOK\n$ redis-cli get foo\n\"Ernest Hemingway once wrote,\\n\\\"The world is a fine place and worth fighting for.\\\"\\nI agree with the second part.\\n\"\n```\n\n### \u91cd\u590d\u6267\u884c\u6307\u4ee4\nredis-cli \u8fd8\u652f\u6301\u91cd\u590d\u6267\u884c\u6307\u4ee4\u591a\u6b21\uff0c\u6bcf\u6761\u6307\u4ee4\u6267\u884c\u4e4b\u95f4\u8bbe\u7f6e\u4e00\u4e2a\u95f4\u9694\u65f6\u95f4\uff0c\u5982\u6b64\u4fbf\u53ef\u4ee5\u89c2\u5bdf\u67d0\u6761\u6307\u4ee4\u7684\u8f93\u51fa\u5185\u5bb9\u968f\u65f6\u95f4\u53d8\u5316\u3002\n```\n// \u95f4\u96941s\uff0c\u6267\u884c5\u6b21\uff0c\u89c2\u5bdfqps\u7684\u53d8\u5316\n$ redis-cli -r 5 -i 1 info | grep ops\ninstantaneous_ops_per_sec:43469\ninstantaneous_ops_per_sec:47460\ninstantaneous_ops_per_sec:47699\ninstantaneous_ops_per_sec:46434\ninstantaneous_ops_per_sec:47216\n```\n\u5982\u679c\u5c06\u6b21\u6570\u8bbe\u7f6e\u4e3a -1 \u90a3\u5c31\u662f\u91cd\u590d\u65e0\u6570\u6b21\u6c38\u8fdc\u6267\u884c\u4e0b\u53bb\u3002\u5982\u679c\u4e0d\u63d0\u4f9b -i \u53c2\u6570\uff0c\u90a3\u5c31\u6ca1\u6709\u95f4\u9694\uff0c\u8fde\u7eed\u91cd\u590d\u6267\u884c\u3002\u5728\u4ea4\u4e92\u6a21\u5f0f\u4e0b\u4e5f\u53ef\u4ee5\u91cd\u590d\u6267\u884c\u6307\u4ee4\uff0c\u5f62\u5f0f\u4e0a\u6bd4\u8f83\u602a\u5f02\uff0c\u5728\u6307\u4ee4\u524d\u9762\u589e\u52a0\u6b21\u6570\n```\n127.0.0.1:6379> 5 ping\nPONG\nPONG\nPONG\nPONG\nPONG\n# \u4e0b\u9762\u7684\u6307\u4ee4\u5f88\u53ef\u6015\uff0c\u4f60\u7684\u5c4f\u5e55\u8981\u6124\u6012\u4e86\n127.0.0.1:6379> 10000 info\n.......\n```\n\n### \u5bfc\u51fa csv\nredis-cli \u4e0d\u80fd\u4e00\u6b21\u5bfc\u51fa\u6574\u4e2a\u5e93\u7684\u5185\u5bb9\u4e3a csv\uff0c\u4f46\u662f\u53ef\u4ee5\u5bfc\u51fa\u5355\u6761\u6307\u4ee4\u7684\u8f93\u51fa\u4e3a csv \u683c\u5f0f\u3002\n```\n$ redis-cli rpush lfoo a b c d e f g\n(integer) 7\n$ redis-cli --csv lrange lfoo 0 -1\n\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\"\n$ redis-cli hmset hfoo a 1 b 2 c 3 d 4\nOK\n$ redis-cli --csv hgetall hfoo\n\"a\",\"1\",\"b\",\"2\",\"c\",\"3\",\"d\",\"4\"\n```\n\u5f53\u7136\u8fd9\u79cd\u5bfc\u51fa\u529f\u80fd\u6bd4\u8f83\u5f31\uff0c\u4ec5\u4ec5\u662f\u4e00\u5806\u5b57\u7b26\u4e32\u7528\u9017\u53f7\u5206\u5272\u5f00\u6765\u3002\u4e0d\u8fc7\u4f60\u53ef\u4ee5\u7ed3\u5408\u547d\u4ee4\u7684\u6279\u91cf\u6267\u884c\u6765\u770b\u770b\u591a\u4e2a\u6307\u4ee4\u7684\u5bfc\u51fa\u6548\u679c\u3002\n```\n$ redis-cli --csv -r 5 hgetall hfoo\n\"a\",\"1\",\"b\",\"2\",\"c\",\"3\",\"d\",\"4\"\n\"a\",\"1\",\"b\",\"2\",\"c\",\"3\",\"d\",\"4\"\n\"a\",\"1\",\"b\",\"2\",\"c\",\"3\",\"d\",\"4\"\n\"a\",\"1\",\"b\",\"2\",\"c\",\"3\",\"d\",\"4\"\n\"a\",\"1\",\"b\",\"2\",\"c\",\"3\",\"d\",\"4\"\n```\n\u770b\u5230\u8fd9\u91cc\u8bfb\u8005\u5e94\u8be5\u660e\u767d --csv \u53c2\u6570\u7684\u6548\u679c\u5c31\u662f\u5bf9\u8f93\u51fa\u505a\u4e86\u4e00\u6b21\u8f6c\u6362\uff0c\u7528\u9017\u53f7\u5206\u5272\uff0c\u4ec5\u6b64\u800c\u5df2\u3002\n\n### \u6267\u884c lua \u811a\u672c\n\u5728 lua \u811a\u672c\u5c0f\u8282\uff0c\u6211\u4eec\u4f7f\u7528 eval \u6307\u4ee4\u6765\u6267\u884c\u811a\u672c\u5b57\u7b26\u4e32\uff0c\u6bcf\u6b21\u90fd\u662f\u5c06\u811a\u672c\u5185\u5bb9\u538b\u7f29\u6210\u5355\u884c\u5b57\u7b26\u4e32\u518d\u8c03\u7528 eval \u6307\u4ee4\uff0c\u8fd9\u975e\u5e38\u7e41\u7410\uff0c\u800c\u4e14\u53ef\u8bfb\u6027\u5f88\u5dee\u3002redis-cli \u8003\u8651\u5230\u4e86\u8fd9\u70b9\uff0c\u5b83\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u811a\u672c\u6587\u4ef6\u3002\n```\n127.0.0.1:6379> eval \"return redis.pcall('mset', KEYS[1], ARGV[1], KEYS[2], ARGV[2])\" 2 foo1 foo2 bar1 bar2\nOK\n127.0.0.1:6379> eval \"return redis.pcall('mget', KEYS[1], KEYS[2])\" 2 foo1 foo2\n1) \"bar1\"\n2) \"bar2\"\n```\n\u4e0b\u9762\u6211\u4eec\u4ee5\u811a\u672c\u7684\u5f62\u5f0f\u6765\u6267\u884c\u4e0a\u9762\u7684\u6307\u4ee4\uff0c\u53c2\u6570\u5f62\u5f0f\u6709\u6240\u4e0d\u540c\uff0cKEY \u548c ARGV \u4e4b\u95f4\u9700\u8981\u4f7f\u7528\u9017\u53f7\u5206\u5272\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u63d0\u4f9b KEY \u7684\u6570\u91cf\u53c2\u6570\n```\n$ cat mset.txt\nreturn redis.pcall('mset', KEYS[1], ARGV[1], KEYS[2], ARGV[2])\n$ cat mget.txt\nreturn redis.pcall('mget', KEYS[1], KEYS[2])\n$ redis-cli --eval mset.txt foo1 foo2 , bar1 bar2\nOK\n$ redis-cli --eval mget.txt foo1 foo2\n1) \"bar1\"\n2) \"bar2\"\n```\n\u5982\u679c\u4f60\u7684 lua \u811a\u672c\u592a\u957f\uff0c--eval \u5c06\u5927\u6709\u7528\u5904\u3002\n\n### \u76d1\u63a7\u670d\u52a1\u5668\u72b6\u6001\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 --stat \u53c2\u6570\u6765\u5b9e\u65f6\u76d1\u63a7\u670d\u52a1\u5668\u7684\u72b6\u6001\uff0c\u95f4\u9694 1s \u5b9e\u65f6\u8f93\u51fa\u4e00\u6b21\u3002\n```\n$ redis-cli --stat\n------- data ------ --------------------- load -------------------- - child -\nkeys\u00a0 \u00a0 \u00a0 \u00a0mem\u00a0 \u00a0 \u00a0 clients blocked requests\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 connections\n2\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 6.66M\u00a0 \u00a0 100\u00a0 \u00a0 \u00a00\u00a0 \u00a0 \u00a0 \u00a011591628 (+0)\u00a0 \u00a0 \u00a0 \u00a0335\n2\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 6.66M\u00a0 \u00a0 100\u00a0 \u00a0 \u00a00\u00a0 \u00a0 \u00a0 \u00a011653169 (+61541)\u00a0 \u00a0335\n2\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 6.66M\u00a0 \u00a0 100\u00a0 \u00a0 \u00a00\u00a0 \u00a0 \u00a0 \u00a011706550 (+53381)\u00a0 \u00a0335\n2\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 6.54M\u00a0 \u00a0 100\u00a0 \u00a0 \u00a00\u00a0 \u00a0 \u00a0 \u00a011758831 (+52281)\u00a0 \u00a0335\n2\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 6.66M\u00a0 \u00a0 100\u00a0 \u00a0 \u00a00\u00a0 \u00a0 \u00a0 \u00a011803132 (+44301)\u00a0 \u00a0335\n2\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 6.66M\u00a0 \u00a0 100\u00a0 \u00a0 \u00a00\u00a0 \u00a0 \u00a0 \u00a011854183 (+51051)\u00a0 \u00a0335\n```\n\u5982\u679c\u4f60\u89c9\u5f97\u95f4\u9694\u592a\u957f\u6216\u662f\u592a\u77ed\uff0c\u53ef\u4ee5\u4f7f\u7528 -i \u53c2\u6570\u8c03\u6574\u8f93\u51fa\u95f4\u9694\u3002\n\n### \u626b\u63cf\u5927 KEY\n\u8fd9\u4e2a\u529f\u80fd\u592a\u5b9e\u7528\u4e86\uff0c\u6211\u5df2\u7ecf\u5728\u7ebf\u4e0a\u8bd5\u8fc7\u65e0\u6570\u6b21\u4e86\u3002\u6bcf\u6b21\u9047\u5230 Redis \u5076\u7136\u5361\u987f\u95ee\u9898\uff0c\u7b2c\u4e00\u4e2a\u60f3\u5230\u7684\u5c31\u662f\u5b9e\u4f8b\u4e2d\u662f\u5426\u5b58\u5728\u5927 KEY\uff0c\u5927 KEY\u7684\u5185\u5b58\u6269\u5bb9\u4ee5\u53ca\u91ca\u653e\u90fd\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u5361\u987f\u3002\u5982\u679c\u77e5\u9053\u91cc\u9762\u6709\u6ca1\u6709\u5927 KEY\uff0c\u53ef\u4ee5\u81ea\u5df1\u5199\u7a0b\u5e8f\u626b\u63cf\uff0c\u4e0d\u8fc7\u8fd9\u592a\u7e41\u7410\u4e86\u3002redis-cli \u63d0\u4f9b\u4e86 --bigkeys \u53c2\u6570\u53ef\u4ee5\u5f88\u5feb\u626b\u51fa\u5185\u5b58\u91cc\u7684\u5927 KEY\uff0c\u4f7f\u7528 -i \u53c2\u6570\u63a7\u5236\u626b\u63cf\u95f4\u9694\uff0c\u907f\u514d\u626b\u63cf\u6307\u4ee4\u5bfc\u81f4\u670d\u52a1\u5668\u7684 ops \u9661\u589e\u62a5\u8b66\u3002\n```\n$ ./redis-cli --bigkeys -i 0.01\n# Scanning the entire keyspace to find biggest keys as well as\n# average sizes per key type.\u00a0 You can use -i 0.1 to sleep 0.1 sec\n# per 100 SCAN commands (not usually needed).\n\n[00.00%] Biggest zset\u00a0 \u00a0found so far 'hist:aht:main:async_finish:20180425:17' with 1440 members\n[00.00%] Biggest zset\u00a0 \u00a0found so far 'hist:qps:async:authorize:20170311:27' with 2465 members\n[00.00%] Biggest hash\u00a0 \u00a0found so far 'job:counters:6ya9ypu6ckcl' with 3 fields\n[00.01%] Biggest string found so far 'rt:aht:main:device_online:68:{-4}' with 4 bytes\n[00.01%] Biggest zset\u00a0 \u00a0found so far 'machine:load:20180709' with 2879 members\n[00.02%] Biggest string found so far '6y6fze8kj7cy:{-7}' with 90 bytes\n\n```\nredis-cli \u5bf9\u4e8e\u6bcf\u4e00\u79cd\u5bf9\u8c61\u7c7b\u578b\u90fd\u4f1a\u8bb0\u5f55\u957f\u5ea6\u6700\u5927\u7684 KEY\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u5bf9\u8c61\u7c7b\u578b\uff0c\u5237\u65b0\u4e00\u6b21\u6700\u9ad8\u8bb0\u5f55\u5c31\u4f1a\u7acb\u5373\u8f93\u51fa\u4e00\u6b21\u3002\u5b83\u80fd\u4fdd\u8bc1\u8f93\u51fa\u957f\u5ea6\u4e3a Top1 \u7684 KEY\uff0c\u4f46\u662f Top2\u3001Top3\u7b49 KEY \u662f\u65e0\u6cd5\u4fdd\u8bc1\u53ef\u4ee5\u626b\u63cf\u51fa\u6765\u7684\u3002\u4e00\u822c\u7684\u5904\u7406\u65b9\u6cd5\u662f\u591a\u626b\u63cf\u51e0\u6b21\uff0c\u6216\u8005\u662f\u6d88\u706d\u4e86 Top1 \u7684 KEY \u4e4b\u540e\u518d\u626b\u63cf\u786e\u8ba4\u8fd8\u6709\u6ca1\u6709\u6b21\u5927\u7684 KEY\u3002\n\n### \u91c7\u6837\u670d\u52a1\u5668\u6307\u4ee4\n\u73b0\u5728\u7ebf\u4e0a\u6709\u4e00\u53f0 Redis \u670d\u52a1\u5668\u7684 OPS \u592a\u9ad8\uff0c\u6709\u5f88\u591a\u4e1a\u52a1\u6a21\u5757\u90fd\u5728\u4f7f\u7528\u8fd9\u4e2a Redis\uff0c\u5982\u4f55\u624d\u80fd\u5224\u65ad\u51fa\u6765\u662f\u54ea\u4e2a\u4e1a\u52a1\u5bfc\u81f4\u4e86 OPS \u5f02\u5e38\u7684\u9ad8\u3002\u8fd9\u65f6\u53ef\u4ee5\u5bf9\u7ebf\u4e0a\u670d\u52a1\u5668\u7684\u6307\u4ee4\u8fdb\u884c\u91c7\u6837\uff0c\u89c2\u5bdf\u91c7\u6837\u7684\u6307\u4ee4\u5927\u81f4\u5c31\u53ef\u4ee5\u5206\u6790\u51fa OPS \u5360\u6bd4\u9ad8\u7684\u4e1a\u52a1\u70b9\u3002\u8fd9\u65f6\u5c31\u8981\u4f7f\u7528 monitor \u6307\u4ee4\uff0c\u5b83\u4f1a\u5c06\u670d\u52a1\u5668\u77ac\u95f4\u6267\u884c\u7684\u6307\u4ee4\u5168\u90e8\u663e\u793a\u51fa\u6765\u3002\u4e0d\u8fc7\u4f7f\u7528\u7684\u65f6\u5019\u8981\u6ce8\u610f\u5373\u4f7f\u4f7f\u7528 ctrl+c \u4e2d\u65ad\uff0c\u5426\u5219\u4f60\u7684\u663e\u793a\u5668\u4f1a\u567c\u91cc\u556a\u5566\u592a\u591a\u7684\u6307\u4ee4\u77ac\u95f4\u8ba9\u4f60\u773c\u82b1\u7f2d\u4e71\u3002\n```\n$ redis-cli --host 192.168.x.x --port 6379 monitor\n1539853410.458483 [0 10.100.90.62:34365] \"GET\" \"6yax3eb6etq8:{-7}\"\n1539853410.459212 [0 10.100.90.61:56659] \"PFADD\" \"growth:dau:20181018\" \"2klxkimass8w\"\n1539853410.462938 [0 10.100.90.62:20681] \"GET\" \"6yax3eb6etq8:{-7}\"\n1539853410.467231 [0 10.100.90.61:40277] \"PFADD\" \"growth:dau:20181018\" \"2kei0to86ps1\"\n1539853410.470319 [0 10.100.90.62:34365] \"GET\" \"6yax3eb6etq8:{-7}\"\n1539853410.473927 [0 10.100.90.61:58128] \"GET\" \"6yax3eb6etq8:{-7}\"\n1539853410.475712 [0 10.100.90.61:40277] \"PFADD\" \"growth:dau:20181018\" \"2km8sqhlefpc\"\n1539853410.477053 [0 10.100.90.62:61292] \"GET\" \"6yax3eb6etq8:{-7}\"\n```\n\n### \u8bca\u65ad\u670d\u52a1\u5668\u65f6\u5ef6\n\u5e73\u65f6\u6211\u4eec\u8bca\u65ad\u4e24\u53f0\u673a\u5668\u7684\u65f6\u5ef6\u4e00\u822c\u662f\u4f7f\u7528 Unix \u7684 ping \u6307\u4ee4\u3002Redis \u4e5f\u63d0\u4f9b\u4e86\u65f6\u5ef6\u8bca\u65ad\u6307\u4ee4\uff0c\u4e0d\u8fc7\u5b83\u7684\u539f\u7406\u4e0d\u592a\u4e00\u6837\uff0c\u5b83\u662f\u8bca\u65ad\u5f53\u524d\u673a\u5668\u548c Redis \u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6307\u4ee4(PING\u6307\u4ee4)\u65f6\u5ef6\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u662f\u7269\u7406\u7f51\u7edc\u7684\u65f6\u5ef6\uff0c\u8fd8\u548c\u5f53\u524d\u7684 Redis \u4e3b\u7ebf\u7a0b\u662f\u5426\u5fd9\u788c\u6709\u5173\u3002\u5982\u679c\u4f60\u53d1\u73b0 Unix \u7684 ping \u6307\u4ee4\u65f6\u5ef6\u5f88\u5c0f\uff0c\u800c Redis \u7684\u65f6\u5ef6\u5f88\u5927\uff0c\u90a3\u8bf4\u660e Redis \u670d\u52a1\u5668\u5728\u6267\u884c\u6307\u4ee4\u65f6\u6709\u5fae\u5f31\u5361\u987f\u3002\n```\n$ redis-cli --host 192.168.x.x --port 6379 --latency\nmin: 0, max: 5, avg: 0.08 (305 samples)\n```\n\u65f6\u5ef6\u5355\u4f4d\u662f ms\u3002redis-cli \u8fd8\u80fd\u663e\u793a\u65f6\u5ef6\u7684\u5206\u5e03\u60c5\u51b5\uff0c\u800c\u4e14\u662f\u56fe\u5f62\u5316\u8f93\u51fa\u3002\n```\n$ redis-cli --latency-dist\n```\n\n\n![](https://user-gold-cdn.xitu.io/2018/10/24/166a3cac25bdb6fb?w=518&h=193&f=png&s=30452)\n\n\u8fd9\u4e2a\u56fe\u5f62\u7684\u542b\u4e49\u4f5c\u8005\u6ca1\u6709\u63cf\u8ff0\uff0c\u8bfb\u8005\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u7834\u89e3\u4e00\u4e0b\u3002\n\n### \u8fdc\u7a0b rdb \u5907\u4efd\n\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5c31\u53ef\u4ee5\u5c06\u8fdc\u7a0b\u7684 Redis \u5b9e\u4f8b\u5907\u4efd\u5230\u672c\u5730\u673a\u5668\uff0c\u8fdc\u7a0b\u670d\u52a1\u5668\u4f1a\u6267\u884c\u4e00\u6b21bgsave\u64cd\u4f5c\uff0c\u7136\u540e\u5c06 rdb \u6587\u4ef6\u4f20\u8f93\u5230\u5ba2\u6237\u7aef\u3002\u8fdc\u7a0b rdb \u5907\u4efd\u8ba9\u6211\u4eec\u6709\u4e00\u79cd\u201c\u79c0\u624d\u4e0d\u51fa\u95e8\uff0c\u5168\u77e5\u5929\u4e0b\u4e8b\u201d\u7684\u611f\u89c9\u3002\n```\n$ ./redis-cli --host 192.168.x.x --port 6379 --rdb ./user.rdb\nSYNC sent to master, writing 2501265095 bytes to './user.rdb'\nTransfer finished with success.\n```\n\n### \u6a21\u62df\u4ece\u5e93\n\u5982\u679c\u4f60\u60f3\u89c2\u5bdf\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u95f4\u90fd\u540c\u6b65\u4e86\u90a3\u4e9b\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 redis-cli \u6a21\u62df\u4ece\u5e93\u3002\n```\n$ ./redis-cli --host 192.168.x.x --port 6379 --slave\nSYNC with master, discarding 51778306 bytes of bulk transfer...\nSYNC done. Logging commands from master.\n...\n```\n\u4ece\u5e93\u8fde\u4e0a\u4e3b\u5e93\u7684\u7b2c\u4e00\u4ef6\u4e8b\u662f\u5168\u91cf\u540c\u6b65\uff0c\u6240\u4ee5\u770b\u5230\u4e0a\u9762\u7684\u6307\u4ee4\u5361\u987f\u8fd9\u5f88\u6b63\u5e38\uff0c\u5f85\u9996\u6b21\u5168\u91cf\u540c\u6b65\u5b8c\u6210\u540e\uff0c\u5c31\u4f1a\u8f93\u51fa\u589e\u91cf\u7684 aof \u65e5\u5fd7\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/32\u62d3\u5c55_11\u77ed\u5c0f\u7cbe\u608d__\u547d\u4ee4\u884c\u5de5\u5177\u7684\u5999\u7528.md", "create_date": "2020-02-18T03:01:06.053", "order": 33}}, {"model": "subject.chapter", "pk": 40, "fields": {"title": "33\u6e90\u7801 1\uff1a\u4e1d\u5206\u7f15\u6790 \u2014\u2014 \u63a2\u7d22\u300c\u5b57\u7b26\u4e32\u300d\u5185\u90e8", "topic": 2, "md5": "18748629d6ba369be3014e9950a3a9e2", "md_body": "# \u6e90\u7801 1\uff1a\u4e1d\u5206\u7f15\u6790 \u2014\u2014 \u63a2\u7d22\u300c\u5b57\u7b26\u4e32\u300d\u5185\u90e8\u7ed3\u6784\n\nRedis \u4e2d\u7684\u5b57\u7b26\u4e32\u662f\u53ef\u4ee5\u4fee\u6539\u7684\u5b57\u7b26\u4e32\uff0c\u5728\u5185\u5b58\u4e2d\u5b83\u662f\u4ee5\u5b57\u8282\u6570\u7ec4\u7684\u5f62\u5f0f\u5b58\u5728\u7684\u3002\u6211\u4eec\u77e5\u9053 C \u8bed\u8a00\u91cc\u9762\u7684\u5b57\u7b26\u4e32\u6807\u51c6\u5f62\u5f0f\u662f\u4ee5 NULL \u4f5c\u4e3a\u7ed3\u675f\u7b26\uff0c\u4f46\u662f\u5728 Redis \u91cc\u9762\u5b57\u7b26\u4e32\u4e0d\u662f\u8fd9\u4e48\u8868\u793a\u7684\u3002\u56e0\u4e3a\u8981\u83b7\u53d6 NULL \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u4f7f\u7528\u7684\u662f `strlen` \u6807\u51c6\u5e93\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u7684\u7b97\u6cd5\u590d\u6742\u5ea6\u662f O(n)\uff0c\u5b83\u9700\u8981\u5bf9\u5b57\u8282\u6570\u7ec4\u8fdb\u884c\u904d\u5386\u626b\u63cf\uff0c\u4f5c\u4e3a\u5355\u7ebf\u7a0b\u7684 Redis \u8868\u793a\u627f\u53d7\u4e0d\u8d77\u3002\n\nRedis \u7684\u5b57\u7b26\u4e32\u53eb\u7740\u300cSDS\u300d\uff0c\u4e5f\u5c31\u662f`Simple Dynamic String`\u3002\u5b83\u7684\u7ed3\u6784\u662f\u4e00\u4e2a\u5e26\u957f\u5ea6\u4fe1\u606f\u7684\u5b57\u8282\u6570\u7ec4\u3002\n```go\nstruct SDS<T> {\n  T capacity; // \u6570\u7ec4\u5bb9\u91cf\n  T len; // \u6570\u7ec4\u957f\u5ea6\n  byte flags; // \u7279\u6b8a\u6807\u8bc6\u4f4d\uff0c\u4e0d\u7406\u776c\u5b83\n  byte[] content; // \u6570\u7ec4\u5185\u5bb9\n}\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/27/164db13445631ab4?w=572&h=169&f=png&s=8854)\n\n\u5982\u4ee3\u7801\u6240\u793a\uff0c`content` \u91cc\u9762\u5b58\u50a8\u4e86\u771f\u6b63\u7684\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u90a3 `capacity` \u548c `len` \u8868\u793a\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u5b83\u6709\u70b9\u7c7b\u4f3c\u4e8e Java \u8bed\u8a00\u7684 ArrayList \u7ed3\u6784\uff0c\u9700\u8981\u6bd4\u5b9e\u9645\u7684\u5185\u5bb9\u957f\u5ea6\u591a\u5206\u914d\u4e00\u4e9b\u5197\u4f59\u7a7a\u95f4\u3002`capacity` \u8868\u793a\u6240\u5206\u914d\u6570\u7ec4\u7684\u957f\u5ea6\uff0c`len` \u8868\u793a\u5b57\u7b26\u4e32\u7684\u5b9e\u9645\u957f\u5ea6\u3002\u524d\u9762\u6211\u4eec\u63d0\u5230\u5b57\u7b26\u4e32\u662f\u53ef\u4ee5\u4fee\u6539\u7684\u5b57\u7b26\u4e32\uff0c\u5b83\u8981\u652f\u6301 `append` \u64cd\u4f5c\u3002\u5982\u679c\u6570\u7ec4\u6ca1\u6709\u5197\u4f59\u7a7a\u95f4\uff0c\u90a3\u4e48\u8ffd\u52a0\u64cd\u4f5c\u5fc5\u7136\u6d89\u53ca\u5230\u5206\u914d\u65b0\u6570\u7ec4\uff0c\u7136\u540e\u5c06\u65e7\u5185\u5bb9\u590d\u5236\u8fc7\u6765\uff0c\u518d `append` \u65b0\u5185\u5bb9\u3002\u5982\u679c\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u975e\u5e38\u957f\uff0c\u8fd9\u6837\u7684\u5185\u5b58\u5206\u914d\u548c\u590d\u5236\u5f00\u9500\u5c31\u4f1a\u975e\u5e38\u5927\u3002\n\n```c\n/* Append the specified binary-safe string pointed by 't' of 'len' bytes to the\n * end of the specified sds string 's'.\n *\n * After the call, the passed sds string is no longer valid and all the\n * references must be substituted with the new pointer returned by the call. */\nsds sdscatlen(sds s, const void *t, size_t len) {\n    size_t curlen = sdslen(s);  // \u539f\u5b57\u7b26\u4e32\u957f\u5ea6\n\n    // \u6309\u9700\u8c03\u6574\u7a7a\u95f4\uff0c\u5982\u679c capacity \u4e0d\u591f\u5bb9\u7eb3\u8ffd\u52a0\u7684\u5185\u5bb9\uff0c\u5c31\u4f1a\u91cd\u65b0\u5206\u914d\u5b57\u8282\u6570\u7ec4\u5e76\u590d\u5236\u539f\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u5230\u65b0\u6570\u7ec4\u4e2d\n    s = sdsMakeRoomFor(s,len);\n    if (s == NULL) return NULL; // \u5185\u5b58\u4e0d\u8db3\n    memcpy(s+curlen, t, len);  // \u8ffd\u52a0\u76ee\u6807\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u5230\u5b57\u8282\u6570\u7ec4\u4e2d\n    sdssetlen(s, curlen+len); // \u8bbe\u7f6e\u8ffd\u52a0\u540e\u7684\u957f\u5ea6\u503c\n    s[curlen+len] = '\\0'; // \u8ba9\u5b57\u7b26\u4e32\u4ee5\\0 \u7ed3\u5c3e\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u6253\u5370\uff0c\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 glibc \u7684\u5b57\u7b26\u4e32\u51fd\u6570\u8fdb\u884c\u64cd\u4f5c\n    return s;\n}\n```\n\n\u4e0a\u9762\u7684 SDS \u7ed3\u6784\u4f7f\u7528\u4e86\u8303\u578b `T`\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7528 `int` \u5462\uff0c\u8fd9\u662f\u56e0\u4e3a\u5f53\u5b57\u7b26\u4e32\u6bd4\u8f83\u77ed\u65f6\uff0c`len` \u548c `capacity` \u53ef\u4ee5\u4f7f\u7528 `byte` \u548c `short` \u6765\u8868\u793a\uff0cRedis \u4e3a\u4e86\u5bf9\u5185\u5b58\u505a\u6781\u81f4\u7684\u4f18\u5316\uff0c\u4e0d\u540c\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\u4f7f\u7528\u4e0d\u540c\u7684\u7ed3\u6784\u4f53\u6765\u8868\u793a\u3002\n\nRedis \u89c4\u5b9a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u4e0d\u5f97\u8d85\u8fc7 512M \u5b57\u8282\u3002\u521b\u5efa\u5b57\u7b26\u4e32\u65f6 `len` \u548c `capacity` \u4e00\u6837\u957f\uff0c\u4e0d\u4f1a\u591a\u5206\u914d\u5197\u4f59\u7a7a\u95f4\uff0c\u8fd9\u662f\u56e0\u4e3a\u7edd\u5927\u591a\u6570\u573a\u666f\u4e0b\u6211\u4eec\u4e0d\u4f1a\u4f7f\u7528 `append` \u64cd\u4f5c\u6765\u4fee\u6539\u5b57\u7b26\u4e32\u3002\n\n## embstr vs raw\nRedis \u7684\u5b57\u7b26\u4e32\u6709\u4e24\u79cd\u5b58\u50a8\u65b9\u5f0f\uff0c\u5728\u957f\u5ea6\u7279\u522b\u77ed\u65f6\uff0c\u4f7f\u7528 `emb` \u5f62\u5f0f\u5b58\u50a8 (embeded)\uff0c\u5f53\u957f\u5ea6\u8d85\u8fc7 44 \u65f6\uff0c\u4f7f\u7528 `raw` \u5f62\u5f0f\u5b58\u50a8\u3002\n\n\u8fd9\u4e24\u79cd\u7c7b\u578b\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u4e3a\u4ec0\u4e48\u5206\u754c\u7ebf\u662f 44 \u5462\uff1f\n```\n> set codehole abcdefghijklmnopqrstuvwxyz012345678912345678\nOK\n> debug object codehole\nValue at:0x7fec2de00370 refcount:1 encoding:embstr serializedlength:45 lru:5958906 lru_seconds_idle:1\n> set codehole abcdefghijklmnopqrstuvwxyz0123456789123456789\nOK\n> debug object codehole\nValue at:0x7fec2dd0b750 refcount:1 encoding:raw serializedlength:46 lru:5958911 lru_seconds_idle:1\n```\n\u6ce8\u610f\u4e0a\u9762 `debug object` \u8f93\u51fa\u4e2d\u6709\u4e2a `encoding` \u5b57\u6bb5\uff0c\u4e00\u4e2a\u5b57\u7b26\u7684\u5dee\u522b\uff0c\u5b58\u50a8\u5f62\u5f0f\u5c31\u53d1\u751f\u4e86\u53d8\u5316\u3002\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\n\n\u4e3a\u4e86\u89e3\u91ca\u8fd9\u79cd\u73b0\u8c61\uff0c\u6211\u4eec\u9996\u5148\u6765\u4e86\u89e3\u4e00\u4e0b Redis \u5bf9\u8c61\u5934\u7ed3\u6784\u4f53\uff0c\u6240\u6709\u7684 Redis \u5bf9\u8c61\u90fd\u6709\u4e0b\u9762\u7684\u8fd9\u4e2a\u7ed3\u6784\u5934:\n```go\nstruct RedisObject {\n    int4 type; // 4bits\n    int4 encoding; // 4bits\n    int24 lru; // 24bits\n    int32 refcount; // 4bytes\n    void *ptr; // 8bytes\uff0c64-bit system\n} robj;\n```\n\u4e0d\u540c\u7684\u5bf9\u8c61\u5177\u6709\u4e0d\u540c\u7684\u7c7b\u578b `type(4bit)`\uff0c\u540c\u4e00\u4e2a\u7c7b\u578b\u7684 type \u4f1a\u6709\u4e0d\u540c\u7684\u5b58\u50a8\u5f62\u5f0f `encoding(4bit)`\uff0c\u4e3a\u4e86\u8bb0\u5f55\u5bf9\u8c61\u7684 LRU \u4fe1\u606f\uff0c\u4f7f\u7528\u4e86 24 \u4e2a bit \u6765\u8bb0\u5f55 LRU \u4fe1\u606f\u3002\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709\u4e2a\u5f15\u7528\u8ba1\u6570\uff0c\u5f53\u5f15\u7528\u8ba1\u6570\u4e3a\u96f6\u65f6\uff0c\u5bf9\u8c61\u5c31\u4f1a\u88ab\u9500\u6bc1\uff0c\u5185\u5b58\u88ab\u56de\u6536\u3002`ptr` \u6307\u9488\u5c06\u6307\u5411\u5bf9\u8c61\u5185\u5bb9 (body) \u7684\u5177\u4f53\u5b58\u50a8\u4f4d\u7f6e\u3002\u8fd9\u6837\u4e00\u4e2a RedisObject \u5bf9\u8c61\u5934\u9700\u8981\u5360\u636e 16 \u5b57\u8282\u7684\u5b58\u50a8\u7a7a\u95f4\u3002\n\n\u63a5\u7740\u6211\u4eec\u518d\u770b SDS \u7ed3\u6784\u4f53\u7684\u5927\u5c0f\uff0c\u5728\u5b57\u7b26\u4e32\u6bd4\u8f83\u5c0f\u65f6\uff0cSDS \u5bf9\u8c61\u5934\u7684\u5927\u5c0f\u662f`capacity+3`\uff0c\u81f3\u5c11\u662f 3\u3002\u610f\u5473\u7740\u5206\u914d\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u6700\u5c0f\u7a7a\u95f4\u5360\u7528\u4e3a 19 \u5b57\u8282 (16+3)\u3002\n```java\nstruct SDS {\n    int8 capacity; // 1byte\n    int8 len; // 1byte\n    int8 flags; // 1byte\n    byte[] content; // \u5185\u8054\u6570\u7ec4\uff0c\u957f\u5ea6\u4e3a capacity\n}\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/27/164db4dcdac7e7f9?w=538&h=320&f=png&s=18508)\n\n\u5982\u56fe\u6240\u793a\uff0c`embstr` \u5b58\u50a8\u5f62\u5f0f\u662f\u8fd9\u6837\u4e00\u79cd\u5b58\u50a8\u5f62\u5f0f\uff0c\u5b83\u5c06 RedisObject \u5bf9\u8c61\u5934\u548c SDS \u5bf9\u8c61\u8fde\u7eed\u5b58\u5728\u4e00\u8d77\uff0c\u4f7f\u7528 `malloc` \u65b9\u6cd5\u4e00\u6b21\u5206\u914d\u3002\u800c `raw` \u5b58\u50a8\u5f62\u5f0f\u4e0d\u4e00\u6837\uff0c\u5b83\u9700\u8981\u4e24\u6b21 `malloc`\uff0c\u4e24\u4e2a\u5bf9\u8c61\u5934\u5728\u5185\u5b58\u5730\u5740\u4e0a\u4e00\u822c\u662f\u4e0d\u8fde\u7eed\u7684\u3002\n\n\u800c\u5185\u5b58\u5206\u914d\u5668 jemalloc/tcmalloc \u7b49\u5206\u914d\u5185\u5b58\u5927\u5c0f\u7684\u5355\u4f4d\u90fd\u662f 2\u30014\u30018\u300116\u300132\u300164 \u7b49\u7b49\uff0c\u4e3a\u4e86\u80fd\u5bb9\u7eb3\u4e00\u4e2a\u5b8c\u6574\u7684 `embstr` \u5bf9\u8c61\uff0c`jemalloc` \u6700\u5c11\u4f1a\u5206\u914d 32 \u5b57\u8282\u7684\u7a7a\u95f4\uff0c\u5982\u679c\u5b57\u7b26\u4e32\u518d\u7a0d\u5fae\u957f\u4e00\u70b9\uff0c\u90a3\u5c31\u662f 64 \u5b57\u8282\u7684\u7a7a\u95f4\u3002\u5982\u679c\u603b\u4f53\u8d85\u51fa\u4e86 64 \u5b57\u8282\uff0cRedis \u8ba4\u4e3a\u5b83\u662f\u4e00\u4e2a\u5927\u5b57\u7b26\u4e32\uff0c\u4e0d\u518d\u4f7f\u7528 `emdstr` \u5f62\u5f0f\u5b58\u50a8\uff0c\u800c\u8be5\u7528 `raw` \u5f62\u5f0f\u3002\n\n\u5f53\u5185\u5b58\u5206\u914d\u5668\u5206\u914d\u4e86 64 \u7a7a\u95f4\u65f6\uff0c\u90a3\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u6700\u5927\u53ef\u4ee5\u662f\u591a\u5c11\u5462\uff1f\u8fd9\u4e2a\u957f\u5ea6\u5c31\u662f 44\u3002\u90a3\u4e3a\u4ec0\u4e48\u662f 44 \u5462\uff1f\n\n\u524d\u9762\u6211\u4eec\u63d0\u5230 SDS \u7ed3\u6784\u4f53\u4e2d\u7684 `content` \u4e2d\u7684\u5b57\u7b26\u4e32\u662f\u4ee5\u5b57\u8282`\\0`\u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff0c\u4e4b\u6240\u4ee5\u591a\u51fa\u8fd9\u6837\u4e00\u4e2a\u5b57\u8282\uff0c\u662f\u4e3a\u4e86\u4fbf\u4e8e\u76f4\u63a5\u4f7f\u7528 `glibc` \u7684\u5b57\u7b26\u4e32\u5904\u7406\u51fd\u6570\uff0c\u4ee5\u53ca\u4e3a\u4e86\u4fbf\u4e8e\u5b57\u7b26\u4e32\u7684\u8c03\u8bd5\u6253\u5370\u8f93\u51fa\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/27/164db590af5e8551?w=925&h=175&f=png&s=19908)\n\n\u770b\u4e0a\u9762\u8fd9\u5f20\u56fe\u53ef\u4ee5\u7b97\u51fa\uff0c\u7559\u7ed9 `content` \u7684\u957f\u5ea6\u6700\u591a\u53ea\u6709 45(64-19) \u5b57\u8282\u4e86\u3002\u5b57\u7b26\u4e32\u53c8\u662f\u4ee5`\\0`\u7ed3\u5c3e\uff0c\u6240\u4ee5 `embstr` \u6700\u5927\u80fd\u5bb9\u7eb3\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u5c31\u662f 44\u3002\n\n## \u6269\u5bb9\u7b56\u7565\n\n\u5b57\u7b26\u4e32\u5728\u957f\u5ea6\u5c0f\u4e8e 1M \u4e4b\u524d\uff0c\u6269\u5bb9\u7a7a\u95f4\u91c7\u7528\u52a0\u500d\u7b56\u7565\uff0c\u4e5f\u5c31\u662f\u4fdd\u7559 100% \u7684\u5197\u4f59\u7a7a\u95f4\u3002\u5f53\u957f\u5ea6\u8d85\u8fc7 1M \u4e4b\u540e\uff0c\u4e3a\u4e86\u907f\u514d\u52a0\u500d\u540e\u7684\u5197\u4f59\u7a7a\u95f4\u8fc7\u5927\u800c\u5bfc\u81f4\u6d6a\u8d39\uff0c\u6bcf\u6b21\u6269\u5bb9\u53ea\u4f1a\u591a\u5206\u914d 1M \u5927\u5c0f\u7684\u5197\u4f59\u7a7a\u95f4\u3002\n\n## \u601d\u8003\n\u4ec0\u4e48\u573a\u5408\u4e0b\u4f1a\u7528\u5230\u5b57\u7b26\u4e32\u7684 `append` \u65b9\u6cd5\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/33\u6e90\u7801_1\u4e1d\u5206\u7f15\u6790__\u63a2\u7d22\u5b57\u7b26\u4e32\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.070", "order": 34}}, {"model": "subject.chapter", "pk": 41, "fields": {"title": "38\u6e90\u7801 6\uff1a\u7834\u65e7\u7acb\u65b0 \u2014\u2014 \u63a2\u7d22\u300c\u7d27\u51d1\u5217\u8868\u300d\u5185\u90e8", "topic": 2, "md5": "6151d7664d1ff9b2d429fc6a5815b962", "md_body": "# \u6e90\u7801 6\uff1a\u7834\u65e7\u7acb\u65b0 \u2014\u2014 \u63a2\u7d22\u300c\u7d27\u51d1\u5217\u8868\u300d\u5185\u90e8\n\nRedis 5.0 \u53c8\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u7ed3\u6784 listpack\uff0c\u5b83\u662f\u5bf9 ziplist \u7ed3\u6784\u7684\u6539\u8fdb\uff0c\u5728\u5b58\u50a8\u7a7a\u95f4\u4e0a\u4f1a\u66f4\u52a0\u8282\u7701\uff0c\u800c\u4e14\u7ed3\u6784\u4e0a\u4e5f\u6bd4 ziplist \u8981\u7cbe\u7b80\u3002\u5b83\u7684\u6574\u4f53\u5f62\u5f0f\u548c ziplist \u8fd8\u662f\u6bd4\u8f83\u63a5\u8fd1\u7684\uff0c\u5982\u679c\u4f60\u8ba4\u771f\u9605\u8bfb\u4e86 ziplist \u7684\u5185\u90e8\u7ed3\u6784\u5206\u6790\uff0c\u90a3\u4e48 listpack \u4e5f\u662f\u6bd4\u8f83\u5bb9\u6613\u7406\u89e3\u7684\u3002\n```c\nstruct listpack<T> {\n    int32 total_bytes; // \u5360\u7528\u7684\u603b\u5b57\u8282\u6570\n    int16 size; // \u5143\u7d20\u4e2a\u6570\n    T[] entries; // \u7d27\u51d1\u6392\u5217\u7684\u5143\u7d20\u5217\u8868\n    int8 end; // \u540c zlend \u4e00\u6837\uff0c\u6052\u4e3a 0xFF\n}\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/29/164e41fa97257519?w=1412&h=480&f=png&s=57895)\n\u9996\u5148\u8fd9\u4e2a listpack \u8ddf ziplist \u7684\u7ed3\u6784\u51e0\u4e4e\u4e00\u6478\u4e00\u6837\uff0c\u53ea\u662f\u5c11\u4e86\u4e00\u4e2a`zltail_offset`\u5b57\u6bb5\u3002ziplist \u901a\u8fc7\u8fd9\u4e2a\u5b57\u6bb5\u6765\u5b9a\u4f4d\u51fa\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4f4d\u7f6e\uff0c\u7528\u4e8e\u9006\u5e8f\u904d\u5386\u3002\u4e0d\u8fc7 listpack \u53ef\u4ee5\u901a\u8fc7\u5176\u5b83\u65b9\u5f0f\u6765\u5b9a\u4f4d\u51fa\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5`zltail_offset`\u5b57\u6bb5\u5c31\u7701\u6389\u4e86\u3002\n```c\nstruct lpentry {\n    int<var> encoding;\n    optional byte[] content;\n    int<var> length;\n}\n```\n\u5143\u7d20\u7684\u7ed3\u6784\u548c ziplist \u7684\u5143\u7d20\u7ed3\u6784\u4e5f\u5f88\u7c7b\u4f3c\uff0c\u90fd\u662f\u5305\u542b\u4e09\u4e2a\u5b57\u6bb5\u3002\u4e0d\u540c\u7684\u662f\u957f\u5ea6\u5b57\u6bb5\u653e\u5728\u4e86\u5143\u7d20\u7684\u5c3e\u90e8\uff0c\u800c\u4e14\u5b58\u50a8\u7684\u4e0d\u662f\u4e0a\u4e00\u4e2a\u5143\u7d20\u7684\u957f\u5ea6\uff0c\u662f\u5f53\u524d\u5143\u7d20\u7684\u957f\u5ea6\u3002\u6b63\u662f\u56e0\u4e3a\u957f\u5ea6\u653e\u5728\u4e86\u5c3e\u90e8\uff0c\u6240\u4ee5\u53ef\u4ee5\u7701\u53bb\u4e86`zltail_offset`\u5b57\u6bb5\u6765\u6807\u8bb0\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u53ef\u4ee5\u901a\u8fc7`total_bytes`\u5b57\u6bb5\u548c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u957f\u5ea6\u5b57\u6bb5\u8ba1\u7b97\u51fa\u6765\u3002\n\n\u957f\u5ea6\u5b57\u6bb5\u4f7f\u7528 varint \u8fdb\u884c\u7f16\u7801\uff0c\u4e0d\u540c\u4e8e skiplist \u5143\u7d20\u957f\u5ea6\u7684\u7f16\u7801\u4e3a 1 \u4e2a\u5b57\u8282\u6216\u8005 5 \u4e2a\u5b57\u8282\uff0clistpack \u5143\u7d20\u957f\u5ea6\u7684\u7f16\u7801\u53ef\u4ee5\u662f 1\u30012\u30013\u30014\u30015 \u4e2a\u5b57\u8282\u3002\u540c UTF8 \u7f16\u7801\u4e00\u6837\uff0c\u5b83\u901a\u8fc7\u5b57\u8282\u7684\u6700\u9ad8\u4e3a\u662f\u5426\u4e3a 1 \u6765\u51b3\u5b9a\u7f16\u7801\u7684\u957f\u5ea6\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/29/164e4256399b6e4a?w=1286&h=618&f=png&s=40994)\n\n\u540c\u6837\uff0cRedis \u4e3a\u4e86\u8ba9 listpack \u5143\u7d20\u652f\u6301\u5f88\u591a\u7c7b\u578b\uff0c\u5b83\u5bf9 encoding \u5b57\u6bb5\u4e5f\u8fdb\u884c\u4e86\u8f83\u4e3a\u590d\u6742\u7684\u8bbe\u8ba1\u3002\n1. `0xxxxxxx` \u8868\u793a\u975e\u8d1f\u5c0f\u6574\u6570\uff0c\u53ef\u4ee5\u8868\u793a`0~127`\u3002\n2. `10xxxxxx` \u8868\u793a\u5c0f\u5b57\u7b26\u4e32\uff0c\u957f\u5ea6\u8303\u56f4\u662f`0~63`\uff0c`content`\u5b57\u6bb5\u4e3a\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u3002\n3. `110xxxxx yyyyyyyy` \u8868\u793a\u6709\u7b26\u53f7\u6574\u6570\uff0c\u8303\u56f4\u662f`-2048~2047`\u3002\n4. `1110xxxx yyyyyyyy` \u8868\u793a\u4e2d\u7b49\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\uff0c\u957f\u5ea6\u8303\u56f4\u662f`0~4095`\uff0c`content`\u5b57\u6bb5\u4e3a\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u3002\n5. `11110000 aaaaaaaa bbbbbbbb cccccccc dddddddd` \u8868\u793a\u5927\u5b57\u7b26\u4e32\uff0c\u56db\u4e2a\u5b57\u8282\u8868\u793a\u957f\u5ea6\uff0c`content`\u5b57\u6bb5\u4e3a\u5b57\u7b26\u4e32\u5185\u5bb9\u3002\n6. `11110001 aaaaaaaa bbbbbbbb` \u8868\u793a 2 \u5b57\u8282\u6709\u7b26\u53f7\u6574\u6570\u3002\n7. `11110010 aaaaaaaa bbbbbbbb cccccccc` \u8868\u793a 3 \u5b57\u8282\u6709\u7b26\u53f7\u6574\u6570\u3002\n8. `11110011 aaaaaaaa bbbbbbbb cccccccc dddddddd` \u8868\u793a 4 \u5b57\u8282\u6709\u7b26\u53f7\u6574\u6570\u3002\n9. `11110011 aaaaaaaa ... hhhhhhhh` \u8868\u793a 8 \u5b57\u8282\u6709\u7b26\u53f7\u6574\u6570\u3002\n10. `11111111` \u8868\u793a listpack \u7684\u7ed3\u675f\u7b26\u53f7\uff0c\u4e5f\u5c31\u662f`0xFF`\u3002\n\n## \u7ea7\u8054\u66f4\u65b0\n\nlistpack \u7684\u8bbe\u8ba1\u5f7b\u5e95\u6d88\u706d\u4e86 ziplist \u5b58\u5728\u7684\u7ea7\u8054\u66f4\u65b0\u884c\u4e3a\uff0c\u5143\u7d20\u4e0e\u5143\u7d20\u4e4b\u95f4\u5b8c\u5168\u72ec\u7acb\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u4e00\u4e2a\u5143\u7d20\u7684\u957f\u5ea6\u53d8\u957f\u5c31\u5bfc\u81f4\u540e\u7eed\u7684\u5143\u7d20\u5185\u5bb9\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\n\n## \u53d6\u4ee3 ziplist\n\nlistpack \u7684\u8bbe\u8ba1\u7684\u76ee\u7684\u662f\u7528\u6765\u53d6\u4ee3 ziplist\uff0c\u4e0d\u8fc7\u5f53\u4e0b\u8fd8\u6ca1\u6709\u505a\u597d\u66ff\u6362 ziplist \u7684\u51c6\u5907\uff0c\u56e0\u4e3a\u6709\u5f88\u591a\u517c\u5bb9\u6027\u7684\u95ee\u9898\u9700\u8981\u8003\u8651\uff0cziplist \u5728 Redis \u6570\u636e\u7ed3\u6784\u4e2d\u4f7f\u7528\u592a\u5e7f\u6cdb\u4e86\uff0c\u66ff\u6362\u8d77\u6765\u590d\u6742\u5ea6\u4f1a\u975e\u5e38\u4e4b\u9ad8\u3002\u5b83\u76ee\u524d\u53ea\u4f7f\u7528\u5728\u4e86\u65b0\u589e\u52a0\u7684 Stream \u6570\u636e\u7ed3\u6784\u4e2d\u3002\n\n## \u601d\u8003\n\n\u4e3a\u4ec0\u4e48 listpack \u6bd4 ziplist \u66f4\u52a0\u4f18\u79c0\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/38\u6e90\u7801_6\u7834\u65e7\u7acb\u65b0__\u63a2\u7d22\u7d27\u51d1\u5217\u8868\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.134", "order": 39}}, {"model": "subject.chapter", "pk": 42, "fields": {"title": "34\u6e90\u7801 2\uff1a\u5faa\u5e8f\u6e10\u8fdb \u2014\u2014 \u63a2\u7d22\u300c\u5b57\u5178\u300d\u5185\u90e8", "topic": 2, "md5": "491208a47a0fe7ec9bfbb8f0e0086f46", "md_body": "# \u6e90\u7801 2\uff1a\u5faa\u5e8f\u6e10\u8fdb \u2014\u2014 \u63a2\u7d22\u300c\u5b57\u5178\u300d\u5185\u90e8\n\ndict \u662f Redis \u670d\u52a1\u5668\u4e2d\u51fa\u73b0\u6700\u4e3a\u9891\u7e41\u7684\u590d\u5408\u578b\u6570\u636e\u7ed3\u6784\uff0c\u9664\u4e86 hash \u7ed3\u6784\u7684\u6570\u636e\u4f1a\u7528\u5230\u5b57\u5178\u5916\uff0c\u6574\u4e2a Redis \u6570\u636e\u5e93\u7684\u6240\u6709 key \u548c value \u4e5f\u7ec4\u6210\u4e86\u4e00\u4e2a\u5168\u5c40\u5b57\u5178\uff0c\u8fd8\u6709\u5e26\u8fc7\u671f\u65f6\u95f4\u7684 key \u96c6\u5408\u4e5f\u662f\u4e00\u4e2a\u5b57\u5178\u3002zset \u96c6\u5408\u4e2d\u5b58\u50a8 value \u548c score \u503c\u7684\u6620\u5c04\u5173\u7cfb\u4e5f\u662f\u901a\u8fc7 dict \u7ed3\u6784\u5b9e\u73b0\u7684\u3002\n```c\nstruct RedisDb {\n    dict* dict; // all keys  key=>value\n    dict* expires; // all expired keys key=>long(timestamp)\n    ...\n}\n\nstruct zset {\n    dict *dict; // all values  value=>score\n    zskiplist *zsl;\n}\n```\n\n## dict \u5185\u90e8\u7ed3\u6784\n\n![](https://user-gold-cdn.xitu.io/2018/7/28/164dc873b2a899a8?w=1566&h=430&f=png&s=54972)\ndict \u7ed3\u6784\u5185\u90e8\u5305\u542b\u4e24\u4e2a hashtable\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u53ea\u6709\u4e00\u4e2a hashtable \u662f\u6709\u503c\u7684\u3002\u4f46\u662f\u5728 dict \u6269\u5bb9\u7f29\u5bb9\u65f6\uff0c\u9700\u8981\u5206\u914d\u65b0\u7684 hashtable\uff0c\u7136\u540e\u8fdb\u884c\u6e10\u8fdb\u5f0f\u642c\u8fc1\uff0c\u8fd9\u65f6\u5019\u4e24\u4e2a hashtable \u5b58\u50a8\u7684\u5206\u522b\u662f\u65e7\u7684 hashtable \u548c\u65b0\u7684 hashtable\u3002\u5f85\u642c\u8fc1\u7ed3\u675f\u540e\uff0c\u65e7\u7684 hashtable \u88ab\u5220\u9664\uff0c\u65b0\u7684 hashtable \u53d6\u800c\u4ee3\u4e4b\u3002\n\n```c\nstruct dict {\n    ...\n    dictht ht[2];\n}\n```\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/28/164dcaac6cec3483?w=1244&h=644&f=png&s=74678)\n\n\u6240\u4ee5\uff0c\u5b57\u5178\u6570\u636e\u7ed3\u6784\u7684\u7cbe\u534e\u5c31\u843d\u5728\u4e86 hashtable \u7ed3\u6784\u4e0a\u4e86\u3002hashtable \u7684\u7ed3\u6784\u548c Java \u7684 HashMap \u51e0\u4e4e\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u901a\u8fc7\u5206\u6876\u7684\u65b9\u5f0f\u89e3\u51b3 hash \u51b2\u7a81\u3002\u7b2c\u4e00\u7ef4\u662f\u6570\u7ec4\uff0c\u7b2c\u4e8c\u7ef4\u662f\u94fe\u8868\u3002\u6570\u7ec4\u4e2d\u5b58\u50a8\u7684\u662f\u7b2c\u4e8c\u7ef4\u94fe\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u6307\u9488\u3002\n```c\nstruct dictEntry {\n    void* key;\n    void* val;\n    dictEntry* next; // \u94fe\u63a5\u4e0b\u4e00\u4e2a entry\n}\nstruct dictht {\n    dictEntry** table; // \u4e8c\u7ef4\n    long size; // \u7b2c\u4e00\u7ef4\u6570\u7ec4\u7684\u957f\u5ea6\n    long used; // hash \u8868\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\n    ...\n}\n```\n\n## \u6e10\u8fdb\u5f0frehash\n\u5927\u5b57\u5178\u7684\u6269\u5bb9\u662f\u6bd4\u8f83\u8017\u65f6\u95f4\u7684\uff0c\u9700\u8981\u91cd\u65b0\u7533\u8bf7\u65b0\u7684\u6570\u7ec4\uff0c\u7136\u540e\u5c06\u65e7\u5b57\u5178\u6240\u6709\u94fe\u8868\u4e2d\u7684\u5143\u7d20\u91cd\u65b0\u6302\u63a5\u5230\u65b0\u7684\u6570\u7ec4\u4e0b\u9762\uff0c\u8fd9\u662f\u4e00\u4e2aO(n)\u7ea7\u522b\u7684\u64cd\u4f5c\uff0c\u4f5c\u4e3a\u5355\u7ebf\u7a0b\u7684Redis\u8868\u793a\u5f88\u96be\u627f\u53d7\u8fd9\u6837\u8017\u65f6\u7684\u8fc7\u7a0b\u3002\u6b65\u5b50\u8fc8\u5927\u4e86\u4f1a\u626f\u7740\u86cb\uff0c\u6240\u4ee5Redis\u4f7f\u7528\u6e10\u8fdb\u5f0frehash\u5c0f\u6b65\u642c\u8fc1\u3002\u867d\u7136\u6162\u4e00\u70b9\uff0c\u4f46\u662f\u80af\u5b9a\u53ef\u4ee5\u642c\u5b8c\u3002\n\n```c\ndictEntry *dictAddRaw(dict *d, void *key, dictEntry **existing)\n{\n    long index;\n    dictEntry *entry;\n    dictht *ht;\n\n    // \u8fd9\u91cc\u8fdb\u884c\u5c0f\u6b65\u642c\u8fc1\n    if (dictIsRehashing(d)) _dictRehashStep(d);\n\n    /* Get the index of the new element, or -1 if\n     * the element already exists. */\n    if ((index = _dictKeyIndex(d, key, dictHashKey(d,key), existing)) == -1)\n        return NULL;\n\n    /* Allocate the memory and store the new entry.\n     * Insert the element in top, with the assumption that in a database\n     * system it is more likely that recently added entries are accessed\n     * more frequently. */\n    // \u5982\u679c\u5b57\u5178\u5904\u4e8e\u642c\u8fc1\u8fc7\u7a0b\u4e2d\uff0c\u8981\u5c06\u65b0\u7684\u5143\u7d20\u6302\u63a5\u5230\u65b0\u7684\u6570\u7ec4\u4e0b\u9762\n    ht = dictIsRehashing(d) ? &d->ht[1] : &d->ht[0];\n    entry = zmalloc(sizeof(*entry));\n    entry->next = ht->table[index];\n    ht->table[index] = entry;\n    ht->used++;\n\n    /* Set the hash entry fields. */\n    dictSetKey(d, entry, key);\n    return entry;\n}\n```\n\n\u642c\u8fc1\u64cd\u4f5c\u57cb\u4f0f\u5728\u5f53\u524d\u5b57\u5178\u7684\u540e\u7eed\u6307\u4ee4\u4e2d(\u6765\u81ea\u5ba2\u6237\u7aef\u7684hset/hdel\u6307\u4ee4\u7b49)\uff0c\u4f46\u662f\u6709\u53ef\u80fd\u5ba2\u6237\u7aef\u95f2\u4e0b\u6765\u4e86\uff0c\u6ca1\u6709\u4e86\u540e\u7eed\u6307\u4ee4\u6765\u89e6\u53d1\u8fd9\u4e2a\u642c\u8fc1\uff0c\u90a3\u4e48Redis\u5c31\u7f6e\u4e4b\u4e0d\u7406\u4e86\u4e48\uff1f\u5f53\u7136\u4e0d\u4f1a\uff0c\u4f18\u96c5\u7684Redis\u600e\u4e48\u53ef\u80fd\u8bbe\u8ba1\u7684\u8fd9\u6837\u6f66\u8349\u3002Redis\u8fd8\u4f1a\u5728\u5b9a\u65f6\u4efb\u52a1\u4e2d\u5bf9\u5b57\u5178\u8fdb\u884c\u4e3b\u52a8\u642c\u8fc1\u3002\n\n```c\n// \u670d\u52a1\u5668\u5b9a\u65f6\u4efb\u52a1\nvoid databaseCron() {\n    ...\n    if (server.activerehashing) {\n        for (j = 0; j < dbs_per_call; j++) {\n            int work_done = incrementallyRehash(rehash_db);\n            if (work_done) {\n                /* If the function did some work, stop here, we'll do\n                 * more at the next cron loop. */\n                break;\n            } else {\n                /* If this db didn't need rehash, we'll try the next one. */\n                rehash_db++;\n                rehash_db %= server.dbnum;\n            }\n        }\n    }\n}\n```\n\n## \u67e5\u627e\u8fc7\u7a0b\n\n\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u90fd\u4f9d\u8d56\u4e8e\u67e5\u627e\uff0c\u5148\u5fc5\u987b\u628a\u5143\u7d20\u627e\u5230\uff0c\u624d\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u7ed3\u6784\u7684\u4fee\u6539\u64cd\u4f5c\u3002hashtable \u7684\u5143\u7d20\u662f\u5728\u7b2c\u4e8c\u7ef4\u7684\u94fe\u8868\u4e0a\uff0c\u6240\u4ee5\u9996\u5148\u6211\u4eec\u5f97\u60f3\u529e\u6cd5\u5b9a\u4f4d\u51fa\u5143\u7d20\u5728\u54ea\u4e2a\u94fe\u8868\u4e0a\u3002\n```js\nfunc get(key) {\n    let index = hash_func(key) % size;\n    let entry = table[index];\n    while(entry != NULL) {\n        if entry.key == target {\n            return entry.value;\n        }\n        entry = entry.next;\n    }\n}\n```\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\u4ee3\u7801\u4e2d\u7684`hash_func`\uff0c\u5b83\u4f1a\u5c06 key \u6620\u5c04\u4e3a\u4e00\u4e2a\u6574\u6570\uff0c\u4e0d\u540c\u7684 key \u4f1a\u88ab\u6620\u5c04\u6210\u5206\u5e03\u6bd4\u8f83\u5747\u5300\u6563\u4e71\u7684\u6574\u6570\u3002\u53ea\u6709 hash \u503c\u5747\u5300\u4e86\uff0c\u6574\u4e2a hashtable \u624d\u662f\u5e73\u8861\u7684\uff0c\u6240\u6709\u7684\u4e8c\u7ef4\u94fe\u8868\u7684\u957f\u5ea6\u5c31\u4e0d\u4f1a\u5dee\u8ddd\u5f88\u8fdc\uff0c\u67e5\u627e\u7b97\u6cd5\u7684\u6027\u80fd\u4e5f\u5c31\u6bd4\u8f83\u7a33\u5b9a\u3002\n\n## hash \u51fd\u6570\n\nhashtable \u7684\u6027\u80fd\u597d\u4e0d\u597d\u5b8c\u5168\u53d6\u51b3\u4e8e hash \u51fd\u6570\u7684\u8d28\u91cf\u3002hash \u51fd\u6570\u5982\u679c\u53ef\u4ee5\u5c06 key \u6253\u6563\u7684\u6bd4\u8f83\u5747\u5300\uff0c\u90a3\u4e48\u8fd9\u4e2a hash \u51fd\u6570\u5c31\u662f\u4e2a\u597d\u51fd\u6570\u3002Redis \u7684\u5b57\u5178\u9ed8\u8ba4\u7684 hash \u51fd\u6570\u662f siphash\u3002siphash \u7b97\u6cd5\u5373\u4f7f\u5728\u8f93\u5165 key \u5f88\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u4ea7\u751f\u968f\u673a\u6027\u7279\u522b\u597d\u7684\u8f93\u51fa\uff0c\u800c\u4e14\u5b83\u7684\u6027\u80fd\u4e5f\u975e\u5e38\u7a81\u51fa\u3002\u5bf9\u4e8e Redis \u8fd9\u6837\u7684\u5355\u7ebf\u7a0b\u6765\u8bf4\uff0c\u5b57\u5178\u6570\u636e\u7ed3\u6784\u5982\u6b64\u666e\u904d\uff0c\u5b57\u5178\u64cd\u4f5c\u4e5f\u4f1a\u975e\u5e38\u9891\u7e41\uff0chash \u51fd\u6570\u81ea\u7136\u4e5f\u662f\u8d8a\u5feb\u8d8a\u597d\u3002\n\n## hash \u653b\u51fb\n\n\u5982\u679c hash \u51fd\u6570\u5b58\u5728\u504f\u5411\u6027\uff0c\u9ed1\u5ba2\u5c31\u53ef\u80fd\u5229\u7528\u8fd9\u79cd\u504f\u5411\u6027\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u653b\u51fb\u3002\u5b58\u5728\u504f\u5411\u6027\u7684 hash \u51fd\u6570\u5728\u7279\u5b9a\u6a21\u5f0f\u4e0b\u7684\u8f93\u5165\u4f1a\u5bfc\u81f4 hash \u7b2c\u4e8c\u7ef4\u94fe\u8868\u957f\u5ea6\u6781\u4e3a\u4e0d\u5747\u5300\uff0c\u751a\u81f3\u6240\u6709\u7684\u5143\u7d20\u90fd\u96c6\u4e2d\u5230\u4e2a\u522b\u94fe\u8868\u4e2d\uff0c\u76f4\u63a5\u5bfc\u81f4\u67e5\u627e\u6548\u7387\u6025\u5267\u4e0b\u964d\uff0c\u4ece`O(1)`\u9000\u5316\u5230`O(n)`\u3002\u6709\u9650\u7684\u670d\u52a1\u5668\u8ba1\u7b97\u80fd\u529b\u5c06\u4f1a\u88ab hashtable \u7684\u67e5\u627e\u6548\u7387\u5f7b\u5e95\u62d6\u57ae\u3002\u8fd9\u5c31\u662f\u6240\u8c13 hash \u653b\u51fb\u3002\n\n## \u6269\u5bb9\u6761\u4ef6\n```c\n/* Expand the hash table if needed */\nstatic int _dictExpandIfNeeded(dict *d)\n{\n    /* Incremental rehashing already in progress. Return. */\n    if (dictIsRehashing(d)) return DICT_OK;\n\n    /* If the hash table is empty expand it to the initial size. */\n    if (d->ht[0].size == 0) return dictExpand(d, DICT_HT_INITIAL_SIZE);\n\n    /* If we reached the 1:1 ratio, and we are allowed to resize the hash\n     * table (global setting) or we should avoid it but the ratio between\n     * elements/buckets is over the \"safe\" threshold, we resize doubling\n     * the number of buckets. */\n    if (d->ht[0].used >= d->ht[0].size &&\n        (dict_can_resize ||\n         d->ht[0].used/d->ht[0].size > dict_force_resize_ratio))\n    {\n        return dictExpand(d, d->ht[0].used*2);\n    }\n    return DICT_OK;\n}\n```\n\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u5f53 hash \u8868\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\u7b49\u4e8e\u7b2c\u4e00\u7ef4\u6570\u7ec4\u7684\u957f\u5ea6\u65f6\uff0c\u5c31\u4f1a\u5f00\u59cb\u6269\u5bb9\uff0c\u6269\u5bb9\u7684\u65b0\u6570\u7ec4\u662f\u539f\u6570\u7ec4\u5927\u5c0f\u7684 2 \u500d\u3002\u4e0d\u8fc7\u5982\u679c Redis \u6b63\u5728\u505a bgsave\uff0c\u4e3a\u4e86\u51cf\u5c11\u5185\u5b58\u9875\u7684\u8fc7\u591a\u5206\u79bb (Copy On Write)\uff0cRedis \u5c3d\u91cf\u4e0d\u53bb\u6269\u5bb9 (`dict_can_resize`)\uff0c\u4f46\u662f\u5982\u679c hash \u8868\u5df2\u7ecf\u975e\u5e38\u6ee1\u4e86\uff0c\u5143\u7d20\u7684\u4e2a\u6570\u5df2\u7ecf\u8fbe\u5230\u4e86\u7b2c\u4e00\u7ef4\u6570\u7ec4\u957f\u5ea6\u7684 5 \u500d (`dict_force_resize_ratio`)\uff0c\u8bf4\u660e hash \u8868\u5df2\u7ecf\u8fc7\u4e8e\u62e5\u6324\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u5f3a\u5236\u6269\u5bb9\u3002\n\n## \u7f29\u5bb9\u6761\u4ef6\n```c\nint htNeedsResize(dict *dict) {\n    long long size, used;\n\n    size = dictSlots(dict);\n    used = dictSize(dict);\n    return (size > DICT_HT_INITIAL_SIZE &&\n            (used*100/size < HASHTABLE_MIN_FILL));\n}\n```\n\u5f53 hash \u8868\u56e0\u4e3a\u5143\u7d20\u7684\u9010\u6e10\u5220\u9664\u53d8\u5f97\u8d8a\u6765\u8d8a\u7a00\u758f\u65f6\uff0cRedis \u4f1a\u5bf9 hash \u8868\u8fdb\u884c\u7f29\u5bb9\u6765\u51cf\u5c11 hash \u8868\u7684\u7b2c\u4e00\u7ef4\u6570\u7ec4\u7a7a\u95f4\u5360\u7528\u3002\u7f29\u5bb9\u7684\u6761\u4ef6\u662f\u5143\u7d20\u4e2a\u6570\u4f4e\u4e8e\u6570\u7ec4\u957f\u5ea6\u7684 10%\u3002\u7f29\u5bb9\u4e0d\u4f1a\u8003\u8651 Redis \u662f\u5426\u6b63\u5728\u505a bgsave\u3002\n\n## set \u7684\u7ed3\u6784\n\nRedis \u91cc\u9762 set \u7684\u7ed3\u6784\u5e95\u5c42\u5b9e\u73b0\u4e5f\u662f\u5b57\u5178\uff0c\u53ea\u4e0d\u8fc7\u6240\u6709\u7684 value \u90fd\u662f NULL\uff0c\u5176\u5b83\u7684\u7279\u6027\u548c\u5b57\u5178\u4e00\u6a21\u4e00\u6837\u3002\n\n## \u601d\u8003\n\n1. \u4e3a\u4ec0\u4e48\u7f29\u5bb9\u4e0d\u7528\u8003\u8651 bgsave\uff1f\n2. Java \u8bed\u8a00\u548c Python \u8bed\u8a00\u5185\u7f6e\u7684 set \u5bb9\u5668\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/34\u6e90\u7801_2\u5faa\u5e8f\u6e10\u8fdb__\u63a2\u7d22\u5b57\u5178\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.153", "order": 35}}, {"model": "subject.chapter", "pk": 43, "fields": {"title": "35\u6e90\u7801 3\uff1a\u6328\u80a9\u8fed\u80cc \u2014\u2014 \u63a2\u7d22\u300c\u538b\u7f29\u5217\u8868\u300d\u5185\u90e8", "topic": 2, "md5": "1a41edfb48ee558f73d8c5f0865d97fe", "md_body": "# \u6e90\u7801 3\uff1a\u6328\u80a9\u8fed\u80cc \u2014\u2014 \u63a2\u7d22\u300c\u538b\u7f29\u5217\u8868\u300d\u5185\u90e8\n\nRedis \u4e3a\u4e86\u8282\u7ea6\u5185\u5b58\u7a7a\u95f4\u4f7f\u7528\uff0czset \u548c hash \u5bb9\u5668\u5bf9\u8c61\u5728\u5143\u7d20\u4e2a\u6570\u8f83\u5c11\u7684\u65f6\u5019\uff0c\u91c7\u7528\u538b\u7f29\u5217\u8868 (ziplist) \u8fdb\u884c\u5b58\u50a8\u3002\u538b\u7f29\u5217\u8868\u662f\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5143\u7d20\u4e4b\u95f4\u7d27\u6328\u7740\u5b58\u50a8\uff0c\u6ca1\u6709\u4efb\u4f55\u5197\u4f59\u7a7a\u9699\u3002\n```\n> zadd programmings 1.0 go 2.0 python 3.0 java\n(integer) 3\n> debug object programmings\nValue at:0x7fec2de00020 refcount:1 encoding:ziplist serializedlength:36 lru:6022374 lru_seconds_idle:6\n> hmset books go fast python slow java fast\nOK\n> debug object books\nValue at:0x7fec2de000c0 refcount:1 encoding:ziplist serializedlength:48 lru:6022478 lru_seconds_idle:1\n```\n\u8fd9\u91cc\uff0c\u6ce8\u610f\u89c2\u5bdf debug object \u8f93\u51fa\u7684 encoding \u5b57\u6bb5\u90fd\u662f ziplist\uff0c\u8fd9\u5c31\u8868\u793a\u5185\u90e8\u91c7\u7528\u538b\u7f29\u5217\u8868\u7ed3\u6784\u8fdb\u884c\u5b58\u50a8\u3002\n```go\nstruct ziplist<T> {\n    int32 zlbytes; // \u6574\u4e2a\u538b\u7f29\u5217\u8868\u5360\u7528\u5b57\u8282\u6570\n    int32 zltail_offset; // \u6700\u540e\u4e00\u4e2a\u5143\u7d20\u8ddd\u79bb\u538b\u7f29\u5217\u8868\u8d77\u59cb\u4f4d\u7f6e\u7684\u504f\u79fb\u91cf\uff0c\u7528\u4e8e\u5feb\u901f\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u4e2a\u8282\u70b9\n    int16 zllength; // \u5143\u7d20\u4e2a\u6570\n    T[] entries; // \u5143\u7d20\u5185\u5bb9\u5217\u8868\uff0c\u6328\u4e2a\u6328\u4e2a\u7d27\u51d1\u5b58\u50a8\n    int8 zlend; // \u6807\u5fd7\u538b\u7f29\u5217\u8868\u7684\u7ed3\u675f\uff0c\u503c\u6052\u4e3a 0xFF\n}\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/28/164df01c1c7579e7?w=1512&h=354&f=png&s=50852)\n\n\u538b\u7f29\u5217\u8868\u4e3a\u4e86\u652f\u6301\u53cc\u5411\u904d\u5386\uff0c\u6240\u4ee5\u624d\u4f1a\u6709 `ztail_offset` \u8fd9\u4e2a\u5b57\u6bb5\uff0c\u7528\u6765\u5feb\u901f\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u7136\u540e\u5012\u7740\u904d\u5386\u3002\n\nentry \u5757\u968f\u7740\u5bb9\u7eb3\u7684\u5143\u7d20\u7c7b\u578b\u4e0d\u540c\uff0c\u4e5f\u4f1a\u6709\u4e0d\u4e00\u6837\u7684\u7ed3\u6784\u3002\n```c\nstruct entry {\n    int<var> prevlen; // \u524d\u4e00\u4e2a entry \u7684\u5b57\u8282\u957f\u5ea6\n    int<var> encoding; // \u5143\u7d20\u7c7b\u578b\u7f16\u7801\n    optional byte[] content; // \u5143\u7d20\u5185\u5bb9\n}\n```\n\u5b83\u7684 `prevlen` \u5b57\u6bb5\u8868\u793a\u524d\u4e00\u4e2a entry \u7684\u5b57\u8282\u957f\u5ea6\uff0c\u5f53\u538b\u7f29\u5217\u8868\u5012\u7740\u904d\u5386\u65f6\uff0c\u9700\u8981\u901a\u8fc7\u8fd9\u4e2a\u5b57\u6bb5\u6765\u5feb\u901f\u5b9a\u4f4d\u5230\u4e0b\u4e00\u4e2a\u5143\u7d20\u7684\u4f4d\u7f6e\u3002\u5b83\u662f\u4e00\u4e2a\u53d8\u957f\u7684\u6574\u6570\uff0c\u5f53\u5b57\u7b26\u4e32\u957f\u5ea6\u5c0f\u4e8e 254(0xFE) \u65f6\uff0c\u4f7f\u7528\u4e00\u4e2a\u5b57\u8282\u8868\u793a\uff1b\u5982\u679c\u8fbe\u5230\u6216\u8d85\u51fa 254(0xFE) \u90a3\u5c31\u4f7f\u7528 5 \u4e2a\u5b57\u8282\u6765\u8868\u793a\u3002\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f 0xFE(254)\uff0c\u5269\u4f59\u56db\u4e2a\u5b57\u8282\u8868\u793a\u5b57\u7b26\u4e32\u957f\u5ea6\u3002\u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97\u7528 5 \u4e2a\u5b57\u8282\u6765\u8868\u793a\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u662f\u4e0d\u662f\u592a\u6d6a\u8d39\u4e86\u3002\u6211\u4eec\u53ef\u4ee5\u7b97\u4e00\u4e0b\uff0c\u5f53\u5b57\u7b26\u4e32\u957f\u5ea6\u6bd4\u8f83\u957f\u7684\u65f6\u5019\uff0c\u5176\u5b9e 5 \u4e2a\u5b57\u8282\u4e5f\u53ea\u5360\u7528\u4e86\u4e0d\u5230`(5/(254+5))<2%`\u7684\u7a7a\u95f4\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/30/164ea7e76014e30c?w=891&h=182&f=png&s=21807)\n\n`encoding`\u5b57\u6bb5\u5b58\u50a8\u4e86\u5143\u7d20\u5185\u5bb9\u7684\u7f16\u7801\u7c7b\u578b\u4fe1\u606f\uff0cziplist \u901a\u8fc7\u8fd9\u4e2a\u5b57\u6bb5\u6765\u51b3\u5b9a\u540e\u9762\u7684 content \u5185\u5bb9\u7684\u5f62\u5f0f\u3002\n\nRedis \u4e3a\u4e86\u8282\u7ea6\u5b58\u50a8\u7a7a\u95f4\uff0c\u5bf9 encoding \u5b57\u6bb5\u8fdb\u884c\u4e86\u76f8\u5f53\u590d\u6742\u7684\u8bbe\u8ba1\u3002Redis \u901a\u8fc7\u8fd9\u4e2a\u5b57\u6bb5\u7684\u524d\u7f00\u4f4d\u6765\u8bc6\u522b\u5177\u4f53\u5b58\u50a8\u7684\u6570\u636e\u5f62\u5f0f\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b Redis \u662f\u5982\u4f55\u6839\u636e`encoding`\u7684\u524d\u7f00\u4f4d\u6765\u533a\u5206\u5185\u5bb9\u7684\uff1a\n\n1. `00xxxxxx` \u6700\u5927\u957f\u5ea6\u4f4d 63 \u7684\u77ed\u5b57\u7b26\u4e32\uff0c\u540e\u9762\u7684 6 \u4e2a\u4f4d\u5b58\u50a8\u5b57\u7b26\u4e32\u7684\u4f4d\u6570\uff0c\u5269\u4f59\u7684\u5b57\u8282\u5c31\u662f\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u3002\n2. `01xxxxxx xxxxxxxx` \u4e2d\u7b49\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\uff0c\u540e\u9762 14 \u4e2a\u4f4d\u6765\u8868\u793a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u5269\u4f59\u7684\u5b57\u8282\u5c31\u662f\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u3002\n3. `10000000 aaaaaaaa bbbbbbbb cccccccc dddddddd` \u7279\u5927\u5b57\u7b26\u4e32\uff0c\u9700\u8981\u4f7f\u7528\u989d\u5916 4 \u4e2a\u5b57\u8282\u6765\u8868\u793a\u957f\u5ea6\u3002\u7b2c\u4e00\u4e2a\u5b57\u8282\u524d\u7f00\u662f`10`\uff0c\u5269\u4f59 6 \u4f4d\u6ca1\u6709\u4f7f\u7528\uff0c\u7edf\u4e00\u7f6e\u4e3a\u96f6\u3002\u540e\u9762\u8ddf\u7740\u5b57\u7b26\u4e32\u5185\u5bb9\u3002\u4e0d\u8fc7\u8fd9\u6837\u7684\u5927\u5b57\u7b26\u4e32\u662f\u6ca1\u6709\u673a\u4f1a\u4f7f\u7528\u7684\uff0c\u538b\u7f29\u5217\u8868\u901a\u5e38\u53ea\u662f\u7528\u6765\u5b58\u50a8\u5c0f\u6570\u636e\u7684\u3002\n4. `11000000` \u8868\u793a int16\uff0c\u540e\u8ddf\u4e24\u4e2a\u5b57\u8282\u8868\u793a\u6574\u6570\u3002\n5. `11010000` \u8868\u793a int32\uff0c\u540e\u8ddf\u56db\u4e2a\u5b57\u8282\u8868\u793a\u6574\u6570\u3002\n6. `11100000` \u8868\u793a int64\uff0c\u540e\u8ddf\u516b\u4e2a\u5b57\u8282\u8868\u793a\u6574\u6570\u3002\n7. `11110000` \u8868\u793a int24\uff0c\u540e\u8ddf\u4e09\u4e2a\u5b57\u8282\u8868\u793a\u6574\u6570\u3002\n8. `11111110` \u8868\u793a int8\uff0c\u540e\u8ddf\u4e00\u4e2a\u5b57\u8282\u8868\u793a\u6574\u6570\u3002\n9. `11111111` \u8868\u793a ziplist \u7684\u7ed3\u675f\uff0c\u4e5f\u5c31\u662f zlend \u7684\u503c 0xFF\u3002\n9. `1111xxxx` \u8868\u793a\u6781\u5c0f\u6574\u6570\uff0cxxxx \u7684\u8303\u56f4\u53ea\u80fd\u662f (`0001~1101`), \u4e5f\u5c31\u662f`1~13`\uff0c\u56e0\u4e3a`0000\u30011110\u30011111`\u90fd\u88ab\u5360\u7528\u4e86\u3002\u8bfb\u53d6\u5230\u7684 value \u9700\u8981\u5c06 xxxx \u51cf 1\uff0c\u4e5f\u5c31\u662f\u6574\u6570`0~12`\u5c31\u662f\u6700\u7ec8\u7684 value\u3002\n\n\u6ce8\u610f\u5230 `content` \u5b57\u6bb5\u5728\u7ed3\u6784\u4f53\u4e2d\u5b9a\u4e49\u4e3a optional \u7c7b\u578b\uff0c\u8868\u793a\u8fd9\u4e2a\u5b57\u6bb5\u662f\u53ef\u9009\u7684\uff0c\u5bf9\u4e8e\u5f88\u5c0f\u7684\u6574\u6570\u800c\u8a00\uff0c\u5b83\u7684\u5185\u5bb9\u5df2\u7ecf\u5185\u8054\u5230 encoding \u5b57\u6bb5\u7684\u5c3e\u90e8\u4e86\u3002\n\n## \u589e\u52a0\u5143\u7d20\n\n\u56e0\u4e3a ziplist \u90fd\u662f\u7d27\u51d1\u5b58\u50a8\uff0c\u6ca1\u6709\u5197\u4f59\u7a7a\u95f4 (\u5bf9\u6bd4\u4e00\u4e0b Redis \u7684\u5b57\u7b26\u4e32\u7ed3\u6784)\u3002\u610f\u5473\u7740\u63d2\u5165\u4e00\u4e2a\u65b0\u7684\u5143\u7d20\u5c31\u9700\u8981\u8c03\u7528 realloc \u6269\u5c55\u5185\u5b58\u3002\u53d6\u51b3\u4e8e\u5185\u5b58\u5206\u914d\u5668\u7b97\u6cd5\u548c\u5f53\u524d\u7684 ziplist \u5185\u5b58\u5927\u5c0f\uff0crealloc \u53ef\u80fd\u4f1a\u91cd\u65b0\u5206\u914d\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5e76\u5c06\u4e4b\u524d\u7684\u5185\u5bb9\u4e00\u6b21\u6027\u62f7\u8d1d\u5230\u65b0\u7684\u5730\u5740\uff0c\u4e5f\u53ef\u80fd\u5728\u539f\u6709\u7684\u5730\u5740\u4e0a\u8fdb\u884c\u6269\u5c55\uff0c\u8fd9\u65f6\u5c31\u4e0d\u9700\u8981\u8fdb\u884c\u65e7\u5185\u5bb9\u7684\u5185\u5b58\u62f7\u8d1d\u3002\n\n\u5982\u679c ziplist \u5360\u636e\u5185\u5b58\u592a\u5927\uff0c\u91cd\u65b0\u5206\u914d\u5185\u5b58\u548c\u62f7\u8d1d\u5185\u5b58\u5c31\u4f1a\u6709\u5f88\u5927\u7684\u6d88\u8017\u3002\u6240\u4ee5 ziplist \u4e0d\u9002\u5408\u5b58\u50a8\u5927\u578b\u5b57\u7b26\u4e32\uff0c\u5b58\u50a8\u7684\u5143\u7d20\u4e5f\u4e0d\u5b9c\u8fc7\u591a\u3002\n\n## \u7ea7\u8054\u66f4\u65b0\n```c\n/* When an entry is inserted, we need to set the prevlen field of the next\n * entry to equal the length of the inserted entry. It can occur that this\n * length cannot be encoded in 1 byte and the next entry needs to be grow\n * a bit larger to hold the 5-byte encoded prevlen. This can be done for free,\n * because this only happens when an entry is already being inserted (which\n * causes a realloc and memmove). However, encoding the prevlen may require\n * that this entry is grown as well. This effect may cascade throughout\n * the ziplist when there are consecutive entries with a size close to\n * ZIP_BIG_PREVLEN, so we need to check that the prevlen can be encoded in\n * every consecutive entry.\n *\n * Note that this effect can also happen in reverse, where the bytes required\n * to encode the prevlen field can shrink. This effect is deliberately ignored,\n * because it can cause a \"flapping\" effect where a chain prevlen fields is\n * first grown and then shrunk again after consecutive inserts. Rather, the\n * field is allowed to stay larger than necessary, because a large prevlen\n * field implies the ziplist is holding large entries anyway.\n *\n * The pointer \"p\" points to the first entry that does NOT need to be\n * updated, i.e. consecutive fields MAY need an update. */\nunsigned char *__ziplistCascadeUpdate(unsigned char *zl, unsigned char *p) {\n    size_t curlen = intrev32ifbe(ZIPLIST_BYTES(zl)), rawlen, rawlensize;\n    size_t offset, noffset, extra;\n    unsigned char *np;\n    zlentry cur, next;\n\n    while (p[0] != ZIP_END) {\n        zipEntry(p, &cur);\n        rawlen = cur.headersize + cur.len;\n        rawlensize = zipStorePrevEntryLength(NULL,rawlen);\n\n        /* Abort if there is no next entry. */\n        if (p[rawlen] == ZIP_END) break;\n        zipEntry(p+rawlen, &next);\n\n        /* Abort when \"prevlen\" has not changed. */\n        // prevlen \u7684\u957f\u5ea6\u6ca1\u6709\u53d8\uff0c\u4e2d\u65ad\u7ea7\u8054\u66f4\u65b0\n        if (next.prevrawlen == rawlen) break;\n\n        if (next.prevrawlensize < rawlensize) {\n            /* The \"prevlen\" field of \"next\" needs more bytes to hold\n             * the raw length of \"cur\". */\n            // \u7ea7\u8054\u6269\u5c55\n            offset = p-zl;\n            extra = rawlensize-next.prevrawlensize;\n            // \u6269\u5927\u5185\u5b58\n            zl = ziplistResize(zl,curlen+extra);\n            p = zl+offset;\n\n            /* Current pointer and offset for next element. */\n            np = p+rawlen;\n            noffset = np-zl;\n\n            /* Update tail offset when next element is not the tail element. */\n            // \u66f4\u65b0 zltail_offset \u6307\u9488\n            if ((zl+intrev32ifbe(ZIPLIST_TAIL_OFFSET(zl))) != np) {\n                ZIPLIST_TAIL_OFFSET(zl) =\n                    intrev32ifbe(intrev32ifbe(ZIPLIST_TAIL_OFFSET(zl))+extra);\n            }\n\n            /* Move the tail to the back. */\n            // \u79fb\u52a8\u5185\u5b58\n            memmove(np+rawlensize,\n                np+next.prevrawlensize,\n                curlen-noffset-next.prevrawlensize-1);\n            zipStorePrevEntryLength(np,rawlen);\n\n            /* Advance the cursor */\n            p += rawlen;\n            curlen += extra;\n        } else {\n            if (next.prevrawlensize > rawlensize) {\n                /* This would result in shrinking, which we want to avoid.\n                 * So, set \"rawlen\" in the available bytes. */\n                // \u7ea7\u8054\u6536\u7f29\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u53ef\u4ee5\u4e0d\u7528\u6536\u7f29\u4e86\uff0c\u56e0\u4e3a 5 \u4e2a\u5b57\u8282\u4e5f\u662f\u53ef\u4ee5\u5b58\u50a8 1 \u4e2a\u5b57\u8282\u7684\u5185\u5bb9\u7684\n                // \u867d\u7136\u6709\u70b9\u6d6a\u8d39\uff0c\u4f46\u662f\u7ea7\u8054\u66f4\u65b0\u5b9e\u5728\u662f\u592a\u53ef\u6015\u4e86\uff0c\u6240\u4ee5\u6d6a\u8d39\u5c31\u6d6a\u8d39\u5427\n                zipStorePrevEntryLengthLarge(p+rawlen,rawlen);\n            } else {\n                // \u5927\u5c0f\u6ca1\u53d8\uff0c\u6539\u4e2a\u957f\u5ea6\u503c\u5c31\u5b8c\u4e8b\u4e86\n                zipStorePrevEntryLength(p+rawlen,rawlen);\n            }\n\n            /* Stop here, as the raw length of \"next\" has not changed. */\n            break;\n        }\n    }\n    return zl;\n}\n```\n\n\u524d\u9762\u63d0\u5230\u6bcf\u4e2a entry \u90fd\u4f1a\u6709\u4e00\u4e2a `prevlen` \u5b57\u6bb5\u5b58\u50a8\u524d\u4e00\u4e2a entry \u7684\u957f\u5ea6\u3002\u5982\u679c\u5185\u5bb9\u5c0f\u4e8e 254 \u5b57\u8282\uff0c`prevlen` \u7528 1 \u5b57\u8282\u5b58\u50a8\uff0c\u5426\u5219\u5c31\u662f 5 \u5b57\u8282\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u67d0\u4e2a entry \u7ecf\u8fc7\u4e86\u4fee\u6539\u64cd\u4f5c\u4ece 253 \u5b57\u8282\u53d8\u6210\u4e86 254 \u5b57\u8282\uff0c\u90a3\u4e48\u5b83\u7684\u4e0b\u4e00\u4e2a entry \u7684 `prevlen` \u5b57\u6bb5\u5c31\u8981\u66f4\u65b0\uff0c\u4ece 1 \u4e2a\u5b57\u8282\u6269\u5c55\u5230 5 \u4e2a\u5b57\u8282\uff1b\u5982\u679c\u8fd9\u4e2a entry \u7684\u957f\u5ea6\u672c\u6765\u4e5f\u662f 253 \u5b57\u8282\uff0c\u90a3\u4e48\u540e\u9762 entry \u7684 `prevlen` \u5b57\u6bb5\u8fd8\u5f97\u7ee7\u7eed\u66f4\u65b0\u3002\n\n\u5982\u679c ziplist \u91cc\u9762\u6bcf\u4e2a entry \u6070\u597d\u90fd\u5b58\u50a8\u4e86 253 \u5b57\u8282\u7684\u5185\u5bb9\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a entry \u5185\u5bb9\u7684\u4fee\u6539\u5c31\u4f1a\u5bfc\u81f4\u540e\u7eed\u6240\u6709 entry \u7684\u7ea7\u8054\u66f4\u65b0\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u6bd4\u8f83\u8017\u8d39\u8ba1\u7b97\u8d44\u6e90\u7684\u64cd\u4f5c\u3002\n\n\u5220\u9664\u4e2d\u95f4\u7684\u67d0\u4e2a\u8282\u70b9\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7ea7\u8054\u66f4\u65b0\uff0c\u8bfb\u8005\u53ef\u4ee5\u601d\u8003\u4e00\u4e0b\u4e3a\u4ec0\u4e48\uff1f\n\n## IntSet \u5c0f\u6574\u6570\u96c6\u5408\n\n\u5f53 set \u96c6\u5408\u5bb9\u7eb3\u7684\u5143\u7d20\u90fd\u662f\u6574\u6570\u5e76\u4e14\u5143\u7d20\u4e2a\u6570\u8f83\u5c0f\u65f6\uff0cRedis \u4f1a\u4f7f\u7528 `intset` \u6765\u5b58\u50a8\u7ed3\u5408\u5143\u7d20\u3002`intset` \u662f\u7d27\u51d1\u7684\u6570\u7ec4\u7ed3\u6784\uff0c\u540c\u65f6\u652f\u6301 16 \u4f4d\u300132 \u4f4d\u548c 64 \u4f4d\u6574\u6570\u3002\n```\nstruct intset<T> {\n    int32 encoding; // \u51b3\u5b9a\u6574\u6570\u4f4d\u5bbd\u662f 16 \u4f4d\u300132 \u4f4d\u8fd8\u662f 64 \u4f4d\n    int32 length; // \u5143\u7d20\u4e2a\u6570\n    int<T> contents; // \u6574\u6570\u6570\u7ec4\uff0c\u53ef\u4ee5\u662f 16 \u4f4d\u300132 \u4f4d\u548c 64 \u4f4d\n}\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/29/164e1a049ea6ea41?w=1472&h=230&f=png&s=32748)\n\u8001\u94b1\u4e5f\u4e0d\u662f\u5f88\u80fd\u7406\u89e3\u4e3a\u4ec0\u4e48 intset \u7684 encoding \u5b57\u6bb5\u548c length \u5b57\u6bb5\u4f7f\u7528 32 \u4f4d\u6574\u6570\u5b58\u50a8\u3002\u6bd5\u7adf\u5b83\u53ea\u662f\u7528\u6765\u5b58\u50a8\u5c0f\u6574\u6570\u7684\uff0c\u957f\u5ea6\u4e0d\u5e94\u8be5\u5f88\u957f\uff0c\u800c\u4e14 encoding \u53ea\u6709 16 \u4f4d\u300132 \u4f4d\u548c 64 \u4f4d\u4e09\u4e2a\u7c7b\u578b\uff0c\u7528\u4e00\u4e2a\u5b57\u8282\u5b58\u50a8\u5c31\u7ef0\u7ef0\u6709\u4f59\u3002\u5173\u4e8e\u8fd9\u70b9\uff0c\u8bfb\u8005\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8ba8\u8bba\u3002\n```\n> sadd codehole 1 2 3\n(integer) 3\n> debug object codehole\nValue at:0x7fec2dc2bde0 refcount:1 encoding:intset serializedlength:15 lru:6065795 lru_seconds_idle:4\n> sadd codehole go java python\n(integer) 3\n> debug object codehole\nValue at:0x7fec2dc2bde0 refcount:1 encoding:hashtable serializedlength:22 lru:6065810 lru_seconds_idle:5\n```\n\u6ce8\u610f\u89c2\u5bdf debug object \u7684\u8f93\u51fa\u5b57\u6bb5 encoding \u7684\u503c\uff0c\u53ef\u4ee5\u53d1\u73b0\u5f53 set \u91cc\u9762\u653e\u8fdb\u53bb\u4e86\u975e\u6574\u6570\u503c\u65f6\uff0c\u5b58\u50a8\u5f62\u5f0f\u7acb\u5373\u4ece intset \u8f6c\u53d8\u6210\u4e86 hash \u7ed3\u6784\u3002\n\n## \u601d\u8003\n1. \u4e3a\u4ec0\u4e48 set \u96c6\u5408\u5728\u6570\u91cf\u5f88\u5c0f\u7684\u65f6\u5019\u4e0d\u4f7f\u7528 ziplist \u6765\u5b58\u50a8\uff1f\n2. \u6267\u884c`rpush codehole 1 2 3`\u547d\u4ee4\u540e\uff0c\u8bf7\u5199\u51fa\u5217\u8868\u5185\u5bb9\u7684 16 \u8fdb\u5236\u5f62\u5f0f\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/35\u6e90\u7801_3\u6328\u80a9\u8fed\u80cc__\u63a2\u7d22\u538b\u7f29\u5217\u8868\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.171", "order": 36}}, {"model": "subject.chapter", "pk": 44, "fields": {"title": "36\u6e90\u7801 4\uff1a\u98ce\u9a70\u7535\u63a3 \u2014\u2014 \u63a2\u7d22\u300c\u5feb\u901f\u5217\u8868\u300d\u5185\u90e8", "topic": 2, "md5": "5115b48324caafb79f45d76854347371", "md_body": "# \u6e90\u7801 4\uff1a\u98ce\u9a70\u7535\u63a3 \u2014\u2014 \u63a2\u7d22\u300c\u5feb\u901f\u5217\u8868\u300d\u5185\u90e8\n\nRedis \u65e9\u671f\u7248\u672c\u5b58\u50a8 list \u5217\u8868\u6570\u636e\u7ed3\u6784\u4f7f\u7528\u7684\u662f\u538b\u7f29\u5217\u8868 ziplist \u548c\u666e\u901a\u7684\u53cc\u5411\u94fe\u8868 linkedlist\uff0c\u4e5f\u5c31\u662f\u5143\u7d20\u5c11\u65f6\u7528 ziplist\uff0c\u5143\u7d20\u591a\u65f6\u7528 linkedlist\u3002\n\n```c\n// \u94fe\u8868\u7684\u8282\u70b9\nstruct listNode<T> {\n    listNode* prev;\n    listNode* next;\n    T value;\n}\n// \u94fe\u8868\nstruct list {\n    listNode *head;\n    listNode *tail;\n    long length;\n}\n```\n\u8003\u8651\u5230\u94fe\u8868\u7684\u9644\u52a0\u7a7a\u95f4\u76f8\u5bf9\u592a\u9ad8\uff0cprev \u548c next \u6307\u9488\u5c31\u8981\u5360\u53bb 16 \u4e2a\u5b57\u8282 (64bit \u7cfb\u7edf\u7684\u6307\u9488\u662f 8 \u4e2a\u5b57\u8282)\uff0c\u53e6\u5916\u6bcf\u4e2a\u8282\u70b9\u7684\u5185\u5b58\u90fd\u662f\u5355\u72ec\u5206\u914d\uff0c\u4f1a\u52a0\u5267\u5185\u5b58\u7684\u788e\u7247\u5316\uff0c\u5f71\u54cd\u5185\u5b58\u7ba1\u7406\u6548\u7387\u3002\u540e\u7eed\u7248\u672c\u5bf9\u5217\u8868\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u4e86\u6539\u9020\uff0c\u4f7f\u7528 quicklist \u4ee3\u66ff\u4e86 ziplist \u548c linkedlist\u3002\n```\n> rpush codehole go java python\n(integer) 3\n> debug object codehole\nValue at:0x7fec2dc2bde0 refcount:1 encoding:quicklist serializedlength:31 lru:6101643 lru_seconds_idle:5 ql_nodes:1 ql_avg_node:3.00 ql_ziplist_max:-2 ql_compressed:0 ql_uncompressed_size:29\n```\n\u6ce8\u610f\u89c2\u5bdf\u4e0a\u9762\u8f93\u51fa\u5b57\u6bb5 encoding \u7684\u503c\u3002quicklist \u662f ziplist \u548c linkedlist \u7684\u6df7\u5408\u4f53\uff0c\u5b83\u5c06 linkedlist \u6309\u6bb5\u5207\u5206\uff0c\u6bcf\u4e00\u6bb5\u4f7f\u7528 ziplist \u6765\u7d27\u51d1\u5b58\u50a8\uff0c\u591a\u4e2a ziplist \u4e4b\u95f4\u4f7f\u7528\u53cc\u5411\u6307\u9488\u4e32\u63a5\u8d77\u6765\u3002\n![](https://user-gold-cdn.xitu.io/2018/7/29/164e3b0b953f2fc7?w=1510&h=542&f=png&s=64217)\n```c\nstruct ziplist {\n    ...\n}\nstruct ziplist_compressed {\n    int32 size;\n    byte[] compressed_data;\n}\nstruct quicklistNode {\n    quicklistNode* prev;\n    quicklistNode* next;\n    ziplist* zl; // \u6307\u5411\u538b\u7f29\u5217\u8868\n    int32 size; // ziplist \u7684\u5b57\u8282\u603b\u6570\n    int16 count; // ziplist \u4e2d\u7684\u5143\u7d20\u6570\u91cf\n    int2 encoding; // \u5b58\u50a8\u5f62\u5f0f 2bit\uff0c\u539f\u751f\u5b57\u8282\u6570\u7ec4\u8fd8\u662f LZF \u538b\u7f29\u5b58\u50a8\n    ...\n}\nstruct quicklist {\n    quicklistNode* head;\n    quicklistNode* tail;\n    long count; // \u5143\u7d20\u603b\u6570\n    int nodes; // ziplist \u8282\u70b9\u7684\u4e2a\u6570\n    int compressDepth; // LZF \u7b97\u6cd5\u538b\u7f29\u6df1\u5ea6\n    ...\n}\n```\n\u4e0a\u8ff0\u4ee3\u7801\u7b80\u5355\u5730\u8868\u793a\u4e86 quicklist \u7684\u5927\u81f4\u7ed3\u6784\u3002\u4e3a\u4e86\u8fdb\u4e00\u6b65\u8282\u7ea6\u7a7a\u95f4\uff0cRedis \u8fd8\u4f1a\u5bf9 ziplist \u8fdb\u884c\u538b\u7f29\u5b58\u50a8\uff0c\u4f7f\u7528 LZF \u7b97\u6cd5\u538b\u7f29\uff0c\u53ef\u4ee5\u9009\u62e9\u538b\u7f29\u6df1\u5ea6\u3002\n\n## \u6bcf\u4e2a ziplist \u5b58\u591a\u5c11\u5143\u7d20\uff1f\n\nquicklist \u5185\u90e8\u9ed8\u8ba4\u5355\u4e2a ziplist \u957f\u5ea6\u4e3a 8k \u5b57\u8282\uff0c\u8d85\u51fa\u4e86\u8fd9\u4e2a\u5b57\u8282\u6570\uff0c\u5c31\u4f1a\u65b0\u8d77\u4e00\u4e2a ziplist\u3002ziplist \u7684\u957f\u5ea6\u7531\u914d\u7f6e\u53c2\u6570`list-max-ziplist-size`\u51b3\u5b9a\u3002\n```\n# Lists are also encoded in a special way to save a lot of space.\n# The number of entries allowed per internal list node can be specified\n# as a fixed maximum size or a maximum number of elements.\n# For a fixed maximum size, use -5 through -1, meaning:\n# -5: max size: 64 Kb  <-- not recommended for normal workloads\n# -4: max size: 32 Kb  <-- not recommended\n# -3: max size: 16 Kb  <-- probably not recommended\n# -2: max size: 8 Kb   <-- good\n# -1: max size: 4 Kb   <-- good\n# Positive numbers mean store up to _exactly_ that number of elements\n# per list node.\n# The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),\n# but if your use case is unique, adjust the settings as necessary.\nlist-max-ziplist-size -2\n```\n\n## \u538b\u7f29\u6df1\u5ea6\n\n![](https://user-gold-cdn.xitu.io/2018/7/29/164e3d168aa62cc9?w=1348&h=532&f=png&s=73235)\n\nquicklist \u9ed8\u8ba4\u7684\u538b\u7f29\u6df1\u5ea6\u662f 0\uff0c\u4e5f\u5c31\u662f\u4e0d\u538b\u7f29\u3002\u538b\u7f29\u7684\u5b9e\u9645\u6df1\u5ea6\u7531\u914d\u7f6e\u53c2\u6570`list-compress-depth`\u51b3\u5b9a\u3002\u4e3a\u4e86\u652f\u6301\u5feb\u901f\u7684 push/pop \u64cd\u4f5c\uff0cquicklist \u7684\u9996\u5c3e\u4e24\u4e2a ziplist \u4e0d\u538b\u7f29\uff0c\u6b64\u65f6\u6df1\u5ea6\u5c31\u662f 1\u3002\u5982\u679c\u6df1\u5ea6\u4e3a 2\uff0c\u5c31\u8868\u793a quicklist \u7684\u9996\u5c3e\u7b2c\u4e00\u4e2a ziplist \u4ee5\u53ca\u9996\u5c3e\u7b2c\u4e8c\u4e2a ziplist \u90fd\u4e0d\u538b\u7f29\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n- [\u300aziplist\u3001linkedlist \u548c quicklist \u7684\u6027\u80fd\u5bf9\u6bd4\u300b](https://matt.sh/redis-quicklist)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/36\u6e90\u7801_4\u98ce\u9a70\u7535\u63a3__\u63a2\u7d22\u5feb\u901f\u5217\u8868\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.189", "order": 37}}, {"model": "subject.chapter", "pk": 45, "fields": {"title": "37\u6e90\u7801 5\uff1a\u51cc\u6ce2\u5fae\u6b65 \u2014\u2014 \u63a2\u7d22\u300c\u8df3\u8dc3\u5217\u8868\u300d\u5185\u90e8", "topic": 2, "md5": "9598b026ee4ea92561959c5d388a386d", "md_body": "# \u6e90\u7801 5\uff1a\u51cc\u6ce2\u5fae\u6b65 \u2014\u2014 \u63a2\u7d22\u300c\u8df3\u8dc3\u5217\u8868\u300d\u5185\u90e8\u7ed3\u6784\n\nRedis \u7684 zset \u662f\u4e00\u4e2a\u590d\u5408\u7ed3\u6784\uff0c\u4e00\u65b9\u9762\u5b83\u9700\u8981\u4e00\u4e2a hash \u7ed3\u6784\u6765\u5b58\u50a8 value \u548c score \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u53e6\u4e00\u65b9\u9762\u9700\u8981\u63d0\u4f9b\u6309\u7167 score \u6765\u6392\u5e8f\u7684\u529f\u80fd\uff0c\u8fd8\u9700\u8981\u80fd\u591f\u6307\u5b9a score \u7684\u8303\u56f4\u6765\u83b7\u53d6 value \u5217\u8868\u7684\u529f\u80fd\uff0c\u8fd9\u5c31\u9700\u8981\u53e6\u5916\u4e00\u4e2a\u7ed3\u6784\u300c\u8df3\u8dc3\u5217\u8868\u300d\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/27/164d9cd9064b556e?w=338&h=152&f=png&s=9604)\n\nzset \u7684\u5185\u90e8\u5b9e\u73b0\u662f\u4e00\u4e2a hash \u5b57\u5178\u52a0\u4e00\u4e2a\u8df3\u8dc3\u5217\u8868 (skiplist)\u3002hash \u7ed3\u6784\u5728\u8bb2\u5b57\u5178\u7ed3\u6784\u65f6\u5df2\u7ecf\u8be6\u7ec6\u5206\u6790\u8fc7\u4e86\uff0c\u5b83\u5f88\u7c7b\u4f3c\u4e8e Java \u8bed\u8a00\u4e2d\u7684 HashMap \u7ed3\u6784\u3002\u672c\u8282\u6211\u4eec\u6765\u8bb2\u8df3\u8dc3\u5217\u8868\uff0c\u5b83\u6bd4\u8f83\u590d\u6742\uff0c\u8bfb\u8005\u8981\u6709\u5fc3\u7406\u51c6\u5907\u3002\n\n## \u57fa\u672c\u7ed3\u6784\n\n![](https://user-gold-cdn.xitu.io/2018/7/27/164d9f96ed4e1a0d?w=1457&h=273&f=png&s=24714)\n\n\u4e0a\u56fe\u5c31\u662f\u8df3\u8dc3\u5217\u8868\u7684\u793a\u610f\u56fe\uff0c\u56fe\u4e2d\u53ea\u753b\u4e86\u56db\u5c42\uff0cRedis \u7684\u8df3\u8dc3\u8868\u5171\u6709 64 \u5c42\uff0c\u5bb9\u7eb3 2^64 \u4e2a\u5143\u7d20\u5e94\u8be5\u4e0d\u6210\u95ee\u9898\u3002\u6bcf\u4e00\u4e2a kv \u5757\u5bf9\u5e94\u7684\u7ed3\u6784\u5982\u4e0b\u9762\u7684\u4ee3\u7801\u4e2d\u7684`zslnode`\u7ed3\u6784\uff0ckv header \u4e5f\u662f\u8fd9\u4e2a\u7ed3\u6784\uff0c\u53ea\u4e0d\u8fc7 value \u5b57\u6bb5\u662f null \u503c\u2014\u2014\u65e0\u6548\u7684\uff0cscore \u662f Double.MIN_VALUE\uff0c\u7528\u6765\u57ab\u5e95\u7684\u3002kv \u4e4b\u95f4\u4f7f\u7528\u6307\u9488\u4e32\u8d77\u6765\u5f62\u6210\u4e86\u53cc\u5411\u94fe\u8868\u7ed3\u6784\uff0c\u5b83\u4eec\u662f **\u6709\u5e8f** \u6392\u5217\u7684\uff0c\u4ece\u5c0f\u5230\u5927\u3002\u4e0d\u540c\u7684 kv \u5c42\u9ad8\u53ef\u80fd\u4e0d\u4e00\u6837\uff0c\u5c42\u6570\u8d8a\u9ad8\u7684 kv \u8d8a\u5c11\u3002\u540c\u4e00\u5c42\u7684 kv \u4f1a\u4f7f\u7528\u6307\u9488\u4e32\u8d77\u6765\u3002\u6bcf\u4e00\u4e2a\u5c42\u5143\u7d20\u7684\u904d\u5386\u90fd\u662f\u4ece kv header \u51fa\u53d1\u3002\n\n```c\nstruct zslnode {\n  string value;\n  double score;\n  zslnode*[] forwards;  // \u591a\u5c42\u8fde\u63a5\u6307\u9488\n  zslnode* backward;  // \u56de\u6eaf\u6307\u9488\n}\n\nstruct zsl {\n  zslnode* header; // \u8df3\u8dc3\u5217\u8868\u5934\u6307\u9488\n  int maxLevel; // \u8df3\u8dc3\u5217\u8868\u5f53\u524d\u7684\u6700\u9ad8\u5c42\n  map<string, zslnode*> ht; // hash \u7ed3\u6784\u7684\u6240\u6709\u952e\u503c\u5bf9\n}\n```\n\n## \u67e5\u627e\u8fc7\u7a0b\n\n\u8bbe\u60f3\u5982\u679c\u8df3\u8dc3\u5217\u8868\u53ea\u6709\u4e00\u5c42\u4f1a\u600e\u6837\uff1f\u63d2\u5165\u5220\u9664\u64cd\u4f5c\u9700\u8981\u5b9a\u4f4d\u5230\u76f8\u5e94\u7684\u4f4d\u7f6e\u8282\u70b9 (\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u4e2a\u6bd4\u300c\u6211\u300d\u5c0f\u7684\u5143\u7d20\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u4e2a\u6bd4\u300c\u6211\u300d\u5927\u7684\u5143\u7d20\u7684\u524d\u4e00\u4e2a)\uff0c\u5b9a\u4f4d\u7684\u6548\u7387\u80af\u5b9a\u6bd4\u8f83\u5dee\uff0c\u590d\u6742\u5ea6\u5c06\u4f1a\u662f O(n)\uff0c\u56e0\u4e3a\u9700\u8981\u6328\u4e2a\u904d\u5386\u3002\u4e5f\u8bb8\u4f60\u4f1a\u60f3\u5230\u4e8c\u5206\u67e5\u627e\uff0c\u4f46\u662f\u4e8c\u5206\u67e5\u627e\u7684\u7ed3\u6784\u53ea\u80fd\u662f\u6709\u5e8f\u6570\u7ec4\u3002\u8df3\u8dc3\u5217\u8868\u6709\u4e86\u591a\u5c42\u7ed3\u6784\u4e4b\u540e\uff0c\u8fd9\u4e2a\u5b9a\u4f4d\u7684\u7b97\u6cd5\u590d\u6742\u5ea6\u5c06\u4f1a\u964d\u5230 O(lg(n))\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/27/164dc52ae7e6444c?w=1912&h=662&f=png&s=119691)\n\n\u5982\u56fe\u6240\u793a\uff0c\u6211\u4eec\u8981\u5b9a\u4f4d\u5230\u90a3\u4e2a\u7d2b\u8272\u7684 kv\uff0c\u9700\u8981\u4ece header \u7684\u6700\u9ad8\u5c42\u5f00\u59cb\u904d\u5386\u627e\u5230\u7b2c\u4e00\u4e2a\u8282\u70b9 (\u6700\u540e\u4e00\u4e2a\u6bd4\u300c\u6211\u300d\u5c0f\u7684\u5143\u7d20)\uff0c\u7136\u540e\u4ece\u8fd9\u4e2a\u8282\u70b9\u5f00\u59cb\u964d\u4e00\u5c42\u518d\u904d\u5386\u627e\u5230\u7b2c\u4e8c\u4e2a\u8282\u70b9 (\u6700\u540e\u4e00\u4e2a\u6bd4\u300c\u6211\u300d\u5c0f\u7684\u5143\u7d20)\uff0c\u7136\u540e\u4e00\u76f4\u964d\u5230\u6700\u5e95\u5c42\u8fdb\u884c\u904d\u5386\u5c31\u627e\u5230\u4e86\u671f\u671b\u7684\u8282\u70b9 (\u6700\u5e95\u5c42\u7684\u6700\u540e\u4e00\u4e2a\u6bd4\u6211\u300c\u5c0f\u300d\u7684\u5143\u7d20)\u3002\n\n\u6211\u4eec\u5c06\u4e2d\u95f4\u7ecf\u8fc7\u7684\u4e00\u7cfb\u5217\u8282\u70b9\u79f0\u4e4b\u4e3a\u300c\u641c\u7d22\u8def\u5f84\u300d\uff0c\u5b83\u662f\u4ece\u6700\u9ad8\u5c42\u4e00\u76f4\u5230\u6700\u5e95\u5c42\u7684\u6bcf\u4e00\u5c42\u6700\u540e\u4e00\u4e2a\u6bd4\u300c\u6211\u300d\u5c0f\u7684\u5143\u7d20\u8282\u70b9\u5217\u8868\u3002\n\n\u6709\u4e86\u8fd9\u4e2a\u641c\u7d22\u8def\u5f84\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u63d2\u5165\u8fd9\u4e2a\u65b0\u8282\u70b9\u4e86\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u63d2\u5165\u8fc7\u7a0b\u4e5f\u4e0d\u662f\u7279\u522b\u7b80\u5355\u3002\u56e0\u4e3a\u65b0\u63d2\u5165\u7684\u8282\u70b9\u5230\u5e95\u6709\u591a\u5c11\u5c42\uff0c\u5f97\u6709\u4e2a\u7b97\u6cd5\u6765\u5206\u914d\u4e00\u4e0b\uff0c\u8df3\u8dc3\u5217\u8868\u4f7f\u7528\u7684\u662f\u968f\u673a\u7b97\u6cd5\u3002\n\n## \u968f\u673a\u5c42\u6570\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u65b0\u63d2\u5165\u7684\u8282\u70b9\uff0c\u90fd\u9700\u8981\u8c03\u7528\u4e00\u4e2a\u968f\u673a\u7b97\u6cd5\u7ed9\u5b83\u5206\u914d\u4e00\u4e2a\u5408\u7406\u7684\u5c42\u6570\u3002\u76f4\u89c2\u4e0a\u671f\u671b\u7684\u76ee\u6807\u662f 50% \u7684 Level1\uff0c25% \u7684 Level2\uff0c12.5% \u7684 Level3\uff0c\u4e00\u76f4\u5230\u6700\u9876\u5c42`2^-63`\uff0c\u56e0\u4e3a\u8fd9\u91cc\u6bcf\u4e00\u5c42\u7684\u664b\u5347\u6982\u7387\u662f 50%\u3002\n\n```c\n/* Returns a random level for the new skiplist node we are going to create.\n * The return value of this function is between 1 and ZSKIPLIST_MAXLEVEL\n * (both inclusive), with a powerlaw-alike distribution where higher\n * levels are less likely to be returned. */\nint zslRandomLevel(void) {\n    int level = 1;\n    while ((random()&0xFFFF) < (ZSKIPLIST_P * 0xFFFF))\n        level += 1;\n    return (level<ZSKIPLIST_MAXLEVEL) ? level : ZSKIPLIST_MAXLEVEL;\n}\n```\n\u4e0d\u8fc7 Redis \u6807\u51c6\u6e90\u7801\u4e2d\u7684\u664b\u5347\u6982\u7387\u53ea\u6709 25%\uff0c\u4e5f\u5c31\u662f\u4ee3\u7801\u4e2d\u7684 ZSKIPLIST_P \u7684\u503c\u3002\u6240\u4ee5\u5b98\u65b9\u7684\u8df3\u8dc3\u5217\u8868\u66f4\u52a0\u7684\u6241\u5e73\u5316\uff0c\u5c42\u9ad8\u76f8\u5bf9\u8f83\u4f4e\uff0c\u5728\u5355\u4e2a\u5c42\u4e0a\u9700\u8981\u904d\u5386\u7684\u8282\u70b9\u6570\u91cf\u4f1a\u7a0d\u591a\u4e00\u70b9\u3002\n\n\u4e5f\u6b63\u662f\u56e0\u4e3a\u5c42\u6570\u4e00\u822c\u4e0d\u9ad8\uff0c\u6240\u4ee5\u904d\u5386\u7684\u65f6\u5019\u4ece\u9876\u5c42\u5f00\u59cb\u5f80\u4e0b\u904d\u5386\u4f1a\u975e\u5e38\u6d6a\u8d39\u3002\u8df3\u8dc3\u5217\u8868\u4f1a\u8bb0\u5f55\u4e00\u4e0b\u5f53\u524d\u7684\u6700\u9ad8\u5c42\u6570`maxLevel`\uff0c\u904d\u5386\u65f6\u4ece\u8fd9\u4e2a maxLevel \u5f00\u59cb\u904d\u5386\u6027\u80fd\u5c31\u4f1a\u63d0\u9ad8\u5f88\u591a\u3002\n\n## \u63d2\u5165\u8fc7\u7a0b\n\u4e0b\u9762\u662f\u63d2\u5165\u8fc7\u7a0b\u7684\u6e90\u7801\uff0c\u5b83\u7a0d\u5fae\u6709\u70b9\u957f\uff0c\u4e0d\u8fc7\u6574\u4f53\u7684\u8fc7\u7a0b\u8fd8\u662f\u6bd4\u8f83\u6e05\u6670\u7684\u3002\n```c\n/* Insert a new node in the skiplist. Assumes the element does not already\n * exist (up to the caller to enforce that). The skiplist takes ownership\n * of the passed SDS string 'ele'. */\nzskiplistNode *zslInsert(zskiplist *zsl, double score, sds ele) {\n    // \u5b58\u50a8\u641c\u7d22\u8def\u5f84\n    zskiplistNode *update[ZSKIPLIST_MAXLEVEL], *x;\n    // \u5b58\u50a8\u7ecf\u8fc7\u7684\u8282\u70b9\u8de8\u5ea6\n    unsigned int rank[ZSKIPLIST_MAXLEVEL];\n    int i, level;\n\n    serverAssert(!isnan(score));\n    x = zsl->header;\n    // \u9010\u6b65\u964d\u7ea7\u5bfb\u627e\u76ee\u6807\u8282\u70b9\uff0c\u5f97\u5230\u300c\u641c\u7d22\u8def\u5f84\u300d\n    for (i = zsl->level-1; i >= 0; i--) {\n        /* store rank that is crossed to reach the insert position */\n        rank[i] = i == (zsl->level-1) ? 0 : rank[i+1];\n        // \u5982\u679cscore\u76f8\u7b49\uff0c\u8fd8\u9700\u8981\u6bd4\u8f83value\n        while (x->level[i].forward &&\n                (x->level[i].forward->score < score ||\n                    (x->level[i].forward->score == score &&\n                    sdscmp(x->level[i].forward->ele,ele) < 0)))\n        {\n            rank[i] += x->level[i].span;\n            x = x->level[i].forward;\n        }\n        update[i] = x;\n    }\n    // \u6b63\u5f0f\u8fdb\u5165\u63d2\u5165\u8fc7\u7a0b\n    /* we assume the element is not already inside, since we allow duplicated\n     * scores, reinserting the same element should never happen since the\n     * caller of zslInsert() should test in the hash table if the element is\n     * already inside or not. */\n    // \u968f\u673a\u4e00\u4e2a\u5c42\u6570\n    level = zslRandomLevel();\n    // \u586b\u5145\u8de8\u5ea6\n    if (level > zsl->level) {\n        for (i = zsl->level; i < level; i++) {\n            rank[i] = 0;\n            update[i] = zsl->header;\n            update[i]->level[i].span = zsl->length;\n        }\n        // \u66f4\u65b0\u8df3\u8dc3\u5217\u8868\u7684\u5c42\u9ad8\n        zsl->level = level;\n    }\n    // \u521b\u5efa\u65b0\u8282\u70b9\n    x = zslCreateNode(level,score,ele);\n    // \u91cd\u6392\u4e00\u4e0b\u524d\u5411\u6307\u9488\n    for (i = 0; i < level; i++) {\n        x->level[i].forward = update[i]->level[i].forward;\n        update[i]->level[i].forward = x;\n\n        /* update span covered by update[i] as x is inserted here */\n        x->level[i].span = update[i]->level[i].span - (rank[0] - rank[i]);\n        update[i]->level[i].span = (rank[0] - rank[i]) + 1;\n    }\n\n    /* increment span for untouched levels */\n    for (i = level; i < zsl->level; i++) {\n        update[i]->level[i].span++;\n    }\n    // \u91cd\u6392\u4e00\u4e0b\u540e\u5411\u6307\u9488\n    x->backward = (update[0] == zsl->header) ? NULL : update[0];\n    if (x->level[0].forward)\n        x->level[0].forward->backward = x;\n    else\n        zsl->tail = x;\n    zsl->length++;\n    return x;\n}\n```\n\u9996\u5148\u6211\u4eec\u5728\u641c\u7d22\u5408\u9002\u63d2\u5165\u70b9\u7684\u8fc7\u7a0b\u4e2d\u5c06\u300c\u641c\u7d22\u8def\u5f84\u300d\u6478\u51fa\u6765\u4e86\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5f00\u59cb\u521b\u5efa\u65b0\u8282\u70b9\u4e86\uff0c\u521b\u5efa\u7684\u65f6\u5019\u9700\u8981\u7ed9\u8fd9\u4e2a\u8282\u70b9\u968f\u673a\u5206\u914d\u4e00\u4e2a\u5c42\u6570\uff0c\u518d\u5c06\u641c\u7d22\u8def\u5f84\u4e0a\u7684\u8282\u70b9\u548c\u8fd9\u4e2a\u65b0\u8282\u70b9\u901a\u8fc7\u524d\u5411\u540e\u5411\u6307\u9488\u4e32\u8d77\u6765\u3002\u5982\u679c\u5206\u914d\u7684\u65b0\u8282\u70b9\u7684\u9ad8\u5ea6\u9ad8\u4e8e\u5f53\u524d\u8df3\u8dc3\u5217\u8868\u7684\u6700\u5927\u9ad8\u5ea6\uff0c\u5c31\u9700\u8981\u66f4\u65b0\u4e00\u4e0b\u8df3\u8dc3\u5217\u8868\u7684\u6700\u5927\u9ad8\u5ea6\u3002\n\n## \u5220\u9664\u8fc7\u7a0b\n\n\u5220\u9664\u8fc7\u7a0b\u548c\u63d2\u5165\u8fc7\u7a0b\u7c7b\u4f3c\uff0c\u90fd\u9700\u5148\u628a\u8fd9\u4e2a\u300c\u641c\u7d22\u8def\u5f84\u300d\u627e\u51fa\u6765\u3002\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u5c42\u7684\u76f8\u5173\u8282\u70b9\u90fd\u91cd\u6392\u4e00\u4e0b\u524d\u5411\u540e\u5411\u6307\u9488\u5c31\u53ef\u4ee5\u4e86\u3002\u540c\u65f6\u8fd8\u8981\u6ce8\u610f\u66f4\u65b0\u4e00\u4e0b\u6700\u9ad8\u5c42\u6570`maxLevel`\u3002\n\n## \u66f4\u65b0\u8fc7\u7a0b\n\n\u5f53\u6211\u4eec\u8c03\u7528 zadd \u65b9\u6cd5\u65f6\uff0c\u5982\u679c\u5bf9\u5e94\u7684 value \u4e0d\u5b58\u5728\uff0c\u90a3\u5c31\u662f\u63d2\u5165\u8fc7\u7a0b\u3002\u5982\u679c\u8fd9\u4e2a value \u5df2\u7ecf\u5b58\u5728\u4e86\uff0c\u53ea\u662f\u8c03\u6574\u4e00\u4e0b score \u7684\u503c\uff0c\u90a3\u5c31\u9700\u8981\u8d70\u4e00\u4e2a\u66f4\u65b0\u7684\u6d41\u7a0b\u3002\u5047\u8bbe\u8fd9\u4e2a\u65b0\u7684 score \u503c\u4e0d\u4f1a\u5e26\u6765\u6392\u5e8f\u4f4d\u7f6e\u4e0a\u7684\u6539\u53d8\uff0c\u90a3\u4e48\u5c31\u4e0d\u9700\u8981\u8c03\u6574\u4f4d\u7f6e\uff0c\u76f4\u63a5\u4fee\u6539\u5143\u7d20\u7684 score \u503c\u5c31\u53ef\u4ee5\u4e86\u3002\u4f46\u662f\u5982\u679c\u6392\u5e8f\u4f4d\u7f6e\u6539\u53d8\u4e86\uff0c\u90a3\u5c31\u8981\u8c03\u6574\u4f4d\u7f6e\u3002\u90a3\u8be5\u5982\u4f55\u8c03\u6574\u4f4d\u7f6e\u5462\uff1f\n```c\n/* Remove and re-insert when score changes. */\n    if (score != curscore) {\n        zskiplistNode *node;\n        serverAssert(zslDelete(zs->zsl,curscore,ele,&node));\n        znode = zslInsert(zs->zsl,score,node->ele);\n        /* We reused the node->ele SDS string, free the node now\n        * since zslInsert created a new one. */\n        node->ele = NULL;\n        zslFreeNode(node);\n        /* Note that we did not removed the original element from\n        * the hash table representing the sorted set, so we just\n        * update the score. */\n        dictGetVal(de) = &znode->score; /* Update score ptr. */\n        *flags |= ZADD_UPDATED;\n        }\n    return 1;\n```\n\n\u4e00\u4e2a\u7b80\u5355\u7684\u7b56\u7565\u5c31\u662f\u5148\u5220\u9664\u8fd9\u4e2a\u5143\u7d20\uff0c\u518d\u63d2\u5165\u8fd9\u4e2a\u5143\u7d20\uff0c\u9700\u8981\u7ecf\u8fc7\u4e24\u6b21\u8def\u5f84\u641c\u7d22\u3002Redis \u5c31\u662f\u8fd9\u4e48\u5e72\u7684\u3002\n\u4e0d\u8fc7 Redis \u9047\u5230 score \u503c\u6539\u53d8\u4e86\u5c31\u76f4\u63a5\u5220\u9664\u518d\u63d2\u5165\uff0c\u4e0d\u4f1a\u53bb\u5224\u65ad\u4f4d\u7f6e\u662f\u5426\u9700\u8981\u8c03\u6574\uff0c\u4ece\u8fd9\u70b9\u770b\uff0cRedis \u7684 zadd \u7684\u4ee3\u7801\u4f3c\u4e4e\u8fd8\u6709\u4f18\u5316\u7a7a\u95f4\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u8bfb\u8005\u4eec\u53ef\u4ee5\u7ee7\u7eed\u8ba8\u8bba\u3002\n\n## \u5982\u679c score \u503c\u90fd\u4e00\u6837\u5462\uff1f\n\n\u5728\u4e00\u4e2a\u6781\u7aef\u7684\u60c5\u51b5\u4e0b\uff0czset \u4e2d\u6240\u6709\u7684 score \u503c\u90fd\u662f\u4e00\u6837\u7684\uff0czset \u7684\u67e5\u627e\u6027\u80fd\u4f1a\u9000\u5316\u4e3a O(n) \u4e48\uff1fRedis \u4f5c\u8005\u81ea\u7136\u8003\u8651\u5230\u4e86\u8fd9\u4e00\u70b9\uff0c\u6240\u4ee5 zset \u7684\u6392\u5e8f\u5143\u7d20\u4e0d\u53ea\u770b score \u503c\uff0c\u5982\u679c score \u503c\u76f8\u540c\u8fd8\u9700\u8981\u518d\u6bd4\u8f83 value \u503c (\u5b57\u7b26\u4e32\u6bd4\u8f83)\u3002\n\n## \u5143\u7d20\u6392\u540d\u662f\u600e\u4e48\u7b97\u51fa\u6765\u7684\uff1f\n\n\u524d\u9762\u6211\u4eec\u5570\u55e6\u4e86\u4e00\u5806\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u5c5e\u6027\u6ca1\u6709\u63d0\u5230\uff0c\u90a3\u5c31\u662f zset \u53ef\u4ee5\u83b7\u53d6\u5143\u7d20\u7684\u6392\u540d rank\u3002\u90a3\u8fd9\u4e2a rank \u662f\u5982\u4f55\u7b97\u51fa\u6765\u7684\uff1f\u5982\u679c\u4ec5\u4ec5\u4f7f\u7528\u4e0a\u9762\u7684\u7ed3\u6784\uff0crank \u662f\u4e0d\u80fd\u7b97\u51fa\u6765\u7684\u3002Redis \u5728 skiplist \u7684 forward \u6307\u9488\u4e0a\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u7ed9\u6bcf\u4e00\u4e2a forward \u6307\u9488\u90fd\u589e\u52a0\u4e86 span \u5c5e\u6027\uff0cspan \u662f\u300c\u8de8\u5ea6\u300d\u7684\u610f\u601d\uff0c\u8868\u793a\u4ece\u524d\u4e00\u4e2a\u8282\u70b9\u6cbf\u7740\u5f53\u524d\u5c42\u7684 forward \u6307\u9488\u8df3\u5230\u5f53\u524d\u8fd9\u4e2a\u8282\u70b9\u4e2d\u95f4\u4f1a\u8df3\u8fc7\u591a\u5c11\u4e2a\u8282\u70b9\u3002Redis \u5728\u63d2\u5165\u5220\u9664\u64cd\u4f5c\u65f6\u4f1a\u5c0f\u5fc3\u7ffc\u7ffc\u5730\u66f4\u65b0 span \u503c\u7684\u5927\u5c0f\u3002\n```java\nstruct zslforward {\n  zslnode* item;\n  long span;  // \u8de8\u5ea6\n}\n\nstruct zsl {\n  String value;\n  double score;\n  zslforward*[] forwards;  // \u591a\u5c42\u8fde\u63a5\u6307\u9488\n  zslnode* backward;  // \u56de\u6eaf\u6307\u9488\n}\n```\n\u8fd9\u6837\u5f53\u6211\u4eec\u8981\u8ba1\u7b97\u4e00\u4e2a\u5143\u7d20\u7684\u6392\u540d\u65f6\uff0c\u53ea\u9700\u8981\u5c06\u300c\u641c\u7d22\u8def\u5f84\u300d\u4e0a\u7684\u7ecf\u8fc7\u7684\u6240\u6709\u8282\u70b9\u7684\u8de8\u5ea6 span \u503c\u8fdb\u884c\u53e0\u52a0\u5c31\u53ef\u4ee5\u7b97\u51fa\u5143\u7d20\u7684\u6700\u7ec8 rank \u503c\u3002\n\n## \u601d\u8003\n\n\u6587\u4e2d\u6211\u4eec\u63d0\u5230\u5f53 score \u503c\u7684\u53d8\u5316\u5fae\u5c0f\uff0c\u4e0d\u4f1a\u5e26\u6765\u4f4d\u7f6e\u4e0a\u7684\u8c03\u6574\u65f6\uff0c\u662f\u4e0d\u662f\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539 score \u540e\u5c31\u8fd4\u56de\uff1f\n\n\u8bf7\u8bfb\u8005\u4eec\u5bf9\u8fd9\u4e2a\u95ee\u9898\u8fdb\u884c\u8ba8\u8bba\u3002\u5982\u679c\u786e\u5b9e\u5982\u6b64\uff0c\u53ef\u4ee5\u8003\u8651\u5411 Redis \u4f5c\u8005 Antirez \u63d0 issue \u4e86\u3002\n\n## \u540e\u8bb0\n\n\u8001\u94b1\u4e8e 2018 \u5e74 7 \u6708 28 \u65e5\u5411 Redis \u7684 Github Repo \u63d0\u4ea4\u4e86\u8fd9\u4e2a\u5c0f\u4f18\u5316\u7684\u5efa\u8bae [\u300amaybe an optimizable point for zadd operation\u300b](https://github.com/antirez/redis/issues/5179)\uff0c5 \u5929\u540e\uff0cRedis \u4f5c\u8005 Antirez \u63a5\u53d7\u4e86\u8fd9\u4e2a\u5efa\u8bae\uff0c\u5bf9 skiplist \u7684\u4ee3\u7801\u505a\u4e86\u5c0f\u4fee\u6539\u5e76 merge \u5230\u4e86 master\u3002\n\nAntirez \u5411\u8001\u94b1\u8868\u8fbe\u4e86\u611f\u8c22\uff0c\u4f5c\u4e3a\u5c0f\u5b66\u751f\u7684\u6211\u8868\u793a\u5f88\u6fc0\u52a8\uff0c\u4ed6\u544a\u8bc9\u6211\u8fd9\u4e2a\u5c0f\u4f18\u5316\u5728\u67d0\u4e9b\u5e94\u7528\u573a\u666f\u4e0b\u53ef\u4ee5\u4e3a zset \u5e26\u6765 10% \u4ee5\u4e0a\u6027\u80fd\u7684\u63d0\u5347\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/5/1650a1dac220f24b?w=1600&h=738&f=png&s=168891)\n", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/37\u6e90\u7801_5\u51cc\u6ce2\u5fae\u6b65__\u63a2\u7d22\u8df3\u8dc3\u5217\u8868\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.207", "order": 38}}, {"model": "subject.chapter", "pk": 46, "fields": {"title": "39\u6e90\u7801 7\uff1a\u91d1\u679d\u7389\u53f6 \u2014\u2014 \u63a2\u7d22\u300c\u57fa\u6570\u6811\u300d\u5185\u90e8", "topic": 2, "md5": "55bef8b3497cf96e6789cfb4374c0798", "md_body": "# \u6e90\u7801 7\uff1a\u91d1\u679d\u7389\u53f6 \u2014\u2014 \u63a2\u7d22\u300c\u57fa\u6570\u6811\u300d\u5185\u90e8\n\nRax \u662f Redis \u5185\u90e8\u6bd4\u8f83\u7279\u6b8a\u7684\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u662f\u4e00\u4e2a\u6709\u5e8f\u5b57\u5178\u6811 (\u57fa\u6570\u6811 Radix Tree)\uff0c\u6309\u7167 key \u7684\u5b57\u5178\u5e8f\u6392\u5217\uff0c\u652f\u6301\u5feb\u901f\u5730\u5b9a\u4f4d\u3001\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u3002Redis \u4e94\u5927\u57fa\u7840\u6570\u636e\u7ed3\u6784\u91cc\u9762\uff0c\u80fd\u4f5c\u4e3a\u5b57\u5178\u4f7f\u7528\u7684\u6709 hash \u548c zset\u3002hash \u4e0d\u5177\u5907\u6392\u5e8f\u529f\u80fd\uff0czset \u5219\u662f\u6309\u7167 score \u8fdb\u884c\u6392\u5e8f\u7684\u3002rax \u8ddf zset \u7684\u4e0d\u540c\u5728\u4e8e\u5b83\u662f\u6309\u7167 key \u8fdb\u884c\u6392\u5e8f\u7684\u3002Redis \u4f5c\u8005\u8ba4\u4e3a rax \u7684\u7ed3\u6784\u975e\u5e38\u6613\u4e8e\u7406\u89e3\uff0c\u4f46\u662f\u5b9e\u73b0\u5374\u6709\u76f8\u5f53\u7684\u590d\u6742\u5ea6\uff0c\u9700\u8981\u8003\u8651\u5f88\u591a\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u9700\u8981\u5904\u7406\u8282\u70b9\u7684\u5206\u88c2\u3001\u5408\u5e76\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5c31\u4f1a\u51fa\u9519\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/29/164e6638d182d063?w=1398&h=428&f=png&s=51175)\n\n## \u5e94\u7528\n\n\u4f60\u53ef\u4ee5\u5c06\u4e00\u672c\u82f1\u8bed\u5b57\u5178\u770b\u6210\u4e00\u68f5 radix tree\uff0c\u5b83\u6240\u6709\u7684\u5355\u8bcd\u90fd\u662f\u6309\u7167\u5b57\u5178\u5e8f\u8fdb\u884c\u6392\u5217\uff0c\u6bcf\u4e2a\u8bcd\u6c47\u90fd\u4f1a\u9644\u5e26\u4e00\u4e2a\u89e3\u91ca\uff0c\u8fd9\u4e2a\u89e3\u91ca\u5c31\u662f key \u5bf9\u5e94\u7684 value\u3002\u6709\u4e86\u8fd9\u68f5\u6811\uff0c\u4f60\u5c31\u53ef\u4ee5\u5feb\u901f\u5730\u68c0\u7d22\u5355\u8bcd\uff0c\u8fd8\u53ef\u4ee5\u67e5\u8be2\u4ee5\u67d0\u4e2a\u524d\u7f00\u5f00\u5934\u7684\u5355\u8bcd\u6709\u54ea\u4e9b\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/30/164e913c11c441ec?w=536&h=400&f=png&s=33470)\n\n\u4f60\u4e5f\u53ef\u4ee5\u5c06\u516c\u5b89\u5c40\u7684\u4eba\u5458\u6863\u6848\u4fe1\u606f\u770b\u6210\u4e00\u68f5 radix tree\uff0c\u5b83\u7684 key \u662f\u6bcf\u4e2a\u4eba\u7684\u8eab\u4efd\u8bc1\u53f7\uff0cvalue \u662f\u8fd9\u4e2a\u4eba\u7684\u5c65\u5386\u3002\u56e0\u4e3a\u8eab\u4efd\u8bc1\u53f7\u7684\u7f16\u7801\u7684\u524d\u7f00\u662f\u6309\u7167\u5730\u533a\u8fdb\u884c\u4e00\u7ea7\u4e00\u7ea7\u5212\u5206\u7684\uff0c\u8fd9\u70b9\u548c\u5355\u8bcd\u975e\u5e38\u7c7b\u4f3c\u3002\u6709\u4e86\u8fd9\u68f5\u6811\uff0c\u4f60\u5c31\u53ef\u4ee5\u5feb\u901f\u5730\u5b9a\u4f4d\u51fa\u4eba\u5458\u6863\u6848\uff0c\u8fd8\u53ef\u4ee5\u5feb\u901f\u67e5\u8be2\u51fa\u67d0\u4e2a\u5c0f\u7247\u533a\u90fd\u6709\u54ea\u4e9b\u4eba\u3002\n\nRadix tree \u8fd8\u53ef\u4ee5\u5e94\u7528\u4e8e\u65f6\u95f4\u5e8f\u5217\u5e94\u7528\uff0ckey \u4e3a\u65f6\u95f4\u6233\uff0cvalue \u4e3a\u53d1\u751f\u5728\u5177\u4f53\u65f6\u95f4\u7684\u4e8b\u4ef6\u5185\u5bb9\u3002\u56e0\u4e3a\u65f6\u95f4\u6233\u7684\u7f16\u7801\u4e5f\u662f\u6309\u7167\u3010\u5e74\u6708\u65e5\u65f6\u5206\u79d2\u6beb\u79d2\u5fae\u79d2\u7eb3\u79d2\u3011\u8fdb\u884c\u4e00\u7ea7\u4e00\u7ea7\u5212\u5206\u7684\uff0c\u6240\u4ee5\u5b83\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b57\u5178\u5e8f\u6765\u6392\u5e8f\u3002\u6709\u4e86\u8fd9\u68f5\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u51fa\u67d0\u4e2a\u5177\u4f53\u65f6\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\u4e8b\uff0c\u4e5f\u53ef\u4ee5\u67e5\u8be2\u51fa\u4e00\u6bb5\u65f6\u95f4\u5185\u90fd\u6709\u54ea\u4e9b\u4e8b\u53d1\u751f\u3002\n\n\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528\u7684 Web \u670d\u52a1\u5668\u7684 Router \u5b83\u4e5f\u662f\u4e00\u68f5 radix tree\u3002\u8fd9\u68f5\u6811\u4e0a\u6302\u6ee1\u4e86 URL \u89c4\u5219\uff0c\u6bcf\u4e2a URL \u89c4\u5219\u4e0a\u90fd\u4f1a\u9644\u4e0a\u4e00\u4e2a\u8bf7\u6c42\u5904\u7406\u5668\u3002\u5f53\u4e00\u4e2a\u8bf7\u6c42\u5230\u6765\u65f6\uff0c\u6211\u4eec\u62ff\u8fd9\u4e2a\u8bf7\u6c42\u7684 URL \u6cbf\u7740\u6811\u8fdb\u884c\u904d\u5386\uff0c\u627e\u5230\u76f8\u5e94\u7684\u8bf7\u6c42\u5904\u7406\u5668\u6765\u5904\u7406\u3002\u56e0\u4e3a URL \u4e2d\u53ef\u80fd\u5b58\u5728\u6b63\u5219 pattern\uff0c\u800c\u4e14\u540c\u4e00\u5c42\u7684\u8282\u70b9\u5bf9\u987a\u5e8f\u6ca1\u6709\u8981\u6c42\uff0c\u6240\u4ee5\u5b83\u4e0d\u7b97\u662f\u4e00\u68f5\u4e25\u683c\u7684 radix tree\u3002\n```\n# golang \u7684 HttpRouter \u5e93\nThe router relies on a tree structure which makes heavy use of *common prefixes*\nit is basically a *compact* [*prefix tree*](https://en.wikipedia.org/wiki/Trie) \n(or just [*Radix tree*](https://en.wikipedia.org/wiki/Radix_tree)). \nNodes with a common prefix also share a common parent. \nHere is a short example what the routing tree for the `GET` request method could look like:\n\nPriority   Path             Handle\n9          \\                *<1>\n3          \u251cs               nil\n2          |\u251cearch\\         *<2>\n1          |\u2514upport\\        *<3>\n2          \u251cblog\\           *<4>\n1          |    \u2514:post      nil\n1          |         \u2514\\     *<5>\n2          \u251cabout-us\\       *<6>\n1          |        \u2514team\\  *<7>\n1          \u2514contact\\        *<8>\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/29/164e677416f3c865?w=1114&h=810&f=png&s=184182)\n\nRax \u88ab\u7528\u5728 Redis Stream \u7ed3\u6784\u91cc\u9762\u7528\u4e8e\u5b58\u50a8\u6d88\u606f\u961f\u5217\uff0c\u5728 Stream \u91cc\u9762\u6d88\u606f ID \u7684\u524d\u7f00\u662f\u65f6\u95f4\u6233 + \u5e8f\u53f7\uff0c\u8fd9\u6837\u7684\u6d88\u606f\u53ef\u4ee5\u7406\u89e3\u4e3a\u65f6\u95f4\u5e8f\u5217\u6d88\u606f\u3002\u4f7f\u7528 Rax \u7ed3\u6784\u8fdb\u884c\u5b58\u50a8\u5c31\u53ef\u4ee5\u5feb\u901f\u5730\u6839\u636e\u6d88\u606f ID \u5b9a\u4f4d\u5230\u5177\u4f53\u7684\u6d88\u606f\uff0c\u7136\u540e\u7ee7\u7eed\u904d\u5386\u6307\u5b9a\u6d88\u606f\u4e4b\u540e\u7684\u6240\u6709\u6d88\u606f\u3002\n\nRax \u88ab\u7528\u5728 Redis Cluster \u4e2d\u7528\u6765\u8bb0\u5f55\u69fd\u4f4d\u548ckey\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd9\u4e2a\u5bf9\u5e94\u5173\u7cfb\u7684\u53d8\u91cf\u540d\u6210\u53eb\u7740`slots_to_keys`\u3002\u8fd9\u4e2araxNode\u7684key\u662f\u7531\u69fd\u4f4d\u7f16\u53f7hashslot\u548ckey\u7ec4\u5408\u800c\u6210\u7684\u3002\u6211\u4eec\u77e5\u9053cluster\u7684\u69fd\u4f4d\u6570\u91cf\u662f16384\uff0c\u5b83\u9700\u89812\u4e2a\u5b57\u8282\u6765\u8868\u793a\uff0c\u6240\u4ee5rax\u8282\u70b9\u91cc\u5b58\u7684key\u5c31\u662f2\u4e2a\u5b57\u8282\u7684hashslot\u548c\u5bf9\u8c61key\u62fc\u63a5\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/7/16513a606ebecb05?w=646&h=66&f=png&s=7952)\n\n\u56e0\u4e3arax\u7684key\u662f\u6309\u7167key\u524d\u7f00\u987a\u5e8f\u6302\u63a5\u7684\uff0c\u610f\u5473\u7740\u540c\u6837\u7684hashslot\u7684\u5bf9\u8c61key\u5c06\u4f1a\u6302\u5728\u540c\u4e00\u4e2araxNode\u4e0b\u9762\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u904d\u5386\u5177\u4f53\u67d0\u4e2a\u69fd\u4f4d\u4e0b\u9762\u7684\u6240\u6709\u5bf9\u8c61key\u3002\n\n\n## \u7ed3\u6784\n\nrax \u4e2d\u6709\u975e\u5e38\u591a\u7684\u8282\u70b9\uff0c\u6839\u8282\u70b9\u3001\u53f6\u8282\u70b9\u548c\u4e2d\u95f4\u8282\u70b9\uff0c\u6709\u4e9b\u4e2d\u95f4\u8282\u70b9\u5e26\u6709 value\uff0c\u6709\u4e9b\u4e2d\u95f4\u8282\u70b9\u7eaf\u7cb9\u662f\u7ed3\u6784\u6027\u9700\u8981\u6ca1\u6709\u5bf9\u5e94\u7684 value\u3002\n\n```c\nstruct raxNode {\n    int<1> isKey; // \u662f\u5426\u6ca1\u6709 key\uff0c\u6ca1\u6709 key \u7684\u662f\u6839\u8282\u70b9\n    int<1> isNull; // \u662f\u5426\u6ca1\u6709\u5bf9\u5e94\u7684 value\uff0c\u65e0\u610f\u4e49\u7684\u4e2d\u95f4\u8282\u70b9\n    int<1> isCompressed; // \u662f\u5426\u538b\u7f29\u5b58\u50a8\uff0c\u8fd9\u4e2a\u538b\u7f29\u7684\u6982\u5ff5\u6bd4\u8f83\u7279\u522b\n    int<29> size; // \u5b50\u8282\u70b9\u7684\u6570\u91cf\u6216\u8005\u662f\u538b\u7f29\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 (isCompressed)\n    byte[] data; // \u8def\u7531\u952e\u3001\u5b50\u8282\u70b9\u6307\u9488\u3001value \u90fd\u5728\u8fd9\u91cc\n}\n```\nrax \u662f\u4e00\u68f5\u6bd4\u8f83\u7279\u6b8a\u7684 radix tree\uff0c\u5b83\u5728\u7ed3\u6784\u4e0a\u4e0d\u662f\u6807\u51c6\u7684 radix tree\u3002\u5982\u679c\u4e00\u4e2a\u4e2d\u95f4\u8282\u70b9\u6709\u591a\u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u8def\u7531\u952e\u5c31\u53ea\u662f\u4e00\u4e2a\u5b57\u7b26\u3002\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u8def\u7531\u952e\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u540e\u8005\u5c31\u662f\u6240\u8c13\u7684\u300c\u538b\u7f29\u300d\u5f62\u5f0f\uff0c\u591a\u4e2a\u5b57\u7b26\u538b\u5728\u4e00\u8d77\u7684\u5b57\u7b26\u4e32\u3002\u6bd4\u5982\u524d\u9762\u7684\u90a3\u68f5\u5b57\u5178\u6811\u5728 Rax \u7b97\u6cd5\u4e2d\u5c06\u5448\u73b0\u51fa\u5982\u4e0b\u7ed3\u6784\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/7/30/164e916ab956ec46?w=497&h=478&f=png&s=37646)\n\n\u56fe\u4e2d\u7684\u6df1\u84dd\u8272\u8282\u70b9\u5c31\u662f\u300c\u538b\u7f29\u300d\u8282\u70b9\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u7ec6\u770b`raxNode.data`\u91cc\u9762\u5b58\u50a8\u7684\u5230\u5e95\u662f\u4ec0\u4e48\u4e1c\u897f\uff0c\u5b83\u662f\u4e00\u4e2a\u6bd4\u8f83\u590d\u6742\u7684\u7ed3\u6784\uff0c\u6309\u7167\u538b\u7f29\u4e0e\u5426\u5206\u4e3a\u4e24\u79cd\u7ed3\u6784\n\n**\u538b\u7f29\u7ed3\u6784** \u5b50\u8282\u70b9\u5982\u679c\u53ea\u6709\u4e00\u4e2a\uff0c\u90a3\u5c31\u662f\u538b\u7f29\u7ed3\u6784\uff0cdata \u5b57\u6bb5\u5982\u4e0b\u4f2a\u4ee3\u7801\u6240\u793a\uff1a\n```c\nstruct data {\n    optional struct { // \u53d6\u51b3\u4e8e header \u7684 size \u5b57\u6bb5\u662f\u5426\u4e3a\u96f6\n        byte[] childKey; // \u8def\u7531\u952e\n        raxNode* childNode; // \u5b50\u8282\u70b9\u6307\u9488\n    } child;\n    optional string value; // \u53d6\u51b3\u4e8e header \u7684 isNull \u5b57\u6bb5\n}\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/30/164e94892c9df020?w=634&h=344&f=png&s=22925)\n\n\u5982\u679c\u662f\u53f6\u5b50\u8282\u70b9\uff0cchild \u5b57\u6bb5\u5c31\u4e0d\u5b58\u5728\u3002\u5982\u679c\u662f\u65e0\u610f\u4e49\u7684\u4e2d\u95f4\u8282\u70b9 (isNull)\uff0c\u90a3\u4e48 value \u5b57\u6bb5\u5c31\u4e0d\u5b58\u5728\u3002\n\n**\u975e\u538b\u7f29\u8282\u70b9** \u5982\u679c\u5b50\u8282\u70b9\u6709\u591a\u4e2a\uff0c\u90a3\u5c31\u4e0d\u662f\u538b\u7f29\u7ed3\u6784\uff0c\u5b58\u5728\u591a\u4e2a\u8def\u7531\u952e\uff0c\u4e00\u4e2a\u952e\u662f\u4e00\u4e2a\u5b57\u7b26\u3002\n```c\nstruct data {\n    byte[] childKeys; // \u8def\u7531\u952e\u5b57\u7b26\u5217\u8868\n    raxNode*[] childNodes; // \u591a\u4e2a\u5b50\u8282\u70b9\u6307\u9488\n    optional string value; // \u53d6\u51b3\u4e8e header \u7684 isNull \u5b57\u6bb5\n}\n```\n\n![](https://user-gold-cdn.xitu.io/2018/7/30/164e948b0d64b69f?w=755&h=431&f=png&s=29746)\n\n\u4e5f\u8bb8\u4f60\u4f1a\u60f3\u5230\u5982\u679c\u5b50\u8282\u70b9\u53ea\u6709\u4e00\u4e2a\uff0c\u5e76\u4e14\u8def\u7531\u952e\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u4e3a 1 \u5462\uff0c\u90a3\u5230\u5e95\u7b97\u538b\u7f29\u8fd8\u662f\u975e\u538b\u7f29\uff1f\u4ed4\u7ec6\u601d\u8003\u4e00\u4e0b\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u538b\u7f29\u548c\u975e\u538b\u7f29\u5728\u6570\u636e\u7ed3\u6784\u8868\u73b0\u5f62\u5f0f\u4e0a\u662f\u4e00\u6837\u7684\uff0c\u4e0d\u7ba1 isCompressed \u662f 0 \u8fd8\u597d\u662f 1\uff0c\u7ed3\u6784\u90fd\u662f\u4e00\u6837\u7684\u3002\n\n\n## \u589e\u5220\u8282\u70b9\n\nRax \u7684\u589e\u5220\u8282\u70b9\u903b\u8f91\u975e\u5e38\u590d\u6742\uff0c\u4ee3\u7801\u91cc\u5145\u65a5\u4e86\u592a\u591a`ifelse`\u903b\u8f91\uff0c\u8001\u5e08\u6211\u770b\u7684\u662f\u6655\u5934\u8f6c\u5411\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f\u5c31\u4e0d\u5206\u6790\u5b83\u7684\u6e90\u7801\u4e86\uff0c\u4ee5\u540e\u8981\u662f\u5f7b\u5e95\u770b\u61c2\u4e86\uff0c\u518d\u6765\u7ee7\u7eed\u8ddf\u540c\u5b66\u4eec\u5206\u4eab\u5427\u3002\u5982\u679c\u54ea\u4f4d\u540c\u5b66\u60f3\u6311\u6218\u4e00\u4e0b\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u770b\uff01\n\n## \u601d\u8003\n\n\u8fd8\u6709\u54ea\u4e9b\u573a\u5408\u53ef\u4ee5\u4f7f\u7528 radix tree\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/39\u6e90\u7801_7\u91d1\u679d\u7389\u53f6__\u63a2\u7d22\u57fa\u6570\u6811\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.223", "order": 40}}, {"model": "subject.chapter", "pk": 47, "fields": {"title": "40\u6e90\u7801 8\uff1a\u7cbe\u76ca\u6c42\u7cbe \u2014\u2014 LFU vs LRU", "topic": 2, "md5": "41c71a659a03712eeb6ee0f7a544a398", "md_body": "# \u6e90\u7801 8\uff1a\u7cbe\u76ca\u6c42\u7cbe \u2014\u2014 LFU vs LRU\n\n\u5728\u7b2c 27 \u5c0f\u8282\uff0c\u6211\u4eec\u8bb2\u5230\u4e86 Redis \u7684 LRU \u6a21\u5f0f\uff0c\u5b83\u53ef\u4ee5\u6709\u6548\u7684\u63a7\u5236 Redis \u5360\u7528\u5185\u5b58\u5927\u5c0f\uff0c\u5c06\u51b7\u6570\u636e\u4ece\u5185\u5b58\u4e2d\u6dd8\u6c70\u51fa\u53bb\u3002Antirez \u5728 Redis 4.0 \u91cc\u5f15\u5165\u4e86\u4e00\u4e2a\u65b0\u7684\u6dd8\u6c70\u7b56\u7565 \u2014\u2014 LFU \u6a21\u5f0f\uff0c\u4f5c\u8005\u8ba4\u4e3a\u5b83\u6bd4 LRU \u66f4\u52a0\u4f18\u79c0\u3002\n\nLFU \u7684\u5168\u79f0\u662f`Least Frequently Used`\uff0c\u8868\u793a\u6309\u6700\u8fd1\u7684\u8bbf\u95ee\u9891\u7387\u8fdb\u884c\u6dd8\u6c70\uff0c\u5b83\u6bd4 LRU \u66f4\u52a0\u7cbe\u51c6\u5730\u8868\u793a\u4e86\u4e00\u4e2a key \u88ab\u8bbf\u95ee\u7684\u70ed\u5ea6\u3002\n\n\u5982\u679c\u4e00\u4e2a key \u957f\u65f6\u95f4\u4e0d\u88ab\u8bbf\u95ee\uff0c\u53ea\u662f\u521a\u521a\u5076\u7136\u88ab\u7528\u6237\u8bbf\u95ee\u4e86\u4e00\u4e0b\uff0c\u90a3\u4e48\u5728\u4f7f\u7528 LRU \u7b97\u6cd5\u4e0b\u5b83\u662f\u4e0d\u5bb9\u6613\u88ab\u6dd8\u6c70\u7684\uff0c\u56e0\u4e3a LRU \u7b97\u6cd5\u8ba4\u4e3a\u5f53\u524d\u8fd9\u4e2a key \u662f\u5f88\u70ed\u7684\u3002\u800c LFU \u662f\u9700\u8981\u8ffd\u8e2a\u6700\u8fd1\u4e00\u6bb5\u65f6\u95f4\u7684\u8bbf\u95ee\u9891\u7387\uff0c\u5982\u679c\u67d0\u4e2a key \u53ea\u662f\u5076\u7136\u88ab\u8bbf\u95ee\u4e00\u6b21\u662f\u4e0d\u8db3\u4ee5\u53d8\u5f97\u5f88\u70ed\u7684\uff0c\u5b83\u9700\u8981\u5728\u8fd1\u671f\u4e00\u6bb5\u65f6\u95f4\u5185\u88ab\u8bbf\u95ee\u5f88\u591a\u6b21\u624d\u6709\u673a\u4f1a\u88ab\u8ba4\u4e3a\u5f88\u70ed\u3002\n\n## Redis \u5bf9\u8c61\u7684\u70ed\u5ea6\n\nRedis \u7684\u6240\u6709\u5bf9\u8c61\u7ed3\u6784\u5934\u4e2d\u90fd\u6709\u4e00\u4e2a 24bit \u7684\u5b57\u6bb5\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u7528\u6765\u8bb0\u5f55\u5bf9\u8c61\u7684\u300c\u70ed\u5ea6\u300d\u3002\n```c\n// redis \u7684\u5bf9\u8c61\u5934\ntypedef struct redisObject {\n    unsigned type:4; // \u5bf9\u8c61\u7c7b\u578b\u5982 zset/set/hash \u7b49\u7b49\n    unsigned encoding:4; // \u5bf9\u8c61\u7f16\u7801\u5982 ziplist/intset/skiplist \u7b49\u7b49\n    unsigned lru:24; // \u5bf9\u8c61\u7684\u300c\u70ed\u5ea6\u300d\n    int refcount; // \u5f15\u7528\u8ba1\u6570\n    void *ptr; // \u5bf9\u8c61\u7684 body\n} robj;\n```\n\n## LRU \u6a21\u5f0f\n\n\u5728 LRU \u6a21\u5f0f\u4e0b\uff0clru \u5b57\u6bb5\u5b58\u50a8\u7684\u662f Redis \u65f6\u949f`server.lruclock`\uff0cRedis \u65f6\u949f\u662f\u4e00\u4e2a 24bit \u7684\u6574\u6570\uff0c\u9ed8\u8ba4\u662f Unix \u65f6\u95f4\u6233\u5bf9 2^24 \u53d6\u6a21\u7684\u7ed3\u679c\uff0c\u5927\u7ea6 97 \u5929\u6e05\u96f6\u4e00\u6b21\u3002\u5f53\u67d0\u4e2a key \u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u5b83\u7684\u5bf9\u8c61\u5934\u7684 lru \u5b57\u6bb5\u503c\u5c31\u4f1a\u88ab\u66f4\u65b0\u4e3a`server.lruclock`\u3002\n\n\u9ed8\u8ba4 Redis \u65f6\u949f\u503c\u6bcf\u6beb\u79d2\u66f4\u65b0\u4e00\u6b21\uff0c\u5728\u5b9a\u65f6\u4efb\u52a1`serverCron`\u91cc\u4e3b\u52a8\u8bbe\u7f6e\u3002Redis \u7684\u5f88\u591a\u5b9a\u65f6\u4efb\u52a1\u90fd\u662f\u5728`serverCron`\u91cc\u9762\u5b8c\u6210\u7684\uff0c\u6bd4\u5982\u5927\u578b hash \u8868\u7684\u6e10\u8fdb\u5f0f\u8fc1\u79fb\u3001\u8fc7\u671f key \u7684\u4e3b\u52a8\u6dd8\u6c70\u3001\u89e6\u53d1 bgsave\u3001bgaofrewrite \u7b49\u7b49\u3002\n\n\u5982\u679c`server.lruclock`\u6ca1\u6709\u6298\u8fd4 (\u5bf9 2^24 \u53d6\u6a21)\uff0c\u5b83\u5c31\u662f\u4e00\u76f4\u9012\u589e\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5bf9\u8c61\u7684 LRU \u5b57\u6bb5\u4e0d\u4f1a\u8d85\u8fc7`server.lruclock`\u7684\u503c\u3002\u5982\u679c\u8d85\u8fc7\u4e86\uff0c\u8bf4\u660e`server.lruclock`\u6298\u8fd4\u4e86\u3002\u901a\u8fc7\u8fd9\u4e2a\u903b\u8f91\u5c31\u53ef\u4ee5\u7cbe\u51c6\u8ba1\u7b97\u51fa\u5bf9\u8c61\u591a\u957f\u65f6\u95f4\u6ca1\u6709\u88ab\u8bbf\u95ee\u2014\u2014\u5bf9\u8c61\u7684\u7a7a\u95f2\u65f6\u95f4\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/6/1650e756e1ce8b9a?w=1284&h=146&f=png&s=21164)\n\n```c\n// \u8ba1\u7b97\u5bf9\u8c61\u7684\u7a7a\u95f2\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u88ab\u8bbf\u95ee\u7684\u65f6\u95f4\uff0c\u8fd4\u56de\u7ed3\u679c\u662f\u6beb\u79d2\nunsigned long long estimateObjectIdleTime(robj *o) {\n    unsigned long long lruclock = LRU_CLOCK(); // \u83b7\u53d6 redis \u65f6\u949f\uff0c\u4e5f\u5c31\u662f server.lruclock \u7684\u503c\n    if (lruclock >= o->lru) {\n        // \u6b63\u5e38\u9012\u589e\n        return (lruclock - o->lru) * LRU_CLOCK_RESOLUTION; // LRU_CLOCK_RESOLUTION \u9ed8\u8ba4\u662f 1000\n    } else {\n        // \u6298\u8fd4\u4e86\n        return (lruclock + (LRU_CLOCK_MAX - o->lru)) * // LRU_CLOCK_MAX \u662f 2^24-1\n                    LRU_CLOCK_RESOLUTION;\n    }\n}\n```\n\n\u6709\u4e86\u5bf9\u8c61\u7684\u7a7a\u95f2\u65f6\u95f4\uff0c\u5c31\u53ef\u4ee5\u76f8\u4e92\u4e4b\u95f4\u8fdb\u884c\u6bd4\u8f83\u8c01\u65b0\u8c01\u65e7\uff0c\u968f\u673a LRU \u7b97\u6cd5\u9760\u7684\u5c31\u662f\u6bd4\u8f83\u5bf9\u8c61\u7684\u7a7a\u95f2\u65f6\u95f4\u6765\u51b3\u5b9a\u8c01\u8be5\u88ab\u6dd8\u6c70\u4e86\u3002\n\n## LFU \u6a21\u5f0f\n\n\u5728 LFU \u6a21\u5f0f\u4e0b\uff0clru \u5b57\u6bb5 24 \u4e2a bit \u7528\u6765\u5b58\u50a8\u4e24\u4e2a\u503c\uff0c\u5206\u522b\u662f`ldt(last decrement time)`\u548c`logc(logistic counter)`\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/6/1650e8f382f31205?w=601&h=93&f=png&s=10013)\n\nlogc \u662f 8 \u4e2a bit\uff0c\u7528\u6765\u5b58\u50a8\u8bbf\u95ee\u9891\u6b21\uff0c\u56e0\u4e3a 8 \u4e2a bit \u80fd\u8868\u793a\u7684\u6700\u5927\u6574\u6570\u503c\u4e3a 255\uff0c\u5b58\u50a8\u9891\u6b21\u80af\u5b9a\u8fdc\u8fdc\u4e0d\u591f\uff0c\u6240\u4ee5\u8fd9 8 \u4e2a bit \u5b58\u50a8\u7684\u662f\u9891\u6b21\u7684\u5bf9\u6570\u503c\uff0c\u5e76\u4e14\u8fd9\u4e2a\u503c\u8fd8\u4f1a\u968f\u65f6\u95f4\u8870\u51cf\u3002\u5982\u679c\u5b83\u7684\u503c\u6bd4\u8f83\u5c0f\uff0c\u90a3\u4e48\u5c31\u5f88\u5bb9\u6613\u88ab\u56de\u6536\u3002\u4e3a\u4e86\u786e\u4fdd\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u4e0d\u88ab\u56de\u6536\uff0c\u65b0\u5bf9\u8c61\u7684\u8fd9 8 \u4e2a bit \u4f1a\u521d\u59cb\u5316\u4e3a\u4e00\u4e2a\u5927\u4e8e\u96f6\u7684\u503c\uff0c\u9ed8\u8ba4\u662f`LFU_INIT_VAL=5`\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/6/1650e9c135644d19?w=1298&h=150&f=png&s=23124)\n\nldt \u662f 16 \u4e2a\u4f4d\uff0c\u7528\u6765\u5b58\u50a8\u4e0a\u4e00\u6b21 logc \u7684\u66f4\u65b0\u65f6\u95f4\uff0c\u56e0\u4e3a\u53ea\u6709 16 \u4f4d\uff0c\u6240\u4ee5\u7cbe\u5ea6\u4e0d\u53ef\u80fd\u5f88\u9ad8\u3002\u5b83\u53d6\u7684\u662f\u5206\u949f\u65f6\u95f4\u6233\u5bf9 2^16 \u8fdb\u884c\u53d6\u6a21\uff0c\u5927\u7ea6\u6bcf\u9694 45 \u5929\u5c31\u4f1a\u6298\u8fd4\u3002\u540c LRU \u6a21\u5f0f\u4e00\u6837\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u903b\u8f91\u8ba1\u7b97\u51fa\u5bf9\u8c61\u7684\u7a7a\u95f2\u65f6\u95f4\uff0c\u53ea\u4e0d\u8fc7\u7cbe\u5ea6\u662f\u5206\u949f\u7ea7\u522b\u7684\u3002\u56fe\u4e2d\u7684 server.unixtime \u662f\u5f53\u524d redis \u8bb0\u5f55\u7684\u7cfb\u7edf\u65f6\u95f4\u6233\uff0c\u548c server.lruclock \u4e00\u6837\uff0c\u5b83\u4e5f\u662f\u6bcf\u6beb\u79d2\u66f4\u65b0\u4e00\u6b21\u3002\n```c\n// nowInMinutes\n// server.unixtime \u4e3a redis \u7f13\u5b58\u7684\u7cfb\u7edf\u65f6\u95f4\u6233\nunsigned long LFUGetTimeInMinutes(void) {\n    return (server.unixtime/60) & 65535;\n}\n\n// idle_in_minutes\nunsigned long LFUTimeElapsed(unsigned long ldt) {\n    unsigned long now = LFUGetTimeInMinutes();\n    if (now >= ldt) return now-ldt; // \u6b63\u5e38\u6bd4\u8f83\n    return 65535-ldt+now; // \u6298\u8fd4\u6bd4\u8f83\n}\n```\n\nldt \u7684\u503c\u548c LRU \u6a21\u5f0f\u7684 lru \u5b57\u6bb5\u4e0d\u4e00\u6837\u7684\u662f ldt \u4e0d\u662f\u5728\u5bf9\u8c61\u88ab\u8bbf\u95ee\u65f6\u66f4\u65b0\u7684\u3002\u5b83\u5728 Redis \u7684\u6dd8\u6c70\u903b\u8f91\u8fdb\u884c\u65f6\u8fdb\u884c\u66f4\u65b0\uff0c\u6dd8\u6c70\u903b\u8f91\u53ea\u4f1a\u5728\u5185\u5b58\u8fbe\u5230 maxmemory \u7684\u8bbe\u7f6e\u65f6\u624d\u4f1a\u89e6\u53d1\uff0c\u5728\u6bcf\u4e00\u4e2a\u6307\u4ee4\u7684\u6267\u884c\u4e4b\u524d\u90fd\u4f1a\u89e6\u53d1\u3002\u6bcf\u6b21\u6dd8\u6c70\u90fd\u662f\u91c7\u7528\u968f\u673a\u7b56\u7565\uff0c\u968f\u673a\u6311\u9009\u82e5\u5e72\u4e2a key\uff0c\u66f4\u65b0\u8fd9\u4e2a key \u7684\u300c\u70ed\u5ea6\u300d\uff0c\u6dd8\u6c70\u6389\u300c\u70ed\u5ea6\u300d\u6700\u4f4e\u7684\u3002\u56e0\u4e3a Redis \u91c7\u7528\u7684\u662f\u968f\u673a\u7b97\u6cd5\uff0c\u5982\u679c key \u6bd4\u8f83\u591a\u7684\u8bdd\uff0c\u90a3\u4e48 ldt \u66f4\u65b0\u7684\u53ef\u80fd\u4f1a\u6bd4\u8f83\u6162\u3002\u4e0d\u8fc7\u65e2\u7136\u5b83\u662f\u5206\u949f\u7ea7\u522b\u7684\u7cbe\u5ea6\uff0c\u4e5f\u6ca1\u6709\u5fc5\u8981\u66f4\u65b0\u7684\u8fc7\u4e8e\u9891\u7e41\u3002\n\nldt \u66f4\u65b0\u7684\u540c\u65f6\u4e5f\u4f1a\u4e00\u540c\u8870\u51cf logc \u7684\u503c\uff0c\u8870\u51cf\u4e5f\u6709\u7279\u5b9a\u7684\u7b97\u6cd5\u3002\u5b83\u5c06\u73b0\u6709\u7684 logc \u503c\u51cf\u53bb\u5bf9\u8c61\u7684\u7a7a\u95f2\u65f6\u95f4 (\u5206\u949f\u6570) \u9664\u4ee5\u4e00\u4e2a\u8870\u51cf\u7cfb\u6570\uff0c\u9ed8\u8ba4\u8fd9\u4e2a\u8870\u51cf\u7cfb\u6570`lfu_decay_time`\u662f 1\u3002\u5982\u679c\u8fd9\u4e2a\u503c\u5927\u4e8e 1\uff0c\u90a3\u4e48\u5c31\u4f1a\u8870\u51cf\u7684\u6bd4\u8f83\u6162\u3002\u5982\u679c\u5b83\u7b49\u4e8e\u96f6\uff0c\u90a3\u5c31\u8868\u793a\u4e0d\u8870\u51cf\uff0c\u5b83\u662f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u53c2\u6570`lfu-decay-time`\u8fdb\u884c\u914d\u7f6e\u3002\n```c\n// \u8870\u51cf logc\nunsigned long LFUDecrAndReturn(robj *o) {\n    unsigned long ldt = o->lru >> 8; // \u524d 16bit\n    unsigned long counter = o->lru & 255; // \u540e 8bit \u4e3a logc\n    // num_periods \u4e3a\u5373\u5c06\u8870\u51cf\u7684\u6570\u91cf\n    unsigned long num_periods = server.lfu_decay_time ? LFUTimeElapsed(ldt) / server.lfu_decay_time : 0;\n    if (num_periods)\n        counter = (num_periods > counter) ? 0 : counter - num_periods;\n    return counter;\n}\n```\n\nlogc \u7684\u66f4\u65b0\u548c LRU \u6a21\u5f0f\u7684 lru \u5b57\u6bb5\u4e00\u6837\uff0c\u90fd\u4f1a\u5728 key \u6bcf\u6b21\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\u66f4\u65b0\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684\u66f4\u65b0\u4e0d\u662f\u7b80\u5355\u7684`+1`\uff0c\u800c\u662f\u91c7\u7528\u6982\u7387\u6cd5\u8fdb\u884c\u9012\u589e\uff0c\u56e0\u4e3a logc \u5b58\u50a8\u7684\u662f\u8bbf\u95ee\u8ba1\u6570\u7684\u5bf9\u6570\u503c\uff0c\u4e0d\u80fd\u76f4\u63a5`+1`\u3002\n```c\n/* Logarithmically increment a counter. The greater is the current counter value\n * the less likely is that it gets really implemented. Saturate it at 255. */\n// \u5bf9\u6570\u9012\u589e\u8ba1\u6570\u503c\nuint8_t LFULogIncr(uint8_t counter) {\n    if (counter == 255) return 255; // \u5230\u6700\u5927\u503c\u4e86\uff0c\u4e0d\u80fd\u5728\u589e\u52a0\u4e86\n    double baseval = counter - LFU_INIT_VAL; // \u51cf\u53bb\u65b0\u5bf9\u8c61\u521d\u59cb\u5316\u7684\u57fa\u6570\u503c (LFU_INIT_VAL \u9ed8\u8ba4\u662f 5)\n    // baseval \u5982\u679c\u5c0f\u4e8e\u96f6\uff0c\u8bf4\u660e\u8fd9\u4e2a\u5bf9\u8c61\u5feb\u4e0d\u884c\u4e86\uff0c\u4e0d\u8fc7\u672c\u6b21 incr \u5c06\u4f1a\u5ef6\u957f\u5b83\u7684\u5bff\u547d\n    if (baseval < 0) baseval = 0; \n    // \u5f53\u524d\u8ba1\u6570\u8d8a\u5927\uff0c\u60f3\u8981 +1 \u5c31\u8d8a\u56f0\u96be\n    // lfu_log_factor \u4e3a\u56f0\u96be\u7cfb\u6570\uff0c\u9ed8\u8ba4\u662f 10\n    // \u5f53 baseval \u7279\u522b\u5927\u65f6\uff0c\u6700\u5927\u662f (255-5)\uff0cp \u503c\u4f1a\u975e\u5e38\u5c0f\uff0c\u5f88\u96be\u4f1a\u8d70\u5230 counter++ \u8fd9\u4e00\u6b65\n    // p \u5c31\u662f counter \u901a\u5f80 [+1] \u6743\u529b\u7684\u95e8\u7f1d\uff0cbaseval \u8d8a\u5927\uff0c\u8fd9\u4e2a\u95e8\u7f1d\u8d8a\u7a84\uff0c\u901a\u8fc7\u5c31\u8d8a\u8270\u96be\n    double p = 1.0/(baseval*server.lfu_log_factor+1);\n    // \u5f00\u59cb\u968f\u673a\u770b\u770b\u80fd\u4e0d\u80fd\u4ece\u95e8\u7f1d\u6324\u8fdb\u53bb\n    double r = (double)rand()/RAND_MAX; // 0 < r < 1\n    if (r < p) counter++;\n    return counter;\n}\n```\n\n## \u4e3a\u4ec0\u4e48 Redis \u8981\u7f13\u5b58\u7cfb\u7edf\u65f6\u95f4\u6233\uff1f\n\n\u6211\u4eec\u5e73\u65f6\u4f7f\u7528\u7cfb\u7edf\u65f6\u95f4\u6233\u65f6\uff0c\u5e38\u5e38\u662f\u4e0d\u5047\u601d\u7d22\u5730\u4f7f\u7528`System.currentTimeInMillis`\u6216\u8005`time.time()`\u6765\u83b7\u53d6\u7cfb\u7edf\u7684\u6beb\u79d2\u65f6\u95f4\u6233\u3002Redis \u4e0d\u80fd\u8fd9\u6837\uff0c\u56e0\u4e3a\u6bcf\u4e00\u6b21\u83b7\u53d6\u7cfb\u7edf\u65f6\u95f4\u6233\u90fd\u662f\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u7cfb\u7edf\u8c03\u7528\u76f8\u5bf9\u6765\u8bf4\u662f\u6bd4\u8f83\u8d39\u65f6\u95f4\u7684\uff0c\u4f5c\u4e3a\u5355\u7ebf\u7a0b\u7684 Redis \u8868\u793a\u627f\u53d7\u4e0d\u8d77\uff0c\u6240\u4ee5\u5b83\u9700\u8981\u5bf9\u65f6\u95f4\u8fdb\u884c\u7f13\u5b58\uff0c\u83b7\u53d6\u65f6\u95f4\u90fd\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u76f4\u63a5\u62ff\u3002\n\n## redis \u4e3a\u4ec0\u4e48\u5728\u83b7\u53d6 lruclock \u65f6\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\uff1f\n\n\u6211\u4eec\u77e5\u9053 Redis \u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u90a3\u4e3a\u4ec0\u4e48 lruclock \u8981\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c atomicGet \u6765\u83b7\u53d6\u5462\uff1f\n```c\nunsigned int LRU_CLOCK(void) {\n    unsigned int lruclock;\n    if (1000/server.hz <= LRU_CLOCK_RESOLUTION) {\n        // \u8fd9\u91cc\u539f\u5b50\u64cd\u4f5c\uff0c\u901a\u5e38\u4f1a\u8d70\u8fd9\u91cc\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6ce8\u610f\u8fd9\u91cc\n        atomicGet(server.lruclock,lruclock);  \n    } else {\n        // \u76f4\u63a5\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u83b7\u53d6\u65f6\u95f4\u6233\uff0chz \u914d\u7f6e\u7684\u592a\u4f4e (\u4e00\u822c\u4e0d\u4f1a\u8fd9\u4e48\u5e72)\uff0clruclock \u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u9700\u8981\u5b9e\u65f6\u83b7\u53d6\u7cfb\u7edf\u65f6\u95f4\u6233\n        lruclock = getLRUClock(); \n    }\n    return lruclock;\n}\n```\n\u56e0\u4e3a Redis \u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u5355\u7ebf\u7a0b\uff0c\u5b83\u80cc\u540e\u8fd8\u6709\u51e0\u4e2a\u5f02\u6b65\u7ebf\u7a0b\u4e5f\u5728\u9ed8\u9ed8\u5de5\u4f5c\u3002\u8fd9\u51e0\u4e2a\u7ebf\u7a0b\u4e5f\u8981\u8bbf\u95ee Redis \u65f6\u949f\uff0c\u6240\u4ee5 lruclock \u5b57\u6bb5\u662f\u9700\u8981\u652f\u6301\u591a\u7ebf\u7a0b\u8bfb\u5199\u7684\u3002\u4f7f\u7528 atomic \u8bfb\u5199\u80fd\u4fdd\u8bc1\u591a\u7ebf\u7a0b lruclock \u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\n\n## \u5982\u4f55\u6253\u5f00 LFU \u6a21\u5f0f\uff1f\n\nRedis 4.0 \u7ed9\u6dd8\u6c70\u7b56\u7565\u914d\u7f6e\u53c2\u6570`maxmemory-policy`\u589e\u52a0\u4e86 2 \u4e2a\u9009\u9879\uff0c\u5206\u522b\u662f volatile-lfu \u548c allkeys-lfu\uff0c\u5206\u522b\u662f\u5bf9\u5e26\u8fc7\u671f\u65f6\u95f4\u7684 key \u8fdb\u884c lfu \u6dd8\u6c70\u4ee5\u53ca\u5bf9\u6240\u6709\u7684 key \u6267\u884c lfu \u6dd8\u6c70\u7b97\u6cd5\u3002\u6253\u5f00\u4e86\u8fd9\u4e2a\u9009\u9879\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 `object freq`\u6307\u4ee4\u83b7\u53d6\u5bf9\u8c61\u7684 lfu \u8ba1\u6570\u503c\u4e86\u3002\n```\n> config set maxmemory-policy allkeys-lfu\nOK\n> set codehole yeahyeahyeah\nOK\n// \u83b7\u53d6\u8ba1\u6570\u503c\uff0c\u521d\u59cb\u5316\u4e3a LFU_INIT_VAL=5\n> object freq codehole\n(integer) 5\n// \u8bbf\u95ee\u4e00\u6b21\n> get codehole\n\"yeahyeahyeah\"\n// \u8ba1\u6570\u503c\u589e\u52a0\u4e86\n> object freq codehole\n(integer) 6\n```\n\n## \u601d\u8003\u9898\n1. \u4f60\u80fd\u5c1d\u8bd5\u4f7f\u7528 py \u6216\u8005 Java \u5199\u4e00\u4e2a\u7b80\u5355\u7684 LFU \u7b97\u6cd5\u4e48\uff1f\n2. \u5982\u679c\u4e00\u5f00\u59cb\u4f7f\u7528 LRU \u6a21\u5f0f\uff0c\u7a81\u7136\u6539\u53d8\u914d\u7f6e\u53d8\u6210\u4e86 LFU \u6a21\u5f0f\uff0c\u60f3\u8c61\u4e00\u4e0b Redis \u5bf9\u8c61\u5934\u7684 lru \u5b57\u6bb5\u503c\uff0c\u4f1a\u5bf9\u73b0\u6709\u7684\u5bf9\u8c61\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/40\u6e90\u7801_8\u7cbe\u76ca\u6c42\u7cbe__LFU_vs_LRU.md", "create_date": "2020-02-18T03:01:06.241", "order": 41}}, {"model": "subject.chapter", "pk": 48, "fields": {"title": "41\u6e90\u7801 9\uff1a\u5982\u5c65\u8584\u51b0 \u2014\u2014 \u61d2\u60f0\u5220\u9664\u7684\u5de8\u5927\u727a\u7272", "topic": 2, "md5": "4415cff7474ec8dca2a1135f8024c2f8", "md_body": "# \u6e90\u7801 9: \u5982\u5c65\u8584\u51b0 \u2014\u2014 \u61d2\u60f0\u5220\u9664\u7684\u5de8\u5927\u727a\u7272\n\n\u524d\u9762\u6211\u4eec\u8bb2\u4e86 Redis \u61d2\u60f0\u5220\u9664\u7684\u7279\u6027\uff0c\u5b83\u662f\u4f7f\u7528\u5f02\u6b65\u7ebf\u7a0b\u5bf9\u5df2\u5220\u9664\u7684\u8282\u70b9\u8fdb\u884c\u5185\u5b58\u56de\u6536\u3002\u4f46\u662f\u8fd8\u4e0d\u591f\u6df1\u5165\uff0c\u6240\u4ee5\u672c\u8282\u6211\u4eec\u8981\u5bf9\u5f02\u6b65\u7ebf\u7a0b\u903b\u8f91\u5904\u7406\u7684\u7ec6\u8282\u8fdb\u884c\u5206\u6790\uff0c\u770b\u770b Antirez \u662f\u5982\u4f55\u5b9e\u73b0\u5f02\u6b65\u7ebf\u7a0b\u5904\u7406\u7684\u3002\n\n\u5f02\u6b65\u7ebf\u7a0b\u5728 Redis \u5185\u90e8\u6709\u4e00\u4e2a\u7279\u522b\u7684\u540d\u79f0\uff0c\u5b83\u5c31\u662f`BIO`\uff0c\u5168\u79f0\u662f`Background IO`\uff0c\u610f\u601d\u662f\u5728\u80cc\u540e\u9ed8\u9ed8\u5e72\u6d3b\u7684 IO \u7ebf\u7a0b\u3002\u4e0d\u8fc7\u5185\u5b58\u56de\u6536\u672c\u8eab\u5e76\u4e0d\u662f\u4ec0\u4e48 IO \u64cd\u4f5c\uff0c\u53ea\u662f CPU \u7684\u8ba1\u7b97\u6d88\u8017\u53ef\u80fd\u4f1a\u6bd4\u8f83\u5927\u800c\u5df2\u3002\n\n## \u61d2\u60f0\u5220\u9664\u7684\u6700\u521d\u5b9e\u73b0\u4e0d\u662f\u5f02\u6b65\u7ebf\u7a0b\n\nAntirez \u5b9e\u73b0\u61d2\u60f0\u5220\u9664\u65f6\uff0c\u5b83\u5e76\u4e0d\u662f\u4e00\u5f00\u59cb\u5c31\u60f3\u5230\u4e86\u5f02\u6b65\u7ebf\u7a0b\u3002\u6700\u521d\u7684\u5c1d\u8bd5\u662f\u5728\u4e3b\u7ebf\u7a0b\u91cc\uff0c\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u5b57\u5178\u6e10\u8fdb\u5f0f\u642c\u8fc1\u90a3\u6837\u6765\u5b9e\u73b0\u6e10\u8fdb\u5f0f\u5220\u9664\u56de\u6536\u3002\u6bd4\u5982\u5bf9\u4e8e\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u5b57\u5178\u6765\u8bf4\uff0c\u61d2\u60f0\u5220\u9664\u662f\u91c7\u7528\u7c7b\u4f3c\u4e8e scan \u64cd\u4f5c\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u904d\u5386\u7b2c\u4e00\u7ef4\u6570\u7ec4\u6765\u9010\u6b65\u5220\u9664\u56de\u6536\u7b2c\u4e8c\u7ef4\u94fe\u8868\u7684\u5185\u5bb9\uff0c\u7b49\u5230\u6240\u6709\u94fe\u8868\u90fd\u56de\u6536\u5b8c\u4e86\uff0c\u518d\u4e00\u6b21\u6027\u56de\u6536\u7b2c\u4e00\u7ef4\u6570\u7ec4\u3002\u8fd9\u6837\u4e5f\u53ef\u4ee5\u8fbe\u5230\u5220\u9664\u5927\u5bf9\u8c61\u65f6\u4e0d\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u6548\u679c\u3002\n\n\u4f46\u662f\u8bf4\u8d77\u6765\u5bb9\u6613\u505a\u8d77\u6765\u5374\u5f88\u96be\u3002\u6e10\u8fdb\u5f0f\u56de\u6536\u9700\u8981\u4ed4\u7ec6\u63a7\u5236\u56de\u6536\u9891\u7387\uff0c\u5b83\u4e0d\u80fd\u56de\u6536\u7684\u592a\u731b\uff0c\u8fd9\u4f1a\u5bfc\u81f4 CPU \u8d44\u6e90\u5360\u7528\u8fc7\u591a\uff0c\u4e5f\u4e0d\u80fd\u56de\u6536\u7684\u8717\u725b\u6162\uff0c\u56e0\u4e3a\u5185\u5b58\u56de\u6536\u4e0d\u53ca\u65f6\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6301\u7eed\u589e\u957f\u3002\n\nAntirez \u9700\u8981\u91c7\u7528\u5408\u9002\u7684\u81ea\u9002\u5e94\u7b97\u6cd5\u6765\u63a7\u5236\u56de\u6536\u9891\u7387\u3002\u4ed6\u9996\u5148\u60f3\u5230\u7684\u662f\u68c0\u6d4b\u5185\u5b58\u589e\u957f\u7684\u8d8b\u52bf\u662f\u589e\u957f (+1) \u8fd8\u662f\u4e0b\u964d (-1) \u6765\u6e10\u8fdb\u5f0f\u8c03\u6574\u56de\u6536\u9891\u7387\u7cfb\u6570\uff0c\u8fd9\u6837\u7684\u81ea\u9002\u5e94\u7b97\u6cd5\u5b9e\u73b0\u4e5f\u5f88\u7b80\u5355\u3002\u4f46\u662f\u6d4b\u8bd5\u540e\u53d1\u73b0\u5728\u670d\u52a1\u7e41\u5fd9\u7684\u65f6\u5019\uff0cQPS \u4f1a\u4e0b\u964d\u5230\u6b63\u5e38\u60c5\u51b5\u4e0b 65% \u7684\u6c34\u5e73\uff0c\u8fd9\u70b9\u975e\u5e38\u81f4\u547d\u3002\n\n\u6240\u4ee5 Antirez \u624d\u4f7f\u7528\u4e86\u5982\u4eca\u4f7f\u7528\u7684\u65b9\u6848\u2014\u2014\u5f02\u6b65\u7ebf\u7a0b\u3002\u5f02\u6b65\u7ebf\u7a0b\u8fd9\u5957\u65b9\u6848\u5c31\u7b80\u5355\u591a\u4e86\uff0c\u91ca\u653e\u5185\u5b58\u4e0d\u7528\u4e3a\u6bcf\u79cd\u6570\u636e\u7ed3\u6784\u9002\u914d\u4e00\u5957\u6e10\u8fdb\u5f0f\u91ca\u653e\u7b56\u7565\uff0c\u4e5f\u4e0d\u7528\u641e\u4e2a\u81ea\u9002\u5e94\u7b97\u6cd5\u6765\u4ed4\u7ec6\u63a7\u5236\u56de\u6536\u9891\u7387\u3002\u5c06\u5bf9\u8c61\u4ece\u5168\u5c40\u5b57\u5178\u4e2d\u6458\u6389\uff0c\u7136\u540e\u5f80\u961f\u5217\u91cc\u4e00\u6254\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u5e72\u522b\u7684\u53bb\u4e86\u3002\u5f02\u6b65\u7ebf\u7a0b\u4ece\u961f\u5217\u91cc\u53d6\u51fa\u5bf9\u8c61\u6765\uff0c\u76f4\u63a5\u8d70\u6b63\u5e38\u7684\u540c\u6b65\u91ca\u653e\u903b\u8f91\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4e0d\u8fc7\u4f7f\u7528\u5f02\u6b65\u7ebf\u7a0b\u4e5f\u662f\u6709\u4ee3\u4ef7\u7684\uff0c\u4e3b\u7ebf\u7a0b\u548c\u5f02\u6b65\u7ebf\u7a0b\u4e4b\u95f4\u5728\u5185\u5b58\u56de\u6536\u5668 (jemalloc) \u7684\u4f7f\u7528\u4e0a\u5b58\u5728\u7ade\u4e89\u3002\u8fd9\u70b9\u7ade\u4e89\u6d88\u8017\u662f\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u7684\uff0c\u56e0\u4e3a Redis \u7684\u4e3b\u7ebf\u7a0b\u5728\u5185\u5b58\u7684\u5206\u914d\u4e0e\u56de\u6536\u4e0a\u82b1\u7684\u65f6\u95f4\u76f8\u5bf9\u6574\u4f53\u8fd0\u7b97\u65f6\u95f4\u800c\u8a00\u662f\u6781\u5c11\u7684\u3002\n\n## \u5f02\u6b65\u7ebf\u7a0b\u65b9\u6848\u5176\u5b9e\u4e5f\u76f8\u5f53\u590d\u6742\n\n\u521a\u624d\u4e0a\u9762\u8bf4\u5f02\u6b65\u7ebf\u7a0b\u65b9\u6848\u5f88\u7b80\u5355\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u53c8\u8bf4\u5b83\u5f88\u590d\u6742\u5462\uff1f\u56e0\u4e3a\u6709\u4e00\u70b9\u6211\u4eec\u4e4b\u524d\u6ca1\u6709\u60f3\u5230\u3002\u8fd9\u70b9\u975e\u5e38\u53ef\u6015\uff0c\u4e25\u91cd\u963b\u788d\u4e86\u5f02\u6b65\u7ebf\u7a0b\u65b9\u6848\u7684\u6539\u9020\uff0c\u90a3\u5c31\u662f Redis \u7684\u5185\u90e8\u5bf9\u8c61\u6709\u5171\u4eab\u673a\u5236\u3002\n\n\u6bd4\u5982\u96c6\u5408\u7684\u5e76\u96c6\u64cd\u4f5c `sunionstore` \u7528\u6765\u5c06\u591a\u4e2a\u96c6\u5408\u5408\u5e76\u6210\u4e00\u4e2a\u65b0\u96c6\u5408\n```\n> sadd src1 value1 value2 value3\n(integer) 3\n> sadd src2 value3 value4 value5\n(integer) 3\n> sunionstore dest src1 src2\n(integer) 5\n> smembers dest\n1) \"value2\"\n2) \"value3\"\n3) \"value1\"\n4) \"value4\"\n5) \"value5\"\n```\n\u6211\u4eec\u770b\u5230\u65b0\u7684\u96c6\u5408\u5305\u542b\u4e86\u65e7\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20\u3002\u4f46\u662f\u8fd9\u91cc\u6709\u4e00\u4e2a\u6211\u4eec\u6ca1\u770b\u5230\u7684 trick\u3002\u90a3\u5c31\u662f\u5e95\u5c42\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u88ab\u5171\u4eab\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/7/165133443f6216c8?w=697&h=372&f=png&s=29829)\n\n\u4e3a\u4ec0\u4e48\u5bf9\u8c61\u5171\u4eab\u662f\u61d2\u60f0\u5220\u9664\u7684\u5de8\u5927\u969c\u788d\u5462\uff1f\u56e0\u4e3a\u61d2\u60f0\u5220\u9664\u76f8\u5f53\u4e8e\u5f7b\u5e95\u780d\u6389\u67d0\u4e2a\u6811\u679d\uff0c\u5c06\u5b83\u6254\u5230\u5f02\u6b65\u5220\u9664\u961f\u5217\u91cc\u53bb\u3002\u6ce8\u610f\u8fd9\u91cc\u5fc5\u987b\u662f\u5f7b\u5e95\u5220\u9664\uff0c\u800c\u4e0d\u80fd\u85d5\u65ad\u4e1d\u8fde\u3002\u5982\u679c\u5e95\u5c42\u5bf9\u8c61\u662f\u5171\u4eab\u7684\uff0c\u90a3\u5c31\u505a\u4e0d\u5230\u5f7b\u5e95\u5220\u9664\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/7/165133bdc0df4a14?w=671&h=332&f=png&s=35963)\n\n\u6240\u4ee5 Antirez \u4e3a\u4e86\u652f\u6301\u61d2\u60f0\u5220\u9664\uff0c\u5c06\u5bf9\u8c61\u5171\u4eab\u673a\u5236\u5f7b\u5e95\u629b\u5f03\uff0c\u5b83\u5c06\u8fd9\u79cd\u5bf9\u8c61\u7ed3\u6784\u79f0\u4e3a\u300cshare-nothing\u300d\uff0c\u4e5f\u5c31\u662f\u65e0\u5171\u4eab\u8bbe\u8ba1\u3002\u4f46\u662f\u7529\u6389\u5bf9\u8c61\u5171\u4eab\u8c08\u4f55\u5bb9\u6613\uff01\u8fd9\u79cd\u5bf9\u8c61\u5171\u4eab\u673a\u5236\u6563\u843d\u5728\u6e90\u4ee3\u7801\u7684\u5404\u4e2a\u89d2\u843d\uff0c\u7275\u4e00\u53d1\u800c\u52a8\u5168\u8eab\uff0c\u6539\u8d77\u6765\u72b9\u5982\u5728\u5e03\u6ee1\u5730\u96f7\u7684\u9053\u8def\u4e0a\u5c0f\u5fc3\u7ffc\u7ffc\u5730\u884c\u8d70\u3002\n\n\u4e0d\u8fc7 Antirez \u8fd8\u662f\u51b3\u5fc3\u6539\u4e86\uff0c\u4ed6\u5c06\u8fd9\u79cd\u6539\u52a8\u63cf\u8ff0\u4e3a\u300c\u7edd\u671b\u800c\u75af\u72c2\u300d\uff0c\u53ef\u89c1\u6539\u52a8\u4e4b\u5927\u4e4b\u6df1\u4e4b\u9669\uff0c\u524d\u540e\u82b1\u4e86\u597d\u51e0\u5468\u7684\u65f6\u95f4\u624d\u6539\u5b8c\u3002\u4e0d\u8fc7\u6548\u679c\u4e5f\u662f\u5f88\u660e\u663e\u7684\uff0c\u5bf9\u8c61\u7684\u5220\u9664\u64cd\u4f5c\u518d\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u5361\u987f\u4e86\u3002\n\n## \u5f02\u6b65\u5220\u9664\u7684\u5b9e\u73b0\n\n\u4e3b\u7ebf\u7a0b\u9700\u8981\u5c06\u5220\u9664\u4efb\u52a1\u4f20\u9012\u7ed9\u5f02\u6b65\u7ebf\u7a0b\uff0c\u5b83\u662f\u901a\u8fc7\u4e00\u4e2a\u666e\u901a\u7684\u53cc\u5411\u94fe\u8868\u6765\u4f20\u9012\u7684\u3002\u56e0\u4e3a\u94fe\u8868\u9700\u8981\u652f\u6301\u591a\u7ebf\u7a0b\u5e76\u53d1\u64cd\u4f5c\uff0c\u6240\u4ee5\u5b83\u9700\u8981\u6709\u9501\u6765\u4fdd\u62a4\u3002\n\n\u6267\u884c\u61d2\u60f0\u5220\u9664\u65f6\uff0cRedis \u5c06\u5220\u9664\u64cd\u4f5c\u7684\u76f8\u5173\u53c2\u6570\u5c01\u88c5\u6210\u4e00\u4e2a`bio_job`\u7ed3\u6784\uff0c\u7136\u540e\u8ffd\u52a0\u5230\u94fe\u8868\u5c3e\u90e8\u3002\u5f02\u6b65\u7ebf\u7a0b\u901a\u8fc7\u904d\u5386\u94fe\u8868\u6458\u53d6 job \u5143\u7d20\u6765\u6328\u4e2a\u6267\u884c\u5f02\u6b65\u4efb\u52a1\u3002\n\n```c\nstruct bio_job {\n    time_t time;  // \u65f6\u95f4\u5b57\u6bb5\u6682\u65f6\u6ca1\u6709\u4f7f\u7528\uff0c\u5e94\u8be5\u662f\u9884\u7559\u7684\n    void *arg1, *arg2, *arg3;\n};\n```\n\n\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u4e2a job \u7ed3\u6784\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u4e3a\u4ec0\u4e48\u5220\u9664\u5bf9\u8c61\u9700\u8981\u4e09\u4e2a\u53c2\u6570\u5462\uff1f\u6211\u4eec\u7ee7\u7eed\u770b\u4ee3\u7801\uff1a\n\n```c\n    /* What we free changes depending on what arguments are set:\n     * arg1 -> free the object at pointer.\n     * arg2 & arg3 -> free two dictionaries (a Redis DB).\n     * only arg3 -> free the skiplist. */\n    if (job->arg1)\n        // \u91ca\u653e\u4e00\u4e2a\u666e\u901a\u5bf9\u8c61\uff0cstring/set/zset/hash \u7b49\u7b49\uff0c\u7528\u4e8e\u666e\u901a\u5bf9\u8c61\u7684\u5f02\u6b65\u5220\u9664\n        lazyfreeFreeObjectFromBioThread(job->arg1);\n    else if (job->arg2 && job->arg3)\n        // \u91ca\u653e\u5168\u5c40 redisDb \u5bf9\u8c61\u7684 dict \u5b57\u5178\u548c expires \u5b57\u5178\uff0c\u7528\u4e8e flushdb\n        lazyfreeFreeDatabaseFromBioThread(job->arg2,job->arg3);\n    else if (job->arg3)\n        // \u91ca\u653e Cluster \u7684 slots_to_keys \u5bf9\u8c61\uff0c\u53c2\u89c1\u6e90\u7801\u7bc7\u7684\u300c\u57fa\u6570\u6811\u300d\u5c0f\u8282\n        lazyfreeFreeSlotsMapFromBioThread(job->arg3);\n```\n\n\u53ef\u4ee5\u770b\u5230\u901a\u8fc7\u7ec4\u5408\u8fd9\u4e09\u4e2a\u53c2\u6570\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u7ed3\u6784\u7684\u91ca\u653e\u903b\u8f91\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u7ee7\u7eed\u8ffd\u8e2a\u666e\u901a\u5bf9\u8c61\u7684\u5f02\u6b65\u5220\u9664`lazyfreeFreeObjectFromBioThread`\u662f\u5982\u4f55\u8fdb\u884c\u7684\uff0c\u8bf7\u4ed4\u7ec6\u9605\u8bfb\u4ee3\u7801\u6ce8\u91ca\u3002\n\n```c\nvoid lazyfreeFreeObjectFromBioThread(robj *o) {\n    decrRefCount(o); // \u964d\u4f4e\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\uff0c\u5982\u679c\u4e3a\u96f6\uff0c\u5c31\u91ca\u653e\n    atomicDecr(lazyfree_objects,1); // lazyfree_objects \u4e3a\u5f85\u91ca\u653e\u5bf9\u8c61\u7684\u6570\u91cf\uff0c\u7528\u4e8e\u7edf\u8ba1\n}\n\n// \u51cf\u5c11\u5f15\u7528\u8ba1\u6570\nvoid decrRefCount(robj *o) {\n    if (o->refcount == 1) {\n        // \u8be5\u91ca\u653e\u5bf9\u8c61\u4e86\n        switch(o->type) {\n        case OBJ_STRING: freeStringObject(o); break;\n        case OBJ_LIST: freeListObject(o); break;\n        case OBJ_SET: freeSetObject(o); break;\n        case OBJ_ZSET: freeZsetObject(o); break;\n        case OBJ_HASH: freeHashObject(o); break;  // \u91ca\u653e hash \u5bf9\u8c61\uff0c\u7ee7\u7eed\u8ffd\u8e2a\n        case OBJ_MODULE: freeModuleObject(o); break;\n        case OBJ_STREAM: freeStreamObject(o); break;\n        default: serverPanic(\"Unknown object type\"); break;\n        }\n        zfree(o);\n    } else {\n        if (o->refcount <= 0) serverPanic(\"decrRefCount against refcount <= 0\");\n        if (o->refcount != OBJ_SHARED_REFCOUNT) o->refcount--; // \u5f15\u7528\u8ba1\u6570\u51cf 1\n    }\n}\n\n// \u91ca\u653e hash \u5bf9\u8c61\nvoid freeHashObject(robj *o) {\n    switch (o->encoding) {\n    case OBJ_ENCODING_HT:\n        // \u91ca\u653e\u5b57\u5178\uff0c\u6211\u4eec\u7ee7\u7eed\u8ffd\u8e2a\n        dictRelease((dict*) o->ptr);\n        break;\n    case OBJ_ENCODING_ZIPLIST:\n        // \u5982\u679c\u662f\u538b\u7f29\u5217\u8868\u53ef\u4ee5\u76f4\u63a5\u91ca\u653e\n        // \u56e0\u4e3a\u538b\u7f29\u5217\u8868\u662f\u4e00\u6574\u5757\u5b57\u8282\u6570\u7ec4\n        zfree(o->ptr);\n        break;\n    default:\n        serverPanic(\"Unknown hash encoding type\");\n        break;\n    }\n}\n\n// \u91ca\u653e\u5b57\u5178\uff0c\u5982\u679c\u5b57\u5178\u6b63\u5728\u8fc1\u79fb\u4e2d\uff0cht[0] \u548c ht[1] \u5206\u522b\u5b58\u50a8\u65e7\u5b57\u5178\u548c\u65b0\u5b57\u5178\nvoid dictRelease(dict *d)\n{\n    _dictClear(d,&d->ht[0],NULL); // \u7ee7\u7eed\u8ffd\u8e2a\n    _dictClear(d,&d->ht[1],NULL);\n    zfree(d);\n}\n\n// \u8fd9\u91cc\u8981\u91ca\u653e hashtable \u4e86\n// \u9700\u8981\u904d\u5386\u7b2c\u4e00\u7ef4\u6570\u7ec4\uff0c\u7136\u540e\u7ee7\u7eed\u904d\u5386\u7b2c\u4e8c\u7ef4\u94fe\u8868\uff0c\u53cc\u91cd\u5faa\u73af\nint _dictClear(dict *d, dictht *ht, void(callback)(void *)) {\n    unsigned long i;\n\n    /* Free all the elements */\n    for (i = 0; i < ht->size && ht->used > 0; i++) {\n        dictEntry *he, *nextHe;\n\n        if (callback && (i & 65535) == 0) callback(d->privdata);\n\n        if ((he = ht->table[i]) == NULL) continue;\n        while(he) {\n            nextHe = he->next;\n            dictFreeKey(d, he); // \u5148\u91ca\u653e key\n            dictFreeVal(d, he); // \u518d\u91ca\u653e value\n            zfree(he); // \u6700\u540e\u91ca\u653e entry\n            ht->used--;\n            he = nextHe;\n        }\n    }\n    /* Free the table and the allocated cache structure */\n    zfree(ht->table); // \u53ef\u4ee5\u56de\u6536\u7b2c\u4e00\u7ef4\u6570\u7ec4\u4e86\n    /* Re-initialize the table */\n    _dictReset(ht);\n    return DICT_OK; /* never fails */\n}\n```\n\u8fd9\u4e9b\u4ee3\u7801\u6563\u843d\u5728\u591a\u4e2a\u4e0d\u540c\u7684\u6587\u4ef6\uff0c\u6211\u5c06\u5b83\u4eec\u51d1\u5230\u4e86\u4e00\u5757\u4fbf\u4e8e\u8bfb\u8005\u9605\u8bfb\u3002\u4ece\u4ee3\u7801\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u91ca\u653e\u4e00\u4e2a\u5bf9\u8c61\u8981\u6df1\u5ea6\u8c03\u7528\u4e00\u7cfb\u5217\u51fd\u6570\uff0c\u6bcf\u79cd\u5bf9\u8c61\u90fd\u6709\u5b83\u72ec\u7279\u7684\u5185\u5b58\u56de\u6536\u903b\u8f91\u3002\n\n## \u961f\u5217\u5b89\u5168\n\n\u524d\u9762\u63d0\u5230\u4efb\u52a1\u961f\u5217\u662f\u4e00\u4e2a\u4e0d\u5b89\u5168\u7684\u53cc\u5411\u94fe\u8868\uff0c\u9700\u8981\u4f7f\u7528\u9501\u6765\u4fdd\u62a4\u5b83\u3002\u5f53\u4e3b\u7ebf\u7a0b\u5c06\u4efb\u52a1\u8ffd\u52a0\u5230\u961f\u5217\u4e4b\u524d\u5b83\u9700\u8981\u52a0\u9501\uff0c\u8ffd\u52a0\u5b8c\u6bd5\u540e\uff0c\u518d\u91ca\u653e\u9501\uff0c\u8fd8\u9700\u8981\u5524\u9192\u5f02\u6b65\u7ebf\u7a0b\uff0c\u5982\u679c\u5b83\u5728\u4f11\u7720\u7684\u8bdd\u3002\n```c\nvoid bioCreateBackgroundJob(int type, void *arg1, void *arg2, void *arg3) {\n    struct bio_job *job = zmalloc(sizeof(*job));\n\n    job->time = time(NULL);\n    job->arg1 = arg1;\n    job->arg2 = arg2;\n    job->arg3 = arg3;\n    pthread_mutex_lock(&bio_mutex[type]); // \u52a0\u9501\n    listAddNodeTail(bio_jobs[type],job); // \u8ffd\u52a0\u4efb\u52a1\n    bio_pending[type]++; // \u8ba1\u6570\n    pthread_cond_signal(&bio_newjob_cond[type]); // \u5524\u9192\u5f02\u6b65\u7ebf\u7a0b\n    pthread_mutex_unlock(&bio_mutex[type]); // \u91ca\u653e\u9501\n}\n```\n\n\u5f02\u6b65\u7ebf\u7a0b\u9700\u8981\u5bf9\u4efb\u52a1\u961f\u5217\u8fdb\u884c\u8f6e\u8bad\u5904\u7406\uff0c\u4f9d\u6b21\u4ece\u94fe\u8868\u8868\u5934\u6458\u53d6\u5143\u7d20\u9010\u4e2a\u5904\u7406\u3002\u6458\u53d6\u5143\u7d20\u7684\u65f6\u5019\u4e5f\u9700\u8981\u52a0\u9501\uff0c\u6458\u51fa\u6765\u4e4b\u540e\u518d\u89e3\u9501\u3002\u5982\u679c\u4e00\u4e2a\u5143\u7d20\u90fd\u6ca1\u6709\uff0c\u5b83\u9700\u8981\u7b49\u5f85\uff0c\u76f4\u5230\u4e3b\u7ebf\u7a0b\u6765\u5524\u9192\u5b83\u7ee7\u7eed\u5de5\u4f5c\u3002\n\n```c\n// \u5f02\u6b65\u7ebf\u7a0b\u6267\u884c\u903b\u8f91\nvoid *bioProcessBackgroundJobs(void *arg) {\n...\n    pthread_mutex_lock(&bio_mutex[type]); // \u5148\u52a0\u9501\n    ...\n    // \u5faa\u73af\u5904\u7406\n    while(1) {\n        listNode *ln;\n\n        /* The loop always starts with the lock hold. */\n        if (listLength(bio_jobs[type]) == 0) {\n            // \u5bf9\u5217\u7a7a\uff0c\u90a3\u5c31\u7761\u89c9\u5427\n            pthread_cond_wait(&bio_newjob_cond[type],&bio_mutex[type]);\n            continue;\n        }\n        /* Pop the job from the queue. */\n        ln = listFirst(bio_jobs[type]); // \u83b7\u53d6\u961f\u5217\u5934\u5143\u7d20\n        job = ln->value;\n        /* It is now possible to unlock the background system as we know have\n         * a stand alone job structure to process.*/\n        pthread_mutex_unlock(&bio_mutex[type]); // \u91ca\u653e\u9501\n\n        // \u8fd9\u91cc\u662f\u5904\u7406\u8fc7\u7a0b\uff0c\u4e3a\u4e86\u7701\u7eb8\uff0c\u5c31\u7565\u53bb\u4e86\n        ...\n        \n        // \u91ca\u653e\u4efb\u52a1\u5bf9\u8c61\n        zfree(job);\n\n        ...\n        \n        // \u518d\u6b21\u52a0\u9501\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2a\u5143\u7d20\n        pthread_mutex_lock(&bio_mutex[type]);\n        // \u56e0\u4e3a\u4efb\u52a1\u5df2\u7ecf\u5904\u7406\u5b8c\u4e86\uff0c\u53ef\u4ee5\u653e\u5fc3\u4ece\u94fe\u8868\u4e2d\u5220\u9664\u8282\u70b9\u4e86\n        listDelNode(bio_jobs[type],ln);\n        bio_pending[type]--; // \u8ba1\u6570\u51cf 1\n    }\n```\n\n\u7814\u7a76\u5b8c\u8fd9\u4e9b\u52a0\u9501\u89e3\u9501\u7684\u4ee3\u7801\u540e\uff0c\u6211\u5f00\u59cb\u6709\u70b9\u5f53\u5fc3\u4e3b\u7ebf\u7a0b\u7684\u6027\u80fd\u3002\u6211\u4eec\u90fd\u77e5\u9053\u52a0\u9501\u89e3\u9501\u662f\u4e00\u4e2a\u76f8\u5bf9\u6bd4\u8f83\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u5c24\u5176\u662f\u60b2\u89c2\u9501\u6700\u4e3a\u8017\u65f6\u3002\u5982\u679c\u5220\u9664\u5f88\u9891\u7e41\uff0c\u4e3b\u7ebf\u7a0b\u5c82\u4e0d\u662f\u8981\u9891\u7e41\u52a0\u9501\u89e3\u9501\u3002\u6240\u4ee5\u8fd9\u91cc\u80af\u5b9a\u8fd8\u6709\u4f18\u5316\u7a7a\u95f4\uff0cJava \u7684 ConcurrentLinkQueue \u5c31\u6ca1\u6709\u4f7f\u7528\u8fd9\u6837\u7c97\u7c92\u5ea6\u7684\u60b2\u89c2\u9501\uff0c\u5b83\u4f18\u5148\u4f7f\u7528 cas \u6765\u63a7\u5236\u5e76\u53d1\u3002\n\n## \u601d\u8003\n\n1. Redis \u8fd8\u6709\u5176\u5b83\u5730\u65b9\u7528\u5230\u4e86\u5bf9\u8c61\u5171\u4eab\u673a\u5236\u4e48\uff1f\n2. Java \u7684 ConcurrentLinkQueue \u5177\u4f53\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/41\u6e90\u7801_9\u5982\u5c65\u8584\u51b0__\u61d2\u60f0\u5220\u9664\u7684\u5de8\u5927\u727a\u7272.md", "create_date": "2020-02-18T03:01:06.259", "order": 42}}, {"model": "subject.chapter", "pk": 49, "fields": {"title": "42\u6e90\u7801 10\uff1a\u8dcb\u5c71\u6d89\u6c34 \u2014\u2014 \u6df1\u5165\u5b57\u5178\u904d\u5386", "topic": 2, "md5": "71b1e9502955aaf8c46c2dfa0aae7b2e", "md_body": "# \u6e90\u7801 10\uff1a\u8dcb\u5c71\u6d89\u6c34 \u2014\u2014 \u6df1\u5165\u5b57\u5178\u904d\u5386\r\n\r\nRedis \u5b57\u5178\u7684\u904d\u5386\u8fc7\u7a0b\u903b\u8f91\u6bd4\u8f83\u590d\u6742\uff0c\u4e92\u8054\u7f51\u4e0a\u5bf9\u8fd9\u4e00\u5757\u7684\u5206\u6790\u8bb2\u89e3\u975e\u5e38\u5c11\u3002\u6211\u4e5f\u82b1\u4e86\u4e0d\u5c11\u65f6\u95f4\u5bf9\u6e90\u7801\u7684\u7ec6\u8282\u8fdb\u884c\u4e86\u6574\u7406\uff0c\u5c06\u6211\u4e2a\u4eba\u5bf9\u5b57\u5178\u904d\u5386\u903b\u8f91\u7684\u7406\u89e3\u5448\u73b0\u7ed9\u5404\u4f4d\u8bfb\u8005\u3002\u4e5f\u8bb8\u8bfb\u8005\u4eec\u5bf9\u5b57\u5178\u7684\u904d\u5386\u8fc7\u7a0b\u6709\u6bd4\u6211\u66f4\u597d\u7684\u7406\u89e3\uff0c\u8fd8\u8bf7\u4e0d\u541d\u6307\u6559\u3002\r\n\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/8/15/1653bd1a8cbe5f4d?w=485&h=370&f=png&s=31214)\r\n\r\n## \u4e00\u8fb9\u904d\u5386\u4e00\u8fb9\u4fee\u6539\r\n\r\n\u6211\u4eec\u77e5\u9053 Redis \u5bf9\u8c61\u6811\u7684\u4e3b\u5e72\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5982\u679c\u5bf9\u8c61\u5f88\u591a\uff0c\u8fd9\u4e2a\u4e3b\u5e72\u5b57\u5178\u4e5f\u4f1a\u5f88\u5927\u3002\u5f53\u6211\u4eec\u4f7f\u7528 `keys` \u547d\u4ee4\u641c\u5bfb\u6307\u5b9a\u6a21\u5f0f\u7684 key \u65f6\uff0c\u5b83\u4f1a\u904d\u5386\u6574\u4e2a\u4e3b\u5e72\u5b57\u5178\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5728\u904d\u5386\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6ee1\u8db3\u6a21\u5f0f\u5339\u914d\u6761\u4ef6\u7684 key \u88ab\u627e\u5230\u4e86\uff0c\u8fd8\u9700\u8981\u5224\u65ad key \u6307\u5411\u7684\u5bf9\u8c61\u662f\u5426\u5df2\u7ecf\u8fc7\u671f\u3002\u5982\u679c\u8fc7\u671f\u4e86\u5c31\u9700\u8981\u4ece\u4e3b\u5e72\u5b57\u5178\u4e2d\u5c06\u8be5 key \u5220\u9664\u3002\r\n\r\n```c\r\nvoid keysCommand(client *c) {\r\n    dictIterator *di; // \u8fed\u4ee3\u5668\r\n    dictEntry *de; // \u8fed\u4ee3\u5668\u5f53\u524d\u7684entry\r\n    sds pattern = c->argv[1]->ptr; // keys\u7684\u5339\u914d\u6a21\u5f0f\u53c2\u6570\r\n    int plen = sdslen(pattern);\r\n    int allkeys; // \u662f\u5426\u8981\u83b7\u53d6\u6240\u6709key\uff0c\u7528\u4e8ekeys *\u8fd9\u6837\u7684\u6307\u4ee4\r\n    unsigned long numkeys = 0;\r\n    void *replylen = addDeferredMultiBulkLength(c);\r\n\r\n    // why safe? \r\n    di = dictGetSafeIterator(c->db->dict);\r\n    allkeys = (pattern[0] == '*' && pattern[1] == '\\0');\r\n    while((de = dictNext(di)) != NULL) {\r\n        sds key = dictGetKey(de);\r\n        robj *keyobj;\r\n\r\n        if (allkeys || stringmatchlen(pattern,plen,key,sdslen(key),0)) {\r\n            keyobj = createStringObject(key,sdslen(key));\r\n            // \u5224\u65ad\u662f\u5426\u8fc7\u671f\uff0c\u8fc7\u671f\u4e86\u8981\u5220\u9664\u5143\u7d20\r\n            if (expireIfNeeded(c->db,keyobj) == 0) {\r\n                addReplyBulk(c,keyobj);\r\n                numkeys++;\r\n            }\r\n            decrRefCount(keyobj);\r\n        }\r\n    }\r\n    dictReleaseIterator(di);\r\n    setDeferredMultiBulkLength(c,replylen,numkeys);\r\n}\r\n```\r\n\r\n\u90a3\u4e48\uff0c\u4f60\u662f\u5426\u60f3\u5230\u4e86\u5176\u4e2d\u7684\u56f0\u96be\u4e4b\u5904\uff0c\u5728\u904d\u5386\u5b57\u5178\u7684\u65f6\u5019\u8fd8\u9700\u8981\u4fee\u6539\u5b57\u5178\uff0c\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u6307\u9488\u5b89\u5168\u95ee\u9898\uff1f\r\n\r\n## \u91cd\u590d\u904d\u5386\r\n\r\n\u5b57\u5178\u5728\u6269\u5bb9\u7684\u65f6\u5019\u8981\u8fdb\u884c\u6e10\u8fdb\u5f0f\u8fc1\u79fb\uff0c\u4f1a\u5b58\u5728\u65b0\u65e7\u4e24\u4e2a hashtable\u3002\u904d\u5386\u9700\u8981\u5bf9\u8fd9\u4e24\u4e2a hashtable \u4f9d\u6b21\u8fdb\u884c\uff0c\u5148\u904d\u5386\u5b8c\u65e7\u7684 hashtable\uff0c\u518d\u7ee7\u7eed\u904d\u5386\u65b0\u7684 hashtable\u3002\u5982\u679c\u5728\u904d\u5386\u7684\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u4e86 rehashStep\uff0c\u5c06\u5df2\u7ecf\u904d\u5386\u8fc7\u7684\u65e7\u7684 hashtable \u7684\u5143\u7d20\u8fc1\u79fb\u5230\u4e86\u65b0\u7684 hashtable \u4e2d\uff0c\u90a3\u4e48\u904d\u5386\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u5143\u7d20\u7684\u91cd\u590d\uff1f\u8fd9\u4e5f\u662f\u904d\u5386\u9700\u8981\u8003\u8651\u7684\u7591\u96be\u4e4b\u5904\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b Redis \u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u3002\r\n\r\n## \u8fed\u4ee3\u5668\u7684\u7ed3\u6784\r\n\r\nRedis \u4e3a\u5b57\u5178\u7684\u904d\u5386\u63d0\u4f9b\u4e86 2 \u79cd\u8fed\u4ee3\u5668\uff0c\u4e00\u79cd\u662f\u5b89\u5168\u8fed\u4ee3\u5668\uff0c\u53e6\u4e00\u79cd\u662f\u4e0d\u5b89\u5168\u8fed\u4ee3\u5668\u3002\r\n\r\n```c\r\ntypedef struct dictIterator {\r\n    dict *d; // \u76ee\u6807\u5b57\u5178\u5bf9\u8c61\r\n    long index; // \u5f53\u524d\u904d\u5386\u7684\u69fd\u4f4d\u7f6e\uff0c\u521d\u59cb\u5316\u4e3a-1\r\n    int table; // ht[0] or ht[1]\r\n    int safe; // \u8fd9\u4e2a\u5c5e\u6027\u975e\u5e38\u5173\u952e\uff0c\u5b83\u8868\u793a\u8fed\u4ee3\u5668\u662f\u5426\u5b89\u5168\r\n    dictEntry *entry; // \u8fed\u4ee3\u5668\u5f53\u524d\u6307\u5411\u7684\u5bf9\u8c61\r\n    dictEntry *nextEntry; // \u8fed\u4ee3\u5668\u4e0b\u4e00\u4e2a\u6307\u5411\u7684\u5bf9\u8c61\r\n    long long fingerprint; // \u8fed\u4ee3\u5668\u6307\u7eb9\uff0c\u653e\u7f6e\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\u5b57\u5178\u88ab\u4fee\u6539\r\n} dictIterator;\r\n\r\n// \u83b7\u53d6\u975e\u5b89\u5168\u8fed\u4ee3\u5668\uff0c\u53ea\u8bfb\u8fed\u4ee3\u5668\uff0c\u5141\u8bb8rehashStep\r\ndictIterator *dictGetIterator(dict *d)\r\n{\r\n    dictIterator *iter = zmalloc(sizeof(*iter));\r\n\r\n    iter->d = d;\r\n    iter->table = 0;\r\n    iter->index = -1;\r\n    iter->safe = 0;\r\n    iter->entry = NULL;\r\n    iter->nextEntry = NULL;\r\n    return iter;\r\n}\r\n\r\n// \u83b7\u53d6\u5b89\u5168\u8fed\u4ee3\u5668\uff0c\u5141\u8bb8\u89e6\u53d1\u8fc7\u671f\u5904\u7406\uff0c\u7981\u6b62rehashStep\r\ndictIterator *dictGetSafeIterator(dict *d) {\r\n    dictIterator *i = dictGetIterator(d);\r\n\r\n    i->safe = 1;\r\n    return i;\r\n}\r\n```\r\n\r\n\u8fed\u4ee3\u5668\u7684\u300c\u5b89\u5168\u300d\u6307\u7684\u662f\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u5bf9\u5b57\u5178\u8fdb\u884c\u67e5\u627e\u548c\u4fee\u6539\uff0c\u4e0d\u7528\u611f\u5230\u62c5\u5fc3\uff0c\u56e0\u4e3a\u67e5\u627e\u548c\u4fee\u6539\u4f1a\u89e6\u53d1\u8fc7\u671f\u5224\u65ad\uff0c\u4f1a\u5220\u9664\u5185\u90e8\u5143\u7d20\u3002\u300c\u5b89\u5168\u300d\u7684\u53e6\u4e00\u5c42\u610f\u601d\u662f\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u5143\u7d20\u91cd\u590d\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u91cd\u590d\uff0c\u5c31\u4f1a\u7981\u6b62 rehashStep\u3002\r\n\r\n\u800c\u300c\u4e0d\u5b89\u5168\u300d\u7684\u8fed\u4ee3\u5668\u662f\u6307\u904d\u5386\u8fc7\u7a0b\u4e2d\u5b57\u5178\u662f\u53ea\u8bfb\u7684\uff0c\u4f60\u4e0d\u53ef\u4ee5\u4fee\u6539\uff0c\u4f60\u53ea\u80fd\u8c03\u7528 dictNext \u5bf9\u5b57\u5178\u8fdb\u884c\u6301\u7eed\u904d\u5386\uff0c\u4e0d\u5f97\u8c03\u7528\u4efb\u4f55\u53ef\u80fd\u89e6\u53d1\u8fc7\u671f\u5224\u65ad\u7684\u51fd\u6570\u3002\u4e0d\u8fc7\u597d\u5904\u662f\u4e0d\u5f71\u54cd rehash\uff0c\u4ee3\u4ef7\u5c31\u662f\u904d\u5386\u7684\u5143\u7d20\u53ef\u80fd\u4f1a\u51fa\u73b0\u91cd\u590d\u3002\r\n\r\n\u5b89\u5168\u8fed\u4ee3\u5668\u5728\u521a\u5f00\u59cb\u904d\u5386\u65f6\uff0c\u4f1a\u7ed9\u5b57\u5178\u6253\u4e0a\u4e00\u4e2a\u6807\u8bb0\uff0c\u6709\u4e86\u8fd9\u4e2a\u6807\u8bb0\uff0crehashStep \u5c31\u4e0d\u4f1a\u6267\u884c\uff0c\u904d\u5386\u65f6\u5143\u7d20\u5c31\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d\u3002\r\n\r\n```c\r\ntypedef struct dict {\r\n    dictType *type;\r\n    void *privdata;\r\n    dictht ht[2];\r\n    long rehashidx;\r\n    // \u8fd9\u4e2a\u5c31\u662f\u6807\u8bb0\uff0c\u5b83\u8868\u793a\u5f53\u524d\u52a0\u5728\u5b57\u5178\u4e0a\u7684\u5b89\u5168\u8fed\u4ee3\u5668\u7684\u6570\u91cf\r\n    unsigned long iterators;\r\n} dict;\r\n\r\n// \u5982\u679c\u5b58\u5728\u5b89\u5168\u7684\u8fed\u4ee3\u5668\uff0c\u5c31\u7981\u6b62rehash\r\nstatic void _dictRehashStep(dict *d) {\r\n    if (d->iterators == 0) dictRehash(d,1);\r\n}\r\n```\r\n\r\n## \u8fed\u4ee3\u8fc7\u7a0b\r\n\r\n\u5b89\u5168\u7684\u8fed\u4ee3\u5668\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\u5141\u8bb8\u5220\u9664\u5143\u7d20\uff0c\u610f\u5473\u7740\u5b57\u5178\u7b2c\u4e00\u7ef4\u6570\u7ec4\u4e0b\u9762\u6302\u63a5\u7684\u94fe\u8868\u4e2d\u7684\u5143\u7d20\u53ef\u80fd\u4f1a\u88ab\u6458\u8d70\uff0c\u5143\u7d20\u7684 next \u6307\u9488\u5c31\u4f1a\u53d1\u751f\u53d8\u52a8\uff0c\u8fd9\u662f\u5426\u4f1a\u5f71\u54cd\u8fed\u4ee3\u8fc7\u7a0b\u5462\uff1f\u4e0b\u9762\u6211\u4eec\u4ed4\u7ec6\u7814\u7a76\u4e00\u4e0b\u8fed\u4ee3\u51fd\u6570\u7684\u4ee3\u7801\u903b\u8f91\u3002\r\n\r\n```\r\ndictEntry *dictNext(dictIterator *iter)\r\n{\r\n    while (1) {\r\n        if (iter->entry == NULL) {\r\n            // \u904d\u5386\u4e00\u4e2a\u65b0\u69fd\u4f4d\u4e0b\u9762\u7684\u94fe\u8868\uff0c\u6570\u7ec4\u7684index\u5f80\u524d\u79fb\u52a8\u4e86\r\n            dictht *ht = &iter->d->ht[iter->table];\r\n            if (iter->index == -1 && iter->table == 0) {\r\n                // \u7b2c\u4e00\u6b21\u904d\u5386\uff0c\u521a\u521a\u8fdb\u5165\u904d\u5386\u8fc7\u7a0b\r\n                // \u4e5f\u5c31\u662fht[0]\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4e0b\u9762\u7684\u94fe\u8868\r\n                if (iter->safe) {\r\n                  // \u7ed9\u5b57\u5178\u6253\u5b89\u5168\u6807\u8bb0\uff0c\u7981\u6b62\u5b57\u5178\u8fdb\u884crehash\r\n                  iter->d->iterators++;\r\n                } else {\r\n                  // \u8bb0\u5f55\u8fed\u4ee3\u5668\u6307\u7eb9\uff0c\u5c31\u597d\u6bd4\u5b57\u5178\u7684md5\u503c\r\n                  // \u5982\u679c\u904d\u5386\u8fc7\u7a0b\u4e2d\u5b57\u5178\u6709\u4efb\u4f55\u53d8\u52a8\uff0c\u6307\u7eb9\u5c31\u4f1a\u6539\u53d8\r\n                  iter->fingerprint = dictFingerprint(iter->d);\r\n                }      \r\n            }\r\n            iter->index++; // index=0\uff0c\u6b63\u5f0f\u8fdb\u5165\u7b2c\u4e00\u4e2a\u69fd\u4f4d\r\n            if (iter->index >= (long) ht->size) {\r\n                // \u6700\u540e\u4e00\u4e2a\u69fd\u4f4d\u90fd\u904d\u5386\u5b8c\u4e86\r\n                if (dictIsRehashing(iter->d) && iter->table == 0) {\r\n                    // \u5982\u679c\u5904\u4e8erehash\u4e2d\uff0c\u90a3\u5c31\u7ee7\u7eed\u904d\u5386\u7b2c\u4e8c\u4e2a hashtable\r\n                    iter->table++;\r\n                    iter->index = 0;\r\n                    ht = &iter->d->ht[1];\r\n                } else {\r\n                    // \u7ed3\u675f\u904d\u5386\r\n                    break;\r\n                }\r\n            }\r\n            // \u5c06\u5f53\u524d\u904d\u5386\u7684\u5143\u7d20\u8bb0\u5f55\u5230\u8fed\u4ee3\u5668\u4e2d\r\n            iter->entry = ht->table[iter->index];\r\n        } else {\r\n            // \u76f4\u63a5\u5c06\u4e0b\u4e00\u4e2a\u5143\u7d20\u8bb0\u5f55\u4e3a\u672c\u6b21\u8fed\u4ee3\u7684\u5143\u7d20\r\n            iter->entry = iter->nextEntry;\r\n        }\r\n        if (iter->entry) {\r\n            // \u5c06\u4e0b\u4e00\u4e2a\u5143\u7d20\u4e5f\u8bb0\u5f55\u5230\u8fed\u4ee3\u5668\u4e2d\uff0c\u8fd9\u70b9\u975e\u5e38\u5173\u952e\r\n            // \u9632\u6b62\u5b89\u5168\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\u5f53\u524d\u5143\u7d20\u88ab\u8fc7\u671f\u5220\u9664\u540e\uff0c\u627e\u4e0d\u5230\u4e0b\u4e00\u4e2a\u9700\u8981\u904d\u5386\u7684\u5143\u7d20\r\n            \r\n            // \u8bd5\u60f3\u5982\u679c\u540e\u9762\u53d1\u751f\u4e86rehash\uff0c\u5f53\u524d\u904d\u5386\u7684\u94fe\u8868\u88ab\u6253\u6563\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\r\n            // \u8fd9\u91cc\u8981\u4f7f\u52b2\u53d1\u6325\u81ea\u5df1\u7684\u60f3\u8c61\u529b\u6765\u7406\u89e3\r\n            // \u65e7\u7684\u94fe\u8868\u5c06\u4e00\u5206\u4e3a\u4e8c\uff0c\u6253\u6563\u540e\u91cd\u65b0\u6302\u63a5\u5230\u65b0\u6570\u7ec4\u7684\u4e24\u4e2a\u69fd\u4f4d\u4e0b\r\n            // \u7ed3\u679c\u5c31\u662f\u4f1a\u5bfc\u81f4\u5f53\u524d\u94fe\u8868\u4e0a\u7684\u5143\u7d20\u4f1a\u91cd\u590d\u904d\u5386\r\n            \r\n            // \u5982\u679crehash\u7684\u94fe\u8868\u662findex\u524d\u9762\u7684\u94fe\u8868\uff0c\u90a3\u4e48\u8fd9\u90e8\u5206\u94fe\u8868\u4e5f\u4f1a\u88ab\u91cd\u590d\u904d\u5386\r\n            iter->nextEntry = iter->entry->next;\r\n            return iter->entry;\r\n        }\r\n    }\r\n    return NULL;\r\n}\r\n\r\n// \u904d\u5386\u5b8c\u6210\u540e\u8981\u91ca\u653e\u8fed\u4ee3\u5668\uff0c\u5b89\u5168\u8fed\u4ee3\u5668\u9700\u8981\u53bb\u6389\u5b57\u5178\u7684\u7981\u6b62rehash\u7684\u6807\u8bb0\r\n// \u975e\u5b89\u5168\u8fed\u4ee3\u5668\u8fd8\u9700\u8981\u68c0\u67e5\u6307\u7eb9\uff0c\u5982\u679c\u6709\u53d8\u52a8\uff0c\u670d\u52a1\u5668\u5c31\u4f1a\u5954\u6e83(failfast)\r\nvoid dictReleaseIterator(dictIterator *iter)\r\n{\r\n    if (!(iter->index == -1 && iter->table == 0)) {\r\n        if (iter->safe)\r\n            iter->d->iterators--; // \u53bb\u6389\u7981\u6b62rehash\u7684\u6807\u8bb0\r\n        else\r\n            assert(iter->fingerprint == dictFingerprint(iter->d));\r\n    }\r\n    zfree(iter);\r\n}\r\n\r\n// \u8ba1\u7b97\u5b57\u5178\u7684\u6307\u7eb9\uff0c\u5c31\u662f\u5c06\u5b57\u5178\u7684\u5173\u952e\u5b57\u6bb5\u8fdb\u884c\u6309\u4f4d\u7cc5\u5408\u5230\u4e00\u8d77\r\n// \u8fd9\u6837\u53ea\u8981\u6709\u4efb\u610f\u7684\u7ed3\u6784\u53d8\u52a8\uff0c\u6307\u7eb9\u90fd\u4f1a\u53d1\u751f\u53d8\u5316\r\n// \u5982\u679c\u53ea\u662f\u67d0\u4e2a\u5143\u7d20\u7684value\u88ab\u4fee\u6539\u4e86\uff0c\u6307\u7eb9\u4e0d\u4f1a\u53d1\u751f\u53d8\u52a8\r\nlong long dictFingerprint(dict *d) {\r\n    long long integers[6], hash = 0;\r\n    int j;\r\n\r\n    integers[0] = (long) d->ht[0].table;\r\n    integers[1] = d->ht[0].size;\r\n    integers[2] = d->ht[0].used;\r\n    integers[3] = (long) d->ht[1].table;\r\n    integers[4] = d->ht[1].size;\r\n    integers[5] = d->ht[1].used;\r\n\r\n    for (j = 0; j < 6; j++) {\r\n        hash += integers[j];\r\n        hash = (~hash) + (hash << 21);\r\n        hash = hash ^ (hash >> 24);\r\n        hash = (hash + (hash << 3)) + (hash << 8);\r\n        hash = hash ^ (hash >> 14);\r\n        hash = (hash + (hash << 2)) + (hash << 4);\r\n        hash = hash ^ (hash >> 28);\r\n        hash = hash + (hash << 31);\r\n    }\r\n    return hash;\r\n}\r\n```\r\n\r\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\u5728\u5b57\u5178\u6269\u5bb9\u65f6\u8fdb\u884c rehash\uff0c\u5c06\u65e7\u6570\u7ec4\u4e2d\u7684\u94fe\u8868\u8fc1\u79fb\u5230\u65b0\u7684\u6570\u7ec4\u4e2d\u3002\u67d0\u4e2a\u5177\u4f53\u69fd\u4f4d\u4e0b\u7684\u94fe\u8868\u53ea\u53ef\u80fd\u4f1a\u8fc1\u79fb\u5230\u65b0\u6570\u7ec4\u7684\u4e24\u4e2a\u69fd\u4f4d\u4e2d\u3002\r\n\r\n```\r\nhash mod 2^n = k\r\nhash mod 2^(n+1) = k or k+2^n\r\n```\r\n\r\n## \u8fed\u4ee3\u5668\u7684\u9009\u62e9\r\n\r\n\u9664\u4e86 `keys` \u6307\u4ee4\u4f7f\u7528\u4e86\u5b89\u5168\u8fed\u4ee3\u5668\uff0c\u56e0\u4e3a\u7ed3\u679c\u4e0d\u5141\u8bb8\u91cd\u590d\u3002\u90a3\u8fd8\u6709\u5176\u5b83\u7684\u5730\u65b9\u4f7f\u7528\u4e86\u5b89\u5168\u8fed\u4ee3\u5668\u4e48\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u904d\u5386\u9002\u5408\u4f7f\u7528\u975e\u5b89\u5168\u8fed\u4ee3\u5668\u5462\uff1f\r\n\r\n\u7b80\u5355\u4e00\u70b9\u8bf4\uff0c\u90a3\u5c31\u662f\u5982\u679c\u904d\u5386\u8fc7\u7a0b\u4e2d\u4e0d\u5141\u8bb8\u51fa\u73b0\u91cd\u590d\uff0c\u90a3\u5c31\u4f7f\u7528 `SafeIterator`\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u4e24\u79cd\u60c5\u51b5\r\n\r\n1. `bgaofrewrite` \u9700\u8981\u904d\u5386\u6240\u6709\u5bf9\u8c61\u8f6c\u6362\u79f0\u64cd\u4f5c\u6307\u4ee4\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u7edd\u5bf9\u4e0d\u5141\u8bb8\u51fa\u73b0\u91cd\u590d\r\n2. `bgsave` \u4e5f\u9700\u8981\u904d\u5386\u6240\u6709\u5bf9\u8c61\u6765\u6301\u4e45\u5316\uff0c\u540c\u6837\u4e0d\u5141\u8bb8\u51fa\u73b0\u91cd\u590d\r\n\r\n\u5982\u679c\u904d\u5386\u8fc7\u7a0b\u4e2d\u9700\u8981\u5904\u7406\u5143\u7d20\u8fc7\u671f\uff0c\u9700\u8981\u5bf9\u5b57\u5178\u8fdb\u884c\u4fee\u6539\uff0c\u90a3\u4e5f\u5fc5\u987b\u4f7f\u7528 `SafeIterator`\uff0c\u56e0\u4e3a\u975e\u5b89\u5168\u7684\u8fed\u4ee3\u5668\u662f\u53ea\u8bfb\u7684\u3002\r\n\r\n\u5176\u5b83\u60c5\u51b5\u4e0b\uff0c\u4e5f\u5c31\u662f\u5141\u8bb8\u904d\u5386\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e2a\u522b\u5143\u7d20\u91cd\u590d\uff0c\u4e0d\u9700\u8981\u5bf9\u5b57\u5178\u8fdb\u884c\u7ed3\u6784\u6027\u4fee\u6539\u7684\u60c5\u51b5\u4e0b\u4e00\u5f8b\u4f7f\u7528\u975e\u5b89\u5168\u8fed\u4ee3\u5668\u3002\r\n\r\n## \u601d\u8003\r\n\r\n\u8bf7\u7ee7\u7eed\u601d\u8003 `rehash` \u5bf9\u975e\u5b89\u5168\u904d\u5386\u8fc7\u7a0b\u7684\u5f71\u54cd\uff0c\u4f1a\u91cd\u590d\u54ea\u4e9b\u5143\u7d20\uff0c\u91cd\u590d\u7684\u5143\u7d20\u4f1a\u975e\u5e38\u591a\u4e48\u8fd8\u662f\u53ea\u662f\u5c11\u91cf\u91cd\u590d\uff1f", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/42\u6e90\u7801_10\u8dcb\u5c71\u6d89\u6c34__\u6df1\u5165\u5b57\u5178\u904d\u5386.md", "create_date": "2020-02-18T03:01:06.276", "order": 43}}, {"model": "subject.chapter", "pk": 50, "fields": {"title": "43\u6e90\u7801 11\uff1a\u89c1\u7f1d\u63d2\u9488 \u2014\u2014 \u63a2\u7d22 HyperLogLog \u5185\u90e8", "topic": 2, "md5": "187fb4514e7bb16643a4f7825f112ecd", "md_body": "# \u6e90\u7801 11\uff1a\u89c1\u7f1d\u63d2\u9488 \u2014\u2014 \u63a2\u7d22 HyperLogLog \u5185\u90e8\n\nHyperLogLog\u7b97\u6cd5\u662f\u4e00\u79cd\u975e\u5e38\u5de7\u5999\u7684\u8fd1\u4f3c\u7edf\u8ba1\u6d77\u91cf\u53bb\u91cd\u5143\u7d20\u6570\u91cf\u7684\u7b97\u6cd5\u3002\u5b83\u5185\u90e8\u7ef4\u62a4\u4e86 16384 \u4e2a\u6876\uff08bucket\uff09\u6765\u8bb0\u5f55\u5404\u81ea\u6876\u7684\u5143\u7d20\u6570\u91cf\u3002\u5f53\u4e00\u4e2a\u5143\u7d20\u5230\u6765\u65f6\uff0c\u5b83\u4f1a\u6563\u5217\u5230\u5176\u4e2d\u4e00\u4e2a\u6876\uff0c\u4ee5\u4e00\u5b9a\u7684\u6982\u7387\u5f71\u54cd\u8fd9\u4e2a\u6876\u7684\u8ba1\u6570\u503c\u3002\u56e0\u4e3a\u662f\u6982\u7387\u7b97\u6cd5\uff0c\u6240\u4ee5\u5355\u4e2a\u6876\u7684\u8ba1\u6570\u503c\u5e76\u4e0d\u51c6\u786e\uff0c\u4f46\u662f\u5c06\u6240\u6709\u7684\u6876\u8ba1\u6570\u503c\u8fdb\u884c\u8c03\u5408\u5747\u503c\u7d2f\u52a0\u8d77\u6765\uff0c\u7ed3\u679c\u5c31\u4f1a\u975e\u5e38\u63a5\u8fd1\u771f\u5b9e\u7684\u8ba1\u6570\u503c\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e5a000b63be7?w=1448&h=604&f=png&s=68760)\n\n\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3HyperLogLog\u7b97\u6cd5\uff0c\u6211\u4eec\u5148\u7b80\u5316\u5b83\u7684\u8ba1\u6570\u903b\u8f91\u3002\u56e0\u4e3a\u662f\u53bb\u91cd\u8ba1\u6570\uff0c\u5982\u679c\u662f\u51c6\u786e\u7684\u53bb\u91cd\uff0c\u80af\u5b9a\u9700\u8981\u7528\u5230 set \u96c6\u5408\uff0c\u4f7f\u7528\u96c6\u5408\u6765\u8bb0\u5f55\u6240\u6709\u7684\u5143\u7d20\uff0c\u7136\u540e\u4f7f\u7528 scard \u6307\u4ee4\u6765\u83b7\u53d6\u96c6\u5408\u5927\u5c0f\u5c31\u53ef\u4ee5\u5f97\u5230\u603b\u7684\u8ba1\u6570\u3002\u56e0\u4e3a\u5143\u7d20\u7279\u522b\u591a\uff0c\u5355\u4e2a\u96c6\u5408\u4f1a\u7279\u522b\u5927\uff0c\u6240\u4ee5\u5c06\u96c6\u5408\u6253\u6563\u6210 16384 \u4e2a\u5c0f\u96c6\u5408\u3002\u5f53\u5143\u7d20\u5230\u6765\u65f6\uff0c\u901a\u8fc7 hash \u7b97\u6cd5\u5c06\u8fd9\u4e2a\u5143\u7d20\u5206\u6d3e\u5230\u5176\u4e2d\u7684\u4e00\u4e2a\u5c0f\u96c6\u5408\u5b58\u50a8\uff0c\u540c\u6837\u7684\u5143\u7d20\u603b\u662f\u4f1a\u6563\u5217\u5230\u540c\u6837\u7684\u5c0f\u96c6\u5408\u3002\u8fd9\u6837\u603b\u7684\u8ba1\u6570\u5c31\u662f\u6240\u6709\u5c0f\u96c6\u5408\u5927\u5c0f\u7684\u603b\u548c\u3002\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u7cbe\u786e\u8ba1\u6570\u9664\u4e86\u53ef\u4ee5\u589e\u52a0\u5143\u7d20\u5916\uff0c\u8fd8\u53ef\u4ee5\u51cf\u5c11\u5143\u7d20\u3002\n\n\u7528 Python \u4ee3\u7801\u63cf\u8ff0\u5982\u4e0b\n\n```py\n# coding:utf-8\nimport hashlib\n\nclass ExactlyCounter:\n\n    def __init__(self):\n        # \u5148\u5206\u914d16384\u4e2a\u7a7a\u96c6\u5408\n        self.buckets = []\n        for i in range(16384):\n            self.buckets.append(set([]))\n        # \u4f7f\u7528md5\u54c8\u5e0c\u7b97\u6cd5\n        self.hash = lambda x: int(hashlib.md5(x).hexdigest(), 16)\n        self.count = 0\n\n    def add(self, element):\n        h = self.hash(element)\n        idx = h % len(self.buckets)\n        bucket = self.buckets[idx]\n        old_len = len(bucket)\n        bucket.add(element)\n        if len(bucket) > old_len:\n            # \u5982\u679c\u6570\u91cf\u53d8\u5316\u4e86\uff0c\u603b\u6570\u5c31+1\n            self.count += 1\n\n    def remove(self, element):\n        h = self.hash(element)\n        idx = h % len(self.buckets)\n        bucket = self.buckets[idx]\n        old_len = len(bucket)\n        bucket.remove(element)\n        if len(bucket) < old_len:\n            # \u5982\u679c\u6570\u91cf\u53d8\u5316\u4e86\uff0c\u603b\u6570-1\n            self.count -= 1\n\n\nif __name__ == '__main__':\n    c = ExactlyCounter()\n    for i in range(100000):\n        c.add(\"element_%d\" % i)\n    print c.count\n    for i in range(100000):\n        c.remove(\"element_%d\" % i)\n    print c.count\n```\n\n\u96c6\u5408\u6253\u6563\u5e76\u6ca1\u6709\u4ec0\u4e48\u660e\u663e\u597d\u5904\uff0c\u56e0\u4e3a\u603b\u7684\u5185\u5b58\u5360\u7528\u5e76\u6ca1\u6709\u51cf\u5c11\u3002HyperLogLog\u80af\u5b9a\u4e0d\u662f\u8fd9\u4e2a\u7b97\u6cd5\uff0c\u5b83\u9700\u8981\u5bf9\u8fd9\u4e2a\u5c0f\u96c6\u5408\u8fdb\u884c\u4f18\u5316\uff0c\u538b\u7f29\u5b83\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u8ba9\u5b83\u7684\u5185\u5b58\u53d8\u5f97\u975e\u5e38\u5fae\u5c0f\u3002HyperLogLog\u7b97\u6cd5\u4e2d\u6bcf\u4e2a\u6876\u6240\u5360\u7528\u7684\u7a7a\u95f4\u5b9e\u9645\u4e0a\u53ea\u6709 6 \u4e2a bit\uff0c\u8fd9 6 \u4e2a bit \u81ea\u7136\u662f\u65e0\u6cd5\u5bb9\u7eb3\u6876\u4e2d\u6240\u6709\u5143\u7d20\u7684\uff0c\u5b83\u8bb0\u5f55\u7684\u662f\u6876\u4e2d\u5143\u7d20\u6570\u91cf\u7684\u5bf9\u6570\u503c\u3002\n\n\u4e3a\u4e86\u8bf4\u660e\u8fd9\u4e2a\u5bf9\u6570\u503c\u5177\u4f53\u662f\u4e2a\u4ec0\u4e48\u4e1c\u897f\uff0c\u6211\u4eec\u5148\u6765\u8003\u8651\u4e00\u4e2a\u5c0f\u95ee\u9898\u3002\u4e00\u4e2a\u968f\u673a\u7684\u6574\u6570\u503c\uff0c\u8fd9\u4e2a\u6574\u6570\u7684\u5c3e\u90e8\u6709\u4e00\u4e2a 0 \u7684\u6982\u7387\u662f 50%\uff0c\u8981\u4e48\u662f 0 \u8981\u4e48\u662f 1\u3002\u540c\u6837\uff0c\u5c3e\u90e8\u6709\u4e24\u4e2a 0 \u7684\u6982\u7387\u662f 25%\uff0c\u6709\u4e09\u4e2a\u96f6\u7684\u6982\u7387\u662f 12.5%\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6709 k \u4e2a 0 \u7684\u6982\u7387\u662f 2^(-k)\u3002\u5982\u679c\u6211\u4eec\u968f\u673a\u51fa\u4e86\u5f88\u591a\u6574\u6570\uff0c\u6574\u6570\u7684\u6570\u91cf\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\uff0c\u4f46\u662f\u6211\u4eec\u8bb0\u5f55\u4e86\u6574\u6570\u5c3e\u90e8\u8fde\u7eed 0 \u7684\u6700\u5927\u6570\u91cf K\u3002\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a K \u6765\u8fd1\u4f3c\u63a8\u65ad\u51fa\u6574\u6570\u7684\u6570\u91cf\uff0c\u8fd9\u4e2a\u6570\u91cf\u5c31\u662f 2^K\u3002\n\n\u5f53\u7136\u7ed3\u679c\u662f\u975e\u5e38\u4e0d\u51c6\u786e\u7684\uff0c\u56e0\u4e3a\u53ef\u80fd\u63a5\u4e0b\u6765\u4f60\u968f\u673a\u4e86\u975e\u5e38\u591a\u7684\u6574\u6570\uff0c\u4f46\u662f\u672b\u5c3e\u8fde\u7eed\u96f6\u7684\u6700\u5927\u6570\u91cf K \u6ca1\u6709\u53d8\u5316\uff0c\u4f46\u662f\u4f30\u8ba1\u503c\u8fd8\u662f 2^K\u3002\u4f60\u4e5f\u8bb8\u4f1a\u60f3\u5230\u8981\u662f\u8fd9\u4e2a K \u662f\u4e2a\u6d6e\u70b9\u6570\u5c31\u597d\u4e86\uff0c\u6bcf\u6b21\u968f\u673a\u4e00\u4e2a\u65b0\u5143\u7d20\uff0c\u5b83\u90fd\u53ef\u4ee5\u7a0d\u5fae\u5f80\u4e0a\u6da8\u4e00\u70b9\u70b9\uff0c\u90a3\u4e48\u4f30\u8ba1\u503c\u5e94\u8be5\u4f1a\u51c6\u786e\u5f88\u591a\u3002\n\nHyperLogLog\u901a\u8fc7\u5206\u914d 16384 \u4e2a\u6876\uff0c\u7136\u540e\u5bf9\u6240\u6709\u7684\u6876\u7684\u6700\u5927\u6570\u91cf K \u8fdb\u884c\u8c03\u5408\u5e73\u5747\u6765\u5f97\u5230\u4e00\u4e2a\u5e73\u5747\u7684\u672b\u5c3e\u96f6\u6700\u5927\u6570\u91cf K# \uff0cK# \u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\uff0c\u4f7f\u7528\u5e73\u5747\u540e\u7684 2^K# \u6765\u4f30\u8ba1\u5143\u7d20\u7684\u603b\u91cf\u76f8\u5bf9\u800c\u8a00\u5c31\u4f1a\u51c6\u786e\u5f88\u591a\u3002\u4e0d\u8fc7\u8fd9\u53ea\u662f\u7b80\u5316\u7b97\u6cd5\uff0c\u771f\u5b9e\u7684\u7b97\u6cd5\u8fd8\u6709\u5f88\u591a\u4fee\u6b63\u56e0\u5b50\uff0c\u56e0\u4e3a\u6d89\u53ca\u5230\u7684\u6570\u5b66\u7406\u8bba\u77e5\u8bc6\u8fc7\u4e8e\u7e41\u591a\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u7cbe\u786e\u63cf\u8ff0\u3002\n\n\u4e0b\u9762\u6211\u4eec\u770b\u770bRedis HyperLogLog \u7b97\u6cd5\u7684\u5177\u4f53\u5b9e\u73b0\u3002\u6211\u4eec\u77e5\u9053\u4e00\u4e2aHyperLogLog\u5b9e\u9645\u5360\u7528\u7684\u7a7a\u95f4\u5927\u7ea6\u662f 13684 * 6bit / 8 = 12k \u5b57\u8282\u3002\u4f46\u662f\u5728\u8ba1\u6570\u6bd4\u8f83\u5c0f\u7684\u65f6\u5019\uff0c\u5927\u591a\u6570\u6876\u7684\u8ba1\u6570\u503c\u90fd\u662f\u96f6\u3002\u5982\u679c 12k \u5b57\u8282\u91cc\u9762\u592a\u591a\u7684\u5b57\u8282\u90fd\u662f\u96f6\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7a7a\u95f4\u662f\u53ef\u4ee5\u9002\u5f53\u8282\u7ea6\u4e00\u4e0b\u7684\u3002Redis  \u5728\u8ba1\u6570\u503c\u6bd4\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0b\u91c7\u7528\u4e86\u7a00\u758f\u5b58\u50a8\uff0c\u7a00\u758f\u5b58\u50a8\u7684\u7a7a\u95f4\u5360\u7528\u8fdc\u8fdc\u5c0f\u4e8e 12k \u5b57\u8282\u3002\u76f8\u5bf9\u4e8e\u7a00\u758f\u5b58\u50a8\u7684\u5c31\u662f\u5bc6\u96c6\u5b58\u50a8\uff0c\u5bc6\u96c6\u5b58\u50a8\u4f1a\u6052\u5b9a\u5360\u7528 12k \u5b57\u8282\u3002\n\n## \u5bc6\u96c6\u5b58\u50a8\u7ed3\u6784\n\n\u4e0d\u8bba\u662f\u7a00\u758f\u5b58\u50a8\u8fd8\u662f\u5bc6\u96c6\u5b58\u50a8\uff0cRedis \u5185\u90e8\u90fd\u662f\u4f7f\u7528\u5b57\u7b26\u4e32\u4f4d\u56fe\u6765\u5b58\u50a8 HyperLogLog \u6240\u6709\u6876\u7684\u8ba1\u6570\u503c\u3002\u5bc6\u96c6\u5b58\u50a8\u7684\u7ed3\u6784\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u8fde\u7eed 16384 \u4e2a 6bit \u4e32\u6210\u7684\u5b57\u7b26\u4e32\u4f4d\u56fe\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e5b7a96f3b21?w=1820&h=266&f=png&s=34418)\n\n\u90a3\u4e48\u7ed9\u5b9a\u4e00\u4e2a\u6876\u7f16\u53f7\uff0c\u5982\u4f55\u83b7\u53d6\u5b83\u7684 6bit \u8ba1\u6570\u503c\u5462\uff1f\u8fd9 6bit \u53ef\u80fd\u5728\u4e00\u4e2a\u5b57\u8282\u5185\u90e8\uff0c\u4e5f\u53ef\u80fd\u4f1a\u8de8\u8d8a\u5b57\u8282\u8fb9\u754c\u3002\u6211\u4eec\u9700\u8981\u5bf9\u8fd9\u4e00\u4e2a\u6216\u8005\u4e24\u4e2a\u5b57\u8282\u8fdb\u884c\u9002\u5f53\u7684\u79fb\u4f4d\u62fc\u63a5\u624d\u53ef\u4ee5\u5f97\u5230\u8ba1\u6570\u503c\u3002\n\n\u5047\u8bbe\u6876\u7684\u7f16\u53f7\u4e3aidx\uff0c\u8fd9\u4e2a 6bit \u8ba1\u6570\u503c\u7684\u8d77\u59cb\u5b57\u8282\u4f4d\u7f6e\u504f\u79fb\u7528 offset_bytes\u8868\u793a\uff0c\u5b83\u5728\u8fd9\u4e2a\u5b57\u8282\u7684\u8d77\u59cb\u6bd4\u7279\u4f4d\u7f6e\u504f\u79fb\u7528 offset_bits \u8868\u793a\u3002\u6211\u4eec\u6709\n\n```py\noffset_bytes = (idx * 6) / 8\noffset_bits = (idx * 6) % 8\n```\n\n\u524d\u8005\u662f\u5546\uff0c\u540e\u8005\u662f\u4f59\u6570\u3002\u6bd4\u5982 bucket 2 \u7684\u5b57\u8282\u504f\u79fb\u662f 1\uff0c\u4e5f\u5c31\u662f\u7b2c 2 \u4e2a\u5b57\u8282\u3002\u5b83\u7684\u4f4d\u504f\u79fb\u662f4\uff0c\u4e5f\u5c31\u662f\u7b2c 2 \u4e2a\u5b57\u8282\u7684\u7b2c 5 \u4e2a\u4f4d\u5f00\u59cb\u662f bucket 2 \u7684\u8ba1\u6570\u503c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u5b57\u8282\u4f4d\u5e8f\u662f\u5de6\u8fb9\u4f4e\u4f4d\u53f3\u8fb9\u9ad8\u4f4d\uff0c\u800c\u901a\u5e38\u6211\u4eec\u4f7f\u7528\u7684\u5b57\u8282\u90fd\u662f\u5de6\u8fb9\u9ad8\u4f4d\u53f3\u8fb9\u4f4e\u4f4d\uff0c\u6211\u4eec\u9700\u8981\u5728\u8111\u6d77\u4e2d\u8fdb\u884c\u5012\u7f6e\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e5c734cbb598?w=665&h=266&f=png&s=16211)\n\n\u5982\u679c offset_bits \u5c0f\u4e8e\u7b49\u4e8e 2\uff0c\u90a3\u4e48\u8fd9 6bit  \u5728\u4e00\u4e2a\u5b57\u8282\u5185\u90e8\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e0b\u9762\u7684\u8868\u8fbe\u5f0f\u5f97\u5230\u8ba1\u6570\u503c val\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e5d7661cc431?w=738&h=316&f=png&s=26669)\n\n```py\nval = buffer[offset_bytes] >> offset_bits  # \u5411\u53f3\u79fb\u4f4d\n```\n\n\u5982\u679c offset_bits \u5927\u4e8e 2\uff0c\u90a3\u4e48\u5c31\u4f1a\u8de8\u8d8a\u5b57\u8282\u8fb9\u754c\uff0c\u8fd9\u65f6\u9700\u8981\u62fc\u63a5\u4e24\u4e2a\u5b57\u8282\u7684\u4f4d\u7247\u6bb5\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e5e23c9067d9?w=959&h=570&f=png&s=54531)\n\n```py\n# \u4f4e\u4f4d\u503c\nlow_val = buffer[offset_bytes] >> offset_bits\n# \u4f4e\u4f4d\u4e2a\u6570\nlow_bits = 8 - offset_bits\n# \u62fc\u63a5\uff0c\u4fdd\u7559\u4f4e6\u4f4d\nval = (high_val << low_bits | low_val) & 0b111111\n```\n\n\u4e0d\u8fc7\u4e0b\u9762 Redis \u7684\u6e90\u7801\u8981\u6666\u6da9\u4e00\u70b9\uff0c\u770b\u5f62\u5f0f\u5b83\u4f3c\u4e4e\u53ea\u8003\u8651\u4e86\u8de8\u8d8a\u5b57\u8282\u8fb9\u754c\u7684\u60c5\u51b5\u3002\u8fd9\u662f\u56e0\u4e3a\u5982\u679c 6bit \u5728\u5355\u4e2a\u5b57\u8282\u5185\uff0c\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684 high_val \u7684\u503c\u662f\u96f6\uff0c\u6240\u4ee5\u8fd9\u4e00\u4efd\u4ee3\u7801\u53ef\u4ee5\u540c\u65f6\u7167\u987e\u5355\u5b57\u8282\u548c\u53cc\u5b57\u8282\u3002\n\n```c\n// \u83b7\u53d6\u6307\u5b9a\u6876\u7684\u8ba1\u6570\u503c\n#define HLL_DENSE_GET_REGISTER(target,p,regnum) do { \\\n    uint8_t *_p = (uint8_t*) p; \\\n    unsigned long _byte = regnum*HLL_BITS/8; \\ \n    unsigned long _fb = regnum*HLL_BITS&7; \\  # %8 = &7\n    unsigned long _fb8 = 8 - _fb; \\\n    unsigned long b0 = _p[_byte]; \\\n    unsigned long b1 = _p[_byte+1]; \\\n    target = ((b0 >> _fb) | (b1 << _fb8)) & HLL_REGISTER_MAX; \\\n} while(0)\n\n// \u8bbe\u7f6e\u6307\u5b9a\u6876\u7684\u8ba1\u6570\u503c\n#define HLL_DENSE_SET_REGISTER(p,regnum,val) do { \\\n    uint8_t *_p = (uint8_t*) p; \\\n    unsigned long _byte = regnum*HLL_BITS/8; \\\n    unsigned long _fb = regnum*HLL_BITS&7; \\\n    unsigned long _fb8 = 8 - _fb; \\\n    unsigned long _v = val; \\\n    _p[_byte] &= ~(HLL_REGISTER_MAX << _fb); \\\n    _p[_byte] |= _v << _fb; \\\n    _p[_byte+1] &= ~(HLL_REGISTER_MAX >> _fb8); \\\n    _p[_byte+1] |= _v >> _fb8; \\\n} while(0)\n```\n\n## \u7a00\u758f\u5b58\u50a8\u7ed3\u6784\n\n\u7a00\u758f\u5b58\u50a8\u9002\u7528\u4e8e\u5f88\u591a\u8ba1\u6570\u503c\u90fd\u662f\u96f6\u7684\u60c5\u51b5\u3002\u4e0b\u56fe\u8868\u793a\u4e86\u4e00\u822c\u7a00\u758f\u5b58\u50a8\u8ba1\u6570\u503c\u7684\u72b6\u6001\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e631c1730628?w=911&h=133&f=png&s=15943)\n\n\u5f53\u591a\u4e2a\u8fde\u7eed\u6876\u7684\u8ba1\u6570\u503c\u90fd\u662f\u96f6\u65f6\uff0cRedis \u4f7f\u7528\u4e86\u4e00\u4e2a\u5b57\u8282\u6765\u8868\u793a\u63a5\u4e0b\u6765\u6709\u591a\u5c11\u4e2a\u6876\u7684\u8ba1\u6570\u503c\u90fd\u662f\u96f6\uff1a00xxxxxx\u3002\u524d\u7f00\u4e24\u4e2a\u96f6\u8868\u793a\u63a5\u4e0b\u6765\u7684 6bit \u6574\u6570\u503c\u52a0 1 \u5c31\u662f\u96f6\u503c\u8ba1\u6570\u5668\u7684\u6570\u91cf\uff0c\u6ce8\u610f\u8fd9\u91cc\u8981\u52a0 1 \u662f\u56e0\u4e3a\u6570\u91cf\u5982\u679c\u4e3a\u96f6\u662f\u6ca1\u6709\u610f\u4e49\u7684\u3002\u6bd4\u5982 00010101\u8868\u793a\u8fde\u7eed 22 \u4e2a\u96f6\u503c\u8ba1\u6570\u5668\u30026bit \u6700\u591a\u53ea\u80fd\u8868\u793a\u8fde\u7eed 64 \u4e2a\u96f6\u503c\u8ba1\u6570\u5668\uff0c\u6240\u4ee5 Redis \u53c8\u8bbe\u8ba1\u4e86\u8fde\u7eed\u591a\u4e2a\u591a\u4e8e 64 \u4e2a\u7684\u8fde\u7eed\u96f6\u503c\u8ba1\u6570\u5668\uff0c\u5b83\u4f7f\u7528\u4e24\u4e2a\u5b57\u8282\u6765\u8868\u793a\uff1a01xxxxxx yyyyyyyy\uff0c\u540e\u9762\u7684 14bit \u53ef\u4ee5\u8868\u793a\u6700\u591a\u8fde\u7eed 16384 \u4e2a\u96f6\u503c\u8ba1\u6570\u5668\u3002\u8fd9\u610f\u5473\u7740 HyperLogLog \u6570\u636e\u7ed3\u6784\u4e2d 16384 \u4e2a\u6876\u7684\u521d\u59cb\u72b6\u6001\uff0c\u6240\u6709\u7684\u8ba1\u6570\u5668\u90fd\u662f\u96f6\u503c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 2 \u4e2a\u5b57\u8282\u6765\u8868\u793a\u3002\n\n\u5982\u679c\u8fde\u7eed\u51e0\u4e2a\u6876\u7684\u8ba1\u6570\u503c\u975e\u96f6\uff0c\u90a3\u5c31\u4f7f\u7528\u5f62\u5982 1vvvvvxx \u8fd9\u6837\u7684\u4e00\u4e2a\u5b57\u8282\u6765\u8868\u793a\u3002\u4e2d\u95f4 5bit \u8868\u793a\u8ba1\u6570\u503c\uff0c\u5c3e\u90e8 2bit \u8868\u793a\u8fde\u7eed\u51e0\u4e2a\u6876\u3002\u5b83\u7684\u610f\u601d\u662f\u8fde\u7eed \uff08xx +1\uff09 \u4e2a\u8ba1\u6570\u503c\u90fd\u662f \uff08vvvvv + 1\uff09\u3002\u6bd4\u5982 10101011 \u8868\u793a\u8fde\u7eed 4 \u4e2a\u8ba1\u6570\u503c\u90fd\u662f 11\u3002\u6ce8\u610f\u8fd9\u4e24\u4e2a\u503c\u90fd\u9700\u8981\u52a0 1\uff0c\u56e0\u4e3a\u4efb\u610f\u4e00\u4e2a\u662f\u96f6\u90fd\u610f\u5473\u7740\u8fd9\u4e2a\u8ba1\u6570\u503c\u4e3a\u96f6\uff0c\u90a3\u5c31\u5e94\u8be5\u4f7f\u7528\u96f6\u8ba1\u6570\u503c\u7684\u5f62\u5f0f\u6765\u8868\u793a\u3002\u6ce8\u610f\u8ba1\u6570\u503c\u6700\u5927\u53ea\u80fd\u8868\u793a\u523032\uff0c\u800c HyperLogLog \u7684\u5bc6\u96c6\u5b58\u50a8\u5355\u4e2a\u8ba1\u6570\u503c\u7528 6bit \u8868\u793a\uff0c\u6700\u5927\u53ef\u4ee5\u8868\u793a\u5230 63\u3002\u5f53\u7a00\u758f\u5b58\u50a8\u7684\u67d0\u4e2a\u8ba1\u6570\u503c\u9700\u8981\u8c03\u6574\u5230\u5927\u4e8e 32 \u65f6\uff0cRedis \u5c31\u4f1a\u7acb\u5373\u8f6c\u6362 HyperLogLog \u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u5c06\u7a00\u758f\u5b58\u50a8\u8f6c\u6362\u6210\u5bc6\u96c6\u5b58\u50a8\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e626c4e3a697?w=792&h=146&f=png&s=17632)\n\nRedis  \u4e3a\u4e86\u65b9\u4fbf\u8868\u8fbe\u7a00\u758f\u5b58\u50a8\uff0c\u5b83\u5c06\u4e0a\u9762\u4e09\u79cd\u5b57\u8282\u8868\u793a\u5f62\u5f0f\u5206\u522b\u8d4b\u4e88\u4e86\u4e00\u6761\u6307\u4ee4\u3002\n1. ZERO:len \u5355\u4e2a\u5b57\u8282\u8868\u793a 00[len-1]\uff0c\u8fde\u7eed\u6700\u591a64\u4e2a\u96f6\u8ba1\u6570\u503c\n2. VAL:value,len \u5355\u4e2a\u5b57\u8282\u8868\u793a 1[value-1][len-1]\uff0c\u8fde\u7eed len \u4e2a\u503c\u4e3a value \u7684\u8ba1\u6570\u503c\n3. XZERO:len \u53cc\u5b57\u8282\u8868\u793a 01[len-1]\uff0c\u8fde\u7eed\u6700\u591a16384\u4e2a\u96f6\u8ba1\u6570\u503c\n\n```c\n#define HLL_SPARSE_XZERO_BIT 0x40 /* 01xxxxxx */\n#define HLL_SPARSE_VAL_BIT 0x80 /* 1vvvvvxx */\n#define HLL_SPARSE_IS_ZERO(p) (((*(p)) & 0xc0) == 0) /* 00xxxxxx */\n#define HLL_SPARSE_IS_XZERO(p) (((*(p)) & 0xc0) == HLL_SPARSE_XZERO_BIT)\n#define HLL_SPARSE_IS_VAL(p) ((*(p)) & HLL_SPARSE_VAL_BIT)\n#define HLL_SPARSE_ZERO_LEN(p) (((*(p)) & 0x3f)+1)\n#define HLL_SPARSE_XZERO_LEN(p) (((((*(p)) & 0x3f) << 8) | (*((p)+1)))+1)\n#define HLL_SPARSE_VAL_VALUE(p) ((((*(p)) >> 2) & 0x1f)+1)\n#define HLL_SPARSE_VAL_LEN(p) (((*(p)) & 0x3)+1)\n#define HLL_SPARSE_VAL_MAX_VALUE 32\n#define HLL_SPARSE_VAL_MAX_LEN 4\n#define HLL_SPARSE_ZERO_MAX_LEN 64\n#define HLL_SPARSE_XZERO_MAX_LEN 16384\n```\n\n\u4e0a\u56fe\u53ef\u4ee5\u4f7f\u7528\u6307\u4ee4\u5f62\u5f0f\u8868\u793a\u5982\u4e0b\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/1658e62bae79cfe5?w=766&h=158&f=png&s=22552)\n\n## \u5b58\u50a8\u8f6c\u6362\n\n\u5f53\u8ba1\u6570\u503c\u8fbe\u5230\u4e00\u5b9a\u7a0b\u5ea6\u540e\uff0c\u7a00\u758f\u5b58\u50a8\u5c06\u4f1a\u4e0d\u53ef\u9006\u4e00\u6b21\u6027\u8f6c\u6362\u4e3a\u5bc6\u96c6\u5b58\u50a8\u3002\u8f6c\u6362\u7684\u6761\u4ef6\u6709\u4e24\u4e2a\uff0c\u4efb\u610f\u4e00\u4e2a\u6ee1\u8db3\u5c31\u4f1a\u7acb\u5373\u53d1\u751f\u8f6c\u6362\n1. \u4efb\u610f\u4e00\u4e2a\u8ba1\u6570\u503c\u4ece 32 \u53d8\u6210 33\uff0c\u56e0\u4e3aVAL\u6307\u4ee4\u5df2\u7ecf\u65e0\u6cd5\u5bb9\u7eb3\uff0c\u5b83\u80fd\u8868\u793a\u7684\u8ba1\u6570\u503c\u6700\u5927\u4e3a 32\n2. \u7a00\u758f\u5b58\u50a8\u5360\u7528\u7684\u603b\u5b57\u8282\u6570\u8d85\u8fc7 3000 \u5b57\u8282\uff0c\u8fd9\u4e2a\u9608\u503c\u53ef\u4ee5\u901a\u8fc7 hll_sparse_max_bytes \u53c2\u6570\u8fdb\u884c\u8c03\u6574\u3002\n\n## \u8ba1\u6570\u7f13\u5b58\n\n\u524d\u9762\u63d0\u5230 HyperLogLog \u8868\u793a\u7684\u603b\u8ba1\u6570\u503c\u662f\u7531 16384 \u4e2a\u6876\u7684\u8ba1\u6570\u503c\u8fdb\u884c\u8c03\u548c\u5e73\u5747\u540e\u518d\u57fa\u4e8e\u56e0\u5b50\u4fee\u6b63\u516c\u5f0f\u8ba1\u7b97\u5f97\u51fa\u6765\u7684\u3002\u5b83\u9700\u8981\u904d\u5386\u6240\u6709\u7684\u6876\u8fdb\u884c\u8ba1\u7b97\u624d\u53ef\u4ee5\u5f97\u5230\u8fd9\u4e2a\u503c\uff0c\u4e2d\u95f4\u8fd8\u6d89\u53ca\u5230\u5f88\u591a\u6d6e\u70b9\u8fd0\u7b97\u3002\u8fd9\u4e2a\u8ba1\u7b97\u91cf\u76f8\u5bf9\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u5927\u7684\u3002\n\n\u6240\u4ee5 Redis \u4f7f\u7528\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u5b57\u6bb5\u6765\u7f13\u5b58\u603b\u8ba1\u6570\u503c\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u6709 64bit\uff0c\u6700\u9ad8\u4f4d\u5982\u679c\u4e3a 1 \u8868\u793a\u8be5\u503c\u662f\u5426\u5df2\u7ecf\u8fc7\u671f\uff0c\u5982\u679c\u4e3a 0\uff0c \u90a3\u4e48\u5269\u4e0b\u7684 63bit \u5c31\u662f\u8ba1\u6570\u503c\u3002\n\n\u5f53 HyperLogLog \u4e2d\u4efb\u610f\u4e00\u4e2a\u6876\u7684\u8ba1\u6570\u503c\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u5c31\u4f1a\u5c06\u8ba1\u6570\u7f13\u5b58\u8bbe\u4e3a\u8fc7\u671f\uff0c\u4f46\u662f\u4e0d\u4f1a\u7acb\u5373\u89e6\u53d1\u8ba1\u7b97\u3002\u800c\u662f\u8981\u7b49\u5230\u7528\u6237\u663e\u793a\u8c03\u7528 pfcount \u6307\u4ee4\u65f6\u624d\u4f1a\u89e6\u53d1\u91cd\u65b0\u8ba1\u7b97\u5237\u65b0\u7f13\u5b58\u3002\u7f13\u5b58\u5237\u65b0\u5728\u5bc6\u96c6\u5b58\u50a8\u65f6\u9700\u8981\u904d\u5386 16384 \u4e2a\u6876\u7684\u8ba1\u6570\u503c\u8fdb\u884c\u8c03\u548c\u5e73\u5747\uff0c\u4f46\u662f\u7a00\u758f\u5b58\u50a8\u65f6\u6ca1\u6709\u8fd9\u4e48\u5927\u7684\u8ba1\u7b97\u91cf\u3002\u4e5f\u5c31\u662f\u8bf4\u53ea\u6709\u5f53\u8ba1\u6570\u503c\u6bd4\u8f83\u5927\u65f6\u624d\u53ef\u80fd\u4ea7\u751f\u8f83\u5927\u7684\u8ba1\u7b97\u91cf\u3002\u53e6\u4e00\u65b9\u9762\u5982\u679c\u8ba1\u6570\u503c\u6bd4\u8f83\u5927\uff0c\u90a3\u4e48\u5927\u90e8\u5206 pfadd \u64cd\u4f5c\u6839\u672c\u4e0d\u4f1a\u5bfc\u81f4\u6876\u4e2d\u7684\u8ba1\u6570\u503c\u53d1\u751f\u53d8\u5316\u3002\n\n\u8fd9\u610f\u5473\u7740\u5728\u4e00\u4e2a\u6781\u5177\u53d8\u5316\u7684 HLL \u8ba1\u6570\u5668\u4e2d\u9891\u7e41\u8c03\u7528 pfcount \u6307\u4ee4\u53ef\u80fd\u4f1a\u6709\u5c11\u8bb8\u6027\u80fd\u95ee\u9898\u3002\u5173\u4e8e\u8fd9\u4e2a\u6027\u80fd\u65b9\u9762\u7684\u62c5\u5fe7\u5728 Redis \u4f5c\u8005 antirez \u7684\u535a\u5ba2\u4e2d\u4e5f\u63d0\u5230\u4e86\u3002\u4e0d\u8fc7\u4f5c\u8005\u505a\u4e86\u4ed4\u7ec6\u7684\u538b\u529b\u7684\u6d4b\u8bd5\uff0c\u53d1\u73b0\u8fd9\u662f\u65e0\u9700\u62c5\u5fc3\u7684\uff0cpfcount \u6307\u4ee4\u7684\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f O(1)\u3002\n\n> After this change even trying to add elements at maximum speed using a pipeline of 32 elements with 50 simultaneous clients, PFCOUNT was able to perform as well as any other O(1) command with very small constant times.\n\n## \u5bf9\u8c61\u5934\n\nHyperLogLog \u9664\u4e86\u9700\u8981\u5b58\u50a8 16384 \u4e2a\u6876\u7684\u8ba1\u6570\u503c\u4e4b\u5916\uff0c\u5b83\u8fd8\u6709\u4e00\u4e9b\u9644\u52a0\u7684\u5b57\u6bb5\u9700\u8981\u5b58\u50a8\uff0c\u6bd4\u5982\u603b\u8ba1\u6570\u7f13\u5b58\u3001\u5b58\u50a8\u7c7b\u578b\u3002\u6240\u4ee5\u5b83\u4f7f\u7528\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u5bf9\u8c61\u5934\u6765\u8868\u793a\u3002\n\n```c\nstruct hllhdr {\n    char magic[4];      /* \u9b54\u672f\u5b57\u7b26\u4e32\"HYLL\" */\n    uint8_t encoding;   /* \u5b58\u50a8\u7c7b\u578b HLL_DENSE or HLL_SPARSE. */\n    uint8_t notused[3]; /* \u4fdd\u7559\u4e09\u4e2a\u5b57\u8282\u672a\u6765\u53ef\u80fd\u4f1a\u4f7f\u7528 */\n    uint8_t card[8];    /* \u603b\u8ba1\u6570\u7f13\u5b58 */\n    uint8_t registers[]; /* \u6240\u6709\u6876\u7684\u8ba1\u6570\u5668 */\n};\n```\n\n\u6240\u4ee5 HyperLogLog \u6574\u4f53\u7684\u5185\u90e8\u7ed3\u6784\u5c31\u662f HLL \u5bf9\u8c61\u5934 \u52a0\u4e0a 16384 \u4e2a\u6876\u7684\u8ba1\u6570\u503c\u4f4d\u56fe\u3002\u5b83\u5728 Redis \u7684\u5185\u90e8\u7ed3\u6784\u8868\u73b0\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u4f4d\u56fe\u3002\u4f60\u53ef\u4ee5\u628a HyperLogLog \u5bf9\u8c61\u5f53\u6210\u666e\u901a\u7684\u5b57\u7b26\u4e32\u6765\u8fdb\u884c\u5904\u7406\u3002\n\n```c\n127.0.0.1:6379> pfadd codehole python java golang\n(integer) 1\n127.0.0.1:6379> get codehole\n\"HYLL\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x80C\\x03\\x84MK\\x80P\\xb8\\x80^\\xf3\"\n```\n\n\u4f46\u662f\u4e0d\u53ef\u4ee5\u4f7f\u7528 HyperLogLog \u6307\u4ee4\u6765\u64cd\u7eb5\u666e\u901a\u7684\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u68c0\u67e5\u5bf9\u8c61\u5934\u9b54\u672f\u5b57\u7b26\u4e32\u662f\u5426\u662f \"HYLL\"\u3002\n\n```\n127.0.0.1:6379> set codehole python\nOK\n127.0.0.1:6379> pfadd codehole java golang\n(error) WRONGTYPE Key is not a valid HyperLogLog string value.\n```\n\n\u4f46\u662f\u5982\u679c\u5b57\u7b26\u4e32\u4ee5 \"HYLL\\x00\" \u6216\u8005 \"HYLL\\x01\" \u5f00\u5934\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u4f7f\u7528 HyperLogLog \u7684\u6307\u4ee4\u3002\n\n```\n127.0.0.1:6379> set codehole \"HYLL\\x01whatmagicthing\"\nOK\n127.0.0.1:6379> get codehole\n\"HYLL\\x01whatmagicthing\"\n127.0.0.1:6379> pfadd codehole python java golang\n(integer) 1\n```\n\n\u4e5f\u8bb8\u4f60\u4f1a\u611f\u89c9\u975e\u5e38\u5947\u602a\uff0c\u8fd9\u662f\u56e0\u4e3a HyperLogLog \u5728\u6267\u884c\u6307\u4ee4\u524d\u9700\u8981\u5bf9\u5185\u5bb9\u8fdb\u884c\u683c\u5f0f\u68c0\u67e5\uff0c\u8fd9\u4e2a\u68c0\u67e5\u5c31\u662f\u67e5\u770b\u5bf9\u8c61\u5934\u7684 magic \u9b54\u672f\u5b57\u7b26\u4e32\u662f\u5426\u662f \"HYLL\" \u4ee5\u53ca encoding \u5b57\u6bb5\u662f\u5426\u662f HLL_SPARSE=0 \u6216\u8005 HLL_DENSE=1 \u6765\u5224\u65ad\u5f53\u524d\u7684\u5b57\u7b26\u4e32\u662f\u5426\u662f HyperLogLog \u8ba1\u6570\u5668\u3002\u5982\u679c\u662f\u5bc6\u96c6\u5b58\u50a8\uff0c\u8fd8\u9700\u8981\u5224\u65ad\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u662f\u5426\u6070\u597d\u7b49\u4e8e\u5bc6\u96c6\u8ba1\u6570\u5668\u5b58\u50a8\u7684\u957f\u5ea6\u3002\n\n```c\nint isHLLObjectOrReply(client *c, robj *o) {\n    ...\n    /* Magic should be \"HYLL\". */\n    if (hdr->magic[0] != 'H' || hdr->magic[1] != 'Y' ||\n        hdr->magic[2] != 'L' || hdr->magic[3] != 'L') goto invalid;\n\n    if (hdr->encoding > HLL_MAX_ENCODING) goto invalid;\n\n    if (hdr->encoding == HLL_DENSE &&\n        stringObjectLen(o) != HLL_DENSE_SIZE) goto invalid;\n\n    return C_OK;\n\ninvalid:\n    addReplySds(c,\n        sdsnew(\"-WRONGTYPE Key is not a valid \"\n               \"HyperLogLog string value.\\r\\n\"));\n    return C_ERR;\n}\n```\n\n\nHyperLogLog \u548c \u5b57\u7b26\u4e32\u7684\u5173\u7cfb\u5c31\u597d\u6bd4 Geo \u548c zset \u7684\u5173\u7cfb\u3002\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f zset \u7684\u6307\u4ee4\u6765\u8bbf\u95ee Geo \u6570\u636e\u7ed3\u6784\uff0c\u56e0\u4e3a Geo \u5185\u90e8\u5b58\u50a8\u5c31\u662f\u4f7f\u7528\u4e86\u4e00\u4e2a\u7eaf\u7cb9\u7684 zset\u6765\u8bb0\u5f55\u5143\u7d20\u7684\u5730\u7406\u4f4d\u7f6e\u3002\n", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/43\u6e90\u7801_11\u89c1\u7f1d\u63d2\u9488__\u63a2\u7d22_HyperLogLog_\u5185\u90e8.md", "create_date": "2020-02-18T03:01:06.293", "order": 44}}, {"model": "subject.chapter", "pk": 51, "fields": {"title": "44\u5c3e\u58f0\uff1a\u767e\u5c3a\u7aff\u5934 \u2014\u2014 \u7ee7\u7eed\u6df1\u9020\u6307\u5357", "topic": 2, "md5": "ee85adf88a19c2f8a02944509ec07940", "md_body": "# \u5c3e\u58f0\uff1a\u767e\u5c3a\u7aff\u5934 \u2014\u2014 \u7ee7\u7eed\u6df1\u9020\u6307\u5357\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/18/164ab7d6ee8ca3b1?w=400&h=320&f=gif&s=1548139)\n\nRedis \u6d89\u53ca\u7684\u77e5\u8bc6\u70b9\u662f\u975e\u5e38\u7e41\u591a\u7684\uff0c\u867d\u7136\u8001\u94b1\u5df2\u7ecf\u75af\u72c2\u6269\u5145\u4e86\u4e0d\u5c11\u8fdb\u9636\u548c\u538b\u7bb1\u5e95\u7684\u5185\u5bb9\uff0c\u4f46\u672c\u5c0f\u518c\u4f9d\u7136\u65e0\u6cd5\u987e\u53ca\u5230 Redis \u7684\u65b9\u65b9\u9762\u9762\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u6e34\u671b\u8fdb\u4e00\u6b65\u62d3\u5c55\u77e5\u8bc6\u7684\u540c\u5b66\uff0c\u5728\u8fd9\u91cc\u505a\u4e00\u4e9b\u7cbe\u54c1\u5b66\u4e60\u8d44\u6e90\u63a8\u8350\u3002\n\n## \u53c2\u8003\u8d44\u6599\n\n### 1. \u56fd\u5185 90 \u540e\u6280\u672f\u5927\u795e\u9ec4\u5065\u5b8f\u7684\u8457\u4f5c[\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b](http://redisbook.com/)\n\n![](https://user-gold-cdn.xitu.io/2018/7/9/1647e89d39a25ede?w=350&h=350&f=jpeg&s=17529)\n\n\u9ec4\u5065\u5b8f\u8001\u5e08\u5199\u7684\u8fd9\u672c\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b\u662f\u8001\u94b1\u9996\u63a8\u7684\u4e00\u672c Redis \u53c2\u8003\u4e66\u7c4d\uff0c\u5b83\u4e5f\u662f\u6bcf\u4e00\u4f4d\u6765\u5230\u638c\u9605\u7684\u540e\u7aef\u5c0f\u4f19\u4f34\u5fc5\u987b\u8981\u770b\u7684\u4e00\u672c\u4e66\u3002\n\n\u628a\u8fd9\u672c\u4e66\u5403\u900f\u540e\uff0c\u4f60\u4f1a\u660e\u663e\u611f\u89c9\u5230\u529f\u529b\u5927\u589e\u3002\u4ee5\u540e\u5728\u5de5\u4f5c\u4e2d\u9047\u5230\u4e86 Redis \u76f8\u5173\u7684\u95ee\u9898\uff0c\u4f60\u603b\u4f1a\u60f3\u4ece\u8fd9\u672c\u4e66\u4e2d\u627e\u5230\u7b54\u6848\u3002\n\n### 2. Redis \u5b98\u7f51 & Redis \u4f5c\u8005 Antirez \u7684 Blog\n\n\u6211\u8fd8\u8981\u9686\u91cd\u63a8\u8350\u4e0b Redis \u7684\u5b98\u7f51\u548c Redis \u4f5c\u8005 Antirez \u7684 Blog\uff0c\u5728\u8fd9\u91cc\uff0c\u4f60\u53ef\u4ee5\u83b7\u53d6\u5b98\u65b9\u6743\u5a01\u8d44\u6599\u548c\u6700\u65b0\u4fe1\u606f\u3002\n\n#### [Redis \u5b98\u7f51](https://redis.io)\n\nRedis \u5b98\u7f51\u6587\u6863\u975e\u5e38\u4e30\u5bcc\uff0c\u5b83\u7684\u6587\u6863\u975e\u5e38\u503c\u5f97\u5543\u3002\u5982\u679c\u4f60\u7684\u82f1\u6587\u4e0d\u4f73\uff0c\u53ef\u4ee5\u53bb\u770b\u770b\u4e2d\u6587 Redis \u7f51\u7ad9\u3002Redis \u5b98\u7f51\u7684\u7cbe\u534e\u6587\u7ae0\u90fd\u5728\u9876\u90e8\u5bfc\u822a [Documentation](https://redis.io/documentation) \u94fe\u63a5\u4e2d\u3002\n\n#### [Antirez \u535a\u5ba2](http://antirez.com/latest/0)\n\nRedis \u4f5c\u8005 Antirez \u5927\u4f6c\u7684\u535a\u5ba2\u6709\u5f88\u591a\u5173\u4e8e Redis \u7684\u6700\u65b0\u6d88\u606f\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u4f1a\u6709\u4e00\u4e9b\u4f5c\u8005\u65b0\u53d1\u73b0\u7684\u3001\u597d\u73a9\u7684\u6280\u672f\u77e5\u8bc6\u70b9\u3002\n\n#### [Redis \u6269\u5c55\u6a21\u5757](https://redis.io/modules)\n\nRedis 4.0 \u589e\u52a0\u4e86\u6a21\u5757\u5316\u4e4b\u540e\uff0c\u8d8a\u6765\u8d8a\u591a\u7684 Redis \u6a21\u5757\u96e8\u540e\u6625\u7b0b\u822c\u7684\u88ab\u5f00\u53d1\u51fa\u6765\u3002\u8fd9\u4e2a\u9875\u9762\u5305\u542b\u4e86\u5f00\u6e90\u5e02\u573a\u4e0a\u6240\u6709\u7684 Redis \u6a21\u5757\u5217\u8868\uff0c\u6709\u4e00\u4e9b\u6a21\u5757\u6bd4\u8f83\u7a33\u5b9a\uff0c\u8fd8\u6709\u4e00\u4e9b\u5904\u4e8e Alpha \u9636\u6bb5\u3002\u8bfb\u8005\u53ef\u4ee5\u4ece\u4e2d\u6311\u9009\u51fa\u81ea\u5df1\u611f\u5174\u8da3\u7684\u6a21\u5757\u7814\u7a76\u5b66\u4e60\u3002\n\n### 3. \u6700\u8fd1\u770b\u5230\u4e00\u7bc7\u8d28\u91cf\u5f88\u9ad8\u7684\u535a\u5ba2\u6587\u7ae0 [\u300aRedis: under the hood\u300b](https://pauladamsmith.com/articles/redis-under-the-hood.html)\n\u8fd9\u7bc7\u535a\u6587\u662f\u8001\u5916\u5199\u7684\uff0c\u503c\u5f97\u6709\u82f1\u8bed\u80fd\u529b\u7684\u540c\u5b66\u5b66\u4e60\u3002\u8fd9\u7bc7\u6587\u7ae0\u4f1a\u5e26\u4f60\u4e00\u6b65\u6b65\u5b66\u4f1a\u5982\u4f55\u9605\u8bfb Redis \u7684\u6e90\u7801\uff0c\u6709\u4e00\u5b9a\u7684\u96be\u5ea6\uff0c\u4e0d\u8fc7\u6574\u4f53\u6765\u8bf4\u8fd8\u7b97\u901a\u4fd7\u6613\u61c2\u3002\u6587\u7ae0\u4e2d vm \u76f8\u5173\u4ee3\u7801\u7247\u6bb5\u4e0d\u7528\u53bb\u7406\u4f1a\uff0c\u8fd9\u4e2a\u529f\u80fd\u5f88\u65e9\u5c31\u88ab Redis \u5b98\u65b9\u5e9f\u5f03\u4e86\u3002\n\n### 4. \u8001\u94b1\u7684\u53e6\u4e00\u672c\u5c0f\u518c\uff1a[\u300a\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1\u300b](https://juejin.im/book/5af56a3c518825426642e004) \n\u8981\u6210\u4e3a\u540e\u7aef\u9ad8\u624b\uff0c\u6700\u9ad8\u6548\u7684\u8def\u5f84\u5c31\u662f\u638c\u63e1\u300c\u9020\u8f6e\u5b50\u300d\u5b66\u4e60\u6cd5\u3002\u8fd9\u672c RPC \u5c0f\u518c\u4e5f\u662f\u8001\u94b1\u7684\u5904\u5973\u4f5c\uff0c\u6559\u4f60\u901a\u8fc7\u81ea\u5efa RPC \u670d\u52a1\uff0c\u6df1\u5165\u7406\u89e3\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1\u539f\u7406\u4e0e\u5b9e\u8df5\uff0c\u4e5f\u63a8\u8350\u7ed9\u540e\u7aef\u540c\u5b66\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/11/163edff00241d286?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)\n\n### 5. \u8001\u94b1\u7684\u4e13\u680f\n\n\u6700\u540e\uff0c\u53cb\u60c5\u63a8\u8350\u4e0b\u8001\u94b1\u81ea\u5df1\u7684\u6280\u672f\u516c\u4f17\u53f7\u300c\u7801\u6d1e\u300d\uff0c\u5185\u90e8\u6709\u975e\u5e38\u591a\u7684\u539f\u521b\u6280\u672f\u6587\u7ae0\u503c\u5f97\u4e00\u770b\uff0c\u8001\u94b1\u540e\u7eed\u7684\u6700\u65b0\u539f\u521b\u4e5f\u4f1a\u540c\u6b65\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u3002\u4f7f\u7528\u5fae\u4fe1\u626b\u4e00\u626b\u4e0b\u9762\u7684\u4e8c\u7ef4\u7801\u5373\u53ef\u5165\u6d1e\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/9/1647e959be074ee0?w=258&h=258&f=jpeg&s=27484)\n\n## \u4ea4\u6d41\u4e92\u52a8\n\n\u5982\u679c\u8bfb\u8005\u8fd8\u6709\u5f88\u591a\u7591\u95ee\uff0c\u5c31\u53bb\u5c0f\u518c\u8bfb\u8005\u7fa4\u91cc\u9762\u968f\u610f\u63d0\u95ee\u5427\uff0c\u4e0e\u8bf8\u591a\u540c\u884c\u8fdb\u884c\u53cb\u597d\u4ea4\u6d41\uff0c\u76f8\u4fe1\u4f60\u4f1a\u6210\u957f\u66f4\u5feb\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/44\u5c3e\u58f0\u767e\u5c3a\u7aff\u5934__\u7ee7\u7eed\u6df1\u9020\u6307\u5357.md", "create_date": "2020-02-18T03:01:06.536", "order": 45}}, {"model": "subject.chapter", "pk": 52, "fields": {"title": "0\u5f00\u7bc7\u6388\u4eba\u4ee5\u9c7c\u4e0d\u82e5\u6388\u4eba\u4ee5\u6e14__Redis_\u53ef\u4ee5\u7528\u6765\u505a\u4ec0\u4e48", "topic": 2, "md5": "460e5401ee6fdc7b7dbe14b5d6b66af6", "md_body": "\n# \u5f00\u7bc7\uff1a\u6388\u4eba\u4ee5\u9c7c\u4e0d\u82e5\u6388\u4eba\u4ee5\u6e14 \u2014\u2014 Redis \u53ef\u4ee5\u7528\u6765\u505a\u4ec0\u4e48\uff1f\n\nRedis \u662f\u4e92\u8054\u7f51\u6280\u672f\u9886\u57df\u4f7f\u7528\u6700\u4e3a\u5e7f\u6cdb\u7684\u5b58\u50a8\u4e2d\u95f4\u4ef6\uff0c\u5b83\u662f\u300c**Re**mote **Di**ctionary **S**ervice\u300d\u7684\u9996\u5b57\u6bcd\u7f29\u5199\uff0c\u4e5f\u5c31\u662f\u300c\u8fdc\u7a0b\u5b57\u5178\u670d\u52a1\u300d\u3002Redis \u4ee5\u5176\u8d85\u9ad8\u7684\u6027\u80fd\u3001\u5b8c\u7f8e\u7684\u6587\u6863\u3001\u7b80\u6d01\u6613\u61c2\u7684\u6e90\u7801\u548c\u4e30\u5bcc\u7684\u5ba2\u6237\u7aef\u5e93\u652f\u6301\u5728\u5f00\u6e90\u4e2d\u95f4\u4ef6\u9886\u57df\u5e7f\u53d7\u597d\u8bc4\u3002\u56fd\u5185\u5916\u5f88\u591a\u5927\u578b\u4e92\u8054\u7f51\u516c\u53f8\u90fd\u5728\u4f7f\u7528 Redis\uff0c\u6bd4\u5982 Twitter\u3001YouPorn\u3001\u66b4\u96ea\u5a31\u4e50\u3001Github\u3001StackOverflow\u3001\u817e\u8baf\u3001\u963f\u91cc\u3001\u4eac\u4e1c\u3001\u534e\u4e3a\u3001\u65b0\u6d6a\u5fae\u535a\u7b49\u7b49\uff0c\u5f88\u591a\u4e2d\u5c0f\u578b\u516c\u53f8\u4e5f\u90fd\u6709\u5e94\u7528\u3002\u4e5f\u53ef\u4ee5\u8bf4\uff0c\u5bf9 Redis \u7684\u4e86\u89e3\u548c\u5e94\u7528\u5b9e\u8df5\u5df2\u6210\u4e3a\u5f53\u4e0b\u4e2d\u9ad8\u7ea7\u540e\u7aef\u5f00\u53d1\u8005\u7ed5\u4e0d\u5f00\u7684\u5fc5\u5907\u6280\u80fd\u3002\n\n## \u7531 Redis \u9762\u8bd5\u60f3\u5230\u7684\n\n\u5728\u9762\u8bd5\u540e\u7aef\u5de5\u7a0b\u5e08 Redis \u6280\u80fd\u7684\u65f6\u5019\uff0c\u9762\u8bd5\u5b98\u901a\u5e38\u95ee\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u201cRedis \u80fd\u7528\u6765\u505a\u4ec0\u4e48\uff1f\u201d\uff0c\u7b2c\u4e00\u4e2a\u56de\u7b54\u5f80\u5f80\u90fd\u4f1a\u662f\u300c\u7f13\u5b58\u300d\u3002\u7f13\u5b58\u786e\u5b9e\u662f Redis \u4f7f\u7528\u6700\u591a\u7684\u9886\u57df\uff0c\u5b83\u76f8\u6bd4 Memcache \u800c\u8a00\u66f4\u52a0\u6613\u4e8e\u7406\u89e3\u3001\u4f7f\u7528\u548c\u63a7\u5236\u3002\n\n\u53ef\u662f\u5982\u679c\u518d\u8fdb\u4e00\u6b65\u95ee\u201c\u8fd8\u6709\u5462\uff1f\u201d\uff0c\u5927\u591a\u6570\u540c\u5b66\u5c31\u4f1a\u5f00\u59cb\u76b1\u7709\u5934\uff0c\u53ea\u6709\u4e00\u5c0f\u90e8\u5206\u4eba\u4f1a\u56de\u7b54\u300c\u5206\u5e03\u5f0f\u9501\u300d\u3002\u5982\u679c\u4f60\u5c31\u5206\u5e03\u5f0f\u9501\u518d\u6df1\u5165\u95ee\u4e0b\u53bb\uff0c\u4ed6\u4eec\u57fa\u672c\u5c31\u4f1a\u5f00\u59cb\u6447\u5934\uff1a\u6211\u4eec\u9879\u76ee\u91cc\u9762 Redis \u7684\u9501\u65b9\u6cd5\u90fd\u662f\u522b\u4eba\uff08\u5e94\u8be5\u662f\u67b6\u6784\u5e08\uff09\u5c01\u88c5\u597d\u7684\uff0c\u62ff\u8fc7\u6765\u76f4\u63a5\u4f7f\u7528\uff0c\u5185\u90e8\u7ec6\u8282\u6ca1\u6709\u53bb\u4e86\u89e3\u8fc7\uff0c\u4e5f\u6ca1\u6709\u5fc5\u8981\u4e86\u89e3\u3002\n\n\u5bf9\u7c7b\u4f3c\u7684\u573a\u666f\uff0c\u6211\u6df1\u6709\u4f53\u4f1a\u3002\u56e0\u4e3a\u5173\u4e8e Redis \u7684\u9762\u8bd5\u9898\uff0c\u4e4b\u524d\u51c6\u5907\u4e86\u5f88\u591a\uff0c\u4f46\u662f\u771f\u6b63\u80fd\u7528\u4e0a\u7684\u5374\u5f88\u5c11\u3002\u5f53\u9762\u8bd5\u7684\u540c\u5b66\u9891\u7e41\u5730\u56de\u590d\u300c\u4e0d\u77e5\u9053\u3001\u6ca1\u7528\u8fc7\u300d\u7684\u65f6\u5019\uff0c\u518d\u7ee7\u7eed\u6df1\u5165\u8ffd\u95ee\u5df2\u7ecf\u6beb\u65e0\u610f\u4e49\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u5207\u6362\u8bdd\u9898\u4e86\u3002\u5076\u5c14\u9047\u4e0a\u51e0\u4e2a\u80fd\u6301\u7eed\u5f88\u591a\u56de\u5408\u7684\u540c\u5b66\uff0c\u4ed6\u4eec\u603b\u80fd\u4f7f\u4eba\u773c\u524d\u4e00\u4eae\u3002\u5982\u679c\u518d\u62d3\u5c55\u4e00\u4e0b\u5468\u8fb9\u77e5\u8bc6\u70b9\uff0c\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e9b\u4eba\u5f80\u5f80\u4e5f\u4f1a\u6709\u6240\u6d89\u730e\uff0c\u8fd9\u65f6\u6211\u5728\u5fc3\u4e2d\u5df2\u7ecf\u6697\u6697\u5730\u5bf9\u8fd9\u4f4d\u540c\u5b66\u4f38\u51fa\u4e86\u5927\u62c7\u6307\u3002\n\n\u8fd9\u6837\u7684\u9762\u8bd5\u7ecf\u5386\u4e8b\u540e\u4e5f\u8ba9\u6211\u6df1\u523b\u53cd\u601d\uff1a\u67b6\u6784\u5e08\u7684\u6280\u80fd\u5f88\u9ad8\uff0c\u5bf9\u63d0\u5347\u56e2\u961f\u7814\u53d1\u6548\u7387\u5f88\u6709\u5e2e\u52a9\uff0c\u6211\u4eec\u975e\u5e38\u94a6\u4f69\u548c\u7fa1\u6155\u3002\u4f46\u662f\u666e\u901a\u5f00\u53d1\u8005\u5982\u679c\u4e60\u60ef\u4e8e\u5728\u67b6\u6784\u5e08\u5c01\u88c5\u597d\u7684\u4e1c\u897f\u4e4b\u4e0a\uff0c\u53ea\u4e13\u6ce8\u4e8e\u505a\u4e1a\u52a1\u5f00\u53d1\uff0c\u90a3\u4e45\u800c\u4e45\u4e4b\uff0c\u5728\u6280\u672f\u7406\u89e3\u548c\u6210\u957f\u4e0a\u5c31\u4f1a\u53d8\u5f97\u8fdf\u949d\u751a\u81f3\u9ebb\u6728\u3002\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u770b\uff0c\u67b6\u6784\u5e08\u4e5f\u53ef\u80fd\u6210\u4e3a\u666e\u901a\u5f00\u53d1\u8005\u7684\u201c\u654c\u4eba\u201d\uff0c\u4ed6\u7684\u5f3a\u5927\u80fd\u529b\u4f1a\u8ba9\u5927\u5bb6\u53d8\u6210\u201c\u6e29\u5ba4\u7684\u82b1\u6735\u201d\uff0c\u4e00\u65e6\u9047\u5230\u73af\u5883\u53d8\u5316\u5c31\u4f1a\u4e0d\u77e5\u6240\u63aa\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/9/1647e75e1b3fba53?w=420&h=263&f=jpeg&s=30938)\n\n\u5176\u5b9e\u5f88\u591a\u4e1a\u52a1\u573a\u666f\uff0c\u5982\u679c\u4ec5\u4ec5\u662f\u4f1a\u4f7f\u7528\u67d0\u9879\u6280\u672f\u3001\u6846\u67b6\uff0c\u90a3\u662f\u518d\u7b80\u5355\u4e0d\u8fc7\u4e86\u3002\u4f46\u968f\u7740\u4e1a\u52a1\u53d1\u5c55\uff0c\u7cfb\u7edf\u7684\u7528\u6237\u91cf\u3001\u5e76\u53d1\u91cf\u6da8\u4e0a\u6765\u4e4b\u540e\uff0c\u73b0\u6709\u7cfb\u7edf\u7684\u95ee\u9898\u5c31\u4f1a\u5c42\u51fa\u4e0d\u7a77\u5730\u66b4\u9732\u51fa\u6765\u3002\u5982\u679c\u4e0d\u80fd\u6df1\u5165\u5730\u4e86\u89e3\u7cfb\u7edf\u3001\u6280\u672f\u548c\u6846\u67b6\u80cc\u540e\u7684\u6df1\u5c42\u539f\u7406\uff0c\u5f88\u591a\u95ee\u9898\u6839\u672c\u65e0\u6cd5\u7406\u89e3\u5230\u672c\u8d28\uff0c\u66f4\u8c08\u4e0d\u4e0a\u89e3\u51b3\uff0c\u4e34\u65f6\u62b1\u4f5b\u811a\u4e5f\u4e8e\u4e8b\u65e0\u8865\u3002\n\n\n\u6240\u8c13\u300c\u6388\u4eba\u4ee5\u9c7c\u4e0d\u82e5\u6388\u4eba\u4ee5\u6e14\u300d\uff0c\u672c\u5c0f\u518c\u7684\u521d\u8877\u548c\u76ee\u6807\u5c31\u662f\u5e2e\u52a9\u540e\u7aef\u5f00\u53d1\u8005\u8f83\u4e3a\u6df1\u5165\u7684\u7406\u89e3 Redis \u80cc\u540e\u7684\u539f\u7406\u548c\u5b9e\u8df5\u7ecf\u9a8c\uff0c\u505a\u5230\u77e5\u5176\u7136\u4e5f\u77e5\u5176\u6240\u4ee5\u7136\uff0c\u4e3a\u672a\u6765\u8fdb\u9636\u6210\u957f\u4e3a\u67b6\u6784\u5e08\u505a\u597d\u51c6\u5907\u3002\n\n## \u5c0f\u518c\u7684\u5185\u5bb9\u8303\u56f4\n\n\u672c\u5c0f\u518c\u4e3b\u8981\u8bb2\u89e3\u7b14\u8005\u4ece\u5b9e\u6218\u4e2d\u6478\u7d22\u603b\u7ed3\u7684 Redis \u6700\u5e38\u7528\u6700\u6838\u5fc3\u77e5\u8bc6\u70b9\uff0c\u4f46\u9650\u4e8e\u7bc7\u5e45\u548c\u7cbe\u529b\uff0c\u5e76\u6ca1\u6709\u6db5\u76d6 Redis \u5168\u90e8\u7684\u5185\u5bb9\u77e5\u8bc6\u70b9\uff0c\u6bd4\u5982 Redis \u5185\u7f6e\u7684 Lua \u811a\u672c\u5f15\u64ce\u5c31\u5b8c\u5168\u6ca1\u6709\u63d0\u5230\u3002\u4e4b\u6240\u4ee5\u4e0d\u8bb2\uff0c\u662f\u56e0\u4e3a\u5728\u5e73\u65f6\u7684\u5de5\u4f5c\u4e2d\u786e\u5b9e\u4ece\u6765\u6ca1\u6709\u4f7f\u7528\u8fc7\uff0c\u5b83\u5c31\u597d\u6bd4\u5173\u7cfb\u6570\u636e\u5e93\u7684\u5b58\u50a8\u8fc7\u7a0b\uff0c\u867d\u7136\u529f\u80fd\u5f88\u5f3a\u5927\uff0c\u4f46\u662f\u786e\u5b9e\u5f88\u5c11\u4f7f\u7528\uff0c\u800c\u4e14\u4e5f\u4e0d\u6613\u7ef4\u62a4\uff0c\u6240\u4ee5\u5c31\u4e0d\u63a8\u8350\u8bfb\u8005\u4f7f\u7528\u4e86\u3002\n\n\u5bf9\u4e8e\u5f88\u591a\u5c0f\u4f01\u4e1a\u6765\u8bf4\uff0c\u672c\u5c0f\u518c\u7684\u5f88\u591a\u5185\u5bb9\u90fd\u662f\u7528\u4e0d\u4e0a\u7684\uff0c\u56e0\u4e3a\u7cfb\u7edf\u7684\u5e76\u53d1\u91cf\u6ca1\u6709\u5230\u4e00\u5b9a\u7684\u91cf\u7ea7\uff0c\u8fd9\u4e9b\u9ad8\u7ea7\u529f\u80fd\u6839\u672c\u6ca1\u5fc5\u8981\u4f7f\u7528\u3002\u4e0d\u8fc7\u673a\u4f1a\u603b\u662f\u7559\u7ed9\u90a3\u4e9b\u6709\u51c6\u5907\u7684\u5b69\u5b50\u4eec\uff0c\u5982\u679c\u7a81\u7136\u6709\u4e00\u5929\u6d41\u91cf\u6da8\u4e0a\u6765\u4e86\uff0cRedis \u7684\u8fd9\u4e9b\u7a00\u6709\u7684\u9ad8\u7ea7\u529f\u80fd\u52bf\u5fc5\u80fd\u7acb\u5373\u6d3e\u4e0a\u7528\u573a\u3002\n\n\u8bfb\u8005\u4eec\u80af\u5b9a\u4e5f\u6ce8\u610f\u5230\uff0c\u5c0f\u518c\u6240\u6709\u7684\u6807\u9898\u90fd\u6709\u4f7f\u7528\u7279\u5b9a\u7684\u6210\u8bed\u6765\u63cf\u8ff0\u3002\u8fd9\u4e9b\u6210\u8bed\u4e0d\u662f\u968f\u4fbf\u5199\u7684\uff0c\u800c\u662f\u7cbe\u786e\u8003\u91cf\u4e86\u6210\u8bed\u7684\u542b\u4e49\u548c\u6280\u672f\u70b9\u7684\u76f8\u5173\u6027\u7cbe\u5fc3\u6311\u9009\u51fa\u6765\u7684\uff0c\u76f8\u4fe1\u8bfb\u8005\u5728\u7406\u89e3\u4e86\u6bcf\u4e2a\u5c0f\u8282\u7684\u5185\u5bb9\u4e4b\u540e\uff0c\u80af\u5b9a\u53ef\u4ee5\u660e\u767d\u5185\u5bb9\u548c\u6210\u8bed\u542b\u4e49\u7684\u76f8\u5173\u6027\u3002\u4e4b\u6240\u4ee5\u8981\u4f7f\u7528\u6210\u8bed\u4e5f\u662f\u4e3a\u4e86\u5236\u9020\u60ac\u5ff5\uff0c\u5438\u5f15\u8bfb\u8005\u63a2\u7a76\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u6280\u672f\u70b9\u4f1a\u548c\u8fd9\u4e2a\u6210\u8bed\u76f8\u5173\u3002\u8001\u94b1\u7684\u8bed\u6587\u6c34\u5e73\u4e0d\u9ad8\uff0c\u5728\u9009\u62e9\u6210\u8bed\u65f6\uff0c\u53cd\u590d\u4f7f\u7528\u4e86\u641c\u7d22\u5f15\u64ce\u3002\u5982\u679c\u8bfb\u8005\u627e\u5230\u4e86\u66f4\u8d34\u5207\u7684\u6210\u8bed\uff0c\u4e00\u5b9a\u8981\u5373\u65f6\u5728\u8bc4\u8bba\u533a\u7559\u8a00\u544a\u77e5\u3002\u5982\u679c\u88ab\u91c7\u7eb3\uff0c\u4f1a\u8003\u8651\u798f\u5229\u53cd\u9988\u3002\n\n\u597d\u4e86\uff0c\u6df1\u5165\u7406\u89e3 Redis \u7684\u5b66\u4e60\u4e4b\u65c5\u6b63\u5f0f\u5f00\u59cb\u3002\n\n## Redis \u53ef\u4ee5\u505a\u4ec0\u4e48\uff1f\n\nRedis\u7684\u4e1a\u52a1\u5e94\u7528\u8303\u56f4\u975e\u5e38\u5e7f\u6cdb\uff0c\u8ba9\u6211\u4eec\u4ee5\u6398\u91d1\u6280\u672f\u793e\u533a\uff08juejin.im\uff09\u7684\u5e16\u5b50\u6a21\u5757\u4e3a\u5b9e\u4f8b\uff0c\u68b3\u7406\u4e00\u4e0b\uff0cRedis \u53ef\u4ee5\u7528\u5728\u54ea\u4e9b\u5730\u65b9\uff1f\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/1648240fd6997ada?w=679&h=156&f=png&s=35476)\n\n1. \u8bb0\u5f55\u5e16\u5b50\u7684\u70b9\u8d5e\u6570\u3001\u8bc4\u8bba\u6570\u548c\u70b9\u51fb\u6570 (hash)\u3002\n2. \u8bb0\u5f55\u7528\u6237\u7684\u5e16\u5b50 ID \u5217\u8868 (\u6392\u5e8f)\uff0c\u4fbf\u4e8e\u5feb\u901f\u663e\u793a\u7528\u6237\u7684\u5e16\u5b50\u5217\u8868 (zset)\u3002\n3. \u8bb0\u5f55\u5e16\u5b50\u7684\u6807\u9898\u3001\u6458\u8981\u3001\u4f5c\u8005\u548c\u5c01\u9762\u4fe1\u606f\uff0c\u7528\u4e8e\u5217\u8868\u9875\u5c55\u793a (hash)\u3002\n4. \u8bb0\u5f55\u5e16\u5b50\u7684\u70b9\u8d5e\u7528\u6237 ID \u5217\u8868\uff0c\u8bc4\u8bba ID \u5217\u8868\uff0c\u7528\u4e8e\u663e\u793a\u548c\u53bb\u91cd\u8ba1\u6570 (zset)\u3002\n5. \u7f13\u5b58\u8fd1\u671f\u70ed\u5e16\u5185\u5bb9 (\u5e16\u5b50\u5185\u5bb9\u7a7a\u95f4\u5360\u7528\u6bd4\u8f83\u5927)\uff0c\u51cf\u5c11\u6570\u636e\u5e93\u538b\u529b (hash)\u3002\n6. \u8bb0\u5f55\u5e16\u5b50\u7684\u76f8\u5173\u6587\u7ae0 ID\uff0c\u6839\u636e\u5185\u5bb9\u63a8\u8350\u76f8\u5173\u5e16\u5b50 (list)\u3002\n7. \u5982\u679c\u5e16\u5b50 ID \u662f\u6574\u6570\u81ea\u589e\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528 Redis \u6765\u5206\u914d\u5e16\u5b50 ID(\u8ba1\u6570\u5668)\u3002\n8. \u6536\u85cf\u96c6\u548c\u5e16\u5b50\u4e4b\u95f4\u7684\u5173\u7cfb (zset)\u3002\n9. \u8bb0\u5f55\u70ed\u699c\u5e16\u5b50 ID \u5217\u8868\uff0c\u603b\u70ed\u699c\u548c\u5206\u7c7b\u70ed\u699c (zset)\u3002\n10. \u7f13\u5b58\u7528\u6237\u884c\u4e3a\u5386\u53f2\uff0c\u8fdb\u884c\u6076\u610f\u884c\u4e3a\u8fc7\u6ee4 (zset,hash)\u3002\n\n\u5f53\u7136\uff0c\u5b9e\u9645\u60c5\u51b5\u4e0b\u9700\u6c42\u53ef\u80fd\u4e5f\u6ca1\u8fd9\u4e48\u591a\uff0c\u56e0\u4e3a\u5728\u8bf7\u6c42\u538b\u529b\u4e0d\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u5f88\u591a\u6570\u636e\u90fd\u662f\u53ef\u4ee5\u76f4\u63a5\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u7684\u3002\u4f46\u8bf7\u6c42\u538b\u529b\u4e00\u5927\uff0c\u4ee5\u524d\u901a\u8fc7\u6570\u636e\u5e93\u76f4\u63a5\u5b58\u53d6\u7684\u6570\u636e\u5219\u5fc5\u987b\u8981\u632a\u5230\u7f13\u5b58\u91cc\u6765\u3002\n\n\u4ee5\u4e0a\u63d0\u5230\u7684\u53ea\u662f Redis \u7684\u57fa\u7840\u5e94\u7528\uff0c\u4e5f\u662f\u65e5\u5e38\u5f00\u53d1\u4e2d\u6700\u5e38\u89c1\u7684\u5e94\u7528\uff08\u5982\u679c\u4f60\u7684 Redis \u57fa\u7840\u548c\u7ecf\u9a8c\u4e0d\u8db3\uff0c\u53ef\u80fd\u9700\u8981\u9605\u8bfb\u5b8c\u4e0b\u4e00\u8282\u4e4b\u540e\u624d\u80fd\u56de\u8fc7\u5934\u6765\u601d\u8003\u8fd9\u4e2a\u95ee\u9898\uff09\u3002\u9664\u4e86\u57fa\u7840\u5e94\u7528\u4e4b\u5916\uff0c\u8fd8\u6709\u5f88\u591a\u5176\u5b83\u7684 Redis \u9ad8\u7ea7\u5e94\u7528\uff0c\u5927\u591a\u6570\u540c\u5b66\u53ef\u80fd\u4ece\u672a\u63a5\u89e6\u8fc7\uff0c\u8fd9\u90e8\u5206\u6211\u4f1a\u5728\u540e\u7eed\u7684\u7ae0\u8282\u4e2d\u9646\u7eed\u8bb2\u89e3\u3002\n\n## \u5c0f\u7ed3\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u8fc7\u4e00\u904d Redis \u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u4f30\u8ba1\u672c\u5c0f\u518c\u5927\u591a\u6570\u8bfb\u8005\u90fd\u5df2\u7ecf\u975e\u5e38\u4e86\u89e3\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f\u4e0d\u6d6a\u8d39\u592a\u591a\u7b14\u58a8\uff0c\u53ea\u8ba1\u5212\u7528\u4e00\u8282\u7684\u7bc7\u5e45\u5feb\u901f\u8bb2\u5b8c\u3002\u5982\u679c\u8bfb\u8005\u5bf9 Redis \u57fa\u7840\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u4e86\u7136\u4e8e\u80f8\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u5230\u4e0b\u4e00\u7ae0\u8282\u9605\u8bfb Redis \u7684\u9ad8\u7ea7\u77e5\u8bc6\u3002\n\n\u53e6\uff0c\u5728\u9605\u8bfb\u5c0f\u518c\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4f60\u88ab\u67d0\u4e9b\u7ae0\u8282\u5361\u4f4f\u4e86\uff0c\u4e00\u4e0b\u7406\u89e3\u4e0d\u4e86\uff0c\u53ef\u4ee5\u5148\u6de1\u5b9a\u7684\u6478\u7740\u80f8\u53e3\u544a\u8bc9\u81ea\u5df1\u201c\u4e0d\u8981\u614c\uff0c\u4e00\u5207\u90fd\u662f\u6b63\u5e38\u7684\uff01\u201d\uff0c\u7136\u540e\u4e34\u65f6\u8df3\u8fc7\u5e76\u7ee7\u7eed\u9605\u8bfb\u540e\u9762\u7684\u7ae0\u8282\u3002\u4f46\u8bf7\u5404\u4f4d\u8bfb\u8005\u52a1\u5fc5\u575a\u6301\u5230\u6700\u540e\uff0c\u76f8\u4fe1\u4f60\u4f1a\u660e\u663e\u611f\u53d7\u5230\u6280\u672f\u80fd\u529b\u7684\u5347\u534e\u3002**\u5927\u5bb6\u52a0\u6cb9**!\n\n## \u6269\u5c55\u9605\u8bfb\n\n#### 1. [\u300a\u5929\u4e0b\u65e0\u96be\u8bd5\u4e4b Redis \u9762\u8bd5\u9898\u5201\u96be\u5927\u5168\u300b](https://mp.weixin.qq.com/s/-y1zvqWEJ3Tt4h39Z0WBJg)\n\u8fd9\u7bc7\u6587\u7ae0\u662f\u8001\u94b1\u4e4b\u524d\u5c31 Redis \u9762\u8bd5\u603b\u7ed3\u7684\u4e00\u7bc7\u539f\u521b\u5206\u4eab\uff0c\u4f9b\u5927\u5bb6\u53c2\u8003\u9605\u8bfb\uff0c\u8fd9\u7bc7\u6587\u7ae0\u4e5f\u88ab IT \u6280\u672f\u5708\u5927\u53f7\u300c\u9ad8\u53ef\u7528\u67b6\u6784\u300d\u8f6c\u8f7d\u3002\n\n#### 2. \u300aRedis \u4f5c\u8005 Antirez \u5176\u4eba\u8da3\u4e8b\uff1a\u4e3a\u4ec0\u4e48 Redis \u7684\u9ed8\u8ba4\u7aef\u53e3\u662f 6379\uff1f\u300b\n\n![](https://user-gold-cdn.xitu.io/2018/7/20/164b579f0d98b52d?w=320&h=350&f=jpeg&s=38110)\n\nRedis \u7531\u610f\u5927\u5229\u4eba Salvatore Sanfilippo\uff08\u7f51\u540d Antirez\uff09 \u5f00\u53d1\uff0c\u4e0a\u56fe\u662f\u4ed6\u7684\u4e2a\u4eba\u7167\u7247\u3002Antirez \u4e0d\u4ec5\u5e05\u7684\u4e0d\u50cf\u5b9e\u529b\u6d3e\uff0c\u4e5f\u975e\u5e38\u6709\u8da3\u3002\u4ed6\u51fa\u751f\u5728\u975e\u82f1\u8bed\u7cfb\u56fd\u5bb6\uff0c\u82f1\u8bed\u80fd\u529b\u957f\u671f\u4ee5\u6765\u662f\u4e00\u4e2a\u77ed\u677f\uff0c\u4ed6\u66fe\u7ecf\u4e13\u95e8\u4e3a\u81ea\u5df1\u8e69\u811a\u7684\u82f1\u8bed\u80fd\u529b\u5199\u8fc7\u4e00\u7bc7\u535a\u6587\u300a\u82f1\u8bed\u4f24\u75db 15 \u5e74\u300b\uff0c\u7528\u81ea\u5df1\u7684\u6210\u957f\u7ecf\u5386\u6765\u9f13\u52b1\u90a3\u4e9b\u975e\u82f1\u8bed\u7cfb\u7684\u6280\u672f\u5f00\u53d1\u8005\u4eec\u52aa\u529b\u653b\u514b\u82f1\u8bed\u96be\u5173\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/20/164b5954ba398db7?w=370&h=245&f=png&s=30220)\n\n\u6211\u4eec\u90fd\u77e5\u9053 Redis \u7684\u9ed8\u8ba4\u7aef\u53e3\u662f 6379\uff0c\u8fd9\u4e2a\u7aef\u53e3\u53f7\u4e5f\u4e0d\u662f\u968f\u673a\u9009\u7684\uff0c\u800c\u662f\u7531\u624b\u673a\u952e\u76d8\u5b57\u6bcd\u300cMERZ\u300d\u7684\u4f4d\u7f6e\u51b3\u5b9a\u7684\u3002\u300cMERZ\u300d\u5728 Antirez \u7684\u670b\u53cb\u5708\u8bed\u8a00\u4e2d\u662f\u300c\u611a\u8822\u300d\u7684\u4ee3\u540d\u8bcd\uff0c\u5b83\u6e90\u4e8e\u610f\u5927\u5229\u5e7f\u544a\u5973\u90ce\u300cAlessia Merz\u300d\u5728\u7535\u89c6\u8282\u76ee\u4e0a\u8bf4\u4e86\u4e00\u5806\u611a\u8822\u7684\u8bdd\uff0c\u60f3\u5230\u8fd9\u91cc\u6211\u4e0d\u7981\u5f00\u59cb\u611f\u89c9\u5230 Antirez \u7684\u670b\u53cb\u5708\u4f3c\u4e4e\u6709\u90a3\u4e48\u70b9\u7325\u7410\u3002\n\nAntirez \u4eca\u5e74\u5df2\u7ecf\u56db\u5341\u5c81\u4e86\uff0c\u4f9d\u65e7\u5728\u5b5c\u5b5c\u4e0d\u5026\u5730\u5199\u4ee3\u7801\uff0c\u4e3a Redis \u7684\u5f00\u6e90\u4e8b\u4e1a\u6301\u7eed\u8d21\u732e\u529b\u91cf\u3002\n\n----\n\n>\u4e0b\u9762\u4e24\u7bc7\u6587\u7ae0\u662f\u8001\u94b1\u5728\u7ffb\u9605\u4e86 Redis \u4f5c\u8005 Antirez \u7684\u65e9\u671f\u535a\u5ba2\u4e4b\u540e\uff0c\u6311\u4e86\u51e0\u4e2a\u6709\u8da3\u7684\u6545\u4e8b\u505a\u4e86\u7ffb\u8bd1\uff0c\u4e5f\u5206\u4eab\u7ed9\u5e7f\u5927\u8bfb\u8005\u4eec\u3002\n#### 3. [\u300a\u6211\u4e3a Redis \u627e\u5230\u4e86\u4e00\u4e2a\u65b0\u5bb6\u2014\u2014 VMWare\u300b](https://juejin.im/post/5b55cba6f265da0fa00a1be7)\n\n#### 4. [\u300aRedis \u4f5c\u8005 Antirez \u7ecf\u5386\u7684\u300c\u6027\u522b\u6b67\u89c6\u300d\u98ce\u6ce2\u300b](https://juejin.im/post/5b580cc2e51d451915571071)", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/0\u5f00\u7bc7\u6388\u4eba\u4ee5\u9c7c\u4e0d\u82e5\u6388\u4eba\u4ee5\u6e14__Redis_\u53ef\u4ee5\u7528\u6765\u505a\u4ec0\u4e48.md", "create_date": "2020-02-18T04:11:53.921", "order": 1}}, {"model": "subject.chapter", "pk": 53, "fields": {"title": "20\u96c6\u7fa4 2\uff1a\u5206\u800c\u6cbb\u4e4b \u2014\u2014 Codis", "topic": 2, "md5": "342d4478b2fbf6b02004ad3bc35ca81f", "md_body": "# \u96c6\u7fa4 2\uff1a\u5206\u800c\u6cbb\u4e4b \u2014\u2014 Codis\n\n\u5728\u5927\u6570\u636e\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\uff0c\u5355\u4e2a Redis \u5b9e\u4f8b\u5f80\u5f80\u4f1a\u663e\u5f97\u6349\u895f\u89c1\u8098\u3002\u9996\u5148\u4f53\u73b0\u5728\u5185\u5b58\u4e0a\uff0c\u5355\u4e2a Redis \u7684\u5185\u5b58\u4e0d\u5b9c\u8fc7\u5927\uff0c\u5185\u5b58\u592a\u5927\u4f1a\u5bfc\u81f4 rdb \u6587\u4ef6\u8fc7\u5927\uff0c\u8fdb\u4e00\u6b65\u5bfc\u81f4\u4e3b\u4ece\u540c\u6b65\u65f6\u5168\u91cf\u540c\u6b65\u65f6\u95f4\u8fc7\u957f\uff0c\u5728\u5b9e\u4f8b\u91cd\u542f\u6062\u590d\u65f6\u4e5f\u4f1a\u6d88\u8017\u5f88\u957f\u7684\u6570\u636e\u52a0\u8f7d\u65f6\u95f4\uff0c\u7279\u522b\u662f\u5728\u4e91\u73af\u5883\u4e0b\uff0c\u5355\u4e2a\u5b9e\u4f8b\u5185\u5b58\u5f80\u5f80\u90fd\u662f\u53d7\u9650\u7684\u3002\u5176\u6b21\u4f53\u73b0\u5728 CPU \u7684\u5229\u7528\u7387\u4e0a\uff0c\u5355\u4e2a Redis \u5b9e\u4f8b\u53ea\u80fd\u5229\u7528\u5355\u4e2a\u6838\u5fc3\uff0c\u8fd9\u5355\u4e2a\u6838\u5fc3\u8981\u5b8c\u6210\u6d77\u91cf\u6570\u636e\u7684\u5b58\u53d6\u548c\u7ba1\u7406\u5de5\u4f5c\u538b\u529b\u4f1a\u975e\u5e38\u5927\u3002\n\n\u6b63\u662f\u5728\u8fd9\u6837\u7684\u5927\u6570\u636e\u9ad8\u5e76\u53d1\u7684\u9700\u6c42\u4e4b\u4e0b\uff0cRedis \u96c6\u7fa4\u65b9\u6848\u5e94\u8fd0\u800c\u751f\u3002\u5b83\u53ef\u4ee5\u5c06\u4f17\u591a\u5c0f\u5185\u5b58\u7684 Redis \u5b9e\u4f8b\u7efc\u5408\u8d77\u6765\uff0c\u5c06\u5206\u5e03\u5728\u591a\u53f0\u673a\u5668\u4e0a\u7684\u4f17\u591a CPU \u6838\u5fc3\u7684\u8ba1\u7b97\u80fd\u529b\u805a\u96c6\u5230\u4e00\u8d77\uff0c\u5b8c\u6210\u6d77\u91cf\u6570\u636e\u5b58\u50a8\u548c\u9ad8\u5e76\u53d1\u8bfb\u5199\u64cd\u4f5c\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163af9facdbecdbc?w=583&h=132&f=png&s=18820)\n\n[Codis](https://github.com/CodisLabs/codis) \u662f Redis \u96c6\u7fa4\u65b9\u6848\u4e4b\u4e00\uff0c\u4ee4\u6211\u4eec\u611f\u5230\u9a84\u50b2\u7684\u662f\uff0c\u5b83\u662f\u4e2d\u56fd\u4eba\u5f00\u53d1\u5e76\u5f00\u6e90\u7684\uff0c\u6765\u81ea\u524d\u8c4c\u8c46\u835a\u4e2d\u95f4\u4ef6\u56e2\u961f\u3002\u7edd\u5927\u591a\u6570\u56fd\u5185\u7684\u5f00\u6e90\u9879\u76ee\u90fd\u4e0d\u600e\u4e48\u9760\u8c31\uff0c\u4f46\u662f Codis \u975e\u5e38\u9760\u8c31\u3002\u6709\u4e86 Codis \u6280\u672f\u79ef\u7d2f\u4e4b\u540e\uff0c\u9879\u76ee\u300c\u7a81\u5934\u4eba\u300d\u5218\u5947\u53c8\u5f00\u53d1\u51fa\u6765\u4e2d\u56fd\u4eba\u81ea\u5df1\u7684\u5f00\u6e90\u5206\u5e03\u5f0f\u6570\u636e\u5e93 \u2014\u2014 [TiDB](https://github.com/pingcap/tidb)\uff0c\u53ef\u4ee5\u8bf4 6 \u5230\u98de\u8d77\u3002\n\n\u4ece Redis \u7684\u5e7f\u6cdb\u6d41\u884c\u5230 RedisCluster \u7684\u5e7f\u6cdb\u4f7f\u7528\u4e4b\u95f4\u76f8\u9694\u4e86\u597d\u591a\u5e74\uff0cCodis \u5c31\u662f\u5728\u8fd9\u6837\u7684\u5e02\u573a\u7a7a\u7f3a\u7684\u673a\u9047\u4e0b\u53d1\u5c55\u51fa\u6765\u7684\u3002\u5927\u578b\u516c\u53f8\u6709\u660e\u786e\u7684 Redis \u5728\u7ebf\u6269\u5bb9\u9700\u6c42\uff0c\u4f46\u662f\u5e02\u9762\u4e0a\u6ca1\u6709\u7279\u522b\u597d\u7684\u4e2d\u95f4\u4ef6\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/16464134248c9f73?w=639&h=303&f=png&s=26779)\n\nCodis \u4f7f\u7528 Go \u8bed\u8a00\u5f00\u53d1\uff0c\u5b83\u662f\u4e00\u4e2a\u4ee3\u7406\u4e2d\u95f4\u4ef6\uff0c\u5b83\u548c Redis \u4e00\u6837\u4e5f\u4f7f\u7528 Redis \u534f\u8bae\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5f53\u5ba2\u6237\u7aef\u5411 Codis \u53d1\u9001\u6307\u4ee4\u65f6\uff0cCodis \u8d1f\u8d23\u5c06\u6307\u4ee4\u8f6c\u53d1\u5230\u540e\u9762\u7684 Redis \u5b9e\u4f8b\u6765\u6267\u884c\uff0c\u5e76\u5c06\u8fd4\u56de\u7ed3\u679c\u518d\u8f6c\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\n\nCodis \u4e0a\u6302\u63a5\u7684\u6240\u6709 Redis \u5b9e\u4f8b\u6784\u6210\u4e00\u4e2a Redis \u96c6\u7fa4\uff0c\u5f53\u96c6\u7fa4\u7a7a\u95f4\u4e0d\u8db3\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u589e\u52a0 Redis \u5b9e\u4f8b\u6765\u5b9e\u73b0\u6269\u5bb9\u9700\u6c42\u3002\n\n\u5ba2\u6237\u7aef\u64cd\u7eb5 Codis \u540c\u64cd\u7eb5 Redis \u51e0\u4e4e\u6ca1\u6709\u533a\u522b\uff0c\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u5ba2\u6237\u7aef SDK\uff0c\u4e0d\u9700\u8981\u4efb\u4f55\u53d8\u5316\u3002\n\n\u56e0\u4e3a Codis \u662f\u65e0\u72b6\u6001\u7684\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u8f6c\u53d1\u4ee3\u7406\u4e2d\u95f4\u4ef6\uff0c\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a Codis \u5b9e\u4f8b\uff0c\u4f9b\u5ba2\u6237\u7aef\u4f7f\u7528\uff0c\u6bcf\u4e2a Codis \u8282\u70b9\u90fd\u662f\u5bf9\u7b49\u7684\u3002\u56e0\u4e3a\u5355\u4e2a Codis \u4ee3\u7406\u80fd\u652f\u6491\u7684 QPS \u6bd4\u8f83\u6709\u9650\uff0c\u901a\u8fc7\u542f\u52a8\u591a\u4e2a Codis \u4ee3\u7406\u53ef\u4ee5\u663e\u8457\u589e\u52a0\u6574\u4f53\u7684 QPS \u9700\u6c42\uff0c\u8fd8\u80fd\u8d77\u5230\u5bb9\u707e\u529f\u80fd\uff0c\u6302\u6389\u4e00\u4e2a Codis \u4ee3\u7406\u6ca1\u5173\u7cfb\uff0c\u8fd8\u6709\u5f88\u591a Codis \u4ee3\u7406\u53ef\u4ee5\u7ee7\u7eed\u670d\u52a1\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/1646414ff83e5846?w=672&h=319&f=png&s=37238)\n\nCodis \u5206\u7247\u539f\u7406\n--\nCodis \u8981\u8d1f\u8d23\u5c06\u7279\u5b9a\u7684 key \u8f6c\u53d1\u5230\u7279\u5b9a\u7684 Redis \u5b9e\u4f8b\uff0c\u90a3\u4e48\u8fd9\u79cd\u5bf9\u5e94\u5173\u7cfb Codis \u662f\u5982\u4f55\u7ba1\u7406\u7684\u5462\uff1f\n\nCodis \u5c06\u6240\u6709\u7684 key \u9ed8\u8ba4\u5212\u5206\u4e3a 1024 \u4e2a\u69fd\u4f4d(slot)\uff0c\u5b83\u9996\u5148\u5bf9\u5ba2\u6237\u7aef\u4f20\u8fc7\u6765\u7684 key \u8fdb\u884c crc32 \u8fd0\u7b97\u8ba1\u7b97\u54c8\u5e0c\u503c\uff0c\u518d\u5c06 hash \u540e\u7684\u6574\u6570\u503c\u5bf9 1024 \u8fd9\u4e2a\u6574\u6570\u8fdb\u884c\u53d6\u6a21\u5f97\u5230\u4e00\u4e2a\u4f59\u6570\uff0c\u8fd9\u4e2a\u4f59\u6570\u5c31\u662f\u5bf9\u5e94 key \u7684\u69fd\u4f4d\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163b010123791e6a?w=573&h=387&f=png&s=23473)\n\n\u6bcf\u4e2a\u69fd\u4f4d\u90fd\u4f1a\u552f\u4e00\u6620\u5c04\u5230\u540e\u9762\u7684\u591a\u4e2a Redis \u5b9e\u4f8b\u4e4b\u4e00\uff0cCodis \u4f1a\u5728\u5185\u5b58\u7ef4\u62a4\u69fd\u4f4d\u548c Redis \u5b9e\u4f8b\u7684\u6620\u5c04\u5173\u7cfb\u3002\u8fd9\u6837\u6709\u4e86\u4e0a\u9762 key \u5bf9\u5e94\u7684\u69fd\u4f4d\uff0c\u90a3\u4e48\u5b83\u5e94\u8be5\u8f6c\u53d1\u5230\u54ea\u4e2a Redis \u5b9e\u4f8b\u5c31\u5f88\u660e\u786e\u4e86\u3002\n\n```py\nhash = crc32(command.key)\nslot_index = hash % 1024\nredis = slots[slot_index].redis\nredis.do(command)\n```\n\n\u69fd\u4f4d\u6570\u91cf\u9ed8\u8ba4\u662f1024\uff0c\u5b83\u662f\u53ef\u4ee5\u914d\u7f6e\u7684\uff0c\u5982\u679c\u96c6\u7fa4\u8282\u70b9\u6bd4\u8f83\u591a\uff0c\u5efa\u8bae\u5c06\u8fd9\u4e2a\u6570\u503c\u914d\u7f6e\u5927\u4e00\u4e9b\uff0c\u6bd4\u59822048\u30014096\u3002\n\n\u4e0d\u540c\u7684 Codis \u5b9e\u4f8b\u4e4b\u95f4\u69fd\u4f4d\u5173\u7cfb\u5982\u4f55\u540c\u6b65\uff1f\n--\n\u5982\u679c Codis \u7684\u69fd\u4f4d\u6620\u5c04\u5173\u7cfb\u53ea\u5b58\u50a8\u5728\u5185\u5b58\u91cc\uff0c\u90a3\u4e48\u4e0d\u540c\u7684 Codis \u5b9e\u4f8b\u4e4b\u95f4\u7684\u69fd\u4f4d\u5173\u7cfb\u5c31\u65e0\u6cd5\u5f97\u5230\u540c\u6b65\u3002\u6240\u4ee5 Codis \u8fd8\u9700\u8981\u4e00\u4e2a\u5206\u5e03\u5f0f\u914d\u7f6e\u5b58\u50a8\u6570\u636e\u5e93\u4e13\u95e8\u7528\u6765\u6301\u4e45\u5316\u69fd\u4f4d\u5173\u7cfb\u3002Codis \u5f00\u59cb\u4f7f\u7528 ZooKeeper\uff0c\u540e\u6765\u8fde etcd \u4e5f\u4e00\u5757\u652f\u6301\u4e86\u3002\n\n\n![](https://user-gold-cdn.xitu.io/2018/7/4/16464178c9cc01fd?w=591&h=256&f=png&s=21319)\n\nCodis \u5c06\u69fd\u4f4d\u5173\u7cfb\u5b58\u50a8\u5728 zk \u4e2d\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u4e00\u4e2a Dashboard \u53ef\u4ee5\u7528\u6765\u89c2\u5bdf\u548c\u4fee\u6539\u69fd\u4f4d\u5173\u7cfb\uff0c\u5f53\u69fd\u4f4d\u5173\u7cfb\u53d8\u5316\u65f6\uff0cCodis Proxy \u4f1a\u76d1\u542c\u5230\u53d8\u5316\u5e76\u91cd\u65b0\u540c\u6b65\u69fd\u4f4d\u5173\u7cfb\uff0c\u4ece\u800c\u5b9e\u73b0\u591a\u4e2a Codis Proxy \u4e4b\u95f4\u5171\u4eab\u76f8\u540c\u7684\u69fd\u4f4d\u5173\u7cfb\u914d\u7f6e\u3002\n\n\u6269\u5bb9\n--\n\u521a\u5f00\u59cb Codis \u540e\u7aef\u53ea\u6709\u4e00\u4e2a Redis \u5b9e\u4f8b\uff0c1024 \u4e2a\u69fd\u4f4d\u5168\u90e8\u6307\u5411\u540c\u4e00\u4e2a Redis\u3002\u7136\u540e\u4e00\u4e2a Redis \u5b9e\u4f8b\u5185\u5b58\u4e0d\u591f\u4e86\uff0c\u6240\u4ee5\u53c8\u52a0\u4e86\u4e00\u4e2a Redis \u5b9e\u4f8b\u3002\u8fd9\u65f6\u5019\u9700\u8981\u5bf9\u69fd\u4f4d\u5173\u7cfb\u8fdb\u884c\u8c03\u6574\uff0c\u5c06\u4e00\u534a\u7684\u69fd\u4f4d\u5212\u5206\u5230\u65b0\u7684\u8282\u70b9\u3002\u8fd9\u610f\u5473\u7740\u9700\u8981\u5bf9\u8fd9\u4e00\u534a\u7684\u69fd\u4f4d\u5bf9\u5e94\u7684\u6240\u6709 key \u8fdb\u884c\u8fc1\u79fb\uff0c\u8fc1\u79fb\u5230\u65b0\u7684 Redis \u5b9e\u4f8b\u3002\n\n**\u90a3 Codis \u5982\u4f55\u627e\u5230\u69fd\u4f4d\u5bf9\u5e94\u7684\u6240\u6709 key \u5462\uff1f**\n\nCodis \u5bf9 Redis \u8fdb\u884c\u4e86\u6539\u9020\uff0c\u589e\u52a0\u4e86 SLOTSSCAN \u6307\u4ee4\uff0c\u53ef\u4ee5\u904d\u5386\u6307\u5b9a slot \u4e0b\u6240\u6709\u7684 key\u3002Codis \u901a\u8fc7 SLOTSSCAN \u626b\u63cf\u51fa\u5f85\u8fc1\u79fb\u69fd\u4f4d\u7684\u6240\u6709\u7684 key\uff0c\u7136\u540e\u6328\u4e2a\u8fc1\u79fb\u6bcf\u4e2a key \u5230\u65b0\u7684 Redis \u8282\u70b9\u3002\n\n\u5728\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0cCodis \u8fd8\u662f\u4f1a\u63a5\u6536\u5230\u65b0\u7684\u8bf7\u6c42\u6253\u5728\u5f53\u524d\u6b63\u5728\u8fc1\u79fb\u7684\u69fd\u4f4d\u4e0a\uff0c\u56e0\u4e3a\u5f53\u524d\u69fd\u4f4d\u7684\u6570\u636e\u540c\u65f6\u5b58\u5728\u4e8e\u65b0\u65e7\u4e24\u4e2a\u69fd\u4f4d\u4e2d\uff0cCodis \u5982\u4f55\u5224\u65ad\u8be5\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u540e\u9762\u7684\u54ea\u4e2a\u5177\u4f53\u5b9e\u4f8b\u5462\uff1f\n\nCodis \u65e0\u6cd5\u5224\u5b9a\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u7684 key \u7a76\u7adf\u5728\u54ea\u4e2a\u5b9e\u4f8b\u4e2d\uff0c\u6240\u4ee5\u5b83\u91c7\u7528\u4e86\u53e6\u4e00\u79cd\u5b8c\u5168\u4e0d\u540c\u7684\u601d\u8def\u3002\u5f53 Codis \u63a5\u6536\u5230\u4f4d\u4e8e\u6b63\u5728\u8fc1\u79fb\u69fd\u4f4d\u4e2d\u7684 key \u540e\uff0c\u4f1a\u7acb\u5373\u5f3a\u5236\u5bf9\u5f53\u524d\u7684\u5355\u4e2a key \u8fdb\u884c\u8fc1\u79fb\uff0c\u8fc1\u79fb\u5b8c\u6210\u540e\uff0c\u518d\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u65b0\u7684 Redis \u5b9e\u4f8b\u3002\n```\nslot_index = crc32(command.key) % 1024\nif slot_index in migrating_slots:\n\tdo_migrate_key(command.key)  # \u5f3a\u5236\u6267\u884c\u8fc1\u79fb\n\tredis = slots[slot_index].new_redis\nelse:\n\tredis = slots[slot_index].redis\nredis.do(command)\n```\n\u6211\u4eec\u77e5\u9053 Redis \u652f\u6301\u7684\u6240\u6709 Scan \u6307\u4ee4\u90fd\u662f\u65e0\u6cd5\u907f\u514d\u91cd\u590d\u7684\uff0c\u540c\u6837 Codis \u81ea\u5b9a\u4e49\u7684 SLOTSSCAN \u4e5f\u662f\u4e00\u6837\uff0c\u4f46\u662f\u8fd9\u5e76\u4e0d\u4f1a\u5f71\u54cd\u8fc1\u79fb\u3002\u56e0\u4e3a\u5355\u4e2a key \u88ab\u8fc1\u79fb\u4e00\u6b21\u540e\uff0c\u5728\u65e7\u5b9e\u4f8b\u4e2d\u5b83\u5c31\u5f7b\u5e95\u88ab\u5220\u9664\u4e86\uff0c\u4e5f\u5c31\u4e0d\u53ef\u80fd\u4f1a\u518d\u6b21\u88ab\u626b\u63cf\u51fa\u6765\u4e86\u3002\n\n\u81ea\u52a8\u5747\u8861\n--\nRedis \u65b0\u589e\u5b9e\u4f8b\uff0c\u624b\u5de5\u5747\u8861slots\u592a\u7e41\u7410\uff0c\u6240\u4ee5 Codis \u63d0\u4f9b\u4e86\u81ea\u52a8\u5747\u8861\u529f\u80fd\u3002\u81ea\u52a8\u5747\u8861\u4f1a\u5728\u7cfb\u7edf\u6bd4\u8f83\u7a7a\u95f2\u7684\u65f6\u5019\u89c2\u5bdf\u6bcf\u4e2a Redis \u5b9e\u4f8b\u5bf9\u5e94\u7684 Slots \u6570\u91cf\uff0c\u5982\u679c\u4e0d\u5e73\u8861\uff0c\u5c31\u4f1a\u81ea\u52a8\u8fdb\u884c\u8fc1\u79fb\u3002\n\nCodis \u7684\u4ee3\u4ef7\n--\nCodis \u7ed9 Redis \u5e26\u6765\u4e86\u6269\u5bb9\u7684\u540c\u65f6\uff0c\u4e5f\u635f\u5931\u4e86\u5176\u5b83\u4e00\u4e9b\u7279\u6027\u3002\u56e0\u4e3a Codis \u4e2d\u6240\u6709\u7684 key \u5206\u6563\u5728\u4e0d\u540c\u7684 Redis \u5b9e\u4f8b\u4e2d\uff0c\u6240\u4ee5\u4e8b\u52a1\u5c31\u4e0d\u80fd\u518d\u652f\u6301\u4e86\uff0c\u4e8b\u52a1\u53ea\u80fd\u5728\u5355\u4e2a Redis \u5b9e\u4f8b\u4e2d\u5b8c\u6210\u3002\u540c\u6837 rename \u64cd\u4f5c\u4e5f\u5f88\u5371\u9669\uff0c\u5b83\u7684\u53c2\u6570\u662f\u4e24\u4e2a key\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a key \u5728\u4e0d\u540c\u7684 Redis \u5b9e\u4f8b\u4e2d\uff0crename \u64cd\u4f5c\u662f\u65e0\u6cd5\u6b63\u786e\u5b8c\u6210\u7684\u3002Codis \u7684\u5b98\u65b9\u6587\u6863\u4e2d\u7ed9\u51fa\u4e86\u4e00\u7cfb\u5217\u4e0d\u652f\u6301\u7684\u547d\u4ee4\u5217\u8868\u3002\n\n\u540c\u6837\u4e3a\u4e86\u652f\u6301\u6269\u5bb9\uff0c\u5355\u4e2a key \u5bf9\u5e94\u7684 value \u4e0d\u5b9c\u8fc7\u5927\uff0c\u56e0\u4e3a\u96c6\u7fa4\u7684\u8fc1\u79fb\u7684\u6700\u5c0f\u5355\u4f4d\u662f key\uff0c\u5bf9\u4e8e\u4e00\u4e2a hash \u7ed3\u6784\uff0c\u5b83\u4f1a\u4e00\u6b21\u6027\u4f7f\u7528 hgetall \u62c9\u53d6\u6240\u6709\u7684\u5185\u5bb9\uff0c\u7136\u540e\u4f7f\u7528 hmset \u653e\u7f6e\u5230\u53e6\u4e00\u4e2a\u8282\u70b9\u3002\u5982\u679c hash \u5185\u90e8\u7684 kv \u592a\u591a\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u8fc1\u79fb\u5361\u987f\u3002\u5b98\u65b9\u5efa\u8bae\u5355\u4e2a\u96c6\u5408\u7ed3\u6784\u7684\u603b\u5b57\u8282\u5bb9\u91cf\u4e0d\u8981\u8d85\u8fc7 1M\u3002\u5982\u679c\u6211\u4eec\u8981\u653e\u7f6e\u793e\u4ea4\u5173\u7cfb\u6570\u636e\uff0c\u4f8b\u5982\u7c89\u4e1d\u5217\u8868\u8fd9\u79cd\uff0c\u5c31\u9700\u8981\u6ce8\u610f\u4e86\uff0c\u53ef\u4ee5\u8003\u8651\u5206\u6876\u5b58\u50a8\uff0c\u5728\u4e1a\u52a1\u4e0a\u4f5c\u6298\u4e2d\u3002\n\nCodis \u56e0\u4e3a\u589e\u52a0\u4e86 Proxy \u4f5c\u4e3a\u4e2d\u8f6c\u5c42\uff0c\u6240\u6709\u5728\u7f51\u7edc\u5f00\u9500\u4e0a\u8981\u6bd4\u5355\u4e2a Redis \u5927\uff0c\u6bd5\u7adf\u6570\u636e\u5305\u591a\u8d70\u4e86\u4e00\u4e2a\u7f51\u7edc\u8282\u70b9\uff0c\u6574\u4f53\u5728\u6027\u80fd\u4e0a\u8981\u6bd4\u5355\u4e2a Redis \u7684\u6027\u80fd\u6709\u6240\u4e0b\u964d\u3002\u4f46\u662f\u8fd9\u90e8\u5206\u6027\u80fd\u635f\u8017\u4e0d\u662f\u592a\u660e\u663e\uff0c\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0 Proxy \u7684\u6570\u91cf\u6765\u5f25\u8865\u6027\u80fd\u4e0a\u7684\u4e0d\u8db3\u3002\n\nCodis \u7684\u96c6\u7fa4\u914d\u7f6e\u4e2d\u5fc3\u4f7f\u7528 zk \u6765\u5b9e\u73b0\uff0c\u610f\u5473\u7740\u5728\u90e8\u7f72\u4e0a\u589e\u52a0\u4e86 zk \u8fd0\u7ef4\u7684\u4ee3\u4ef7\uff0c\u4e0d\u8fc7\u5927\u90e8\u5206\u4e92\u8054\u7f51\u4f01\u4e1a\u5185\u90e8\u90fd\u6709 zk \u96c6\u7fa4\uff0c\u53ef\u4ee5\u4f7f\u7528\u73b0\u6709\u7684 zk \u96c6\u7fa4\u4f7f\u7528\u5373\u53ef\u3002\n\nCodis \u7684\u4f18\u70b9\n--\nCodis \u5728\u8bbe\u8ba1\u4e0a\u76f8\u6bd4 Redis Cluster \u5b98\u65b9\u96c6\u7fa4\u65b9\u6848\u8981\u7b80\u5355\u5f88\u591a\uff0c\u56e0\u4e3a\u5b83\u5c06\u5206\u5e03\u5f0f\u7684\u95ee\u9898\u4ea4\u7ed9\u4e86\u7b2c\u4e09\u65b9 zk/etcd \u53bb\u8d1f\u8d23\uff0c\u81ea\u5df1\u5c31\u7701\u53bb\u4e86\u590d\u6742\u7684\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\u4ee3\u7801\u7684\u7f16\u5199\u7ef4\u62a4\u5de5\u4f5c\u3002\u800c Redis Cluster \u7684\u5185\u90e8\u5b9e\u73b0\u975e\u5e38\u590d\u6742\uff0c\u5b83\u4e3a\u4e86\u5b9e\u73b0\u53bb\u4e2d\u5fc3\u5316\uff0c\u6df7\u5408\u4f7f\u7528\u4e86\u590d\u6742\u7684 Raft \u548c Gossip \u534f\u8bae\uff0c\u8fd8\u6709\u5927\u91cf\u7684\u9700\u8981\u8c03\u4f18\u7684\u914d\u7f6e\u53c2\u6570\uff0c\u5f53\u96c6\u7fa4\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u7ef4\u62a4\u4eba\u5458\u5f80\u5f80\u4e0d\u77e5\u9053\u4ece\u4f55\u5904\u7740\u624b\u3002\n\nMGET \u6307\u4ee4\u7684\u64cd\u4f5c\u8fc7\u7a0b\n--\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16481f2b7825a89f?w=774&h=348&f=png&s=25251)\nmget \u6307\u4ee4\u7528\u4e8e\u6279\u91cf\u83b7\u53d6\u591a\u4e2a key \u7684\u503c\uff0c\u8fd9\u4e9b key \u53ef\u80fd\u4f1a\u5206\u5e03\u5728\u591a\u4e2a Redis \u5b9e\u4f8b\u4e2d\u3002Codis \u7684\u7b56\u7565\u662f\u5c06 key \u6309\u7167\u6240\u5206\u914d\u7684\u5b9e\u4f8b\u6253\u6563\u5206\u7ec4\uff0c\u7136\u540e\u4f9d\u6b21\u5bf9\u6bcf\u4e2a\u5b9e\u4f8b\u8c03\u7528 mget \u65b9\u6cd5\uff0c\u6700\u540e\u5c06\u7ed3\u679c\u6c47\u603b\u4e3a\u4e00\u4e2a\uff0c\u518d\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\n\n\u67b6\u6784\u53d8\u8fc1\n--\nCodis \u4f5c\u4e3a\u975e\u5b98\u65b9 Redis \u96c6\u7fa4\u65b9\u6848\uff0c\u8fd1\u51e0\u5e74\u6765\u5b83\u7684\u7ed3\u6784\u4e00\u76f4\u5728\u4e0d\u65ad\u53d8\u5316\uff0c\u4e00\u65b9\u9762\u5f53\u5b98\u65b9\u7684 Redis \u6709\u53d8\u5316\u7684\u65f6\u5019\u5b83\u8981\u5b9e\u65f6\u53bb\u8ddf\u8fdb\uff0c\u53e6\u4e00\u65b9\u9762\u5b83\u4f5c\u4e3a Redis Cluster \u7684\u7ade\u4e89\u65b9\u6848\u4e4b\u4e00\uff0c\u5b83\u8fd8\u5f97\u6301\u7eed\u63d0\u9ad8\u81ea\u5df1\u7684\u7ade\u4e89\u529b\uff0c\u7ed9\u81ea\u5df1\u589e\u52a0\u66f4\u591a\u7684\u5b98\u65b9\u96c6\u7fa4\u6240\u6ca1\u6709\u7684\u4fbf\u6377\u529f\u80fd\u3002\n\n\u6bd4\u5982 Codis \u6709\u4e2a\u7279\u8272\u7684\u5730\u65b9\u5728\u4e8e\u5f3a\u5927\u7684 Dashboard \u529f\u80fd\uff0c\u80fd\u591f\u4fbf\u6377\u5730\u5bf9 Redis \u96c6\u7fa4\u8fdb\u884c\u7ba1\u7406\u3002\u8fd9\u662f Redis \u5b98\u65b9\u6240\u6b20\u7f3a\u7684\u3002\u53e6\u5916 Codis \u8fd8\u5f00\u53d1\u4e86\u4e00\u4e2a Codis-fe(federation \u8054\u90a6) \u5de5\u5177\uff0c\u53ef\u4ee5\u540c\u65f6\u5bf9\u591a\u4e2a Codis \u96c6\u7fa4\u8fdb\u884c\u7ba1\u7406\u3002\u5728\u5927\u578b\u4f01\u4e1a\uff0cCodis \u96c6\u7fa4\u5f80\u5f80\u4f1a\u6709\u51e0\u5341\u4e2a\uff0c\u6709\u8fd9\u6837\u4e00\u4e2a\u4fbf\u6377\u7684\u8054\u90a6\u5de5\u5177\u53ef\u4ee5\u964d\u4f4e\u4e0d\u5c11\u8fd0\u7ef4\u6210\u672c\u3002\n\nCodis \u7684\u5c34\u5c2c\n--\nCodis \u4e0d\u662f Redis \u5b98\u65b9\u9879\u76ee\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u7684\u547d\u8fd0\u4f1a\u65e0\u6bd4\u66f2\u6298\uff0c\u5b83\u603b\u662f\u8981\u88ab\u5b98\u65b9 Redis \u7275\u7740\u725b\u9f3b\u5b50\u8d70\u3002\u5f53 Redis \u5b98\u65b9\u63d0\u4f9b\u4e86\u4ec0\u4e48\u529f\u80fd\u5b83\u6b20\u7f3a\u65f6\uff0cCodis \u5c31\u4f1a\u611f\u5230\u6050\u60e7\uff0c\u5bb3\u6015\u81ea\u5df1\u88ab\u5e02\u573a\u7529\u6389\uff0c\u6240\u4ee5\u5fc5\u987b\u5b9e\u65f6\u4fdd\u6301\u8ddf\u8fdb\u3002\n\n\u540c\u65f6\u56e0\u4e3a Codis \u603b\u662f\u8981\u6bd4 Redis \u5b98\u65b9\u6162\u4e00\u62cd\uff0cRedis \u5b98\u65b9\u63d0\u4f9b\u7684\u6700\u65b0\u529f\u80fd\uff0cCodis \u5f80\u5f80\u8981\u7b49\u5f88\u4e45\u624d\u80fd\u540c\u6b65\u3002\u6bd4\u5982\u73b0\u5728 Redis \u5df2\u7ecf\u8fdb\u5165\u5230 4.0 \u9636\u6bb5\uff0c\u63d0\u4f9b\u4e86\u63d2\u4ef6\u5316 Redis-Module \u652f\u6301\uff0c\u76ee\u524d Codis \u8fd8\u6ca1\u6709\u63d0\u4f9b\u89e3\u51b3\u65b9\u6848\u3002\n\n\u73b0\u5728 Redis-Cluster \u5728\u4e1a\u754c\u5df2\u7ecf\u9010\u6e10\u6d41\u884c\u8d77\u6765\uff0cCodis \u80fd\u5426\u6301\u7eed\u4fdd\u6301\u7ade\u4e89\u529b\u662f\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u770b\u5230 Codis \u5728\u4e0d\u65ad\u7684\u5dee\u5f02\u5316\u7ade\u4e89\uff0c\u7ade\u4e89\u7684\u65b9\u6cd5\u5c31\u4f53\u73b0\u5728\u5de5\u5177\u4e0a\uff0c\u800c\u4e0d\u662f\u5185\u6838\uff0c\u8fd9\u4e2a\u548c\u5b98\u65b9\u7684\u8def\u7ebf\u771f\u662f\u76f8\u53cd\u7684\uff0c\u5b98\u65b9\u5bf9\u5de5\u5177\u65e0\u6687\u987e\u53ca\uff0c\u53ea\u63d0\u4f9b\u57fa\u672c\u7684\u5de5\u5177\uff0c\u5176\u5b83\u5b8c\u5168\u4ea4\u7ed9\u7b2c\u4e09\u65b9\u53bb\u5f00\u53d1\u3002\n\nCodis \u7684\u540e\u53f0\u7ba1\u7406\n--\n\u540e\u53f0\u7ba1\u7406\u7684\u754c\u9762\u975e\u5e38\u53cb\u597d\uff0c\u4f7f\u7528\u4e86\u6700\u65b0\u7684 BootStrap \u524d\u7aef\u6846\u67b6\u3002\u6bd4\u8f83\u9177\u70ab\u7684\u662f\u53ef\u4ee5\u770b\u5230\u5b9e\u65f6\u7684 QPS \u6ce2\u52a8\u66f2\u7ebf\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163af25a3336bf5e?w=1180&h=1549&f=png&s=211168)\n\n\u540c\u65f6\u8fd8\u652f\u6301\u670d\u52a1\u5668\u96c6\u7fa4\u7ba1\u7406\u529f\u80fd\uff0c\u53ef\u4ee5\u589e\u52a0\u5206\u7ec4\u3001\u589e\u52a0\u8282\u70b9\u3001\u6267\u884c\u81ea\u52a8\u5747\u8861\u7b49\u6307\u4ee4\uff0c\u8fd8\u53ef\u4ee5\u76f4\u63a5\u67e5\u770b\u6240\u6709 slot \u7684\u72b6\u6001\uff0c\u6bcf\u4e2a slot \u88ab\u5206\u914d\u5230\u54ea\u4e2a Redis \u5b9e\u4f8b\u3002\n\n\u601d\u8003 & \u4f5c\u4e1a\n--\n1. \u8bf7\u8bfb\u8005\u81ea\u5df1\u5c1d\u8bd5\u642d\u5efa\u4e00\u4e2a Codis \u96c6\u7fa4\u3002\n2. \u4f7f\u7528 Python \u6216\u8005 Java \u5ba2\u6237\u7aef\u4f53\u9a8c\u4e00\u4e0b Codis \u96c6\u7fa4\u7684\u5e38\u89c4 Redis \u6307\u4ee4\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/20\u96c6\u7fa4_2\u5206\u800c\u6cbb\u4e4b__Codis.md", "create_date": "2020-02-18T04:11:53.925", "order": 21}}, {"model": "subject.chapter", "pk": 54, "fields": {"title": "8\u5e94\u7528 7\uff1a\u4e00\u6bdb\u4e0d\u62d4 \u2014\u2014 \u6f0f\u6597\u9650\u6d41", "topic": 2, "md5": "55aac009604ea1f77e066a22713160e4", "md_body": "# \u5e94\u7528 7\uff1a\u4e00\u6bdb\u4e0d\u62d4 \u2014\u2014 \u6f0f\u6597\u9650\u6d41\n\n\u6f0f\u6597\u9650\u6d41\u662f\u6700\u5e38\u7528\u7684\u9650\u6d41\u65b9\u6cd5\u4e4b\u4e00\uff0c\u987e\u540d\u601d\u4e49\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u7684\u7075\u611f\u6e90\u4e8e\u6f0f\u6597\uff08funnel\uff09\u7684\u7ed3\u6784\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/164847a37cfcea2e?w=730&h=320&f=png&s=73710)\n\n\u6f0f\u6597\u7684\u5bb9\u91cf\u662f\u6709\u9650\u7684\uff0c\u5982\u679c\u5c06\u6f0f\u5634\u5835\u4f4f\uff0c\u7136\u540e\u4e00\u76f4\u5f80\u91cc\u9762\u704c\u6c34\uff0c\u5b83\u5c31\u4f1a\u53d8\u6ee1\uff0c\u76f4\u81f3\u518d\u4e5f\u88c5\u4e0d\u8fdb\u53bb\u3002\u5982\u679c\u5c06\u6f0f\u5634\u653e\u5f00\uff0c\u6c34\u5c31\u4f1a\u5f80\u4e0b\u6d41\uff0c\u6d41\u8d70\u4e00\u90e8\u5206\u4e4b\u540e\uff0c\u5c31\u53c8\u53ef\u4ee5\u7ee7\u7eed\u5f80\u91cc\u9762\u704c\u6c34\u3002\u5982\u679c\u6f0f\u5634\u6d41\u6c34\u7684\u901f\u7387\u5927\u4e8e\u704c\u6c34\u7684\u901f\u7387\uff0c\u90a3\u4e48\u6f0f\u6597\u6c38\u8fdc\u90fd\u88c5\u4e0d\u6ee1\u3002\u5982\u679c\u6f0f\u5634\u6d41\u6c34\u901f\u7387\u5c0f\u4e8e\u704c\u6c34\u7684\u901f\u7387\uff0c\u90a3\u4e48\u4e00\u65e6\u6f0f\u6597\u6ee1\u4e86\uff0c\u704c\u6c34\u5c31\u9700\u8981\u6682\u505c\u5e76\u7b49\u5f85\u6f0f\u6597\u817e\u7a7a\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/11/16487813367a459d?w=483&h=174&f=png&s=30383)\n\n\u6240\u4ee5\uff0c\u6f0f\u6597\u7684\u5269\u4f59\u7a7a\u95f4\u5c31\u4ee3\u8868\u7740\u5f53\u524d\u884c\u4e3a\u53ef\u4ee5\u6301\u7eed\u8fdb\u884c\u7684\u6570\u91cf\uff0c\u6f0f\u5634\u7684\u6d41\u6c34\u901f\u7387\u4ee3\u8868\u7740\u7cfb\u7edf\u5141\u8bb8\u8be5\u884c\u4e3a\u7684\u6700\u5927\u9891\u7387\u3002\u4e0b\u9762\u6211\u4eec\u4f7f\u7528\u4ee3\u7801\u6765\u63cf\u8ff0\u5355\u673a\u6f0f\u6597\u7b97\u6cd5\u3002\n\n```py\n# coding: utf8\n\nimport time\n\nclass Funnel(object):\n\n    def __init__(self, capacity, leaking_rate):\n        self.capacity = capacity  # \u6f0f\u6597\u5bb9\u91cf\n        self.leaking_rate = leaking_rate  # \u6f0f\u5634\u6d41\u6c34\u901f\u7387\n        self.left_quota = capacity  # \u6f0f\u6597\u5269\u4f59\u7a7a\u95f4\n        self.leaking_ts = time.time()  # \u4e0a\u4e00\u6b21\u6f0f\u6c34\u65f6\u95f4\n\n    def make_space(self):\n        now_ts = time.time()\n        delta_ts = now_ts - self.leaking_ts  # \u8ddd\u79bb\u4e0a\u4e00\u6b21\u6f0f\u6c34\u8fc7\u53bb\u4e86\u591a\u4e45\n        delta_quota = delta_ts * self.leaking_rate  # \u53c8\u53ef\u4ee5\u817e\u51fa\u4e0d\u5c11\u7a7a\u95f4\u4e86\n        if delta_quota < 1:  # \u817e\u7684\u7a7a\u95f4\u592a\u5c11\uff0c\u90a3\u5c31\u7b49\u4e0b\u6b21\u5427\n            return\n        self.left_quota += delta_quota  # \u589e\u52a0\u5269\u4f59\u7a7a\u95f4\n        self.leaking_ts = now_ts  # \u8bb0\u5f55\u6f0f\u6c34\u65f6\u95f4\n        if self.left_quota > self.capacity:  # \u5269\u4f59\u7a7a\u95f4\u4e0d\u5f97\u9ad8\u4e8e\u5bb9\u91cf\n            self.left_quota = self.capacity\n\n    def watering(self, quota):\n        self.make_space()\n        if self.left_quota >= quota:  # \u5224\u65ad\u5269\u4f59\u7a7a\u95f4\u662f\u5426\u8db3\u591f\n            self.left_quota -= quota\n            return True\n        return False\n\n\nfunnels = {}  # \u6240\u6709\u7684\u6f0f\u6597\n\n# capacity  \u6f0f\u6597\u5bb9\u91cf\n# leaking_rate \u6f0f\u5634\u6d41\u6c34\u901f\u7387 quota/s\ndef is_action_allowed(\n        user_id, action_key, capacity, leaking_rate):\n    key = '%s:%s' % (user_id, action_key)\n    funnel = funnels.get(key)\n    if not funnel:\n        funnel = Funnel(capacity, leaking_rate)\n        funnels[key] = funnel\n    return funnel.watering(1)\n\n\nfor i in range(20):\n    print is_action_allowed('laoqian', 'reply', 15, 0.5)\n```\n\u518d\u63d0\u4f9b\u4e00\u4e2a Java \u7248\u672c\u7684\uff1a\n```java\npublic class FunnelRateLimiter {\n\n  static class Funnel {\n    int capacity;\n    float leakingRate;\n    int leftQuota;\n    long leakingTs;\n\n    public Funnel(int capacity, float leakingRate) {\n      this.capacity = capacity;\n      this.leakingRate = leakingRate;\n      this.leftQuota = capacity;\n      this.leakingTs = System.currentTimeMillis();\n    }\n\n    void makeSpace() {\n      long nowTs = System.currentTimeMillis();\n      long deltaTs = nowTs - leakingTs;\n      int deltaQuota = (int) (deltaTs * leakingRate);\n      if (deltaQuota < 0) { // \u95f4\u9694\u65f6\u95f4\u592a\u957f\uff0c\u6574\u6570\u6570\u5b57\u8fc7\u5927\u6ea2\u51fa\n        this.leftQuota = capacity;\n        this.leakingTs = nowTs;\n        return;\n      }\n      if (deltaQuota < 1) { // \u817e\u51fa\u7a7a\u95f4\u592a\u5c0f\uff0c\u6700\u5c0f\u5355\u4f4d\u662f1\n        return;\n      }\n      this.leftQuota += deltaQuota;\n      this.leakingTs = nowTs;\n      if (this.leftQuota > this.capacity) {\n        this.leftQuota = this.capacity;\n      }\n    }\n\n    boolean watering(int quota) {\n      makeSpace();\n      if (this.leftQuota >= quota) {\n        this.leftQuota -= quota;\n        return true;\n      }\n      return false;\n    }\n  }\n\n  private Map<String, Funnel> funnels = new HashMap<>();\n\n  public boolean isActionAllowed(String userId, String actionKey, int capacity, float leakingRate) {\n    String key = String.format(\"%s:%s\", userId, actionKey);\n    Funnel funnel = funnels.get(key);\n    if (funnel == null) {\n      funnel = new Funnel(capacity, leakingRate);\n      funnels.put(key, funnel);\n    }\n    return funnel.watering(1); // \u9700\u89811\u4e2aquota\n  }\n}\n```\nFunnel \u5bf9\u8c61\u7684 make_space \u65b9\u6cd5\u662f\u6f0f\u6597\u7b97\u6cd5\u7684\u6838\u5fc3\uff0c\u5176\u5728\u6bcf\u6b21\u704c\u6c34\u524d\u90fd\u4f1a\u88ab\u8c03\u7528\u4ee5\u89e6\u53d1\u6f0f\u6c34\uff0c\u7ed9\u6f0f\u6597\u817e\u51fa\u7a7a\u95f4\u6765\u3002\u80fd\u817e\u51fa\u591a\u5c11\u7a7a\u95f4\u53d6\u51b3\u4e8e\u8fc7\u53bb\u4e86\u591a\u4e45\u4ee5\u53ca\u6d41\u6c34\u7684\u901f\u7387\u3002Funnel \u5bf9\u8c61\u5360\u636e\u7684\u7a7a\u95f4\u5927\u5c0f\u4e0d\u518d\u548c\u884c\u4e3a\u7684\u9891\u7387\u6210\u6b63\u6bd4\uff0c\u5b83\u7684\u7a7a\u95f4\u5360\u7528\u662f\u4e00\u4e2a\u5e38\u91cf\u3002\n\n\u95ee\u9898\u6765\u4e86\uff0c\u5206\u5e03\u5f0f\u7684\u6f0f\u6597\u7b97\u6cd5\u8be5\u5982\u4f55\u5b9e\u73b0\uff1f\u80fd\u4e0d\u80fd\u4f7f\u7528 Redis \u7684\u57fa\u7840\u6570\u636e\u7ed3\u6784\u6765\u641e\u5b9a\uff1f\n\n\u6211\u4eec\u89c2\u5bdf Funnel \u5bf9\u8c61\u7684\u51e0\u4e2a\u5b57\u6bb5\uff0c\u6211\u4eec\u53d1\u73b0\u53ef\u4ee5\u5c06 Funnel \u5bf9\u8c61\u7684\u5185\u5bb9\u6309\u5b57\u6bb5\u5b58\u50a8\u5230\u4e00\u4e2a hash \u7ed3\u6784\u4e2d\uff0c\u704c\u6c34\u7684\u65f6\u5019\u5c06 hash \u7ed3\u6784\u7684\u5b57\u6bb5\u53d6\u51fa\u6765\u8fdb\u884c\u903b\u8f91\u8fd0\u7b97\u540e\uff0c\u518d\u5c06\u65b0\u503c\u56de\u586b\u5230 hash \u7ed3\u6784\u4e2d\u5c31\u5b8c\u6210\u4e86\u4e00\u6b21\u884c\u4e3a\u9891\u5ea6\u7684\u68c0\u6d4b\u3002\n\n\u4f46\u662f\u6709\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u65e0\u6cd5\u4fdd\u8bc1\u6574\u4e2a\u8fc7\u7a0b\u7684\u539f\u5b50\u6027\u3002\u4ece hash \u7ed3\u6784\u4e2d\u53d6\u503c\uff0c\u7136\u540e\u5728\u5185\u5b58\u91cc\u8fd0\u7b97\uff0c\u518d\u56de\u586b\u5230 hash \u7ed3\u6784\uff0c\u8fd9\u4e09\u4e2a\u8fc7\u7a0b\u65e0\u6cd5\u539f\u5b50\u5316\uff0c\u610f\u5473\u7740\u9700\u8981\u8fdb\u884c\u9002\u5f53\u7684\u52a0\u9501\u63a7\u5236\u3002\u800c\u4e00\u65e6\u52a0\u9501\uff0c\u5c31\u610f\u5473\u7740\u4f1a\u6709\u52a0\u9501\u5931\u8d25\uff0c\u52a0\u9501\u5931\u8d25\u5c31\u9700\u8981\u9009\u62e9\u91cd\u8bd5\u6216\u8005\u653e\u5f03\u3002\n\n\u5982\u679c\u91cd\u8bd5\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002\u5982\u679c\u653e\u5f03\u7684\u8bdd\uff0c\u5c31\u4f1a\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u540c\u65f6\uff0c\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u4e5f\u8ddf\u7740\u5347\u9ad8\u5f88\u591a\u3002\u8fd9\u771f\u662f\u4e2a\u8270\u96be\u7684\u9009\u62e9\uff0c\u6211\u4eec\u8be5\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1fRedis-Cell \u6551\u661f\u6765\u4e86\uff01\n\n## Redis-Cell\n\nRedis 4.0 \u63d0\u4f9b\u4e86\u4e00\u4e2a\u9650\u6d41 Redis \u6a21\u5757\uff0c\u5b83\u53eb redis-cell\u3002\u8be5\u6a21\u5757\u4e5f\u4f7f\u7528\u4e86\u6f0f\u6597\u7b97\u6cd5\uff0c\u5e76\u63d0\u4f9b\u4e86\u539f\u5b50\u7684\u9650\u6d41\u6307\u4ee4\u3002\u6709\u4e86\u8fd9\u4e2a\u6a21\u5757\uff0c\u9650\u6d41\u95ee\u9898\u5c31\u975e\u5e38\u7b80\u5355\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/11/1648780927d6f4ec?w=522&h=202&f=png&s=32765)\n\n\u8be5\u6a21\u5757\u53ea\u67091\u6761\u6307\u4ee4```cl.throttle```\uff0c\u5b83\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u90fd\u7565\u663e\u590d\u6742\uff0c\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u6765\u770b\u770b\u8fd9\u4e2a\u6307\u4ee4\u5177\u4f53\u8be5\u5982\u4f55\u4f7f\u7528\u3002\n```\n> cl.throttle laoqian:reply 15 30 60 1\n                      \u25b2     \u25b2  \u25b2  \u25b2  \u25b2\n                      |     |  |  |  \u2514\u2500\u2500\u2500\u2500\u2500 need 1 quota (\u53ef\u9009\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u4e5f\u662f1)\n                      |     |  \u2514\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500 30 operations / 60 seconds \u8fd9\u662f\u6f0f\u6c34\u901f\u7387\n                      |     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 15 capacity \u8fd9\u662f\u6f0f\u6597\u5bb9\u91cf\n                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 key laoqian\n```\n\u4e0a\u9762\u8fd9\u4e2a\u6307\u4ee4\u7684\u610f\u601d\u662f\u5141\u8bb8\u300c\u7528\u6237\u8001\u94b1\u56de\u590d\u884c\u4e3a\u300d\u7684\u9891\u7387\u4e3a\u6bcf 60s \u6700\u591a 30 \u6b21(\u6f0f\u6c34\u901f\u7387)\uff0c\u6f0f\u6597\u7684\u521d\u59cb\u5bb9\u91cf\u4e3a 15\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u5f00\u59cb\u53ef\u4ee5\u8fde\u7eed\u56de\u590d 15 \u4e2a\u5e16\u5b50\uff0c\u7136\u540e\u624d\u5f00\u59cb\u53d7\u6f0f\u6c34\u901f\u7387\u7684\u5f71\u54cd\u3002\u6211\u4eec\u770b\u5230\u8fd9\u4e2a\u6307\u4ee4\u4e2d\u6f0f\u6c34\u901f\u7387\u53d8\u6210\u4e86 2 \u4e2a\u53c2\u6570\uff0c\u66ff\u4ee3\u4e86\u4e4b\u524d\u7684\u5355\u4e2a\u6d6e\u70b9\u6570\u3002\u7528\u4e24\u4e2a\u53c2\u6570\u76f8\u9664\u7684\u7ed3\u679c\u6765\u8868\u8fbe\u6f0f\u6c34\u901f\u7387\u76f8\u5bf9\u5355\u4e2a\u6d6e\u70b9\u6570\u8981\u66f4\u52a0\u76f4\u89c2\u4e00\u4e9b\u3002\n```\n> cl.throttle laoqian:reply 15 30 60\n1) (integer) 0   # 0 \u8868\u793a\u5141\u8bb8\uff0c1\u8868\u793a\u62d2\u7edd\n2) (integer) 15  # \u6f0f\u6597\u5bb9\u91cfcapacity\n3) (integer) 14  # \u6f0f\u6597\u5269\u4f59\u7a7a\u95f4left_quota\n4) (integer) -1  # \u5982\u679c\u62d2\u7edd\u4e86\uff0c\u9700\u8981\u591a\u957f\u65f6\u95f4\u540e\u518d\u8bd5(\u6f0f\u6597\u6709\u7a7a\u95f4\u4e86\uff0c\u5355\u4f4d\u79d2)\n5) (integer) 2   # \u591a\u957f\u65f6\u95f4\u540e\uff0c\u6f0f\u6597\u5b8c\u5168\u7a7a\u51fa\u6765(left_quota==capacity\uff0c\u5355\u4f4d\u79d2)\n```\n\n\u5728\u6267\u884c\u9650\u6d41\u6307\u4ee4\u65f6\uff0c\u5982\u679c\u88ab\u62d2\u7edd\u4e86\uff0c\u5c31\u9700\u8981\u4e22\u5f03\u6216\u91cd\u8bd5\u3002cl.throttle \u6307\u4ee4\u8003\u8651\u7684\u975e\u5e38\u5468\u5230\uff0c\u8fde\u91cd\u8bd5\u65f6\u95f4\u90fd\u5e2e\u4f60\u7b97\u597d\u4e86\uff0c\u76f4\u63a5\u53d6\u8fd4\u56de\u7ed3\u679c\u6570\u7ec4\u7684\u7b2c\u56db\u4e2a\u503c\u8fdb\u884c sleep \u5373\u53ef\uff0c\u5982\u679c\u4e0d\u60f3\u963b\u585e\u7ebf\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u5f02\u6b65\u5b9a\u65f6\u4efb\u52a1\u6765\u91cd\u8bd5\u3002\n\n## \u601d\u8003\n\u6f0f\u6597\u9650\u6d41\u6a21\u5757\u9664\u4e86\u5e94\u7528\u4e8e UGC\uff0c\u8fd8\u80fd\u5e94\u7528\u4e8e\u54ea\u4e9b\u5730\u65b9\uff1f\n\n## \u62d3\u5c55\u9605\u8bfb\n\n**1. \u300aRedis-Cell \u4f5c\u8005 Itamar Haber \u5176\u4eba\u8da3\u4e8b\u300b**\n\n![](https://user-gold-cdn.xitu.io/2018/7/11/164872dc531f1a48?w=865&h=141&f=png&s=56775)\n\nRedis-Cell \u4f5c\u8005 Itamar Haber  \u7684\u4ecb\u7ecd\u5f88\u6709\u610f\u601d\u2014\u2014\u4e00\u4e2a\u300c\u81ea\u5c01\u300d\u7684 Redis \u6781\u5ba2\u3002\u8fd8\u6709\uff0cCell \u8fd9\u4e2a\u6a21\u5757\u5c45\u7136\u662f\u7528 Rust \u7f16\u5199\u7684\u3002\u2014\u2014 \u539f\u6765 Redis \u6a21\u5757\u53ef\u4ee5\u4f7f\u7528 Rust \u7f16\u5199\uff1f\uff01\n\n\u8fd9\u610f\u5473\u7740\u6211\u4eec\u4e0d\u7528\u53bb\u641e\u53e4\u8001\u7684 C \u8bed\u8a00\u4e86\u3002\u8001\u94b1\u8868\u793a\u8981\u91cd\u65b0\u62fe\u8d77\u653e\u5f03\u5f88\u4e45\u7684 Rust \u8bed\u8a00\u3002\u54ce\uff0c\u5e72\u7a0b\u5e8f\u5458\u8fd9\u4e00\u884c\uff0c\u771f\u662f\u8981\u6d3b\u5230\u8001\uff0c\u5b66\u5230\u6b7b\u554a\uff01\n", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/8\u5e94\u7528_7\u4e00\u6bdb\u4e0d\u62d4__\u6f0f\u6597\u9650\u6d41.md", "create_date": "2020-02-18T04:11:53.924", "order": 9}}, {"model": "subject.chapter", "pk": 55, "fields": {"title": "5\u5e94\u7528 4\uff1a\u56db\u4e24\u62e8\u5343\u65a4 \u2014\u2014 HyperLogLog", "topic": 2, "md5": "85ccd813ea35ebe30278d80d80b34bbc", "md_body": "# \u5e94\u7528 4\uff1a\u56db\u4e24\u62e8\u5343\u65a4 \u2014\u2014 HyperLogLog\n\n\u5728\u5f00\u59cb\u8fd9\u4e00\u8282\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e2a\u5e38\u89c1\u7684\u4e1a\u52a1\u95ee\u9898\uff1a\u5982\u679c\u4f60\u8d1f\u8d23\u5f00\u53d1\u7ef4\u62a4\u4e00\u4e2a\u5927\u578b\u7684\u7f51\u7ad9\uff0c\u6709\u4e00\u5929\u8001\u677f\u627e\u4ea7\u54c1\u7ecf\u7406\u8981\u7f51\u7ad9\u6bcf\u4e2a\u7f51\u9875\u6bcf\u5929\u7684 UV \u6570\u636e\uff0c\u7136\u540e\u8ba9\u4f60\u6765\u5f00\u53d1\u8fd9\u4e2a\u7edf\u8ba1\u6a21\u5757\uff0c\u4f60\u4f1a\u5982\u4f55\u5b9e\u73b0\uff1f\n\n![](https://user-gold-cdn.xitu.io/2018/7/12/1648f065e38200cb?w=400&h=128&f=gif&s=250971)\n\n\u5982\u679c\u7edf\u8ba1 PV \u90a3\u975e\u5e38\u597d\u529e\uff0c\u7ed9\u6bcf\u4e2a\u7f51\u9875\u4e00\u4e2a\u72ec\u7acb\u7684 Redis \u8ba1\u6570\u5668\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u4e2a\u8ba1\u6570\u5668\u7684 key \u540e\u7f00\u52a0\u4e0a\u5f53\u5929\u7684\u65e5\u671f\u3002\u8fd9\u6837\u6765\u4e00\u4e2a\u8bf7\u6c42\uff0cincrby \u4e00\u6b21\uff0c\u6700\u7ec8\u5c31\u53ef\u4ee5\u7edf\u8ba1\u51fa\u6240\u6709\u7684 PV \u6570\u636e\u3002\n\n\u4f46\u662f UV \u4e0d\u4e00\u6837\uff0c\u5b83\u8981\u53bb\u91cd\uff0c\u540c\u4e00\u4e2a\u7528\u6237\u4e00\u5929\u4e4b\u5185\u7684\u591a\u6b21\u8bbf\u95ee\u8bf7\u6c42\u53ea\u80fd\u8ba1\u6570\u4e00\u6b21\u3002\u8fd9\u5c31\u8981\u6c42\u6bcf\u4e00\u4e2a\u7f51\u9875\u8bf7\u6c42\u90fd\u9700\u8981\u5e26\u4e0a\u7528\u6237\u7684 ID\uff0c\u65e0\u8bba\u662f\u767b\u9646\u7528\u6237\u8fd8\u662f\u672a\u767b\u9646\u7528\u6237\u90fd\u9700\u8981\u4e00\u4e2a\u552f\u4e00 ID \u6765\u6807\u8bc6\u3002\n\n\u4f60\u4e5f\u8bb8\u5df2\u7ecf\u60f3\u5230\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u65b9\u6848\uff0c\u90a3\u5c31\u662f\u4e3a\u6bcf\u4e00\u4e2a\u9875\u9762\u4e00\u4e2a\u72ec\u7acb\u7684 set \u96c6\u5408\u6765\u5b58\u50a8\u6240\u6709\u5f53\u5929\u8bbf\u95ee\u8fc7\u6b64\u9875\u9762\u7684\u7528\u6237 ID\u3002\u5f53\u4e00\u4e2a\u8bf7\u6c42\u8fc7\u6765\u65f6\uff0c\u6211\u4eec\u4f7f\u7528 sadd \u5c06\u7528\u6237 ID \u585e\u8fdb\u53bb\u5c31\u53ef\u4ee5\u4e86\u3002\u901a\u8fc7 scard \u53ef\u4ee5\u53d6\u51fa\u8fd9\u4e2a\u96c6\u5408\u7684\u5927\u5c0f\uff0c\u8fd9\u4e2a\u6570\u5b57\u5c31\u662f\u8fd9\u4e2a\u9875\u9762\u7684 UV \u6570\u636e\u3002\u6ca1\u9519\uff0c\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u65b9\u6848\u3002\n\n\u4f46\u662f\uff0c\u5982\u679c\u4f60\u7684\u9875\u9762\u8bbf\u95ee\u91cf\u975e\u5e38\u5927\uff0c\u6bd4\u5982\u4e00\u4e2a\u7206\u6b3e\u9875\u9762\u51e0\u5343\u4e07\u7684 UV\uff0c\u4f60\u9700\u8981\u4e00\u4e2a\u5f88\u5927\u7684 set \u96c6\u5408\u6765\u7edf\u8ba1\uff0c\u8fd9\u5c31\u975e\u5e38\u6d6a\u8d39\u7a7a\u95f4\u3002\u5982\u679c\u8fd9\u6837\u7684\u9875\u9762\u5f88\u591a\uff0c\u90a3\u6240\u9700\u8981\u7684\u5b58\u50a8\u7a7a\u95f4\u662f\u60ca\u4eba\u7684\u3002\u4e3a\u8fd9\u6837\u4e00\u4e2a\u53bb\u91cd\u529f\u80fd\u5c31\u8017\u8d39\u8fd9\u6837\u591a\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u503c\u5f97\u4e48\uff1f\u5176\u5b9e\u8001\u677f\u9700\u8981\u7684\u6570\u636e\u53c8\u4e0d\u9700\u8981\u592a\u7cbe\u786e\uff0c105w \u548c 106w \u8fd9\u4e24\u4e2a\u6570\u5b57\u5bf9\u4e8e\u8001\u677f\u4eec\u6765\u8bf4\u5e76\u6ca1\u6709\u591a\u5927\u533a\u522b\uff0cSo\uff0c\u6709\u6ca1\u6709\u66f4\u597d\u7684\u89e3\u51b3\u65b9\u6848\u5462\uff1f\n\n\u8fd9\u5c31\u662f\u672c\u8282\u8981\u5f15\u5165\u7684\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\uff0cRedis \u63d0\u4f9b\u4e86 HyperLogLog \u6570\u636e\u7ed3\u6784\u5c31\u662f\u7528\u6765\u89e3\u51b3\u8fd9\u79cd\u7edf\u8ba1\u95ee\u9898\u7684\u3002HyperLogLog \u63d0\u4f9b\u4e0d\u7cbe\u786e\u7684\u53bb\u91cd\u8ba1\u6570\u65b9\u6848\uff0c\u867d\u7136\u4e0d\u7cbe\u786e\u4f46\u662f\u4e5f\u4e0d\u662f\u975e\u5e38\u4e0d\u7cbe\u786e\uff0c\u6807\u51c6\u8bef\u5dee\u662f 0.81%\uff0c\u8fd9\u6837\u7684\u7cbe\u786e\u5ea6\u5df2\u7ecf\u53ef\u4ee5\u6ee1\u8db3\u4e0a\u9762\u7684 UV \u7edf\u8ba1\u9700\u6c42\u4e86\u3002\n\nHyperLogLog \u6570\u636e\u7ed3\u6784\u662f Redis \u7684\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u975e\u5e38\u6709\u7528\uff0c\u4f46\u662f\u4ee4\u4eba\u611f\u5230\u610f\u5916\u7684\u662f\uff0c\u4f7f\u7528\u8fc7\u5b83\u7684\u4eba\u975e\u5e38\u5c11\u3002\n\n## \u4f7f\u7528\u65b9\u6cd5\n\nHyperLogLog \u63d0\u4f9b\u4e86\u4e24\u4e2a\u6307\u4ee4 pfadd \u548c pfcount\uff0c\u6839\u636e\u5b57\u9762\u610f\u4e49\u5f88\u597d\u7406\u89e3\uff0c\u4e00\u4e2a\u662f\u589e\u52a0\u8ba1\u6570\uff0c\u4e00\u4e2a\u662f\u83b7\u53d6\u8ba1\u6570\u3002pfadd \u7528\u6cd5\u548c set \u96c6\u5408\u7684 sadd \u662f\u4e00\u6837\u7684\uff0c\u6765\u4e00\u4e2a\u7528\u6237 ID\uff0c\u5c31\u5c06\u7528\u6237 ID \u585e\u8fdb\u53bb\u5c31\u662f\u3002pfcount \u548c scard \u7528\u6cd5\u662f\u4e00\u6837\u7684\uff0c\u76f4\u63a5\u83b7\u53d6\u8ba1\u6570\u503c\u3002\n\n```bash\n127.0.0.1:6379> pfadd codehole user1\n(integer) 1\n127.0.0.1:6379> pfcount codehole\n(integer) 1\n127.0.0.1:6379> pfadd codehole user2\n(integer) 1\n127.0.0.1:6379> pfcount codehole\n(integer) 2\n127.0.0.1:6379> pfadd codehole user3\n(integer) 1\n127.0.0.1:6379> pfcount codehole\n(integer) 3\n127.0.0.1:6379> pfadd codehole user4\n(integer) 1\n127.0.0.1:6379> pfcount codehole\n(integer) 4\n127.0.0.1:6379> pfadd codehole user5\n(integer) 1\n127.0.0.1:6379> pfcount codehole\n(integer) 5\n127.0.0.1:6379> pfadd codehole user6\n(integer) 1\n127.0.0.1:6379> pfcount codehole\n(integer) 6\n127.0.0.1:6379> pfadd codehole user7 user8 user9 user10\n(integer) 1\n127.0.0.1:6379> pfcount codehole\n(integer) 10\n```\n\n\u7b80\u5355\u8bd5\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u8fd8\u86ee\u7cbe\u786e\u7684\uff0c\u4e00\u4e2a\u6ca1\u591a\u4e5f\u4e00\u4e2a\u6ca1\u5c11\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528\u811a\u672c\uff0c\u5f80\u91cc\u9762\u704c\u66f4\u591a\u7684\u6570\u636e\uff0c\u770b\u770b\u5b83\u662f\u5426\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u7cbe\u786e\u4e0b\u53bb\uff0c\u5982\u679c\u4e0d\u80fd\u7cbe\u786e\uff0c\u5dee\u8ddd\u6709\u591a\u5927\u3002\u4eba\u751f\u82e6\u77ed\uff0c\u6211\u7528 Python\uff01Python \u811a\u672c\u8d70\u8d77\u6765\uff01\n\n```py\n# coding: utf-8\n\nimport redis\n\nclient = redis.StrictRedis()\nfor i in range(1000):\n    client.pfadd(\"codehole\", \"user%d\" % i)\n    total = client.pfcount(\"codehole\")\n    if total != i+1:\n        print total, i+1\n        break\n```\n\n\u5f53\u7136 Java \u4e5f\u4e0d\u9519\uff0c\u5927\u540c\u5c0f\u5f02\uff0c\u4e0b\u9762\u662f Java \u7248\u672c\uff1a\n\n```java\npublic class PfTest {\n  public static void main(String[] args) {\n    Jedis jedis = new Jedis();\n    for (int i = 0; i < 1000; i++) {\n      jedis.pfadd(\"codehole\", \"user\" + i);\n      long total = jedis.pfcount(\"codehole\");\n      if (total != i + 1) {\n        System.out.printf(\"%d %d\\n\", total, i + 1);\n        break;\n      }\n    }\n    jedis.close();\n  }\n}\n```\n\n\u6211\u4eec\u6765\u770b\u4e0b\u8f93\u51fa\uff1a\n\n```\n> python pftest.py\n99 100\n```\n\n\u5f53\u6211\u4eec\u52a0\u5165\u7b2c 100 \u4e2a\u5143\u7d20\u65f6\uff0c\u7ed3\u679c\u5f00\u59cb\u51fa\u73b0\u4e86\u4e0d\u4e00\u81f4\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u6570\u636e\u589e\u52a0\u5230 10w \u4e2a\uff0c\u770b\u770b\u603b\u91cf\u5dee\u8ddd\u6709\u591a\u5927\u3002\n\n```\n# coding: utf-8\n\nimport redis\n\nclient = redis.StrictRedis()\nfor i in range(100000):\n    client.pfadd(\"codehole\", \"user%d\" % i)\nprint 100000, client.pfcount(\"codehole\")\n```\n\nJava \u7248\uff1a\n\n```java\npublic class JedisTest {\n  public static void main(String[] args) {\n    Jedis jedis = new Jedis();\n    for (int i = 0; i < 100000; i++) {\n      jedis.pfadd(\"codehole\", \"user\" + i);\n    }\n    long total = jedis.pfcount(\"codehole\");\n    System.out.printf(\"%d %d\\n\", 100000, total);\n    jedis.close();\n  }\n}\n```\n\n\u8dd1\u4e86\u7ea6\u534a\u5206\u949f\uff0c\u6211\u4eec\u770b\u8f93\u51fa\uff1a\n\n```\n> python pftest.py\n100000 99723\n```\n\n\u5dee\u4e86 277 \u4e2a\uff0c\u6309\u767e\u5206\u6bd4\u662f 0.277%\uff0c\u5bf9\u4e8e\u4e0a\u9762\u7684 UV \u7edf\u8ba1\u9700\u6c42\u6765\u8bf4\uff0c\u8bef\u5dee\u7387\u4e5f\u4e0d\u7b97\u9ad8\u3002\u7136\u540e\u6211\u4eec\u628a\u4e0a\u9762\u7684\u811a\u672c\u518d\u8dd1\u4e00\u8fb9\uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e\u5c06\u6570\u636e\u91cd\u590d\u52a0\u5165\u4e00\u8fb9\uff0c\u67e5\u770b\u8f93\u51fa\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0cpfcount \u7684\u7ed3\u679c\u6ca1\u6709\u4efb\u4f55\u6539\u53d8\uff0c\u8fd8\u662f 99723\uff0c\u8bf4\u660e\u5b83\u786e\u5b9e\u5177\u5907\u53bb\u91cd\u529f\u80fd\u3002\n\n## pfadd \u8fd9\u4e2a pf \u662f\u4ec0\u4e48\u610f\u601d\uff1f\n\n\u5b83\u662f HyperLogLog \u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u7684\u53d1\u660e\u4eba Philippe Flajolet \u7684\u9996\u5b57\u6bcd\u7f29\u5199\uff0c\u8001\u5e08\u89c9\u5f97\u4ed6\u53d1\u578b\u5f88\u9177\uff0c\u770b\u8d77\u6765\u662f\u4e2a\u4f5b\u7cfb\u6559\u6388\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/12/1648f09fa1a77152?w=300&h=242&f=jpeg&s=24061)\n\n## pfmerge \u9002\u5408\u4ec0\u4e48\u573a\u5408\u7528\uff1f\n\nHyperLogLog \u9664\u4e86\u4e0a\u9762\u7684 pfadd \u548c pfcount \u4e4b\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u7b2c\u4e09\u4e2a\u6307\u4ee4 pfmerge\uff0c\u7528\u4e8e\u5c06\u591a\u4e2a pf \u8ba1\u6570\u503c\u7d2f\u52a0\u5728\u4e00\u8d77\u5f62\u6210\u4e00\u4e2a\u65b0\u7684 pf \u503c\u3002\n\n\u6bd4\u5982\u5728\u7f51\u7ad9\u4e2d\u6211\u4eec\u6709\u4e24\u4e2a\u5185\u5bb9\u5dee\u4e0d\u591a\u7684\u9875\u9762\uff0c\u8fd0\u8425\u8bf4\u9700\u8981\u8fd9\u4e24\u4e2a\u9875\u9762\u7684\u6570\u636e\u8fdb\u884c\u5408\u5e76\u3002\u5176\u4e2d\u9875\u9762\u7684 UV \u8bbf\u95ee\u91cf\u4e5f\u9700\u8981\u5408\u5e76\uff0c\u90a3\u8fd9\u4e2a\u65f6\u5019 pfmerge \u5c31\u53ef\u4ee5\u6d3e\u4e0a\u7528\u573a\u4e86\u3002\n\n## \u6ce8\u610f\u4e8b\u9879\n\nHyperLogLog \u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u4e0d\u662f\u514d\u8d39\u7684\uff0c\u4e0d\u662f\u8bf4\u4f7f\u7528\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u8981\u82b1\u94b1\uff0c\u5b83\u9700\u8981\u5360\u636e\u4e00\u5b9a 12k \u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u5b83\u4e0d\u9002\u5408\u7edf\u8ba1\u5355\u4e2a\u7528\u6237\u76f8\u5173\u7684\u6570\u636e\u3002\u5982\u679c\u4f60\u7684\u7528\u6237\u4e0a\u4ebf\uff0c\u53ef\u4ee5\u7b97\u7b97\uff0c\u8fd9\u4e2a\u7a7a\u95f4\u6210\u672c\u662f\u975e\u5e38\u60ca\u4eba\u7684\u3002\u4f46\u662f\u76f8\u6bd4 set \u5b58\u50a8\u65b9\u6848\uff0cHyperLogLog \u6240\u4f7f\u7528\u7684\u7a7a\u95f4\u90a3\u771f\u662f\u53ef\u4ee5\u4f7f\u7528\u5343\u65a4\u5bf9\u6bd4\u56db\u4e24\u6765\u5f62\u5bb9\u4e86\u3002\n\n\u4e0d\u8fc7\u4f60\u4e5f\u4e0d\u5fc5\u8fc7\u4e8e\u62c5\u5fc3\uff0c\u56e0\u4e3a Redis \u5bf9 HyperLogLog \u7684\u5b58\u50a8\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u5728\u8ba1\u6570\u6bd4\u8f83\u5c0f\u65f6\uff0c\u5b83\u7684\u5b58\u50a8\u7a7a\u95f4\u91c7\u7528\u7a00\u758f\u77e9\u9635\u5b58\u50a8\uff0c\u7a7a\u95f4\u5360\u7528\u5f88\u5c0f\uff0c\u4ec5\u4ec5\u5728\u8ba1\u6570\u6162\u6162\u53d8\u5927\uff0c\u7a00\u758f\u77e9\u9635\u5360\u7528\u7a7a\u95f4\u6e10\u6e10\u8d85\u8fc7\u4e86\u9608\u503c\u65f6\u624d\u4f1a\u4e00\u6b21\u6027\u8f6c\u53d8\u6210\u7a20\u5bc6\u77e9\u9635\uff0c\u624d\u4f1a\u5360\u7528 12k \u7684\u7a7a\u95f4\u3002\n\n## HyperLogLog \u5b9e\u73b0\u539f\u7406\n\nHyperLogLog \u7684\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u4f46\u662f\u5b9e\u73b0\u539f\u7406\u6bd4\u8f83\u590d\u6742\uff0c\u5982\u679c\u8bfb\u8005\u6ca1\u6709\u7279\u522b\u7684\u5174\u8da3\uff0c\u4e0b\u9762\u7684\u5185\u5bb9\u6682\u65f6\u53ef\u4ee5\u8df3\u8fc7\u4e0d\u770b\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3 HyperLogLog \u7684\u5185\u90e8\u5b9e\u73b0\u539f\u7406\uff0c\u6211\u753b\u4e86\u4e0b\u9762\u8fd9\u5f20\u56fe\n\n![](https://user-gold-cdn.xitu.io/2018/7/12/1648f0af2621881b?w=1102&h=692&f=png&s=53467)\n\n\u8fd9\u5f20\u56fe\u7684\u610f\u601d\u662f\uff0c\u7ed9\u5b9a\u4e00\u7cfb\u5217\u7684\u968f\u673a\u6574\u6570\uff0c\u6211\u4eec\u8bb0\u5f55\u4e0b\u4f4e\u4f4d\u8fde\u7eed\u96f6\u4f4d\u7684\u6700\u5927\u957f\u5ea6 k\uff0c\u901a\u8fc7\u8fd9\u4e2a k \u503c\u53ef\u4ee5\u4f30\u7b97\u51fa\u968f\u673a\u6570\u7684\u6570\u91cf\u3002\n\u9996\u5148\u4e0d\u95ee\u4e3a\u4ec0\u4e48\uff0c\u6211\u4eec\u7f16\u5199\u4ee3\u7801\u505a\u4e00\u4e2a\u5b9e\u9a8c\uff0c\u89c2\u5bdf\u4e00\u4e0b\u968f\u673a\u6574\u6570\u7684\u6570\u91cf\u548c k \u503c\u7684\u5173\u7cfb\u3002\n\n```py\nimport math\nimport random\n\n# \u7b97\u4f4e\u4f4d\u96f6\u7684\u4e2a\u6570\ndef low_zeros(value):\n    for i in xrange(1, 32):\n        if value >> i << i != value:\n            break\n    return i - 1\n\n\n# \u901a\u8fc7\u968f\u673a\u6570\u8bb0\u5f55\u6700\u5927\u7684\u4f4e\u4f4d\u96f6\u7684\u4e2a\u6570\nclass BitKeeper(object):\n\n    def __init__(self):\n        self.maxbits = 0\n\n    def random(self):\n        value = random.randint(0, 2**32-1)\n        bits = low_zeros(value)\n        if bits > self.maxbits:\n            self.maxbits = bits\n\n\nclass Experiment(object):\n\n    def __init__(self, n):\n        self.n = n\n        self.keeper = BitKeeper()\n\n    def do(self):\n        for i in range(self.n):\n            self.keeper.random()\n\n    def debug(self):\n        print self.n, '%.2f' % math.log(self.n, 2), self.keeper.maxbits\n\n\nfor i in range(1000, 100000, 100):\n    exp = Experiment(i)\n    exp.do()\n    exp.debug()\n```\n\nJava \u7248\uff1a\n\n```java\npublic class PfTest {\n\n  static class BitKeeper {\n    private int maxbits;\n\n    public void random() {\n      long value = ThreadLocalRandom.current().nextLong(2L << 32);\n      int bits = lowZeros(value);\n      if (bits > this.maxbits) {\n        this.maxbits = bits;\n      }\n    }\n\n    private int lowZeros(long value) {\n      int i = 1;\n      for (; i < 32; i++) {\n        if (value >> i << i != value) {\n          break;\n        }\n      }\n      return i - 1;\n    }\n  }\n\n  static class Experiment {\n    private int n;\n    private BitKeeper keeper;\n\n    public Experiment(int n) {\n      this.n = n;\n      this.keeper = new BitKeeper();\n    }\n\n    public void work() {\n      for (int i = 0; i < n; i++) {\n        this.keeper.random();\n      }\n    }\n\n    public void debug() {\n      System.out.printf(\"%d %.2f %d\\n\", this.n, Math.log(this.n) / Math.log(2), this.keeper.maxbits);\n    }\n  }\n\n  public static void main(String[] args) {\n    for (int i = 1000; i < 100000; i += 100) {\n      Experiment exp = new Experiment(i);\n      exp.work();\n      exp.debug();\n    }\n  }\n\n}\n```\n\u8fd0\u884c\u89c2\u5bdf\u8f93\u51fa\uff1a\n```\n36400 15.15 13\n36500 15.16 16\n36600 15.16 13\n36700 15.16 14\n36800 15.17 15\n36900 15.17 18\n37000 15.18 16\n37100 15.18 15\n37200 15.18 13\n37300 15.19 14\n37400 15.19 16\n37500 15.19 14\n37600 15.20 15\n```\n\n\u901a\u8fc7\u8fd9\u5b9e\u9a8c\u53ef\u4ee5\u53d1\u73b0 K \u548c N \u7684\u5bf9\u6570\u4e4b\u95f4\u5b58\u5728\u663e\u8457\u7684\u7ebf\u6027\u76f8\u5173\u6027\uff1a\n\n```\nN=2^K  # \u7ea6\u7b49\u4e8e\n```\n\n\u5982\u679c N \u4ecb\u4e8e 2^K \u548c 2^(K+1) \u4e4b\u95f4\uff0c\u7528\u8fd9\u79cd\u65b9\u5f0f\u4f30\u8ba1\u7684\u503c\u90fd\u7b49\u4e8e 2^K\uff0c\u8fd9\u660e\u663e\u662f\u4e0d\u5408\u7406\u7684\u3002\u8fd9\u91cc\u53ef\u4ee5\u91c7\u7528\u591a\u4e2a BitKeeper\uff0c\u7136\u540e\u8fdb\u884c\u52a0\u6743\u4f30\u8ba1\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u6bd4\u8f83\u51c6\u786e\u7684\u503c\u3002\n\n```py\nimport math\nimport random\n\ndef low_zeros(value):\n    for i in xrange(1, 32):\n        if value >> i << i != value:\n            break\n    return i - 1\n\n\nclass BitKeeper(object):\n\n    def __init__(self):\n        self.maxbits = 0\n\n    def random(self, m):\n        bits = low_zeros(m)\n        if bits > self.maxbits:\n            self.maxbits = bits\n\n\nclass Experiment(object):\n\n    def __init__(self, n, k=1024):\n        self.n = n\n        self.k = k\n        self.keepers = [BitKeeper() for i in range(k)]\n\n    def do(self):\n        for i in range(self.n):\n            m = random.randint(0, 1<<32-1)\n            # \u786e\u4fdd\u540c\u4e00\u4e2a\u6574\u6570\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a\u6876\u91cc\u9762\uff0c\u6458\u53d6\u9ad8\u4f4d\u540e\u53d6\u6a21\n            keeper = self.keepers[((m & 0xfff0000) >> 16) % len(self.keepers)]\n            keeper.random(m)\n\n    def estimate(self):\n        sumbits_inverse = 0  # \u96f6\u4f4d\u6570\u5012\u6570\n        for keeper in self.keepers:\n            sumbits_inverse += 1.0/float(keeper.maxbits)\n        avgbits = float(self.k)/sumbits_inverse  # \u5e73\u5747\u96f6\u4f4d\u6570\n        return 2**avgbits * self.k  # \u6839\u636e\u6876\u7684\u6570\u91cf\u5bf9\u4f30\u8ba1\u503c\u8fdb\u884c\u653e\u5927\n\n\nfor i in range(100000, 1000000, 100000):\n    exp = Experiment(i)\n    exp.do()\n    est = exp.estimate()\n    print i, '%.2f' % est, '%.2f' % (abs(est-i) / i)\n```\n\u4e0b\u9762\u662f Java \u7248\uff1a\n```java\npublic class PfTest {\n\n  static class BitKeeper {\n    private int maxbits;\n\n    public void random(long value) {\n      int bits = lowZeros(value);\n      if (bits > this.maxbits) {\n        this.maxbits = bits;\n      }\n    }\n\n    private int lowZeros(long value) {\n      int i = 1;\n      for (; i < 32; i++) {\n        if (value >> i << i != value) {\n          break;\n        }\n      }\n      return i - 1;\n    }\n  }\n\n  static class Experiment {\n    private int n;\n    private int k;\n    private BitKeeper[] keepers;\n\n    public Experiment(int n) {\n      this(n, 1024);\n    }\n\n    public Experiment(int n, int k) {\n      this.n = n;\n      this.k = k;\n      this.keepers = new BitKeeper[k];\n      for (int i = 0; i < k; i++) {\n        this.keepers[i] = new BitKeeper();\n      }\n    }\n\n    public void work() {\n      for (int i = 0; i < this.n; i++) {\n        long m = ThreadLocalRandom.current().nextLong(1L << 32);\n        BitKeeper keeper = keepers[(int) (((m & 0xfff0000) >> 16) % keepers.length)];\n        keeper.random(m);\n      }\n    }\n\n    public double estimate() {\n      double sumbitsInverse = 0.0;\n      for (BitKeeper keeper : keepers) {\n        sumbitsInverse += 1.0 / (float) keeper.maxbits;\n      }\n      double avgBits = (float) keepers.length / sumbitsInverse;\n      return Math.pow(2, avgBits) * this.k;\n    }\n  }\n\n  public static void main(String[] args) {\n    for (int i = 100000; i < 1000000; i += 100000) {\n      Experiment exp = new Experiment(i);\n      exp.work();\n      double est = exp.estimate();\n      System.out.printf(\"%d %.2f %.2f\\n\", i, est, Math.abs(est - i) / i);\n    }\n  }\n\n}\n```\n\u4ee3\u7801\u4e2d\u5206\u4e86 1024 \u4e2a\u6876\uff0c\u8ba1\u7b97\u5e73\u5747\u6570\u4f7f\u7528\u4e86\u8c03\u548c\u5e73\u5747 (\u5012\u6570\u7684\u5e73\u5747)\u3002\u666e\u901a\u7684\u5e73\u5747\u6cd5\u53ef\u80fd\u56e0\u4e3a\u4e2a\u522b\u79bb\u7fa4\u503c\u5bf9\u5e73\u5747\u7ed3\u679c\u4ea7\u751f\u8f83\u5927\u7684\u5f71\u54cd\uff0c\u8c03\u548c\u5e73\u5747\u53ef\u4ee5\u6709\u6548\u5e73\u6ed1\u79bb\u7fa4\u503c\u7684\u5f71\u54cd\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/12/1648f0fa8841ceb1?w=565&h=171&f=png&s=14049)\n\n\u89c2\u5bdf\u811a\u672c\u7684\u8f93\u51fa\uff0c\u8bef\u5dee\u7387\u63a7\u5236\u5728\u767e\u5206\u6bd4\u4e2a\u4f4d\u6570\uff1a\n```\n100000 97287.38 0.03\n200000 189369.02 0.05\n300000 287770.04 0.04\n400000 401233.52 0.00\n500000 491704.97 0.02\n600000 604233.92 0.01\n700000 721127.67 0.03\n800000 832308.12 0.04\n900000 870954.86 0.03\n1000000 1075497.64 0.08\n```\n\u771f\u5b9e\u7684 HyperLogLog \u8981\u6bd4\u4e0a\u9762\u7684\u793a\u4f8b\u4ee3\u7801\u66f4\u52a0\u590d\u6742\u4e00\u4e9b\uff0c\u4e5f\u66f4\u52a0\u7cbe\u786e\u4e00\u4e9b\u3002\u4e0a\u9762\u7684\u8fd9\u4e2a\u7b97\u6cd5\u5728\u968f\u673a\u6b21\u6570\u5f88\u5c11\u7684\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0\u9664\u96f6\u9519\u8bef\uff0c\u56e0\u4e3a maxbits=0 \u662f\u4e0d\u53ef\u4ee5\u6c42\u5012\u6570\u7684\u3002\n\n## pf \u7684\u5185\u5b58\u5360\u7528\u4e3a\u4ec0\u4e48\u662f 12k\uff1f\n\u6211\u4eec\u5728\u4e0a\u9762\u7684\u7b97\u6cd5\u4e2d\u4f7f\u7528\u4e86 1024 \u4e2a\u6876\u8fdb\u884c\u72ec\u7acb\u8ba1\u6570\uff0c\u4e0d\u8fc7\u5728 Redis \u7684 HyperLogLog \u5b9e\u73b0\u4e2d\u7528\u5230\u7684\u662f 16384 \u4e2a\u6876\uff0c\u4e5f\u5c31\u662f 2^14\uff0c\u6bcf\u4e2a\u6876\u7684 maxbits \u9700\u8981 6 \u4e2a bits \u6765\u5b58\u50a8\uff0c\u6700\u5927\u53ef\u4ee5\u8868\u793a maxbits=63\uff0c\u4e8e\u662f\u603b\u5171\u5360\u7528\u5185\u5b58\u5c31\u662f```2^14 * 6 / 8 = 12k```\u5b57\u8282\u3002\n\n## \u601d\u8003 & \u4f5c\u4e1a\n\u5c1d\u8bd5\u5c06\u4e00\u5806\u6570\u636e\u8fdb\u884c\u5206\u7ec4\uff0c\u5206\u522b\u8fdb\u884c\u8ba1\u6570\uff0c\u518d\u4f7f\u7528 pfmerge \u5408\u5e76\u5230\u4e00\u8d77\uff0c\u89c2\u5bdf pfcount \u8ba1\u6570\u503c\uff0c\u4e0e\u4e0d\u5206\u7ec4\u7684\u60c5\u51b5\u4e0b\u7684\u7edf\u8ba1\u7ed3\u679c\u8fdb\u884c\u6bd4\u8f83\uff0c\u89c2\u5bdf\u6709\u6ca1\u6709\u5dee\u5f02\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n- HyperLogLog \u590d\u6742\u7684\u516c\u5f0f\u63a8\u5bfc\u8bf7\u9605\u8bfb [Count-Distinct Problem](https://www.slideshare.net/KaiZhang130/countdistinct-problem-88329470)\uff0c\u5982\u679c\u4f60\u7684\u6982\u7387\u8bba\u57fa\u7840\u4e0d\u597d\uff0c\u90a3\u5c31\u5efa\u8bae\u4e0d\u8981\u770b\u4e86\uff08\u53e6\uff0c\u8fd9\u4e2a PPT \u9700\u8981\u7ffb\u5899\u89c2\u770b\uff09\u3002", "md_File": "subject/Redis \u6df1\u5ea6\u5386\u9669/5\u5e94\u7528_4\u56db\u4e24\u62e8\u5343\u65a4__HyperLogLog.md", "create_date": "2020-02-18T04:11:53.950", "order": 6}}, {"model": "subject.chapter", "pk": 56, "fields": {"title": "\u5b89\u88c5\u8fd0\u884c\uff1a\u5728 Windows \u548c Mac \u4e2d\u4f7f\u7528 Docker", "topic": 3, "md5": "8baeba97d08e7793e510a8c02b605ba2", "md_body": "# \u5728 Windows \u548c Mac \u4e2d\u4f7f\u7528 Docker\n\n\u5bf9\u4e8e\u5f00\u53d1\u6765\u8bf4\uff0cWindows \u548c macOS \u662f\u66f4\u4e3a\u5e38\u89c1\u548c\u5e38\u7528\u7684\u7cfb\u7edf\uff0c\u6240\u4ee5\u4e5f\u5f88\u6709\u5fc5\u8981\u4e86\u89e3\u5728 Windows \u548c macOS \u4e2d\u4f7f\u7528 Docker \u7684\u65b9\u6cd5\u3002\u5f88\u5e78\u8fd0\u7684\u662f\uff0cDocker \u7684\u5b98\u65b9\u5bf9\u8fd9\u4e24\u4e2a\u7cfb\u7edf\u63d0\u4f9b\u4e86\u5f3a\u6709\u529b\u7684\u652f\u6301\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u5728\u8fd9\u4e24\u4e2a\u7cfb\u7edf\u4e2d\u8fd0\u884c Docker\u3002\u5728\u8fd9\u4e00\u5c0f\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u4e86\u89e3\u4e00\u4e0b Docker \u5728 Windows \u548c macOS \u4e2d\u5b89\u88c5\u7684\u65b9\u5f0f\u4ee5\u53ca\u8fd0\u884c\u7684\u539f\u7406\u3002\n\n## Docker Desktop\n\n\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7684\u5f00\u53d1\u5de5\u4f5c\u662f\u5728 Windows \u6216 macOS \u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u8fdb\u884c\u7684\uff0c\u65e2\u7136 Docker \u662f\u6211\u4eec\u7528\u6765\u89e3\u51b3\u5f00\u53d1\u3001\u6d4b\u8bd5\u5230\u8fd0\u7ef4\u6574\u6761\u4ea7\u54c1\u7ebf\u7684\u5de5\u5177\uff0c\u81ea\u7136\u652f\u6301\u8fd9\u4e24\u4e2a\u7cfb\u7edf\u662f\u4e0d\u53ef\u6216\u7f3a\u7684\u529f\u80fd\u3002\n\n\u5982\u540c\u5c01\u88c5 Docker \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u8f7b\u677e\u7684\u865a\u62df\u5316\u8fd0\u884c\u73af\u5883\u4e00\u6837\uff0cDocker \u5728 Windows \u548c macOS \u4e2d\u7684\u5b89\u88c5\u4e5f\u662f\u6781\u6613\u5b8c\u6210\u7684\u3002Docker \u5b98\u65b9\u4e3a Windows \u548c macOS \u7cfb\u7edf\u5355\u72ec\u5f00\u8f9f\u4e86\u4e00\u6761\u4ea7\u54c1\u7ebf\uff0c\u540d\u4e3a Docker Desktop\uff0c\u5176\u5b9a\u4f4d\u662f\u5feb\u901f\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u5728 Windows \u548c macOS \u4e2d\u8fd0\u884c Docker \u73af\u5883\u7684\u5de5\u5177\u3002\n\nDocker Desktop \u5b9e\u73b0\u5bb9\u5668\u5316\u4e0e Docker Engine \u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86\u6211\u4eec\u5728 Windows \u548c macOS \u4e2d\u5f00\u53d1\u6240\u4f7f\u7528\u7684\u73af\u5883\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u8f6c\u79fb\u5230\u5176\u4ed6\u7684 Docker \u5b9e\u4f8b\u4e2d\uff0c\u4e0d\u8bba\u8fd9\u4e2a Docker \u5b9e\u4f8b\u662f\u8fd0\u884c\u5728 Windows\u3001macOS \u4ea6\u6216\u662f Linux\u3002\n\nDocker Desktop \u4ea7\u54c1\u7ebf\u5305\u542b\u4e24\u4e2a\u8f6f\u4ef6\uff0c\u4e5f\u5c31\u662f\u9488\u5bf9 Windows \u7cfb\u7edf\u7684 Docker for Windows \u548c\u9488\u5bf9 macOS \u7684 Docker for Mac\u3002\n\n### \u5b89\u88c5 Docker Desktop\n\n\u5728\u5b89\u88c5 Docker for Windows \u548c Docker for Mac \u4e4b\u524d\uff0c\u6211\u4eec\u4f9d\u7136\u8981\u4e86\u89e3\u4e00\u4e0b\u4e24\u6b3e\u8f6f\u4ef6\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u53ca\u8f6f\u786c\u4ef6\u7684\u8981\u6c42\uff0c\u53ea\u6709\u8fbe\u5230\u4e86\u8fd9\u4e9b\u8981\u6c42\uff0c\u6211\u4eec\u624d\u80fd\u987a\u5229\u7684\u5b89\u88c5\u4e0a Docker for Windows \u548c Docker for Mac\u3002\n\n\u5bf9\u4e8e Windows \u7cfb\u7edf\u6765\u8bf4\uff0c\u5b89\u88c5 Docker for Windows \u9700\u8981\u7b26\u5408\u4ee5\u4e0b\u6761\u4ef6\uff1a\n\n*   \u5fc5\u987b\u4f7f\u7528 Windows 10 Pro ( \u4e13\u4e1a\u7248 )\n*   \u5fc5\u987b\u4f7f\u7528 64 bit \u7248\u672c\u7684 Windows\n\n\u5bf9\u4e8e macOS \u7cfb\u7edf\u6765\u8bf4\uff0c\u5b89\u88c5 Docker for Mac \u9700\u8981\u7b26\u5408\u4ee5\u4e0b\u6761\u4ef6\uff1a\n\n*   Mac \u786c\u4ef6\u5fc5\u987b\u4e3a 2010 \u5e74\u4ee5\u540e\u7684\u578b\u53f7\n*   \u5fc5\u987b\u4f7f\u7528 macOS El Capitan 10.11 \u53ca\u4ee5\u540e\u7684\u7248\u672c\n\n\u53e6\u5916\uff0c\u865a\u62df\u673a\u8f6f\u4ef6 VirtualBox \u4e0e Docker Desktop \u517c\u5bb9\u6027\u4e0d\u4f73\uff0c\u5efa\u8bae\u5728\u5b89\u88c5 Docker for Windows \u548c Docker for Mac \u4e4b\u524d\u5148\u5378\u8f7d VirtualBox\u3002\n\n\u5728\u786e\u8ba4\u7cfb\u7edf\u80fd\u591f\u652f\u6301 Docker Desktop \u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u4ece Docker \u5b98\u65b9\u7f51\u7ad9\u4e0b\u8f7d\u8fd9\u4e24\u4e2a\u8f6f\u4ef6\u7684\u5b89\u88c5\u7a0b\u5e8f\uff0c\u8fd9\u91cc\u76f4\u63a5\u9644\u4e0a Docker Store \u7684\u4e0b\u8f7d\u94fe\u63a5\uff0c\u4f9b\u5927\u5bb6\u76f4\u63a5\u4e0b\u8f7d\uff1a\n\n*   [Docker for Windows](https://store.docker.com/editions/community/docker-ce-desktop-windows) ( [https://store.docker.com/editions/community/docker-ce-desktop-windows](https://store.docker.com/editions/community/docker-ce-desktop-windows) )\n*   [Docker for Mac](https://store.docker.com/editions/community/docker-ce-desktop-mac) ( [https://store.docker.com/editions/community/docker-ce-desktop-mac](https://store.docker.com/editions/community/docker-ce-desktop-mac) )\n\n\u5b89\u88c5 Docker for Windows \u548c Docker for Mac \u7684\u65b9\u6cd5\u5341\u5206\u7b80\u5355\uff0c\u6309 Windows \u6216 macOS \u5e38\u89c1\u7684\u8f6f\u4ef6\u5b89\u88c5\u65b9\u5f0f\u5b89\u88c5\u5373\u53ef\u3002\n\n### \u542f\u52a8 Docker\n\n\u50cf Linux \u4e2d\u4e00\u6837\uff0c\u6211\u4eec\u8981\u5728 Windows \u548c macOS \u4e2d\u4f7f\u7528 Docker \u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u5c06 Docker \u670d\u52a1\u542f\u52a8\u8d77\u6765\u3002\u5728\u8fd9\u4e24\u4e2a\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u542f\u52a8\u7684\u5c31\u662f\u521a\u624d\u6211\u4eec\u5b89\u88c5\u7684 Docker for Windows \u548c Docker for Mac \u4e86\u3002\n\n\u542f\u52a8\u4e24\u4e2a\u8f6f\u4ef6\u7684\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u5feb\u6377\u8bbf\u95ee\u529f\u80fd\u67e5\u627e\u5230 Docker for Windows \u6216 Docker for Mac \u5e76\u542f\u52a8\u5373\u53ef\u3002\n\n\u6253\u5f00\u8f6f\u4ef6\u4e4b\u540e\uff0c\u6211\u4eec\u4f1a\u5728 Windows \u7684\u4efb\u52a1\u680f\u6216\u8005 macOS \u7684\u72b6\u6001\u680f\u4e2d\u770b\u5230 Docker \u7684\u5927\u9cb8\u9c7c\u56fe\u6807\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/10/165c1d1fb7030b63?w=1186&h=431&f=png&s=92607)\n\nDocker for Windows \u6216 Docker for Mac \u5728\u542f\u52a8\u65f6\uff0c\u8fd9\u53ea\u5927\u9cb8\u9c7c\u4e0a\u7684\u96c6\u88c5\u7bb1\u4f1a\u4e00\u76f4\u95ea\u52a8\uff0c\u8fd9\u8bf4\u660e Docker \u7a0b\u5e8f\u6b63\u5728\u90e8\u7f72 docker daemon \u6240\u9700\u8981\u7684\u4e00\u4e9b\u73af\u5883\u5e76\u6267\u884c docker daemon \u7684\u542f\u52a8\u3002\u5f53\u96c6\u88c5\u7bb1\u4e0d\u518d\u95ea\u52a8\uff0c\u5c31\u8bf4\u660e Docker \u670d\u52a1\u5df2\u7ecf\u51c6\u5907\u5c31\u7eea\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 Windows \u548c macOS \u4e2d\u4f7f\u7528 Docker \u4e86\u3002\n\nDocker Desktop \u4e3a\u6211\u4eec\u5728 Windows \u548c macOS \u4e2d\u4f7f\u7528 Docker \u63d0\u4f9b\u4e86\u4e0e Linux \u4e2d\u51e0\u4e4e\u4e00\u81f4\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6253\u5f00 Windows \u4e2d\u7684 PowerShell \u83b7\u5f97 macOS \u4e2d\u7684 Terminal\uff0c\u4ea6\u6216\u8005 Git Bash\u3001Cmder\u3001iTerm \u7b49\u63a7\u5236\u53f0\u7c7b\u8f6f\u4ef6\uff0c\u8f93\u5165 `docker` \u547d\u4ee4\u5373\u53ef\u3002\n\n\u4f7f\u7528 `docker version` \u80fd\u591f\u770b\u5230 Docker \u5ba2\u6237\u7aef\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u91cc\u53d1\u73b0\u7a0b\u5e8f\u8fd0\u884c\u7684\u5e73\u53f0\uff1a\n\n```\n\u03bb docker version\nClient:\n## ......\n OS/Arch:  windows/amd64\n## ......\n\n```\n\n## Docker Desktop \u7684\u5b9e\u73b0\u539f\u7406\n\n\u901a\u8fc7\u4e4b\u524d\u5c0f\u8282\u7684\u4ecb\u7ecd\uff0c\u6211\u4eec\u77e5\u9053 Docker \u7684\u6838\u5fc3\u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u5bb9\u5668\u5b9e\u73b0\uff0c\u662f\u57fa\u4e8e Linux \u5185\u6838\u4e2d Namespaces\u3001CGroups \u7b49\u529f\u80fd\u7684\u3002\u90a3\u4e48\u5927\u4f53\u4e0a\u53ef\u4ee5\u8bf4\uff0cDocker \u662f\u4f9d\u8d56\u4e8e Linux \u800c\u5b58\u5728\u7684\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0cDocker Desktop \u662f\u5982\u4f55\u5b9e\u73b0\u8ba9\u6211\u4eec\u5728 Windows \u548c macOS \u4e2d\u5982\u6b64\u987a\u7545\u7684\u4f7f\u7528 Docker \u7684\u5462\uff1f\n\n\u5176\u5b9e Docker Desktop \u7684\u5b9e\u73b0\u903b\u8f91\u5f88\u7b80\u5355\uff1a\u65e2\u7136 Windows \u548c macOS \u4e2d\u6ca1\u6709 Docker \u80fd\u591f\u5229\u7528\u7684 Linux \u73af\u5883\uff0c\u90a3\u4e48\u6211\u4eec\u751f\u9020\u4e00\u4e2a Linux \u73af\u5883\u5c31\u884c\u5566\uff01Docker for Windows \u548c Docker for Mac \u6b63\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684\u3002\n\n\u7531\u4e8e\u865a\u62df\u5316\u5728\u4e91\u8ba1\u7b97\u65f6\u4ee3\u7684\u5e7f\u6cdb\u4f7f\u7528\uff0cWindows \u548c MacOS \u4e5f\u5c06\u865a\u62df\u5316\u5f15\u5165\u5230\u4e86\u7cfb\u7edf\u672c\u8eab\u7684\u5b9e\u73b0\u4e2d\uff0c\u8fd9\u5176\u4e2d\u5c31\u5305\u542b\u4e86\u4e4b\u524d\u6211\u4eec\u6240\u63d0\u5230\u7684\u901a\u8fc7 Hypervisor \u5b9e\u73b0\u865a\u62df\u5316\u7684\u529f\u80fd\u3002\u5728 Windows \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Hyper-V \u5b9e\u73b0\u865a\u62df\u5316\uff0c\u800c\u5728 macOS \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 HyperKit \u5b9e\u73b0\u865a\u62df\u5316\u3002\n\nDocker for Windows \u548c Docker for Mac \u8fd9\u91cc\u5229\u7528\u4e86\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u529f\u80fd\u6765\u642d\u5efa\u4e00\u4e2a\u865a\u62df Linux \u7cfb\u7edf\uff0c\u5e76\u5728\u5176\u4e4b\u4e0a\u5b89\u88c5\u548c\u8fd0\u884c docker daemon\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/12/165cb3b94b24b951?w=1374&h=517&f=png&s=51096)\n\n\u9664\u4e86\u642d\u5efa Linux \u7cfb\u7edf\u5e76\u8fd0\u884c docker daemon \u4e4b\u5916\uff0cDocker Desktop \u7cfb\u5217\u6700\u7a81\u51fa\u7684\u4e00\u9879\u529f\u80fd\u5c31\u662f\u6211\u4eec\u80fd\u591f\u76f4\u63a5\u901a\u8fc7 PowerShell\u3001Terminal \u8fd9\u7c7b\u7684\u63a7\u5236\u53f0\u8f6f\u4ef6\u5728 Windows \u548c macOS \u4e2d\u76f4\u63a5\u64cd\u4f5c\u865a\u62df Linux \u7cfb\u7edf\u4e2d\u8fd0\u884c\u7684 docker daemon\u3002\n\n\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u5f97\u76ca\u4e8e docker daemon \u5bf9\u5916\u63d0\u4f9b\u7684\u64cd\u4f5c\u8fc7\u7a0b\u5e76\u4e0d\u662f\u590d\u6742\u4e14\u9886\u57df\u6027\u5f3a\u7684 IPC \u7b49\u65b9\u5f0f\uff0c\u800c\u662f\u901a\u7528\u7684 RESTful Api \u7684\u5f62\u5f0f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cDocker Desktop \u53ea\u8981\u5b9e\u73b0 Windows \u548c macOS \u4e2d\u7684\u5ba2\u6237\u7aef\uff0c\u5c31\u80fd\u591f\u76f4\u63a5\u5229\u7528 Hypervisor \u7684\u7f51\u7edc\u652f\u6301\u4e0e\u865a\u62df Linux \u7cfb\u7edf\u4e2d\u7684 docker daemon \u8fdb\u884c\u901a\u8baf\uff0c\u5e76\u5bf9\u5b83\u8fdb\u884c\u63a7\u5236\u3002\n\n\u8fd9\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u6240\u63d0\u5230 docker daemon \u4f7f\u7528 RESTful Api \u4f5c\u4e3a\u63a7\u5236\u65b9\u5f0f\u7684\u4f18\u52bf\u4f53\u73b0\u4e86\u3002\n\n### \u4e3b\u673a\u6587\u4ef6\u6302\u8f7d\n\n\u63a7\u5236\u80fd\u591f\u76f4\u63a5\u5728\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u8fdb\u884c\uff0c\u7ed9\u6211\u4eec\u4f7f\u7528 Docker Desktop \u7cfb\u5217\u8f6f\u4ef6\u63d0\u4f9b\u4e86\u6781\u5927\u7684\u65b9\u4fbf\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6587\u4ef6\u7684\u6302\u8f7d\u4e5f\u662f Docker Desktop \u6240\u63d0\u4f9b\u7684\u5927\u5e45\u7b80\u5316\u6211\u4eec\u5de5\u4f5c\u6548\u7387\u4e14\u7b80\u5316\u4f7f\u7528\u7684\u529f\u80fd\u4e4b\u4e00\u3002\n\n\u4e4b\u524d\u6211\u4eec\u8c08\u5230\u4e86\uff0cDocker \u5bb9\u5668\u4e2d\u80fd\u591f\u901a\u8fc7\u6570\u636e\u5377\u7684\u65b9\u5f0f\u6302\u8f7d\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u5728 Windows \u548c macOS \u73af\u5883\u4e0b\u7684 Docker Desktop \u4e2d\uff0c\u6307\u7684\u662f\u865a\u62df\u7684 Linux \u7cfb\u7edf\u3002\n\n\u5f53\u7136\uff0c\u5982\u679c\u53ea\u80fd\u4ece\u865a\u62df\u7684 Linux \u7cfb\u7edf\u4e2d\u8fdb\u884c\u6302\u8f7d\uff0c\u663e\u7136\u4e0d\u8db3\u4ee5\u8fbe\u5230\u6211\u4eec\u7684\u671f\u671b\uff0c\u56e0\u4e3a\u6700\u65b9\u4fbf\u7684\u65b9\u5f0f\u5fc5\u7136\u662f\u76f4\u63a5\u4ece Windows \u548c macOS \u91cc\u6302\u8f7d\u6587\u4ef6\u4e86\u3002\n\n\u8981\u5b9e\u73b0\u6211\u4eec\u6240\u671f\u671b\u7684\u6548\u679c\uff0c\u4e5f\u5c31\u662f Docker \u5bb9\u5668\u76f4\u63a5\u6302\u8f7d\u4e3b\u673a\u7cfb\u7edf\u7684\u76ee\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u5c06\u76ee\u5f55\u6302\u8f7d\u5230\u865a\u62df Linux \u7cfb\u7edf\u4e0a\uff0c\u518d\u5229\u7528 Docker \u6302\u8f7d\u5230\u5bb9\u5668\u4e4b\u4e2d\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u96c6\u6210\u5728\u4e86 Docker Desktop \u7cfb\u5217\u8f6f\u4ef6\u4e2d\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u4eba\u5de5\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\uff0c\u6574\u4e2a\u8fc7\u7a0b\u5df2\u7ecf\u5b9e\u73b0\u4e86\u81ea\u52a8\u5316\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/11/165c8400bf8f809e?w=1491&h=832&f=png&s=97059)\n\nDocker Desktop \u5bf9 Windows \u548c macOS \u5230\u865a\u62df Linux \u7cfb\u7edf\uff0c\u518d\u5230 Docker \u5bb9\u5668\u4e2d\u7684\u6302\u8f7d\u8fdb\u884c\u4e86\u5b9e\u73b0\uff0c\u6211\u4eec\u53ea\u9700\u8981\u76f4\u63a5\u9009\u62e9\u80fd\u591f\u88ab\u6302\u8f7d\u7684\u4e3b\u673a\u76ee\u5f55 ( \u8fd9\u4e2a\u8fc7\u7a0b\u66f4\u591a\u4e5f\u662f\u4e3a\u4e86\u5b89\u5168\u6240\u8003\u8651 )\uff0c\u5269\u4e0b\u7684\u8fc7\u7a0b\u5168\u90e8\u7531 Docker Desktop \u4ee3\u66ff\u6211\u4eec\u5b8c\u6210\u3002\u8fd9\u76f8\u6bd4\u4e8e\u666e\u901a\u865a\u62df\u673a\u8f6f\u4ef6\u8fdb\u884c\u6302\u8f7d\u7684\u8fc7\u7a0b\u6765\u8bf4\uff0c\u5b8c\u5168\u4e0d\u80fd\u7528\u767e\u500d\u6548\u7387\u6765\u6bd4\u8f83\u4e86\u3002\n\n## \u914d\u7f6e Docker Desktop\n\n\u5728\u6211\u4eec\u4f7f\u7528 Docker Desktop \u7cfb\u5217\u4e4b\u524d\uff0c\u6211\u4eec\u8fd8\u4f1a\u7b80\u5355\u4fee\u6539\u5176\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u4ee5\u4fbf\u66f4\u597d\u7684\u5408\u7406\u642d\u914d\u64cd\u4f5c\u7cfb\u7edf\u4e0e Docker Desktop \u7cfb\u5217\u8f6f\u4ef6\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Docker for Windows \u6216 Docker for Mac \u7684\u5927\u9cb8\u9c7c\u56fe\u6807\u6253\u5f00\u914d\u7f6e\u9875\u9762\uff1a\u5728\u5927\u9cb8\u9c7c\u5f39\u51fa\u7684\u83dc\u5355\u4e2d\u9009\u62e9 Settings ( Windows ) \u6216 Preferences ( macOS )\u3002\n\n\u6253\u5f00 Docker for Windows \u548c Docker for Mac \u7684\u914d\u7f6e\u9875\u9762\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u51e0\u4e2a\u914d\u7f6e\u9875\u9762\u3002\u8fd9\u91cc\u6211\u4e0d\u9010\u4e00\u628a\u6bcf\u4e2a\u9875\u9762\u8fdb\u884c\u622a\u56fe\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u5df1\u52a8\u624b\u67e5\u770b\u9875\u9762\u6bcf\u4e2a\u9875\u9762\u7684\u5185\u5bb9\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/11/165c62cd575bb4e8?w=1559&h=614&f=png&s=339615)\n\nDocker for Windows \u548c Docker for Mac \u7684\u914d\u7f6e\u9879\u76ee\u8f83 Docker Engine \u6765\u8bf4\u8981\u591a\u4e0a\u8bb8\u591a\uff0c\u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a Docker Desktop \u662f Docker Engine \u7684\u8d85\u96c6\uff0c\u6240\u4ee5\u5176\u4e0d\u4ec5\u5305\u542b\u4e86 Docker Engine \u7684\u914d\u7f6e\u5185\u5bb9\uff0c\u8fd8\u8981\u5305\u542b\u8bf8\u5982\u865a\u62df\u673a\u5b9e\u73b0\u7b49\u5176\u4ed6\u914d\u7f6e\u3002\n\n\u6211\u8fd9\u91cc\u62bd\u51fa\u51e0\u4e2a\u4e0e Docker \u76f8\u5173\u7684\u5173\u952e\u914d\u7f6e\uff0c\u5206\u522b\u7b80\u5355\u8bf4\u660e\u5b83\u4eec\u7684\u4f5c\u7528\uff1a\n\n#### \u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u914d\u7f6e\n\n\u5728 Docker for Windows \u7684 Shared Drivers \u9762\u677f\uff0c\u4ee5\u53ca\u5728 Docker for Mac \u4e2d\u7684 File Sharing \u9762\u677f\u4e2d\uff0c\u5305\u542b\u4e86\u6211\u4eec\u4e4b\u524d\u63d0\u5230\u7684\u5c06\u672c\u673a\u76ee\u5f55\u6302\u8f7d\u5230 Hypervisor \u91cc Linux \u7cfb\u7edf\u4e2d\u7684\u914d\u7f6e\u3002\n\n#### \u8d44\u6e90\u63a7\u5236\u914d\u7f6e\n\n\u5728 Advanced \u9762\u677f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574 Docker \u6700\u5927\u5360\u7528\u7684\u672c\u673a\u8d44\u6e90\u3002\u5f53\u7136\uff0c\u66f4\u51c6\u786e\u7684\u8bf4\u6211\u4eec\u662f\u5728\u8c03\u6574\u865a\u62df Linux \u73af\u5883\u6240\u80fd\u5360\u7528\u7684\u8d44\u6e90\uff0c\u662f\u901a\u8fc7\u8fd9\u4e2a\u65b9\u5f0f\u5f71\u54cd Docker \u6240\u80fd\u5360\u7528\u7684\u6700\u5927\u8d44\u6e90\u3002\n\n#### \u7f51\u7edc\u914d\u7f6e\n\n\u5728 Docker for Windows \u7684 Network \u9762\u677f\uff0c\u4ee5\u53ca\u5728 Docker for Mac \u4e2d\u7684 Advanced \u9762\u677f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e Docker \u5185\u90e8\u9ed8\u8ba4\u7f51\u7edc\u7684\u5b50\u7f51\u7b49\u5185\u5bb9\u3002\u8fd9\u4e2a\u7f51\u7edc\u7684\u4f5c\u7528\u4ee5\u53ca\u66f4\u8be6\u7ec6\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u4f1a\u5728\u4e4b\u7b2c 9 \u8282\u4e2d\u8fdb\u884c\u8bb2\u89e3\u3002\n\n#### docker daemon \u914d\u7f6e\n\n\u5728 Daemon \u9762\u677f\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u914d\u7f6e\u5bf9 docker daemon \u7684\u8fd0\u884c\u914d\u7f6e\u8fdb\u884c\u8c03\u6574\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728 Daemon \u9762\u677f\u91cc\u53ea\u6709 Insecure registries \u548c Registry mirrors \u4e24\u4e2a\u914d\u7f6e\uff0c\u5206\u522b\u7528\u6765\u5b9a\u4e49\u672a\u8ba4\u8bc1\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u548c\u955c\u50cf\u6e90\u5730\u5740\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u70b9\u51fb\u5207\u6362\u6309\u94ae\u5207\u6362\u5230 Advanced \u6a21\u5f0f\uff0c\u5728\u8fd9\u4e2a\u6a21\u5f0f\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7f16\u8f91 docker daemon \u7684 daemon.json \u914d\u7f6e\u6587\u4ef6\uff0c\u5b9e\u73b0\u66f4\u5177\u4f53\u3001\u5b8c\u6574\u7684\u914d\u7f6e docker daemon \u7684\u76ee\u7684\u3002\n\n## \u4f4e\u7cfb\u7edf\u7248\u672c\u89e3\u51b3\u65b9\u6848\n\nDocker Desktop \u7cfb\u5217\u4e3a\u6211\u4eec\u5728 Windows \u548c macOS \u4e2d\u4f7f\u7528 Docker \u63d0\u4f9b\u4e86\u5de8\u5927\u7684\u4fbf\u5229\uff0c\u51e0\u4e4e\u8ba9\u6211\u4eec\u53ef\u4ee5\u5728\u6570\u5206\u949f\u5185\u642d\u5efa Windows \u548c macOS \u4e2d Docker \u7684\u8fd0\u884c\u73af\u5883\uff0c\u5e76\u5f97\u5230\u50cf Linux \u4e2d\u4f7f\u7528 Docker \u4e00\u6837\u7684\u4f53\u9a8c\u3002\u4f46 Docker Desktop \u4f9d\u7136\u5b58\u5728\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u5176\u4e2d\u6700\u5927\u7684\u83ab\u8fc7\u4e8e\u5176\u5bf9 Windows \u548c macOS \u7684\u82db\u523b\u8981\u6c42\u3002\u867d\u7136\u6211\u4eec\u63d0\u5021\u4fdd\u6301\u64cd\u4f5c\u7cfb\u7edf\u7684\u66f4\u65b0\u6362\u4ee3\uff0c\u4ee5\u5f97\u5230\u6700\u65b0\u7684\u529f\u80fd\u4ee5\u53ca\u66f4\u597d\u7684\u5b89\u5168\u4fdd\u969c\uff0c\u4f46\u4f9d\u7136\u6709\u5f88\u591a\u60c5\u51b5\u4e0b\u6211\u4eec\u4e0d\u5f97\u4e0d\u4f7f\u7528\u4f4e\u7248\u672c\u7684 Windows \u548c macOS\u3002\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0cDocker \u5b98\u65b9\u4e5f\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684\u89e3\u51b3\u65b9\u6848\u3002\n\n\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u6765\u804a\u804a\u4e3a\u4ec0\u4e48 Docker for Windows \u548c Docker for Mac \u4f1a\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u6709\u5982\u6b64\u4e25\u82db\u7684\u8981\u6c42\u3002\u5176\u5b9e\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u521a\u624d\u6211\u4eec\u8c08\u5230\u4e86\uff0cDocker for Windows \u548c Docker for Mac \u7684\u5b9e\u73b0\u5206\u522b\u4f9d\u9760\u4e86 Windows \u4e2d\u7684 Hyper-V \u548c macOS \u4e2d\u7684 HyperKit\uff0c\u800c\u8fd9\u4e24\u4e2a\u865a\u62df\u5316\u5de5\u5177\u53ea\u5728\u9ad8\u7248\u672c\u7684 Windows \u548c macOS \u7cfb\u7edf\u4e2d\u624d\u63d0\u4f9b\u51fa\u6765\u3002\n\n\u65e2\u7136\u77e5\u9053\u4e86\u539f\u56e0\uff0c\u89e3\u51b3\u65b9\u6848\u81ea\u7136\u4e5f\u5c31\u6709\u4e86\uff0c\u65e2\u7136\u6211\u4eec\u4e0d\u80fd\u5229\u7528 Hyper-V \u6216 HyperKit \u6765\u521b\u5efa\u865a\u62df\u7684 Linux \u7cfb\u7edf\uff0c\u90a3\u5c31\u627e\u4e00\u4e2a\u80fd\u591f\u66ff\u4ee3\u5b83\u4eec\u7684\u5de5\u5177\uff0c\u7528\u5176\u521b\u5efa\u865a\u62df Linux \u7cfb\u7edf\u5373\u53ef\u3002\n\n### Docker Toolbox\n\nDocker \u5b98\u65b9\u4e3a\u6211\u4eec\u627e\u5230\u4e86\u7528\u4e8e\u642d\u5efa\u865a\u62df Linux \u7cfb\u7edf\u7684\u8f6f\u4ef6\uff0c\u5373 Oracle \u7684 VirtualBox\uff0c\u5e76\u4ee5\u6b64\u5c01\u88c5\u4e86\u53e6\u4e00\u4e2a\u96c6\u6210\u7684 Docker \u8fd0\u884c\u73af\u5883\u8f6f\u4ef6\uff1aDocker Toolbox\u3002\n\n\u5b89\u88c5 Docker Toolbox \u7684\u8fc7\u7a0b\u4e5f\u5341\u5206\u7b80\u5355\uff0c\u4e0b\u8f7d\u5b89\u88c5\u5305\u5e76\u6309\u5e38\u89c4\u8f6f\u4ef6\u4e00\u6837\u5b89\u88c5\u5373\u53ef\u3002\u8fd9\u91cc\u76f4\u63a5\u6211\u76f4\u63a5\u63d0\u4f9b\u7ed9\u5927\u5bb6 Docker Toolbox \u5b89\u88c5\u5305\u7684\u8fde\u63a5\uff0c\u65b9\u4fbf\u5927\u5bb6\u4e0b\u8f7d\u3002\n\n*   [Docker Toolbox for Windows](https://download.docker.com/win/stable/DockerToolbox.exe) ( [https://download.docker.com/win/stable/DockerToolbox.exe](https://download.docker.com/win/stable/DockerToolbox.exe) )\n*   [Docker Toolbox for Mac](https://download.docker.com/mac/stable/DockerToolbox.pkg) ( [https://download.docker.com/mac/stable/DockerToolbox.pkg](https://download.docker.com/mac/stable/DockerToolbox.pkg) )\n\n\u5b89\u88c5\u5b8c Docker Toolbox \u540e\uff0c\u6211\u4eec\u6709\u51e0\u9879\u4e0e Docker for Windows \u548c Docker for Mac \u4e0d\u540c\u7684\u4f7f\u7528\u65b9\u6cd5\u9700\u8981\u6ce8\u610f\u3002\n\n\u7531\u4e8e\u4e0d\u80fd\u5f88\u597d\u7684\u4e0e\u7cfb\u7edf\u4ee5\u53ca VirtualBox \u4e92\u901a\u7ed3\u5408\uff0c\u6211\u4eec\u542f\u52a8\u3001\u5173\u95ed\u3001\u91cd\u542f Docker \u670d\u52a1\u4e0d\u80fd\u5b8c\u5168\u5b9e\u73b0\u81ea\u52a8\u5316\uff0c\u6240\u4ee5\u8fd9\u91cc Docker \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86 Docker QuickStart Terminal \u8fd9\u4e2a\u5de5\u5177\u6765\u5904\u7406\u8fd9\u4e9b\u8fc7\u7a0b\u3002\u6362\u4e2a\u65b9\u5f0f\u8bf4\uff0c\u6211\u4eec\u5fc5\u987b\u901a\u8fc7\u5b83\u6765\u542f\u52a8\u548c\u64cd\u4f5c Docker\uff0c\u800c\u4e0d\u80fd\u518d\u76f4\u63a5\u4f7f\u7528 PowerShell\u3001Terminal \u8fd9\u7c7b\u8f6f\u4ef6\u4e86\u3002\n\n\u53e6\u5916\u4e00\u4e2a\u4e0d\u4fbf\u4e4b\u5904\u5c31\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u6302\u8f7d\uff0c\u7531\u4e8e Docker Toolbox \u65e0\u6cd5\u76f4\u63a5\u64cd\u4f5c VirtualBox \u5b9e\u73b0\u6302\u8f7d\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981\u6211\u4eec\u4eba\u5de5\u6765\u8fdb\u884c\u3002\u6574\u4e2a\u6302\u8f7d\u7684\u65b9\u5f0f\u4e0e\u6211\u4eec\u4e4b\u524d\u8c08\u5230\u7684\u4e00\u6837\uff0c\u533a\u522b\u53ea\u662f\u9700\u8981\u6211\u4eec\u624b\u52a8\u64cd\u4f5c\u3002\u5c06\u672c\u673a\u76ee\u5f55\u6302\u8f7d\u5230\u865a\u62df Linux \u7cfb\u7edf\u4e2d\u7684\u914d\u7f6e\u5728 VirtualBox \u7684 Settings \u4e2d\uff0c\u6211\u4eec\u5c06\u672c\u673a\u9700\u8981\u6302\u8f7d\u7684\u76ee\u5f55\u914d\u7f6e\u8fdb\u53bb\u5e76\u4fdd\u5b58\u5373\u53ef\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u8fd9\u8282\u4e2d\uff0c\u5728\u8fd9\u4e00\u5c0f\u8282\u4e2d\u6211\u4eec\u638c\u63e1\u4e86\u5982\u4f55\u5728 Windows \u548c macOS \u5b89\u88c5 Docker Desktop \u5e76\u8fdb\u884c\u914d\u7f6e\uff0c\u4e86\u89e3\u4e86 Docker Desktop \u7684\u5b9e\u73b0\u539f\u7406\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> \u9664\u4e86\u5728 Windows \u6216 macOS \u4e2d\u642d\u5efa\u865a\u62df\u7684 Linux \u7cfb\u7edf\u6765\u5b9e\u73b0\u57fa\u4e8e Linux Container \u8fd0\u884c Docker \u8fd9\u79cd\u65b9\u5f0f\u5916\uff0c\u4f60\u662f\u5426\u8fd8\u77e5\u9053\u76f4\u63a5\u4f7f\u7528 Windows \u6216 macOS \u672c\u8eab\u7684\u5bb9\u5668\u6280\u672f\u8fd0\u884c Docker \u7684\u65b9\u6cd5\uff1f\u5c1d\u8bd5\u4e86\u89e3\u8fd9\u4e9b\u5b9e\u73b0\u65b9\u5f0f\uff0c\u8bf4\u8bf4\u5b83\u4eec\u80cc\u540e\u7684\u539f\u7406\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker Desktop \u7684\u5b89\u88c5\u3001\u914d\u7f6e\u8fd8\u6709\u5185\u90e8\u5b9e\u73b0\u8fd8\u6709\u4ec0\u4e48\u4e0d\u89e3\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u5b89\u88c5\u8fd0\u884c\u5728_Windows_\u548c_Mac_\u4e2d\u4f7f\u7528_Docker.md", "create_date": "2020-02-18T21:18:38.864", "order": 5}}, {"model": "subject.chapter", "pk": 57, "fields": {"title": "\u5b89\u88c5\u8fd0\u884c\uff1a\u642d\u5efa Docker \u8fd0\u884c\u73af\u5883", "topic": 3, "md5": "1a76d9bfb9874672bf4b07603b586721", "md_body": "# \u642d\u5efa Docker \u8fd0\u884c\u73af\u5883\n\n\u65e2\u7136 Docker \u662f\u4e00\u6b3e\u5b9e\u7528\u8f6f\u4ef6\uff0c\u6211\u4eec\u5c31\u4e0d\u5f97\u4e0d\u5148\u4ece\u5b83\u7684\u5b89\u88c5\u8bf4\u8d77\uff0c\u53ea\u6709\u8ba9 Docker \u8fd0\u884c\u5728\u6211\u4eec\u7684\u8ba1\u7b97\u673a\u4e0a\uff0c\u624d\u80fd\u66f4\u65b9\u4fbf\u6211\u4eec\u5bf9 Docker \u76f8\u5173\u77e5\u8bc6\u548c\u4f7f\u7528\u65b9\u5f0f\u7684\u5b66\u4e60\u3002\u5f97\u76ca\u4e8e\u4e0e\u5546\u4e1a\u6027\u7684\u4f18\u96c5\u7ed3\u5408\uff0cDocker \u80cc\u540e\u62e5\u6709\u5927\u91cf\u7684\u4f18\u79c0\u5f00\u53d1\u8005\u4e3a\u5176\u63d0\u4f9b\u6280\u672f\u652f\u6301\uff0c\u800c\u8fd9\u4e2a\u4f18\u52bf\u6240\u9020\u5c31\u7684\u7ed3\u679c\u4e4b\u4e00\uff0c\u5c31\u662f Docker \u62e5\u6709\u4e30\u5bcc\u4e14\u5b8c\u5584\u7684\u5b89\u88c5\u4f53\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u5b89\u88c5\u548c\u8fd0\u884c Docker\u3002\n\n## \u5b89\u88c5\u524d\u7684\u51c6\u5907\n\n\u7531\u4e8e Docker \u5bb9\u5668\u5b9e\u73b0\u672c\u8eab\u5c31\u91c7\u7528\u4e86 Linux \u5185\u6838\u4e2d\u5f88\u591a\u7684\u7279\u6027\uff0c\u6240\u4ee5\u5b83\u81ea\u7136\u4e0e Linux \u7cfb\u7edf\u4eb2\u5bc6\u6027\u5f88\u9ad8\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u5c06 Docker Engine \u5b89\u88c5\u5728 Linux \u7cfb\u7edf\u4e2d\u3002\n\n\u4e0d\u8fc7\uff0c\u5728\u5b89\u88c5\u4e4b\u524d\uff0c\u6211\u8fd8\u5f97\u4e0d\u538c\u5176\u70e6\u7684\u5570\u55e6\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5\uff0c\u8ba9\u5927\u5bb6\u5728\u5b89\u88c5 Docker \u65f6\u80fd\u591f\u66f4\u597d\u7684\u8fdb\u884c\u9009\u62e9\u3002\u638c\u63e1\u8fd9\u4e9b\u6982\u5ff5\uff0c\u80fd\u591f\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\u4e00\u4e9b\u5b89\u88c5\u6d41\u7a0b\u4e2d\u64cd\u4f5c\u7684\u76ee\u7684\uff0c\u4e0d\u81f3\u4e8e\u603b\u662f\u4e00\u5473\u7684\u8fdb\u884c\u201c\u4e0b\u4e00\u6b65\u201d\u5f0f\u5b89\u88c5\u3002\n\n### Docker Engine \u7684\u7248\u672c\n\n\u5728\u5b89\u88c5 Docker \u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e00\u4e0b Docker \u7684\u7248\u672c\u5b9a\u4e49\uff0c\u8fd9\u6709\u5229\u4e8e\u6211\u4eec\u5728\u4e4b\u540e\u7684\u5f00\u53d1\u4e2d\u9009\u62e9\u548c\u4f7f\u7528\u5408\u9002\u7684 Docker \u7248\u672c\u3002\n\n\u5bf9\u4e8e Docker Engine \u6765\u8bf4\uff0c\u5176\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u7cfb\u5217\uff1a\n\n*   \u793e\u533a\u7248 ( CE, Community Edition )\n*   \u4f01\u4e1a\u7248 ( EE, Enterprise Edition )\n\n\u793e\u533a\u7248 ( Docker Engine CE ) \u4e3b\u8981\u63d0\u4f9b\u4e86 Docker \u4e2d\u7684\u5bb9\u5668\u7ba1\u7406\u7b49\u57fa\u7840\u529f\u80fd\uff0c\u4e3b\u8981\u9488\u5bf9\u5f00\u53d1\u8005\u548c\u5c0f\u578b\u56e2\u961f\u8fdb\u884c\u5f00\u53d1\u548c\u8bd5\u9a8c\u3002\u800c\u4f01\u4e1a\u7248 ( Docker Engine EE ) \u5219\u5728\u793e\u533a\u7248\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u8bf8\u5982\u5bb9\u5668\u7ba1\u7406\u3001\u955c\u50cf\u7ba1\u7406\u3001\u63d2\u4ef6\u3001\u5b89\u5168\u7b49\u989d\u5916\u670d\u52a1\u4e0e\u529f\u80fd\uff0c\u4e3a\u5bb9\u5668\u7684\u7a33\u5b9a\u8fd0\u884c\u63d0\u4f9b\u4e86\u652f\u6301\uff0c\u9002\u5408\u4e8e\u4e2d\u5927\u578b\u9879\u76ee\u7684\u7ebf\u4e0a\u8fd0\u884c\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/29/16586347c98cc591?w=2022&h=276&f=png&s=40439)\n\n\u793e\u533a\u7248\u548c\u4f01\u4e1a\u7248\u7684\u53e6\u4e00\u533a\u522b\u5c31\u662f\u514d\u8d39\u4e0e\u6536\u8d39\u4e86\u3002\u5bf9\u4e8e\u6211\u4eec\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u793e\u533a\u7248\u5df2\u7ecf\u63d0\u4f9b\u4e86 Docker \u6240\u6709\u6838\u5fc3\u7684\u529f\u80fd\uff0c\u8db3\u591f\u6ee1\u8db3\u6211\u4eec\u5728\u5f00\u53d1\u3001\u6d4b\u8bd5\u4e2d\u7684\u9700\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u9009\u62e9\u4f7f\u7528\u793e\u533a\u7248\u8fdb\u884c\u5f00\u53d1\u5373\u53ef\u3002\u5728\u8fd9\u672c\u5c0f\u518c\u4e2d\uff0c\u6240\u6709\u7684\u5185\u5bb9\u4e5f\u662f\u56f4\u7ed5\u7740\u793e\u533a\u7248\u7684 Docker Engine \u5c55\u5f00\u7684\u3002\n\n\u4ece\u53e6\u5916\u4e00\u4e2a\u89d2\u5ea6\uff0cDocker Engine \u7684\u8fed\u4ee3\u7248\u672c\u53c8\u4f1a\u5206\u4e3a\u7a33\u5b9a\u7248 ( Stable release ) \u548c\u9884\u89c8\u7248 ( Edge release )\u3002\u4e0d\u8bba\u662f\u7a33\u5b9a\u7248\u8fd8\u662f\u9884\u89c8\u7248\uff0c\u5b83\u4eec\u90fd\u4f1a\u4ee5\u53d1\u5e03\u65f6\u7684\u5e74\u6708\u6765\u547d\u540d\u7248\u672c\u53f7\uff0c\u4f8b\u5982\u5982 17 \u5e74 3 \u6708\u7684\u7248\u672c\uff0c\u7248\u672c\u53f7\u5c31\u662f 17.03\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/29/165863f7df36e81f?w=914&h=200&f=png&s=43434)\n\nDocker Engine \u7684\u7a33\u5b9a\u7248\u56fa\u5b9a\u4e3a\u6bcf\u4e09\u4e2a\u6708\u66f4\u65b0\u4e00\u6b21\uff0c\u800c\u9884\u89c8\u7248\u5219\u6bcf\u6708\u90fd\u4f1a\u66f4\u65b0\u3002\u5728\u9884\u89c8\u7248\u4e2d\u53ef\u4ee5\u53ca\u65f6\u638c\u63e1\u5230\u6700\u65b0\u7684\u529f\u80fd\u7279\u6027\uff0c\u4e0d\u8fc7\u8fd9\u5bf9\u4e8e\u6211\u4eec\u4ec5\u662f\u4f7f\u7528 Docker \u7684\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u610f\u4e49\u5e76\u4e0d\u662f\u7279\u522b\u91cd\u5927\u7684\uff0c\u6240\u4ee5\u6211\u8fd8\u662f\u66f4\u63a8\u8350\u5b89\u88c5\u66f4\u6709\u4fdd\u969c\u7684\u7a33\u5b9a\u7248\u672c\u3002\n\n\u5728\u4e3b\u8981\u7248\u672c\u4e4b\u5916\uff0cDocker \u5b98\u65b9\u4e5f\u4ee5\u89e3\u51b3 Bug \u4e3a\u4e3b\u8981\u76ee\u7684\uff0c\u4e0d\u5b9a\u671f\u53d1\u5e03\u6b21\u8981\u7248\u672c\u3002\u6b21\u8981\u7248\u672c\u7684\u7248\u672c\u53f7\u7531\u4e3b\u8981\u7248\u672c\u548c\u53d1\u5e03\u5e8f\u53f7\u7ec4\u6210\uff0c\u5982\uff1a17.03.2 \u5c31\u662f\u5bf9 17.03 \u7248\u672c\u7684\u7b2c\u4e8c\u6b21\u4fee\u6b63\u3002\n\n### Docker \u7684\u73af\u5883\u4f9d\u8d56\n\n\u7531\u4e8e Docker \u7684\u5bb9\u5668\u9694\u79bb\u4f9d\u8d56\u4e8e Linux \u5185\u6838\u4e2d\u7684\u76f8\u5173\u652f\u6301\uff0c\u6240\u4ee5\u4f7f\u7528 Docker \u9996\u5148\u9700\u8981\u786e\u4fdd\u5b89\u88c5\u673a\u5668\u7684 Linux kernel \u4e2d\u5305\u542b Docker \u6240\u9700\u8981\u4f7f\u7528\u7684\u7279\u6027\u3002\u4ee5\u76ee\u524d Docker \u5b98\u65b9\u4e3b\u8981\u7ef4\u62a4\u7684\u7248\u672c\u4e3a\u4f8b\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u57fa\u4e8e Linux kernel 3.10 \u4ee5\u4e0a\u7248\u672c\u7684 Linux \u7cfb\u7edf\u6765\u5b89\u88c5 Docker\u3002\n\n\u4e5f\u8bb8 Linux kernel \u7684\u7248\u672c\u8fd8\u4e0d\u591f\u76f4\u89c2\uff0c\u4e0b\u9762\u7684\u8868\u683c\u5c31\u76f4\u63a5\u5c55\u793a\u4e86 Docker \u5bf9\u4e3b\u6d41\u51e0\u6b3e Linux \u7cfb\u7edf\u7248\u672c\u7684\u8981\u6c42\u3002\n\n\u64cd\u4f5c\u7cfb\u7edf\n\n\u652f\u6301\u7684\u7cfb\u7edf\u7248\u672c\n\nCentOS\n\nCentOS 7\n\nDebian\n\nDebian Wheezy 7.7 (LTS)  \nDebian Jessie 8 (LTS)  \nDebian Stretch 9  \nDebian Buster 10\n\nFedora\n\nFedora 26  \nFedora 27\n\nUbuntu\n\nUbuntu Trusty 14.04 (LTS)  \nUbuntu Xenial 16.04 (LTS)  \nUbuntu Artful 17.10\n\n\u5f53\u7136\uff0c\u5728\u8f83\u4f4e\u7248\u672c\u7684 Linux \u7cfb\u7edf\u4e2d\u4e5f\u80fd\u5b89\u88c5 Docker\uff0c\u4e0d\u8fc7\u53ea\u80fd\u662f\u7248\u672c\u8f83\u4f4e\u7684 Docker\uff0c\u5176\u529f\u80fd\u5b58\u5728\u4e00\u4e9b\u7f3a\u5931\uff0c\u6216\u8005\u4e0e\u6700\u65b0\u7248\u672c\u6709\u6240\u533a\u522b\u3002\u5728\u8fd9\u672c\u5c0f\u518c\u91cc\uff0c\u6211\u4eec\u4e3b\u8981\u4ee5\u8f83\u65b0\u7248\u672c\u7684 Docker \u529f\u80fd\u548c\u64cd\u4f5c\u4f5c\u4e3a\u4ecb\u7ecd\uff0c\u6240\u4ee5\u5982\u679c\u6761\u4ef6\u5141\u8bb8\uff0c\u5efa\u8bae\u5c06\u7cfb\u7edf\u5347\u7ea7\u5230\u652f\u6301\u6700\u65b0\u7248\u672c Docker \u7684\u7cfb\u7edf\u7248\u672c\u3002\n\n## \u5728 Linux \u7cfb\u7edf\u4e2d\u5b89\u88c5 Docker\n\n\u56e0\u4e3a Docker \u672c\u8eab\u5c31\u57fa\u4e8e Linux \u7684\u6838\u5fc3\u80fd\u529b\uff0c\u540c\u65f6\u76ee\u524d\u4e3b\u6d41\u7684 Linux \u7cfb\u7edf\u4e2d\u6240\u62e5\u6709\u7684\u8f6f\u4ef6\u5305\u7ba1\u7406\u7a0b\u5e8f\uff0c\u5df2\u7ecf\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u5e2e\u52a9\u6211\u4eec\u5904\u7406\u5404\u79cd\u4f9d\u8d56\u95ee\u9898\uff0c\u6240\u4ee5\u5728 Linux \u4e2d\u5b89\u88c5 Docker \u5e76\u975e\u4ec0\u4e48\u96be\u4e8b\u3002\n\n\u66f4\u591a\u7684\u7ec6\u8282\u5c31\u4e0d\u591a\u8bf4\u4e86\uff0cDocker \u5df2\u7ecf\u4e3a\u6211\u4eec\u51c6\u5907\u4e86\u597d\u4e86\u5404\u7cfb\u7edf\u7684\u5b89\u88c5\u5305\uff0c\u6bd5\u7adf\u5b89\u88c5 Docker \u5e76\u4e0d\u662f\u6211\u4eec\u6240\u8981\u638c\u63e1\u7684\u91cd\u70b9\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u5c31\u76f4\u63a5\u7ed9\u51fa\u5b89\u88c5\u7684\u547d\u4ee4\u4e86\u3002\n\n### CentOS\n\n```\n$ sudo yum install yum-utils device-mapper-persistent-data lvm2\n$\n$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n$ sudo yum install docker-ce\n$\n$ sudo systemctl enable docker\n$ sudo systemctl start docker\n\n```\n\n### Debian\n\n```\n$ sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common\n$\n$ curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -\n$ sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable\"\n$ sudo apt-get update\n$ sudo apt-get install docker-ce\n$\n$ sudo systemctl enable docker\n$ sudo systemctl start docker\n\n```\n\n### Fedora\n\n```\n$ sudo dnf -y install dnf-plugins-core\n$\n$ sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo\n$ sudo dnf install docker-ce\n$\n$ sudo systemctl enable docker\n$ sudo systemctl start docker\n\n```\n\n### Ubuntu\n\n```\n$ sudo apt-get install apt-transport-https ca-certificates curl software-properties-common\n$\n$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n$ sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\"\n$ sudo apt-get update\n$ sudo apt-get install docker-ce\n$\n$ sudo systemctl enable docker\n$ sudo systemctl start docker\n\n```\n\n## \u4e0a\u624b\u4f7f\u7528\n\n\u5728\u5b89\u88c5 Docker \u5b8c\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u9700\u8981\u5148\u542f\u52a8 docker daemon \u4f7f\u5176\u80fd\u591f\u4e3a\u6211\u4eec\u63d0\u4f9b Docker \u670d\u52a1\uff0c\u8fd9\u6837\u6211\u4eec\u624d\u80fd\u6b63\u5e38\u4f7f\u7528 Docker\u3002\n\n\u5728\u6211\u4eec\u901a\u8fc7\u8f6f\u4ef6\u5305\u7684\u5f62\u5f0f\u5b89\u88c5 Docker Engine \u65f6\uff0c\u5b89\u88c5\u5305\u5df2\u7ecf\u4e3a\u6211\u4eec\u5728 Linux \u7cfb\u7edf\u4e2d\u6ce8\u518c\u4e86\u4e00\u4e2a Docker \u670d\u52a1\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u76f4\u63a5\u542f\u52a8 docker daemon \u5bf9\u5e94\u7684 `dockerd` \u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u800c\u662f\u76f4\u63a5\u542f\u52a8 Docker \u670d\u52a1\u5373\u53ef\u3002\u542f\u52a8\u7684 Docker \u670d\u52a1\u7684\u547d\u4ee4\u5176\u5b9e\u6211\u5df2\u7ecf\u5305\u542b\u5728\u4e86\u524d\u9762\u8c08\u5230\u7684\u5b89\u88c5\u547d\u4ee4\u4e2d\uff0c\u4e5f\u5c31\u662f\uff1a\n\n```\n$ sudo systemctl start docker\n\n```\n\n\u5f53\u7136\uff0c\u4e3a\u4e86\u5b9e\u73b0 Docker \u670d\u52a1\u5f00\u673a\u81ea\u542f\u52a8\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4\uff1a\n\n```\n$ sudo systemctl enable docker\n\n```\n\n### docker version\n\n\u5728 Docker \u670d\u52a1\u542f\u52a8\u4e4b\u540e\uff0c\u6211\u4eec\u5148\u6765\u5c1d\u8bd5\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u67e5\u770b Docker \u7248\u672c\u7684\u547d\u4ee4\uff1a`docker version`\u3002\n\n```\n$ sudo docker version\nClient:\n Version:           18.06.1-ce\n API version:       1.38\n Go version:        go1.10.3\n Git commit:        e68fc7a\n Built:             Tue Aug 21 17:23:03 2018\n OS/Arch:           linux/amd64\n Experimental:      false\n\nServer:\n Engine:\n  Version:          18.06.1-ce\n  API version:      1.38 (minimum version 1.12)\n  Go version:       go1.10.3\n  Git commit:       e68fc7a\n  Built:            Tue Aug 21 17:25:29 2018\n  OS/Arch:          linux/amd64\n  Experimental:     false\n\n```\n\n\u8fd9\u4e2a\u547d\u4ee4\u80fd\u591f\u663e\u793a Docker C/S \u7ed3\u6784\u4e2d\u7684\u670d\u52a1\u7aef ( docker daemon ) \u548c\u5ba2\u6237\u7aef ( docker CLI ) \u76f8\u5173\u7684\u7248\u672c\u4fe1\u606f\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cdocker CLI \u8fde\u63a5\u7684\u662f\u672c\u673a\u8fd0\u884c\u7684 docker daemon \uff0c\u7531\u4e8e docker daemon \u548c docker CLI \u901a\u8fc7 RESTful \u63a5\u53e3\u8fdb\u884c\u4e86\u89e3\u8026\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u80fd\u4fee\u6539\u914d\u7f6e\u7528\u4e8e\u64cd\u4f5c\u5176\u4ed6\u673a\u5668\u4e0a\u8fd0\u884c\u7684 docker daemon \u3002\n\n### docker info\n\n\u5982\u679c\u60f3\u8981\u4e86\u89e3 Docker Engine \u66f4\u591a\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7 `docker info` \u8fd9\u4e2a\u547d\u4ee4\u3002\n\n```\n$ sudo docker info\nContainers: 0\n Running: 0\n Paused: 0\n Stopped: 0\nImages: 0\nServer Version: 18.06.0-ce\nStorage Driver: overlay2\n Backing Filesystem: extfs\n Supports d_type: true\n Native Overlay Diff: true\nLogging Driver: json-file\nCgroup Driver: cgroupfs\n## ......\nLive Restore Enabled: false\n\n```\n\n\u5728 `docker info` \u8fd9\u6761\u547d\u4ee4\u7684\u7ed3\u679c\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b63\u5728\u8fd0\u884c\u7684 Docker Engine \u5b9e\u4f8b\u4e2d\u8fd0\u884c\u7684\u5bb9\u5668\u6570\u91cf\uff0c\u5b58\u50a8\u7684\u5f15\u64ce\u7b49\u7b49\u4fe1\u606f\u3002\u7531\u4e8e\u547d\u4ee4\u7ed3\u679c\u6bd4\u8f83\u591a\uff0c\u8fd9\u91cc\u6211\u7701\u7565\u4e86\u5927\u90e8\u5206\u5185\u5bb9\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u5df1\u64cd\u4f5c\u6765\u5c1d\u8bd5\u83b7\u5f97\u5b8c\u6574\u7684\u4fe1\u606f\u3002\u5728\u4e4b\u540e\u7684\u7ae0\u8282\u91cc\uff0c\u8f83\u591a\u7ed3\u679c\u7684\u547d\u4ee4\u6211\u4e5f\u4f1a\u7701\u53bb\u4e00\u4e9b\u4e0e\u8bb2\u89e3\u5185\u5bb9\u65e0\u5173\u7684\u90e8\u5206\uff0c\u8282\u7ea6\u5927\u5bb6\u9605\u8bfb\u7684\u65f6\u95f4\u5e76\u5f3a\u5316\u91cd\u70b9\u3002\n\n### \u914d\u7f6e\u56fd\u5185\u955c\u50cf\u6e90\n\n\u5728\u5f88\u591a\u7f16\u7a0b\u8bed\u8a00\u4e2d\uff0c\u4e3a\u4e86\u66f4\u597d\u7684\u5411\u5927\u5bb6\u63d0\u4f9b\u4f9d\u8d56\u5305\u7684\u7ba1\u7406\uff0c\u901a\u5e38\u90fd\u4f1a\u6709\u4e00\u4e9b\u7ec4\u7ec7\u7814\u53d1\u76f8\u5e94\u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u4f8b\u5982 Java \u7684 Maven\uff0cPHP \u7684 Composer\uff0cNode.js \u7684 NPM \u7b49\u7b49\u3002\u800c\u8fd9\u4e9b\u7ba1\u7406\u5de5\u5177\u80cc\u540e\uff0c\u4e5f\u5bf9\u5e94\u7740\u4e00\u4e2a\u9ed8\u8ba4\u7684\u4f9d\u8d56\u5305\u4ed3\u5e93\u3002\n\n\u7531\u4e8e\u4f17\u6240\u5468\u77e5\u7684\u539f\u56e0\uff0c\u6211\u4eec\u76f4\u63a5\u8fde\u63a5\u8fd9\u4e9b\u4f4d\u4e8e\u56fd\u5916\u670d\u52a1\u5668\u4e0a\u7684\u4ed3\u5e93\u53bb\u83b7\u53d6\u4f9d\u8d56\u5305\u901f\u5ea6\u662f\u975e\u5e38\u6162\u7684\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u901a\u5e38\u4f1a\u91c7\u7528\u56fd\u5185\u4e00\u4e9b\u7ec4\u7ec7\u6216\u5f00\u53d1\u8005\u8d21\u732e\u7684\u56fd\u5185\u955c\u50cf\u4ed3\u5e93 ( \u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u201c\u955c\u50cf\u201d\u662f\u6307\u590d\u5236\u4e8e\u56fd\u5916\u6e90\u7684\u610f\u601d\uff0c\u800c\u4e0d\u662f Docker \u91cc\u7684\u955c\u50cf )\u3002\n\n\u5728 Docker \u4e2d\u4e5f\u6709\u4e00\u4e2a\u7531\u5b98\u65b9\u63d0\u4f9b\u7684\u4e2d\u592e\u955c\u50cf\u4ed3\u5e93\uff0c\u4e0d\u8fc7\uff0c\u5b83\u4e0e\u4e4b\u524d\u6211\u4eec\u6240\u8bf4\u7684\u56fd\u5916\u4f9d\u8d56\u5305\u4ed3\u5e93\u4e00\u6837\uff0c\u9664\u4e86\u6162\u7684\u53ef\u601c\u4ee5\u5916\uff0c\u8fd8\u7ecf\u5e38\u83ab\u540d\u5176\u5999\u7684\u5b8c\u5168\u65e0\u6cd5\u8bbf\u95ee\u3002\n\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u6700\u4f73\u7684\u65b9\u5f0f\u4f9d\u65e7\u662f\u5728\u56fd\u5185\u627e\u4e00\u4e2a\u955c\u50cf\u4ed3\u5e93\u7684\u955c\u50cf\u6e90\u8fdb\u884c\u66ff\u6362\u3002\u5f88\u611f\u8c22 DaoCloud\u3001\u963f\u91cc\u4e91\u7b49\u4f01\u4e1a\u7684\u652f\u6301\uff0c\u5728\u56fd\u5185\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u8bb8\u591a\u955c\u50cf\u6e90\u3002\u8fd9\u91cc\u6211\u4eec\u7ed9\u51fa\u4e00\u4e2a\u7531 Docker \u5b98\u65b9\u63d0\u4f9b\u7684\u56fd\u5185\u955c\u50cf\u6e90\uff1a\n\n> [https://registry.docker-cn.com](https://registry.docker-cn.com)\n\n_( \u6ce8\uff1a\u90e8\u5206\u8bfb\u8005\u53cd\u6620\u914d\u7f6e\u4e86\u8fd9\u4e2a\u955c\u50cf\u6e90\u65e0\u6548\uff0c\u5927\u5bb6\u9700\u8981\u6ce8\u610f\u6b64\u5730\u5740\u7684\u534f\u8bae\u662f https\uff0c\u4e0d\u8981\u641e\u9519\u54df )_\n\n\u90a3\u4e48\u6709\u4e86\u5730\u5740\uff0c\u6211\u4eec\u8981\u5982\u4f55\u5c06\u5176\u914d\u7f6e\u5230 Docker \u4e2d\u5462\uff1f\n\n\u5728 Linux \u73af\u5883\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 `/etc/docker/daemon.json` ( \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u521b\u5efa\u5b83 ) \u8fd9\u4e2a Docker \u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\u8fbe\u5230\u6548\u679c\u3002\n\n```\n{\n    \"registry-mirrors\": [\n        \"https://registry.docker-cn.com\"\n    ]\n}\n\n```\n\n\u5728\u4fee\u6539\u4e4b\u540e\uff0c\u522b\u5fd8\u4e86\u91cd\u65b0\u542f\u52a8 docker daemon \u6765\u8ba9\u914d\u7f6e\u751f\u6548\u54df\uff1a\n\n```\n$ sudo systemctl restart docker\n\n```\n\n\u8981\u9a8c\u8bc1\u6211\u4eec\u914d\u7f6e\u7684\u955c\u50cf\u6e90\u662f\u5426\u751f\u6548\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `docker info` \u6765\u67e5\u9605\u5f53\u524d\u6ce8\u518c\u7684\u955c\u50cf\u6e90\u5217\u8868\u3002\n\n```\n$ sudo docker info\n## ......\nRegistry Mirrors:\n https://registry.docker-cn.com/\n## ......\n\n```\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u8fd9\u8282\u4e2d\uff0c\u5728\u8fd9\u4e00\u5c0f\u8282\u4e2d\u6211\u4eec\u638c\u63e1\u4e86\u5982\u4f55\u5728 Linux \u4e2d\u5b89\u88c5\u4e0a\u4e86 Docker Engine\uff0c\u4e5f\u5b66\u4e60\u4f7f\u7528\u4e86\u51e0\u4e2a\u7b80\u5355\u7684 docker \u547d\u4ee4\u7684\u4f7f\u7528\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u5b9e\u8df5\u9898\uff1a\n\n> \u5c1d\u8bd5\u81ea\u5df1\u5728 Linux \u7cfb\u7edf\u4e2d\u5b89\u88c5\u548c\u8fd0\u884c Docker Engine\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker Engine \u7684\u5b89\u88c5\u4ee5\u53ca\u542f\u52a8\u8fd0\u884c\u8fd8\u6709\u4ec0\u4e48\u7591\u95ee\uff0c\u6216\u8005\u5728\u64cd\u4f5c\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u65e0\u6cd5\u5904\u7406\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u5b89\u88c5\u8fd0\u884c\u642d\u5efa_Docker_\u8fd0\u884c\u73af\u5883.md", "create_date": "2020-02-18T21:18:38.867", "order": 4}}, {"model": "subject.chapter", "pk": 58, "fields": {"title": "\u767e\u5c3a\u7aff\u5934\uff0c\u66f4\u8fdb\u4e00\u6b65", "topic": 3, "md5": "6153f8f492560b14d824fc8a864a96e0", "md_body": "# \u767e\u5c3a\u7aff\u5934\uff0c\u66f4\u8fdb\u4e00\u6b65\n\n\u5728\u8fd9\u672c\u5c0f\u518c\u91cc\uff0c\u6211\u4eec\u4ece Docker \u6700\u57fa\u7840\u7684\u77e5\u8bc6\u8c08\u8d77\uff0c\u4ecb\u7ecd\u4e86 Docker \u7684\u6838\u5fc3\u7ec4\u6210\u90e8\u5206\u4ee5\u53ca\u64cd\u4f5c\u8fd9\u4e9b\u529f\u80fd\u7684\u547d\u4ee4\u4e0e\u65b9\u6cd5\uff0c\u5176\u540e\u53c8\u8bb2\u89e3\u4e86\u5f00\u53d1\u4e2d\u6700\u5e38\u7528\u7684 Docker Compose\uff0c\u5e76\u5b8c\u6574\u7684\u5c55\u793a\u4e86\u901a\u8fc7\u5b83\u4eec\u642d\u5efa\u5f00\u53d1\u73af\u5883\u7684\u8fc7\u7a0b\u3002\n\n\u7136\u800c Docker \u7684\u751f\u6001\u592a\u8fc7\u4e30\u5bcc\uff0c\u4e0d\u4ec5\u662f Docker \u76f8\u5173\u7684\u77e5\u8bc6\u6d69\u5982\u70df\u6d77\uff0c\u5c31\u8fde\u5f00\u53d1\u4e2d\u6240\u80fd\u4f7f\u7528\u5230\u7684\u6280\u5de7\u4e5f\u4e0d\u53ef\u80dc\u6570\u3002\u867d\u7136\u6211\u5c3d\u5fc3\u603b\u7ed3\uff0c\u4f46\u8fd9\u672c\u5c0f\u518c\u91cc\u80af\u5b9a\u8fd8\u5b58\u5728\u8bb8\u591a\u6b20\u7f3a\u548c\u532e\u4e4f\u4e4b\u5904\u3002\n\n\u597d\u5728\u5c0f\u518c\u7684\u7ed3\u6784\u7ecf\u8fc7\u6211\u7cbe\u5fc3\u7f16\u6392\uff0c\u5f62\u6210\u4e86\u4e00\u6761\u6709\u903b\u8f91\u7684\u8109\u7edc\uff0c\u8fd9\u80fd\u591f\u5e2e\u52a9\u5927\u5bb6\u7531\u6d45\u5165\u6df1\u7684\u9010\u6b65\u638c\u63e1 Docker \u53ca\u5176\u4e0e\u5b83\u76f8\u5173\u7684\u77e5\u8bc6\u3002\n\n\u5927\u5bb6\u53ef\u4ee5\u5728\u9605\u8bfb\u6bcf\u4e00\u5c0f\u8282\u540e\uff0c\u5bf9\u5176\u4e2d\u4ecd\u6709\u7591\u60d1\u4e4b\u5904\uff0c\u53ef\u4ee5\u76f4\u63a5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u76f4\u63a5\u5411\u5927\u5bb6\u63d0\u95ee\u5e76\u53c2\u4e0e\u6211\u4eec\u7684\u4ea4\u6d41\u3002\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5728\u5f00\u53d1\u4e2d\u8fd8\u6709\u5bf9\u5de5\u4f5c\u6548\u7387\u6216\u5176\u4ed6\u65b9\u9762\u6709\u63d0\u9ad8\u7684 Docker \u4f7f\u7528\u7ecf\u9a8c\u6280\u5de7\uff0c\u4e5f\u6b22\u8fce\u52a0\u5165\u5230\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u4e0e\u5927\u5bb6\u5206\u4eab\u3002\n\n\u53e6\u5916\uff0c\u5927\u5bb6\u53ef\u4ee5\u901a\u8fc7\u7559\u8a00\u6216\u5728\u5fae\u4fe1\u7fa4\u4e2d\u63d0\u95ee\u7684\u65b9\u5f0f\uff0c\u8bf4\u51fa\u4f60\u8fd8\u60f3\u4e86\u89e3\u7684\u77e5\u8bc6\u70b9\u6216\u4f7f\u7528\u6280\u5de7\uff0c\u5728\u8fd9\u672c\u5c0f\u518c\u540e\u9762\uff0c\u6211\u4f1a\u9009\u62e9\u5927\u5bb6\u6bd4\u8f83\u5173\u6ce8\u7684\u4e00\u4e9b\u77e5\u8bc6\u6216\u95ee\u9898\u4e13\u95e8\u5f00\u8f9f\u7bc7\u5e45\u8fdb\u884c\u8bb2\u89e3\u3002\n\n## \u77e5\u8bc6\u5ef6\u4f38\n\n\u5728\u5c0f\u518c\u91cc\u6211\u4eec\u8c08\u5230\u4e86\u5f88\u591a\u5173\u4e8e docker \u547d\u4ee4\u548c docker-compose \u547d\u4ee4\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u4f46\u8fd9\u4e24\u4e2a\u547d\u4ee4\u4e2d\u8fd8\u5305\u542b\u4e86\u5927\u91cf\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u5927\u5bb6\u53ef\u4ee5\u901a\u8fc7\u9605\u8bfb\u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u624b\u518c\u6765\u83b7\u5f97\u66f4\u8be6\u7ec6\u7684\u89e3\u8bfb\u3002\n\n*   [docker : https://docs.docker.com/engine/reference/run/](https://docs.docker.com/engine/reference/run/)\n*   [docker-compose : https://docs.docker.com/compose/reference/overview/](https://docs.docker.com/compose/reference/overview/)\n\n\u5982\u679c\u8fd8\u5e0c\u671b\u4e86\u89e3\u66f4\u591a\u5173\u4e8e Docker \u7684\u77e5\u8bc6\uff0c\u6211\u60f3\u4e0b\u9762\u7684\u8fd9\u4e9b\u793e\u533a\u4f1a\u5bf9\u4f60\u5f88\u6709\u5e2e\u52a9\u3002\n\n*   [\u6398\u91d1](https://juejin.im/tag/Docker)\n*   [Segmentfault](https://segmentfault.com/t/docker)\n*   [\u5f00\u6e90\u4e2d\u56fd](https://www.oschina.net/question/tag/docker)\n\n## \u6211\u7684\u4e13\u680f\n\n\u6700\u540e\uff0c\u53cb\u60c5\u63a8\u8350\u4e0b\u6211\u81ea\u5df1\u7684\u5fae\u4fe1\u516c\u4f17\u53f7\u300c\u865e\u5c71\u811a\u4e0b\u300d\uff0c\u66f4\u591a\u6709\u5173\u6280\u672f\u7684\u77e5\u8bc6\u6211\u4f1a\u9010\u6e10\u66f4\u65b0\u5230\u516c\u4f17\u53f7\u4e2d\u3002\u4f7f\u7528\u5fae\u4fe1\u626b\u4e00\u626b\u4e0b\u9762\u7684\u4e8c\u7ef4\u7801\u5373\u53ef\u5230\u8bbf\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/8/166530142aefeb7a?w=258&h=258&f=jpeg&s=27874)\n\n\u4e5f\u6b22\u8fce\u5230\u8bbf\uff1a[\u865e\u5c71\u811a\u4e0b : https://youmingdot.com](https://youmingdot.com)", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u767e\u5c3a\u7aff\u5934\u66f4\u8fdb\u4e00\u6b65.md", "create_date": "2020-02-18T21:18:38.954", "order": 21}}, {"model": "subject.chapter", "pk": 59, "fields": {"title": "\u64cd\u4f5c\u955c\u50cf\uff1a\u901a\u8fc7 Dockerfile \u521b\u5efa\u955c\u50cf", "topic": 3, "md5": "f4e6f9d967364f5cbf7c43d1ce666810", "md_body": "# \u901a\u8fc7 Dockerfile \u521b\u5efa\u955c\u50cf\n\n\u7531\u4e8e Docker \u955c\u50cf\u7684\u7ed3\u6784\u4f18\u52bf\uff0c\u4f7f\u5b83\u7684\u5360\u7528\u7a7a\u95f4\u8fdc\u5c0f\u4e8e\u666e\u901a\u7684\u865a\u62df\u673a\u955c\u50cf\uff0c\u800c\u8fd9\u5c31\u5927\u5e45\u51cf\u5c11\u4e86 Docker \u955c\u50cf\u5728\u7f51\u7edc\u6216\u8005\u5176\u4ed6\u4ecb\u8d28\u4e2d\u8f6c\u79fb\u6240\u82b1\u8d39\u7684\u65f6\u95f4\uff0c\u8fdb\u800c\u63d0\u9ad8\u4e86\u6211\u4eec\u8fdb\u884c\u8fc1\u79fb\u90e8\u7f72\u7684\u6548\u7387\u3002\u4e0d\u8fc7\uff0c\u4f60\u8981\u662f\u4ee5\u4e3a\u8fd9\u5c31\u662f Docker \u80fd\u591f\u5feb\u901f\u90e8\u7f72\u7684\u7ec8\u6781\u5927\u62db\u90a3\u5c31\u5927\u9519\u7279\u9519\u4e86\u3002\u5728\u8fd9\u4e00\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u5c06\u8c08\u5230 Docker \u7279\u6709\u7684\u955c\u50cf\u6784\u5efa\u5b9a\u4e49\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f Dockerfile\u3002\u901a\u8fc7\u4e86\u89e3\u5b83\uff0c\u4f60\u80fd\u771f\u6b63\u4f53\u9a8c\u4e00\u79cd\u8fdb\u884c\u79d2\u7ea7\u955c\u50cf\u8fc1\u79fb\u7684\u4e50\u8da3\u3002\n\n## \u5173\u4e8e Dockerfile\n\nDockerfile \u662f Docker \u4e2d\u7528\u4e8e\u5b9a\u4e49\u955c\u50cf\u81ea\u52a8\u5316\u6784\u5efa\u6d41\u7a0b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5728 Dockerfile \u4e2d\uff0c\u5305\u542b\u4e86\u6784\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\u548c\u5176\u4ed6\u64cd\u4f5c\u3002\u901a\u8fc7 Dockerfile \u6211\u4eec\u53ef\u4ee5\u66f4\u52a0\u6e05\u6670\u3001\u660e\u786e\u7684\u7ed9\u5b9a Docker \u955c\u50cf\u7684\u5236\u4f5c\u8fc7\u7a0b\uff0c\u800c\u7531\u4e8e\u5176\u4ec5\u662f\u7b80\u5355\u3001\u5c0f\u4f53\u79ef\u7684\u6587\u4ef6\uff0c\u5728\u7f51\u7edc\u7b49\u5176\u4ed6\u4ecb\u8d28\u4e2d\u4f20\u9012\u7684\u901f\u5ea6\u6781\u5feb\uff0c\u80fd\u591f\u66f4\u5feb\u7684\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u5bb9\u5668\u8fc1\u79fb\u548c\u96c6\u7fa4\u90e8\u7f72\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/1/1662ee4fdf802776?w=1047&h=332&f=png&s=55112)\n\n\u901a\u5e38\u6765\u8bf4\uff0c\u6211\u4eec\u5bf9 Dockerfile \u7684\u5b9a\u4e49\u5c31\u662f\u9488\u5bf9\u4e00\u4e2a\u540d\u4e3a Dockerfile \u7684\u6587\u4ef6\uff0c\u5176\u867d\u7136\u6ca1\u6709\u6269\u5c55\u540d\uff0c\u4f46\u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5e38\u89c1\u7684\u6587\u672c\u7f16\u8f91\u5668\u6216\u8005 IDE \u521b\u5efa\u548c\u7f16\u8f91\u5b83\u3002\n\nDockerfile \u7684\u5185\u5bb9\u5f88\u7b80\u5355\uff0c\u4e3b\u8981\u4ee5\u4e24\u79cd\u5f62\u5f0f\u5448\u73b0\uff0c\u4e00\u79cd\u662f\u6ce8\u91ca\u884c\uff0c\u53e6\u4e00\u79cd\u662f\u6307\u4ee4\u884c\u3002\n\n```\n# Comment\nINSTRUCTION arguments\n\n```\n\n\u5728 Dockerfile \u4e2d\uff0c\u62e5\u6709\u4e00\u5957\u72ec\u7acb\u7684\u6307\u4ee4\u8bed\u6cd5\uff0c\u5176\u7528\u4e8e\u7ed9\u51fa\u955c\u50cf\u6784\u5efa\u8fc7\u7a0b\u4e2d\u6240\u8981\u6267\u884c\u7684\u8fc7\u7a0b\u3002Dockerfile \u91cc\u7684\u6307\u4ee4\u884c\uff0c\u5c31\u662f\u7531\u6307\u4ee4\u4e0e\u5176\u76f8\u5e94\u7684\u53c2\u6570\u6240\u7ec4\u6210\u3002\n\n### \u73af\u5883\u642d\u5efa\u4e0e\u955c\u50cf\u6784\u5efa\n\n\u5982\u679c\u5177\u4f53\u6765\u8bf4 Dockerfile \u7684\u4f5c\u7528\u548c\u5176\u5b9e\u9645\u8fd0\u8f6c\u7684\u673a\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u6211\u4eec\u5f00\u53d1\u4e2d\u7684\u5e38\u89c1\u6d41\u7a0b\u6765\u6bd4\u8f83\u3002\n\n\u5728\u4e00\u4e2a\u5b8c\u6574\u7684\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u90e8\u7f72\u8fc7\u7a0b\u4e2d\uff0c\u7a0b\u5e8f\u8fd0\u884c\u73af\u5883\u7684\u5b9a\u4e49\u901a\u5e38\u662f\u7531\u5f00\u53d1\u4eba\u5458\u6765\u8fdb\u884c\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u66f4\u52a0\u719f\u6089\u7a0b\u5e8f\u8fd0\u8f6c\u7684\u5404\u4e2a\u7ec6\u8282\uff0c\u66f4\u9002\u5408\u642d\u5efa\u9002\u5408\u7a0b\u5e8f\u7684\u8fd0\u884c\u73af\u5883\u3002\n\n\u5728\u8fd9\u6837\u7684\u524d\u63d0\u4e0b\uff0c\u4e3a\u4e86\u65b9\u4fbf\u6d4b\u8bd5\u548c\u8fd0\u7ef4\u642d\u5efa\u76f8\u540c\u7684\u7a0b\u5e8f\u8fd0\u884c\u73af\u5883\uff0c\u5e38\u7528\u7684\u505a\u6cd5\u662f\u7531\u5f00\u53d1\u4eba\u5458\u7f16\u5199\u4e00\u5957\u73af\u5883\u642d\u5efa\u624b\u518c\uff0c\u5e2e\u52a9\u6d4b\u8bd5\u4eba\u5458\u548c\u8fd0\u7ef4\u4eba\u5458\u4e86\u89e3\u73af\u5883\u642d\u5efa\u7684\u6d41\u7a0b\u3002\n\n\u800c Dockerfile \u5c31\u5f88\u50cf\u8fd9\u6837\u4e00\u4e2a\u73af\u5883\u642d\u5efa\u624b\u518c\uff0c\u56e0\u4e3a\u5176\u4e2d\u5305\u542b\u7684\u5c31\u662f\u4e00\u4e2a\u6784\u5efa\u5bb9\u5668\u7684\u8fc7\u7a0b\u3002\n\n\u800c\u6bd4\u73af\u5883\u642d\u5efa\u624b\u518c\u66f4\u597d\u7684\u662f\uff0cDockerfile \u5728\u5bb9\u5668\u4f53\u7cfb\u4e0b\u80fd\u591f\u5b8c\u6210\u81ea\u52a8\u6784\u5efa\uff0c\u65e2\u4e0d\u9700\u8981\u6d4b\u8bd5\u548c\u8fd0\u7ef4\u4eba\u5458\u6df1\u5165\u7406\u89e3\u73af\u5883\u4e2d\u5404\u4e2a\u8f6f\u4ef6\u7684\u5177\u4f53\u7ec6\u8282\uff0c\u4e5f\u4e0d\u9700\u8981\u4eba\u5de5\u6267\u884c\u6bcf\u4e00\u4e2a\u642d\u5efa\u6d41\u7a0b\u3002\n\n## \u7f16\u5199 Dockerfile\n\n\u76f8\u5bf9\u4e8e\u4e4b\u524d\u6211\u4eec\u4ecb\u7ecd\u7684\u63d0\u4ea4\u5bb9\u5668\u4fee\u6539\uff0c\u518d\u8fdb\u884c\u955c\u50cf\u8fc1\u79fb\u7684\u65b9\u5f0f\u76f8\u6bd4\uff0c\u4f7f\u7528 Dockerfile \u8fdb\u884c\u8fd9\u9879\u5de5\u4f5c\u6709\u5f88\u591a\u4f18\u52bf\uff0c\u6211\u603b\u7ed3\u4e86\u51e0\u9879\u5c24\u4e3a\u7a81\u51fa\u7684\u3002\n\n*   Dockerfile \u7684\u4f53\u79ef\u8fdc\u5c0f\u4e8e\u955c\u50cf\u5305\uff0c\u66f4\u5bb9\u6613\u8fdb\u884c\u5feb\u901f\u8fc1\u79fb\u548c\u90e8\u7f72\u3002\n*   \u73af\u5883\u6784\u5efa\u6d41\u7a0b\u8bb0\u5f55\u4e86 Dockerfile \u4e2d\uff0c\u80fd\u591f\u76f4\u89c2\u7684\u770b\u5230\u955c\u50cf\u6784\u5efa\u7684\u987a\u5e8f\u548c\u903b\u8f91\u3002\n*   \u4f7f\u7528 Dockerfile \u6765\u6784\u5efa\u955c\u50cf\u80fd\u591f\u66f4\u8f7b\u677e\u7684\u5b9e\u73b0\u81ea\u52a8\u90e8\u7f72\u7b49\u81ea\u52a8\u5316\u6d41\u7a0b\u3002\n*   \u5728\u4fee\u6539\u73af\u5883\u642d\u5efa\u7ec6\u8282\u65f6\uff0c\u4fee\u6539 Dockerfile \u6587\u4ef6\u8981\u6bd4\u4ece\u65b0\u63d0\u4ea4\u955c\u50cf\u6765\u7684\u8f7b\u677e\u3001\u7b80\u5355\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u6211\u4eec\u4e5f\u5f88\u5c11\u4f1a\u9009\u62e9\u5bb9\u5668\u63d0\u4ea4\u8fd9\u79cd\u65b9\u6cd5\u6765\u6784\u5efa\u955c\u50cf\uff0c\u800c\u662f\u51e0\u4e4e\u90fd\u91c7\u7528 Dockerfile \u6765\u5236\u4f5c\u955c\u50cf\u3002\u6240\u4ee5\u8bf4\uff0c\u5b66\u4f1a Dockerfile \u7684\u7f16\u5199\u662f\u6240\u6709\u719f\u7ec3\u4f7f\u7528 Docker \u7684\u5f00\u53d1\u8005\u5fc5\u987b\u638c\u63e1\u7684\u80fd\u529b\u3002\n\n\u7eb8\u4e0a\u5f97\u6765\u7ec8\u89c9\u6d45\uff0c\u5149\u8bf4\u5f88\u591a\u5173\u4e8e Dockerfile \u7684\u6982\u5ff5\u5176\u5b9e\u5bf9\u6211\u4eec\u5f00\u53d1\u4f7f\u7528\u6765\u8bf4\u610f\u4e49\u4e0d\u5927\uff0c\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u5b66\u4e60\u5982\u4f55\u7f16\u5199\u4e00\u4e2a\u7528\u4e8e\u6784\u5efa\u955c\u50cf\u7684 Dockerfile\u3002\n\n\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5b8c\u6574\u7684 Dockerfile \u7684\u4f8b\u5b50\uff0c\u8fd9\u662f\u7528\u4e8e\u6784\u5efa Docker \u5b98\u65b9\u6240\u63d0\u4f9b\u7684 Redis \u955c\u50cf\u7684 Dockerfile \u6587\u4ef6\u3002\n\n```\nFROM debian:stretch-slim\n\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r redis && useradd -r -g redis redis\n\n# grab gosu for easy step-down from root\n# https://github.com/tianon/gosu/releases\nENV GOSU_VERSION 1.10\nRUN set -ex; \\\n\t\\\n\tfetchDeps=\" \\\n\t\tca-certificates \\\n\t\tdirmngr \\\n\t\tgnupg \\\n\t\twget \\\n\t\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends $fetchDeps; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\t\\\n\tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \\\n\twget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \\\n\twget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \\\n\tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \\\n\tgpgconf --kill all; \\\n\trm -r \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \\\n\tchmod +x /usr/local/bin/gosu; \\\n\tgosu nobody true; \\\n\t\\\n\tapt-get purge -y --auto-remove $fetchDeps\n\nENV REDIS_VERSION 3.2.12\nENV REDIS_DOWNLOAD_URL http://download.redis.io/releases/redis-3.2.12.tar.gz\nENV REDIS_DOWNLOAD_SHA 98c4254ae1be4e452aa7884245471501c9aa657993e0318d88f048093e7f88fd\n\n# for redis-sentinel see: http://redis.io/topics/sentinel\nRUN set -ex; \\\n\t\\\n\tbuildDeps=' \\\n\t\twget \\\n\t\t\\\n\t\tgcc \\\n\t\tlibc6-dev \\\n\t\tmake \\\n\t'; \\\n\tapt-get update; \\\n\tapt-get install -y $buildDeps --no-install-recommends; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\t\\\n\twget -O redis.tar.gz \"$REDIS_DOWNLOAD_URL\"; \\\n\techo \"$REDIS_DOWNLOAD_SHA *redis.tar.gz\" | sha256sum -c -; \\\n\tmkdir -p /usr/src/redis; \\\n\ttar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1; \\\n\trm redis.tar.gz; \\\n\t\\\n# disable Redis protected mode [1] as it is unnecessary in context of Docker\n# (ports are not automatically exposed when running inside Docker, but rather explicitly by specifying -p / -P)\n# [1]: https://github.com/antirez/redis/commit/edd4d555df57dc84265fdfb4ef59a4678832f6da\n\tgrep -q '^#define CONFIG_DEFAULT_PROTECTED_MODE 1$' /usr/src/redis/src/server.h; \\\n\tsed -ri 's!^(#define CONFIG_DEFAULT_PROTECTED_MODE) 1$!\\1 0!' /usr/src/redis/src/server.h; \\\n\tgrep -q '^#define CONFIG_DEFAULT_PROTECTED_MODE 0$' /usr/src/redis/src/server.h; \\\n# for future reference, we modify this directly in the source instead of just supplying a default configuration flag because apparently \"if you specify any argument to redis-server, [it assumes] you are going to specify everything\"\n# see also https://github.com/docker-library/redis/issues/4#issuecomment-50780840\n# (more exactly, this makes sure the default behavior of \"save on SIGTERM\" stays functional by default)\n\t\\\n\tmake -C /usr/src/redis -j \"$(nproc)\"; \\\n\tmake -C /usr/src/redis install; \\\n\t\\\n\trm -r /usr/src/redis; \\\n\t\\\n\tapt-get purge -y --auto-remove $buildDeps\n\nRUN mkdir /data && chown redis:redis /data\nVOLUME /data\nWORKDIR /data\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\nEXPOSE 6379\nCMD [\"redis-server\"]\n\n```\n\n\u5176\u4e2d\u53ef\u4ee5\u5f88\u660e\u786e\u7684\u89c1\u5230\u6211\u4eec\u4e4b\u524d\u8bf4\u7684 Dockerfile \u6587\u4ef6\u7684\u4e24\u79cd\u884c\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u6307\u4ee4\u884c\u548c\u6ce8\u91ca\u884c\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u7740\u91cd\u5173\u6ce8\u6307\u4ee4\u884c\uff0c\u56e0\u4e3a\u8fd9\u662f\u6784\u5efa\u955c\u50cf\u7684\u5173\u952e\u3002\n\n### Dockerfile \u7684\u7ed3\u6784\n\n\u603b\u4f53\u4e0a\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 Dockerfile \u7406\u89e3\u4e3a\u4e00\u4e2a\u7531\u4e0a\u5f80\u4e0b\u6267\u884c\u6307\u4ee4\u7684\u811a\u672c\u6587\u4ef6\u3002\u5f53\u6211\u4eec\u8c03\u7528\u6784\u5efa\u547d\u4ee4\u8ba9 Docker \u901a\u8fc7\u6211\u4eec\u7ed9\u51fa\u7684 Dockerfile \u6784\u5efa\u955c\u50cf\u65f6\uff0cDocker \u4f1a\u9010\u4e00\u6309\u987a\u5e8f\u89e3\u6790 Dockerfile \u4e2d\u7684\u6307\u4ee4\uff0c\u5e76\u6839\u636e\u5b83\u4eec\u4e0d\u540c\u7684\u542b\u4e49\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\u3002\n\n\u5982\u679c\u8fdb\u884c\u7ec6\u5206\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 Dockerfile \u7684\u6307\u4ee4\u7b80\u5355\u5206\u4e3a\u4e94\u5927\u7c7b\u3002\n\n*   **\u57fa\u7840\u6307\u4ee4**\uff1a\u7528\u4e8e\u5b9a\u4e49\u65b0\u955c\u50cf\u7684\u57fa\u7840\u548c\u6027\u8d28\u3002\n*   **\u63a7\u5236\u6307\u4ee4**\uff1a\u662f\u6307\u5bfc\u955c\u50cf\u6784\u5efa\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u7528\u4e8e\u63cf\u8ff0\u955c\u50cf\u5728\u6784\u5efa\u8fc7\u7a0b\u4e2d\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002\n*   **\u5f15\u5165\u6307\u4ee4**\uff1a\u7528\u4e8e\u5c06\u5916\u90e8\u6587\u4ef6\u76f4\u63a5\u5f15\u5165\u5230\u6784\u5efa\u955c\u50cf\u5185\u90e8\u3002\n*   **\u6267\u884c\u6307\u4ee4**\uff1a\u80fd\u591f\u4e3a\u57fa\u4e8e\u955c\u50cf\u6240\u521b\u5efa\u7684\u5bb9\u5668\uff0c\u6307\u5b9a\u5728\u542f\u52a8\u65f6\u9700\u8981\u6267\u884c\u7684\u811a\u672c\u6216\u547d\u4ee4\u3002\n*   **\u914d\u7f6e\u6307\u4ee4**\uff1a\u5bf9\u955c\u50cf\u4ee5\u53ca\u57fa\u4e8e\u955c\u50cf\u6240\u521b\u5efa\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6307\u4ee4\u5bf9\u5176\u7f51\u7edc\u3001\u7528\u6237\u7b49\u5185\u5bb9\u8fdb\u884c\u914d\u7f6e\u3002\n\n\u8fd9\u4e94\u7c7b\u547d\u4ee4\u5e76\u975e\u90fd\u4f1a\u51fa\u73b0\u5728\u4e00\u4e2a Dockerfile \u91cc\uff0c\u4f46\u5374\u5bf9\u57fa\u4e8e\u8fd9\u4e2a Dockerfile \u6240\u6784\u5efa\u955c\u50cf\u5f62\u6210\u4e0d\u540c\u7684\u5f71\u54cd\u3002\n\n## \u5e38\u89c1 Dockerfile \u6307\u4ee4\n\n\u719f\u6089 Dockerfile \u7684\u6307\u4ee4\u662f\u7f16\u5199 Dockerfile \u7684\u524d\u63d0\uff0c\u8fd9\u91cc\u6211\u4eec\u5148\u6765\u4ecb\u7ecd\u51e0\u4e2a\u6700\u5e38\u89c1\u7684 Dockerfile \u6307\u4ee4\uff0c\u5b83\u4eec\u57fa\u672c\u4e0a\u56ca\u62ec\u4e86\u6240\u6709 Dockerfile \u4e2d 90% \u4ee5\u4e0a\u7684\u5de5\u4f5c\u3002\n\n### FROM\n\n\u901a\u5e38\u6765\u8bf4\uff0c\u6211\u4eec\u4e0d\u4f1a\u4ece\u96f6\u5f00\u59cb\u642d\u5efa\u4e00\u4e2a\u955c\u50cf\uff0c\u800c\u662f\u4f1a\u9009\u62e9\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u955c\u50cf\u4f5c\u4e3a\u6211\u4eec\u65b0\u955c\u50cf\u7684\u57fa\u7840\uff0c\u8fd9\u79cd\u65b9\u5f0f\u80fd\u591f\u5927\u5e45\u51cf\u5c11\u6211\u4eec\u7684\u65f6\u95f4\u3002\n\n\u5728 Dockerfile \u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 FROM \u6307\u4ee4\u6307\u5b9a\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\uff0c\u63a5\u4e0b\u6765\u6240\u6709\u7684\u6307\u4ee4\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e2a\u955c\u50cf\u6240\u5c55\u5f00\u7684\u3002\u5728\u955c\u50cf\u6784\u5efa\u7684\u8fc7\u7a0b\u4e2d\uff0cDocker \u4e5f\u4f1a\u5148\u83b7\u53d6\u5230\u8fd9\u4e2a\u7ed9\u51fa\u7684\u57fa\u7840\u955c\u50cf\uff0c\u518d\u4ece\u8fd9\u4e2a\u955c\u50cf\u4e0a\u8fdb\u884c\u6784\u5efa\u64cd\u4f5c\u3002\n\nFROM \u6307\u4ee4\u652f\u6301\u4e09\u79cd\u5f62\u5f0f\uff0c\u4e0d\u7ba1\u662f\u54ea\u79cd\u5f62\u5f0f\uff0c\u5176\u6838\u5fc3\u903b\u8f91\u5c31\u662f\u6307\u51fa\u80fd\u591f\u88ab Docker \u8bc6\u522b\u7684\u90a3\u4e2a\u955c\u50cf\uff0c\u597d\u8ba9 Docker \u4ece\u90a3\u4e2a\u955c\u50cf\u4e4b\u4e0a\u5f00\u59cb\u6784\u5efa\u5de5\u4f5c\u3002\n\n```\nFROM <image> [AS <name>]\nFROM <image>[:<tag>] [AS <name>]\nFROM <image>[@<digest>] [AS <name>]\n\n```\n\n\u65e2\u7136\u9009\u62e9\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\u662f\u6784\u5efa\u65b0\u955c\u50cf\u7684\u6839\u672c\uff0c\u90a3\u4e48 Dockerfile \u4e2d\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u5fc5\u987b\u662f FROM \u6307\u4ee4\uff0c\u56e0\u4e3a\u6ca1\u6709\u4e86\u57fa\u7840\u955c\u50cf\uff0c\u4e00\u5207\u6784\u5efa\u8fc7\u7a0b\u90fd\u65e0\u6cd5\u5f00\u5c55\u3002\n\n\u5f53\u7136\uff0c\u4e00\u4e2a Dockerfile \u8981\u4ee5 FROM \u6307\u4ee4\u4f5c\u4e3a\u5f00\u59cb\u5e76\u4e0d\u610f\u5473\u7740 FROM \u53ea\u80fd\u662f Dockerfile \u4e2d\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u3002\u5728 Dockerfile \u4e2d\u53ef\u4ee5\u591a\u6b21\u51fa\u73b0 FROM \u6307\u4ee4\uff0c\u5f53 FROM \u7b2c\u4e8c\u6b21\u6216\u8005\u4e4b\u540e\u51fa\u73b0\u65f6\uff0c\u8868\u793a\u5728\u6b64\u523b\u6784\u5efa\u65f6\uff0c\u8981\u5c06\u5f53\u524d\u6307\u51fa\u955c\u50cf\u7684\u5185\u5bb9\u5408\u5e76\u5230\u6b64\u523b\u6784\u5efa\u955c\u50cf\u7684\u5185\u5bb9\u91cc\u3002\u8fd9\u5bf9\u4e8e\u6211\u4eec\u76f4\u63a5\u5408\u5e76\u4e24\u4e2a\u955c\u50cf\u7684\u529f\u80fd\u5f88\u6709\u5e2e\u52a9\u3002\n\n### RUN\n\n\u955c\u50cf\u7684\u6784\u5efa\u867d\u7136\u662f\u6309\u7167\u6307\u4ee4\u6267\u884c\u7684\uff0c\u4f46\u6307\u4ee4\u53ea\u662f\u5f15\u5bfc\uff0c\u6700\u7ec8\u5927\u90e8\u5206\u5185\u5bb9\u8fd8\u662f\u63a7\u5236\u53f0\u4e2d\u5bf9\u7a0b\u5e8f\u53d1\u51fa\u7684\u547d\u4ee4\uff0c\u800c RUN \u6307\u4ee4\u5c31\u662f\u7528\u4e8e\u5411\u63a7\u5236\u53f0\u53d1\u9001\u547d\u4ee4\u7684\u6307\u4ee4\u3002\n\n\u5728 RUN \u6307\u4ee4\u4e4b\u540e\uff0c\u6211\u4eec\u76f4\u63a5\u62fc\u63a5\u4e0a\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5728\u6784\u5efa\u65f6\uff0cDocker \u5c31\u4f1a\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\uff0c\u5e76\u5c06\u5b83\u4eec\u5bf9\u6587\u4ef6\u7cfb\u7edf\u7684\u4fee\u6539\u8bb0\u5f55\u4e0b\u6765\uff0c\u5f62\u6210\u955c\u50cf\u7684\u53d8\u5316\u3002\n\n```\nRUN <command>\nRUN [\"executable\", \"param1\", \"param2\"]\n\n```\n\nRUN \u6307\u4ee4\u662f\u652f\u6301 \\\\ \u6362\u884c\u7684\uff0c\u5982\u679c\u5355\u884c\u7684\u957f\u5ea6\u8fc7\u957f\uff0c\u5efa\u8bae\u5bf9\u5185\u5bb9\u8fdb\u884c\u5207\u5272\uff0c\u65b9\u4fbf\u9605\u8bfb\u3002\u800c\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u4f1a\u7ecf\u5e38\u770b\u5230 \\\\ \u5206\u5272\u7684\u547d\u4ee4\uff0c\u4f8b\u5982\u5728\u4e0a\u9762\u6211\u4eec\u8d34\u51fa\u7684 Redis \u955c\u50cf\u7684 Dockerfile \u91cc\u3002\n\n### ENTRYPOINT \u548c CMD\n\n\u57fa\u4e8e\u955c\u50cf\u542f\u52a8\u7684\u5bb9\u5668\uff0c\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u4f1a\u6839\u636e\u955c\u50cf\u6240\u5b9a\u4e49\u7684\u4e00\u6761\u547d\u4ee4\u6765\u542f\u52a8\u5bb9\u5668\u4e2d\u8fdb\u7a0b\u53f7\u4e3a 1 \u7684\u8fdb\u7a0b\u3002\u800c\u8fd9\u4e2a\u547d\u4ee4\u7684\u5b9a\u4e49\uff0c\u5c31\u662f\u901a\u8fc7 Dockerfile \u4e2d\u7684 ENTRYPOINT \u548c CMD \u5b9e\u73b0\u7684\u3002\n\n```\nENTRYPOINT [\"executable\", \"param1\", \"param2\"]\nENTRYPOINT command param1 param2\n\nCMD [\"executable\",\"param1\",\"param2\"]\nCMD [\"param1\",\"param2\"]\nCMD command param1 param2\n\n```\n\nENTRYPOINT \u6307\u4ee4\u548c CMD \u6307\u4ee4\u7684\u7528\u6cd5\u8fd1\u4f3c\uff0c\u90fd\u662f\u7ed9\u51fa\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5e76\u4e14\u5b83\u4eec\u90fd\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u6216\u8005\u8bf4\u662f\u4e0d\u5728 Dockerfile \u91cc\u6307\u51fa\u3002\n\n\u5f53 ENTRYPOINT \u4e0e CMD \u540c\u65f6\u7ed9\u51fa\u65f6\uff0cCMD \u4e2d\u7684\u5185\u5bb9\u4f1a\u4f5c\u4e3a ENTRYPOINT \u5b9a\u4e49\u547d\u4ee4\u7684\u53c2\u6570\uff0c\u6700\u7ec8\u6267\u884c\u5bb9\u5668\u542f\u52a8\u7684\u8fd8\u662f ENTRYPOINT \u4e2d\u7ed9\u51fa\u7684\u547d\u4ee4\u3002\n\n\u5173\u4e8e ENTRYPOINT \u548c CMD \u7684\u66f4\u8be6\u7ec6\u5bf9\u6bd4\uff0c\u5728\u540e\u4e00\u8282\u91cc\u6211\u4eec\u4f1a\u63d0\u5230\u3002\n\n### EXPOSE\n\n\u5728[\u7b2c 9 \u8282\uff1a\u4e3a\u5bb9\u5668\u914d\u7f6e\u7f51\u7edc](https://juejin.im/book/5b7ba116e51d4556f30b476c/section/5b8381a56fb9a019ba684035)\u4e2d\uff0c\u5728\u672a\u505a\u7279\u6b8a\u5b9a\u4e49\u7684\u524d\u63d0\u4e0b\uff0c\u6211\u4eec\u76f4\u63a5\u8fde\u63a5\u5bb9\u5668\u7f51\u7edc\uff0c\u53ea\u80fd\u8bbf\u95ee\u5bb9\u5668\u660e\u786e\u66b4\u9732\u7684\u7aef\u53e3\u3002\u800c\u6211\u4eec\u4e4b\u524d\u4ecb\u7ecd\u7684\u662f\u5728\u5bb9\u5668\u521b\u5efa\u65f6\u901a\u8fc7\u9009\u9879\u6765\u66b4\u9732\u8fd9\u4e9b\u7aef\u53e3\u3002\n\n\u7531\u4e8e\u6211\u4eec\u6784\u5efa\u955c\u50cf\u65f6\u66f4\u4e86\u89e3\u955c\u50cf\u4e2d\u5e94\u7528\u7a0b\u5e8f\u7684\u903b\u8f91\uff0c\u4e5f\u66f4\u52a0\u6e05\u695a\u5b83\u9700\u8981\u63a5\u6536\u548c\u5904\u7406\u6765\u81ea\u54ea\u4e9b\u7aef\u53e3\u7684\u8bf7\u6c42\uff0c\u6240\u4ee5\u5728\u955c\u50cf\u4e2d\u5b9a\u4e49\u7aef\u53e3\u66b4\u9732\u663e\u7136\u662f\u66f4\u5408\u7406\u7684\u505a\u6cd5\u3002\n\n\u901a\u8fc7 EXPOSE \u6307\u4ee4\u5c31\u53ef\u4ee5\u4e3a\u955c\u50cf\u6307\u5b9a\u8981\u66b4\u9732\u7684\u7aef\u53e3\u3002\n\n```\nEXPOSE <port> [<port>/<protocol>...]\n\n```\n\n\u5f53\u6211\u4eec\u901a\u8fc7 EXPOSE \u6307\u4ee4\u914d\u7f6e\u4e86\u955c\u50cf\u7684\u7aef\u53e3\u66b4\u9732\u5b9a\u4e49\uff0c\u90a3\u4e48\u57fa\u4e8e\u8fd9\u4e2a\u955c\u50cf\u6240\u521b\u5efa\u7684\u5bb9\u5668\uff0c\u5728\u88ab\u5176\u4ed6\u5bb9\u5668\u901a\u8fc7 `--link` \u9009\u9879\u8fde\u63a5\u65f6\uff0c\u5c31\u80fd\u591f\u76f4\u63a5\u5141\u8bb8\u6765\u81ea\u5176\u4ed6\u5bb9\u5668\u5bf9\u8fd9\u4e9b\u7aef\u53e3\u7684\u8bbf\u95ee\u4e86\u3002\n\n### VOLUME\n\n\u5728\u4e00\u4e9b\u7a0b\u5e8f\u91cc\uff0c\u6211\u4eec\u9700\u8981\u6301\u4e45\u5316\u4e00\u4e9b\u6570\u636e\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u4e2d\u5b58\u50a8\u6570\u636e\u7684\u6587\u4ef6\u5939\u5c31\u9700\u8981\u5355\u72ec\u5904\u7406\u3002\u5728\u4e4b\u524d\u7684\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u63d0\u5230\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u5377\u6765\u5904\u7406\u8fd9\u4e9b\u95ee\u9898\u3002\n\n\u4f46\u4f7f\u7528\u6570\u636e\u5377\u9700\u8981\u6211\u4eec\u5728\u521b\u5efa\u5bb9\u5668\u65f6\u901a\u8fc7 `-v` \u9009\u9879\u6765\u5b9a\u4e49\uff0c\u800c\u6709\u65f6\u5019\u7531\u4e8e\u955c\u50cf\u7684\u4f7f\u7528\u8005\u5bf9\u955c\u50cf\u4e86\u89e3\u7a0b\u5ea6\u4e0d\u9ad8\uff0c\u4f1a\u6f0f\u6389\u6570\u636e\u5377\u7684\u521b\u5efa\uff0c\u4ece\u800c\u5f15\u8d77\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6\u3002\n\n\u8fd8\u662f\u90a3\u53e5\u8bdd\uff0c\u5236\u4f5c\u955c\u50cf\u7684\u4eba\u662f\u6700\u6e05\u695a\u955c\u50cf\u4e2d\u7a0b\u5e8f\u5de5\u4f5c\u7684\u5404\u9879\u6d41\u7a0b\u7684\uff0c\u6240\u4ee5\u5b83\u6765\u5b9a\u4e49\u6570\u636e\u5377\u4e5f\u662f\u6700\u5408\u9002\u7684\u3002\u6240\u4ee5\u5728 Dockerfile \u91cc\uff0c\u63d0\u4f9b\u4e86 VOLUME \u6307\u4ee4\u6765\u5b9a\u4e49\u57fa\u4e8e\u6b64\u955c\u50cf\u7684\u5bb9\u5668\u6240\u81ea\u52a8\u5efa\u7acb\u7684\u6570\u636e\u5377\u3002\n\n```\nVOLUME [\"/data\"]\n\n```\n\n\u5728 VOLUME \u6307\u4ee4\u4e2d\u5b9a\u4e49\u7684\u76ee\u5f55\uff0c\u5728\u57fa\u4e8e\u65b0\u955c\u50cf\u521b\u5efa\u5bb9\u5668\u65f6\uff0c\u4f1a\u81ea\u52a8\u5efa\u7acb\u4e3a\u6570\u636e\u5377\uff0c\u4e0d\u9700\u8981\u6211\u4eec\u518d\u5355\u72ec\u4f7f\u7528 `-v` \u9009\u9879\u6765\u914d\u7f6e\u4e86\u3002\n\n### COPY \u548c ADD\n\n\u5728\u5236\u4f5c\u65b0\u7684\u955c\u50cf\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u5c06\u4e00\u4e9b\u8f6f\u4ef6\u914d\u7f6e\u3001\u7a0b\u5e8f\u4ee3\u7801\u3001\u6267\u884c\u811a\u672c\u7b49\u76f4\u63a5\u5bfc\u5165\u5230\u955c\u50cf\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\u91cc\uff0c\u4f7f\u7528 COPY \u6216 ADD \u6307\u4ee4\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u76f4\u63a5\u4ece\u5bbf\u4e3b\u673a\u7684\u6587\u4ef6\u7cfb\u7edf\u91cc\u62f7\u8d1d\u5185\u5bb9\u5230\u955c\u50cf\u91cc\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\n\n```\nCOPY [--chown=<user>:<group>] <src>... <dest>\nADD [--chown=<user>:<group>] <src>... <dest>\n\nCOPY [--chown=<user>:<group>] [\"<src>\",... \"<dest>\"]\nADD [--chown=<user>:<group>] [\"<src>\",... \"<dest>\"]\n\n```\n\nCOPY \u4e0e ADD \u6307\u4ee4\u7684\u5b9a\u4e49\u65b9\u5f0f\u5b8c\u5168\u4e00\u6837\uff0c\u9700\u8981\u6ce8\u610f\u7684\u4ec5\u662f\u5f53\u6211\u4eec\u7684\u76ee\u5f55\u4e2d\u5b58\u5728\u7a7a\u683c\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u540e\u4e24\u79cd\u683c\u5f0f\u907f\u514d\u7a7a\u683c\u4ea7\u751f\u6b67\u4e49\u3002\n\n\u5bf9\u6bd4 COPY \u4e0e ADD\uff0c\u4e24\u8005\u7684\u533a\u522b\u4e3b\u8981\u5728\u4e8e ADD \u80fd\u591f\u652f\u6301\u4f7f\u7528\u7f51\u7edc\u7aef\u7684 URL \u5730\u5740\u4f5c\u4e3a src \u6e90\uff0c\u5e76\u4e14\u5728\u6e90\u6587\u4ef6\u88ab\u8bc6\u522b\u4e3a\u538b\u7f29\u5305\u65f6\uff0c\u81ea\u52a8\u8fdb\u884c\u89e3\u538b\uff0c\u800c COPY \u6ca1\u6709\u8fd9\u4e24\u4e2a\u80fd\u529b\u3002\n\n\u867d\u7136\u770b\u4e0a\u53bb COPY \u80fd\u529b\u7a0d\u5f31\uff0c\u4f46\u5bf9\u4e8e\u90a3\u4e9b\u4e0d\u5e0c\u671b\u6e90\u6587\u4ef6\u88ab\u89e3\u538b\u6216\u6ca1\u6709\u7f51\u7edc\u8bf7\u6c42\u7684\u573a\u666f\uff0cCOPY \u6307\u4ee4\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\n\n## \u6784\u5efa\u955c\u50cf\n\n\u5728\u7f16\u5199\u597d Dockerfile \u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6784\u5efa\u6211\u4eec\u6240\u5b9a\u4e49\u7684\u955c\u50cf\u4e86\uff0c\u6784\u5efa\u955c\u50cf\u7684\u547d\u4ee4\u4e3a `docker build`\u3002\n\n```\n$ sudo docker build ./webapp\n\n```\n\n`docker build` \u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u53c2\u6570\u4e3a\u4e00\u4e2a\u76ee\u5f55\u8def\u5f84 ( \u672c\u5730\u8def\u5f84\u6216 URL \u8def\u5f84 )\uff0c\u800c\u5e76\u975e Dockerfile \u6587\u4ef6\u7684\u8def\u5f84\u3002\u5728 `docker build` \u91cc\uff0c\u8fd9\u4e2a\u6211\u4eec\u7ed9\u51fa\u7684\u76ee\u5f55\u4f1a\u4f5c\u4e3a\u6784\u5efa\u7684\u73af\u5883\u76ee\u5f55\uff0c\u6211\u4eec\u5f88\u591a\u7684\u64cd\u4f5c\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e2a\u76ee\u5f55\u8fdb\u884c\u7684\u3002\n\n\u4f8b\u5982\uff0c\u5728\u6211\u4eec\u4f7f\u7528 COPY \u6216\u662f ADD \u62f7\u8d1d\u6587\u4ef6\u5230\u6784\u5efa\u7684\u65b0\u955c\u50cf\u65f6\uff0c\u4f1a\u4ee5\u8fd9\u4e2a\u76ee\u5f55\u4f5c\u4e3a\u57fa\u7840\u76ee\u5f55\u3002\n\n\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c`docker build` \u4e5f\u4f1a\u4ece\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u5bfb\u627e\u540d\u4e3a Dockerfile \u7684\u6587\u4ef6\uff0c\u5c06\u5b83\u4f5c\u4e3a Dockerfile \u5185\u5bb9\u7684\u6765\u6e90\u3002\u5982\u679c\u6211\u4eec\u7684 Dockerfile \u6587\u4ef6\u8def\u5f84\u4e0d\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u6216\u8005\u6709\u53e6\u5916\u7684\u6587\u4ef6\u540d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `-f` \u9009\u9879\u5355\u72ec\u7ed9\u51fa Dockerfile \u6587\u4ef6\u7684\u8def\u5f84\u3002\n\n```\n$ sudo docker build -t webapp:latest -f ./webapp/a.Dockerfile ./webapp\n\n```\n\n\u5f53\u7136\uff0c\u5728\u6784\u5efa\u65f6\u6211\u4eec\u6700\u597d\u603b\u662f\u643a\u5e26\u4e0a `-t` \u9009\u9879\uff0c\u7528\u5b83\u6765\u6307\u5b9a\u65b0\u751f\u6210\u955c\u50cf\u7684\u540d\u79f0\u3002\n\n```\n$ sudo docker build -t webapp:latest ./webapp\n\n```\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u5173\u4e8e Dockerfile \u4ee5\u53ca\u5173\u4e8e\u5b83\u57fa\u672c\u4f7f\u7528\u65b9\u9762\u7684\u5185\u5bb9\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u5b9e\u8df5\u9898\uff1a\n\n> \u7f16\u5199\u4e00\u4e2a\u4f60\u81ea\u5df1\u7684\u7a0b\u5e8f\u7684 Dockerfile\uff0c\u5e76\u5c06\u5b83\u5171\u4eab\u7ed9\u6d4b\u8bd5\u548c\u8fd0\u7ef4\u4eba\u5458\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Dockerfile \u7684\u57fa\u672c\u4f7f\u7528\u8fd8\u6709\u7591\u95ee\uff0c\u6216\u8005\u6709\u66f4\u597d\u7684\u5b9e\u8df5\u89d2\u5ea6\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u64cd\u4f5c\u955c\u50cf\u901a\u8fc7_Dockerfile_\u521b\u5efa\u955c\u50cf.md", "create_date": "2020-02-18T21:18:38.961", "order": 12}}, {"model": "subject.chapter", "pk": 60, "fields": {"title": "\u57fa\u7840\u6982\u5ff5\uff1a\u4e86\u89e3 Docker \u7684\u6838\u5fc3\u7ec4\u6210", "topic": 3, "md5": "030254a1709abe837f59b4d8d4acc8ae", "md_body": "# \u4e86\u89e3 Docker \u7684\u6838\u5fc3\u7ec4\u6210\n\n\u5728\u638c\u63e1 Docker \u7684\u4e00\u4e9b\u80cc\u666f\u77e5\u8bc6\u540e\uff0c\u6211\u4eec\u8fd8\u4e0d\u5f97\u4e0d\u82b1\u8d39\u4e00\u8282\u7684\u7bc7\u5e45\u6765\u7b80\u5355\u4ecb\u7ecd\u6709\u5173 Docker \u6838\u5fc3\u7684\u4e00\u4e9b\u77e5\u8bc6\u3002\u5f53\u7136\uff0c\u5927\u5bb6\u4e0d\u8981\u89c9\u5f97\u6709\u201c\u6838\u5fc3\u201d\u8fd9\u7c7b\u7684\u8bcd\uff0c\u6211\u4eec\u5c31\u8981\u5728\u8fd9\u4e00\u8282\u4e2d\u6df1\u5165 Docker \u5e95\u5c42\u53bb\u8bb2\u89e3\u539f\u7406\u6027\u7684\u4e1c\u897f\uff0c\u66f4\u786e\u5207\u7684\u8bf4\u8fd9\u4e00\u8282\u66f4\u50cf\u4e00\u5f20\u8bcd\u6c47\u8868\uff0c\u5728\u638c\u63e1\u8fd9\u4e9b\u4e0e Docker \u7d27\u5bc6\u76f8\u5173\u7684\u8bcd\u6c47\u540e\uff0c\u5927\u5bb6\u53ef\u4ee5\u66f4\u597d\u7684\u7406\u89e3\u4e4b\u540e\u5c0f\u8282\u4e2d\u7684\u5185\u5bb9\u3002\n\n## \u56db\u5927\u7ec4\u6210\u5bf9\u8c61\n\n\u5728\u4e4b\u524d\u7684\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u63d0\u5230\u4e86 Docker \u5b9e\u73b0\u5bb9\u5668\u5f15\u64ce\u7684\u4e00\u4e9b\u6280\u672f\uff0c\u4f46\u90a3\u4e9b\u90fd\u662f\u4e00\u4e9b\u76f8\u5bf9\u5e95\u5c42\u7684\u539f\u7406\u5b9e\u73b0\uff0c\u5728 Docker \u5c06\u5b83\u4eec\u5c01\u88c5\u540e\uff0c\u6211\u4eec\u5e76\u4e0d\u4f1a\u76f4\u63a5\u64cd\u4f5c\u5b83\u4eec\u3002\u5728 Docker \u4e2d\uff0c\u53e6\u5916\u63d0\u4f9b\u51fa\u4e86\u4e00\u4e9b\u8f6f\u4ef6\u5c42\u9762\u7684\u6982\u5ff5\uff0c\u8fd9\u624d\u662f\u6211\u4eec\u64cd\u4f5c Docker \u6240\u9488\u5bf9\u7684\u5bf9\u8c61\u3002\n\n\u5728 Docker \u4f53\u7cfb\u91cc\uff0c\u6709\u56db\u4e2a\u5bf9\u8c61 ( Object ) \u662f\u6211\u4eec\u4e0d\u5f97\u4e0d\u8fdb\u884c\u4ecb\u7ecd\u7684\uff0c\u56e0\u4e3a\u51e0\u4e4e\u6240\u6709 Docker \u4ee5\u53ca\u5468\u8fb9\u751f\u6001\u7684\u529f\u80fd\uff0c\u90fd\u662f\u56f4\u7ed5\u7740\u5b83\u4eec\u6240\u5c55\u5f00\u7684\u3002\u5b83\u4eec\u5206\u522b\u662f\uff1a**\u955c\u50cf ( Image )**\u3001**\u5bb9\u5668 ( Container )**\u3001**\u7f51\u7edc ( Network )**\u3001**\u6570\u636e\u5377 ( Volume )**\u3002\n\n### \u955c\u50cf\n\n\u955c\u50cf ( Image ) \u8fd9\u4e2a\u6982\u5ff5\u76f8\u4fe1\u5927\u5bb6\u4e0d\u4f1a\u964c\u751f\uff0c\u56e0\u4e3a\u5b83\u662f\u5176\u4ed6\u865a\u62df\u5316\u6280\u672f ( \u7279\u522b\u662f\u865a\u62df\u673a ) \u4e2d\u5e38\u5e38\u88ab\u4f7f\u7528\u7684\u4e00\u4e2a\u6982\u5ff5\u3002\u6240\u8c13\u955c\u50cf\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u53ea\u8bfb\u7684\u6587\u4ef6\u5305\uff0c\u5176\u4e2d\u5305\u542b\u4e86**\u865a\u62df\u73af\u5883\u8fd0\u884c\u6700\u539f\u59cb\u6587\u4ef6\u7cfb\u7edf\u7684\u5185\u5bb9**\u3002\n\n\u5f53\u7136\uff0cDocker \u7684\u955c\u50cf\u4e0e\u865a\u62df\u673a\u4e2d\u7684\u955c\u50cf\u8fd8\u662f\u6709\u4e00\u5b9a\u533a\u522b\u7684\u3002\u9996\u5148\uff0c\u4e4b\u524d\u6211\u4eec\u8c08\u5230\u4e86 Docker \u4e2d\u7684\u4e00\u4e2a\u521b\u65b0\u662f\u5229\u7528\u4e86 AUFS \u4f5c\u4e3a\u5e95\u5c42\u6587\u4ef6\u7cfb\u7edf\u5b9e\u73b0\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0cDocker \u5b9e\u73b0\u4e86\u4e00\u79cd\u589e\u91cf\u5f0f\u7684\u955c\u50cf\u7ed3\u6784\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/7/165b29cad1a3dfae?w=1645&h=740&f=png&s=92371)\n\n\u6bcf\u6b21\u5bf9\u955c\u50cf\u5185\u5bb9\u7684\u4fee\u6539\uff0cDocker \u90fd\u4f1a\u5c06\u8fd9\u4e9b\u4fee\u6539\u94f8\u9020\u6210\u4e00\u4e2a\u955c\u50cf\u5c42\uff0c\u800c\u4e00\u4e2a\u955c\u50cf\u5176\u5b9e\u5c31\u662f\u7531\u5176\u4e0b\u5c42\u6240\u6709\u7684\u955c\u50cf\u5c42\u6240\u7ec4\u6210\u7684\u3002\u5f53\u7136\uff0c\u6bcf\u4e00\u4e2a\u955c\u50cf\u5c42\u5355\u72ec\u62ff\u51fa\u6765\uff0c\u4e0e\u5b83\u4e4b\u4e0b\u7684\u955c\u50cf\u5c42\u90fd\u53ef\u4ee5\u7ec4\u6210\u4e00\u4e2a\u955c\u50cf\u3002\n\n\u53e6\u5916\uff0c\u7531\u4e8e\u8fd9\u79cd\u7ed3\u6784\uff0cDocker \u7684\u955c\u50cf\u5b9e\u8d28\u4e0a\u662f\u65e0\u6cd5\u88ab\u4fee\u6539\u7684\uff0c\u56e0\u4e3a\u6240\u6709\u5bf9\u955c\u50cf\u7684\u4fee\u6539\u53ea\u4f1a\u4ea7\u751f\u65b0\u7684\u955c\u50cf\uff0c\u800c\u4e0d\u662f\u66f4\u65b0\u539f\u6709\u7684\u955c\u50cf\u3002\n\n### \u5bb9\u5668\n\n\u5bb9\u5668 ( Container ) \u5c31\u66f4\u597d\u7406\u89e3\u4e86\uff0c\u5728\u5bb9\u5668\u6280\u672f\u4e2d\uff0c\u5bb9\u5668\u5c31\u662f\u7528\u6765\u9694\u79bb\u865a\u62df\u73af\u5883\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u800c\u5728 Docker \u91cc\uff0c\u5b83\u4e5f\u88ab\u5f15\u7533\u4e3a\u9694\u79bb\u51fa\u6765\u7684\u865a\u62df\u73af\u5883\u3002\n\n\u5982\u679c\u628a\u955c\u50cf\u7406\u89e3\u4e3a\u7f16\u7a0b\u4e2d\u7684\u7c7b\uff0c\u90a3\u4e48\u5bb9\u5668\u5c31\u53ef\u4ee5\u7406\u89e3\u4e3a\u7c7b\u7684\u5b9e\u4f8b\u3002\u955c\u50cf\u5185\u5b58\u653e\u7684\u662f\u4e0d\u53ef\u53d8\u5316\u7684\u4e1c\u897f\uff0c\u5f53\u4ee5\u5b83\u4eec\u4e3a\u57fa\u7840\u7684\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u5bb9\u5668\u5185\u4e5f\u5c31\u6210\u4e3a\u4e86\u4e00\u4e2a\u201c\u6d3b\u201d\u7684\u7a7a\u95f4\u3002\n\n\u7528\u66f4\u5b98\u65b9\u7684\u5b9a\u4e49\uff0cDocker \u7684\u5bb9\u5668\u5e94\u8be5\u6709\u4e09\u9879\u5185\u5bb9\u7ec4\u6210\uff1a\n\n*   \u4e00\u4e2a Docker \u955c\u50cf\n*   \u4e00\u4e2a\u7a0b\u5e8f\u8fd0\u884c\u73af\u5883\n*   \u4e00\u4e2a\u6307\u4ee4\u96c6\u5408\n\n\u5173\u4e8e\u955c\u50cf\u4e0e\u5bb9\u5668\u7684\u66f4\u591a\u7ec6\u8282\u77e5\u8bc6\uff0c\u6211\u4eec\u5728\u540e\u9762\u7684\u5c0f\u8282\u4e2d\u8fd8\u4f1a\u5355\u72ec\u8fdb\u884c\u8bb2\u89e3\u3002\n\n### \u7f51\u7edc\n\n\u5bf9\u4e8e\u5927\u90e8\u5206\u7a0b\u5e8f\u6765\u8bf4\uff0c\u5b83\u4eec\u7684\u8fd0\u884c\u90fd\u4e0d\u4f1a\u662f\u5b64\u7acb\u7684\uff0c\u800c\u662f\u8981\u4e0e\u5916\u754c\u6216\u8005\u66f4\u51c6\u786e\u7684\u8bf4\u662f\u4e0e\u5176\u4ed6\u7a0b\u5e8f\u8fdb\u884c\u4ea4\u4e92\u7684\uff0c\u8fd9\u91cc\u7684\u4ea4\u4e92\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6307\u7684\u5c31\u662f\u6570\u636e\u4fe1\u606f\u7684\u4ea4\u6362\u3002\u7f51\u7edc\u901a\u8baf\u662f\u76ee\u524d\u6700\u5e38\u7528\u7684\u4e00\u79cd\u7a0b\u5e8f\u95f4\u7684\u6570\u636e\u4ea4\u6362\u65b9\u5f0f\u4e86\u3002\n\n\u7531\u4e8e\u8ba1\u7b97\u673a\u7f51\u7edc\u9886\u57df\u62e5\u6709\u76f8\u5bf9\u7edf\u4e00\u4e14\u72ec\u7acb\u7684\u534f\u8bae\u7b49\u7ea6\u5b9a\uff0c\u5176\u8de8\u5e73\u53f0\u6027\u975e\u5e38\u4f18\u79c0\uff0c\u6240\u6709\u7684\u5e94\u7528\u90fd\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u5728\u4e0d\u540c\u7684\u786c\u4ef6\u5e73\u53f0\u6216\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\u4e0a\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u3002\u7279\u522b\u662f\u5728\u5206\u5e03\u5f0f\u4e91\u8ba1\u7b97\u7684\u65f6\u4ee3\uff0c\u5e94\u7528\u6216\u670d\u52a1\u95f4\u7684\u901a\u8baf\u66f4\u662f\u5145\u5206\u4f9d\u8d56\u4e8e\u7f51\u7edc\u4f20\u8f93\uff0c\u6240\u4ee5\u81ea\u7136\u62e5\u6709\u4e00\u5957\u5b8c\u5584\u7684\u7f51\u7edc\u4f53\u7cfb\u652f\u6491\uff0c\u662f\u627f\u8f7d\u5e94\u7528\u8fd0\u884c\u6240\u5fc5\u987b\u7684\u57fa\u7840\u8bbe\u65bd\u3002\n\n\u5728 Docker \u4e2d\uff0c\u5b9e\u73b0\u4e86\u5f3a\u5927\u7684\u7f51\u7edc\u529f\u80fd\uff0c\u6211\u4eec\u4e0d\u4f46\u80fd\u591f\u5341\u5206\u8f7b\u677e\u7684\u5bf9\u6bcf\u4e2a\u5bb9\u5668\u7684\u7f51\u7edc\u8fdb\u884c\u914d\u7f6e\uff0c\u8fd8\u80fd\u5728\u5bb9\u5668\u95f4\u5efa\u7acb\u865a\u62df\u7f51\u7edc\uff0c\u5c06\u6570\u4e2a\u5bb9\u5668\u5305\u88f9\u5176\u4e2d\uff0c\u540c\u65f6\u4e0e\u5176\u4ed6\u7f51\u7edc\u73af\u5883\u9694\u79bb\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/5/165a810ad2c81714?w=1570&h=486&f=png&s=50933)\n\n\u53e6\u5916\uff0c\u5229\u7528\u4e00\u4e9b\u6280\u672f\uff0cDocker \u80fd\u591f\u5728\u5bb9\u5668\u4e2d\u8425\u9020\u72ec\u7acb\u7684\u57df\u540d\u89e3\u6790\u73af\u5883\uff0c\u8fd9\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u4ee3\u7801\u548c\u914d\u7f6e\u7684\u524d\u63d0\u4e0b\u76f4\u63a5\u8fc1\u79fb\u5bb9\u5668\uff0cDocker \u4f1a\u4e3a\u6211\u4eec\u5b8c\u6210\u65b0\u73af\u5883\u7684\u7f51\u7edc\u9002\u914d\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u751a\u81f3\u80fd\u591f\u5728\u4e0d\u540c\u7684\u7269\u7406\u670d\u52a1\u5668\u95f4\u5b9e\u73b0\uff0c\u8ba9\u5904\u5728\u4e24\u53f0\u7269\u7406\u673a\u4e0a\u7684\u4e24\u4e2a Docker \u6240\u63d0\u4f9b\u7684\u5bb9\u5668\uff0c\u52a0\u5165\u5230\u540c\u4e00\u4e2a\u865a\u62df\u7f51\u7edc\u4e2d\uff0c\u5f62\u6210\u5b8c\u5168\u5c4f\u853d\u786c\u4ef6\u7684\u6548\u679c\u3002\n\n\u6b63\u662f\u56e0\u4e3a\u62e5\u6709\u5f3a\u5927\u7684\u7f51\u7edc\u529f\u80fd\uff0c\u624d\u80fd\u8ba9\u6211\u4eec\u5236\u9020\u5065\u58ee\u7684 Docker \u5e94\u7528\u4f53\u7cfb\u3002\n\n### \u6570\u636e\u5377\n\n\u9664\u4e86\u7f51\u7edc\u4e4b\u5916\uff0c\u6587\u4ef6\u4e5f\u662f\u91cd\u8981\u7684\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u7684\u8d44\u6e90\u3002\u5728\u4ee5\u5f80\u7684\u865a\u62df\u673a\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u76f4\u63a5\u91c7\u7528\u865a\u62df\u673a\u7684\u6587\u4ef6\u7cfb\u7edf\u4f5c\u4e3a\u5e94\u7528\u6570\u636e\u7b49\u6587\u4ef6\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002\u7136\u800c\u8fd9\u79cd\u65b9\u5f0f\u5176\u5b9e\u5e76\u975e\u5b8c\u5168\u5b89\u5168\u7684\uff0c\u5f53\u865a\u62df\u673a\u6216\u8005\u5bb9\u5668\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u6587\u4ef6\u7cfb\u7edf\u65e0\u6cd5\u4f7f\u7528\u65f6\uff0c\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u5f88\u5feb\u7684\u901a\u8fc7\u955c\u50cf\u91cd\u7f6e\u6587\u4ef6\u7cfb\u7edf\u4f7f\u5f97\u5e94\u7528\u5feb\u901f\u6062\u590d\u8fd0\u884c\uff0c\u4f46\u662f\u4e4b\u524d\u5b58\u653e\u7684\u6570\u636e\u4e5f\u5c31\u6d88\u5931\u4e86\u3002\n\n\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u72ec\u7acb\u6027\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u5355\u72ec\u6302\u8f7d\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u6765\u5b58\u653e\u6570\u636e\u3002\u8fd9\u79cd\u64cd\u4f5c\u5728\u865a\u62df\u673a\u4e2d\u662f\u7e41\u7410\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u4e0d\u4f46\u8981\u641e\u5b9a\u6302\u8f7d\u5728\u4e0d\u540c\u5bbf\u4e3b\u673a\u4e2d\u5b9e\u73b0\u7684\u65b9\u6cd5\uff0c\u8fd8\u8981\u8003\u8651\u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf\u517c\u5bb9\u6027\uff0c\u865a\u62df\u64cd\u4f5c\u7cfb\u7edf\u914d\u7f6e\u7b49\u95ee\u9898\u3002\u503c\u5f97\u5e86\u5e78\u7684\u662f\uff0c\u8fd9\u4e9b\u5728 Docker \u91cc\u90fd\u5df2\u7ecf\u4e3a\u6211\u4eec\u8f7b\u677e\u7684\u5b9e\u73b0\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7b80\u5355\u7684\u4e00\u4e24\u4e2a\u547d\u4ee4\u6216\u53c2\u6570\uff0c\u5c31\u80fd\u5b8c\u6210\u6587\u4ef6\u7cfb\u7edf\u76ee\u5f55\u7684\u6302\u8f7d\u3002\n\n\u80fd\u591f\u8fd9\u4e48\u7b80\u5355\u7684\u5b9e\u73b0\u6302\u8f7d\uff0c\u4e3b\u8981\u8fd8\u662f\u5f97\u76ca\u4e8e Docker \u5e95\u5c42\u7684 Union File System \u6280\u672f\u3002\u5728 UnionFS \u7684\u52a0\u6301\u4e0b\uff0c\u9664\u4e86\u80fd\u591f\u4ece\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6302\u8f7d\u76ee\u5f55\u5916\uff0c\u8fd8\u80fd\u591f\u5efa\u7acb\u72ec\u7acb\u7684\u76ee\u5f55\u6301\u4e45\u5b58\u653e\u6570\u636e\uff0c\u6216\u8005\u5728\u5bb9\u5668\u95f4\u5171\u4eab\u3002\n\n\u5728 Docker \u4e2d\uff0c\u901a\u8fc7\u8fd9\u51e0\u79cd\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u5171\u4eab\u6216\u6301\u4e45\u5316\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u6211\u4eec\u90fd\u79f0\u4e3a\u6570\u636e\u5377 ( Volume )\u3002\n\n## Docker Engine\n\n\u65f6\u81f3\u4eca\u65e5\uff0cDocker \u751f\u6001\u5df2\u7ecf\u8fdc\u6bd4\u5b83\u8bde\u751f\u4e4b\u521d\u8981\u5e9e\u5927\u8bb8\u591a\uff0c\u867d\u7136\u6211\u4eec\u4ecd\u7136\u4e60\u60ef\u4f7f\u7528 Docker \u8fd9\u4e2a\u540d\u5b57\u53bb\u6307\u4ee3\u5b9e\u73b0\u5bb9\u5668\u6280\u672f\u652f\u6301\u7684\u8f6f\u4ef6\uff0c\u4f46\u663e\u7136\u66f4\u52a0\u5bb9\u6613\u4e0e\u5176\u4ed6\u7684\u6982\u5ff5\u4ea7\u751f\u6df7\u6dc6\u3002\u8fd9\u91cc\u6211\u4eec\u5f88\u6709\u5fc5\u8981\u5bf9\u8fd9\u4e2a Docker \u4e2d\u6700\u6838\u5fc3\u7684\u8f6f\u4ef6\u8fdb\u884c\u4ecb\u7ecd\uff0c\u4e0d\u4ec5\u56e0\u4e3a\u5b83\u5728 Docker \u751f\u6001\u4e2d\u626e\u6f14\u7740\u4e2d\u5fc3\u7684\u5730\u4f4d\uff0c\u4e5f\u56e0\u4e3a\u5b83\u662f\u6211\u4eec\u5728\u5f00\u53d1\u4e2d\u5b9e\u5b9e\u5728\u5728\u63a5\u89e6\u6700\u591a\u7684\u4e1c\u897f\u3002\n\n\u76ee\u524d\u8fd9\u6b3e\u5b9e\u73b0\u5bb9\u5668\u5316\u7684\u5de5\u5177\u662f\u7531 Docker \u5b98\u65b9\u8fdb\u884c\u7ef4\u62a4\u7684\uff0cDocker \u5b98\u65b9\u5c06\u5176\u547d\u540d\u4e3a **Docker Engine**\uff0c\u540c\u65f6\u5b9a\u4e49\u5176\u4e3a\u5de5\u4e1a\u7ea7\u7684\u5bb9\u5668\u5f15\u64ce ( Industry-standard Container Engine )\u3002\u5728 Docker Engine \u4e2d\uff0c\u5b9e\u73b0\u4e86 Docker \u6280\u672f\u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u5bb9\u5668\u5f15\u64ce\u8fd9\u4e00\u90e8\u5206\u3002\n\n### docker daemon \u548c docker CLI\n\n\u867d\u7136\u6211\u4eec\u8bf4 Docker Engine \u662f\u4e00\u6b3e\u8f6f\u4ef6\uff0c\u4f46\u5b9e\u5b9e\u5728\u5728\u53bb\u6df1\u7a76\u7684\u8bdd\uff0c\u5b83\u5176\u5b9e\u7b97\u662f\u7531\u591a\u4e2a\u72ec\u7acb\u8f6f\u4ef6\u6240\u7ec4\u6210\u7684\u8f6f\u4ef6\u5305\u3002\u5728\u8fd9\u4e9b\u7a0b\u5e8f\u4e2d\uff0c\u6700\u6838\u5fc3\u7684\u5c31\u662f **docker daemon** \u548c **docker CLI** \u8fd9\u4fe9\u4e86\u3002\n\n\u6240\u6709\u6211\u4eec\u901a\u5e38\u8ba4\u4e3a\u7684 Docker \u6240\u80fd\u63d0\u4f9b\u7684\u5bb9\u5668\u7ba1\u7406\u3001\u5e94\u7528\u7f16\u6392\u3001\u955c\u50cf\u5206\u53d1\u7b49\u529f\u80fd\uff0c\u90fd\u96c6\u4e2d\u5728\u4e86 docker daemon \u4e2d\uff0c\u800c\u6211\u4eec\u4e4b\u524d\u6240\u63d0\u5230\u7684\u955c\u50cf\u6a21\u5757\u3001\u5bb9\u5668\u6a21\u5757\u3001\u6570\u636e\u5377\u6a21\u5757\u548c\u7f51\u7edc\u6a21\u5757\u4e5f\u90fd\u5b9e\u73b0\u5728\u5176\u4e2d\u3002\u5728\u64cd\u4f5c\u7cfb\u7edf\u91cc\uff0cdocker daemon \u901a\u5e38\u4ee5\u670d\u52a1\u7684\u5f62\u5f0f\u8fd0\u884c\u4ee5\u4fbf\u9759\u9ed8\u7684\u63d0\u4f9b\u8fd9\u4e9b\u529f\u80fd\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u901a\u5e38\u79f0\u4e4b\u4e3a Docker \u670d\u52a1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/5/165a8349ffdb33e0?w=1385&h=530&f=png&s=60142)\n\n\u5728 docker daemon \u7ba1\u7406\u5bb9\u5668\u7b49\u76f8\u5173\u8d44\u6e90\u7684\u540c\u65f6\uff0c\u5b83\u4e5f\u5411\u5916\u66b4\u9732\u4e86\u4e00\u5957 RESTful API\uff0c\u6211\u4eec\u80fd\u591f\u901a\u8fc7\u8fd9\u5957\u63a5\u53e3\u5bf9 docker daemon \u8fdb\u884c\u64cd\u4f5c\u3002\u6216\u8005\u66f4\u786e\u5207\u7684\u8bf4\uff0c\u662f\u901a\u8fc7\u8fd9\u5957 RESTful API \u5bf9 docker daemon \u4e2d\u8fd0\u884c\u7684\u5bb9\u5668\u548c\u5176\u4ed6\u8d44\u6e90\u8fdb\u884c\u7ba1\u7406\u3002\n\n\u901a\u5e38\u6765\u8bf4\uff0c\u6211\u4eec\u662f\u91c7\u7528\u5728\u63a7\u5236\u53f0\u6216\u8005\u547d\u4ee4\u884c\u8f93\u5165\u547d\u4ee4\u6765\u63a7\u5236 docker daemon \u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u5f88\u9177\u4e5f\u66f4\u5bb9\u6613\u9002\u5e94\u90a3\u4e9b\u6709\u6216\u8005\u6ca1\u6709\u56fe\u5f62\u754c\u9762\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002\n\n\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u6211\u4eec\u5728\u63a7\u5236\u53f0\u4e2d\u7f16\u5199\u4e00\u4e2a HTTP \u8bf7\u6c42\u4ee5\u501f\u52a9 docker daemon \u63d0\u4f9b\u7684 RESTful API \u6765\u64cd\u63a7\u5b83\uff0c\u90a3\u663e\u7136\u662f\u4e2a\u8d39\u8111\u3001\u8d39\u624b\u53c8\u8d39\u65f6\u95f4\u7684\u6d3b\u513f\u3002\u6240\u4ee5\u5728 Docker Engine \u91cc\u8fd8\u76f4\u63a5\u9644\u5e26\u4e86 docker CLI \u8fd9\u4e2a\u63a7\u5236\u53f0\u7a0b\u5e8f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/5/165a834db42056c4?w=1502&h=503&f=png&s=37784)\n\n\u719f\u6089\u7a0b\u5e8f\u7ed3\u6784\u7684\u670b\u53cb\u4eec\u6bd4\u8f83\u5bb9\u6613\u770b\u51fa\u6765\uff0cdocker daemon \u548c docker CLI \u6240\u7ec4\u6210\u7684\uff0c\u6b63\u662f\u4e00\u4e2a\u6807\u51c6 C/S ( Client-Server ) \u7ed3\u6784\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u8854\u63a5\u8fd9\u4e24\u8005\u7684\uff0c\u6b63\u662f docker daemon \u6240\u63d0\u4f9b\u7684\u8fd9\u5957 RESTful API\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u8fd9\u8282\u4e2d\uff0c\u6211\u4eec\u4e86\u89e3\u4e86 Docker \u4e2d\u6838\u5fc3\u7684\u6982\u5ff5\uff0c\u8fd9\u4e9b\u57fa\u7840\u77e5\u8bc6\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u7406\u89e3\u4e4b\u540e\u6211\u4eec\u5bf9 Docker \u7684\u5b9e\u8df5\u5b66\u4e60\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> Docker \u7684\u56db\u5927\u6838\u5fc3\u6a21\u5757\u80cc\u540e\u5404\u7531\u54ea\u4e9b\u6280\u672f\u63d0\u4f9b\u652f\u6301\uff0c\u5b83\u4eec\u53c8\u5728 Docker \u5b9e\u73b0\u865a\u62df\u8fd0\u884c\u73af\u5883\u7684\u8fc7\u7a0b\u5404\u626e\u6f14\u4e86\u4ec0\u4e48\u6837\u7684\u89d2\u8272\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker \u7684\u6838\u5fc3\u6982\u5ff5\u4ee5\u53ca Docker Engine \u7684\u57fa\u7840\u77e5\u8bc6\u6709\u4ec0\u4e48\u4e0d\u7406\u89e3\u4e4b\u5904\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u57fa\u7840\u6982\u5ff5\u4e86\u89e3_Docker_\u7684\u6838\u5fc3\u7ec4\u6210.md", "create_date": "2020-02-18T21:18:38.964", "order": 3}}, {"model": "subject.chapter", "pk": 61, "fields": {"title": "\u64cd\u4f5c\u955c\u50cf\uff1a\u4f7f\u7528 Docker Hub \u4e2d\u7684\u955c\u50cf", "topic": 3, "md5": "c451b956ab5ff43cee74650d4b9d052b", "md_body": "# \u4f7f\u7528 Docker Hub \u4e2d\u7684\u955c\u50cf\n\n\u81ea\u5df1\u7f16\u5199 Dockerfile \u80fd\u591f\u5f88\u597d\u7684\u5b9e\u73b0\u6211\u4eec\u60f3\u8981\u7684\u7a0b\u5e8f\u8fd0\u884c\u73af\u5883\uff0c\u4e0d\u8fc7\u5982\u679c\u88c5\u6709\u6211\u4eec\u60f3\u8981\u73af\u5883\u7684\u955c\u50cf\u5df2\u7ecf\u7531\u70ed\u5fc3\u7684\u5f00\u53d1\u8005\u6784\u5efa\u597d\u5e76\u5171\u4eab\u5728 Docker Hub \u4e0a\uff0c\u76f4\u63a5\u4f7f\u7528\u5b83\u4eec\u5c31\u4f1a\u8fdc\u6bd4\u81ea\u5df1\u7f16\u5199 Dockerfile \u5e76\u8fdb\u884c\u6784\u5efa\u8981\u6765\u7684\u7b80\u5355\u7684\u591a\u4e86\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6211\u4eec\u7528\u5230\u7684\u955c\u50cf\u5927\u90e8\u5206\u8fd8\u662f\u76f4\u63a5\u91c7\u7528 Docker Hub \u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u955c\u50cf\u7684\uff0c\u5373\u4f7f\u81ea\u5df1\u7f16\u5199 Dockerfile\uff0c\u4e5f\u53ea\u662f\u5bf9\u5df2\u6709\u955c\u50cf\u8fdb\u884c\u7b80\u5355\u7684\u6539\u52a8\uff0c\u5f88\u5c11\u4f1a\u4ece\u96f6\u5f00\u59cb\u642d\u5efa\u955c\u50cf\u3002\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u8981\u6765\u770b\u770b\u5982\u4f55\u66f4\u597d\u5730\u4f7f\u7528 Docker Hub \u4e0a\u7531\u5176\u4ed6\u5f00\u53d1\u8005\u5171\u4eab\u7684\u955c\u50cf\u3002\n\n## \u9009\u62e9\u955c\u50cf\u4e0e\u7a0b\u5e8f\u7248\u672c\n\n\u7531\u4e8e Docker \u7684\u5bb9\u5668\u8bbe\u8ba1\u662f\u7a0b\u5e8f\u5373\u5bb9\u5668\u7684\uff0c\u6240\u4ee5\u7ec4\u6210\u6211\u4eec\u670d\u52a1\u7cfb\u7edf\u7684\u591a\u4e2a\u7a0b\u5e8f\u4e00\u822c\u4f1a\u642d\u5efa\u5728\u591a\u4e2a\u5bb9\u5668\u91cc\uff0c\u4e92\u76f8\u4e4b\u95f4\u534f\u4f5c\u63d0\u4f9b\u670d\u52a1\u3002\u4f8b\u5982\u4e00\u5957\u6700\u7b80\u5355\u7684 Web \u670d\u52a1\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9700\u8981 Java \u5bb9\u5668\u6765\u8fd0\u884c\u57fa\u4e8e Spring Boot \u7684\u7a0b\u5e8f\uff0c\u9700\u8981 MySQL \u5bb9\u5668\u6765\u63d0\u4f9b\u6570\u636e\u5e93\u652f\u6301\uff0c\u9700\u8981 Redis \u5bb9\u5668\u6765\u4f5c\u4e3a\u9ad8\u901f KV \u5b58\u50a8\u7b49\u7b49\u3002\u88c5\u6709\u8fd9\u4e9b\u7a0b\u5e8f\u7684\u955c\u50cf\u6211\u4eec\u90fd\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u5728 Docker Hub \u4e0a\u627e\u5230\u5e76\u76f4\u63a5\u4f7f\u7528\uff0c\u4f46\u5728\u6211\u4eec\u4f7f\u7528\u524d\uff0c\u5149\u9009\u62e9\u955c\u50cf\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u6211\u4eec\u8fd8\u5f97\u6839\u636e\u9700\u8981\u9009\u62e9\u5bf9\u5e94\u7a0b\u5e8f\u7248\u672c\u7684\u955c\u50cf\u3002\n\n\u867d\u7136\u6211\u4eec\u5e38\u628a\u8f6f\u4ef6\u7684\u7248\u672c\u653e\u5728 Tag \u91cc\u4f5c\u4e3a\u955c\u50cf\u540d\u7684\u4e00\u90e8\u5206\uff0c\u4f46\u5bf9\u4e8e\u4e00\u4e9b\u590d\u6742\u7684\u5e94\u7528\uff0c\u9664\u4e86\u7248\u672c\u5916\uff0c\u8fd8\u5b58\u5728\u5f88\u591a\u7684\u53d8\u91cf\uff0c\u955c\u50cf\u7684\u7ef4\u62a4\u8005\u4eec\u4e5f\u559c\u6b22\u5c06\u8fd9\u4e9b\u53d8\u91cf\u4e00\u540c\u7ec4\u5408\u5230\u955c\u50cf\u7684 Tag \u91cc\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u4f7f\u7528\u955c\u50cf\u524d\uff0c\u4e00\u5b9a\u8981\u5148\u4e86\u89e3\u4e0d\u540c Tag \u5bf9\u5e94\u7684\u4e0d\u540c\u5185\u5bb9\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u6765\u770b\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u662f\u7531 Docker \u5b98\u65b9\u63d0\u4f9b\u7684 OpenJDK \u955c\u50cf\u7684\u8bf4\u660e\u9875\u9762\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/166387eaadcb9fe1?w=816&h=762&f=png&s=65318)\n\n\u901a\u5e38\u6765\u8bf4\uff0c\u955c\u50cf\u7684\u7ef4\u62a4\u8005\u4f1a\u5728\u955c\u50cf\u4ecb\u7ecd\u4e2d\u5c55\u793a\u51fa\u955c\u50cf\u6240\u6709\u7684 Tag\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u4ece\u9875\u9762\u4e0a\u7684 Tags \u5bfc\u822a\u91cc\u8fdb\u5165\u5230\u955c\u50cf\u6807\u7b7e\u5217\u8868\u9875\u9762\u3002\n\n\u5728 OpenJDK \u955c\u50cf\u7684 Tag \u5217\u8868\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u540c\u6837\u7248\u672c\u53f7\u7684\u955c\u50cf\u5c31\u5b58\u5728\u591a\u79cd\u6807\u7b7e\u3002\u5728\u8fd9\u4e9b\u4e0d\u540c\u7684\u6807\u7b7e\u4e0a\uff0c\u9664\u4e86\u5b9a\u4e49 OpenJDK \u7684\u7248\u672c\uff0c\u8fd8\u6709\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8f6f\u4ef6\u63d0\u4f9b\u8005\u7b49\u4fe1\u606f\u3002\n\n\u955c\u50cf\u7ef4\u62a4\u8005\u4e3a\u6211\u4eec\u63d0\u4f9b\u8fd9\u4e48\u591a\u7684\u6807\u7b7e\u8fdb\u884c\u9009\u62e9\uff0c\u5176\u5b9e\u65b9\u4fbf\u4e86\u6211\u4eec\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u9009\u62e9\u4e0d\u540c\u73af\u5883\u5b9e\u73b0\u7ec6\u8282\u65f6\uff0c\u90fd\u80fd\u76f4\u63a5\u7528\u5230\u8fd9\u4e2a\u955c\u50cf\uff0c\u800c\u4e0d\u9700\u8981\u518d\u5355\u72ec\u7f16\u5199 Dockerfile \u5e76\u6784\u5efa\u3002\n\n\u4f46\u662f\u6362\u53e5\u8bdd\u8bf4\uff0c\u6b63\u662f\u6709\u8fd9\u4e48\u591a\u4e0d\u540c\u6807\u7b7e\u7684\u955c\u50cf\u5b58\u5728\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u9009\u62e9\u7684\u65f6\u5019\uff0c\u66f4\u8981\u4ed4\u7ec6\u8ba4\u771f\uff0c\u627e\u5230\u6211\u4eec\u60f3\u8981\u7684\u90a3\u4e2a\u955c\u50cf\u3002\n\n### Alpine \u955c\u50cf\n\n\u5982\u679c\u5927\u5bb6\u591a\u63a5\u89e6\u51e0\u4e2a\u955c\u50cf\uff0c\u5c31\u4f1a\u53d1\u73b0\u5e26\u6709 Alpine \u7684\u7248\u672c\u662f\u8bb8\u591a\u955c\u50cf\u4e2d\u90fd\u5e38\u89c1\u7684\u6807\u7b7e\u3002\u5e26\u6709 Alpine \u6807\u7b7e\u7684\u955c\u50cf\u5230\u5e95\u662f\u4ec0\u4e48\u6837\u7684\u5b58\u5728\u5462\uff1f\u5b83\u4e0e\u76f8\u540c\u8f6f\u4ef6\u4e0d\u540c\u6807\u7b7e\u7684\u955c\u50cf\u53c8\u6709\u4ec0\u4e48\u6837\u7684\u533a\u522b\u5462\uff1f\n\n\u955c\u50cf\u6807\u7b7e\u4e2d\u7684 Alpine \u5176\u5b9e\u6307\u7684\u662f\u8fd9\u4e2a\u955c\u50cf\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\u5185\u5bb9\uff0c\u662f\u57fa\u4e8e Alpine Linux \u8fd9\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u3002Alpine Linux \u662f\u4e00\u4e2a\u76f8\u5f53\u7cbe\u7b80\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u800c\u57fa\u4e8e\u5b83\u7684 Docker \u955c\u50cf\u53ef\u4ee5\u4ec5\u6709\u6570 MB \u7684\u5c3a\u5bf8\u3002\u5982\u679c\u8f6f\u4ef6\u57fa\u4e8e\u8fd9\u6837\u7684\u7cfb\u7edf\u955c\u50cf\u4e4b\u4e0a\u6784\u5efa\u800c\u5f97\uff0c\u53ef\u4ee5\u60f3\u8c61\u65b0\u7684\u955c\u50cf\u4e5f\u662f\u5341\u5206\u5c0f\u5de7\u7684\u3002\n\n\u5728 Docker \u91cc\uff0cAlpine \u7cfb\u7edf\u7684\u955c\u50cf\u5230\u5e95\u6709\u591a\u5c0f\uff0c\u6211\u4eec\u4e0d\u59a8\u6765\u4e0e\u5176\u4ed6\u7cfb\u7edf\u955c\u50cf\u505a\u4e00\u4e2a\u6bd4\u8f83\u3002\n\n\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\n\n\u5360\u7528\u7a7a\u95f4\n\nalpine:latest\n\n4.4 MB\n\nubuntu:latest\n\n84.1 MB\n\ndebian:latest\n\n101 MB\n\ncentos:latest\n\n200 MB\n\n\u53ef\u4ee5\u770b\u5230\uff0cAlpine \u7cfb\u7edf\u955c\u50cf\u7684\u5c3a\u5bf8\u8981\u8fdc\u5c0f\u4e8e\u5176\u4ed6\u5e38\u89c1\u7684\u7cfb\u7edf\u955c\u50cf\u3002\u8ba9\u6211\u4eec\u518d\u6765\u6bd4\u8f83\u540c\u4e00\u4e2a\u8f6f\u4ef6\u5728\u57fa\u4e8e\u666e\u901a\u7cfb\u7edf\u7684\u955c\u50cf\u548c\u57fa\u4e8e Alpine \u7cfb\u7edf\u7684\u955c\u50cf\u540e\u5c3a\u5bf8\u4e0a\u7684\u533a\u522b\u3002\n\n\u955c\u50cf\u6807\u7b7e\n\n\u5360\u7528\u7a7a\u95f4\n\npython:3.6-alpine\n\n74.2 MB\n\npython:3.6-jessie\n\n697 MB\n\n\u7531\u4e8e\u57fa\u4e8e Alpine \u7cfb\u7edf\u5efa\u7acb\u7684\u8f6f\u4ef6\u955c\u50cf\u8fdc\u8fdc\u5c0f\u4e8e\u57fa\u4e8e\u5176\u4ed6\u7cfb\u7edf\u7684\u8f6f\u4ef6\u955c\u50cf\uff0c\u5b83\u5728\u7f51\u7edc\u4f20\u8f93\u4e0a\u7684\u4f18\u52bf\u5c24\u4e3a\u660e\u663e\u3002\u5982\u679c\u6211\u4eec\u9009\u62e9\u8fd9\u7c7b\u7684\u955c\u50cf\uff0c\u4e0d\u4f46\u53ef\u4ee5\u8282\u7ea6\u7f51\u7edc\u4f20\u8f93\u7684\u65f6\u95f4\uff0c\u4e5f\u80fd\u51cf\u5c11\u955c\u50cf\u5bf9\u786c\u76d8\u7a7a\u95f4\u7684\u5360\u7528\u3002\n\n\u5f53\u7136\uff0c\u6709\u4f18\u70b9\u4e5f\u4f1a\u6709\u7f3a\u70b9\uff0cAlpine \u955c\u50cf\u7684\u7f3a\u70b9\u5c31\u5728\u4e8e\u5b83\u5b9e\u5728\u8fc7\u4e8e\u7cbe\u7b80\uff0c\u4ee5\u81f3\u4e8e\u9ebb\u96c0\u867d\u5c0f\uff0c\u4e5f\u65e0\u6cd5\u505a\u5230\u4e94\u810f\u4ff1\u5168\u4e86\u3002\u5728 Alpine \u4e2d\u7f3a\u5c11\u5f88\u591a\u5e38\u89c1\u7684\u5de5\u5177\u548c\u7c7b\u5e93\uff0c\u4ee5\u81f3\u4e8e\u5982\u679c\u6211\u4eec\u60f3\u57fa\u4e8e\u8f6f\u4ef6 Alpine \u6807\u7b7e\u7684\u955c\u50cf\u8fdb\u884c\u4e8c\u6b21\u6784\u5efa\uff0c\u90a3\u642d\u5efa\u7684\u8fc7\u7a0b\u4f1a\u76f8\u5f53\u70e6\u7410\u3002\u6240\u4ee5\u5982\u679c\u4f60\u60f3\u8981\u5bf9\u8f6f\u4ef6\u955c\u50cf\u8fdb\u884c\u6539\u9020\uff0c\u5e76\u57fa\u4e8e\u5176\u6784\u5efa\u65b0\u7684\u955c\u50cf\uff0c\u90a3\u4e48 Alpine \u955c\u50cf\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9 (\u8fd9\u65f6\u5019\u6211\u4eec\u66f4\u63d0\u5021\u57fa\u4e8e Ubuntu\u3001Debian\u3001CentOS \u8fd9\u7c7b\u76f8\u5bf9\u5b8c\u6574\u7684\u7cfb\u7edf\u955c\u50cf\u6765\u6784\u5efa)\u3002\n\n## \u5bf9\u5bb9\u5668\u8fdb\u884c\u914d\u7f6e\n\n\u9664\u4e86\u5408\u7406\u9009\u62e9\u955c\u50cf\u5916\uff0c\u8bb8\u591a\u955c\u50cf\u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u66f4\u52a0\u65b9\u4fbf\u7684\u529f\u80fd\uff0c\u8fd9\u4e9b\u7ec6\u8282\u6211\u4eec\u901a\u5e38\u90fd\u53ef\u4ee5\u5728\u955c\u50cf\u7684\u8be6\u60c5\u91cc\u9605\u8bfb\u5230\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u4ee5 MySQL \u4e3a\u4f8b\uff0c\u770b\u770b\u901a\u5e38\u6211\u4eec\u662f\u600e\u6837\u9605\u8bfb\u548c\u4f7f\u7528\u955c\u50cf\u7684\u7279\u6b8a\u529f\u80fd\u7684\u3002\n\n\u81ea\u5df1\u5b89\u88c5\u8fc7 MySQL \u7684\u670b\u53cb\u4e00\u5b9a\u77e5\u9053\uff0c\u642d\u5efa MySQL \u6700\u9ebb\u70e6\u7684\u5730\u65b9\u5e76\u4e0d\u662f\u5b89\u88c5\u7684\u8fc7\u7a0b\uff0c\u800c\u662f\u5b89\u88c5\u540e\u8fdb\u884c\u521d\u59cb\u5316\u914d\u7f6e\u7684\u8fc7\u7a0b\u3002\u5c31\u62ff\u66f4\u6539 root \u8d26\u53f7\u7684\u5bc6\u7801\u6765\u8bf4\uff0c\u5728\u521d\u59cb\u7684 MySQL \u91cc\u5c31\u8981\u8017\u8d39\u4e0d\u5c11\u5de5\u4f5c\u91cf\u3002\n\n\u5982\u679c\u6211\u4eec\u62ff\u5230\u4e00\u4e2a MySQL \u955c\u50cf\uff0c\u8fd0\u884c\u8d77\u6765\u7684 MySQL \u4e5f\u5c31\u7ea6\u7b49\u4e8e\u4e00\u4e2a\u521a\u521a\u5b89\u88c5\u597d\u7684\u7a0b\u5e8f\uff0c\u9762\u4e34\u7684\u6b63\u597d\u662f\u590d\u6742\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u3002\n\n\u597d\u5728 MySQL \u955c\u50cf\u7684\u7ef4\u62a4\u8005\u4eec\u4e3a\u6211\u4eec\u6253\u9020\u4e86\u4e00\u4e9b\u81ea\u52a8\u5316\u811a\u672c\uff0c\u901a\u8fc7\u5b83\u4eec\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7b80\u5355\u7684\u4f20\u5165\u51e0\u4e2a\u53c2\u6570\uff0c\u5c31\u80fd\u591f\u5feb\u901f\u5b9e\u73b0\u5bf9 MySQL \u6570\u636e\u5e93\u7684\u521d\u59cb\u5316\u3002\n\n\u5728 MySQL \u955c\u50cf\u7684\u8be6\u60c5\u91cc\uff0c\u63cf\u8ff0\u4e86\u6211\u4eec\u8981\u5982\u4f55\u4f20\u5165\u8fd9\u4e9b\u53c2\u6570\u6765\u542f\u52a8 MySQL \u5bb9\u5668\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/16639074fdc48422?w=816&h=762&f=png&s=97212)\n\n\u5bf9\u4e8e MySQL \u955c\u50cf\u6765\u8bf4\uff0c\u8fdb\u884c\u8f6f\u4ef6\u914d\u7f6e\u7684\u65b9\u6cd5\u662f\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684 ( \u5728\u5176\u4ed6\u7684\u955c\u50cf\u91cc\uff0c\u8fd8\u6709\u901a\u8fc7\u542f\u52a8\u547d\u4ee4\u3001\u6302\u8f7d\u7b49\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684 )\u3002\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u8fd9\u4e9b\u7ed9\u51fa\u7684\u73af\u5883\u53d8\u91cf\uff0c\u5c31\u53ef\u4ee5\u521d\u59cb\u5316 MySQL \u7684\u914d\u7f6e\u4e86\u3002\n\n\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u76f4\u63a5\u5efa\u7acb MySQL \u4e2d\u7684\u7528\u6237\u548c\u6570\u636e\u5e93\u3002\n\n```\n$ sudo docker run --name mysql -e MYSQL_DATABASE=webapp -e MYSQL_USER=www -e MYSQL_PASSWORD=my-secret-pw -d mysql:5.7\n\n```\n\n\u901a\u8fc7\u8fd9\u6761\u547d\u4ee4\u542f\u52a8\u7684 MySQL \u5bb9\u5668\uff0c\u5728\u5185\u90e8\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\u7528\u6237\u7684\u521b\u5efa\u548c\u6570\u636e\u5e93\u7684\u521b\u5efa\uff0c\u6211\u4eec\u901a\u8fc7 MySQL \u5ba2\u6237\u7aef\u5c31\u80fd\u591f\u76f4\u63a5\u767b\u5f55\u8fd9\u4e2a\u7528\u6237\u548c\u8bbf\u95ee\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u4e86\u3002\n\n\u5982\u679c\u6df1\u7a76 MySQL \u662f\u5982\u4f55\u5b9e\u73b0\u8fd9\u6837\u590d\u6742\u7684\u529f\u80fd\u7684\uff0c\u5927\u5bb6\u53ef\u4ee5\u5230 MySQL \u955c\u50cf\u7684 Dockerfile \u6e90\u7801\u5e93\u91cc\uff0c\u627e\u5230 [docker-entrypoint.sh](https://github.com/docker-library/mysql/blob/master/5.7/docker-entrypoint.sh) \u8fd9\u4e2a\u811a\u672c\uff0c\u6240\u6709\u7684\u79d8\u5bc6\u6b63\u6697\u85cf\u5728\u5176\u4e2d\u3002MySQL \u6b63\u662f\u5229\u7528\u4e86 ENTRYPOINT \u6307\u4ee4\u8fdb\u884c\u521d\u59cb\u5316\u8fd9\u79cd\u4efb\u52a1\u5b89\u6392\uff0c\u5bf9\u5bb9\u5668\u4e2d\u7684 MySQL \u8fdb\u884c\u521d\u59cb\u5316\u7684\u3002\n\n\u901a\u8fc7 MySQL \u955c\u50cf\u8fd9\u6837\u7684\u903b\u8f91\uff0c\u5927\u5bb6\u8fd8\u53ef\u4ee5\u4e3e\u4e00\u53cd\u4e09\uff0c\u4e86\u89e3\u5176\u4ed6\u955c\u50cf\u6240\u7279\u7528\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u751a\u81f3\u53ef\u4ee5\u53c2\u8003\u7f16\u5199\u3001\u6784\u5efa\u4e00\u4e9b\u80fd\u591f\u63d0\u4f9b\u8fd9\u7c7b\u65b9\u6cd5\u7684 Dockerfile \u548c\u955c\u50cf\u3002\n\n## \u5171\u4eab\u81ea\u5df1\u7684\u955c\u50cf\n\n\u5982\u679c\u6211\u4eec\u5e0c\u671b\u5c06\u6211\u4eec\u955c\u50cf\u516c\u5f00\u7ed9\u7f51\u7edc\u4e0a\u7684\u5f00\u53d1\u8005\u4eec\uff0c\u90a3\u901a\u8fc7 Docker Hub \u65e0\u7591\u662f\u6700\u4f73\u7684\u65b9\u5f0f\u3002\n\n\u8981\u5728 Docker Hub \u4e0a\u5171\u4eab\u955c\u50cf\uff0c\u6211\u4eec\u5fc5\u987b\u6709\u4e00\u4e2a Docker Hub \u7684\u8d26\u53f7\uff0c\u8fd9\u81ea\u4e0d\u5fc5\u8bf4\u4e86\u3002\u5728\u767b\u5f55\u5230\u6211\u4eec\u8d26\u53f7\u7684\u63a7\u5236\u9762\u677f\u540e\uff0c\u6211\u4eec\u80fd\u591f\u627e\u5230\u521b\u5efa\u7684\u6309\u94ae\uff0c\u5728\u8fd9\u91cc\u9009\u62e9 `Create Automated Build` ( \u521b\u5efa\u81ea\u52a8\u6784\u5efa )\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/16638f7a60c3c8a9?w=916&h=558&f=png&s=69134)\n\n\u81ea\u52a8\u6784\u5efa\u955c\u50cf\u662f Docker Hub \u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u4e00\u5957\u955c\u50cf\u6784\u5efa\u670d\u52a1\uff0c\u6211\u4eec\u53ea\u9700\u8981\u63d0\u4f9b Dockerfile \u548c\u76f8\u5173\u7684\u57fa\u672c\u6587\u4ef6\uff0cDocker Hub \u5c31\u80fd\u591f\u5728\u4e91\u7aef\u81ea\u52a8\u5c06\u5b83\u4eec\u6784\u5efa\u6210\u955c\u50cf\uff0c\u4e4b\u540e\u4fbf\u53ef\u4ee5\u8ba9\u5176\u4ed6\u5f00\u53d1\u8005\u901a\u8fc7 `docker pull` \u547d\u4ee4\u62c9\u53d6\u5230\u8fd9\u4e00\u955c\u50cf\u3002\n\n\u81ea\u52a8\u6784\u5efa\u8ba9\u4e0d\u9700\u8981\u6211\u4eec\u518d\u7528\u672c\u673a\u8fdb\u884c\u955c\u50cf\u7684\u6784\u5efa\uff0c\u65e2\u80fd\u8282\u7ea6\u65f6\u95f4\uff0c\u53c8\u80fd\u4eab\u53d7\u9ad8\u901f\u7684\u4e91\u7aef\u673a\u5668\u6784\u5efa\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/16638fbdcfee0b77?w=2558&h=918&f=png&s=89388)\n\n\u5728 Docker Hub \u4e2d\u5e76\u4e0d\u76f4\u63a5\u5b58\u653e\u6211\u4eec\u7528\u4e8e\u6784\u5efa\u7684 Dockerfile \u548c\u76f8\u5173\u6587\u4ef6\uff0c\u6211\u4eec\u5fc5\u987b\u5c06 Docker Hub \u8d26\u53f7\u6388\u6743\u5230 GitHub \u6216\u662f Bitbucket \u6765\u4ece\u8fd9\u4e9b\u4ee3\u7801\u5e93\u4e2d\u83b7\u53d6 Dockerfile \u548c\u76f8\u5173\u6587\u4ef6\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/16638fbc9c1ac1c2?w=2558&h=708&f=png&s=79510)\n\n\u5728\u8fde\u63a5\u5230 GitHub \u6216 Bitbucket \u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u9009\u62e9\u6211\u4eec\u5b58\u653e Dockerfile \u548c\u76f8\u5173\u6587\u4ef6\u7684\u4ee3\u7801\u4ed3\u5e93\u7528\u6765\u521b\u5efa\u81ea\u52a8\u6784\u5efa\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/16638fbbd4f6d20a?w=1934&h=1034&f=png&s=96802)\n\n\u5728\u57fa\u672c\u4fe1\u606f\u586b\u5199\u5b8c\u6210\uff0c\u70b9\u51fb\u521b\u5efa\u6309\u94ae\u540e\uff0cDocker Hub \u5c31\u4f1a\u5f00\u59cb\u6839\u636e\u6211\u4eec Dockerfile \u7684\u5185\u5bb9\u6784\u5efa\u955c\u50cf\u4e86\u3002\u800c\u6b64\u65f6\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u8bbf\u95ee\u6211\u4eec\u955c\u50cf\u4e13\u6709\u7684\u8be6\u60c5\u9875\u9762\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/16638fb9fa6cd7f7?w=2554&h=952&f=png&s=137319)\n\n\u5728 Build Details \u9875\u9762\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u955c\u50cf\u6784\u5efa\u7684\u8fdb\u5ea6\u548c\u8be6\u7ec6\u7684\u6784\u5efa\u60c5\u51b5\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u5982\u4f55\u638c\u63e1\u5bf9 Docker Hub \u4e2d\u4e0d\u540c\u955c\u50cf\u7684\u4f7f\u7528\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> \u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u4f7f\u7528\u7f51\u7edc\u4e2d\u7531\u4ed6\u4eba\u5171\u4eab\u7684 Docker \u955c\u50cf\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u54ea\u4e9b\u5185\u5bb9\u5feb\u901f\u4e86\u89e3\u8fd9\u4e9b\u955c\u50cf\u7684\u4f7f\u7528\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u4f7f\u7528 Docker Hub \u7531\u5176\u4ed6\u7f51\u53cb\u63d0\u4f9b\u7684\u955c\u50cf\u8fd8\u6709\u4ec0\u4e48\u4e0d\u89e3\u4e4b\u5904\uff0c\u6216\u8005\u6709\u5177\u4f53\u7684\u65b9\u6cd5\u60f3\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u64cd\u4f5c\u955c\u50cf\u4f7f\u7528_Docker_Hub_\u4e2d\u7684\u955c\u50cf.md", "create_date": "2020-02-18T21:18:38.983", "order": 14}}, {"model": "subject.chapter", "pk": 62, "fields": {"title": "\u64cd\u4f5c\u955c\u50cf\uff1a\u4fdd\u5b58\u548c\u5171\u4eab\u955c\u50cf", "topic": 3, "md5": "5ba31c97110605e0a95e3cd2d973ba31", "md_body": "# \u4fdd\u5b58\u548c\u5171\u4eab\u955c\u50cf\n\n\u8ba9 Docker \u5f15\u4ee5\u4e3a\u50b2\u7684\u662f\u5b83\u80fd\u591f\u5b9e\u73b0\u76f8\u6bd4\u4e8e\u5176\u4ed6\u865a\u62df\u5316\u8f6f\u4ef6\u66f4\u5feb\u7684\u73af\u5883\u8fc1\u79fb\u548c\u90e8\u7f72\uff0c\u5728\u8fd9\u4ef6\u4e8b\u60c5\u4e0a\uff0c\u8f7b\u91cf\u7ea7\u7684\u5bb9\u5668\u548c\u955c\u50cf\u7ed3\u6784\u7684\u8bbe\u8ba1\u65e0\u7591\u53d1\u6325\u4e86\u5de8\u5927\u7684\u4f5c\u7528\u3002\u901a\u8fc7\u5c06\u5bb9\u5668\u6253\u5305\u6210\u955c\u50cf\uff0c\u518d\u5229\u7528\u4f53\u79ef\u8fdc\u5c0f\u4e8e\u5176\u4ed6\u865a\u62df\u5316\u8f6f\u4ef6\u7684 Docker \u955c\u50cf\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u5feb\u7684\u5c06\u5b83\u4eec\u590d\u5236\u5230\u5176\u4ed6\u7684\u673a\u5668\u4e0a\u3002\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u4e13\u95e8\u6765\u8c08\u8c08\u5982\u4f55\u8fdb\u884c\u8fd9\u6837\u7684\u8fc1\u79fb\u3002\n\n## \u63d0\u4ea4\u5bb9\u5668\u66f4\u6539\n\n\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u4e86\uff0cDocker \u955c\u50cf\u7684\u672c\u8d28\u662f\u591a\u4e2a\u57fa\u4e8e UnionFS \u7684\u955c\u50cf\u5c42\u4f9d\u6b21\u6302\u8f7d\u7684\u7ed3\u679c\uff0c\u800c\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u5219\u662f\u5728\u4ee5\u53ea\u8bfb\u65b9\u5f0f\u6302\u8f7d\u955c\u50cf\u540e\u589e\u52a0\u7684\u4e00\u4e2a\u53ef\u8bfb\u53ef\u5199\u7684\u6c99\u76d2\u73af\u5883\u3002\n\n\u57fa\u4e8e\u8fd9\u6837\u7684\u7ed3\u6784\uff0cDocker \u4e2d\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5c06\u5bb9\u5668\u4e2d\u7684\u8fd9\u4e2a\u53ef\u8bfb\u53ef\u5199\u7684\u6c99\u76d2\u73af\u5883\u6301\u4e45\u5316\u4e3a\u4e00\u4e2a\u955c\u50cf\u5c42\u7684\u65b9\u6cd5\u3002\u66f4\u6d45\u663e\u7684\u8bf4\uff0c\u5c31\u662f\u6211\u4eec\u80fd\u591f\u5f88\u8f7b\u677e\u7684\u5728 Docker \u91cc\u5c06\u5bb9\u5668\u5185\u7684\u4fee\u6539\u8bb0\u5f55\u4e0b\u6765\uff0c\u4fdd\u5b58\u4e3a\u4e00\u4e2a\u65b0\u7684\u955c\u50cf\u3002\n\n\u5c06\u5bb9\u5668\u4fee\u6539\u7684\u5185\u5bb9\u4fdd\u5b58\u4e3a\u955c\u50cf\u7684\u547d\u4ee4\u662f `docker commit`\uff0c\u7531\u4e8e\u955c\u50cf\u7684\u7ed3\u6784\u5f88\u50cf\u4ee3\u7801\u4ed3\u5e93\u91cc\u7684\u4fee\u6539\u8bb0\u5f55\uff0c\u800c\u8bb0\u5f55\u5bb9\u5668\u4fee\u6539\u7684\u8fc7\u7a0b\u53c8\u50cf\u662f\u5728\u63d0\u4ea4\u4ee3\u7801\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u66f4\u5f62\u8c61\u7684\u79f0\u4e4b\u4e3a\u63d0\u4ea4\u5bb9\u5668\u7684\u66f4\u6539\u3002\n\n```\n$ sudo docker commit webapp\nsha256:0bc42f7ff218029c6c4199ab5c75ab83aeaaed3b5c731f715a3e807dda61d19e\n\n```\n\nDocker \u6267\u884c\u5c06\u5bb9\u5668\u5185\u6c99\u76d2\u6587\u4ef6\u7cfb\u7edf\u8bb0\u5f55\u6210\u955c\u50cf\u5c42\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u6682\u505c\u5bb9\u5668\u7684\u8fd0\u884c\uff0c\u4ee5\u4fdd\u8bc1\u5bb9\u5668\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\u5904\u4e8e\u4e00\u4e2a\u76f8\u5bf9\u7a33\u5b9a\u7684\u72b6\u6001\uff0c\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\n\n\u5728\u4f7f\u7528 `docker commit` \u63d0\u4ea4\u955c\u50cf\u66f4\u65b0\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 Docker \u521b\u5efa\u7684\u65b0\u955c\u50cf\u7684 ID\uff0c\u4e4b\u540e\u6211\u4eec\u4e5f\u80fd\u591f\u4ece\u672c\u5730\u955c\u50cf\u5217\u8868\u4e2d\u627e\u5230\u5b83\u3002\n\n```\n$ sudo docker images\nREPOSITORY            TAG                 IMAGE ID            CREATED             SIZE\n<none>                <none>              0bc42f7ff218        3 seconds ago       372MB\n## ......\n\n```\n\n\u50cf\u901a\u8fc7 Git \u7b49\u4ee3\u7801\u4ed3\u5e93\u8f6f\u4ef6\u63d0\u4ea4\u4ee3\u7801\u4e00\u6837\uff0c\u6211\u4eec\u8fd8\u80fd\u5728\u63d0\u4ea4\u5bb9\u5668\u66f4\u6539\u7684\u65f6\u5019\u7ed9\u51fa\u4e00\u4e2a\u63d0\u4ea4\u4fe1\u606f\uff0c\u65b9\u4fbf\u4ee5\u540e\u67e5\u8be2\u3002\n\n```\n$ sudo docker commit -m \"Configured\" webapp\n\n```\n\n### \u4e3a\u955c\u50cf\u547d\u540d\n\n\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u53d1\u73b0\u63d0\u4ea4\u5bb9\u5668\u66f4\u65b0\u540e\u4ea7\u751f\u7684\u955c\u50cf\u5e76\u6ca1 REPOSITORY \u548c TAG \u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u65b0\u7684\u955c\u50cf\u8fd8\u6ca1\u6709\u540d\u5b57\u3002\n\n\u4e4b\u524d\u6211\u4eec\u8c08\u5230\u8fc7\uff0c\u4f7f\u7528\u6ca1\u6709\u540d\u5b57\u7684\u955c\u50cf\u5e76\u4e0d\u662f\u5f88\u597d\u7684\u9009\u62e9\uff0c\u56e0\u4e3a\u6211\u4eec\u65e0\u6cd5\u76f4\u89c2\u7684\u770b\u5230\u6211\u4eec\u6b63\u5728\u4f7f\u7528\u4ec0\u4e48\u3002\u597d\u5728 Docker \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e3a\u955c\u50cf\u53d6\u540d\u7684\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f `docker tag` \u547d\u4ee4\u3002\n\n```\n$ sudo docker tag 0bc42f7ff218 webapp:1.0\n\n```\n\n\u4f7f\u7528 `docker tag` \u80fd\u591f\u4e3a\u672a\u547d\u540d\u7684\u955c\u50cf\u6307\u5b9a\u955c\u50cf\u540d\uff0c\u4e5f\u80fd\u591f\u5bf9\u5df2\u6709\u7684\u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u547d\u540d\u3002\n\n```\n$ sudo docker tag webapp:1.0 webapp:latest\n\n```\n\n\u5f53\u6211\u4eec\u5bf9\u672a\u547d\u540d\u7684\u955c\u50cf\u8fdb\u884c\u547d\u540d\u540e\uff0cDocker \u5c31\u4e0d\u4f1a\u5728\u955c\u50cf\u5217\u8868\u91cc\u7ee7\u7eed\u663e\u793a\u8fd9\u4e2a\u955c\u50cf\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u6211\u4eec\u65b0\u7684\u547d\u540d\u3002\u800c\u5982\u679c\u6211\u4eec\u5bf9\u4ee5\u540e\u955c\u50cf\u4f7f\u7528 `docker tag`\uff0c\u65e7\u7684\u955c\u50cf\u4f9d\u7136\u4f1a\u5b58\u5728\u4e8e\u955c\u50cf\u5217\u8868\u4e2d\u3002\n\n```\n$ sudo docker images\nREPOSITORY            TAG                 IMAGE ID            CREATED             SIZE\nwebapp                1.0                 0bc42f7ff218        29 minutes ago      372MB\nwebapp                latest              0bc42f7ff218        29 minutes ago      372MB\n## ......\n\n```\n\n\u7531\u4e8e\u955c\u50cf\u662f\u5bf9\u955c\u50cf\u5c42\u7684\u5f15\u7528\u8bb0\u5f55\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u955c\u50cf\u8fdb\u884c\u547d\u540d\u540e\uff0c\u867d\u7136\u80fd\u591f\u5728\u955c\u50cf\u5217\u8868\u91cc\u540c\u65f6\u770b\u5230\u65b0\u8001\u4e24\u4e2a\u955c\u50cf\uff0c\u5b9e\u8d28\u662f\u5b83\u4eec\u5176\u5b9e\u5f15\u7528\u7740\u76f8\u540c\u7684\u955c\u50cf\u5c42\uff0c\u8fd9\u4e2a\u6211\u4eec\u80fd\u591f\u4ece\u955c\u50cf ID \u4e2d\u770b\u5f97\u51fa\u6765 ( \u56e0\u4e3a\u955c\u50cf ID \u5c31\u662f\u6700\u4e0a\u5c42\u955c\u50cf\u5c42\u7684 ID )\u3002\u6b63\u662f\u8fd9\u4e2a\u539f\u56e0\uff0c\u6211\u4eec\u867d\u7136\u521b\u5efa\u4e86\u65b0\u7684\u955c\u50cf\uff0c\u4f46\u5bf9\u7269\u7406\u5b58\u50a8\u7684\u5360\u7528\u7a7a\u95f4\u5374\u4e0d\u662f\u955c\u50cf\u5927\u5c0f\u76f4\u63a5\u7ffb\u500d\uff0c\u5e76\u4e14\u521b\u5efa\u4e5f\u5728\u970e\u90a3\u4e4b\u95f4\u3002\n\n\u9664\u4e86\u4f7f\u7528 `docker tag` \u5728\u5bb9\u5668\u63d0\u4ea4\u4e3a\u65b0\u7684\u955c\u50cf\u540e\u4e3a\u955c\u50cf\u547d\u540d\u8fd9\u79cd\u65b9\u5f0f\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5728 `docker commit` \u547d\u4ee4\u91cc\u6307\u5b9a\u65b0\u7684\u955c\u50cf\u540d\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5728\u4f7f\u7528\u5bb9\u5668\u63d0\u4ea4\u65f6\u4f1a\u66f4\u52a0\u65b9\u4fbf\u3002\n\n```\n$ sudo docker commit -m \"Upgrade\" webapp webapp\uff1a2.0\n\n```\n\n## \u955c\u50cf\u7684\u8fc1\u79fb\n\n\u5728\u6211\u4eec\u5c06\u66f4\u65b0\u5bfc\u51fa\u4e3a\u955c\u50cf\u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u8fc1\u79fb\u955c\u50cf\u7684\u5de5\u4f5c\u4e86\u3002\n\n\u7531\u4e8e Docker \u662f\u4ee5\u96c6\u4e2d\u7684\u65b9\u5f0f\u7ba1\u7406\u955c\u50cf\u7684\uff0c\u6240\u4ee5\u5728\u8fc1\u79fb\u4e4b\u524d\uff0c\u6211\u4eec\u8981\u5148\u4ece Docker \u4e2d\u53d6\u51fa\u955c\u50cf\u3002`docker save` \u547d\u4ee4\u53ef\u4ee5\u5c06\u955c\u50cf\u8f93\u51fa\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u8ba9\u6211\u4eec\u4fdd\u5b58\u955c\u50cf\u5230 Docker \u5916\u90e8\u7684\u65b9\u5f0f\u3002\n\n```\n$ sudo docker save webapp:1.0 > webapp-1.0.tar\n\n```\n\n\u5728\u9ed8\u8ba4\u5b9a\u4e49\u4e0b\uff0c`docker save` \u547d\u4ee4\u4f1a\u5c06\u955c\u50cf\u5185\u5bb9\u653e\u5165\u8f93\u51fa\u6d41\u4e2d\uff0c\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u4f7f\u7528\u7ba1\u9053\u8fdb\u884c\u63a5\u6536 ( \u4e5f\u5c31\u662f\u547d\u4ee4\u4e2d\u7684 > \u7b26\u53f7 )\uff0c\u8fd9\u5c5e\u4e8e Linux \u7b49\u7cfb\u7edf\u63a7\u5236\u53f0\u4e2d\u7684\u7528\u6cd5\uff0c\u8fd9\u91cc\u6211\u4eec\u4e0d\u505a\u8be6\u7ec6\u8bb2\u89e3\u3002\n\n\u7ba1\u9053\u8fd9\u79cd\u7528\u6cd5\u6709\u65f6\u5019\u4f9d\u7136\u4e0d\u592a\u53cb\u597d\uff0c`docker save` \u547d\u4ee4\u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86 `-o` \u9009\u9879\uff0c\u7528\u6765\u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\uff0c\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\u53ef\u4ee5\u8ba9\u547d\u4ee4\u66f4\u5177\u6709\u7edf\u4e00\u6027\u3002\n\n```\n$ sudo docker save -o ./webapp-1.0.tar webapp:1.0\n\n```\n\n\u5728\u955c\u50cf\u5bfc\u51fa\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u627e\u5230\u5df2\u7ecf\u5b58\u50a8\u955c\u50cf\u5185\u5bb9\u7684 webapp-1.0.tar \u8fd9\u4e2a\u6587\u4ef6\u4e86\u3002\u6709\u5174\u8da3\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u4f7f\u7528\u89e3\u538b\u8f6f\u4ef6\u67e5\u770b\u5176\u4e2d\u7684\u5185\u5bb9\uff0c\u4f60\u4f1a\u770b\u5230\u91cc\u9762\u5176\u5b9e\u5c31\u662f\u955c\u50cf\u6240\u57fa\u4e8e\u7684\u51e0\u4e2a\u955c\u50cf\u5c42\u7684\u8bb0\u5f55\u6587\u4ef6\u3002\n\n### \u5bfc\u5165\u955c\u50cf\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5f88\u591a\u79cd\u65b9\u5f0f\u5c06\u5bfc\u51fa\u7684\u955c\u50cf\u6587\u4ef6\u590d\u5236\u5230\u53e6\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u5728\u8fd9\u4e48\u64cd\u4f5c\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u8981\u5c06\u955c\u50cf\u5bfc\u5165\u5230\u8fd9\u53f0\u65b0\u673a\u5668\u4e2d\u8fd0\u884c\u7684 Docker \u4e2d\u3002\n\n\u5bfc\u5165\u955c\u50cf\u7684\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u4f7f\u7528\u4e0e `docker save` \u76f8\u5bf9\u7684 `docker load` \u547d\u4ee4\u5373\u53ef\u3002\n\n```\n$ sudo docker load < webapp-1.0.tar\n\n```\n\n\u76f8\u5bf9\u7684\uff0c`docker load` \u547d\u4ee4\u662f\u4ece\u8f93\u5165\u6d41\u4e2d\u8bfb\u53d6\u955c\u50cf\u7684\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u4e5f\u8981\u4f7f\u7528\u7ba1\u9053\u6765\u4f20\u8f93\u5185\u5bb9\u3002\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u4f7f\u7528 `-i` \u9009\u9879\u6307\u5b9a\u8f93\u5165\u6587\u4ef6\u3002\n\n```\n$ sudo docker load -i webapp-1.0.tar\n\n```\n\n\u955c\u50cf\u5bfc\u5165\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 `docker images` \u770b\u5230\u5b83\u4e86\uff0c\u5bfc\u5165\u7684\u955c\u50cf\u4f1a\u5ef6\u7528\u539f\u6709\u7684\u955c\u50cf\u540d\u79f0\u3002\n\n### \u6279\u91cf\u8fc1\u79fb\n\n\u901a\u8fc7 `docker save` \u548c `docker load` \u547d\u4ee4\u6211\u4eec\u8fd8\u80fd\u591f\u6279\u91cf\u8fc1\u79fb\u955c\u50cf\uff0c\u53ea\u8981\u6211\u4eec\u5728 `docker save` \u4e2d\u4f20\u5165\u591a\u4e2a\u955c\u50cf\u540d\u4f5c\u4e3a\u53c2\u6570\uff0c\u5b83\u5c31\u80fd\u591f\u5c06\u8fd9\u4e9b\u955c\u50cf\u90fd\u6253\u6210\u4e00\u4e2a\u5305\uff0c\u4fbf\u4e8e\u6211\u4eec\u4e00\u6b21\u6027\u8fc1\u79fb\u591a\u4e2a\u955c\u50cf\u3002\n\n```\n$ sudo docker save -o ./images.tar webapp:1.0 nginx:1.12 mysql:5.7\n\n```\n\n\u88c5\u6709\u591a\u4e2a\u955c\u50cf\u7684\u5305\u53ef\u4ee5\u76f4\u63a5\u88ab `docker load` \u8bc6\u522b\u548c\u8bfb\u53d6\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a\u5305\u5bfc\u5165\u540e\uff0c\u6240\u6709\u5176\u4e2d\u88c5\u8f7d\u7684\u955c\u50cf\u90fd\u4f1a\u88ab\u5bfc\u5165\u5230 Docker \u4e4b\u4e2d\u3002\n\n## \u5bfc\u51fa\u548c\u5bfc\u5165\u5bb9\u5668\n\n\u4e5f\u8bb8 Docker \u7684\u5f00\u53d1\u8005\u8ba4\u4e3a\uff0c\u63d0\u4ea4\u955c\u50cf\u4fee\u6539\uff0c\u518d\u5bfc\u51fa\u955c\u50cf\u8fdb\u884c\u8fc1\u79fb\u7684\u65b9\u6cd5\u8fd8\u4e0d\u591f\u6548\u7387\uff0c\u6240\u4ee5\u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5bfc\u51fa\u5bb9\u5668\u7684\u65b9\u6cd5\u3002\n\n\u4f7f\u7528 `docker export` \u547d\u4ee4\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5bfc\u51fa\u5bb9\u5668\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u7b80\u5355\u7684\u7406\u89e3\u4e3a `docker commit` \u4e0e `docker save` \u7684\u7ed3\u5408\u4f53\u3002\n\n```\n$ sudo docker export -o ./webapp.tar webapp\n\n```\n\n\u76f8\u5bf9\u7684\uff0c\u4f7f\u7528 `docker export` \u5bfc\u51fa\u7684\u5bb9\u5668\u5305\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `docker import` \u5bfc\u5165\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4f7f\u7528 `docker import` \u5e76\u975e\u76f4\u63a5\u5c06\u5bb9\u5668\u5bfc\u5165\uff0c\u800c\u662f\u5c06\u5bb9\u5668\u8fd0\u884c\u65f6\u7684\u5185\u5bb9\u4ee5\u955c\u50cf\u7684\u5f62\u5f0f\u5bfc\u5165\u3002\u6240\u4ee5\u5bfc\u5165\u7684\u7ed3\u679c\u5176\u5b9e\u662f\u4e00\u4e2a\u955c\u50cf\uff0c\u800c\u4e0d\u662f\u5bb9\u5668\u3002\u5728 `docker import` \u7684\u53c2\u6570\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9\u8fd9\u4e2a\u955c\u50cf\u547d\u540d\u3002\n\n```\n$ sudo docker import ./webapp.tar webapp:1.0\n\n```\n\n\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f7f\u7528 `docker save` \u548c `docker load`\uff0c\u6216\u8005\u662f\u4f7f\u7528 `docker export` \u548c `docker import` \u90fd\u53ef\u4ee5\u8fbe\u5230\u8fc1\u79fb\u5bb9\u5668\u6216\u8005\u955c\u50cf\u7684\u76ee\u7684\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u5173\u4e8e\u5bf9 Docker \u5bb9\u5668\u548c\u955c\u50cf\u8fdb\u884c\u8fc1\u79fb\u7684\u4e00\u4e9b\u65b9\u6cd5\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> \u901a\u8fc7 Docker \u8fdb\u884c\u7684\u96c6\u7fa4\u90e8\u7f72\u548c\u5176\u4ed6\u865a\u62df\u5316\u5f62\u5f0f\u4e2d\u7684\u96c6\u7fa4\u90e8\u7f72\u6709\u600e\u6837\u7684\u533a\u522b\uff0c\u5728\u90e8\u7f72\u8fc7\u7a0b\u4e2d Docker \u53c8\u662f\u5982\u4f55\u53d1\u6325\u5b83\u4f18\u52bf\u7684\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u4fdd\u5b58\u548c\u5171\u4eab\u955c\u50cf\u8fd8\u6709\u7591\u95ee\uff0c\u6216\u8005\u6709\u66f4\u597d\u7684\u5b9e\u8df5\u89d2\u5ea6\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u64cd\u4f5c\u955c\u50cf\u4fdd\u5b58\u548c\u5171\u4eab\u955c\u50cf.md", "create_date": "2020-02-18T21:18:39.000", "order": 11}}, {"model": "subject.chapter", "pk": 63, "fields": {"title": "\u64cd\u4f5c\u955c\u50cf\uff1a\u5e38\u89c1\u7684 Dockerfile \u4f7f\u7528\u6280\u5de7", "topic": 3, "md5": "560bd8687e4dc462bbe3d92212853fa3", "md_body": "# \u5e38\u89c1 Dockerfile \u4f7f\u7528\u6280\u5de7\n\n\u5728\u638c\u63e1 Dockerfile \u7684\u57fa\u672c\u4f7f\u7528\u65b9\u6cd5\u540e\uff0c\u6211\u4eec\u518d\u6765\u4e86\u89e3\u4e00\u4e9b\u5728\u5f00\u53d1\u4e2d\u4f7f\u7528 Dockerfile \u7684\u6280\u5de7\u3002\u8fd9\u4e00\u5c0f\u8282\u7684\u5c55\u73b0\u65b9\u5f0f\u4e0e\u4e4b\u524d\u7684\u7565\u6709\u4e0d\u540c\uff0c\u5176\u4e3b\u8981\u6765\u81ea\u9605\u8bfb\u6536\u96c6\u548c\u6211\u81ea\u8eab\u5728\u4f7f\u7528\u4e2d\u7684\u6700\u4f73\u5b9e\u8df5\u3002\u4e5f\u8bb8\u8fd9\u91cc\u9762\u4ecb\u7ecd\u7684\u4e0d\u662f\u6700\u4e3a\u6807\u51c6\u6216\u662f\u5408\u4e4e\u89c4\u8303\u7684\u65b9\u5f0f\uff0c\u4f46\u4e00\u5b9a\u662f\u80fd\u591f\u76f4\u63a5\u5e2e\u52a9\u5927\u5bb6\u5728\u5f00\u53d1\u4e2d\u4f7f\u7528 Docker \u63d0\u5347\u751f\u4ea7\u529b\u7684\u65b9\u5f0f\u3002\u4e0b\u9762\u5c31\u8ba9\u6211\u4eec\u6765\u770b\u770b\u8fd9\u4e9b\u5173\u4e8e Dockerfile \u7684\u4f7f\u7528\u6280\u5de7\u5427\u3002\n\n## \u6784\u5efa\u4e2d\u4f7f\u7528\u53d8\u91cf\n\n\u5728\u5b9e\u9645\u7f16\u5199 Dockerfile \u65f6\uff0c\u4e0e\u642d\u5efa\u73af\u5883\u76f8\u5173\u7684\u6307\u4ee4\u4f1a\u662f\u5176\u4e2d\u5360\u6709\u5927\u90e8\u5206\u6bd4\u4f8b\u7684\u6307\u4ee4\u3002\u5728\u642d\u5efa\u7a0b\u5e8f\u6240\u9700\u8fd0\u884c\u73af\u5883\u65f6\uff0c\u96be\u514d\u6d89\u53ca\u5230\u4e00\u4e9b\u53ef\u53d8\u91cf\uff0c\u4f8b\u5982\u4f9d\u8d56\u8f6f\u4ef6\u7684\u7248\u672c\uff0c\u7f16\u8bd1\u7684\u53c2\u6570\u7b49\u7b49\u3002\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u8fd9\u4e9b\u6570\u636e\u5199\u5165\u5230 Dockerfile \u4e2d\u5b8c\u5168\u6ca1\u6709\u95ee\u9898\uff0c\u6709\u95ee\u9898\u7684\u662f\u8fd9\u4e9b\u53ef\u53d8\u91cf\u6211\u4eec\u4f1a\u7ecf\u5e38\u8c03\u6574\uff0c\u5728\u8c03\u6574\u65f6\u5c31\u9700\u8981\u6211\u4eec\u5230 Dockerfile \u4e2d\u627e\u5230\u5b83\u4eec\u5e76\u8fdb\u884c\u66f4\u6539\uff0c\u5982\u679c\u53ea\u662f\u7b80\u5355\u7684 Dockerfile \u6587\u4ef6\u5c1a\u4e14\u597d\u8bf4\uff0c\u4f46\u5982\u679c\u662f\u76f8\u5bf9\u590d\u6742\u6216\u662f\u5b58\u5728\u591a\u5904\u53d8\u91cf\u7684 Dockerfile \u6587\u4ef6\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u5c31\u53d8\u5f97\u7e41\u7410\u800c\u8ba9\u4eba\u70e6\u8e81\u4e86\u3002\n\n\u5728 Dockerfile \u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 ARG \u6307\u4ee4\u6765\u5efa\u7acb\u4e00\u4e2a\u53c2\u6570\u53d8\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u901a\u8fc7\u6784\u5efa\u6307\u4ee4\u4f20\u5165\u8fd9\u4e2a\u53c2\u6570\u53d8\u91cf\uff0c\u5e76\u4e14\u5728 Dockerfile \u91cc\u4f7f\u7528\u5b83\u3002\n\n\u4f8b\u5982\uff0c\u6211\u4eec\u5e0c\u671b\u901a\u8fc7\u53c2\u6570\u53d8\u91cf\u63a7\u5236 Dockerfile \u4e2d\u67d0\u4e2a\u7a0b\u5e8f\u7684\u7248\u672c\uff0c\u5728\u6784\u5efa\u65f6\u5b89\u88c5\u6211\u4eec\u6307\u5b9a\u7248\u672c\u7684\u8f6f\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ARG \u5b9a\u4e49\u7684\u53c2\u6570\u4f5c\u4e3a\u5360\u4f4d\u7b26\uff0c\u66ff\u6362\u7248\u672c\u5b9a\u4e49\u7684\u90e8\u5206\u3002\n\n```\nFROM debian:stretch-slim\n\n## ......\n\nARG TOMCAT_MAJOR\nARG TOMCAT_VERSION\n\n## ......\n\nRUN wget -O tomcat.tar.gz \"https://www.apache.org/dyn/closer.cgi?action=download&filename=tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz\"\n\n## ......\n\n\n```\n\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u5c06 Tomcat \u7684\u7248\u672c\u53f7\u901a\u8fc7 ARG \u6307\u4ee4\u5b9a\u4e49\u4e3a\u53c2\u6570\u53d8\u91cf\uff0c\u5728\u8c03\u7528\u4e0b\u8f7d Tomcat \u5305\u65f6\uff0c\u4f7f\u7528\u53d8\u91cf\u66ff\u6362\u6389\u4e0b\u8f7d\u5730\u5740\u4e2d\u7684\u7248\u672c\u53f7\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u5b9a\u4e49\uff0c\u5c31\u53ef\u4ee5\u8ba9\u6211\u4eec\u5728\u4e0d\u5bf9 Dockerfile \u8fdb\u884c\u5927\u5e45\u4fee\u6539\u7684\u524d\u63d0\u4e0b\uff0c\u8f7b\u677e\u5b9e\u73b0\u5bf9 Tomcat \u7248\u672c\u7684\u5207\u6362\u5e76\u91cd\u65b0\u6784\u5efa\u955c\u50cf\u4e86\u3002\n\n\u5982\u679c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u8fd9\u4e2a Dockerfile \u6587\u4ef6\u6784\u5efa Tomcat \u955c\u50cf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u901a\u8fc7 `docker build` \u7684 `--build-arg` \u9009\u9879\u6765\u8bbe\u7f6e\u53c2\u6570\u53d8\u91cf\u3002\n\n```\n$ sudo docker build --build-arg TOMCAT_MAJOR=8 --build-arg TOMCAT_VERSION=8.0.53 -t tomcat:8.0 ./tomcat\n\n```\n\n### \u73af\u5883\u53d8\u91cf\n\n\u73af\u5883\u53d8\u91cf\u4e5f\u662f\u7528\u6765\u5b9a\u4e49\u53c2\u6570\u7684\u4e1c\u897f\uff0c\u4e0e ARG \u6307\u4ee4\u76f8\u7c7b\u4f3c\uff0c\u73af\u5883\u53d8\u91cf\u7684\u5b9a\u4e49\u662f\u901a\u8fc7 ENV \u8fd9\u4e2a\u6307\u4ee4\u6765\u5b8c\u6210\u7684\u3002\n\n```\nFROM debian:stretch-slim\n\n## ......\n\nENV TOMCAT_MAJOR 8\nENV TOMCAT_VERSION 8.0.53\n\n## ......\n\nRUN wget -O tomcat.tar.gz \"https://www.apache.org/dyn/closer.cgi?action=download&filename=tomcat/tomcat-$TOMCAT_MAJOR/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz\"\n\n\n```\n\n\u73af\u5883\u53d8\u91cf\u7684\u4f7f\u7528\u65b9\u6cd5\u4e0e\u53c2\u6570\u53d8\u91cf\u4e00\u6837\uff0c\u4e5f\u90fd\u662f\u80fd\u591f\u76f4\u63a5\u66ff\u6362\u6307\u4ee4\u53c2\u6570\u4e2d\u7684\u5185\u5bb9\u3002\n\n\u4e0e\u53c2\u6570\u53d8\u91cf\u53ea\u80fd\u5f71\u54cd\u6784\u5efa\u8fc7\u7a0b\u4e0d\u540c\uff0c\u73af\u5883\u53d8\u91cf\u4e0d\u4ec5\u80fd\u591f\u5f71\u54cd\u6784\u5efa\uff0c\u8fd8\u80fd\u591f\u5f71\u54cd\u57fa\u4e8e\u6b64\u955c\u50cf\u521b\u5efa\u7684\u5bb9\u5668\u3002\u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\u7684\u5b9e\u8d28\uff0c\u5176\u5b9e\u5c31\u662f\u5b9a\u4e49\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff0c\u6240\u4ee5\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u91cc\uff0c\u4e00\u6837\u62e5\u6709\u8fd9\u4e9b\u53d8\u91cf\uff0c\u800c\u5bb9\u5668\u4e2d\u8fd0\u884c\u7684\u7a0b\u5e8f\u4e5f\u80fd\u591f\u5f97\u5230\u8fd9\u4e9b\u53d8\u91cf\u7684\u503c\u3002\n\n\u53e6\u4e00\u4e2a\u4e0d\u540c\u70b9\u662f\uff0c\u73af\u5883\u53d8\u91cf\u7684\u503c\u4e0d\u662f\u5728\u6784\u5efa\u6307\u4ee4\u4e2d\u4f20\u5165\u7684\uff0c\u800c\u662f\u5728 Dockerfile \u4e2d\u7f16\u5199\u7684\uff0c\u6240\u4ee5\u5982\u679c\u6211\u4eec\u8981\u4fee\u6539\u73af\u5883\u53d8\u91cf\u7684\u503c\uff0c\u6211\u4eec\u9700\u8981\u5230 Dockerfile \u4fee\u6539\u3002\u4e0d\u8fc7\u5373\u4f7f\u8fd9\u6837\uff0c\u53ea\u8981\u6211\u4eec\u5c06 ENV \u5b9a\u4e49\u653e\u5728 Dockerfile \u524d\u90e8\u5bb9\u6613\u67e5\u627e\u7684\u5730\u65b9\uff0c\u5176\u4f9d\u7136\u53ef\u4ee5\u5f88\u5feb\u7684\u5e2e\u52a9\u6211\u4eec\u5207\u6362\u955c\u50cf\u73af\u5883\u4e2d\u7684\u4e00\u4e9b\u5185\u5bb9\u3002\n\n\u7531\u4e8e\u73af\u5883\u53d8\u91cf\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f9d\u7136\u6709\u6548\uff0c\u6240\u4ee5\u8fd0\u884c\u5bb9\u5668\u65f6\u6211\u4eec\u8fd8\u53ef\u4ee5\u5bf9\u5176\u8fdb\u884c\u8986\u76d6\uff0c\u5728\u521b\u5efa\u5bb9\u5668\u65f6\u4f7f\u7528 `-e` \u6216\u662f `--env` \u9009\u9879\uff0c\u53ef\u4ee5\u5bf9\u73af\u5883\u53d8\u91cf\u7684\u503c\u8fdb\u884c\u4fee\u6539\u6216\u5b9a\u4e49\u65b0\u7684\u73af\u5883\u53d8\u91cf\u3002\n\n```\n$ sudo docker run -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:5.7\n\n```\n\n\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u79cd\u7528\u6cd5\u5728\u6211\u4eec\u5f00\u53d1\u4e2d\u662f\u975e\u5e38\u5e38\u89c1\u7684\u3002\u4e5f\u6b63\u662f\u56e0\u4e3a\u8fd9\u79cd\u5141\u8bb8\u8fd0\u884c\u65f6\u914d\u7f6e\u7684\u65b9\u6cd5\u5b58\u5728\uff0c\u73af\u5883\u53d8\u91cf\u548c\u5b9a\u4e49\u5b83\u7684 ENV \u6307\u4ee4\uff0c\u662f\u6211\u4eec\u66f4\u5e38\u4f7f\u7528\u7684\u6307\u4ee4\uff0c\u6211\u4eec\u4f1a\u4f18\u5148\u9009\u62e9\u5b83\u4eec\u6765\u5b9e\u73b0\u5bf9\u53d8\u91cf\u7684\u64cd\u4f5c\u3002\n\n\u5173\u4e8e\u73af\u5883\u53d8\u91cf\u662f\u5982\u4f55\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u66f4\u8f7b\u677e\u7684\u5904\u7406 Docker \u955c\u50cf\u548c\u5bb9\u5668\u4f7f\u7528\u7b49\u95ee\u9898\uff0c\u6211\u4eec\u4f1a\u5728\u4e0b\u4e00\u8282\u4e2d\u8fdb\u884c\u5b9e\u9645\u5c55\u793a\uff0c\u901a\u8fc7\u4f8b\u5b50\u5927\u5bb6\u80fd\u591f\u66f4\u5bb9\u6613\u7406\u89e3\u5b83\u7684\u539f\u7406\u3002\n\n\u53e6\u5916\u9700\u8981\u8bf4\u660e\u4e00\u70b9\uff0c\u901a\u8fc7 ENV \u6307\u4ee4\u548c ARG \u6307\u4ee4\u6240\u5b9a\u4e49\u7684\u53c2\u6570\uff0c\u5728\u4f7f\u7528\u65f6\u90fd\u662f\u91c7\u7528 $ + NAME \u8fd9\u79cd\u5f62\u5f0f\u6765\u5360\u4f4d\u7684\uff0c\u6240\u4ee5\u5b83\u4eec\u4e4b\u95f4\u7684\u5b9a\u4e49\u5c31\u5b58\u5728\u51b2\u7a81\u7684\u53ef\u80fd\u6027\u3002\u5bf9\u4e8e\u8fd9\u79cd\u573a\u666f\uff0c\u5927\u5bb6\u53ea\u9700\u8981\u8bb0\u4f4f\uff0cENV \u6307\u4ee4\u6240\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u6c38\u8fdc\u4f1a\u8986\u76d6 ARG \u6240\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5373\u4f7f\u5b83\u4eec\u5b9a\u65f6\u7684\u987a\u5e8f\u662f\u76f8\u53cd\u7684\u3002\n\n## \u5408\u5e76\u547d\u4ee4\n\n\u5728\u4e0a\u4e00\u8282\u6211\u4eec\u5c55\u793a\u7684\u5b8c\u6574\u7684\u5b98\u65b9 Redis \u955c\u50cf\u7684 Dockerfile \u4e2d\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0 RUN \u7b49\u6307\u4ee4\u91cc\u4f1a\u805a\u5408\u4e0b\u5927\u91cf\u7684\u4ee3\u7801\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u4e0b\u9762\u4e24\u79cd\u5199\u6cd5\u5bf9\u4e8e\u642d\u5efa\u7684\u73af\u5883\u6765\u8bf4\u662f\u6ca1\u6709\u592a\u5927\u533a\u522b\u7684\u3002\n\n```\nRUN apt-get update; \\\n    apt-get install -y --no-install-recommends $fetchDeps; \\\n    rm -rf /var/lib/apt/lists/*;\n\n```\n\n```\nRUN apt-get update\nRUN apt-get install -y --no-install-recommends $fetchDeps\nRUN rm -rf /var/lib/apt/lists/*\n\n```\n\n\u90a3\u4e3a\u4ec0\u4e48\u6211\u4eec\u66f4\u591a\u89c1\u7684\u662f\u7b2c\u4e00\u79cd\u5f62\u5f0f\u800c\u975e\u7b2c\u4e8c\u79cd\u5462\uff1f\u8fd9\u5c31\u8981\u4ece\u955c\u50cf\u6784\u5efa\u7684\u8fc7\u7a0b\u8bf4\u8d77\u4e86\u3002\n\n\u770b\u4f3c\u8fde\u7eed\u7684\u955c\u50cf\u6784\u5efa\u8fc7\u7a0b\uff0c\u5176\u5b9e\u662f\u7531\u591a\u4e2a\u5c0f\u6bb5\u7ec4\u6210\u3002\u6bcf\u5f53\u4e00\u6761\u80fd\u591f\u5f62\u6210\u5bf9\u6587\u4ef6\u7cfb\u7edf\u6539\u52a8\u7684\u6307\u4ee4\u5728\u88ab\u6267\u884c\u524d\uff0cDocker \u5148\u4f1a\u57fa\u4e8e\u4e0a\u6761\u547d\u4ee4\u7684\u7ed3\u679c\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u8fd9\u6761\u6307\u4ee4\u7684\u5185\u5bb9\uff0c\u4e4b\u540e\u5c06\u7ed3\u679c\u6253\u5305\u6210\u4e00\u4e2a\u955c\u50cf\u5c42\uff0c\u5982\u6b64\u53cd\u590d\uff0c\u6700\u7ec8\u5f62\u6210\u955c\u50cf\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/166377aa670bb4a4?w=1516&h=482&f=png&s=49015)\n\n\u6240\u4ee5\u8bf4\uff0c\u6211\u4eec\u4e4b\u524d\u8c08\u5230\u955c\u50cf\u662f\u7531\u591a\u4e2a\u955c\u50cf\u5c42\u53e0\u52a0\u800c\u5f97\uff0c\u800c\u8fd9\u4e9b\u955c\u50cf\u5c42\u5176\u5b9e\u5c31\u662f\u5728\u6211\u4eec Dockerfile \u4e2d\u6bcf\u6761\u6307\u4ee4\u6240\u751f\u6210\u7684\u3002\n\n\u4e86\u89e3\u4e86\u8fd9\u4e2a\u539f\u7406\uff0c\u5927\u5bb6\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u4e3a\u4ec0\u4e48\u7edd\u5927\u591a\u6570\u955c\u50cf\u4f1a\u5c06\u547d\u4ee4\u5408\u5e76\u5230\u4e00\u6761\u6307\u4ee4\u4e2d\uff0c\u56e0\u4e3a\u8fd9\u79cd\u505a\u6cd5\u4e0d\u4f46\u51cf\u5c11\u4e86\u955c\u50cf\u5c42\u7684\u6570\u91cf\uff0c\u4e5f\u51cf\u5c11\u4e86\u955c\u50cf\u6784\u5efa\u8fc7\u7a0b\u4e2d\u53cd\u590d\u521b\u5efa\u5bb9\u5668\u7684\u6b21\u6570\uff0c\u63d0\u9ad8\u4e86\u955c\u50cf\u6784\u5efa\u7684\u901f\u5ea6\u3002\n\n### \u6784\u5efa\u7f13\u5b58\n\nDocker \u5728\u955c\u50cf\u6784\u5efa\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u652f\u6301\u4e00\u79cd\u7f13\u5b58\u7b56\u7565\u6765\u63d0\u9ad8\u955c\u50cf\u7684\u6784\u5efa\u901f\u5ea6\u3002\n\n\u7531\u4e8e\u955c\u50cf\u662f\u591a\u4e2a\u6307\u4ee4\u6240\u521b\u5efa\u7684\u955c\u50cf\u5c42\u7ec4\u5408\u800c\u5f97\uff0c\u90a3\u4e48\u5982\u679c\u6211\u4eec\u5224\u65ad\u65b0\u7f16\u8bd1\u7684\u955c\u50cf\u5c42\u4e0e\u5df2\u7ecf\u5b58\u5728\u7684\u955c\u50cf\u5c42\u672a\u53d1\u751f\u53d8\u5316\uff0c\u90a3\u4e48\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u4e4b\u524d\u6784\u5efa\u7684\u7ed3\u679c\uff0c\u800c\u4e0d\u9700\u8981\u518d\u6267\u884c\u8fd9\u6761\u6784\u5efa\u6307\u4ee4\uff0c\u8fd9\u5c31\u662f\u955c\u50cf\u6784\u5efa\u7f13\u5b58\u7684\u539f\u7406\u3002\n\n\u90a3\u4e48 Docker \u662f\u5982\u4f55\u5224\u65ad\u955c\u50cf\u5c42\u4e0e\u4e4b\u524d\u7684\u955c\u50cf\u95f4\u4e0d\u5b58\u5728\u53d8\u5316\u7684\u5462\uff1f\u8fd9\u4e3b\u8981\u53c2\u8003\u4e24\u4e2a\u7ef4\u5ea6\uff0c\u7b2c\u4e00\u662f\u6240\u57fa\u4e8e\u7684\u955c\u50cf\u5c42\u662f\u5426\u4e00\u6837\uff0c\u7b2c\u4e8c\u662f\u7528\u4e8e\u751f\u6210\u955c\u50cf\u5c42\u7684\u6307\u4ee4\u7684\u5185\u5bb9\u662f\u5426\u4e00\u6837\u3002\n\n\u57fa\u4e8e\u8fd9\u4e2a\u539f\u5219\uff0c\u6211\u4eec\u5728\u6761\u4ef6\u5141\u8bb8\u7684\u524d\u63d0\u4e0b\uff0c\u66f4\u5efa\u8bae\u5c06\u4e0d\u5bb9\u6613\u53d1\u751f\u53d8\u5316\u7684\u642d\u5efa\u8fc7\u7a0b\u653e\u5230 Dockerfile \u7684\u524d\u90e8\uff0c\u5145\u5206\u5229\u7528\u6784\u5efa\u7f13\u5b58\u63d0\u9ad8\u955c\u50cf\u6784\u5efa\u7684\u901f\u5ea6\u3002\u53e6\u5916\uff0c\u6307\u4ee4\u7684\u5408\u5e76\u4e5f\u4e0d\u5b9c\u8fc7\u5ea6\uff0c\u800c\u662f\u5c06\u6613\u53d8\u548c\u4e0d\u6613\u53d8\u7684\u8fc7\u7a0b\u62c6\u5206\uff0c\u5206\u522b\u653e\u5230\u4e0d\u540c\u7684\u6307\u4ee4\u91cc\u3002\n\n\u5728\u53e6\u5916\u4e00\u4e9b\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u80fd\u4e0d\u5e0c\u671b Docker \u5728\u6784\u5efa\u955c\u50cf\u65f6\u4f7f\u7528\u6784\u5efa\u7f13\u5b58\uff0c\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `--no-cache` \u9009\u9879\u6765\u7981\u7528\u5b83\u3002\n\n```\n$ sudo docker build --no-cache ./webapp\n\n```\n\n## \u642d\u914d ENTRYPOINT \u548c CMD\n\n\u4e0a\u4e00\u8282\u6211\u4eec\u8c08\u5230\u4e86 ENTRYPOINT \u548c CMD \u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c\u4e5f\u89e3\u91ca\u4e86\u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u76ee\u7684\uff0c\u5373\u90fd\u662f\u7528\u6765\u6307\u5b9a\u57fa\u4e8e\u6b64\u955c\u50cf\u6240\u521b\u5efa\u5bb9\u5668\u91cc\u4e3b\u8fdb\u7a0b\u7684\u542f\u52a8\u547d\u4ee4\u7684\u3002\n\n\u4e24\u4e2a\u6307\u4ee4\u7684\u533a\u522b\u5728\u4e8e\uff0cENTRYPOINT \u6307\u4ee4\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e CMD \u6307\u4ee4\u3002\u5f53 ENTRYPOINT \u548c CMD \u540c\u65f6\u5728\u955c\u50cf\u4e2d\u88ab\u6307\u5b9a\u65f6\uff0cCMD \u91cc\u7684\u5185\u5bb9\u4f1a\u4f5c\u4e3a ENTRYPOINT \u7684\u53c2\u6570\uff0c\u4e24\u8005\u62fc\u63a5\u4e4b\u540e\uff0c\u624d\u662f\u6700\u7ec8\u6267\u884c\u7684\u547d\u4ee4\u3002\n\n\u4e3a\u4e86\u66f4\u597d\u7684\u8ba9\u5927\u5bb6\u7406\u89e3\uff0c\u8fd9\u91cc\u7d22\u6027\u5217\u51fa\u6240\u6709\u7684 ENTRYPOINT \u4e0e CMD \u7684\u7ec4\u5408\uff0c\u4f9b\u5927\u5bb6\u53c2\u8003\u3002\n\nENTRYPOINT\n\nCMD\n\n\u5b9e\u9645\u6267\u884c\n\nENTRYPOINT \\[\"/bin/ep\", \"arge\"\\]\n\n/bin/ep arge\n\nENTRYPOINT /bin/ep arge\n\n/bin/sh -c /bin/ep arge\n\nCMD \\[\"/bin/exec\", \"args\"\\]\n\n/bin/exec args\n\nCMD /bin/exec args\n\n/bin/sh -c /bin/exec args\n\nENTRYPOINT \\[\"/bin/ep\", \"arge\"\\]\n\nCMD \\[\"/bin/exec\", \"argc\"\\]\n\n/bin/ep arge /bin/exec argc\n\nENTRYPOINT \\[\"/bin/ep\", \"arge\"\\]\n\nCMD /bin/exec args\n\n/bin/ep arge /bin/sh -c /bin/exec args\n\nENTRYPOINT /bin/ep arge\n\nCMD \\[\"/bin/exec\", \"argc\"\\]\n\n/bin/sh -c /bin/ep arge /bin/exec argc\n\nENTRYPOINT /bin/ep arge\n\nCMD /bin/exec args\n\n/bin/sh -c /bin/ep arge /bin/sh -c /bin/exec args\n\n\u6709\u7684\u8bfb\u8005\u4f1a\u5b58\u5728\u7591\u95ee\uff0c\u65e2\u7136\u4e24\u8005\u90fd\u662f\u7528\u6765\u5b9a\u4e49\u5bb9\u5668\u542f\u52a8\u547d\u4ee4\u7684\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u5206\u6210\u4e24\u4e2a\uff0c\u5408\u5e76\u4e3a\u4e00\u4e2a\u6307\u4ee4\u5c82\u4e0d\u662f\u66f4\u65b9\u4fbf\u5417\uff1f\n\n\u8fd9\u5176\u5b9e\u5728\u4e8e ENTRYPOINT \u548c CMD \u8bbe\u8ba1\u7684\u76ee\u7684\u662f\u4e0d\u540c\u7684\u3002ENTRYPOINT \u6307\u4ee4\u4e3b\u8981\u7528\u4e8e\u5bf9\u5bb9\u5668\u8fdb\u884c\u4e00\u4e9b\u521d\u59cb\u5316\uff0c\u800c CMD \u6307\u4ee4\u5219\u7528\u4e8e\u771f\u6b63\u5b9a\u4e49\u5bb9\u5668\u4e2d\u4e3b\u7a0b\u5e8f\u7684\u542f\u52a8\u547d\u4ee4\u3002\n\n\u53e6\u5916\uff0c\u6211\u4eec\u4e4b\u524d\u8c08\u5230\u521b\u5efa\u5bb9\u5668\u65f6\u53ef\u4ee5\u6539\u5199\u5bb9\u5668\u4e3b\u7a0b\u5e8f\u7684\u542f\u52a8\u547d\u4ee4\uff0c\u800c\u8fd9\u4e2a\u8986\u76d6\u53ea\u4f1a\u8986\u76d6 CMD \u4e2d\u5b9a\u4e49\u7684\u5185\u5bb9\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd ENTRYPOINT \u4e2d\u7684\u5185\u5bb9\u3002\n\n\u6211\u4eec\u4f9d\u7136\u4ee5\u4e4b\u524d\u7684 Redis \u955c\u50cf\u4e3a\u4f8b\uff0c\u8fd9\u662f Redis \u955c\u50cf\u4e2d\u5bf9 ENTRYPOINT \u548c CMD \u7684\u5b9a\u4e49\u3002\n\n```\n## ......\n\nCOPY docker-entrypoint.sh /usr/local/bin/\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\n## ......\n\nCMD [\"redis-server\"]\n\n```\n\n\u53ef\u4ee5\u5f88\u6e05\u6670\u7684\u770b\u5230\uff0cCMD \u6307\u4ee4\u5b9a\u4e49\u7684\u6b63\u662f\u542f\u52a8 Redis \u7684\u670d\u52a1\u7a0b\u5e8f\uff0c\u800c ENTRYPOINT \u4f7f\u7528\u7684\u662f\u4e00\u4e2a\u5916\u90e8\u5f15\u5165\u7684\u811a\u672c\u6587\u4ef6\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u4f7f\u7528\u811a\u672c\u6587\u4ef6\u6765\u4f5c\u4e3a ENTRYPOINT \u7684\u5185\u5bb9\u662f\u5e38\u89c1\u7684\u505a\u6cd5\uff0c\u56e0\u4e3a\u5bf9\u5bb9\u5668\u8fd0\u884c\u521d\u59cb\u5316\u7684\u547d\u4ee4\u76f8\u5bf9\u8f83\u591a\uff0c\u5168\u90e8\u76f4\u63a5\u653e\u7f6e\u5728 ENTRYPOINT \u540e\u4f1a\u7279\u522b\u590d\u6742\u3002\n\n\u6211\u4eec\u6765\u770b\u770b Redis \u4e2d\u7684 ENTRYPOINT \u811a\u672c\uff0c\u53ef\u4ee5\u770b\u5230\u5176\u4e2d\u4f1a\u6839\u636e\u811a\u672c\u53c2\u6570\u8fdb\u884c\u4e00\u4e9b\u5904\u7406\uff0c\u800c\u811a\u672c\u7684\u53c2\u6570\uff0c\u5176\u5b9e\u5c31\u662f CMD \u4e2d\u5b9a\u4e49\u7684\u5185\u5bb9\u3002\n\n```\n#!/bin/sh\nset -e\n\n# first arg is `-f` or `--some-option`\n# or first arg is `something.conf`\nif [ \"${1#-}\" != \"$1\" ] || [ \"${1%.conf}\" != \"$1\" ]; then\n\tset -- redis-server \"$@\"\nfi\n\n# allow the container to be started with `--user`\nif [ \"$1\" = 'redis-server' -a \"$(id -u)\" = '0' ]; then\n\tfind . \\! -user redis -exec chown redis '{}' +\n\texec gosu redis \"$0\" \"$@\"\nfi\n\nexec \"$@\"\n\n```\n\n\u8fd9\u91cc\u6211\u4eec\u8981\u5173\u6ce8\u811a\u672c\u6700\u540e\u7684\u4e00\u6761\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f `exec \"$@\"`\u3002\u5728\u5f88\u591a\u955c\u50cf\u7684 ENTRYPOINT \u811a\u672c\u91cc\uff0c\u6211\u4eec\u90fd\u4f1a\u770b\u5230\u8fd9\u6761\u547d\u4ee4\uff0c\u5176\u4f5c\u7528\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u800c\u8fd0\u884c\u547d\u4ee4\u5c31\u662f ENTRYPOINT \u811a\u672c\u7684\u53c2\u6570\u3002\u53cd\u8fc7\u6765\uff0c\u7531\u4e8e ENTRYPOINT \u811a\u672c\u7684\u53c2\u6570\u5c31\u662f CMD \u6307\u4ee4\u4e2d\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u5b9e\u9645\u6267\u884c\u7684\u5c31\u662f CMD \u91cc\u7684\u547d\u4ee4\u3002\n\n\u6240\u4ee5\u8bf4\uff0c\u867d\u7136 Docker \u5bf9\u5bb9\u5668\u542f\u52a8\u547d\u4ee4\u7684\u7ed3\u5408\u673a\u5236\u4e3a CMD \u4f5c\u4e3a ENTRYPOINT \u7684\u53c2\u6570\uff0c\u5408\u5e76\u540e\u6267\u884c ENTRYPOINT \u4e2d\u7684\u5b9a\u4e49\uff0c\u4f46\u5b9e\u9645\u5728\u6211\u4eec\u4f7f\u7528\u4e2d\uff0c\u6211\u4eec\u8fd8\u4f1a\u5728 ENTRYPOINT \u7684\u811a\u672c\u91cc\u4ee3\u7406\u5230 CMD \u547d\u4ee4\u4e0a\u3002\n\n\u76f8\u5bf9\u6765\u8bf4\uff0cRedis \u7684 ENTRYPOINT \u5185\u5bb9\u8fd8\u662f\u7b80\u5355\u7684\uff0c\u5728\u638c\u63e1\u4e86 ENTRYPOINT \u7684\u76f8\u5173\u4f5c\u7528\u540e\uff0c\u5927\u5bb6\u53ef\u4ee5\u5c1d\u8bd5\u9605\u8bfb\u548c\u7f16\u5199\u4e00\u4e9b\u590d\u6742\u7684 ENTRYPOINT \u811a\u672c\u3002\n\n## \u4e34\u6479\u6848\u4f8b\n\n\u4e0a\u9762\u63d0\u53ca\u7684\u51e0\u9879\u53ea\u662f\u51e0\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684 Dockerfile \u6700\u4f73\u5b9e\u8df5\uff0c\u5176\u5b9e\u5728\u7f16\u5199 Dockerfile \u65f6\uff0c\u8fd8\u6709\u5f88\u591a\u4e0d\u6210\u6587\u7684\u5c0f\u6280\u5de7\u3002\n\n\u60f3\u8981\u5b66\u597d Dockerfile \u7684\u7f16\u5199\uff0c\u9605\u8bfb\u548c\u601d\u8003\u524d\u4eba\u7684\u4f5c\u54c1\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002\n\n\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86\uff0cDocker \u5b98\u65b9\u63d0\u4f9b\u7684 Docker Hub \u662f Docker \u955c\u50cf\u7684\u4e2d\u592e\u4ed3\u5e93\uff0c\u5b83\u9664\u4e86\u955c\u50cf\u4e30\u5bcc\u4e4b\u5916\uff0c\u7ed9\u6211\u4eec\u5e26\u6765\u7684\u53e6\u4e00\u9879\u597d\u5904\u5c31\u662f\u5176\u5927\u90e8\u5206\u955c\u50cf\u90fd\u662f\u80fd\u591f\u76f4\u63a5\u63d0\u4f9b Dockerfile \u6587\u4ef6\u7ed9\u6211\u4eec\u53c2\u8003\u7684\u3002\n\n\u8981\u5f97\u5230\u955c\u50cf\u7684 Dockerfile \u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u5165\u5230\u955c\u50cf\u7684\u8be6\u60c5\u9875\u9762\uff0c\u5728\u4ecb\u7ecd\u4e2d\uff0c\u955c\u50cf\u4f5c\u8005\u4eec\u901a\u5e38\u4f1a\u76f4\u63a5\u628a Dockerfile \u7684\u8fde\u63a5\u653e\u5728\u90a3\u91cc\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/16637944f4705632?w=709&h=583&f=png&s=41150)\n\n\u9664\u6b64\u4e4b\u5916\uff0c\u8fdb\u5165\u5230 Dockerfile \u8fd9\u4e2a\u680f\u76ee\u4e0b\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u76f4\u63a5\u770b\u5230\u955c\u50cf Dockerfile \u7684\u5185\u5bb9\u3002\u5728\u9875\u9762\u7684\u53f3\u4fa7\uff0c\u8fd8\u6709\u8fdb\u5165 Dockerfile \u6e90\u6587\u4ef6\u7684\u8fde\u63a5\uff0c\u5982\u679c\u5728 Dockerfile \u4e2d\u6709\u5f15\u5165\u5176\u4ed6\u7684\u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u8fde\u63a5\u8bbf\u95ee\u5230\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/3/166379581300d9e0?w=1264&h=675&f=png&s=62662)\n\n\u53e6\u5916\uff0c\u6211\u81ea\u5df1\u4e5f\u5236\u4f5c\u4e86\u4e00\u4e9b\u8f6f\u4ef6\u7684\u955c\u50cf\uff0c\u5927\u5bb6\u53ef\u4ee5\u8bbf\u95ee GitHub \u4e0a\u7684\u9879\u76ee\u5730\u5740\uff0c\u67e5\u9605\u5176\u4e2d\u7684 Dockerfile \u5185\u5bb9\uff1a[https://github.com/cogset](https://github.com/cogset) \u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u5728\u5f00\u53d1\u4e2d\u4f7f\u7528 Dockerfile \u7684\u4e00\u4e9b\u6280\u5de7\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> \u5728\u5e38\u89c1\u7684\u955c\u50cf\u6784\u5efa\u4e2d\uff0c\u6211\u4eec\u5982\u4f55\u5408\u7406\u7ec4\u5408 ENTRYPOINT \u548c CMD \u5e76\u5206\u914d\u5b83\u4eec\u7684\u5de5\u4f5c\u5462\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u4e0a\u8ff0\u6211\u4eec\u63d0\u53ca\u7684 Dockerfile \u4f7f\u7528\u6280\u5de7\u8fd8\u6709\u4e0d\u7406\u89e3\u7684\u5730\u65b9\uff0c\u6216\u8005\u6709\u5176\u4ed6\u7684\u6280\u5de7\u60f3\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u64cd\u4f5c\u955c\u50cf\u5e38\u89c1\u7684_Dockerfile_\u4f7f\u7528\u6280\u5de7.md", "create_date": "2020-02-18T21:18:39.019", "order": 13}}, {"model": "subject.chapter", "pk": 64, "fields": {"title": "\u5b9e\u8df5\u4e4b\u8def\uff1a\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u4f7f\u7528\u670d\u52a1\u53d1\u73b0", "topic": 3, "md5": "9a238cedbe12e88140e9a0b974f7b088", "md_body": "# \u5728\u5f00\u53d1\u73af\u5883\u4e2d\u4f7f\u7528\u670d\u52a1\u53d1\u73b0\n\n\u670d\u52a1\u53d1\u73b0\u5e94\u7528\u662f\u5f88\u591a\u670d\u52a1\u5316\u7cfb\u7edf\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u6240\u4ee5\u5728\u5f00\u53d1\u3001\u6d4b\u8bd5\u73af\u5883\u4e2d\u4e5f\u5c31\u6709\u5fc5\u8981\u914d\u5907\u4e00\u5957\u670d\u52a1\u53d1\u73b0\u4f53\u7cfb\u6765\u914d\u5408\u6211\u4eec\u7684\u5f00\u53d1\u3001\u6d4b\u8bd5\u5de5\u4f5c\u3002\u5728\u8fd9\u4e00\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u5c31\u6765\u8c08\u8c08\u5982\u4f55\u5728 Docker \u73af\u5883\u4e0b\u90e8\u7f72\u670d\u52a1\u53d1\u73b0\u5e94\u7528\u3002\n\n## \u4f7f\u7528 Docker Compose \u6a21\u62df Zookeeper \u96c6\u7fa4\n\n\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u7684\u65b9\u6cd5\u6709\u5f88\u591a\u79cd\uff0c\u5176\u4e2d\u8f83\u4e3a\u5e38\u89c1\u7684\u4e00\u79cd\u662f\u5229\u7528\u5206\u5e03\u5f0f\u6ce8\u518c\u4e2d\u5fc3\uff0c\u89e3\u51b3\u670d\u52a1\u4e4b\u95f4\u534f\u8c03\u7684\u95ee\u9898\u3002\n\n\u5728\u4f17\u591a\u6ce8\u518c\u4e2d\u5fc3\u5e94\u7528\u4e2d\uff0cZookeeper \u662f\u8f83\u4e3a\u5e38\u89c1\u548c\u5e38\u7528\u7684\u4e00\u6b3e\u7a0b\u5e8f\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u4ee5 Zookeeper \u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Docker \u642d\u5efa Zookeeper \u7684\u8fd0\u884c\u73af\u5883\u3002\n\n### \u8bbe\u8ba1\u76ee\u5f55\u7ed3\u6784\n\n\u7531\u4e8e Zookeeper \u7684\u8fd0\u884c\u5e76\u4e0d\u9700\u8981\u592a\u591a\u7684\u5173\u6ce8\u914d\u7f6e\u548c\u8c03\u6574\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u4ee5\u6700\u57fa\u7840\u7684\u5f62\u5f0f\u6765\u8bbe\u8ba1 Docker Compose \u9879\u76ee\u7684\u7ed3\u6784\u3002\n\n```\n\u2514\u2500 project\n   \u251c\u2500 bin\n   \u2502  \u2514\u2500 compose.sh\n   \u2514\u2500 compose\n      \u2514\u2500 docker-compose.yml\n\n```\n\n\u4e3a\u4e86\u65b9\u4fbf\u65e5\u5e38\u64cd\u4f5c\uff0c\u6211\u4eec\u4f9d\u7136\u7f16\u5199\u4e86 [compose.sh](http://compose.sh) \u8fd9\u4e2a\u811a\u672c\u6765\u8f85\u52a9\u6211\u4eec\u63a7\u5236 Docker Compose \u9879\u76ee\u3002\n\n### \u7f16\u5199 docker-compose.yml\n\n\u5f88\u591a\u8bfb\u8005\u4f1a\u95ee\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u600e\u4e48\u6837\u624d\u80fd\u901a\u8fc7 Docker \u7684\u865a\u62df\u5316\u6280\u672f\u5b9e\u73b0\u5728\u4e00\u4e2a\u673a\u5668\u4e0a\u6a21\u62df\u51fa\u591a\u53f0\u673a\u5668\u7684\u6548\u679c\u3002\u6216\u8005\u8bf4\u4e00\u4e2a\u6211\u4eec\u8fd9\u91cc\u4f1a\u6d89\u53ca\u7684\u5177\u4f53\u95ee\u9898\uff0c\u5982\u4f55\u53ea\u7528\u4e00\u4e2a Docker \u6765\u6a21\u62df\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684 Zookeeper \u96c6\u7fa4\u3002\n\n\u6211\u4eec\u77e5\u9053\uff0c\u8981\u5b9e\u73b0 Zookeeper \u7684\u9ad8\u53ef\u7528\uff0c\u81f3\u5c11\u9700\u8981\u4e09\u4e2a Zookeeper \u8282\u70b9\u8fdb\u884c\u534f\u4f5c\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u7528\u4e09\u4e2a\u5355\u72ec\u7684 Docker Compose \u670d\u52a1\u5b9a\u4e49\u6765\u5206\u522b\u5b9a\u4e49\u8fd9\u4e09\u4e2a\u8282\u70b9\u3002\n\n```\nversion: '3'\n\nservices:\n\n  zk1:\n    image: zookeeper:3.4\n    restart: always\n    hostname: zk1\n    environment:\n      ZOO_MY_ID: 1\n      ZOO_SERVERS: server.1=0.0.0.0:2888:3888 server.2=zk2:2888:3888 server.3=zk3:2888:3888\n    ports:\n      - 2181:2181\n\n  zk2:\n    image: zookeeper:3.4\n    restart: always\n    hostname: zk2\n    environment:\n      ZOO_MY_ID: 2\n      ZOO_SERVERS: server.1=zk1:2888:3888 server.2=0.0.0.0:2888:3888 server.3=zk3:2888:3888\n    ports:\n      - 2182:2181\n\n  zk3:\n    image: zookeeper:3.4\n    restart: always\n    hostname: zk3\n    environment:\n      ZOO_MY_ID: 3\n      ZOO_SERVERS: server.1=zk1:2888:3888 server.2=zk2:2888:3888 server.3=0.0.0.0:2888:3888\n    ports:\n      - 2183:2181\n\n```\n\n\u5728\u8fd9\u4e2a Docker Compose \u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u7684\u4e09\u4e2a Zookeeper \u670d\u52a1\u90fd\u76f4\u63a5\u4f7f\u7528\u4e86\u5b98\u65b9\u5236\u4f5c\u7684 zookeeper \u955c\u50cf\u3002\n\n\u5728\u8fd9\u4e2a\u955c\u50cf\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u7559\u610f\u5b9a\u5236 ZOO\\_MY\\_ID \u548c ZOO\\_SERVERS \u8fd9\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\u3002\u8fd9\u4e24\u4e2a\u53d8\u91cf\u4e3b\u8981\u662f\u7528\u6765\u8bc6\u522b Zookeeper \u96c6\u7fa4\u4e2d\u4e0d\u540c Zookeeper \u7a0b\u5e8f\u7684\u3002\n\n\u5176\u4e2d ZOO\\_MY\\_ID \u662f Zookeeper \u5728\u96c6\u7fa4\u4e2d\u7684\u7f16\u53f7\uff0c\u800c ZOO\\_SERVERS \u7528\u6765\u5b9a\u4e49\u96c6\u7fa4\u4e2d\u7684\u6240\u6709 Zookeeper \u53ca\u5b83\u4eec\u7684\u8fde\u63a5\u65b9\u5f0f\u3002\n\n\u6211\u4eec\u4ee5 zk1 \u8fd9\u4e2a\u670d\u52a1\u4e3a\u4f8b\u6765\u89e3\u91ca\u4e00\u4e0b ZOO\\_SERVERS \u7684\u5b9a\u4e49\u65b9\u6cd5\u3002\n\n```\nserver.1=0.0.0.0:2888:3888 server.2=zk2:2888:3888 server.3=zk3:2888:3888\n\n```\n\n\u6211\u4eec\u53ef\u4ee5\u5728 ZOO\\_SERVERS \u4e2d\u5b9a\u4e49\u6240\u6709\u5904\u4e8e Zookeeper \u96c6\u7fa4\u4e2d\u7684\u7a0b\u5e8f\uff0c\u901a\u8fc7\u7a7a\u683c\u6765\u95f4\u9694\u5b83\u4eec\u3002\u800c\u6bcf\u4e2a\u670d\u52a1\u7684\u7684\u5b9a\u4e49\u5f62\u5f0f\u4e3a `server.[id]=[host]:[port]:[port]`\uff0c\u6240\u4ee5\u5c31\u6709\u4e86\u4e0a\u9762\u4f8b\u5b50\u4e2d\u6211\u4eec\u770b\u5230\u7684\u6837\u5b50\u3002\n\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u63cf\u8ff0\u4e86\u4e09\u4e2a Zookeeper \u7a0b\u5e8f\u7684\u8fde\u63a5\u5730\u5740\u3002\n\n\u7531\u4e8e\u6bcf\u4e2a\u5bb9\u5668\u90fd\u6709\u72ec\u7acb\u7684\u7aef\u53e3\u8868\uff0c\u6240\u4ee5\u5373\u4f7f\u8fd9\u4e9b\u7a0b\u5e8f\u90fd\u8fd0\u884c\u5728\u4e00\u4e2a\u4e3b\u673a\u91cc\uff0c\u6211\u4eec\u4f9d\u7136\u4e0d\u9700\u8981\u62c5\u5fc3\uff0c\u5b83\u4eec\u4f1a\u9020\u6210\u7aef\u53e3\u7684\u51b2\u7a81\u3002\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u9ed8\u8ba4\u7684 2888 \u548c 3888 \u6765\u8fdb\u884c\u670d\u52a1\u95f4\u7684\u76f8\u4e92\u901a\u4fe1\u5373\u53ef\u3002\n\n\u800c\u5728\u8fdb\u884c\u5bb9\u5668\u4e92\u8054\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Docker \u7684\u89e3\u6790\u673a\u5236\uff0c\u76f4\u63a5\u586b\u5165\u5bf9\u5e94\u670d\u52a1\u7684\u540d\u79f0\u66ff\u4ee3\u5b83\u4eec\u7684 IP \u5730\u5740\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e2a\u4f8b\u5b50\u91cc\u7684 zk2 \u548c zk3\u3002\n\n### \u91cd\u542f\u673a\u5236\n\n\u5728\u9879\u76ee\u5b9a\u4e49\u4e2d\uff0c\u6211\u4eec\u8fd8\u6ce8\u610f\u5230\u4e86 `restart: always` \u8fd9\u4e2a\u914d\u7f6e\uff0c\u8fd9\u4e2a\u914d\u7f6e\u4e3b\u8981\u662f\u7528\u6765\u63a7\u5236\u5bb9\u5668\u7684\u91cd\u542f\u7b56\u7565\u7684\u3002\n\n\u8fd9\u91cc\u7684 always \u6307\u7684\u662f\u4e0d\u8bba\u4efb\u4f55\u60c5\u51b5\uff0c\u5bb9\u5668\u51fa\u73b0\u95ee\u9898\u540e\u90fd\u4f1a\u81ea\u52a8\u91cd\u542f\uff0c\u4e5f\u5305\u62ec Docker \u670d\u52a1\u672c\u8eab\u5728\u542f\u52a8\u540e\u5bb9\u5668\u4e5f\u4f1a\u81ea\u52a8\u542f\u52a8\u3002\n\n\u53e6\u5916\uff0crestart \u8fd8\u652f\u6301\u51e0\u79cd\u914d\u7f6e\uff1a\n\n\u914d\u7f6e\u503c\n\n\u8bf4\u660e\n\nno\n\n\u4e0d\u8bbe\u91cd\u542f\u673a\u5236\n\nalways\n\n\u603b\u662f\u91cd\u542f\n\non-failure\n\n\u5728\u5f02\u5e38\u9000\u51fa\u65f6\u91cd\u542f\n\nunless-stopped\n\n\u9664\u975e\u7531\u505c\u6b62\u547d\u4ee4\u7ed3\u675f\uff0c\u5176\u4ed6\u60c5\u51b5\u90fd\u91cd\u542f\n\n\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u4e0d\u540c\u7684\u91cd\u542f\u7b56\u7565\u3002\n\n\u800c\u8fd9\u4e2a\u9879\u76ee\u91cc\uff0c\u6211\u4eec\u5e0c\u671b Zookeeper \u80fd\u591f\u4e00\u76f4\u5065\u58ee\u7684\u8fd0\u884c\uff0c\u6240\u4ee5\u4f7f\u7528\u4e86 always \u8fd9\u4e2a\u91cd\u542f\u7b56\u7565\u3002\n\n## \u542f\u52a8\u9879\u76ee\n\n\u4e00\u5207\u5c31\u7eea\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 Docker Compose \u7684\u547d\u4ee4\u6765\u542f\u52a8\u5f00\u53d1\u73af\u5883\u4e86\u3002\n\n```\n# ./bin/compose.sh up -d\n\n```\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u8fd9\u8282\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86\u5728\u5f00\u53d1\u4e2d\u4f7f\u7528 Docker \u90e8\u7f72\u670d\u52a1\u53d1\u73b0\u5de5\u5177\u7684\u8fc7\u7a0b\uff0c\u4e0b\u9762\u5c31\u662f\u5927\u5bb6\u81ea\u5df1\u52a8\u624b\u8fdb\u884c\u5b9e\u8df5\u7684\u65f6\u5019\u4e86\u3002\n\n\u672c\u5c0f\u8282\u4e2d\u7684\u793a\u4f8b\uff0c\u5df2\u7ecf\u66f4\u65b0\u5230\u4e86\uff1a\n\n[https://github.com/youmingdot/docker-book-for-developer-samples](https://github.com/youmingdot/docker-book-for-developer-samples)\n\n\u5927\u5bb6\u53ef\u4ee5\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u7684\u7528\u5176\u4f5c\u4e3a\u53c2\u8003\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u5927\u5bb6\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u9047\u5230\u56f0\u96be\uff0c\u6216\u8005\u6709\u81ea\u5df1\u7684\u5b9e\u8df5\u5fc3\u5f97\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u5b9e\u8df5\u4e4b\u8def\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u4f7f\u7528\u670d\u52a1\u53d1\u73b0.md", "create_date": "2020-02-18T21:18:39.057", "order": 20}}, {"model": "subject.chapter", "pk": 65, "fields": {"title": "\u5b9e\u8df5\u4e4b\u8def\uff1a\u642d\u5efa Java Web \u9879\u76ee\u8fd0\u884c\u73af\u5883", "topic": 3, "md5": "0ea35ac6e4c6c57bec7dcd7d32fd9040", "md_body": "# \u642d\u5efa Java Web \u9879\u76ee\u8fd0\u884c\u73af\u5883\n\nJava Web \u6cdb\u6307\u4ee5 Java \u7a0b\u5e8f\u4e3a\u57fa\u7840\u5411\u5916\u63d0\u4f9b Web \u670d\u52a1\u7684\u6280\u672f\u53ca\u76f8\u5173\u5de5\u5177\uff0c\u72ed\u4e49\u4e0a\u6765\u8bf4\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8bf4 Java Web \u662f\u7531 Servlet \u7a0b\u5e8f\u63d0\u4f9b\u7684 Web \u670d\u52a1\u3002 \u5bf9\u6211\u4eec\u800c\u8a00\uff0cTomcat \u65e0\u7591\u662f\u6700\u5e38\u89c1\u7684 Servlet \u5bb9\u5668\uff0c\u6240\u4ee5\u5728\u8fd9\u4e2a\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u6765\u642d\u5efa\u4e00\u4e2a\u4ee5 Tomcat \u4e3a\u6838\u5fc3\u7684 Web \u5e94\u7528\u8fd0\u884c\u73af\u5883\u3002 \u5728\u8fd9\u4e2a\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u8fd8\u8981\u7ec4\u5408\u8fdb MySQL \u4f5c\u4e3a\u6570\u636e\u5b58\u50a8\uff0cRedis \u4f5c\u4e3a KV \u5b58\u50a8\u3002\n\n## \u5b9a\u4e49\u9879\u76ee\u7ed3\u6784\n\n\u4e0e\u4e4b\u524d\u6211\u4eec\u63d0\u53ca\u7684\u4e00\u6837\uff0c\u8981\u642d\u5efa\u8fd9\u6837\u7684\u7531\u591a\u4e2a\u7a0b\u5e8f\u6240\u534f\u4f5c\u7ec4\u6210\u7684\u5f00\u53d1\u73af\u5883\uff0c\u4f7f\u7528 Docker Compose \u662f\u6700\u4f73\u7684\u9009\u62e9\u3002\n\n\u5efa\u7acb Docker Compose \u9879\u76ee\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u89c4\u5212\u4e00\u4e0b\u9879\u76ee\u7684\u76ee\u5f55\u7ed3\u6784\u3002 \u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u503e\u5411\u4e8e\u5c06\u4e0e\u9879\u76ee\u6709\u5173\u7684\u5185\u5bb9\u96c6\u5408\u5230\u540c\u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\uff0c\u8fd9\u6837\u7684\u505a\u6709\u51e0\u70b9\u597d\u5904\uff1a\n\n*   \u9879\u76ee\u5185\u5bb9\u6e05\u6670\u660e\u786e\uff0c\u590d\u5236\u3001\u8fc1\u79fb\u548c\u4e0e\u4ed6\u4eba\u5171\u4eab\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u53d1\u751f\u9057\u6f0f\u7684\u60c5\u51b5\uff1b\n*   \u5728\u5b9a\u4e49 Docker Compose \u9879\u76ee\u65f6\u53ef\u4ee5\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\uff0c\u8ba9\u5171\u4eab\u3001\u8fc1\u79fb\u540e\u6574\u4e2a\u9879\u76ee\u53ef\u4ee5\u4e0d\u9700\u8981\u989d\u5916\u64cd\u4f5c\u5c31\u80fd\u8fd0\u884c\u3002\n\n\u5728\u8fd9\u4e9b\u7684\u57fa\u7840\u4e0a\uff0c\u6211\u7ed9\u51fa\u4e00\u4e2a\u5efa\u8bae\u6027\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u4f9b\u5927\u5bb6\u53c2\u8003\u3002\n\n```\n\u2514\u2500 project\n   \u251c\u2500 app\n   \u251c\u2500 compose\n   \u2502  \u2514\u2500 docker-compose.yml\n   \u251c\u2500 mysql\n   \u2502  \u2514\u2500 my.cnf\n   \u251c\u2500 redis\n   \u2502  \u2514\u2500 redis.conf\n   \u2514\u2500 tomcat\n      \u251c\u2500 server.xml\n      \u2514\u2500 web.xml\n\n```\n\n\u8bbe\u8ba1\u8fd9\u6837\u4e00\u4e2a\u76ee\u5f55\u7ed3\u6784\u7684\u4e3b\u8981\u76ee\u7684\u662f\u5c06\u4e0d\u540c\u7a0b\u5e8f\u7684\u914d\u7f6e\u8fdb\u884c\u533a\u5206\uff0c\u8fd9\u4e0e\u6211\u4eec\u4e4b\u540e\u4f1a\u901a\u8fc7\u591a\u4e2a\u7a0b\u5e8f\u6240\u5173\u8054\u7684\u955c\u50cf\u53ca\u5bb9\u5668\u6765\u7ec4\u5408\u8fd9\u5957\u73af\u5883\u7684\u8109\u7edc\u662f\u76f8\u5951\u5408\u7684\u3002\n\n\u5728\u8fd9\u4e2a\u76ee\u5f55\u7ed3\u6784\u4e2d\uff0c\u533a\u5206\u4e86 5 \u4e2a\u9876\u5c42\u76ee\u5f55\uff1a\n\n*   **app** \uff1a\u7528\u4e8e\u5b58\u653e\u7a0b\u5e8f\u5de5\u7a0b\uff0c\u5373\u4ee3\u7801\u3001\u7f16\u8bd1\u7ed3\u679c\u4ee5\u53ca\u76f8\u5173\u7684\u5e93\u3001\u5de5\u5177\u7b49\uff1b\n*   **compose** \uff1a\u7528\u4e8e\u5b9a\u4e49 Docker Compose \u9879\u76ee\uff1b\n*   **mysql** \uff1a\u4e0e MySQL \u76f8\u5173\u914d\u7f6e\u7b49\u5185\u5bb9\uff1b\n*   **redis** \uff1a\u4e0e Redis \u76f8\u5173\u914d\u7f6e\u7b49\u5185\u5bb9\uff1b\n*   **tomcat** \uff1a\u4e0e Tomcat \u76f8\u5173\u914d\u7f6e\u7b49\u5185\u5bb9\u3002\n\n## \u51c6\u5907\u7a0b\u5e8f\u914d\u7f6e\n\n\u4e3a\u4e86\u66f4\u65b9\u4fbf\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5bf9 MySQL\u3001Redis\u3001Tomcat \u7a0b\u5e8f\u672c\u8eab\uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u5c06\u5b83\u4eec\u7684\u6838\u5fc3\u914d\u7f6e\u653e\u7f6e\u5230\u9879\u76ee\u91cc\uff0c\u518d\u901a\u8fc7\u6302\u8f7d\u7684\u65b9\u5f0f\u6620\u5c04\u5230\u5bb9\u5668\u4e2d\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u6211\u4eec\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u91cc\u76f4\u63a5\u4fee\u6539\u8fd9\u4e9b\u914d\u7f6e\uff0c\u65e0\u987b\u518d\u8fdb\u5165\u5230\u5bb9\u5668\u4e2d\u4e86\u3002\n\n\u57fa\u4e8e\u6b64\uff0c\u6211\u4eec\u5728\u5b8c\u6210\u76ee\u5f55\u7684\u8bbe\u8ba1\u4e4b\u540e\uff0c\u9996\u8981\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u662f\u51c6\u5907\u597d\u8fd9\u4e9b\u7a0b\u5e8f\u4e2d\u4f1a\u7ecf\u5e38\u53d8\u52a8\u7684\u914d\u7f6e\uff0c\u5e76\u628a\u5b83\u4eec\u653e\u7f6e\u5728\u7a0b\u5e8f\u5bf9\u5e94\u7684\u76ee\u5f55\u4e4b\u4e2d\u3002\n\n\u6211\u4eec\u5e38\u7528\u4e0b\u5217\u51e0\u79cd\u65b9\u5f0f\u6765\u83b7\u5f97\u7a0b\u5e8f\u7684\u914d\u7f6e\u6587\u4ef6\uff1a\n\n*   \u501f\u52a9\u914d\u7f6e\u6587\u6863\u76f4\u63a5\u7f16\u5199\n*   \u4e0b\u8f7d\u7a0b\u5e8f\u6e90\u4ee3\u7801\u4e2d\u7684\u914d\u7f6e\u6837\u4f8b\n*   \u901a\u8fc7\u5bb9\u5668\u4e2d\u7684\u9ed8\u8ba4\u914d\u7f6e\u83b7\u5f97\n\n\u4e0b\u9762\u6211\u4eec\u6765\u5c55\u793a\u4e00\u4e0b\u8fd9\u51e0\u79cd\u83b7\u53d6\u914d\u7f6e\u7684\u65b9\u5f0f\u3002\n\n### \u501f\u52a9\u914d\u7f6e\u6587\u6863\u76f4\u63a5\u7f16\u5199\n\n\u8fd9\u91cc\u6211\u4eec\u5229\u7528 MySQL \u6587\u6863\u4e2d\u914d\u7f6e\u6587\u4ef6\u7684\u4ecb\u7ecd\u90e8\u5206\uff0c\u6765\u7f16\u5199\u4e00\u4e2a MySQL \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\n\u6211\u4eec\u5148\u627e\u5230 MySQL \u6587\u6863\u4e2d\u5173\u4e8e\u914d\u7f6e\u6587\u4ef6\u7684\u53c2\u8003\uff0c\u4e5f\u5c31\u662f\u4e0b\u9762\u8fd9\u4e2a\u5730\u5740\uff1a\n\n[https://dev.mysql.com/doc/refman/5.7/en/server-options.html](https://dev.mysql.com/doc/refman/5.7/en/server-options.html)\n\n\u6211\u4eec\u6839\u636e\u8fd9\u4e9b\u5185\u5bb9\uff0c\u9009\u53d6\u8ddf\u6211\u4eec\u7a0b\u5e8f\u8fd0\u884c\u6709\u5f71\u54cd\u7684\u51e0\u9879\u9700\u8981\u4fee\u6539\u7684\u53c2\u6570\uff0c\u7f16\u5199\u6210 MySQL \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\n```\n# ./mysql/my.cnf\n\n[mysqld_safe]\npid-file = /var/run/mysqld/mysqld.pid\nsocket   = /var/run/mysqld/mysqld.sock\nnice     = 0\n\n[mysqld]\nskip-host-cache\nskip-name-resolve\nexplicit_defaults_for_timestamp\n\nbind-address = 0.0.0.0\nport         = 3306\n\nuser      = mysql\npid-file  = /var/run/mysqld/mysqld.pid\nsocket    = /var/run/mysqld/mysqld.sock\nlog-error = /var/log/mysql/error.log\nbasedir   = /usr\ndatadir   = /var/lib/mysql\ntmpdir    = /tmp\nsql_mode  = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\n\nlc-messages-dir = /usr/share/mysql\n\nsymbolic-links = 0\n\n```\n\n\u4f7f\u7528\u8f6f\u4ef6\u7684\u6587\u6863\u6765\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\uff0c\u5176\u4f18\u52bf\u5728\u4e8e\u5728\u7f16\u5199\u7684\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u4e5f\u662f\u6211\u4eec\u719f\u6089\u8f6f\u4ef6\u7684\u8fc7\u7a0b\uff0c\u901a\u8fc7\u914d\u7f6e\u52a0\u6587\u6863\u5f62\u5f0f\u7684\u9605\u8bfb\uff0c\u4f60\u4e00\u5b9a\u4f1a\u4ece\u4e2d\u6536\u83b7\u5f88\u591a\u3002 \u5f53\u7136\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e5f\u6709\u5f88\u5927\u7684\u52a3\u52bf\uff0c\u5373\u9700\u8981\u4ed4\u7ec6\u9605\u8bfb\u6587\u6863\uff0c\u52b3\u795e\u52b3\u529b\uff0c\u5bf9\u4e8e\u5e38\u89c4\u5f00\u53d1\u4e2d\u7684\u4f7f\u7528\u6765\u8bf4\uff0c\u6210\u6548\u6bd4\u5f88\u4f4e\u3002\n\n### \u4e0b\u8f7d\u7a0b\u5e8f\u6e90\u4ee3\u7801\u4e2d\u7684\u914d\u7f6e\u6837\u4f8b\n\n\u9664\u4e86\u901a\u8fc7\u914d\u7f6e\u6587\u6863\u6765\u4e86\u89e3\u8f6f\u4ef6\u7684\u914d\u7f6e\u5916\uff0c\u5927\u90e8\u5206\u8f6f\u4ef6\uff0c\u7279\u522b\u662f\u5f00\u6e90\u8f6f\u4ef6\u90fd\u4f1a\u76f4\u63a5\u7ed9\u51fa\u4e00\u4efd\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u4f5c\u4e3a\u53c2\u8003\u3002 \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u5230\u8fd9\u4efd\u914d\u7f6e\uff0c\u8fbe\u5230\u6211\u4eec\u7684\u76ee\u7684\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u4ee5 Redis \u4e3a\u4f8b\uff0c\u5728 Redis \u6e90\u4ee3\u7801\u4e2d\uff0c\u5c31\u5305\u542b\u4e86\u4e00\u4efd\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u4f7f\u7528\uff1a\n\n[https://github.com/antirez/redis/blob/3.2/redis.conf](https://github.com/antirez/redis/blob/3.2/redis.conf)\n\n\u5728\u62ff\u5230\u8fd9\u662f\u9ed8\u8ba4\u7684\u914d\u7f6e\u540e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6839\u636e\u9700\u8981\u5bf9\u5176\u4e2d\u7684\u90e8\u5206\u914d\u7f6e\u8fdb\u884c\u4fee\u6539\uff0c\u4ee5\u66f4\u597d\u7684\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u4ee5\u4fee\u6539 Redis \u7684\u5bc6\u7801\u4e3a\u4f8b\u3002 \u6253\u5f00\u914d\u7f6e\u6587\u4ef6\uff0c\u627e\u5230\u5b9a\u4e49 Redis \u6388\u6743\u6388\u6743\u7684\u5730\u65b9\uff0c\u5c06\u5bc6\u7801\u4fee\u6539\u4e3a\u6211\u4eec\u9700\u8981\u7684\u5185\u5bb9\u3002\n\n```\n# ./redis/redis.conf\n##...\n################################## SECURITY ###################################\n\n# Require clients to issue AUTH <PASSWORD> before processing any other\n# commands.  This might be useful in environments in which you do not trust\n# others with access to the host running redis-server.\n#\n# This should stay commented out for backward compatibility and because most\n# people do not need auth (e.g. they run their own servers).\n#\n# Warning: since Redis is pretty fast an outside user can try up to\n# 150k passwords per second against a good box. This means that you should\n# use a very strong password otherwise it will be very easy to break.\n#\nrequirepass my-secret-pw\n##...\n\n```\n\n\u76f8\u5bf9\u4e8e\u901a\u8fc7\u914d\u7f6e\u6587\u6863\u83b7\u5f97\u914d\u7f6e\uff0c\u4ece\u914d\u7f6e\u793a\u4f8b\u91cc\u83b7\u5f97\u914d\u7f6e\u8981\u6765\u5f97\u66f4\u4e3a\u7b80\u5355\u5bb9\u6613\u3002 \u4f46\u5176\u4e5f\u6709\u4e00\u5b9a\u7684\u9650\u5236\uff0c\u65e2\u8981\u5bf9\u4e8e\u7684\u7a0b\u5e8f\u80fd\u591f\u63d0\u4f9b\u8fd9\u6837\u7684\u793a\u4f8b\u914d\u7f6e\uff0c\u53c8\u8981\u6211\u4eec\u80fd\u591f\u987a\u5229\u627e\u5230\u8fd9\u4e9b\u914d\u7f6e\u6587\u4ef6\u3002\n\n### \u901a\u8fc7\u5bb9\u5668\u4e2d\u7684\u9ed8\u8ba4\u914d\u7f6e\u83b7\u5f97\n\n\u9664\u4e86\u4ece\u5b98\u65b9\u624b\u518c\u6216\u8005\u914d\u7f6e\u793a\u4f8b\u4e2d\u83b7\u5f97\u914d\u7f6e\u6587\u4ef6\u5916\uff0c\u6211\u4eec\u8fd8\u6709\u4e00\u79cd\u8fdc\u5728\u5929\u8fb9\u8fd1\u5728\u773c\u524d\u7684\u83b7\u53d6\u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u6cd5\u3002 \u5927\u591a\u6570 Docker \u955c\u50cf\u4e3a\u4e86\u5b9e\u73b0\u81ea\u8eab\u80fd\u591f\u76f4\u63a5\u542f\u52a8\u4e3a\u5bb9\u5668\u5e76\u9a6c\u4e0a\u63d0\u4f9b\u670d\u52a1\uff0c\u4f1a\u628a\u9ed8\u8ba4\u914d\u7f6e\u76f4\u63a5\u6253\u5305\u5230\u955c\u50cf\u4e2d\uff0c\u4ee5\u4fbf\u8ba9\u7a0b\u5e8f\u80fd\u591f\u76f4\u63a5\u8bfb\u53d6\u3002 \u6240\u4ee5\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4ece\u955c\u50cf\u91cc\u62ff\u5230\u8fd9\u4efd\u914d\u7f6e\uff0c\u62f7\u8d1d\u5230\u5bbf\u4e3b\u673a\u91cc\u5907\u7528\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u4ee5\u6700\u540e\u4e00\u4e2a\u5c1a\u672a\u51fa\u573a\u7684 Tomcat \u4e3a\u4f8b\uff0c\u8bf4\u8bf4\u5982\u4f55\u4ece Tomcat \u955c\u50cf\u91cc\u62ff\u5230\u914d\u7f6e\u6587\u4ef6\u3002\n\n\u8981\u62ff\u5230 Tomcat \u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u7684 Tomcat \u5bb9\u5668\u3002\n\n```\n# docker run --rm -d --name temp-tomcat tomcat:8.5 \n\n```\n\n\u8fd9\u91cc\u6211\u4eec\u5c06\u5bb9\u5668\u547d\u540d\u4e3a temp-tomcat \u4ee5\u4fbf\u6211\u4eec\u4e4b\u540e\u7684\u64cd\u4f5c\u3002\n\n\u5bf9\u4e8e Tomcat \u6765\u8bf4\uff0c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6211\u4eec\u53ef\u80fd\u4f1a\u7ecf\u5e38\u6539\u52a8\u7684\u914d\u7f6e\u4e3b\u8981\u662f server.xml \u548c web.xml \u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u628a\u8fd9\u4e24\u4e2a\u6587\u4ef6\u4ece\u5bb9\u5668\u4e2d\u590d\u5236\u5230\u5bbf\u4e3b\u673a\u91cc\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u4f1a\u7528\u5230 `docker cp` \u8fd9\u4e2a\u547d\u4ee4\uff0c`docker cp` \u80fd\u591f\u5728\u5bb9\u5668\u4e0e\u5bbf\u4e3b\u673a\u7684\u6587\u4ef6\u7cfb\u7edf\u95f4\u62f7\u8d1d\u6587\u4ef6\u548c\u76ee\u5f55\u3002\n\n```\n# docker cp temp-tomcat:/usr/local/tomcat/conf/server.xml ./server.xml\n# docker cp temp-tomcat:/usr/local/tomcat/conf/web.xml ./web.xml\n\n```\n\n\u5728\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f7f\u7528\u4e2d\uff0c\u51e0\u4e2a\u53c2\u6570\u7684\u542b\u4e49\u5982\u4e0b\uff1a\n\n*   **temp-tomcat** : \u64cd\u4f5c\u7684\u5bb9\u5668\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u521a\u624d\u521b\u5efa\u7684\u4e34\u65f6\u5bb9\u5668\u7684\u5bb9\u5668\u540d\u6765\u6307\u5b9a\u3002\n*   **/usr/local/tomcat/conf/server.xml** : \u9700\u8981\u62f7\u8d1d\u7684\u8def\u5f84\u3002\u4e5f\u5c31\u662f\u5bb9\u5668\u4e2d\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u53ef\u4ee5\u901a\u8fc7 `docker exec` \u7b49\u547d\u4ee4\u8fdb\u5230\u5bb9\u5668\u91cc\u5bfb\u89c5\u4e00\u4e0b\u5c31\u80fd\u83b7\u5f97\u3002\n*   **./server.xml** : \u662f\u76ee\u6807\u8def\u5f84\u3002\u5373\u9009\u62e9\u5c06\u6587\u4ef6\u62f7\u8d1d\u5230\u5bbf\u4e3b\u673a\u7684\u4ec0\u4e48\u4f4d\u7f6e\u4e0a\u3002\n\n\u719f\u6089 Linux \u4e2d cp \u547d\u4ee4\u7684\u670b\u53cb\u4f1a\u975e\u5e38\u5bb9\u6613\u770b\u61c2\u8fd9\u4e2a\u547d\u4ee4\uff0c\u8fd9\u4e24\u8005\u4f20\u53c2\u7684\u65b9\u5f0f\u662f\u57fa\u672c\u4e00\u81f4\u7684\u3002 \u4e3b\u8981\u7684\u533a\u522b\u5728\u4e8e `docker cp` \u547d\u4ee4\u7531\u4e8e\u662f\u5728\u5bb9\u5668\u4e0e\u5bbf\u4e3b\u673a\u95f4\u8fdb\u884c\u62f7\u8d1d\uff0c\u6240\u4ee5\u6765\u6e90\u76ee\u5f55\u6216\u8005\u76ee\u6807\u76ee\u5f55\u4e2d\u9700\u8981\u6307\u5b9a\u4e00\u4e0b\u5bb9\u5668\u3002\n\n\u4e0a\u8ff0\u7684\u547d\u4ee4\u662f\u4ece\u5bb9\u5668\u4e2d\u5411\u5bbf\u4e3b\u673a\u91cc\u62f7\u8d1d\u6587\u4ef6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4ece\u5bbf\u4e3b\u673a\u4e2d\u5411\u5bb9\u5668\u91cc\u62f7\u8d1d\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u8c03\u6362\u4e00\u4e0b\u53c2\u6570\u7684\u4f4d\u7f6e\u5373\u53ef\u3002\n\n```\n# docker cp ./server.xml temp-tomcat:/usr/local/tomcat/conf/server.xml\n\n```\n\n\u56de\u8fc7\u5934\u6765\u770b\u6211\u4eec\u7684\u914d\u7f6e\uff0c\u5728\u6267\u884c\u4e86\u4e0a\u8ff0\u7684\u547d\u4ee4\u4e4b\u540e\uff0c\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\u5df2\u7ecf\u51fa\u73b0\u5728\u6211\u4eec\u7cfb\u7edf\u7684\u76ee\u5f55\u4e2d\u4e86\u3002\n\n\u53e6\u5916\uff0c\u522b\u5fd8\u4e86\u5728\u5b8c\u6210\u4e0a\u9762\u7684\u64cd\u4f5c\u540e\u6e05\u7406\u6211\u4eec\u521b\u5efa\u7684\u4e34\u65f6\u5bb9\u5668\u3002\n\n```\n# docker stop temp-tomcat\n\n```\n\n\u7531\u4e8e\u6211\u4eec\u5728\u521b\u5efa\u4e34\u65f6\u5bb9\u5668\u7684\u65f6\u5019\u589e\u52a0\u4e86 `--rm` \u9009\u9879\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u8fd9\u91cc\u53ea\u9700\u8981\u4f7f\u7528 `docker stop` \u505c\u6b62\u5bb9\u5668\uff0c\u5c31\u53ef\u4ee5\u5728\u505c\u6b62\u5bb9\u5668\u7684\u540c\u65f6\u76f4\u63a5\u5220\u9664\u5bb9\u5668\uff0c\u5b9e\u73b0\u76f4\u63a5\u6e05\u7406\u7684\u76ee\u7684\u3002\n\n## \u7f16\u5199 Docker Compose \u5b9a\u4e49\u6587\u4ef6\n\n\u51c6\u5907\u597d\u4e86\u7a0b\u5e8f\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6765\u7f16\u5199\u6211\u4eec\u7684 Docker Compose \u9879\u76ee\u5b9a\u4e49\u6587\u4ef6\u4e86\u3002\n\n\u8fd9\u91cc\u662f\u6211\u7f16\u5199\u597d\u7684\u4e00\u4efd Docker Compose \u9879\u76ee\u5b9a\u4e49\u6587\u4ef6\u3002\n\n```\nversion: \"3\"\n\nservices:\n\n  redis:\n    image: redis:3.2\n    volumes:\n      - ../redis/redis.conf:/etc/redis/redis.conf:ro\n      - ../redis/data:/data\n    command:\n      - redis-server\n      - /etc/redis/redis.conf\n    ports:\n     - 6379:6379\n\n  mysql:\n    image: mysql:5.7\n    volumes:\n      - ../mysql/my.cnf:/etc/mysql/my.cnf:ro\n      - ../mysql/data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: my-secret-pw\n    ports:\n      - 3306:3306\n\n  tomcat:\n    image: tomcat:8.5\n    volumes:\n      - ../app:/usr/local/tomcat/webapps/ROOT\n    ports:\n      - 80:8080\n\n```\n\n\u5728\u8fd9\u4e2a\u9879\u76ee\u91cc\uff0c\u6211\u5c06 Redis \u548c MySQL \u7684\u6570\u636e\u5b58\u50a8\u76ee\u5f55\uff0c\u4e5f\u5c31\u662f Redis \u5bb9\u5668\u4e2d\u7684 /data \u76ee\u5f55\u548c MySQL \u5bb9\u5668\u4e2d\u7684 /var/lib/mysql \u76ee\u5f55\u901a\u8fc7\u6302\u8f7d\u7684\u65b9\u5f0f\u7ed1\u5b9a\u5230\u4e86\u5bbf\u4e3b\u673a\u4e0a\u7684\u76ee\u5f55\u4e2d\u3002 \u8fd9\u4e48\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9 Redis \u548c MySQL \u7684\u6570\u636e\u80fd\u591f\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u907f\u514d\u6211\u4eec\u5728\u521b\u5efa\u548c\u79fb\u9664\u5bb9\u5668\u65f6\u9020\u6210\u6570\u636e\u7684\u6d41\u5931\u3002\n\n\u540c\u65f6\uff0c\u8fd9\u79cd\u5c06\u6570\u636e\u6302\u8f7d\u51fa\u6765\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u76f4\u63a5\u65b9\u4fbf\u6211\u4eec\u6253\u5305\u6570\u636e\u5e76\u4f20\u9001\u7ed9\u5176\u4ed6\u5f00\u53d1\u8005\uff0c\u65b9\u4fbf\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u8054\u8c03\u3002\n\n\u5728 Tomcat \u8fd9\u4e2a\u670d\u52a1\u4e2d\uff0c\u6211\u4eec\u5c06\u7a0b\u5e8f\u76f4\u63a5\u6302\u8f7d\u5230 webapps/ROOT \u76ee\u5f55\u4e0b\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u591f\u501f\u52a9 Tomcat \u8bbf\u95ee\u6211\u4eec\u7684\u5e94\u7528\u4e86\u3002 \u5982\u679c\u5927\u5bb6\u6709\u591a\u4e2a\u9879\u76ee\uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u9002\u5f53\u8c03\u6574\uff0c\u5c06\u5b83\u4eec\u6302\u8f7d\u5230 webapps \u4e0b\u9762\u7684\u5b50\u76ee\u5f55\u4e2d\uff0c\u5b9e\u73b0\u540c\u65f6\u8bbf\u95ee\u591a\u4e2a\u5e94\u7528\u7684\u76ee\u7684\u3002\n\n\u53e6\u5916\uff0c\u8fd9\u91cc\u6211\u8fd8\u628a Tomcat \u9ed8\u8ba4\u7684 8080 \u7aef\u53e3\u6620\u5c04\u5230\u4e86\u5bbf\u4e3b\u673a\u7684 80 \u7aef\u53e3\u4e0a\uff0c\u8fd9\u6837\u4fbf\u4e8e\u6211\u4eec\u76f4\u63a5\u901a\u8fc7\u5730\u5740\u8bbf\u95ee\u7f51\u7ad9\uff0c\u4e0d\u9700\u8981\u7ecf\u5e38\u4eba\u5de5\u8865\u5145\u7aef\u53e3\u53f7\u4e86\u3002\n\n## \u542f\u52a8\u9879\u76ee\n\n\u4e00\u5207\u5c31\u7eea\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 Docker Compose \u7684\u547d\u4ee4\u6765\u542f\u52a8\u5f00\u53d1\u73af\u5883\u4e86\u3002\n\n```\n# docker-compose -p javaweb -f ./compose/docker-compose.yml up -d\n\n```\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u8fd9\u8282\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86\u901a\u8fc7 Docker \u642d\u5efa\u4e00\u4e2a Java Web \u5f00\u53d1\u73af\u5883\u7684\u8fc7\u7a0b\uff0c\u4e0b\u9762\u5c31\u662f\u5927\u5bb6\u81ea\u5df1\u52a8\u624b\u8fdb\u884c\u5b9e\u8df5\u7684\u65f6\u5019\u4e86\u3002\n\n\u672c\u5c0f\u8282\u4e2d\u7684\u793a\u4f8b\uff0c\u5df2\u7ecf\u66f4\u65b0\u5230\u4e86\uff1a\n\n[https://github.com/youmingdot/docker-book-for-developer-samples](https://github.com/youmingdot/docker-book-for-developer-samples)\n\n\u5927\u5bb6\u53ef\u4ee5\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u7684\u7528\u5176\u4f5c\u4e3a\u53c2\u8003\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u5927\u5bb6\u5728\u5b9e\u8df5\u8fc7\u7a0b\u4e2d\u9047\u5230\u56f0\u96be\uff0c\u6216\u8005\u6709\u81ea\u5df1\u7684\u5b9e\u8df5\u5fc3\u5f97\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u5b9e\u8df5\u4e4b\u8def\u642d\u5efa_Java_Web_\u9879\u76ee\u8fd0\u884c\u73af\u5883.md", "create_date": "2020-02-18T21:18:39.073", "order": 19}}, {"model": "subject.chapter", "pk": 66, "fields": {"title": "\u57fa\u7840\u6982\u5ff5\uff1a\u6d45\u8c08\u865a\u62df\u5316\u548c\u5bb9\u5668\u6280\u672f", "topic": 3, "md5": "bdb8a2c358940ea30503f0a25e520fbe", "md_body": "# \u6d45\u8c08\u865a\u62df\u5316\u548c\u5bb9\u5668\u6280\u672f\n\n\u76f8\u4fe1\u6240\u6709\u5bf9 Docker \u6709\u6240\u8033\u95fb\u7684\u670b\u53cb\u90fd\u77e5\u9053\uff0c\u5b83\u662f\u4e00\u6b3e\u4ee5**\u5bb9\u5668\u865a\u62df\u5316**\u6280\u672f\u4e3a\u57fa\u7840\u7684\u8f6f\u4ef6\uff0c\u56e0\u6b64\u5728\u4e86\u89e3\u6709\u5173 Docker \u7684\u6982\u5ff5\u77e5\u8bc6\u548c\u4f7f\u7528\u65b9\u6cd5\u4e4b\u524d\uff0c\u865a\u62df\u5316\u548c\u5bb9\u5668\u6280\u672f\u662f\u6211\u4eec\u4e0d\u53ef\u6216\u7f3a\u7684\u57fa\u7840\u77e5\u8bc6\u3002\u5728\u672c\u5c0f\u518c\u7684\u7b2c\u4e00\u4e2a\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u5c31\u5148\u6765\u5c1d\u4e00\u5c1d\u8fd9\u9053\u6709\u5173\u865a\u62df\u5316\u548c\u5bb9\u5668\u6280\u672f\u7684\u5f00\u80c3\u83dc\u5427\u3002\n\n## \u865a\u62df\u5316\u6280\u672f\n\n\u5982\u679c\u8981\u7528\u7b80\u5355\u7684\u8bed\u53e5\u6765\u9610\u8ff0\u865a\u62df\u5316\u6280\u672f\u7684\u8bdd\uff0c\u90a3\u4e48\u53ef\u4ee5\u8fd9\u4e48\u89e3\u91ca\uff1a\n\n> \u865a\u62df\u5316\u6280\u672f\u662f\u4e00\u79cd\u5c06\u8ba1\u7b97\u673a\u7269\u7406\u8d44\u6e90\u8fdb\u884c\u62bd\u8c61\u3001\u8f6c\u6362\u4e3a\u865a\u62df\u7684\u8ba1\u7b97\u673a\u8d44\u6e90\u63d0\u4f9b\u7ed9\u7a0b\u5e8f\u4f7f\u7528\u7684\u6280\u672f\u3002\n\n\u8fd9\u91cc\u6240\u6307\u7684\u8ba1\u7b97\u673a\u8d44\u6e90\uff0c\u5c31\u5305\u62ec\u4e86 CPU \u63d0\u4f9b\u7684**\u8fd0\u7b97\u63a7\u5236\u8d44\u6e90**\uff0c\u786c\u76d8\u63d0\u4f9b\u7684**\u6570\u636e\u5b58\u50a8\u8d44\u6e90**\uff0c\u7f51\u5361\u63d0\u4f9b\u7684**\u7f51\u7edc\u4f20\u8f93\u8d44\u6e90**\u7b49\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/30/165885f15326d070?w=1074&h=320&f=jpeg&s=37284)\n\n### \u4e3a\u7a0b\u5e8f\u8de8\u5e73\u53f0\u517c\u5bb9\u800c\u751f\n\n\u865a\u62df\u5316\u8fd9\u4e2a\u6982\u5ff5\u5e76\u4e0d\u662f\u4ec0\u4e48\u65b0\u4e8b\u7269\u4e86\uff0c\u65e9\u5728 20 \u4e16\u7eaa 60 \u5e74\u4ee3\uff0cIBM \u5c31\u7528\u5b83\u6765\u63cf\u8ff0\u4e00\u5957\u80fd\u591f\u62bd\u8c61\u786c\u4ef6\u8d44\u6e90\u7684\u5b9e\u9a8c\u6027\u7cfb\u7edf\u3002\n\n\u5728\u8ba1\u7b97\u673a\u6280\u672f\u53d1\u5c55\u7684\u65e9\u671f\uff0c\u5404\u7c7b\u8ba1\u7b97\u5e73\u53f0\u3001\u8ba1\u7b97\u8d44\u6e90\u6240\u63d0\u4f9b\u7684\u63a5\u53e3\u3001\u8c03\u7528\u65b9\u5f0f\u5341\u5206\u6742\u4e71\uff0c\u6ca1\u6709\u50cf\u4eca\u5929\u8fd9\u6837\u76f8\u5bf9\u7edf\u4e00\u7684\u6807\u51c6\u3002\u7531\u4e8e\u8981\u9002\u914d\u4e0d\u540c\u7684\u5e73\u53f0\uff0c\u5199\u5404\u79cd\u517c\u5bb9\u4ee3\u7801\uff0c\u8fd9\u65e0\u5f62\u7ed9\u5f00\u53d1\u8005\u5e26\u6765\u4e86\u5f88\u591a\u7684\u56f0\u6270\u3002\u8fd9\u79cd\u6df7\u4e71\u751a\u81f3\u90fd\u51fa\u73b0\u5728 IBM \u8fd9\u4e00\u5bb6\u516c\u53f8\u4e0b\u4e0d\u540c\u673a\u578b\u7684\u673a\u5668\u4e0a\uff0c\u6240\u4ee5 IBM \u7684\u5de5\u7a0b\u5e08\u4eec\u521b\u9020\u4e86\u865a\u62df\u5316\u6280\u672f\uff0c\u7528\u6765\u5e2e\u52a9\u7a0b\u5e8f\u5feb\u901f\u9002\u914d\u4e0d\u540c\u5e73\u53f0\u7684\u7269\u7406\u673a\u5668\u3002\n\n\u719f\u6089\u8ba1\u7b97\u673a\u539f\u7406\u7684\u670b\u53cb\u5e94\u8be5\u77e5\u9053\uff0c\u7a0b\u5e8f\u5bf9\u8ba1\u7b97\u673a\u8d44\u6e90\u7684\u8c03\u7528\u4e3b\u8981\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u6240\u7ed9\u51fa\u7684\u63a5\u53e3\u3002\u6211\u4eec\u7684\u7a0b\u5e8f\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u5411\u7269\u7406\u786c\u4ef6\u53d1\u9001\u6307\u4ee4\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/30/1658930a8c4c0ab9?w=760&h=230&f=png&s=146264)\n\n\u6240\u4ee5\uff0c\u8981\u5b9e\u73b0\u7a0b\u5e8f\u8de8\u5e73\u53f0\u517c\u5bb9\u7684\u65b9\u6cd5\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u64cd\u4f5c\u7cfb\u7edf\u6216\u8005\u7269\u7406\u786c\u4ef6\u6240\u63d0\u4f9b\u7684\u63a5\u53e3\u8c03\u7528\u65b9\u5f0f\u4e00\u81f4\uff0c\u7a0b\u5e8f\u4fbf\u4e0d\u9700\u8981\u517c\u5bb9\u4e0d\u540c\u786c\u4ef6\u5e73\u53f0\u7684\u63a5\u53e3\uff0c\u800c\u53ea\u9700\u8981\u9488\u5bf9\u8fd9\u4e00\u5957\u7edf\u4e00\u7684\u63a5\u53e3\u5f00\u53d1\u5373\u53ef\u3002\u865a\u62df\u5316\u6280\u672f\u6b63\u662f\u901a\u8fc7\u5176\u672c\u8eab\u9002\u914d\u4e0d\u540c\u5e73\u53f0\u7684\u786c\u4ef6\uff0c\u800c\u52a0\u4ee5\u62bd\u8c61\u6210\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u6765\u5b9e\u73b0\u7a0b\u5e8f\u8de8\u5e73\u53f0\u8fd0\u884c\u8fd9\u4e00\u76ee\u7684\u7684\u3002\n\n\u65f6\u81f3\u4eca\u65e5\uff0c\u6211\u4eec\u4e4b\u6240\u4ee5\u5173\u6ce8\u548c\u4f7f\u7528\u865a\u62df\u5316\u6280\u672f\uff0c\u5b9e\u73b0\u8de8\u5e73\u53f0\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u4f9d\u7136\u662f\u5f88\u5927\u4e00\u90e8\u5206\u7684\u539f\u56e0\u3002\n\n### \u5c06\u865a\u62df\u5316\u5e94\u7528\u4e8e\u8d44\u6e90\u7ba1\u7406\n\n\u5728\u865a\u62df\u5316\u6280\u672f\u7684\u53d1\u5c55\u8fc7\u7a0b\u4e2d\uff0c\u4eba\u4eec\u9010\u6e10\u53d1\u73b0\u4e86\u865a\u62df\u5316\u7684\u53e6\u4e00\u5927\u7528\u9014\uff0c\u4e5f\u5c31\u662f\u5c06\u4e4b\u5e94\u7528\u4e8e\u8ba1\u7b97\u673a\u8d44\u6e90\u7684\u7ba1\u7406\u3002\n\n\u8fd9\u5176\u4e2d\u7684\u9053\u7406\u5176\u5b9e\u5e76\u4e0d\u590d\u6742\uff0c\u865a\u62df\u5316\u6280\u672f\u672c\u8eab\u5c31\u662f\u62bd\u8c61\u8ba1\u7b97\u673a\u7684\u7269\u7406\u8d44\u6e90\u8fdb\u800c\u52a0\u5de5\u6210\u865a\u62df\u7684\u8ba1\u7b97\u8d44\u6e90\u7684\uff0c\u5b83\u81ea\u7136\u5f88\u5bb9\u6613\u4ece\u4e2d\u505a\u201c\u624b\u811a\u201d\uff0c\u6765\u544a\u8bc9\u5e94\u7528\u7a0b\u5e8f\u4e00\u4e9b\u865a\u5047\u7684\u8d44\u6e90\u6570\u636e\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ea\u8981\u544a\u8bc9\u7a0b\u5e8f\u8ba1\u7b97\u673a\u53ea\u6709 4GB \u5185\u5b58\uff0c\u90a3\u4e48\u4e0d\u7ba1\u771f\u5b9e\u7684\u7269\u7406\u673a\u662f 8GB\u300116GB \u8fd8\u662f 32GB\uff0c\u5e94\u7528\u7a0b\u5e8f\u90fd\u4f1a\u6309\u7167 4GB \u8fd9\u4e2a\u865a\u5047\u7684\u503c\u6765\u5904\u7406\u5b83\u7684\u903b\u8f91\u3002\n\n\u901a\u8fc7\u865a\u62df\u5316\u6280\u672f\u6765\u7ba1\u7406\u8ba1\u7b97\u673a\u8d44\u6e90\u7684\u65b9\u5f0f\uff0c\u4e0d\u4f46\u8ba9\u6211\u4eec\u5bf9\u8ba1\u7b97\u673a\u8d44\u6e90\u7684\u63a7\u5236\u53d8\u5f97\u66f4\u52a0\u7075\u6d3b\uff0c\u4e5f\u5927\u5e45\u63d0\u9ad8\u4e86\u8ba1\u7b97\u673a\u8d44\u6e90\u7684\u4f7f\u7528\u7387\u3002\n\n\u90e8\u5206\u540c\u5b66\u4e00\u76f4\u6709\u4e00\u4e2a\u8bef\u89e3\uff1a\u5b9e\u73b0\u865a\u62df\u5316\u7684\u7a0b\u5e8f\u672c\u8eab\u5c31\u8981\u5360\u7528\u8ba1\u7b97\u673a\u7684\u8d44\u6e90\uff0c\u800c\u8fd0\u8f6c\u5728\u5176\u4e2d\u7684\u7a0b\u5e8f\u4e5f\u4e0d\u4f1a\u964d\u4f4e\u5b83\u4eec\u5bf9\u8d44\u6e90\u7684\u6d88\u8017\uff0c\u600e\u4e48\u53c8\u4f1a\u4ea7\u751f 1 + 1 < 2 \u7684\u6548\u679c\u5462\u3002\n\n\u8fd9\u91cc\u8981\u6ce8\u610f\u4e86\uff0c\u6211\u4eec\u6240\u8bf4\u7684\u662f**\u63d0\u9ad8\u8ba1\u7b97\u673a\u8d44\u6e90\u4f7f\u7528\u7387**\uff0c\u800c\u975e**\u51cf\u5c11\u7a0b\u5e8f\u8d44\u6e90\u7684\u5360\u7528\u7387**\uff0c\u8fd9\u4e24\u8005\u770b\u4f3c\u5f88\u76f8\u8fd1\uff0c\u5176\u5b9e\u5e76\u975e\u662f\u540c\u4e00\u4e2a\u6982\u5ff5\u3002\u865a\u62df\u5316\u6280\u672f\u80fd\u591f\u63d0\u9ad8\u8ba1\u7b97\u673a\u8d44\u6e90\u7684\u4f7f\u7528\u7387\uff0c\u662f\u6307\u5229\u7528\u865a\u62df\u5316\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u539f\u6765\u7a0b\u5e8f\u7528\u4e0d\u5230\u7684\u4e00\u4e9b\u8d44\u6e90\u62ff\u51fa\u6765\uff0c\u5206\u4eab\u7ed9\u53e6\u5916\u4e00\u4e9b\u7a0b\u5e8f\uff0c\u8ba9\u8ba1\u7b97\u673a\u8d44\u6e90\u4e0d\u88ab\u6d6a\u8d39\u3002\n\n\u4f8b\u5982\uff0c\u8fd9\u91cc\u6211\u4eec\u6709\u4e00\u53f0\u8fd0\u884c Nginx \u7684\u673a\u5668\uff0c\u7531\u4e8e Nginx \u8fd0\u884c\u5bf9\u7cfb\u7edf\u8d44\u6e90\u7684\u6d88\u8017\u5e76\u4e0d\u9ad8\uff0c\u8fd9\u5c31\u8ba9\u7cfb\u7edf\u51e0\u4e4e 95% \u4ee5\u4e0a\u7684\u8d44\u6e90\u5904\u4e8e\u95f2\u7f6e\u72b6\u6001\u3002\u8fd9\u65f6\u5019\u6211\u4eec\u901a\u8fc7\u865a\u62df\u5316\u6280\u672f\uff0c\u628a\u5176\u4ed6\u7684\u4e00\u4e9b\u7a0b\u5e8f\u653e\u5230\u8fd9\u53f0\u673a\u5668\u4e0a\u6765\u8fd0\u884c\uff0c\u5b83\u4eec\u5c31\u80fd\u591f\u5145\u5206\u5229\u7528\u95f2\u7f6e\u7684\u8d44\u6e90\u3002\u8fd9\u5e26\u6765\u7684\u597d\u5904\u5c31\u662f\u6211\u4eec\u4e0d\u9700\u8981\u518d\u4e3a\u8fd9\u4e9b\u7a0b\u5e8f\u5355\u72ec\u90e8\u7f72\u673a\u5668\uff0c\u4ece\u800c\u8282\u7ea6\u4e0d\u5c11\u7684\u6210\u672c\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/30/1658938d9c8b3de2?w=1055&h=321&f=jpeg&s=50216)\n\n\u90e8\u5206\u8bfb\u8005\u8bfb\u5230\u8fd9\u91cc\u5c31\u4f1a\u4ea7\u751f\u7591\u60d1\u4e86\uff0c\u6211\u672c\u8eab\u5c31\u53ef\u4ee5\u5728\u64cd\u4f5c\u7cfb\u7edf\u91cc\u5b89\u88c5\u8fd9\u4e9b\u7a0b\u5e8f\u5e76\u4e14\u540c\u65f6\u8fd0\u884c\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u628a\u5b83\u4eec\u5206\u522b\u88c5\u5230\u4e0d\u540c\u7684\u865a\u62df\u73af\u5883\u4e2d\u53bb\u5462\uff1f\n\n\u5176\u5b9e\u9053\u7406\u5f88\u7b80\u5355\uff0c\u867d\u7136\u6211\u4eec\u80fd\u591f\u5728\u64cd\u4f5c\u7cfb\u7edf\u91cc\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u7a0b\u5e8f\uff0c\u4f46\u524d\u63d0\u5f97\u662f\u8fd9\u4e9b\u7a0b\u5e8f\u672c\u8eab\u4e0d\u5b58\u5728\u51b2\u7a81\u3002\u8fd9\u91cc\u7684\u51b2\u7a81\u4f53\u73b0\u5728\u5f88\u591a\u7684\u65b9\u9762\uff0c\u4f8b\u5982\u4e0d\u540c\u7684\u7a0b\u5e8f\u540c\u65f6\u4f7f\u7528\u4e86\u540c\u4e00\u4e2a\u7aef\u53e3\uff1b\u4e0d\u540c\u7a0b\u5e8f\u4f9d\u8d56\u4e8e\u540c\u4e00\u4e2a\u5de5\u5177\u5e93\u7684\u4e0d\u540c\u7248\u672c\uff1b\u7a0b\u5e8f\u672c\u8eab\u9650\u5236\u4e86\u540c\u65f6\u5f00\u542f\u7684\u8fdb\u7a0b\u6570\u7b49\u3002\u865a\u62df\u5316\u6280\u672f\u901a\u8fc7\u8d44\u6e90\u9694\u79bb\u7684\u65b9\u5f0f\uff0c\u65e0\u5f62\u5730\u4e5f\u53ef\u4ee5\u628a\u8fd9\u4e9b\u7a0b\u5e8f\u9694\u79bb\u5728\u4e0d\u540c\u7684\u865a\u62df\u73af\u5883\u4e2d\uff0c\u65e2\u7136\u865a\u62df\u73af\u5883\u4e0d\u540c\uff0c\u81ea\u7136\u8fd0\u884c\u5728\u4e0d\u540c\u73af\u5883\u4e2d\u7684\u7a0b\u5e8f\u5c31\u4e0d\u4f1a\u4e92\u76f8\u5e72\u6270\u6216\u4e89\u62a2\u8d44\u6e90\u4e86\u3002\n\n## \u865a\u62df\u5316\u7684\u5206\u7c7b\n\n\u8bf4\u5b8c\u865a\u62df\u5316\u7684\u8d77\u6e90\u548c\u5e94\u7528\uff0c\u6211\u4eec\u5f97\u8bf4\u8bf4\u865a\u62df\u5316\u7684\u5206\u7c7b\u4e86\u3002\u6240\u8c13\u865a\u62df\u5316\u7684\u5206\u7c7b\uff0c\u5176\u5b9e\u4e3b\u8981\u6307\u7684\u662f\u6211\u4eec\u5728\u5b9e\u73b0\u865a\u62df\u5316\u7684\u65b9\u5f0f\u4e0a\u7684\u533a\u522b\u3002\n\n\u5bf9\u4e8e\u865a\u62df\u5316\u6280\u672f\u7684\u5206\u7c7b\uff0c\u6709\u5f88\u591a\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\uff0c\u6709\u7684\u4e4b\u95f4\u4e5f\u6709\u4e92\u76f8\u91cd\u5408\u7684\u90e8\u5206\uff0c\u4f46\u603b\u4f53\u6765\u8bf4\u53ef\u4ee5\u533a\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a**\u786c\u4ef6\u865a\u62df\u5316**\u3001**\u8f6f\u4ef6\u865a\u62df\u5316**\u3002\n\n\u6240\u8c13\u786c\u4ef6\u865a\u62df\u5316\uff0c\u6307\u7684\u662f\u7269\u7406\u786c\u4ef6\u672c\u8eab\u5c31\u63d0\u4f9b\u865a\u62df\u5316\u7684\u652f\u6301\u3002\u4e3e\u4e2a\u4f8b\u5b50\u6765\u8bf4\uff0c\u67d0\u4e2a\u5e73\u53f0\u7684 CPU\uff0c\u80fd\u591f\u5c06\u53e6\u5916\u4e00\u4e2a\u5e73\u53f0\u7684\u6307\u4ee4\u96c6\u8f6c\u6362\u4e3a\u81ea\u8eab\u7684\u6307\u4ee4\u96c6\u6267\u884c\uff0c\u5e76\u7ed9\u7a0b\u5e8f\u5b8c\u5168\u8fd0\u884c\u5728\u90a3\u4e2a\u5e73\u53f0\u4e0a\u7684\u611f\u89c9\u3002\u53c8\u6216\u8005\u8bf4\uff0cCPU \u80fd\u591f\u81ea\u8eab\u6a21\u62df\u88c2\u53d8\uff0c\u8ba9\u7a0b\u5e8f\u6216\u8005\u64cd\u4f5c\u7cfb\u7edf\u8ba4\u4e3a\u5b58\u5728\u591a\u4e2a CPU\uff0c\u8fdb\u800c\u80fd\u591f\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u7a0b\u5e8f\u6216\u8005\u64cd\u4f5c\u7cfb\u7edf\u3002\u8fd9\u4e9b\u90fd\u662f\u786c\u4ef6\u865a\u62df\u5316\u7684\u4f53\u73b0\u3002\n\n\u800c\u8f6f\u4ef6\u865a\u62df\u5316\u5219\u6307\u7684\u662f\u901a\u8fc7\u8f6f\u4ef6\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u865a\u62df\u5316\u4e2d\u5173\u952e\u7684\u6307\u4ee4\u8f6c\u6362\u90e8\u5206\u3002\u4f9d\u7136\u7528 CPU \u7684\u4f8b\u5b50\u6765\u8bf4\u8bdd\uff0c\u5728\u8f6f\u4ef6\u865a\u62df\u5316\u5b9e\u73b0\u4e2d\uff0c\u901a\u8fc7\u4e00\u5c42\u5939\u6742\u5728\u5e94\u7528\u7a0b\u5e8f\u548c\u786c\u4ef6\u5e73\u53f0\u4e0a\u7684\u865a\u62df\u5316\u5b9e\u73b0\u8f6f\u4ef6\u6765\u8fdb\u884c\u6307\u4ee4\u7684\u8f6c\u6362\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u867d\u7136\u5e94\u7528\u7a0b\u5e8f\u5411\u64cd\u4f5c\u7cfb\u7edf\u6216\u8005\u7269\u7406\u786c\u4ef6\u53d1\u51fa\u7684\u6307\u4ee4\u4e0d\u662f\u5f53\u524d\u786c\u4ef6\u5e73\u53f0\u6240\u652f\u6301\u7684\u6307\u4ee4\uff0c\u8fd9\u4e2a\u5b9e\u73b0\u865a\u62df\u5316\u7684\u8f6f\u4ef6\u4e5f\u4f1a\u5c06\u4e4b\u8f6c\u6362\u4e3a\u5f53\u524d\u786c\u4ef6\u5e73\u53f0\u6240\u80fd\u8bc6\u522b\u7684\u3002\n\n\u5f53\u7136\uff0c\u5728\u5b9e\u9645\u573a\u666f\u4e2d\uff0c\u865a\u62df\u5316\u8fd8\u80fd\u8fdb\u884c\u66f4\u52a0\u7ec6\u5316\u7684\u5206\u7c7b\uff0c\u4f8b\u5982\uff1a\n\n*   **\u5e73\u53f0\u865a\u62df\u5316**\uff1a\u5728\u64cd\u4f5c\u7cfb\u7edf\u548c\u786c\u4ef6\u5e73\u53f0\u95f4\u642d\u5efa\u865a\u62df\u5316\u8bbe\u65bd\uff0c\u4f7f\u5f97\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u90fd\u8fd0\u884c\u5728\u865a\u62df\u540e\u7684\u73af\u5883\u4e2d\u3002\n*   **\u5e94\u7528\u7a0b\u5e8f\u865a\u62df\u5316**\uff1a\u5728\u64cd\u4f5c\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u95f4\u5b9e\u73b0\u865a\u62df\u5316\uff0c\u53ea\u8ba9\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u865a\u62df\u5316\u73af\u5883\u4e2d\u3002\n*   **\u5185\u5b58\u865a\u62df\u5316**\uff1a\u5c06\u4e0d\u76f8\u90bb\u7684\u5185\u5b58\u533a\uff0c\u751a\u81f3\u786c\u76d8\u7a7a\u95f4\u865a\u62df\u6210\u7edf\u4e00\u8fde\u7eed\u7684\u5185\u5b58\u5730\u5740\uff0c\u5373\u6211\u4eec\u5e38\u8bf4\u7684\u865a\u62df\u5185\u5b58\u3002\n*   **\u684c\u9762\u865a\u62df\u5316**\uff1a\u8ba9\u672c\u5730\u684c\u9762\u7a0b\u5e8f\u5229\u7528\u8fdc\u7a0b\u8ba1\u7b97\u673a\u8d44\u6e90\u8fd0\u884c\uff0c\u8fbe\u5230\u63a7\u5236\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7684\u76ee\u7684\u3002\n*   \u2026\u2026\n\n\u7531\u4e8e\u865a\u62df\u5316\u7684\u5206\u7c7b\u5b9e\u5728\u592a\u591a\uff0c\u4e14\u4e0d\u662f\u8fd9\u672c\u5c0f\u518c\u5173\u6ce8\u7684\u91cd\u70b9\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5168\u90e8\u7f57\u5217\u4e86\u3002\u603b\u4e4b\uff0c\u4ece\u5b9e\u73b0\u4e0a\u6765\u8bf4\uff0c\u7686\u662f\u786c\u4ef6\u865a\u62df\u5316\u548c\u8f6f\u4ef6\u865a\u62df\u5316\u4e24\u4e2a\u65b9\u6848\u7684\u76f8\u4e92\u7ec4\u5408\u3001\u7ec4\u88c5\u800c\u5f97\u3002\n\n### \u865a\u62df\u673a\n\n\u5728\u8fd9\u4e9b\u865a\u62df\u5316\u5206\u7c7b\u6216\u8005\u8bf4\u662f\u865a\u62df\u5316\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u8981\u7740\u91cd\u8bb2\u4e00\u4e0b**\u865a\u62df\u673a ( Virtual Machine )**\u3002\u6240\u8c13\u865a\u62df\u673a\uff0c\u901a\u5e38\u6765\u8bf4\u5c31\u662f\u901a\u8fc7\u4e00\u4e2a**\u865a\u62df\u673a\u76d1\u89c6\u5668 ( Virtual Machine Monitor )** \u7684\u8bbe\u65bd\u6765\u9694\u79bb\u64cd\u4f5c\u7cfb\u7edf\u4e0e\u786c\u4ef6\u6216\u8005\u5e94\u7528\u7a0b\u5e8f\u548c\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4ee5\u6b64\u8fbe\u5230\u865a\u62df\u5316\u7684\u76ee\u7684\u3002\u8fd9\u4e2a\u5939\u5728\u5176\u4e2d\u7684\u865a\u62df\u673a\u76d1\u89c6\u5668\uff0c\u5e38\u5e38\u88ab\u79f0\u4e3a **Hypervisor**\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/8/31/16590358c6f2217e?w=748&h=634&f=png&s=59855)\n\n\u4e4b\u6240\u4ee5\u6211\u4eec\u5728\u8fd9\u91cc\u5355\u72ec\u8c08\u8c08\u865a\u62df\u673a\uff0c\u662f\u56e0\u4e3a\u5b83\u5bf9\u4e8e\u6211\u4eec\u5f00\u53d1\u8005\u6765\u8bf4\u662f\u4e2a\u518d\u719f\u6089\u4e0d\u8fc7\u7684\u6982\u5ff5\u4e86\u3002\u4ece\u6211\u4eec\u4e60\u60ef\u7528\u6765\u642d\u5efa\u865a\u62df\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u7684 VMware Workstation\u3001Xen \u7b49\u8f6f\u4ef6\uff0c\u5230 Java \u865a\u62df\u673a JVM\uff0cPHP \u865a\u62df\u673a HHVM \u7b49\u7b49\uff0c\u90fd\u5145\u6d3b\u8dc3\u5728\u6211\u4eec\u7a0b\u5e8f\u5f00\u53d1\u5230\u7a0b\u5e8f\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u3002\n\n\u8fd9\u65f6\u5019\u6709\u7684\u8bfb\u8005\u53ef\u80fd\u4f1a\u773c\u524d\u4e00\u4eae\uff0c\u53d1\u73b0\u539f\u6765 JVM\u3001HHVM \u7b49\u7279\u5b9a\u8bed\u8a00\u8fd0\u884c\u73af\u5883\u4e2d\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u4e5f\u662f\u865a\u62df\u5316\u7684\u4e00\u79cd\u5b9e\u5b9e\u5728\u5728\u7684\u5b9e\u73b0\u3002\u6ca1\u9519\uff0c\u53ea\u8981\u5927\u5bb6\u4ed4\u7ec6\u5206\u6790\u548c\u601d\u8003\u4e00\u4e0b\u5c31\u4f1a\u53d1\u73b0\uff0c\u5b83\u4eec\u6b63\u662f\u57fa\u4e8e\u865a\u62df\u5316\u7684\u601d\u60f3\u6765\u5b9e\u73b0\u7684\u3002\u5b83\u4eec\u901a\u8fc7\u9694\u79bb\u7a0b\u5e8f\u548c\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5c06\u7a0b\u5e8f\u7684\u6307\u4ee4\u8f6c\u6362\u4e3a\u5f53\u524d\u6240\u5728\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\u6240\u80fd\u6267\u884c\u7684\u6307\u4ee4\uff0c\u8fbe\u5230\u4e86\u4e0d\u7528\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u4efb\u4f55\u4fee\u6539\u5373\u53ef\u6267\u884c\u7684\u76ee\u7684\u3002\u4e5f\u6b63\u662f\u8fd9\u4e2a\u539f\u56e0\uff0c\u8fd9\u4e9b\u8bed\u8a00\u7684\u7a0b\u5e8f\u90fd\u5177\u6709\u975e\u5e38\u5f3a\u7684\u8de8\u5e73\u53f0\u6027\u3002\n\n\u867d\u7136\u865a\u62df\u673a\u6280\u672f\u5f97\u76ca\u4e8e Hypervisor \u7684\u52a0\u6301\uff0c\u4f7f\u5f97\u5e94\u7528\u7a0b\u5e8f\u6216\u8005\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5728\u65e0\u4efb\u4f55\u4fee\u6539\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\u5728\u53e6\u4e00\u5e73\u53f0\u4e0a\uff0c\u4f46\u5927\u5bb6\u5f88\u5bb9\u6613\u53d1\u73b0\uff0c\u5176\u6709\u4e00\u4e2a\u81f4\u547d\u7684\u7f3a\u9677\uff0c\u5c31\u662f\u6240\u6709\u7684\u6307\u4ee4\u90fd\u5fc5\u987b\u7ecf\u8fc7\u865a\u62df\u673a\u76d1\u89c6\u5668\u7684\u5904\u7406\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u865a\u62df\u673a\u7684\u6027\u80fd\u662f\u4f4e\u4e0b\u7684\uff0c\u4f8b\u5982\u8fd0\u884c\u5728 ZendVM \u6216\u8005 HHVM \u4e2d\u7684 PHP \u7a0b\u5e8f\uff0c\u6240\u6709\u4ee3\u7801\u867d\u7136\u7f16\u8bd1\u6210\u4e86 Opcode \u7801\uff0c\u4f46\u5176\u4f9d\u7136\u662f\u901a\u8fc7\u865a\u62df\u673a\u624d\u6700\u7ec8\u8f6c\u6362\u4e3a\u673a\u5668\u6240\u80fd\u8bc6\u522b\u7684\u673a\u5668\u7801\u53bb\u6267\u884c\u3002\n\n\u8fd9\u79cd\u6548\u7387\u7684\u4f4e\u4e0b\u6709\u65f6\u5019\u662f\u65e0\u6cd5\u5bb9\u5fcd\u7684\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u771f\u5b9e\u7684\u865a\u62df\u673a\u7a0b\u5e8f\u5e38\u5e38\u4e0d\u5b8c\u5168\u9075\u5faa Hypervisor \u7684\u8bbe\u8ba1\u7ed3\u6784\uff0c\u800c\u662f\u5f15\u5165\u4e00\u4e9b\u5176\u4ed6\u6280\u672f\u6765\u89e3\u51b3\u6548\u7387\u95ee\u9898\u3002\n\n\u4f8b\u5982\uff0c\u5728 VMware Workstation\u3001Xen \u4e2d\u6211\u4eec\u80fd\u591f\u770b\u5230\u786c\u4ef6\u8f85\u52a9\u865a\u62df\u5316\u7684\u4f7f\u7528\uff0c\u901a\u8fc7\u8ba9\u6307\u4ee4\u76f4\u8fbe\u652f\u6301\u865a\u62df\u5316\u7684\u786c\u4ef6\uff0c\u4ee5\u6b64\u907f\u5f00\u4e86\u6548\u7387\u4f4e\u4e0b\u7684 Hypervisor\u3002\u800c\u5982 JRE\u3001HPHP \u4e2d\uff0c\u9664\u4e86\u57fa\u4e8e Hypervisor \u5b9e\u73b0\u7684**\u89e3\u91ca\u6267\u884c**\u673a\u5236\u5916\uff0c\u8fd8\u6709**\u5373\u65f6\u7f16\u8bd1 ( Just In Time )** \u8fd0\u884c\u673a\u5236\uff0c\u8ba9\u7a0b\u5e8f\u4ee3\u7801\u5728\u8fd0\u884c\u524d\u7f16\u8bd1\u6210\u7b26\u5408\u5f53\u524d\u786c\u4ef6\u5e73\u53f0\u7684\u673a\u5668\u7801\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5c31\u5df2\u7ecf\u4e0d\u5c5e\u4e8e\u865a\u62df\u5316\u7684\u8303\u7574\u4e86\u3002\n\n## \u5bb9\u5668\u6280\u672f\n\n\u5bb9\u5668\u6280\u672f\u662f\u4e00\u79cd\u5168\u65b0\u610f\u4e49\u4e0a\u7684\u865a\u62df\u5316\u6280\u672f\uff0c\u6309\u5206\u7c7b\u6216\u8005\u5b9e\u73b0\u65b9\u5f0f\u6765\u8bf4\uff0c\u5176\u5e94\u8be5\u5c5e\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u865a\u62df\u5316\u7684\u8303\u7574\uff0c\u4e5f\u5c31\u662f\u5728\u7531\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u865a\u62df\u5316\u7684\u652f\u6301\u3002\n\n\u6240\u8c13\u5bb9\u5668\u6280\u672f\uff0c\u6307\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u81ea\u8eab\u652f\u6301\u4e00\u4e9b\u63a5\u53e3\uff0c\u80fd\u591f\u8ba9\u5e94\u7528\u7a0b\u5e8f\u95f4\u53ef\u4ee5\u4e92\u4e0d\u5e72\u6270\u7684\u72ec\u7acb\u8fd0\u884c\uff0c\u5e76\u4e14\u80fd\u591f\u5bf9\u5176\u5728\u8fd0\u884c\u4e2d\u6240\u4f7f\u7528\u7684\u8d44\u6e90\u8fdb\u884c\u5e72\u9884\u3002\u5f53\u7136\uff0c\u76ee\u524d\u6765\u8bf4\u5bb9\u5668\u6280\u672f\u8fd8\u6ca1\u6709\u4e00\u4e2a\u4e25\u683c\u7684\u5b9a\u4e49\uff0c\u5176\u5b9e\u73b0\u65b9\u5f0f\u4e5f\u5404\u6709\u4e0d\u540c\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u80fd\u7b97\u662f\u6211\u7684\u4e00\u70b9\u5c0f\u5c0f\u603b\u7ed3\u5f52\u7eb3\u3002\n\n\u7531\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u88ab\u9694\u79bb\u5728\u4e86\u4e00\u4e2a\u72ec\u7acb\u7684\u8fd0\u884c\u73af\u5883\u4e4b\u4e2d\uff0c\u8fd9\u4e2a\u72ec\u7acb\u7684\u8fd0\u884c\u73af\u5883\u5c31\u597d\u4f3c\u4e00\u4e2a\u5bb9\u5668\uff0c\u5305\u88f9\u4f4f\u4e86\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u5c31\u662f\u5bb9\u5668\u6280\u672f\u540d\u5b57\u7684\u7531\u6765\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/1/1659296247facf28?w=485&h=246&f=png&s=39990)\n\n\u5bb9\u5668\u6280\u672f\u8fd1\u5e74\u6765\u5df2\u7ecf\u662f\u4e00\u4e2a\u706b\u904d\u5927\u6c5f\u5357\u5317\u7684\u6982\u5ff5\u4e86\uff0c\u5176\u4e4b\u6240\u4ee5\u80fd\u540d\u58f0\u5927\u566a\uff0c\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u539f\u56e0\u662f\u5176\u5728\u8fd0\u884c\u6027\u80fd\u4e0a\u8981\u8fdc\u8d85\u865a\u62df\u673a\u7b49\u5176\u4ed6\u865a\u62df\u5316\u5b9e\u73b0\u3002\u66f4\u751a\u4e00\u6b65\u8bf4\uff0c\u8fd0\u884c\u5728\u5bb9\u5668\u865a\u62df\u5316\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5728\u8fd0\u884c\u6548\u7387\u4e0a\u4e0e\u771f\u5b9e\u8fd0\u884c\u5728\u7269\u7406\u5e73\u53f0\u4e0a\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u76f8\u4e0a\u4e0b\u3002\n\n\u4e3a\u4ec0\u4e48\u5bb9\u5668\u6280\u672f\u80fd\u591f\u9020\u5c31\u8fd1\u4e4e\u5b8c\u7f8e\u7684\u8fd0\u884c\u6548\u7387\u5462\uff1f\u8fd9\u5c31\u5f97\u4ece\u5bb9\u5668\u6280\u672f\u5982\u4f55\u5b9e\u73b0\u5e94\u7528\u7a0b\u5e8f\u7684\u6307\u4ee4\u8f6c\u6362\u5f00\u59cb\u8bf4\u8d77\u3002\u4e0b\u9762\u8fd9\u5f20\u56fe\u5c55\u793a\u4e86\u5bb9\u5668\u6280\u672f\u5982\u4f55\u8fdb\u884c\u6307\u4ee4\u8f6c\u6362\u7684\u3002\n\n...\n\n\u5b9e\u5728\u65e0\u5948\uff0c\u6ca1\u6709\u627e\u5230\u5bb9\u5668\u6280\u672f\u8fdb\u884c\u6307\u4ee4\u8f6c\u6362\u7684\u56fe\u7247\uff0c\u56e0\u4e3a\u5bb9\u5668\u6280\u672f\u538b\u6839\u6ca1\u6709\u505a\u6307\u4ee4\u8f6c\u6362\u3002\u662f\u7684\uff0c\u4f60\u6ca1\u6709\u542c\u9519\uff0c\u6709\u65f6\u5019**\u89e3\u51b3\u95ee\u9898\u7684\u6700\u4f73\u65b9\u6cd5\u5c31\u662f\u4e0d\u89e3\u51b3\u5b83**\u3002\n\n\u7531\u4e8e\u6ca1\u6709\u6307\u4ee4\u8f6c\u6362\uff0c\u8fd0\u884c\u5728\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u81ea\u8eab\u5fc5\u987b\u652f\u6301\u5728\u771f\u5b9e\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c\uff0c\u4e5f\u5c31\u662f\u5fc5\u987b\u9075\u5faa\u786c\u4ef6\u5e73\u53f0\u7684\u6307\u4ee4\u89c4\u5219\u3002\n\n\u5f88\u591a\u540c\u5b66\u8fd9\u65f6\u5019\u5c31\u6709\u7591\u95ee\u4e86\uff0c\u6307\u4ee4\u90fd\u4e0d\u8f6c\u6362\uff0c\u4e5f\u6ca1\u6709\u89e3\u51b3\u7a0b\u5e8f\u8de8\u5e73\u53f0\u517c\u5bb9\u7684\u95ee\u9898\uff0c\u8fd9\u7b97\u54ea\u95e8\u5b50\u865a\u62df\u5316\u6280\u672f\u3002\n\n\u6ca1\u9519\uff0c\u6b63\u662f\u8fd9\u79cd\u539f\u56e0\uff0c\u5f88\u591a\u4eba\u5e76\u4e0d\u8ba4\u540c\u5bb9\u5668\u6280\u672f\u5c5e\u4e8e\u865a\u62df\u5316\u6280\u672f\u7684\u8303\u7574\u3002\u4e0d\u8fc7\u53e6\u4e00\u6d3e\u89c2\u70b9\u8ba4\u4e3a\uff0c\u5bb9\u5668\u6280\u672f\u63d0\u4f9b\u4e86\u76f8\u5bf9\u72ec\u7acb\u7684\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u7684\u73af\u5883\uff0c\u4e5f\u63d0\u4f9b\u4e86\u8d44\u6e90\u63a7\u5236\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u6211\u4eec\u4f9d\u7136\u53ef\u4ee5\u5f52\u7eb3\u5176\u4e3a\u4e00\u79cd\u5b9e\u73b0\u4e0d\u5b8c\u5168\u7684\u865a\u62df\u5316\u6280\u672f\u3002\n\n### \u865a\u62df\u673a VS \u5bb9\u5668\n\n\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u901a\u8fc7\u865a\u62df\u673a\u548c\u5bb9\u5668\u6280\u672f\u7684\u5256\u6790\u56fe\u6765\u5206\u6790\uff0c\u5c31\u66f4\u5bb9\u6613\u770b\u51fa\u5bb9\u5668\u865a\u62df\u5316\u662f\u5982\u4f55\u5728\u6548\u7387\u4e0a\u5b8c\u80dc\u865a\u62df\u673a\u7684\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/1/16592899b28d4181?w=886&h=478&f=png&s=324715)\n\n\u7531\u4e8e\u6ca1\u6709\u4e86\u865a\u62df\u64cd\u4f5c\u7cfb\u7edf\u548c\u865a\u62df\u673a\u76d1\u89c6\u5668\u8fd9\u4e24\u4e2a\u5c42\u6b21\uff0c\u5927\u5e45\u51cf\u5c11\u4e86\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5e26\u6765\u7684\u989d\u5916\u6d88\u8017\u3002\n\n\u66f4\u51c6\u786e\u7684\u6765\u8bf4\uff0c\u6240\u6709\u5728\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u5176\u5b9e\u5b8c\u5168\u8fd0\u884c\u5728\u4e86\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u4e0e\u5176\u4ed6\u771f\u5b9e\u8fd0\u884c\u5728\u5176\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u5728\u6307\u4ee4\u8fd0\u884c\u5c42\u9762\u662f\u5b8c\u5168\u6ca1\u6709\u4efb\u4f55\u533a\u522b\u7684\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u9605\u8bfb\u5b8c\u8fd9\u4e00\u5c0f\u8282\u540e\uff0c\u76f8\u4fe1\u4f60\u5bf9\u865a\u62df\u5316\u548c\u5bb9\u5668\u6280\u672f\u5df2\u7ecf\u6709\u4e86\u521d\u6b65\u7684\u8ba4\u8bc6\uff0c\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> \u901a\u8fc7\u5bb9\u5668\u6280\u672f\u4e0e\u5176\u4ed6\u5e38\u89c1\u7684\u865a\u62df\u5316\u6280\u672f ( \u4f8b\u5982\u865a\u62df\u673a ) \u5b9e\u73b0\u5404\u81ea\u7684\u4f18\u52bf\u548c\u52a3\u52bf\uff0c\u8bf4\u8bf4\u5b83\u4eec\u5404\u81ea\u6709\u600e\u6837\u7684\u9002\u7528\u573a\u666f\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u865a\u62df\u5316\u6280\u672f\u3001\u5bb9\u5668\u6280\u672f\u7b49\u8fd8\u6709\u4e0d\u751a\u4e86\u89e3\u4e4b\u5904\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u57fa\u7840\u6982\u5ff5\u6d45\u8c08\u865a\u62df\u5316\u548c\u5bb9\u5668\u6280\u672f.md", "create_date": "2020-02-18T21:18:39.089", "order": 1}}, {"model": "subject.chapter", "pk": 67, "fields": {"title": "\u57fa\u7840\u6982\u5ff5\uff1a\u8fd9\u662f Docker \u7684\u7b80\u5386", "topic": 3, "md5": "1d2ff989628dbd5eef65cb8fbbcd973c", "md_body": "# \u8fd9\u662f Docker \u7684\u7b80\u5386\n\n\u5728\u4e86\u89e3\u865a\u62df\u5316\u548c\u5bb9\u5668\u6280\u672f\u540e\uff0c\u6211\u4eec\u5c31\u66f4\u5bb9\u6613\u7406\u89e3 Docker \u7684\u76f8\u5173\u77e5\u8bc6\u4e86\u3002\u5728\u8fd9\u4e00\u5c0f\u8282\u4e2d\uff0c\u6211\u5c06\u4ecb\u7ecd\u5173\u4e8e Docker \u7684\u51fa\u73b0\u548c\u53d1\u5c55\uff0cDocker \u80cc\u540e\u7684\u6280\u672f\u3002\u540c\u65f6\uff0c\u6211\u4eec\u5c06\u9610\u8ff0 Docker \u5728\u865a\u62df\u5316\u9886\u57df\u4e2d\u7684\u5b9a\u4f4d\u4ee5\u53ca\u5176\u5e26\u6765\u7684\u53d8\u9769\u3002\n\n## Docker \u5f00\u6e90\u9879\u76ee\n\n\u5982\u679c\u8bf4 Docker \u7684\u8bde\u751f\uff0c\u5c31\u5fc5\u987b\u4ece Docker \u8fd9\u4e2a\u5f00\u6e90\u9879\u76ee\u63d0\u8d77 ( \u867d\u7136\u5b83\u73b0\u5728\u5df2\u7ecf\u4e0d\u53eb Docker \u4e86 )\u3002Docker \u9879\u76ee\u662f\u4e00\u4e2a\u7531 Go \u8bed\u8a00\u5b9e\u73b0\u7684\u5bb9\u5668\u5f15\u64ce\uff0c\u5b83\u6700\u521d\u7531 dotCloud \u8fd9\u5bb6\u505a\u4e91\u670d\u52a1\u7684\u516c\u53f8\u5728 2013 \u5e74\u5f00\u6e90\u3002\n\n\u7531\u4e8e Docker \u5e26\u6765\u7684\u5de8\u5927\u7684\u4fbf\u5229\uff0c\u8ba9\u5f88\u591a\u5f00\u53d1\u3001\u6d4b\u8bd5\u548c\u8fd0\u7ef4\u7b49\u8f6f\u4ef6\u5f00\u53d1\u73af\u8282\u4e0a\u7684\u5de5\u4f5c\u88ab\u7b80\u5316\u751a\u81f3\u7701\u53bb\uff0c\u6240\u4ee5\u5728\u77ed\u77ed\u7684\u51e0\u5e74\u95f4\u4fbf\u6210\u4e3a\u865a\u62df\u5316\u4e43\u81f3\u6574\u4e2a\u6280\u672f\u9886\u57df\u7684\u70ed\u8bcd\u3002\u540c\u65f6\uff0c\u8bb8\u591a\u5f00\u53d1\u8005\u4e43\u81f3\u5927\u578b\u79d1\u6280\u4f01\u4e1a\u90fd\u53c2\u4e0e\u5230\u4e86 Docker \u76f8\u5173\u9886\u57df\u7684\u8d21\u732e\u4e2d\u6765\uff0c\u4e3a Docker \u53ca\u5176\u751f\u6001\u5708\u8d21\u732e\u4e86\u8bb8\u591a\u4f18\u79c0\u7684\u8f6f\u4ef6\u9879\u76ee\uff0c\u8fd9\u5927\u5927\u63d0\u9ad8\u4e86 Docker \u751f\u6001\u7684\u5b8c\u6574\u6027\uff0c\u4e5f\u8ba9 Docker \u65e5\u76ca\u5065\u58ee\u3002\n\n\u4e5f\u8bb8 dotCloud \u81ea\u5df1\u4e5f\u6ca1\u6709\u60f3\u5230\uff0c\u4e91\u670d\u52a1\u6ca1\u5356\u51fa\u51e0\u4e2a\u94b1\uff0c\u53cd\u5012\u662f Docker \u8d8a\u6765\u8d8a\u706b\u3002\u62e5\u6709\u5546\u4e1a\u5934\u8111\u7684\u4ed6\u4eec\uff0c\u5e72\u8106\u4e0d\u518d\u505a\u4e91\u670d\u52a1\u4e86\uff0c\u4e5f\u628a\u516c\u53f8\u540d\u5b57\u6539\u6210 Docker Inc. \u4e13\u95e8\u4ece\u4e8b Docker \u5468\u8fb9\u7684\u751f\u610f\u3002\n\n\u5f53\u7136\uff0cDocker \u7684\u5546\u4e1a\u5316\u4e5f\u5e26\u6765\u4e86\u4e00\u5b9a\u7684\u53d8\u5316\u3002\u4e3a\u4e86\u66f4\u597d\u7684\u8fdb\u884c\u5546\u4e1a\u8fd0\u4f5c\uff0cDocker Inc. \u5c06 Docker \u5f00\u6e90\u9879\u76ee\u7684\u540d\u79f0\u4fee\u6539\u4e3a\u4e86 Moby\uff0c\u6240\u4ee5\u5927\u5bb6\u8981\u662f\u5728 GitHub \u4e0a\u6ca1\u6709\u641c\u7d22\u5230 Docker \u4e0d\u8981\u89c9\u5f97\u60ca\u8bb6\uff0c\u56e0\u4e3a\u5b83\u73b0\u5728\u7684\u540d\u5b57\u662f Moby ( [https://github.com/moby/moby](https://github.com/moby/moby) )\u3002\n\n\u5173\u4e8e Moby \u548c Docker \u66f4\u591a\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u7ed9\u5927\u5bb6\u63d0\u4f9b\u4e00\u4e0b\u53c2\u8003\u8d44\u6599\uff0c\u6709\u5174\u8da3\u7684\u670b\u53cb\u4eec\u53ef\u4ee5\u524d\u5f80\u9605\u8bfb\uff1a\n\n*   [Docker\u6539\u540d\u5566\uff1f\u4ec0\u4e48\u662f Moby Project](https://yq.aliyun.com/articles/74437)\n*   [\u5bf9\u4e8e Docker \u6539\u540d Moby \uff0c\u5927\u5bb6\u600e\u4e48\u770b\uff1f](https://www.zhihu.com/question/58805021)\n*   [Introducing Moby Project](https://blog.docker.com/2017/04/introducing-the-moby-project/)\n\n## Docker \u6240\u5e26\u6765\u7684\u6539\u53d8\n\n\u7b80\u5355\u8bf4\u4e86\u4e00\u4e9b Docker \u7684\u6545\u4e8b\uff0c\u63a5\u6765\u4e0b\u6211\u4eec\u5c31\u5fc5\u987b\u91cd\u70b9\u8bf4\u4e00\u4e0b Docker \u6240\u5e26\u6765\u7684\u6539\u53d8\u3002\u6b63\u662f\u8fd9\u4e9b\u5bf9\u6211\u4eec\u5de5\u4f5c\u65b9\u5f0f\u7684\u6539\u53d8\uff0c\u8ba9\u6211\u4eec\u8d8a\u6765\u8d8a\u96be\u4ee5\u79bb\u5f00 Docker\uff0c\u53c8\u6e90\u4e8e\u6211\u4eec\u5bf9 Docker \u5982\u6b64\u7684\u559c\u7231\uff0c\u8ba9 Docker \u80fd\u591f\u5728\u77ed\u65f6\u95f4\u5185\u5c31\u4ece\u96cf\u9e1f\u6210\u957f\u4e3a\u5927\u9e4f\uff0c\u6210\u4e3a\u4e07\u4f17\u77a9\u76ee\u7684\u65b0\u661f\u3002\n\n### \u4e91\u8ba1\u7b97\u65f6\u4ee3\u7684\u6311\u6218\n\n\u5728\u8ba1\u7b97\u673a\u6280\u672f\u53d1\u5c55\u7684\u65e9\u671f\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u7a0b\u5e8f\u90fd\u662f\u5728\u5f00\u53d1\u540e\u90e8\u7f72\u5230\u4e00\u53f0\u6216\u662f\u5c11\u6570\u51e0\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u3002\u90a3\u65f6\u7684\u7a0b\u5e8f\u4e5f\u51e0\u4e4e\u90fd\u662f\u96c6\u6240\u6709\u6a21\u5757\u548c\u8fd0\u884c\u65f6\u73af\u5883\u4e3a\u4e00\u8eab\u7684\u201c\u5168\u6808\u5e94\u7528\u201d\uff0c\u867d\u7136\u8fd9\u4e9b\u7a0b\u5e8f\u53ef\u4ee5\u57fa\u4e8e\u4e00\u5957\u826f\u597d\u3001\u5b8c\u5584\u7684\u534f\u8bae\u6808 ( \u8b6c\u5982\u4e00\u5957\u5b8c\u6574\u7684 MVC \u67b6\u6784 ) \u8fdb\u884c\u5f00\u53d1\uff0c\u4f46\u518d\u597d\u7684\u67b6\u6784\u4e5f\u65e0\u6cd5\u8ba9\u5e94\u7528\u670d\u52a1\u5728\u8fd9\u79cd\u4f53\u7cfb\u4e0b\u5feb\u901f\u53d1\u5c55\u3002\n\n\u968f\u7740\u4e92\u8054\u7f51\u7684\u6781\u901f\u53d1\u5c55\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u529f\u80fd\u8d8a\u6765\u8d8a\u4e30\u5bcc\uff0c\u800c\u9700\u8981\u8fed\u4ee3\u7684\u901f\u5ea6\u8981\u6c42\u4e5f\u8d8a\u6765\u8d8a\u9ad8\uff0c\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e9b\u76ee\u6807\uff0c\u5e94\u7528\u7684\u5f00\u53d1\u9010\u6e10\u8d8b\u5411\u670d\u52a1\u5316\u751a\u81f3\u5fae\u670d\u52a1\u5316\u3002\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u90fd\u6709\u5176\u5bf9\u5e94\u4f9d\u8d56\u7684\u64cd\u4f5c\u7cfb\u7edf\u6216\u8005\u5176\u4ed6\u7a0b\u5e8f\uff0c\u800c\u5728\u5c06\u5e94\u7528\u7a0b\u5e8f\u7ec6\u5206\u4e3a\u4e0d\u540c\u7684\u5fae\u670d\u52a1\u6216\u8005\u662f\u5176\u4ed6\u5f62\u5f0f\u7684\u5fae\u5c0f\u5e94\u7528\u6a21\u5757\u540e\uff0c\u89e3\u51b3\u8fd9\u79cd\u4f9d\u8d56\u95ee\u9898\u4f1a\u6108\u53d1\u663e\u5f97\u68d8\u624b\u3002\u6709\u7684\u5e94\u7528\u8fd0\u884c\u73af\u5883\u7279\u522b\u590d\u6742\uff0c\u642d\u5efa\u8fc7\u7a0b\u4e5f\u6781\u6613\u51fa\u9519\uff0c\u8fd9\u90fd\u662f\u8ba9\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u8fd0\u7ef4\u4eba\u5458\u7126\u5934\u70c2\u989d\u7684\u5730\u65b9\u3002\u66f4\u591a\u65f6\u5019\uff0c\u5f00\u53d1\u8005\u4eec\u80af\u5b9a\u66f4\u613f\u610f\u5c06\u4ed6\u4eec\u5b9d\u8d35\u7684\u65f6\u95f4\u7528\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u800c\u4e0d\u662f\u7ea0\u7f20\u7740\u5e94\u7528\u8fd0\u884c\u73af\u5883\u7684\u95ee\u9898\u4e0a\u3002\n\n![\u5206\u5e03\u5f0f\u5e94\u7528\u670d\u52a1\u4f53\u7cfb](https://user-gold-cdn.xitu.io/2018/9/2/165997343db35f56?w=1140&h=869&f=png&s=223317)\n\n\u540c\u65f6\uff0c\u7531\u4e8e\u7269\u7406\u786c\u4ef6\u7684\u66f4\u65b0\u8fed\u4ee3\u901f\u5ea6\u5df2\u7ecf\u96be\u4ee5\u8ffd\u8d76\u4e92\u8054\u7f51\u7684\u811a\u6b65\uff0c\u5e94\u7528\u7684\u90e8\u7f72\u9010\u6e10\u8f6c\u5411\u96c6\u7fa4\u5316\u3002\u5e94\u7528\u6a21\u5757\u7684\u6570\u91cf\u4e58\u4e0a\u6bcf\u4e2a\u5e94\u7528\u6240\u90e8\u7f72\u7684\u673a\u5668\u7684\u6570\u91cf\uff0c\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u5e9e\u5927\u7684\u6570\u5b57\u3002\u76f8\u4fe1\u6240\u6709\u7684\u5f00\u53d1\u6216\u8005\u8fd0\u7ef4\u90fd\u4e0d\u4f1a\u613f\u610f\u628a\u65f6\u95f4\u6d6a\u8d39\u5728\u9010\u4e00\u642d\u5efa\u670d\u52a1\u5668\u73af\u5883\u8fd9\u79cd\u91cd\u590d\u7684\u52b3\u52a8\u4e0a\u3002\n\n\u8fd9\u4e9b\u53d8\u5316\u90fd\u5bf9\u5e94\u7528\u7684\u5f00\u53d1\u3001\u90e8\u7f72\u5e26\u6765\u4e86\u4e0d\u5c0f\u7684\u6311\u6218\u3002\n\n\u6211\u60f3\u5f88\u591a\u8bfb\u8005\u5df2\u7ecf\u60f3\u5230\u4e86\u5e94\u5bf9\u8fd9\u4e9b\u6311\u6218\u7684\u529e\u6cd5\u4e86\uff0c\u6ca1\u9519\uff0c\u90a3\u5c31\u662f\u865a\u62df\u5316\u6280\u672f\u3002\u901a\u8fc7\u865a\u62df\u5316\u6280\u672f\u53ef\u4ee5\u8ba9\u73af\u5883\u7684\u642d\u5efa\u53d8\u5f97\u66f4\u52a0\u7684\u5bb9\u6613\uff0c\u5bf9\u6211\u4eec\u5feb\u901f\u90e8\u7f72\u5206\u5e03\u5f0f\u5e94\u7528\u670d\u52a1\u4f53\u7cfb\u63d0\u4f9b\u4e86\u6781\u5927\u7684\u4fbf\u5229\u3002\n\n\u8fdb\u800c\u8a00\u4e4b\uff0c\u5982\u679c\u6211\u4eec\u628a\u7ba1\u7406\u73af\u5883\u7684\u590d\u6742\u5ea6\uff0c\u66f4\u8f7b\u91cf\u7ea7\u7684\u865a\u62df\u5316\u5b9e\u73b0\u7b49\u66f4\u52a0\u5b9e\u9645\u7684\u95ee\u9898\u8003\u8651\u8fdb\u53bb\uff0c\u5bb9\u5668\u6280\u672f\u81ea\u7136\u6210\u4e86\u865a\u62df\u5316\u6280\u672f\u4e2d\u6700\u4f73\u7684\u9009\u62e9\u9879\u3002\n\n### \u7686\u4e3a\u6548\u7387\n\n\u5982\u679c\u8bf4\u5728\u5206\u5e03\u5f0f\u90e8\u7f72\u4e2d\u5e94\u7528\u5bb9\u5668\u6280\u672f\u662f\u4e00\u4e2a\u65b9\u5411\uff0c\u90a3\u4e48 Docker \u5c31\u662f\u5728\u8fd9\u4e2a\u65b9\u5411\u4e0a\u8dd1\u5f97\u6700\u5feb\u4e5f\u6700\u5b8c\u7f8e\u7684\u8fd0\u52a8\u5458\u4e86\u3002Docker \u4e0d\u8bba\u4ece\u5b9e\u73b0\u5bb9\u5668\u6280\u672f\u7684\u5b8c\u6574\u6027\u4e0a\u6765\u8bf4\uff0c\u8fd8\u662f\u4ece\u4e0a\u624b\u6613\u7528\u6027\u6765\u8bf4\uff0c\u90fd\u662f\u53ef\u5708\u53ef\u70b9\u7684\u3002\n\n\u597d\u4e86\uff0c\u8fd9\u91cc\u6211\u8981\u7a7f\u63d2\u4e00\u4e0b\u63a8\u8350 Docker \u7684\u539f\u56e0\u4e86\u3002\u6211\u4eec\u4f7f\u7528 Docker \u7684\u76ee\u7684\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5c31\u662f**\u5229\u7528\u5b83\u7684\u5168\u9762\u6027\u548c\u6613\u7528\u6027\u5e26\u6765\u7684\u63d0\u5347\u6211\u4eec\u7684\u5de5\u4f5c\u6548\u7387**\u3002\u4e86\u89e3\u4e86\u8fd9\u4e2a\u76ee\u7684\uff0c\u6211\u60f3\u5927\u5bb6\u4f1a\u66f4\u5bb9\u6613\u7406\u89e3\u5f88\u591a\u573a\u5408 Docker \u80fd\u6d3e\u4e0a\u7528\u573a\u7684\u539f\u56e0\u3002\u5f53\u7136\uff0c\u901a\u8fc7\u8fd9\u4e2a\u9053\u7406\uff0c\u4f60\u4e5f\u5c31\u660e\u767d\u4e86\u4e3a\u4ec0\u4e48\u6211\u4f1a\u8bf4 Docker \u662f\u4e00\u95e8\u65b0\u65f6\u4ee3\u5f00\u53d1\u8005\u5fc5\u987b\u638c\u63e1\u7684\u6280\u672f\u4e86\u3002\u6bd5\u7adf\u6240\u6709\u7684\u8001\u677f\u90fd\u5e0c\u671b\u627e\u5230\u4f1a\u5f97\u591a\u3001\u5e72\u6d3b\u5feb\u7684\u4f18\u79c0\u5f00\u53d1\u8005 ( \u4ea6\u6216\u8005\u8bf4\uff0c\u4f1a\u7684\u591a\u3001\u5e72\u6d3b\u5feb\u662f\u4f18\u79c0\u5f00\u53d1\u8005\u6240\u5fc5\u5907\u7684\u54c1\u8d28 )\u3002\n\n\u518d\u600e\u4e48\u4ece\u7406\u8bba\u4e0a\u8bf4\u5feb\u4e5f\u662f\u5f88\u96be\u670d\u4f17\u7684\uff0c\u662f\u9aa1\u5b50\u662f\u9a6c\u62c9\u51fa\u6765\u201c\u8dd1\u4e2a\u5206\u201d\u5c31\u77e5\u9053\u4e86\u3002Docker \u5b98\u65b9\u5bf9 Docker \u5728\u5de5\u4f5c\u4e0a\u5e26\u6765\u7684\u63d0\u5347\u505a\u4e86\u8c03\u67e5\u7814\u7a76\uff0c\u5206\u522b\u4ece\u5de5\u4f5c\u6548\u7387\u7684\u63d0\u5347\u548c\u6280\u672f\u8bbe\u8ba1\u6295\u5165\u7684\u51cf\u5c11\u7b49\u65b9\u9762\u6570\u636e\u5316\u4e86 Docker \u6240\u505a\u51fa\u7684\u7a81\u51fa\u8d21\u732e\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/2/1659994bbc4225dd?w=826&h=1394&f=png&s=231772)\n\n\u76f8\u4fe1\u770b\u5230\u8fd9\u4e9b\u6570\u636e\uff0c\u4f60\u5df2\u7ecf\u660e\u767d\u4e3a\u4f55 Docker \u5907\u53d7\u5173\u6ce8\u7684\u539f\u56e0\u4e86\u3002\n\n## Docker \u7684\u6280\u672f\u5b9e\u73b0\n\n\u8fd9\u91cc\u6211\u4eec\u518d\u7b80\u5355\u4e86\u89e3\u4e00\u4e0b Docker \u7684\u6280\u672f\u5b9e\u73b0\uff0c\u4ee5\u4fbf\u6709\u63a2\u7d22\u6b32\u671b\u7684\u8bfb\u8005\u67e5\u627e\u76f8\u5173\u8d44\u6599\u8fdb\u884c\u6df1\u5165\u9605\u8bfb\u3002\n\nDocker \u7684\u5b9e\u73b0\uff0c\u4e3b\u8981\u5f52\u7ed3\u4e8e\u4e09\u5927\u6280\u672f\uff1a\u547d\u540d\u7a7a\u95f4 ( Namespaces ) \u3001\u63a7\u5236\u7ec4 ( Control Groups ) \u548c\u8054\u5408\u6587\u4ef6\u7cfb\u7edf ( Union File System ) \u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/2/16599a9d7a391ecf?w=1200&h=330&f=png&s=49811)\n\n### Namespace\n\n\u547d\u540d\u7a7a\u95f4\u662f Linux \u6838\u5fc3\u5728 2.4 \u7248\u672c\u540e\u9010\u6e10\u5f15\u5165\u7684\u4e00\u9879\u7528\u4e8e\u8fd0\u884c\u9694\u79bb\u7684\u6a21\u5757\u3002\n\n\u76f8\u4fe1\u5f88\u591a\u5f00\u53d1\u8005\u5728\u4e0d\u540c\u7684\u7f16\u7a0b\u8bed\u8a00\u4e2d\u90fd\u89c1\u8fc7\u547d\u540d\u7a7a\u95f4\u7684\u6982\u5ff5\uff0c\u5728\u8fd9\u4e9b\u7f16\u7a0b\u8bed\u8a00\u4e2d\uff0c\u547d\u540d\u7a7a\u95f4\u7684\u4e3b\u8981\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u96c6\u5408\u76f8\u540c\u6a21\u5757\u7684\u7c7b\uff0c\u533a\u5206\u4e0d\u540c\u6a21\u5757\u95f4\u7684\u540c\u540d\u7c7b\u3002\n\n\u540c\u6837\u7684\u9053\u7406\uff0cLinux \u5185\u6838\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u5c31\u662f\u80fd\u591f\u5c06\u8ba1\u7b97\u673a\u8d44\u6e90\u8fdb\u884c\u5207\u5272\u5212\u5206\uff0c\u5f62\u6210\u5404\u81ea\u72ec\u7acb\u7684\u7a7a\u95f4\u3002\n\n\u5c31\u5b9e\u73b0\u800c\u8a00\uff0cLinux Namespaces \u53ef\u4ee5\u5206\u4e3a\u5f88\u591a\u5177\u4f53\u7684\u5b50\u7cfb\u7edf\uff0c\u5982 User Namespace\u3001Net Namespace\u3001PID Namespace\u3001Mount Namespace \u7b49\u7b49\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u4ee5\u8fdb\u7a0b\u4e3a\u4f8b\uff0c\u901a\u8fc7 PID Namespace\uff0c\u6211\u4eec\u53ef\u4ee5\u9020\u5c31\u4e00\u4e2a\u72ec\u7acb\u7684\u8fdb\u7a0b\u8fd0\u884c\u7a7a\u95f4\uff0c\u5728\u5176\u4e2d\u8fdb\u7a0b\u7684\u7f16\u53f7\u53c8\u4f1a\u4ece 1 \u5f00\u59cb\u3002\u5728\u8fd9\u4e2a\u7a7a\u95f4\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5b8c\u5168\u611f\u77e5\u4e0d\u5230\u5916\u754c\u7cfb\u7edf\u4e2d\u7684\u5176\u4ed6\u8fdb\u7a0b\u6216\u662f\u5176\u4ed6\u8fdb\u7a0b\u547d\u540d\u7a7a\u95f4\u4e2d\u8fd0\u884c\u7684\u8fdb\u7a0b\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/2/16599ae7734e4bbd?w=1200&h=520&f=png&s=82060)\n\n\u5229\u7528 PID Namespace\uff0cDocker \u5c31\u5b9e\u73b0\u4e86\u5bb9\u5668\u4e2d\u9694\u79bb\u7a0b\u5e8f\u8fd0\u884c\u4e2d\u8fdb\u7a0b\u9694\u79bb\u8fd9\u4e00\u76ee\u6807\u3002\n\n### Control Groups\n\n\u8d44\u6e90\u63a7\u5236\u7ec4 ( \u5e38\u7f29\u5199\u4e3a CGroups ) \u662f Linux \u5185\u6838\u5728 2.6 \u7248\u672c\u540e\u9010\u6e10\u5f15\u5165\u7684\u4e00\u9879\u5bf9\u8ba1\u7b97\u673a\u8d44\u6e90\u63a7\u5236\u7684\u6a21\u5757\u3002\n\n\u987e\u540d\u601d\u4e49\uff0c\u8d44\u6e90\u63a7\u5236\u7ec4\u7684\u4f5c\u7528\u5c31\u662f\u63a7\u5236\u8ba1\u7b97\u673a\u8d44\u6e90\u7684\u3002\u4e0e\u4ee5\u9694\u79bb\u8fdb\u7a0b\u3001\u7f51\u7edc\u3001\u6587\u4ef6\u7cfb\u7edf\u7b49\u865a\u62df\u8d44\u6e90\u4e3a\u76ee\u7684 Namespace \u4e0d\u540c\uff0cCGroups \u4e3b\u8981\u505a\u7684\u662f\u786c\u4ef6\u8d44\u6e90\u7684\u9694\u79bb\u3002\n\n\u4e4b\u524d\u6211\u4eec\u63d0\u5230\u4e86\uff0c\u865a\u62df\u5316\u9664\u4e86\u5236\u9020\u51fa\u865a\u62df\u7684\u73af\u5883\u9694\u79bb\u540c\u4e00\u7269\u7406\u5e73\u53f0\u8fd0\u884c\u7684\u4e0d\u540c\u7a0b\u5e8f\u4e4b\u5916\uff0c\u53e6\u4e00\u5927\u4f5c\u7528\u5c31\u662f\u63a7\u5236\u786c\u4ef6\u8d44\u6e90\u7684\u5206\u914d\uff0cCGroups \u7684\u4f7f\u7528\u6b63\u662f\u4e3a\u4e86\u8fd9\u6837\u7684\u76ee\u7684\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/3/1659fe616f839787?w=1200&h=500&f=png&s=51915)\n\n\u9700\u8981\u518d\u5f3a\u8c03\u4e00\u6b21\u7684\u662f\uff0cCGroups \u9664\u4e86\u8d44\u6e90\u7684\u9694\u79bb\uff0c\u8fd8\u6709\u8d44\u6e90**\u5206\u914d**\u8fd9\u4e2a\u5173\u952e\u6027\u7684\u4f5c\u7528\u3002\u901a\u8fc7 CGroups\uff0c\u6211\u4eec\u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u4e00\u4e2a\u9694\u79bb\u73af\u5883\u5bf9\u4efb\u610f\u8d44\u6e90\u7684\u5360\u7528\u503c\u6216\u5360\u7528\u7387\uff0c\u8fd9\u5bf9\u4e8e\u5f88\u591a\u5206\u5e03\u5f0f\u4f7f\u7528\u573a\u666f\u6765\u8bf4\u662f\u975e\u5e38\u6709\u7528\u7684\u529f\u80fd\u3002\n\n\u4f8b\u5982\uff0c\u6211\u4eec\u5728\u670d\u52a1\u5668\u4e0a\u90e8\u7f72\u4e00\u4e2a\u4e1a\u52a1\u670d\u52a1\u548c\u4e00\u4e2a\u5065\u5eb7\u76d1\u63a7\u670d\u52a1\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u76d1\u63a7\u670d\u52a1\u53ea\u4f1a\u5360\u7528\u5f88\u5c11\u7684\u8ba1\u7b97\u673a\u8d44\u6e90\uff0c\u4f46\u6211\u4eec\u65e0\u6cd5\u4fdd\u8bc1\u5176\u4e0d\u4f1a\u56e0\u4e3a\u4e00\u4e9b\u903b\u8f91\u95ee\u9898\u4ea7\u751f Bug \u8fdb\u800c\u8fc7\u5206\u6d88\u8017\u8ba1\u7b97\u673a\u8d44\u6e90\u3002\u800c\u5b83\u7533\u8bf7\u7684\u8ba1\u7b97\u673a\u8d44\u6e90\u8d8a\u591a\uff0c\u610f\u5473\u7740\u4e1a\u52a1\u670d\u52a1\u6240\u80fd\u4f7f\u7528\u7684\u8ba1\u7b97\u673a\u8d44\u6e90\u4e5f\u5c31\u8d8a\u5c11\uff0c\u6700\u540e\u751a\u81f3\u53ef\u80fd\u9020\u6210\u7269\u7406\u670d\u52a1\u5668\u7684\u5d29\u6e83\u3002\n\n\u4e0a\u8ff0\u7684\u95ee\u9898\u5728\u6ca1\u6709\u9694\u79bb\u5b9e\u73b0\u7684\u666e\u901a\u8fd0\u884c\u73af\u5883\u4e0b\u662f\u6bd4\u8f83\u96be\u89e3\u51b3\u7684\uff0c\u56e0\u4e3a\u6240\u6709\u4e0d\u4ece\u7cfb\u7edf\u5c42\u9762\u51fa\u53d1\u7684\u9650\u5236\u7a0b\u5e8f\u8d44\u6e90\u4f7f\u7528\u7684\u65b9\u5f0f\u90fd\u5e76\u4e0d\u5b8c\u5168\u6709\u6548\u3002\u7531\u4e8e CGroups \u5b9e\u73b0\u4e8e\u64cd\u4f5c\u7cfb\u7edf\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u5784\u65ad\u7740\u7cfb\u7edf\u8d44\u6e90\u7684\u5206\u914d\uff0c\u6240\u4ee5\u5176\u5b8c\u5168\u80fd\u591f\u9650\u5236\u9694\u79bb\u73af\u5883\u4e0b\u5e94\u7528\u7684\u8d44\u6e90\u5360\u6709\u91cf\u3002\n\n### Union File System\n\n\u8054\u5408\u6587\u4ef6\u7cfb\u7edf ( Union File System ) \u662f\u4e00\u79cd\u80fd\u591f\u540c\u65f6\u6302\u8f7d\u4e0d\u540c\u5b9e\u9645\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u5230\u540c\u4e00\u76ee\u5f55\uff0c\u5f62\u6210\u4e00\u79cd**\u8054\u5408\u6587\u4ef6\u7ed3\u6784**\u7684\u6587\u4ef6\u7cfb\u7edf\u3002\u8054\u5408\u6587\u4ef6\u7cfb\u7edf\u672c\u8eab\u4e0e\u865a\u62df\u5316\u5e76\u65e0\u592a\u5927\u7684\u5173\u7cfb\uff0c\u4f46 Docker \u5374\u521b\u65b0\u7684\u5c06\u5176\u5f15\u5165\u5230\u5bb9\u5668\u5b9e\u73b0\u4e2d\uff0c\u7528\u5b83\u89e3\u51b3\u865a\u62df\u73af\u5883\u5bf9\u6587\u4ef6\u7cfb\u7edf\u5360\u7528\u8fc7\u91cf\uff0c\u5b9e\u73b0\u865a\u62df\u73af\u5883\u5feb\u901f\u542f\u505c\u7b49\u95ee\u9898\u3002\n\n\u5728 Docker \u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u5bf9 UnionFS \u7684\u6539\u8fdb\u5b9e\u73b0\uff0c\u4e5f\u5c31\u662f AUFS ( Advanced Union File System )\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/3/1659ff1c8e6f1c3c?w=1200&h=770&f=png&s=107859)\n\nAUFS \u5c06\u6587\u4ef6\u7684\u66f4\u65b0\u6302\u8f7d\u5230\u8001\u7684\u6587\u4ef6\u4e4b\u4e0a\uff0c\u800c\u4e0d\u53bb\u4fee\u6539\u90a3\u4e9b\u4e0d\u66f4\u65b0\u7684\u5185\u5bb9\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u5373\u4f7f\u865a\u62df\u7684\u6587\u4ef6\u7cfb\u7edf\u88ab\u53cd\u590d\u4fee\u6539\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u5bf9\u771f\u5b9e\u6587\u4ef6\u7cfb\u7edf\u7684\u7a7a\u95f4\u5360\u7528\u4fdd\u6301\u4e00\u4e2a\u8f83\u4f4e\u6c34\u5e73\u3002\n\n\u4e5f\u8bb8\u8fd9\u4e2a\u8868\u8ff0\u8fd8\u4e0d\u591f\u5f62\u8c61\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u7528 Git \u8fdb\u884c\u6bd4\u8f83\uff0c\u4f1a\u8ba9\u5927\u5bb6\u4f1a\u66f4\u5bb9\u6613\u7406\u89e3\u3002\u5927\u5bb6\u77e5\u9053\uff0c\u6211\u4eec\u5728 Git \u4e2d\u6bcf\u8fdb\u884c\u4e00\u6b21\u63d0\u4ea4\uff0cGit \u5e76\u4e0d\u662f\u5c06\u6211\u4eec\u6240\u6709\u7684\u5185\u5bb9\u6253\u5305\u6210\u4e00\u4e2a\u7248\u672c\uff0c\u800c\u53ea\u662f\u5c06\u4fee\u6539\u7684\u90e8\u5206\u8fdb\u884c\u8bb0\u5f55\uff0c\u8fd9\u6837\u5373\u4f7f\u6211\u4eec\u63d0\u4ea4\u5f88\u591a\u6b21\u540e\uff0c\u4ee3\u7801\u5e93\u7684\u7a7a\u95f4\u5360\u7528\u4e5f\u4e0d\u4f1a\u500d\u6570\u589e\u52a0\u3002\n\n\u540c\u6837\u7684\uff0c\u901a\u8fc7 AUFS\uff0cDocker \u5927\u5e45\u51cf\u5c11\u4e86\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u5bf9\u7269\u7406\u5b58\u50a8\u7a7a\u95f4\u7684\u5360\u7528\u3002\u7531\u6b64\uff0cDocker \u4e5f\u5f00\u521b\u51fa\u4e86\u865a\u62df\u5316\u9886\u57df\u5f88\u591a\u65b0\u7684\u8f7b\u91cf\u7ea7\u89e3\u51b3\u65b9\u6848\uff0c\u8fd9\u5728\u4e4b\u540e\u7684\u5c0f\u8282\u91cc\u6211\u4eec\u4f1a\u63d0\u5230\u3002\n\n## Docker \u7684\u7406\u5ff5\n\n\u5728\u5bf9 Docker \u53ca\u5176\u80cc\u540e\u7684\u4e00\u4e9b\u6280\u672f\u6709\u4e86\u4e00\u4e2a\u521d\u6b65\u4e86\u89e3\u4e4b\u540e\uff0c\u6211\u4eec\u8fd8\u8981\u7740\u91cd\u8bf4\u4e00\u4e0b Docker \u672c\u8eab\u7684\u4e00\u4e9b\u8bbe\u8ba1\u7406\u5ff5\u3002\u5982\u679c\u8bf4\u719f\u6089 Docker \u80cc\u540e\u7684\u6280\u672f\u80fd\u591f\u66f4\u597d\u7684\u5e2e\u52a9\u4f60\u6b63\u786e\u4f7f\u7528 Docker\uff0c\u90a3\u4e48\u7406\u89e3 Docker \u7684\u7406\u5ff5\u5c06\u66f4\u597d\u7684\u6307\u5bfc\u4f60\u5982\u4f55\u642d\u914d Docker \u5bb9\u5668\u95f4\u7684\u5173\u7cfb\u3002\n\n\u8ba9\u6211\u4eec\u5148\u6765\u4ece\u4e00\u5f20 Docker \u5b98\u65b9\u63d0\u4f9b\u7684\u67b6\u6784\u56fe\u6765\u770b\u770b Docker \u5bf9\u5bb9\u5668\u7ed3\u6784\u7684\u8bbe\u8ba1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/7/165b2a9bd4a1a1b4?w=1239&h=630&f=png&s=64225)\n\n\u4e0e\u5176\u4ed6\u865a\u62df\u5316\u5b9e\u73b0\u751a\u81f3\u5176\u4ed6\u5bb9\u5668\u5f15\u64ce\u4e0d\u540c\u7684\u662f\uff0cDocker \u63a8\u5d07\u4e00\u79cd\u8f7b\u91cf\u7ea7\u5bb9\u5668\u7684\u7ed3\u6784\uff0c\u5373\u4e00\u4e2a\u5e94\u7528\u4e00\u4e2a\u5bb9\u5668\u3002\n\n\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u5728\u5e38\u89c1\u7684\u865a\u62df\u673a\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u8981\u642d\u5efa\u4e00\u5957 LAMP \u7ed3\u6784\u7684\u670d\u52a1\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u5efa\u7acb\u4e00\u4e2a\u865a\u62df\u673a\uff0c\u5728\u865a\u62df\u673a\u4e2d\u5b89\u88c5\u4e0a Linux \u7cfb\u7edf\uff0c\u4e4b\u540e\u5206\u522b\u5b89\u88c5 Apache\u3001MySQL \u548c PHP\u3002\u800c\u5728 Docker \u91cc\uff0c\u6700\u4f73\u7684\u5b9e\u8df5\u662f\u5206\u522b\u57fa\u4e8e Apache\u3001MySQL \u548c PHP \u7684\u955c\u50cf\u5efa\u7acb\u4e09\u4e2a\u5bb9\u5668\uff0c\u5206\u522b\u8fd0\u884c Apache\u3001MySQL \u548c PHP \uff0c\u800c\u5b83\u4eec\u6240\u5728\u7684\u865a\u62df\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u76f4\u63a5\u5171\u4eab\u4e8e\u5bbf\u4e3b\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002\n\n\u5982\u679c\u6211\u4eec\u5c06 Docker \u7684\u8f7b\u91cf\u7ea7\u5bb9\u5668\u5b9e\u73b0\u548c\u865a\u62df\u673a\u7684\u4e00\u4e9b\u53c2\u6570\u8fdb\u884c\u5bf9\u6bd4\uff0c\u66f4\u5bb9\u6613\u5f97\u5230\u7ed3\u679c\u3002\n\n\u5c5e\u6027\n\nDocker\n\n\u865a\u62df\u673a\n\n\u542f\u52a8\u901f\u5ea6\n\n\u79d2\u7ea7\n\n\u5206\u949f\u7ea7\n\n\u786c\u76d8\u4f7f\u7528\n\nMB \u7ea7\n\nGB \u7ea7\n\n\u6027\u80fd\n\n\u63a5\u8fd1\u539f\u751f\n\n\u8f83\u4f4e\n\n\u666e\u901a\u673a\u5668\u652f\u6491\u91cf\n\n\u6570\u767e\u4e2a\n\n\u51e0\u4e2a\n\n\u867d\u7136\u8fd9\u91cc\u53ea\u5217\u51fa\u4e86\u4e00\u4e9b Docker \u7684\u4f18\u52bf\u9879\uff0c\u4f46\u8fd9\u4e9b\u4f18\u52bf\u90fd\u662f\u5bf9\u6211\u4eec\u5f00\u53d1\u4e2d\u73af\u5883\u642d\u5efa\u548c\u4f7f\u7528\u6781\u5176\u6709\u5e2e\u52a9\u7684\u5185\u5bb9\u3002\u5c31\u62ff\u542f\u52a8\u901f\u5ea6\u6765\u8bf4\uff0c\u6211\u4eec\u5728\u5f00\u53d1\u4e2d\u663e\u7136\u4e0d\u613f\u610f\u8c03\u6574\u73af\u5883\u6216\u66f4\u65b0\u4ee3\u7801\u540e\u8981\u7b49\u5f85\u51e0\u5206\u949f\u6765\u8ba9\u5176\u751f\u6548\uff0cDocker \u79d2\u7ea7\u7684\u542f\u52a8\u901f\u5ea6\u51e0\u4e4e\u8ba9\u6211\u4eec\u611f\u77e5\u4e0d\u5230\u6211\u4eec\u5bf9\u73af\u5883\u505a\u4e86\u4ec0\u4e48\u6539\u52a8\u3002\u800c\u50cf\u865a\u62df\u673a\u5360\u7528\u5927\u91cf\u64cd\u4f5c\u7cfb\u7edf\u8d44\u6e90\uff0c\u5bfc\u81f4\u6211\u4eec\u672c\u5730\u5f00\u53d1\u4f7f\u7528\u7535\u8111\u8fc7\u6162 ( \u6709\u65f6\u5019\u4e0d\u5f97\u4e0d\u5c06\u73af\u5883\u642d\u5efa\u5728\u53e6\u5916\u7684\u673a\u5668\u4e0a\uff0c\u4f46\u8fd9\u663e\u7136\u5728\u4ee3\u7801\u7f16\u5199\u5230\u8fd0\u884c\u81ea\u6d4b\u7684\u8fc7\u7a0b\u4e2d\u589e\u52a0\u5f88\u591a\u5de5\u4f5c\u91cf ) \u7b49\u95ee\u9898\uff0c\u4e5f\u5bb9\u6613\u5f97\u5230\u89e3\u51b3\u3002\n\n\u5f53\u7136\uff0c\u5728 Docker \u4e2d\u80fd\u5b9e\u73b0\u8fd9\u6837\u7684\u8bbe\u8ba1\u7406\u5ff5\uff0c\u8fd8\u8981\u5f52\u529f\u4e8e\u51e0\u9879\u57fa\u7840\u8bbe\u65bd\u7684\u652f\u6301\u3002\n\n\u9996\u5148\uff0c\u53ea\u6709\u5728\u5bb9\u5668\u6280\u672f\u7684\u652f\u6491\u4e0b\uff0c\u5e94\u7528\u5373\u5bb9\u5668\u7684\u65b9\u6848\u624d\u80fd\u6709\u6548\u7684\u5b9e\u65bd\u3002\u56e0\u4e3a\u5bb9\u5668\u6280\u672f\u65e2\u5254\u9664\u4e86 Hypervisor \u5c42\uff0c\u53c8\u5e72\u6389\u4e86\u865a\u62df\u64cd\u4f5c\u7cfb\u7edf\u7684\u6982\u5ff5\uff0c\u8ba9\u5bb9\u5668\u4e2d\u5e94\u7528\u8fd0\u884c\u7684\u6d88\u8017\u4e0e\u771f\u5b9e\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u8fd0\u884c\u7684\u6d88\u8017\u51e0\u4e4e\u5b8c\u5168\u4e00\u81f4\u3002\u53ea\u6709\u8fd9\u6837\uff0c\u6211\u4eec\u624d\u80fd\u50cf\u5728\u771f\u5b9e\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5f00\u542f\u5e94\u7528\u4e00\u6837\u5f00\u542f\u65b0\u7684\u5bb9\u5668\uff0c\u800c\u4e0d\u7528\u8fc7\u5206\u62c5\u5fc3\u865a\u62df\u5316\u5e26\u6765\u7684\u6027\u80fd\u6d88\u8017\u3002\n\n\u5176\u6b21\uff0c\u57fa\u4e8e\u8054\u5408\u6587\u4ef6\u7cfb\u7edf\u7684\u5e95\u5c42\u6587\u4ef6\u7cfb\u7edf\u652f\u6301\uff0c\u8ba9\u5bb9\u5668\u80fd\u591f\u5f88\u5bb9\u6613\u5728\u771f\u5b9e\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5171\u4eab\u5b58\u50a8\u8d44\u6e90\uff0c\u5e76\u7531\u6b64\u5e26\u6765\u4e86\u5bf9\u5b58\u50a8\u7a7a\u95f4\u7684\u4f4e\u6d88\u8017\u3002\u4e0e\u52a8\u8f84\u5c31\u8981\u72ec\u7acb\u5f00\u8f9f\u5341\u51e0 GB \u751a\u81f3\u51e0\u5341 GB \u7684\u865a\u62df\u5316\u5b9e\u73b0\u76f8\u6bd4\uff0c\u8981\u5b58\u5728\u5de8\u5927\u7684\u4f18\u52bf\u3002\n\n\u5f53\u7136\uff0cDocker \u4e5f\u652f\u6301\u4f60\u5728\u5bb9\u5668\u4e2d\u540c\u65f6\u8fd0\u884c\u5f88\u591a\u79cd\u7a0b\u5e8f\uff0c\u4f46\u5176\u5bb9\u5668\u8bbe\u8ba1\u672c\u8eab\u5e76\u4e0d\u9488\u5bf9\u8fd9\u79cd\u65b9\u6848\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u4ee5\u8fd9\u79cd\u65b9\u6848\u5728 Docker \u4e2d\u642d\u5efa\u73af\u5883\uff0c\u4f60\u4f1a\u82b1\u8d39\u4e0d\u5c11\u65f6\u95f4\u505a\u51fa\u4e00\u4e9b\u672c\u6765\u5e76\u4e0d\u9700\u8981\u505a\u7684\u4e8b\u60c5\u3002\u867d\u7136\u8fd9\u770b\u4e0a\u53bb\u52a8\u624b\u6027\u5f88\u5f3a\uff0c\u4f46\u6211\u5e76\u4e0d\u63a8\u8350\u5728\u5de5\u4f5c\u4e2d\u8fd9\u4e48\u53bb\u505a\uff0c\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528 Docker \u672c\u8eab\u5c31\u662f\u4e3a\u4e86\u6548\u7387\uff0c\u6d6a\u8d39\u65f6\u95f4\u5728\u8fd9\u4e9b\u4e0d\u5fc5\u8981\u7684\u4e8b\u60c5\u4e0a\uff0c\u5df2\u7ecf\u8fdd\u80cc\u4e86\u6211\u4eec\u4f7f\u7528 Docker \u7684\u521d\u8877\u3002\n\n## \u6211\u4eec\u80fd\u7528 Docker \u505a\u4e9b\u4ec0\u4e48\n\n\u4ece\u7406\u8bba\u4e0a\u6211\u4eec\u5df2\u7ecf\u77e5\u9053 Docker \u80fd\u591f\u4e3a\u6211\u4eec\u7684\u5de5\u4f5c\u5e26\u6765\u5de8\u5927\u7684\u4fbf\u5229\uff0c\u90a3\u4e48\u5c06\u5176\u653e\u4e8e\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u6b63\u786e\u7684\u4f7f\u7528\u5b83\u5462\uff1f\u8fd9\u91cc\u6211\u6458\u5f55\u6574\u7406\u4e86\u4e00\u6bb5\u6765\u81ea Docker \u5b98\u65b9\u6587\u6863\u7684\u6307\u5bfc\u610f\u89c1\uff0c\u5e0c\u671b\u80fd\u591f\u5bf9\u5927\u5bb6\u7684\u5b9e\u8df5\u63d0\u4f9b\u53c2\u8003\u3002\n\n### \u66f4\u5feb\u3001\u66f4\u4e00\u81f4\u7684\u4ea4\u4ed8\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\n\n\u4f7f\u7528 Docker \u540e\uff0c\u5f00\u53d1\u8005\u80fd\u591f\u5728\u672c\u5730\u5bb9\u5668\u4e2d\u5f97\u5230\u4e00\u5957\u6807\u51c6\u7684\u5e94\u7528\u6216\u670d\u52a1\u7684\u8fd0\u884c\u73af\u5883\uff0c\u7531\u6b64\u53ef\u4ee5\u7b80\u5316\u5f00\u53d1\u7684\u751f\u547d\u5468\u671f ( \u51cf\u5c11\u5728\u4e0d\u540c\u73af\u5883\u95f4\u8fdb\u884c\u9002\u914d\u3001\u8c03\u6574\u6240\u9020\u6210\u7684\u989d\u5916\u6d88\u8017 )\u3002\u5bf9\u4e8e\u6574\u4e2a\u5e94\u7528\u8fed\u4ee3\u6765\u8bf4\uff0c\u52a0\u5165 Docker \u7684\u5de5\u4f5c\u6d41\u7a0b\u5c06\u66f4\u52a0\u9002\u5408\u6301\u7eed\u96c6\u6210 ( Continuous Integration ) \u548c\u6301\u7eed\u4ea4\u4ed8 ( Continuous Delivery )\u3002\n\n\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff1a\n\n*   \u5f00\u53d1\u8005\u80fd\u591f\u4f7f\u7528 Docker \u5728\u672c\u5730\u7f16\u5199\u4ee3\u7801\u5e76\u901a\u8fc7\u5bb9\u5668\u4e0e\u5176\u4ed6\u540c\u4e8b\u5171\u4eab\u4ed6\u4eec\u7684\u5de5\u4f5c\u3002\n*   \u4ed6\u4eec\u80fd\u591f\u4f7f\u7528 Docker \u5c06\u7f16\u5199\u597d\u7684\u7a0b\u5e8f\u63a8\u9001\u81f3\u6d4b\u8bd5\u73af\u5883\u8fdb\u884c\u81ea\u52a8\u5316\u6d4b\u8bd5\u6216\u662f\u4eba\u5de5\u6d4b\u8bd5\u3002\n*   \u5f53\u51fa\u73b0 Bugs \u65f6\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u4fee\u590d\u5b83\u4eec\uff0c\u5e76\u5f88\u5feb\u7684\u91cd\u65b0\u90e8\u7f72\u5230\u6d4b\u8bd5\u73af\u5883\u4e2d\u3002\n*   \u5728\u6d4b\u8bd5\u5b8c\u6210\u540e\uff0c\u90e8\u7f72\u88c5\u6709\u5e94\u7528\u7a0b\u5e8f\u7684\u955c\u50cf\u5c31\u80fd\u5b8c\u6210\u751f\u4ea7\u73af\u5883\u7684\u53d1\u5e03\u3002\n\n### \u8de8\u5e73\u53f0\u90e8\u7f72\u548c\u52a8\u6001\u4f38\u7f29\n\n\u57fa\u4e8e\u5bb9\u5668\u6280\u672f\u7684 Docker \u62e5\u6709\u5f88\u9ad8\u7684\u8de8\u5e73\u53f0\u6027\uff0cDocker \u7684\u5bb9\u5668\u80fd\u591f\u5f88\u8f7b\u677e\u7684\u8fd0\u884c\u5728\u5f00\u53d1\u8005\u672c\u5730\u7684\u7535\u8111\uff0c\u6570\u636e\u4e2d\u5fc3\u7684\u7269\u7406\u673a\u6216\u865a\u62df\u673a\uff0c\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u7684\u4e91\u670d\u52a1\u5668\uff0c\u751a\u81f3\u662f\u6df7\u5408\u73af\u5883\u4e2d\u3002\n\n\u540c\u65f6\uff0cDocker \u7684\u8f7b\u91cf\u6027\u548c\u9ad8\u53ef\u79fb\u690d\u6027\u80fd\u591f\u5f88\u597d\u7684\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u5e94\u7528\u7684\u52a8\u6001\u4f38\u7f29\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u624b\u6bb5\u8fd1\u5b9e\u65f6\u7684\u5bf9\u57fa\u4e8e Docker \u8fd0\u884c\u7684\u5e94\u7528\u8fdb\u884c\u5f39\u6027\u4f38\u7f29\uff0c\u8fd9\u80fd\u591f\u5927\u5e45\u63d0\u9ad8\u5e94\u7528\u7684\u5065\u58ee\u6027\u3002\n\n### \u8ba9\u540c\u6837\u7684\u786c\u4ef6\u63d0\u4f9b\u66f4\u591a\u7684\u4ea7\u51fa\u80fd\u529b\n\nDocker \u7684\u9ad8\u6548\u548c\u8f7b\u91cf\u7b49\u7279\u5f81\uff0c\u4e3a\u66ff\u4ee3\u57fa\u4e8e Hypervisor \u7684\u865a\u62df\u673a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7ecf\u6d4e\u3001\u9ad8\u6548\u3001\u53ef\u884c\u7684\u65b9\u6848\u3002\u5728 Docker \u4e0b\uff0c\u4f60\u80fd\u8282\u7ea6\u51fa\u66f4\u591a\u7684\u8d44\u6e90\u6295\u5165\u5230\u4e1a\u52a1\u4e2d\u53bb\uff0c\u8ba9\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u66f4\u9ad8\u7684\u6548\u76ca\u3002\u540c\u65f6\uff0c\u5982\u6b64\u4f4e\u7684\u8d44\u6e90\u6d88\u8017\u4e5f\u8bf4\u660e\u4e86 Docker \u975e\u5e38\u9002\u5408\u5728\u9ad8\u5bc6\u5ea6\u7684\u4e2d\u5c0f\u578b\u90e8\u7f72\u573a\u666f\u4e2d\u4f7f\u7528\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u8fd9\u8282\u4e2d\uff0c\u6211\u4eec\u6eaf\u6e90 Docker \u7684\u5386\u53f2\uff0c\u4ece\u5176\u8bde\u751f\u7684\u80cc\u666f\u548c\u5176\u89e3\u51b3\u7684\u95ee\u9898\u51fa\u53d1\uff0c\u9610\u8ff0\u4e86 Docker \u80cc\u540e\u7684\u6280\u672f\u548c Docker \u672c\u8eab\u7684\u8bbe\u8ba1\u7406\u5ff5\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> Docker \u6240\u63d0\u5021\u7684\u8f7b\u91cf\u7ea7\u865a\u62df\u5316\u4e0e\u5176\u4ed6\u865a\u62df\u5316\u5b9e\u73b0\u4e2d\u7684\u5b8c\u6574\u64cd\u4f5c\u7cfb\u7edf\u865a\u62df\u5316\u6709\u4ec0\u4e48\u6837\u7684\u4f18\u52bf\uff0c\u5176\u4f18\u52bf\u53c8\u80fd\u5e94\u7528\u5230\u54ea\u4e9b\u5b9e\u9645\u7684\u573a\u666f\u4e2d\u53bb\u5462\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker \u7684\u53d1\u5c55\u5386\u53f2\uff0cDocker \u80cc\u540e\u7684\u6280\u672f\u6216\u8005 Docker \u6240\u63a8\u5d07\u7684\u7406\u5ff5\u8fd8\u6709\u4e0d\u89e3\u4e4b\u5904\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u57fa\u7840\u6982\u5ff5\u8fd9\u662f_Docker_\u7684\u7b80\u5386.md", "create_date": "2020-02-18T21:18:39.107", "order": 2}}, {"model": "subject.chapter", "pk": 68, "fields": {"title": "\u4f7f\u7528\u5bb9\u5668\uff1a\u7ba1\u7406\u548c\u5b58\u50a8\u6570\u636e", "topic": 3, "md5": "0307c03879509f86b1e92505b3ce0201", "md_body": "# \u7ba1\u7406\u548c\u5b58\u50a8\u6570\u636e\n\n\u6570\u636e\u662f\u5e94\u7528\u7a0b\u5e8f\u91cd\u8981\u7684\u4ea7\u51fa\uff0c\u6240\u4ee5\u5f88\u597d\u7684\u7ba1\u7406\u548c\u5b58\u50a8\u6570\u636e\uff0c\u662f\u5bf9\u5e94\u7528\u7a0b\u5e8f\u52b3\u52a8\u7ed3\u679c\u7684\u5c0a\u91cd\u3002\u7279\u522b\u662f\u5728\u5927\u6570\u636e\u65f6\u4ee3\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u662f\u91cd\u8981\u7684\u8d44\u4ea7\uff0c\u4fdd\u62a4\u597d\u6570\u636e\u662f\u6bcf\u4e2a\u5f00\u53d1\u8005\u5fc5\u987b\u638c\u63e1\u7684\u6280\u80fd\u3002\u6211\u4eec\u77e5\u9053\uff0c\u5728 Docker \u91cc\uff0c\u5bb9\u5668\u8fd0\u884c\u7684\u6587\u4ef6\u7cfb\u7edf\u5904\u4e8e\u6c99\u76d2\u73af\u5883\u4e2d\uff0c\u4e0e\u5916\u754c\u5176\u5b9e\u662f\u9694\u79bb\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u53c8\u8981\u5982\u4f55\u5728 Docker \u4e2d\u5408\u7406\u7684\u901a\u8fc7\u6587\u4ef6\u4e0e\u5916\u754c\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u5462\uff1f\u5728\u8fd9\u4e00\u5c0f\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u4ecb\u7ecd Docker \u4e2d\u4e0e\u6587\u4ef6\u6570\u636e\u6709\u5173\u7684\u5185\u5bb9\u3002\n\n## \u6570\u636e\u7ba1\u7406\u5b9e\u73b0\u65b9\u5f0f\n\nDocker \u5bb9\u5668\u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u4e8e\u6211\u4eec\u8fd9\u4e9b\u5f00\u53d1\u4f7f\u7528\u8005\u6765\u8bf4\uff0c\u867d\u7136\u6709\u5f88\u591a\u4f18\u52bf\uff0c\u4f46\u4e5f\u6709\u5f88\u591a\u5f0a\u7aef\uff0c\u5176\u4e2d\u663e\u8457\u7684\u4e24\u70b9\u5c31\u662f\uff1a\n\n*   \u6c99\u76d2\u6587\u4ef6\u7cfb\u7edf\u662f\u8ddf\u968f\u5bb9\u5668\u751f\u547d\u5468\u671f\u6240\u521b\u5efa\u548c\u79fb\u9664\u7684\uff0c\u6570\u636e\u65e0\u6cd5\u76f4\u63a5\u88ab\u6301\u4e45\u5316\u5b58\u50a8\u3002\n*   \u7531\u4e8e\u5bb9\u5668\u9694\u79bb\uff0c\u6211\u4eec\u5f88\u96be\u4ece\u5bb9\u5668\u5916\u90e8\u83b7\u5f97\u6216\u64cd\u4f5c\u5bb9\u5668\u5185\u90e8\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u3002\n\n\u5f53\u7136\uff0cDocker \u5f88\u597d\u7684\u89e3\u51b3\u4e86\u8fd9\u4e9b\u95ee\u9898\uff0c\u8fd9\u4e3b\u8981\u8fd8\u662f\u5f52\u529f\u4e8e Docker \u5bb9\u5668\u6587\u4ef6\u7cfb\u7edf\u662f\u57fa\u4e8e UnionFS\u3002\u7531\u4e8e UnionFS \u652f\u6301\u6302\u8f7d\u4e0d\u540c\u7c7b\u578b\u7684\u6587\u4ef6\u7cfb\u7edf\u5230\u7edf\u4e00\u7684\u76ee\u5f55\u7ed3\u6784\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5c06\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u6587\u4ef6\u7cfb\u7edf\u91cc\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff0c\u4fbf\u80fd\u591f\u8ba9\u5bb9\u5668\u5185\u5916\u5171\u4eab\u8fd9\u4e2a\u6587\u4ef6\u3002\n\n\u7531\u4e8e\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u4e92\u901a\u5bb9\u5668\u5185\u5916\u7684\u6587\u4ef6\uff0c\u90a3\u4e48\u6587\u4ef6\u6570\u636e\u6301\u4e45\u5316\u548c\u64cd\u4f5c\u5bb9\u5668\u5185\u6587\u4ef6\u7684\u95ee\u9898\u5c31\u81ea\u7136\u800c\u7136\u7684\u89e3\u51b3\u4e86\u3002\n\n\u540c\u65f6\uff0cUnionFS \u5e26\u6765\u7684\u8bfb\u5199\u6027\u80fd\u635f\u5931\u662f\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u7684\uff0c\u6240\u4ee5\u8fd9\u79cd\u5b9e\u73b0\u53ef\u4ee5\u8bf4\u662f\u76f8\u5f53\u4f18\u79c0\u7684\u3002\n\n### \u6302\u8f7d\u65b9\u5f0f\n\n\u57fa\u4e8e\u5e95\u5c42\u5b58\u50a8\u5b9e\u73b0\uff0cDocker \u63d0\u4f9b\u4e86\u4e09\u79cd\u9002\u7528\u4e8e\u4e0d\u540c\u573a\u666f\u7684\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u65b9\u5f0f\uff1a**Bind Mount**\u3001**Volume** \u548c **Tmpfs Mount**\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/25/1660eff4b182c891?w=1391&h=549&f=png&s=43471)\n\n*   **Bind Mount** \u80fd\u591f\u76f4\u63a5\u5c06\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u76ee\u5f55\u548c\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u901a\u8fc7\u6307\u5b9a\u5bb9\u5668\u5916\u7684\u8def\u5f84\u548c\u5bb9\u5668\u5185\u7684\u8def\u5f84\uff0c\u5c31\u53ef\u4ee5\u5f62\u6210\u6302\u8f7d\u6620\u5c04\u5173\u7cfb\uff0c\u5728\u5bb9\u5668\u5185\u5916\u5bf9\u6587\u4ef6\u7684\u8bfb\u5199\uff0c\u90fd\u662f\u76f8\u4e92\u53ef\u89c1\u7684\u3002\n    \n*   **Volume** \u4e5f\u662f\u4ece\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6302\u8f7d\u76ee\u5f55\u5230\u5bb9\u5668\u5185\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u6302\u8f7d\u7684\u76ee\u5f55\u7531 Docker \u8fdb\u884c\u7ba1\u7406\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6307\u5b9a\u5bb9\u5668\u5185\u7684\u76ee\u5f55\uff0c\u4e0d\u9700\u8981\u5173\u5fc3\u5177\u4f53\u6302\u8f7d\u5230\u4e86\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u54ea\u91cc\u3002\n    \n*   **Tmpfs Mount** \u652f\u6301\u6302\u8f7d\u7cfb\u7edf\u5185\u5b58\u4e2d\u7684\u4e00\u90e8\u5206\u5230\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u91cc\uff0c\u4e0d\u8fc7\u7531\u4e8e\u5185\u5b58\u548c\u5bb9\u5668\u7684\u7279\u5f81\uff0c\u5b83\u7684\u5b58\u50a8\u5e76\u4e0d\u662f\u6301\u4e45\u7684\uff0c\u5176\u4e2d\u7684\u5185\u5bb9\u4f1a\u968f\u7740\u5bb9\u5668\u7684\u505c\u6b62\u800c\u6d88\u5931\u3002\n    \n\n## \u6302\u8f7d\u6587\u4ef6\u5230\u5bb9\u5668\n\n\u8981\u5c06\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5bb9\u5668\u521b\u5efa\u7684\u65f6\u5019\u901a\u8fc7\u4f20\u9012 `-v` \u6216 `--volume` \u9009\u9879\u6765\u6307\u5b9a\u5185\u5916\u6302\u8f7d\u7684\u5bf9\u5e94\u76ee\u5f55\u6216\u6587\u4ef6\u3002\n\n```\n$ sudo docker run -d --name nginx -v /webapp/html:/usr/share/nginx/html nginx:1.12\n\n```\n\n\u4f7f\u7528 `-v` \u6216 `--volume` \u6765\u6302\u8f7d\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u76ee\u5f55\u7684\u5f62\u5f0f\u662f `-v <host-path>:<container-path>` \u6216 `--volume <host-path>:<container-path>`\uff0c\u5176\u4e2d host-path \u548c container-path \u5206\u522b\u4ee3\u8868\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u76ee\u5f55\u548c\u5bb9\u5668\u4e2d\u7684\u76ee\u5f55\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e3a\u4e86\u907f\u514d\u6df7\u6dc6\uff0cDocker \u8fd9\u91cc\u5f3a\u5236\u5b9a\u4e49\u76ee\u5f55\u65f6\u5fc5\u987b\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\uff0c\u4e0d\u80fd\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\u3002\n\n\u6211\u4eec\u80fd\u591f\u6307\u5b9a\u76ee\u5f55\u8fdb\u884c\u6302\u8f7d\uff0c\u4e5f\u80fd\u591f\u6307\u5b9a\u5177\u4f53\u7684\u6587\u4ef6\u6765\u6302\u8f7d\uff0c\u5177\u4f53\u9009\u62e9\u4f55\u79cd\u5f62\u5f0f\u6765\u6302\u8f7d\uff0c\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u7684\u60c5\u51b5\u6765\u9009\u62e9\u3002\n\n\u5f53\u6302\u8f7d\u4e86\u76ee\u5f55\u7684\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5728\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u6587\u4ef6\u5df2\u7ecf\u51fa\u73b0\u5728\u5bb9\u5668\u4e2d\u4e86\u3002\n\n```\n$ sudo docker exec nginx ls /usr/share/nginx/html\nindex.html\n\n```\n\n\u5728 `docker inspect` \u7684\u7ed3\u679c\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u5173\u5bb9\u5668\u6570\u636e\u6302\u8f7d\u76f8\u5173\u7684\u4fe1\u606f\u3002\n\n```\n$ sudo docker inspect nginx\n[\n    {\n## ......\n        \"Mounts\": [\n            {\n                \"Type\": \"bind\",\n                \"Source\": \"/webapp/html\",\n                \"Destination\": \"/usr/share/nginx/html\",\n                \"Mode\": \"\",\n                \"RW\": true,\n                \"Propagation\": \"rprivate\"\n            }\n        ],\n## ......\n    }\n]\n\n```\n\n\u5728\u5173\u4e8e\u6302\u8f7d\u7684\u4fe1\u606f\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a RW \u5b57\u6bb5\uff0c\u8fd9\u8868\u793a\u6302\u8f7d\u76ee\u5f55\u6216\u6587\u4ef6\u7684\u8bfb\u5199\u6027 ( Read and Write )\u3002\u5b9e\u9645\u64cd\u4f5c\u4e2d\uff0cDocker \u8fd8\u652f\u6301\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u6302\u8f7d\uff0c\u901a\u8fc7\u53ea\u8bfb\u65b9\u5f0f\u6302\u8f7d\u7684\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u53ea\u80fd\u88ab\u5bb9\u5668\u4e2d\u7684\u7a0b\u5e8f\u8bfb\u53d6\uff0c\u4f46\u4e0d\u63a5\u53d7\u5bb9\u5668\u4e2d\u7a0b\u5e8f\u4fee\u6539\u5b83\u4eec\u7684\u8bf7\u6c42\u3002\u5728\u6302\u8f7d\u9009\u9879 `-v` \u540e\u518d\u63a5\u4e0a `:ro` \u5c31\u53ef\u4ee5\u53ea\u8bfb\u6302\u8f7d\u4e86\u3002\n\n```\n$ sudo docker run -d --name nginx -v /webapp/html:/usr/share/nginx/html:ro nginx:1.12\n\n```\n\n\u7531\u4e8e\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u6587\u4ef6\u6302\u8f7d\u5728\u6743\u9650\u5141\u8bb8\u7684\u60c5\u51b5\u4e0b\u80fd\u591f\u6302\u8f7d\u4efb\u4f55\u76ee\u5f55\u6216\u6587\u4ef6\uff0c\u8fd9\u7ed9\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u9020\u6210\u4e86\u4e00\u5b9a\u7684\u9690\u60a3\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u4f7f\u7528 Bind Mount \u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u7279\u522b\u6ce8\u610f\u6302\u8f7d\u7684\u5916\u90e8\u76ee\u5f55\u9009\u62e9\u3002\u5f53\u7136\uff0c\u5728\u4fdd\u8bc1\u5b89\u5168\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u6709\u51e0\u79cd\u5e38\u89c1\u573a\u666f\u975e\u5e38\u9002\u5408\u4f7f\u7528\u8fd9\u79cd\u6302\u8f7d\u65b9\u5f0f\u3002\n\n*   \u5f53\u6211\u4eec\u9700\u8981\u4ece\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u5171\u4eab\u914d\u7f6e\u7684\u65f6\u5019\u3002\u5bf9\u4e8e\u4e00\u4e9b\u914d\u7f6e\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4ece\u5bb9\u5668\u5916\u90e8\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff0c\u8fd9\u5229\u4e8e\u4fdd\u8bc1\u5bb9\u5668\u4e2d\u7684\u914d\u7f6e\u4e3a\u6211\u4eec\u6240\u786e\u8ba4\u7684\u503c\uff0c\u4e5f\u65b9\u4fbf\u6211\u4eec\u5bf9\u914d\u7f6e\u8fdb\u884c\u76d1\u63a7\u3002\u4f8b\u5982\uff0c\u9047\u5230\u5bb9\u5668\u4e2d\u65f6\u533a\u4e0d\u6b63\u786e\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u533a\u914d\u7f6e\uff0c\u4e5f\u5c31\u662f /etc/timezone \u8fd9\u4e2a\u6587\u4ef6\u6302\u8f7d\u5e76\u8986\u76d6\u5bb9\u5668\u4e2d\u7684\u65f6\u533a\u914d\u7f6e\u3002\n    \n*   \u5f53\u6211\u4eec\u9700\u8981\u501f\u52a9 Docker \u8fdb\u884c\u5f00\u53d1\u7684\u65f6\u5019\u3002\u867d\u7136\u5728 Docker \u4e2d\uff0c\u63a8\u5d07\u76f4\u63a5\u5c06\u4ee3\u7801\u548c\u914d\u7f6e\u6253\u5305\u8fdb\u955c\u50cf\uff0c\u4ee5\u4fbf\u5feb\u901f\u90e8\u7f72\u548c\u5feb\u901f\u91cd\u5efa\u3002\u4f46\u8fd9\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u663e\u7136\u975e\u5e38\u4e0d\u65b9\u4fbf\uff0c\u56e0\u4e3a\u6bcf\u6b21\u6784\u5efa\u955c\u50cf\u9700\u8981\u8017\u8d39\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u8fd9\u4e9b\u65f6\u95f4\u79ef\u5c11\u6210\u591a\uff0c\u5c31\u662f\u5bf9\u5f00\u53d1\u5de5\u4f5c\u6548\u7387\u7684\u4e25\u91cd\u6d6a\u8d39\u4e86\u3002\u5982\u679c\u6211\u4eec\u76f4\u63a5\u628a\u4ee3\u7801\u6302\u8f7d\u8fdb\u5165\u5bb9\u5668\uff0c\u90a3\u4e48\u6211\u4eec\u6bcf\u6b21\u5bf9\u4ee3\u7801\u7684\u4fee\u6539\u90fd\u53ef\u4ee5\u76f4\u63a5\u5728\u5bb9\u5668\u5916\u90e8\u8fdb\u884c\u3002\n    \n\n### \u6302\u8f7d\u4e34\u65f6\u6587\u4ef6\u76ee\u5f55\n\nTmpfs Mount \u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6302\u8f7d\u65b9\u5f0f\uff0c\u5b83\u4e3b\u8981\u5229\u7528\u5185\u5b58\u6765\u5b58\u50a8\u6570\u636e\u3002\u7531\u4e8e\u5185\u5b58\u4e0d\u662f\u6301\u4e45\u6027\u5b58\u50a8\u8bbe\u5907\uff0c\u6240\u4ee5\u5176\u5e26\u7ed9 Tmpfs Mount \u7684\u7279\u5f81\u5c31\u662f\u4e34\u65f6\u6027\u6302\u8f7d\u3002\n\n\u4e0e\u6302\u8f7d\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u76ee\u5f55\u6216\u6587\u4ef6\u4e0d\u540c\uff0c\u6302\u8f7d\u4e34\u65f6\u6587\u4ef6\u76ee\u5f55\u8981\u901a\u8fc7 `--tmpfs` \u8fd9\u4e2a\u9009\u9879\u6765\u5b8c\u6210\u3002\u7531\u4e8e\u5185\u5b58\u7684\u5177\u4f53\u4f4d\u7f6e\u4e0d\u9700\u8981\u6211\u4eec\u6765\u6307\u5b9a\uff0c\u8fd9\u4e2a\u9009\u9879\u91cc\u6211\u4eec\u53ea\u9700\u8981\u4f20\u9012\u6302\u8f7d\u5230\u5bb9\u5668\u5185\u7684\u76ee\u5f55\u5373\u53ef\u3002\n\n```\n$ sudo docker run -d --name webapp --tmpfs /webapp/cache webapp:latest\n\n```\n\n\u5bb9\u5668\u5df2\u6302\u8f7d\u7684\u4e34\u65f6\u6587\u4ef6\u76ee\u5f55\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 `docker inspect` \u547d\u4ee4\u67e5\u770b\u3002\n\n```\n$ sudo docker inspect webapp\n[\n    {\n## ......\n         \"Tmpfs\": {\n            \"/webapp/cache\": \"\"\n        },\n## ......\n    }\n]\n\n```\n\n\u6302\u8f7d\u4e34\u65f6\u6587\u4ef6\u9996\u5148\u8981\u6ce8\u610f\u5b83\u4e0d\u662f\u6301\u4e45\u5b58\u50a8\u8fd9\u4e00\u7279\u6027\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u5b83\u6709\u51e0\u79cd\u5e38\u89c1\u7684\u9002\u5e94\u573a\u666f\u3002\n\n*   \u5e94\u7528\u4e2d\u4f7f\u7528\u5230\uff0c\u4f46\u4e0d\u9700\u8981\u8fdb\u884c\u6301\u4e45\u4fdd\u5b58\u7684\u654f\u611f\u6570\u636e\uff0c\u53ef\u4ee5\u501f\u52a9\u5185\u5b58\u7684\u975e\u6301\u4e45\u6027\u548c\u7a0b\u5e8f\u9694\u79bb\u6027\u8fdb\u884c\u4e00\u5b9a\u7684\u5b89\u5168\u4fdd\u969c\u3002\n    \n*   \u8bfb\u5199\u901f\u5ea6\u8981\u6c42\u8f83\u9ad8\uff0c\u6570\u636e\u53d8\u5316\u91cf\u5927\uff0c\u4f46\u4e0d\u9700\u8981\u6301\u4e45\u4fdd\u5b58\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u501f\u52a9\u5185\u5b58\u7684\u9ad8\u8bfb\u5199\u901f\u5ea6\u51cf\u5c11\u64cd\u4f5c\u7684\u65f6\u95f4\u3002\n    \n\n## \u4f7f\u7528\u6570\u636e\u5377\n\n\u9664\u4e86\u4e0e\u5176\u4ed6\u865a\u62df\u673a\u5de5\u5177\u8fd1\u4f3c\u7684\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u76ee\u5f55\u6302\u8f7d\u7684\u529f\u80fd\u5916\uff0cDocker \u8fd8\u521b\u9020\u4e86\u6570\u636e\u5377 ( Volume ) \u8fd9\u4e2a\u6982\u5ff5\u3002\u6570\u636e\u5377\u7684\u672c\u8d28\u5176\u5b9e\u4f9d\u7136\u662f\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u76ee\u5f55\u5b58\u653e\u5728 Docker \u5185\u90e8\uff0c\u63a5\u53d7 Docker \u7684\u7ba1\u7406\u3002\n\n\u5728\u4f7f\u7528\u6570\u636e\u5377\u8fdb\u884c\u6302\u8f7d\u65f6\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u77e5\u9053\u6570\u636e\u5177\u4f53\u5b58\u50a8\u5728\u4e86\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u4f55\u5904\uff0c\u53ea\u9700\u8981\u7ed9\u5b9a\u5bb9\u5668\u4e2d\u7684\u54ea\u4e2a\u76ee\u5f55\u4f1a\u88ab\u6302\u8f7d\u5373\u53ef\u3002\n\n\u6211\u4eec\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 `-v` \u6216 `--volume` \u9009\u9879\u6765\u5b9a\u4e49\u6570\u636e\u5377\u7684\u6302\u8f7d\u3002\n\n```\n$ sudo docker run -d --name webapp -v /webapp/storage webapp:latest\n\n```\n\n\u6570\u636e\u5377\u6302\u8f7d\u5230\u5bb9\u5668\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `docker inspect` \u770b\u5230\u5bb9\u5668\u4e2d\u6570\u636e\u5377\u6302\u8f7d\u7684\u4fe1\u606f\u3002\n\n```\n$ sudo docker inspect webapp\n[\n    {\n## ......\n        \"Mounts\": [\n            {\n                \"Type\": \"volume\",\n                \"Name\": \"2bbd2719b81fbe030e6f446243386d763ef25879ec82bb60c9be7ef7f3a25336\",\n                \"Source\": \"/var/lib/docker/volumes/2bbd2719b81fbe030e6f446243386d763ef25879ec82bb60c9be7ef7f3a25336/_data\",\n                \"Destination\": \"/webapp/storage\",\n                \"Driver\": \"local\",\n                \"Mode\": \"\",\n                \"RW\": true,\n                \"Propagation\": \"\"\n            }\n        ],\n## ......\n    }\n]\n\n```\n\n\u8fd9\u91cc\u6211\u4eec\u6240\u5f97\u5230\u7684\u4fe1\u606f\u4e0e\u7ed1\u5b9a\u6302\u8f7d\u6709\u6240\u533a\u522b\uff0c\u9664\u4e86 Type \u4e2d\u7684\u7c7b\u578b\u4e0d\u4e00\u6837\u4e4b\u5916\uff0c\u5728\u6570\u636e\u5377\u6302\u8f7d\u4e2d\uff0c\u6211\u4eec\u8fd8\u8981\u5173\u6ce8\u4e00\u4e0b Name \u548c Source \u8fd9\u4e24\u4e2a\u4fe1\u606f\u3002\n\n\u5176\u4e2d Source \u662f Docker \u4e3a\u6211\u4eec\u5206\u914d\u7528\u4e8e\u6302\u8f7d\u7684\u5bbf\u4e3b\u673a\u76ee\u5f55\uff0c\u5176\u4f4d\u4e8e Docker \u7684\u8d44\u6e90\u533a\u57df ( \u8fd9\u91cc\u662f\u9ed8\u8ba4\u7684 /var/lib/docker ) \u5185\u3002\u5f53\u7136\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5173\u5fc3\u8fd9\u4e2a\u76ee\u5f55\uff0c\u4e00\u5207\u5bf9\u5b83\u7684\u7ba1\u7406\u90fd\u5df2\u7ecf\u5728 Docker \u5185\u5b9e\u73b0\u4e86\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u8bc6\u522b\u6570\u636e\u5377\uff0c\u6211\u4eec\u53ef\u4ee5\u50cf\u547d\u540d\u5bb9\u5668\u4e00\u6837\u4e3a\u6570\u636e\u5377\u547d\u540d\uff0c\u8fd9\u91cc\u7684 Name \u5c31\u662f\u6570\u636e\u5377\u7684\u547d\u540d\u3002\u5728\u6211\u4eec\u672a\u7ed9\u51fa\u6570\u636e\u5377\u547d\u540d\u7684\u65f6\u5019\uff0cDocker \u4f1a\u91c7\u7528\u6570\u636e\u5377\u7684 ID \u547d\u540d\u6570\u636e\u5377\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 `-v <name>:<container-path>` \u8fd9\u79cd\u5f62\u5f0f\u6765\u547d\u540d\u6570\u636e\u5377\u3002\n\n```\n$ sudo docker run -d --name webapp -v appdata:/webapp/storage webapp:latest\n\n```\n\n\u7531\u4e8e `-v` \u9009\u9879\u65e2\u627f\u8f7d\u4e86 Bind Mount \u7684\u5b9a\u4e49\uff0c\u53c8\u53c2\u4e0e\u4e86 Volume \u7684\u5b9a\u4e49\uff0c\u6240\u4ee5\u5176\u4f20\u53c2\u65b9\u5f0f\u9700\u8981\u7279\u522b\u7559\u610f\u3002\u524d\u9762\u63d0\u5230\u4e86\uff0c`-v` \u5728\u5b9a\u4e49\u7ed1\u5b9a\u6302\u8f7d\u65f6\u5fc5\u987b\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\uff0c\u5176\u76ee\u7684\u4e3b\u8981\u662f\u4e3a\u4e86\u907f\u514d\u4e0e\u6570\u636e\u5377\u6302\u8f7d\u4e2d\u547d\u540d\u8fd9\u79cd\u5f62\u5f0f\u7684\u51b2\u7a81\u3002\n\n\u867d\u7136\u4e0e\u7ed1\u5b9a\u6302\u8f7d\u7684\u539f\u7406\u5dee\u522b\u4e0d\u5927\uff0c\u4f46\u6570\u636e\u5377\u5728\u8bb8\u591a\u5b9e\u9645\u573a\u666f\u4e0b\u4f60\u4f1a\u53d1\u73b0\u5b83\u5f88\u6709\u7528\u3002\n\n*   \u5f53\u5e0c\u671b\u5c06\u6570\u636e\u5728\u591a\u4e2a\u5bb9\u5668\u95f4\u5171\u4eab\u65f6\uff0c\u5229\u7528\u6570\u636e\u5377\u53ef\u4ee5\u5728\u4fdd\u8bc1\u6570\u636e\u6301\u4e45\u6027\u548c\u5b8c\u6574\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u5b8c\u6210\u66f4\u591a\u81ea\u52a8\u5316\u64cd\u4f5c\u3002\n    \n*   \u5f53\u6211\u4eec\u5e0c\u671b\u5bf9\u5bb9\u5668\u4e2d\u6302\u8f7d\u7684\u5185\u5bb9\u8fdb\u884c\u7ba1\u7406\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u6570\u636e\u5377\u81ea\u8eab\u7684\u7ba1\u7406\u65b9\u6cd5\u5b9e\u73b0\u3002\n    \n*   \u5f53\u4f7f\u7528\u8fdc\u7a0b\u670d\u52a1\u5668\u6216\u4e91\u670d\u52a1\u4f5c\u4e3a\u5b58\u50a8\u4ecb\u8d28\u7684\u65f6\u5019\uff0c\u6570\u636e\u5377\u80fd\u591f\u9690\u85cf\u66f4\u591a\u7684\u7ec6\u8282\uff0c\u8ba9\u6574\u4e2a\u8fc7\u7a0b\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\u3002\n    \n\n### \u5171\u7528\u6570\u636e\u5377\n\n\u6570\u636e\u5377\u7684\u53e6\u4e00\u5927\u4f5c\u7528\u662f\u5b9e\u73b0\u5bb9\u5668\u95f4\u7684\u76ee\u5f55\u5171\u4eab\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u6302\u8f7d\u76f8\u540c\u7684\u6570\u636e\u5377\uff0c\u8ba9\u5bb9\u5668\u4e4b\u95f4\u80fd\u591f\u540c\u65f6\u770b\u5230\u5e76\u64cd\u4f5c\u6570\u636e\u5377\u4e2d\u7684\u5185\u5bb9\u3002\u8fd9\u4e2a\u529f\u80fd\u867d\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ed1\u5b9a\u6302\u8f7d\u6765\u5b9e\u73b0\uff0c\u4f46\u901a\u8fc7\u6570\u636e\u5377\u6765\u64cd\u4f5c\u4f1a\u66f4\u52a0\u7684\u8212\u9002\u3001\u7b80\u5355\u3002\n\n\u7531\u4e8e\u6570\u636e\u5377\u7684\u547d\u540d\u5728 Docker \u4e2d\u662f\u552f\u4e00\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5f88\u5bb9\u6613\u901a\u8fc7\u6570\u636e\u5377\u7684\u540d\u79f0\u786e\u5b9a\u6570\u636e\u5377\uff0c\u8fd9\u5c31\u8ba9\u6211\u4eec\u5f88\u65b9\u4fbf\u7684\u8ba9\u591a\u4e2a\u5bb9\u5668\u6302\u8f7d\u540c\u4e00\u4e2a\u6570\u636e\u5377\u4e86\u3002\n\n```\n$ sudo docker run -d --name webapp -v html:/webapp/html webapp:latest\n$ sudo docker run -d --name nginx -v html:/usr/share/nginx/html:ro nginx:1.12\n\n```\n\n\u6211\u4eec\u4f7f\u7528 `-v` \u9009\u9879\u6302\u8f7d\u6570\u636e\u5377\u65f6\uff0c\u5982\u679c\u6570\u636e\u5377\u4e0d\u5b58\u5728\uff0cDocker \u4f1a\u4e3a\u6211\u4eec\u81ea\u52a8\u521b\u5efa\u548c\u5206\u914d\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u76ee\u5f55\uff0c\u800c\u5982\u679c\u540c\u540d\u6570\u636e\u5377\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u4f1a\u76f4\u63a5\u5f15\u7528\u3002\n\n\u5982\u679c\u6709\u670b\u53cb\u89c9\u5f97\u8fd9\u6837\u5bf9\u6570\u636e\u5377\u7684\u64cd\u4f5c\u65b9\u5f0f\u8fd8\u4e0d\u591f\u76f4\u63a5\u548c\u51c6\u786e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7 `docker volume` \u4e0b\u7684\u51e0\u4e2a\u547d\u4ee4\u4e13\u95e8\u64cd\u4f5c\u6570\u636e\u5377\u3002\n\n\u901a\u8fc7 `docker volume create` \u6211\u4eec\u53ef\u4ee5\u4e0d\u4f9d\u8d56\u4e8e\u5bb9\u5668\u72ec\u7acb\u521b\u5efa\u6570\u636e\u5377\u3002\n\n```\n$ sudo docker volume create appdata\n\n```\n\n\u901a\u8fc7 `docker volume ls` \u53ef\u4ee5\u5217\u51fa\u5f53\u524d\u5df2\u521b\u5efa\u7684\u6570\u636e\u5377\u3002\n\n```\n$ sudo docker volume ls\nDRIVER              VOLUME NAME\nlocal               html\nlocal               appdata\n\n```\n\n### \u5220\u9664\u6570\u636e\u5377\n\n\u867d\u7136\u6570\u636e\u5377\u7684\u76ee\u7684\u662f\u7528\u6765\u6301\u4e45\u5316\u5b58\u50a8\u6570\u636e\u7684\uff0c\u4f46\u6709\u65f6\u5019\u6211\u4eec\u4e5f\u96be\u514d\u6709\u5220\u9664\u5b83\u4eec\u4ee5\u91ca\u653e\u7a7a\u95f4\u7684\u9700\u6c42\u3002\u76f4\u63a5\u53bb Docker \u7684\u76ee\u5f55\u4e0b\u5220\u9664\u663e\u7136\u4e0d\u662f\u597d\u7684\u9009\u62e9\uff0c\u6211\u4eec\u5e94\u8be5\u901a\u8fc7 Docker \u5bf9\u6570\u636e\u5377\u7684\u7ba1\u7406\u547d\u4ee4\u6765\u5220\u9664\u5b83\u4eec\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 `docker volume rm` \u6765\u5220\u9664\u6307\u5b9a\u7684\u6570\u636e\u5377\u3002\n\n```\n$ sudo docker volume rm appdata\n\n```\n\n\u5728\u5220\u9664\u6570\u636e\u5377\u4e4b\u524d\uff0c\u6211\u4eec\u5fc5\u987b\u4fdd\u8bc1\u6570\u636e\u5377\u6ca1\u6709\u88ab\u4efb\u4f55\u5bb9\u5668\u6240\u4f7f\u7528 ( \u4e5f\u5c31\u662f\u4e4b\u524d\u5f15\u7528\u8fc7\u8fd9\u4e2a\u6570\u636e\u5377\u7684\u5bb9\u5668\u90fd\u5df2\u7ecf\u5220\u9664 )\uff0c\u5426\u5219 Docker \u4e0d\u4f1a\u5141\u8bb8\u6211\u4eec\u5220\u9664\u8fd9\u4e2a\u6570\u636e\u5377\u3002\n\n\u5bf9\u4e8e\u6211\u4eec\u6ca1\u6709\u76f4\u63a5\u547d\u540d\u7684\u6570\u636e\u5377\uff0c\u56e0\u4e3a\u8981\u53cd\u590d\u6838\u5bf9\u6570\u636e\u5377 ID\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u5e76\u4e0d\u7b97\u7279\u522b\u53cb\u597d\u3002\u8fd9\u79cd\u6ca1\u6709\u547d\u540d\u7684\u6570\u636e\u5377\uff0c\u901a\u5e38\u6211\u4eec\u53ef\u4ee5\u770b\u6210\u5b83\u4eec\u4e0e\u5bf9\u5e94\u7684\u5bb9\u5668\u4ea7\u751f\u4e86\u7ed1\u5b9a\uff0c\u56e0\u4e3a\u5176\u4ed6\u5bb9\u5668\u5f88\u96be\u4f7f\u7528\u5230\u5b83\u4eec\u3002\u800c\u8fd9\u79cd\u7ed1\u5b9a\u5173\u7cfb\u7684\u4ea7\u751f\uff0c\u4e5f\u8ba9\u6211\u4eec\u53ef\u4ee5\u5728\u5bb9\u5668\u5220\u9664\u65f6\u5c06\u5b83\u4eec\u4e00\u5e76\u5220\u9664\u3002\n\n\u5728 `docker rm` \u5220\u9664\u5bb9\u5668\u7684\u547d\u4ee4\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0 `-v` \u9009\u9879\u6765\u5220\u9664\u5bb9\u5668\u5173\u8054\u7684\u6570\u636e\u5377\u3002\n\n```\n$ sudo docker rm -v webapp\n\n```\n\n\u5982\u679c\u6211\u4eec\u6ca1\u6709\u968f\u5bb9\u5668\u5220\u9664\u8fd9\u4e9b\u6570\u636e\u5377\uff0cDocker \u5728\u521b\u5efa\u65b0\u7684\u5bb9\u5668\u65f6\u4e5f\u4e0d\u4f1a\u542f\u7528\u5b83\u4eec\uff0c\u5373\u4f7f\u5b83\u4eec\u4e0e\u65b0\u521b\u5efa\u5bb9\u5668\u6240\u5b9a\u4e49\u7684\u6570\u636e\u5377\u6709\u5b8c\u5168\u4e00\u81f4\u7684\u7279\u5f81\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6b64\u65f6\u5b83\u4eec\u5df2\u7ecf\u53d8\u6210\u4e86\u5b64\u9b42\u91ce\u9b3c\uff0c\u7eaf\u7cb9\u7684\u5360\u7528\u7740\u786c\u76d8\u7a7a\u95f4\u800c\u53c8\u4e0d\u53d7\u7ba1\u7406\u3002\n\n\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `docker volume rm` \u6765\u5220\u9664\u5b83\u4eec\uff0c\u4f46\u524d\u63d0\u65f6\u4f60\u80fd\u5728\u4e00\u5806\u4e71\u7801\u822c\u7684\u6570\u636e\u5377 ID \u4e2d\u627e\u51fa\u54ea\u4e2a\u662f\u6ca1\u6709\u88ab\u5bb9\u5668\u5f15\u7528\u7684\u6570\u636e\u5377\u3002\n\n\u4e3a\u6b64\uff0cDocker \u5411\u6211\u4eec\u63d0\u4f9b\u4e86 `docker volume prune` \u8fd9\u4e2a\u547d\u4ee4\uff0c\u5b83\u53ef\u4ee5\u5220\u9664\u90a3\u4e9b\u6ca1\u6709\u88ab\u5bb9\u5668\u5f15\u7528\u7684\u6570\u636e\u5377\u3002\n\n```\n$ sudo docker volume prune -f\nDeleted Volumes:\naf6459286b5ce42bb5f205d0d323ac11ce8b8d9df4c65909ddc2feea7c3d1d53\n0783665df434533f6b53afe3d9decfa791929570913c7aff10f302c17ed1a389\n65b822e27d0be93d149304afb1515f8111344da9ea18adc3b3a34bddd2b243c7\n## ......\n\n```\n\n## \u6570\u636e\u5377\u5bb9\u5668\n\n\u5728\u6570\u636e\u5377\u7684\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u6709\u4e00\u79cd\u76f8\u5bf9\u65b0\u9896\u7684\u7528\u6cd5\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u5377\u5bb9\u5668\u3002\u6240\u8c13\u6570\u636e\u5377\u5bb9\u5668\uff0c\u5c31\u662f\u4e00\u4e2a\u6ca1\u6709\u5177\u4f53\u6307\u5b9a\u7684\u5e94\u7528\uff0c\u751a\u81f3\u4e0d\u9700\u8981\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u6211\u4eec\u4f7f\u7528\u5b83\u7684\u76ee\u7684\uff0c\u662f\u4e3a\u4e86\u5b9a\u4e49\u4e00\u4e2a\u6216\u591a\u4e2a\u6570\u636e\u5377\u5e76\u6301\u6709\u5b83\u4eec\u7684\u5f15\u7528\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/26/166135778cfd74c2?w=1462&h=571&f=png&s=43220)\n\n\u521b\u5efa\u6570\u636e\u5377\u5bb9\u5668\u7684\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u7531\u4e8e\u4e0d\u9700\u8981\u5bb9\u5668\u672c\u8eab\u8fd0\u884c\uff0c\u56e0\u800c\u6211\u4eec\u627e\u4e2a\u7b80\u5355\u7684\u7cfb\u7edf\u955c\u50cf\u90fd\u53ef\u4ee5\u5b8c\u6210\u521b\u5efa\u3002\n\n```\n$ sudo docker create --name appdata -v /webapp/storage ubuntu\n\n```\n\n\u5728\u4f7f\u7528\u6570\u636e\u5377\u5bb9\u5668\u65f6\uff0c\u6211\u4eec\u4e0d\u5efa\u8bae\u518d\u5b9a\u4e49\u6570\u636e\u5377\u7684\u540d\u79f0\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5bf9\u6570\u636e\u5377\u5bb9\u5668\u7684\u5f15\u7528\u6765\u5b8c\u6210\u6570\u636e\u5377\u7684\u5f15\u7528\u3002\u800c\u4e0d\u8bbe\u7f6e\u6570\u636e\u5377\u7684\u540d\u79f0\uff0c\u4e5f\u907f\u514d\u4e86\u5728\u540c\u4e00 Docker \u4e2d\u6570\u636e\u5377\u91cd\u540d\u7684\u5c34\u5c2c\u3002\n\n\u4e4b\u524d\u6211\u4eec\u63d0\u5230\uff0cDocker \u7684 Network \u662f\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\u6865\u6881\uff0c\u5982\u679c\u505a\u7c7b\u6bd4\uff0c\u6570\u636e\u5377\u5bb9\u5668\u5c31\u53ef\u4ee5\u7b97\u662f\u5bb9\u5668\u95f4\u7684\u6587\u4ef6\u7cfb\u7edf\u6865\u6881\u3002\u6211\u4eec\u53ef\u4ee5\u50cf\u52a0\u5165\u7f51\u7edc\u4e00\u6837\u5f15\u7528\u6570\u636e\u5377\u5bb9\u5668\uff0c\u53ea\u9700\u8981\u5728\u521b\u5efa\u65b0\u5bb9\u5668\u65f6\u4f7f\u7528\u4e13\u95e8\u7684 `--volumes-from` \u9009\u9879\u5373\u53ef\u3002\n\n```\n$ sudo docker run -d --name webapp --volumes-from appdata webapp:latest\n\n```\n\n\u5f15\u7528\u6570\u636e\u5377\u5bb9\u5668\u65f6\uff0c\u4e0d\u9700\u8981\u518d\u5b9a\u4e49\u6570\u636e\u5377\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\u7684\u4f4d\u7f6e\uff0cDocker \u4f1a\u4ee5\u6570\u636e\u5377\u5bb9\u5668\u4e2d\u7684\u6302\u8f7d\u5b9a\u4e49\u5c06\u6570\u636e\u5377\u6302\u8f7d\u5230\u5f15\u7528\u7684\u5bb9\u5668\u4e2d\u3002\n\n\u867d\u7136\u770b\u4e0a\u53bb\u6570\u636e\u5377\u5bb9\u5668\u4e0e\u6570\u636e\u5377\u7684\u4f7f\u7528\u65b9\u6cd5\u53d8\u5316\u4e0d\u5927\uff0c\u4f46\u6700\u5173\u952e\u7684\u5c31\u5728\u4e8e\u5176\u771f\u6b63\u9690\u85cf\u4e86\u6570\u636e\u5377\u7684\u914d\u7f6e\u548c\u5b9a\u4e49\uff0c\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u6570\u636e\u5377\u5bb9\u5668\u7684\u540d\u79f0\u6765\u4f7f\u7528\u5b83\u3002\u8fd9\u4e9b\u7ec6\u8282\u7684\u9690\u85cf\uff0c\u610f\u5473\u7740\u6211\u4eec\u80fd\u591f\u66f4\u8f7b\u677e\u7684\u5b9e\u73b0\u5bb9\u5668\u7684\u8fc1\u79fb\u3002\n\n### \u5907\u4efd\u548c\u8fc1\u79fb\u6570\u636e\u5377\n\n\u7531\u4e8e\u6570\u636e\u5377\u672c\u8eab\u5c31\u662f\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728 Docker \u8d44\u6e90\u76ee\u5f55\u91cc\u627e\u5230\u5b83\u5c31\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u6253\u5305\u3001\u8fc1\u79fb\u3001\u6062\u590d\u4e86\u3002\u867d\u7136\u8fd9\u4e48\u505a\u76f8\u5bf9\u5176\u4ed6\u865a\u62df\u5316\u65b9\u6848\u6765\u8bf4\u5df2\u7ecf\u5f88\u7b80\u5355\u4e86\uff0c\u4f46\u5728 Docker \u91cc\u8fd8\u4e0d\u662f\u6700\u4f18\u96c5\u7684\u89e3\u51b3\u65b9\u5f0f\u3002\n\n\u5229\u7528\u6570\u636e\u5377\u5bb9\u5668\uff0c\u6211\u4eec\u8fd8\u80fd\u591f\u66f4\u65b9\u4fbf\u7684\u5bf9\u6570\u636e\u5377\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u8fc1\u79fb\u3002\n\n\u6570\u636e\u5907\u4efd\u3001\u8fc1\u79fb\u3001\u6062\u590d\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7406\u89e3\u4e3a\u5bf9\u6570\u636e\u8fdb\u884c\u6253\u5305\uff0c\u79fb\u52a8\u5230\u5176\u4ed6\u4f4d\u7f6e\uff0c\u5728\u9700\u8981\u7684\u5730\u65b9\u89e3\u538b\u7684\u8fc7\u7a0b\u3002\u5728\u6570\u636e\u6253\u5305\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u5efa\u7acb\u4e00\u4e2a\u7528\u6765\u5b58\u653e\u6253\u5305\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 `/backup` \u4f5c\u4e3a\u4f8b\u5b50\u3002\n\n\u8981\u5907\u4efd\u6570\u636e\uff0c\u6211\u4eec\u5148\u5efa\u7acb\u4e00\u4e2a\u4e34\u65f6\u7684\u5bb9\u5668\uff0c\u5c06\u7528\u4e8e\u5907\u4efd\u7684\u76ee\u5f55\u548c\u8981\u5907\u4efd\u7684\u6570\u636e\u5377\u90fd\u6302\u8f7d\u5230\u8fd9\u4e2a\u5bb9\u5668\u4e0a\u3002\n\n```\n$ sudo docker run --rm --volumes-from appdata -v /backup:/backup ubuntu tar cvf /backup/backup.tar /webapp/storage\n\n```\n\n\u5728\u8fd9\u6761\u547d\u4ee4\u4e2d\uff0c\u9664\u4e86\u6302\u8f7d\u7684\u914d\u7f6e\u5916\uff0c\u6211\u4eec\u518d\u6ce8\u610f\u51e0\u4e2a\u9009\u9879\u3002\u901a\u8fc7 `--rm` \u9009\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u5bb9\u5668\u5728\u505c\u6b62\u540e\u81ea\u52a8\u5220\u9664\uff0c\u800c\u4e0d\u9700\u8981\u6211\u4eec\u518d\u4f7f\u7528\u5bb9\u5668\u5220\u9664\u547d\u4ee4\u6765\u5220\u9664\u5b83\uff0c\u8fd9\u5bf9\u4e8e\u6211\u4eec\u4f7f\u7528\u4e00\u4e9b\u4e34\u65f6\u5bb9\u5668\u5f88\u6709\u5e2e\u52a9\u3002\u5728\u5bb9\u5668\u6240\u57fa\u4e8e\u7684\u955c\u50cf\u4e4b\u540e\uff0c\u6211\u4eec\u8fd8\u770b\u5230\u4e86\u4e00\u4e32\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f `tar cvf /backup/backup.tar /webapp/storage`\uff0c\u5176\u5b9e\u5982\u679c\u6211\u4eec\u5728\u955c\u50cf\u5b9a\u4e49\u4e4b\u540e\u63a5\u4e0a\u547d\u4ee4\uff0c\u53ef\u4ee5\u76f4\u63a5\u66ff\u6362\u6389\u955c\u50cf\u6240\u5b9a\u4e49\u7684\u4e3b\u7a0b\u5e8f\u542f\u52a8\u547d\u4ee4\uff0c\u800c\u53bb\u6267\u884c\u8fd9\u4e00\u6761\u547d\u4ee4\u3002\u5728\u5f88\u591a\u573a\u5408\u4e0b\uff0c\u6211\u4eec\u8fd8\u80fd\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u5e72\u5f88\u591a\u4e0d\u540c\u7684\u4e8b\u60c5\u3002\n\n\u5728\u5907\u4efd\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 /backup \u4e0b\u627e\u5230\u6570\u636e\u5377\u7684\u5907\u4efd\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f backup.tar \u4e86\u3002\n\n\u5982\u679c\u8981\u6062\u590d\u6570\u636e\u5377\u4e2d\u7684\u6570\u636e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u501f\u52a9\u4e34\u65f6\u5bb9\u5668\u5b8c\u6210\u3002\n\n```\n$ docker run --rm --volumes-from appdata -v /backup:/backup ubuntu tar xvf /backup/backup.tar -C /webapp/storage --strip\n\n```\n\n\u6062\u590d\u7684\u8fc7\u7a0b\u4e0e\u5907\u4efd\u7684\u8fc7\u7a0b\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u628a\u6253\u5305\u7684\u547d\u4ee4\u8f6c\u6362\u4e3a\u89e3\u5305\u7684\u547d\u4ee4\u800c\u5df2\u3002\n\n## \u53e6\u4e00\u4e2a\u6302\u8f7d\u9009\u9879\n\n\u4e0a\u9762\u6211\u4eec\u8bb2\u5230\u4e86\u4f7f\u7528 `-v` \u9009\u9879\u6765\u6302\u8f7d\u5b58\u5728\u5bb9\u6613\u6df7\u6dc6\u7684\u95ee\u9898\uff0c\u5176\u4e3b\u8981\u539f\u56e0\u662f\u6302\u8f7d\u7684\u65b9\u5f0f\u548c\u914d\u7f6e\u968f\u7740 Docker \u7684\u4e0d\u65ad\u53d1\u5c55\u65e5\u6e10\u4e30\u5bcc\uff0c\u800c `-v` \u9009\u9879\u7684\u4f20\u53c2\u65b9\u5f0f\u9650\u5236\u4e86\u5b83\u80fd\u4f7f\u7528\u7684\u573a\u666f\u3002\n\n\u5176\u5b9e\u5728 Docker \u91cc\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u76f8\u5bf9\u652f\u6301\u4e30\u5bcc\u7684\u6302\u8f7d\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7 `--mount` \u8fd9\u4e2a\u9009\u9879\u914d\u7f6e\u6302\u8f7d\u3002\n\n```\n$ sudo docker run -d --name webapp webapp:latest --mount 'type=volume,src=appdata,dst=/webapp/storage,volume-driver=local,volume-opt=type=nfs,volume-opt=device=<nfs-server>:<nfs-path>' webapp:latest\n\n```\n\n\u5728 `--mount` \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u9017\u53f7\u5206\u9694\u8fd9\u79cd CSV \u683c\u5f0f\u6765\u5b9a\u4e49\u591a\u4e2a\u53c2\u6570\u3002\u5176\u4e2d\uff0c\u901a\u8fc7 type \u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u6302\u8f7d\u7c7b\u578b\uff0c\u5176\u503c\u53ef\u4ee5\u662f\uff1abind\uff0cvolume \u6216 tmpfs\u3002\u53e6\u5916\uff0c`--mount` \u9009\u9879\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u96c6\u7fa4\u6302\u8f7d\u7684\u5b9a\u4e49\uff0c\u4f8b\u5982\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u6302\u8f7d\u7684\u6765\u6e90\u662f\u4e00\u4e2a NFS \u76ee\u5f55\u3002\n\n\u7531\u4e8e\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c`-v` \u57fa\u672c\u4e0a\u8db3\u591f\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u5e38\u4f7f\u7528\u76f8\u5bf9\u590d\u6742\u7684 `--mount` \u9009\u9879\u6765\u5b9a\u4e49\u6302\u8f7d\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u662f\u5c06\u5b83\u7b80\u5355\u4ecb\u7ecd\uff0c\u4f9b\u5927\u5bb6\u53c2\u8003\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u5173\u4e8e\u5982\u4f55\u5728 Docker \u4e2d\u7ba1\u7406\u548c\u5b58\u50a8\u6570\u636e\u7684\u65b9\u6cd5\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u5b9e\u8df5\u9898\uff1a\n\n> \u7ed3\u5408\u6211\u4eec\u6240\u63d0\u5230\u4e09\u79cd\u6302\u8f7d\u65b9\u5f0f\u5404\u81ea\u7684\u9002\u7528\u573a\u666f\uff0c\u5206\u522b\u5c1d\u8bd5\u4f7f\u7528\u5b83\u4eec\u8fdb\u884c\u6570\u636e\u6302\u8f7d\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker \u4e2d\u7684\u6570\u636e\u6302\u8f7d\u8fd8\u6709\u4e0d\u7406\u89e3\u7684\u5730\u65b9\uff0c\u6216\u8005\u5bf9\u5176\u6709\u72ec\u7279\u7684\u89c1\u89e3\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u4f7f\u7528\u5bb9\u5668\u7ba1\u7406\u548c\u5b58\u50a8\u6570\u636e.md", "create_date": "2020-02-18T21:18:39.123", "order": 10}}, {"model": "subject.chapter", "pk": 69, "fields": {"title": "\u4f7f\u7528\u5bb9\u5668\uff1a\u4ece\u955c\u50cf\u4ed3\u5e93\u83b7\u5f97\u955c\u50cf", "topic": 3, "md5": "4d629f7a18be06e1ae0bcfe6d23dae2d", "md_body": "# \u4ece\u955c\u50cf\u4ed3\u5e93\u83b7\u5f97\u955c\u50cf\n\n\u4e4b\u524d\u6211\u4eec\u8bf4\u5230\u4e86\uff0cDocker \u4e0e\u5176\u4ed6\u865a\u62df\u5316\u8f6f\u4ef6\u7684\u4e00\u5904\u4e0d\u540c\u5c31\u662f\u5c06\u955c\u50cf\u7ba1\u7406\u7eb3\u5165\u5230\u4e86\u529f\u80fd\u4e4b\u4e2d\u3002\u5b9e\u73b0\u865a\u62df\u5316\u53ea\u662f\u7a0b\u5e8f\u80fd\u591f\u65e0\u7f1d\u79fb\u690d\u7684\u4e00\u90e8\u5206\uff0c\u800c\u6709\u4e86\u955c\u50cf\u7ba1\u7406\uff0c\u5c31\u771f\u6b63\u53d6\u4ee3\u4e86\u6211\u4eec\u5728\u79fb\u690d\u8fc7\u7a0b\u4e2d\u7684\u7e41\u7410\u64cd\u4f5c\u3002\u5229\u7528 Docker \u7684\u955c\u50cf\u7ba1\u7406\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u548c\u5206\u4eab\u955c\u50cf\uff0c\u5e76\u4fdd\u969c\u955c\u50cf\u5185\u5bb9\u7684\u4e00\u81f4\u6027\u3002\u6240\u4ee5\uff0c\u4e86\u89e3 Docker \u7684\u955c\u50cf\u7ba1\u7406\u65b9\u6cd5\u53ef\u4ee5\u7b97\u662f\u638c\u63e1 Docker \u7684\u7b2c\u4e00\u6b65\u3002\n\n## \u955c\u50cf\u4ed3\u5e93\n\n\u5728\u4e4b\u524d\u7684\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u5df2\u7ecf\u63d0\u5230\u8fc7 Docker \u91cc\u96c6\u4e2d\u5b58\u653e\u955c\u50cf\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u4e5f\u5c31\u662f**\u955c\u50cf\u4ed3\u5e93**\u3002\n\n\u5982\u679c\u8bf4\u6211\u4eec\u628a\u955c\u50cf\u7684\u7ed3\u6784\u7528 Git \u9879\u76ee\u7684\u7ed3\u6784\u505a\u7c7b\u6bd4\uff0c\u90a3\u4e48\u955c\u50cf\u4ed3\u5e93\u5c31\u53ef\u4ee5\u770b\u4f3c GitLab\u3001GitHub \u7b49\u7684\u6258\u7ba1\u5e73\u53f0\uff0c\u53ea\u4e0d\u8fc7 Docker \u7684\u955c\u50cf\u4ed3\u5e93\u6258\u7ba1\u7684\u4e0d\u662f\u4ee3\u7801\u9879\u76ee\uff0c\u800c\u662f\u955c\u50cf\u3002\n\n\u5f53\u7136\uff0c\u5b58\u50a8\u955c\u50cf\u5e76\u4e0d\u662f\u955c\u50cf\u4ed3\u5e93\u6700\u503c\u5f97\u70ab\u8000\u7684\u529f\u80fd\uff0c\u5176\u6700\u5927\u7684\u4f5c\u7528\u662f\u5b9e\u73b0\u4e86 Docker \u955c\u50cf\u7684\u5206\u53d1\u3002\u501f\u52a9\u955c\u50cf\u4ed3\u5e93\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u955c\u50cf\u7684\u4e2d\u8f6c\u7ad9\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5f00\u53d1\u73af\u5883\u4e0a\u6240\u4f7f\u7528\u7684\u955c\u50cf\u63a8\u9001\u81f3\u955c\u50cf\u4ed3\u5e93\uff0c\u5e76\u5728\u6d4b\u8bd5\u6216\u751f\u4ea7\u73af\u5883\u4e0a\u62c9\u53d6\u5230\u5b83\u4eec\uff0c\u800c\u8fd9\u4e2a\u8fc7\u7a0b\u4ec5\u9700\u8981\u51e0\u4e2a\u547d\u4ee4\uff0c\u751a\u81f3\u81ea\u52a8\u5316\u5b8c\u6210\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/18/165eacb6b1b2c1ac?w=1771&h=735&f=png&s=67549)\n\n### \u83b7\u53d6\u955c\u50cf\n\n\u867d\u7136\u6709\u5f88\u591a\u79cd\u65b9\u5f0f\u5c06\u955c\u50cf\u5f15\u5165\u5230 Docker \u4e4b\u4e2d\uff0c\u4f46\u6211\u4eec\u6700\u4e3a\u5e38\u7528\u7684\u83b7\u53d6\u73b0\u6709\u955c\u50cf\u7684\u65b9\u5f0f\u8fd8\u662f\u76f4\u63a5\u4ece\u955c\u50cf\u4ed3\u5e93\u4e2d\u62c9\u53d6\uff0c\u56e0\u4e3a\u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\u3001\u5feb\u901f\u3001\u6709\u4fdd\u969c\u3002\n\n\u8981\u62c9\u53d6\u955c\u50cf\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `docker pull` \u547d\u4ee4\uff0c\u547d\u4ee4\u7684\u53c2\u6570\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u6240\u63d0\u5230\u7684\u955c\u50cf\u4ed3\u5e93\u540d\u3002\n\n```\n$ sudo docker pull ubuntu\nUsing default tag: latest\nlatest: Pulling from library/ubuntu\n124c757242f8: Downloading [===============================================>   ]  30.19MB/31.76MB\n9d866f8bde2a: Download complete \nfa3f2f277e67: Download complete \n398d32b153e8: Download complete \nafde35469481: Download complete \n\n```\n\n\u5f53\u6211\u4eec\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0cDocker \u5c31\u4f1a\u5f00\u59cb\u4ece\u955c\u50cf\u4ed3\u5e93\u4e2d\u62c9\u53d6\u6211\u4eec\u6240\u6307\u5b9a\u7684\u955c\u50cf\u4e86\uff0c\u5728\u63a7\u5236\u53f0\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u955c\u50cf\u62c9\u53d6\u7684\u8fdb\u5ea6\u3002\u4e0b\u8f7d\u8fdb\u5ea6\u4f1a\u5206\u4e3a\u51e0\u884c\uff0c\u5176\u5b9e\u6bcf\u4e00\u884c\u4ee3\u8868\u7684\u5c31\u662f\u4e00\u4e2a\u955c\u50cf\u5c42\u3002Docker \u9996\u5148\u4f1a\u62c9\u53d6\u955c\u50cf\u6240\u57fa\u4e8e\u7684\u6240\u6709\u955c\u50cf\u5c42\uff0c\u4e4b\u540e\u518d\u5355\u72ec\u62c9\u53d6\u6bcf\u4e00\u4e2a\u955c\u50cf\u5c42\u5e76\u7ec4\u5408\u6210\u8fd9\u4e2a\u955c\u50cf\u3002\u5f53\u7136\uff0c\u5982\u679c\u5728\u672c\u5730\u5df2\u7ecf\u5b58\u5728\u76f8\u540c\u7684\u955c\u50cf\u5c42 ( \u5171\u4eab\u4e8e\u5176\u4ed6\u7684\u955c\u50cf )\uff0c\u90a3\u4e48 Docker \u5c31\u76f4\u63a5\u7565\u8fc7\u8fd9\u4e2a\u955c\u50cf\u5c42\u7684\u62c9\u53d6\u800c\u76f4\u63a5\u91c7\u7528\u672c\u5730\u7684\u5185\u5bb9\u3002\n\n\u4e0a\u9762\u662f\u4e00\u4e2a\u62c9\u53d6\u5b98\u65b9\u955c\u50cf\u5e76\u4e14\u6ca1\u6709\u7ed9\u51fa\u955c\u50cf\u6807\u7b7e\u7684\u4f8b\u5b50\uff0c\u5927\u5bb6\u6ce8\u610f\u5230\uff0c\u5f53\u6211\u4eec\u6ca1\u6709\u63d0\u4f9b\u955c\u50cf\u6807\u7b7e\u65f6\uff0cDocker \u4f1a\u9ed8\u8ba4\u4f7f\u7528 latest \u8fd9\u4e2a\u6807\u7b7e\uff0c\u8fd9\u4e2a\u6211\u4eec\u5728\u4e4b\u524d\u7684\u5c0f\u8282\u4e2d\u63d0\u5230\u8fc7\uff0c\u5c31\u4e0d\u5728\u8d58\u8ff0\u4e86\u3002\n\n\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u4f7f\u7528\u5b8c\u6574\u7684\u955c\u50cf\u547d\u540d\u6765\u62c9\u53d6\u955c\u50cf\u3002\n\n```\n$ sudo docker pull openresty/openresty:1.13.6.2-alpine\n1.13.6.2-alpine: Pulling from openresty/openresty\nff3a5c916c92: Pull complete \nede0a2a1012b: Pull complete \n0e0a11843023: Pull complete \n246b2c6f4992: Pull complete \nDigest: sha256:23ff32a1e7d5a10824ab44b24a0daf86c2df1426defe8b162d8376079a548bf2\nStatus: Downloaded newer image for openresty/openresty:1.13.6.2-alpine\n\n```\n\n\u955c\u50cf\u5728\u88ab\u62c9\u53d6\u4e4b\u540e\uff0c\u5c31\u5b58\u653e\u5230\u4e86\u672c\u5730\uff0c\u63a5\u53d7\u5f53\u524d\u8fd9\u4e2a Docker \u5b9e\u4f8b\u7ba1\u7406\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `docker images` \u547d\u4ee4\u770b\u5230\u5b83\u4eec\u3002\n\n```\n$ sudo docker images\nREPOSITORY            TAG                 IMAGE ID            CREATED             SIZE\nubuntu                latest              cd6d8154f1e1        12 days ago         84.1MB\nopenresty/openresty   1.13.6.2-alpine     08d5c926e4b6        3 months ago        49.3MB\n\n```\n\n## Docker Hub\n\n\u65e2\u7136\u8bf4\u5230\u955c\u50cf\u4ed3\u5e93\uff0c\u5c31\u4e0d\u5f97\u4e0d\u63d0 **Docker Hub** \u4e86\u3002Docker Hub \u662f Docker \u5b98\u65b9\u5efa\u7acb\u7684\u4e2d\u592e\u955c\u50cf\u4ed3\u5e93\uff0c\u9664\u4e86\u666e\u901a\u955c\u50cf\u4ed3\u5e93\u7684\u529f\u80fd\u5916\uff0c\u5b83\u5185\u90e8\u8fd8\u6709\u66f4\u52a0\u7ec6\u81f4\u7684\u6743\u9650\u7ba1\u7406\uff0c\u652f\u6301\u6784\u5efa\u94a9\u5b50\u548c\u81ea\u52a8\u6784\u5efa\uff0c\u5e76\u4e14\u6709\u4e00\u5957\u7cbe\u81f4\u7684 Web \u64cd\u4f5c\u9875\u9762\u3002\n\nDocker Hub \u7684\u5730\u5740\u662f\uff1a[https://hub.docker.com/](https://hub.docker.com/)\n\n![](https://user-gold-cdn.xitu.io/2018/9/19/165efa8f3a706682?w=872&h=428&f=png&s=38148)\n\n\u7531\u4e8e\u5b9a\u4f4d\u662f Docker \u7684\u4e2d\u592e\u955c\u50cf\u4ed3\u5e93\u7cfb\u7edf\uff0c\u540c\u65f6\u4e5f\u662f Docker Engine \u7684\u9ed8\u8ba4\u955c\u50cf\u4ed3\u5e93\uff0c\u6240\u4ee5 Docker Hub \u662f\u5f00\u53d1\u8005\u5171\u4eab\u955c\u50cf\u7684\u9996\u9009\uff0c\u90a3\u4e48\u4e5f\u5c31\u610f\u5473\u7740\u5176\u4e2d\u7684\u955c\u50cf\u8db3\u591f\u4e30\u5bcc\u3002\n\n\u5e38\u7528\u670d\u52a1\u8f6f\u4ef6\u7684\u955c\u50cf\uff0c\u6211\u4eec\u90fd\u80fd\u5728 Docker Hub \u4e2d\u627e\u5230\uff0c\u751a\u81f3\u80fd\u627e\u5230\u9488\u5bf9\u5b83\u4eec\u4e0d\u540c\u7528\u6cd5\u7684\u4e0d\u540c\u955c\u50cf\u3002\n\n\u540c\u65f6\uff0cDocker Hub \u4e5f\u5141\u8bb8\u6211\u4eec\u5c06\u6211\u4eec\u5236\u4f5c\u597d\u7684\u955c\u50cf\u4e0a\u4f20\u5230\u5176\u4e2d\uff0c\u4e0e\u5e7f\u5927 Docker \u7528\u6237\u5171\u4eab\u4f60\u7684\u6210\u679c\u3002\n\n### \u641c\u7d22\u955c\u50cf\n\n\u7531\u4e8e Docker Hub \u63d0\u4f9b\u4e86\u4e00\u5957\u5b8c\u6574\u7684 Web \u64cd\u4f5c\u754c\u9762\uff0c\u6240\u4ee5\u6211\u4eec\u641c\u7d22\u5176\u4e2d\u7684\u955c\u50cf\u4f1a\u975e\u5e38\u65b9\u4fbf\u3002\n\n\u5728\u4e0a\u65b9\u7684\u641c\u7d22\u6761\u4e2d\u8f93\u5165\u955c\u50cf\u7684\u5173\u952e\u8bcd\uff0c\u56de\u8f66\u641c\u7d22\u6211\u4eec\u5c31\u53ef\u4ee5\u770b\u5230\u955c\u50cf\u641c\u7d22\u7684\u7ed3\u679c\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/19/165efb39b6076f2e?w=872&h=694&f=png&s=53378)\n\n\u5728 Docker Hub \u7684\u641c\u7d22\u7ed3\u679c\u4e2d\uff0c\u6709\u51e0\u9879\u5173\u952e\u7684\u4fe1\u606f\u6709\u52a9\u4e8e\u6211\u4eec\u9009\u62e9\u5408\u9002\u7684\u955c\u50cf\uff1a\n\n*   **OFFICIAL** \u4ee3\u8868\u955c\u50cf\u4e3a Docker \u5b98\u65b9\u63d0\u4f9b\u548c\u7ef4\u62a4\uff0c\u76f8\u5bf9\u6765\u8bf4\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u8f83\u9ad8\n*   **STARS** \u4ee3\u8868\u955c\u50cf\u7684\u5173\u6ce8\u4eba\u6570\uff0c\u8fd9\u7c7b\u4f3c GitHub \u7684 Stars\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u70ed\u5ea6\n*   **PULLS** \u4ee3\u8868\u955c\u50cf\u88ab\u62c9\u53d6\u7684\u6b21\u6570\uff0c\u57fa\u672c\u4e0a\u80fd\u591f\u8868\u793a\u955c\u50cf\u88ab\u4f7f\u7528\u7684\u9891\u5ea6\n\n\u5f53\u7136\uff0c\u5173\u4e8e\u955c\u50cf\u66f4\u591a\u7684\u4fe1\u606f\u6211\u4eec\u53ef\u4ee5\u5728 **DETAILS** \u4e2d\u770b\u5230\uff0c\u8fd9\u5176\u4e2d\u901a\u5e38\u8fd8\u5305\u62ec\u4e86\u6bcf\u4e2a\u955c\u50cf\u4e0d\u540c\u7684\u4f7f\u7528\u65b9\u6cd5\u3002\u5177\u4f53\u5982\u4f55\u9605\u8bfb\u8fd9\u4e9b\u4f7f\u7528\u8bf4\u660e\uff0c\u6211\u4eec\u4f1a\u5728\u4e4b\u540e\u7684\u5c0f\u8282\u91cc\u4e13\u95e8\u4ecb\u7ecd\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/18/165eb438f307c73b?w=800&h=252&f=jpeg&s=46304)\n\n\u9664\u4e86\u76f4\u63a5\u901a\u8fc7 Docker Hub \u7f51\u7ad9\u641c\u7d22\u955c\u50cf\u8fd9\u79cd\u65b9\u5f0f\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528 docker CLI \u4e2d\u7684 `docker search` \u8fd9\u4e2a\u547d\u4ee4\u641c\u7d22 Docker Hub \u4e2d\u7684\u955c\u50cf\u3002\n\n```\n$ sudo docker search ubuntu\nNAME                                                   DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nubuntu                                                 Ubuntu is a Debian-based Linux operating sys\u2026   8397                [OK]                \ndorowu/ubuntu-desktop-lxde-vnc                         Ubuntu with openssh-server and NoVNC            220                                     [OK]\nrastasheep/ubuntu-sshd                                 Dockerized SSH service, built on top of offi\u2026   171                                     [OK]\nconsol/ubuntu-xfce-vnc                                 Ubuntu container with \"headless\" VNC session\u2026   129                                     [OK]\nansible/ubuntu14.04-ansible                            Ubuntu 14.04 LTS with ansible                   95                                      [OK]\nubuntu-upstart                                         Upstart is an event-based replacement for th\u2026   89                  [OK]                \nneurodebian                                            NeuroDebian provides neuroscience research s\u2026   54                  [OK]                \n## ......\n\n```\n\n\u4f7f\u7528 `docker search` \u547d\u4ee4\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7c7b\u4f3c\u4e8e Docker Hub \u7f51\u9875\u7248\u641c\u7d22\u7684\u955c\u50cf\u5217\u8868\u7ed3\u679c\uff0c\u5176\u4e2d\u7684\u4fe1\u606f\u4e0e\u7f51\u9875\u7248\u4e5f\u662f\u7c7b\u4f3c\u7684\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6211\u4eec\u53ef\u4ee5\u5728\u4e0d\u65b9\u4fbf\u8bbf\u95ee Web \u7684\u73af\u5883\u4e0b\u641c\u7d22\u955c\u50cf\uff0c\u5bf9\u4e8e\u63a7\u5236\u53f0\u7231\u597d\u8005\u6765\u8bf4\u4e5f\u662f\u4e00\u79cd\u4e0d\u9519\u7684\u9009\u62e9\u3002\n\n## \u7ba1\u7406\u955c\u50cf\n\n\u5bf9\u955c\u50cf\u7684\u7ba1\u7406\u8981\u6bd4\u641c\u7d22\u548c\u83b7\u53d6\u955c\u50cf\u66f4\u5e38\u7528\uff0c\u6240\u4ee5\u4e86\u89e3\u955c\u50cf\u7ba1\u7406\u76f8\u5173\u7684\u64cd\u4f5c\u4ee5\u53ca\u77e5\u8bc6\u662f\u975e\u5e38\u6709\u5fc5\u8981\u7684\u3002\n\n\u9664\u4e86\u4e4b\u524d\u6211\u4eec\u6240\u63d0\u5230\u7684 `docker images` \u53ef\u4ee5\u5217\u51fa\u672c\u5730 Docker \u4e2d\u7684\u6240\u6709\u955c\u50cf\u5916\uff0c\u5982\u679c\u6211\u4eec\u8981\u83b7\u5f97\u955c\u50cf\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `docker inspect` \u8fd9\u4e2a\u547d\u4ee4\u3002\n\n```\n$ sudo docker inspect redis:3.2\n[\n    {\n        \"Id\": \"sha256:2fef532eadb328740479f93b4a1b7595d412b9105ca8face42d3245485c39ddc\",\n        \"RepoTags\": [\n            \"redis:3.2\"\n        ],\n        \"RepoDigests\": [\n            \"redis@sha256:745bdd82bad441a666ee4c23adb7a4c8fac4b564a1c7ac4454aa81e91057d977\"\n        ],\n## ......\n    }\n]\n\n```\n\n\u5728 `docker inspect` \u7684\u7ed3\u679c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5173\u4e8e\u955c\u50cf\u76f8\u5f53\u5b8c\u5907\u7684\u4fe1\u606f\uff0c\u7531\u4e8e\u6761\u76ee\u5206\u7c7b\u6bd4\u8f83\u591a\uff0c\u8fd9\u91cc\u6211\u5c31\u4e0d\u4e00\u4e00\u7f57\u5217\u5c55\u5f00\u4e86\u3002\n\n\u9664\u4e86\u80fd\u591f\u67e5\u770b\u955c\u50cf\u7684\u4fe1\u606f\u5916\uff0c`docker inspect` \u8fd8\u80fd\u67e5\u770b\u5bb9\u5668\u7b49\u4e4b\u524d\u6211\u4eec\u6240\u63d0\u5230\u7684 Docker \u5bf9\u8c61\u7684\u4fe1\u606f\uff0c\u800c\u4f20\u53c2\u7684\u65b9\u5f0f\u9664\u4e86\u4f20\u9012\u955c\u50cf\u6216\u5bb9\u5668\u7684\u540d\u79f0\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f20\u5165\u955c\u50cf ID \u6216\u5bb9\u5668 ID\u3002\n\n```\n$ sudo docker inspect redis:4.0\n$ sudo docker inspect 2fef532e\n\n```\n\n### \u53c2\u6570\u8bc6\u522b\n\n\u7ec6\u5fc3\u7684\u8bfb\u8005\u5728\u8fd9\u91cc\u4e00\u5b9a\u53d1\u73b0\u4e86\u4e00\u4e2a\u7ec6\u8282\uff0c\u4e4b\u524d\u6211\u4eec\u6240\u8c08\u5230\u955c\u50cf ID \u662f 64 \u4e2a\u5b57\u7b26\uff0c\u800c `docker images` \u547d\u4ee4\u91cc\u7684\u7f29\u5199\u4e5f\u6709 12 \u4e2a\u5b57\u7b26\uff0c\u4e3a\u4ec0\u4e48\u6211\u8fd9\u91cc\u5c55\u793a\u7684\u64cd\u4f5c\u547d\u4ee4\u91cc\u53ea\u586b\u5199\u4e86 8 \u4e2a\u5b57\u7b26\u5462\uff1f\n\n\u8fd9\u5c31\u6709\u5fc5\u8981\u4e13\u95e8\u8bf4\u8bf4 Docker \u6240\u652f\u6301\u7684\u8fd9\u79cd\u4f20\u53c2\u65b9\u5f0f\u4e86\u3002\n\n\u4e0d\u8bba\u6211\u4eec\u662f\u901a\u8fc7\u955c\u50cf\u540d\u8fd8\u662f\u955c\u50cf ID \u4f20\u9012\u5230 `docker inspect` \u6216\u8005\u5176\u4ed6\u7c7b\u4f3c\u7684\u547d\u4ee4 ( \u9700\u8981\u6307\u5b9a Docker \u5bf9\u8c61\u7684\u547d\u4ee4 ) \u91cc\uff0cDocker \u90fd\u4f1a\u6839\u636e\u6211\u4eec\u4f20\u5165\u7684\u5185\u5bb9\u53bb\u5bfb\u627e\u4e0e\u4e4b\u5339\u914d\u7684\u5185\u5bb9\uff0c\u53ea\u8981\u6211\u4eec\u6240\u7ed9\u51fa\u7684\u5185\u5bb9\u80fd\u591f\u627e\u51fa\u552f\u4e00\u7684\u955c\u50cf\uff0c\u90a3\u4e48 Docker \u5c31\u4f1a\u5bf9\u8fd9\u4e2a\u955c\u50cf\u6267\u884c\u7ed9\u5b9a\u7684\u64cd\u4f5c\u3002\u53cd\u4e4b\uff0c\u5982\u679c\u627e\u4e0d\u5230\u552f\u4e00\u7684\u955c\u50cf\uff0c\u90a3\u4e48\u64cd\u4f5c\u4e0d\u4f1a\u8fdb\u884c\uff0cDocker \u4e5f\u4f1a\u663e\u793a\u9519\u8bef\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u8981\u6211\u4eec\u63d0\u4f9b\u4e86\u80fd\u591f\u552f\u4e00\u8bc6\u522b\u955c\u50cf\u6216\u5bb9\u5668\u7684\u4fe1\u606f\uff0c\u5373\u4f7f\u5b83\u77ed\u5230\u53ea\u6709 1 \u4e2a\u5b57\u7b26\uff0cDocker \u90fd\u662f\u53ef\u4ee5\u5904\u7406\u7684\u3002\n\n\u4f8b\u5982\u6211\u4eec\u6709\u4e94\u4e2a\u955c\u50cf\uff1a\n\n```\nREPOSITORY            TAG                 IMAGE ID            CREATED             SIZE\nphp                   7-fpm               f214b5c48a25        11 days ago         368MB\nubuntu                latest              cd6d8154f1e1        13 days ago         84.1MB\nredis                 3.2                 2fef532eadb3        13 days ago         76MB\nredis                 4.0                 e1a73233e3be        13 days ago         83.4MB\nopenresty/openresty   1.13.6.2-alpine     08d5c926e4b6        3 months ago        49.3MB\ncogset/cron           latest              c01d5ac6fc8a        16 months ago       125MB\n\n```\n\n\u6211\u4eec\u6ce8\u610f\u5230\u955c\u50cf ID \u524d\u7f00\u4e3a 2 \u7684\u53ea\u6709 redis:3.2 \u8fd9\u4e2a\u955c\u50cf\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 2 \u6765\u6307\u4ee3\u8fd9\u4e2a\u955c\u50cf\u3002\n\n```\n$ sudo docker inspect 2\n\n```\n\n\u800c\u524d\u7f00\u4e3a c \u7684\u955c\u50cf\u6709\u4e24\u4e2a\uff0c\u8fd9\u65f6\u5019\u5982\u679c\u6211\u4eec\u76f4\u63a5\u4f7f\u7528 c \u6765\u6307\u4ee3\u955c\u50cf\u7684\u8bdd\uff0cDocker \u4f1a\u63d0\u793a\u672a\u80fd\u5339\u914d\u5230\u955c\u50cf\u3002\n\n```\n$ sudo docker inspect c\n[]\nError: No such object: c\n\n```\n\n### \u5220\u9664\u955c\u50cf\n\n\u867d\u7136 Docker \u955c\u50cf\u5360\u7528\u7684\u7a7a\u95f4\u6bd4\u8f83\u5c0f\uff0c\u4f46\u65e5\u6e10\u5197\u6742\u7684\u955c\u50cf\u548c\u51cc\u4e71\u7684\u955c\u50cf\u7248\u672c\u4f1a\u8ba9\u7ba1\u7406\u8d8a\u6765\u8d8a\u56f0\u96be\uff0c\u6240\u4ee5\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u6e05\u7406\u4e00\u4e9b\u65e0\u7528\u7684\u955c\u50cf\uff0c\u5c06\u5b83\u4eec\u4ece\u672c\u5730\u7684 Docker Engine \u4e2d\u79fb\u9664\u3002\n\n\u5220\u9664\u955c\u50cf\u7684\u547d\u4ee4\u662f `docker rmi`\uff0c\u53c2\u6570\u662f\u955c\u50cf\u7684\u540d\u79f0\u6216 ID\u3002\n\n```\n$ sudo docker rmi ubuntu:latest\nUntagged: ubuntu:latest\nUntagged: ubuntu@sha256:de774a3145f7ca4f0bd144c7d4ffb2931e06634f11529653b23eba85aef8e378\nDeleted: sha256:cd6d8154f1e16e38493c3c2798977c5e142be5e5d41403ca89883840c6d51762\nDeleted: sha256:2416e906f135eea2d08b4a8a8ae539328482eacb6cf39100f7c8f99e98a78d84\nDeleted: sha256:7f8291c73f3ecc4dc9317076ad01a567dd44510e789242368cd061c709e0e36d\nDeleted: sha256:4b3d88bd6e729deea28b2390d1ddfdbfa3db603160a1129f06f85f26e7bcf4a2\nDeleted: sha256:f51700a4e396a235cee37249ffc260cdbeb33268225eb8f7345970f5ae309312\nDeleted: sha256:a30b835850bfd4c7e9495edf7085cedfad918219227c7157ff71e8afe2661f63\n\n```\n\n\u5220\u9664\u955c\u50cf\u7684\u8fc7\u7a0b\u5176\u5b9e\u662f\u5220\u9664\u955c\u50cf\u5185\u7684\u955c\u50cf\u5c42\uff0c\u5728\u5220\u9664\u955c\u50cf\u547d\u4ee4\u6253\u5370\u7684\u7ed3\u679c\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u88ab\u5220\u9664\u7684\u955c\u50cf\u5c42\u4ee5\u53ca\u5b83\u4eec\u7684 ID\u3002\u5f53\u7136\uff0c\u5982\u679c\u5b58\u5728\u4e24\u4e2a\u955c\u50cf\u5171\u7528\u4e00\u4e2a\u955c\u50cf\u5c42\u7684\u60c5\u51b5\uff0c\u4f60\u4e5f\u4e0d\u9700\u8981\u62c5\u5fc3 Docker \u4f1a\u5220\u9664\u88ab\u5171\u4eab\u7684\u90a3\u90e8\u5206\u955c\u50cf\u5c42\uff0c\u53ea\u6709\u5f53\u955c\u50cf\u5c42\u53ea\u88ab\u5f53\u524d\u88ab\u5220\u9664\u7684\u955c\u50cf\u6240\u5f15\u7528\u65f6\uff0cDocker \u624d\u4f1a\u5c06\u5b83\u4eec\u4ece\u786c\u76d8\u7a7a\u95f4\u4e2d\u79fb\u9664\u3002\n\n`docker rmi` \u547d\u4ee4\u4e5f\u652f\u6301\u540c\u65f6\u5220\u9664\u591a\u4e2a\u955c\u50cf\uff0c\u53ea\u9700\u8981\u901a\u8fc7\u7a7a\u683c\u4f20\u9012\u591a\u4e2a\u955c\u50cf ID \u6216\u955c\u50cf\u540d\u5373\u53ef\u3002\n\n```\n$ sudo docker rmi redis:3.2 redis:4.0\nUntagged: redis:3.2\nUntagged: redis@sha256:745bdd82bad441a666ee4c23adb7a4c8fac4b564a1c7ac4454aa81e91057d977\nDeleted: sha256:2fef532eadb328740479f93b4a1b7595d412b9105ca8face42d3245485c39ddc\n## ......\nUntagged: redis:4.0\nUntagged: redis@sha256:b77926b30ca2f126431e4c2055efcf2891ebd4b4c4a86a53cf85ec3d4c98a4c9\nDeleted: sha256:e1a73233e3beffea70442fc2cfae2c2bab0f657c3eebb3bdec1e84b6cc778b75\n## ......\n\n```\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5bf9\u955c\u50cf\u7684\u83b7\u53d6\u548c\u5176\u4ed6\u4e00\u4e9b\u5173\u4e8e\u955c\u50cf\u7684\u57fa\u672c\u64cd\u4f5c\u8fdb\u884c\u4e86\u4f7f\u7528\u5c55\u793a\uff0c\u4ecb\u7ecd\u4e86 Docker \u7684\u5b98\u65b9\u955c\u50cf\u4ed3\u5e93 Docker Hub\uff0c\u7b80\u5355\u6982\u8ff0\u4e86\u955c\u50cf\u4e0e\u955c\u50cf\u4ed3\u5e93\u7684\u5173\u7cfb\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> Docker \u4e2d\u955c\u50cf\u4ed3\u5e93\u8fd9\u9879\u529f\u80fd\u8bbe\u8ba1\uff0c\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\u80fd\u591f\u4e3a\u6211\u4eec\u5e26\u6765\u54ea\u4e9b\u5177\u4f53\u7684\u4fbf\u5229\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u955c\u50cf\u7684\u64cd\u4f5c\u4e0e\u4f7f\u7528\u8fd8\u6709\u4ec0\u4e48\u4e0d\u7406\u89e3\u7684\u5730\u65b9\uff0c\u6216\u8005\u5bf9\u5176\u6709\u72ec\u7279\u7684\u89c1\u89e3\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u4f7f\u7528\u5bb9\u5668\u4ece\u955c\u50cf\u4ed3\u5e93\u83b7\u5f97\u955c\u50cf.md", "create_date": "2020-02-18T21:18:39.141", "order": 7}}, {"model": "subject.chapter", "pk": 70, "fields": {"title": "\u4f7f\u7528\u5bb9\u5668\uff1a\u955c\u50cf\u4e0e\u5bb9\u5668", "topic": 3, "md5": "a1d2a94c3220c8f9198d1f83a26ad188", "md_body": "# \u955c\u50cf\u4e0e\u5bb9\u5668\n\n\u955c\u50cf\u548c\u5bb9\u5668\u4f5c\u4e3a Docker \u91cc\u6700\u57fa\u7840\u7684\u6982\u5ff5\uff0c\u6211\u4eec\u5f88\u6709\u5fc5\u8981\u4e86\u89e3 Docker \u5bf9\u5b83\u4eec\u7684\u5f88\u591a\u5b9a\u4e49\u4ee5\u53ca\u5176\u4ed6\u4e0e\u5b83\u4eec\u6709\u5173\u7684\u77e5\u8bc6\u3002\u5728\u8fd9\u4e00\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u5c31\u4e13\u95e8\u9488\u5bf9\u955c\u50cf\u4e0e\u5bb9\u5668\u4e24\u4e2a\u6982\u5ff5\u5c55\u5f00\uff0c\u7ec6\u81f4\u7684\u68b3\u7406\u4e0e\u8fd9\u4e24\u8005\u6709\u5173\u7684\u6982\u5ff5\u548c\u5b9a\u4e49\u3002\n\n## Docker \u955c\u50cf\n\n\u5982\u679c\u8fdb\u884c\u5f62\u8c61\u7684\u8868\u8ff0\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 Docker \u955c\u50cf\u7406\u89e3\u4e3a\u5305\u542b\u5e94\u7528\u7a0b\u5e8f\u4ee5\u53ca\u5176\u76f8\u5173\u4f9d\u8d56\u7684\u4e00\u4e2a\u57fa\u7840\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728 Docker \u5bb9\u5668\u542f\u52a8\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u88ab\u7528\u4e8e\u521b\u5efa\u5bb9\u5668\u7684\u8fd0\u884c\u73af\u5883\u3002\n\n\u4ece\u53e6\u4e00\u4e2a\u89d2\u5ea6\u770b\uff0c\u5728\u4e4b\u524d\u7684\u5c0f\u8282\u91cc\u6211\u4eec\u8bb2\u5230\u4e86\uff0cDocker \u955c\u50cf\u5176\u5b9e\u662f\u7531\u57fa\u4e8e UnionFS \u6587\u4ef6\u7cfb\u7edf\u7684\u4e00\u7ec4\u955c\u50cf\u5c42\u4f9d\u6b21\u6302\u8f7d\u800c\u5f97\uff0c\u800c\u6bcf\u4e2a\u955c\u50cf\u5c42\u5305\u542b\u7684\u5176\u5b9e\u662f\u5bf9\u4e0a\u4e00\u955c\u50cf\u5c42\u7684\u4fee\u6539\uff0c\u8fd9\u4e9b\u4fee\u6539\u5176\u5b9e\u662f\u53d1\u751f\u5728\u5bb9\u5668\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\u7684\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u53cd\u8fc7\u6765\u7406\u89e3\uff0c\u955c\u50cf\u662f\u5bf9\u5bb9\u5668\u8fd0\u884c\u73af\u5883\u8fdb\u884c\u6301\u4e45\u5316\u5b58\u50a8\u7684\u7ed3\u679c\u3002\n\n### \u6df1\u5165\u955c\u50cf\u5b9e\u73b0\n\n\u4e0e\u5176\u4ed6\u865a\u62df\u673a\u7684\u955c\u50cf\u7ba1\u7406\u4e0d\u540c\uff0cDocker \u5c06\u955c\u50cf\u7ba1\u7406\u7eb3\u5165\u5230\u4e86\u81ea\u8eab\u8bbe\u8ba1\u4e4b\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6240\u6709\u7684 Docker \u955c\u50cf\u90fd\u662f\u6309\u7167 Docker \u6240\u8bbe\u5b9a\u7684\u903b\u8f91\u6253\u5305\u7684\uff0c\u4e5f\u662f\u53d7\u5230 Docker Engine \u6240\u63a7\u5236\u7684\u3002\n\n\u8fd9\u4e48\u8bf4\u8d77\u6765\u4e5f\u8bb8\u8fd8\u4e0d\u591f\u5177\u4f53\uff0c\u8ba9\u6211\u4eec\u6765\u505a\u4e00\u4e2a\u6bd4\u8f83\u3002\u6211\u4eec\u5e38\u89c1\u7684\u865a\u62df\u673a\u955c\u50cf\uff0c\u901a\u5e38\u662f\u7531\u70ed\u5fc3\u7684\u63d0\u4f9b\u8005\u4ee5\u4ed6\u4eec\u81ea\u5df1\u719f\u6089\u7684\u65b9\u5f0f\u6253\u5305\u6210\u955c\u50cf\u6587\u4ef6\uff0c\u88ab\u6211\u4eec\u4ece\u7f51\u4e0a\u4e0b\u8f7d\u6216\u662f\u5176\u4ed6\u65b9\u5f0f\u83b7\u5f97\u540e\uff0c\u6062\u590d\u5230\u865a\u62df\u673a\u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u91cc\u7684\u3002\u800c Docker \u7684\u955c\u50cf\u6211\u4eec\u5fc5\u987b\u901a\u8fc7 Docker \u6765\u6253\u5305\uff0c\u4e5f\u5fc5\u987b\u901a\u8fc7 Docker \u4e0b\u8f7d\u6216\u5bfc\u5165\u540e\u4f7f\u7528\uff0c\u4e0d\u80fd\u5355\u72ec\u76f4\u63a5\u6062\u590d\u6210\u5bb9\u5668\u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u3002\n\n\u867d\u7136\u8fd9\u4e48\u505a\u5931\u53bb\u4e86\u5f88\u591a\u7075\u6d3b\u6027\uff0c\u4f46\u56fa\u5b9a\u7684\u683c\u5f0f\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u95f4\u4f20\u9012 Docker \u955c\u50cf\uff0c\u914d\u5408 Docker \u81ea\u8eab\u5bf9\u955c\u50cf\u7684\u7ba1\u7406\u529f\u80fd\uff0c\u8ba9\u6211\u4eec\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e2d\u4f20\u9012\u548c\u5171\u4eab Docker \u53d8\u5f97\u975e\u5e38\u65b9\u4fbf\u3002\u8fd9\u4e5f\u662f Docker \u80fd\u591f\u63d0\u5347\u6211\u4eec\u5de5\u4f5c\u6548\u7387\u7684\u4e00\u5904\u4f53\u73b0\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8bb0\u5f55\u6587\u4ef6\u7cfb\u7edf\u4fee\u6539\u7684\u955c\u50cf\u5c42\u6765\u8bf4\uff0cDocker \u90fd\u4f1a\u6839\u636e\u5b83\u4eec\u7684\u4fe1\u606f\u751f\u6210\u4e86\u4e00\u4e2a Hash \u7801\uff0c\u8fd9\u662f\u4e00\u4e2a 64 \u957f\u5ea6\u7684\u5b57\u7b26\u4e32\uff0c\u8db3\u4ee5\u4fdd\u8bc1\u5168\u7403\u552f\u4e00\u6027\u3002\u8fd9\u79cd\u7f16\u7801\u7684\u5f62\u5f0f\u5728 Docker \u5f88\u591a\u5730\u65b9\u90fd\u6709\u4f53\u73b0\uff0c\u4e4b\u540e\u6211\u4eec\u4f1a\u7ecf\u5e38\u89c1\u5230\u3002\n\n\u7531\u4e8e\u955c\u50cf\u5c42\u90fd\u6709\u552f\u4e00\u7684\u7f16\u7801\uff0c\u6211\u4eec\u5c31\u80fd\u591f\u533a\u5206\u4e0d\u540c\u7684\u955c\u50cf\u5c42\u5e76\u80fd\u4fdd\u8bc1\u5b83\u4eec\u7684\u5185\u5bb9\u4e0e\u7f16\u7801\u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u5e26\u6765\u4e86\u53e6\u4e00\u9879\u597d\u5904\uff0c\u5c31\u662f\u5141\u8bb8\u6211\u4eec\u5728\u955c\u50cf\u4e4b\u95f4\u5171\u4eab\u955c\u50cf\u5c42\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/13/165d0692fe7a478b?w=1434&h=554&f=png&s=65696)\n\n\u4e3e\u4e00\u4e2a\u5b9e\u9645\u7684\u4f8b\u5b50\uff0c\u7531 Docker \u5b98\u65b9\u63d0\u4f9b\u7684\u4e24\u4e2a\u955c\u50cf elasticsearch \u955c\u50cf\u548c jenkins \u955c\u50cf\u90fd\u662f\u5728 openjdk \u955c\u50cf\u4e4b\u4e0a\u4fee\u6539\u800c\u5f97\uff0c\u90a3\u4e48\u5728\u6211\u4eec\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u8fd9\u4e24\u4e2a\u955c\u50cf\u662f\u53ef\u4ee5\u5171\u7528 openjdk \u955c\u50cf\u5185\u90e8\u7684\u955c\u50cf\u5c42\u7684\u3002\n\n\u8fd9\u5e26\u6765\u7684\u4e00\u9879\u597d\u5904\u5c31\u662f\u8ba9\u955c\u50cf\u53ef\u4ee5\u5171\u7528\u4e00\u4e9b\u5b58\u50a8\u7a7a\u95f4\uff0c\u8fbe\u5230 1 + 1 < 2 \u7684\u6548\u679c\uff0c\u4e3a\u6211\u4eec\u5728\u540c\u4e00\u53f0\u673a\u5668\u91cc\u5b58\u653e\u4f17\u591a\u955c\u50cf\u63d0\u4f9b\u4e86\u53ef\u80fd\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u4e2a\u4f18\u52bf\u662f\u66f4\u4e3a\u660e\u663e\u7684\u3002\u4e00\u4e2a\u865a\u62df\u673a\u955c\u50cf\u7684\u5360\u7528\u7a7a\u95f4\u5f80\u5f80\u7528 GB \u6765\u8861\u91cf\uff0c\u5728\u540c\u4e00\u53f0\u7269\u7406\u673a\u4e0a\u5b58\u653e\u51e0\u4e2a\u5c31\u5df2\u7ecf\u662f\u4e86\u4e0d\u8d77\u7684\u4e8b\u60c5\u4e86\u3002\u800c Docker \u7ba1\u7406\u4e4b\u4e0b\u7684\u955c\u50cf\uff0c\u5360\u7528\u7a7a\u95f4\u662f\u4ee5 MB \u4e3a\u5355\u4f4d\u8fdb\u884c\u8861\u91cf\u7684\uff0c\u52a0\u4e4b\u955c\u50cf\u4e4b\u95f4\u8fd8\u80fd\u591f\u5171\u4eab\u90e8\u5206\u7684\u955c\u50cf\u5c42\uff0c\u4e5f\u5c31\u662f\u5171\u4eab\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u5e38\u89c1\u7684\u786c\u76d8\u91cc\u653e\u4e0b\u51e0\u5341\u3001\u6570\u767e\u4e2a\u955c\u50cf\u4e5f\u4e0d\u662f\u4ec0\u4e48\u96be\u4e8b\u3002\n\n\u5728\u4e4b\u540e\u7684\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u4f1a\u8bb2\u5230\u5982\u4f55\u5bfc\u51fa\u955c\u50cf\uff0c\u5728\u5bfc\u51fa\u955c\u50cf\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u6e05\u6670\u7684\u770b\u5230\u955c\u50cf\u5c42\u7684\u4f53\u73b0\uff0c\u8fd9\u4e2a\u7559\u81f3\u540e\u9762\u6211\u4eec\u6765\u8bb2\u89e3\u3002\n\n### \u67e5\u770b\u955c\u50cf\n\n\u955c\u50cf\u662f\u7531 Docker \u8fdb\u884c\u7ba1\u7406\u7684\uff0c\u6240\u4ee5\u5b83\u4eec\u7684\u5b58\u50a8\u4f4d\u7f6e\u548c\u5b58\u50a8\u65b9\u5f0f\u7b49\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u8fc7\u591a\u7684\u5173\u5fc3\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5229\u7528 Docker \u6240\u63d0\u4f9b\u7684\u4e00\u4e9b\u63a5\u53e3\u6216\u547d\u4ee4\u5bf9\u5b83\u4eec\u8fdb\u884c\u63a7\u5236\u5373\u53ef\u3002\n\n\u5982\u679c\u8981\u67e5\u770b\u5f53\u524d\u8fde\u63a5\u7684 docker daemon \u4e2d\u5b58\u653e\u548c\u7ba1\u7406\u4e86\u54ea\u4e9b\u955c\u50cf\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `docker images` \u8fd9\u4e2a\u547d\u4ee4 ( Linux\u3001macOS \u8fd8\u662f Windows \u4e0a\u90fd\u662f\u4e00\u81f4\u7684 )\u3002\n\n```\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nphp                 7-fpm               f214b5c48a25        9 days ago          368MB\nredis               3.2                 2fef532eadb3        11 days ago         76MB\nredis               4.0                 e1a73233e3be        11 days ago         83.4MB\ncogset/cron         latest              c01d5ac6fc8a        15 months ago       125MB\n\n```\n\n\u5728 `docker images` \u547d\u4ee4\u7684\u7ed3\u679c\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230**\u955c\u50cf\u7684 ID ( IMAGE ID)**\u3001**\u6784\u5efa\u65f6\u95f4 ( CREATED )**\u3001**\u5360\u7528\u7a7a\u95f4 ( SIZE )** \u7b49\u6570\u636e\u3002\n\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u6211\u4eec\u53d1\u73b0\u5728\u7ed3\u679c\u4e2d\u955c\u50cf ID \u7684\u957f\u5ea6\u53ea\u6709 12 \u4e2a\u5b57\u7b26\uff0c\u8fd9\u548c\u6211\u4eec\u4e4b\u524d\u8bf4\u7684 64 \u4e2a\u5b57\u7b26\u8c8c\u4f3c\u4e0d\u4e00\u81f4\u3002\u5176\u5b9e\u4e3a\u4e86\u907f\u514d\u5c4f\u5e55\u7684\u7a7a\u95f4\u90fd\u88ab\u8fd9\u4e9b\u770b\u4f3c\u201c\u4e71\u7801\u201d\u7684\u955c\u50cf ID \u6240\u6324\u5360\uff0c\u6240\u4ee5 Docker \u53ea\u663e\u793a\u4e86\u955c\u50cf ID \u7684\u524d 12 \u4e2a\u5b57\u7b26\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u5b83\u4eec\u5df2\u7ecf\u80fd\u591f\u8ba9\u6211\u4eec\u5728\u5355\u4e00\u4e3b\u673a\u4e2d\u8bc6\u522b\u51fa\u4e0d\u540c\u7684\u955c\u50cf\u4e86\u3002\n\n### \u955c\u50cf\u547d\u540d\n\n\u955c\u50cf\u5c42\u7684 ID \u65e2\u53ef\u4ee5\u8bc6\u522b\u6bcf\u4e2a\u955c\u50cf\u5c42\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u76f4\u63a5\u8bc6\u522b\u955c\u50cf ( \u56e0\u4e3a\u6839\u636e\u6700\u4e0a\u5c42\u955c\u50cf\u80fd\u591f\u627e\u51fa\u6240\u6709\u4f9d\u8d56\u7684\u4e0b\u5c42\u955c\u50cf\uff0c\u6240\u4ee5\u6700\u4e0a\u5c42\u8fdb\u884c\u7684\u955c\u50cf\u5c42 ID \u5c31\u80fd\u8868\u793a\u955c\u50cf\u7684 ID )\uff0c\u4f46\u662f\u4f7f\u7528\u8fd9\u79cd\u65e0\u610f\u4e49\u7684\u8d85\u957f\u54c8\u5e0c\u7801\u663e\u7136\u662f\u8fdd\u80cc\u4eba\u6027\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u8fd8\u8981\u4ecb\u7ecd\u955c\u50cf\u7684\u547d\u540d\uff0c\u901a\u8fc7\u955c\u50cf\u540d\u6211\u4eec\u80fd\u591f\u66f4\u5bb9\u6613\u7684\u8bc6\u522b\u955c\u50cf\u3002\n\n\u5728 `docker images` \u547d\u4ee4\u6253\u5370\u51fa\u7684\u5185\u5bb9\u4e2d\uff0c\u6211\u4eec\u8fd8\u80fd\u770b\u5230\u4e24\u4e2a\u4e0e\u955c\u50cf\u547d\u540d\u6709\u5173\u7684\u6570\u636e\uff1a**REPOSITORY** \u548c **TAG**\uff0c\u8fd9\u4e24\u8005\u5176\u5b9e\u5c31\u7ec4\u6210\u4e86 docker \u5bf9\u955c\u50cf\u7684\u547d\u540d\u89c4\u5219\u3002\n\n\u6765\u770b\u8fd9\u4e2a\u4f8b\u5b50\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/9/12/165cc15252cc5e51?w=1151&h=418&f=png&s=25855)\n\n\u51c6\u786e\u7684\u6765\u8bf4\uff0c\u955c\u50cf\u7684\u547d\u540d\u6211\u4eec\u53ef\u4ee5\u5206\u6210\u4e09\u4e2a\u90e8\u5206\uff1a**username**\u3001**repository** \u548c **tag**\u3002\n\n*   **username**\uff1a \u4e3b\u8981\u7528\u4e8e\u8bc6\u522b\u4e0a\u4f20\u955c\u50cf\u7684\u4e0d\u540c\u7528\u6237\uff0c\u4e0e GitHub \u4e2d\u7684\u7528\u6237\u7a7a\u95f4\u7c7b\u4f3c\u3002\n*   **repository**\uff1a\u4e3b\u8981\u7528\u4e8e\u8bc6\u522b\u8fdb\u884c\u7684\u5185\u5bb9\uff0c\u5f62\u6210\u5bf9\u955c\u50cf\u7684\u8868\u610f\u63cf\u8ff0\u3002\n*   **tag**\uff1a\u4e3b\u8981\u7528\u6237\u8868\u793a\u955c\u50cf\u7684\u7248\u672c\uff0c\u65b9\u4fbf\u533a\u5206\u8fdb\u884c\u5185\u5bb9\u7684\u4e0d\u540c\u7ec6\u8282\n\n\u5bf9\u4e8e username \u6765\u8bf4\uff0c\u5728\u4e0a\u9762\u6211\u4eec\u5c55\u793a\u7684 `docker images` \u7ed3\u679c\u4e2d\uff0c\u6709\u7684\u955c\u50cf\u6709 username \u8fd9\u4e2a\u90e8\u5206\uff0c\u800c\u6709\u7684\u955c\u50cf\u662f\u6ca1\u6709\u7684\u3002\u6ca1\u6709 username \u8fd9\u4e2a\u90e8\u5206\u7684\u955c\u50cf\uff0c\u8868\u793a\u955c\u50cf\u662f\u7531 Docker \u5b98\u65b9\u6240\u7ef4\u62a4\u548c\u63d0\u4f9b\u7684\uff0c\u6240\u4ee5\u5c31\u4e0d\u5355\u72ec\u6807\u8bb0\u7528\u6237\u4e86\u3002\n\n\u5982\u679c\u5927\u5bb6\u518d\u591a\u63a5\u89e6\u4e00\u4e9b\u955c\u50cf\uff0c\u4f1a\u53d1\u73b0 Docker \u4e2d\u955c\u50cf\u7684 repository \u90e8\u5206\u901a\u5e38\u91c7\u7528\u7684\u662f\u8f6f\u4ef6\u540d\u3002\u8fd9\u65f6\u5019\u5927\u5bb6\u4e00\u5b9a\u8981\u6ce8\u610f\u4e86\uff0c\u955c\u50cf\u8fd8\u662f\u955c\u50cf\uff0c\u955c\u50cf\u540d\u8fd8\u662f\u955c\u50cf\u540d\uff0c\u5176\u4e0e\u8f6f\u4ef6\u547d\u540d\u5176\u5b9e\u662f\u72ec\u7acb\u7684\u3002\n\n\u4e4b\u6240\u4ee5\u955c\u50cf\u901a\u5e38\u76f4\u63a5\u91c7\u7528\u8f6f\u4ef6\u540d\uff0c\u8fd9\u8fd8\u8981\u56de\u5f52\u5230 Docker \u5bf9\u5bb9\u5668\u7684\u8f7b\u91cf\u5316\u8bbe\u8ba1\u4e2d\u3002Docker \u5bf9\u5bb9\u5668\u7684\u8bbe\u8ba1\u548c\u5b9a\u4e49\u662f\u5fae\u578b\u5bb9\u5668\u800c\u4e0d\u662f\u5e9e\u5927\u81c3\u80bf\u7684\u5b8c\u6574\u73af\u5883 ( \u8fd9\u5f53\u7136\u5f52\u529f\u4e8e\u5bb9\u5668\u6280\u672f\u5728\u5b9e\u73b0\u865a\u62df\u5316\u8fc7\u7a0b\u4e2d\u6027\u80fd\u51e0\u4e4e\u65e0\u635f )\uff0c\u8fd9\u5c31\u4f7f\u5f97\u6211\u4eec\u901a\u5e38\u4f1a\u53ea\u5728\u4e00\u4e2a\u5bb9\u5668\u4e2d\u8fd0\u884c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u6837\u7684\u597d\u5904\u81ea\u7136\u662f\u80fd\u591f\u5927\u5e45\u964d\u4f4e\u7a0b\u5e8f\u4e4b\u95f4\u76f8\u4e92\u7684\u5f71\u54cd\uff0c\u4e5f\u6709\u5229\u4e8e\u5229\u7528\u5bb9\u5668\u6280\u672f\u63a7\u5236\u6bcf\u4e2a\u7a0b\u5e8f\u6240\u4f7f\u7528\u7684\u8d44\u6e90\u3002\n\n\u56de\u8fc7\u5934\u6765\uff0c\u65e2\u7136\u6211\u4eec\u63a8\u5d07\u8fd9\u79cd\u4e00\u4e2a\u5bb9\u5668\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\u7684\u505a\u6cd5\uff0c\u90a3\u4e48\u81ea\u7136\u5bb9\u5668\u7684\u955c\u50cf\u4e5f\u4f1a\u4ec5\u5305\u542b\u7a0b\u5e8f\u4ee5\u53ca\u4e0e\u5b83\u8fd0\u884c\u6709\u5173\u7684\u4e00\u4e9b\u4f9d\u8d56\u5305\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u7a0b\u5e8f\u7684\u540d\u5b57\u76f4\u63a5\u5957\u7528\u5728\u955c\u50cf\u4e4b\u4e0a\uff0c\u65e2\u795b\u9664\u4e86\u955c\u50cf\u53d6\u540d\u7684\u9ebb\u70e6\uff0c\u53c8\u80fd\u76f4\u63a5\u8868\u8fbe\u955c\u50cf\u4e2d\u7684\u5185\u5bb9\u3002\n\n\u5728\u955c\u50cf\u547d\u540d\u4e2d\uff0c\u8fd8\u6709\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u955c\u50cf\u7684\u6807\u7b7e ( tag )\u3002\u955c\u50cf\u7684\u6807\u7b7e\u662f\u5bf9\u540c\u4e00\u79cd\u955c\u50cf\u8fdb\u884c\u66f4\u7ec6\u5c42\u6b21\u533a\u5206\u7684\u65b9\u6cd5\uff0c\u4e5f\u662f\u6700\u7ec8\u8bc6\u522b\u955c\u50cf\u7684\u5173\u952e\u90e8\u5206\u3002\n\n\u901a\u5e38\u6765\u8bf4\uff0c\u955c\u50cf\u7684\u6807\u7b7e\u4e3b\u8981\u662f\u4e3a\u4e86\u533a\u5206\u540c\u7c7b\u955c\u50cf\u4e0d\u540c\u6784\u5efa\u8fc7\u7a0b\u6240\u4ea7\u751f\u7684\u4e0d\u540c\u7ed3\u679c\u7684\u3002\u7531\u4e8e\u65f6\u95f4\u3001\u7a7a\u95f4\u7b49\u56e0\u7d20\u7684\u4e0d\u540c\uff0cDocker \u6bcf\u6b21\u6784\u5efa\u955c\u50cf\u7684\u5185\u5bb9\u4e5f\u5c31\u6709\u6240\u4e0d\u540c\uff0c\u5177\u4f53\u4f53\u73b0\u5c31\u662f\u955c\u50cf\u5c42\u4ee5\u53ca\u5b83\u4eec\u7684 ID \u90fd\u4f1a\u4ea7\u751f\u53d8\u5316\u3002\u800c\u6807\u7b7e\u5c31\u662f\u5728\u955c\u50cf\u547d\u540d\u8fd9\u4e2a\u5c42\u9762\u4e0a\u533a\u5206\u8fd9\u4e9b\u955c\u50cf\u7684\u65b9\u6cd5\u3002\n\n\u4e0e\u955c\u50cf\u7684 repository \u7c7b\u4f3c\uff0c\u955c\u50cf tag \u7684\u547d\u540d\u65b9\u6cd5\u4e5f\u901a\u5e38\u53c2\u8003\u955c\u50cf\u6240\u5173\u8054\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u66f4\u786e\u5207\u7684\u6765\u8bf4\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u91c7\u7528\u955c\u50cf\u5185\u5e94\u7528\u7a0b\u5e8f\u7684\u7248\u672c\u53f7\u4ee5\u53ca\u4e00\u4e9b\u73af\u5883\u3001\u6784\u5efa\u65b9\u5f0f\u7b49\u4fe1\u606f\u6765\u4f5c\u4e3a\u955c\u50cf\u7684 tag\u3002\n\n\u4f8b\u5982\uff0c\u6211\u4eec\u4e4b\u524d\u793a\u4f8b\u7684\u7ed3\u679c\u4e2d\u5c31\u5206\u522b\u6709\u5305\u542b Redis 3.2 \u7248\u672c\u548c 4.0 \u7248\u672c\u7684\u4e24\u4e2a\u955c\u50cf\uff1a`redis:3.2` \u548c `redis:4.0`\u3002\n\n\u9664\u4e86\u5355\u7eaf\u4f7f\u7528\u5e94\u7528\u7a0b\u5e8f\u7248\u672c\u6765\u4f5c\u4e3a\u955c\u50cf\u7684\u6807\u7b7e\u5916\uff0c\u6709\u65f6\u5019\u6211\u4eec\u4e5f\u4f1a\u5728\u5176\u4e2d\u5305\u542b\u4e00\u4e9b\u6784\u5efa\u65b9\u5f0f\u7684\u533a\u522b\u3002\u4f8b\u5982 `php:7.2-cli` \u548c `php:7.2-fpm` \u4e24\u4e2a\u955c\u50cf\u5206\u522b\u8868\u793a\u53ea\u5305\u542b\u63a7\u5236\u53f0\u547d\u4ee4\u7684 PHP \u955c\u50cf\u4ee5\u53ca\u5305\u542b PHP-FPM \u529f\u80fd\u7684 PHP \u955c\u50cf\uff0c\u800c\u4ed6\u4eec\u5bf9\u5e94 PHP \u7248\u672c\u90fd\u662f 7.2\u3002\n\n\u901a\u8fc7\u7ec4\u5408\u5e94\u7528\u7a0b\u5e8f\u548c\u5b83\u7684\u7248\u672c\u53f7\u6765\u547d\u540d\u955c\u50cf\uff0c\u5927\u5927\u65b9\u4fbf\u4e86\u6211\u4eec\u5728 Docker \u533a\u522b\u548c\u4f7f\u7528\u955c\u50cf\u7684\u95e8\u69db\uff0c\u4e0e\u5176\u8bf4\u6211\u4eec\u5728\u4f7f\u7528 Docker \u8fdb\u884c\u6765\u542f\u52a8\u5bb9\u5668\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5012\u66f4\u50cf\u6211\u4eec\u5728\u8fd0\u884c\u6307\u5b9a\u7248\u672c\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\n\n\u53e6\u5916\uff0cDocker \u4e2d\u8fd8\u6709\u4e00\u4e2a\u7ea6\u5b9a\uff0c\u5f53\u6211\u4eec\u5728\u64cd\u4f5c\u4e2d\u6ca1\u6709\u5177\u4f53\u7ed9\u51fa\u955c\u50cf\u7684 tag \u65f6\uff0cDocker \u4f1a\u91c7\u7528 **latest** \u4f5c\u4e3a\u7f3a\u7701 tag\u3002\u8fd9\u4e5f\u5c31\u5e26\u6765\u4e86\u4e00\u4e2a\u5171\u8bc6\uff0c\u4e5f\u5c31\u662f\u7edd\u5927\u591a\u6570\u955c\u50cf\u63d0\u4f9b\u8005\u5728\u63d0\u4f9b\u955c\u50cf\u65f6\uff0c\u4f1a\u5728 latest \u5bf9\u5e94\u7684\u955c\u50cf\u4e2d\u5305\u542b\u8f6f\u4ef6\u6700\u65b0\u7684\u7248\u672c\u3002\u8fd9\u5e26\u6765\u4e86\u4e00\u9879\u5c0f\u4fbf\u5229\uff0c\u5c31\u662f\u6211\u4eec\u5728\u4e0d\u9700\u8981\u4e86\u89e3\u5e94\u7528\u7a0b\u5e8f\u8fed\u4ee3\u5468\u671f\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5229\u7528 latest \u955c\u50cf\u4fdd\u6301\u8f6f\u4ef6\u6700\u65b0\u7248\u672c\u7684\u4f7f\u7528\u3002\n\n## \u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\n\n\u8981\u719f\u6089 Docker \u5bb9\u5668\uff0c\u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u4e5f\u5c31\u662f\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u3002\n\n\u7531\u4e8e Docker \u63fd\u4e0b\u4e86\u5927\u90e8\u5206\u5bf9\u5bb9\u5668\u7ba1\u7406\u7684\u6d3b\uff0c\u53ea\u63d0\u4f9b\u7ed9\u6211\u4eec\u975e\u5e38\u7b80\u5355\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u8fd9\u5c31\u610f\u5473\u7740 Docker \u91cc\u5bf9\u5bb9\u5668\u7684\u4e00\u4e9b\u8fd0\u884c\u7ec6\u8282\u4f1a\u88ab\u66f4\u52a0\u4e25\u683c\u7684\u5b9a\u4e49\uff0c\u8fd9\u5176\u4e2d\u5c31\u5305\u62ec\u4e86\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u3002\n\n\u8fd9\u91cc\u6709\u4e00\u5f20\u5bb9\u5668\u8fd0\u884c\u7684\u72b6\u6001\u6d41\u8f6c\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/9/17/165e53743e730432?w=1829&h=932&f=png&s=215394)\n\n\u56fe\u4e2d\u5c55\u793a\u4e86\u51e0\u79cd\u5e38\u89c1\u5bf9 Docker \u5bb9\u5668\u7684\u64cd\u4f5c\u547d\u4ee4\uff0c\u4ee5\u53ca\u6267\u884c\u5b83\u4eec\u4e4b\u540e\u5bb9\u5668\u8fd0\u884c\u72b6\u6001\u7684\u53d8\u5316\u3002\u8fd9\u91cc\u6211\u4eec\u6487\u5f00\u547d\u4ee4\uff0c\u7740\u91cd\u770b\u770b\u5bb9\u5668\u7684\u51e0\u4e2a\u6838\u5fc3\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u56fe\u4e2d\u8272\u5757\u8868\u793a\u7684\uff1a**Created**\u3001**Running**\u3001**Paused**\u3001**Stopped**\u3001**Deleted**\u3002\n\n\u5728\u8fd9\u51e0\u79cd\u72b6\u6001\u4e2d\uff0cRunning \u662f\u6700\u4e3a\u5173\u952e\u7684\u72b6\u6001\uff0c\u5728\u8fd9\u79cd\u72b6\u6001\u4e2d\u7684\u5bb9\u5668\uff0c\u5c31\u662f\u771f\u6b63\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u4e86\u3002\n\n### \u4e3b\u8fdb\u7a0b\n\n\u5982\u679c\u5355\u7eaf\u53bb\u770b\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u4f1a\u6709\u4e00\u4e9b\u96be\u7406\u89e3\u7684\u5730\u65b9\uff0c\u800c Docker \u4e2d\u5bf9\u5bb9\u5668\u751f\u547d\u5468\u671f\u7684\u5b9a\u4e49\u5176\u5b9e\u5e76\u4e0d\u662f\u72ec\u7acb\u5b58\u5728\u7684\u3002\n\n\u5728 Docker \u7684\u8bbe\u8ba1\u4e2d\uff0c\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u5176\u5b9e\u4e0e\u5bb9\u5668\u4e2d PID \u4e3a 1 \u8fd9\u4e2a\u8fdb\u7a0b\u6709\u7740\u5bc6\u5207\u7684\u5173\u7cfb\u3002\u66f4\u786e\u5207\u7684\u8bf4\uff0c\u5b83\u4eec\u5176\u5b9e\u662f\u5171\u60a3\u96be\uff0c\u540c\u751f\u6b7b\u7684\u5144\u5f1f\u3002\u5bb9\u5668\u7684\u542f\u52a8\uff0c\u672c\u8d28\u4e0a\u53ef\u4ee5\u7406\u89e3\u4e3a\u8fd9\u4e2a\u8fdb\u7a0b\u7684\u542f\u52a8\uff0c\u800c\u5bb9\u5668\u7684\u505c\u6b62\u4e5f\u5c31\u610f\u5473\u7740\u8fd9\u4e2a\u8fdb\u7a0b\u7684\u505c\u6b62\uff0c\u53cd\u8fc7\u6765\u7406\u89e3\u4ea6\u7136\u3002\n\n\u5f53\u6211\u4eec\u542f\u52a8\u5bb9\u5668\u65f6\uff0cDocker \u5176\u5b9e\u4f1a\u6309\u7167\u955c\u50cf\u4e2d\u7684\u5b9a\u4e49\uff0c\u542f\u52a8\u5bf9\u5e94\u7684\u7a0b\u5e8f\uff0c\u5e76\u5c06\u8fd9\u4e2a\u7a0b\u5e8f\u7684\u4e3b\u8fdb\u7a0b\u4f5c\u4e3a\u5bb9\u5668\u7684\u4e3b\u8fdb\u7a0b ( \u4e5f\u5c31\u662f PID \u4e3a 1 \u7684\u8fdb\u7a0b )\u3002\u800c\u5f53\u6211\u4eec\u63a7\u5236\u5bb9\u5668\u505c\u6b62\u65f6\uff0cDocker \u4f1a\u5411\u4e3b\u8fdb\u7a0b\u53d1\u9001\u7ed3\u675f\u4fe1\u53f7\uff0c\u901a\u77e5\u7a0b\u5e8f\u9000\u51fa\u3002\n\n\u800c\u5f53\u5bb9\u5668\u4e2d\u7684\u4e3b\u8fdb\u7a0b\u4e3b\u52a8\u5173\u95ed\u65f6 ( \u6b63\u5e38\u7ed3\u675f\u6216\u51fa\u9519\u505c\u6b62 )\uff0c\u4e5f\u4f1a\u8ba9\u5bb9\u5668\u968f\u4e4b\u505c\u6b62\u3002\n\n\u901a\u8fc7\u4e4b\u524d\u63d0\u5230\u7684\u51e0\u4e2a\u65b9\u9762\u6765\u770b\uff0cDocker \u4e0d\u4ec5\u662f\u4ece\u8bbe\u8ba1\u4e0a\u63a8\u5d07\u8f7b\u91cf\u5316\u7684\u5bb9\u5668\uff0c\u4e5f\u662f\u8bb8\u591a\u673a\u5236\u4e0a\u662f\u4ee5\u6b64\u4e3a\u539f\u5219\u53bb\u5b9e\u73b0\u7684\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u6700\u4f73\u7684 Docker \u5b9e\u8df5\u65b9\u6cd5\u662f\u9075\u5faa\u7740\u5b83\u7684\u903b\u8f91\uff0c\u9010\u6e10\u4e60\u60ef\u8fd9\u79cd\u5bb9\u5668\u5373\u5e94\u7528\uff0c\u5e94\u7528\u5373\u5bb9\u5668\u7684\u865a\u62df\u5316\u65b9\u5f0f\u3002\u867d\u7136\u5728 Docker \u4e2d\u6211\u4eec\u4e5f\u80fd\u591f\u5b9e\u73b0\u5728\u540c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u8fd0\u884c\u591a\u4e2a\u4e0d\u540c\u7c7b\u578b\u7684\u7a0b\u5e8f\uff0c\u4f46\u8fd9\u4e48\u505a\u7684\u8bdd\uff0cDocker \u5c31\u65e0\u6cd5\u8ddf\u8e2a\u4e0d\u540c\u5e94\u7528\u7684\u751f\u547d\u5468\u671f\uff0c\u6709\u53ef\u80fd\u9020\u6210\u5e94\u7528\u7684\u975e\u6b63\u5e38\u5173\u95ed\uff0c\u8fdb\u800c\u5f71\u54cd\u7cfb\u7edf\u3001\u6570\u636e\u7684\u7a33\u5b9a\u6027\u3002\n\n## \u5199\u65f6\u590d\u5236\u673a\u5236\n\n\u5199\u65f6\u590d\u5236 ( Copy on Write ) \u8fd9\u4e2a\u8bcd\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\u5e94\u8be5\u5e76\u4e0d\u964c\u751f\uff0c\u5728\u5f88\u591a\u7f16\u7a0b\u8bed\u8a00\u91cc\uff0c\u90fd\u9690\u85cf\u4e86\u5199\u65f6\u590d\u5236\u7684\u5b9e\u73b0\u3002\u5728\u7f16\u7a0b\u91cc\uff0c\u5199\u65f6\u590d\u5236\u5e38\u5e38\u7528\u4e8e\u5bf9\u8c61\u6216\u6570\u7ec4\u7684\u62f7\u8d1d\u4e2d\uff0c\u5f53\u6211\u4eec\u62f7\u8d1d\u5bf9\u8c61\u6216\u6570\u7ec4\u65f6\uff0c\u590d\u5236\u7684\u8fc7\u7a0b\u5e76\u4e0d\u662f\u9a6c\u4e0a\u53d1\u751f\u5728\u5185\u5b58\u4e2d\uff0c\u800c\u53ea\u662f\u5148\u8ba9\u4e24\u4e2a\u53d8\u91cf\u540c\u65f6\u6307\u5411\u540c\u4e00\u4e2a\u5185\u5b58\u7a7a\u95f4\uff0c\u5e76\u8fdb\u884c\u4e00\u4e9b\u6807\u8bb0\uff0c\u5f53\u6211\u4eec\u8981\u5bf9\u5bf9\u8c61\u6216\u6570\u7ec4\u8fdb\u884c\u4fee\u6539\u65f6\uff0c\u624d\u771f\u6b63\u8fdb\u884c\u5185\u5b58\u7684\u62f7\u8d1d\u3002\n\nDocker \u7684\u5199\u65f6\u590d\u5236\u4e0e\u7f16\u7a0b\u4e2d\u7684\u76f8\u7c7b\u4f3c\uff0c\u4e5f\u5c31\u662f\u5728\u901a\u8fc7\u955c\u50cf\u8fd0\u884c\u5bb9\u5668\u65f6\uff0c\u5e76\u4e0d\u662f\u9a6c\u4e0a\u5c31\u628a\u955c\u50cf\u91cc\u7684\u6240\u6709\u5185\u5bb9\u62f7\u8d1d\u5230\u5bb9\u5668\u6240\u8fd0\u884c\u7684\u6c99\u76d2\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u800c\u662f\u5229\u7528 UnionFS \u5c06\u955c\u50cf\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u6302\u8f7d\u5230\u6c99\u76d2\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u53ea\u6709\u5728\u5bb9\u5668\u4e2d\u53d1\u751f\u5bf9\u6587\u4ef6\u7684\u4fee\u6539\u65f6\uff0c\u4fee\u6539\u624d\u4f1a\u4f53\u73b0\u5230\u6c99\u76d2\u73af\u5883\u4e0a\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bb9\u5668\u5728\u521b\u5efa\u548c\u542f\u52a8\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u4efb\u4f55\u7684\u6587\u4ef6\u7cfb\u7edf\u590d\u5236\u64cd\u4f5c\uff0c\u4e5f\u4e0d\u9700\u8981\u4e3a\u5bb9\u5668\u5355\u72ec\u5f00\u8f9f\u5927\u91cf\u7684\u786c\u76d8\u7a7a\u95f4\uff0c\u4e0e\u5176\u4ed6\u865a\u62df\u5316\u65b9\u5f0f\u5bf9\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u64cd\u4f5c\u8fdb\u884c\u5bf9\u6bd4\uff0cDocker \u542f\u52a8\u7684\u901f\u5ea6\u53ef\u89c1\u4e00\u6591\u3002\n\n\u91c7\u7528\u5199\u65f6\u590d\u5236\u673a\u5236\u6765\u8bbe\u8ba1\u7684 Docker\uff0c\u65e2\u4fdd\u8bc1\u4e86\u955c\u50cf\u5728\u751f\u6210\u4e3a\u5bb9\u5668\u65f6\uff0c\u4ee5\u53ca\u5bb9\u5668\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u5bf9\u81ea\u8eab\u9020\u6210\u4fee\u6539\u3002\u53c8\u501f\u52a9\u5254\u9664\u5e38\u89c1\u865a\u62df\u5316\u5728\u521d\u59cb\u5316\u65f6\u9700\u8981\u4ece\u955c\u50cf\u4e2d\u62f7\u8d1d\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u8fc7\u7a0b\uff0c\u5927\u5e45\u63d0\u9ad8\u4e86\u5bb9\u5668\u7684\u521b\u5efa\u548c\u542f\u52a8\u901f\u5ea6\u3002\u53ef\u4ee5\u8bf4\uff0cDocker \u5bb9\u5668\u80fd\u591f\u5b9e\u73b0\u79d2\u7ea7\u542f\u52a8\u901f\u5ea6\uff0c\u5199\u65f6\u590d\u5236\u673a\u5236\u5728\u5176\u4e2d\u53d1\u6325\u4e86\u4e3e\u8db3\u8f7b\u91cd\u7684\u4f5c\u7528\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u8fd9\u4e00\u5c0f\u8282\u4e2d\uff0c\u6211\u4eec\u5bf9 Docker \u7684\u955c\u50cf\u4e0e\u5bb9\u5668\u76f8\u5173\u7684\u6982\u5ff5\u8fdb\u884c\u4e86\u8fdb\u4e00\u6b65\u7684\u68b3\u7406\uff0c\u901a\u8fc7\u638c\u63e1\u8fd9\u4e9b\u8bcd\u6c47\uff0c\u80fd\u591f\u66f4\u597d\u7684\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\u4e4b\u540e\u5c0f\u8282\u4e2d\u7684\u5185\u5bb9\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> Docker \u5bf9\u955c\u50cf\u4e0e\u5bb9\u5668\u7684\u8bbe\u8ba1\u6709\u4ec0\u4e48\u72ec\u7279\u4e4b\u5904\uff0c\u5b83\u4eec\u53c8\u7ed9 Docker \u5e26\u6765\u4e86\u600e\u6837\u7684\u4f18\u52bf\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u955c\u50cf\u4e0e\u5bb9\u5668\u76f8\u5173\u7684\u6982\u5ff5\u3001\u77e5\u8bc6\u8fd8\u6709\u4e0d\u7406\u89e3\u7684\u5730\u65b9\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u4f7f\u7528\u5bb9\u5668\u955c\u50cf\u4e0e\u5bb9\u5668.md", "create_date": "2020-02-18T21:18:39.160", "order": 6}}, {"model": "subject.chapter", "pk": 71, "fields": {"title": "\u4f7f\u7528\u5bb9\u5668\uff1a\u4e3a\u5bb9\u5668\u914d\u7f6e\u7f51\u7edc", "topic": 3, "md5": "c80eba0d8826da7e89c11ca4a6b33448", "md_body": "# \u4e3a\u5bb9\u5668\u914d\u7f6e\u7f51\u7edc\n\n\u5728\u4e92\u8054\u7f51\u65f6\u4ee3\uff0c\u7f51\u7edc\u5df2\u7ecf\u6210\u4e3a\u7edd\u5927\u591a\u6570\u5e94\u7528\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u7684\u4e3b\u8981\u901a\u9053\uff0cDocker \u4f5c\u4e3a\u96c6\u7fa4\u90e8\u7f72\u7684\u5229\u5668\uff0c\u5728\u7f51\u7edc\u652f\u6301\u4e0a\u4e5f\u4e0b\u4e86\u8bb8\u591a\u529f\u592b\u3002\u529f\u80fd\u4e30\u5bcc\u548c\u5f3a\u5927\uff0c\u5e76\u4e0d\u4ee3\u8868\u4f7f\u7528\u590d\u6742\uff0c\u5728 Docker \u7684\u5c01\u88c5\u4e0b\uff0c\u6211\u4eec\u4f9d\u7136\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u548c\u53c2\u6570\u8f7b\u677e\u7684\u4e3a\u5bb9\u5668\u5236\u5b9a\u4e0d\u540c\u7684\u7f51\u7edc\u65b9\u6848\u3002\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u4e86\u89e3 Docker \u7684\u7f51\u7edc\u90e8\u5206\u3002\n\n## \u5bb9\u5668\u7f51\u7edc\n\n\u5728\u4e4b\u524d\u4ecb\u7ecd Docker \u6838\u5fc3\u7ec4\u6210\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5df2\u7ecf\u7b80\u5355\u8c08\u5230\u4e86\u5bb9\u5668\u7f51\u7edc\u7684\u76f8\u5173\u77e5\u8bc6\u3002\u5bb9\u5668\u7f51\u7edc\u5b9e\u8d28\u4e0a\u4e5f\u662f\u7531 Docker \u4e3a\u5e94\u7528\u7a0b\u5e8f\u6240\u521b\u9020\u7684\u865a\u62df\u73af\u5883\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u80fd\u8ba9\u5e94\u7528\u4ece\u5bbf\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f51\u7edc\u73af\u5883\u4e2d\u72ec\u7acb\u51fa\u6765\uff0c\u5f62\u6210\u5bb9\u5668\u81ea\u6709\u7684\u7f51\u7edc\u8bbe\u5907\u3001IP \u534f\u8bae\u6808\u3001\u7aef\u53e3\u5957\u63a5\u5b57\u3001IP \u8def\u7531\u8868\u3001\u9632\u706b\u5899\u7b49\u7b49\u4e0e\u7f51\u7edc\u76f8\u5173\u7684\u6a21\u5757\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/5/165a810ad2c81714?w=1570&h=486&f=png&s=50933)\n\n\u8fd8\u662f\u56de\u5f52\u4e0a\u9762\u8fd9\u5e45\u4e4b\u524d\u5c55\u793a\u8fc7\u7684\u5173\u4e8e Docker \u7f51\u7edc\u7684\u56fe\u7247\u3002\u5728 Docker \u7f51\u7edc\u4e2d\uff0c\u6709\u4e09\u4e2a\u6bd4\u8f83\u6838\u5fc3\u7684\u6982\u5ff5\uff0c\u4e5f\u5c31\u662f\uff1a**\u6c99\u76d2 ( Sandbox )**\u3001**\u7f51\u7edc ( Network )**\u3001**\u7aef\u70b9 ( Endpoint )**\u3002\n\n*   **\u6c99\u76d2**\u63d0\u4f9b\u4e86\u5bb9\u5668\u7684\u865a\u62df\u7f51\u7edc\u6808\uff0c\u4e5f\u5c31\u662f\u4e4b\u524d\u6240\u63d0\u5230\u7684\u7aef\u53e3\u5957\u63a5\u5b57\u3001IP \u8def\u7531\u8868\u3001\u9632\u706b\u5899\u7b49\u7684\u5185\u5bb9\u3002\u5176\u5b9e\u73b0\u9694\u79bb\u4e86\u5bb9\u5668\u7f51\u7edc\u4e0e\u5bbf\u4e3b\u673a\u7f51\u7edc\uff0c\u5f62\u6210\u4e86\u5b8c\u5168\u72ec\u7acb\u7684\u5bb9\u5668\u7f51\u7edc\u73af\u5883\u3002\n*   **\u7f51\u7edc**\u53ef\u4ee5\u7406\u89e3\u4e3a Docker \u5185\u90e8\u7684\u865a\u62df\u5b50\u7f51\uff0c\u7f51\u7edc\u5185\u7684\u53c2\u4e0e\u8005\u76f8\u4e92\u53ef\u89c1\u5e76\u80fd\u591f\u8fdb\u884c\u901a\u8baf\u3002Docker \u7684\u8fd9\u79cd\u865a\u62df\u7f51\u7edc\u4e5f\u662f\u4e8e\u5bbf\u4e3b\u673a\u7f51\u7edc\u5b58\u5728\u9694\u79bb\u5173\u7cfb\u7684\uff0c\u5176\u76ee\u7684\u4e3b\u8981\u662f\u5f62\u6210\u5bb9\u5668\u95f4\u7684\u5b89\u5168\u901a\u8baf\u73af\u5883\u3002\n*   **\u7aef\u70b9**\u662f\u4f4d\u4e8e\u5bb9\u5668\u6216\u7f51\u7edc\u9694\u79bb\u5899\u4e4b\u4e0a\u7684\u6d1e\uff0c\u5176\u4e3b\u8981\u76ee\u7684\u662f\u5f62\u6210\u4e00\u4e2a\u53ef\u4ee5\u63a7\u5236\u7684\u7a81\u7834\u5c01\u95ed\u7684\u7f51\u7edc\u73af\u5883\u7684\u51fa\u5165\u53e3\u3002\u5f53\u5bb9\u5668\u7684\u7aef\u70b9\u4e0e\u7f51\u7edc\u7684\u7aef\u70b9\u5f62\u6210\u914d\u5bf9\u540e\uff0c\u5c31\u5982\u540c\u5728\u8fd9\u4e24\u8005\u4e4b\u95f4\u642d\u5efa\u4e86\u6865\u6881\uff0c\u4fbf\u80fd\u591f\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u4e86\u3002\n\n\u8fd9\u4e09\u8005\u5f62\u6210\u4e86 Docker \u7f51\u7edc\u7684\u6838\u5fc3\u6a21\u578b\uff0c\u4e5f\u5c31\u662f\u5bb9\u5668\u7f51\u7edc\u6a21\u578b ( Container Network Model )\u3002\n\n### \u6d45\u6790 Docker \u7684\u7f51\u7edc\u5b9e\u73b0\n\n\u5bb9\u5668\u7f51\u7edc\u6a21\u578b\u4e3a\u5bb9\u5668\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e00\u5957\u6807\u51c6\u7684\u7f51\u7edc\u5bf9\u63a5\u8303\u5f0f\uff0c\u800c\u5728 Docker \u4e2d\uff0c\u5b9e\u73b0\u8fd9\u5957\u8303\u5f0f\u7684\u662f Docker \u6240\u5c01\u88c5\u7684 libnetwork \u6a21\u5757\u3002\n\n\u800c\u5bf9\u4e8e\u7f51\u7edc\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5728 Docker \u7684\u53d1\u5c55\u8fc7\u7a0b\u4e2d\u4e5f\u9010\u6e10\u62bd\u8c61\uff0c\u5f62\u6210\u4e86\u7edf\u4e00\u7684\u62bd\u8c61\u5b9a\u4e49\u3002\u8fdb\u800c\u901a\u8fc7\u8fd9\u4e9b\u62bd\u8c61\u5b9a\u4e49\uff0c\u4fbf\u53ef\u4ee5\u5bf9 Docker \u7f51\u7edc\u7684\u5b9e\u73b0\u65b9\u5f0f\u8fdb\u884c\u4e0d\u540c\u7684\u53d8\u5316\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/23/166042a49627f8a6?w=1304&h=702&f=png&s=65589)\n\n\u76ee\u524d Docker \u5b98\u65b9\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e94\u79cd Docker \u7f51\u7edc\u9a71\u52a8\uff0c\u5206\u522b\u662f\uff1a**Bridge Driver**\u3001**Host Driver**\u3001**Overlay Driver**\u3001**MacLan Driver**\u3001**None Driver**\u3002\n\n\u5176\u4e2d\uff0cBridge \u7f51\u7edc\u662f Docker \u5bb9\u5668\u7684\u9ed8\u8ba4\u7f51\u7edc\u9a71\u52a8\uff0c\u7b80\u800c\u8a00\u4e4b\u5176\u5c31\u662f\u901a\u8fc7\u7f51\u6865\u6765\u5b9e\u73b0\u7f51\u7edc\u901a\u8baf ( \u7f51\u6865\u7f51\u7edc\u7684\u5b9e\u73b0\u53ef\u4ee5\u57fa\u4e8e\u786c\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u57fa\u4e8e\u8f6f\u4ef6 )\u3002\u800c Overlay \u7f51\u7edc\u662f\u501f\u52a9 Docker \u96c6\u7fa4\u6a21\u5757 Docker Swarm \u6765\u642d\u5efa\u7684\u8de8 Docker Daemon \u7f51\u7edc\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u642d\u5efa\u8de8\u7269\u7406\u4e3b\u673a\u7684\u865a\u62df\u7f51\u7edc\uff0c\u8fdb\u800c\u8ba9\u4e0d\u540c\u7269\u7406\u673a\u4e2d\u8fd0\u884c\u7684\u5bb9\u5668\u611f\u77e5\u4e0d\u5230\u591a\u4e2a\u7269\u7406\u673a\u7684\u5b58\u5728\u3002\n\nBridge Driver \u548c Overlay Driver \u5728\u5f00\u53d1\u4e2d\u4f7f\u7528\u9891\u7387\u8f83\u9ad8\uff0c\u4e4b\u540e\u7684\u5c0f\u8282\u8bb2\u89e3\u91cc\uff0c\u5173\u4e8e\u5bb9\u5668\u7f51\u7edc\u7684\u90e8\u5206\u6211\u4eec\u90fd\u4e3b\u8981\u56f4\u7ed5\u7740\u5b83\u4eec\u5c55\u5f00\u3002\n\n\u5f53\u7136\uff0c\u5173\u4e8e Docker \u7684\u7f51\u7edc\u5b9e\u73b0\u8fd8\u6709\u975e\u5e38\u591a\u7684\u7ec6\u8282\u3002\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u6211\u4eec\u53ea\u662f Docker \u7684\u4f7f\u7528\u8005\u800c\u975e\u6280\u672f\u4e13\u5bb6\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u4e0d\u505a\u66f4\u591a\u8be6\u5c3d\u7684\u8bba\u8ff0\u3002\n\n## \u5bb9\u5668\u4e92\u8054\n\n\u7531\u4e8e Docker \u63d0\u5021\u5bb9\u5668\u4e0e\u5e94\u7528\u5171\u751f\u7684\u8f7b\u91cf\u7ea7\u5bb9\u5668\u7406\u5ff5\uff0c\u6240\u4ee5\u5bb9\u5668\u4e2d\u901a\u5e38\u53ea\u5305\u542b\u4e00\u79cd\u5e94\u7528\u7a0b\u5e8f\uff0c\u4f46\u6211\u4eec\u77e5\u9053\uff0c\u5982\u4eca\u7eb7\u7e41\u7684\u7cfb\u7edf\u670d\u52a1\uff0c\u6ca1\u6709\u51e0\u4e2a\u662f\u53ef\u4ee5\u901a\u8fc7\u5355\u4e00\u7684\u5e94\u7528\u7a0b\u5e8f\u652f\u6491\u7684\u3002\u62ff\u6700\u7b80\u5355\u7684 Web \u5e94\u7528\u4e3a\u4f8b\uff0c\u4e5f\u81f3\u5c11\u9700\u8981\u4e1a\u52a1\u5e94\u7528\u3001\u6570\u636e\u5e93\u5e94\u7528\u3001\u7f13\u5b58\u5e94\u7528\u7b49\u7ec4\u6210\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728 Docker \u91cc\u6211\u4eec\u9700\u8981\u901a\u8fc7\u591a\u4e2a\u5bb9\u5668\u6765\u7ec4\u6210\u8fd9\u6837\u7684\u7cfb\u7edf\u3002\n\n\u800c\u8fd9\u4e9b\u4e92\u8054\u7f51\u65f6\u4ee3\u7684\u5e94\u7528\uff0c\u5176\u95f4\u7684\u901a\u8baf\u65b9\u5f0f\u4e3b\u8981\u4ee5\u7f51\u7edc\u4e3a\u4e3b\uff0c\u6240\u4ee5\u6253\u901a\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\uff0c\u662f\u4f7f\u5b83\u4eec\u80fd\u591f\u4e92\u76f8\u901a\u8baf\u7684\u5173\u952e\u6240\u5728\u3002\n\n\u8981\u8ba9\u4e00\u4e2a\u5bb9\u5668\u8fde\u63a5\u5230\u53e6\u5916\u4e00\u4e2a\u5bb9\u5668\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5bb9\u5668\u901a\u8fc7 `docker create` \u6216 `docker run` \u521b\u5efa\u65f6\u901a\u8fc7 `--link` \u9009\u9879\u8fdb\u884c\u914d\u7f6e\u3002\n\n\u4f8b\u5982\uff0c\u8fd9\u91cc\u6211\u4eec\u521b\u5efa\u4e00\u4e2a MySQL \u5bb9\u5668\uff0c\u5c06\u8fd0\u884c\u6211\u4eec Web \u5e94\u7528\u7684\u5bb9\u5668\u8fde\u63a5\u5230\u8fd9\u4e2a MySQL \u5bb9\u5668\u4e0a\uff0c\u6253\u901a\u4e24\u4e2a\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\uff0c\u5b9e\u73b0\u5b83\u4eec\u4e4b\u95f4\u7684\u7f51\u7edc\u4e92\u901a\u3002\n\n```\n$ sudo docker run -d --name mysql -e MYSQL_RANDOM_ROOT_PASSWORD=yes mysql\n$ sudo docker run -d --name webapp --link mysql webapp:latest\n\n```\n\n\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\u5df2\u7ecf\u6253\u901a\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u5982\u4f55\u5728 Web \u5e94\u7528\u4e2d\u8fde\u63a5\u5230 MySQL \u6570\u636e\u5e93\u5462\uff1fDocker \u4e3a\u5bb9\u5668\u95f4\u8fde\u63a5\u63d0\u4f9b\u4e86\u4e00\u79cd\u975e\u5e38\u53cb\u597d\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06\u5bb9\u5668\u7684\u7f51\u7edc\u547d\u540d\u586b\u5165\u5230\u8fde\u63a5\u5730\u5740\u4e2d\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u9700\u8981\u8fde\u63a5\u7684\u5bb9\u5668\u4e86\u3002\n\n\u5047\u8bbe\u6211\u4eec\u5728 Web \u5e94\u7528\u4e2d\u4f7f\u7528\u7684\u662f JDBC \u8fdb\u884c\u6570\u636e\u5e93\u8fde\u63a5\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u586b\u5199\u8fde\u63a5\u3002\n\n```\nString url = \"jdbc:mysql://mysql:3306/webapp\";\n\n```\n\n\u5728\u8fd9\u91cc\uff0c\u8fde\u63a5\u5730\u5740\u4e2d\u7684 mysql \u5c31\u597d\u4f3c\u6211\u4eec\u5e38\u89c1\u7684\u57df\u540d\u89e3\u6790\uff0cDocker \u4f1a\u5c06\u5176\u6307\u5411 MySQL \u5bb9\u5668\u7684 IP \u5730\u5740\u3002\n\n\u770b\u5230\u8fd9\u91cc\uff0c\u8bfb\u8005\u4eec\u6709\u6ca1\u6709\u53d1\u73b0 Docker \u5728\u5bb9\u5668\u4e92\u901a\u4e2d\u4e3a\u6211\u4eec\u5e26\u6765\u7684\u4e00\u9879\u4fbf\u5229\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u4e0d\u518d\u9700\u8981\u771f\u5b9e\u7684\u77e5\u9053\u53e6\u5916\u4e00\u4e2a\u5bb9\u5668\u7684 IP \u5730\u5740\u5c31\u80fd\u8fdb\u884c\u8fde\u63a5\u3002\u518d\u5177\u4f53\u6765\u5bf9\u6bd4\uff0c\u5728\u4ee5\u5f80\u7684\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u6bcf\u5207\u6362\u4e00\u4e2a\u73af\u5883 ( \u4f8b\u5982\u5c06\u7a0b\u5e8f\u4ece\u5f00\u53d1\u73af\u5883\u63d0\u4ea4\u5230\u6d4b\u8bd5\u73af\u5883 )\uff0c\u90fd\u9700\u8981\u91cd\u65b0\u914d\u7f6e\u7a0b\u5e8f\u4e2d\u7684\u5404\u9879\u8fde\u63a5\u5730\u5740\u7b49\u53c2\u6570\uff0c\u800c\u5728 Docker \u91cc\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5173\u5fc3\u8fd9\u4e2a\uff0c\u53ea\u9700\u8981\u7a0b\u5e8f\u4e2d\u914d\u7f6e\u88ab\u8fde\u63a5\u5bb9\u5668\u7684\u522b\u540d\uff0c\u6620\u5c04 IP \u7684\u5de5\u4f5c\u5c31\u4ea4\u7ed9 Docker \u5b8c\u6210\u4e86\u3002\n\n### \u66b4\u9732\u7aef\u53e3\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\u6253\u901a\u4e86\uff0c\u4f46\u5e76\u4e0d\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u4efb\u610f\u8bbf\u95ee\u88ab\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684\u4efb\u4f55\u670d\u52a1\u3002Docker \u4e3a\u5bb9\u5668\u7f51\u7edc\u589e\u52a0\u4e86\u4e00\u5957\u5b89\u5168\u673a\u5236\uff0c\u53ea\u6709\u5bb9\u5668\u81ea\u8eab\u5141\u8bb8\u7684\u7aef\u53e3\uff0c\u624d\u80fd\u88ab\u5176\u4ed6\u5bb9\u5668\u6240\u8bbf\u95ee\u3002\n\n\u8fd9\u4e2a\u5bb9\u5668\u81ea\u6211\u6807\u8bb0\u7aef\u53e3\u53ef\u88ab\u8bbf\u95ee\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u901a\u5e38\u79f0\u4e3a\u66b4\u9732\u7aef\u53e3\u3002\u6211\u4eec\u5728 `docker ps` \u7684\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u5230\u5bb9\u5668\u66b4\u9732\u7ed9\u5176\u4ed6\u5bb9\u5668\u8bbf\u95ee\u7684\u7aef\u53e3\u3002\n\n```\n$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                 NAMES\n95507bc88082        mysql:5.7           \"docker-entrypoint.s\u2026\"   17 seconds ago      Up 16 seconds       3306/tcp, 33060/tcp   mysql\n\n```\n\n\u8fd9\u91cc\u6211\u4eec\u770b\u5230\uff0cMySQL \u8fd9\u4e2a\u5bb9\u5668\u66b4\u9732\u7684\u7aef\u53e3\u662f 3306 \u548c 33060\u3002\u6240\u4ee5\u6211\u4eec\u8fde\u63a5\u5230 MySQL \u5bb9\u5668\u540e\uff0c\u53ea\u80fd\u5bf9\u8fd9\u4e24\u4e2a\u7aef\u53e3\u8fdb\u884c\u8bbf\u95ee\u3002\n\n\u7aef\u53e3\u7684\u66b4\u9732\u53ef\u4ee5\u901a\u8fc7 Docker \u955c\u50cf\u8fdb\u884c\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4ee5\u5728\u5bb9\u5668\u521b\u5efa\u65f6\u8fdb\u884c\u5b9a\u4e49\u3002\u5728\u5bb9\u5668\u521b\u5efa\u65f6\u8fdb\u884c\u5b9a\u4e49\u7684\u65b9\u6cd5\u662f\u501f\u52a9 `--expose` \u8fd9\u4e2a\u9009\u9879\u3002\n\n```\n$ sudo docker run -d --name mysql -e MYSQL_RANDOM_ROOT_PASSWORD=yes --expose 13306 --expose 23306 mysql:5.7\n\n```\n\n\u8fd9\u91cc\u6211\u4eec\u4e3a MySQL \u66b4\u9732\u4e86 13306 \u548c 23306 \u8fd9\u4e24\u4e2a\u7aef\u53e3\uff0c\u66b4\u9732\u540e\u6211\u4eec\u53ef\u4ee5\u5728 `docker ps` \u4e2d\u770b\u5230\u8fd9\u4e24\u4e2a\u7aef\u53e3\u5df2\u7ecf\u6210\u529f\u7684\u6253\u5f00\u3002\n\n```\n$ sudo docker ps \nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                       NAMES\n3c4e645f21d7        mysql:5.7           \"docker-entrypoint.s\u2026\"   4 seconds ago       Up 3 seconds        3306/tcp, 13306/tcp, 23306/tcp, 33060/tcp   mysql\n\n```\n\n\u5bb9\u5668\u66b4\u9732\u4e86\u7aef\u53e3\u53ea\u662f\u7c7b\u4f3c\u6211\u4eec\u6253\u5f00\u4e86\u5bb9\u5668\u7684\u9632\u706b\u5899\uff0c\u5177\u4f53\u80fd\u4e0d\u80fd\u901a\u8fc7\u8fd9\u4e2a\u7aef\u53e3\u8bbf\u95ee\u5bb9\u5668\u4e2d\u7684\u670d\u52a1\uff0c\u8fd8\u9700\u8981\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u76d1\u542c\u5e76\u5904\u7406\u6765\u81ea\u8fd9\u4e2a\u7aef\u53e3\u7684\u8bf7\u6c42\u3002\n\n### \u901a\u8fc7\u522b\u540d\u8fde\u63a5\n\n\u7eaf\u7cb9\u7684\u901a\u8fc7\u5bb9\u5668\u540d\u6765\u6253\u5f00\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\u901a\u9053\u7f3a\u4e4f\u4e00\u5b9a\u7684\u7075\u6d3b\u6027\uff0c\u5728 Docker \u91cc\u8fd8\u652f\u6301\u8fde\u63a5\u65f6\u4f7f\u7528\u522b\u540d\u6765\u4f7f\u6211\u4eec\u6446\u8131\u5bb9\u5668\u540d\u7684\u9650\u5236\u3002\n\n```\n$ sudo docker run -d --name webapp --link mysql:database webapp:latest\n\n```\n\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u4f7f\u7528 `--link <name>:<alias>` \u7684\u5f62\u5f0f\uff0c\u8fde\u63a5\u5230 MySQL \u5bb9\u5668\uff0c\u5e76\u8bbe\u7f6e\u5b83\u7684\u522b\u540d\u4e3a database\u3002\u5f53\u6211\u4eec\u8981\u5728 Web \u5e94\u7528\u4e2d\u4f7f\u7528 MySQL \u8fde\u63a5\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 database \u6765\u4ee3\u66ff\u8fde\u63a5\u5730\u5740\u4e86\u3002\n\n```\nString url = \"jdbc:mysql://database:3306/webapp\";\n\n```\n\n## \u7ba1\u7406\u7f51\u7edc\n\n\u5bb9\u5668\u80fd\u591f\u4e92\u76f8\u8fde\u63a5\u7684\u524d\u63d0\u662f\u4e24\u8005\u540c\u5904\u4e8e\u4e00\u4e2a\u7f51\u7edc\u4e2d ( \u8fd9\u91cc\u7684\u7f51\u7edc\u662f\u6307\u5bb9\u5668\u7f51\u7edc\u6a21\u578b\u4e2d\u7684\u7f51\u7edc )\u3002\u8fd9\u4e2a\u9650\u5236\u5f88\u597d\u7406\u89e3\uff0c\u521a\u624d\u6211\u4eec\u8bf4\u4e86\uff0c\u7f51\u7edc\u8fd9\u4e2a\u6982\u5ff5\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a Docker \u6240\u865a\u62df\u7684\u5b50\u7f51\uff0c\u800c\u5bb9\u5668\u7f51\u7edc\u6c99\u76d2\u53ef\u4ee5\u770b\u505a\u662f\u865a\u62df\u7684\u4e3b\u673a\uff0c\u53ea\u6709\u5f53\u591a\u4e2a\u4e3b\u673a\u5728\u540c\u4e00\u5b50\u7f51\u91cc\u65f6\uff0c\u624d\u80fd\u4e92\u76f8\u770b\u5230\u5e76\u8fdb\u884c\u7f51\u7edc\u6570\u636e\u4ea4\u6362\u3002\n\n\u5f53\u6211\u4eec\u542f\u52a8 Docker \u670d\u52a1\u65f6\uff0c\u5b83\u4f1a\u4e3a\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u7684 bridge \u7f51\u7edc\uff0c\u800c\u6211\u4eec\u521b\u5efa\u7684\u5bb9\u5668\u5728\u4e0d\u4e13\u95e8\u6307\u5b9a\u7f51\u7edc\u7684\u60c5\u51b5\u4e0b\u90fd\u4f1a\u8fde\u63a5\u5230\u8fd9\u4e2a\u7f51\u7edc\u4e0a\u3002\u6240\u4ee5\u6211\u4eec\u521a\u624d\u4e4b\u6240\u4ee5\u80fd\u591f\u628a webapp \u5bb9\u5668\u8fde\u63a5\u5230 mysql \u5bb9\u5668\u4e0a\uff0c\u5176\u539f\u56e0\u662f\u4e24\u8005\u90fd\u5904\u4e8e bridge \u8fd9\u4e2a\u7f51\u7edc\u4e0a\u3002\n\n\u6211\u4eec\u901a\u8fc7 `docker inspect` \u547d\u4ee4\u67e5\u770b\u5bb9\u5668\uff0c\u53ef\u4ee5\u5728 Network \u90e8\u5206\u770b\u5230\u5bb9\u5668\u7f51\u7edc\u76f8\u5173\u7684\u4fe1\u606f\u3002\n\n```\n$ sudo docker inspect mysql\n[\n    {\n## ......\n        \"NetworkSettings\": {\n## ......\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"bc14eb1da66b67c7d155d6c78cb5389d4ffa6c719c8be3280628b7b54617441b\",\n                    \"EndpointID\": \"1e201db6858341d326be4510971b2f81f0f85ebd09b9b168e1df61bab18a6f22\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.2\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:02\",\n                    \"DriverOpts\": null\n                }\n            }\n## ......\n        }\n## ......\n    }\n]\n\n```\n\n\u8fd9\u91cc\u6211\u4eec\u80fd\u591f\u770b\u5230 mysql \u5bb9\u5668\u5728 bridge \u7f51\u7edc\u4e2d\u6240\u5206\u914d\u7684 IP \u5730\u5740\uff0c\u5176\u81ea\u8eab\u7684\u7aef\u70b9\u3001Mac \u5730\u5740\uff0cbridge \u7f51\u7edc\u7684\u7f51\u5173\u5730\u5740\u7b49\u4fe1\u606f\u3002\n\nDocker \u9ed8\u8ba4\u521b\u5efa\u7684\u8fd9\u4e2a bridge \u7f51\u7edc\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u7406\u7531\u81ea\u7136\u662f\u5728\u6ca1\u6709\u660e\u786e\u6307\u5b9a\u5bb9\u5668\u7f51\u7edc\u65f6\uff0c\u5bb9\u5668\u90fd\u4f1a\u8fde\u63a5\u5230\u8fd9\u4e2a\u7f51\u7edc\u4e2d\u3002\u5728\u4e4b\u524d\u8bb2\u89e3 Docker for Win \u548c Docker for Mac \u5b89\u88c5\u7684\u65f6\u5019\uff0c\u6211\u4eec\u63d0\u5230\u8fc7\u8fd9\u4e24\u4e2a\u8f6f\u4ef6\u7684\u914d\u7f6e\u4e2d\u90fd\u6709\u4e00\u5757\u914d\u7f6e Docker \u4e2d\u9ed8\u8ba4\u7f51\u7edc\u7684\u5185\u5bb9\uff0c\u8fd9\u5757\u6240\u6307\u7684\u9ed8\u8ba4\u7f51\u7edc\u5c31\u662f\u8fd9\u4e2a bridge \u7f51\u7edc\u3002\n\n### \u521b\u5efa\u7f51\u7edc\n\n\u5728 Docker \u91cc\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u521b\u5efa\u7f51\u7edc\uff0c\u5f62\u6210\u81ea\u5df1\u5b9a\u4e49\u865a\u62df\u5b50\u7f51\u7684\u76ee\u7684\u3002\n\ndocker CLI \u91cc\u4e0e\u7f51\u7edc\u76f8\u5173\u7684\u547d\u4ee4\u90fd\u4ee5 `docker network` \u5f00\u5934\uff0c\u5176\u4e2d\u521b\u5efa\u7f51\u7edc\u7684\u547d\u4ee4\u662f `docker network create`\u3002\n\n```\n$ sudo docker network create -d bridge individual\n\n```\n\n\u901a\u8fc7 `-d` \u9009\u9879\u6211\u4eec\u53ef\u4ee5\u4e3a\u65b0\u7684\u7f51\u7edc\u6307\u5b9a\u9a71\u52a8\u7684\u7c7b\u578b\uff0c\u5176\u503c\u53ef\u4ee5\u662f\u521a\u624d\u6211\u4eec\u6240\u63d0\u53ca\u7684 bridge\u3001host\u3001overlay\u3001maclan\u3001none\uff0c\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u7f51\u7edc\u9a71\u52a8\u63d2\u4ef6\u6240\u5b9a\u4e49\u7684\u7c7b\u578b\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u7684\u662f Bridge Driver ( \u5f53\u6211\u4eec\u4e0d\u6307\u5b9a\u7f51\u7edc\u9a71\u52a8\u65f6\uff0cDocker \u4e5f\u4f1a\u9ed8\u8ba4\u91c7\u7528 Bridge Driver \u4f5c\u4e3a\u7f51\u7edc\u9a71\u52a8 )\u3002\n\n\u901a\u8fc7 `docker network ls` \u6216\u662f `docker network list` \u53ef\u4ee5\u67e5\u770b Docker \u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u7f51\u7edc\u3002\n\n```\n$ sudo docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nbc14eb1da66b        bridge              bridge              local\n35c3ef1cc27d        individual          bridge              local\n\n```\n\n\u4e4b\u540e\u5728\u6211\u4eec\u521b\u5efa\u5bb9\u5668\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 `--network` \u6765\u6307\u5b9a\u5bb9\u5668\u6240\u52a0\u5165\u7684\u7f51\u7edc\uff0c\u4e00\u65e6\u8fd9\u4e2a\u53c2\u6570\u88ab\u6307\u5b9a\uff0c\u5bb9\u5668\u4fbf\u4e0d\u4f1a\u9ed8\u8ba4\u52a0\u5165\u5230 bridge \u8fd9\u4e2a\u7f51\u7edc\u4e2d\u4e86 ( \u4f46\u662f\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7 `--network bridge` \u8ba9\u5176\u52a0\u5165 )\u3002\n\n```\n$ sudo docker run -d --name mysql -e MYSQL_RANDOM_ROOT_PASSWORD=yes --network individual mysql:5.7\n\n```\n\n\u6211\u4eec\u901a\u8fc7 `docker inspect` \u89c2\u5bdf\u4e00\u4e0b\u6b64\u65f6\u7684\u5bb9\u5668\u7f51\u7edc\u3002\n\n```\n$ sudo docker inspect mysql\n[\n    {\n## ......\n        \"NetworkSettings\": {\n## ......\n            \"Networks\": {\n                \"individual\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": [\n                        \"2ad678e6d110\"\n                    ],\n                    \"NetworkID\": \"35c3ef1cc27d24e15a2b22bdd606dc28e58f0593ead6a57da34a8ed989b1b15d\",\n                    \"EndpointID\": \"41a2345b913a45c3c5aae258776fcd1be03b812403e249f96b161e50d66595ab\",\n                    \"Gateway\": \"172.18.0.1\",\n                    \"IPAddress\": \"172.18.0.2\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:12:00:02\",\n                    \"DriverOpts\": null\n                }\n            }\n## ......\n        }\n## ......\n    }\n]\n\n```\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u5bb9\u5668\u6240\u52a0\u5165\u7f51\u7edc\u5df2\u7ecf\u53d8\u6210\u4e86 individual \u8fd9\u4e2a\u7f51\u7edc\u4e86\u3002\n\n\u8fd9\u65f6\u5019\u6211\u4eec\u901a\u8fc7 `--link` \u8ba9\u5904\u4e8e\u53e6\u5916\u4e00\u4e2a\u7f51\u7edc\u7684\u5bb9\u5668\u8fde\u63a5\u5230\u8fd9\u4e2a\u5bb9\u5668\u4e0a\uff0c\u770b\u770b\u4f1a\u53d1\u751f\u4ec0\u4e48\u6837\u7684\u6548\u679c\u3002\n\n```\n$ sudo docker run -d --name webapp --link mysql --network bridge webapp:latest\ndocker: Error response from daemon: Cannot link to /mysql, as it does not belong to the default network.\nERRO[0000] error waiting for container: context canceled\n\n```\n\n\u53ef\u4ee5\u770b\u5230\u5bb9\u5668\u5e76\u4e0d\u80fd\u6b63\u5e38\u7684\u542f\u52a8\uff0c\u800c Docker \u63d0\u9192\u6211\u4eec\u4e24\u4e2a\u5bb9\u5668\u5904\u4e8e\u4e0d\u540c\u7684\u7f51\u7edc\uff0c\u4e4b\u95f4\u662f\u4e0d\u80fd\u76f8\u4e92\u8fde\u63a5\u5f15\u7528\u7684\u3002\n\n\u6211\u4eec\u6765\u6539\u53d8\u4e00\u4e0b\uff0c\u8ba9\u8fd0\u884c Web \u5e94\u7528\u7684\u5bb9\u5668\u52a0\u5165\u5230 individual \u8fd9\u4e2a\u7f51\u7edc\uff0c\u5c31\u53ef\u4ee5\u6210\u529f\u5efa\u7acb\u5bb9\u5668\u95f4\u7684\u7f51\u7edc\u8fde\u63a5\u4e86\u3002\n\n```\n$ sudo docker run -d --name webapp --link mysql --network individual webapp:latest\n\n```\n\n## \u7aef\u53e3\u6620\u5c04\n\n\u521a\u624d\u6211\u4eec\u63d0\u53ca\u7684\u90fd\u662f\u5bb9\u5668\u76f4\u63a5\u901a\u8fc7 Docker \u7f51\u7edc\u8fdb\u884c\u7684\u4e92\u76f8\u8bbf\u95ee\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u8fd8\u6709\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u5c31\u662f\u6211\u4eec\u9700\u8981\u5728\u5bb9\u5668\u5916\u901a\u8fc7\u7f51\u7edc\u8bbf\u95ee\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u3002\u6700\u7b80\u5355\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86 Web \u670d\u52a1\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u63d0\u4f9b\u4e00\u79cd\u65b9\u5f0f\u8bbf\u95ee\u8fd0\u884c\u5728\u5bb9\u5668\u4e2d\u7684 Web \u5e94\u7528\u3002\n\n\u5728 Docker \u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7aef\u53e3\u6620\u5c04\u7684\u529f\u80fd\u5b9e\u73b0\u8fd9\u6837\u7684\u9700\u6c42\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/23/16605128077de72a?w=1420&h=599&f=png&s=65191)\n\n\u901a\u8fc7 Docker \u7aef\u53e3\u6620\u5c04\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5bb9\u5668\u7684\u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u7aef\u53e3\u4e0a\uff0c\u5f53\u6211\u4eec\u4ece\u5916\u90e8\u8bbf\u95ee\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u7aef\u53e3\u65f6\uff0c\u6570\u636e\u8bf7\u6c42\u5c31\u4f1a\u81ea\u52a8\u53d1\u9001\u7ed9\u4e0e\u4e4b\u5173\u8054\u7684\u5bb9\u5668\u7aef\u53e3\u3002\n\n\u8981\u6620\u5c04\u7aef\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u521b\u5efa\u5bb9\u5668\u65f6\u4f7f\u7528 `-p` \u6216\u8005\u662f `--publish` \u9009\u9879\u3002\n\n```\n$ sudo docker run -d --name nginx -p 80:80 -p 443:443 nginx:1.12\n\n```\n\n\u4f7f\u7528\u7aef\u53e3\u6620\u5c04\u9009\u9879\u7684\u683c\u5f0f\u662f `-p <ip>:<host-port>:<container-port>`\uff0c\u5176\u4e2d ip \u662f\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u76d1\u542c ip\uff0c\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u76d1\u542c\u7684\u7f51\u5361\uff0c\u9ed8\u8ba4\u4e3a 0.0.0.0\uff0c\u4e5f\u5c31\u662f\u76d1\u542c\u6240\u6709\u7f51\u5361\u3002host-port \u548c container-port \u5206\u522b\u8868\u793a\u6620\u5c04\u5230\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u7aef\u53e3\u548c\u5bb9\u5668\u7684\u7aef\u53e3\uff0c\u8fd9\u4e24\u8005\u662f\u53ef\u4ee5\u4e0d\u4e00\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5bb9\u5668\u7684 80 \u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684 8080 \u7aef\u53e3\uff0c\u4f20\u5165 `-p 8080:80` \u5373\u53ef\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5728\u5bb9\u5668\u5217\u8868\u91cc\u770b\u5230\u7aef\u53e3\u6620\u5c04\u7684\u914d\u7f6e\u3002\n\n```\n$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                      NAMES\nbc79fc5d42a6        nginx:1.12          \"nginx -g 'daemon of\u2026\"   4 seconds ago       Up 2 seconds        0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp   nginx\n\n```\n\n\u6253\u5370\u7684\u7ed3\u679c\u91cc\u7528 `->` \u6807\u8bb0\u4e86\u7aef\u53e3\u7684\u6620\u5c04\u5173\u7cfb\u3002\n\n### \u5728 Windows \u548c macOS \u4e2d\u4f7f\u7528\u6620\u5c04\n\nDocker \u7684\u7aef\u53e3\u6620\u5c04\u529f\u80fd\u662f\u5c06\u5bb9\u5668\u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u7684\u7aef\u53e3\u4e0a\uff0c\u5b9e\u9645\u6765\u8bf4\u5c31\u662f\u6620\u5c04\u5230\u4e86 Linux \u7cfb\u7edf\u7684\u7aef\u53e3\u4e0a\u3002\u800c\u6211\u4eec\u77e5\u9053\uff0c\u5728 Windows \u548c macOS \u4e2d\u8fd0\u884c\u7684 Docker\uff0c\u5176 Linux \u73af\u5883\u662f\u88ab\u865a\u62df\u51fa\u6765\u7684\uff0c\u5982\u679c\u6211\u4eec\u4ec5\u4ec5\u662f\u5c06\u7aef\u53e3\u6620\u5c04\u5230 Linux \u4e0a\uff0c\u7531\u4e8e\u865a\u62df\u73af\u5883\u8fd8\u6709\u4e00\u5c42\u9694\u79bb\uff0c\u6211\u4eec\u4f9d\u7136\u4e0d\u80fd\u901a\u8fc7 Windows \u6216 macOS \u7684\u7aef\u53e3\u6765\u8bbf\u95ee\u5bb9\u5668\u3002\n\n\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\u7684\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u518d\u52a0\u4e00\u6b21\u6620\u5c04\uff0c\u5c06\u865a\u62df Linux \u7cfb\u7edf\u4e2d\u7684\u7aef\u53e3\u6620\u5c04\u5230 Windows \u6216 macOS \u7684\u7aef\u53e3\u5373\u53ef\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/23/166053965573b1f4)\n\n\u5982\u679c\u6211\u4eec\u4f7f\u7528 Docker for Windows \u6216 Docker for Mac\uff0c\u8fd9\u4e2a\u7aef\u53e3\u6620\u5c04\u7684\u64cd\u4f5c\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u989d\u5916\u7684\u4e8b\u60c5\uff0c\u5c31\u80fd\u591f\u76f4\u63a5\u4f7f\u7528 Windows \u6216 macOS \u7684\u7aef\u53e3\u8bbf\u95ee\u5bb9\u5668\u7aef\u53e3\u4e86\u3002\n\n\u800c\u5f53\u6211\u4eec\u4f7f\u7528 Docker Toolbox \u65f6\uff0c\u7531\u4e8e\u5176\u81ea\u52a8\u5316\u80fd\u529b\u6bd4\u8f83\u5dee\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u5728 VirtualBox \u91cc\u5355\u72ec\u914d\u7f6e\u8fd9\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7aef\u53e3\u5230 Linux \u7aef\u53e3\u7684\u6620\u5c04\u5173\u7cfb\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/23/166053d78b8b1f5c?w=644&h=392&f=png&s=79314)\n\n\u5728 VirtualBox \u914d\u7f6e\u4e2d\u7684\u7aef\u53e3\u8f6c\u53d1\u4e00\u680f\u91cc\uff0c\u8fdb\u884c\u76f8\u5173\u7684\u914d\u7f6e\u5373\u53ef\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u4e86\u89e3\u4e86 Docker \u7f51\u7edc\u76f8\u5173\u7684\u77e5\u8bc6\u548c\u64cd\u4f5c\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> \u901a\u8fc7 Docker \u7f51\u7edc\u8fdb\u884c\u7684\u5bb9\u5668\u4e92\u8054\uff0c\u4e0e\u901a\u8fc7\u5bbf\u4e3b\u673a\u8fdb\u884c\u7aef\u53e3\u6620\u5c04\u7684\u5bb9\u5668\u4e92\u8054\u6709\u600e\u6837\u7684\u533a\u522b\uff0c\u53c8\u5404\u6709\u600e\u6837\u7684\u4f18\u52a3\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u5bb9\u5668\u7f51\u7edc\u7684\u6982\u5ff5\u6216\u8005\u4f7f\u7528\u65b9\u6cd5\u8fd8\u6709\u4ec0\u4e48\u4e0d\u89e3\u4e4b\u5904\uff0c\u6216\u8005\u5bf9\u5176\u6709\u72ec\u7279\u7684\u89c1\u89e3\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u4f7f\u7528\u5bb9\u5668\u4e3a\u5bb9\u5668\u914d\u7f6e\u7f51\u7edc.md", "create_date": "2020-02-18T21:18:39.181", "order": 9}}, {"model": "subject.chapter", "pk": 72, "fields": {"title": "\u4f7f\u7528\u5bb9\u5668\uff1a\u8fd0\u884c\u548c\u7ba1\u7406\u5bb9\u5668", "topic": 3, "md5": "384c33bf7d7807856b1c4dc97c4fd81d", "md_body": "# \u8fd0\u884c\u548c\u7ba1\u7406\u5bb9\u5668\n\n\u5bb9\u5668\u662f\u57fa\u4e8e\u5bb9\u5668\u6280\u672f\u6240\u5efa\u7acb\u548c\u8fd0\u884c\u7684\u8f7b\u91cf\u7ea7\u5e94\u7528\u8fd0\u884c\u73af\u5883\uff0c\u5b83\u662f Docker \u5c01\u88c5\u548c\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u6216\u5fae\u670d\u52a1\u7684\u201c\u96c6\u88c5\u7bb1\u201d\u3002\u5728 Docker \u4e2d\uff0c\u5bb9\u5668\u7b97\u662f\u6700\u6838\u5fc3\u7684\u90e8\u5206\u4e86\uff0c\u638c\u63e1\u5bb9\u5668\u7684\u64cd\u4f5c\u4e5f\u662f Docker \u4e2d\u6700\u57fa\u7840\u7684\u6280\u80fd\u4e86\u3002\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u4f1a\u6df1\u5165\u4e86\u89e3\u5bb9\u5668\uff0c\u5c55\u793a\u5173\u4e8e\u5bb9\u5668\u7684\u64cd\u4f5c\u3002\n\n## \u5bb9\u5668\u7684\u521b\u5efa\u548c\u542f\u52a8\n\n\u5728\u4e86\u89e3\u5bb9\u5668\u7684\u5404\u9879\u64cd\u4f5c\u4e4b\u524d\uff0c\u6211\u4eec\u518d\u6765\u56de\u987e\u4e00\u4e0b\u4e4b\u524d\u6211\u4eec\u6240\u63d0\u53ca\u7684\u5bb9\u5668\u72b6\u6001\u6d41\u8f6c\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/17/165e53743e730432?w=1829&h=932&f=png&s=215394)\n\n\u5728\u8fd9\u5e45\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0cDocker \u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\u91cc\u5206\u4e3a\u4e94\u79cd\u72b6\u6001\uff0c\u5176\u5206\u522b\u4ee3\u8868\u7740\uff1a\n\n*   **Created**\uff1a\u5bb9\u5668\u5df2\u7ecf\u88ab\u521b\u5efa\uff0c\u5bb9\u5668\u6240\u9700\u7684\u76f8\u5173\u8d44\u6e90\u5df2\u7ecf\u51c6\u5907\u5c31\u7eea\uff0c\u4f46\u5bb9\u5668\u4e2d\u7684\u7a0b\u5e8f\u8fd8\u672a\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u3002\n*   **Running**\uff1a\u5bb9\u5668\u6b63\u5728\u8fd0\u884c\uff0c\u4e5f\u5c31\u662f\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u6b63\u5728\u8fd0\u884c\u3002\n*   **Paused**\uff1a\u5bb9\u5668\u5df2\u6682\u505c\uff0c\u8868\u793a\u5bb9\u5668\u4e2d\u7684\u6240\u6709\u7a0b\u5e8f\u90fd\u5904\u4e8e\u6682\u505c ( \u4e0d\u662f\u505c\u6b62 ) \u72b6\u6001\u3002\n*   **Stopped**\uff1a\u5bb9\u5668\u5904\u4e8e\u505c\u6b62\u72b6\u6001\uff0c\u5360\u7528\u7684\u8d44\u6e90\u548c\u6c99\u76d2\u73af\u5883\u90fd\u4f9d\u7136\u5b58\u5728\uff0c\u53ea\u662f\u5bb9\u5668\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u5747\u5df2\u505c\u6b62\u3002\n*   **Deleted**\uff1a\u5bb9\u5668\u5df2\u5220\u9664\uff0c\u76f8\u5173\u5360\u7528\u7684\u8d44\u6e90\u53ca\u5b58\u50a8\u5728 Docker \u4e2d\u7684\u7ba1\u7406\u4fe1\u606f\u4e5f\u90fd\u5df2\u91ca\u653e\u548c\u79fb\u9664\u3002\n\n### \u521b\u5efa\u5bb9\u5668\n\n\u5f53\u6211\u4eec\u9009\u62e9\u597d\u955c\u50cf\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 `docker create` \u8fd9\u4e2a\u547d\u4ee4\u6765\u521b\u5efa\u5bb9\u5668\u4e86\u3002\n\n```\n$ sudo docker create nginx:1.12\n34f277e22be252b51d204acbb32ce21181df86520de0c337a835de6932ca06c3\n\n```\n\n\u6267\u884c `docker create` \u540e\uff0cDocker \u4f1a\u6839\u636e\u6211\u4eec\u6240\u7ed9\u51fa\u7684\u955c\u50cf\u521b\u5efa\u5bb9\u5668\uff0c\u5728\u63a7\u5236\u53f0\u4e2d\u4f1a\u6253\u5370\u51fa Docker \u4e3a\u5bb9\u5668\u6240\u5206\u914d\u7684\u5bb9\u5668 ID\uff0c\u6b64\u65f6\u5bb9\u5668\u662f\u5904\u4e8e Created \u72b6\u6001\u7684\u3002\n\n\u4e4b\u540e\u6211\u4eec\u5bf9\u5bb9\u5668\u7684\u64cd\u4f5c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u5bb9\u5668 ID \u6216\u8005\u5b83\u7684\u7f29\u7565\u5f62\u5f0f\u8fdb\u884c\uff0c\u4f46\u7528\u5bb9\u5668 ID \u64cd\u4f5c\u5bb9\u5668\u5c31\u548c\u7528\u955c\u50cf ID \u64cd\u4f5c\u955c\u50cf\u4e00\u6837\u70e6\u95f7\uff0c\u6240\u4ee5\u6211\u4eec\u66f4\u4e60\u60ef\u4e8e\u4f7f\u7528\u5bb9\u5668\u540d\u6765\u64cd\u4f5c\u5bb9\u5668\u3002\n\n\u8981\u4f7f\u7528\u5bb9\u5668\u540d\u64cd\u4f5c\u5bb9\u5668\uff0c\u5c31\u5148\u5f97\u7ed9\u5bb9\u5668\u547d\u540d\uff0c\u5728\u521b\u5efa\u5bb9\u5668\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `--name` \u8fd9\u4e2a\u9009\u9879\u6765\u914d\u7f6e\u5bb9\u5668\u540d\u3002\n\n```\n$ sudo docker create --name nginx nginx:1.12\n\n```\n\n### \u542f\u52a8\u5bb9\u5668\n\n\u901a\u8fc7 `docker create` \u521b\u5efa\u7684\u5bb9\u5668\uff0c\u662f\u5904\u4e8e Created \u72b6\u6001\u7684\uff0c\u5176\u5185\u90e8\u7684\u5e94\u7528\u7a0b\u5e8f\u8fd8\u6ca1\u6709\u542f\u52a8\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u901a\u8fc7 `docker start` \u547d\u4ee4\u6765\u542f\u52a8\u5b83\u3002\n\n```\n$ sudo docker start nginx\n\n```\n\n\u7531\u4e8e\u6211\u4eec\u4e3a\u5bb9\u5668\u6307\u5b9a\u4e86\u540d\u79f0\uff0c\u8fd9\u6837\u7684\u64cd\u4f5c\u4f1a\u66f4\u52a0\u81ea\u7136\uff0c\u6240\u4ee5\u6211\u4eec\u975e\u5e38\u63a8\u8350\u4e3a\u6bcf\u4e2a\u88ab\u521b\u5efa\u7684\u5bb9\u5668\u90fd\u8fdb\u884c\u547d\u540d\u3002\n\n\u5f53\u5bb9\u5668\u542f\u52a8\u540e\uff0c\u5176\u4e2d\u7684\u5e94\u7528\u5c31\u4f1a\u8fd0\u884c\u8d77\u6765\uff0c\u5bb9\u5668\u7684\u51e0\u4e2a\u751f\u547d\u5468\u671f\u4e5f\u4f1a\u7ed1\u5b9a\u5230\u4e86\u8fd9\u4e2a\u5e94\u7528\u4e0a\uff0c\u8fd9\u4e2a\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u63d0\u53ca\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5728\u8d58\u8ff0\u3002\u53ea\u8981\u5e94\u7528\u7a0b\u5e8f\u8fd8\u5728\u8fd0\u884c\uff0c\u90a3\u4e48\u5bb9\u5668\u7684\u72b6\u6001\u5c31\u4f1a\u662f Running\uff0c\u9664\u975e\u8fdb\u884c\u4e00\u4e9b\u4fee\u6539\u5bb9\u5668\u7684\u64cd\u4f5c\u3002\n\n\u5728 Docker \u91cc\uff0c\u8fd8\u5141\u8bb8\u6211\u4eec\u901a\u8fc7 `docker run` \u8fd9\u4e2a\u547d\u4ee4\u5c06 `docker create` \u548c `docker start` \u8fd9\u4e24\u6b65\u64cd\u4f5c\u5408\u6210\u4e3a\u4e00\u6b65\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u5de5\u4f5c\u6548\u7387\u3002\n\n```\n$ sudo docker run --name nginx -d nginx:1.12\n89f2b769498a50f5c35a314ab82300ce9945cbb69da9cda4b022646125db8ca7\n\n```\n\n\u901a\u8fc7 `docker run` \u521b\u5efa\u7684\u5bb9\u5668\uff0c\u5728\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\u4f1a\u76f4\u63a5\u542f\u52a8\u8d77\u6765\uff0c\u4e0d\u9700\u8981\u6211\u4eec\u518d\u4f7f\u7528 `docker start` \u53bb\u542f\u52a8\u4e86\u3002\n\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u901a\u5e38\u6765\u8bf4\u6211\u4eec\u542f\u52a8\u5bb9\u5668\u4f1a\u671f\u671b\u5b83\u8fd0\u884c\u5728\u201c\u540e\u53f0\u201d\uff0c\u800c `docker run` \u5728\u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u4f1a\u91c7\u7528\u201c\u524d\u53f0\u201d\u8fd0\u884c\u8fd9\u79cd\u65b9\u5f0f\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u7684\u63a7\u5236\u53f0\u5c31\u4f1a\u8854\u63a5\u5230\u5bb9\u5668\u4e0a\uff0c\u4e0d\u80fd\u518d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u4e86\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `-d` \u6216 `--detach` \u8fd9\u4e2a\u9009\u9879\u544a\u8bc9 Docker \u5728\u542f\u52a8\u540e\u5c06\u7a0b\u5e8f\u4e0e\u63a7\u5236\u53f0\u5206\u79bb\uff0c\u4f7f\u5176\u8fdb\u5165\u201c\u540e\u53f0\u201d\u8fd0\u884c\u3002\n\n## \u7ba1\u7406\u5bb9\u5668\n\n\u5bb9\u5668\u521b\u5efa\u548c\u542f\u52a8\u540e\uff0c\u9664\u4e86\u5173\u6ce8\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u529f\u80fd\u6b63\u5e38\u5916\uff0c\u6211\u4eec\u4e5f\u4f1a\u5173\u6ce8\u5bb9\u5668\u7684\u72b6\u6001\u7b49\u5185\u5bb9\u3002\n\n\u901a\u8fc7 `docker ps` \u8fd9\u4e2a\u547d\u4ee4\uff0c\u6211\u4eec\u53ef\u4ee5\u7f57\u5217\u51fa Docker \u4e2d\u7684\u5bb9\u5668\u3002\n\n```\n$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n89f2b769498a        nginx:1.12          \"nginx -g 'daemon of\u2026\"   About an hour ago   Up About an hour    80/tcp              nginx\n\n```\n\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c`docker ps` \u5217\u51fa\u7684\u5bb9\u5668\u662f\u5904\u4e8e\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\uff0c\u5982\u679c\u8981\u5217\u51fa\u6240\u6709\u72b6\u6001\u7684\u5bb9\u5668\uff0c\u9700\u8981\u589e\u52a0 `-a` \u6216 `--all` \u9009\u9879\u3002\n\n```\n$ sudo docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n425a0d3cd18b        redis:3.2           \"docker-entrypoint.s\u2026\"   2 minutes ago       Created                                 redis\n89f2b769498a        nginx:1.12          \"nginx -g 'daemon of\u2026\"   About an hour ago   Up About an hour    80/tcp              nginx\n\n```\n\n\u5728 `docker ps` \u7684\u7ed3\u679c\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u51e0\u9879\u5173\u4e8e\u5bb9\u5668\u7684\u4fe1\u606f\u3002\u5176\u4e2d **CONTAINER ID**\u3001**IMAGE**\u3001**CREATED**\u3001**NAMES** \u5927\u5bb6\u90fd\u6bd4\u8f83\u5bb9\u6613\u7406\u89e3\uff0c\u5206\u522b\u8868\u793a\u5bb9\u5668 ID\uff0c\u5bb9\u5668\u6240\u57fa\u4e8e\u7684\u955c\u50cf\uff0c\u5bb9\u5668\u7684\u521b\u5efa\u65f6\u95f4\u548c\u5bb9\u5668\u7684\u540d\u79f0\u3002\n\n\u7ed3\u679c\u4e2d\u7684 **COMMAND** \u8868\u793a\u7684\u662f\u5bb9\u5668\u4e2d\u4e3b\u7a0b\u5e8f ( \u4e5f\u5c31\u662f\u4e0e\u5bb9\u5668\u751f\u547d\u5468\u671f\u6240\u7ed1\u5b9a\u8fdb\u7a0b\u6240\u5173\u8054\u7684\u7a0b\u5e8f ) \u7684\u542f\u52a8\u547d\u4ee4\uff0c\u8fd9\u6761\u547d\u4ee4\u662f\u5728\u955c\u50cf\u5185\u5b9a\u4e49\u7684\uff0c\u800c\u5bb9\u5668\u7684\u542f\u52a8\u5176\u5b9e\u8d28\u5c31\u662f\u542f\u52a8\u8fd9\u6761\u547d\u4ee4\u3002\u5173\u4e8e COMMAND \u7684\u66f4\u591a\u77e5\u8bc6\uff0c\u6211\u4eec\u5728\u4e4b\u540e\u7684 Docker \u955c\u50cf\u5236\u4f5c\u4e2d\u4f1a\u66f4\u8be6\u7ec6\u7684\u89e3\u8bfb\u3002\n\n\u7ed3\u679c\u4e2d\u7684 **STATUS** \u8868\u793a\u5bb9\u5668\u6240\u5904\u7684\u72b6\u6001\uff0c\u5176\u503c\u548c\u6211\u4eec\u4e4b\u524d\u6240\u8c08\u5230\u7684\u72b6\u6001\u6709\u6240\u533a\u522b\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u8fd9\u91cc\u8fd8\u8bb0\u5f55\u4e86\u5176\u4ed6\u7684\u4e00\u4e9b\u4fe1\u606f\u3002\u5728\u8fd9\u91cc\uff0c\u5e38\u89c1\u7684\u72b6\u6001\u8868\u793a\u6709\u4e09\u79cd\uff1a\n\n*   **Created** \u6b64\u65f6\u5bb9\u5668\u5df2\u521b\u5efa\uff0c\u4f46\u8fd8\u6ca1\u6709\u88ab\u542f\u52a8\u8fc7\u3002\n*   **Up \\[ Time \\]** \u8fd9\u65f6\u5019\u5bb9\u5668\u5904\u4e8e\u6b63\u5728\u8fd0\u884c\u72b6\u6001\uff0c\u800c\u8fd9\u91cc\u7684 Time \u8868\u793a\u5bb9\u5668\u4ece\u5f00\u59cb\u8fd0\u884c\u5230\u67e5\u770b\u65f6\u7684\u65f6\u95f4\u3002\n*   **Exited (\\[ Code \\]) \\[ Time \\]** \u5bb9\u5668\u5df2\u7ecf\u7ed3\u675f\u8fd0\u884c\uff0c\u8fd9\u91cc\u7684 Code \u8868\u793a\u5bb9\u5668\u7ed3\u675f\u8fd0\u884c\u65f6\uff0c\u4e3b\u7a0b\u5e8f\u8fd4\u56de\u7684\u7a0b\u5e8f\u9000\u51fa\u7801\uff0c\u800c Time \u5219\u8868\u793a\u5bb9\u5668\u7ed3\u675f\u5230\u67e5\u770b\u65f6\u7684\u65f6\u95f4\u3002\n\n\u6709\u4e9b\u8bfb\u8005\u6709\u7591\u95ee\uff0c\u65e2\u7136\u662f\u5217\u51fa\u5bb9\u5668\uff0c\u5e94\u8be5\u4e3a\u547d\u4ee4\u53d6\u4e00\u4e9b\u5e26\u6709 `ls` \u5b57\u773c\u7684\u540d\u5b57\uff0c\u4e3a\u5565\u4f1a\u7528\u7c7b\u4f3c Linux \u4e2d\u67e5\u770b\u8fdb\u7a0b\u7684 `ps` \u5462\uff1f\u8fd9\u5176\u5b9e\u6709\u4e00\u90e8\u5206\u5386\u53f2\u539f\u56e0\uff0c\u7531\u4e8e\u5bb9\u5668\u5e76\u975e\u771f\u7684\u5305\u88f9\u4f4f\u4e86\u8fdb\u7a0b\uff0c\u800c\u53ea\u662f\u9694\u79bb\u4e86\u8fdb\u7a0b\uff0c\u8fdb\u7a0b\u8fd8\u662f\u5141\u8bb8\u5728\u5bbf\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u4e0a\u7684\uff0c\u6240\u4ee5\u5217\u51fa\u955c\u50cf\u7684\u8fc7\u7a0b\u5230\u66f4\u65b0\u662f\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u6545\u800c\u6709\u4e86\u8fd9\u6837\u7684\u540d\u5b57\u3002\n\n\u5f53\u7136\uff0c\u5728 Docker \u9010\u6e10\u6210\u719f\u540e\uff0c\u547d\u4ee4\u7684\u547d\u540d\u4e5f\u6ca1\u6709\u539f\u6765\u90a3\u4e48\u968f\u610f\u4e86\uff0c\u5df2\u7ecf\u9010\u6e10\u8f6c\u6362\u4e3a\u4f7f\u7528\u5927\u5bb6\u5e7f\u6cdb\u8ba4\u53ef\u7684\u5f62\u5f0f\u3002\u53ea\u662f `docker ps` \u8fd9\u6761\u547d\u4ee4\uff0c\u8fd8\u4fdd\u7559\u7740\u590d\u53e4\u7684\u98ce\u683c\u3002\n\n### \u505c\u6b62\u548c\u5220\u9664\u5bb9\u5668\n\n\u8981\u5c06\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u505c\u6b62\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `docker stop` \u547d\u4ee4\u3002\n\n```\n$ sudo docker stop nginx\n\n```\n\n\u5bb9\u5668\u505c\u6b62\u540e\uff0c\u5176\u7ef4\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\u6c99\u76d2\u73af\u5883\u8fd8\u662f\u5b58\u5728\u7684\uff0c\u5185\u90e8\u88ab\u4fee\u6539\u7684\u5185\u5bb9\u4e5f\u90fd\u4f1a\u4fdd\u7559\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `docker start` \u547d\u4ee4\u5c06\u8fd9\u4e2a\u5bb9\u5668\u518d\u6b21\u542f\u52a8\u3002\n\n\u5f53\u6211\u4eec\u9700\u8981\u5b8c\u5168\u5220\u9664\u5bb9\u5668\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 `docker rm` \u547d\u4ee4\u5c06\u5bb9\u5668\u8fdb\u884c\u5220\u9664\u3002\n\n```\n$ sudo docker rm nginx\n\n```\n\n\u6b63\u5728\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u4e0d\u80fd\u88ab\u5220\u9664\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0 `-f` \u6216 `--force` \u9009\u9879\u6765\u8ba9 `docker rm` \u5f3a\u5236\u505c\u6b62\u5e76\u5220\u9664\u5bb9\u5668\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u505a\u6cd5\u5e76\u4e0d\u59a5\u5f53\u3002\n\n### \u968f\u624b\u5220\u9664\u5bb9\u5668\n\n\u4e0e\u5176\u4ed6\u865a\u62df\u673a\u4e0d\u540c\uff0cDocker \u7684\u8f7b\u91cf\u7ea7\u5bb9\u5668\u8bbe\u8ba1\uff0c\u8bb2\u7a76\u968f\u7528\u968f\u5f00\uff0c\u968f\u5173\u968f\u5220\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u6211\u4eec\u77ed\u65f6\u95f4\u5185\u4e0d\u9700\u8981\u4f7f\u7528\u5bb9\u5668\u65f6\uff0c\u6700\u4f73\u7684\u505a\u6cd5\u662f\u5220\u9664\u5b83\u800c\u4e0d\u662f\u4ec5\u4ec5\u505c\u6b62\u5b83\u3002\n\n\u6709\u7684\u8bfb\u8005\u4f1a\u95ee\uff0c\u5bb9\u5668\u4e00\u65e6\u5220\u9664\uff0c\u5176\u5185\u90e8\u7684\u6587\u4ef6\u7cfb\u7edf\u53d8\u52a8\u4e5f\u5c31\u6d88\u5931\u4e86\uff0c\u8fd9\u6837\u505a\u5c82\u4e0d\u662f\u975e\u5e38\u9ebb\u70e6\u3002\u8981\u89e3\u51b3\u8fd9\u4e2a\u7591\u60d1\uff0c\u5176\u6839\u672c\u662f\u89e3\u51b3\u4e3a\u4ec0\u4e48\u6211\u4eec\u4f1a\u5bf9\u5bb9\u5668\u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u505a\u66f4\u6539\u3002\u6211\u8fd9\u91cc\u603b\u7ed3\u4e86\u4e24\u4e2a\u5bf9\u865a\u62df\u73af\u5883\u505a\u66f4\u6539\u7684\u539f\u56e0\uff0c\u4ee5\u53ca\u5728 Docker \u4e2d\u5982\u4f55\u4f18\u96c5\u7684\u89e3\u51b3\u5b83\u4eec\u3002\n\n*   \u5728\u4f7f\u7528\u865a\u62df\u673a\u6216\u5176\u4ed6\u865a\u62df\u5316\u6240\u642d\u5efa\u7684\u865a\u62df\u73af\u5883\u65f6\uff0c\u6211\u4eec\u503e\u5411\u4e8e\u4f7f\u7528\u4e00\u4e2a\u5e72\u51c0\u7684\u7cfb\u7edf\u955c\u50cf\u5e76\u642d\u5efa\u7a0b\u5e8f\u7684\u8fd0\u884c\u73af\u5883\uff0c\u7531\u4e8e\u5c06\u8fd9\u7c7b\u865a\u62df\u73af\u5883\u5236\u4f5c\u6210\u955c\u50cf\u7684\u6210\u672c\u8f83\u9ad8\uff0c\u8017\u65f6\u4e5f\u975e\u5e38\u4e45\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u4e00\u4e9b\u7ec6\u5c0f\u7684\u6539\u52a8\u503e\u5411\u4e8e\u4fee\u6539\u540e\u4fdd\u6301\u865a\u62df\u73af\u5883\u4e0d\u88ab\u6e05\u9664\u5373\u53ef\u3002\u800c\u5728 Docker \u4e2d\uff0c\u6253\u5305\u955c\u50cf\u7684\u6210\u672c\u662f\u975e\u5e38\u4f4e\u7684\uff0c\u5176\u901f\u5ea6\u4e5f\u5feb\u5f97\u60ca\u4eba\uff0c\u6240\u4ee5\u5982\u679c\u6211\u4eec\u8981\u4e3a\u7a0b\u5e8f\u51c6\u5907\u4e00\u4e9b\u73af\u5883\u6216\u8005\u914d\u7f6e\uff0c\u5b8c\u5168\u53ef\u4ee5\u76f4\u63a5\u5c06\u5b83\u4eec\u6253\u5305\u81f3\u65b0\u7684\u955c\u50cf\u4e2d\uff0c\u4e0b\u6b21\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u65b0\u7684\u955c\u50cf\u521b\u5efa\u5bb9\u5668\u5373\u53ef\u3002\n    \n*   \u5bb9\u5668\u4e2d\u5e94\u7528\u7a0b\u5e8f\u6240\u4ea7\u751f\u7684\u4e00\u4e9b\u6587\u4ef6\u6570\u636e\uff0c\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u5982\u679c\u8fd9\u4e9b\u6570\u636e\u968f\u7740\u5bb9\u5668\u7684\u5220\u9664\u800c\u4e22\u5931\uff0c\u5176\u635f\u5931\u662f\u975e\u5e38\u5de8\u5927\u7684\u3002\u5bf9\u4e8e\u8fd9\u7c7b\u7531\u5e94\u7528\u7a0b\u5e8f\u6240\u4ea7\u751f\u7684\u6570\u636e\uff0c\u5e76\u4e14\u9700\u8981\u4fdd\u8bc1\u5b83\u4eec\u4e0d\u4f1a\u968f\u7740\u5bb9\u5668\u7684\u5220\u9664\u800c\u6d88\u5931\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Docker \u4e2d\u7684\u6570\u636e\u5377\u6765\u5355\u72ec\u5b58\u653e\u3002\u7531\u4e8e\u6570\u636e\u5377\u662f\u72ec\u7acb\u4e8e\u5bb9\u5668\u5b58\u5728\u7684\uff0c\u6240\u4ee5\u5176\u80fd\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u968f\u7740\u5bb9\u5668\u7684\u5220\u9664\u800c\u4e22\u5931\u3002\u5173\u4e8e\u6570\u636e\u5377\u7684\u5177\u4f53\u4f7f\u7528\uff0c\u5728\u4e4b\u540e\u7684\u5c0f\u8282\u4f1a\u4e13\u95e8\u8bb2\u89e3\u3002\n    \n\n\u89e3\u51b3\u4e86\u8fd9\u4e24\u4e2a\u95ee\u9898\uff0c\u5927\u5bb6\u5fc3\u4e2d\u7684\u7591\u8651\u662f\u4e0d\u662f\u5c31\u5c0f\u4e86\u5f88\u591a\u3002\u800c\u4e8b\u5b9e\u4e0a\uff0c\u5bb9\u5668\u7684\u968f\u7528\u968f\u5220\u65e2\u80fd\u4fdd\u8bc1\u5728\u6211\u4eec\u4e0d\u9700\u8981\u5b83\u4eec\u7684\u65f6\u5019\u5b83\u4eec\u4e0d\u4f1a\u6789\u5360\u5f88\u591a\u8d44\u6e90\uff0c\u4e5f\u4fdd\u8bc1\u4e86\u6bcf\u6b21\u6211\u4eec\u5efa\u7acb\u548c\u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u5b83\u4eec\u90fd\u662f\u201c\u70ed\u4e4e\u201d\u7684\u5d2d\u65b0\u7248\u672c\u3002\u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u7cfb\u7edf\u5361\u5c31\u91cd\u88c5\uff0c\u800c\u501f\u52a9 Docker \u79d2\u7ea7\u7684\u5bb9\u5668\u542f\u505c\u7279\u6027\uff0c\u6211\u4eec\u5c31\u662f\u53ef\u4ee5\u8fd9\u4e48\u4efb\u6027\u7684\u201c\u91cd\u88c5\u201d\u3002\n\n## \u8fdb\u5165\u5bb9\u5668\n\n\u5f88\u591a\u65f6\u95f4\uff0c\u6211\u4eec\u9700\u8981\u7684\u64cd\u4f5c\u5e76\u4e0d\u4ec5\u4ec5\u662f\u6309\u955c\u50cf\u6240\u7ed9\u51fa\u7684\u547d\u4ee4\u542f\u52a8\u5bb9\u5668\u800c\u5df2\uff0c\u6211\u4eec\u8fd8\u4f1a\u5e0c\u671b\u8fdb\u4e00\u6b65\u4e86\u89e3\u5bb9\u5668\u6216\u64cd\u4f5c\u5bb9\u5668\uff0c\u8fd9\u65f6\u5019\u6700\u4f73\u7684\u65b9\u5f0f\u5c31\u662f\u8ba9\u6211\u4eec\u8fdb\u5165\u5230\u5bb9\u5668\u4e86\u3002\n\n\u6211\u4eec\u77e5\u9053\uff0c\u5bb9\u5668\u662f\u4e00\u4e2a\u9694\u79bb\u8fd0\u884c\u73af\u5883\u7684\u4e1c\u897f\uff0c\u5b83\u91cc\u9762\u9664\u4e86\u955c\u50cf\u6240\u89c4\u5b9a\u7684\u4e3b\u8fdb\u7a0b\u5916\uff0c\u5176\u4ed6\u7684\u8fdb\u7a0b\u4e5f\u662f\u80fd\u591f\u8fd0\u884c\u7684\uff0cDocker \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u547d\u4ee4 `docker exec` \u6765\u8ba9\u5bb9\u5668\u8fd0\u884c\u6211\u4eec\u6240\u7ed9\u51fa\u7684\u547d\u4ee4\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u8bd5\u8bd5\u7528\u5bb9\u5668\u4e2d\u7684 `more` \u547d\u4ee4\u67e5\u770b\u5bb9\u5668\u7684\u4e3b\u673a\u540d\u5b9a\u4e49\u3002\n\n```\n$ sudo docker exec nginx more /etc/hostname\n::::::::::::::\n/etc/hostname\n::::::::::::::\n83821ea220ed\n\n```\n\n`docker exec` \u547d\u4ee4\u80fd\u5e2e\u52a9\u6211\u4eec\u5728\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u4e2d\u8fd0\u884c\u6307\u5b9a\u547d\u4ee4\uff0c\u8fd9\u5bf9\u4e8e\u670d\u52a1\u63a7\u5236\uff0c\u8fd0\u7ef4\u76d1\u63a7\u7b49\u6709\u7740\u4e0d\u9519\u7684\u5e94\u7528\u573a\u666f\u3002\u4f46\u662f\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u66f4\u5e38\u4f7f\u7528\u5b83\u6765\u4f5c\u4e3a\u6211\u4eec\u8fdb\u5165\u5bb9\u5668\u7684\u6865\u6881\u3002\n\n\u719f\u6089 Linux \u7684\u670b\u53cb\u4eec\u77e5\u9053\uff0c\u6211\u4eec\u64cd\u4f5c Linux \u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u5e76\u4e0d\u662f Linux \u5185\u90e8\u7684\u67d0\u4e9b\u673a\u80fd\uff0c\u800c\u662f\u901a\u8fc7\u63a7\u5236\u53f0\u8f6f\u4ef6\u6765\u5b8c\u6210\u7684\u3002\u63a7\u5236\u53f0\u8f6f\u4ef6\u5206\u6790\u6211\u4eec\u7684\u547d\u4ee4\uff0c\u5c06\u5176\u8f6c\u5316\u4e3a\u5bf9 Linux \u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u5b9e\u73b0\u4e86\u6211\u4eec\u5bf9 Linux \u7684\u64cd\u4f5c\u3002\u82e5\u4e0d\u662f\u8fd9\u6837\uff0c\u751f\u6da9\u7684\u7cfb\u7edf\u8c03\u7528\u65b9\u6cd5\u5bf9\u666e\u901a\u5f00\u53d1\u8005\u6765\u8bf4\u7b80\u76f4\u5c31\u662f\u9ed1\u6d1e\u4e00\u822c\u7684\u5b58\u5728\uff0c\u66f4\u522b\u63d0\u7528\u5b83\u4eec\u63a7\u5236\u7cfb\u7edf\u4e86\u3002\n\n\u5728 Linux \u4e2d\uff0c\u5927\u5bb6\u719f\u6089\u7684\u63a7\u5236\u53f0\u8f6f\u4ef6\u5e94\u8be5\u662f Shell \u548c Bash \u4e86\uff0c\u5b83\u4eec\u5206\u522b\u7531 sh \u548c bash \u8fd9\u4e24\u4e2a\u7a0b\u5e8f\u542f\u52a8\u3002\n\n\u8bf4\u5230\u8fd9\u91cc\uff0c\u6709\u8bfb\u8005\u4e00\u5b9a\u60f3\u5230\u4e86\uff0c\u65e2\u7136\u6709\u8fd9\u4e24\u4e2a\u63a7\u5236\u53f0\u7a0b\u5e8f\uff0c\u6211\u4eec\u53ea\u8981\u5728\u5bb9\u5668\u91cc\u6267\u884c\u5b83\u4eec\uff0c\u7136\u540e\u901a\u8fc7\u5b83\u4eec\u53bb\u63a7\u5236\u5bb9\u5668\u5185\u7684\u73af\u5883\uff0c\u5c82\u4e0d\u5c31\u53ef\u4ee5\u201c\u81ea\u7531\u7684\u98de\u7fd4\u201d\u4e86\u5417\u3002\u6ca1\u9519\uff0c\u8fd9\u91cc\u8bf4\u7684\u8fdb\u5165\u5bb9\u5668\uff0c\u5c31\u662f\u901a\u8fc7 `docker exec` \u547d\u4ee4\u6765\u542f\u52a8 sh \u6216 bash\uff0c\u5e76\u901a\u8fc7\u5b83\u4eec\u5b9e\u73b0\u5bf9\u5bb9\u5668\u5185\u7684\u865a\u62df\u73af\u5883\u7684\u63a7\u5236\u3002\n\n\u7531\u4e8e bash \u7684\u529f\u80fd\u8981\u6bd4 sh \u4e30\u5bcc\uff0c\u6240\u4ee5\u5728\u80fd\u591f\u4f7f\u7528 bash \u7684\u5bb9\u5668\u91cc\uff0c\u6211\u4eec\u4f18\u5148\u9009\u62e9\u5b83\u4f5c\u4e3a\u63a7\u5236\u53f0\u7a0b\u5e8f\u3002\n\n```\n$ sudo docker exec -it nginx bash\nroot@83821ea220ed:/#\n\n```\n\n\u5728\u501f\u52a9 `docker exec` \u8fdb\u5165\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u7279\u522b\u6ce8\u610f\u547d\u4ee4\u4e2d\u7684\u4e24\u4e2a\u9009\u9879\u4e0d\u53ef\u6216\u7f3a\uff0c\u5373 `-i` \u548c `-t` ( \u5b83\u4eec\u4fe9\u53ef\u4ee5\u5229\u7528\u7b80\u5199\u673a\u5236\u5408\u5e76\u6210 `-it` )\u3002\n\n\u5176\u4e2d `-i` ( `--interactive` ) \u8868\u793a\u4fdd\u6301\u6211\u4eec\u7684\u8f93\u5165\u6d41\uff0c\u53ea\u6709\u4f7f\u7528\u5b83\u624d\u80fd\u4fdd\u8bc1\u63a7\u5236\u53f0\u7a0b\u5e8f\u80fd\u591f\u6b63\u786e\u8bc6\u522b\u6211\u4eec\u7684\u547d\u4ee4\u3002\u800c `-t` ( `--tty` ) \u8868\u793a\u542f\u7528\u4e00\u4e2a\u4f2a\u7ec8\u7aef\uff0c\u5f62\u6210\u6211\u4eec\u4e0e bash \u7684\u4ea4\u4e92\uff0c\u5982\u679c\u6ca1\u6709\u5b83\uff0c\u6211\u4eec\u65e0\u6cd5\u770b\u5230 bash \u5185\u90e8\u7684\u6267\u884c\u7ed3\u679c\u3002\n\n\u719f\u6089\u901a\u8fc7\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u63a7\u5236\u53f0\u7a0b\u5e8f\u8fdb\u800c\u8fdb\u5165\u5bb9\u5668\u8fd9\u79cd\u65b9\u6cd5\uff0c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f60\u80fd\u66f4\u8f7b\u677e\u7684\u89c2\u5bdf\u5bb9\u5668\u4e2d\u53d1\u751f\u4e86\u4ec0\u4e48\uff0c\u4e5f\u66f4\u5bb9\u6613\u6392\u67e5\u7a0b\u5e8f\u6216\u8005\u73af\u5883\u5f15\u8d77\u7684\u95ee\u9898\u3002\n\n### \u8854\u63a5\u5230\u5bb9\u5668\n\nDocker \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a `docker attach` \u547d\u4ee4\uff0c\u7528\u4e8e\u5c06\u5f53\u524d\u7684\u8f93\u5165\u8f93\u51fa\u6d41\u8fde\u63a5\u5230\u6307\u5b9a\u7684\u5bb9\u5668\u4e0a\u3002\n\n```\n$ sudo docker attach nginx\n\n```\n\n\u8fd9\u4e2a\u547d\u4ee4\u6700\u76f4\u89c2\u7684\u6548\u679c\u53ef\u4ee5\u7406\u89e3\u4e3a\u6211\u4eec\u5c06\u5bb9\u5668\u4e2d\u7684\u4e3b\u7a0b\u5e8f\u8f6c\u4e3a\u4e86\u201c\u524d\u53f0\u201d\u8fd0\u884c ( \u4e0e `docker run` \u4e2d\u7684 `-d` \u9009\u9879\u6709\u76f8\u53cd\u7684\u610f\u601d )\u3002\n\n\u7531\u4e8e\u6211\u4eec\u7684\u8f93\u5165\u8f93\u51fa\u6d41\u8854\u63a5\u5230\u4e86\u5bb9\u5668\u7684\u4e3b\u7a0b\u5e8f\u4e0a\uff0c\u6211\u4eec\u7684\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u4e5f\u5c31\u76f4\u63a5\u9488\u5bf9\u4e86\u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u800c\u6211\u4eec\u53d1\u9001\u7684 Linux \u4fe1\u53f7\u4e5f\u4f1a\u8f6c\u79fb\u5230\u8fd9\u4e2a\u7a0b\u5e8f\u4e0a\u3002\u4f8b\u5982\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Ctrl + C \u6765\u5411\u7a0b\u5e8f\u53d1\u9001\u505c\u6b62\u4fe1\u53f7\uff0c\u8ba9\u7a0b\u5e8f\u505c\u6b62 ( \u4ece\u800c\u5bb9\u5668\u4e5f\u4f1a\u968f\u4e4b\u505c\u6b62 )\u3002\n\n\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u7531\u4e8e `docker attach` \u9650\u5236\u8f83\u591a\uff0c\u529f\u80fd\u4e5f\u4e0d\u591f\u5f3a\u5927\uff0c\u6240\u4ee5\u5e76\u6ca1\u6709\u592a\u591a\u7528\u6b66\u4e4b\u5730\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u4e00\u7b14\u5e26\u8fc7\uff0c\u4e0d\u505a\u8be6\u7ec6\u7684\u89e3\u8bfb\u4e86\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5bf9\u5bb9\u5668\u76f8\u5173\u7684\u64cd\u4f5c\u8fdb\u884c\u4e86\u6df1\u5165\u7684\u4e86\u89e3\uff0c\u5bf9\u5bb9\u5668\u7684\u8fd0\u884c\u72b6\u6001\u53ca\u76f8\u5173\u77e5\u8bc6\u505a\u4e86\u4ecb\u7ecd\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u5b9e\u8df5\u9898\uff1a\n\n> \u8bd5\u7740\u521b\u5efa Nginx \u5bb9\u5668\uff0c\u4e4b\u540e\u8fdb\u5165\u5230\u5bb9\u5668\u4e2d\uff0c\u5229\u7528\u76f8\u5173\u547d\u4ee4\u505c\u6b62 Nginx \u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u89c2\u5bdf\u64cd\u4f5c\u4e4b\u540e\u5bb9\u5668\u7684\u72b6\u6001\u53d8\u5316\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u5bb9\u5668\u76f8\u5173\u7684\u64cd\u4f5c\u4e0e\u4f7f\u7528\u8fd8\u6709\u4ec0\u4e48\u4e0d\u7406\u89e3\u7684\u5730\u65b9\uff0c\u6216\u8005\u5bf9\u5176\u6709\u72ec\u7279\u7684\u89c1\u89e3\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u4f7f\u7528\u5bb9\u5668\u8fd0\u884c\u548c\u7ba1\u7406\u5bb9\u5668.md", "create_date": "2020-02-18T21:18:39.198", "order": 8}}, {"model": "subject.chapter", "pk": 73, "fields": {"title": "\u7ec4\u5408\u5e94\u7528\uff1a\u7f16\u5199 Docker Compose \u9879\u76ee", "topic": 3, "md5": "09c8aad0b4646810b32b6a616998a0d8", "md_body": "# \u7f16\u5199 Docker Compose \u9879\u76ee\n\n\u901a\u8fc7\u9605\u8bfb\u4e4b\u524d\u7684\u5c0f\u8282\uff0c\u76f8\u4fe1\u5927\u5bb6\u5bf9 Docker \u5728\u5f00\u53d1\u4e2d\u7684\u5e94\u7528\u5df2\u7ecf\u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\u3002\u4f5c\u4e3a\u4e00\u6b3e\u5b9e\u7528\u7684\u8f6f\u4ef6\uff0c\u6211\u4eec\u5fc5\u987b\u56de\u5f52\u5230\u5b9e\u8df5\u4e2d\u6765\uff0c\u8fd9\u6837\u624d\u80fd\u66f4\u597d\u5730\u7406\u89e3 Docker \u7684\u5b9e\u7528\u903b\u8f91\u548c\u80cc\u540e\u7684\u539f\u7406\u3002\u5728\u8fd9\u4e00\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u5c31\u4e3e\u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50\uff0c\u8ba9\u5927\u5bb6\u8ddf\u968f\u8fd9\u4e2a\u9879\u76ee\u7684\u8109\u7edc\uff0c\u719f\u6089\u5982\u4f55\u901a\u8fc7 Docker \u548c Docker Compose \u6765\u642d\u5efa\u5e94\u7528\u5f00\u53d1\u73af\u5883\u3002\n\n## \u8bbe\u8ba1\u9879\u76ee\u7684\u76ee\u5f55\u7ed3\u6784\n\n\u5728\u8fd9\u4e00\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u4ee5\u4e00\u4e2a\u7531 MySQL\u3001Redis\u3001PHP-FPM \u548c Nginx \u7ec4\u6210\u7684\u5c0f\u578b PHP \u7f51\u7ad9\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u901a\u8fc7 Docker \u642d\u5efa\u8fd0\u884c\u8fd9\u5957\u7a0b\u5e8f\u8fd0\u884c\u73af\u5883\u7684\u65b9\u6cd5\u3002\n\n\u65e2\u7136\u6211\u4eec\u8bf4\u5230\u8fd9\u4e2a\u5c0f\u578b\u7f51\u7ad9\u662f\u7531 MySQL\u3001Redis\u3001PHP-FPM \u548c Nginx \u56db\u6b3e\u8f6f\u4ef6\u6240\u7ec4\u6210\u7684\uff0c\u90a3\u4e48\u81ea\u7136\u5728 Docker \u91cc\uff0c\u6211\u4eec\u8981\u51c6\u5907\u56db\u4e2a\u5bb9\u5668\u5206\u522b\u6765\u8fd0\u884c\u5b83\u4eec\u3002\u800c\u4e3a\u4e86\u66f4\u597d\u5730\u7ba1\u7406\u8fd9\u56db\u4e2a\u5bb9\u5668\u6240\u7ec4\u6210\u7684\u73af\u5883\uff0c\u6211\u4eec\u8fd9\u91cc\u8fd8\u4f1a\u4f7f\u7528\u5230 Docker Compose\u3002\n\n\u4e0e\u642d\u5efa\u4e00\u4e2a\u8f6f\u4ef6\u5f00\u53d1\u9879\u76ee\u7c7b\u4f3c\uff0c\u6211\u4eec\u63d0\u5021\u5c06 Docker Compose \u9879\u76ee\u7684\u7ec4\u6210\u5185\u5bb9\u805a\u96c6\u5230\u4e00\u4e2a\u6587\u4ef6\u76ee\u5f55\u4e2d\uff0c\u8fd9\u6837\u66f4\u5229\u4e8e\u6211\u4eec\u8fdb\u884c\u7ba1\u7406\u548c\u8fc1\u79fb\u3002\n\n\u8fd9\u91cc\u6211\u5df2\u7ecf\u5efa\u7acb\u597d\u4e86\u4e00\u4e2a\u76ee\u5f55\u7ed3\u6784\uff0c\u867d\u7136\u6211\u4eec\u5728\u5b9e\u8df5\u7684\u8fc7\u7a0b\u4e2d\u4e0d\u4e00\u5b9a\u8981\u6309\u7167\u8fd9\u6837\u7684\u7ed3\u6784\uff0c\u4f46\u6211\u76f8\u4fe1\u8fd9\u4e2a\u7ed3\u6784\u4e00\u5b9a\u5bf9\u4f60\u6709\u6240\u542f\u53d1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/22/1669c139cbb5b1d8?w=804&h=928&f=png&s=110156)\n\n\u7b80\u5355\u8bf4\u660e\u4e00\u4e0b\u8fd9\u4e2a\u7ed3\u6784\u4e2d\u4e3b\u8981\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u529f\u80fd\u548c\u4f5c\u7528\u3002\u5728\u8fd9\u4e2a\u7ed3\u6784\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6839\u76ee\u5f55\u4e0b\u7684\u51e0\u4e2a\u76ee\u5f55\u5206\u4e3a\u56db\u7c7b\uff1a\n\n*   \u7b2c\u4e00\u7c7b\u662f Docker \u5b9a\u4e49\u76ee\u5f55\uff0c\u4e5f\u5c31\u662f compose \u8fd9\u4e2a\u76ee\u5f55\u3002\u5728\u8fd9\u4e2a\u76ee\u5f55\u91cc\uff0c\u5305\u542b\u4e86 docker-compose.yml \u8fd9\u4e2a\u7528\u4e8e\u5b9a\u4e49 Docker Compose \u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u6b64\u5916\uff0c\u8fd8\u5305\u542b\u4e86\u6211\u4eec\u7528\u4e8e\u6784\u5efa\u81ea\u5b9a\u4e49\u955c\u50cf\u7684\u5185\u5bb9\u3002\n    \n*   \u7b2c\u4e8c\u7c7b\u662f\u7a0b\u5e8f\u6587\u4ef6\u76ee\u5f55\uff0c\u5728\u8fd9\u4e2a\u9879\u76ee\u91cc\u662f mysql\u3001nginx\u3001phpfpm\u3001redis \u8fd9\u56db\u4e2a\u76ee\u5f55\u3002\u8fd9\u4e9b\u76ee\u5f55\u5206\u522b\u5bf9\u5e94\u7740 Docker Compose \u4e2d\u5b9a\u4e49\u7684\u670d\u52a1\uff0c\u5728\u5176\u4e2d\u4e3b\u8981\u5b58\u653e\u5bf9\u5e94\u7a0b\u5e8f\u7684\u914d\u7f6e\uff0c\u4ea7\u751f\u7684\u6570\u636e\u6216\u65e5\u5fd7\u7b49\u5185\u5bb9\u3002\n    \n*   \u7b2c\u4e09\u7c7b\u662f\u4ee3\u7801\u76ee\u5f55\uff0c\u5728\u8fd9\u4e2a\u9879\u76ee\u4e2d\u5c31\u662f\u5b58\u653e Web \u7a0b\u5e8f\u7684 website \u76ee\u5f55\u3002\u6211\u4eec\u5c06\u4ee3\u7801\u7edf\u4e00\u653e\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e2d\uff0c\u65b9\u4fbf\u5728\u5bb9\u5668\u4e2d\u6302\u8f7d\u3002\n    \n*   \u7b2c\u56db\u7c7b\u662f\u5de5\u5177\u547d\u4ee4\u76ee\u5f55\uff0c\u8fd9\u91cc\u6307 bin \u8fd9\u4e2a\u76ee\u5f55\u3002\u6211\u4eec\u5728\u8fd9\u91cc\u5b58\u653e\u4e00\u4e9b\u81ea\u5df1\u7f16\u5199\u7684\u547d\u4ee4\u811a\u672c\uff0c\u6211\u4eec\u901a\u8fc7\u8fd9\u4e9b\u811a\u672c\u53ef\u4ee5\u66f4\u7b80\u6d01\u5730\u64cd\u4f5c\u6574\u4e2a\u9879\u76ee\u3002\n    \n\n## \u7f16\u5199 Docker Compose \u914d\u7f6e\u6587\u4ef6\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u7f16\u5199 docker-compose.yml \u6587\u4ef6\u6765\u5b9a\u4e49\u7ec4\u6210\u8fd9\u4e2a\u73af\u5883\u7684\u6240\u6709 Docker \u5bb9\u5668\u4ee5\u53ca\u4e0e\u5b83\u4eec\u76f8\u5173\u7684\u5185\u5bb9\u4e86\u3002docker-compose.yml \u89c4\u5219\u548c\u7f16\u5199\u7684\u65b9\u6cd5\u5728\u524d\u4e24\u5c0f\u8282\u4e2d\u5df2\u7ecf\u8c08\u5230\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u4e0d\u518d\u5c55\u5f00\uff0c\u76f4\u63a5\u6765\u770b\u770b\u7f16\u5199\u597d\u7684 docker-compose.yml \u914d\u7f6e\u6587\u4ef6\u3002\n\n```\nversion: \"3\"\n\nnetworks:\n  frontend:\n  backend:\n\nservices:\n\n  redis:\n    image: redis:3.2\n    networks:\n      - backend\n    volumes:\n      - ../redis/redis.conf:/etc/redis/redis.conf:ro\n      - ../redis/data:/data\n    command: [\"redis-server\", \"/etc/redis/redis.conf\"]\n    ports:\n      - \"6379:6379\"\n\n  mysql:\n    image: mysql:5.7\n    networks:\n      - backend\n    volumes:\n      - ../mysql/my.cnf:/etc/mysql/my.cnf:ro\n      - ../mysql/data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: my-secret-pw\n    ports:\n      - \"3306:3306\"\n\n  phpfpm:\n    build: ./phpfpm\n    networks:\n      - frontend\n      - backend\n    volumes:\n      - ../phpfpm/php.ini:/usr/local/etc/php/php.ini:ro\n      - ../phpfpm/php-fpm.conf:/usr/local/etc/php-fpm.conf:ro\n      - ../phpfpm/php-fpm.d:/usr/local/etc/php-fpm.d:ro\n      - ../phpfpm/crontab:/etc/crontab:ro\n      - ../website:/website\n    depends_on:\n      - redis\n      - mysql\n  \n  nginx:\n    image: nginx:1.12\n    networks:\n      - frontend\n    volumes:\n      - ../nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ../nginx/conf.d:/etc/nginx/conf.d:ro\n      - ../website:/website\n    depends_on:\n      - phpfpm\n    ports:\n      - \"80:80\"\n\n```\n\n\u4f7f\u7528\u5408\u9002\u7684\u955c\u50cf\u662f\u63d0\u9ad8\u5de5\u4f5c\u6548\u7387\u7684\u9014\u5f84\u4e4b\u4e00\uff0c\u8fd9\u91cc\u8bb2\u89e3\u4e00\u4e0b\u6211\u4eec\u5728\u8fd9\u4e2a\u9879\u76ee\u4e2d\u9009\u62e9\u955c\u50cf\u7684\u539f\u7531\u3002\n\n\u5728\u8fd9\u4e2a\u9879\u76ee\u91cc\uff0c\u6211\u4eec\u76f4\u63a5\u91c7\u7528\u4e86 MySQL\u3001Redis \u548c Nginx \u4e09\u4e2a\u5b98\u65b9\u955c\u50cf\uff0c\u800c\u5bf9\u4e8e PHP-FPM \u7684\u955c\u50cf\uff0c\u6211\u4eec\u9700\u8981\u589e\u52a0\u4e00\u4e9b\u529f\u80fd\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u8fc7 Dockerfile \u6784\u5efa\u7684\u65b9\u5f0f\u6765\u751f\u6210\u3002\n\n\u5bf9\u4e8e MySQL \u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u4e3a\u5b83\u4eec\u8bbe\u7f6e\u5bc6\u7801\uff0c\u6240\u4ee5\u539f\u5219\u4e0a\u6211\u4eec\u662f\u9700\u8981\u5bf9\u5b83\u4eec\u8fdb\u884c\u6539\u9020\u5e76\u751f\u6210\u65b0\u7684\u955c\u50cf\u6765\u4f7f\u7528\u7684\u3002\u800c\u7531\u4e8e MySQL \u955c\u50cf\u53ef\u4ee5\u901a\u8fc7\u6211\u4eec\u4e4b\u524d\u5728\u955c\u50cf\u4f7f\u7528\u65b9\u6cd5\u4e00\u8282\u6240\u63d0\u5230\u7684\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u7684\u65b9\u5f0f\uff0c\u6765\u76f4\u63a5\u6307\u5b9a MySQL \u7684\u5bc6\u7801\u53ca\u5176\u4ed6\u4e00\u4e9b\u5173\u952e\u6027\u5185\u5bb9\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u65e0\u987b\u5355\u72ec\u6784\u5efa\u955c\u50cf\uff0c\u53ef\u4ee5\u76f4\u63a5\u91c7\u7528\u5b98\u65b9\u955c\u50cf\u5e76\u914d\u5408\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u6765\u8fbe\u5230\u76ee\u7684\u3002\n\n\u5bf9\u4e8e Redis \u6765\u8bf4\uff0c\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u6211\u4eec\u4e00\u6837\u9700\u8981\u8bbe\u7f6e\u5bc6\u7801\u3002Redis \u8bbe\u7f6e\u5bc6\u7801\u7684\u65b9\u6cd5\u662f\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4fee\u6539 Redis \u7684\u914d\u7f6e\u6587\u4ef6\u5e76\u6302\u8f7d\u5230 Redis \u5bb9\u5668\u4e2d\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u76f8\u5bf9\u7b80\u5355\uff0c\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u5b98\u65b9\u63d0\u4f9b\u7684 Redis \u955c\u50cf\u91cc\uff0c\u9ed8\u8ba4\u7684\u542f\u52a8\u547d\u4ee4\u662f redis-server\uff0c\u5176\u5e76\u6ca1\u6709\u6307\u5b9a\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u3002\u6240\u4ee5\u5728\u6211\u4eec\u5b9a\u4e49 Redis \u5bb9\u5668\u65f6\uff0c\u8981\u4f7f\u7528 command \u914d\u7f6e\u4fee\u6539\u5bb9\u5668\u7684\u542f\u52a8\u547d\u4ee4\uff0c\u4f7f\u5176\u8bfb\u53d6\u6211\u4eec\u6302\u8f7d\u5230\u5bb9\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\n### \u81ea\u5b9a\u4e49\u955c\u50cf\n\n\u76f8\u6bd4\u8f83\u4e8e MySQL\u3001Redis \u8fd9\u6837\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u914d\u7f6e\u5373\u53ef\u76f4\u63a5\u4f7f\u7528\u7684\u955c\u50cf\u4e0d\u540c\uff0cPHP \u7684\u955c\u50cf\u4e2d\u7f3a\u4e4f\u4e86\u4e00\u4e9b\u6211\u4eec\u7a0b\u5e8f\u4e2d\u5fc5\u8981\u7684\u5143\u7d20\uff0c\u800c\u8fd9\u4e9b\u90e8\u5206\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u81ea\u5b9a\u4e49\u955c\u50cf\u7684\u65b9\u5f0f\u5c06\u5b83\u4eec\u52a0\u5165\u5176\u4e2d\u3002\n\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0c\u56e0\u4e3a\u9700\u8981\u8ba9 PHP \u8fde\u63a5\u5230 MySQL \u6570\u636e\u5e93\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u4e3a\u955c\u50cf\u4e2d\u7684 PHP \u7a0b\u5e8f\u5b89\u88c5\u548c\u5f00\u542f pdo\\_mysql \u8fd9\u4e2a\u6269\u5c55\u3002\n\n\u4e86\u89e3\u5982\u4f55\u5b89\u88c5\u6269\u5c55\uff0c\u8fd9\u5c31\u8981\u8003\u9a8c\u6211\u4eec\u4e4b\u524d\u5728 Docker Hub \u955c\u50cf\u4f7f\u7528\u4e00\u8282\u4e2d\u5b66\u5230\u7684\u77e5\u8bc6\u4e86\u3002\u6211\u4eec\u901a\u8fc7\u9605\u8bfb PHP \u955c\u50cf\u7684\u4ecb\u7ecd\u9875\u9762\uff0c\u53ef\u4ee5\u627e\u5230 PHP \u955c\u50cf\u4e2d\u5df2\u7ecf\u4e3a\u6211\u4eec\u51c6\u5907\u597d\u4e86\u6269\u5c55\u7684\u5b89\u88c5\u548c\u542f\u7528\u547d\u4ee4\uff0c\u8fd9\u8ba9\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u5730\u5728\u955c\u50cf\u4e2d\u52a0\u5165\u6269\u5c55\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/23/166a08aa844baae9?w=733&h=561&f=png&s=60471)\n\n\u5728\u51c6\u5907\u597d\u8fd9\u4e9b\u4f7f\u7528\u65b9\u6cd5\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u6784\u5efa PHP \u955c\u50cf\u7684 Dockerfile \u6587\u4ef6\u4e86\u3002\u8fd9\u91cc\u6211\u5df2\u7ecf\u7f16\u5199\u597d\u4e86\u4e00\u4efd\uff0c\u4f9b\u5927\u5bb6\u53c2\u8003\u3002\n\n```\nFROM php:7.2-fpm\n\nMAINTAINER You Ming <youming@funcuter.org>\n\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends cron\n\nRUN docker-php-ext-install pdo_mysql\n\nCOPY docker-entrypoint.sh /usr/local/bin/\n\nRUN chmod +x /usr/local/bin/docker-entrypoint.sh\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\nCMD [\"php-fpm\"]\n\n```\n\n\u7531\u4e8e Docker \u5b98\u65b9\u6240\u63d0\u4f9b\u7684\u955c\u50cf\u6bd4\u8f83\u7cbe\u7b80\uff0c\u6240\u4ee5\u5728\u8fd9\u4e2a Dockerfile \u91cc\uff0c\u6211\u4eec\u8fd8\u6267\u884c\u4e86 cron \u7684\u5b89\u88c5\u547d\u4ee4\uff0c\u6765\u786e\u4fdd\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b9a\u65f6\u4efb\u52a1\u3002\n\n\u5927\u5bb6\u6ce8\u610f\u5230\uff0c\u8fd9\u91cc\u9664\u4e86\u6211\u4eec\u8fdb\u884c\u529f\u80fd\u5b89\u88c5\u5916\uff0c\u8fd8\u5c06\u4e00\u4e2a\u811a\u672c\u62f7\u5165\u4e86\u955c\u50cf\u4e2d\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a ENTRYPOINT \u542f\u52a8\u5165\u53e3\u3002\u8fd9\u4e2a\u6587\u4ef6\u7684\u4f5c\u7528\u4e3b\u8981\u662f\u4e3a\u4e86\u542f\u52a8 cron \u670d\u52a1\uff0c\u4ee5\u4fbf\u6211\u4eec\u5728\u5bb9\u5668\u4e2d\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u5b83\u3002\n\n```\n#!/bin/bash\n\nservice cron start\n\nexec \"$@\"\n\n```\n\n\u5728 [docker-entrypoint.sh](http://docker-entrypoint.sh) \u91cc\uff0c\u9664\u4e86\u542f\u52a8 cron \u670d\u52a1\u7684\u547d\u4ee4\u5916\uff0c\u6211\u4eec\u5728\u811a\u672c\u7684\u6700\u540e\u770b\u5230\u7684\u662f `exec \"$@\"` \u8fd9\u884c\u547d\u4ee4\u3002`$@` \u662f shell \u811a\u672c\u83b7\u53d6\u53c2\u6570\u7684\u7b26\u53f7\uff0c\u8fd9\u91cc\u83b7\u5f97\u7684\u662f\u6240\u6709\u4f20\u5165\u811a\u672c\u7684\u53c2\u6570\uff0c\u800c exec \u662f\u6267\u884c\u547d\u4ee4\uff0c\u76f4\u63a5\u6267\u884c\u8fd9\u4e9b\u53c2\u6570\u3002\n\n\u5982\u679c\u76f4\u63a5\u770b\u8fd9\u6761\u547d\u4ee4\u5927\u5bb6\u4f1a\u6709\u4e9b\u7591\u60d1\uff0c\u53c2\u6570\u600e\u4e48\u62ff\u6765\u6267\u884c\uff0c\u8fd9\u4e0d\u662f\u6709\u95ee\u9898\u4e48\uff1f\n\n\u8bf7\u5927\u5bb6\u56de\u987e\u4e00\u4e0b\uff0c\u6211\u4eec\u4e4b\u524d\u63d0\u5230\u7684\uff0c\u5982\u679c\u5728\u955c\u50cf\u91cc\u540c\u65f6\u5b9a\u4e49\u4e86 ENTRYPOINT \u548c CMD \u4e24\u4e2a\u6307\u4ee4\uff0cCMD \u6307\u4ee4\u7684\u5185\u5bb9\u4f1a\u4ee5\u53c2\u6570\u7684\u5f62\u5f0f\u4f20\u9012\u7ed9 ENTRYPOINT \u6307\u4ee4\u3002\u6240\u4ee5\uff0c\u8fd9\u91cc\u811a\u672c\u6700\u7ec8\u6267\u884c\u7684\uff0c\u662f CMD \u4e2d\u6240\u5b9a\u4e49\u7684\u547d\u4ee4\u3002\n\n### \u76ee\u5f55\u6302\u8f7d\n\n\u5728\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u4f1a\u628a\u9879\u76ee\u4e2d\u7684\u4e00\u4e9b\u76ee\u5f55\u6216\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u91cc\uff0c\u8fd9\u6837\u7684\u6302\u8f7d\u4e3b\u8981\u6709\u4e09\u79cd\u76ee\u7684\uff1a\n\n*   \u5c06\u7a0b\u5e8f\u7684\u914d\u7f6e\u901a\u8fc7\u6302\u8f7d\u7684\u65b9\u5f0f\u8986\u76d6\u5bb9\u5668\u4e2d\u5bf9\u5e94\u7684\u6587\u4ef6\uff0c\u8fd9\u8ba9\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u5bb9\u5668\u5916\u4fee\u6539\u7a0b\u5e8f\u7684\u914d\u7f6e\uff0c\u5e76\u901a\u8fc7\u76f4\u63a5\u91cd\u542f\u5bb9\u5668\u5c31\u80fd\u5e94\u7528\u8fd9\u4e9b\u914d\u7f6e\uff1b\n    \n*   \u628a\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\u5e94\u7528\u6570\u636e\u7684\u8f93\u51fa\u76ee\u5f55\uff0c\u5c31\u53ef\u4ee5\u8ba9\u5bb9\u5668\u4e2d\u7684\u7a0b\u5e8f\u76f4\u63a5\u5c06\u6570\u636e\u8f93\u51fa\u5230\u5bb9\u5668\u5916\uff0c\u5bf9\u4e8e MySQL\u3001Redis \u4e2d\u7684\u6570\u636e\uff0c\u7a0b\u5e8f\u7684\u65e5\u5fd7\u7b49\u5185\u5bb9\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u6765\u6301\u4e45\u4fdd\u5b58\u5b83\u4eec\uff1b\n    \n*   \u628a\u4ee3\u7801\u6216\u8005\u7f16\u8bd1\u540e\u7684\u7a0b\u5e8f\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff0c\u8ba9\u5b83\u4eec\u5728\u5bb9\u5668\u4e2d\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u6211\u4eec\u5728\u5f00\u53d1\u4e2d\u53cd\u590d\u6784\u5efa\u955c\u50cf\u5e26\u6765\u7684\u9ebb\u70e6\uff0c\u8282\u7701\u51fa\u5927\u91cf\u5b9d\u8d35\u7684\u5f00\u53d1\u65f6\u95f4\u3002\n    \n\n\u4e0a\u8ff0\u7684\u51e0\u79cd\u65b9\u6cd5\uff0c\u5bf9\u4e8e\u7ebf\u4e0a\u90e8\u7f72\u6765\u8bf4\u90fd\u662f\u4e0d\u9002\u7528\u7684\uff0c\u4f46\u5728\u6211\u4eec\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5374\u53ef\u4ee5\u4e3a\u6211\u4eec\u514d\u53bb\u5927\u91cf\u4e0d\u5fc5\u8981\u7684\u5de5\u4f5c\uff0c\u56e0\u6b64\u5efa\u8bae\u5728\u5f00\u53d1\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u6302\u8f7d\u7ed3\u6784\u3002\n\n## \u7f16\u5199\u8f85\u52a9\u811a\u672c\n\n\u6211\u4eec\u77e5\u9053\uff0c\u867d\u7136 Docker Compose \u7b80\u5316\u4e86\u8bb8\u591a\u64cd\u4f5c\u6d41\u7a0b\uff0c\u4f46\u6211\u4eec\u8fd8\u662f\u9700\u8981\u4f7f\u7528 docker-compose \u547d\u4ee4\u6765\u7ba1\u7406\u9879\u76ee\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u4f8b\u5b50\u6765\u8bf4\uff0c\u6211\u4eec\u8981\u542f\u52a8\u5b83\u5c31\u5fc5\u987b\u4f7f\u7528\u8fd9\u6837\u7684 docker-compose \u547d\u4ee4\u6765\u7ba1\u7406\u9879\u76ee\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u4f8b\u5b50\u6765\u8bf4\uff0c\u6211\u4eec\u8981\u542f\u52a8\u5b83\u5c31\u5fc5\u987b\u4f7f\u7528\u8fd9\u6837\u7684\uff1a\n\n```\n$ sudo docker-compose -p website up -d\n\n```\n\n\u800c\u6267\u884c\u7684\u76ee\u5f55\u5fc5\u987b\u662f docker-compose.yml \u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\uff0c\u8fd9\u6837\u624d\u80fd\u6b63\u786e\u5730\u8bfb\u53d6 Docker Compose \u9879\u76ee\u7684\u914d\u7f6e\u5185\u5bb9\u3002\n\n\u6211\u7f16\u5199\u4e86\u4e00\u4e2a compose \u811a\u672c\uff0c\u7528\u6765\u7b80\u5316 docker-compose \u7684\u64cd\u4f5c\u547d\u4ee4\u3002\n\n```\n#!/bin/bash\n\nroot=$(cd `dirname $0`; dirname `pwd`)\n\ndocker-compose -p website -f ${root}/compose/docker-compose.yml \"$@\"\n\n```\n\n\u5728\u8fd9\u4e2a\u811a\u672c\u91cc\uff0c\u6211\u628a\u4e00\u4e9b\u5171\u6027\u7684\u4e1c\u897f\u5305\u542b\u8fdb\u53bb\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u4e0d\u5fc5\u6bcf\u6b21\u4f20\u5165\u8fd9\u4e9b\u53c2\u6570\u6216\u9009\u9879\u4e86\u3002\u540c\u65f6\uff0c\u8fd9\u4e2a\u811a\u672c\u8fd8\u80fd\u81ea\u9002\u5e94\u8c03\u7528\u7684\u76ee\u5f55\uff0c\u51c6\u786e\u627e\u5230 docker-compose.yml \u6587\u4ef6\uff0c\u66f4\u65b9\u4fbf\u6211\u4eec\u76f4\u63a5\u8c03\u7528\u3002\n\n\u901a\u8fc7\u8fd9\u4e2a\u811a\u672c\u6765\u64cd\u4f5c\u9879\u76ee\uff0c\u6211\u4eec\u7684\u547d\u4ee4\u5c31\u53ef\u4ee5\u7b80\u5316\u4e3a\uff1a\n\n```\n$ sudo ./bin/compose up -d\n\n$ sudo ./bin/compose logs nginx\n\n$ sudo ./bin/compose down\n\n```\n\n\u5f53\u7136\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7f16\u5199\u50cf\u4ee3\u7801\u90e8\u7f72\u3001\u670d\u52a1\u91cd\u542f\u7b49\u811a\u672c\uff0c\u6765\u63d0\u9ad8\u6211\u4eec\u7684\u5f00\u53d1\u6548\u7387\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86\u7f16\u5199\u4e00\u4e2a\u7528\u4e8e\u5f00\u53d1\u7684\u5b8c\u6574 Docker Compose \u9879\u76ee\u7684\u65b9\u6cd5\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u5b9e\u8df5\u9898\uff1a\n\n> \u5c1d\u8bd5\u81ea\u5df1\u7f16\u5199\u9002\u7528\u4e8e\u81ea\u5df1\u5e94\u7528\u7684 Docker Compose \u9879\u76ee\uff0c\u5e76\u5c06\u5b83\u63d0\u4f9b\u7ed9\u6d4b\u8bd5\u540c\u4e8b\uff0c\u8fdb\u884c\u6d4b\u8bd5\u73af\u5883\u7684\u90e8\u7f72\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9\u7f16\u5199 Docker Compose \u9879\u76ee\u8fd8\u6709\u7591\u95ee\uff0c\u6216\u8005\u6709\u7f16\u5199\u7684\u5fc3\u5f97\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002\n\n\u672c\u5c0f\u8282\u4e2d\u7684\u793a\u4f8b\uff0c\u5df2\u7ecf\u66f4\u65b0\u5230\u4e86\uff1a\n\n[https://github.com/youmingdot/docker-book-for-developer-samples](https://github.com/youmingdot/docker-book-for-developer-samples)", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u7ec4\u5408\u5e94\u7528\u7f16\u5199_Docker_Compose_\u9879\u76ee.md", "create_date": "2020-02-18T21:18:39.215", "order": 17}}, {"model": "subject.chapter", "pk": 74, "fields": {"title": "\u7ec4\u5408\u5e94\u7528\uff1a\u5e38\u7528\u7684 Docker Compose \u914d\u7f6e\u9879", "topic": 3, "md5": "c84ca932817c604a091002c6ff195330", "md_body": "# \u5e38\u7528\u7684 Docker Compose \u914d\u7f6e\u9879\n\n\u4e0e Dockerfile \u4e00\u6837\uff0c\u7f16\u5199 Docker Compose \u7684\u914d\u7f6e\u6587\u4ef6\u662f\u638c\u63e1\u548c\u4f7f\u7528\u597d Docker Compose \u7684\u524d\u63d0\u3002\u7f16\u5199 Docker Compose \u914d\u7f6e\u6587\u4ef6\uff0c\u5176\u672c\u8d28\u5c31\u662f\u6839\u636e\u6211\u4eec\u6240\u8bbe\u8ba1\u7684\u5e94\u7528\u67b6\u6784\uff0c\u5bf9\u4e0d\u540c\u5e94\u7528\u5bb9\u5668\u8fdb\u884c\u914d\u7f6e\u5e76\u52a0\u4ee5\u7ec4\u5408\u3002\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u8c08\u8c08\u5982\u4f55\u7f16\u5199 Docker Compose \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e86\u89e3\u5176\u4e2d\u5e38\u89c1\u914d\u7f6e\u9879\u7684\u4f7f\u7528\u65b9\u6cd5\u3002\n\n## \u5b9a\u4e49\u670d\u52a1\n\n\u4e3a\u4e86\u7406\u89e3\u5728\u5f00\u53d1\u4e2d\u5e38\u7528\u7684 Docker Compose \u914d\u7f6e\uff0c\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u5728\u5f00\u53d1\u4e2d\u4f7f\u7528\u7684 Docker Compose \u6587\u4ef6\u6765\u8fdb\u884c\u4e0b\u9762\u7684\u8bb2\u89e3\u3002\n\n```\nversion: \"3\"\n\nservices:\n\n  redis:\n    image: redis:3.2\n    networks:\n      - backend\n    volumes:\n      - ./redis/redis.conf:/etc/redis.conf:ro\n    ports:\n      - \"6379:6379\"\n    command: [\"redis-server\", \"/etc/redis.conf\"]\n\n  database:\n    image: mysql:5.7\n    networks:\n      - backend\n    volumes:\n      - ./mysql/my.cnf:/etc/mysql/my.cnf:ro\n      - mysql-data:/var/lib/mysql\n    environment:\n      - MYSQL_ROOT_PASSWORD=my-secret-pw\n    ports:\n      - \"3306:3306\"\n\n  webapp:\n    build: ./webapp\n    networks:\n      - frontend\n      - backend\n    volumes:\n      - ./webapp:/webapp\n    depends_on:\n      - redis\n      - database\n\n  nginx:\n    image: nginx:1.12\n    networks:\n      - frontend\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/conf.d:/etc/nginx/conf.d:ro\n      - ./webapp/html:/webapp/html\n    depends_on:\n      - webapp\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n\nnetworks:\n  frontend:\n  backend:\n\nvolumes:\n  mysql-data:\n\n```\n\n\u5728\u8fd9\u4e2a Docker Compose \u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u770b\u5230\u5360\u6709\u5927\u91cf\u7bc7\u5e45\u7684\u5c31\u662f services \u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u5b9a\u4e49\u7684\u90e8\u5206\u4e86\u3002\u5728\u4e0a\u4e00\u8282\u91cc\uff0c\u6211\u4eec\u5df2\u7ecf\u8bf4\u5230\u4e86\uff0cDocker Compose \u4e2d\u7684\u670d\u52a1\uff0c\u662f\u5bf9\u4e00\u7ec4\u76f8\u540c\u5bb9\u5668\u96c6\u7fa4\u7edf\u4e00\u914d\u7f6e\u7684\u5b9a\u4e49\uff0c\u6240\u4ee5\u53ef\u89c1\uff0c\u5728 Docker Compose \u91cc\uff0c\u4e3b\u8981\u7684\u5185\u5bb9\u4e5f\u662f\u5bf9\u5bb9\u5668\u914d\u7f6e\u7684\u5b9a\u4e49\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u4f9d\u7136\u8981\u58f0\u660e\u4e00\u4e0b\uff0c\u8fd9\u672c\u5c0f\u518c\u4e3b\u8981\u4ee5\u5f00\u53d1\u4e2d\u4f7f\u7528 Docker \u7684\u65b9\u6cd5\u4e3a\u4e3b\uff0c\u6240\u4ee5\u5728\u5173\u4e8e Docker Compose \u7684\u5185\u5bb9\u91cc\uff0c\u4f9d\u7136\u4ee5\u5f00\u53d1\u4e2d\u7684\u4f7f\u7528\u4e3a\u4e3b\u3002\u7531\u4e8e\u6211\u4eec\u5f00\u53d1\u4e2d\uff0c\u9274\u4e8e\u672c\u5730\u673a\u5668\u6027\u80fd\u548c\u6613\u7ba1\u7406\u6027\u7b49\u7684\u8003\u8651\uff0c\u4e0d\u4f1a\u4e3a\u670d\u52a1\u8fdb\u884c\u96c6\u7fa4\u914d\u7f6e\uff0c\u901a\u5e38\u5c31\u662f\u4e00\u4e2a\u670d\u52a1\u5bf9\u5e94\u4e00\u4e2a\u5bb9\u5668\uff0c\u6240\u4ee5\u8fd9\u91cc\u5747\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u6765\u8fdb\u884c\u8bb2\u89e3\u3002\n\n\u5728 Docker Compose \u7684\u914d\u7f6e\u6587\u4ef6\u91cc\uff0c\u5bf9\u670d\u52a1\u7684\u5b9a\u4e49\u4e0e\u6211\u4eec\u4e4b\u524d\u8c08\u5230\u7684\u521b\u5efa\u548c\u542f\u52a8\u5bb9\u5668\u4e2d\u7684\u9009\u9879\u975e\u5e38\u76f8\u4f3c\uff0c\u6216\u8005\u8bf4 Docker Compose \u5c31\u662f\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u51fa\u8fd9\u4e9b\u5185\u5bb9\uff0c\u4ee3\u6211\u4eec\u521b\u5efa\u548c\u7ba1\u7406\u8fd9\u4e9b\u5bb9\u5668\u7684\u3002\n\n\u5728\u4f7f\u7528\u65f6\uff0c\u6211\u4eec\u9996\u5148\u8981\u4e3a\u6bcf\u4e2a\u670d\u52a1\u5b9a\u4e49\u4e00\u4e2a\u540d\u79f0\uff0c\u7528\u4ee5\u533a\u522b\u4e0d\u540c\u7684\u670d\u52a1\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u91cc\uff0credis\u3001database\u3001webapp\u3001nginx \u5c31\u662f\u670d\u52a1\u7684\u540d\u79f0\u3002\n\n### \u6307\u5b9a\u955c\u50cf\n\n\u5bb9\u5668\u6700\u57fa\u7840\u7684\u5c31\u662f\u955c\u50cf\u4e86\uff0c\u6240\u4ee5\u6bcf\u4e2a\u670d\u52a1\u5fc5\u987b\u6307\u5b9a\u955c\u50cf\u3002\u5728 Docker Compose \u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u4e3a\u670d\u52a1\u6307\u5b9a\u6240\u91c7\u7528\u7684\u955c\u50cf\u3002\u4e00\u79cd\u662f\u901a\u8fc7 image \u8fd9\u4e2a\u914d\u7f6e\uff0c\u8fd9\u4e2a\u76f8\u5bf9\u7b80\u5355\uff0c\u7ed9\u51fa\u80fd\u5728\u955c\u50cf\u4ed3\u5e93\u4e2d\u627e\u5230\u955c\u50cf\u7684\u540d\u79f0\u5373\u53ef\u3002\n\n\u53e6\u5916\u4e00\u79cd\u6307\u5b9a\u955c\u50cf\u7684\u65b9\u5f0f\u5c31\u662f\u76f4\u63a5\u91c7\u7528 Dockerfile \u6765\u6784\u5efa\u955c\u50cf\uff0c\u901a\u8fc7 build \u8fd9\u4e2a\u914d\u7f6e\u6211\u4eec\u80fd\u591f\u5b9a\u4e49\u6784\u5efa\u7684\u73af\u5883\u76ee\u5f55\uff0c\u8fd9\u4e0e `docker build` \u4e2d\u7684\u73af\u5883\u76ee\u5f55\u662f\u540c\u4e00\u4e2a\u542b\u4e49\u3002\u5982\u679c\u6211\u4eec\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6307\u5b9a\u955c\u50cf\uff0c\u90a3\u4e48 Docker Compose \u5148\u4f1a\u5e2e\u52a9\u6211\u4eec\u6267\u884c\u955c\u50cf\u7684\u6784\u5efa\uff0c\u4e4b\u540e\u518d\u901a\u8fc7\u8fd9\u4e2a\u955c\u50cf\u542f\u52a8\u5bb9\u5668\u3002\n\n\u5f53\u7136\uff0c\u5728 `docker build` \u91cc\u6211\u4eec\u8fd8\u80fd\u901a\u8fc7\u9009\u9879\u5b9a\u4e49\u8bb8\u591a\u5185\u5bb9\uff0c\u8fd9\u4e9b\u5728 Docker Compose \u91cc\u6211\u4eec\u4f9d\u7136\u53ef\u4ee5\u3002\n\n```\n## ......\n  webapp:\n    build:\n      context: ./webapp\n      dockerfile: webapp-dockerfile\n      args:\n        - JAVA_VERSION=1.6\n## ......\n\n```\n\n\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\uff0c\u6211\u4eec\u8fd8\u80fd\u7528 Map \u7684\u5f62\u5f0f\u6765\u5b9a\u4e49 build\uff0c\u5728\u8fd9\u79cd\u683c\u5f0f\u4e0b\uff0c\u6211\u4eec\u80fd\u591f\u6307\u5b9a\u66f4\u591a\u7684\u955c\u50cf\u6784\u5efa\u53c2\u6570\uff0c\u4f8b\u5982 Dockerfile \u7684\u6587\u4ef6\u540d\uff0c\u6784\u5efa\u53c2\u6570\u7b49\u7b49\u3002\n\n\u5f53\u7136\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u53ef\u4ee5\u4e0d\u901a\u8fc7\u91cd\u65b0\u6784\u5efa\u955c\u50cf\u7684\u65b9\u5f0f\u4fbf\u80fd\u4fee\u6539\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u8fd8\u662f\u4e0d\u5efa\u8bae\u91cd\u65b0\u6784\u5efa\u955c\u50cf\uff0c\u800c\u662f\u4f7f\u7528\u539f\u6709\u7684\u955c\u50cf\u505a\u7b80\u5355\u7684\u4fee\u6539\u3002\n\n\u4f8b\u5982\u4e0a\u9762\u7684\u914d\u7f6e\u91cc\uff0c\u6211\u4eec\u5e0c\u671b\u4fee\u6539 Redis \u7684\u542f\u52a8\u547d\u4ee4\uff0c\u52a0\u5165\u914d\u7f6e\u6587\u4ef6\u4ee5\u4fbf\u5bf9 Redis \u670d\u52a1\u8fdb\u884c\u914d\u7f6e\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 command \u914d\u7f6e\u6765\u4fee\u6539\u3002\u800c\u5728 MySQL \u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u901a\u8fc7 environment \u914d\u7f6e\u4e3a MySQL \u8bbe\u7f6e\u4e86\u521d\u59cb\u5bc6\u7801\u3002\n\n\u8fd9\u4e9b\u5bf9\u955c\u50cf\u7684\u4f7f\u7528\u65b9\u6cd5\u6211\u4eec\u5728\u4e4b\u524d\u90fd\u5df2\u7ecf\u8c08\u5230\u8fc7\u4e86\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u4e4b\u524d\u7528\u7684\u662f Docker Engine \u7684\u547d\u4ee4\u4ee5\u53ca\u5176\u9009\u9879\u6765\u63a7\u5236\u7684\uff0c\u800c\u5728 Docker Compose \u91cc\uff0c\u6211\u4eec\u76f4\u63a5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u5b9a\u4e49\u5b83\u4eec\u3002\n\n\u7531\u4e8e Docker Compose \u7684\u914d\u7f6e\u5df2\u7ecf\u56fa\u5316\u4e0b\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u62c5\u5fc3\u5fd8\u8bb0\u4e4b\u524d\u6267\u884c\u4e86\u54ea\u4e9b\u547d\u4ee4\u6765\u542f\u52a8\u5bb9\u5668\uff0c\u5f53\u6bcf\u6b21\u9700\u8981\u5f00\u542f\u6216\u5173\u95ed\u73af\u5883\u65f6\uff0c\u53ea\u9700\u8981 `docker-compose up -d` \u548c `docker-compose down` \u547d\u4ee4\uff0c\u5c31\u80fd\u8f7b\u677e\u5b8c\u6210\u64cd\u4f5c\u3002\n\n### \u4f9d\u8d56\u58f0\u660e\n\n\u867d\u7136\u6211\u4eec\u5728 Docker Compose \u7684\u914d\u7f6e\u6587\u4ef6\u91cc\u5b9a\u4e49\u670d\u52a1\uff0c\u5728\u4e66\u5199\u4e0a\u6709\u7531\u4e0a\u81f3\u4e0b\u7684\u5148\u540e\u5173\u7cfb\uff0c\u4f46\u5b9e\u9645\u5728\u5bb9\u5668\u542f\u52a8\u4e2d\uff0c\u7531\u4e8e\u5404\u79cd\u56e0\u7d20\u7684\u5b58\u5728\uff0c\u5176\u987a\u5e8f\u8fd8\u662f\u65e0\u6cd5\u4fdd\u969c\u7684\u3002\n\n\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u7684\u670d\u52a1\u95f4\u6709\u975e\u5e38\u5f3a\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u544a\u77e5 Docker Compose \u5bb9\u5668\u7684\u5148\u540e\u542f\u52a8\u987a\u5e8f\u3002\u53ea\u6709\u5f53\u88ab\u4f9d\u8d56\u7684\u5bb9\u5668\u5b8c\u5168\u542f\u52a8\u540e\uff0cDocker Compose \u624d\u4f1a\u521b\u5efa\u548c\u542f\u52a8\u8fd9\u4e2a\u5bb9\u5668\u3002\n\n\u5b9a\u4e49\u4f9d\u8d56\u7684\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\u6211\u4eec\u5df2\u7ecf\u770b\u5230\u4e86\uff0c\u4e5f\u5c31\u662f depends\\_on \u8fd9\u4e2a\u914d\u7f6e\u9879\uff0c\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u5b83\u5217\u51fa\u8fd9\u4e2a\u670d\u52a1\u6240\u6709\u4f9d\u8d56\u7684\u5176\u4ed6\u670d\u52a1\u5373\u53ef\u3002\u5728 Docker Compose \u4e3a\u6211\u4eec\u542f\u52a8\u9879\u76ee\u7684\u65f6\u5019\uff0c\u4f1a\u68c0\u67e5\u6240\u6709\u4f9d\u8d56\uff0c\u5f62\u6210\u6b63\u786e\u7684\u542f\u52a8\u987a\u5e8f\u5e76\u6309\u8fd9\u4e2a\u987a\u5e8f\u6765\u4f9d\u6b21\u542f\u52a8\u5bb9\u5668\u3002\n\n## \u6587\u4ef6\u6302\u8f7d\n\n\u5728 Docker Compose \u91cc\u5b9a\u4e49\u6587\u4ef6\u6302\u8f7d\u7684\u65b9\u5f0f\u4e0e Docker Engine \u91cc\u4e5f\u5e76\u6ca1\u6709\u592a\u591a\u7684\u533a\u522b\uff0c\u4f7f\u7528 volumes \u914d\u7f6e\u53ef\u4ee5\u50cf docker CLI \u91cc\u7684 `-v` \u9009\u9879\u4e00\u6837\u6765\u6307\u5b9a\u5916\u90e8\u6302\u8f7d\u548c\u6570\u636e\u5377\u6302\u8f7d\u3002\n\n\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u770b\u5230\u4e86\u5b9a\u4e49\u51e0\u79cd\u5e38\u7528\u6302\u8f7d\u7684\u65b9\u5f0f\u3002\u6211\u4eec\u80fd\u591f\u76f4\u63a5\u6302\u8f7d\u5bbf\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u76ee\u5f55\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6570\u636e\u5377\u7684\u5f62\u5f0f\u6302\u8f7d\u5185\u5bb9\u3002\n\n\u5728\u4f7f\u7528\u5916\u90e8\u6587\u4ef6\u6302\u8f7d\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u76f8\u5bf9\u76ee\u5f55\u8fdb\u884c\u6302\u8f7d\uff0c\u8fd9\u91cc\u7684\u76f8\u5bf9\u76ee\u5f55\u662f\u6307\u76f8\u5bf9\u4e8e docker-compose.yml \u6587\u4ef6\u7684\u76ee\u5f55\u3002\n\n\u7531\u4e8e\u6709\u76f8\u5bf9\u76ee\u5f55\u8fd9\u6837\u7684\u673a\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 docker-compose.yml \u548c\u6240\u6709\u76f8\u5173\u7684\u6302\u8f7d\u6587\u4ef6\u653e\u7f6e\u5230\u540c\u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\uff0c\u5f62\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u9879\u76ee\u6587\u4ef6\u5939\u3002\u8fd9\u6837\u65e2\u53ef\u4ee5\u5f88\u597d\u7684\u6574\u7406\u9879\u76ee\u6587\u4ef6\uff0c\u4e5f\u5229\u4e8e\u5b8c\u6574\u7684\u8fdb\u884c\u9879\u76ee\u8fc1\u79fb\u3002\n\n\u867d\u7136 Docker \u63d0\u5021\u5c06\u4ee3\u7801\u6216\u7f16\u8bd1\u597d\u7684\u7a0b\u5e8f\u901a\u8fc7\u6784\u5efa\u955c\u50cf\u7684\u65b9\u5f0f\u6253\u5305\u5230\u955c\u50cf\u91cc\uff0c\u968f\u6574\u4e2a CI \u6d41\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e2d\uff0c\u4f46\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u6bcf\u6b21\u4fee\u6539\u7a0b\u5e8f\u8fdb\u884c\u7b80\u5355\u6d4b\u8bd5\u90fd\u8981\u91cd\u65b0\u6784\u5efa\u955c\u50cf\u7b80\u76f4\u662f\u6d6a\u8d39\u751f\u547d\u7684\u64cd\u4f5c\u3002\u6240\u4ee5\u5728\u5f00\u53d1\u65f6\uff0c\u6211\u4eec\u63a8\u8350\u76f4\u63a5\u5c06\u4ee3\u7801\u6302\u8f7d\u5230\u5bb9\u5668\u91cc\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u955c\u50cf\u6784\u5efa\u7684\u65b9\u5f0f\u6253\u5305\u6210\u955c\u50cf\u3002\n\n\u540c\u65f6\uff0c\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u4e8e\u7a0b\u5e8f\u7684\u914d\u7f6e\u7b49\u5185\u5bb9\uff0c\u6211\u4eec\u4e5f\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u6587\u4ef6\u6302\u8f7d\u7684\u5f62\u5f0f\u6302\u8f7d\u5230\u5bb9\u5668\u91cc\uff0c\u907f\u514d\u7ecf\u5e38\u4fee\u6539\u6240\u5e26\u6765\u7684\u9ebb\u70e6\u3002\n\n### \u4f7f\u7528\u6570\u636e\u5377\n\n\u5982\u679c\u6211\u4eec\u8981\u5728\u9879\u76ee\u4e2d\u4f7f\u7528\u6570\u636e\u5377\u6765\u5b58\u653e\u7279\u6b8a\u7684\u6570\u636e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ba9 Docker Compose \u81ea\u52a8\u5b8c\u6210\u5bf9\u6570\u636e\u5377\u7684\u521b\u5efa\uff0c\u800c\u4e0d\u9700\u8981\u6211\u4eec\u5355\u72ec\u8fdb\u884c\u64cd\u4f5c\u3002\n\n\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c\u72ec\u7acb\u4e8e services \u7684 volumes \u914d\u7f6e\u5c31\u662f\u7528\u6765\u58f0\u660e\u6570\u636e\u5377\u7684\u3002\u5b9a\u4e49\u6570\u636e\u5377\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u4ec5\u9700\u8981\u63d0\u4f9b\u6570\u636e\u5377\u7684\u540d\u79f0\uff0c\u5bf9\u4e8e\u6211\u4eec\u5728 Docker Engine \u4e2d\u521b\u5efa\u6570\u636e\u5377\u65f6\u80fd\u591f\u4f7f\u7528\u7684\u5176\u4ed6\u5b9a\u4e49\uff0c\u4e5f\u80fd\u591f\u653e\u5165 Docker Compose \u7684\u6570\u636e\u5377\u5b9a\u4e49\u4e2d\u3002\n\n\u5982\u679c\u6211\u4eec\u60f3\u628a\u5c5e\u4e8e Docker Compose \u9879\u76ee\u4ee5\u5916\u7684\u6570\u636e\u5377\u5f15\u5165\u8fdb\u6765\u76f4\u63a5\u4f7f\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u5377\u5b9a\u4e49\u4e3a\u5916\u90e8\u5f15\u5165\uff0c\u901a\u8fc7 external \u8fd9\u4e2a\u914d\u7f6e\u5c31\u80fd\u5b8c\u6210\u8fd9\u4e2a\u5b9a\u4e49\u3002\n\n```\n## ......\nvolumes:\n  mysql-data:\n    external: true\n## ......\n\n```\n\n\u5728\u52a0\u5165 external \u5b9a\u4e49\u540e\uff0cDocker Compose \u5728\u521b\u5efa\u9879\u76ee\u65f6\u4e0d\u4f1a\u76f4\u63a5\u521b\u5efa\u6570\u636e\u5377\uff0c\u800c\u662f\u4f18\u5148\u4ece Docker Engine \u4e2d\u5df2\u6709\u7684\u6570\u636e\u5377\u91cc\u5bfb\u627e\u5e76\u76f4\u63a5\u91c7\u7528\u3002\n\n## \u914d\u7f6e\u7f51\u7edc\n\n\u7f51\u7edc\u4e5f\u662f\u5bb9\u5668\u95f4\u4e92\u76f8\u8bbf\u95ee\u7684\u6865\u6881\uff0c\u6240\u4ee5\u7f51\u7edc\u7684\u914d\u7f6e\u5bf9\u4e8e\u591a\u4e2a\u5bb9\u5668\u7ec4\u6210\u7684\u5e94\u7528\u7cfb\u7edf\u6765\u8bf4\u4e5f\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u5728 Docker Compose \u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a\u6574\u4e2a\u5e94\u7528\u7cfb\u7edf\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a\u7f51\u7edc\u3002\n\n\u8981\u4f7f\u7528\u7f51\u7edc\uff0c\u6211\u4eec\u5fc5\u987b\u5148\u58f0\u660e\u7f51\u7edc\u3002\u58f0\u660e\u7f51\u7edc\u7684\u914d\u7f6e\u540c\u6837\u72ec\u7acb\u4e8e services \u5b58\u5728\uff0c\u662f\u4f4d\u4e8e\u6839\u914d\u7f6e\u4e0b\u7684 networks \u914d\u7f6e\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u91cc\uff0c\u6211\u4eec\u5df2\u7ecf\u770b\u5230\u4e86\u58f0\u660e frontend \u548c backend \u8fd9\u4e24\u4e2a\u7f51\u7edc\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u3002\n\n\u9664\u4e86\u7b80\u5355\u7684\u58f0\u660e\u7f51\u7edc\u540d\u79f0\uff0c\u8ba9 Docker Compose \u81ea\u52a8\u6309\u9ed8\u8ba4\u5f62\u5f0f\u5b8c\u6210\u7f51\u7edc\u914d\u7f6e\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u663e\u5f0f\u7684\u6307\u5b9a\u7f51\u7edc\u7684\u53c2\u6570\u3002\n\n```\nnetworks:\n  frontend:\n    driver: bridge\n    ipam:\n      driver: default\n      config:\n        - subnet: 10.10.1.0/24\n## ......\n\n```\n\n\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u4e3a\u7f51\u7edc\u5b9a\u4e49\u4e86\u7f51\u7edc\u9a71\u52a8\u7684\u7c7b\u578b\uff0c\u5e76\u6307\u5b9a\u4e86\u5b50\u7f51\u7684\u7f51\u6bb5\u3002\n\n### \u4f7f\u7528\u7f51\u7edc\u522b\u540d\n\n\u76f4\u63a5\u4f7f\u7528\u5bb9\u5668\u540d\u6216\u670d\u52a1\u540d\u6765\u4f5c\u4e3a\u8fde\u63a5\u5176\u4ed6\u670d\u52a1\u7684\u7f51\u7edc\u5730\u5740\uff0c\u56e0\u4e3a\u7f3a\u4e4f\u7075\u6d3b\u6027\uff0c\u5e38\u5e38\u8fd8\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u8981\u3002\u8fd9\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u4e3a\u670d\u52a1\u5355\u72ec\u8bbe\u7f6e\u7f51\u7edc\u522b\u540d\uff0c\u5728\u5176\u4ed6\u5bb9\u5668\u91cc\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a\u522b\u540d\u4f5c\u4e3a\u7f51\u7edc\u5730\u5740\u8fdb\u884c\u8bbf\u95ee\u3002\n\n\u7f51\u7edc\u522b\u540d\u7684\u5b9a\u4e49\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u8fd9\u91cc\u9700\u8981\u5c06\u4e4b\u524d\u7b80\u5355\u7684\u7f51\u7edc List \u5b9a\u4e49\u7ed3\u6784\u4fee\u6539\u6210 Map \u7ed3\u6784\uff0c\u4ee5\u4fbf\u5728\u7f51\u7edc\u4e2d\u52a0\u5165\u66f4\u591a\u7684\u5b9a\u4e49\u3002\n\n```\n## ......\n  database:\n    networks:\n      backend:\n        aliases:\n          - backend.database\n## ......\n  webapp:\n    networks:\n      backend:\n        aliases:\n          - backend.webapp\n      frontend:\n        aliases:\n          - frontend.webapp\n## ......\n\n```\n\n\u5728\u6211\u4eec\u8fdb\u884c\u8fd9\u6837\u7684\u914d\u7f6e\u540e\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u4f7f\u7528\u8fd9\u91cc\u6211\u4eec\u6240\u8bbe\u7f6e\u7684\u7f51\u7edc\u522b\u540d\u5bf9\u5176\u4ed6\u5bb9\u5668\u8fdb\u884c\u8bbf\u95ee\u4e86\u3002\n\n### \u7aef\u53e3\u6620\u5c04\n\n\u5728 Docker Compose \u7684\u6bcf\u4e2a\u670d\u52a1\u914d\u7f6e\u91cc\uff0c\u6211\u4eec\u8fd8\u770b\u5230\u4e86 ports \u8fd9\u4e2a\u914d\u7f6e\u9879\uff0c\u5b83\u662f\u7528\u6765\u5b9a\u4e49\u7aef\u53e3\u6620\u5c04\u7684\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5b83\u8fdb\u884c\u5bbf\u4e3b\u673a\u4e0e\u5bb9\u5668\u7aef\u53e3\u7684\u6620\u5c04\uff0c\u8fd9\u4e2a\u914d\u7f6e\u4e0e docker CLI \u4e2d `-p` \u9009\u9879\u7684\u4f7f\u7528\u65b9\u6cd5\u662f\u8fd1\u4f3c\u7684\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e YAML \u683c\u5f0f\u5bf9 xx:yy \u8fd9\u79cd\u683c\u5f0f\u7684\u89e3\u6790\u6709\u7279\u6b8a\u6027\uff0c\u5728\u8bbe\u7f6e\u5c0f\u4e8e 60 \u7684\u503c\u65f6\uff0c\u4f1a\u88ab\u5f53\u6210\u65f6\u95f4\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\u6765\u5904\u7406\uff0c\u6240\u4ee5\u6211\u4eec\u6700\u597d\u4f7f\u7528\u5f15\u53f7\u5c06\u7aef\u53e3\u6620\u5c04\u7684\u5b9a\u4e49\u5305\u88f9\u8d77\u6765\uff0c\u907f\u514d\u6b67\u4e49\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86 Docker Compose \u4e2d\u5e38\u89c1\u5b9a\u4e49\u548c\u914d\u7f6e\u7684\u65b9\u6cd5\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u5b9e\u8df5\u9898\uff1a\n\n> \u5c1d\u8bd5\u5229\u7528 Docker Compose \u4ee5\u53ca\u4e4b\u524d\u6240\u5b66\u4e60\u7684 Docker \u77e5\u8bc6\uff0c\u4e3a\u81ea\u5df1\u6b63\u5728\u5f00\u53d1\u7684\u5e94\u7528\u642d\u5efa\u4e00\u4e2a Docker \u8fd0\u884c\u73af\u5883\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker Compose \u7684\u914d\u7f6e\u65b9\u6cd5\u8fd8\u6709\u7591\u95ee\uff0c\u6216\u8005\u6709\u81ea\u5df1\u7684\u4f7f\u7528\u6280\u5de7\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u7ec4\u5408\u5e94\u7528\u5e38\u7528\u7684_Docker_Compose_\u914d\u7f6e\u9879.md", "create_date": "2020-02-18T21:18:39.231", "order": 16}}, {"model": "subject.chapter", "pk": 75, "fields": {"title": "\u7ec4\u5408\u5e94\u7528\uff1a\u4f7f\u7528 Docker Compose \u7ba1\u7406\u5bb9\u5668", "topic": 3, "md5": "5d5bd2fbdea212713bc8f39d48a2023c", "md_body": "# \u4f7f\u7528 Docker Compose \u7ba1\u7406\u5bb9\u5668\n\n\u901a\u8fc7\u4e4b\u524d\u7684\u4ecb\u7ecd\uff0c\u6211\u4eec\u5df2\u7ecf\u57fa\u672c\u638c\u63e1\u4e86\u6784\u5efa\u3001\u8fd0\u884c\u5bb9\u5668\u7684\u65b9\u6cd5\uff0c\u4f46\u8fd9\u8fd8\u8fdc\u8fdc\u4e0d\u591f\uff0c\u7531\u4e8e Docker \u91c7\u7528\u8f7b\u91cf\u7ea7\u5bb9\u5668\u7684\u8bbe\u8ba1\uff0c\u6bcf\u4e2a\u5bb9\u5668\u4e00\u822c\u53ea\u8fd0\u884c\u4e00\u4e2a\u8f6f\u4ef6\uff0c\u800c\u76ee\u524d\u7edd\u5927\u591a\u6570\u5e94\u7528\u7cfb\u7edf\u90fd\u7edd\u4e0d\u662f\u4e00\u4e2a\u8f6f\u4ef6\u6240\u80fd\u7ec4\u6210\u7684\u3002\u867d\u7136\u6211\u4eec\u4e4b\u524d\u63d0\u5230\u4e86\u5bb9\u5668\u95f4\u4e92\u76f8\u8fde\u63a5\u3001\u4ea4\u6362\u6570\u636e\u7684\u5404\u79cd\u65b9\u6cd5\uff0c\u901a\u8fc7\u8fd9\u4e9b\u65b9\u6cd5\u8db3\u4ee5\u642d\u5efa\u8d77\u5b8c\u6574\u7684\u7528\u4e8e\u5e94\u7528\u7cfb\u7edf\u8fd0\u884c\u7684\u5bb9\u5668\u7fa4\uff0c\u4f46\u662f\u8fd9\u663e\u7136\u8fd8\u4e0d\u591f\uff0c\u8fd9\u4e2a\u5bb9\u5668\u7fa4\u7684\u642d\u5efa\u9700\u8981\u6267\u884c\u592a\u591a\u547d\u4ee4\uff0c\u66f4\u91cd\u8981\u7684\u662f\u9700\u8981\u8003\u8651\u592a\u591a\u5e94\u7528\u548c\u5bb9\u5668\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u5904\u7406\uff0c\u662f\u4e00\u6ce2\u4ee4\u4eba\u5934\u5927\u7684\u64cd\u4f5c\u3002\u5728\u8fd9\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u4ecb\u7ecd\u5982\u4f55\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002\n\n## \u89e3\u51b3\u5bb9\u5668\u7ba1\u7406\u95ee\u9898\n\n\u62ff\u4efb\u4f55\u4e00\u4e2a\u76f8\u5bf9\u5b8c\u6574\u7684\u5e94\u7528\u7cfb\u7edf\u6765\u8bf4\uff0c\u90fd\u4e0d\u53ef\u80fd\u662f\u7531\u4e00\u4e2a\u7a0b\u5e8f\u72ec\u7acb\u652f\u6491\u7684\uff0c\u800c\u5bf9\u4e8e\u4f7f\u7528 Docker \u6765\u90e8\u7f72\u7684\u5206\u5e03\u5f0f\u8ba1\u7b97\u670d\u52a1\u66f4\u662f\u8fd9\u6837\u3002\u968f\u7740\u65f6\u4ee3\u7684\u53d1\u5c55\u548c\u6280\u672f\u6f14\u8fdb\uff0c\u6211\u4eec\u8d8a\u6765\u8d8a\u63a8\u5d07\u5c06\u5927\u578b\u670d\u52a1\u62c6\u5206\u6210\u8f83\u5c0f\u7684\u5fae\u670d\u52a1\uff0c\u5206\u522b\u90e8\u7f72\u5230\u72ec\u7acb\u7684\u673a\u5668\u6216\u5bb9\u5668\u4e2d\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u7684\u5e94\u7528\u7cfb\u7edf\u5f80\u5f80\u7531\u6570\u5341\u4e2a\u751a\u81f3\u4e0a\u767e\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6216\u5fae\u670d\u52a1\u7ec4\u6210\u3002\u5373\u4f7f\u662f\u4e00\u4e2a\u5c0f\u7684\u5fae\u670d\u52a1\u6a21\u5757\uff0c\u901a\u5e38\u90fd\u9700\u8981\u591a\u4e2a\u5e94\u7528\u534f\u4f5c\u5b8c\u6210\u5de5\u4f5c\u3002\n\n\u6211\u4eec\u7f16\u5199\u4e00\u4e2a\u5c0f\u578b\u7684\u5fae\u670d\u52a1\u6a21\u5757\uff0c\u867d\u7136\u6211\u4eec\u7f16\u5199\u4ee3\u7801\u4e3b\u8981\u9488\u5bf9\u7684\u662f\u5176\u4e2d\u7684\u5e94\u7528\u90e8\u5206\uff0c\u4f46\u5982\u679c\u6211\u4eec\u8981\u5b8c\u6574\u7684\u8fdb\u884c\u5f00\u53d1\u3001\u6d4b\u8bd5\uff0c\u4e0e\u5e94\u7528\u76f8\u5173\u7684\u5468\u8fb9\u8f6f\u4ef6\u5fc5\u7136\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002\n\n\u867d\u7136 Docker Engine \u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u4e86\u5bf9\u5e94\u7528\u8fd0\u884c\u73af\u5883\u7684\u5c01\u88c5\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u9700\u8981\u8bb0\u5f55\u590d\u6742\u7684\u5e94\u7528\u73af\u5883\u642d\u5efa\u8fc7\u7a0b\uff0c\u901a\u8fc7\u7b80\u5355\u7684\u914d\u7f6e\u4fbf\u53ef\u4ee5\u5c06\u5e94\u7528\u8fd0\u884c\u8d77\u6765\u4e86\uff0c\u4f46\u8fd9\u53ea\u662f\u9488\u5bf9\u5355\u4e2a\u5bb9\u5668\u6216\u5355\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u7684\u3002\u5982\u679c\u5ef6\u4f38\u5230\u7531\u591a\u4e2a\u5e94\u7528\u7ec4\u6210\u7684\u5e94\u7528\u7cfb\u7edf\uff0c\u90a3\u60c5\u51b5\u5c31\u7a0d\u663e\u590d\u6742\u4e86\u3002\n\n\u5c31\u62ff\u6700\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u8bf4\u5427\uff0c\u5982\u679c\u6211\u4eec\u8981\u4e3a\u6211\u4eec\u7684\u5e94\u7528\u5bb9\u5668\u51c6\u5907\u4e00\u4e2a MySQL \u5bb9\u5668\u548c\u4e00\u4e2a Redis \u5bb9\u5668\uff0c\u90a3\u4e48\u5728\u6bcf\u6b21\u542f\u52a8\u65f6\uff0c\u6211\u4eec\u5148\u8981\u5c06 MySQL \u5bb9\u5668\u548c Redis \u5bb9\u5668\u542f\u52a8\u8d77\u6765\uff0c\u518d\u5c06\u5e94\u7528\u5bb9\u5668\u8fd0\u884c\u8d77\u6765\u3002\u8fd9\u5176\u4e2d\u8fd8\u4e0d\u8981\u5fd8\u4e86\u5728\u521b\u5efa\u5e94\u7528\u5bb9\u5668\u65f6\u5c06\u5bb9\u5668\u7f51\u7edc\u8fde\u63a5\u5230 MySQL \u5bb9\u5668\u548c Redis \u5bb9\u5668\u4e0a\uff0c\u4ee5\u4fbf\u5e94\u7528\u8fde\u63a5\u4e0a\u5b83\u4eec\u5e76\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002\n\n\u8fd9\u8fd8\u4e0d\u591f\uff0c\u5982\u679c\u6211\u4eec\u8fd8\u5bf9\u5bb9\u5668\u8fdb\u884c\u4e86\u5404\u79cd\u914d\u7f6e\uff0c\u6211\u4eec\u6700\u597d\u8fd8\u5f97\u5c06\u5bb9\u5668\u521b\u5efa\u548c\u914d\u7f6e\u7684\u547d\u4ee4\u4fdd\u5b58\u4e0b\u6765\uff0c\u4ee5\u4fbf\u4e0b\u6b21\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002\n\n\u5982\u679c\u6211\u4eec\u8981\u60f3\u8ba9\u8fd9\u5957\u4f53\u7cfb\u50cf `docker run` \u548c `docker rm` \u90a3\u6837\u81ea\u5982\u7684\u8fdb\u884c\u65e0\u75d5\u5207\u6362\uff0c\u90a3\u5c31\u66f4\u52a0\u9ebb\u70e6\u4e86\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u7f16\u5199\u4e00\u4e9b\u811a\u672c\u624d\u80fd\u4e0d\u81f3\u4e8e\u88ab\u7ed5\u5230\u547d\u4ee4\u7684\u6bdb\u7ebf\u7403\u91cc\u3002\n\n\u8bf4\u4e86\u8fd9\u4e48\u591a\uff0c\u5176\u5b9e\u6838\u5fc3\u8fd8\u662f\u7f3a\u5c11\u4e00\u4e2a\u5bf9\u5bb9\u5668\u7ec4\u5408\u8fdb\u884c\u7ba1\u7406\u7684\u4e1c\u897f\u3002\n\n### Docker Compose\n\n\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5c31\u4e0d\u5f97\u4e0d\u5f15\u51fa\u5728\u6211\u4eec\u5f00\u53d1\u4e2d\u6700\u5e38\u4f7f\u7528\u7684\u591a\u5bb9\u5668\u5b9a\u4e49\u548c\u8fd0\u884c\u8f6f\u4ef6\uff0c\u4e5f\u5c31\u662f Docker Compose \u4e86\u3002\n\n\u5982\u679c\u8bf4 Dockerfile \u662f\u5c06\u5bb9\u5668\u5185\u8fd0\u884c\u73af\u5883\u7684\u642d\u5efa\u56fa\u5316\u4e0b\u6765\uff0c\u90a3\u4e48 Docker Compose \u6211\u4eec\u5c31\u53ef\u4ee5\u7406\u89e3\u4e3a\u5c06\u591a\u4e2a\u5bb9\u5668\u8fd0\u884c\u7684\u65b9\u5f0f\u548c\u914d\u7f6e\u56fa\u5316\u4e0b\u6765\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/4/1663e6a38cd88368?w=1600&h=704&f=png&s=781358)\n\n\u5728 Docker Compose \u91cc\uff0c\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06\u6240\u6709\u4e0e\u5e94\u7528\u7cfb\u7edf\u76f8\u5173\u7684\u8f6f\u4ef6\u53ca\u5b83\u4eec\u5bf9\u5e94\u7684\u5bb9\u5668\u8fdb\u884c\u914d\u7f6e\uff0c\u4e4b\u540e\u4f7f\u7528 Docker Compose \u63d0\u4f9b\u7684\u547d\u4ee4\u8fdb\u884c\u542f\u52a8\uff0c\u5c31\u80fd\u8ba9 Docker Compose \u5c06\u521a\u624d\u6211\u4eec\u6240\u63d0\u5230\u7684\u90a3\u4e9b\u590d\u6742\u95ee\u9898\u89e3\u51b3\u6389\u3002\n\n## \u5b89\u88c5 Docker Compose\n\n\u867d\u7136 Docker Compose \u76ee\u524d\u4e5f\u662f\u7531 Docker \u5b98\u65b9\u4e3b\u8981\u7ef4\u62a4\uff0c\u4f46\u5176\u5374\u4e0d\u5c5e\u4e8e Docker Engine \u7684\u4e00\u90e8\u5206\uff0c\u800c\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u8f6f\u4ef6\u3002\u6240\u4ee5\u5982\u679c\u6211\u4eec\u8981\u5728 Linux \u4e2d\u4f7f\u7528\u5b83\uff0c\u8fd8\u5fc5\u987b\u8981\u5355\u72ec\u4e0b\u8f7d\u4f7f\u7528\u3002\n\nDocker Compose \u662f\u4e00\u4e2a\u7531 Python \u7f16\u5199\u7684\u8f6f\u4ef6\uff0c\u5728\u62e5\u6709 Python \u8fd0\u884c\u73af\u5883\u7684\u673a\u5668\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u5b83\uff0c\u4e0d\u9700\u8981\u5176\u5b83\u7684\u64cd\u4f5c\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u4e0b\u8f7d Docker Compose \u5230\u5e94\u7528\u6267\u884c\u76ee\u5f55\uff0c\u5e76\u9644\u4e0a\u8fd0\u884c\u6743\u9650\uff0c\u8fd9\u6837 Docker Compose \u5c31\u53ef\u4ee5\u5728\u673a\u5668\u4e2d\u4f7f\u7528\u4e86\u3002\n\n```\n$ sudo curl -L \"https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n$ sudo chmod +x /usr/local/bin/docker-compose\n$\n$ sudo docker-compose version\ndocker-compose version 1.21.2, build a133471\ndocker-py version: 3.3.0\nCPython version: 3.6.5\nOpenSSL version: OpenSSL 1.0.1t  3 May 2016\n\n```\n\n\u6211\u4eec\u4e5f\u80fd\u591f\u901a\u8fc7 Python \u7684\u5305\u7ba1\u7406\u5de5\u5177 pip \u6765\u5b89\u88c5 Docker Compose\u3002\n\n```\n$ sudo pip install docker-compose\n\n```\n\n### \u5728 Windows \u548c macOS \u4e2d\u7684 Docker Compose\n\n\u5728\u6211\u4eec\u66f4\u5e38\u7528\u4e8e\u5f00\u53d1\u7684 Windows \u548c macOS \u4e2d\uff0c\u4f7f\u7528 Docker Compose \u4f1a\u6765\u5f97\u66f4\u52a0\u65b9\u4fbf\u3002\u4e0d\u8bba\u4f60\u662f\u4f7f\u7528 Docker for Win \u8fd8\u662f Docker for Mac\uff0c\u4ea6\u6216\u662f Docker Toolbox \u6765\u642d\u5efa Docker \u8fd0\u884c\u73af\u5883\uff0c\u4f60\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 `docker-compose` \u8fd9\u4e2a\u547d\u4ee4\u3002\u8fd9\u4e09\u6b3e\u8f6f\u4ef6\u90fd\u5df2\u7ecf\u5c06 Docker Compose \u5185\u7f6e\u5728\u5176\u4e2d\uff0c\u4f9b\u6211\u4eec\u4f7f\u7528\u3002\n\n## Docker Compose \u7684\u57fa\u672c\u4f7f\u7528\u903b\u8f91\n\n\u5982\u679c\u5c06\u4f7f\u7528 Docker Compose \u7684\u6b65\u9aa4\u7b80\u5316\u6765\u8bf4\uff0c\u53ef\u4ee5\u5206\u6210\u4e09\u6b65\u3002\n\n1.  \u5982\u679c\u9700\u8981\u7684\u8bdd\uff0c\u7f16\u5199\u5bb9\u5668\u6240\u9700\u955c\u50cf\u7684 Dockerfile\uff1b( \u4e5f\u53ef\u4ee5\u4f7f\u7528\u73b0\u6709\u7684\u955c\u50cf )\n2.  \u7f16\u5199\u7528\u4e8e\u914d\u7f6e\u5bb9\u5668\u7684 docker-compose.yml\uff1b\n3.  \u4f7f\u7528 docker-compose \u547d\u4ee4\u542f\u52a8\u5e94\u7528\u3002\n\n\u51c6\u5907\u955c\u50cf\u8fd9\u4e00\u8fc7\u7a0b\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf\u638c\u63e1\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u7b80\u5355\u6765\u770b\u770b\u540e\u9762\u4e24\u4e2a\u6b65\u9aa4\u3002\n\n### \u7f16\u5199 Docker Compose \u914d\u7f6e\n\n\u914d\u7f6e\u6587\u4ef6\u662f Docker Compose \u7684\u6838\u5fc3\u90e8\u5206\uff0c\u6211\u4eec\u6b63\u662f\u901a\u8fc7\u5b83\u53bb\u5b9a\u4e49\u7ec4\u6210\u5e94\u7528\u670d\u52a1\u5bb9\u5668\u7fa4\u7684\u5404\u9879\u914d\u7f6e\uff0c\u800c\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\uff0c\u5219\u662f\u4f7f\u7528 Docker Compose \u8fc7\u7a0b\u4e2d\u6700\u6838\u5fc3\u7684\u4e00\u4e2a\u6b65\u9aa4\u3002\n\nDocker Compose \u7684\u914d\u7f6e\u6587\u4ef6\u662f\u4e00\u4e2a\u57fa\u4e8e [YAML](http://yaml.org/) \u683c\u5f0f\u7684\u6587\u4ef6\u3002\u5173\u4e8e YAML \u7684\u8bed\u6cd5\u5927\u5bb6\u53ef\u4ee5\u5728\u7f51\u4e0a\u627e\u5230\uff0c\u8fd9\u91cc\u4e0d\u518d\u7ec6\u8bf4\uff0c\u603b\u7684\u6765\u8bf4\uff0cYAML \u662f\u4e00\u79cd\u6e05\u6670\u3001\u7b80\u5355\u7684\u6807\u8bb0\u8bed\u8a00\uff0c\u4f60\u751a\u81f3\u90fd\u53ef\u4ee5\u5728\u770b\u8fc7\u51e0\u4e2a\u4f8b\u5b50\u540e\u6478\u7d22\u51fa\u5b83\u7684\u8bed\u6cd5\u3002\n\n\u4e0e Dockerfile \u91c7\u7528 Dockerfile \u8fd9\u4e2a\u540d\u5b57\u4f5c\u4e3a\u955c\u50cf\u6784\u5efa\u5b9a\u4e49\u7684\u9ed8\u8ba4\u6587\u4ef6\u540d\u4e00\u6837\uff0cDocker Compose \u7684\u914d\u7f6e\u6587\u4ef6\u4e5f\u6709\u4e00\u4e2a\u7f3a\u7701\u7684\u6587\u4ef6\u540d\uff0c\u4e5f\u5c31\u662f docker-compose.yml\uff0c\u5982\u975e\u5fc5\u8981\uff0c\u6211\u5efa\u8bae\u5927\u5bb6\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u540d\u6765\u505a Docker Compose \u9879\u76ee\u7684\u5b9a\u4e49\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u7b80\u5355\u7684 Docker Compose \u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u3002\n\n```\nversion: '3'\n\nservices:\n\n  webapp:\n    build: ./image/webapp\n    ports:\n      - \"5000:5000\"\n    volumes:\n      - ./code:/code\n      - logvolume:/var/log\n    links:\n      - mysql\n      - redis\n\n  redis:\n    image: redis:3.2\n  \n  mysql:\n    image: mysql:5.7\n    environment:\n      - MYSQL_ROOT_PASSWORD=my-secret-pw\n\nvolumes:\n  logvolume: {}\n\n```\n\nDocker Compose \u914d\u7f6e\u6587\u4ef6\u91cc\u53ef\u4ee5\u5305\u542b\u8bb8\u591a\u5185\u5bb9\uff0c\u4ece\u6bcf\u4e2a\u5bb9\u5668\u7684\u5404\u4e2a\u7ec6\u8282\u63a7\u5236\uff0c\u5230\u7f51\u7edc\u3001\u6570\u636e\u5377\u7b49\u7684\u5b9a\u4e49\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u770b\u51e0\u4e2a\u4e3b\u8981\u7684\u7ec6\u8282\u3002\u9996\u5148\u662f version \u8fd9\u4e2a\u914d\u7f6e\uff0c\u8fd9\u4ee3\u8868\u6211\u4eec\u5b9a\u4e49\u7684 docker-compose.yml \u6587\u4ef6\u5185\u5bb9\u6240\u91c7\u7528\u7684\u7248\u672c\uff0c\u76ee\u524d Docker Compose \u7684\u914d\u7f6e\u6587\u4ef6\u5df2\u7ecf\u8fed\u4ee3\u81f3\u4e86\u7b2c\u4e09\u7248\uff0c\u5176\u6240\u652f\u6301\u7684\u529f\u80fd\u4e5f\u8d8a\u6765\u8d8a\u4e30\u5bcc\uff0c\u6240\u4ee5\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u6700\u65b0\u7684\u7248\u672c\u6765\u5b9a\u4e49\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b services \u8fd9\u5757\uff0c\u8fd9\u662f\u6574\u4e2a docker-compose.yml \u7684\u6838\u5fc3\u90e8\u5206\uff0c\u5176\u5b9a\u4e49\u4e86\u5bb9\u5668\u7684\u5404\u9879\u7ec6\u8282\u3002\n\n\u5728 Docker Compose \u91cc\u4e0d\u76f4\u63a5\u4f53\u73b0\u5bb9\u5668\u8fd9\u4e2a\u6982\u5ff5\uff0c\u8fd9\u662f\u628a service \u4f5c\u4e3a\u914d\u7f6e\u7684\u6700\u5c0f\u5355\u5143\u3002\u867d\u7136\u6211\u4eec\u770b\u4e0a\u53bb\u6bcf\u4e2a service \u91cc\u7684\u914d\u7f6e\u5185\u5bb9\u5c31\u50cf\u662f\u5728\u914d\u7f6e\u5bb9\u5668\uff0c\u4f46\u5176\u5b9e service \u4ee3\u8868\u7684\u662f\u4e00\u4e2a\u5e94\u7528\u96c6\u7fa4\u7684\u914d\u7f6e\u3002\u6bcf\u4e2a service \u5b9a\u4e49\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u901a\u8fc7\u7279\u5b9a\u7684\u914d\u7f6e\u8fdb\u884c\u6c34\u5e73\u6269\u5145\uff0c\u5c06\u540c\u6837\u7684\u5bb9\u5668\u590d\u5236\u6570\u4efd\u5f62\u6210\u4e00\u4e2a\u5bb9\u5668\u96c6\u7fa4\u3002\u800c Docker Compose \u80fd\u591f\u5bf9\u8fd9\u4e2a\u96c6\u7fa4\u505a\u5230\u9ed1\u76d2\u6548\u679c\uff0c\u8ba9\u5176\u4ed6\u7684\u5e94\u7528\u548c\u5bb9\u5668\u65e0\u6cd5\u611f\u77e5\u5b83\u4eec\u7684\u5177\u4f53\u7ed3\u6784\u3002\n\n\u5bf9\u4e8e docker-compose.yml \u914d\u7f6e\u7684\u5177\u4f53\u7ec6\u8282\uff0c\u6211\u4eec\u5728\u4e0b\u4e00\u8282\u4e2d\u8fd8\u4f1a\u4e13\u95e8\u8bb2\u89e3\u3002\n\n### \u542f\u52a8\u548c\u505c\u6b62\n\n\u5bf9\u4e8e\u5f00\u53d1\u6765\u8bf4\uff0c\u6700\u5e38\u4f7f\u7528\u7684 Docker Compose \u547d\u4ee4\u5c31\u662f `docker-compose up` \u548c `docker-compose down` \u4e86\u3002\n\n`docker-compose up` \u547d\u4ee4\u7c7b\u4f3c\u4e8e Docker Engine \u4e2d\u7684 `docker run`\uff0c\u5b83\u4f1a\u6839\u636e docker-compose.yml \u4e2d\u914d\u7f6e\u7684\u5185\u5bb9\uff0c\u521b\u5efa\u6240\u6709\u7684\u5bb9\u5668\u3001\u7f51\u7edc\u3001\u6570\u636e\u5377\u7b49\u7b49\u5185\u5bb9\uff0c\u5e76\u5c06\u5b83\u4eec\u542f\u52a8\u3002\u4e0e `docker run` \u4e00\u6837\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b `docker-compose up` \u4f1a\u5728\u201c\u524d\u53f0\u201d\u8fd0\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 `-d` \u9009\u9879\u4f7f\u5176\u201c\u540e\u53f0\u201d\u8fd0\u884c\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u5927\u591a\u6570\u60c5\u51b5\u90fd\u4f1a\u52a0\u4e0a `-d` \u9009\u9879\u3002\n\n```\n$ sudo docker-compose up -d\n\n```\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c`docker-compose` \u547d\u4ee4\u9ed8\u8ba4\u4f1a\u8bc6\u522b\u5f53\u524d\u63a7\u5236\u53f0\u6240\u5728\u76ee\u5f55\u5185\u7684 docker-compose.yml \u6587\u4ef6\uff0c\u800c\u4f1a\u4ee5\u8fd9\u4e2a\u76ee\u5f55\u7684\u540d\u5b57\u4f5c\u4e3a\u7ec4\u88c5\u7684\u5e94\u7528\u9879\u76ee\u7684\u540d\u79f0\u3002\u5982\u679c\u6211\u4eec\u9700\u8981\u6539\u53d8\u5b83\u4eec\uff0c\u53ef\u4ee5\u901a\u8fc7\u9009\u9879 `-f` \u6765\u4fee\u6539\u8bc6\u522b\u7684 Docker Compose \u914d\u7f6e\u6587\u4ef6\uff0c\u901a\u8fc7 `-p` \u9009\u9879\u6765\u5b9a\u4e49\u9879\u76ee\u540d\u3002\n\n```\n$ sudo docker-compose -f ./compose/docker-compose.yml -p myapp up -d\n\n```\n\n\u4e0e `docker-compose up` \u76f8\u53cd\uff0c`docker-compose down` \u547d\u4ee4\u7528\u4e8e\u505c\u6b62\u6240\u6709\u7684\u5bb9\u5668\uff0c\u5e76\u5c06\u5b83\u4eec\u5220\u9664\uff0c\u540c\u65f6\u6d88\u9664\u7f51\u7edc\u7b49\u914d\u7f6e\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f\u51e0\u4e4e\u5c06\u8fd9\u4e2a Docker Compose \u9879\u76ee\u7684\u6240\u6709\u5f71\u54cd\u4ece Docker \u4e2d\u6e05\u9664\u3002\n\n```\n$ sudo docker-compose down\n\n```\n\n\u5982\u679c\u6761\u4ef6\u5141\u8bb8\uff0c\u6211\u66f4\u5efa\u8bae\u5927\u5bb6\u50cf\u5bb9\u5668\u4f7f\u7528\u4e00\u6837\u5bf9\u5f85 Docker Compose \u9879\u76ee\uff0c\u505a\u5230\u968f\u7528\u968f\u542f\uff0c\u968f\u505c\u968f\u5220\u3002\u4e5f\u5c31\u662f\u4f7f\u7528\u7684\u65f6\u5019\u901a\u8fc7 `docker-compose up` \u8fdb\u884c\uff0c\u800c\u77ed\u65f6\u95f4\u5185\u4e0d\u518d\u9700\u8981\u65f6\uff0c\u901a\u8fc7 `docker-compose down` \u6e05\u7406\u5b83\u3002\n\n\u501f\u52a9 Docker \u5bb9\u5668\u7684\u79d2\u7ea7\u542f\u52a8\u548c\u505c\u6b62\u7279\u6027\uff0c\u6211\u4eec\u5728\u4f7f\u7528 `docker-compose up` \u548c `docker-compose down` \u65f6\u53ef\u4ee5\u975e\u5e38\u5feb\u7684\u5b8c\u6210\u64cd\u4f5c\u3002\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e0d\u5230\u534a\u5206\u949f\u7684\u65f6\u95f4\u5185\u505c\u6b62\u4e00\u5957\u73af\u5883\uff0c\u5207\u6362\u5230\u53e6\u5916\u4e00\u5957\u73af\u5883\uff0c\u8fd9\u5bf9\u4e8e\u7ecf\u5e38\u8fdb\u884c\u591a\u4e2a\u9879\u76ee\u5f00\u53d1\u7684\u670b\u53cb\u6765\u8bf4\uff0c\u7edd\u5bf9\u662f\u798f\u97f3\u3002\n\n\u901a\u8fc7 Docker \u8ba9\u6211\u4eec\u80fd\u591f\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u642d\u5efa\u4e00\u5957\u4e0d\u53d7\u5e72\u6270\u7684\u72ec\u7acb\u73af\u5883\uff0c\u8ba9\u5f00\u53d1\u8fc7\u7a0b\u80fd\u591f\u57fa\u4e8e\u7a33\u5b9a\u7684\u73af\u5883\u4e0b\u8fdb\u884c\u3002\u800c Docker Compose \u5219\u8ba9\u6211\u4eec\u66f4\u8fd1\u4e00\u6b65\uff0c\u540c\u65f6\u8ba9\u6211\u4eec\u5904\u7406\u597d\u591a\u5957\u5f00\u53d1\u73af\u5883\uff0c\u5e76\u8fdb\u884c\u5feb\u901f\u5207\u6362\u3002\n\n### \u5bb9\u5668\u547d\u4ee4\n\n\u9664\u4e86\u542f\u52a8\u548c\u505c\u6b62\u547d\u4ee4\u5916\uff0cDocker Compose \u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5f88\u591a\u76f4\u63a5\u64cd\u4f5c\u670d\u52a1\u7684\u547d\u4ee4\u3002\u4e4b\u524d\u6211\u4eec\u8bf4\u4e86\uff0c\u670d\u52a1\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u7ec4\u76f8\u540c\u5bb9\u5668\u7684\u96c6\u5408\uff0c\u6240\u4ee5\u64cd\u4f5c\u670d\u52a1\u5c31\u6709\u70b9\u50cf\u64cd\u4f5c\u5bb9\u5668\u4e00\u6837\u3002\n\n\u8fd9\u4e9b\u547d\u4ee4\u770b\u4e0a\u53bb\u90fd\u548c Docker Engine \u4e2d\u5bf9\u5355\u4e2a\u5bb9\u5668\u8fdb\u884c\u64cd\u4f5c\u7684\u547d\u4ee4\u7c7b\u4f3c\uff0c\u6211\u4eec\u6765\u770b\u51e0\u4e2a\u5e38\u89c1\u7684\u3002\n\n\u5728 Docker Engine \u4e2d\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u67e5\u770b\u5bb9\u5668\u4e2d\u4e3b\u8fdb\u7a0b\u7684\u8f93\u51fa\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 `docker logs` \u547d\u4ee4\u3002\u800c\u7531\u4e8e\u5728 Docker Compose \u4e0b\u8fd0\u884c\u7684\u670d\u52a1\uff0c\u5176\u547d\u540d\u90fd\u662f\u7531 Docker Compose \u81ea\u52a8\u5b8c\u6210\u7684\uff0c\u5982\u679c\u6211\u4eec\u76f4\u63a5\u4f7f\u7528 `docker logs` \u5c31\u9700\u8981\u5148\u627e\u5230\u5bb9\u5668\u7684\u540d\u5b57\uff0c\u8fd9\u663e\u7136\u6709\u4e9b\u9ebb\u70e6\u4e86\u3002\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 `docker-compose logs` \u547d\u4ee4\u6765\u5b8c\u6210\u8fd9\u9879\u5de5\u4f5c\u3002\n\n```\n$ sudo docker-compose logs nginx\n\n```\n\n\u5728 `docker-compose logs` \u8854\u63a5\u7684\u662f Docker Compose \u4e2d\u6240\u5b9a\u4e49\u7684\u670d\u52a1\u7684\u540d\u79f0\u3002\n\n\u540c\u7406\uff0c\u5728 Docker Compose \u8fd8\u6709\u51e0\u4e2a\u7c7b\u4f3c\u7684\u547d\u4ee4\u53ef\u4ee5\u5355\u72ec\u63a7\u5236\u67d0\u4e2a\u6216\u67d0\u4e9b\u670d\u52a1\u3002\n\n\u901a\u8fc7 `docker-compose create`\uff0c`docker-compose start` \u548c `docker-compose stop` \u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u4e0e `docker create`\uff0c`docker start` \u548c `docker stop` \u76f8\u4f3c\u7684\u6548\u679c\uff0c\u53ea\u4e0d\u8fc7\u64cd\u4f5c\u7684\u5bf9\u8c61\u7531 Docker Engine \u4e2d\u7684\u5bb9\u5668\u53d8\u4e3a\u4e86 Docker Compose \u4e2d\u7684\u670d\u52a1\u3002\n\n```\n$ sudo docker-compose create webapp\n$ sudo docker-compose start webapp\n$ sudo docker-compose stop webapp\n\n```\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86 Docker Compose \u8fd9\u4e2a\u7528\u4e8e\u7ba1\u7406\u5bb9\u5668\u7684\u5de5\u5177\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u601d\u8003\u9898\uff1a\n\n> \u5728\u6211\u4eec\u7684\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u7684\u5408\u7406\u5229\u7528 Docker Compose \u8fdb\u884c\u5bb9\u5668\u7ba1\u7406\u5462\uff1f\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u770b\u6cd5\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker Compose \u548c\u5bb9\u5668\u7ba1\u7406\u8fd8\u6709\u4ec0\u4e48\u7591\u60d1\uff0c\u6216\u8005\u6709\u81ea\u5df1\u7684\u60f3\u6cd5\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u7ec4\u5408\u5e94\u7528\u4f7f\u7528_Docker_Compose_\u7ba1\u7406\u5bb9\u5668.md", "create_date": "2020-02-18T21:18:39.250", "order": 15}}, {"model": "subject.chapter", "pk": 76, "fields": {"title": "\u7ec4\u5408\u5e94\u7528\uff1a\u5e94\u7528\u4e8e\u670d\u52a1\u5316\u5f00\u53d1", "topic": 3, "md5": "556888b67f989faa09febe2cd19c8bcd", "md_body": "# \u5e94\u7528\u4e8e\u670d\u52a1\u5316\u5f00\u53d1\n\n\u4e0a\u4e00\u8282\u91cc\u6211\u4eec\u8c08\u5230\u4e86\u5c0f\u578b\u7684\u72ec\u7acb\u9879\u76ee\u5982\u4f55\u4f7f\u7528 Docker Compose \u6765\u642d\u5efa\u7a0b\u5e8f\u7684\u8fd0\u884c\u73af\u5883\uff0c\u5bf9\u4e8e\u7531\u591a\u4eba\u6216\u591a\u90e8\u95e8\u53c2\u4e0e\u7684\u4e2d\u5927\u578b\u670d\u52a1\u5316\u67b6\u6784\u7684\u9879\u76ee\uff0c\u4ec5\u7531\u4e00\u4e2a Docker Compose \u9879\u76ee\u6765\u7ba1\u7406\u5b83\u4eec\u7684\u8fd0\u884c\u73af\u5883\u663e\u7136\u662f\u4e0d\u5207\u5b9e\u9645\u7684\u3002\u5728\u8fd9\u4e00\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u5c31\u8c08\u8c08\u5982\u4f55\u5728\u670d\u52a1\u5316\u5f00\u53d1\u4e2d\u5408\u7406\u5229\u7528 Docker \u6765\u642d\u5efa\u73af\u5883\u3002\n\n## \u670d\u52a1\u5f00\u53d1\u73af\u5883\n\n\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u6211\u4eec\u4f9d\u7136\u6765\u8bbe\u5b9a\u4e00\u4e2a\u573a\u666f\u3002\u5728\u8fd9\u91cc\uff0c\u5047\u5b9a\u6211\u4eec\u5904\u4e8e\u4e00\u4e2a Dubbo \u6cbb\u4e0b\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\uff0c\u800c\u5de5\u4f5c\u662f\u5f00\u53d1\u7cfb\u7edf\u4e2d\u67d0\u4e00\u9879\u5fae\u670d\u52a1\u3002\n\n\u5fae\u670d\u52a1\u5f00\u53d1\u4e0e\u4e0a\u4e00\u8282\u91cc\u6211\u4eec\u63d0\u5230\u7684\u5c0f\u578b\u9879\u76ee\u5f00\u53d1\u5728\u73af\u5883\u642d\u5efa\u4e0a\u6709\u4e00\u5b9a\u7684\u533a\u522b\uff0c\u6211\u4eec\u8981\u5408\u7406\u5730\u8c03\u6574 Docker \u7684\u4f7f\u7528\u65b9\u6cd5\u548c\u7b56\u7565\uff0c\u5c31\u5fc5\u987b\u5148\u4e86\u89e3\u8fd9\u4e9b\u533a\u522b\u3002\n\n\u5728\u5fae\u670d\u52a1\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u6240\u5f00\u53d1\u7684\u529f\u80fd\u90fd\u4e0d\u662f\u5b8c\u6574\u7684\u7cfb\u7edf\uff0c\u5f88\u591a\u529f\u80fd\u9700\u8981\u4e0e\u5176\u4ed6\u670d\u52a1\u4e4b\u95f4\u914d\u5408\u624d\u80fd\u6b63\u5e38\u8fd0\u8f6c\uff0c\u800c\u6211\u4eec\u5f00\u53d1\u6240\u4f7f\u7528\u7684\u673a\u5668\u65f6\u5e38\u65e0\u6cd5\u6ee1\u8db3\u6211\u4eec\u5728\u4e00\u53f0\u673a\u5668\u4e0a\u5c06\u8fd9\u4e9b\u76f8\u5173\u670d\u52a1\u540c\u65f6\u8fd0\u884c\u8d77\u6765\u3002\n\n\u6211\u4eec\u4ec5\u4ec5\u662f\u5f00\u53d1\u67d0\u4e00\u90e8\u5206\u670d\u52a1\u7684\u5185\u5bb9\uff0c\u65e2\u5bf9\u5176\u4ed6\u670d\u52a1\u7684\u8fd0\u8f6c\u673a\u5236\u4e0d\u592a\u4e86\u89e3\uff0c\u53c8\u5b8c\u5168\u6ca1\u6709\u5fc5\u8981\u5728\u81ea\u5df1\u7684\u673a\u5668\u4e0a\u8fd0\u884c\u5176\u4ed6\u7684\u670d\u52a1\u3002\u6240\u4ee5\u6211\u4eec\u6700\u4f73\u7684\u5b9e\u8df5\u81ea\u7136\u5c31\u662f\u8ba9\u53c2\u4e0e\u7cfb\u7edf\u4e2d\u670d\u52a1\u5f00\u53d1\u7684\u540c\u4e8b\uff0c\u5404\u81ea\u7ef4\u62a4\u81ea\u5df1\u5f00\u53d1\u670d\u52a1\u7684\u73af\u5883\uff0c\u800c\u76f4\u63a5\u63d0\u4f9b\u7ed9\u6211\u4eec\u5bf9\u5e94\u7684\u8fde\u63a5\u5730\u5740\u4f7f\u7528\u670d\u52a1\u5373\u53ef\u3002\n\n\u66f4\u786e\u5207\u5730\u8bf4\uff0c\u6211\u4eec\u5728\u5f00\u53d1\u4e2d\uff0c\u53ea\u9700\u8981\u5728\u672c\u5730\u642d\u5efa\u8d77\u81ea\u5df1\u6240\u5f00\u53d1\u670d\u52a1\u7684\u8fd0\u884c\u73af\u5883\uff0c\u518d\u4e0e\u5176\u4ed6\u5f00\u53d1\u8005\u642d\u5efa\u7684\u73af\u5883\u4e92\u8054\u5373\u53ef\u3002\n\n### \u642d\u5efa\u672c\u5730\u73af\u5883\n\n\u5728\u6211\u4eec\u7684\u5f00\u53d1\u673a\u5668\u4e0a\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fd0\u884c\u6211\u4eec\u6b63\u5728\u5f00\u53d1\u7684\u670d\u52a1\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 Docker Compose \u6765\u5b8c\u6210\u3002\u8fd9\u91cc\u6211\u7ed9\u51fa\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u8868\u793a\u4e00\u4e2a\u7b80\u5355\u7684\u5c0f\u670d\u52a1\u8fd0\u884c\u73af\u5883\u3002\n\n```\nversion: \"3\"\n\nnetworks:\n  backend:\n  mesh:\n\nservices:\n\n  mysql:\n    image: mysql:5.7\n    networks:\n      - backend\n    volumes:\n      - ../mysql/my.cnf:/etc/mysql/my.cnf:ro\n      - ../mysql/data:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: my-secret-pw\n    ports:\n      - \"3306:3306\"\n\n  app:\n    build: ./spring\n    networks:\n      - mesh\n      - backend\n    volumes:\n      - ../app:/app\n    depends_on:\n      - mysql\n\n```\n\n\u5173\u4e8e\u8fd9\u91cc Spring \u955c\u50cf\u7684\u4f7f\u7528\u548c\u6539\u9020\u65b9\u6cd5\uff0c\u6211\u5c31\u4e0d\u5c55\u5f00\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u901a\u8fc7 Docker Hub \u4ee5\u53ca Spring \u5b98\u65b9\u6240\u63d0\u4f9b\u7684\u955c\u50cf\uff0c\u7ec3\u4e60\u5982\u4f55\u6539\u9020\u5b83\uff0c\u4f7f\u5b83\u9002\u914d\u81ea\u5df1\u7684\u670d\u52a1\u3002\n\n## \u8de8\u4e3b\u673a\u7f51\u7edc\n\n\u642d\u5efa\u597d\u672c\u5730\u7684\u73af\u5883\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8003\u8651\u5982\u4f55\u4e0e\u670b\u53cb\u4eec\u6240\u642d\u5efa\u7684\u73af\u5883\u8fdb\u884c\u4e92\u8054\u4e86\u3002\n\n\u8fd9\u65f6\u5019\u5927\u5bb6\u4e5f\u8bb8\u4f1a\u60f3\u5230\uff0c\u53ef\u4ee5\u5c06\u670d\u52a1\u6d89\u53ca\u7684\u76f8\u5173\u7aef\u53e3\u901a\u8fc7\u6620\u5c04\u7684\u65b9\u5f0f\u66b4\u9732\u5230\u6211\u4eec\u673a\u5668\u7684\u7aef\u53e3\u4e0a\uff0c\u63a5\u7740\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u5404\u670d\u52a1\u673a\u5668\u7684 IP \u4e0e\u5bf9\u5e94\u7684\u7aef\u53e3\u5c31\u53ef\u4ee5\u8fde\u63a5\u4e86\u3002\n\n\u7136\u800c\u8fd9\u79cd\u65b9\u6cd5\u8fd8\u4e0d\u7b97\u7279\u522b\u65b9\u4fbf\uff0c\u4e00\u6765\u9664\u4e86\u5904\u7406\u6620\u5c04\u5916\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u914d\u7f6e\u9632\u706b\u5899\u7b49\u624d\u80fd\u4f7f\u5176\u4ed6\u7684\u673a\u5668\u6b63\u786e\u8bbf\u95ee\u5230\u5bb9\u5668\uff0c\u4e8c\u6765\u662f\u8fd9\u79cd\u65b9\u5f0f\u6211\u4eec\u4f9d\u7136\u8981\u8bb0\u5f55\u5404\u4e2a\u670d\u52a1\u7684\u7f51\u7edc\u5730\u5740\u7b49\u914d\u7f6e\uff0c\u800c\u5f00\u53d1\u4e2d\u5207\u6362\u5b83\u4eec\u662f\u4e2a\u70e6\u7410\u7684\u8fc7\u7a0b\u3002\n\n\u5728\u4ecb\u7ecd Docker Compose \u7684\u5c0f\u8282\u91cc\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u7f51\u7edc\u522b\u540d ( alias ) \u7684\u65b9\u5f0f\u6765\u66f4\u8f7b\u677e\u5730\u8fde\u63a5\u5176\u4ed6\u5bb9\u5668\uff0c\u5982\u679c\u6211\u4eec\u5728\u670d\u52a1\u5316\u5f00\u53d1\u91cc\u4e5f\u80fd\u8fd9\u4e48\u505a\u5c31\u80fd\u51cf\u5c11\u5f88\u591a\u70e6\u7410\u64cd\u4f5c\u4e86\u3002\n\n\u8981\u5b9e\u73b0\u8bbe\u7f6e\u7f51\u7edc\u522b\u540d\u7684\u76ee\u7684\uff0c\u81ea\u7136\u8981\u5148\u786e\u4fdd\u6240\u6709\u6d89\u53ca\u7684\u5bb9\u5668\u4f4d\u4e8e\u540c\u4e00\u4e2a\u7f51\u7edc\u4e2d\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u5f15\u51fa\u6211\u4eec\u4e4b\u524d\u5728\u7f51\u7edc\u5c0f\u8282\u91cc\u8bf4\u5230\u7684 Overlay \u7f51\u7edc\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/28/166b9a1165699266?w=600&h=312&f=png&s=84054)\n\nOverlay Network \u80fd\u591f\u8de8\u8d8a\u7269\u7406\u4e3b\u673a\u7684\u9650\u5236\uff0c\u8ba9\u591a\u4e2a\u5904\u4e8e\u4e0d\u540c Docker daemon \u5b9e\u4f8b\u4e2d\u7684\u5bb9\u5668\u8fde\u63a5\u5230\u540c\u4e00\u4e2a\u7f51\u7edc\uff0c\u5e76\u4e14\u8ba9\u8fd9\u4e9b\u5bb9\u5668\u611f\u89c9\u8fd9\u4e2a\u7f51\u7edc\u4e0e\u5176\u4ed6\u7c7b\u578b\u7684\u7f51\u7edc\u6ca1\u6709\u533a\u522b\u3002\n\n### Docker Swarm\n\n\u8981\u642d\u5efa Overlay Network \u7f51\u7edc\uff0c\u6211\u4eec\u5c31\u8981\u7528\u5230 Docker Swarm \u8fd9\u4e2a\u5de5\u5177\u4e86\u3002Docker Swarm \u662f Docker \u5185\u7f6e\u7684\u96c6\u7fa4\u5de5\u5177\uff0c\u5b83\u80fd\u591f\u5e2e\u52a9\u6211\u4eec\u66f4\u8f7b\u677e\u5730\u5c06\u670d\u52a1\u90e8\u7f72\u5230 Docker daemon \u7684\u96c6\u7fa4\u4e4b\u4e2d\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/10/28/166b9cfc98bedd76?w=1887&h=985&f=png&s=268427)\n\n\u5728\u771f\u5b9e\u7684\u670d\u52a1\u90e8\u7f72\u91cc\uff0c\u6211\u4eec\u901a\u5e38\u662f\u4f7f\u7528 Docker Compose \u6765\u5b9a\u4e49\u96c6\u7fa4\uff0c\u800c\u901a\u8fc7 Docker Swarm \u6765\u90e8\u7f72\u96c6\u7fa4\u3002\n\n\u5982\u679c\u719f\u6089 Docker \u5468\u8fb9\u77e5\u8bc6\u7684\u670b\u53cb\uff0c\u76f8\u4fe1\u8fd9\u65f6\u5019\u5df2\u7ecf\u60f3\u5230\u4e86\u53e6\u5916\u4e00\u4e2a\u5de5\u5177\uff0c\u5373 Kubernetes ( K8s )\u3002\u6ca1\u9519\uff0cKubernetes \u4e0e\u8fd9\u4e24\u8005\u7684\u7ec4\u5408\u76f8\u6bd4\uff0c\u529f\u80fd\u8981\u4e30\u5bcc\u5f3a\u5927\u5f88\u591a\uff0c\u4e5f\u6b63\u56e0\u6b64\uff0c\u4e0e\u5b83\u76f8\u5173\u7684\u5185\u5bb9\u5b8c\u5168\u8db3\u4ee5\u53e6\u8f9f\u4e00\u672c\u5c0f\u518c\u6765\u8bf4\u3002\u800c\u5728\u5f00\u53d1\u91cc\uff0c\u6211\u4eec\u51e0\u4e4e\u4f7f\u7528\u4e0d\u5230 Kubernetes\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u5c31\u4e0d\u505a\u4ecb\u7ecd\u4e86\u3002\u5982\u679c\u5927\u5bb6\u6709\u60f3\u8981\u4e86\u89e3\u7684 Kubernetes \u77e5\u8bc6\u70b9\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c0f\u518c\u7684\u5fae\u4fe1\u7fa4\u5411\u6211\u63d0\u51fa\uff0c\u6211\u4f1a\u6311\u9009\u5927\u5bb6\u5173\u6ce8\u7684\u5185\u5bb9\u8865\u5145\u5230\u5c0f\u518c\u7684\u540e\u9762\u3002\n\nDocker Swarm \u6700\u521d\u662f\u72ec\u7acb\u7684\u9879\u76ee\uff0c\u4e0d\u8fc7\u76ee\u524d\u5df2\u7ecf\u96c6\u6210\u5230\u4e86 Docker \u4e4b\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7 docker CLI \u7684\u547d\u4ee4\u5c31\u80fd\u591f\u76f4\u63a5\u64cd\u63a7\u5b83\u3002\n\n\u5bf9\u4e8e Docker Swarm \u6765\u8bf4\uff0c\u6bcf\u4e00\u4e2a Docker daemon \u7684\u5b9e\u4f8b\u90fd\u53ef\u4ee5\u6210\u4e3a\u96c6\u7fa4\u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u800c\u5728 Docker daemon \u52a0\u5165\u5230\u96c6\u7fa4\u6210\u4e3a\u5176\u4e2d\u7684\u4e00\u5458\u540e\uff0c\u96c6\u7fa4\u7684\u7ba1\u7406\u8282\u70b9\u5c31\u80fd\u5bf9\u5b83\u8fdb\u884c\u63a7\u5236\u3002\u6211\u4eec\u8981\u642d\u5efa\u7684 Overlay \u7f51\u7edc\u6b63\u662f\u57fa\u4e8e\u8fd9\u6837\u7684\u96c6\u7fa4\u5b9e\u73b0\u7684\u3002\n\n\u65e2\u7136\u8981\u5c06 Docker \u52a0\u5165\u5230\u96c6\u7fa4\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u5148\u6709\u4e00\u4e2a\u96c6\u7fa4\uff0c\u6211\u4eec\u5728\u4efb\u610f\u4e00\u4e2a Docker \u5b9e\u4f8b\u4e0a\u90fd\u53ef\u4ee5\u901a\u8fc7 `docker swarm init` \u6765\u521d\u59cb\u5316\u96c6\u7fa4\u3002\n\n```\n$ sudo docker swarm init\n\nSwarm initialized: current node (t4ydh2o5mwp5io2netepcauyl) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-4dvxvx4n7magy5zh0g0de0xoues9azekw308jlv6hlvqwpriwy-cb43z26n5jbadk024tx0cqz5r 192.168.1.5:2377\n\n```\n\n\u5728\u96c6\u7fa4\u521d\u59cb\u5316\u540e\uff0c\u8fd9\u4e2a Docker \u5b9e\u4f8b\u5c31\u81ea\u52a8\u6210\u4e3a\u4e86\u96c6\u7fa4\u7684\u7ba1\u7406\u8282\u70b9\uff0c\u800c\u5176\u4ed6 Docker \u5b9e\u4f8b\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u8fd9\u91cc\u6240\u6253\u5370\u7684 `docker swarm join` \u547d\u4ee4\u6765\u52a0\u5165\u96c6\u7fa4\u3002\n\n\u52a0\u5165\u5230\u96c6\u7fa4\u7684\u8282\u70b9\u9ed8\u8ba4\u4e3a\u666e\u901a\u8282\u70b9\uff0c\u5982\u679c\u8981\u4ee5\u7ba1\u7406\u8282\u70b9\u7684\u8eab\u4efd\u52a0\u5165\u5230\u96c6\u7fa4\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `docker swarm join-token` \u547d\u4ee4\u6765\u83b7\u5f97\u7ba1\u7406\u8282\u70b9\u7684\u52a0\u5165\u547d\u4ee4\u3002\n\n```\n$ sudo docker swarm join-token manager\nTo add a manager to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-60am9y6axwot0angn1e5inxrpzrj5d6aa91gx72f8et94wztm1-7lz0dth35wywekjd1qn30jtes 192.168.1.5:2377\n\n```\n\n\u6211\u4eec\u901a\u8fc7\u8fd9\u4e9b\u547d\u4ee4\u6765\u5efa\u7acb\u7528\u4e8e\u6211\u4eec\u670d\u52a1\u5f00\u53d1\u7684 Docker \u96c6\u7fa4\uff0c\u5e76\u5c06\u76f8\u5173\u5f00\u53d1\u540c\u4e8b\u7684 Docker \u52a0\u5165\u5230\u8fd9\u4e2a\u96c6\u7fa4\u91cc\uff0c\u5c31\u5b8c\u6210\u4e86\u642d\u5efa\u8de8\u4e3b\u673a\u7f51\u7edc\u7684\u7b2c\u4e00\u6b65\u3002\n\n### \u5efa\u7acb\u8de8\u4e3b\u673a\u7f51\u7edc\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u901a\u8fc7 `docker network create` \u547d\u4ee4\u6765\u5efa\u7acb Overlay \u7f51\u7edc\u3002\n\n```\n$ sudo docker network create --driver overlay --attachable mesh\n\n```\n\n\u5728\u521b\u5efa Overlay \u7f51\u7edc\u65f6\uff0c\u6211\u4eec\u8981\u52a0\u5165 `--attachable` \u9009\u9879\u4ee5\u4fbf\u4e0d\u540c\u673a\u5668\u4e0a\u7684 Docker \u5bb9\u5668\u80fd\u591f\u6b63\u5e38\u4f7f\u7528\u5230\u5b83\u3002\n\n\u5728\u521b\u5efa\u4e86\u8fd9\u4e2a\u7f51\u7edc\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4efb\u4f55\u4e00\u4e2a\u52a0\u5165\u5230\u96c6\u7fa4\u7684 Docker \u5b9e\u4f8b\u4e0a\u4f7f\u7528 `docker network ls` \u67e5\u770b\u4e00\u4e0b\u5176\u4e0b\u7684\u7f51\u7edc\u5217\u8868\u3002\u6211\u4eec\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u7f51\u7edc\u5b9a\u4e49\u5df2\u7ecf\u540c\u6b65\u5230\u4e86\u6240\u6709\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u4e0a\u3002\n\n```\n$ sudo docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\n## ......\ny89bt74ld9l8        mesh                overlay             swarm\n## ......\n\n```\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u4fee\u6539 Docker Compose \u7684\u5b9a\u4e49\uff0c\u8ba9\u5b83\u4f7f\u7528\u8fd9\u4e2a\u6211\u4eec\u5df2\u7ecf\u5b9a\u4e49\u597d\u7684\u7f51\u7edc\uff0c\u800c\u4e0d\u662f\u518d\u91cd\u65b0\u521b\u5efa\u7f51\u7edc\u3002\n\n\u6211\u4eec\u53ea\u9700\u8981\u5728 Docker Compose \u914d\u7f6e\u6587\u4ef6\u7684\u7f51\u7edc\u5b9a\u4e49\u90e8\u5206\uff0c\u5c06\u7f51\u7edc\u7684 external \u5c5e\u6027\u8bbe\u7f6e\u4e3a true\uff0c\u5c31\u53ef\u4ee5\u8ba9 Docker Compose \u5c06\u5176\u5efa\u7acb\u7684\u5bb9\u5668\u90fd\u8fde\u63a5\u5230\u8fd9\u4e2a\u4e0d\u5c5e\u4e8e Docker Compose \u7684\u9879\u76ee\u4e0a\u4e86\u3002\n\n```\nnetworks:\n  mesh:\n    external: true\n\n```\n\n\u901a\u8fc7\u8fd9\u4e2a\u5b9e\u73b0\uff0c\u6211\u4eec\u5728\u5f00\u53d1\u4e2d\u5c31\u4f7f\u6574\u4e2a\u670d\u52a1\u90fd\u5904\u4e8e\u4e00\u4e2a\u53ef\u4ee5\u4f7f\u7528\u522b\u540d\u6620\u5c04\u7f51\u7edc\u4e2d\uff0c\u907f\u514d\u4e86\u8981\u5bf9\u4e0d\u540c\u529f\u80fd\u8054\u8c03\u65f6\u5207\u6362\u670d\u52a1 IP \u7684\u70e6\u7410\u6d41\u7a0b\u3002\u5728\u8fd9\u79cd\u7ed3\u6784\u4e0b\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8ba9\u6211\u4eec\u5f00\u53d1\u7684 Docker \u9000\u51fa\u548c\u52a0\u5165\u4e0d\u540c\u7684\u96c6\u7fa4\uff0c\u5c31\u80fd\u9a6c\u4e0a\u505a\u5230\u5207\u6362\u4e0d\u540c\u8054\u8c03\u9879\u76ee\u3002\n\n## \u7559\u8a00\u4e92\u52a8\n\n\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86\u4f7f\u7528 Docker \u8fdb\u884c\u591a\u4eba\u534f\u540c\u5f00\u53d1\u7684\u65b9\u6cd5\u3002\u8fd9\u91cc\u7ed9\u5927\u5bb6\u7559\u4e00\u9053\u5b9e\u8df5\u9898\uff1a\n\n> \u5c1d\u8bd5\u4f7f\u7528\u672c\u5c0f\u8282\u4e2d\u7684\u77e5\u8bc6\uff0c\u4e0e\u540c\u4e8b\u642d\u5efa\u4e00\u5957\u534f\u540c\u5f00\u53d1\u73af\u5883\u3002\n\n\u6b22\u8fce\u5927\u5bb6\u901a\u8fc7\u7559\u8a00\u7684\u65b9\u5f0f\u8bf4\u51fa\u4f60\u7684\u5b9e\u8df5\u4e4b\u8def\u3002\u6211\u4f1a\u9009\u51fa\u6709\u4ee3\u8868\u6027\u7684\u4f18\u8d28\u7559\u8a00\uff0c\u63a8\u8350\u7ed9\u5927\u5bb6\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u4f60\u5bf9 Docker \u5728\u670d\u52a1\u5316\u5f00\u53d1\u4e2d\u7684\u5e94\u7528\u8fd8\u6709\u7591\u95ee\uff0c\u6216\u8005\u6709\u81ea\u5df1\u7684\u5b9e\u8df5\u5fc3\u5f97\u8981\u4e0e\u5927\u5bb6\u5206\u4eab\uff0c\u53ef\u4ee5\u52a0\u5165\u5230\u8fd9\u672c\u5c0f\u518c\u7684\u5b98\u65b9\u5fae\u4fe1\u7fa4\u4e2d\uff0c\u53c2\u4e0e\u5bf9\u76f8\u5173\u95ee\u9898\u7684\u8ba8\u8bba\u3002", "md_File": "subject/\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357/\u7ec4\u5408\u5e94\u7528\u5e94\u7528\u4e8e\u670d\u52a1\u5316\u5f00\u53d1.md", "create_date": "2020-02-18T21:18:39.268", "order": 18}}, {"model": "subject.chapter", "pk": 77, "fields": {"title": "\u5206\u5e03\u5f0f 1\uff1a\u6df1\u5165 RPC \u5206\u5e03\u5f0f\u539f\u7406", "topic": 4, "md5": "4ae33e94a8bbbc4c8a72fb072462f391", "md_body": "# \u5206\u5e03\u5f0f 1\uff1a\u6df1\u5165 RPC \u5206\u5e03\u5f0f\u539f\u7406\n\n\u524d\u9762\u51e0\u8282\u8bb2\u7684\u90fd\u662f\u5355\u673a RPC \u670d\u52a1\u7684\u6a21\u5f0f\uff0c\u65e0\u8bba\u662f\u591a\u7ebf\u7a0b\u4e5f\u597d\u591a\u8fdb\u7a0b\u4e5f\u597d\uff0c\u5b83\u4eec\u90fd\u53ea\u80fd\u7b97\u662f\u5355\u70b9\u7684\u8bbe\u8ba1\u3002\u73b0\u4ee3\u4f01\u4e1a\u7684\u5173\u952e\u6027 RPC \u670d\u52a1\u662f\u7edd\u4e0d\u53ef\u4ee5\u53ea\u4f7f\u7528\u5355\u70b9\u90e8\u7f72\u7684\u3002\u672c\u8282\u6211\u4eec\u8981\u5bf9 RPC \u670d\u52a1\u8fdb\u884c\u5206\u5e03\u5f0f\u5316\uff0c\u4f7f\u5f97\u670d\u52a1\u53ef\u4ee5\u5bb9\u5fcd\u4e2a\u522b\u8282\u70b9\u6545\u969c\u4ecd\u80fd\u7ee7\u7eed\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/11/1634f9d6e0ca7032?w=1184&h=550&f=png&s=62638)\n\n## \u5ba2\u6237\u7aef\n\n\u5f53 RPC \u670d\u52a1\u90e8\u7f72\u5728\u591a\u4e2a\u8282\u70b9\u4e0a\u65f6\uff0c\u5ba2\u6237\u7aef\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u670d\u52a1\u5217\u8868\uff0c\u6709\u591a\u4e2a IP \u7aef\u53e3\u5bf9\u3002\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u6c60\u53ef\u4ee5\u968f\u673a\u5730\u6311\u9009\u4efb\u610f\u7684 RPC \u670d\u52a1\u8282\u70b9\u8fdb\u884c\u8fde\u63a5\u3002\n\n\u6bcf\u4e2a\u670d\u52a1\u8282\u70b9\u5e94\u8be5\u6709\u4e2a\u6743\u91cd\u503c\uff0c\u5f53\u6240\u6709\u8282\u70b9\u7684\u6743\u91cd\u503c\u4e00\u6837\u65f6\uff0c\u5b83\u4eec\u7684\u6d41\u91cf\u5206\u914d\u5c31\u662f\u5747\u5300\u7684\u3002\u5982\u679c\u67d0\u4e2a\u8282\u70b9\u7684\u76f8\u5bf9\u6743\u91cd\u503c\u8f83\u5c0f\uff0c\u5b83\u88ab\u5ba2\u6237\u7aef\u9009\u4e2d\u7684\u6982\u7387\u4e5f\u4f1a\u76f8\u5bf9\u6bd4\u8f83\u5c0f\u3002\n\n```\nclass RPCNode {\n    String addr;  // \u670d\u52a1\u5730\u5740\n    int weight; // \u8282\u70b9\u6743\u91cd\n}\n\nclass RPCCluster {\n    RPCNode[] nodes; // \u8282\u70b9\u5217\u8868\n    \n    Node random(); // \u6309\u6743\u91cd\u968f\u673a\u6311\u9009\u8282\u70b9\n}\n\n```\n\n## \u5bb9\u707e Failover\n\n\u5f53\u6709\u4e00\u4e2a\u670d\u52a1\u8282\u70b9\u6302\u6389\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u91c7\u53d6\u4e00\u5b9a\u7684\u7b56\u7565\u907f\u514d\u8bf7\u6c42\u5931\u8d25\u3002\u5f53\u8bf7\u6c42\u5931\u8d25\u65f6\uff0c\u5ba2\u6237\u7aef\u8fd8\u8981\u8fdb\u884c\u91cd\u8bd5\uff0c\u4f46\u662f\u4e5f\u4e0d\u53ef\u4ee5\u65e0\u9650\u91cd\u8bd5\uff0c\u8981\u6709\u4e00\u5b9a\u7684\u91cd\u8bd5\u7b56\u7565\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/11/1634f9e7c0d1cff7?w=998&h=522&f=png&s=59383)\n\n\u6bd4\u5982\u5f53\u8282\u70b9\u6302\u6389\u65f6\uff0c\u5c06\u5931\u6548\u8282\u70b9\u6458\u9664\uff0c\u653e\u7f6e\u5230\u5931\u6548\u8282\u70b9\u5217\u8868\u4e2d\u3002\u7136\u540e\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u68c0\u67e5\u5931\u6548\u8282\u70b9\u662f\u5426\u6062\u590d\u4e86\uff0c\u5982\u679c\u6062\u590d\u4e86\uff0c\u90a3\u5c31\u4ece\u5931\u6548\u8282\u70b9\u4e2d\u79fb\u9664\uff0c\u518d\u5c06\u8282\u70b9\u5730\u5740\u91cd\u65b0\u52a0\u5165\u5230\u6709\u6548\u8282\u70b9\u5217\u8868\u4e2d\u3002\u90a3\u5982\u4f55\u5224\u65ad\u8282\u70b9\u771f\u7684\u6302\u6389\u4e86\u5462\uff0c\u4e00\u822c\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u65f6\u95f4\u7a97\u53e3\uff0c\u7edf\u8ba1\u5728\u4e00\u5b9a\u65f6\u95f4\u7a97\u53e3\u91cc\u51fa\u73b0\u7684\u9519\u8bef\u6570\u91cf\u3002\u5982\u679c\u8fd9\u4e2a\u6570\u91cf\u8fc7\u5927\uff0c\u90a3\u5c31\u610f\u5473\u7740\u5931\u6548\u4e86\u3002\u8fd9\u4e5f\u662f\u4e3a\u4e86\u9632\u6b62\u7f51\u7edc\u5076\u7136\u6296\u52a8\u5bfc\u81f4\u670d\u52a1\u8282\u70b9\u6d41\u91cf\u7684\u5927\u5e45\u6ce2\u52a8\u3002\n\n## \u964d\u6743\u6cd5\n\n\u4e0a\u9762\u63d0\u5230\u5ba2\u6237\u7aef\u4f1a\u4e3a\u6bcf\u4e2a\u8282\u70b9\u8d4b\u4e88\u4e00\u4e2a\u6743\u503c\uff0c\u6539\u53d8\u6743\u503c\u5c31\u53ef\u4ee5\u6539\u53d8\u8282\u70b9\u7684\u76f8\u5bf9\u6d41\u91cf\u3002\u5982\u679c\u67d0\u4e2a\u8282\u70b9\u51fa\u73b0\u4e86\u4e00\u6b21\u8c03\u7528\u9519\u8bef\uff0c\u53ef\u4ee5\u5bf9\u8be5\u8282\u70b9\u8fdb\u884c\u964d\u6743\u3002\u5982\u679c\u9519\u8bef\u6b21\u6570\u8fc7\u591a\uff0c\u964d\u6743\u4f1a\u964d\u7684\u5f88\u5feb\uff0c\u6700\u7ec8\u8fbe\u5230\u4e00\u4e2a\u6700\u5c0f\u503c\u3002\u4e4b\u6240\u4ee5\u4e0d\u5e94\u8be5\u964d\u5230\u96f6\uff0c\u90a3\u662f\u4e3a\u4e86\u7ed9\u8282\u70b9\u63d0\u4f9b\u4e00\u4e2a\u6062\u590d\u7684\u673a\u4f1a\u3002\u88ab\u964d\u6743\u7684\u8282\u70b9\u540e\u6765\u53ea\u8981\u6709\u4e00\u6b21\u8c03\u7528\u6210\u529f\uff0c\u90a3\u4e48 weight \u503c\u5c31\u5e94\u8be5\u5c3d\u5feb\u88ab\u8fd8\u539f\uff0c\u8fd9\u6837\u8282\u70b9\u5c31\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u4e3a\u6b63\u5e38\u8282\u70b9\u3002\n\n\u5ba2\u6237\u7aef\u4e00\u6b21\u8c03\u7528\u5931\u8d25\u4f1a\u5c1d\u8bd5\u91cd\u8bd5\u3002\u5982\u679c\u964d\u6743\u592a\u6162\uff0c\u4f1a\u5bfc\u81f4\u91cd\u8bd5\u6b21\u6570\u592a\u591a\uff0c\u56e0\u4e3a\u7b2c\u4e8c\u6b21\u968f\u673a\u6311\u9009\u8282\u70b9\u65f6\u8fd8\u662f\u5f88\u6709\u53ef\u80fd\u518d\u6b21\u6311\u9009\u5230\u5931\u6548\u8282\u70b9\u3002\u964d\u6743\u592a\u5feb\u4e5f\u4e0d\u597d\uff0c\u7f51\u7edc\u6296\u52a8\u4f1a\u5bfc\u81f4\u8282\u70b9\u6d41\u91cf\u5206\u914d\u7684\u5feb\u901f\u6296\u52a8\uff0c\u77ac\u95f4\u4ece\u6b63\u5e38\u964d\u5230\u8fd1\u96f6\uff0c\u53c8\u53ef\u4ee5\u77ac\u95f4\u4ece\u8fd1\u96f6\u6062\u590d\u5230\u6b63\u5e38\u3002\n\n\u4e00\u4e2a\u7b80\u5355\u7684\u7b56\u7565\u662f\u6743\u91cd\u51cf\u534a\u6cd5\u3002\u9519\u8bef\u4e00\u6b21\u6743\u91cd\u51cf\u534a\uff0c\u8fde\u7eed\u9519\u8bef\u4e24\u6b21\u6743\u91cd\u5c31\u964d\u5230 1/4\uff0c\u5982\u6b64\u76f4\u5230\u964d\u5230\u6700\u5c0f\u503c\u3002\u5982\u679c\u521d\u59cb\u6743\u91cd\u503c\u662f 1024\uff0c\u90a3\u4e48\u6743\u91cd\u503c\u5c31\u4f1a\u9010\u6e10\u8870\u51cf`1024=>512=>256=>128=>64=>32=>16=>8=>4=>2=>1`\u3002\u5982\u679c\u8282\u70b9\u6062\u590d\u4e86\uff0c\u90a3\u4e48\u8c03\u7528\u4f1a\u6210\u529f\uff0c\u6743\u91cd\u5c31\u53ef\u4ee5\u76f4\u63a5\u6062\u590d\u5230\u6b63\u5e38\u503c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u52a0\u500d\u6cd5\u9010\u6e10\u6062\u590d\u5230\u6b63\u5e38\u503c`1=>2=>4=>8=>16=>32=>64=>128=>256=>512=>1024`\u3002\u5982\u679c\u5e0c\u671b\u6062\u590d\u7684\u66f4\u5feb\u4e00\u70b9\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e58 4 \u6cd5\uff0c\u4e58 8 \u6cd5\u3002\n\n## \u670d\u52a1\u53d1\u73b0\n\n\u5065\u58ee\u7684\u670d\u52a1\u5e94\u8be5\u662f\u53ef\u4ee5\u652f\u6301\u52a8\u6001\u6269\u5bb9\u7684\u670d\u52a1\u3002\u6bd4\u5982 RPC \u670d\u52a1\u538b\u529b\u8fc7\u5927\uff0c\u5e0c\u671b\u901a\u8fc7\u589e\u52a0\u8282\u70b9\u7684\u65b9\u5f0f\u6765\u51cf\u5c0f\u5355\u4e2a RPC \u670d\u52a1\u7684\u538b\u529b\u3002\u5982\u679c\u4f7f\u7528\u7684\u662f\u524d\u9762\u7684\u9759\u6001 RPC \u670d\u52a1\u5730\u5740\u5217\u8868\uff0c\u90a3\u4e48\u5f53\u8282\u70b9\u589e\u52a0\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539\u5ba2\u6237\u7aef\u7684\u914d\u7f6e\u91cd\u542f\u624d\u80fd\u751f\u6548\u3002\n\n\u901a\u8fc7\u670d\u52a1\u53d1\u73b0\u6280\u672f\uff0c\u5f53 RPC \u670d\u52a1\u8282\u70b9\u589e\u52a0\u6216\u51cf\u5c11\u65f6\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u52a8\u6001\u5feb\u901f\u6536\u5230\u670d\u52a1\u5217\u8868\u7684\u53d8\u66f4\u4fe1\u606f\uff0c\u4ece\u800c\u53ef\u4ee5\u5b9e\u65f6\u8c03\u6574\u8fde\u63a5\u914d\u7f6e\uff0c\u8fd9\u6837\u65e0\u9700\u91cd\u542f\u5c31\u53ef\u4ee5\u5b8c\u6210\u670d\u52a1\u7684\u6269\u5bb9\u548c\u7f29\u5bb9\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/11/1634fa1aeaed7b55?w=1436&h=600&f=png&s=90324)\n\n```\nclass ServiceDiscovery(object):\n\n    def register_service(self, name, addr):\n        pass\n        \n    def get_services(self, name):\n        pass\n        \n    def on_services_changed(self, name):\n        pass\n\n```\n\n\u670d\u52a1\u53d1\u73b0\u6280\u672f\u4f9d\u8d56\u4e8e\u670d\u52a1\u4e4b\u95f4\u7684\u7279\u6b8a\u4e2d\u95f4\u8282\u70b9\u3002\u8fd9\u4e2a\u8282\u70b9\u7684\u4f5c\u7528\u5c31\u662f\u63a5\u53d7\u670d\u52a1\u7684\u6ce8\u518c\uff0c\u63d0\u4f9b\u670d\u52a1\u7684\u67e5\u627e\uff0c\u4ee5\u53ca\u670d\u52a1\u5217\u8868\u53d8\u66f4\u7684\u5b9e\u65f6\u901a\u77e5\u529f\u80fd\u3002\u5b83\u4e00\u822c\u4f7f\u7528\u652f\u6301\u9ad8\u53ef\u7528\u7684\u5206\u5e03\u5f0f\u914d\u7f6e\u6570\u636e\u5e93\u4f5c\u4e3a\u89e3\u51b3\u65b9\u6848\uff0c\u5982 zookeeper/etcd \u7b49\u3002\n\n1.  \u670d\u52a1\u6ce8\u518c\u2014\u2014\u670d\u52a1\u8282\u70b9\u5728\u542f\u52a8\u65f6\u5c06\u81ea\u5df1\u7684\u670d\u52a1\u5730\u5740\u6ce8\u518c\u5230\u4e2d\u95f4\u8282\u70b9\n2.  \u670d\u52a1\u67e5\u627e\u2014\u2014\u5ba2\u6237\u7aef\u542f\u52a8\u65f6\u53bb\u4e2d\u95f4\u8282\u70b9\u67e5\u8be2\u670d\u52a1\u5730\u5740\u5217\u8868\n3.  \u670d\u52a1\u53d8\u66f4\u901a\u77e5\u2014\u2014\u5ba2\u6237\u7aef\u5728\u4e2d\u95f4\u8282\u70b9\u4e0a\u8ba2\u9605\u4f9d\u8d56\u670d\u52a1\u5217\u8868\u7684\u53d8\u66f4\u4e8b\u4ef6\u3002\u5f53\u4f9d\u8d56\u7684\u670d\u52a1\u5217\u8868\u53d8\u66f4\u65f6\uff0c\u4e2d\u95f4\u8282\u70b9\u8d1f\u8d23\u5c06\u53d8\u66f4\u4fe1\u606f\u5b9e\u65f6\u901a\u77e5\u7ed9\u5ba2\u6237\u7aef\u3002\n\n# \u5c0f\u7ed3\n\n\u5206\u5e03\u5f0f\u7684\u539f\u7406\u5e76\u6ca1\u6709\u5b83\u7684\u540d\u5b57\u542c\u8d77\u6765\u90a3\u6837\u590d\u6742\uff0c\u5b83\u5728\u672c\u8d28\u4e0a\u4e5f\u4e0d\u8fc7\u662f\u5c06\u591a\u4e2a\u5355\u673a\u670d\u52a1\u7ec4\u5408\u5728\u4e00\u8d77\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u5f53\u4f60\u62b1\u7740\u5fd0\u5fd1\u7684\u5fc3\u60c5\u8fdb\u5165\u8fd9\u4e00\u8282\uff0c\u7136\u540e\u53c8\u62b1\u7740\u5931\u671b\u7684\u5fc3\u60c5\u79bb\u5f00\u672c\u5c0f\u8282\uff0c\u8fd9\u79cd\u5fc3\u60c5\u8001\u5e08\u6211\u662f\u53ef\u4ee5\u7406\u89e3\u7684\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/163774b0e3c7f299?w=300&h=252&f=jpeg&s=10857)\n\n\u56e0\u4e3a\u5f80\u65e5\u91cc\u4f60\u4eec\u7ecf\u5e38\u542c\u5230\u7684\u90a3\u79cd\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1\u7684\u795e\u8bdd\u5728\u8001\u5e08\u7684\u8fd9\u672c\u5c0f\u518c\u91cc\u5f7b\u5e95\u7834\u706d\u4e86\u3002\n\n\u7834\u706d\u4e4b\u540e\u4fbf\u662f\u91cd\u751f\uff0c\u4f60\u4eec\u5728\u6280\u672f\u7814\u53d1\u8fd9\u6761\u8def\u4e0a\u5c06\u5f00\u59cb\u5b66\u4f1a\u72ec\u7acb\u601d\u8003\uff0c\u4e0d\u518d\u8ff7\u4fe1\u6559\u79d1\u4e66\u4e0a\u7684\u6559\u6761\uff0c\u4e0d\u518d\u8f7b\u4fe1\u5927\u725b\u4eec\u7684\u6559\u8bf2\uff0c\u4f60\u7684\u601d\u7ef4\u5c06\u8df3\u51fa\u73b0\u6709\u7684\u5c42\u6b21\uff0c\u4f60\u7684\u4eba\u751f\u4e5f\u4f1a\u8e0f\u4e0a\u4e00\u4e2a\u65b0\u7684\u53f0\u9636\ufe0f\u3002\u270c\u270c\n\n\u4e0b\u4e00\u8282\u5c06\u653e\u51fa\u5927\u62db\uff0c\u5e26\u9886\u6253\u9020\u4e00\u4e2a\u5b8c\u6574\u7684\u5206\u5e03\u5f0f RPC \u670d\u52a1\uff0c\u5185\u90e8\u4f1a\u6d89\u53ca Python \u591a\u8fdb\u7a0b\u7ba1\u7406\u3001\u4fe1\u53f7\u5904\u7406\u3001ZooKeeper \u670d\u52a1\u53d1\u73b0\u7b49\u77e5\u8bc6\uff0c\u5b83\u5c31\u50cf\u4e00\u4e2a\u8bfe\u7a0b\u5927\u4f5c\u4e1a\uff0c\u9700\u8981\u8bfb\u8005\u6709\u975e\u5e38\u5730\u8010\u5fc3\u53bb\u7406\u89e3\u3002\n\n\u8003\u8651\u5230\u8fd9\u4e2a\u5927\u4f5c\u4e1a\u9700\u8981\u5f88\u591a\u524d\u7f6e\u7684\u77e5\u8bc6\u6280\u80fd\uff0c\u6211\u5c06\u8fd9\u4efd\u5927\u4f5c\u4e1a\u62c6\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u7b2c\u4e00\u90e8\u5206\u4e13\u95e8\u8bb2\u89e3\u524d\u7f6e\u6838\u5fc3\u77e5\u8bc6\uff0c\u7b2c\u4e8c\u90e8\u5206\u518d\u6b63\u5f0f\u5806\u4ee3\u7801\uff0c\u5f00\u5199\u5927\u4f5c\u4e1a\u3002\n\n## \u4f5c\u4e1a\n\n\u8bf7\u8bfb\u8005\u5c1d\u8bd5\u4f7f\u7528\u964d\u6743\u6cd5\u5305\u88c5 redis-py \u6765\u8fde\u63a5\u4f7f\u7528\u591a\u4e2a Redis \u7f13\u5b58\u5b9e\u4f8b\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u5206\u5e03\u5f0f_1\u6df1\u5165_RPC_\u5206\u5e03\u5f0f\u539f\u7406.md", "create_date": "2020-02-18T21:31:51.491", "order": 15}}, {"model": "subject.chapter", "pk": 78, "fields": {"title": "\u5206\u5e03\u5f0f 2\uff1a\u5206\u5e03\u5f0f RPC \u77e5\u8bc6\u57fa\u7840", "topic": 4, "md5": "d6c7497cef29e03cfb90ab26efc63f08", "md_body": "# \u5206\u5e03\u5f0f 2\uff1a\u5206\u5e03\u5f0f RPC \u77e5\u8bc6\u57fa\u7840\n\n\u672c\u8282\u8981\u5b66\u4e60\u4e00\u4e0b ZooKeeper \u7684\u8fdb\u7a0b\u7ba1\u7406\u3001\u4fe1\u53f7\u5904\u7406\u548c\u670d\u52a1\u53d1\u73b0\u7684 Python \u5ba2\u6237\u7aef\u57fa\u672c\u4f7f\u7528\u3002\u6709\u4e86\u8fd9\u4e9b\u57fa\u7840\u77e5\u8bc6\u4e4b\u540e\uff0c\u5927\u4f5c\u4e1a\u7684\u4ee3\u7801\u7406\u89e3\u8d77\u6765\u5c31\u6ca1\u6709\u90a3\u4e48\u5403\u529b\u4e86\u3002\u8bf7\u8bfb\u8005\u52a1\u5fc5\u638c\u63e1\u4e86\u672c\u8282\u7684\u6240\u6709\u77e5\u8bc6\u70b9\u4e4b\u540e\u518d\u53bb\u8fdb\u884c\u5927\u4f5c\u4e1a\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u611f\u89c9\u50cf\u5929\u4e66\u4e00\u822c\u96be\u4ee5\u7406\u89e3\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/3/163c48dc374d52f3?w=1248&h=488&f=png&s=58876)\n\n## \u6740\u6b7b\u5b50\u8fdb\u7a0b\n\n![](https://user-gold-cdn.xitu.io/2018/5/25/163960c4dc9966c6?w=457&h=143&f=png&s=9578)\n\nPython \u63d0\u4f9b\u4e86 os.kill \u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u5411\u6307\u5b9a\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\u3002\u6bd4\u5982\u4f60\u8981\u5f3a\u5236\u6740\u6b7b\u67d0\u4e2a\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u5411\u5b83\u53d1\u9001 SIGKILL \u4fe1\u53f7\u3002SIGKILL \u4fe1\u53f7\u6bd4\u8f83\u66b4\u529b\uff0c\u5bf9\u65b9\u8fdb\u7a0b\u4f1a\u7acb\u5373 crash\u3002\u9664\u4e86 SIGKILL\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7 SIGTERM \u548c SIGINT \u4fe1\u53f7\u6e29\u67d4\u5730\u901a\u77e5\u5bf9\u65b9\u9000\u51fa\uff0c\u53ea\u8981\u5bf9\u65b9\u8fdb\u7a0b\u8bbe\u7f6e\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u5c31\u53ef\u4ee5\u5728\u9000\u51fa\u4e4b\u524d\u6267\u884c\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\u3002\u8fdb\u7a0b\u65e0\u6cd5\u4e3a SIGKILL \u4fe1\u53f7\u8bbe\u7f6e\u5904\u7406\u51fd\u6570\uff0c\u6240\u4ee5 SIGKILL \u65e0\u6cd5\u6355\u83b7\uff0c\u53ea\u80fd\u66b4\u529b\u9000\u51fa\uff0c\u7528\u6237\u65e0\u6cd5\u63a7\u5236\u3002\n\n```\nos.kill(pid, signal.SIGKILL)\nos.kill(pid, signal.SIGTERM)\nos.kill(pid, signal.SIGINT)\n\n```\n\n## \u4fe1\u53f7\u5904\u7406\u51fd\u6570\n\n![](https://user-gold-cdn.xitu.io/2018/6/12/163f2c0def73e10c?w=680&h=245&f=png&s=26000)\n\n\u6211\u4eec\u53ef\u4ee5\u6355\u83b7\u7279\u5b9a\u4fe1\u53f7\uff0c\u8986\u76d6\u9ed8\u8ba4\u4fe1\u53f7\u5904\u7406\u884c\u4e3a\u3002\u6bd4\u5982\u7ec8\u7aef\u7684\u4e00\u4e2a Python \u7a0b\u5e8f\u6302\u5728\u90a3\u91cc\uff0c\u4f60\u6572\u51fb\u4e86\u952e\u76d8\u7684 ctrl+c \u5f80\u5f80\u4f1a\u5bfc\u81f4\u8fdb\u7a0b\u9000\u51fa\u5e76\u629b\u51fa\u5f02\u5e38\u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u4f60\u5728\u7ec8\u7aef\u6267\u884c `Python sig.py`\uff0c\u8be5\u8fdb\u7a0b\u4f1a\u60ac\u6302\u5728\u90a3\u91cc\u4f11\u7720\n\n```\n# sig.py\nimport time\n\nwhile True:\n    print \"hello\"\n    time.sleep(1)  # \u4f11\u7720 1s\n\n```\n\n\u7136\u540e\u4f60\u6572\u51fb `ctrl+c`\n\n```\nhello\nhello\nhello\n^CTraceback (most recent call last):\n  File \"sig.py\", line 12, in <module>\n    time.sleep(1)\nKeyboardInterrupt\n\n```\n\n\u8fdb\u7a0b\u88ab\u6253\u65ad\uff0c\u7206\u51fa\u4e86 KeyboardInterrupt \u5f02\u5e38\u3002\u8fdb\u7a0b\u7acb\u5373\u9000\u51fa\u4e86\u3002\n\n\u539f\u56e0\u5c31\u662f\u5f53\u4f60\u6572\u51fb ctrl+c \u65f6\uff0c\u9ed8\u8ba4\u8fdb\u7a0b\u4f1a\u6536\u5230 SIGINT(interrupt) \u4fe1\u53f7\uff0c\u8be5\u4fe1\u53f7\u9ed8\u8ba4\u7684\u5904\u7406\u51fd\u6570\u5c31\u662f\u9000\u51fa\u8fdb\u7a0b\u3002\u5982\u679c\u4f60\u4e3a SIGINT \u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u5c31\u53ef\u4ee5\u63a7\u5236\u8fdb\u7a0b\u4e0d\u53d7 ctrl+c \u5f71\u54cd\u3002\n\n```\nimport time\nimport signal\n\n\ndef ignore(sig, frame):  # \u5565\u4e5f\u4e0d\u5e72\uff0c\u5c31\u5ffd\u7565\u4fe1\u53f7\n    pass\n\nsignal.signal(signal.SIGINT, ignore)\n\nwhile True:\n    print \"hello\"\n    time.sleep(1)\n\n```\n\n\u4f60\u8bd5\u8bd5\u72c2\u6309 ctrl+c\uff0c\u8fdb\u7a0b\u4f9d\u65e7\u6253\u8f6c\uff0c\u53ea\u662f\u8fd9 hello \u8f93\u51fa\u7684\u8981\u6bd4\u5e73\u65f6\u5feb\u4e00\u70b9\uff0c\u4f3c\u4e4e\u4e0d\u518d\u53d7\u5230 sleep \u7684\u5f71\u54cd\u3002\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a sleep \u51fd\u6570\u603b\u662f\u8981\u88ab SIGINT \u4fe1\u53f7\u6253\u65ad\u7684\uff0c\u4e0d\u7ba1\u4f60\u6709\u6ca1\u6709\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u53ea\u4e0d\u8fc7\u56e0\u4e3a\u6709 while True \u5faa\u73af\u5728\u4fdd\u62a4\u7740\u3002\n\n```\nhello\nhello\nhello\n^Chello\n^Chello\n^Chello\n^Chello\n^Chello\n^Chello\n^Chello\n^Chello\n\n```\n\n## \u9519\u8bef\u7801\n\nPython \u7684 errono \u5305\u5b9a\u4e49\u4e86\u5f88\u591a\u64cd\u4f5c\u7cfb\u7edf\u8c03\u7528\u9519\u8bef\u7801\u3002\u6bd4\u5982 errno.EINTR \u8868\u793a\u8c03\u7528\u88ab\u6253\u65ad\uff0c\u4ee3\u7801\u9047\u5230\u6b64\u79cd\u9519\u8bef\u65f6\u5f80\u5f80\u9700\u8981\u8fdb\u884c\u91cd\u8bd5\u3002\u8fd8\u6709 errno.ECHILD \u5728 waitpid \u6536\u5272\u5b50\u8fdb\u7a0b\u65f6\uff0c\u76ee\u6807\u8fdb\u7a0b\u4e0d\u5b58\u5728\uff0c\u5c31\u4f1a\u6709\u8fd9\u6837\u7684\u9519\u8bef\u3002\n\n\u4e0b\u9762\u5217\u51fa\u4e86 errno \u6700\u5e38\u89c1\u7684\u4e00\u4e9b\u5f02\u5e38\u8bf4\u660e\uff0c\u8bfb\u8005\u7b80\u5355\u7406\u89e3\u5373\u53ef\uff0c\u65e0\u9700\u6df1\u7a76\u3002\n\n```\nerrno.EPERM\nOperation not permitted  # \u64cd\u4f5c\u4e0d\u5141\u8bb8\n\nerrno.ENOENT\nNo such file or directory  # \u6587\u4ef6\u6ca1\u627e\u5230\n\nerrno.ESRCH\nNo such process  # \u8fdb\u7a0b\u672a\u627e\u5230\n\nerrno.EINTR\nInterrupted system call  # \u8c03\u7528\u88ab\u6253\u65ad\n\nerrno.EIO\nI/O error  # I/O \u9519\u8bef\n\nerrno.ENXIO\nNo such device or address  # \u8bbe\u5907\u672a\u627e\u5230\n\nerrno.E2BIG\nArg list too long  # \u8c03\u7528\u53c2\u6570\u592a\u591a\n\nerrno.ENOEXEC\u00b6\nExec format error  # exec \u8c03\u7528\u4e8c\u8fdb\u5236\u6587\u4ef6\u683c\u5f0f\u9519\u8bef\n\nerrno.EBADF\nBad file number  # \u6587\u4ef6\u63cf\u8ff0\u7b26\u9519\u8bef\n\nerrno.ECHILD\nNo child processes  # \u5b50\u8fdb\u7a0b\u4e0d\u5b58\u5728\n\nerrno.EAGAIN\nTry again  # I/O \u64cd\u4f5c\u88ab\u6253\u65ad\uff0c\u544a\u77e5 I/O \u64cd\u4f5c\u91cd\u8bd5\n\n```\n\n## \u7279\u6b8a\u4fe1\u53f7\n\n\u4e0a\u9762\u63d0\u5230 SIGINT \u4fe1\u53f7\u4e00\u822c\u6307\u4ee3\u952e\u76d8\u7684 ctrl+c \u89e6\u53d1\u7684 Keyboard Interrupt\u3002\u8fd8\u6709\u5176\u5b83\u5e38\u89c1\u4fe1\u53f7\u8bfb\u8005\u9700\u8981\u4e86\u89e3\u4e00\u4e0b\u3002\n\n1.  SIGTERM \u5f53\u4f60\u4f7f\u7528\u4e0d\u5e26\u53c2\u6570\u7684 kill \u6307\u4ee4\u6740\u6b7b\u8fdb\u7a0b\u65f6\uff0c\u8fdb\u7a0b\u4f1a\u6536\u5230\u8be5\u4fe1\u53f7\u3002\u6b64\u4fe1\u53f7\u9ed8\u8ba4\u884c\u4e3a\u4e5f\u662f\u9000\u51fa\u8fdb\u7a0b\uff0c\u4f46\u662f\u5141\u8bb8\u7528\u6237\u81ea\u5b9a\u4e49\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002\n2.  SIGKILL \u5f53\u4f60\u4f7f\u7528 `kill -9` \u6740\u6b7b\u8fdb\u7a0b\u65f6\uff0c\u8fdb\u7a0b\u4f1a\u6536\u5230\u4fe1\u53f7\u3002\u6b64\u4fe1\u53f7\u7684\u5904\u7406\u51fd\u6570\u65e0\u6cd5\u8986\u76d6\uff0c\u8fdb\u7a0b\u6536\u5230\u6b64\u4fe1\u53f7\u4f1a\u7acb\u5373\u66b4\u529b\u9000\u51fa\u3002\n3.  SIGCHLD \u5b50\u8fdb\u7a0b\u9000\u51fa\u65f6\uff0c\u7236\u8fdb\u7a0b\u4f1a\u6536\u5230\u6b64\u4fe1\u53f7\u3002\u5f53\u5b50\u8fdb\u7a0b\u9000\u51fa\u540e\uff0c\u7236\u8fdb\u7a0b\u5fc5\u987b\u901a\u8fc7 waitpid \u6765\u6536\u5272\u5b50\u8fdb\u7a0b\uff0c\u5426\u5219\u5b50\u8fdb\u7a0b\u5c06\u6210\u4e3a\u50f5\u5c38\u8fdb\u7a0b\uff0c\u76f4\u5230\u7236\u8fdb\u7a0b\u4e5f\u9000\u51fa\u4e86\uff0c\u5176\u8d44\u6e90\u624d\u4f1a\u5f7b\u5e95\u91ca\u653e\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/27/163a2003c32d9ac6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)\n\n## \u6536\u5272\u5b50\u8fdb\u7a0b\n\n\u6536\u5272\u5b50\u8fdb\u7a0b\u4f7f\u7528`os.waitpid(pid, options)`\u7cfb\u7edf\u8c03\u7528\uff0c\u53ef\u4ee5\u63d0\u4f9b\u5177\u4f53 pid \u6765\u6536\u5272\u6307\u5b9a\u5b50\u8fdb\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570 `pid=-1` \u6765\u6536\u5272\u4efb\u610f\u5b50\u8fdb\u7a0b\u3002\n\noptions \u5982\u679c\u662f 0\uff0c\u5c31\u8868\u793a\u963b\u585e\u7b49\u5f85\u5b50\u8fdb\u7a0b\u7ed3\u675f\u624d\u4f1a\u8fd4\u56de\uff0c\u5982\u679c\u662f WNOHANG \u5c31\u8868\u793a\u975e\u963b\u585e\uff0c\u6709,\u5c31\u8fd4\u56de\u6307\u5b9a\u8fdb\u7a0b\u7684 pid\uff0c\u6ca1\u6709,\u5c31\u8fd4\u56de 0\u3002\n\nwaitpid \u6709\u53ef\u80fd\u629b\u51fa\u5f02\u5e38\uff0c\u5982\u679c\u6307\u5b9a pid \u8fdb\u7a0b\u4e0d\u5b58\u5728\u6216\u8005\u6ca1\u6709\u5b50\u8fdb\u7a0b\u53ef\u4ee5\u6536\u5272\uff0c\u5c31\u4f1a\u629b\u51fa OSError(errno.ECHILD)\uff0c\u5982\u679c waitpid \u88ab\u5176\u5b83\u4fe1\u53f7\u6253\u65ad\uff0c\u5c31\u4f1a\u629b\u51fa OSError(errno.EINTR)\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u9009\u62e9\u91cd\u8bd5\u3002\n\n## \u7236\u8fdb\u7a0b\u9000\u51fa\n\n\u5f53\u7236\u8fdb\u7a0b\u9000\u51fa\u65f6\uff0c\u5b83\u5e94\u8be5\u5148\u5173\u95ed\u6240\u6709\u7684\u5b50\u8fdb\u7a0b\u3002\u5b83\u53ef\u4ee5\u5c06 fork \u8c03\u7528\u7684\u8fd4\u56de\u503c pid \u8bb0\u5f55\u4e0b\u6765\uff0c\u7136\u540e\u5728\u8fdb\u7a0b\u9000\u51fa\u4e4b\u524d\u8c03\u7528 os.kill \u6328\u4e2a\u6740\u6b7b\u5b83\u4eec\u3002\u5982\u679c\u4e0d\u5173\u95ed\u5b50\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u5c06\u4f1a\u7ee7\u7eed\u8fd0\u884c\uff0c\u8fd9\u53ef\u80fd\u4e0d\u662f\u4f60\u5e0c\u671b\u7684\u884c\u4e3a\u3002\n\n```\npids = []\npid = os.fork()\nif pid > 0:\n    pids.append(pid)  # \u8bb0\u5f55\u5b50\u8fdb\u7a0b pid\nelse:\n    run_child()  # \u8fd0\u884c\u5b50\u8fdb\u7a0b\n    sys.exit(0)\nfor pid in pids:\n    os.kill(pid, signal.SIGTERM) # \u5411\u5b50\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\nfor pid in pids:\n    os.waitpid(pid, 0)  # \u6536\u5272\u5b50\u8fdb\u7a0b\nsys.exit(0)  # \u7236\u8fdb\u7a0b\u9000\u51fa\n\n```\n\n## \u4fe1\u53f7\u8fde\u7eed\u6253\u65ad\n\n![](https://user-gold-cdn.xitu.io/2018/5/25/16396138a5e0611c?w=345&h=331&f=png&s=19416)\n\n\u5f53\u6211\u4eec\u6b63\u5728\u6267\u884c\u4e00\u4e2a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u65f6\uff0c\u53ef\u80fd\u53c8\u6536\u5230\u53e6\u5916\u4e00\u4e2a\u4fe1\u53f7\uff0c\u8be5\u4fe1\u53f7\u4f1a\u6253\u65ad\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002\n\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5148\u6765\u4e86\u7b2c\u4e00\u4e2a SIGINT \u4fe1\u53f7\uff0c\u5f00\u59cb\u6267\u884c SIGINT \u4fe1\u53f7\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6267\u884c\u5230\u4e00\u534a\uff0c\u53c8\u6765\u4e86\u4e00\u4e2a SIGCHLD\uff0c\u7136\u540e\u5f00\u59cb\u6267\u884c SIGCHLD \u4fe1\u53f7\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u53c8\u53ea\u6267\u884c\u5230\u4e86\u4e00\u534a\uff0c\u53c8\u6765\u4e86\u4e00\u4e2a SIGTERM \u4fe1\u53f7\uff0c\u6240\u4ee5\u53c8\u5f00\u59cb\u6267\u884c SIGTERM \u4fe1\u53f7\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u5f85 SIGTERM \u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u518d\u8fd4\u56de SIGCHLD \u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7ee7\u7eed\u6267\u884c\uff0c\u5f85 SIGCHLD \u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u540e\u518d\u8fd4\u56de\u5230 SIGINT \u4fe1\u53f7\u5904\u7406\u51fd\u6570\u7ee7\u7eed\u6267\u884c\u3002\n\n\u5982\u679c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d waitpid \u6b63\u5728\u6267\u884c\uff0c\u8fd9\u4e2a\u65f6\u5019\u7a81\u7136\u6765\u4e86\u4e00\u4e2a SIGINT \u4fe1\u53f7\uff0c\u90a3\u4e48\u5f85 SIGINT \u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6267\u884c\u5b8c\u6bd5\u540e\u8fd4\u56de\u5230\u539f\u6765\u7684 waitpid \u8c03\u7528\u65f6\uff0cwaitpid \u5c06\u4f1a\u7206\u51fa OSError \u5f02\u5e38\uff0c\u4e5f\u5c31\u662f waitpid \u8c03\u7528\u88ab\u6253\u65ad\u4e86\u3002\n\n\u6211\u4eec\u901a\u8fc7\u68c0\u67e5\u5f02\u5e38\u5bf9\u8c61\u91cc\u9762\u7684\u9519\u8bef\u7c7b\u578b\uff0c\u6765\u51b3\u5b9a\u662f\u5426\u8981\u7ee7\u7eed\u91cd\u8bd5\u3002\n\n\u5982\u679c\u5f02\u5e38\u7c7b\u578b\u662f errno.EINTR\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u91cd\u8bd5 waitpid\uff0c\u5982\u679c\u662f errno.ECHILD\uff0c\u8bf4\u660e\u76ee\u6807\u5b50\u8fdb\u7a0b\u5df2\u7ecf\u7ed3\u675f\u4e86\uff0c\u9047\u5230\u5176\u5b83\u7c7b\u578b\u5e94\u8be5\u5411\u4e0a\u629b\u51fa\u5f02\u5e38\u3002\u81f3\u4e8e\u4ec0\u4e48\u662f\u5176\u5b83\u5f02\u5e38\uff0c\u8fd9\u4e2a\u662f\u6ca1\u6709\u5177\u4f53\u5b9a\u4e49\u7684\uff0c\u800c\u4e14\u662f\u4e0d\u5e94\u8be5\u51fa\u73b0\u7684\u3002\n\n```\nwhile True:\n    try:\n        os.waitpid(pid, 0)\n        break  # \u8c03\u7528\u6210\u529f\u9000\u51fa\u5faa\u73af\n    except OSError, ex:\n        if ex.args[0] == errno.ECHILD:\n            break # \u76ee\u6807\u5b50\u8fdb\u7a0b\u5df2\u7ecf\u7ed3\u675f\n        if ex.args[0] == errno.EINTR:\n            continue  # EINTR \u5e94\u8be5\u91cd\u8bd5\n        raise ex  # \u5176\u5b83\u5f02\u5e38\uff0c\u7ee7\u7eed\u5411\u4e0a\u629b\u51fa\n\n```\n\n## \u670d\u52a1\u53d1\u73b0\n\nZooKeeper \u7684\u8282\u70b9\u4fe1\u606f\u4ee5\u6811\u72b6\u7ed3\u6784\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u3002\u6bd4\u5982\u4e0b\u9762\u5c55\u793a\u4e86\u670d\u52a1\u53d1\u73b0\u7684\u4e09\u4e2a\u8282\u70b9\u7ed3\u6784\u4fe1\u606f\u3002\u6bcf\u4e2a\u8282\u70b9\u5185\u90e8\u53ef\u4ee5\u5b58\u50a8\u4e00\u4e2a\u5b57\u8282\u4e32\uff0c\u8282\u70b9\u7528\u4e8e\u670d\u52a1\u53d1\u73b0\u65f6\u5b58\u50a8\u670d\u52a1\u5668\u7684\u5730\u5740\u4fe1\u606f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/25/163962955da73a31?w=513&h=374&f=png&s=28715)\n\n**\u987a\u5e8f\u8282\u70b9**\n\nZooKeeper \u652f\u6301\u987a\u5e8f\u8282\u70b9 (sequence)\uff0c\u5b83\u53ef\u4ee5\u5728\u8282\u70b9\u540d\u79f0\u540e\u9762\u81ea\u52a8\u8ffd\u52a0\u81ea\u589e id\uff0c\u907f\u514d\u8282\u70b9\u540d\u79f0\u91cd\u590d\u3002\u5728\u670d\u52a1\u53d1\u73b0\u4e2d\u4f1a\u6709\u591a\u4e2a\u5b50\u8282\u70b9\uff0c\u4f7f\u7528\u987a\u5e8f\u8282\u70b9\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u589e\u52a0\u5b50\u8282\u70b9\u3002\n\n**\u4e34\u65f6\u8282\u70b9**\n\nZooKeeper \u652f\u6301\u4e34\u65f6\u8282\u70b9 (ephemeral)\uff0c\u5728\u4f1a\u8bdd\u7ed3\u675f\u65f6\uff0c\u4e34\u65f6\u8282\u70b9\u4f1a\u81ea\u52a8\u91ca\u653e\u3002\u4e4b\u6240\u4ee5\u4f1a\u7528\u5230\u4e34\u65f6\u8282\u70b9\u662f\u56e0\u4e3a ZooKeeper \u7684\u4f1a\u8bdd\u652f\u6301\u8fde\u63a5\u65ad\u5f00\u91cd\u8fde\u3002\u77ed\u65f6\u95f4\u7684\u8fde\u63a5\u65ad\u5f00\u5e76\u4e0d\u4f1a\u7acb\u5373\u5220\u9664\u5185\u5b58\u4f1a\u8bdd\uff0c\u800c\u662f\u6709\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u65f6\u95f4\u4e00\u5230\uff0c\u4f1a\u8bdd\u4f1a\u81ea\u52a8\u8fc7\u671f\u3002\u53ef\u4ee5\u663e\u5f0f\u53d1\u9001\u4f1a\u8bdd\u7ed3\u675f\u6307\u4ee4\u5f3a\u5236\u5173\u95ed\u4f1a\u8bdd\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u8fdb\u7a0b\u7a81\u7136 crash \u6389\uff0c\u6765\u4e0d\u53ca\u53d1\u9001\u4f1a\u8bdd\u5173\u95ed\u6307\u4ee4\uff0cZooKeeper \u5c06\u901a\u8fc7\u4f1a\u8bdd\u81ea\u52a8\u8fc7\u671f\u673a\u5236\u5173\u95ed\u4f1a\u8bdd\u3002\n\n## kazoo\n\nkazoo \u662f Python \u8fde\u63a5 ZooKeeper \u7684\u5ba2\u6237\u7aef library\u3002\u5b83\u5bf9 zk \u7684 api \u505a\u4e86\u5f88\u597d\u7684\u5c01\u88c5\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u975e\u5e38\u4fbf\u6377\u5730\u4f7f\u7528 zk\u3002\u6211\u4eec\u5c06\u901a\u8fc7 kazoo \u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u529f\u80fd\u3002\n\n\u751f\u4ea7\u8005\u8d1f\u8d23\u751f\u6210\u670d\u52a1\u53d1\u73b0\u7684\u5b50\u8282\u70b9\uff0c\u5b50\u8282\u70b9\u4f1a\u5b58\u50a8\u670d\u52a1\u5730\u5740\u4fe1\u606f\uff1a\n\n```\n# \u670d\u52a1\u53d1\u73b0\u751f\u4ea7\u8005\nimport json\nimport kazoo\n\nzk = kazoo.KazooClient(hosts=\"localhost:2181\")\nzk.start()  # \u542f\u52a8\u5ba2\u6237\u7aef\uff0c\u5c1d\u8bd5\u8fde\u63a5\nvalue = json.dumps({\"host\": \"127.0.0.1\", \"port\": 8080})\nzk.ensure_path(\"/demo\")  # \u786e\u4fdd\u6839\u8282\u70b9\u5b58\u5728\uff0c\u5982\u679c\u6ca1\u6709\u4f1a\u81ea\u52a8\u521b\u5efa\n# \u521b\u5efa\u987a\u5e8f\u4e34\u65f6\u8282\u70b9\uff0c\u8fd9\u5c31\u662f\u670d\u52a1\u5217\u8868\u4e2d\u7684\u4e00\u4e2a\u5b50\u670d\u52a1\u5730\u5740\u4fe1\u606f\nzk.create(\"/demo/rpc\", value, ephemeral=True, sequence=True)\n# \u5173\u95ed zk \u4f1a\u8bdd\uff0c\u5173\u95ed\u5ba2\u6237\u7aef\uff0c\u5426\u5219\u4e34\u65f6\u8282\u70b9\u4e0d\u4f1a\u7acb\u5373\u6d88\u5931\nzk.stop()\n\n```\n\n\u6d88\u8d39\u8005\u901a\u8fc7\u83b7\u53d6\u5b50\u8282\u70b9\u5217\u8868\u6765\u62ff\u5230\u670d\u52a1\u5730\u5740\uff1a\n\n```\n# \u670d\u52a1\u53d1\u73b0\u6d88\u8d39\u8005\nimport json\nimport kazoo\n\nzk = KazooClient(hosts=\"127.0.0.1:2181\")\nzk.start()\nservers = set()\nfor child in zk.get_children(zk_root):  # \u83b7\u53d6\u5b50\u8282\u70b9\u540d\u79f0\n    node = zk.get(zk_root + \"/\" + child)  # \u83b7\u53d6\u5b50\u8282\u70b9 value\n    addr = json.loads(node[0])\n    servers.add(\"%s:%d\" % (addr[\"host\"], addr[\"port\"])\nservers = list(servers)  # \u4e13\u6210\u5217\u8868\n\n```\n\n**\u76d1\u542c\u670d\u52a1\u8282\u70b9\u53d8\u66f4**\n\nZooKeeper \u63d0\u4f9b\u4e86 watch \u529f\u80fd\uff0c\u5728\u8282\u70b9\u53d8\u52a8\u65f6\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u6536\u5230\u901a\u77e5\uff0c\u8fdb\u800c\u91cd\u52a0\u8f7d\u670d\u52a1\u5217\u8868\u3002\n\n```\ndef callback(*args):\n    new_children = zk.get_children(zk_root, watch=callback)  # \u7ee7\u7eed watch\n\nchildren = zk.get_children(zk_root, watch=callback)  # \u589e\u52a0 watch \u53c2\u6570\n\n```\n\n\u6211\u4eec\u5728 callback \u65b9\u6cd5\u91cc\u91cd\u65b0\u8c03\u7528 get\\_children \u4ee5\u8fbe\u5230\u91cd\u52a0\u8f7d\u670d\u52a1\u5217\u8868\u7684\u76ee\u7684\uff0c\u7136\u540e\u8fd8\u5f97\u7ee7\u7eed watch\uff0c\u6301\u7eed\u76d1\u542c\u670d\u52a1\u8282\u70b9\u53d8\u66f4\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u8282\u7684\u77e5\u8bc6\u70b9\u6bd4\u8f83\u96f6\u6563\uff0c\u5b83\u6d89\u53ca\u5230 Unix \u64cd\u4f5c\u7cfb\u7edf\u548c\u5206\u5e03\u5f0f\u6570\u636e\u5e93 ZooKeeper \u7684\u4e00\u4e9b\u7406\u8bba\u77e5\u8bc6\u548c\u4f7f\u7528\u7ec6\u8282\u3002\u8bfb\u8005\u5728\u9605\u8bfb\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u9047\u5230\u969c\u788d\uff0c\u8fd9\u662f\u6b63\u5e38\u73b0\u8c61\u3002\u5927\u5bb6\u53ef\u4ee5\u5148\u4f7f\u7528\u641c\u7d22\u5f15\u64ce\u5bfb\u627e\u76f8\u5173\u7684\u8d44\u6599\u8fdb\u884c\u6df1\u5165\u4e86\u89e3\uff0c\u7136\u540e\u53ef\u4ee5\u8fdb\u5165\u4ea4\u6d41\u7fa4\u8fdb\u884c\u8ba8\u8bba\u3002\n\n\u8bfb\u8005\u5728\u638c\u63e1\u4e86\u672c\u8282\u7684\u6240\u6709\u57fa\u7840\u77e5\u8bc6\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u8fdb\u5165\u7ec8\u6781\u5b9e\u6218\u73af\u8282 \u2014\u2014 \u7f16\u5199\u5206\u5e03\u5f0f\u7684 RPC \u670d\u52a1\u548c\u5ba2\u6237\u7aef\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u5206\u5e03\u5f0f_2\u5206\u5e03\u5f0f_RPC_\u77e5\u8bc6\u57fa\u7840.md", "create_date": "2020-02-18T21:31:51.522", "order": 16}}, {"model": "subject.chapter", "pk": 79, "fields": {"title": "\u670d\u52a1\u5668 1\uff1a\u3010\u5355\u7ebf\u7a0b\u540c\u6b65\u3011\u6a21\u578b", "topic": 4, "md5": "707f9f860efa047639b269dfdb2b2785", "md_body": "# \u670d\u52a1\u5668 1\uff1a\u3010\u5355\u7ebf\u7a0b\u540c\u6b65\u3011\u6a21\u578b\n\n![](https://user-gold-cdn.xitu.io/2018/6/11/163ef471eb6eaeba?w=1704&h=732&f=png&s=147613)\n\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u73b0\u5728\u6211\u4eec\u5f00\u59cb\u4f7f\u7528\u4ee3\u7801\u6765\u63cf\u8ff0 RPC \u7684\u670d\u52a1\u5668\u6a21\u578b\uff0c\u4ece\u7b80\u5355\u53d8\u5316\u5230\u590d\u6742\uff0c\u4ece\u7ecf\u5178\u53d8\u5316\u5230\u73b0\u4ee3\u3002\u8003\u8651\u5230\u6559\u5b66\u4e0a\u7684\u7b80\u5355\u6027\uff0c\u6211\u4eec\u4f7f\u7528 Python \u8bed\u8a00\u8fdb\u884c\u63cf\u8ff0\uff0c\u540c\u65f6\u4e3a\u4e86\u65b9\u4fbf\u8bfb\u8005\u7406\u89e3\u6838\u5fc3\u7406\u5ff5\uff0c\u4ee3\u7801\u4e0d\u5b9c\u8fc7\u957f\uff0c\u5bf9\u5176\u4e2d\u4e0d\u5c11\u7ec6\u8282\u4e4b\u5904\u505a\u4e86\u7b80\u5316\u5904\u7406\uff0c\u8fd8\u8bf7\u8bfb\u8005\u7406\u89e3\u3002\n\n\u53e6\uff0c\u5982\u679c\u8bfb\u8005\u7f3a\u5c11\u7f51\u7edc\u7f16\u7a0b\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u9605\u8bfb\u540e\u7eed\u4ee3\u7801\u53ef\u80fd\u4f1a\u6709\u969c\u788d\u3002\u5efa\u8bae\u8bfb\u8005\u5148\u5bfb\u627e\u76f8\u5173\u7684\u6587\u7ae0\u8865\u5145\u4e00\u4e0b\u57fa\u7840\u77e5\u8bc6\u3002\n\n## \u9879\u76ee\u6e90\u4ee3\u7801\u5730\u5740\n\n\u672c\u5c0f\u518c\u7684\u6240\u6709\u5b9e\u6218\u4ee3\u7801\u53ef\u4ee5\u5728 [Github](https://github.com/pyloque/juejin_rpc_py) \u4e0a\u76f4\u63a5\u4e0b\u8f7d\u8fd0\u884c\u4f7f\u7528\u3002\u8fd0\u884c\u4ee3\u7801\u9700\u8981 Linux \u6216\u8005 Mac \u8fd0\u884c\u73af\u5883\uff0c\u5982\u679c\u8bfb\u8005\u4f7f\u7528\u7684\u662f Windows\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u865a\u62df\u673a\u6216\u8005\u5b89\u88c5 Docker\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/3/163c484ed0ee0367?w=1052&h=546&f=png&s=62714)\n\n\u672c\u8282\u6211\u4eec\u4f1a\u4e3b\u8981\u8bb2\u89e3\u4ee5\u4e0b\u5185\u5bb9\uff1a\n\n*   \u4f7f\u7528\u4e09\u4e2a\u975e\u5e38\u91cd\u8981\u7684 Python \u5185\u7f6e\u7684\u5e93\uff0c\u5b83\u4eec\u5206\u522b\u662f socket\u3001struct \u548c json\uff0c\u5206\u522b\u627f\u62c5 RPC \u670d\u52a1\u7684\u7f51\u7edc\u901a\u4fe1\u529f\u80fd\u3001\u5b57\u8282\u8f6c\u6362\u529f\u80fd\u548c\u6d88\u606f\u5e8f\u5217\u5316\u529f\u80fd\u3002\n*   \u7f51\u7edc\u901a\u4fe1\u7684\u5185\u5bb9\u662f\u5b57\u8282\u5e8f\u5217\uff0c\u6d88\u606f\u5e8f\u5217\u5316\u7684\u76ee\u6807\u662f\u5c06 Python \u7684\u6570\u636e\u7ed3\u6784\u8f6c\u6362\u6210\u5b57\u8282\u5e8f\u5217\uff0c\u800c\u7528\u4e8e\u754c\u5b9a\u6d88\u606f\u8fb9\u754c\u7684\u6d88\u606f\u957f\u5ea6\u4e5f\u662f\u6d88\u606f\u7684\u4e00\u90e8\u5206\uff0c\u5b83\u9700\u8981\u5c06 Python \u7684\u6574\u5f62\u8f6c\u6362\u6210\u5b57\u8282\u6570\u7ec4\uff0c\u8fd9\u90e8\u5206\u5de5\u4f5c\u662f\u7531 struct \u5e93\u6765\u5b8c\u6210\u3002\n\n## socket\n\nPython \u6709\u5185\u7f6e\u7684\u7f51\u7edc\u7f16\u7a0b\u7c7b\u5e93\uff0c\u65b9\u4fbf\u7528\u6237\u7f16\u5199 tcp/udp \u76f8\u5173\u7684\u4ee3\u7801\u3002\u4e24\u4e2a\u4e0d\u540c\u673a\u5668\u7684\u8fdb\u7a0b\u9700\u8981\u901a\u4fe1\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 socket \u6765\u4f20\u8f93\u6570\u636e\u3002\n\n```\n# \u5957\u63a5\u5b57\u5ba2\u6237\u7aef\u5927\u81f4 API\uff0c\u53c2\u6570\u7565\nsock = socket.socket()  # \u521b\u5efa\u4e00\u4e2a\u5957\u63a5\u5b57\nsock.connect()  # \u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\nsock.recv() # \u8bfb\nsock.send()  # \u5c3d\u53ef\u80fd\u5730\u5199\nsock.sendall()  # \u5b8c\u5168\u5199\nsock.close()  # \u5173\u95ed\n\n```\n\n\u6ce8\u610fsend\u548csendall\u65b9\u6cd5\u7684\u533a\u522b\uff0c\u5728\u7f51\u7edc\u72b6\u51b5\u826f\u597d\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u51e0\u4e4e\u6ca1\u6709\u533a\u522b\u3002\u4f46\u662f\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u662fsend\u65b9\u6cd5\u6709\u53ef\u80fd\u53ea\u4f1a\u53d1\u9001\u4e86\u90e8\u5206\u5185\u5bb9\uff0c\u5b83\u901a\u8fc7\u8fd4\u56de\u503c\u6765\u6307\u793a\u5b9e\u9645\u53d1\u51fa\u53bb\u4e86\u591a\u5c11\u5185\u5bb9\u3002\u800csendall\u65b9\u6cd5\u662f\u5bf9send\u65b9\u6cd5\u7684\u5c01\u88c5\uff0c\u5b83\u8003\u8651\u4e86\u8fd9\u4e2a\u60c5\u51b5\uff0c\u5982\u679c\u7b2c\u4e00\u6b21send\u65b9\u6cd5\u53d1\u9001\u4e0d\u5b8c\u5168\uff0c\u5c31\u4f1a\u5c1d\u8bd5\u7b2c\u4e8c\u6b21\u7b2c\u4e09\u6b21\u5faa\u73af\u53d1\u9001\u76f4\u5230\u5168\u90e8\u5185\u5bb9\u90fd\u53d1\u9001\u51fa\u53bb\u4e86\u6216\u8005\u4e2d\u95f4\u51fa\u4e86\u9519\u8bef\u624d\u4f1a\u8fd4\u56de\u3002\u540e\u7eed\u6240\u6709\u8c03\u7528\u6211\u4eec\u90fd\u4f1a\u4f7f\u7528sendall\u65b9\u6cd5\u3002\n\n```\n# \u5957\u63a5\u5b57\u670d\u52a1\u5668\u5927\u81f4 API\uff0c\u53c2\u6570\u7565\nsock = socket.socket()  # \u521b\u5efa\u4e00\u4e2a\u670d\u52a1\u5668\u5957\u63a5\u5b57\nsock.bind()  # \u7ed1\u5b9a\u7aef\u53e3\nsock.listen()  # \u76d1\u542c\u8fde\u63a5\nsock.accept()  # \u63a5\u53d7\u65b0\u8fde\u63a5\nsock.close()  # \u5173\u95ed\u670d\u52a1\u5668\u5957\u63a5\u5b57\n\n```\n\n## struct\n\nPython \u5185\u7f6e\u7684\u4e8c\u8fdb\u5236\u89e3\u7801\u7f16\u7801\u5e93\uff0c\u7528\u4e8e\u5c06\u5404\u79cd\u4e0d\u540c\u7684\u7c7b\u578b\u7684\u5b57\u6bb5\u7f16\u7801\u6210\u4e8c\u8fdb\u5236\u5b57\u8282\u4e32\u3002\u7c7b\u4f3c\u4e8e java \u8bed\u8a00\u7684 bytebuffer \u53ef\u4ee5\u5c06\u5404\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u5b57\u6bb5\u5185\u5bb9\u7f16\u7801\u6210 byte \u6570\u7ec4\u3002\u6211\u4eec\u901a\u8fc7 struct \u5305\u5c06\u6d88\u606f\u7684\u957f\u5ea6\u6574\u6570\u7f16\u7801\u6210 byte \u6570\u7ec4\u3002\n\n```\nvalue_in_bytes = struct.pack(\"I\", 1024)  # \u5c06\u4e00\u4e2a\u6574\u6570\u7f16\u7801\u6210 4 \u4e2a\u5b57\u8282\u7684\u5b57\u7b26\u4e32\nvalue, = struct.unpack(\"I\", value_in_bytes)  # \u5c06\u4e00\u4e2a 4 \u5b57\u8282\u7684\u5b57\u7b26\u4e32\u89e3\u7801\u6210\u4e00\u4e2a\u6574\u6570\n# \u6ce8\u610f\u7b49\u53f7\u524d\u9762\u6709\u4e2a\u9017\u53f7\uff0c\u8fd9\u4e2a\u975e\u5e38\u91cd\u8981\uff0c\u5b83\u4e0d\u662f\u7b14\u8bef\u3002\n# \u56e0\u4e3a unpack \u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5f88\u957f\u7684\u5b57\u8282\u4e32\u89e3\u7801\u6210\u4e00\u7cfb\u5217\u7684\u5bf9\u8c61\u3002\n# value \u53d6\u8fd9\u4e2a\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5bf9\u8c61\u3002\n\n```\n\n## json\n\nPython \u5185\u7f6e\u7684 json \u5e8f\u5217\u5316\u5e93\u3002\u5b83\u53ef\u4ee5\u5c06\u5185\u5b58\u7684\u5bf9\u8c61\u5e8f\u5217\u5316\u6210 json \u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u5c06\u5b57\u7b26\u4e32\u53cd\u5e8f\u5217\u5316\u6210 Python \u5bf9\u8c61\u3002\u5b83\u7684\u5e8f\u5217\u5316\u6027\u80fd\u4e0d\u9ad8\uff0c\u4f46\u662f\u4f7f\u7528\u65b9\u4fbf\u76f4\u89c2\u3002\n\n```\nraw = json.dumps({\"hello\": \"world\"})  # \u5e8f\u5217\u5316\npo = json.loads(raw)  # \u53cd\u5e8f\u5217\u5316\n\n```\n\n## \u6d88\u606f\u534f\u8bae\n\n\u6211\u4eec\u5c06\u4f7f\u7528\u957f\u5ea6\u524d\u7f00\u6cd5\u6765\u786e\u5b9a\u6d88\u606f\u8fb9\u754c\uff0c\u6d88\u606f\u4f53\u4f7f\u7528 json \u5e8f\u5217\u5316\u3002\n\n\u6bcf\u4e2a\u6d88\u606f\u90fd\u6709\u76f8\u5e94\u7684\u540d\u79f0\uff0c\u8bf7\u6c42\u7684\u540d\u79f0\u4f7f\u7528 in \u5b57\u6bb5\u8868\u793a\uff0c\u8bf7\u6c42\u7684\u53c2\u6570\u4f7f\u7528 params \u5b57\u6bb5\u8868\u793a\uff0c\u54cd\u5e94\u7684\u540d\u79f0\u662f out \u5b57\u6bb5\u8868\u793a\uff0c\u54cd\u5e94\u7684\u7ed3\u679c\u7528 result \u5b57\u6bb5\u8868\u793a\u3002\n\n\u6211\u4eec\u5c06\u8bf7\u6c42\u548c\u54cd\u5e94\u4f7f\u7528 json \u5e8f\u5217\u5316\u6210\u5b57\u7b26\u4e32\u4f5c\u4e3a\u6d88\u606f\u4f53\uff0c\u7136\u540e\u901a\u8fc7 Python \u5185\u7f6e\u7684 struct \u5305\u5c06\u6d88\u606f\u4f53\u7684\u957f\u5ea6\u6574\u6570\u8f6c\u6210 4 \u4e2a\u5b57\u8282\u7684\u957f\u5ea6\u524d\u7f00\u5b57\u7b26\u4e32\u3002\n\n```\n// \u8f93\u5165\n{\n    in: \"ping\",\n    params: \"ireader 0\"\n}\n\n// \u8f93\u51fa\n{\n    out: \"pong\",\n    result: \"ireader 0\"\n}\n\n```\n\n## \u5ba2\u6237\u7aef\u4ee3\u7801\n\n\u540e\u7eed\u4f7f\u7528\u7684\u5ba2\u6237\u7aef\u4ee3\u7801\u662f\u901a\u7528\u7684\uff0c\u5b83\u9002\u7528\u4e8e\u6f14\u793a\u6240\u6709\u670d\u52a1\u5668\u6a21\u578b\u3002\u5b83\u7684\u8fc7\u7a0b\u5c31\u662f\u5411\u670d\u52a1\u5668\u8fde\u7eed\u53d1\u9001 10 \u4e2a RPC \u8bf7\u6c42\uff0c\u5e76\u8f93\u51fa\u670d\u52a1\u5668\u7684\u54cd\u5e94\u7ed3\u679c\u3002\u5b83\u4f7f\u7528\u7ea6\u5b9a\u7684\u957f\u5ea6\u524d\u7f00\u6cd5\u5bf9\u8bf7\u6c42\u6d88\u606f\u8fdb\u884c\u7f16\u7801\uff0c\u5bf9\u54cd\u5e94\u6d88\u606f\u8fdb\u884c\u89e3\u7801\u3002\u5982\u679c\u8981\u6f14\u793a\u591a\u4e2a\u5e76\u53d1\u5ba2\u6237\u7aef\u8fdb\u884c RPC \u8bf7\u6c42\uff0c\u90a3\u5c31\u542f\u52a8\u591a\u4e2a\u5ba2\u6237\u7aef\u8fdb\u7a0b\u3002\n\n```\n# coding: utf-8\n# client.py\n\nimport json\nimport time\nimport struct\nimport socket\n\n\ndef rpc(sock, in_, params):\n    request = json.dumps({\"in\": in_, \"params\": params})  # \u8bf7\u6c42\u6d88\u606f\u4f53\n    length_prefix = struct.pack(\"I\", len(request)) # \u8bf7\u6c42\u957f\u5ea6\u524d\u7f00\n    sock.sendall(length_prefix)\n    sock.sendall(request)\n    length_prefix = sock.recv(4)  # \u54cd\u5e94\u957f\u5ea6\u524d\u7f00\n    length, = struct.unpack(\"I\", length_prefix)\n    body = sock.recv(length) # \u54cd\u5e94\u6d88\u606f\u4f53\n    response = json.loads(body)\n    return response[\"out\"], response[\"result\"]  # \u8fd4\u56de\u54cd\u5e94\u7c7b\u578b\u548c\u7ed3\u679c\n\nif __name__ == '__main__':\n    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    s.connect((\"localhost\", 8080))\n    for i in range(10): # \u8fde\u7eed\u53d1\u9001 10 \u4e2a rpc \u8bf7\u6c42\n        out, result = rpc(s, \"ping\", \"ireader %d\" % i)\n        print out, result\n        time.sleep(1)  # \u4f11\u7720 1s\uff0c\u4fbf\u4e8e\u89c2\u5bdf\n    s.close() # \u5173\u95ed\u8fde\u63a5\n\n```\n\n![](https://user-gold-cdn.xitu.io/2018/5/16/163680245ad03253?w=777&h=283&f=png&s=17566)\n\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\u4ee3\u7801\u4e2d\u6709\u4e24\u4e2a\u5730\u65b9\u8c03\u7528\u4e86`socket.recv`\u65b9\u6cd5\u6765\u8bfb\u53d6\u671f\u671b\u7684\u6d88\u606f\uff0c\u901a\u8fc7\u4f20\u5165\u4e00\u4e2a\u957f\u5ea6\u503c\u6765\u83b7\u53d6\u60f3\u8981\u7684\u5b57\u8282\u6570\u7ec4\u3002\u5b9e\u9645\u4e0a\u8fd9\u6837\u4f7f\u7528\u662f\u4e0d\u4e25\u8c28\u7684\uff0c\u751a\u81f3\u6839\u672c\u5c31\u662f\u9519\u8bef\u7684\u3002\n\n`socket.recv(int)`\u9ed8\u8ba4\u662f\u963b\u585e\u8c03\u7528\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u963b\u585e\u4e5f\u662f\u6709\u6761\u4ef6\u7684\u3002\u5982\u679c\u5185\u6838\u7684\u5957\u63a5\u5b57\u63a5\u6536\u7f13\u5b58\u662f\u7a7a\u7684\uff0c\u5b83\u624d\u4f1a\u963b\u585e\u3002\u53ea\u8981\u91cc\u9762\u6709\u54ea\u6015\u53ea\u6709\u4e00\u4e2a\u5b57\u8282\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u4e0d\u4f1a\u963b\u585e\uff0c\u5b83\u4f1a\u5c3d\u53ef\u80fd\u5c06\u63a5\u53d7\u7f13\u5b58\u4e2d\u7684\u5185\u5bb9\u5e26\u8d70\u6307\u5b9a\u7684\u5b57\u8282\u6570\uff0c\u7136\u540e\u5c31\u7acb\u5373\u8fd4\u56de\uff0c\u800c\u4e0d\u662f\u975e\u8981\u7b49\u5f85\u671f\u671b\u7684\u5b57\u8282\u6570\u5168\u6ee1\u8db3\u4e86\u624d\u8fd4\u56de\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u9700\u8981\u5c1d\u8bd5\u5faa\u73af\u8bfb\u53d6\u624d\u80fd\u6b63\u786e\u5730\u8bfb\u53d6\u5230\u671f\u671b\u7684\u5b57\u8282\u6570\u3002\n\n```\ndef receive(sock, n):\n    rs = []  # \u8bfb\u53d6\u7684\u7ed3\u679c\n    while n > 0:\n        r = sock.recv(n)\n        if not r:  # EOF\n            return rs\n        rs.append(r)\n        n -= len(r)\n    return ''.join(rs)\n\n```\n\n\u4f46\u662f\u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u540e\u9762\u7684\u7ae0\u8282\u4ee3\u7801\u90fd\u76f4\u63a5\u4f7f\u7528socket.recv\uff0c\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u7f51\u7edc\u5ef6\u8fdf\u7684\u60c5\u51b5\u8f83\u5c11\u53d1\u751f\uff0c\u4e00\u822c\u6765\u8bf4\u5f88\u5c11\u4f1a\u9047\u5230recv\u65b9\u6cd5\u4e00\u6b21\u8bfb\u4e0d\u5168\u7684\u60c5\u51b5\u53d1\u751f\u3002\n\n## \u5355\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b\u670d\u52a1\u5668\u4ee3\u7801\n\n\u5355\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b\u7684\u670d\u52a1\u5668\u662f\u6700\u7b80\u5355\u7684\u670d\u52a1\u5668\u6a21\u578b\uff0c\u6bcf\u6b21\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u5176\u5b83\u8fde\u63a5\u5fc5\u987b\u7b49\u5230\u524d\u9762\u7684\u8fde\u63a5\u5173\u95ed\u4e86\u624d\u80fd\u5f97\u5230\u670d\u52a1\u5668\u7684\u5904\u7406\u3002\u5426\u5219\u53d1\u9001\u8fc7\u6765\u7684\u8bf7\u6c42\u4f1a\u60ac\u6302\u4f4f\uff0c\u6ca1\u6709\u4efb\u4f55\u54cd\u5e94\uff0c\u76f4\u5230\u524d\u9762\u7684\u8fde\u63a5\u5904\u7406\u5b8c\u4e86\u624d\u80fd\u7ee7\u7eed\u3002\n\n\u670d\u52a1\u5668\u6839\u636e RPC \u8bf7\u6c42\u7684 in \u5b57\u6bb5\u6765\u67e5\u627e\u76f8\u5e94\u7684 RPC Handler \u8fdb\u884c\u5904\u7406\u3002\u4f8b\u5b50\u4e2d\u53ea\u5c55\u793a\u4e86 ping \u6d88\u606f\u7684\u5904\u7406\u5668\u3002\u5982\u679c\u4f60\u60f3\u652f\u6301\u591a\u79cd\u6d88\u606f\uff0c\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u589e\u52a0\u66f4\u591a\u7684\u5904\u7406\u5668\u51fd\u6570\uff0c\u5e76\u5c06\u5904\u7406\u5668\u51fd\u6570\u6ce8\u518c\u5230\u5168\u5c40\u7684 handlers \u5b57\u5178\u4e2d\u3002\n\n```\n# coding: utf8\n# blocking_single.py\n\nimport json\nimport struct\nimport socket\n\n\ndef handle_conn(conn, addr, handlers):\n    print addr, \"comes\"\n    while True:  # \u5faa\u73af\u8bfb\u5199\n        length_prefix = conn.recv(4)  # \u8bf7\u6c42\u957f\u5ea6\u524d\u7f00\n        if not length_prefix:  # \u8fde\u63a5\u5173\u95ed\u4e86\n            print addr, \"bye\"\n            conn.close()\n            break  # \u9000\u51fa\u5faa\u73af\uff0c\u5904\u7406\u4e0b\u4e00\u4e2a\u8fde\u63a5\n        length, = struct.unpack(\"I\", length_prefix)\n        body = conn.recv(length)  # \u8bf7\u6c42\u6d88\u606f\u4f53  \n        request = json.loads(body)\n        in_ = request['in']\n        params = request['params']\n        print in_, params\n        handler = handlers[in_]  # \u67e5\u627e\u8bf7\u6c42\u5904\u7406\u5668\n        handler(conn, params)  # \u5904\u7406\u8bf7\u6c42\n\n\ndef loop(sock, handlers):\n    while True:\n        conn, addr = sock.accept()  # \u63a5\u6536\u8fde\u63a5\n        handle_conn(conn, addr, handlers)  # \u5904\u7406\u8fde\u63a5\n\n\ndef ping(conn, params):\n    send_result(conn, \"pong\", params)\n\n\ndef send_result(conn, out, result):\n    response = json.dumps({\"out\": out, \"result\": result})  # \u54cd\u5e94\u6d88\u606f\u4f53\n    length_prefix = struct.pack(\"I\", len(response))  # \u54cd\u5e94\u957f\u5ea6\u524d\u7f00\n    conn.sendall(length_prefix)\n    conn.sendall(response)\n\n\nif __name__ == '__main__':\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  # \u521b\u5efa\u4e00\u4e2a TCP \u5957\u63a5\u5b57\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)  # \u6253\u5f00 reuse addr \u9009\u9879\n    sock.bind((\"localhost\", 8080)) # \u7ed1\u5b9a\u7aef\u53e3\n    sock.listen(1)  # \u76d1\u542c\u5ba2\u6237\u7aef\u8fde\u63a5\n    handlers = {  # \u6ce8\u518c\u8bf7\u6c42\u5904\u7406\u5668\n        \"ping\": ping\n    }\n    loop(sock, handlers)  # \u8fdb\u5165\u670d\u52a1\u5faa\u73af\n\n```\n\n\u670d\u52a1\u5668\u8fd0\u884c\u6548\u679c\n\n```\nbash>  Python blocking_single.py\n('127.0.0.1', 58417) comes\nping ireader 0\nping ireader 1\nping ireader 2\nping ireader 3\nping ireader 4\nping ireader 5\nping ireader 6\nping ireader 7\nping ireader 8\nping ireader 9\n('127.0.0.1', 58417) bye\n\n```\n\n\u5ba2\u6237\u7aef\u8fd0\u884c\u6548\u679c\n\n```\nbash> Python client.py\npong ireader 0\npong ireader 1\npong ireader 2\npong ireader 3\npong ireader 4\npong ireader 5\npong ireader 6\npong ireader 7\npong ireader 8\npong ireader 9\n\n```\n\n\u5982\u679c\u5728\u4e0a\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fd0\u884c\u671f\u95f4\uff0c\u518d\u5f00\u4e00\u4e2a\u65b0\u7684\u5ba2\u6237\u7aef\uff0c\u4f1a\u770b\u5230\u65b0\u7684\u5ba2\u6237\u7aef\u6ca1\u6709\u4efb\u4f55\u8f93\u51fa\u3002\u76f4\u5230\u524d\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fd0\u884c\u7ed3\u675f\uff0c\u8f93\u51fa\u624d\u5f00\u59cb\u663e\u793a\u51fa\u6765\u3002\u56e0\u4e3a\u670d\u52a1\u5668\u662f\u4e32\u884c\u5730\u5904\u7406\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\n\n\u8fd9\u6837\u7684\u670d\u52a1\u5668\u6beb\u65e0\u7591\u95ee\u80af\u5b9a\u662f\u4e0d\u4f1a\u6709\u4eba\u7528\u7684\uff0c\u5982\u679c\u4f60\u5bb6\u7684\u670d\u52a1\u5668\u53ea\u80fd\u670d\u52a1\u4e00\u4e2a\u5ba2\u6237\uff0c\u5176\u5b83\u4eba\u90fd\u5f97\u6392\u961f\uff0c\u8fd9\u4e0d\u662f\u8981\u628a\u4eba\u5bb6\u6d3b\u6d3b\u6025\u6b7b\u4e48\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/163761062f0f96b9?w=430&h=316&f=png&s=94455)\n\n\u6240\u4ee5\uff0c\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u4ecb\u7ecd\u670d\u52a1\u5668\u795e\u5947\u7684\u5e76\u53d1\u80fd\u529b\u3002\n\n## \u4f5c\u4e1a\n\n\u672c\u8282\u5e03\u7f6e\u4e00\u4e2a\u96be\u5ea6\u7cfb\u6570\u8f83\u9ad8\u7684\u4f5c\u4e1a\uff0c\u8bf7\u8bfb\u8005\u5b9e\u73b0 Redis \u534f\u8bae\u7684\u7f16\u7801\u548c\u89e3\u7801\u3002\u4e3a\u4e86\u5b8c\u6210\u8fd9\u4e2a\u4f5c\u4e1a\uff0c\u5efa\u8bae\u8bfb\u8005\u5148\u53bb\u6e29\u4e60\u4e00\u4e0b\u524d\u9762\u7ae0\u8282\u5b66\u4e60\u7684 Redis \u534f\u8bae\u683c\u5f0f\u3002\n\n\u4e0d\u5fc5\u60e7\u6015\u56f0\u96be\uff0c\u8d8a\u662f\u56f0\u96be\u7684\u4e8b\u60c5\uff0c\u5b8c\u6210\u4e86\u5c31\u8d8a\u6709\u6210\u5c31\u611f\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u670d\u52a1\u5668_1\u5355\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b.md", "create_date": "2020-02-18T21:31:51.524", "order": 8}}, {"model": "subject.chapter", "pk": 80, "fields": {"title": "\u670d\u52a1\u5668 2\uff1a\u3010\u591a\u7ebf\u7a0b\u540c\u6b65\u3011\u6a21\u578b", "topic": 4, "md5": "6e3f624011536052ac2067a5146bbe7b", "md_body": "# \u670d\u52a1\u5668 2\uff1a\u3010\u591a\u7ebf\u7a0b\u540c\u6b65\u3011\u6a21\u578b\n\n\u4e0a\u8282\u6211\u4eec\u7f16\u5199\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684 RPC \u670d\u52a1\u5668\u6a21\u578b\uff0c\u7b80\u5355\u5230\u540c\u65f6\u53ea\u80fd\u5904\u7406\u5355\u4e2a\u8fde\u63a5\u3002\u672c\u8282\u6211\u4eec\u4e3a\u670d\u52a1\u5668\u589e\u52a0\u591a\u7ebf\u7a0b\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u540c\u65f6\u53ef\u4ee5\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\u540e\u6765\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u518d\u4e5f\u4e0d\u7528\u6392\u961f\u4e86\u3002\u8fd9\u4e5f\u662f\u53e4\u5178 RPC \u670d\u52a1\u6700\u5e38\u89c1\u7684\u5904\u7406\u6a21\u578b\u3002\n\n\u65e2\u7136\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b\uff0c\u81ea\u7136\u79bb\u4e0d\u5f00 Python \u5185\u7f6e\u7684\u591a\u7ebf\u7a0b\u7f16\u7a0b\u5e93\u3002\u6211\u4eec\u5728\u4e0a\u8282\u5f15\u51fa\u7684 socket\u3001struct \u548c json \u4e09\u4e2a\u5e93\u7684\u57fa\u7840\u4e0a\u518d\u589e\u52a0\u7b2c\u56db\u4e2a\u5185\u7f6e\u5e93 thread\uff0c\u672c\u8282\u7a0b\u5e8f\u7684\u591a\u7ebf\u7a0b\u529f\u80fd\u5c06\u7531\u5b83\u6765\u6253\u5f00\u3002\n\n## thread\n\nthread \u662f Python \u5185\u7f6e\u7684\u7ebf\u7a0b\u5e93\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 thread \u5e93\u521b\u5efa\u539f\u751f\u7684\u7ebf\u7a0b\u3002\n\n```\ndef something_heavy(params):\n    pass\n    \nthread.start_new_thread(something_heavy, (params,))\n\n```\n\n\u5982\u679c\u9700\u8981\u5bf9\u7ebf\u7a0b\u8fdb\u884c\u66f4\u52a0\u7cbe\u7ec6\u7684\u63a7\u5236\uff0c\u90a3\u5c31\u9700\u8981\u4f7f\u7528\u5230\u5185\u7f6e\u7684 threading \u7c7b\u5e93\uff0c\u5b83\u662f\u5bf9\u7ebf\u7a0b\u66f4\u9ad8\u7ea7\u7684\u62bd\u8c61\uff0c\u7c7b\u4f3c\u4e8e Java \u8bed\u8a00\u63d0\u4f9b\u7684 Thread \u7c7b\u3002\u4e0d\u8fc7\u672c\u8282\u4e0d\u9700\u8981\u4f7f\u7528\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/16/163686a461346432?w=781&h=396&f=png&s=36885)\n\n## \u591a\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b\n\n\u670d\u52a1\u5668\u53ef\u4ee5\u5e76\u884c\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u6bcf\u6765\u4e00\u4e2a\u65b0\u8fde\u63a5\uff0c\u5219\u5f00\u542f\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u5355\u72ec\u8fdb\u884c\u5904\u7406\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u662f\u540c\u6b65\u8bfb\u5199\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\n\n\u4e0b\u9762\u7684\u4ee3\u7801\u540c\u4e0a\u8282\u5355\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b\u4ee3\u7801\u7684\u5dee\u522b\u53ea\u6709\u4e00\u884c\u4ee3\u7801\u3002\u4e3a\u4e86\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff0c\u6211\u4eec\u5c06\u5b8c\u6574\u7684\u4ee3\u7801\u76f4\u63a5\u8d34\u5728\u4e0b\u6765\u3002\n\n```\n# coding: utf8\n# multithread.py\n\nimport json\nimport struct\nimport socket\nimport thread\n\n\ndef handle_conn(conn, addr, handlers):\n    print addr, \"comes\"\n    while True:  # \u5faa\u73af\u8bfb\u5199\n        length_prefix = conn.recv(4)  # \u8bf7\u6c42\u957f\u5ea6\u524d\u7f00\n        if not length_prefix:  # \u8fde\u63a5\u5173\u95ed\u4e86\n            print addr, \"bye\"\n            conn.close()\n            break  # \u9000\u51fa\u5faa\u73af\uff0c\u9000\u51fa\u7ebf\u7a0b\n        length, = struct.unpack(\"I\", length_prefix)\n        body = conn.recv(length)  # \u8bf7\u6c42\u6d88\u606f\u4f53  \n        request = json.loads(body)\n        in_ = request['in']\n        params = request['params']\n        print in_, params\n        handler = handlers[in_]  # \u67e5\u627e\u8bf7\u6c42\u5904\u7406\u5668\n        handler(conn, params)  # \u5904\u7406\u8bf7\u6c42\n\n\ndef loop(sock, handlers):\n    while True:\n        conn, addr = sock.accept()\n        thread.start_new_thread(handle_conn, (conn, addr, handlers))  # \u5f00\u542f\u65b0\u7ebf\u7a0b\u8fdb\u884c\u5904\u7406\uff0c\u5c31\u8fd9\u884c\u4ee3\u7801\u4e0d\u4e00\u6837\n\n\ndef ping(conn, params):\n    send_result(conn, \"pong\", params)\n\n\ndef send_result(conn, out, result):\n    response = json.dumps({\"out\": out, \"result\": result})\n    length_prefix = struct.pack(\"I\", len(response))\n    conn.sendall(length_prefix)\n    conn.sendall(response)\n\n\nif __name__ == '__main__':\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((\"localhost\", 8080))\n    sock.listen(1)\n    handlers = {\n        \"ping\": ping\n    }\n    loop(sock, handlers)\n\n```\n\n\u5f53\u6211\u4eec\u540c\u65f6\u5f00\u542f 2 \u4e2a\u5ba2\u6237\u7aef\u65f6\uff0c\u4ece\u4e0b\u9762\u670d\u52a1\u5668\u7684\u8f93\u51fa\u53ef\u4ee5\u770b\u51fa\u670d\u52a1\u5668\u786e\u5b9e\u662f\u5728\u5e76\u884c\u5904\u7406\u591a\u4e2a\u8fde\u63a5\uff1a\n\n```\nbash>  python multithread.py\n('127.0.0.1', 60181) comes\nping ireader 0\nping ireader 1\nping ireader 2\nping ireader 3\n('127.0.0.1', 60188) comes\nping ireader 0\nping ireader 4\nping ireader 1\nping ireader 5\nping ireader 2\nping ireader 6\nping ireader 3\nping ireader 7\nping ireader 4\nping ireader 8\nping ireader 5\nping ireader 9\nping ireader 6\n('127.0.0.1', 60181) bye\nping ireader 7\nping ireader 8\nping ireader 9\n('127.0.0.1', 60188) bye\n\n```\n\n\u770b\u5230\u8fd9\u91cc\uff0c\u8bfb\u8005\u4eec\uff0c\u4f60\u4eec\u5e94\u8be5\u611f\u5230\u6fc0\u52a8\uff0c\u56e0\u4e3a\u5e76\u53d1\u7684\u6f58\u591a\u62c9\u9b54\u76d2\u5df2\u7ecf\u88ab\u4f60\u4eec\u6253\u5f00\u4e86\u3002\u5e76\u53d1\u7684\u4e16\u754c\u91cc\u4e30\u5bcc\u591a\u5f69\uff0c\u65e0\u6570\u7684\u9ad8\u624b\u5728\u91cc\u9762\u6d41\u8fde\u5fd8\u8fd4\u3002\u6b64\u523b\uff0c\u4f60\u4eec\u4e0e\u7f16\u7a0b\u9ad8\u624b\u7684\u8ddd\u79bb\u5177\u4f53\u8fd8\u5dee\u3002\u3002\u3002\u3002\u5176\u5b9e\u8fd8\u662f\u5f88\u8fdc\u3002\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u8981\u5f00\u59cb\u8bb2\u89e3\u591a\u8fdb\u7a0b\u5e76\u53d1\uff0c\u54c7\u54c7\uff0c\u9177\u6bd9\u4e86\uff0c\u6709\u6ca1\u6709\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/163761b9752e1261?w=272&h=160&f=png&s=24745)\n\n\u591a\u8fdb\u7a0b\u7684\u9b45\u529b\uff0cJava \u8bed\u8a00\u5f00\u53d1\u8005\u591a\u6570\u662f\u6ca1\u6709\u673a\u4f1a\u4f53\u9a8c\u5230\u7684\uff0c\u4ed6\u4eec\u901a\u5e38\u53ea\u4f1a\u4f7f\u7528\u591a\u7ebf\u7a0b\u3002\n\n## \u7ec3\u4e60\u9898\n\n1.  \u589e\u52a0\u4e00\u4e2a\u65b0\u7684 RPC \u670d\u52a1\uff0c\u8ba1\u7b97\u6590\u6ce2\u90a3\u5951\u7ea7\u6570\u3002\n2.  \u589e\u52a0\u4e00\u4e2a\u65b0\u7684 RPC \u670d\u52a1\uff0c\u63d0\u4f9b Redis \u7684\u7f13\u5b58\u670d\u52a1 API\uff0c\u53ef\u4ee5\u5728\u5ba2\u6237\u7aef\u4f7f\u7528 RPC \u8c03\u7528\u6765\u8fdb\u884c\u7f13\u5b58 key/value \u7684\u589e\u5220\u6539\u64cd\u4f5c\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u670d\u52a1\u5668_2\u591a\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b.md", "create_date": "2020-02-18T21:31:51.547", "order": 9}}, {"model": "subject.chapter", "pk": 81, "fields": {"title": "\u5206\u5e03\u5f0f 3\uff1a\u5206\u5e03\u5f0f RPC \u5b9e\u6218", "topic": 4, "md5": "8e6f867df76e2481447953d5fe1bd6e0", "md_body": "# \u5206\u5e03\u5f0f 3\uff1a\u5206\u5e03\u5f0f RPC \u5b9e\u6218\n\n\u5206\u5e03\u5f0f RPC \u670d\u52a1\u5f00\u53d1\u5b9e\u6218\u8fd9\u4e2a\u5927\u4f5c\u4e1a\u5c06\u5206\u4e3a\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u4e24\u4e2a\u6a21\u5757\uff0c\u6bcf\u4e2a\u6a21\u5757\u90fd\u4e0d\u662f\u7279\u522b\u7b80\u5355\u3002\n\n\u670d\u52a1\u5668\u8981\u8fdb\u884c\u590d\u6742\u7684\u8fdb\u7a0b\u7ba1\u7406\uff0c\u5ba2\u6237\u7aef\u8981\u8fdb\u884c\u590d\u6742\u7684\u670d\u52a1\u5217\u8868\u53d8\u66f4\u5904\u7406\u3002\u6700\u7ec8\u6211\u4eec\u5c06\u6253\u9020\u51fa\u4e00\u4e2a\u53ef\u7528\u7684\u9ad8\u6027\u80fd\u5206\u5e03\u5f0f RPC \u670d\u52a1\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u6a2a\u5411\u6269\u5c55\u5230\u591a\u4e2a\u673a\u5668\u591a\u4e2a\u8282\u70b9\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u5b9e\u65f6\u968f\u7740\u670d\u52a1\u5668\u7684\u53d8\u52a8\u800c\u52a8\u6001\u5207\u6362\u8c03\u7528\u5730\u5740\u3002\n\n\u4e0b\u9762\u8fd9\u5f20\u56fe\u5c31\u662f\u672c\u8282\u5927\u4f5c\u4e1a\u7684\u5168\u8c8c\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b40840eca31e5?w=1134&h=475&f=png&s=95754)\n\n\u6211\u4eec\u5148\u5b8c\u6210\u5de6\u534a\u90e8\u5206\uff1a\n\n*   \u5b9e\u73b0\u51fa\u4e00\u4e2a PreForking \u5f02\u6b65\u6a21\u578b\u7684\u5355\u673a RPC \u670d\u52a1\u5668\uff1b\n*   \u7136\u540e\u5c06\u670d\u52a1\u6302\u63a5\u5230 ZooKeeper \u7684\u6811\u8282\u70b9\u4e0a\uff1b\n*   \u518d\u7f16\u5199\u5ba2\u6237\u7aef\u6d88\u8d39\u8005\u4ece ZooKeeper \u4e2d\u8bfb\u53d6\u670d\u52a1\u8282\u70b9\u5730\u5740\uff0c\u8fde\u63a5 RPC \u670d\u52a1\u5668\u8fdb\u884c\u4ea4\u4e92\uff1b\n*   \u540c\u65f6\u8fd8\u8981\u76d1\u542c ZooKeeper \u6811\u8282\u70b9\u7684\u53d8\u66f4\uff0c\u5728 RPC \u670d\u52a1\u5668\u8282\u70b9\u53d8\u52a8\u65f6\u80fd\u52a8\u6001\u8c03\u6574\u670d\u52a1\u5217\u8868\u5730\u5740\u3002\n*   \u5355\u673a\u670d\u52a1\u5668\u7684\u5185\u5bb9\u4f1a\u6bd4\u4e4b\u524d\u8981\u590d\u6742\u4e00\u4e9b\uff0c\u56e0\u4e3a\u8981\u8003\u8651\u5468\u5168\uff0c\u5bf9\u5b50\u8fdb\u7a0b\u8fdb\u884c\u7ba1\u7406\uff0c\u8981\u5904\u7406\u4fe1\u53f7\u76d1\u542c\u548c\u5b50\u8fdb\u7a0b\u6536\u5272\u7b49\uff0c\u8fd9\u4e5f\u662f\u5bf9\u4e0a\u8282\u7406\u8bba\u5185\u5bb9\u7684\u5b9e\u6218\u5f00\u53d1\u5e94\u7528\u3002\n\n\u672c\u8282\u6211\u4eec\u8fd8\u5c06\u589e\u52a0\u4e00\u4e2a\u65b0\u7684 RPC \u670d\u52a1\uff0c\u8ba1\u7b97\u5706\u5468\u7387\uff0c\u4f7f\u5f97\u6211\u4eec\u7684 RPC \u670d\u52a1\u4e0d\u518d\u8fc7\u4e8e\u5355\u8c03\u3002\u9996\u5148\u6211\u4eec\u770b\u5706\u5468\u7387\u516c\u5f0f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b3f5b64ff9974?w=1288&h=194&f=png&s=31781)\n\n\u6211\u4eec\u901a\u8fc7\u589e\u5927 n \u7684\u503c\uff0c\u7ea7\u6570\u7684\u503c\u5c31\u8d8a\u6765\u8d8a\u63a5\u8fd1\u5706\u5468\u7387\uff0cn \u7684\u503c\u5c06\u4f5c\u4e3a\u5706\u5468\u7387\u670d\u52a1\u7684\u53c2\u6570\u3002\n\n## \u5b8c\u6574\u7684 RPC \u670d\u52a1\u5668\n\n\u7ee7\u4e0a\u8282\u7684\u5f02\u6b65 prefork \u670d\u52a1\u5668\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u589e\u52a0\u4e86\u670d\u52a1\u53d1\u73b0\u3001\u5b50\u8fdb\u7a0b\u6536\u5272\u3001\u4fe1\u53f7\u5904\u7406\u529f\u80fd\u3002\u5f02\u6b65\u591a\u8fdb\u7a0b\u670d\u52a1\u5171\u4eab\u540c\u6837\u7684\u76d1\u542c\u5730\u5740\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u7236\u8fdb\u7a0b\u6ce8\u518c\u670d\u52a1\u5373\u53ef\u3002\n\n*   \u7236\u8fdb\u7a0b\u9700\u8981\u8bbe\u7f6e SIGCHLD \u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6536\u5272\u610f\u5916\u9000\u51fa\u7684\u5b50\u8fdb\u7a0b\uff0c\u907f\u514d\u50f5\u5c38\u8fdb\u7a0b\u3002\n*   \u7236\u8fdb\u7a0b\u9700\u8981\u5728\u8fdb\u7a0b\u9000\u51fa\u4e4b\u524d\u6740\u6b7b\u6240\u6709\u5b50\u8fdb\u7a0b\u5e76\u6536\u5272\u4e4b\u3002\n*   \u7236\u8fdb\u7a0b\u9700\u8981\u5728\u9000\u51fa\u65f6\u5173\u95ed zk \u4f1a\u8bdd\uff0c\u7acb\u5373\u91ca\u653e\u4e34\u65f6\u8282\u70b9\u3002\n*   \u7236\u8fdb\u7a0b\u9700\u8981\u8003\u8651 waitpid \u88ab\u5176\u5b83\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6253\u65ad\u65f6\u8fdb\u884c\u91cd\u8bd5\u3002\n*   \u7236\u8fdb\u7a0b\u5728\u6740\u6b7b\u5b50\u8fdb\u7a0b\u65f6\u6709\u53ef\u80fd\u9047\u5230\u5b50\u8fdb\u7a0b\u5df2\u7ecf\u63d0\u524d\u6b7b\u6389\u4e86\uff0c\u8fd9\u65f6\u4f1a\u7206\u51fa\u5f02\u5e38\u9700\u8981\u8fdb\u884c\u6355\u83b7\u3002\n\n```\n# coding: utf8\n\nimport os\nimport sys\nimport math\nimport json\nimport errno\nimport struct\nimport signal\nimport socket\nimport asyncore\nfrom cStringIO import StringIO\nfrom kazoo.client import KazooClient\n\n\nclass RPCHandler(asyncore.dispatcher_with_send):\n\n    def __init__(self, sock, addr):\n        asyncore.dispatcher_with_send.__init__(self, sock=sock)\n        self.addr = addr\n        self.handlers = {\n            \"ping\": self.ping,\n            \"pi\": self.pi\n        }\n        self.rbuf = StringIO()\n\n    def handle_connect(self):\n        print self.addr, 'comes'\n\n    def handle_close(self):\n        print self.addr, 'bye'\n        self.close()\n\n    def handle_read(self):\n        while True:\n            content = self.recv(1024)\n            if content:\n                self.rbuf.write(content)\n            if len(content) < 1024:\n                break\n        self.handle_rpc()\n\n    def handle_rpc(self):\n        while True:\n            self.rbuf.seek(0)\n            length_prefix = self.rbuf.read(4)\n            if len(length_prefix) < 4:\n                break\n            length, = struct.unpack(\"I\", length_prefix)\n            body = self.rbuf.read(length)\n            if len(body) < length:\n                break\n            request = json.loads(body)\n            in_ = request['in']\n            params = request['params']\n            print os.getpid(), in_, params\n            handler = self.handlers[in_]\n            handler(params)\n            left = self.rbuf.getvalue()[length + 4:]\n            self.rbuf = StringIO()\n            self.rbuf.write(left)\n        self.rbuf.seek(0, 2)\n\n    def ping(self, params):\n        self.send_result(\"pong\", params)\n\n    def pi(self, n):\n        s = 0.0\n        for i in range(n+1):\n            s += 1.0/(2*i+1)/(2*i+1)\n        result = math.sqrt(8*s)\n        self.send_result(\"pi_r\", result)\n\n    def send_result(self, out, result):\n        response = {\"out\": out, \"result\": result}\n        body = json.dumps(response)\n        length_prefix = struct.pack(\"I\", len(body))\n        self.send(length_prefix)\n        self.send(body)\n\n\nclass RPCServer(asyncore.dispatcher):\n\n    zk_root = \"/demo\"\n    zk_rpc = zk_root + \"/rpc\"\n\n    def __init__(self, host, port):\n        asyncore.dispatcher.__init__(self)\n        self.host = host\n        self.port = port\n        self.create_socket(socket.AF_INET, socket.SOCK_STREAM)\n        self.set_reuse_addr()\n        self.bind((host, port))\n        self.listen(1)\n        self.child_pids = []\n        if self.prefork(10):  # \u4ea7\u751f\u5b50\u8fdb\u7a0b\n            self.register_zk()  # \u6ce8\u518c\u670d\u52a1\n            self.register_parent_signal()  # \u7236\u8fdb\u7a0b\u5584\u540e\u5904\u7406\n        else:\n            self.register_child_signal()  # \u5b50\u8fdb\u7a0b\u5584\u540e\u5904\u7406\n\n    def prefork(self, n):\n        for i in range(n):\n            pid = os.fork()\n            if pid < 0:  # fork error\n                raise\n            if pid > 0:  # parent process\n                self.child_pids.append(pid)\n                continue\n            if pid == 0:\n                return False  # child process\n        return True\n\n    def register_zk(self):\n        self.zk = KazooClient(hosts='127.0.0.1:2181')\n        self.zk.start()\n        self.zk.ensure_path(self.zk_root)  # \u521b\u5efa\u6839\u8282\u70b9\n        value = json.dumps({\"host\": self.host, \"port\": self.port})\n        # \u521b\u5efa\u670d\u52a1\u5b50\u8282\u70b9\n        self.zk.create(self.zk_rpc, value, ephemeral=True, sequence=True)\n\n    def exit_parent(self, sig, frame):\n        self.zk.stop()  # \u5173\u95ed zk \u5ba2\u6237\u7aef\n        self.close()  # \u5173\u95ed serversocket\n        asyncore.close_all()  # \u5173\u95ed\u6240\u6709 clientsocket\n        pids = []\n        for pid in self.child_pids:\n            print 'before kill'\n            try:\n                os.kill(pid, signal.SIGINT)  # \u5173\u95ed\u5b50\u8fdb\u7a0b\n                pids.append(pid)\n            except OSError, ex:\n                if ex.args[0] == errno.ECHILD:  # \u76ee\u6807\u5b50\u8fdb\u7a0b\u5df2\u7ecf\u63d0\u524d\u6302\u4e86\n                    continue\n                raise ex\n            print 'after kill', pid\n        for pid in pids:\n            while True:\n                try:\n                    os.waitpid(pid, 0)  # \u6536\u5272\u76ee\u6807\u5b50\u8fdb\u7a0b\n                    break\n                except OSError, ex:\n                    if ex.args[0] == errno.ECHILD:  # \u5b50\u8fdb\u7a0b\u5df2\u7ecf\u5272\u8fc7\u4e86\n                        break\n                    if ex.args[0] != errno.EINTR:\n                        raise ex  # \u88ab\u5176\u5b83\u4fe1\u53f7\u6253\u65ad\u4e86\uff0c\u8981\u91cd\u8bd5\n            print 'wait over', pid\n\n    def reap_child(self, sig, frame):\n        print 'before reap'\n        while True:\n            try:\n                info = os.waitpid(-1, os.WNOHANG)  # \u6536\u5272\u4efb\u610f\u5b50\u8fdb\u7a0b\n                break\n            except OSError, ex:\n                if ex.args[0] == errno.ECHILD:\n                    return  # \u6ca1\u6709\u5b50\u8fdb\u7a0b\u53ef\u4ee5\u6536\u5272\n                if ex.args[0] != errno.EINTR:\n                    raise ex  # \u88ab\u5176\u5b83\u4fe1\u53f7\u6253\u65ad\u8981\u91cd\u8bd5\n        pid = info[0]\n        try:\n            self.child_pids.remove(pid)\n        except ValueError:\n            pass\n        print 'after reap', pid\n\n    def register_parent_signal(self):\n        signal.signal(signal.SIGINT, self.exit_parent)\n        signal.signal(signal.SIGTERM, self.exit_parent)\n        signal.signal(signal.SIGCHLD, self.reap_child)  # \u76d1\u542c\u5b50\u8fdb\u7a0b\u9000\u51fa\n\n    def exit_child(self, sig, frame):\n        self.close()  # \u5173\u95ed serversocket\n        asyncore.close_all()  # \u5173\u95ed\u6240\u6709 clientsocket\n        print 'all closed'\n\n    def register_child_signal(self):\n        signal.signal(signal.SIGINT, self.exit_child)\n        signal.signal(signal.SIGTERM, self.exit_child)\n\n    def handle_accept(self):\n        pair = self.accept()  # \u63a5\u6536\u65b0\u8fde\u63a5\n        if pair is not None:\n            sock, addr = pair\n            RPCHandler(sock, addr)\n\n\nif __name__ == '__main__':\n    host = sys.argv[1]\n    port = int(sys.argv[2])\n    RPCServer(host, port)\n    asyncore.loop()  # \u542f\u52a8\u4e8b\u4ef6\u5faa\u73af\n\n```\n\n## \u5b8c\u6574\u7684 RPC \u5ba2\u6237\u7aef\n\n\u6211\u4eec\u7ed9\u4e0a\u8282\u7684\u5ba2\u6237\u7aef\u4ee3\u7801\u589e\u52a0\u4e86\u83b7\u53d6\u670d\u52a1\u5217\u8868\u529f\u80fd\uff0c\u5e76\u6301\u7eed\u76d1\u542c\u670d\u52a1\u5217\u8868\u53d8\u66f4\uff0c\u7136\u540e\u5faa\u73af\u968f\u673a\u9009\u51fa\u4e00\u4e2a\u53ef\u7528\u670d\u52a1\u5668\u53d1\u9001 ping \u6307\u4ee4\u548c pi \u6307\u4ee4\u8f93\u51fa\u670d\u52a1\u5668\u53cd\u9988\u3002\n\n\u5f53\u670d\u52a1\u5217\u8868\u53d8\u66f4\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06\u65b0\u7684\u670d\u52a1\u5217\u8868\u548c\u5185\u5b58\u4e2d\u73b0\u6709\u7684\u670d\u52a1\u5217\u8868\u8fdb\u884c\u6bd4\u5bf9\uff0c\u521b\u5efa\u65b0\u7684\u8fde\u63a5\uff0c\u5173\u95ed\u65e7\u7684\u8fde\u63a5\u3002\n\n```\n# coding: utf-8\n\nimport json\nimport time\nimport struct\nimport socket\nimport random\nfrom kazoo.client import KazooClient\n\nzk_root = \"/demo\"\n\nG = {\"servers\": None}  # \u5168\u5c40\u53d8\u91cf\uff0cRemoteServer \u5bf9\u8c61\u5217\u8868\n\n\nclass RemoteServer(object):  # \u5c01\u88c5 rpc \u5957\u63a5\u5b57\u5bf9\u8c61\n\n    def __init__(self, addr):\n        self.addr = addr\n        self._socket = None\n\n    @property\n    def socket(self):  # \u61d2\u60f0\u8fde\u63a5\n        if not self._socket:\n            self.connect()\n        return self._socket\n\n    def ping(self, twitter):\n        return self.rpc(\"ping\", twitter)\n\n    def pi(self, n):\n        return self.rpc(\"pi\", n)\n\n    def rpc(self, in_, params):\n        sock = self.socket\n        request = json.dumps({\"in\": in_, \"params\": params})\n        length_prefix = struct.pack(\"I\", len(request))\n        sock.send(length_prefix)\n        sock.sendall(request)\n        length_prefix = sock.recv(4)\n        length, = struct.unpack(\"I\", length_prefix)\n        body = sock.recv(length)\n        response = json.loads(body)\n        return response[\"out\"], response[\"result\"]\n\n    def connect(self):\n        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        host, port = self.addr.split(\":\")\n        sock.connect((host, int(port)))\n        self._socket = sock\n\n    def reconnect(self):  # \u91cd\u8fde\n        self.close()\n        self.connect()\n\n    def close(self):\n        if self._socket:\n            self._socket.close()\n            self._socket = None\n\n\ndef get_servers():\n    zk = KazooClient(hosts=\"127.0.0.1:2181\")\n    zk.start()\n    current_addrs = set()  # \u5f53\u524d\u6d3b\u8dc3\u5730\u5740\u5217\u8868\n\n    def watch_servers(*args):  # \u95ed\u5305\u51fd\u6570\n        new_addrs = set()\n        # \u83b7\u53d6\u65b0\u7684\u670d\u52a1\u5730\u5740\u5217\u8868\uff0c\u5e76\u6301\u7eed\u76d1\u542c\u670d\u52a1\u5217\u8868\u53d8\u52a8\n        for child in zk.get_children(zk_root, watch=watch_servers):\n            node = zk.get(zk_root + \"/\" + child)\n            addr = json.loads(node[0])\n            new_addrs.add(\"%s:%d\" % (addr[\"host\"], addr[\"port\"]))\n        # \u65b0\u589e\u7684\u5730\u5740\n        add_addrs = new_addrs - current_addrs\n        # \u5220\u9664\u7684\u5730\u5740\n        del_addrs = current_addrs - new_addrs\n        del_servers = []\n        # \u5148\u627e\u51fa\u6240\u6709\u7684\u5f85\u5220\u9664 server \u5bf9\u8c61\n        for addr in del_addrs:\n            for s in G[\"servers\"]:\n                if s.addr == addr:\n                    del_servers.append(s)\n                    break\n        # \u4f9d\u6b21\u5220\u9664\u6bcf\u4e2a server\n        for server in del_servers:\n            G[\"servers\"].remove(server)\n            current_addrs.remove(server.addr)\n        # \u65b0\u589e server\n        for addr in add_addrs:\n            G[\"servers\"].append(RemoteServer(addr))\n            current_addrs.add(addr)\n\n    # \u9996\u6b21\u83b7\u53d6\u8282\u70b9\u5217\u8868\u5e76\u6301\u7eed\u76d1\u542c\u670d\u52a1\u5217\u8868\u53d8\u66f4\n    for child in zk.get_children(zk_root, watch=watch_servers):\n        node = zk.get(zk_root + \"/\" + child)\n        addr = json.loads(node[0])\n        current_addrs.add(\"%s:%d\" % (addr[\"host\"], addr[\"port\"]))\n    G[\"servers\"] = [RemoteServer(s) for s in current_addrs]\n    return G[\"servers\"]\n\n\ndef random_server():  # \u968f\u673a\u83b7\u53d6\u4e00\u4e2a\u670d\u52a1\u8282\u70b9\n    if G[\"servers\"] is None:\n        get_servers()  # \u9996\u6b21\u521d\u59cb\u5316\u670d\u52a1\u5217\u8868\n    if not G[\"servers\"]:\n        return\n    return random.choice(G[\"servers\"])\n\n\nif __name__ == '__main__':\n    for i in range(100):\n        server = random_server()\n        if not server:\n            break  # \u5982\u679c\u6ca1\u6709\u8282\u70b9\u5b58\u6d3b\uff0c\u5c31\u9000\u51fa\n        time.sleep(0.5)\n        try:\n            out, result = server.ping(\"ireader %d\" % i)\n            print server.addr, out, result\n        except Exception, ex:\n            server.close()  # \u9047\u5230\u9519\u8bef\uff0c\u5173\u95ed\u8fde\u63a5\n            print ex\n        server = random_server()\n        if not server:\n            break  # \u5982\u679c\u6ca1\u6709\u8282\u70b9\u5b58\u6d3b\uff0c\u5c31\u9000\u51fa\n        time.sleep(0.5)\n        try:\n            out, result = server.pi(i)\n            print server.addr, out, result\n        except Exception, ex:\n            server.close()  # \u9047\u5230\u9519\u8bef\uff0c\u5173\u95ed\u8fde\u63a5\n            print ex\n\n```\n\n## \u8fd0\u884c\n\n```\n# \u5f00\u4e00\u4e2a\u670d\u52a1\u7aef\u7a97\u53e3\npython server.py localhost 8080\n# \u518d\u5f00\u4e00\u4e2a\u670d\u52a1\u7aef\u7a97\u53e3\npython server.py localhost 8081\n# \u5f00\u4e00\u4e2a\u5ba2\u6237\u7aef\u7a97\u53e3\npython client.py\n# \u518d\u5f00\u4e00\u4e2a\u5ba2\u6237\u7aef\u7a97\u53e3\npython client.py\n\n```\n\n\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\n\n```\n...\nlocalhost:8888 pong ireader 93\nlocalhost:8888 pi_r 3.1382045832\nlocalhost:8888 pong ireader 94\nlocalhost:8888 pi_r 3.13824026548\nlocalhost:8888 pong ireader 95\nlocalhost:8888 pi_r 3.13827520401\nlocalhost:8888 pong ireader 96\nlocalhost:8888 pi_r 3.13830942181\nlocalhost:8888 pong ireader 97\nlocalhost:8888 pi_r 3.13834294093\nlocalhost:8888 pong ireader 98\nlocalhost:8888 pi_r 3.13837578257\nlocalhost:8888 pong ireader 99\nlocalhost:8888 pi_r 3.13840796707\n\n```\n\n\u6211\u4eec\u770b\u5230\u4e24\u4e2a\u670d\u52a1\u5730\u5740\u90fd\u6b63\u786e\u8fd4\u56de\u4e86\u54cd\u5e94\uff0c\u968f\u7740\u53c2\u6570 n \u7684\u9010\u6e10\u589e\u5927\uff0cpi \u7684\u503c\u8d8a\u6765\u8d8a\u63a5\u8fd1\u5706\u5468\u7387\u3002\n\n\u53e6\u5916\u5982\u679c\u4efb\u610f\u5173\u95ed\u4e00\u4e2a\u670d\u52a1\u8282\u70b9\uff0c\u53ef\u4ee5\u770b\u5230\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u6301\u7eed\u6b63\u5e38\u8f93\u51fa\uff0c\u89c2\u5bdf\u8f93\u51fa\u7684\u670d\u52a1\u5730\u5740\u53ea\u5269\u4e00\u4e2a\u4e86\u3002\u5982\u679c\u518d\u91cd\u65b0\u542f\u52a8\u8fd9\u4e2a\u670d\u52a1\u8282\u70b9\uff0c\u5ba2\u6237\u7aef\u7684\u8f93\u51fa\u5730\u5740\u81ea\u52a8\u6062\u590d\u5230\u6b63\u5e38\u7684\u4e24\u4e2a\u5730\u5740\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u8282\u5185\u5bb9\u662f RPC \u5b9e\u6218\u5f00\u53d1\u7684\u6700\u540e\u4e00\u8282\uff0c\u4e5f\u662f\u6700\u96be\u7684\u4e00\u8282\u3002\u5b83\u6d89\u53ca\u7684\u77e5\u8bc6\u70b9\u975e\u5e38\u7e41\u591a\u3002\u8bf7\u8bfb\u8005\u52a1\u5fc5\u4fdd\u6301\u8010\u5fc3\uff0c\u5bf9\u4e0d\u719f\u6089\u7684\u6280\u672f\u77e5\u8bc6\u8fdb\u884c\u5404\u4e2a\u51fb\u7834\u3002\u7406\u89e3\u672c\u8282\u4ee3\u7801\u9700\u8981\u8bfb\u8005\u5177\u5907\u4e00\u5b9a\u7684\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u77e5\u8bc6\uff0c\u8fd8\u6709 ZooKeeper \u670d\u52a1\u53d1\u73b0\u7684\u4f7f\u7528\u65b9\u6cd5\u3002\n\n\u5982\u679c\u4f60\u5b8c\u5168\u7406\u89e3\u4e86\u4ee5\u4e0a\u4ee3\u7801\uff0c\u8bf4\u660e\u4f60\u7684\u6c34\u5e73\u5df2\u7ecf\u8fdb\u5165\u4e86\u9ad8\u7ea7\u5c42\u6b21\uff0c\u8fd9\u4e9b\u77e5\u8bc6\u5728\u4f60\u8eab\u8fb9\u81f3\u5c11\u6709 90% \u4ee5\u4e0a\u7684 Python \u7a0b\u5e8f\u5458\u90fd\u4e0d\u5177\u5907\uff0c\u4f60\u5df2\u7ecf\u6b63\u5f0f\u8e0f\u4e0a\u4e86\u5c11\u6709\u4eba\u8d70\u7684\u8def\u3002\n\n\u540e\u9762\u6211\u4eec\u5c06\u5bf9\u6700\u6709\u4ee3\u8868\u6027\u7684\u4e24\u4e2a\u5f00\u6e90 RPC \u6846\u67b6\u8fdb\u884c\u9010\u4e2a\u8bb2\u89e3\u3002\u4ece\u5de5\u7a0b\u89d2\u5ea6\uff0c\u4f7f\u7528\u8fd9\u4e9b\u5f00\u6e90\u7684\u3001\u6210\u719f\u7684\u5927\u578b\u4e92\u8054\u7f51\u516c\u53f8\u9020\u51fa\u6765\u7684\u8f6e\u5b50\u662f\u4e00\u4e2a\u975e\u5e38\u7ecf\u6d4e\u7684\u9009\u62e9\u3002\u800c\u4e14\u4f60\u5df2\u7ecf\u901a\u8fc7\u300c\u9020\u8f6e\u5b50\u300d\u6df1\u5165\u7406\u89e3\u4e86 RPC \u539f\u7406\uff0c\u518d\u5e94\u7528\u8fd9\u4e9b\u5f00\u6e90\u6846\u67b6\uff0c\u4e5f\u4f1a\u611f\u5230\u66f4\u52a0\u5f97\u5fc3\u5e94\u624b\u3002\n\n## \u7ec3\u4e60\n\n\u8bf7\u8bfb\u8005\u5c06 zk \u6362\u6210 etcd \u6765\u5b8c\u6210 RPC \u670d\u52a1\u7684\u5206\u5e03\u5f0f\u5316\uff0c\u8fd9\u8981\u6c42\u8bfb\u8005\u5b66\u4f1a\u642d\u5efa etcd \u670d\u52a1\u5668\u3002\u7b80\u5355\u5316\u610f\u89c1\uff0c\u8bfb\u8005\u53ef\u4ee5\u4f7f\u7528 Docker \u6765\u542f\u52a8 etcd \u670d\u52a1\u5668\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u5206\u5e03\u5f0f_3\u5206\u5e03\u5f0f_RPC_\u5b9e\u6218.md", "create_date": "2020-02-18T21:31:51.563", "order": 17}}, {"model": "subject.chapter", "pk": 82, "fields": {"title": "\u670d\u52a1\u5668 3\uff1a\u3010\u591a\u8fdb\u7a0b\u540c\u6b65\u3011\u6a21\u578b", "topic": 4, "md5": "30d33ee11a76dc43ebc29d626ae77af0", "md_body": "# \u670d\u52a1\u5668 3\uff1a\u3010\u591a\u8fdb\u7a0b\u540c\u6b65\u3011\u6a21\u578b\n\n\u4e0a\u8282\u6211\u4eec\u5b8c\u6210\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u591a\u7ebf\u7a0b\u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u5e76\u53d1\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\u4f46\u662f Python \u91cc\u591a\u7ebf\u7a0b\u4f7f\u7528\u7684\u5e76\u4e0d\u5e38\u89c1\uff0c\u56e0\u4e3a Python \u7684 GIL \u81f4\u4f7f\u5355\u4e2a\u8fdb\u7a0b\u53ea\u80fd\u5360\u6ee1\u4e00\u4e2a CPU \u6838\u5fc3\uff0c\u591a\u7ebf\u7a0b\u5e76\u4e0d\u80fd\u5145\u5206\u5229\u7528\u591a\u6838\u7684\u4f18\u52bf\u3002\u6240\u4ee5\u591a\u6570 Python \u670d\u52a1\u5668\u63a8\u8350\u4f7f\u7528\u591a\u8fdb\u7a0b\u6a21\u578b\u3002\u6211\u4eec\u5c06\u4f7f\u7528 Python \u5185\u7f6e\u7684 os.fork() \u521b\u5efa\u5b50\u8fdb\u7a0b\u3002\n\n## os.fork()\n\nPython \u5185\u7f6e\u7684\u5b50\u8fdb\u7a0b\u521b\u5efa\u51fd\u6570\uff0c\u5b83\u5c01\u88c5\u4e86 glibc \u63d0\u4f9b\u7684 fork \u51fd\u6570\u3002\n\nfork \u8c03\u7528\u5c06\u751f\u6210\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u6240\u4ee5\u8fd9\u4e2a\u51fd\u6570\u4f1a\u5728\u7236\u5b50\u8fdb\u7a0b\u540c\u65f6\u8fd4\u56de\u3002\u5728\u7236\u8fdb\u7a0b\u7684\u8fd4\u56de\u7ed3\u679c\u662f\u4e00\u4e2a\u6574\u6570\u503c\uff0c\u8fd9\u4e2a\u503c\u662f\u5b50\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u53f7\uff0c\u7236\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528\u8be5\u8fdb\u7a0b\u53f7\u6765\u63a7\u5236\u5b50\u8fdb\u7a0b\u7684\u8fd0\u884c\u3002fork \u5728\u5b50\u8fdb\u7a0b\u7684\u8fd4\u56de\u7ed3\u679c\u662f\u96f6\u3002\u5982\u679c fork \u8fd4\u56de\u503c\u5c0f\u4e8e\u96f6\uff0c\u4e00\u822c\u610f\u5473\u7740\u64cd\u4f5c\u7cfb\u7edf\u8d44\u6e90\u4e0d\u8db3\uff0c\u65e0\u6cd5\u521b\u5efa\u8fdb\u7a0b\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 fork \u8c03\u7528\u7684\u8fd4\u56de\u503c\u6765\u533a\u5206\u5f53\u524d\u7684\u8fdb\u7a0b\u662f\u7236\u8fdb\u7a0b\u8fd8\u662f\u5b50\u8fdb\u7a0b\u3002\n\n```\npid = os.fork()\nif pid > 0:\n    # in parent process\nif pid == 0:\n    # in child process\nif pid < 0:\n    # fork error\n\n```\n\n\u5b50\u8fdb\u7a0b\u521b\u5efa\u540e\uff0c\u7236\u8fdb\u7a0b\u62e5\u6709\u7684\u5f88\u591a\u64cd\u4f5c\u7cfb\u7edf\u8d44\u6e90\uff0c\u5b50\u8fdb\u7a0b\u4e5f\u4f1a\u6301\u6709\u3002\u6bd4\u5982\u5957\u63a5\u5b57\u548c\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5b83\u4eec\u672c\u8d28\u4e0a\u90fd\u662f\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5bf9\u8c61\u7684\u4e00\u4e2a\u5f15\u7528\u3002\u5982\u679c\u5b50\u8fdb\u7a0b\u4e0d\u9700\u8981\u67d0\u4e9b\u5f15\u7528\uff0c\u4e00\u5b9a\u8981\u5373\u65f6\u5173\u95ed\u5b83\uff0c\u907f\u514d\u64cd\u4f5c\u7cfb\u7edf\u8d44\u6e90\u5f97\u4e0d\u5230\u91ca\u653e\u5bfc\u81f4\u8d44\u6e90\u6cc4\u9732\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/16/163686aa96c93a39?w=791&h=358&f=png&s=33397)\n\n## \u591a\u8fdb\u7a0b\u540c\u6b65\u6a21\u578b\n\n\u5b50\u8fdb\u7a0b\u521b\u5efa\u5bb9\u6613\uff0c\u9500\u6bc1\u96be\u3002\u5f53\u5b50\u8fdb\u7a0b\u9000\u51fa\u540e\uff0c\u7236\u8fdb\u7a0b\u9700\u8981\u4f7f\u7528 waitpid \u7cfb\u7edf\u8c03\u7528\u6536\u5272\u5b50\u8fdb\u7a0b\uff0c\u5426\u5219\u5b50\u8fdb\u7a0b\u5c06\u6210\u4e3a\u50f5\u5c38\u8fdb\u7a0b\uff0c\u50f5\u5c38\u8fdb\u7a0b\u4f1a\u6301\u7eed\u5360\u636e\u64cd\u4f5c\u7cfb\u7edf\u7684\u8d44\u6e90\u76f4\u5230\u7236\u8fdb\u7a0b\u9000\u51fa\u540e\u88ab init \u8fdb\u7a0b\u63a5\u7ba1\u6536\u5272\u540e\u624d\u4f1a\u6d88\u5931\u91ca\u653e\u8d44\u6e90\u3002\u6536\u5272\u5b50\u8fdb\u7a0b\u7684\u903b\u8f91\u5904\u7406\u6709\u4e00\u5b9a\u7684\u590d\u6742\u5ea6\uff0c\u6d89\u53ca\u5230\u975e\u5e38\u7cbe\u7ec6\u7684\u4fe1\u53f7\u63a7\u5236\u903b\u8f91\u3002\u4ece\u7406\u89e3\u6838\u5fc3\u91cd\u70b9\u89d2\u5ea6\u51fa\u53d1\uff0c\u8fd9\u90e8\u5206\u672c\u8282\u5c31\u4e0d\u505a\u8be6\u7ec6\u8bb2\u89e3\u3002\n\n```\n# coding: utf8\n# multiprocess.py\n\nimport os\nimport json\nimport struct\nimport socket\nimport multiprocessing\n\n\ndef handle_conn(conn, addr, handlers):\n    print addr, \"comes\"\n    while True:\n        length_prefix = conn.recv(4)\n        if not length_prefix:\n            print addr, \"bye\"\n            conn.close()\n            break\n        length, = struct.unpack(\"I\", length_prefix)\n        body = conn.recv(length)\n        request = json.loads(body)\n        in_ = request['in']\n        params = request['params']\n        print in_, params\n        handler = handlers[in_]\n        handler(conn, params)\n\n\ndef loop(sock, handlers):\n    while True:\n        conn, addr = sock.accept()\n        pid = os.fork()  # \u597d\u620f\u5728\u8fd9\u91cc\uff0c\u521b\u5efa\u5b50\u8fdb\u7a0b\u5904\u7406\u65b0\u8fde\u63a5\n        if pid < 0:  # fork error\n            return\n        if pid > 0:  # parent process\n            conn.close()  # \u5173\u95ed\u7236\u8fdb\u7a0b\u7684\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u5f15\u7528\n            continue\n        if pid == 0:\n            sock.close()  # \u5173\u95ed\u5b50\u8fdb\u7a0b\u7684\u670d\u52a1\u5668\u5957\u63a5\u5b57\u5f15\u7528\n            handle_conn(conn, addr, handlers)\n            break  # \u5904\u7406\u5b8c\u540e\u4e00\u5b9a\u8981\u9000\u51fa\u5faa\u73af\uff0c\u4e0d\u7136\u5b50\u8fdb\u7a0b\u4e5f\u4f1a\u7ee7\u7eed\u53bb accept \u8fde\u63a5\n\n\ndef ping(conn, params):\n    send_result(conn, \"pong\", params)\n\n\ndef send_result(conn, out, result):\n    response = json.dumps({\"out\": out, \"result\": result})\n    length_prefix = struct.pack(\"I\", len(response))\n    conn.sendall(length_prefix)\n    conn.sendall(response)\n\n\nif __name__ == '__main__':\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((\"localhost\", 8080))\n    sock.listen(1)\n    handlers = {\n        \"ping\": ping\n    }\n    loop(sock, handlers)\n\n```\n\n\u6ce8\u610f\uff0c\u6211\u4eec\u5728\u5b50\u8fdb\u7a0b\u91cc\u5173\u95ed\u4e86\u670d\u52a1\u5668\u7684\u5957\u63a5\u5b57\uff0c\u540c\u6837\u5728\u7236\u8fdb\u7a0b\u91cc\u5173\u95ed\u4e86\u5ba2\u6237\u7aef\u7684\u5957\u63a5\u5b57\u3002\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u505a\u5462\uff1f\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16482e1557af155e?w=1188&h=312&f=png&s=28186)\n\n\u56e0\u4e3a\u8fdb\u7a0b fork \u4e4b\u540e\uff0c\u5957\u63a5\u5b57\u4f1a\u590d\u5236\u4e00\u4efd\u5230\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u65f6\u7236\u5b50\u8fdb\u7a0b\u5c06\u4f1a\u5404\u6709\u81ea\u5df1\u7684\u5957\u63a5\u5b57\u5f15\u7528\u6307\u5411\u5185\u6838\u7684\u540c\u4e00\u4efd\u5957\u63a5\u5b57\u5bf9\u8c61\uff0c\u5957\u63a5\u5b57\u7684\u5f15\u7528\u8ba1\u6570\u4e3a2\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/10/16482e6f7ae7ce4e?w=1134&h=330&f=png&s=38036)\n\n\u5bf9\u5957\u63a5\u5b57\u8fdb\u7a0b close\uff0c\u5e76\u4e0d\u662f\u8bf4\u5c31\u662f\u5173\u95ed\u5957\u63a5\u5b57\uff0c\u5176\u672c\u8d28\u4e0a\u53ea\u662f\u5c06\u5185\u6838\u5957\u63a5\u5b57\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\u51cf\u4e00\u3002\u53ea\u6709\u5f53\u5f15\u7528\u8ba1\u6570\u51cf\u4e3a\u96f6\u65f6\uff0c\u624d\u4f1a\u5173\u95ed\u5957\u63a5\u5b57\u3002\n\n\u5982\u679c\u6ca1\u6709\u4e0a\u8ff0\u903b\u8f91\u5c31\u4f1a\u5bfc\u81f4\u670d\u52a1\u5668\u5957\u63a5\u5b57\u5f15\u7528\u8ba1\u6570\u4e0d\u65ad\u589e\u957f\uff0c\u540c\u65f6\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u5bf9\u8c61\u4e5f\u5f97\u4e0d\u5230\u5373\u65f6\u56de\u6536\uff0c\u8fd9\u4fbf\u662f\u4f20\u8bf4\u4e2d\u7684\u8d44\u6e90\u6cc4\u9732\u3002\n\n## \u591a\u8fdb\u7a0b vs \u591a\u7ebf\u7a0b\n\n\u5982\u679c\u5c06 IT \u670d\u52a1\u6bd4\u55bb\u6210\u5de5\u5382\u7684\u8bdd\uff0c\u591a\u7ebf\u7a0b\u5c31\u597d\u6bd4\u540c\u4e00\u4e2a\u5de5\u5382\u7684\u591a\u540d\u5de5\u4eba\u5e76\u884c\u5de5\u4f5c\u3002\u800c\u591a\u8fdb\u7a0b\u5219\u662f\u591a\u4e2a\u5de5\u5382\u540c\u65f6\u8fdb\u884c\u751f\u4ea7\u3002\u540c\u4e00\u4e2a\u5de5\u5382\u5185\u90e8\u7684\u5de5\u4eba\u4e4b\u95f4\u6709\u5f88\u591a\u7684\u5de5\u5177\u53ef\u4ee5\u5171\u4eab\uff0c\u4f46\u662f\u8de8\u8d8a\u4e86\u5de5\u5382\u7684\u5de5\u4eba\u4e4b\u95f4\u5c31\u5b8c\u5168\u9694\u79bb\u4e86\uff0c\u5b83\u4eec\u90fd\u4f7f\u7528\u7740\u5404\u81ea\u72ec\u7acb\u7684\u5168\u5957\u8d44\u6e90\u3002\n\n## \u5c0f\u7ed3\n\n\u4e5f\u8bb8\u5f88\u591a\u8bfb\u8005\u770b\u4e86\u8fd9\u4e00\u8282\u4f1a\u5f88\u4e0d\u9002\u5e94\uff0c\u5c3c\u739b\u591a\u8fdb\u7a0b\u7f16\u7a0b\u7b2c\u4e00\u6b21\u9047\u5230\u554a\uff0c\u4ece\u6765\u6ca1\u89c1\u8fc7\u554a\uff0c\u597d\u795e\u5947\u554a\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/16376bab038123fc?w=240&h=215&f=jpeg&s=8255)\n\n\u54c8\uff0c\u606d\u559c\u4f60\u4eec\uff0c\u4ee5\u540e\u90fd\u7b97\u89c1\u8fc7\u4e16\u9762\u7684\u7a0b\u5e8f\u5458\u4e86\u3002\n\n## \u7ec3\u4e60\n\n\u591a\u7ebf\u7a0b\u670d\u52a1\u5668\u89c1\u8fc7\u4e86\uff0c\u591a\u8fdb\u7a0b\u670d\u52a1\u5668\u4e5f\u89c1\u8fc7\u4e86\uff0c\u4f46\u662f\u8fd8\u6ca1\u89c1\u8fc7\u65e2\u662f\u591a\u8fdb\u7a0b\u53c8\u662f\u591a\u7ebf\u7a0b\u7684\u670d\u52a1\u5668\u3002\n\n\u8bf7\u8bfb\u8005\u7a0d\u52a0\u6539\u9020\uff0c\u5c06 RPC \u670d\u52a1\u6539\u6210\u9ad8\u5927\u4e0a\u7684\u300c\u591a\u8fdb\u7a0b\u5d4c\u5957\u591a\u7ebf\u7a0b\u300d\u670d\u52a1\u3002\u662f\u4e0d\u662f\u66f4 6 \u4e86\uff1f", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u670d\u52a1\u5668_3\u591a\u8fdb\u7a0b\u540c\u6b65\u6a21\u578b.md", "create_date": "2020-02-18T21:31:51.573", "order": 19}}, {"model": "subject.chapter", "pk": 83, "fields": {"title": "\u670d\u52a1\u5668 4\uff1a\u3010PreForking\u540c\u6b65\u3011\u6a21\u578b", "topic": 4, "md5": "62501fe3f11ee465918849fd74d83256", "md_body": "# \u670d\u52a1\u5668 4\uff1a\u3010PreForking\u540c\u6b65\u3011\u6a21\u578b\n\n\u8fdb\u7a0b\u8981\u6bd4\u7ebf\u7a0b\u66f4\u52a0\u5403\u8d44\u6e90\uff0c\u5982\u679c\u6765\u4e00\u4e2a\u8fde\u63a5\u5c31\u5f00\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5f53\u8fde\u63a5\u6bd4\u8f83\u591a\u65f6\uff0c\u8fdb\u7a0b\u6570\u91cf\u4e5f\u4f1a\u8ddf\u7740\u591a\u8d77\u6765\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\u538b\u529b\u4e5f\u5c31\u4f1a\u6bd4\u8f83\u5927\u3002\u6240\u4ee5\u6211\u4eec\u8981\u5bf9\u670d\u52a1\u5668\u5f00\u8f9f\u7684\u8fdb\u7a0b\u6570\u91cf\u8fdb\u884c\u9650\u5236\uff0c\u907f\u514d\u7cfb\u7edf\u8d1f\u8f7d\u8fc7\u91cd\u3002\u8fd9\u5c31\u9700\u8981\u638c\u63e1\u591a\u8fdb\u7a0b PreForking \u6a21\u578b\u3002\n\n## \u591a\u8fdb\u7a0b PreForking \u6a21\u578b\n\n\u91c7\u7528 PreForking \u6a21\u578b\u53ef\u4ee5\u5bf9\u5b50\u8fdb\u7a0b\u7684\u6570\u91cf\u8fdb\u884c\u4e86\u9650\u5236\u3002PreForking \u662f\u901a\u8fc7\u9884\u5148\u4ea7\u751f\u591a\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5171\u540c\u5bf9\u670d\u52a1\u5668\u5957\u63a5\u5b57\u8fdb\u884c\u7ade\u4e89\u6027\u7684 accept\uff0c\u5f53\u4e00\u4e2a\u8fde\u63a5\u5230\u6765\u65f6\uff0c\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u90fd\u6709\u673a\u4f1a\u62ff\u5230\u8fd9\u4e2a\u8fde\u63a5\uff0c\u4f46\u662f\u6700\u7ec8\u53ea\u4f1a\u6709\u4e00\u4e2a\u8fdb\u7a0b\u80fd accept \u6210\u529f\u8fd4\u56de\u62ff\u5230\u8fde\u63a5\u3002\u5b50\u8fdb\u7a0b\u62ff\u5230\u8fde\u63a5\u540e\uff0c\u8fdb\u7a0b\u5185\u90e8\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u5355\u7ebf\u7a0b\u6216\u8005\u591a\u7ebf\u7a0b\u540c\u6b65\u7684\u5f62\u5f0f\u5bf9\u8fde\u63a5\u8fdb\u884c\u5904\u7406\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/16/163686ba498563be?w=722&h=383&f=png&s=31336)\n\n\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u7684\u5b50\u8fdb\u7a0b\u5185\u90e8\u4f7f\u7528\u5355\u7ebf\u7a0b\u5bf9\u8fde\u63a5\u8fdb\u884c\u5904\u7406\u3002\n\n```\n# coding: utf8\n# prefork.py\n\nimport os\nimport json\nimport struct\nimport socket\n\n\ndef handle_conn(conn, addr, handlers):\n    print addr, \"comes\"\n    while True:\n        length_prefix = conn.recv(4)\n        if not length_prefix:\n            print addr, \"bye\"\n            conn.close()\n            break  # \u5173\u95ed\u8fde\u63a5\uff0c\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2a\u8fde\u63a5\n        length, = struct.unpack(\"I\", length_prefix)\n        body = conn.recv(length)\n        request = json.loads(body)\n        in_ = request['in']\n        params = request['params']\n        print in_, params\n        handler = handlers[in_]\n        handler(conn, params)\n\n\ndef loop(sock, handlers):\n    while True:\n        conn, addr = sock.accept()\n        handle_conn(conn, addr, handlers)\n\n\ndef ping(conn, params):\n    send_result(conn, \"pong\", params)\n\n\ndef send_result(conn, out, result):\n    response = json.dumps({\"out\": out, \"result\": result})\n    length_prefix = struct.pack(\"I\", len(response))\n    conn.sendall(length_prefix)\n    conn.sendall(response)\n\n\ndef prefork(n):\n    for i in range(n):\n        pid = os.fork()\n        if pid < 0:  # fork error\n            return\n        if pid > 0:  # parent process\n            continue\n        if pid == 0:\n            break  # child process\n\n\nif __name__ == '__main__':\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n    sock.bind((\"localhost\", 8080))\n    sock.listen(1)\n    prefork(10)  # \u597d\u620f\u5728\u8fd9\u91cc\uff0c\u5f00\u542f\u4e86 10 \u4e2a\u5b50\u8fdb\u7a0b\n    handlers = {\n        \"ping\": ping\n    }\n    loop(sock, handlers)\n\n```\n\n\u5982\u679c\u5e76\u884c\u7684\u8fde\u63a5\u6570\u8d85\u8fc7\u4e86 prefork \u8fdb\u7a0b\u7684\u6570\u91cf\uff0c\u90a3\u4e48\u540e\u6765\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u5c06\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u6b63\u5728\u5904\u7406\u8fde\u63a5\u7684\u5b50\u8fdb\u7a0b\u662f\u6ca1\u6709\u673a\u4f1a\u53bb\u8c03\u7528 accept \u6765\u83b7\u53d6\u65b0\u8fde\u63a5\u7684\u3002\u4e3a\u4e86\u4e0d\u963b\u585e\u65b0\u7684\u5ba2\u6237\u7aef\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5b50\u8fdb\u7a0b\u7684\u5355\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b\u6539\u6210\u591a\u7ebf\u7a0b\u540c\u6b65\u6a21\u578b\u5373\u53ef\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/16/163686cd2e845425?w=935&h=442&f=png&s=53008)\n\n## accept \u7ade\u4e89\n\nprefork \u4e4b\u540e\uff0c\u7236\u8fdb\u7a0b\u521b\u5efa\u7684\u670d\u52a1\u5957\u63a5\u5b57\u5f15\u7528\uff0c\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u4e5f\u4f1a\u7ee7\u627f\u4e00\u4efd\uff0c\u5b83\u4eec\u5171\u540c\u6307\u5411\u4e86\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u5957\u63a5\u5b57\u5bf9\u8c61\uff0c\u5171\u4eab\u4e86\u540c\u4e00\u4efd\u8fde\u63a5\u76d1\u542c\u961f\u5217\u3002\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\u4e00\u6837\u90fd\u53ef\u4ee5\u5bf9\u670d\u52a1\u5957\u63a5\u5b57\u8fdb\u884c accept \u8c03\u7528\uff0c\u4ece\u5171\u4eab\u7684\u76d1\u542c\u961f\u5217\u4e2d\u6458\u53d6\u4e00\u4e2a\u65b0\u8fde\u63a5\u8fdb\u884c\u5904\u7406\u3002\n\n## \u5c0f\u7ed3\n\n\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u4f60\u4eec\u5df2\u7ecf\u638c\u63e1\u4e86\u5f88\u591a\u81ea\u5df1\u4ece\u6765\u672a\u66fe\u542c\u8fc7\u7684\u6280\u672f\uff0c\u4f46\u662f\u6211\u8981\u8bf4\u660e\u7684\u662f\u8fd9\u4e9b\u77e5\u8bc6\u8fd8\u53ea\u80fd\u79f0\u5f97\u4e0a\u662f\u53e4\u5178\u7684 RPC \u5e76\u53d1\u6280\u672f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/16376b94eac96ce5?w=300&h=263&f=jpeg&s=9330)\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u8981\u5f00\u59cb\u4f7f\u7528\u73b0\u4ee3\u5316\u6280\u672f\u6765\u6b66\u88c5\u81ea\u5df1\u2014\u2014\u5f02\u6b65\u9ad8\u5e76\u53d1\u3002\n\n## \u7ec3\u4e60\n\nPreForking \u662f\u8fdb\u7a0b\u6c60\u6a21\u578b\uff0c\u76f8\u5bf9\u5e94\u7684\u7ebf\u7a0b\u6c60\u6a21\u578b\uff0c\u6211\u4eec\u76ee\u524d\u5e76\u6ca1\u6709\u63d0\u53ca\u3002\u8bfb\u8005\u662f\u4e0d\u662f\u53ef\u4ee5\u81ea\u5df1\u5c1d\u8bd5\u5b8c\u6210\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u6a21\u578b\u7684 RPC \u670d\u52a1\u5668\u5462\uff1f", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u670d\u52a1\u5668_4PreForking\u540c\u6b65\u6a21\u578b.md", "create_date": "2020-02-18T21:31:51.593", "order": 11}}, {"model": "subject.chapter", "pk": 84, "fields": {"title": "\u670d\u52a1\u5668 5\uff1a\u3010\u5355\u8fdb\u7a0b\u5f02\u6b65\u3011\u6a21\u578b", "topic": 4, "md5": "abd16cdef9195a5c9d1ea8a73a4ec7eb", "md_body": "# \u670d\u52a1\u5668 5\uff1a\u3010\u5355\u8fdb\u7a0b\u5f02\u6b65\u3011\u6a21\u578b\n\n\u672c\u5c0f\u8282\u6211\u4eec\u5f00\u59cb\u8bb2 RPC \u7684\u5f02\u6b65\u6a21\u578b\u3002\u5f02\u6b65\u6a21\u578b\u662f\u73b0\u4ee3\u670d\u52a1\u5668\u7684\u901a\u7528\u6a21\u578b\uff0c\u5b83\u6bd4\u53e4\u5178\u7684\u540c\u6b65\u6a21\u578b\u5728\u6548\u7387\u4e0a\u8981\u9ad8\u51fa\u4e00\u5927\u622a\uff0c\u4f46\u662f\u7f16\u7a0b\u96be\u5ea6\u4e0a\u4e5f\u8981\u52a0\u5927\u4e0d\u5c11\uff0c\u9700\u8981\u7a0b\u5e8f\u5458\u6709\u8f83\u9ad8\u7684\u7f16\u7a0b\u7d20\u517b\u3002\u5173\u4e8e\u5982\u4f55\u5e94\u7528\u5f02\u6b65\u6a21\u578b\uff0c\u6211\u4eec\u9700\u8981\u8981\u5148\u4ece\u975e\u963b\u585e IO \u5f00\u59cb\u8bb2\u8d77\uff0c\u9010\u6b65\u7406\u89e3\u57fa\u672c\u539f\u7406\u548c\u5fc5\u5907\u7684\u5de5\u5177\u548c\u5e93\u4e4b\u540e\uff0c\u518d\u7528\u4ee3\u7801\u5b9e\u73b0\u3002\n\n## \u975e\u963b\u585e IO\n\n\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c\u9ed8\u8ba4\u90fd\u662f\u540c\u6b65\u7684\uff0c\u5b83\u5fc5\u987b\u7b49\u5230\u6570\u636e\u5c31\u7eea\u540e\u624d\u80fd\u8fd4\u56de\uff0c\u5982\u679c\u6570\u636e\u6ca1\u6709\u5c31\u7eea\uff0c\u5b83\u5c31\u4f1a\u963b\u585e\u5f53\u524d\u7684\u7ebf\u7a0b\uff0c\u5176\u5b83\u7684\u4e8b\u4ec0\u4e48\u90fd\u5e72\u4e0d\u4e86\uff0c\u8fd9\u662f\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u8d44\u6e90\u7684\u4e00\u79cd\u6d6a\u8d39\u3002\n\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7ed9\u6587\u4ef6\u8bfb\u5199\u63d0\u4f9b\u4e86\u975e\u963b\u585e\u9009\u9879\u3002\u5f53\u6211\u4eec\u8bfb\u5199\u6587\u4ef6\u65f6\uff0c\u63d0\u4f9b\u4e00\u4e2a O\\_NONBLOCK \u9009\u9879\uff0c\u8bfb\u5199\u64cd\u4f5c\u5c31\u4e0d\u4f1a\u963b\u585e\u3002\n\n\u5185\u6838\u5957\u63a5\u5b57\u7684 ReadBuffer \u6709\u591a\u5c11\u5b57\u8282\uff0cread \u64cd\u4f5c\u5c31\u8fd4\u56de\u591a\u5c11\u5b57\u8282\u3002\u5185\u6838\u5957\u63a5\u5b57\u7684 WriteBuffer \u6709\u591a\u5c11\u5269\u4f59\u5b57\u8282\u7a7a\u95f4\uff0cwrite \u64cd\u4f5c\u5c31\u5199\u591a\u5c11\u5b57\u8282\u3002\u6211\u4eec\u901a\u8fc7\u8bfb\u5199\u7684\u8fd4\u56de\u503c\u5c31\u53ef\u4ee5\u77e5\u9053\u8bfb\u5199\u4e86\u591a\u5c11\u6570\u636e\u3002\u63a5\u4e0b\u6765\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5e72\u522b\u7684\u4e8b\u53bb\u4e86\uff0c\u7a0d\u540e\u518d\u7ee7\u7eed\u8fdb\u884c\u8bfb\u5199\u3002\n\n```\nsocket = socket.socket()\nsocket.setblocking(0)  # \u5f00\u542f\u975e\u963b\u585e\u6a21\u5f0f\nsocket.read()  # \u6709\u591a\u5c11\u8bfb\u591a\u5c11\nsocket.write()  # \u80fd\u5199\u591a\u5c11\u662f\u591a\u5c11\n\n```\n\n## \u4e8b\u4ef6\u8f6e\u8be2\n\n\u975e\u963b\u585e IO \u770b\u8d77\u6765\u5f88\u6709\u7528\uff0c\u4f46\u662f\u6709\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u8be5\u5982\u4f55\u77e5\u9053\u67d0\u4e2a\u5957\u63a5\u5b57\u53ef\u8bfb\u53ef\u5199\u5462\uff1f\u5982\u679c\u6211\u4eec\u53cd\u590d\u53bb\u4f7f\u7528 read \u548c write \u53bb\u8f6e\u8be2 IO\uff0c\u8fd9\u4f3c\u4e4e\u633a\u8d39\u52b2\u7684\uff0c\u5047\u8bbe\u4e00\u4e2a\u5957\u63a5\u5b57\u957f\u671f\u95f2\u7f6e\u6ca1\u6709\u6d88\u606f\u5230\u6765\uff0c\u7ed3\u679c\u8fd8\u8981\u8c03\u7528\u6210\u5343\u4e0a\u4e07\u6b21\u7684 read\uff0c\u8fd9\u662f\u660e\u663e\u7684\u5728\u6d6a\u8d39 CPU \u561b\u3002\n\n**\u5982\u4f55\u5e94\u5bf9\u8fd9\u79cd\u56f0\u5883\u5462\uff1f**\n\n\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e8b\u4ef6\u8f6e\u8be2\u7684 API\u3002\u6211\u4eec\u4f7f\u7528\u8fd9\u4e2a API \u6765\u67e5\u8be2\u76f8\u5173\u5957\u63a5\u5b57\u662f\u5426\u6709\u76f8\u5e94\u7684\u8bfb\u5199\u4e8b\u4ef6\uff0c\u5982\u679c\u6709\u7684\u8bdd\u8be5 API \u4f1a\u7acb\u5373\u643a\u5e26\u4e8b\u4ef6\u5217\u8868\u8fd4\u56de\uff0c\u5982\u679c\u6ca1\u6709\u4e8b\u4ef6\uff0c\u8be5 API \u4f1a\u963b\u585e\uff0c\u963b\u585e\u591a\u957f\u65f6\u95f4\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u8bbe\u7f6e\u3002\u963b\u585e\u770b\u8d77\u6765\u4f3c\u4e4e\u4e0d\u592a\u597d\uff0c\u4f46\u662f\u5982\u679c\u670d\u52a1\u5668\u6ca1\u4ec0\u4e48\u4e8b\u53ef\u4ee5\u5e72\uff0c\u90a3\u7761\u5927\u89c9\u5c31\u662f\u8282\u7701\u8d44\u6e90\u7684\u6700\u4f73\u65b9\u5f0f\u3002\n\n\u8c03\u7528\u4e8b\u4ef6\u8f6e\u8be2 API \u62ff\u5230\u8bfb\u5199\u4e8b\u4ef6\u540e\uff0c\u5c31\u53ef\u4ee5\u63a5\u7740\u5bf9\u4e8b\u4ef6\u76f8\u5173\u7684\u5957\u63a5\u5b57\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u8bfb\u5199\u64cd\u4f5c\u90fd\u662f\u6b63\u5e38\u8fdb\u884c\u7684\uff0c\u800c\u4e0d\u4f1a\u6d6a\u8d39 CPU \u7a7a\u8bfb\u7a7a\u5199\u3002\n\n```\nread_events, write_events = select.select(read_fds, write_fds, timeout)\nfor event in read_events:\n    handle_read(event)\nfor event in write_events:\n    handle_write(event)\n\n```\n\n\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u5f80\u5f80\u90fd\u63d0\u4f9b\u4e86\u591a\u79cd\u4e8b\u4ef6\u8f6e\u8be2 API\uff0c\u4ece\u53e4\u5178\u7684 select \u548c poll \u7cfb\u7edf\u8c03\u7528\u8fdb\u5316\u5230\u5982\u4eca\u7684 epoll \u548c kqueue \u7cfb\u7edf\u8c03\u7528\u3002\u53e4\u5178\u7684\u4f7f\u7528\u7b80\u5355\uff0c\u6027\u80fd\u5dee\uff0c\u73b0\u4ee3\u7684\u4f7f\u7528\u590d\u6742\uff0c\u6027\u80fd\u8d85\u597d\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/11/1634e0e657a73708?w=854&h=582&f=png&s=54272)\n\n\u6211\u4eec\u770b\u5230\u8f6e\u8be2 API \u7684\u53c2\u6570\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u5217\u8868\u3002\u7f51\u7edc\u5957\u63a5\u5b57\u7684 socket \u5bf9\u8c61\u5982\u4f55\u8ddf\u8f6e\u8be2 API \u4ea7\u751f\u5173\u8054\u7684\u5462\uff1f\u8fd9\u4e2a\u8981\u5f52\u529f\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u62bd\u8c61\u80fd\u529b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c06\u6240\u6709\u7684 IO \u64cd\u4f5c\u90fd\u62bd\u8c61\u6210\u4e86\u6587\u4ef6\u64cd\u4f5c\uff0c\u7f51\u7edc\u5957\u63a5\u5b57\u7684 socket \u5bf9\u8c61\u63d0\u4f9b\u4e86 makefile \u51fd\u6570\uff0c\u53ef\u4ee5\u83b7\u53d6\u5bf9\u5e94\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5bf9\u8c61\u3002\n\n\u4e00\u4e2a\u5b8c\u6574\u7684\u4e8b\u4ef6\u5faa\u73af\u9664\u4e86\u8981\u5904\u7406 IO \u76f8\u5173\u7684\u4e8b\u4ef6\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5185\u90e8\u7684\u4e8b\u4ef6\u9700\u8981\u5904\u7406\uff0c\u6bd4\u5982\u5b9a\u65f6\u4efb\u52a1\u3002\n\nNginx/Redis/Java NIO \u548c\u5404\u79cd Web \u670d\u52a1\u5668\u90fd\u4f7f\u7528\u4e86\u4e8b\u4ef6\u8f6e\u8be2 API\uff0c\u5b83\u662f\u9ad8\u6027\u80fd\u9ad8\u5e76\u53d1\u7684\u5173\u952e\u6280\u672f\u4e4b\u4e00\u3002\n\n## \u7528\u6237\u8fdb\u7a0b\u8bfb\u5199\u7f13\u51b2\u533a\n\n\u56e0\u4e3a\u8bfb\u662f\u975e\u963b\u585e\u7684\uff0c\u610f\u5473\u7740\u5f53\u6211\u4eec\u60f3\u8981\u8bfb\u53d6 100 \u4e2a\u5b57\u8282\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u7ecf\u5386\u4e86\u591a\u6b21 read \u8c03\u7528\uff0c\u7b2c\u4e00\u6b21\u8bfb\u4e86 10 \u4e2a\u5b57\u8282\uff0c\u7b2c\u4e8c\u6b21\u8bfb\u4e86 30 \u4e2a\u5b57\u8282\uff0c\u7136\u540e\u53c8\u8bfb\u4e86 80 \u4e2a\u5b57\u8282\u3002\u51d1\u591f\u4e86 100 \u4e2a\u5b57\u8282\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u89e3\u7801\u51fa\u4e00\u4e2a\u5b8c\u6574\u7684\u8bf7\u6c42\u5bf9\u8c61\u8fdb\u884c\u5904\u7406\u4e86\uff0c\u8fd8\u5269\u4f59\u7684 20 \u4e2a\u5b57\u8282\u53c8\u662f\u540e\u9762\u8bf7\u6c42\u6d88\u606f\u7684\u4e00\u90e8\u5206\u3002\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u534a\u5305\u95ee\u9898\u3002\n\n\u975e\u963b\u585e IO \u8981\u6c42\u7528\u6237\u7a0b\u5e8f\u4e3a\u6bcf\u4e2a\u5957\u63a5\u5b57\u7ef4\u6301\u4e00\u4e2a ReadBuffer\uff0c\u5b83\u548c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u533a\u7684 ReadBuffer \u4e0d\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\u3002\u7528\u6237\u6001\u7684 ReadBuffer \u662f\u7531\u7528\u6237\u4ee3\u7801\u6765\u8fdb\u884c\u63a7\u5236\u3002\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u4fdd\u7559\u5f53\u524d\u7684\u534a\u5305\u6d88\u606f\uff0c\u5982\u679c\u6d88\u606f\u7684\u5185\u5bb9\u5b8c\u6574\u4e86\uff0c\u5c31\u53ef\u4ee5\u4ece ReadBuffer \u4e2d\u53d6\u51fa\u6765\u8fdb\u884c\u5904\u7406\u3002\n\n\u56e0\u4e3a\u5199\u662f\u975e\u963b\u585e\u7684\uff0c\u610f\u5473\u7740\u5f53\u6211\u4eec\u60f3\u8981\u5199 100 \u4e2a\u5b57\u8282\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u7ecf\u5386\u4e86\u591a\u6b21 write \u8c03\u7528\uff0c\u7b2c\u4e00\u6b21 write \u4e86 10 \u4e2a\u5b57\u8282\uff0c\u7b2c\u4e8c\u6b21 write \u4e86 30 \u4e2a\u5b57\u8282\uff0c\u6700\u540e\u624d\u628a\u5269\u4f59\u7684 40 \u4e2a\u5b57\u8282\u5199\u51fa\u53bb\u4e86\u3002\u8fd9\u5c31\u8981\u6c42\u7528\u6237\u7a0b\u5e8f\u4e3a\u6bcf\u4e2a\u5957\u63a5\u5b57\u7ef4\u62a4\u4e00\u4e2a\u5199\u7f13\u51b2\u533a\uff0c\u628a\u5269\u4e0b\u7684\u6ca1\u5199\u5b8c\u7684\u5b57\u8282\u90fd\u653e\u5728\u91cc\u9762\uff0c\u4ee5\u4fbf\u540e\u7eed\u53ef\u5199\u4e8b\u4ef6\u5230\u6765\u65f6\uff0c\u80fd\u7ee7\u7eed\u628a\u6ca1\u5199\u5b8c\u7684\u5199\u4e0b\u53bb\u3002\n\n## StringIO\n\nPython \u5185\u7f6e\u7684\u7c7b\u5e93\uff0c\u7c7b\u4f3c\u4e8e Java \u7684 ByteArrayInputStream \u548c ByteArrayOutputStream \u7684\u5408\u4f53\uff0c\u5c06\u5b57\u7b26\u4e32\u5f53\u6210\u4e00\u4e2a\u6587\u4ef6\u4e00\u6837\u4f7f\u7528\uff0c\u5177\u5907\u548c\u6587\u4ef6\u4e00\u6837\u7684 read \u548c write \u64cd\u4f5c\u3002Python \u63d0\u4f9b\u4e86\u4e24\u4e2a\u5b9e\u73b0\uff0c\u4e00\u4e2a\u662f\u7eaf Python \u5b9e\u73b0 StringIO\uff0c\u4e00\u4e2a\u662f\u5e95\u5c42 C \u7684\u5b9e\u73b0 cStringIO\u3002\u6beb\u65e0\u7591\u95ee\uff0cC \u7684\u5b9e\u73b0\u8981\u5feb\u5f88\u591a\u3002\u7528\u6237\u8fdb\u7a0b\u8bfb\u5199\u7f13\u51b2\u533a\u4f7f\u7528 StringIO \u5b9e\u73b0\u3002\n\n```\nfrom StringIO import StringIO  # \u7eaf python \u7684\u5b9e\u73b0\nfrom cStringIO import StringIO  # C \u5b9e\u73b0\n\ns = StringIO()\ns.write(\"hello, ireader\")\ns.seek(0)\ns.read(1024)\n\n```\n\n## asyncore\n\nPython \u5185\u7f6e\u7684\u5f02\u6b65 IO \u5e93\u3002\u8003\u8651\u5230\u7f16\u5199\u539f\u751f\u7684\u4e8b\u4ef6\u8f6e\u8be2\u548c\u5f02\u6b65\u8bfb\u5199\u7684\u903b\u8f91\u6bd4\u8f83\u590d\u6742\uff0c\u8981\u8003\u8651\u7684\u7ec6\u8282\u975e\u5e38\u591a\u3002\u6240\u4ee5 Python \u5bf9\u8fd9\u4e00\u5757\u7684\u903b\u8f91\u4ee3\u7801\u505a\u4e86\u4e00\u5c42\u5c01\u88c5\uff0c\u7b80\u5316\u4e86\u5f02\u6b65\u903b\u8f91\u7684\u5904\u7406\uff0c\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u65b9\u4fbf\u3002asyncore\u8d1f\u8d23socket\u4e8b\u4ef6\u8f6e\u8be2\uff0c\u7528\u6237\u7f16\u5199\u4ee3\u7801\u65f6\u53ea\u9700\u8981\u63d0\u4f9b\u56de\u8c03\u65b9\u6cd5\u5373\u53ef\uff0casyncore\u4f1a\u5728\u76f8\u5e94\u7684\u4e8b\u4ef6\u5230\u6765\u65f6\uff0c\u8c03\u7528\u7528\u6237\u63d0\u4f9b\u7684\u56de\u8c03\u65b9\u6cd5\u3002\u6bd4\u5982\u5f53serversocket\u7684read\u4e8b\u4ef6\u5230\u6765\u65f6\uff0c\u4f1a\u81ea\u52a8\u8c03\u7528handle\\_accept\u65b9\u6cd5\uff0c \u5f53socket\u7684read\u4e8b\u4ef6\u5230\u6765\u65f6\uff0c\u8c03\u7528handle\\_read\u65b9\u6cd5\u3002\n\n## \u5b9e\u73b0\u5355\u8fdb\u7a0b\u5f02\u6b65\u6a21\u578b\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528 Python \u5185\u7f6e\u7684 asyncore \u6a21\u5757\uff0c\u5b9e\u73b0\u4e00\u4e2a\u5f02\u6b65\u6a21\u578b\u7684 RPC \u670d\u52a1\u5668\u3002\n\n```\n# coding: utf8\n\nimport json\nimport struct\nimport socket\nimport asyncore\nfrom cStringIO import StringIO\n\n\nclass RPCHandler(asyncore.dispatcher_with_send):  # \u5ba2\u6237\u5957\u63a5\u5b57\u5904\u7406\u5668\u5fc5\u987b\u7ee7\u627f dispatcher_with_send\n\n    def __init__(self, sock, addr):\n        asyncore.dispatcher_with_send.__init__(self, sock=sock)\n        self.addr = addr\n        self.handlers = {\n            \"ping\": self.ping\n        }\n        self.rbuf = StringIO()  # \u8bfb\u7f13\u51b2\u533a\u7531\u7528\u6237\u4ee3\u7801\u7ef4\u62a4\uff0c\u5199\u7f13\u51b2\u533a\u7531 asyncore \u5185\u90e8\u63d0\u4f9b\n\n    def handle_connect(self):  # \u65b0\u7684\u8fde\u63a5\u88ab accept \u540e\u56de\u8c03\u65b9\u6cd5\n        print self.addr, 'comes'\n\n    def handle_close(self):  # \u8fde\u63a5\u5173\u95ed\u4e4b\u524d\u56de\u8c03\u65b9\u6cd5\n        print self.addr, 'bye'\n        self.close()\n\n    def handle_read(self):  # \u6709\u8bfb\u4e8b\u4ef6\u5230\u6765\u65f6\u56de\u8c03\u65b9\u6cd5\n        while True:\n            content = self.recv(1024)\n            if content:\n                self.rbuf.write(content)\n            if len(content) < 1024:\n                break\n        self.handle_rpc()\n\n    def handle_rpc(self):  # \u5c06\u8bfb\u5230\u7684\u6d88\u606f\u89e3\u5305\u5e76\u5904\u7406\n        while True:  # \u53ef\u80fd\u4e00\u6b21\u6027\u6536\u5230\u4e86\u591a\u4e2a\u8bf7\u6c42\u6d88\u606f\uff0c\u6240\u4ee5\u9700\u8981\u5faa\u73af\u5904\u7406\n            self.rbuf.seek(0)\n            length_prefix = self.rbuf.read(4)\n            if len(length_prefix) < 4:  # \u4e0d\u8db3\u4e00\u4e2a\u6d88\u606f\n                break\n            length, = struct.unpack(\"I\", length_prefix)\n            body = self.rbuf.read(length)\n            if len(body) < length:  # \u4e0d\u8db3\u4e00\u4e2a\u6d88\u606f\n                break\n            request = json.loads(body)\n            in_ = request['in']\n            params = request['params']\n            print in_, params\n            handler = self.handlers[in_]\n            handler(params)  # \u5904\u7406\u6d88\u606f\n            left = self.rbuf.getvalue()[length + 4:]  # \u6d88\u606f\u5904\u7406\u5b8c\u4e86\uff0c\u7f13\u51b2\u533a\u8981\u622a\u65ad\n            self.rbuf = StringIO()\n            self.rbuf.write(left)\n        self.rbuf.seek(0, 2)  # \u5c06\u6e38\u6807\u632a\u5230\u6587\u4ef6\u7ed3\u5c3e\uff0c\u4ee5\u4fbf\u540e\u7eed\u8bfb\u5230\u7684\u5185\u5bb9\u76f4\u63a5\u8ffd\u52a0\n\n    def ping(self, params):\n        self.send_result(\"pong\", params)\n\n    def send_result(self, out, result):\n        response = {\"out\": out, \"result\": result}\n        body = json.dumps(response)\n        length_prefix = struct.pack(\"I\", len(body))\n        self.send(length_prefix)  # \u5199\u5165\u7f13\u51b2\u533a\n        self.send(body) # \u5199\u5165\u7f13\u51b2\u533a\n\n\nclass RPCServer(asyncore.dispatcher):  # \u670d\u52a1\u5668\u5957\u63a5\u5b57\u5904\u7406\u5668\u5fc5\u987b\u7ee7\u627f dispatcher\n\n    def __init__(self, host, port):\n        asyncore.dispatcher.__init__(self)\n        self.create_socket(socket.AF_INET, socket.SOCK_STREAM)\n        self.set_reuse_addr()\n        self.bind((host, port))\n        self.listen(1)\n\n    def handle_accept(self):\n        pair = self.accept()\n        if pair is not None:\n            sock, addr = pair\n            RPCHandler(sock, addr)\n\n\nif __name__ == '__main__':\n    RPCServer(\"localhost\", 8080)\n    asyncore.loop()\n\n```\n\n\u6700\u540e\u4e00\u884c\u4ee3\u7801\\`\\`asyncore.loop()\\`\\`\\` \u542f\u52a8\u4e8b\u4ef6\u5faa\u73af\uff0c\u6240\u8c13\u4e8b\u4ef6\u5faa\u73af\u5c31\u662f\u8f6e\u8be2\u4e8b\u4ef6\u5e76\u5904\u7406\uff0c\u5904\u7406\u5b8c\u4e86\u518d\u7ee7\u7eed\u8f6e\u8be2\uff0c\u6ca1\u5b8c\u6ca1\u4e86\uff0c\u5929\u8352\u5730\u8001\u3002\n\nreuse\\_addr \u9009\u9879\u5982\u6b64\u5e38\u89c1\uff0c\u6240\u4ee5 asyncore \u5355\u72ec\u4e3a\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u6cd5\u4fbf\u4e8e\u7528\u6237\u4f7f\u7528\u3002\n\n\u6211\u4eec\u4f7f\u7528\u4e86 StringIO \u4f5c\u4e3a\u8bfb\u7f13\u51b2\uff0c\u7528\u4e8e\u7f13\u5b58\u534a\u5305\u6d88\u606f\u548c\u521a\u521a\u4ece\u5957\u63a5\u5b57\u90a3\u91cc\u8bfb\u53d6\u5230\u7684\u5b57\u8282\u6570\u636e\u3002\u6d88\u606f\u5904\u7406\u5b8c\u6bd5\u4e4b\u540e\u8981\u5bf9\u8bfb\u7f13\u51b2\u8fdb\u884c\u622a\u65ad\u5904\u7406\uff0c\u5c06\u5df2\u7ecf\u5904\u7406\u7684\u5b57\u8282\u6570\u636e\u780d\u6389\u3002StringIO \u7684\u8bfb\u5199\u6e38\u6807\u8981\u5c0f\u5fc3\u4f7f\u7528\uff0c\u8bfb\u7684\u65f6\u5019\u6e38\u6807\u4ece\u5934\u5f00\u59cb\uff0c\u5199\u7684\u65f6\u5019\u6e38\u6807\u4ece\u5c3e\u90e8\u5f00\u59cb\u8ffd\u52a0\uff0cseek \u51fd\u6570\u7528\u6765\u79fb\u52a8\u6e38\u6807\u3002\n\n\u670d\u52a1\u5668\u5957\u63a5\u5b57\u4e0d\u540c\u4e8e\u5ba2\u6237\u5957\u63a5\u5b57\uff0c\u670d\u52a1\u5957\u63a5\u5b57\u7684\u53ef\u8bfb\u4e8b\u4ef6\u662f\u6307\u6709\u65b0\u8fde\u63a5\u6765\u4e86\uff0c\u5b83\u6ca1\u6709\u76f8\u5e94\u7684\u53ef\u5199\u4e8b\u4ef6\u3002\u670d\u52a1\u5668\u5957\u63a5\u5b57\u7684\u8bfb\u64cd\u4f5c\u5c31\u662f\u8c03\u7528 accept \u83b7\u53d6\u65b0\u8fde\u63a5\u3002\n\n# \u5c0f\u7ed3\n\n\u8fd9\u4e00\u8282\u4f60\u4eec\u89c1\u8bc6\u5230\u7684\u5f02\u6b65\u6a21\u578b\u5c31\u662f\u73b0\u4ee3\u7684\u6a21\u578b\uff0c\u4f60\u4eec\u6240\u542c\u8bf4\u7684 Nginx/Nodejs/Redis \u5c31\u662f\u57fa\u4e8e\u5f02\u6b65\u6a21\u578b\u6784\u5efa\u51fa\u6765\u7684\u3002\u53ea\u4e0d\u8fc7\u4eba\u5bb6\u7528\u7684\u662f C \u8bed\u8a00\uff0c\u6027\u80fd\u4e0a\u9ad8\u51fa\u4e86\u51e0\u4e2a\u6570\u91cf\u7ea7\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/16376c152ad1ace8?w=300&h=283&f=jpeg&s=11304)\n\n\u5f02\u6b65\u6a21\u578b\u7684\u6027\u80fd\u8981\u6bd4\u540c\u6b65\u597d\u592a\u591a\uff0c\u4f46\u662f\u4e5f\u6709\u7f3a\u70b9\uff0c\u5c31\u662f\u4f1a\u589e\u52a0\u7f16\u7a0b\u96be\u5ea6\uff0c\u7406\u89e3\u8d77\u6765\u4e5f\u4e0d\u53ca\u540c\u6b65\u6a21\u578b\u6765\u7684\u76f4\u89c2\uff0c\u5bf9\u7a0b\u5e8f\u5458\u7684\u8981\u6c42\u4f1a\u6bd4\u8f83\u9ad8\u3002\n\n\u6240\u4ee5\uff0c\u5728\u516c\u53f8\u7684\u4e1a\u52a1\u6d41\u7a0b\u4ee3\u7801\u4e2d\uff0c\u591a\u534a\u91c7\u7528\u540c\u6b65\u6a21\u578b\uff0c\u4ec5\u4ec5\u662f\u5728\u7279\u522b\u8bb2\u7a76\u9ad8\u5e76\u53d1\u9ad8\u6027\u80fd\u7684\u573a\u5408\u624d\u4f1a\u7528\u5230\u5f02\u6b65\u6a21\u578b\u3002\u5f02\u6b65\u6a21\u578b\u7f16\u7801\u6210\u672c\u9ad8\uff0c\u5bb9\u6613\u51fa\u9519\uff0c\u4e00\u5b9a\u614e\u7528\uff01\n\n\u672c\u8282\u8bb2\u7684\u5355\u7ebf\u7a0b\u5f02\u6b65\u6a21\u578b\uff0c\u6700\u591a\u53ea\u80fd\u69a8\u5e72\u4e00\u4e2a CPU\u3002\u4e0b\u8282\u6211\u4eec\u4f7f\u7528\u591a\u8fdb\u7a0b\u5f02\u6b65\u6a21\u578b\uff0c\u8fd9\u4e2a\u6a21\u578b\u53ef\u4ee5\u5c06\u6240\u6709\u7684 CPU \u7edf\u7edf\u69a8\u5e72\uff0c\u5c31\u95ee\u4f60\u6015\u4e0d\u6015\uff1f", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u670d\u52a1\u5668_5\u5355\u8fdb\u7a0b\u5f02\u6b65\u6a21\u578b.md", "create_date": "2020-02-18T21:31:51.602", "order": 12}}, {"model": "subject.chapter", "pk": 85, "fields": {"title": "\u670d\u52a1\u5668 6\uff1a\u3010PreForking\u5f02\u6b65\u3011\u6a21\u578b", "topic": 4, "md5": "e6dc27bab8e799508daa8678bb4d5191", "md_body": "# \u670d\u52a1\u5668 6\uff1a\u3010PreForking\u5f02\u6b65\u3011\u6a21\u578b\n\n\u5355\u4e2a\u8fdb\u7a0b\u7684 IO \u5e76\u53d1\u80fd\u529b\u6709\u9650\uff0c\u867d\u7136\u4f7f\u7528\u4e86\u4e8b\u4ef6\u8f6e\u8be2 API \u548c\u5f02\u6b65\u8bfb\u5199\u529f\u80fd\uff0c\u4f46\u662f\u8fd8\u662f\u4e0d\u591f\u5e94\u5bf9\u5927\u578b\u670d\u52a1\u7684\u9ad8\u5e76\u53d1\u8981\u6c42\u3002\u7279\u522b\u662f Python \u8fd9\u79cd\u8bed\u8a00\u56e0\u4e3a GIL \u7684\u5b58\u5728\u4f7f\u5f97\u5355\u4e2a\u8fdb\u7a0b\u53ea\u80fd\u69a8\u5e72\u4e00\u4e2a CPU \u6838\u5fc3\u3002\u6211\u4eec\u9700\u8981\u4e00\u79cd\u6269\u5c55\u673a\u5236\u53ef\u4ee5\u6269\u5927\u670d\u52a1\u5668\u7684\u6574\u4f53\u5e76\u53d1\u5904\u7406\u80fd\u529b\uff0c\u597d\u597d\u5229\u7528\u73b0\u4ee3\u5904\u7406\u5668\u7684\u591a\u6838\u4f18\u52bf\uff0c\u8fd9\u5c31\u9700\u8981\u4f7f\u7528\u591a\u8fdb\u7a0b\u3002\n\n\u5c06 PreForking \u673a\u5236\u548c\u4e8b\u4ef6\u8f6e\u8be2\u5f02\u6b65\u8bfb\u5199\u7ed3\u5408\u8d77\u6765\uff0c\u5c31\u80fd\u8fbe\u6210\u4e0a\u9762\u6269\u5c55\u7684\u76ee\u6807\u3002PreForking \u51fa\u6765\u7684\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u5185\u90e8\u90fd\u662f\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u69a8\u5e72\u4e00\u4e2a CPU \u6838\u5fc3\uff0c\u591a\u4e2a\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u69a8\u5e72\u591a\u4e2a CPU \u6838\u5fc3\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/11/1634e13697d3b055?w=1033&h=639&f=png&s=76598)\n\n## \u591a\u8fdb\u7a0b PreForking \u5f02\u6b65\u6a21\u578b\n\n\u4ee3\u7801\u5b9e\u73b0\u548c\u524d\u9762\u7684\u5355\u8fdb\u7a0b\u5f02\u6b65\u6a21\u578b\u5dee\u522b\u4e0d\u5927\uff0c\u5c31\u662f\u591a\u4e86\u4e2a prefork \u8c03\u7528\u3002prefork \u5728\u670d\u52a1\u5668\u5957\u63a5\u5b57\u542f\u7528\u76d1\u542c\u961f\u5217\u4e4b\u540e\u8fdb\u884c\uff0c\u8fd9\u6837\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u5668\u5957\u63a5\u5b57\u6765\u83b7\u53d6\u65b0\u8fde\u63a5\u8fdb\u884c\u5904\u7406\u3002\n\n```\n# coding: utf8\n\nimport os\nimport json\nimport struct\nimport socket\nimport asyncore\nfrom cStringIO import StringIO\n\n\nclass RPCHandler(asyncore.dispatcher_with_send):\n\n    def __init__(self, sock, addr):\n        asyncore.dispatcher_with_send.__init__(self, sock=sock)\n        self.addr = addr\n        self.handlers = {\n            \"ping\": self.ping\n        }\n        self.rbuf = StringIO()  # \u8bfb\u7f13\u51b2\n\n    def handle_connect(self):\n        print self.addr, 'comes'\n\n    def handle_close(self):\n        print self.addr, 'bye'\n        self.close()\n\n    def handle_read(self):\n        while True:\n            content = self.recv(1024)\n            if content:\n                self.rbuf.write(content)  # \u8ffd\u52a0\u5230\u8bfb\u7f13\u51b2\n            if len(content) < 1024:  # \u8bf4\u660e\u5185\u6838\u7f13\u51b2\u533a\u7a7a\u4e86\uff0c\u7b49\u5f85\u4e0b\u4e2a\u4e8b\u4ef6\u5faa\u73af\u518d\u7ee7\u7eed\u8bfb\u5427\n                break\n        self.handle_rpc()  # \u5904\u7406\u65b0\u8bfb\u5230\u7684\u6d88\u606f\n\n    def handle_rpc(self):\n        while True:\n            self.rbuf.seek(0)\n            length_prefix = self.rbuf.read(4)\n            if len(length_prefix) < 4:  # \u534a\u5305\n                break\n            length, = struct.unpack(\"I\", length_prefix)\n            body = self.rbuf.read(length)\n            if len(body) < length:  # \u8fd8\u662f\u534a\u5305\n                break\n            request = json.loads(body)\n            in_ = request['in']\n            params = request['params']\n            print os.getpid(), in_, params\n            handler = self.handlers[in_]\n            handler(params) # \u5904\u7406 RPC\n            left = self.rbuf.getvalue()[length + 4:]  # \u622a\u65ad\u8bfb\u7f13\u51b2\n            self.rbuf = StringIO()\n            self.rbuf.write(left)\n        self.rbuf.seek(0, 2)  # \u79fb\u52a8\u6e38\u6807\u5230\u7f13\u51b2\u533a\u672b\u5c3e\uff0c\u4fbf\u4e8e\u540e\u7eed\u5185\u5bb9\u76f4\u63a5\u8ffd\u52a0\n\n    def ping(self, params):\n        self.send_result(\"pong\", params)\n\n    def send_result(self, out, result):\n        response = {\"out\": out, \"result\": result}\n        body = json.dumps(response)\n        length_prefix = struct.pack(\"I\", len(body))\n        self.send(length_prefix)\n        self.send(body)\n\n\nclass RPCServer(asyncore.dispatcher):\n\n    def __init__(self, host, port):\n        asyncore.dispatcher.__init__(self)\n        self.create_socket(socket.AF_INET, socket.SOCK_STREAM)\n        self.set_reuse_addr()\n        self.bind((host, port))\n        self.listen(1)\n        self.prefork(10)  # \u5f00\u8f9f 10 \u4e2a\u5b50\u8fdb\u7a0b\n\n    def prefork(self, n):\n        for i in range(n):\n            pid = os.fork()\n            if pid < 0:  # fork error\n                return\n            if pid > 0:  # parent process\n                continue\n            if pid == 0:\n                break  # child process\n\n    def handle_accept(self):\n        pair = self.accept()  # \u83b7\u53d6\u4e00\u4e2a\u8fde\u63a5\n        if pair is not None:\n            sock, addr = pair\n            RPCHandler(sock, addr)  # \u5904\u7406\u8fde\u63a5\n\n\nif __name__ == '__main__':\n    RPCServer(\"localhost\", 8080)\n    asyncore.loop()\n\n```\n\n\u5f00\u6e90\u6846\u67b6 Tornado \u548c\u5f00\u6e90\u4ee3\u7406\u670d\u52a1\u5668 Nginx \u6b63\u662f\u91c7\u7528\u4e86\u591a\u8fdb\u7a0b PreForking \u5f02\u6b65\u6a21\u578b\u8fbe\u5230\u4e86\u4e1a\u754c\u5567\u5567\u79f0\u5947\u7684\u9ad8\u5e76\u53d1\u7684\u5904\u7406\u80fd\u529b\u3002\n\n## \u540c\u6b65\u6a21\u578b vs \u5f02\u6b65\u6a21\u578b\n\n\u540c\u6b65\u548c\u5f02\u6b65\u7684\u5dee\u522b\u5c31\u597d\u6bd4\u5361\u8f66\u548c\u6469\u6258\u8f66\u4e00\u6837\uff0c\u5982\u679c\u9047\u5230\u4e86\u4ea4\u901a\u5835\u585e\uff0c\u5361\u8f66\u53ea\u80fd\u7ee7\u7eed\u7b49\u5f85\u5835\u585e\u7f13\u89e3\u624d\u53ef\u4ee5\u7ee7\u7eed\u524d\u8fdb\u3002\u4f46\u662f\u6469\u6258\u8f66\u4e0d\u4e00\u6837\uff0c\u5b83\u53ef\u4ee5\u5207\u6362\u5230\u5176\u5b83\u5c0f\u8def\u4e0d\u505c\u5730\u5f80\u524d\u5f00\u3002\n\n## \u5c0f\u7ed3\n\n\u5199\u5230\u8fd9\u91cc\u65f6\uff0c\u8001\u5e08\u611f\u89c9\u81ea\u5df1\u7684\u77e5\u8bc6\u5c31\u8981\u5feb\u88ab\u4f60\u4eec\u5438\u5e72\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/16376cfc8de560c2?w=225&h=225&f=jpeg&s=5484)\n\n\u6211\u672c\u6765\u6253\u7b97\u8fd8\u7559\u4e00\u70b9\u7ed9\u81ea\u5df1\u7eed\u547d\uff0c\u4f46\u662f\u597d\u4eba\u505a\u5230\u5e95\uff0c\u6211\u51b3\u5b9a\u628a\u8fd9\u6761\u8001\u547d\u5168\u90e8\u8c41\u51fa\u53bb\u4e86\u3002\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u6b63\u5f0f\u5f00\u8bb2\u5206\u5e03\u5f0f\u7cfb\u7edf\u6784\u5efa\u77e5\u8bc6\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u670d\u52a1\u5668_6PreForking\u5f02\u6b65\u6a21\u578b.md", "create_date": "2020-02-18T21:31:51.619", "order": 13}}, {"model": "subject.chapter", "pk": 86, "fields": {"title": "\u670d\u52a1\u5668 7\uff1a\u3010\u591a\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u4f20\u9012\u3011\u6a21\u578b", "topic": 4, "md5": "6aafe9e9c2a0da3d540b353cec9baf1a", "md_body": "# \u670d\u52a1\u5668 7\uff1a\u3010\u591a\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u4f20\u9012\u3011\u6a21\u578b\n\n\u672c\u8282\u662f\u8865\u5145\u5185\u5bb9\uff0c\u8001\u5e08\u8981\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e2a\u6bd4\u8f83\u7279\u522b\u7684 RPC \u670d\u52a1\u5668\u6a21\u578b\uff0c\u8fd9\u4e2a\u6a21\u578b\u4e0d\u540c\u4e8e Nginx\u3001\u4e0d\u540c\u4e8e Redis\u3001\u4e0d\u540c\u4e8e Apache\u3001\u4e0d\u540c\u4e8e Tornado\u3001\u4e0d\u540c\u4e8e Netty\uff0c\u5b83\u7684\u539f\u578b\u662f Node Cluster \u7684\u591a\u8fdb\u7a0b\u5e76\u53d1\u6a21\u578b\u3002\n\n## Nginx \u5e76\u53d1\u6a21\u578b\n\n\u6211\u4eec\u77e5\u9053 Nginx \u7684\u5e76\u53d1\u6a21\u578b\u662f\u4e00\u4e2a\u591a\u8fdb\u7a0b\u5e76\u53d1\u6a21\u578b\uff0c\u5b83\u7684 Master \u8fdb\u7a0b\u5728\u7ed1\u5b9a\u76d1\u542c\u5730\u5740\u7aef\u53e3\u540e fork \u51fa\u4e86\u591a\u4e2a Slave \u8fdb\u7a0b\u5171\u540c\u7ade\u4e89\u5904\u7406\u8fd9\u4e2a\u670d\u52a1\u7aef\u5957\u63a5\u5b57\u63a5\u6536\u5230\u7684\u5f88\u591a\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/2/16599c91138fd139?w=1544&h=902&f=png&s=209124)\n\n\u8fd9\u591a\u4e2a Slave \u8fdb\u7a0b\u4f1a\u5171\u4eab\u540c\u4e00\u4e2a\u5904\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u6001\u7684\u5957\u63a5\u5b57\u961f\u5217\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f51\u7edc\u6a21\u5757\u5728\u5904\u7406\u5b8c\u4e09\u6b21\u63e1\u624b\u540e\u5c31\u4f1a\u5c06\u5957\u63a5\u5b57\u585e\u8fdb\u8fd9\u4e2a\u961f\u5217\u3002\u8fd9\u662f\u4e00\u4e2a\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u578b\uff0c\u751f\u4ea7\u8005\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f51\u7edc\u6a21\u5757\uff0c\u6d88\u8d39\u8005\u662f\u591a\u4e2a Slave \u8fdb\u7a0b\uff0c\u961f\u5217\u4e2d\u7684\u5bf9\u8c61\u662f\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u3002\n\n\u8fd9\u79cd\u6a21\u578b\u5728\u8d1f\u8f7d\u5747\u8861\u4e0a\u6709\u4e00\u4e2a\u7f3a\u70b9\uff0c\u90a3\u5c31\u662f\u5957\u63a5\u5b57\u5206\u914d\u4e0d\u5747\u5300\uff0c\u5f62\u6210\u4e86\u7c7b\u4f3c\u4e8e\u8d2b\u5bcc\u5206\u5316\u7684\u5c40\u9762\uff0c\u4e5f\u5c31\u662f\u300c\u95f2\u8005\u6108\u95f2\uff0c\u5fd9\u8005\u6108\u5fd9\u300d\u7684\u72b6\u6001\u3002\u8fd9\u662f\u56e0\u4e3a\u5f53\u591a\u4e2a\u8fdb\u7a0b\u7ade\u4e89\u540c\u4e00\u4e2a\u5957\u63a5\u5b57\u961f\u5217\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u91c7\u7528\u4e86 LIFO \u7684\u7b56\u7565\uff0c\u6700\u540e\u4e00\u4e2a\u6765 accept \u7684\u8fdb\u7a0b\u6700\u4f18\u5148\u62ff\u5230 \u5957\u63a5\u5b57\u3002\u8d8a\u662f\u7e41\u5fd9\u7684\u8fdb\u7a0b\u8d8a\u662f\u6709\u66f4\u591a\u7684\u673a\u4f1a\u8c03\u7528 accept\uff0c\u5b83\u80fd\u62ff\u5230\u7684\u5957\u63a5\u5b57\u4e5f\u5c31\u8d8a\u591a\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/2/16599caa54c9cf6a?w=1208&h=464&f=png&s=78243)\n\n## Node Cluster \u5e76\u53d1\u6a21\u578b\n\nNode Cluster \u4e3a\u4e86\u89e3\u51b3\u8d1f\u8f7d\u5747\u8861\u95ee\u9898\uff0c\u5b83\u91c7\u7528\u4e86\u4e0d\u540c\u7684\u7b56\u7565\u3002\u5b83\u4e5f\u662f\u591a\u8fdb\u7a0b\u5e76\u53d1\u6a21\u578b\uff0cMaster \u8fdb\u7a0b\u4f1a fork \u51fa\u591a\u4e2a\u5b50\u8fdb\u7a0b\u6765\u5904\u7406\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u3002\u4f46\u662f\u4e0d\u5b58\u5728\u7ade\u4e89\u95ee\u9898\uff0c\u56e0\u4e3a\u8d1f\u8d23 accept \u5957\u63a5\u5b57\u7684\u53ea\u80fd\u662f Master \u8fdb\u7a0b\uff0cSlave \u8fdb\u7a0b\u53ea\u8d1f\u8d23\u5904\u7406\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u8bf7\u6c42\u3002\u90a3\u5c31\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0cMaster \u8fdb\u7a0b\u62ff\u5230\u7684\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u5982\u4f55\u4f20\u9012\u7ed9 Slave \u8fdb\u7a0b\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/2/16599c93d60337bf?w=1526&h=1012&f=png&s=225527)\n\n\u8fd9\u65f6\uff0c\u795e\u5947\u7684 sendmsg \u767b\u573a\u4e86\u3002\u5b83\u662f\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u8fdb\u7a0b\u4e4b\u95f4\u4f20\u9012\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002sendmsg \u4f1a\u642d\u4e58\u4e00\u4e2a\u7279\u6b8a\u7684\u300c\u7ba1\u9053\u300d\u5c06 Master \u8fdb\u7a0b\u7684\u5957\u63a5\u5b57\u63cf\u8ff0\u7b26\u4f20\u9012\u5230 Slave \u8fdb\u7a0b\uff0cSlave \u8fdb\u7a0b\u901a\u8fc7 recvmsg \u7cfb\u7edf\u8c03\u7528\u4ece\u8fd9\u4e2a\u300c\u7ba1\u9053\u300d\u4e2d\u5c06\u63cf\u8ff0\u7b26\u53d6\u51fa\u6765\u3002\u8fd9\u4e2a\u300c\u7ba1\u9053\u300d\u6bd4\u8f83\u7279\u6b8a\uff0c\u5b83\u662f Unix \u57df\u5957\u63a5\u5b57\u3002\u666e\u901a\u7684\u5957\u63a5\u5b57\u53ef\u4ee5\u8de8\u673a\u5668\u4f20\u8f93\u6d88\u606f\uff0cUnix \u57df\u5957\u63a5\u5b57\u53ea\u80fd\u5728\u540c\u4e00\u4e2a\u673a\u5668\u7684\u4e0d\u540c\u8fdb\u7a0b\u4e4b\u95f4\u4f20\u9012\u6d88\u606f\u3002\u540c\u7ba1\u9053\u4e00\u6837\uff0cUnix \u57df\u5957\u63a5\u5b57\u4e5f\u5206\u4e3a\u6709\u540d\u5957\u63a5\u5b57\u548c\u65e0\u540d\u5957\u63a5\u5b57\uff0c\u6709\u540d\u5957\u63a5\u5b57\u4f1a\u5728\u6587\u4ef6\u7cfb\u7edf\u6307\u5b9a\u4e00\u4e2a\u8def\u5f84\u540d\uff0c\u65e0\u5173\u8fdb\u7a0b\u4e4b\u95f4\u90fd\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u8def\u5f84\u6765\u8bbf\u95ee Unix \u57df\u5957\u63a5\u5b57\u3002\u800c\u65e0\u540d\u5957\u63a5\u5b57\u4e00\u822c\u7528\u4e8e\u7236\u5b50\u8fdb\u7a0b\u4e4b\u95f4\uff0c\u7236\u8fdb\u7a0b\u4f1a\u901a\u8fc7 socketpair \u8c03\u7528\u6765\u521b\u5efa\u5957\u63a5\u5b57\uff0c\u7136\u540e fork \u51fa\u6765\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u6837\u5b50\u8fdb\u7a0b\u4e5f\u4f1a\u540c\u65f6\u6301\u6709\u8fd9\u4e2a\u5957\u63a5\u5b57\u7684\u5f15\u7528\u3002\u540e\u7eed\u7236\u5b50\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u5957\u63a5\u5b57\u4e92\u76f8\u901a\u4fe1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/9/2/16599c9ecb300f2d?w=1196&h=866&f=png&s=129386)\n\n\u6ce8\u610f\u8fd9\u91cc\u7684\u4f20\u9012\u63cf\u8ff0\u7b26\uff0c\u672c\u8d28\u4e0a\u4e0d\u662f\u4f20\u9012\uff0c\u800c\u662f\u590d\u5236\u3002\u7236\u8fdb\u7a0b\u7684\u63cf\u8ff0\u7b26\u5e76\u4e0d\u4f1a\u5728 sendmsg \u81ea\u52a8\u5173\u95ed\u81ea\u52a8\u6d88\u5931\uff0c\u5b50\u8fdb\u7a0b\u6536\u5230\u7684\u63cf\u8ff0\u7b26\u548c\u7236\u8fdb\u7a0b\u7684\u63cf\u8ff0\u7b26\u4e5f\u4e0d\u662f\u540c\u4e00\u4e2a\u6574\u6570\u503c\u3002\u4f46\u662f\u7236\u5b50\u8fdb\u7a0b\u7684\u63cf\u8ff0\u7b26\u90fd\u4f1a\u6307\u5411\u540c\u4e00\u4e2a\u5185\u6838\u5957\u63a5\u5b57\u5bf9\u8c61\u3002\n\n\u6709\u4e86\u63cf\u8ff0\u7b26\u7684\u4f20\u9012\u80fd\u529b\uff0c\u7236\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u5c06 accept \u5230\u7684\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u8f6e\u6d41\u4f20\u9012\u7ed9\u591a\u4e2a Slave \u8fdb\u7a0b\uff0c\u8d1f\u8f7d\u5747\u8861\u7684\u76ee\u6807\u5c31\u53ef\u4ee5\u987a\u5229\u5b9e\u73b0\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u662f\u7528 Python \u4ee3\u7801\u6765\u64b8\u4e00\u904d Node Cluster \u7684\u5e76\u53d1\u6a21\u578b\u3002\u56e0\u4e3a sendmsg \u548c recvmsg \u65b9\u6cd5\u5230\u4e86 Python3.5 \u624d\u5185\u7f6e\u8fdb\u6765\uff0c\u6240\u4ee5\u4e0b\u9762\u7684\u4ee3\u7801\u9700\u8981\u4f7f\u7528 Python3.5+\u624d\u53ef\u4ee5\u8fd0\u884c\u3002\n\n\u6211\u4eec\u770b sendmsg \u65b9\u6cd5\u7684\u5b9a\u4e49\uff1a\n\n```\nsocket.sendmsg(buffers[,\u00a0ancdata[,\u00a0flags[,\u00a0address]]])\n\n```\n\n\u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3\u7b2c\u4e8c\u4e2a\u53c2\u6570 ancdata\uff0c\u63cf\u8ff0\u7b26\u662f\u901a\u8fc7ancdata \u53c2\u6570\u4f20\u9012\u7684\uff0c\u5b83\u7684\u610f\u601d\u662f \u300c\u8f85\u52a9\u6570\u636e\u300d\uff0c\u800c buffers \u8868\u793a\u9700\u8981\u4f20\u9012\u7684\u6d88\u606f\u5185\u5bb9\uff0c\u56e0\u4e3a\u6d88\u606f\u5185\u5bb9\u8fd9\u91cc\u6ca1\u6709\u610f\u4e49\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5b57\u6bb5\u53ef\u4ee5\u4efb\u610f\u586b\u5199\uff0c\u4f46\u662f\u5fc5\u987b\u8981\u6709\u5185\u5bb9\uff0c\u5982\u679c\u6ca1\u6709\u5185\u5bb9\uff0csendmsg \u65b9\u6cd5\u5c31\u662f\u4e00\u4e2a\u7a7a\u8c03\u7528\u3002\n\n```\nimport socket, struct\n\ndef send_fds(sock, fd):\n    return sock.sendmsg([b'x'], [(socket.SOL_SOCKET, socket.SCM_RIGHTS, struct.pack(\"i\", fd))])\n    \n# ancdata \u53c2\u6570\u662f\u4e00\u4e2a\u4e09\u5143\u7ec4\u7684\u5217\u8868\uff0c\u4e09\u5143\u7ec4\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u7f51\u7edc\u534f\u8bae\u6808\u7ea7\u522b level\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8868\u793a\u8f85\u52a9\u6570\u636e\u7684\u7c7b\u578b type\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u624d\u662f\u643a\u5e26\u7684\u6570\u636e\uff0clevel=SOL_SOCKET \u8868\u793a\u4f20\u9012\u7684\u6570\u636e\u5904\u4e8e TCP \u534f\u8bae\u5c42\u7ea7\uff0ctype=SCM_RIGHTS \u5c31\u8868\u793a\u643a\u5e26\u7684\u6570\u636e\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u6211\u4eec\u4f20\u9012\u7684\u63cf\u8ff0\u7b26 fd \u662f\u4e00\u4e2a\u6574\u6570\uff0c\u9700\u8981\u4f7f\u7528 struct \u5305\u5c06\u5b83\u5e8f\u5217\u5316\u6210\u4e8c\u8fdb\u5236\u3002\n\n```\n\n\u518d\u770b recvmsg \u65b9\u6cd5\u7684\u5b9a\u4e49\uff1a\n\n```\nmsg, ancdata, flags, addr = socket.recvmsg(bufsize[,\u00a0ancbufsize[,\u00a0flags]])\n\n```\n\n\u540c\u6837\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3\u8fd4\u56de\u7684 ancdata \u6570\u636e\uff0c\u5b83\u91cc\u9762\u5305\u542b\u4e86\u6211\u4eec\u9700\u8981\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u4f46\u662f\u9700\u8981\u63d0\u4f9b\u6d88\u606f\u4f53\u7684\u957f\u5ea6\u548c\u8f85\u52a9\u6570\u636e\u7684\u957f\u5ea6\u53c2\u6570\u3002\u8f85\u52a9\u6570\u636e\u7684\u957f\u5ea6\u6bd4\u8f83\u7279\u6b8a\uff0c\u9700\u8981\u4f7f\u7528 CMSG\\_LEN \u65b9\u6cd5\u6765\u8ba1\u7b97\uff0c\u56e0\u4e3a\u8f85\u52a9\u6570\u636e\u91cc\u9762\u8fd8\u6709\u6211\u4eec\u770b\u4e0d\u5230\u7684\u989d\u5916\u7684\u5934\u90e8\u4fe1\u606f\u3002\n\n```\nbufsize = 1  # \u6d88\u606f\u5185\u5bb9\u7684\u957f\u5ea6\nancbufsize = socket.CMSG_LEN(struct.calcsize('i'))  # \u8f85\u52a9\u6570\u636e\u7684\u957f\u5ea6\nmsg, ancdata, flags, addr = socket.recvmsg(bufsize,\u00a0ancbufsize) # \u6536\u53d6\u6d88\u606f\nlevel, type, fd_bytes = ancdata[0] # \u53d6\u7b2c\u4e00\u4e2a\u5143\u7956\uff0c\u6ce8\u610f\u53d1\u9001\u6d88\u606f\u65f6\u6211\u4eec\u4f20\u9012\u7684\u662f\u4e00\u4e2a\u4e09\u5143\u7ec4\u7684\u5217\u8868\nfd = struct.unpack('i', fd_bytes) # \u53cd\u5e8f\u5217\u5316\n\n```\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n\u4e0b\u9762\u6211\u6765\u732e\u4e0a\u5b8c\u6574\u7684\u670d\u52a1\u5668\u4ee3\u7801\uff0c\u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u5728 Slave \u8fdb\u7a0b\u4e2d\u5904\u7406 RPC \u8bf7\u6c42\u4f7f\u7528\u540c\u6b65\u6a21\u578b\u3002\n\n```\n# coding: utf\n# sendmsg recvmsg python3.5+\u624d\u53ef\u4ee5\u652f\u6301\n\nimport os\nimport json\nimport struct\nimport socket\n\n\ndef handle_conn(conn, addr, handlers):\n\u00a0 \u00a0 print(addr, \"comes\")\n\u00a0 \u00a0 while True:\n\u00a0 \u00a0 \u00a0 \u00a0 # \u7b80\u5355\u8d77\u89c1\uff0c\u8fd9\u91cc\u5c31\u6ca1\u6709\u4f7f\u7528\u5faa\u73af\u8bfb\u53d6\u4e86\n\u00a0 \u00a0 \u00a0 \u00a0 length_prefix = conn.recv(4)\n\u00a0 \u00a0 \u00a0 \u00a0 if not length_prefix:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 print(addr, \"bye\")\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 conn.close()\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 break\u00a0 # \u5173\u95ed\u8fde\u63a5\uff0c\u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2a\u8fde\u63a5\n\u00a0 \u00a0 \u00a0 \u00a0 length, = struct.unpack(\"I\", length_prefix)\n\u00a0 \u00a0 \u00a0 \u00a0 body = conn.recv(length)\n\u00a0 \u00a0 \u00a0 \u00a0 request = json.loads(body)\n\u00a0 \u00a0 \u00a0 \u00a0 in_ = request['in']\n\u00a0 \u00a0 \u00a0 \u00a0 params = request['params']\n\u00a0 \u00a0 \u00a0 \u00a0 print(in_, params)\n\u00a0 \u00a0 \u00a0 \u00a0 handler = handlers[in_]\n\u00a0 \u00a0 \u00a0 \u00a0 handler(conn, params)\n\n\ndef loop_slave(pr, handlers):\n\u00a0 \u00a0 while True:\n\u00a0 \u00a0 \u00a0 \u00a0 bufsize = 1\n\u00a0 \u00a0 \u00a0 \u00a0 ancsize = socket.CMSG_LEN(struct.calcsize('i'))\n\u00a0 \u00a0 \u00a0 \u00a0 msg, ancdata, flags, addr = pr.recvmsg(bufsize, ancsize)\n\u00a0 \u00a0 \u00a0 \u00a0 cmsg_level, cmsg_type, cmsg_data = ancdata[0]\n\u00a0 \u00a0 \u00a0 \u00a0 fd = struct.unpack('i', cmsg_data)[0]\n\u00a0 \u00a0 \u00a0 \u00a0 sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM, fileno=fd)\n\u00a0 \u00a0 \u00a0 \u00a0 handle_conn(sock, sock.getpeername(), handlers)\n\n\ndef ping(conn, params):\n\u00a0 \u00a0 send_result(conn, \"pong\", params)\n\n\ndef send_result(conn, out, result):\n\u00a0 \u00a0 response = json.dumps({\"out\": out, \"result\": result}).encode('utf-8')\n\u00a0 \u00a0 length_prefix = struct.pack(\"I\", len(response))\n\u00a0 \u00a0 conn.sendall(length_prefix)\n\u00a0 \u00a0 conn.sendall(response)\n\n\ndef loop_master(serv_sock, pws):\n\u00a0 \u00a0 idx = 0\n\u00a0 \u00a0 while True:\n\u00a0 \u00a0 \u00a0 \u00a0 sock, addr = serv_sock.accept()\n\u00a0 \u00a0 \u00a0 \u00a0 pw = pws[idx % len(pws)]\n\u00a0 \u00a0 \u00a0 \u00a0 # \u6d88\u606f\u6570\u636e\uff0cwhatever\n\u00a0 \u00a0 \u00a0 \u00a0 msg = [b'x']\n\u00a0 \u00a0 \u00a0 \u00a0 # \u8f85\u52a9\u6570\u636e\uff0c\u643a\u5e26\u63cf\u8ff0\u7b26\n\u00a0 \u00a0 \u00a0 \u00a0 ancdata = [(\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 socket.SOL_SOCKET,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 socket.SCM_RIGHTS,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 struct.pack('i', sock.fileno()))]\n\u00a0 \u00a0 \u00a0 \u00a0 pw.sendmsg(msg, ancdata)\n\u00a0 \u00a0 \u00a0 \u00a0 sock.close()\u00a0 # \u5173\u95ed\u5f15\u7528\n\u00a0 \u00a0 \u00a0 \u00a0 idx += 1\n\n\ndef prefork(serv_sock, n):\n\u00a0 \u00a0 pws = []\n\u00a0 \u00a0 for i in range(n):\n\u00a0 \u00a0 \u00a0 \u00a0 # \u5f00\u8f9f\u7236\u5b50\u8fdb\u7a0b\u901a\u4fe1\u300c\u7ba1\u9053\u300d\n\u00a0 \u00a0 \u00a0 \u00a0 pr, pw = socket.socketpair()\n\u00a0 \u00a0 \u00a0 \u00a0 pid = os.fork()\n\u00a0 \u00a0 \u00a0 \u00a0 if pid < 0:\u00a0 # fork error\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return pws\n\u00a0 \u00a0 \u00a0 \u00a0 if pid > 0:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u7236\u8fdb\u7a0b\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 pr.close()\u00a0 # \u7236\u8fdb\u7a0b\u4e0d\u7528\u8bfb\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 pws.append(pw)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 continue\n\u00a0 \u00a0 \u00a0 \u00a0 if pid == 0:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # \u5b50\u8fdb\u7a0b\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 serv_sock.close()\u00a0 # \u5173\u95ed\u5f15\u7528\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 pw.close()\u00a0 # \u5b50\u8fdb\u7a0b\u4e0d\u7528\u5199\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 return pr\n\u00a0 \u00a0 return pws\n\n\nif __name__ == '__main__':\n\u00a0 \u00a0 serv_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n\u00a0 \u00a0 serv_sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n\u00a0 \u00a0 serv_sock.bind((\"localhost\", 8080))\n\u00a0 \u00a0 serv_sock.listen(1)\n\u00a0 \u00a0 pws_or_pr = prefork(serv_sock, 10)\n\u00a0 \u00a0 if hasattr(pws_or_pr, '__len__'):\n\u00a0 \u00a0 \u00a0 \u00a0 if pws_or_pr:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 loop_master(serv_sock, pws_or_pr)\n\u00a0 \u00a0 \u00a0 \u00a0 else:\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 # fork \u5168\u90e8\u5931\u8d25\uff0c\u6ca1\u6709\u5b50\u8fdb\u7a0b\uff0cGame Over\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 serv_sock.close()\n\u00a0 \u00a0 else:\n\u00a0 \u00a0 \u00a0 \u00a0 handlers = {\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"ping\": ping\n\u00a0 \u00a0 \u00a0 \u00a0 }\n\u00a0 \u00a0 \u00a0 \u00a0 loop_slave(pws_or_pr, handlers)\n\n```\n\n\u7236\u8fdb\u7a0b\u4f7f\u7528 fork \u8c03\u7528\u521b\u5efa\u4e86\u591a\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u7136\u540e\u53c8\u4f7f\u7528 socketpair \u8c03\u7528\u4e3a\u6bcf\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u90fd\u521b\u5efa\u4e00\u4e2a\u65e0\u540d\u5957\u63a5\u5b57\u7528\u6765\u4f20\u9012\u63cf\u8ff0\u7b26\u3002\u7236\u8fdb\u7a0b\u4f7f\u7528 roundrobin \u7b56\u7565\u5e73\u5747\u5206\u914d\u63a5\u6536\u5230\u7684\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u3002\u5b50\u8fdb\u7a0b\u63a5\u6536\u5230\u7684\u662f\u4e00\u4e2a\u63cf\u8ff0\u7b26\u6574\u6570\uff0c\u9700\u8981\u5c06\u63cf\u8ff0\u7b26\u5305\u88c5\u6210\u5957\u63a5\u5b57\u5bf9\u8c61\u540e\u65b9\u53ef\u8bfb\u5199\u3002\u6253\u5370\u5bf9\u6bd4\u53d1\u9001\u548c\u63a5\u6536\u5230\u7684\u63cf\u8ff0\u7b26\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u4eec\u4fe9\u7684\u503c\u5e76\u4e0d\u76f8\u540c\uff0c\u8fd9\u662f\u56e0\u4e3a sendmsg \u5c06\u63cf\u8ff0\u7b26\u53d1\u9001\u5230\u5185\u6838\u540e\uff0c\u5185\u6838\u7ed9\u63cf\u8ff0\u7b26\u6307\u5411\u7684\u5185\u6838\u5957\u63a5\u5b57\u53c8\u91cd\u65b0\u5206\u914d\u4e86\u4e00\u4e2a\u65b0\u7684\u63cf\u8ff0\u7b26\u5bf9\u8c61\u3002\n\n## \u601d\u8003\u9898\n\n1.  sendmsg/recvmsg \u9664\u4e86\u53ef\u4ee5\u53d1\u9001\u63cf\u8ff0\u7b26\u5916\u8fd8\u53ef\u4ee5\u7528\u6765\u5e72\u4ec0\u4e48\uff1f\n2.  sendmsg/recvmsg \u53d1\u9001\u63a5\u6536\u63cf\u8ff0\u7b26\u5728\u5185\u6838\u6001\u5177\u4f53\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u670d\u52a1\u5668_7\u591a\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u4f20\u9012\u6a21\u578b.md", "create_date": "2020-02-18T21:31:51.640", "order": 14}}, {"model": "subject.chapter", "pk": 87, "fields": {"title": "\u62d3\u5c55 1\uff1agRPC \u539f\u7406\u4e0e\u5b9e\u8df5", "topic": 4, "md5": "661d8e8702a8abcacfe75846181495af", "md_body": "# \u62d3\u5c55 1\uff1agRPC \u539f\u7406\u4e0e\u5b9e\u8df5\n\ngRPC \u662f Google \u5f00\u6e90\u7684\u57fa\u4e8e Protobuf \u548c Http2.0 \u534f\u8bae\u7684\u901a\u4fe1\u6846\u67b6\uff0cGoogle \u6df1\u5ea6\u5b66\u4e60\u6846\u67b6 tensorflow \u5e95\u5c42\u7684 RPC \u901a\u4fe1\u5c31\u5b8c\u5168\u4f9d\u8d56\u4e8e gRPC \u5e93\u3002Google \u7684\u5f00\u6e90\u5f71\u54cd\u529b\u5f88\u5927\uff0c\u76ee\u524d\u5df2\u7ecf\u6709\u975e\u5e38\u591a\u7684\u5927\u578b\u4e92\u8054\u7f51\u516c\u53f8\u5728\u4f7f\u7528 gRPC \u4e86\u3002\u6bd4\u5982\u56fd\u4ea7\u5f00\u6e90\u6570\u636e\u5e93\u5f71\u54cd\u529b\u6700\u5927\u7684 Tidb \u5c31\u9009\u62e9\u4e86 gRPC \u4f5c\u4e3a\u5e95\u5c42\u901a\u8baf\u5e93\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c8d8db8d4768e?w=654&h=226&f=png&s=15181)\n\ngRPC \u4e4b\u6240\u4ee5\u9009\u62e9 Http2.0 \u4f5c\u4e3a\u57fa\u7840\u5f00\u6e90\u534f\u8bae\uff0c\u662f\u8003\u8651\u5230 Http \u534f\u8bae\u5728\u4e92\u8054\u7f51\u5e94\u7528\u7684\u5e7f\u6cdb\u6027\u3002\u540c\u65f6\u56e0\u4e3a Http2.0 \u652f\u6301\u7684 Streaming \u548c Duplexing \u53ef\u4ee5\u5c06\u8bf7\u6c42\u548c\u54cd\u5e94\u6d88\u606f\u8fdb\u884c\u5206\u7247\u4ea4\u53c9\u4f20\u9001\uff0c\u53ef\u4ee5\u5927\u5e45\u63d0\u5347\u4f20\u8f93\u6548\u7387\uff0cGRPC \u7279\u8272\u7684 Stream \u6d88\u606f\u6b63\u662f\u4f7f\u7528\u4e86 Http2.0 \u7684 Streaming \u7279\u6027\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c8d69cc6cc63b?w=668&h=196&f=png&s=9399)\n\n\u4e3a\u4e86\u7406\u89e3 gRPC \u7684\u539f\u7406\u6211\u4eec\u6709\u5fc5\u8981\u5148\u5bf9 HTTP2.0 \u534f\u8bae\u6709\u4e2a\u57fa\u672c\u7684\u4e86\u89e3\u3002\n\n## HTTP2.0\n\n\u76ee\u524d\u56fd\u5185\u5927\u90e8\u5206\u4e92\u8054\u7f51\u90fd\u8fd8\u5728\u4f7f\u7528 HTTP1.1 \u534f\u8bae\u5bf9\u5916\u63d0\u4f9b API \u670d\u52a1\uff0c\u4e0d\u8fc7 HTTP2.0 \u5728\u56fd\u5916\u65e9\u5df2\u6697\u6d41\u6d8c\u52a8\uff0c\u5f88\u591a\u5927\u578b\u4e92\u8054\u7f51\u516c\u53f8\u90fd\u5df2\u7ecf\u6709\u5927\u91cf\u7684\u4e1a\u52a1\u7ebf\u5728\u4f7f\u7528\u4e86 HTTP2.0 \u534f\u8bae\u3002\u636e W3Techs \u7edf\u8ba1\uff0c\u622a\u6b62 2018 \u5e74 6 \u6708\u4efd\uff0c\u5df2\u7ecf\u6709 26% \u7684\u5927\u578b\u4e92\u8054\u7f51\u670d\u52a1\u5df2\u7ecf\u5f00\u59cb\u4f7f\u7528 HTTP2.0 \u534f\u8bae\u3002HTTP2.0 \u534f\u8bae\u6bd4\u8f83\u590d\u6742\uff0c\u4e0b\u9762\u6211\u53ea\u8bb2\u4e00\u4e0b HTTP2.0 \u7684\u4e00\u4e9b\u91cd\u8981\u7279\u6027\u3002\n\n**duplexing**\n\nHTTP2.0 \u76f8\u6bd4 HTTP1.1 \u6709\u975e\u5e38\u5927\u7684\u4e0d\u540c\uff0cHTTP1.1 \u8fd8\u662f\u57fa\u4e8e\u6587\u672c\u534f\u8bae\u7684\u95ee\u7b54\u6709\u5e8f\u6a21\u5f0f\uff0c\u4f46\u662f HTTP2.0 \u662f\u57fa\u4e8e\u4e8c\u8fdb\u5236\u534f\u8bae\u7684\u4e71\u5e8f\u6a21\u5f0f (Duplexing)\u3002\u8fd9\u610f\u5473\u540c\u4e00\u4e2a\u8fde\u63a5\u901a\u9053\u4e0a\u591a\u4e2a\u8bf7\u6c42\u5e76\u884c\u65f6\uff0c\u670d\u52a1\u5668\u5904\u7406\u5feb\u7684\u53ef\u4ee5\u5148\u8fd4\u56de\u800c\u4e0d\u7528\u56e0\u4e3a\u7b49\u5f85\u5176\u5b83\u8bf7\u6c42\u7684\u54cd\u5e94\u800c\u6392\u961f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c8e7a99339e76?w=1009&h=340&f=png&s=47150)\n\n**header \u4f18\u5316**\n\n\u6211\u4eec\u77e5\u9053 HTTP \u534f\u8bae\u7684\u8bf7\u6c42\u5934\u6709\u5927\u91cf\u7684 key/value \u6587\u672c\u7ec4\u6210\uff0c\u591a\u4e2a\u8bf7\u6c42\u76f4\u63a5 key/value \u91cd\u590d\u7a0b\u5ea6\u5f88\u9ad8\u3002\u4e3a\u4e86\u4f18\u5316\u8fd9\u90e8\u5206\uff0cHTTP2.0 \u5bf9\u8bf7\u6c42\u5934\u7684 key/value \u505a\u4e86\u5b57\u5178\u5904\u7406\uff0c\u5bf9\u4e8e\u5e38\u7528\u7684 key/value \u6587\u672c\u65e0\u9700\u91cd\u590d\u4f20\u9001\uff0c\u800c\u662f\u901a\u8fc7\u5f15\u7528\u5185\u90e8\u5b57\u5178\u7684\u6574\u6570\u7d22\u5f15\u6765\u8fbe\u5230\u663e\u8457\u8282\u7701\u8bf7\u6c42\u5934\u4f20\u8f93\u6d41\u91cf\u7684\u76ee\u7684\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u4ee5\u540e\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\u8089\u773c\u6765\u89c2\u5bdf HTTP \u534f\u8bae\u6d4b\u4f20\u8f93\u5185\u5bb9\u4e86\uff0c\u5b83\u7684\u534f\u8bae\u5185\u5bb9\u5bf9\u8089\u773c\u4e0d\u518d\u5341\u5206\u53cb\u597d\u3002\n\n**framing & streaming**\n\n\u5728 HTTP1.1 \u91cc\u9762\u5982\u679c\u4e00\u4e2a\u54cd\u5e94\u7684\u5185\u5bb9\u592a\u5927\uff0c\u4e00\u822c\u4f7f\u7528 chunk \u6a21\u5f0f\u8fdb\u884c\u5206\u5757\u4f20\u8f93\u3002\u5728 HTTP2.0 \u91cc\u9762\u5b83\u4e5f\u6709\u5206\u5757\u4f20\u9001\uff0c\u4f46\u662f\u6982\u5ff5\u4e0a\u53eb\u7740`Framing`\u2014\u2014\u5206\u5e27\u4f20\u9001\u3002\u540c\u4e00\u4e2a\u54cd\u5e94\u4f1a\u6709\u540c\u4e00\u4e2a\u6d41 ID`stream_id`\uff0c\u6d88\u606f\u63a5\u6536\u7aef\u4f1a\u5c06\u5177\u6709\u76f8\u540c`stream_id`\u7684\u6d88\u606f\u5e27\u4e32\u8d77\u6765\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u6765\u5904\u7406\uff0c\u4f4d\u4e8e\u6d41\u7684\u6700\u540e\u4e00\u4e2a\u6d88\u606f\u5e27\u4f1a\u6709\u4e00\u4e2a\u6d41\u7ed3\u675f\u6807\u5fd7\u4f4d`(EOS\u2014\u2014End of Stream)`\u3002\u6ce8\u610f EOS \u5e76\u4e0d\u610f\u5473\u7740\u8fde\u63a5\u7684\u4e2d\u6b62\uff0c\u540c\u4e00\u4e2a\u8fde\u63a5\u4e0a\u4f1a\u6709\u591a\u4e2a\u6d41\u7a7f\u63d2\u4f20\u8f93\uff0c\u7ed3\u675f\u4e86\u5355\u4e2a\u6d41\u8fd8\u4f1a\u6709\u5f88\u591a\u5176\u5b83\u7684\u6d41\u5728\u7ee7\u7eed\u4f20\u9001\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c8faa521c5315?w=986&h=84&f=png&s=18261)\n\n**\u5e27\u683c\u5f0f**\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c900e3019b85b?w=704&h=301&f=png&s=17078)\n\nHTTP2.0 \u7684\u6d88\u606f\u90fd\u662f\u5206\u5e27\u4f20\u9001\u7684\uff0c\u6240\u6709\u7684\u6d88\u606f\u90fd\u662f\u4e00\u5e27\u4e00\u5e27\u7684\uff0c\u6709\u4e9b\u5c0f\u8bf7\u6c42 / \u54cd\u5e94\u53ea\u6709\u4e00\u4e2a\u5e27\uff0c\u8fd8\u6709\u4e9b\u5927\u8bf7\u6c42 / \u54cd\u5e94\u56e0\u4e3a\u5185\u5bb9\u591a\u9700\u8981\u591a\u4e2a\u5e27\u3002\u6bcf\u4e2a\u5e27\u7684\u683c\u5f0f\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5305\u542b\u957f\u5ea6\u524d\u7f00\u3001\u6d88\u606f\u7c7b\u578b\u3001\u6d88\u606f\u6807\u5fd7\u4f4d\u548c\u6d88\u606f\u5185\u5bb9 5 \u4e2a\u90e8\u5206\u3002\n\nHTTP2.0 \u9ed8\u8ba4\u5b9a\u4e49\u4e86\u5341\u79cd\u7c7b\u578b\u7684\u5e27\uff0c\u56e0\u4e3a type \u5b57\u6bb5\u662f\u4e00\u4e2a\u5b57\u8282\uff0c\u53ef\u4ee5\u652f\u6301 255 \u4e2a\u7c7b\u578b\uff0c\u6240\u4ee5\u5e27\u7c7b\u578b\u662f\u53ef\u4ee5\u6269\u5c55\u7684\u3002\n\n1.  HEADERS \u5e27 \u5934\u4fe1\u606f\uff0c\u5bf9\u5e94\u4e8e`HTTP HEADER`\n2.  DATA \u5e27 \u5bf9\u5e94\u4e8e`HTTP Response Body`\n3.  PRIORITY \u5e27 \u7528\u4e8e\u8c03\u6574\u6d41\u7684\u4f18\u5148\u7ea7\n4.  RST\\_STREAM \u5e27 \u6d41\u7ec8\u6b62\u5e27\uff0c\u7528\u4e8e\u4e2d\u65ad\u8d44\u6e90\u7684\u4f20\u8f93\n5.  SETTINGS \u5e27 \u7528\u6237\u5ba2\u6237\u670d\u52a1\u5668\u4ea4\u6d41\u8fde\u63a5\u914d\u7f6e\u4fe1\u606f\n6.  PUSH\\_PROMISE \u5e27 \u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u4e3b\u52a8\u63a8\u9001\u8d44\u6e90\n7.  GOAWAY \u5e27 \u793c\u8c8c\u5730\u901a\u77e5\u5bf9\u65b9\u65ad\u5f00\u8fde\u63a5\n8.  PING \u5e27 \u5fc3\u8df3\u5e27\uff0c\u68c0\u6d4b\u5f80\u8fd4\u65f6\u95f4\u548c\u8fde\u63a5\u53ef\u7528\u6027\n9.  WINDOW\\_UPDATE \u5e27 \u8c03\u6574\u5e27\u7a97\u53e3\u5927\u5c0f\n10.  CONTINUATION \u5e27 HEADERS \u5e27\u592a\u5927\u65f6\u5206\u5757\u7684\u7eed\u5e27\n\nHTTP2.0 \u5b9a\u4e49\u4e86\u4e09\u79cd\u5e38\u7528\u7684\u6807\u5fd7\u4f4d\uff0c\u5b83\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e27\u7684\u5c5e\u6027\u3002\n\n1.  END\\_STREAM \u6d41\u7ed3\u675f\u6807\u5fd7\uff0c\u8868\u793a\u5f53\u524d\u5e27\u662f\u6d41\u7684\u6700\u540e\u4e00\u4e2a\u5e27\n2.  END\\_HEADERS \u5934\u7ed3\u675f\u8868\u793a\uff0c\u8868\u793a\u5f53\u524d\u5e27\u662f\u5934\u4fe1\u606f\u7684\u6700\u540e\u4e00\u4e2a\u5e27\n3.  PADDED \u586b\u5145\u6807\u5fd7\uff0c\u5728\u6570\u636e Payload \u91cc\u586b\u5145\u65e0\u7528\u4fe1\u606f\uff0c\u7528\u4e8e\u5e72\u6270\u4fe1\u9053\u76d1\u542c\n\n\u901a\u5e38\u6211\u4eec\u6700\u5e38\u7528\u7684 HTTP \u8bf7\u6c42 / \u54cd\u5e94\u7684\u5e27\u5f62\u5f0f\u5982\u4e0b\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c90e5a630d04d?w=1199&h=308&f=png&s=32875)\n\n## **HTTP2.0 vs HTTP1.1**\n\nHTTP2.0 \u548c HTTP1.1 \u7684\u533a\u522b\u5c31\u597d\u6bd4\u653f\u5e9c\u4f01\u4e1a\u548c\u4e92\u8054\u7f51\u4f01\u4e1a\u3002\u5728\u653f\u5e9c\u4f01\u4e1a\u91cc\u5f80\u5f80\u8bb2\u7a76\u8bba\u8d44\u6392\u8f88\uff0c\u8c01\u5148\u6765\u8c01\u662f\u8001\u5927\uff0c\u540e\u8f88\u4eec\u53ea\u6709\u7b49\u524d\u8f88\u4eec\u9000\u4f11\u4e86\u624d\u80fd\u7ee7\u7eed\u5f80\u4e0a\u8d70\u3002\u800c\u4e92\u8054\u7f51\u4f01\u4e1a\u4e0d\u4e00\u6837\uff0c\u8c01\u6709\u80fd\u529b\u8c01\u5148\u4e0a\uff0c\u6240\u4ee5\u6211\u4eec\u7ecf\u5e38\u770b\u5230\u67d0\u67d0\u516c\u53f8\u91cc\u7684 90 \u540e\u7684\u9886\u5bfc\u5e26\u7740\u4e00\u5c41\u80a1 80 \u540e\u7684\u5144\u5f1f\u4eec\u7ec4\u961f\u6253\u602a\u505a\u4ea7\u54c1\u3002\n\n**protobuf**\n\n\u6211\u4eec\u5728\u524d\u9762\u7684 Protobuf \u7ae0\u8282\u63d0\u5230 Protobuf \u534f\u8bae\u4ec5\u4ec5\u5b9a\u4e49\u4e86\u5355\u4e2a\u6d88\u606f\u7684\u5e8f\u5217\u5316\u683c\u5f0f\uff0c\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u5934\u90e8\u7684\u957f\u5ea6\u548c\u6d88\u606f\u7684\u7c7b\u540d\u79f0\u6765\u533a\u5206\u6d88\u606f\u8fb9\u754c\u3002Protobuf \u5c06\u6d88\u606f\u5e8f\u5217\u5316\u540e\uff0c\u5185\u5bb9\u653e\u5728 HTTP2.0 \u7684 Data \u5e27\u7684 Payload \u5b57\u6bb5\u91cc\uff0c\u6d88\u606f\u7684\u957f\u5ea6\u5728 Data \u5e27\u7684 Length \u5b57\u6bb5\u91cc\uff0c\u6d88\u606f\u7684\u7c7b\u540d\u79f0\u653e\u5728 Headers \u5e27\u7684 Path \u5934\u4fe1\u606f\u4e2d\u3002\u6211\u4eec\u9700\u8981\u901a\u8fc7\u5934\u90e8\u5b57\u6bb5\u7684 Path \u6765\u786e\u5b9a\u5177\u4f53\u6d88\u606f\u7684\u89e3\u7801\u5668\u6765\u53cd\u5e8f\u5217\u5316 Data \u5e27\u7684 Payload \u5185\u5bb9\uff0c\u800c\u8fd9\u4e9b\u5de5\u4f5c gRPC \u90fd\u5e2e\u6211\u4eec\u5e72\u4e86\u3002\n\n## gRPC \u5165\u95e8\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c96b5be229172?w=984&h=532&f=png&s=76848)\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528 GRPC \u6765\u5b9e\u73b0\u4e00\u4e0b\u5706\u5468\u7387\u8ba1\u7b97\u670d\u52a1\u3002\u6574\u4e2a\u8fc7\u7a0b\u5206\u4e3a\u4e94\u6b65\n\n1.  \u7f16\u5199\u534f\u8bae\u6587\u4ef6 `pi.proto`\n2.  \u4f7f\u7528`grpc_tools`\u5de5\u5177\u5c06 `pi.proto`\u7f16\u8bd1\u6210`pi_pb2.py`\u548c`pi_pb2_grpc.py`\u4e24\u4e2a\u6587\u4ef6\n3.  \u4f7f\u7528`pi_pb2_grpc.py`\u6587\u4ef6\u4e2d\u7684\u670d\u52a1\u5668\u63a5\u53e3\u7c7b\uff0c\u7f16\u5199\u670d\u52a1\u5668\u5177\u4f53\u903b\u8f91\u5b9e\u73b0\n4.  \u4f7f\u7528`pi_pb2_grpc.py`\u6587\u4ef6\u4e2d\u7684\u5ba2\u6237\u7aef Stub\uff0c\u7f16\u5199\u5ba2\u6237\u7aef\u4ea4\u4e92\u4ee3\u7801\n5.  \u5206\u522b\u8fd0\u884c\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\uff0c\u89c2\u5bdf\u8f93\u51fa\u7ed3\u679c\n\n\u9996\u5148\u6211\u4eec\u5b89\u88c5\u4e00\u4e0b\u5de5\u5177\u4f9d\u8d56\n\n```\npip install grpcio_tools  # tools \u5305\u542b\u4ee3\u7801\u751f\u6210\u5de5\u5177\uff0c\u4f1a\u81ea\u52a8\u5b89\u88c5\u4f9d\u8d56\u7684 grpcio \u5305\n\n```\n\n**\u7f16\u5199\u534f\u8bae\u6587\u4ef6**\n\n```\nsyntax = \"proto3\";\n\npackage pi;\n\n// pi service\nservice PiCalculator {\n    // pi method\n    rpc Calc(PiRequest) returns (PiResponse) {}\n}\n\n// pi input\nmessage PiRequest {\n    int32 n = 1;\n}\n\n// pi output\nmessage PiResponse {\n    double value = 1;\n}\n\n```\n\n\u534f\u8bae\u6587\u4ef6\u5305\u542b\u8f93\u5165\u6d88\u606f`PiRequest`\u3001\u8f93\u51fa\u6d88\u606f`PiResponse`\u548c rpc \u670d\u52a1\u8c03\u7528\u7684\u5b9a\u4e49`PiCalculator`\n\n**\u751f\u6210\u4ee3\u7801**\n\n```\npython -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. pi.proto\n\n```\n\n\u8fd9\u4e2a\u547d\u4ee4\u884c\u6709\u5f88\u591a\u53c2\u6570\uff0c\u5176\u4e2d`python_out`\u76ee\u5f55\u6307\u5b9a`pi_pb2.py`\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84\uff0c`grpc_python_out`\u6307\u5b9a`pi_pb2_grpc.py`\u6587\u4ef6\u7684\u8f93\u51fa\u8def\u5f84\u3002`-I`\u53c2\u6570\u6307\u5b9a\u534f\u8bae\u6587\u4ef6\u7684\u67e5\u627e\u76ee\u5f55\uff0c\u6211\u4eec\u90fd\u5c06\u5b83\u4eec\u8bbe\u7f6e\u4e3a\u5f53\u524d\u76ee\u5f55\u3002\n\n\u547d\u4ee4\u6267\u884c\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u76ee\u5f55\u4e0b\u591a\u4e86\u4e24\u4e2a\u6587\u4ef6\uff0c`pi_pb2.py`\u548c`pi_pb2_grpc.py`\u3002\u524d\u8005\u662f\u6d88\u606f\u5e8f\u5217\u5316\u7c7b\uff0c\u540e\u8005\u5305\u542b\u4e86\u670d\u52a1\u5668 Stub \u7c7b\u548c\u5ba2\u6237\u7aef Stub \u7c7b\uff0c\u4ee5\u53ca\u5f85\u5b9e\u73b0\u7684\u670d\u52a1 RPC \u63a5\u53e3\u3002\n\n**\u5b9e\u73b0\u670d\u52a1\u63a5\u53e3**\n\n\u4e0a\u9762\u6211\u4eec\u751f\u6210\u4e86\u670d\u52a1\u7684 RPC \u63a5\u53e3\uff0c\u5b83\u53ea\u662f\u4e2a\u7a7a\u63a5\u53e3\uff0c\u5177\u4f53\u8ba1\u7b97\u903b\u8f91\u8981\u7528\u6237\u81ea\u5df1\u6765\u6765\u5b9e\u73b0\u3002\u4e0b\u9762\u6211\u4eec\u5b9e\u73b0\u4e00\u4e0b\u5706\u5468\u7387\u8ba1\u7b97\u670d\u52a1\u7684\u903b\u8f91\u3002\u7136\u540e\u5c06\u670d\u52a1\u7c7b\u7ec4\u88c5\u6210\u4e00\u4e2a\u5b8c\u6210\u7684\u670d\u52a1\u5668\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b3f5b64ff9974?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)\n\n```\n# coding: utf-8\n# server.py\nimport math\nimport grpc\nimport time\nfrom concurrent import futures\n\nimport pi_pb2\nimport pi_pb2_grpc\n\n\n# \u5706\u5468\u7387\u8ba1\u7b97\u670d\u52a1\u5b9e\u73b0\u7c7b\nclass PiCalculatorServicer(pi_pb2_grpc.PiCalculatorServicer):\n\n    def Calc(self, request, ctx):\n        # \u8ba1\u7b97\u5706\u5468\u7387\u7684\u903b\u8f91\u5728\u8fd9\u91cc\n        s = 0.0\n        for i in range(request.n):\n            s += 1.0/(2*i+1)/(2*i+1)\n        # \u6ce8\u610f\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u54cd\u5e94\u5bf9\u8c61\n        return pi_pb2.PiResponse(value=math.sqrt(8*s))\n\n\ndef main():\n    # \u591a\u7ebf\u7a0b\u670d\u52a1\u5668\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    # \u5b9e\u4f8b\u5316\u5706\u5468\u7387\u670d\u52a1\u7c7b\n    servicer = PiCalculatorServicer()\n    # \u6ce8\u518c\u672c\u5730\u670d\u52a1\n    pi_pb2_grpc.add_PiCalculatorServicer_to_server(servicer, server)\n    # \u76d1\u542c\u7aef\u53e3\n    server.add_insecure_port('127.0.0.1:8080')\n    # \u5f00\u59cb\u63a5\u6536\u8bf7\u6c42\u8fdb\u884c\u670d\u52a1\n    server.start()\n    # \u4f7f\u7528 ctrl+c \u53ef\u4ee5\u9000\u51fa\u670d\u52a1\n    try:\n        time.sleep(1000)\n    except KeyboardInterrupt:\n        server.stop(0)\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\n**\u5ba2\u6237\u7aef**\n\n\u5ba2\u6237\u7aef\u5c31\u7b80\u5355\u591a\u4e86\uff0c\u76f4\u63a5\u4f7f\u7528\u751f\u6210\u4ee3\u7801\u7684\u5ba2\u6237\u7aef Stub \u5c31\u53ef\u4ee5\u8fde\u63a5\u670d\u52a1\u5668\u8fdb\u884c\u8c03\u7528\u4e86\u3002\u6211\u4eec\u8fd0\u884c 1000 \u6b21 Pi \u8ba1\u7b97\u670d\u52a1\uff0c\u89c2\u5bdf pi \u7684\u8ba1\u7b97\u7ed3\u679c\u662f\u4e0d\u662f\u8d8a\u6765\u8d8a\u63a5\u8fd1\u5706\u5468\u7387\u3002\n\n```\n# coding: utf-8\n# client.py\n\nimport grpc\n\nimport pi_pb2\nimport pi_pb2_grpc\n\n\ndef main():\n    channel = grpc.insecure_channel('localhost:8080')\n    # \u4f7f\u7528 stub\n    client = pi_pb2_grpc.PiCalculatorStub(channel)\n    # \u8c03\u7528\u5427\n    for i in range(1, 1000):\n        print \"pi(%d) =\" % i, client.Calc(pi_pb2.PiRequest(n=i)).value\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\n**\u8fd0\u884c**\n\n```\n# \u5f00\u4e00\u4e2a\u7a97\u53e3\npython server.py\n# \u518d\u5f00\u4e00\u4e2a\u7a97\u53e3\npython client.py\n\n```\n\n\u89c2\u5bdf\u5230\u8f93\u51fa\u5982\u4e0b\n\n```\n...\npi(990) = 3.14127111202\npi(991) = 3.1412714365\npi(992) = 3.14127176033\npi(993) = 3.1412720835\npi(994) = 3.14127240602\npi(995) = 3.14127272789\npi(996) = 3.14127304912\npi(997) = 3.1412733697\npi(998) = 3.14127368964\npi(999) = 3.14127400894\n\n```\n\n**\u7ebf\u7a0b\u6a21\u578b**\n\ngRPC \u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u5f02\u6b65 IO \u6a21\u578b\uff0c\u5e95\u5c42\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u4e8b\u4ef6\u5faa\u73af\u3002\u5b83\u7684\u5f02\u6b65\u4e0d\u662f\u4f7f\u7528 Python \u5185\u7f6e\u7684 asyncio \u6765\u5b8c\u6210\u7684\uff0c\u5b83\u4f7f\u7528\u7684\u662f\u5f00\u6e90\u5f02\u6b65\u4e8b\u4ef6\u6846\u67b6 gevent\u3002gevent \u7684\u4f18\u52bf\u5728\u4e8e\u53ef\u4ee5\u8ba9\u7528\u6237\u4f7f\u7528\u540c\u6b65\u7684\u4ee3\u7801\u7f16\u5199\u5f02\u6b65\u7684\u903b\u8f91\uff0c\u800c\u5b8c\u5168\u4e0d\u77e5\u5185\u90e8\u6b63\u5728\u8fdb\u884c\u590d\u6742\u7684\u534f\u7a0b\u8c03\u5ea6\uff0c\u8fd9\u6837\u53ef\u4ee5\u660e\u663e\u964d\u4f4e\u6846\u67b6\u4ee3\u7801\u7684\u5b9e\u73b0\u590d\u6742\u5ea6\u3002grpc \u670d\u52a1\u5668\u7aef\u63a5\u6536\u5230\u4e00\u4e2a\u5b8c\u6574\u7684\u6d88\u606f\u5305\u540e\u5c31\u4f1a\u4f20\u9012\u5230\u7ebf\u7a0b\u6c60\u53bb\u8fdb\u884c\u4e1a\u52a1\u903b\u8f91\u5904\u7406\uff0c\u7ebf\u7a0b\u6c60\u662f\u7531\u7528\u6237\u5c42\u4ee3\u7801\u6765\u6307\u5b9a\u7684\uff0c\u5f85\u7ebf\u7a0b\u6c60\u5c06\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u5c06\u7ed3\u679c\u6254\u5230 IO \u6a21\u578b\u7684\u5b8c\u6210\u961f\u5217\u4e2d\u8fdb\u884c\u540e\u7eed\u7684\u54cd\u5e94\u5904\u7406\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163ca165f5549ee2?w=870&h=386&f=png&s=47110)\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6539\u9020\u4e00\u4e0b\u5ba2\u6237\u7aef\u4ee3\u7801\uff0c\u4f7f\u7528\u5ba2\u6237\u7aef\u7684\u5e76\u884c RPC \u8c03\u7528\u6765\u8ba1\u7b97\u5706\u5468\u7387\u3002\n\n```\n# multithread_client.py\nimport grpc\n\nimport pi_pb2\nimport pi_pb2_grpc\n\nfrom concurrent import futures\n\ndef pi(client, k):\n    return client.Calc(pi_pb2.PiRequest(n=k)).value\n\ndef main():\n    channel = grpc.insecure_channel('localhost:8080')\n    # client \u5bf9\u8c61\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\n    client = pi_pb2_grpc.PiCalculatorStub(channel)\n    # \u5ba2\u6237\u7aef\u4f7f\u7528\u7ebf\u7a0b\u6c60\u6267\u884c\n    pool = futures.ThreadPoolExecutor(max_workers=4)\n    results = []\n    for i in range(1, 1000):\n        results.append((i, pool.submit(pi, client, i)))\n    # \u7b49\u5f85\u6240\u6709\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\n    pool.shutdown()\n    for i, future in results:\n        print i, future.result()\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\n\u73b0\u5728\u6211\u4eec\u53bb\u6389 print \u6253\u5370\u8f93\u51fa\uff0c\u5bf9\u6bd4\u6539\u9020\u524d\u540e\u5ba2\u6237\u7aef\u7684\u6267\u884c\u6548\u7387\u53d1\u73b0\uff0c\u4e24\u8005\u6267\u884c\u65f6\u95f4\u5c45\u7136\u5dee\u4e0d\u591a\n\n```\n> time python client.py\npython client.py  0.43s user 0.10s system 44% cpu 1.192 total\n\n> time python multithread_client.py\npython multithread_client.py  0.57s user 0.21s system 60% cpu 1.289 total\n\n```\n\n\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\u539f\u56e0\u5728\u4e8e Python \u670d\u52a1\u5668\u7684 GIL \u9650\u5236\u4e86\u7a0b\u5e8f\u6700\u591a\u53ea\u80fd\u4f7f\u7528\u5355\u4e2a CPU \u6838\u5fc3\uff0c\u867d\u7136\u662f\u591a\u7ebf\u7a0b\u670d\u52a1\u5668\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5bf9\u4e8e\u7eaf\u8ba1\u7b97\u6027\u64cd\u4f5c\u6765\u8bf4\uff0c\u591a\u7ebf\u7a0b\u7684\u6267\u884c\u6548\u7387\u8ddf\u5355\u7ebf\u7a0b\u6ca1\u6709\u533a\u522b\u3002\u4e0b\u9762\u6211\u4eec\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u4e00\u4e0b\u6539\u9020\uff0c\u5728\u8ba1\u7b97\u65b9\u6cd5\u91cc\u9762\u589e\u52a0\u4e00\u4e2a sleep \u64cd\u4f5c\uff0c\u6bd4\u5982\u73b0\u5728\u6211\u4eec\u5728\u6bcf\u4e2a Calc \u65b9\u6cd5\u91cc\u7761\u7720 0.01s\uff0c\u7136\u540e\u518d\u5bf9\u6bd4\uff0c\u7ed3\u679c\u5c31\u4f1a\u6bd4\u8f83\u660e\u663e\u4e86\u3002\n\n```\n> time python client.py\npython client.py  0.68s user 0.15s system 5% cpu 14.031 total\n\n> time python multithread_client.py\npython multithread_client.py  0.67s user 0.25s system 43% cpu 2.099 total\n\n```\n\n\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0cRPC \u670d\u52a1\u5f80\u5f80\u4f34\u968f\u7740\u5f88\u591a IO \u64cd\u4f5c\uff0c\u591a\u7ebf\u7a0b\u5728 IO \u578b\u670d\u52a1\u4e2d\u53ef\u4ee5\u660e\u663e\u63d0\u5347\u6574\u4f53\u670d\u52a1\u6548\u7387\u3002\n\n**PreForking \u6a21\u578b**\n\n\u6ce8\u610f gRPC \u6682\u65f6\u4e0d\u652f\u6301\u591a\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u5982\u679c\u8981\u652f\u6301\u591a\u8fdb\u7a0b\u6a21\u578b\uff0cgRPC \u5b98\u65b9\u8868\u793a\u8fd8\u9700\u8981\u505a\u5927\u91cf\u7684\u6539\u9020\uff0c\u76ee\u524d gRPC \u8fd8\u4e0d\u652f\u6301 fork\uff0c\u7b14\u8005\u505a\u4e86\u591a\u6b21\u8bd5\u9a8c\u53d1\u73b0\u8fd0\u884c\u5728 PreForking \u6a21\u578b\u4e0b\uff0c\u5ba2\u6237\u7aef\u4f1a\u51fa\u73b0\u83ab\u540d\u5176\u5999\u7684\u5361\u6b7b\u73b0\u8c61\uff0c\u4e0d\u5efa\u8bae\u8bfb\u8005\u4f7f\u7528\u3002\n\n## Streaming\n\ngRPC \u7684\u4e00\u4e2a\u7279\u8272\u4e4b\u5904\u5728\u4e8e\u63d0\u4f9b\u4e86 Streaming \u6a21\u5f0f\uff0c\u6709\u4e86 Streaming \u6a21\u5f0f\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u5c06\u4e00\u8fde\u4e32\u7684\u8bf7\u6c42\u8fde\u7eed\u53d1\u9001\u5230\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u5c06\u4e00\u8fde\u4e32\u8fde\u7eed\u7684\u54cd\u5e94\u56de\u590d\u7ed9\u5ba2\u6237\u7aef\u3002\u5b83\u7c7b\u4f3c\u4e8e\u5217\u8868\u7c7b\u578b\u7684\u6d88\u606f\uff0c\u4f46\u662f\u53c8\u4e0d\u4e00\u6837\u3002\u5217\u8868\u7c7b\u7684\u6d88\u606f\u8981\u6c42\u6211\u4eec\u4e00\u6b21\u6027\u5c06\u6574\u4e2a\u5217\u8868\u6d88\u606f\u6253\u5305\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff0c\u4f46\u662f Streaming \u4e0d\u4e00\u6837\uff0c\u53ef\u4ee5\u751f\u6210\u4e00\u4e2a\u8bf7\u6c42\u5c31\u53ef\u4ee5\u7acb\u5373\u53d1\u5f80\u670d\u52a1\u5668\uff0c\u63a5\u4e0b\u6765\u7ee7\u7eed\u751f\u6210\u8bf7\u6c42\uff0c\u7ee7\u7eed\u53d1\u9001\uff0c\u5c31\u597d\u6bd4\u6d41\u6c34\u7ebf\u4e00\u6837\u3002\n\n\u5bf9\u6bd4\u524d\u9762\u7684\u540c\u6b65\u8c03\u7528\uff0cStreaming \u53ef\u4ee5\u7406\u89e3\u4e3a gRPC \u7684\u5f02\u6b65\u8c03\u7528\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163ca3eb9c586cc5?w=747&h=218&f=png&s=20825)\n\nStreaming \u4e5f\u662f\u4eba\u7c7b\u4e4b\u95f4\u6b63\u5e38\u7684\u5bf9\u8bdd\u5f62\u5f0f\uff0c\u4e24\u4e2a\u4eba\u5bf9\u8bdd\u53ef\u4ee5\u4e00\u95ee\u4e00\u7b54\uff0c\u4e5f\u53ef\u4ee5\u4e00\u6b21\u6027\u8bf4\u5f88\u591a\u8bdd\u8ba9\u5bf9\u65b9\u4e00\u76f4\u542c\u3002\u4e0d\u8fc7 Streaming \u8fd8\u662f\u4e0d\u592a\u4e00\u6837\uff0c\u5b83\u5141\u8bb8\u4e00\u4e2a\u4eba\u540c\u65f6\u8bf4\u53c8\u540c\u65f6\u542c\uff0c\u53cc\u5de5\u5bf9\u8bdd\uff0c\u4eba\u7c7b\u5728\u8fd9\u65b9\u9762\u7684\u80fd\u529b\u90a3\u662f\u5f88\u6b20\u7f3a\u7684\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u4e0a\u9762\u7684\u5706\u5468\u7387\u670d\u52a1\u6539\u9020\u6210 Streaming \u6a21\u5f0f\u8fdb\u884c\u4ea4\u4e92\u3002\n\n**\u7f16\u5199\u534f\u8bae\u6587\u4ef6**\n\n```\nsyntax = \"proto3\";\n\npackage pi;\n\n// pi service\nservice PiCalculator {\n\t// pi method\n\trpc Calc(stream PiRequest) returns (stream PiResponse) {}\n}\n\n// pi input\nmessage PiRequest {\n\tint32 n = 1;\n}\n\n// pi output\nmessage PiResponse {\n\tint32  n = 1;\n\tdouble value = 2;\n}\n\n```\n\n\u8fd9\u4e2a\u534f\u8bae\u5dee\u522b\u5f88\u5c0f\uff0c\u5c31\u662f\u5728\u8f93\u5165\u8f93\u51fa\u7c7b\u578b\u4e0a\u589e\u52a0\u4e86 stream \u5173\u952e\u5b57\u5c31\u53ef\u4ee5\u5c06\u8f93\u5165\u8f93\u51fa\u540c\u65f6\u53d8\u6210\u6d41\u5f0f\u4e86\u3002\u4e0d\u8fc7\u8fd8\u5f97\u6ce8\u610f\u5230\u8f93\u51fa\u6d88\u606f\u589e\u52a0\u4e86\u4e00\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570 n \u5c31\u662f\u8f93\u5165\u7684\u53c2\u6570 n\u3002\u5f53\u534f\u8bae\u53d8\u6210\u6d41\u5f0f\u4e4b\u540e\uff0c\u8f93\u5165\u548c\u8f93\u51fa\u7684\u5bf9\u5e94\u5173\u7cfb\u9700\u8981\u5728\u534f\u8bae\u5c42\u9762\u8fdb\u884c\u7ef4\u62a4\u3002\u56e0\u4e3a\u4e0d\u662f\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4f1a\u6709\u54cd\u5e94\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u5ffd\u7565\u6389\u67d0\u4e9b\u8bf7\u6c42\u4e0d\u8fdb\u884c\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u8f93\u5165\u548c\u8f93\u51fa\u4e0d\u518d\u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\u3002\n\n**\u751f\u6210\u4ee3\u7801**\n\n\u8fd9\u4e2a\u548c\u524d\u9762\u7684\u6ca1\u6709\u5dee\u522b\uff0c\u4e00\u6478\u4e00\u6837\uff0c\u8bfb\u8005\u62f7\u8d1d\u7c98\u8d34\u5373\u53ef\u3002\n\n**\u5b9e\u73b0\u670d\u52a1\u63a5\u53e3**\n\n```\n# coding: utf-8\n# server.py\nimport math\nimport grpc\nimport time\nimport random\nfrom concurrent import futures\n\nimport pi_pb2\nimport pi_pb2_grpc\n\n\nclass PiCalculatorServicer(pi_pb2_grpc.PiCalculatorServicer):\n\n    def Calc(self, request_iterator, ctx):\n        # request \u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\u53c2\u6570\uff0c\u5bf9\u5e94\u7684\u662f\u4e00\u4e2a stream \u8bf7\u6c42\n        for request in request_iterator:\n            # 50% \u7684\u6982\u7387\u4f1a\u6709\u54cd\u5e94\n            if random.randint(0, 1) == 1:\n                continue\n            s = 0.0\n            for i in range(request.n):\n                s += 1.0/(2*i+1)/(2*i+1)\n            # \u54cd\u5e94\u662f\u4e00\u4e2a\u751f\u6210\u5668\uff0c\u4e00\u4e2a\u54cd\u5e94\u5bf9\u5e94\u5bf9\u5e94\u4e00\u4e2a\u8bf7\u6c42\n            yield pi_pb2.PiResponse(n=i, value=math.sqrt(8*s))\n\n\ndef main():\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    servicer = PiCalculatorServicer()\n    pi_pb2_grpc.add_PiCalculatorServicer_to_server(servicer, server)\n    server.add_insecure_port('localhost:8080')\n    server.start()\n    try:\n        time.sleep(1000)\n    except KeyboardInterrupt:\n        server.stop(0)\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\n\u670d\u52a1\u5668\u5dee\u522b\u4e5f\u5f88\u5c0f\uff0c\u53ea\u662f\u5728 RPC \u65b9\u6cd5\u7684\u8f93\u5165\u548c\u8f93\u51fa\u5206\u522b\u53d8\u6210\u4e86\u8fed\u4ee3\u5668\u548c\u751f\u6210\u5668\uff0c\u6ca1\u6709\u5176\u5b83\u533a\u522b\u3002\u540c\u65f6\u4e3a\u4e86\u4f53\u73b0\u8f93\u5165\u8f93\u51fa\u4e0d\u662f\u4e00\u5bf9\u4e00\u7684\u6548\u679c\uff0c\u6211\u4eec\u6309 50% \u7684\u6982\u7387\u5bf9\u8bf7\u6c42\u4e88\u4ee5\u54cd\u5e94\u3002\n\n**\u5b9e\u73b0\u5ba2\u6237\u7aef**\n\n```\n# client.py\nimport grpc\n\nimport pi_pb2\nimport pi_pb2_grpc\n\n\ndef generate_request():\n    for i in range(1, 1000):\n        yield pi_pb2.PiRequest(n=i)\n\n\ndef main():\n    channel = grpc.insecure_channel('localhost:8080')\n    client = pi_pb2_grpc.PiCalculatorStub(channel)\n    response_iterator = client.Calc(generate_request())\n    for response in response_iterator:\n        print \"pi(%d) =\" % response.n, response.value\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\n\u5ba2\u6237\u7aef\u7684\u5dee\u522b\u5728\u4e8e RPC \u7684\u8f93\u5165\u53c2\u6570\u662f\u4e00\u4e2a\u751f\u6210\u5668\uff0c\u8f93\u51fa\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u8fd9\u4e2a\u8ddf\u670d\u52a1\u5668\u6b63\u597d\u5bf9\u5e94\u8d77\u6765\u3002\n\n**\u8fd0\u884c**\n\n```\n# \u5f00\u4e00\u4e2a\u7a97\u53e3\npython server.py\n# \u518d\u5f00\u4e00\u4e2a\u7a97\u53e3\npython client.py\n\n```\n\n\u89c2\u5bdf\u5230\u8f93\u51fa\u5982\u4e0b\n\n```\n...\npi(981) = 3.14126849241\npi(982) = 3.14126882219\npi(984) = 3.14126947975\npi(985) = 3.14126980753\npi(986) = 3.14127013464\npi(987) = 3.1412704611\npi(988) = 3.14127078689\npi(989) = 3.14127111202\npi(991) = 3.14127176033\npi(992) = 3.1412720835\n\n```\n\n\u8dd1\u8d77\u6765\u8ddf\u666e\u901a\u7684 RPC \u4f3c\u4e4e\u6ca1\u6709\u592a\u591a\u533a\u522b\uff0c\u53ea\u4e0d\u8fc7\u4ece\u8f93\u51fa\u4e0a\u770b n \u7684\u503c\u5e76\u4e0d\u8fde\u7eed\uff0c\u6709\u5f88\u591a\u8bf7\u6c42\u88ab\u8df3\u8fc7\u4e86\u3002\n\ngRPC \u9664\u4e86\u652f\u6301\u5ba2\u6237\u7aef\u670d\u52a1\u5668\u53cc\u5411 Streaming \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5355\u5411 Streaming\u3002\u5982\u5355\u8bf7\u6c42\u6d41\u54cd\u5e94\u6216\u8005\u6d41\u8bf7\u6c42\u5355\u54cd\u5e94\u3002\u6bd4\u5982\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e86\u6d41\u8bf7\u6c42\uff0c\u5305\u542b\u4e86\u4e00\u5806\u5b50\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u5bf9\u8fd9\u4e9b\u5b50\u8bf7\u6c42\u8fdb\u884c\u6c47\u603b\u5904\u7406\uff0c\u901a\u8fc7\u4e00\u4e2a\u5355\u54cd\u5e94\u56de\u9988\u7ed9\u5ba2\u6237\u7aef\uff0c\u8fd9\u5c31\u662f\u6d41\u8bf7\u6c42\u5355\u54cd\u5e94\u7684\u4e00\u4e2a\u4f7f\u7528\u573a\u666f\u3002\u518d\u6bd4\u5982\u63a8\u8350\u7cfb\u7edf\u5728\u7ed9\u7528\u6237\u8ba1\u7b97\u63a8\u8350\u5546\u54c1\u65f6\uff0c\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u975e\u5e38\u590d\u6742\u7684\u8ba1\u7b97\uff0c\u800c\u4e14\u662f\u5206\u5e03\u8ba1\u7b97\uff0c\u4e00\u6b21\u53ea\u80fd\u5410\u51fa\u51e0\u4e2a\u7ed3\u679c\uff0c\u6574\u4f53\u8017\u65f6\u4f1a\u5f88\u957f\u3002\u8fd9\u65f6\u5c31\u53ef\u4ee5\u901a\u8fc7 Streaming \u7ed9\u5ba2\u6237\u7aef\u54cd\u5e94\uff0c\u7b97\u51fa\u4e00\u4e2a\u63a8\u4e00\u4e2a\uff0c\u800c\u4e0d\u662f\u7b49\u5230\u5b8c\u5168\u8ba1\u7b97\u5b8c\u6bd5\u518d\u7ed9\u7ed3\u679c\uff0c\u8fd9\u6837\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u7528\u6237\u4f53\u9a8c\uff0c\u8fd9\u5c31\u662f\u5355\u8bf7\u6c42\u6d41\u54cd\u5e94\u7684\u4f7f\u7528\u573a\u666f\u3002\n\n## \u5f02\u5e38\u5904\u7406\n\nRPC \u670d\u52a1\u8fd8\u9700\u8981\u5904\u7406\u7684\u4e00\u4e2a\u91cd\u8981\u95ee\u9898\u5c31\u662f\u5f02\u5e38\u3002\u5f53 RPC \u670d\u52a1\u5668\u903b\u8f91\u629b\u51fa\u5f02\u5e38\u65f6\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\u53ef\u4ee5\u6b63\u786e\u6355\u83b7\u5230\u3002GRPC \u5bf9\u5f02\u5e38\u7684\u5904\u7406\u5c31\u662f\u5728\u54cd\u5e94\u5934\u5e27\u91cc\u4f7f\u7528 Status \u548c Status-Message \u4e24\u4e2a header \u6765\u6807\u8bc6\u5f02\u5e38\u7684 code \u548c\u539f\u56e0\u3002\u5bf9\u5e94\u7684\u4ee3\u7801\u5c31\u662f\n\n```\nclass PiCalculatorServicer(pi_pb2_grpc.PiCalculatorServicer):\n\n    def Calc(self, request, ctx):\n        if request.n <= 0:\n            ctx.set_code(grpc.StatusCode.INVALID_ARGUMENT)  # \u53c2\u6570\u9519\u8bef\n            ctx.set_details(\"request number should be positive\")  # \u9519\u8bef\u5177\u4f53\u8bf4\u660e\n            return pi_pb2.PiResponse()\n        s = 0.0\n        for i in range(request.n):\n            s += 1.0/(2*i+1)/(2*i+1)\n        return pi_pb2.PiResponse(value=math.sqrt(8*s))\n\n```\n\ngRPC \u6846\u67b6\u5185\u7f6e\u4e86\u5f88\u591a\u9519\u8bef code\uff0c\u5f53\u6211\u60f3\u8981\u629b\u51fa\u5f02\u5e38\u65f6\uff0c\u5c31\u4ece\u4e2d\u6311\u9009\u4e00\u4e2a\u5408\u9002\u7684 code\uff0c\u518d\u52a0\u4e0a\u4e00\u4e2a\u9519\u8bef\u8bf4\u660e\u7684\u5b57\u7b26\u4e32\u5c31\u53ef\u4ee5\u4e86\u3002\u6ce8\u610f\u5373\u4f7f\u53d1\u751f\u9519\u8bef\u4e86\uff0c\u4e5f\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u6b63\u5e38\u7684\u7a7a\u5bf9\u8c61\u3002\n\n\u5ba2\u6237\u7aef\u5728\u5904\u7406\u5f02\u5e38\u65f6\u7528 try...catch \u5305\u88f9\u8d77 RPC \u8c03\u7528\uff0c\u7136\u540e\u4ece\u5f02\u5e38\u5bf9\u8c61\u4e2d\u63d0\u53d6 code \u548c details \u4e24\u4e2a\u5b57\u6bb5\u5c31\u77e5\u9053\u5177\u4f53\u53d1\u751f\u7684\u9519\u8bef\u539f\u56e0\u4e86\u3002\n\n```\ndef main():\n    channel = grpc.insecure_channel('localhost:8080')\n    client = pi_pb2_grpc.PiCalculatorStub(channel)\n    for i in range(2):\n        try:\n            print \"pi(%d) =\" % i, client.Calc(pi_pb2.PiRequest(n=i)).value\n        except grpc.RpcError as e:\n            print e.code(), e.details()\n\n```\n\n## \u81ea\u5b9a\u4e49\u5f02\u5e38\n\ngRPC \u6846\u67b6\u5185\u90e8\u5185\u7f6e\u4e86\u5f88\u591a\u5f02\u5e38\u72b6\u6001\u7801\uff0c\u6211\u4ece\u6e90\u7801\u91cc\u5c06\u8fd9\u4e9b\u9519\u8bef\u7801\u90fd\u5217\u4e86\u51fa\u6765\n\n```\nclass StatusCode(enum.Enum):\n    # \u9ed8\u8ba4\u6b63\u5e38\n    OK = (_cygrpc.StatusCode.ok, 'ok')\n    # RPC \u8c03\u7528\u53d6\u6d88\n    CANCELLED = (_cygrpc.StatusCode.cancelled, 'cancelled')\n    # \u672a\u77e5\u9519\u8bef\uff0c\u4e00\u822c\u662f\u670d\u52a1\u5668\u4e1a\u52a1\u903b\u8f91\u629b\u51fa\u4e86\u4e00\u4e2a\u5f02\u5e38\n    UNKNOWN = (_cygrpc.StatusCode.unknown, 'unknown')\n    # \u53c2\u6570\u9519\u8bef\n    INVALID_ARGUMENT = (_cygrpc.StatusCode.invalid_argument, 'invalid argument')\n    # \u8c03\u7528\u8d85\u65f6\n    DEADLINE_EXCEEDED = (_cygrpc.StatusCode.deadline_exceeded, 'deadline exceeded')\n    # \u8d44\u6e90\u6ca1\u627e\u5230\n    NOT_FOUND = (_cygrpc.StatusCode.not_found, 'not found')\n    # \u8d44\u6e90\u91cd\u590d\u521b\u5efa\n    ALREADY_EXISTS = (_cygrpc.StatusCode.already_exists, 'already exists')\n    # \u6743\u9650\u4e0d\u8db3\n    PERMISSION_DENIED = (_cygrpc.StatusCode.permission_denied, 'permission denied')\n    # \u8d44\u6e90\u4e0d\u591f\n    RESOURCE_EXHAUSTED = (_cygrpc.StatusCode.resource_exhausted, 'resource exhausted')\n    # \u9884\u68c0\u5931\u8d25\n    FAILED_PRECONDITION = (_cygrpc.StatusCode.failed_precondition, 'failed precondition')\n    # \u8c03\u7528\u4e2d\u6b62\n    ABORTED = (_cygrpc.StatusCode.aborted, 'aborted')\n    # \u8d85\u51fa\u8d44\u6e90\u65e2\u6709\u8303\u56f4\uff0c\u6bd4\u5982\u65ad\u70b9\u7eed\u4f20\u7684 offset \u503c\u8d85\u51fa\u6587\u4ef6\u957f\u5ea6\n    OUT_OF_RANGE = (_cygrpc.StatusCode.out_of_range, 'out of range')\n    # \u670d\u52a1\u5668\u672a\u5b9e\u73b0\u534f\u8bae\u4e2d\u5b9a\u4e49\u7684 Service \u63a5\u53e3\n    UNIMPLEMENTED = (_cygrpc.StatusCode.unimplemented, 'unimplemented')\n    # \u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef\n    INTERNAL = (_cygrpc.StatusCode.internal, 'internal')\n    # \u670d\u52a1\u6302\u4e86\n    UNAVAILABLE = (_cygrpc.StatusCode.unavailable, 'unavailable')\n    # \u6570\u636e\u4e22\u5931\n    DATA_LOSS = (_cygrpc.StatusCode.data_loss, 'data loss')\n    # \u9274\u6743\u9519\u8bef\n    UNAUTHENTICATED = (_cygrpc.StatusCode.unauthenticated, 'unauthenticated')\n\n```\n\n\u8fd9\u4e9b\u9519\u8bef\u7801\u548c HTTP \u7684\u4e00\u7cfb\u5217\u72b6\u6001\u7801\u57fa\u672c\u90fd\u80fd\u5bf9\u4e0a\u3002\u6709\u5f88\u591a\u7c7b\u578b\u6211\u4eec\u901a\u5e38\u90fd\u7528\u4e0d\u4e0a\uff0c\u4e0d\u8fc7\u8fd9\u4e9b\u7c7b\u578b\u90fd\u662f\u534f\u8bae\u5b9a\u4e49\u7684\uff0c\u5fc5\u7136\u6709\u76f8\u5e94\u7684\u4f7f\u7528\u573a\u666f\u3002\u770b\u5230\u8fd9\u91cc\uff0c\u4e5f\u8bb8\u4f60\u4f1a\u95ee\uff1a\u5982\u679c\u6211\u60f3\u81ea\u5b9a\u4e49\u4e1a\u52a1\u7684\u9519\u8bef\u7801\uff0c\u8be5\u600e\u4e48\u505a\u5462\uff1f\n\n\u6709\u4e24\u79cd\u65b9\u6cd5\uff0c\u7b2c\u4e00\u4e2a\u5c31\u662f\u5728 details \u5b57\u6bb5\u7740\u624b\uff0c\u5b83\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 details \u6765\u4f20\u9012\u5e8f\u5217\u5316\u7684\u81ea\u5b9a\u4e49\u9519\u8bef\u5bf9\u8c61\u3002\n\n```\nctx.details(json.dumps({\"biz_err_code\": 10086, \"msg\": \"something happened\"}))\n\n```\n\n\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u662f\u901a\u8fc7 metadata\uff0cgRPC \u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u5934\u90fd\u652f\u6301\u4f20\u9012 metadata \u4fe1\u606f\uff0c\u5b83\u662f\u4e00\u4e2a\u5177\u6709\u591a\u4e2a\u5b57\u7b26\u4e32 key/value \u7684\u5b57\u5178\uff0c\u4f60\u53ef\u4ee5\u5728 metadata \u4e2d\u6dfb\u52a0\u4efb\u610f\u9644\u52a0\u4fe1\u606f\u3002\n\n```\nctx.send_initial_metadata([(key1, value1), (key2, value2)])\n\n```\n\n\u6ce8\u610f key/value \u5fc5\u987b\u662f\u5b57\u7b26\u4e32\uff0c\u5426\u5219 gRPC \u6846\u67b6\u4f1a\u629b\u51fa\u9519\u8bef\u3002\u6211\u4eec\u4ece\u5ba2\u6237\u7aef\u6355\u83b7\u5230\u7684\u5f02\u5e38\u4e2d\u5c31\u53ef\u4ee5\u5c06 metadata \u8bfb\u53d6\u51fa\u6765\u3002\n\n```\ne.initial_metadata()\n\n```\n\n## \u5355\u5411\u6d88\u606f\n\n\u8fd8\u6709\u4e00\u79cd\u91cd\u8981\u7684\u6d88\u606f\u7c7b\u578b\u53eb\u5355\u5411 oneway \u6d88\u606f\uff0c\u8fd9\u7c7b\u6d88\u606f\u9002\u5408\u4e0d\u91cd\u8981\u7684\u65e5\u5fd7\u578b\u6570\u636e\uff0c\u53d1\u5411\u4e86\u670d\u52a1\u5668\u4e0d\u8981\u6c42\u6709\u54cd\u5e94\uff0c\u5373\u4f7f\u6d88\u606f\u4e22\u5931\u4e86\u4e5f\u65e0\u6240\u8c13\u3002gRPC \u4e0d\u652f\u6301\u8fd9\u7c7b\u6d88\u606f\uff0cgRPC \u5f3a\u5236\u8981\u6c42\u8f93\u5165\u548c\u8f93\u51fa\u90fd\u5fc5\u987b\u6709\u7c7b\u578b\uff0c\u5982\u679c\u4e0d\u9700\u8981\u8fd4\u56de\u7ed3\u679c\uff0c\u4e5f\u5fc5\u987b\u4f7f\u7528\u5185\u7f6e\u7684 Empty \u7684\u6d88\u606f\u7c7b\u578b\u4f5c\u4e3a\u8fd4\u56de\u3002\u76f8\u6bd4\u800c\u8a00\uff0cThrift \u662f\u652f\u6301 oneway \u6d88\u606f\u7684\uff0c\u963f\u91cc\u7684 SOFA RPC \u4e5f\u652f\u6301 oneway \u6d88\u606f\u3002\n\n## \u538b\u7f29\n\n\u5ba2\u6237\u7aef\u53ef\u4ee5\u5728 channel \u7684\u9009\u9879\u4e2d\u6307\u5b9a\u538b\u7f29\u7b97\u6cd5\u5c5e\u6027\uff0c\u5728\u8bf7\u6c42\u7684\u5934\u90e8\u4f1a\u643a\u5e26\u538b\u7f29\u7b97\u6cd5\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u5668\u3002\u53ef\u60dc\u7684\u662f\u76ee\u524d\u53ea\u652f\u6301\u5ba2\u6237\u7aef\u538b\u7f29\uff0cPython \u7248\u672c\u7684 gRPC \u670d\u52a1\u5668\u7248\u672c\u6ca1\u6709\u63d0\u4f9b\u538b\u7f29\u9009\u9879\u3002\n\n```\nimport grpc\nfrom grpc._cython.cygrpc import CompressionAlgorithm\nfrom grpc._cython.cygrpc import CompressionLevel\n\nchan_ops = [('grpc.default_compression_algorithm', CompressionAlgorithm.gzip),\n            ('grpc.grpc.default_compression_level', CompressionLevel.high)]\n\nchannel = grpc.insecure_channel('localhost:8080', chan_ops)\n\n```\n\n## \u91cd\u8bd5\n\ngRPC \u9ed8\u8ba4\u4e0d\u652f\u6301\u91cd\u8bd5\uff0c\u5982\u679c RPC \u8c03\u7528\u9047\u5230\u9519\u8bef\uff0c\u4f1a\u7acb\u5373\u5411\u4e0a\u5c42\u629b\u51fa\u9519\u8bef\u3002\u91cd\u8bd5\u4e0e\u5426\u53ea\u80fd\u7531\u7528\u6237\u81ea\u5df1\u7684\u4e1a\u52a1\u4ee3\u7801\u6765\u8fdb\u884c\u63a7\u5236\u6216\u8005\u7531\u62e6\u622a\u5668\u6765\u7edf\u4e00\u63a7\u5236\u3002\n\n## \u8d85\u65f6\n\ngRPC \u9ed8\u8ba4\u652f\u6301\u8d85\u65f6\u9009\u9879\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u53ef\u4ee5\u643a\u5e26\u53c2\u6570 timeout \u6307\u5b9a\u6700\u957f\u54cd\u5e94\u65f6\u95f4\uff0c\u5982\u679c timeout \u65f6\u95f4\u5185\uff0c\u670d\u52a1\u5668\u8fd8\u6ca1\u6709\u8fd4\u56de\u7ed3\u679c\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u629b\u51fa\u8d85\u65f6\u5f02\u5e38\u3002\n\n```\nclient.Calc(pi_pb2.PiRequest(n=i), timeout=5)  # 5s \u8d85\u65f6\n\n```\n\n## \u62e6\u622a\u5668\n\ngRPC \u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u90fd\u63d0\u4f9b\u4e86\u62e6\u622a\u5668\u9009\u9879\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u62e6\u622a\u5668\u62e6\u622a\u8bf7\u6c42\u548c\u54cd\u5e94\u3002\u6bd4\u5982\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u62e6\u622a\u5668\u7edf\u4e00\u5728\u8bf7\u6c42\u5934\u91cc\u9762\u589e\u52a0 metadata\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u901a\u8fc7\u62e6\u622a\u5668\u6765\u8ddf\u8e2a RPC \u8c03\u7528\u6027\u80fd\u7b49\u3002\n\n## \u5206\u5e03\u5f0f gRPC \u670d\u52a1\n\ngRPC \u670d\u52a1\u5668\u867d\u7136\u6027\u80fd\u597d\uff0c\u4f46\u662f\u538b\u529b\u5927\u4e86\uff0c\u5355\u4e2a\u8fdb\u7a0b\u5355\u4e2a\u673a\u5668\u8fd8\u662f\u4e0d\u591f\uff0c\u6700\u7ec8\u662f\u5fc5\u987b\u8981\u4e0a\u5206\u5e03\u5f0f\u7684\u3002\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\u548c\u666e\u901a\u7684 RPC \u5927\u540c\u5c0f\u5f02\uff0c\u4e5f\u662f\u9700\u8981\u4e00\u4e2a\u914d\u7f6e\u6570\u636e\u5e93\u6765\u5b58\u50a8\u670d\u52a1\u5217\u8868\u4fe1\u606f\uff0c\u5e38\u7528\u7684\u8fd9\u7c7b\u6570\u636e\u5e93\u7531 zk\u3001etcd \u548c consul \u7b49\u3002\u8bfb\u8005\u53ef\u4ee5\u4f7f\u7528\u5b9e\u6218\u5c0f\u8282\u7684\u5206\u5e03\u5f0f\u65b9\u6cd5\u5305\u88c5\u4e00\u4e0b gRPC \u7684\u4ee3\u7801\uff0c\u5c31\u53ef\u4ee5\u6253\u9020\u51fa\u5206\u5e03\u5f0f gRPC \u670d\u52a1\u4e86\u3002\n\n## \u63a8\u8350\u5b66\u4e60\u8d44\u6599\n\n\u8003\u8651\u5230 gRPC \u5185\u90e8\u534f\u8bae\u975e\u5e38\u590d\u6742\uff0c\u77ed\u77ed\u4e00\u7bc7\u6587\u7ae0\u5f88\u96be\u5f7b\u5e95\u5c06 gRPC \u8bb2\u7684\u5168\u9762\uff0c\u8fd9\u91cc\u7ed9\u8bfb\u8005\u63a8\u8350\u51e0\u7bc7\u6269\u5c55\u6587\u7ae0\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u7ee7\u7eed\u6df1\u5165\u9605\u8bfb\n\n1.  [TiDB \u2014\u2014 \u6df1\u5165\u7406\u89e3 gRPC](https://user-gold-cdn.xitu.io/2018/6/5/163cd9862a1faec1)\n2.  [gRPC \u5b98\u65b9\u5168\u5957\u6587\u6863 (\u82f1\u6587\u9605\u8bfb)](https://github.com/grpc/grpc/tree/master/doc)\n3.  [HTTP2.0 \u8be6\u89e3\u2014\u2014gitbook](https://legacy.gitbook.com/book/ye11ow/http2-explained/details)\n4.  [gGRPC \u8bbe\u8ba1\u4e0e\u5b9e\u73b0](https://platformlab.stanford.edu/Seminar%20Talks/gRPC.pdf)\n5.  [HTTP2.0 Demo](http://www.http2demo.io/)\n6.  [gRPC Errors](http://avi.im/grpc-errors/)\n\n## \u5c0f\u7ed3\n\n\u672c\u8282\u6211\u4eec\u641e\u6e05\u695a\u4e86 gRPC \u7684\u539f\u7406\uff0c\u5b66\u4f1a\u4e86\u5982\u4f55\u4f7f\u7528 gRPC \u6765\u5f00\u53d1\u670d\u52a1\u3002\u4e0b\u4e00\u8282\u6211\u4eec\u770b\u770b Facebook \u5f00\u6e90\u7684 RPC \u901a\u4fe1\u6846\u67b6 Thrift\uff0c\u770b\u770b\u5b83\u548c gRPC \u6709\u591a\u5927\u533a\u522b\u3002\n\n## \u4f5c\u4e1a\n\n1.  \u4f7f\u7528 gRPC \u5b8c\u6210\u4e00\u4e2a\u7b80\u5355\u7684 Redis \u7f13\u5b58\u8bfb\u5199\u670d\u52a1\u3002\n2.  \u7ed9\u4ee5\u4e0a\u57fa\u4e8e gRPC \u7684\u670d\u52a1\u5668\u63d0\u4f9b\u5206\u5e03\u5f0f\u670d\u52a1\u53d1\u73b0\u529f\u80fd\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u62d3\u5c55_1gRPC_\u539f\u7406\u4e0e\u5b9e\u8df5.md", "create_date": "2020-02-18T21:31:51.661", "order": 18}}, {"model": "subject.chapter", "pk": 88, "fields": {"title": "\u534f\u8bae 1\uff1a\u6df1\u5165 RPC \u6d88\u606f\u534f\u8bae", "topic": 4, "md5": "fc3a6c36532ced11adb7454f0a18eef8", "md_body": "# \u534f\u8bae 1\uff1a\u6df1\u5165 RPC \u6d88\u606f\u534f\u8bae\n\n\u672c\u8282\u6211\u4eec\u5f00\u59cb\u8bb2\u89e3 RPC \u7684\u6d88\u606f\u534f\u8bae\u8bbe\u8ba1\u80cc\u540e\u7684\u57fa\u672c\u539f\u7406\uff0c\u4e86\u89e3 RPC \u7684\u534f\u8bae\u5f00\u53d1\u80cc\u540e\u6709\u54ea\u4e9b\u9700\u8981\u8003\u8651\u7684\u57fa\u672c\u70b9\u3002\u5728\u901a\u6653\u539f\u7406\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u5df1\u8bbe\u8ba1\u4e00\u5957\u534f\u8bae\u6765\u5f00\u53d1\u5c5e\u4e8e\u81ea\u5df1\u7684 RPC \u7cfb\u7edf\u3002\n\n\u672c\u8282\u4e3b\u8981\u6d89\u53ca\u7684\u77e5\u8bc6\u70b9\u548c\u5b83\u4eec\u4e4b\u89c1\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b506eba8a3aae?w=568&h=351&f=png&s=34908)\n\n\u5bf9\u4e8e\u4e00\u4e32\u6d88\u606f\u6d41\uff0c\u6211\u4eec\u5fc5\u987b\u80fd\u786e\u5b9a\u6d88\u606f\u8fb9\u754c\uff0c\u63d0\u53d6\u51fa\u5355\u6761\u6d88\u606f\u7684\u5b57\u8282\u6d41\u7247\u6bb5\uff0c\u7136\u540e\u5bf9\u8fd9\u4e2a\u7247\u6bb5\u6309\u7167\u4e00\u5b9a\u7684\u89c4\u5219\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u6765\u751f\u6210\u76f8\u5e94\u7684\u6d88\u606f\u5bf9\u8c61\u3002\n\n\u6d88\u606f\u8868\u793a\u6307\u7684\u662f\u5e8f\u5217\u5316\u540e\u7684\u6d88\u606f\u5b57\u8282\u6d41\u5728\u76f4\u89c2\u4e0a\u7684\u8868\u73b0\u5f62\u5f0f\uff0c\u5b83\u770b\u8d77\u6765\u662f\u5bf9\u4eba\u7c7b\u53cb\u597d\u8fd8\u662f\u5bf9\u8ba1\u7b97\u673a\u53cb\u597d\u3002\u6587\u672c\u5f62\u5f0f\u5bf9\u4eba\u7c7b\u53cb\u597d\uff0c\u4e8c\u8fdb\u5236\u5f62\u5f0f\u5bf9\u8ba1\u7b97\u673a\u53cb\u597d\u3002\n\n\u6bcf\u4e2a\u6d88\u606f\u90fd\u6709\u5176\u5185\u90e8\u5b57\u6bb5\u7ed3\u6784\uff0c\u7ed3\u6784\u6784\u6210\u4e86\u6d88\u606f\u5185\u90e8\u7684\u903b\u8f91\u89c4\u5219\uff0c\u7a0b\u5e8f\u8981\u6309\u7167\u7ed3\u6784\u89c4\u5219\u6765\u51b3\u5b9a\u5b57\u6bb5\u5e8f\u5217\u5316\u7684\u987a\u5e8f\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u521d\u6b65\u8be6\u7ec6\u62c6\u89e3\u3002\n\n## \u6d88\u606f\u8fb9\u754c\n\nRPC \u9700\u8981\u5728\u4e00\u6761 TCP \u94fe\u63a5\u4e0a\u8fdb\u884c\u591a\u6b21\u6d88\u606f\u4f20\u9012\u3002\u5728\u8fde\u7eed\u7684\u4e24\u6761\u6d88\u606f\u4e4b\u95f4\u5fc5\u987b\u6709\u660e\u786e\u7684\u5206\u5272\u89c4\u5219\uff0c\u4ee5\u4fbf\u63a5\u6536\u7aef\u53ef\u4ee5\u5c06\u6d88\u606f\u5206\u5272\u5f00\u6765\uff0c\u8fd9\u91cc\u7684\u63a5\u6536\u7aef\u53ef\u4ee5\u662f RPC \u670d\u52a1\u5668\u63a5\u6536\u8bf7\u6c42\uff0c\u4e5f\u53ef\u4ee5\u662f RPC \u5ba2\u6237\u7aef\u63a5\u6536\u54cd\u5e94\u3002\n\n\u57fa\u4e8e TCP \u94fe\u63a5\u4e4b\u4e0a\u7684\u5355\u6761\u6d88\u606f\u5982\u679c\u8fc7\u5927\uff0c\u5c31\u4f1a\u88ab\u7f51\u7edc\u534f\u8bae\u6808\u62c6\u5206\u4e3a\u591a\u4e2a\u6570\u636e\u5305\u8fdb\u884c\u4f20\u9001\u3002\u5982\u679c\u6d88\u606f\u8fc7\u5c0f\uff0c\u7f51\u7edc\u534f\u8bae\u6808\u53ef\u80fd\u4f1a\u5c06\u591a\u4e2a\u6d88\u606f\u7ec4\u5408\u6210\u4e00\u4e2a\u6570\u636e\u5305\u8fdb\u884c\u53d1\u9001\u3002\u5bf9\u4e8e\u63a5\u6536\u7aef\u6765\u8bf4\u5b83\u770b\u5230\u7684\u53ea\u662f\u4e00\u4e32\u4e32\u7684\u5b57\u8282\u6570\u7ec4\uff0c\u5982\u679c\u6ca1\u6709\u660e\u786e\u7684\u6d88\u606f\u8fb9\u754c\u89c4\u5219\uff0c\u63a5\u6536\u7aef\u662f\u65e0\u4ece\u77e5\u9053\u8fd9\u4e00\u4e32\u5b57\u8282\u6570\u7ec4\u7a76\u7adf\u662f\u5305\u542b\u591a\u6761\u6d88\u606f\u8fd8\u662f\u53ea\u662f\u67d0\u6761\u6d88\u606f\u7684\u4e00\u90e8\u5206\u3002\n\n\u6bd4\u8f83\u5e38\u7528\u7684\u4e24\u79cd\u5206\u5272\u65b9\u5f0f\u662f\u7279\u6b8a\u5206\u5272\u7b26\u6cd5\u548c\u957f\u5ea6\u524d\u7f00\u6cd5\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/10/16347e7b909be082?w=705&h=94&f=png&s=7417)\n\n\u6d88\u606f\u53d1\u9001\u7aef\u5728\u6bcf\u6761\u6d88\u606f\u7684\u672b\u5c3e\u8ffd\u52a0\u4e00\u4e2a\u7279\u6b8a\u7684\u5206\u5272\u7b26\uff0c\u5e76\u4e14\u4fdd\u8bc1\u6d88\u606f\u4e2d\u95f4\u7684\u6570\u636e\u4e0d\u80fd\u5305\u542b\u7279\u6b8a\u5206\u5272\u7b26\u3002\u6bd4\u5982\u6700\u4e3a\u5e38\u89c1\u7684\u5206\u5272\u7b26\u662f`\\r\\n`\u3002\u5f53\u63a5\u6536\u7aef\u904d\u5386\u5b57\u8282\u6570\u7ec4\u65f6\u53d1\u73b0\u4e86`\\r\\n`\uff0c\u5c31\u7acb\u5373\u53ef\u4ee5\u65ad\u5b9a`\\r\\n` \u4e4b\u524d\u7684\u5b57\u8282\u6570\u7ec4\u662f\u4e00\u6761\u5b8c\u6574\u7684\u6d88\u606f\uff0c\u53ef\u4ee5\u4f20\u9012\u5230\u4e0a\u5c42\u903b\u8f91\u7ee7\u7eed\u8fdb\u884c\u5904\u7406\u3002HTTP \u548c Redis \u534f\u8bae\u5c31\u5927\u91cf\u4f7f\u7528\u4e86`\\r\\n` \u5206\u5272\u7b26\u3002\u6b64\u79cd\u6d88\u606f\u4e00\u822c\u8981\u6c42\u6d88\u606f\u4f53\u7684\u5185\u5bb9\u662f\u6587\u672c\u6d88\u606f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/10/16347e89710eb4da?w=689&h=81&f=png&s=7313)\n\n\u6d88\u606f\u53d1\u9001\u7aef\u5728\u6bcf\u6761\u6d88\u606f\u7684\u5f00\u5934\u589e\u52a0\u4e00\u4e2a 4 \u5b57\u8282\u957f\u5ea6\u7684\u6574\u6570\u503c\uff0c\u6807\u8bb0\u6d88\u606f\u4f53\u7684\u957f\u5ea6\u3002\u8fd9\u6837\u6d88\u606f\u63a5\u53d7\u8005\u9996\u5148\u8bfb\u53d6\u5230\u957f\u5ea6\u4fe1\u606f\uff0c\u7136\u540e\u518d\u8bfb\u53d6\u76f8\u5e94\u957f\u5ea6\u7684\u5b57\u8282\u6570\u7ec4\u5c31\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5b8c\u6574\u7684\u6d88\u606f\u5206\u79bb\u51fa\u6765\u3002\u6b64\u79cd\u6d88\u606f\u6bd4\u8f83\u5e38\u7528\u4e8e\u4e8c\u8fdb\u5236\u6d88\u606f\u3002\n\n\u57fa\u4e8e\u7279\u6b8a\u5206\u5272\u7b26\u6cd5\u7684\u4f18\u70b9\u5728\u4e8e\u6d88\u606f\u7684\u53ef\u8bfb\u6027\u6bd4\u8f83\u5f3a\uff0c\u53ef\u4ee5\u76f4\u63a5\u770b\u5230\u6d88\u606f\u7684\u6587\u672c\u5185\u5bb9\uff0c\u7f3a\u70b9\u662f\u4e0d\u9002\u5408\u4f20\u9012\u4e8c\u8fdb\u5236\u6d88\u606f\uff0c\u56e0\u4e3a\u4e8c\u8fdb\u5236\u7684\u5b57\u8282\u6570\u7ec4\u91cc\u9762\u5f88\u5bb9\u6613\u5c31\u5192\u51fa\u8fde\u7eed\u7684\u4e24\u4e2a\u5b57\u8282\u5185\u5bb9\u6b63\u597d\u5c31\u662f`\\r\\n` \u5206\u5272\u7b26\u7684 ascii \u503c\u3002\u5982\u679c\u9700\u8981\u4f20\u9012\u7684\u8bdd\uff0c\u4e00\u822c\u662f\u5bf9\u4e8c\u8fdb\u5236\u8fdb\u884c base64 \u7f16\u7801\u8f6c\u53d8\u6210\u666e\u901a\u6587\u672c\u6d88\u606f\u518d\u8fdb\u884c\u4f20\u9001\u3002\n\n\u57fa\u4e8e\u957f\u5ea6\u524d\u7f00\u6cd5\u7684\u4f18\u70b9\u548c\u7f3a\u70b9\u540c\u7279\u6b8a\u5206\u5272\u7b26\u6cd5\u6b63\u597d\u662f\u76f8\u53cd\u7684\u3002\u957f\u5ea6\u524d\u7f00\u6cd5\u56e0\u4e3a\u9002\u7528\u4e8e\u4e8c\u8fdb\u5236\u534f\u8bae\uff0c\u6240\u4ee5\u53ef\u8bfb\u6027\u5f88\u5dee\u3002\u4f46\u662f\u5bf9\u4f20\u9012\u7684\u5185\u5bb9\u672c\u8eab\u6ca1\u6709\u7279\u6b8a\u9650\u5236\uff0c\u6587\u672c\u548c\u5185\u5bb9\u7686\u53ef\u4ee5\u4f20\u8f93\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u7279\u6b8a\u5904\u7406\u3002HTTP \u534f\u8bae\u7684 Content-Length \u5934\u4fe1\u606f\u7528\u6765\u6807\u8bb0\u6d88\u606f\u4f53\u7684\u957f\u5ea6\uff0c\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u770b\u6210\u662f\u957f\u5ea6\u524d\u7f00\u6cd5\u7684\u4e00\u79cd\u5e94\u7528\u3002\n\n```\nHTTP/1.0 200 OK\nServer: SimpleHTTP/0.6 Python/2.7.13\nDate: Thu, 10 May 2018 02:38:03 GMT\nContent-type: text/html; charset=utf-8\nContent-Length: 10393\n# \u6b64\u5904\u7701\u7565 10393 \u5b57\u8282\u6d88\u606f\u4f53\u6570\u636e\n\n```\n\nHTTP \u534f\u8bae\u662f\u4e00\u79cd\u57fa\u4e8e\u7279\u6b8a\u5206\u5272\u7b26\u548c\u957f\u5ea6\u524d\u7f00\u6cd5\u7684\u6df7\u5408\u578b\u534f\u8bae\u3002\u6bd4\u5982 HTTP \u7684\u6d88\u606f\u5934\u91c7\u7528\u7684\u662f\u7eaf\u6587\u672c\u5916\u52a0`\\r\\n` \u5206\u5272\u7b26\uff0c\u800c\u6d88\u606f\u4f53\u5219\u662f\u901a\u8fc7\u6d88\u606f\u5934\u4e2d\u7684 Content-Type \u7684\u503c\u6765\u51b3\u5b9a\u957f\u5ea6\u3002HTTP \u534f\u8bae\u867d\u7136\u88ab\u79f0\u4e4b\u4e3a\u6587\u672c\u4f20\u8f93\u534f\u8bae\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u5728\u6d88\u606f\u4f53\u4e2d\u4f20\u8f93\u4e8c\u8fdb\u5236\u6570\u636e\u6570\u636e\u7684\uff0c\u4f8b\u5982\u97f3\u89c6\u9891\u56fe\u50cf\uff0c\u6240\u4ee5 HTTP \u534f\u8bae\u88ab\u79f0\u4e4b\u4e3a\u300c\u8d85\u6587\u672c\u300d\u4f20\u8f93\u534f\u8bae\u3002\n\n## \u6d88\u606f\u7684\u7ed3\u6784\n\n\u6bcf\u6761\u6d88\u606f\u90fd\u6709\u5b83\u5305\u542b\u7684\u8bed\u4e49\u7ed3\u6784\u4fe1\u606f\uff0c\u6709\u4e9b\u6d88\u606f\u534f\u8bae\u7684\u7ed3\u6784\u4fe1\u606f\u662f\u663e\u5f0f\u7684\uff0c\u8fd8\u6709\u4e9b\u662f\u9690\u5f0f\u7684\u3002\u6bd4\u5982 json \u6d88\u606f\uff0c\u5b83\u7684\u7ed3\u6784\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5b83\u7684\u5185\u5bb9\u4f53\u73b0\u51fa\u6765\uff0c\u6240\u4ee5\u5b83\u662f\u4e00\u79cd\u663e\u5f0f\u7ed3\u6784\u7684\u6d88\u606f\u534f\u8bae\u3002\n\n```\n{\n     \"firstName\": \"John\",\n     \"lastName\": \"Smith\",\n     \"gender\": \"male\",\n     \"age\": 25,\n     \"address\": \n     {\n         \"streetAddress\": \"21 2nd Street\",\n         \"city\": \"New York\",\n         \"state\": \"NY\",\n         \"postalCode\": \"10021\"\n     },\n     \"phoneNumber\": \n     [\n         {\n           \"type\": \"home\",\n           \"number\": \"212 555-1234\"\n         },\n         {\n           \"type\": \"fax\",\n           \"number\": \"646 555-4567\"\n         }\n     ]\n }\n\n```\n\njson \u8fd9\u79cd\u76f4\u89c2\u7684\u6d88\u606f\u534f\u8bae\u7684\u53ef\u8bfb\u6027\u975e\u5e38\u68d2\uff0c\u4f46\u662f\u5b83\u7684\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u6709\u592a\u591a\u7684\u5197\u4f59\u4fe1\u606f\u3002\u6bd4\u5982\u6bcf\u4e2a\u5b57\u7b26\u4e32\u90fd\u4f7f\u7528\u53cc\u5f15\u53f7\u6765\u754c\u5b9a\u8fb9\u754c\uff0ckey/value \u4e4b\u95f4\u5fc5\u987b\u6709\u5192\u53f7\u5206\u5272\uff0c\u5bf9\u8c61\u4e4b\u95f4\u5fc5\u987b\u4f7f\u7528\u5927\u62ec\u53f7\u5206\u5272\u7b49\u7b49\u3002\u8fd9\u4e9b\u8fd8\u53ea\u662f\u5197\u4f59\u7684\u5c0f\u5934\uff0c\u6700\u5927\u7684\u5197\u4f59\u8fd8\u5728\u4e8e\u8fde\u7eed\u7684\u591a\u6761 json \u6d88\u606f\u5373\u4f7f\u7ed3\u6784\u5b8c\u5168\u4e00\u6837\uff0c\u4ec5\u4ec5\u53ea\u662f value \u7684\u503c\u4e0d\u4e00\u6837\uff0c\u4e5f\u9700\u8981\u53d1\u9001\u540c\u6837\u7684 key \u5b57\u7b26\u4e32\u4fe1\u606f\u3002\n\n\u6d88\u606f\u7684\u7ed3\u6784\u5728\u540c\u4e00\u6761\u6d88\u606f\u901a\u9053\u4e0a\u662f\u53ef\u4ee5\u590d\u7528\u7684\uff0c\u6bd4\u5982\u5728\u5efa\u7acb\u94fe\u63a5\u7684\u5f00\u59cb RPC \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u5148\u4ea4\u6d41\u534f\u5546\u4e00\u4e0b\u6d88\u606f\u7684\u7ed3\u6784\uff0c\u540e\u7eed\u53d1\u9001\u6d88\u606f\u65f6\u53ea\u9700\u8981\u53d1\u9001\u4e00\u7cfb\u5217\u6d88\u606f\u7684 value \u503c\uff0c\u63a5\u6536\u7aef\u4f1a\u81ea\u52a8\u5c06 value \u503c\u548c\u76f8\u5e94\u4f4d\u7f6e\u7684 key \u5173\u8054\u8d77\u6765\uff0c\u5f62\u6210\u4e00\u4e2a\u5b8c\u6210\u7684\u7ed3\u6784\u6d88\u606f\u3002\u5728 Hadoop \u7cfb\u7edf\u4e2d\u5e7f\u6cdb\u4f7f\u7528\u7684 avro \u6d88\u606f\u534f\u8bae\u5c31\u662f\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0\u7684\uff0c\u5728 RPC \u94fe\u63a5\u5efa\u7acb\u4e4b\u5904\u5c31\u5f00\u59cb\u4ea4\u6d41\u6d88\u606f\u7684\u7ed3\u6784\uff0c\u540e\u7eed\u6d88\u606f\u7684\u4f20\u9012\u5c31\u53ef\u4ee5\u8282\u7701\u5f88\u591a\u6d41\u91cf\u3002\n\n\u6d88\u606f\u7684\u9690\u5f0f\u7ed3\u6784\u4e00\u822c\u662f\u6307\u90a3\u4e9b\u7ed3\u6784\u4fe1\u606f\u7531\u4ee3\u7801\u6765\u7ea6\u5b9a\u7684\u6d88\u606f\u534f\u8bae\uff0c\u5728 RPC \u4ea4\u4e92\u7684\u6d88\u606f\u6570\u636e\u4e2d\u53ea\u662f\u7eaf\u7cb9\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u7531\u4ee3\u7801\u6765\u786e\u5b9a\u76f8\u5e94\u4f4d\u7f6e\u7684\u4e8c\u8fdb\u5236\u662f\u5c5e\u4e8e\u54ea\u4e2a\u5b57\u6bb5\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u8fd9\u6bb5\u4ee3\u7801\n\n```\n// \u53d1\u9001\u7aef\u5199\u6d88\u606f\nclass AuthUserOutput {\n\tint platformId;\n\tlong deviceId;\n\tString productId;\n\tString channelId;\n\tString versionId;\n\tString phoneModel;\n\t\n\t@Override\n\tpublic void writeImpl() {\n\t\twriteByte((byte) this.platformId);\n\t\twriteLong(deviceId);\n\t\twriteStr(productId);\n\t\twriteStr(channelId);\n\t\twriteStr(versionId);\n\t\twriteStr(phoneModel);\n\t}\n}\n\n// \u63a5\u6536\u7aef\u8bfb\u53d6\u6d88\u606f\nclass AuthorizeInput {\n\tint platformId;\n\tlong deviceId;\n\tString productId;\n\tString channelId;\n\tString versionId;\n\tString phoneModel;\n\t\n\t@Override\n\tpublic void readImpl() {\n\t\tthis.platformId = readByte();\n\t\tthis.deviceId = readLong();\n\t\tthis.productId = readStr();\n\t\tthis.channelId = readStr();\n\t\tthis.versionId = readStr();\n\t\tthis.phoneModel = readStr();\n\t}\n}\n\n```\n\n\u5982\u679c\u7eaf\u7cb9\u770b\u6d88\u606f\u5185\u5bb9\u662f\u65e0\u6cd5\u77e5\u9053\u8282\u70b9\u6d88\u606f\u5185\u5bb9\u4e2d\u7684\u54ea\u4e9b\u5b57\u8282\u7684\u542b\u4e49\uff0c\u5b83\u7684\u6d88\u606f\u7ed3\u6784\u662f\u901a\u8fc7\u4ee3\u7801\u7684\u7ed3\u6784\u987a\u5e8f\u6765\u786e\u5b9a\u7684\u3002\u8fd9\u79cd\u9690\u5f0f\u7684\u6d88\u606f\u7684\u4f18\u70b9\u5c31\u5728\u4e8e\u8282\u7701\u4f20\u8f93\u6d41\u91cf\uff0c\u5b83\u5b8c\u5168\u4e0d\u9700\u8981\u4f20\u8f93\u7ed3\u6784\u4fe1\u606f\u3002\n\n## \u6d88\u606f\u538b\u7f29\n\n\u5982\u679c\u6d88\u606f\u7684\u5185\u5bb9\u592a\u5927\uff0c\u5c31\u8981\u8003\u8651\u5bf9\u6d88\u606f\u8fdb\u884c\u538b\u7f29\u5904\u7406\uff0c\u8fd9\u53ef\u4ee5\u51cf\u8f7b\u7f51\u7edc\u5e26\u5bbd\u538b\u529b\u3002\u4f46\u662f\u8fd9\u540c\u65f6\u4e5f\u4f1a\u52a0\u91cd CPU \u7684\u8d1f\u62c5\uff0c\u56e0\u4e3a\u538b\u7f29\u7b97\u6cd5\u662f CPU \u8ba1\u7b97\u5bc6\u96c6\u578b\u64cd\u4f5c\uff0c\u4f1a\u5bfc\u81f4\u64cd\u4f5c\u7cfb\u7edf\u7684\u8d1f\u8f7d\u52a0\u91cd\u3002\u6240\u4ee5\uff0c\u6700\u7ec8\u662f\u5426\u8fdb\u884c\u6d88\u606f\u538b\u7f29\uff0c\u4e00\u5b9a\u8981\u6839\u636e\u4e1a\u52a1\u60c5\u51b5\u52a0\u4ee5\u6743\u8861\u3002\n\n\u5982\u679c\u786e\u5b9a\u538b\u7f29\uff0c\u90a3\u4e48\u5728\u9009\u62e9\u538b\u7f29\u7b97\u6cd5\u5305\u65f6\uff0c\u52a1\u5fc5\u6311\u9009\u90a3\u4e9b\u5e95\u5c42\u7528 C \u8bed\u8a00\u5b9e\u73b0\u7684\u7b97\u6cd5\u5e93\uff0c\u56e0\u4e3a Python \u7684\u5b57\u8282\u7801\u6267\u884c\u8d77\u6765\u592a\u6162\u4e86\u3002\u6bd4\u8f83\u6d41\u884c\u7684\u6d88\u606f\u538b\u7f29\u7b97\u6cd5\u6709 Google \u7684 snappy \u7b97\u6cd5\uff0c\u5b83\u7684\u8fd0\u884c\u6027\u80fd\u975e\u5e38\u597d\uff0c\u538b\u7f29\u6bd4\u4f8b\u867d\u7136\u4e0d\u662f\u6700\u4f18\u7684\uff0c\u4f46\u662f\u79bb\u6700\u4f18\u7684\u5dee\u8ddd\u5df2\u7ecf\u4e0d\u662f\u5f88\u5927\u3002\u963f\u91cc\u7684 SOFA RPC \u5c31\u4f7f\u7528\u4e86 snappy \u4f5c\u4e3a\u534f\u8bae\u5c42\u538b\u7f29\u7b97\u6cd5\u3002\n\n## \u6d41\u91cf\u7684\u6781\u81f4\u4f18\u5316\n\n\u5f00\u6e90\u7684\u6d41\u884c RPC \u6d88\u606f\u534f\u8bae\u5f80\u5f80\u5bf9\u6d88\u606f\u6d41\u91cf\u4f18\u5316\u5230\u4e86\u6781\u81f4\uff0c\u5b83\u4eec\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u6253\u52a8\u7528\u6237\uff0c\u5438\u5f15\u7528\u6237\u6765\u4f7f\u7528\u5b83\u4eec\u3002\u6bd4\u5982\u5bf9\u4e8e\u4e00\u4e2a\u6574\u5f62\u6570\u5b57\uff0c\u4e00\u822c\u4f7f\u7528 4 \u4e2a\u5b57\u8282\u6765\u8868\u793a\u4e00\u4e2a\u6574\u6570\u503c\u3002\n\n\u4f46\u662f\u7ecf\u8fc7\u7814\u7a76\u53d1\u73b0\uff0c\u6d88\u606f\u4f20\u9012\u4e2d\u5927\u90e8\u5206\u4f7f\u7528\u7684\u6574\u6570\u503c\u90fd\u662f\u5f88\u5c0f\u7684\u975e\u8d1f\u6574\u6570\uff0c\u5982\u679c\u5168\u90e8\u4f7f\u7528 4 \u4e2a\u5b57\u8282\u6765\u8868\u793a\u4e00\u4e2a\u6574\u6570\u4f1a\u5f88\u6d6a\u8d39\u3002\u6240\u4ee5\u5c31\u53d1\u660e\u4e86\u4e00\u4e2a\u7c7b\u578b\u53eb\u53d8\u957f\u6574\u6570varint\u3002\u6570\u503c\u975e\u5e38\u5c0f\u65f6\uff0c\u53ea\u9700\u8981\u4f7f\u7528\u4e00\u4e2a\u5b57\u8282\u6765\u5b58\u50a8\uff0c\u6570\u503c\u7a0d\u5fae\u5927\u4e00\u70b9\u53ef\u4ee5\u4f7f\u7528 2 \u4e2a\u5b57\u8282\uff0c\u518d\u5927\u4e00\u70b9\u5c31\u662f 3 \u4e2a\u5b57\u8282\uff0c\u5b83\u8fd8\u53ef\u4ee5\u8d85\u8fc7 4 \u4e2a\u5b57\u8282\u7528\u6765\u8868\u8fbe\u957f\u6574\u5f62\u6570\u5b57\u3002\n\n\u5176\u539f\u7406\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4fdd\u7559\u6bcf\u4e2a\u5b57\u8282\u7684\u6700\u9ad8\u4f4d\u7684 bit \u6765\u6807\u8bc6\u662f\u5426\u540e\u9762\u8fd8\u6709\u5b57\u8282\uff0c1 \u8868\u793a\u8fd8\u6709\u5b57\u8282\u9700\u8981\u7ee7\u7eed\u8bfb\uff0c0 \u8868\u793a\u5230\u8bfb\u5230\u5f53\u524d\u5b57\u8282\u5c31\u7ed3\u675f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/10/163483000fcef1a5?w=802&h=265&f=png&s=19301)\n\n\u90a3\u5982\u679c\u662f\u8d1f\u6570\u8be5\u600e\u4e48\u529e\u5462\uff1f-1 \u7684 16 \u8fdb\u5236\u6570\u662f 0xFFFFFFFF\uff0c\u5982\u679c\u8981\u6309\u7167\u8fd9\u4e2a\u7f16\u7801\u90a3\u5c82\u4e0d\u662f\u8981 6 \u4e2a\u5b57\u8282\u624d\u80fd\u5b58\u7684\u4e0b\u3002-1 \u4e5f\u662f\u975e\u5e38\u5e38\u89c1\u7684\u6574\u6570\u554a\u3002\n\n\u4e8e\u662f zigzag \u7f16\u7801\u6765\u4e86\uff0c\u4e13\u95e8\u7528\u6765\u89e3\u51b3\u8d1f\u6570\u95ee\u9898\u3002zigzag \u7f16\u7801\u5c06\u6574\u6570\u8303\u56f4\u4e00\u4e00\u6620\u5c04\u5230\u81ea\u7136\u6570\u8303\u56f4\uff0c\u7136\u540e\u518d\u8fdb\u884c varint \u7f16\u7801\u3002\n\n```\n0 => 0\n-1 => 1\n1 => 2\n-2 => 3\n2 => 4\n-3 => 5\n3 => 6\n\n```\n\nzigzag \u5c06\u8d1f\u6570\u7f16\u7801\u6210\u6b63\u5947\u6570\uff0c\u6b63\u6570\u7f16\u7801\u6210\u5076\u6570\u3002\u89e3\u7801\u7684\u65f6\u5019\u9047\u5230\u5076\u6570\u76f4\u63a5\u9664 2 \u5c31\u662f\u539f\u503c\uff0c\u9047\u5230\u5947\u6570\u5c31\u52a0 1 \u9664 2 \u518d\u53d6\u8d1f\u5c31\u662f\u539f\u503c\u3002\n\n## \u5c0f\u7ed3\n\n\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e86 RPC \u6d88\u606f\u7ed3\u6784\u7684\u8bbe\u8ba1\u539f\u7406\uff0c\u9075\u5faa\u8fd9\u4e9b\u57fa\u672c\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u521b\u9020\u51fa\u4e00\u4e2a\u53c8\u4e00\u4e2a\u4e0d\u540c\u7684\u6d88\u606f\u534f\u8bae\u3002\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u8bb2\u4e00\u4e2a\u5177\u4f53\u7684\u5b9e\u4f8b\uff0c\u62ff\u5e02\u573a\u4e0a\u5e94\u7528\u6700\u5e7f\u7684\u5f00\u6e90\u5b58\u50a8\u4e2d\u95f4\u4ef6 Redis \u7684\u6d88\u606f\u534f\u8bae\u4e3a\u4f8b\u8fdb\u884c\u8be6\u7ec6\u5206\u6790\u3002\n\n## \u7ec3\u4e60\u9898\n\n\u8bf7\u8bfb\u8005\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e0b varint \u548c zigzag \u7f16\u7801\u8f6c\u6362\u5668\uff0c\u4e0d\u8981\u6c42\u8bfb\u8005\u5b9e\u73b0\u7684\u7279\u522b\u9ad8\u6548\uff0c\u4f46\u5e94\u5f53\u5b9e\u73b0\u57fa\u672c\u7684\u8f93\u5165\u8f93\u51fa\u3002\n\n\u53e6\uff0c\u8fd9\u4e2a\u4f5c\u4e1a\u7684\u4ee3\u7801\u5b9e\u73b0\u4f1a\u6d89\u53ca\u5230\u4e0d\u5c11 Python \u7684\u4f4d\u64cd\u4f5c\u77e5\u8bc6\uff0c\u53ef\u4ee5\u6e29\u6545\u800c\u77e5\u65b0\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u534f\u8bae_1\u6df1\u5165_RPC_\u6d88\u606f\u534f\u8bae.md", "create_date": "2020-02-18T21:31:51.672", "order": 3}}, {"model": "subject.chapter", "pk": 89, "fields": {"title": "\u5f00\u7bc7\uff1aRPC \u8981\u89e3\u51b3\u7684\u6838\u5fc3\u95ee\u9898\u548c\u5728\u4f01\u4e1a\u670d\u52a1\u4e2d\u7684\u5730\u4f4d", "topic": 4, "md5": "80d939791de45a76e6ddfe383705d7b7", "md_body": "# \u5f00\u7bc7\uff1aRPC \u8981\u89e3\u51b3\u7684\u6838\u5fc3\u95ee\u9898\u548c\u5728\u4f01\u4e1a\u670d\u52a1\u4e2d\u7684\u5730\u4f4d\n\n\u968f\u7740\u4f01\u4e1a IT \u670d\u52a1\u7684\u4e0d\u65ad\u53d1\u5c55\uff0c\u5355\u53f0\u670d\u52a1\u5668\u9010\u6e10\u65e0\u6cd5\u627f\u53d7\u7528\u6237\u65e5\u76ca\u589e\u957f\u7684\u8bf7\u6c42\u538b\u529b\u65f6\uff0c\u5c31\u9700\u8981\u591a\u53f0\u670d\u52a1\u5668\u8054\u5408\u8d77\u6765\u6784\u6210\u300c\u670d\u52a1\u96c6\u7fa4\u300d\u5171\u540c\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u540c\u65f6\u4e1a\u52a1\u670d\u52a1\u4f1a\u968f\u7740\u4ea7\u54c1\u9700\u6c42\u7684\u589e\u591a\u8d8a\u6765\u8d8a\u80bf\uff0c\u67b6\u6784\u4e0a\u5fc5\u987b\u8fdb\u884c\u670d\u52a1\u62c6\u5206\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u5927\u578b\u670d\u52a1\u4f1a\u88ab\u6253\u6563\u6210\u5f88\u591a\u5f88\u591a\u72ec\u7acb\u7684\u5c0f\u670d\u52a1\uff0c\u6bcf\u4e2a\u5c0f\u670d\u52a1\u4f1a\u7531\u72ec\u7acb\u7684\u8fdb\u7a0b\u53bb\u7ba1\u7406\u6765\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u5c31\u662f\u300c\u5fae\u670d\u52a1\u300d\u3002\n\n\u5f53\u7528\u6237\u7684\u8bf7\u6c42\u5230\u6765\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u5206\u6563\u5230\u591a\u4e2a\u670d\u52a1\u53bb\u5404\u81ea\u5904\u7406\uff0c\u7136\u540e\u53c8\u9700\u8981\u5c06\u8fd9\u4e9b\u5b50\u670d\u52a1\u7684\u7ed3\u679c\u6c47\u603b\u8d77\u6765\u5448\u73b0\u7ed9\u7528\u6237\u3002\u90a3\u4e48\u670d\u52a1\u4e4b\u95f4\u8be5\u4f7f\u7528\u4f55\u79cd\u65b9\u5f0f\u8fdb\u884c\u4ea4\u4e92\u5c31\u662f\u9700\u8981\u89e3\u51b3\u7684\u6838\u5fc3\u95ee\u9898\u3002RPC \u5c31\u662f\u4e3a\u89e3\u51b3\u670d\u52a1\u4e4b\u95f4\u4fe1\u606f\u4ea4\u4e92\u800c\u53d1\u660e\u548c\u5b58\u5728\u7684\u3002\n\n## \u4ec0\u4e48\u662f RPC \uff1f\n\nRPC (Remote Procedure Call)\u5373\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff0c\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u5e38\u89c1\u7684\u4e00\u79cd\u901a\u4fe1\u65b9\u6cd5\uff0c\u5df2\u7ecf\u6709 40 \u591a\u5e74\u5386\u53f2\u3002\u5f53\u4e24\u4e2a\u7269\u7406\u5206\u79bb\u7684\u5b50\u7cfb\u7edf\u9700\u8981\u5efa\u7acb\u903b\u8f91\u4e0a\u7684\u5173\u8054\u65f6\uff0cRPC \u662f\u7275\u7ebf\u642d\u6865\u7684\u5e38\u89c1\u6280\u672f\u624b\u6bb5\u4e4b\u4e00\u3002\u9664 RPC \u4e4b\u5916\uff0c\u5e38\u89c1\u7684\u591a\u7cfb\u7edf\u6570\u636e\u4ea4\u4e92\u65b9\u6848\u8fd8\u6709\u5206\u5e03\u5f0f\u6d88\u606f\u961f\u5217\u3001HTTP \u8bf7\u6c42\u8c03\u7528\u3001\u6570\u636e\u5e93\u548c\u5206\u5e03\u5f0f\u7f13\u5b58\u7b49\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b41bfc788058b?w=936&h=377&f=png&s=35725)\n\n\u5176\u4e2d RPC \u548c HTTP \u8c03\u7528\u662f\u6ca1\u6709\u7ecf\u8fc7\u4e2d\u95f4\u4ef6\u7684\uff0c\u5b83\u4eec\u662f\u7aef\u5230\u7aef\u7cfb\u7edf\u7684\u76f4\u63a5\u6570\u636e\u4ea4\u4e92\u3002HTTP \u8c03\u7528\u5176\u5b9e\u4e5f\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u79cd\u7279\u6b8a\u7684 RPC\uff0c\u53ea\u4e0d\u8fc7\u4f20\u7edf\u610f\u4e49\u4e0a\u7684 RPC \u662f\u6307\u957f\u8fde\u63a5\u6570\u636e\u4ea4\u4e92\uff0c\u800c HTTP \u4e00\u822c\u662f\u6307\u5373\u7528\u5373\u8d70\u7684\u77ed\u94fe\u63a5\u3002\n\nRPC \u5728\u6211\u4eec\u719f\u77e5\u7684\u5404\u79cd\u4e2d\u95f4\u4ef6\u4e2d\u90fd\u6709\u5b83\u7684\u8eab\u5f71\u3002Nginx/Redis/MySQL/Dubbo/Hadoop/Spark/Tensorflow \u7b49\u91cd\u91cf\u7ea7\u5f00\u6e90\u4ea7\u54c1\u90fd\u662f\u5728 RPC \u6280\u672f\u7684\u57fa\u7840\u4e0a\u6784\u5efa\u51fa\u6765\u7684\uff0c\u6211\u4eec\u8fd9\u91cc\u8bf4\u7684 RPC \u6307\u7684\u662f\u5e7f\u4e49\u7684 RPC\uff0c\u4e5f\u5c31\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u901a\u4fe1\u6280\u672f\u3002RPC \u5728\u6280\u672f\u4e2d\u7684\u5730\u4f4d\u597d\u6bd4\u6211\u4eec\u8eab\u8fb9\u7684\u7a7a\u6c14\uff0c\u5b83\u65e0\u5904\u4e0d\u5728\uff0c\u4f46\u662f\u53c8\u6709\u5f88\u591a\u4eba\u6839\u672c\u4e0d\u77e5\u9053\u5b83\u7684\u5b58\u5728\u3002\n\n## Nginx \u4e0e RPC\n\nNgnix \u662f\u4e92\u8054\u7f51\u4f01\u4e1a\u4f7f\u7528\u6700\u4e3a\u5e7f\u6cdb\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002\u5b83\u53ef\u4ee5\u4e3a\u540e\u7aef\u5206\u5e03\u5f0f\u670d\u52a1\u63d0\u4f9b\u8d1f\u8f7d\u5747\u8861\u7684\u529f\u80fd\uff0c\u5b83\u53ef\u4ee5\u5c06\u540e\u7aef\u591a\u4e2a\u670d\u52a1\u5730\u5740\u805a\u5408\u4e3a\u5355\u4e2a\u5730\u5740\u6765\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u5982\u56fe\uff0cDjango \u662f Python \u6280\u672f\u6808\u6700\u6d41\u884c\u7684 Web \u6846\u67b6\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b41f9801d8800?w=500&h=259&f=png&s=18146)\n\nNginx \u548c\u540e\u7aef\u670d\u52a1\u4e4b\u95f4\u7684\u4ea4\u4e92\u5728\u672c\u8d28\u4e0a\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a RPC \u6570\u636e\u4ea4\u4e92\u3002\u4e5f\u8bb8\u4f60\u4f1a\u4e89\u8fa9\u8bf4 Nginx \u548c\u540e\u7aef\u670d\u52a1\u4e4b\u95f4\u4f7f\u7528\u7684\u662f HTTP \u534f\u8bae\uff0c\u8d70\u7684\u662f\u77ed\u8fde\u63a5\uff0c\u4e25\u683c\u4e0a\u4e0d\u80fd\u7b97\u662f RPC \u8c03\u7528\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/13/163f70a2491c77de?w=663&h=268&f=png&s=22101)\n\n\u4f60\u8bf4\u7684\u6ca1\u9519\uff0c\u4e0d\u8fc7 Nginx \u548c\u540e\u7aef\u670d\u52a1\u4e4b\u95f4\u8fd8\u53ef\u4ee5\u8d70\u5176\u5b83\u7684\u534f\u8bae\uff0c\u6bd4\u5982 uwsgi \u534f\u8bae\u3001fastcgi \u534f\u8bae\u7b49\uff0c\u8fd9\u4e24\u4e2a\u534f\u8bae\u90fd\u662f\u91c7\u7528\u4e86\u6bd4 HTTP \u534f\u8bae\u66f4\u52a0\u8282\u7701\u6d41\u91cf\u7684\u4e8c\u8fdb\u5236\u534f\u8bae\u3002\u5982\u4e0a\u56fe\u6240\u793a\uff0cuWSGI \u662f\u8457\u540d\u7684 Python \u5bb9\u5668\uff0c\u4f7f\u7528\u5b83\u53ef\u4ee5\u542f\u52a8 uwsgi \u534f\u8bae\u7684\u670d\u52a1\u5668\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\n\nuwsgi \u901a\u8baf\u534f\u8bae\u5728 Python \u8bed\u8a00\u4f53\u7cfb\u91cc\u4f7f\u7528\u975e\u5e38\u666e\u904d\uff0c\u5982\u679c\u4e00\u4e2a\u4f01\u4e1a\u5185\u90e8\u4f7f\u7528 Python \u8bed\u8a00\u6808\u642d\u5efa Web \u670d\u52a1\uff0c\u90a3\u4e48\u4ed6\u4eec\u5728\u751f\u4ea7\u73af\u5883\u90e8\u7f72 Python \u5e94\u7528\u7684\u65f6\u5019\u4e0d\u662f\u5728\u4f7f\u7528 HTTP \u534f\u8bae\u5c31\u662f\u5728\u4f7f\u7528 uwsgi \u534f\u8bae\u6765\u548c Nginx \u4e4b\u95f4\u5efa\u7acb\u901a\u8baf\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b421f022ecc8c?w=536&h=269&f=png&s=18803)\n\nFastcgi \u534f\u8bae\u5728 PHP \u8bed\u8a00\u4f53\u7cfb\u91cc\u975e\u5e38\u5e38\u89c1\uff0cNginx \u548c PHP-fpm \u8fdb\u7a0b\u4e4b\u95f4\u4e00\u822c\u8f83\u5e38\u4f7f\u7528 Fastcgi \u534f\u8bae\u8fdb\u884c\u901a\u8baf\u3002\n\n## Hadoop \u4e0e RPC\n\n\u5728\u5927\u6570\u636e\u6280\u672f\u9886\u57df\uff0cRPC \u4e5f\u5360\u636e\u4e86\u975e\u5e38\u91cd\u8981\u7684\u5730\u4f4d\u3002\u5927\u6570\u636e\u9886\u57df\u5e7f\u6cdb\u5e94\u7528\u4e86\u975e\u5e38\u591a\u7684\u5206\u5e03\u5f0f\u6280\u672f\uff0c\u5206\u5e03\u5f0f\u610f\u5473\u7740\u8282\u70b9\u7684\u7269\u7406\u9694\u79bb\uff0c\u9694\u79bb\u610f\u5473\u7740\u9700\u8981\u901a\u4fe1\uff0c\u901a\u4fe1\u610f\u5473\u7740 RPC \u7684\u5b58\u5728\u3002\u5927\u6570\u636e\u9700\u8981\u901a\u4fe1\u7684\u91cf\u6bd4\u4e1a\u52a1\u7cfb\u7edf\u66f4\u52a0\u5e9e\u5927\uff0c\u6240\u4ee5\u5728\u6570\u636e\u901a\u4fe1\u4f18\u5316\u4e0a\u505a\u7684\u66f4\u6df1\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b45dc4e72d505?w=592&h=255&f=png&s=19280)\n\n\u6bd4\u5982\u6700\u5e38\u89c1\u7684 Hadoop \u6587\u4ef6\u7cfb\u7edf hdfs\uff0c\u4e00\u822c\u5305\u62ec\u4e00\u4e2a NameNode \u548c\u591a\u4e2a DataNode\uff0cNameNode \u548c DataNode \u4e4b\u95f4\u5c31\u662f\u901a\u8fc7\u4e00\u79cd\u79f0\u4e3a Hadoop RPC \u7684\u4e8c\u8fdb\u5236\u534f\u8bae\u8fdb\u884c\u901a\u8baf\u3002\n\n## TensorFlow \u4e0e RPC\n\n\u5728\u4eba\u5de5\u667a\u80fd\u9886\u57df\uff0cRPC \u4e5f\u5f88\u91cd\u8981\uff0c\u8457\u540d\u7684 TensorFlow \u6846\u67b6\u5982\u679c\u9700\u8981\u5904\u7406\u4e0a\u4ebf\u7684\u6570\u636e\uff0c\u5c31\u9700\u8981\u4f9d\u9760\u5206\u5e03\u5f0f\u8ba1\u7b97\u529b\uff0c\u9700\u8981\u96c6\u7fa4\u5316\uff0c\u5f53\u591a\u4e2a\u5206\u5e03\u5f0f\u8282\u70b9\u9700\u8981\u96c6\u4f53\u667a\u6167\u65f6\uff0c\u5c31\u5fc5\u987b\u5f15\u5165 RPC \u6280\u672f\u8fdb\u884c\u901a\u8baf\u3002Tensorflow Cluster \u7684 RPC \u901a\u8baf\u6846\u67b6\u4f7f\u7528\u4e86 Google \u5185\u90e8\u81ea\u7814\u7684 gRPC \u6846\u67b6\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/7/163d86e168946589?w=728&h=280&f=png&s=40442)\n\n## HTTP \u8c03\u7528\u5176\u5b9e\u4e5f\u662f\u4e00\u79cd\u7279\u6b8a\u7684 RPC\n\nHTTP1.0 \u534f\u8bae\u65f6\uff0cHTTP \u8c03\u7528\u8fd8\u53ea\u80fd\u662f\u77ed\u94fe\u63a5\u8c03\u7528\uff0c\u4e00\u4e2a\u8bf7\u6c42\u6765\u56de\u4e4b\u540e\u8fde\u63a5\u5c31\u4f1a\u5173\u95ed\u3002HTTP1.1 \u5728 HTTP1.0 \u534f\u8bae\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u4e86\u6539\u8fdb\uff0c\u5f15\u5165\u4e86 KeepAlive \u7279\u6027\u53ef\u4ee5\u4fdd\u6301 HTTP \u8fde\u63a5\u957f\u65f6\u95f4\u4e0d\u65ad\u5f00\uff0c\u4ee5\u4fbf\u5728\u540c\u4e00\u4e2a\u8fde\u63a5\u4e4b\u4e0a\u8fdb\u884c\u591a\u6b21\u8fde\u7eed\u7684\u8bf7\u6c42\uff0c\u8fdb\u4e00\u6b65\u62c9\u8fd1\u4e86 HTTP \u548c RPC \u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/9/1634501f55a9ab05?w=450&h=280&f=png&s=13256)\n\n\u5f53 HTTP \u534f\u8bae\u8fdb\u5316\u5230 2.0 \u4e4b\u540e\uff0cGoogle \u5f00\u6e90\u4e86\u4e00\u4e2a\u5efa\u7acb\u5728 HTTP2.0 \u534f\u8bae\u4e4b\u4e0a\u7684\u901a\u4fe1\u6846\u67b6\u76f4\u63a5\u53d6\u540d\u4e3a gRPC\uff0c\u4e5f\u5c31\u662f Google RPC\uff0c\u8fd9\u65f6 HTTP \u548c RPC \u4e4b\u95f4\u5df2\u7ecf\u6ca1\u6709\u975e\u5e38\u660e\u663e\u7684\u754c\u9650\u4e86\u3002\u6240\u4ee5\u5728\u540e\u6587\u6211\u4eec\u4e0d\u518d\u660e\u786e\u5f3a\u8c03 RPC \u548c HTTP \u8bf7\u6c42\u8c03\u7528\u4e4b\u95f4\u7684\u7ec6\u5fae\u533a\u522b\u4e86\uff0c\u76f4\u63a5\u7edf\u4e00\u79f0\u4e4b\u4e3a RPC\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/9/163450426bc81a78?w=429&h=314&f=png&s=12725)\n\n## HTTP VS RPC \uff08\u666e\u901a\u8bdd VS \u65b9\u8a00\uff09\n\nHTTP \u4e0e RPC \u7684\u5173\u7cfb\u5c31\u597d\u6bd4\u666e\u901a\u8bdd\u4e0e\u65b9\u8a00\u7684\u5173\u7cfb\u3002\u8981\u8fdb\u884c\u8de8\u4f01\u4e1a\u670d\u52a1\u8c03\u7528\u65f6\uff0c\u5f80\u5f80\u90fd\u662f\u901a\u8fc7 HTTP API\uff0c\u4e5f\u5c31\u662f\u666e\u901a\u8bdd\uff0c\u867d\u7136\u6548\u7387\u4e0d\u9ad8\uff0c\u4f46\u662f\u901a\u7528\uff0c\u6ca1\u6709\u592a\u591a\u6c9f\u901a\u7684\u5b66\u4e60\u6210\u672c\u3002\u4f46\u662f\u5728\u4f01\u4e1a\u5185\u90e8\u8fd8\u662f RPC \u66f4\u52a0\u9ad8\u6548\uff0c\u540c\u4e00\u4e2a\u4f01\u4e1a\u516c\u7528\u4e00\u5957\u65b9\u8a00\u8fdb\u884c\u9ad8\u6548\u7387\u7684\u4ea4\u6d41\uff0c\u8981\u6bd4\u901a\u7528\u7684 HTTP \u534f\u8bae\u6765\u4ea4\u6d41\u66f4\u52a0\u8282\u7701\u8d44\u6e90\u3002\u6574\u4e2a\u4e2d\u56fd\u6709\u975e\u5e38\u591a\u7684\u65b9\u8a00\uff0c\u6b63\u5982\u6709\u5f88\u591a\u7684\u4f01\u4e1a\u5185\u90e8\u670d\u52a1\u5404\u6709\u81ea\u5df1\u7684\u4e00\u5957\u4ea4\u4e92\u534f\u8bae\u4e00\u6837\u3002\u867d\u7136\u56fd\u5bb6\u4e00\u76f4\u5728\u63d0\u5021\u4f7f\u7528\u666e\u901a\u8bdd\u4ea4\u6d41\uff0c\u4f46\u662f\u8fd9\u4e48\u591a\u5e74\u8fc7\u53bb\u4e86\uff0c\u4f60\u56de\u4e00\u8d9f\u5bb6\u4e61\u63a2\u4e2a\u4eb2\u4ec0\u4e48\u7684\u5c31\u4f1a\u53d1\u73b0\u8eab\u8fb9\u7684\u4eba\u8fd8\u662f\u6d41\u884c\u8bf4\u65b9\u8a00\u3002\n\n\u5982\u679c\u518d\u6df1\u5165\u4e00\u70b9\u8bf4\uff0c\u666e\u901a\u8bdd\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u79cd\u65b9\u8a00\uff0c\u53ea\u4e0d\u8fc7\u5b83\u662f\u5b98\u65b9\u7684\u65b9\u8a00\uff0c\u4f7f\u7528\u6700\u4e3a\u5e7f\u6cdb\u7684\u65b9\u8a00\uff0c\u76f8\u6bd4\u800c\u8a00\u5176\u5b83\u65b9\u8a00\u90fd\u662f\u5c0f\u8bed\u79cd\uff0c\u5c0f\u8bed\u79cd\u4e4b\u4e2d\u4e5f\u4f1a\u6709\u51e0\u4e2a\u4f7f\u7528\u6bd4\u8f83\u5e7f\u6cdb\u6bd4\u8f83\u7279\u8272\u7684\u65b9\u8a00\u5360\u6bd4\u4e5f\u4f1a\u6bd4\u8f83\u5927\u3002\u8fd9\u5c31\u597d\u6bd4\u5f00\u6e90 RPC \u534f\u8bae\u4e2d Protobuf \u548c Thrift \u4e00\u6837\uff0c\u5b83\u4eec\u4e24\u5e94\u8be5\u662f RPC \u534f\u8bae\u4e2d\u4f7f\u7528\u6700\u4e3a\u5e7f\u6cdb\u7684\u4e24\u4e2a\u3002\n\n## \u6362\u4e2a\u89d2\u5ea6\u770b\u4e16\u754c\n\n\u5982\u679c\u4e24\u4e2a\u5b50\u7cfb\u7edf\u6ca1\u6709\u5728\u7f51\u7edc\u4e0a\u8fdb\u884c\u5206\u79bb\uff0c\u800c\u662f\u8fd0\u884c\u5728\u540c\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u4f8b\u4e4b\u4e0a\u7684\u4e24\u4e2a\u8fdb\u7a0b\u65f6\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u901a\u4fe1\u624b\u6bb5\u8fd8\u53ef\u4ee5\u66f4\u52a0\u4e30\u5bcc\u3002\u9664\u4e86\u4ee5\u4e0a\u63d0\u5230\u7684\u51e0\u79cd\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\u4e4b\u5916\uff0c\u8fd8\u6709\u5171\u4eab\u5185\u5b58\u3001\u4fe1\u53f7\u91cf\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u5185\u6838\u6d88\u606f\u961f\u5217\u3001\u7ba1\u9053\u7b49\uff0c\u672c\u8d28\u4e0a\u90fd\u662f\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u673a\u5236\u6765\u8fdb\u884c\u6570\u636e\u548c\u6d88\u606f\u7684\u4ea4\u4e92\u800c\u65e0\u987b\u7ecf\u8fc7\u7f51\u7edc\u534f\u8bae\u6808\u3002\n\n\u4f46\u5728\u73b0\u4ee3\u4f01\u4e1a\u670d\u52a1\u4e2d\uff0c\u8fd9\u79cd\u5355\u673a\u5e94\u7528\u5df2\u7ecf\u975e\u5e38\u5c11\u89c1\u4e86\uff0c\u56e0\u4e3a\u5355\u673a\u5e94\u7528\u610f\u5473\u7740\u5355\u70b9\u6545\u969c \u2014\u2014 \u201c\u4e00\u4eba\u6454\u8de4\u5168\u5bb6\u8dcc\u5012\u201d\u3002\u4e1a\u52a1\u5b50\u7cfb\u7edf\u5f80\u5f80\u90fd\u9700\u8981\u7ecf\u7269\u7406\u7f51\u7edc\u6808\u8fdb\u884c\u9694\u79bb\uff0c\u56e0\u6b64\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\u5728\u8981\u6c42\u9ad8\u53ef\u7528\u65e0\u95f4\u65ad\u670d\u52a1\u7684\u4f01\u4e1a\u73af\u5883\u91cc\u4fbf\u5927\u6709\u4f5c\u4e3a\uff0c\u8fd9\u4e5f\u8ba9 RPC \u8fce\u6765\u81ea\u5df1\u5927\u653e\u5f02\u5f69\u7684\u65f6\u4ee3\u3002\n\n\u524d\u6587\u63d0\u5230\u7684\u5206\u5e03\u5f0f\u5b50\u7cfb\u7edf\u4ea4\u4e92\u65b9\u6848\uff0c\u9664\u4e86 RPC \u6280\u672f\u4e4b\u5916\u8fd8\u6709\u6570\u636e\u5e93\u3001\u6d88\u606f\u961f\u5217\u548c\u7f13\u5b58\u3002\u4f46\u5176\u5b9e\u8fd9\u4e09\u8005\u672c\u8d28\u4e0a\u662f RPC \u6280\u672f\u7684\u4e00\u4e2a\u5e94\u7528\u7ec4\u5408\u3002\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u5e93\u670d\u52a1\u7406\u89e3\u4e3a\u4e0b\u9762\u8fd9\u5f20\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b423db4c30c8d?w=528&h=125&f=png&s=10782)\n\n\u53ef\u4ee5\u770b\u51fa\uff0c\u5b50\u7cfb\u7edf\u548c\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u4ea4\u4e92\u4e5f\u662f\u901a\u8fc7 RPC \u8fdb\u884c\u7684\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u91cc\u662f\u4e09\u4e2a\u5b50\u7cfb\u7edf\u4e4b\u95f4\u590d\u6742\u7684\u7ec4\u5408\u6d88\u606f\u4ea4\u4e92\u7f62\u4e86\u3002\u5982\u679c\u518d\u6df1\u5165\u8fdb\u53bb\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u8fd9\u91cc\u7684\u6570\u636e\u5e93\u4e0d\u662f\u90a3\u79cd\u5355\u673a\u6570\u636e\u5e93\uff0c\u800c\u662f\u5177\u5907\u4e3b\u4ece\u590d\u5236\u529f\u80fd\u7684\u6570\u636e\u5e93\uff0c\u6bd4\u5982 MySQL\u3002\u5728\u4e92\u8054\u7f51\u4f01\u4e1a\u91cc\u4e00\u822c\u90fd\u4f1a\u4f7f\u7528\u8fd9\u79cd\u4e3b\u4ece\u8bfb\u5199\u5206\u79bb\u7684\u6570\u636e\u5e93\u3002\u4e00\u4e2a\u4e1a\u52a1\u5b50\u7cfb\u7edf\u5c06\u6570\u636e\u5199\u5f80\u4e3b\u5e93\uff0c\u4e3b\u5e93\u518d\u5c06\u6570\u636e\u540c\u6b65\u5230\u4ece\u5e93\uff0c\u7136\u540e\u53e6\u4e00\u4e2a\u4e1a\u52a1\u5b50\u7cfb\u7edf\u53c8\u4ece\u4ece\u5e93\u91cc\u5c06\u6570\u636e\u53d6\u51fa\u6765\u3002\u8fd9\u65f6\u53c8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5c06\u5b83\u4eec\u770b\u6210\u662f\u56db\u4e2a\u5b50\u7cfb\u7edf\u4e4b\u95f4\u8fdb\u884c\u7684\u66f4\u52a0\u590d\u6742\u7684 RPC \u6570\u636e\u4ea4\u4e92\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b424e19251da7?w=674&h=125&f=png&s=12287)\n\n## \u5c0f\u7ed3\n\n\u73b0\u5728\uff0c\u8bfb\u8005\u5e94\u8be5\u53ef\u4ee5\u6df1\u523b\u7406\u89e3 RPC \u5728\u4e92\u8054\u7f51\u4f01\u4e1a\u6280\u672f\u4e2d\u7684\u91cd\u8981\u5730\u4f4d\u3002\u4ece\u6280\u672f\u590d\u6742\u6027\u89d2\u5ea6\uff0c\u4e5f\u5e94\u8be5\u53ef\u4ee5\u660e\u767d\u4e3a\u4ec0\u4e48\u8bf4\u5bf9 RPC \u6280\u672f\u7684\u7406\u89e3\u6c34\u5e73\u662f\u8bc4\u5224\u4e00\u4e2a\u7a0b\u5e8f\u5458\u662f\u4e0d\u662f\u9ad8\u7ea7\u7a0b\u5e8f\u5458\u7684\u91cd\u8981\u6807\u51c6\u4e4b\u4e00\u3002\n\n\u5728\u4e0b\u4e00\u8282\uff0c\u6211\u4eec\u5c06\u5bf9 RPC \u7684\u4ea4\u4e92\u539f\u7406\u8fdb\u884c\u6df1\u5165\u7684\u5b66\u4e60\uff0c\u5148\u628a\u5730\u57fa\u6253\u7262\uff0c\u518d\u5f00\u59cb\u5b9e\u6218\u5f00\u53d1\u3002\n\n## \u601d\u8003\u9898\n\n\u8bf7\u8bfb\u8005\u601d\u8003\u4e00\u4e0b\uff0c\u5728\u5e73\u65f6\u7684\u540e\u7aef\u5f00\u53d1\u4e2d\uff0c\u8fd8\u6709\u54ea\u4e9b\u5730\u65b9\u7528\u5230\u4e86\u300c\u7c7b RPC\u300d\u6280\u672f\uff1f", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u5f00\u7bc7RPC_\u8981\u89e3\u51b3\u7684\u6838\u5fc3\u95ee\u9898\u548c\u5728\u4f01\u4e1a\u670d\u52a1\u4e2d\u7684\u5730\u4f4d.md", "create_date": "2020-02-18T21:31:51.691", "order": 1}}, {"model": "subject.chapter", "pk": 90, "fields": {"title": "\u57fa\u7840\uff1a\u6df1\u5165 RPC \u4ea4\u4e92\u6d41\u7a0b", "topic": 4, "md5": "d64f001a28920653ceffea749a7e0535", "md_body": "# \u57fa\u7840\u7bc7\uff1a\u6df1\u5165\u7406\u89e3 RPC \u4ea4\u4e92\u6d41\u7a0b\n\n\u672c\u8282\u6211\u4eec\u5f00\u59cb\u8bb2\u89e3 RPC \u7684\u6d88\u606f\u4ea4\u4e92\u6d41\u7a0b\uff0c\u76ee\u7684\u662f\u641e\u6e05\u695a\u4e00\u4e2a\u7b80\u5355\u7684 RPC \u65b9\u6cd5\u8c03\u7528\u80cc\u540e\u7a76\u7adf\u53d1\u751f\u4e86\u600e\u6837\u590d\u6742\u66f2\u6298\u7684\u6545\u4e8b\uff0c\u4ee5\u770b\u900f RPC \u7684\u672c\u8d28\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163cf789da84cb53?w=869&h=133&f=png&s=9766)\n\n\u4e0a\u56fe\u662f\u4fe1\u606f\u7cfb\u7edf\u4ea4\u4e92\u6a21\u578b\u5b8f\u89c2\u793a\u610f\u56fe\uff0cRPC \u7684\u6d88\u606f\u4ea4\u4e92\u5219\u4f1a\u6df1\u5165\u5230\u5e95\u5c42\u3002\n\nRPC \u662f\u4e24\u4e2a\u5b50\u7cfb\u7edf\u4e4b\u95f4\u8fdb\u884c\u7684\u76f4\u63a5\u6d88\u606f\u4ea4\u4e92\uff0c\u5b83\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u5957\u63a5\u5b57\u6765\u4f5c\u4e3a\u6d88\u606f\u7684\u8f7d\u4f53\uff0c\u4ee5\u7279\u5b9a\u7684\u6d88\u606f\u683c\u5f0f\u6765\u5b9a\u4e49\u6d88\u606f\u5185\u5bb9\u548c\u8fb9\u754c\u3002\n\nRPC \u7684\u5ba2\u6237\u7aef\u901a\u8fc7\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u8bfb\u5199 API (read & write) \u6765\u8bbf\u95ee\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e2d\u7684\u7f51\u7edc\u6a21\u5757\u4e3a\u5f53\u524d\u5957\u63a5\u5b57\u5206\u914d\u7684\u53d1\u9001 (send buffer) \u548c\u63a5\u6536 (recv buffer) \u7f13\u5b58\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b4dcf06e0a780?w=865&h=471&f=png&s=40786)\n\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5de6\u8fb9\u7684\u5ba2\u6237\u7aef\u8fdb\u7a0b\u5199 RPC \u6307\u4ee4\u6d88\u606f\u5230\u5185\u6838\u7684\u53d1\u9001\u7f13\u5b58\u4e2d\uff0c\u5185\u6838\u5c06\u53d1\u9001\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u4f20\u9001\u5230\u7269\u7406\u786c\u4ef6 NIC\uff0c\u4e5f\u5c31\u662f\u7f51\u7edc\u63a5\u53e3\u82af\u7247 (Network Interface Circuit)\u3002NIC \u8d1f\u8d23\u5c06\u7ffb\u8bd1\u51fa\u6765\u7684\u6a21\u62df\u4fe1\u53f7\u901a\u8fc7\u7f51\u7edc\u786c\u4ef6\u4f20\u9012\u5230\u670d\u52a1\u5668\u786c\u4ef6\u7684 NIC\u3002\u670d\u52a1\u5668\u7684 NIC \u518d\u5c06\u6a21\u62df\u4fe1\u53f7\u8f6c\u6210\u5b57\u8282\u6570\u636e\u5b58\u653e\u5230\u5185\u6838\u4e3a\u5957\u63a5\u5b57\u5206\u914d\u7684\u63a5\u6536\u7f13\u5b58\u4e2d\uff0c\u6700\u7ec8\u670d\u52a1\u5668\u8fdb\u7a0b\u4ece\u63a5\u6536\u7f13\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u5373\u4e3a\u6e90\u5ba2\u6237\u7aef\u8fdb\u7a0b\u4f20\u9012\u8fc7\u6765\u7684 RPC \u6307\u4ee4\u6d88\u606f\u3002\n\n\u6d88\u606f\u4ece\u7528\u6237\u8fdb\u7a0b\u6d41\u5411\u7269\u7406\u786c\u4ef6\uff0c\u53c8\u4ece\u7269\u7406\u786c\u4ef6\u6d41\u5411\u7528\u6237\u8fdb\u7a0b\uff0c\u4e2d\u95f4\u8fd8\u7ecf\u8fc7\u4e86\u4e00\u7cfb\u5217\u7684\u8def\u7531\u7f51\u5173\u8282\u70b9\u3002\n\n\u4e0a\u56fe\u5448\u73b0\u7684\u53ea\u662f RPC \u4e00\u6b21\u6d88\u606f\u4ea4\u4e92\u7684\u4e0a\u534a\u573a\uff0c\u4e0b\u534a\u573a\u662f\u4e00\u4e2a\u9006\u5411\u7684\u8fc7\u7a0b\uff0c\u4ece\u670d\u52a1\u5668\u8fdb\u7a0b\u5411\u5ba2\u6237\u7aef\u8fdb\u7a0b\u8fd4\u56de\u54cd\u5e94\u6570\u636e\u3002\u5b8c\u6574\u7684\u4e00\u6b21 RPC \u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/10/17/166802bd272e86a2?w=811&h=432&f=png&s=50907)\n\n\u4e0b\u9762\u7528 Python \u4ee3\u7801\u6765\u63cf\u8ff0\u4e0a\u8ff0\u8fc7\u7a0b\u3002\n\n*   Server \u7aef\u6b7b\u5faa\u73af\u76d1\u542c\u672c\u5730 8080 \u7aef\u53e3\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002\n*   \u5ba2\u6237\u7aef\u542f\u52a8\u65f6\u8fde\u63a5\u672c\u5730 8080 \u7aef\u53e3\uff0c\u7d27\u63a5\u7740\u53d1\u9001\u8bcd\u4e00\u4e2a\u5b57\u7b26\u4e32 hello\uff0c\u7136\u540e\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94\u3002\n*   \u670d\u52a1\u5668\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u8fde\u63a5\u540e\u7acb\u5373\u6536\u53d6\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u5c31\u662f hello\uff0c\u6253\u5370\u51fa\u6765\u3002\u7136\u540e\u7acb\u5373\u7ed9\u5bf9\u65b9\u56de\u590d\u4e00\u4e2a\u5b57\u7b26\u4e32 world\u3002\n*   \u5ba2\u6237\u7aef\u63a5\u6536\u5230\u670d\u52a1\u5668\u53d1\u9001\u8fc7\u6765\u7684 world\uff0c\u9a6c\u4e0a\u6253\u5370\u51fa\u6765\u3002\n*   \u5173\u95ed\u8fde\u63a5\uff0c\u7ed3\u675f\u3002\n\n```\n# coding: utf-8\n# server\n\nimport socket\n\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nsock.bind((\"localhost\", 8080))\nsock.listen(1)  # \u76d1\u542c\u5ba2\u6237\u7aef\u8fde\u63a5\nwhile True:\n    conn, addr = sock.accept()  # \u63a5\u6536\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\n    print conn.recv(1024)  # \u4ece\u63a5\u6536\u7f13\u51b2\u8bfb\u6d88\u606f recv buffer\n    conn.sendall(\"world\")  # \u5c06\u54cd\u5e94\u53d1\u9001\u5230\u53d1\u9001\u7f13\u51b2 send buffer\n    conn.close() # \u5173\u95ed\u8fde\u63a5\n\n# coding: utf-8\n# client\n\nimport socket\n\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nsock.connect((\"localhost\", 8080))  # \u8fde\u63a5\u670d\u52a1\u5668\nsock.sendall(\"hello\")  # \u5c06\u6d88\u606f\u8f93\u51fa\u5230\u53d1\u9001\u7f13\u51b2 send buffer\nprint sock.recv(1024)  # \u4ece\u63a5\u6536\u7f13\u51b2 recv buffer \u4e2d\u8bfb\u54cd\u5e94\nsock.close() # \u5173\u95ed\u5957\u63a5\u5b57\n\n\n```\n\n\u5982\u679c\u4ece\u4e0a\u9762\u4ee3\u7801\u4e0a\u89c2\u5bdf\uff0c\u6211\u4eec\u5176\u5b9e\u5f88\u96be\u770b\u51fa\u4e0a\u56fe\u6240\u793a\u7684\u590d\u6742\u8fc7\u7a0b\u3002\u6d6e\u73b0\u5728\u591a\u6570\u4eba\u8111\u6d77\u4e2d\u5f80\u5f80\u662f\u4e0b\u9762\u7684\u8fd9\u5e45\u7b80\u7ea6\u6a21\u578b\u56fe\u3002\u76f8\u6bd4\u4e4b\u4e0b\u5b83\u8981\u7b80\u5355\u5f88\u591a\uff0c\u8fd9\u4e5f\u6b63\u662f\u64cd\u4f5c\u7cfb\u7edf\u8bbe\u8ba1\u7684\u9b45\u529b\u6240\u5728\uff0c\u8ba9\u4f60\u65f6\u65f6\u523b\u523b\u90fd\u5728\u4f7f\u7528\u5b83\u5374\u611f\u53d7\u4e0d\u5230\u5b83\u7684\u5b58\u5728\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b4e36daa5cc79?w=533&h=187&f=png&s=14580)\n\n## \u5c0f\u7ed3\n\n\u901a\u8fc7\u672c\u8282\u5185\u5bb9\uff0c\u8bfb\u8005\u4eec\u5bf9 RPC \u7684\u4ea4\u4e92\u6d41\u7a0b\u5e94\u8be5\u6709\u4e86\u5927\u81f4\u4e86\u89e3\uff0c\u4f46\u662f\u8fd8\u5e76\u4e0d\u77e5\u9053 RPC \u4e4b\u95f4\u5230\u5e95\u4ea4\u4e92\u4e86\u4ec0\u4e48\u3002\u5c31\u597d\u6bd4\u4f60\u80fd\u770b\u5230\u8fdc\u65b9\u6709\u51e0\u4e2a\u4eba\u5728\u8bf4\u8bdd\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u4ed6\u4eec\u5728\u8bf4\u5565\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/163760c75f77399c?w=150&h=150&f=jpeg&s=6950)\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u653e\u5927\u7ec6\u8282\uff0c\u4ed4\u7ec6\u89c2\u5bdf RPC \u5ba2\u6237\u7aef\u670d\u52a1\u5668\u4e4b\u95f4\u7a83\u7a83\u79c1\u8bed\u4e86\u4ec0\u4e48\uff0c\u5b83\u4eec\u7a76\u7adf\u662f\u5728\u7528\u4ec0\u4e48\u5916\u661f\u8bed\u8a00\u4ea4\u6d41\u3002\n\n## \u7ec3\u4e60\u9898\n\n\u4e00\u4e2a\u5f88\u6709\u8da3\u7684\u5c0f\u6d4b\u8bd5\u5b9e\u9a8c , \u8bf7\u8bfb\u8005\u7f16\u5199\u4ee3\u7801\u5b9e\u73b0\u4ee5\u4e0b\u60c5\u666f:\n\n> \u5ba2\u6237\u7aef\u75af\u72c2\u53d1\u9001\u8bf7\u6c42\uff0c\u4f46\u662f\u670d\u52a1\u5668\u4e0d\u8bfb\u4e0d\u5904\u7406\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u57fa\u7840\u6df1\u5165_RPC_\u4ea4\u4e92\u6d41\u7a0b.md", "create_date": "2020-02-18T21:31:51.708", "order": 2}}, {"model": "subject.chapter", "pk": 91, "fields": {"title": "\u62d3\u5c55 2\uff1aThrift \u539f\u7406\u4e0e\u5b9e\u8df5", "topic": 4, "md5": "f50106d481fe636c1576634c21f60823", "md_body": "# \u62d3\u5c55 2\uff1aThrift \u539f\u7406\u4e0e\u5b9e\u8df5\n\n\u56fd\u5916\u5f00\u6e90\u5f71\u54cd\u529b\u5927\u5382\u9664\u4e86 Google \u5c31\u6570 Facebook \u4e86\u3002\u81ea\u4ece Google \u5f00\u6e90\u4e86 protobuf \u4e4b\u540e\uff0cFacebook \u7d27\u968f\u5176\u540e\uff0c\u5f00\u6e90\u4e86\u81ea\u5bb6\u7684 Thrift RPC \u6846\u67b6\u3002\u76f8\u6bd4 protobuf \u4e00\u4e2a\u5355\u7eaf\u7684\u5e8f\u5217\u5316\u5de5\u5177\u800c\u8a00\uff0cthrift \u662f\u4e00\u4e2a\u5168\u5957\u7684 RPC \u6846\u67b6\uff0c\u652f\u6301\u591a\u79cd\u534f\u8bae\uff0c\u591a\u79cd\u4f20\u8f93\u6a21\u5f0f\u548c\u591a\u79cd\u670d\u52a1\u5668\u6a21\u578b\uff0c\u8fd8\u6709\u5355\u5411\u6d88\u606f\uff0c\u591a\u79cd\u5bb9\u5668\u578b\u6570\u636e\u7ed3\u6784\u548c\u81ea\u5b9a\u4e49\u5f02\u5e38\u7c7b\u578b\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163cecbb9ea989dc?w=400&h=400&f=png&s=59433)\n\n\u4e0a\u9762\u8fd9\u5f20\u56fe\u662f\u5b98\u65b9\u7684 Thrift \u7ed3\u6784\u56fe (\u8001\u5e08\u8fd8\u662f\u89c9\u5f97\u81ea\u5df1\u753b\u7684\u56fe\u597d\u770b)\u3002\u4ece\u4e0b\u5f80\u4e0a\u770b\uff0cTTransport \u5c42\u53ef\u4ee5\u9009\u62e9\u591a\u79cd\u4f20\u8f93\u6a21\u5f0f\uff0cTProtocol \u5c42\u53ef\u4ee5\u9009\u62e9\u591a\u79cd\u534f\u8bae\uff0c\u518d\u4e0a\u9762\u4e24\u5c42\u662f Thrift \u7f16\u8bd1\u5668\u751f\u6210\u7684\u4ee3\u7801\uff0c\u5305\u542b\u6d88\u606f\u7684\u7f16\u7801\u89e3\u7801\u5668\u3001\u5ba2\u6237\u7aef\u670d\u52a1\u5668\u7684 Stub \u7c7b\u548c\u670d\u52a1\u5668\u7684\u5b9e\u73b0\u63a5\u53e3\u3002\u6700\u4e0a\u5c42\u670d\u52a1\u5668\u8fd9\u8fb9\u8981\u81ea\u5df1\u5b9e\u73b0\u670d\u52a1\u5668\u63a5\u53e3\uff0c\u7ec4\u88c5\u670d\u52a1\u5668\u4ee3\u7801\uff0c\u5ba2\u6237\u7aef\u8981\u5305\u88c5 Stub \u7c7b\u6765\u8c03\u7528 RPC \u8fdc\u7a0b\u670d\u52a1\u3002\n\n## \u534f\u8bae\u9009\u62e9\n\nThrift \u652f\u6301\u591a\u79cd\u534f\u8bae\uff0c\u6709\u6587\u672c\u534f\u8bae\u6709\u4e8c\u8fdb\u5236\u534f\u8bae\u3002Python \u7248\u672c\u7684\u6587\u672c\u534f\u8bae\u9ed8\u8ba4\u63d0\u4f9b\u4e86 JSON \u5e8f\u5217\u5316\u7684\u5b9e\u73b0 TJSONProtocol\uff0c\u4e8c\u8fdb\u5236\u534f\u8bae\u6709\u666e\u901a\u7684\u4e8c\u8fdb\u5236\u534f\u8bae TBinaryProtocol \u548c\u7d27\u51d1\u7248\u7684\u4e8c\u8fdb\u5236\u534f\u8bae TCompactProtocol\u3002\u7528\u6237\u53ef\u4ee5\u81ea\u5df1\u6269\u5c55\u534f\u8bae\u7c7b\u578b\u3002\u4e0b\u9762\u7684\u4f8b\u5b50\u6211\u4eec\u4f7f\u7528 TCompactProtocol\uff0c\u8fd9\u4e5f\u662f\u5b98\u65b9\u63a8\u8350\u7684\u534f\u8bae\uff0c\u5b83\u5728\u517c\u5177\u6027\u80fd\u7684\u524d\u63d0\u4e0b\u8fd8\u80fd\u6709\u8f83\u9ad8\u7684\u7a7a\u95f4\u6548\u7387\u3002\n\n## \u670d\u52a1\u5668\u6a21\u5f0f\u9009\u62e9\n\nThrift \u652f\u6301\u591a\u79cd\u670d\u52a1\u5668\u6a21\u5f0f\uff0c\u6211\u4eec\u5728\u5b9e\u6218\u73af\u8282\u5217\u4e3e\u7684\u670d\u52a1\u5668\u6a21\u5f0f\u5b83\u5168\u90e8\u652f\u6301\n\n1.  \u5355\u7ebf\u7a0b\u6a21\u5f0f\n2.  \u591a\u7ebf\u7a0b\u6a21\u5f0f\n3.  \u591a\u8fdb\u7a0b\u6a21\u5f0f\n4.  \u7ebf\u7a0b\u6c60\u6a21\u5f0f\n5.  \u8fdb\u7a0b\u6c60\u6a21\u5f0f\n6.  \u5f02\u6b65\u6a21\u5f0f\n\n\u5355\u770b\u8fd9\u4e00\u70b9\uff0cThrift \u8981\u6bd4 gRPC \u66f4\u52a0\u6709\u4f18\u52bf\uff0cgRPC \u90fd\u4e0d\u80fd\u5f88\u597d\u5730\u652f\u6301\u591a\u8fdb\u7a0b\u6a21\u5f0f\u3002Thrift \u9ed8\u8ba4\u6ca1\u6709\u63d0\u4f9b\u591a\u8fdb\u7a0b\u5f02\u6b65\u6a21\u5f0f\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7531\u7528\u6237\u81ea\u5df1\u53bb\u6269\u5c55\u3002\n\n## \u4f20\u8f93\u5c42\u9009\u62e9\n\nThrift \u652f\u6301\u591a\u79cd\u4f20\u8f93\u6a21\u5f0f\uff0c\u9664\u4e86\u666e\u901a\u7684 TCP socket \u4e4b\u5916\uff0c\u8fd8\u6709\u5bf9 ssl \u7684\u652f\u6301\uff0c\u6709\u5bf9\u538b\u7f29\u7684\u652f\u6301\u3002\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u7531\u7528\u6237\u81ea\u5df1\u6765\u9009\u62e9\u3002\u6211\u4eec\u901a\u5e38\u5728\u4f20\u8f93\u5c42\u4f7f\u7528\u7f13\u51b2\u6a21\u5f0f\uff0c\u5728\u5e8f\u5217\u5316\u6d88\u606f\u65f6\uff0c\u5f85\u5b8c\u6574\u7684\u6d88\u606f\u7ed3\u6784\u4f53\u5e8f\u5217\u5316\u5b8c\u6210\u540e\u8c03\u7528 flush \u65b9\u6cd5\u624d\u4f1a\u5c06\u6d88\u606f\u4f20\u9012\u5230\u5bf9\u65b9\uff0c\u6709\u52a9\u4e8e\u63d0\u5347 IO \u6548\u7387\uff0c\u907f\u514d\u6d88\u606f\u7684\u534a\u5305\u95ee\u9898\u9891\u7e41\u6253\u6270\u5bf9\u65b9\u3002\n\n## Thrift \u5165\u95e8\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163cefafce5878f8?w=899&h=489&f=png&s=78087)\n\nThrift \u4f7f\u7528\u4e0a\u548c gRPC \u5dee\u4e0d\u591a\uff0c\u4f7f\u7528\u6b65\u9aa4\u56fe\u8ddf gRPC \u4e5f\u6ca1\u6709\u533a\u522b\uff0c\u53ea\u4e0d\u8fc7\u662f\u6362\u4e86\u4ee3\u7801\u751f\u6210\u5de5\u5177\u3001\u4f9d\u8d56\u5e93\u548c\u7c7b\u547d\u540d\u3002 \u4e0b\u9762\u6211\u4eec\u4f7f\u7528 Thrift \u6765\u5b9e\u73b0\u4e00\u8fb9\u5706\u5468\u7387\u670d\u52a1\u3002\n\n**\u7f16\u5199\u534f\u8bae\u6587\u4ef6**\n\n```\nnamespace py pi  # \u751f\u6210\u7684 python \u4ee3\u7801\u4ee5 pi \u4f5c\u4e3a\u5305\u540d\n\nservice PiService {\n\tdouble calc(1:i32 n)\n}\n\n```\n\nThrift \u7684\u534f\u8bae\u6587\u4ef6\u8981\u6bd4 gRPC \u7b80\u6d01\u591a\u4e86\uff0c\u53c2\u6570\u548c\u8fd4\u56de\u652f\u6301\u5f88\u591a\u539f\u751f\u7c7b\u578b\uff0cgRPC \u4e0d\u884c\uff0c\u90fd\u5fc5\u987b\u4f7f\u7528\u5305\u88c5\u7c7b\u578b\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8f93\u5165\u548c\u8f93\u51fa\u90fd\u8981\u5b9a\u4e49 message \u7ed3\u6784\u4f53\uff0c\u6bd4\u8f83\u7e41\u7410\u3002\n\n\u4e3a\u4e86\u548c gRPC \u4fdd\u6301\u4e00\u81f4\uff0c\u6211\u4eec\u5c06\u53c2\u6570\u7a0d\u5fae\u590d\u6742\u5316\u4e00\u70b9\uff0c\u589e\u52a0\u8f93\u5165\u8f93\u51fa\u7ed3\u6784\u4f53\uff0c\u540c\u65f6 Thrift \u8fd8\u652f\u6301\u81ea\u5b9a\u4e49\u5f02\u5e38\u7c7b\u578b\uff0c\u5f53\u8f93\u5165\u53c2\u6570 n \u975e\u6b63\u6570\u65f6\uff0c\u6211\u4eec\u629b\u51fa IllegalArgument \u5f02\u5e38\n\n```\nnamespace py pi\n\nstruct PiRequest {\n1:i32 n\n}\n\nstruct PiResponse {\n1:double value\n}\n\nexception IllegalArgument {\n1: string message\n}\n\nservice PiService {\n\tPiResponse calc(1:PiRequest req) throws(1:IllegalArgument ia)\n}\n\n```\n\n**\u751f\u6210\u4ee3\u7801**\n\n```\nthrift --gen py pi.thrift\n\n```\n\n\u6267\u884c\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u76ee\u5f55\u4e0b\u591a\u4e86\u4e2a gen-py \u76ee\u5f55\uff0c\u91cc\u9762\u5c31\u662f\u751f\u6210\u7684\u4ee3\u7801\u3002\u6211\u4eec\u770b\u76ee\u5f55\u91cc\u9762\u6709\u4e2a pi/PiService.py \u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5c31\u5305\u542b\u4e86\u5ba2\u6237\u7aef\u670d\u52a1\u5668\u7684 Stub\uff0c\u6d88\u606f\u7f16\u7801\u89e3\u7801\u5668\u548c\u670d\u52a1\u5668\u63a5\u53e3\u3002\u8fd8\u6709\u4e2a pi/PiService-remote \u6587\u4ef6\u8fd9\u4e2a\u662f\u7528\u6765\u6d4b\u8bd5 RPC \u670d\u52a1\u529f\u80fd\u7684\u5ba2\u6237\u7aef\u5de5\u5177\u7c7b\uff0c\u6211\u4eec\u4e0d\u7528\u7406\u4f1a\u8fd9\u4e2a\u6587\u4ef6\u3002\u7136\u540e\u8fd8\u6709 constants.py \u548c ttypes.py, \u4e00\u4e2a\u662f\u534f\u8bae\u91cc\u5b9a\u4e49\u7684\u5e38\u91cf\uff0c\u4e00\u4e2a\u662f\u81ea\u5b9a\u4e49\u7ed3\u6784\u4f53\u7684\u7f16\u7801\u89e3\u7801\u7c7b\u548c\u81ea\u5b9a\u4e49\u679a\u4e3e\u7c7b\u3002Thrift \u652f\u6301\u5b9a\u4e49\u5e38\u91cf\u548c\u679a\u4e3e\u3002\n\n**\u670d\u52a1\u5668\u5b9e\u73b0**\n\n\u670d\u52a1\u5668\u6211\u4eec\u4f7f\u7528\u7ebf\u7a0b\u6c60\u6a21\u5f0f\u63d0\u4f9b\u670d\u52a1\uff0c\u5f53\u53c2\u6570\u975e\u6cd5\u65f6\uff0c\u6211\u4eec\u629b\u51fa\u81ea\u5b9a\u4e49\u5f02\u5e38\uff0c\u671f\u671b\u5ba2\u6237\u7aef\u53ef\u4ee5\u6355\u83b7\u3002\n\n```\n# coding: utf-8\n# server.py\nimport sys\nsys.path.append('gen-py')  # \u589e\u52a0 py \u5305\u67e5\u627e\u8def\u5f84\uff0c\u8fd9\u6837\u624d\u53ef\u4ee5\u627e\u5230 pi \u5305\nimport math\n\nfrom thrift.transport import TSocket, TTransport\nfrom thrift.protocol import TCompactProtocol\nfrom thrift.server import TServer\n\nfrom pi.ttypes import PiResponse, IllegalArgument\nfrom pi.PiService import Iface, Processor\n\n\nclass PiHandler(Iface):  # Iface \u4e3a RPC \u670d\u52a1\u63a5\u53e3\n\n    def calc(self, req):\n        if req.n <= 0:\n            raise IllegalArgument(message=\"parameter must be positive\")\n        s = 0.0\n        for i in range(req.n):\n            s += 1.0/(2*i+1)/(2*i+1)\n        return PiResponse(value=math.sqrt(8*s))\n\n\nif __name__ == '__main__':\n    handler = PiHandler()\n    processor = Processor(handler)\n    transport = TSocket.TServerSocket(host=\"127.0.0.1\", port=8888)\n    tfactory = TTransport.TBufferedTransportFactory()  # \u7f13\u51b2\u6a21\u5f0f\n    pfactory = TCompactProtocol.TCompactProtocolFactory()  # \u7d27\u51d1\u6a21\u5f0f\n\n    # \u7ebf\u7a0b\u6c60\u670d\u52a1 RPC \u8bf7\u6c42\n    server = TServer.TThreadPoolServer(processor, transport, tfactory, pfactory)\n    # \u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u6570\u91cf\n    server.setNumThreads(10)\n    # \u8bbe\u7f6e\u7ebf\u7a0b\u4e3a daemon\uff0c\u5f53\u8fdb\u7a0b\u53ea\u5269\u4e0b daemon \u7ebf\u7a0b\u65f6\u4f1a\u7acb\u5373\u9000\u51fa\n    server.daemon = True\n    # \u542f\u52a8\u670d\u52a1\n    server.serve()\n\n```\n\n**\u5ba2\u6237\u7aef\u5b9e\u73b0**\n\n\u7f16\u5199\u5ba2\u6237\u7aef\u65f6\u5fc5\u987b\u6ce8\u610f\u7684\u662f Thrift \u63d0\u4f9b\u7684\u5ba2\u6237\u7aef Stub \u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u8fde\u63a5\u901a\u9053\u5e76\u4e0d\u5177\u5907\u50cf gRPC \u90a3\u6837\u7684 duplexing \u591a\u8def\u590d\u7528\u7684\u9ad8\u7ea7\u529f\u80fd\u3002\u5f53\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u8fde\u63a5\u65f6\uff0c\u5fc5\u987b\u52a0\u9501\uff0c\u907f\u514d\u5176\u5b83\u7ebf\u7a0b\u540c\u65f6\u4f7f\u7528\u8be5\u8fde\u63a5\u3002\u4e3a\u4e86\u63d0\u5347\u5ba2\u6237\u7aef\u6027\u80fd\uff0c\u6709\u5fc5\u8981\u5305\u88c5\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u6c60\u6765\u51cf\u5c11\u7ebf\u7a0b\u4e4b\u95f4\u7684\u7ade\u4e89\u3002\n\n```\n# coding: utf-8\n# client.py\nimport sys\nsys.path.append(\"gen-py\")\n\nfrom thrift.transport import TSocket, TTransport\nfrom thrift.protocol import TCompactProtocol\n\nfrom pi.PiService import Client\nfrom pi.ttypes import PiRequest, IllegalArgument\n\nif __name__ == '__main__':\n    sock = TSocket.TSocket(\"127.0.0.1\", 8888)\n    transport = TTransport.TBufferedTransport(sock)  # \u7f13\u51b2\u6a21\u5f0f\n    protocol = TCompactProtocol.TCompactProtocol(transport)  # \u7d27\u51d1\u6a21\u5f0f\n    client = Client(protocol)\n\n    transport.open()  # \u5f00\u542f\u8fde\u63a5\n    for i in range(10):\n        try:\n            res = client.calc(PiRequest(n=i))\n            print \"pi(%d) =\" % i, res.value\n        except IllegalArgument as ia:  # \u6355\u83b7\u5f02\u5e38\n            print \"pi(%d)\" % i, ia.message\n    transport.close()  # \u5173\u95ed\u8fde\u63a5\n\n```\n\n**\u8d85\u65f6\u673a\u5236**\n\nThrift \u7684\u8d85\u65f6\u673a\u5236\u662f\u901a\u8fc7\u5957\u63a5\u5b57\u7684 timeout \u5c5e\u6027\u6765\u63a7\u5236\u8bfb\u5199\u8d85\u65f6\u7684\uff0cgRPC \u5219\u662f\u901a\u8fc7\u5b9a\u65f6\u5668\u6765\u63a7\u5236\u7684\u3002Thrift \u5ba2\u6237\u7aef\u4e00\u65e6\u51fa\u73b0\u8d85\u65f6\uff0c\u5f80\u5f80\u610f\u5473\u7740\u5f53\u524d\u8fde\u63a5\u9700\u8981\u5173\u95ed\u5e76\u91cd\u65b0\u5efa\u7acb\u65b0\u8fde\u63a5\uff0c\u624d\u80fd\u4fdd\u8bc1\u94fe\u8def\u6570\u636e\u7684\u5b8c\u6574\u6027\u3002\u4f46\u662f gRPC \u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u73b0\u6709\u7684\u901a\u9053\u800c\u4e0d\u7528\u7406\u4f1a\u5355\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u95ee\u9898\uff0c\u5982\u679c\u8d85\u65f6\u7684\u6d88\u606f\u53c8\u6536\u5230\u4e86\uff0cgRPC \u7684\u5ba2\u6237\u7aef Stub \u4f1a\u81ea\u52a8\u4e22\u5f03\u8fd9\u4e2a\u8fdf\u5230\u7684\u6d88\u606f\u3002\n\n## gRPC \u8fd8\u662f Thrift\uff1f\n\nPython \u7248\u672c\u7684 gRPC \u4e0d\u652f\u6301\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u8fd9\u4e2a\u662f gRPC \u7684\u7f3a\u70b9\uff0c\u4e0d\u8fc7 java \u548c golang \u7248\u672c\u7684 gRPC \u5c31\u4e0d\u5728\u4e4e\u591a\u8fdb\u7a0b\u6a21\u578b\u4e86\u3002\u540c\u65f6 gRPC \u8fd8\u4e0d\u652f\u6301\u5355\u5411\u6d88\u606f\uff0c\u5728\u534f\u8bae\u7684\u6548\u7387\u4e0a gRPC \u57fa\u4e8e HTTP2.0 \u534f\u8bae\uff0c\u8fd9\u4e2a\u80af\u5b9a\u662f\u65e0\u6cd5\u6297\u8861\u7eaf\u7cb9\u7684\u4e8c\u8fdb\u5236\u534f\u8bae\u7684\u3002\u4f46\u662f gRPC \u6709\u5b83\u81ea\u5df1\u7684\u7279\u8272\u4e4b\u5904\u5728\u4e8e\u5b83\u7684\u5ba2\u6237\u7aef\u662f\u591a\u8def\u590d\u7528\u7684\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u62ff\u8fc7\u6765\u76f4\u63a5\u4f7f\u7528\uff0c\u800c\u4e14\u591a\u8def\u590d\u7528\u7684\u5ba2\u6237\u7aef\u5728\u6548\u7387\u4e0a\u6709\u660e\u663e\u4f18\u52bf\u3002\u800c Thrift \u7684\u5ba2\u6237\u7aef\u8fd8\u9700\u8981\u7528\u6237\u81ea\u5df1\u53bb\u5c01\u88c5\u4e00\u4e2a\u8fde\u63a5\u6c60\u624d\u80fd\u8fdb\u5165\u53ef\u7528\u72b6\u6001\u3002gRPC \u867d\u7136\u4f7f\u7528\u4e86\u7a0d\u5fae\u6d6a\u8d39\u6d41\u91cf\u7684 HTTP2.0 \u534f\u8bae\uff0c\u4f46\u662f\u8003\u8651\u5230 HTTP \u534f\u8bae\u7684\u5e7f\u6cdb\u6027\uff0c\u672a\u6765\u652f\u6301 HTTP2.0 \u7684\u4ee3\u7406\u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\u3001\u8d1f\u8f7d\u5747\u8861\u4e2d\u95f4\u4ef6\u7b49\u4f1a\u8d8a\u6765\u8d8a\u591a\uff0cgRPC \u53ef\u4ee5\u76f4\u63a5\u900f\u660e\u5730\u5728\u8fd9\u4e9b\u4e2d\u95f4\u4ef6\u4e4b\u95f4\u8fdb\u884c\u8f6c\u53d1\u800c\u65e0\u9700\u8fdb\u884c\u590d\u6742\u7684\u534f\u8bae\u8f6c\u6362\u5de5\u4f5c\u3002Thrift \u5c31\u4e0d\u884c\u4e86\uff0c\u5b8c\u5168\u7684\u4e8c\u8fdb\u5236\u534f\u8bae\u56fa\u7136\u9ad8\u6548\uff0c\u4f46\u662f\u517c\u5bb9\u6027\u5c31\u5dee\u7684\u592a\u8fdc\u3002\n\n\u53e6\u5916\u5728\u5f00\u6e90\u5f71\u54cd\u529b\u4e0a\uff0cGoogle \u4e00\u76f4\u6bd4 Facebook \u5f3a\u52bf\u5f88\u591a\uff0c\u6211\u4eec\u4f7f\u7528\u7684 Google \u7684\u5f00\u6e90\u9879\u76ee\u8981\u6bd4 Facebook \u591a\u7684\u592a\u591a\u3002gRPC \u51fa\u6765\u7684\u65f6\u95f4\u8981\u6bd4 Thrift \u8981\u665a\uff0cGoogle \u81ea\u7136\u662f\u77e5\u9053 gRPC \u8981\u6bd4 Thrift \u76f8\u6bd4\u6709\u660e\u663e\u7684\u4f18\u52bf\u6240\u4ee5\u624d\u6562\u653e\u51fa\u6765\u5f00\u6e90\u7684\u3002\n\n\u8fd8\u6709\u5728\u6587\u6863\u4e0a\uff0c\u4e2a\u4eba\u89c9\u5f97 gRPC \u7684\u6587\u6863\u8981\u4f18\u79c0\u4e00\u4e9b\uff0c\u81f3\u5c11\u5728\u76f4\u89c2\u4e0a\u8981\u8d4f\u5fc3\u60a6\u76ee\u5f88\u591a\u3002\u6211\u4eec\u53bb\u770b Thrift \u7684\u5b98\u65b9\u6587\u6863\uff0c\u8fd8\u662f\u8001\u65e7\u7684\u591a\u5e74\u4ee5\u524d\u7684\u7070\u6697\u98ce\u683c\u7684\u6587\u6863\uff0c\u6587\u6863\u4e2d\u6709\u597d\u591a\u8fde\u63a5\u70b9\u51fb\u7684\u65f6\u5019\u5c45\u7136 404\uff0c\u53ef\u89c1\u6587\u6863\u5df2\u7ecf\u5f88\u4e45\u5904\u4e8e\u65e0\u4eba\u7ef4\u62a4\u7684\u72b6\u6001\u3002\n\n\u4f46\u662f Thrift \u7684\u6e90\u7801\u8981\u7b80\u5355\u5f88\u591a\uff0c\u5b83\u7684 py \u7248\u672c\u51e0\u4e4e\u5168\u662f\u7eaf\u7cb9\u7684 Python \u8bed\u8a00\u7f16\u5199\u7684\uff0c\u5982\u679c\u8981\u7814\u7a76\u6e90\u7801\u7684\u8bdd\uff0c\u8fd8\u662f\u5e94\u8be5\u9009\u62e9 Thrift\u3002\u8bfb\u8005\u53ef\u4ee5\u5c1d\u8bd5\u53bb\u770b\u770b gRPC \u7684\u6e90\u7801\uff0c\u6700\u7ec8\u90fd\u9700\u8981\u6df1\u5165\u5230\u5e95\u5c42 HTTP2.0 \u7684 c \u8bed\u8a00\u5b9e\u73b0\uff0c\u4ee3\u7801\u5de8\u5927\u65e0\u6bd4\uff0c\u8001\u5e08\u6211\u662f\u770b\u7684\u5f88\u5934\u75bc\uff0c\u6240\u4ee5\u6211\u4e5f\u4e0d\u5efa\u8bae\u8bfb\u8005\u53bb\u82b1\u8d39\u8fc7\u591a\u7cbe\u529b\u53bb\u7814\u7a76\u3002\u5982\u679c\u8981\u6df1\u5165 gRPC \u7684\u539f\u7406\uff0c\u8fd8\u4e0d\u5982\u53bb Github \u4e0a\u770b gRPC \u7684\u4e30\u5bcc\u7684\u6587\u6863\u6765\u5f97\u76f4\u63a5\u3002\n\n## \u4f5c\u4e1a\n\n1.  \u5c1d\u8bd5\u4f7f\u7528\u5176\u5b83\u670d\u52a1\u5668\u6a21\u578b\u5982\u591a\u8fdb\u7a0b\u6a21\u578b\u3001\u5f02\u6b65\u6a21\u578b\u6765\u66ff\u6362\u4e0a\u9762\u7684\u591a\u7ebf\u7a0b\u6a21\u578b\uff1b\n2.  \u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684 Thrift \u5ba2\u6237\u7aef\u8fde\u63a5\u6c60\uff1b\n3.  \u5bf9 Thrift \u7f16\u5199\u7684 RPC \u670d\u52a1\u589e\u52a0\u5206\u5e03\u5f0f\u670d\u52a1\u53d1\u73b0\u529f\u80fd\uff1b", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u62d3\u5c55_2Thrift_\u539f\u7406\u4e0e\u5b9e\u8df5.md", "create_date": "2020-02-18T21:31:51.725", "order": 19}}, {"model": "subject.chapter", "pk": 92, "fields": {"title": "\u5c3e\u58f0\uff1a\u63a8\u8350\u5b66\u4e60\u8d44\u6e90", "topic": 4, "md5": "98bcae0a82e0b5b2c9ceba410d53e070", "md_body": "# \u5c3e\u58f0\uff1a\u603b\u7ed3 & \u63a8\u8350\u5b66\u4e60\u8d44\u6e90\n\n![](https://user-gold-cdn.xitu.io/2018/6/9/163e40287967a3a9?w=680&h=678&f=png&s=1087519)\n\n\u8bfb\u8005\u4eec\uff0c\u5f53\u4f60\u4eec\u7406\u89e3\u4e86\u672c\u5c0f\u518c\u8bb2\u89e3\u7684 RPC \u670d\u52a1\u6838\u5fc3\u5185\u5bb9\u548c\u793a\u4f8b\uff0c\u5e76\u4e00\u6b65\u6b65\u89e3\u51b3\u4e86\u5b66\u4e60\u5f53\u4e2d\u9047\u5230\u7684\u95ee\u9898\uff0c\u6700\u7ec8\u6765\u5230\u4e86\u8fd9\u91cc\uff0c\u53ef\u4ee5\u8bf4\uff0c\u4f60\u4eec\u5b8c\u6210\u4e86\u4e00\u4e2a\u4e86\u4e0d\u8d77\u7684\u6311\u6218\uff0c\u606d\u559c\u4f60\u4eec\u6536\u83b7\u4e86\u300c\u9020\u8f6e\u5b50\u5b66\u4e60\u6cd5\u300d\u7684\u5b9e\u6218\u7ecf\u9a8c\uff01\n\n## \u603b\u7ed3\n\n\u901a\u8fc7\u8fd9\u6bb5\u5f81\u9014\uff0c\u4f60\u4eec\u5e94\u8be5\u4f1a\u53d1\u73b0\uff0c\u540e\u7aef\u5f00\u53d1\u8005\u5728\u5e73\u65f6\u5de5\u4f5c\u4e2d\u7528\u5230\u7684\u5404\u79cd\u670d\u52a1\u5668\u5de5\u5177\u5c31\u662f\u57fa\u4e8e\u8fd9\u672c\u5c0f\u518c\u4e2d\u4ecb\u7ecd\u7684\u5404\u79cd\u4fe1\u606f\u4ea4\u4e92\u6a21\u578b\u6784\u5efa\u51fa\u6765\u7684\u3002\u65e0\u8bba\u662f Nginx\u3001Redis\u3001MySQL\uff0c\u8fd8\u662f Tornado\u3001Nodejs\u3001Tomcat\u3001Netty \u7b49\u7b49\uff0c\u5b83\u4eec\u7684\u6838\u5fc3\u7ed3\u6784\u5c31\u662f\u591a\u7ebf\u7a0b\u3001\u591a\u8fdb\u7a0b\u3001PreForking\u3001\u4e8b\u4ef6\u5faa\u73af\u3001\u5f02\u6b65 IO \u7b49\u3002\n\n\u5728\u5b8c\u6210\u8fd9\u4e2a\u6311\u6218\u540e\uff0c\u4e0b\u4e00\u4e2a\u9636\u6bb5\u7684\u300c\u9020\u8f6e\u5b50\u300d\u76ee\u6807\u53c8\u662f\u4ec0\u4e48\u5462\uff1f\n\n\u5982\u679c\u4f60\u80fd\u518d\u53bb\u4ed4\u7ec6\u9605\u8bfb HTTP \u7684\u534f\u8bae\u6587\u6863\uff0cRedis \u7684\u534f\u8bae\u6587\u6863\uff0c\u90a3\u4e48\u8ddd\u79bb\u4f60\u81ea\u5df1\u53bb\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 HTTP \u670d\u52a1\u5668\u548c\u5355\u673a\u7248\u672c\u7684\u5185\u5b58\u6570\u636e\u5e93\u5df2\u7ecf\u4e0d\u662f\u5f88\u8fdc\u4e86\u3002\u4f60\u4e5f\u5c06\u66f4\u52a0\u63a5\u8fd1\u5fc3\u4e2d\u7684\u76ee\u6807 \u2014\u2014 \u771f\u6b63\u7684\u540e\u7aef\u5927\u4f6c\u3002\n\n\u4f46\u662f\u8fdc\u65b9\u7684\u8def\uff0c\u8fd9\u672c\u5c0f\u518c\u5df2\u7ecf\u4e0d\u80fd\u518d\u966a\u4f60\u4eec\u7ee7\u7eed\u884c\u8d70\u4e86\uff0c\u5728\u8fd9\u91cc\u8865\u5145\u4e00\u4e9b\u8fdb\u9636\u5b66\u4e60\u8d44\u6e90\u63a8\u8350\u3002\n\n## \u63a8\u8350\u8fdb\u9636\u5b66\u4e60\u8d44\u6e90\n\n1.  [\u300aTCP Sockets \u7f16\u7a0b\u300b](http://www.ituring.com.cn/book/1176)\n2.  [\u300aUNIX \u73af\u5883\u9ad8\u7ea7\u7f16\u7a0b\u300b](https://book.douban.com/subject/1788421/)\n3.  [\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b](https://book.douban.com/subject/25900156/)\n4.  [\u300aPython \u6e90\u7801\u5256\u6790\u300b](https://book.douban.com/subject/3117898/)\n5.  [EINTR \u7684\u6b63\u786e\u4f7f\u7528\u65b9\u5f0f](http://250bpm.com/blog:12)\n6.  [kazoo api](https://kazoo.readthedocs.io/en/latest/api/client.html)\n7.  [Python \u591a\u8fdb\u7a0b\u7f16\u7a0b\u57fa\u7840\u2014\u2014\u56fe\u6587\u7248](https://juejin.im/post/5b0a88b4f265da0db06e4385)\n8.  [Python \u8fdb\u7a0b\u95f4\u901a\u4fe1\u539f\u7406\u4e0e\u5b9e\u6218\u2014\u2014\u56fe\u6587\u7248](https://juejin.im/post/5b0abab451882538c220440b)\n\n## \u8001\u94b1\u7684\u4e13\u680f\n\n\u6700\u540e\uff0c\u53cb\u60c5\u63a8\u8350\u4e0b\u8001\u94b1\u81ea\u5df1\u7684\u6280\u672f\u516c\u4f17\u53f7\u300c\u7801\u6d1e\u300d\uff0c\u5185\u90e8\u6709\u975e\u5e38\u591a\u7684\u539f\u521b\u6280\u672f\u6587\u7ae0\u503c\u5f97\u4e00\u770b\uff0c\u8001\u94b1\u540e\u7eed\u7684\u6700\u65b0\u539f\u521b\u4e5f\u4f1a\u540c\u6b65\u5728\u5fae\u4fe1\u516c\u4f17\u53f7\u4e2d\u3002\u4f7f\u7528\u5fae\u4fe1\u626b\u4e00\u626b\u4e0b\u9762\u7684\u4e8c\u7ef4\u7801\u5373\u53ef\u5165\u6d1e\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/7/9/1647e959be074ee0?w=258&h=258&f=jpeg&s=27484)\n\n## \u8001\u94b1\u5bc4\u8bed\n\n> \u4e16\u4e4b\u5947\u4f1f\u3001\u7470\u602a\u3001\u975e\u5e38\u4e4b\u89c2\uff0c\u5e38\u5728\u4e8e\u9669\u8fdc\u3002\n\n> \u8def\u6f2b\u6f2b\u5176\u4fee\u8fdc\u516e\uff0c\u543e\u5c06\u4e0a\u4e0b\u800c\u6c42\u7d22\u3002\n\n\u4e0e\u8bf8\u4f4d\u5f00\u53d1\u8005\u670b\u53cb\u5171\u52c9\uff0c\u5728\u300c\u9020\u66f4\u597d\u7684\u8f6e\u5b50\u300d\u8def\u4e0a\u5e76\u80a9\u524d\u884c\uff01\u52a0\u6cb9\uff01\u26fd\ufe0f", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u5c3e\u58f0\u63a8\u8350\u5b66\u4e60\u8d44\u6e90.md", "create_date": "2020-02-18T21:31:51.743", "order": 20}}, {"model": "subject.chapter", "pk": 93, "fields": {"title": "\u534f\u8bae 2\uff1aRedis \u6587\u672c\u534f\u8bae\u7ed3\u6784", "topic": 4, "md5": "5ab2ea2d510bc73e8451f4b9671b5b21", "md_body": "# \u534f\u8bae 2\uff1aRedis \u6587\u672c\u534f\u8bae\u7ed3\u6784\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/1637757f34821de2?w=1200&h=401&f=png&s=50682)\n\nRedis \u5728\u4e92\u8054\u7f51\u5b58\u50a8\u6280\u672f\u4e0a\u4f7f\u7528\u975e\u5e38\u666e\u904d\uff0c\u5b83\u4ee5\u9ad8\u6027\u80fd\u9ad8\u5e76\u53d1\u3001\u6613\u4e8e\u7406\u89e3\u548c\u6613\u4e8e\u4f7f\u7528\u800c\u5e7f\u6cdb\u5e94\u7528\u4e8e\u4e92\u8054\u7f51\u670d\u52a1\u7684\u5b58\u50a8\u7cfb\u7edf\u4e0a\u3002\n\nRedis \u8981\u5bf9\u5916\u63d0\u4f9b\u5b58\u50a8\u670d\u52a1\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u514d\u4e0d\u4e86\u4e5f\u8981\u8fdb\u884c RPC \u901a\u4fe1\uff0cRedis \u4f5c\u8005 Antirez \u4e3a Redis \u8bbe\u8ba1\u4e86\u4e00\u5957\u4e13\u7528\u7684\u6587\u672c\u901a\u8baf\u534f\u8bae RESP\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/9/163e3f79f3ac85fd?w=910&h=550&f=png&s=105102)\n\nAntirez \u8ba4\u4e3a\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u74f6\u9888\u4e00\u822c\u4e0d\u5728\u4e8e\u7f51\u7edc\u6d41\u91cf\uff0c\u800c\u662f\u6570\u636e\u5e93\u81ea\u8eab\u5185\u90e8\u903b\u8f91\u5904\u7406\u4e0a\u3002\u6240\u4ee5\u5373\u4f7f Redis \u4f7f\u7528\u4e86\u6d6a\u8d39\u6d41\u91cf\u7684\u6587\u672c\u534f\u8bae\uff0c\u4f9d\u7136\u53ef\u4ee5\u53d6\u5f97\u6781\u9ad8\u7684\u8bbf\u95ee\u6027\u80fd\u3002Redis \u5c06\u6240\u6709\u6570\u636e\u90fd\u653e\u5728\u5185\u5b58\uff0c\u7528\u4e00\u4e2a\u5355\u7ebf\u7a0b\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5355\u4e2a\u8282\u70b9\u5728\u8dd1\u6ee1\u4e00\u4e2a CPU \u6838\u5fc3\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u8fbe\u5230\u4e86 10w/s \u7684\u8d85\u9ad8 QPS\u3002\n\n## \u6df1\u5165\u7406\u89e3 RESP (Redis Serialization Protocol)\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b4ebb8d0eda9b?w=749&h=254&f=png&s=26822)\n\nRESP \u662f Redis \u5e8f\u5217\u5316\u534f\u8bae\u7684\u7b80\u5199\u3002\u5b83\u662f\u4e00\u79cd\u76f4\u89c2\u7684\u6587\u672c\u534f\u8bae\uff0c\u4f18\u52bf\u5728\u4e8e\u5b9e\u73b0\u5f02\u5e38\u7b80\u5355\uff0c\u89e3\u6790\u6027\u80fd\u6781\u597d\u3002\n\nRedis \u534f\u8bae\u5c06\u4f20\u8f93\u7684\u7ed3\u6784\u6570\u636e\u5206\u4e3a 5 \u79cd\u6700\u5c0f\u5355\u5143\u7c7b\u578b\uff0c\u5355\u5143\u7ed3\u675f\u65f6\u7edf\u4e00\u52a0\u4e0a\u56de\u8f66\u6362\u884c\u7b26\u53f7`\\r\\n`\u3002\n\n1.  \u5355\u884c\u5b57\u7b26\u4e32 \u4ee5`+`\u7b26\u53f7\u5f00\u5934\uff1b\n2.  \u591a\u884c\u5b57\u7b26\u4e32 \u4ee5`$`\u7b26\u53f7\u5f00\u5934\uff0c\u540e\u8ddf\u5b57\u7b26\u4e32\u957f\u5ea6\uff1b\n3.  \u6574\u6570\u503c \u4ee5`:`\u7b26\u53f7\u5f00\u5934\uff0c\u540e\u8ddf\u6574\u6570\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\uff1b\n4.  \u9519\u8bef\u6d88\u606f \u4ee5`-`\u7b26\u53f7\u5f00\u5934\uff1b\n5.  \u6570\u7ec4 \u4ee5`*`\u53f7\u5f00\u5934\uff0c\u540e\u8ddf\u6570\u7ec4\u7684\u957f\u5ea6\uff1b\n\n**\u5355\u884c\u5b57\u7b26\u4e32** hello world\n\n```\n+hello world\\r\\n\n\n```\n\n\u76f4\u89c2\u6253\u5370\u5982\u4e0b\uff1a\n\n```\n+hello world\n\n\n```\n\n**\u591a\u884c\u5b57\u7b26\u4e32** \u7b2c\u4e00\u884c\u662f\u957f\u5ea6\uff0c\u5269\u4e0b\u7684\u662f\u5185\u5bb9\uff0c\u8868\u793a\u5b57\u7b26\u4e32 hello world \u5982\u4e0b\uff1a\n\n```\n$11\\r\\nhello world\\r\\n\n\n```\n\n\u76f4\u89c2\u6253\u5370\u5982\u4e0b\uff1a\n\n```\n$11\nhello world\n\n\n```\n\n\u591a\u884c\u5b57\u7b26\u4e32\u5f53\u7136\u4e5f\u53ef\u4ee5\u8868\u793a\u5355\u884c\u5b57\u7b26\u4e32\u3002\n\n**\u6574\u6570** \u5192\u53f7\u5f00\u5934 \u8868\u793a\u6574\u6570 1024 \u5982\u4e0b\uff1a\n\n```\n:1024\\r\\n\n\n```\n\n\u76f4\u89c2\u6253\u5370\u5982\u4e0b\uff1a\n\n```\n:1024\n\n\n```\n\n**\u9519\u8bef** \u51cf\u53f7\u5f00\u5934\u540e\u8ddf\u9519\u8bef\u540d\u79f0\u548c\u8be6\u7ec6\u9519\u8bef\u89e3\u91ca \u8868\u793a\u300c\u53c2\u6570\u7c7b\u578b\u9519\u8bef\u300d\u5982\u4e0b\uff1a\n\n```\n-WRONGTYPE Operation against a key holding the wrong kind of value\\r\\n\n\n```\n\n\u76f4\u89c2\u6253\u5370\u5982\u4e0b\uff1a\n\n```\n-WRONGTYPE Operation against a key holding the wrong kind of value\n\n\n```\n\n**\u6570\u7ec4** \u7b2c\u4e00\u884c\u662f\u957f\u5ea6\uff0c\u540e\u9762\u4f9d\u6b21\u662f\u6bcf\u4e2a\u5185\u5bb9\uff0c\u8868\u793a\u6570\u7ec4 \\[1,2,3\\] \u5982\u4e0b\uff1a\n\n```\n*3\\r\\n:1\\r\\n:2\\r\\n:3\\r\\n\n\n```\n\n\u76f4\u89c2\u6253\u5370\u5982\u4e0b\uff1a\n\n```\n*3\n:1\n:2\n:3\n\n\n```\n\n\u6570\u7ec4\u91cc\u9762\u53ef\u4ee5\u5d4c\u5957\u5176\u5b83\u7c7b\u578b\uff0c\u751a\u81f3\u53ef\u4ee5\u5d4c\u5957\u53e6\u5916\u4e00\u4e2a\u6570\u7ec4\uff0c\u5982\u6b64\u5c31\u53ef\u4ee5\u5f62\u6210\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\u3002\n\n**NULL** \u7528\u591a\u884c\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u4e0d\u8fc7\u957f\u5ea6\u8981\u5199\u6210-1\u3002\n\n```\n$-1\\r\\n\n\n```\n\n\u76f4\u89c2\u6253\u5370\u5982\u4e0b\uff1a\n\n```\n$-1\n\n\n```\n\n**\u7a7a\u4e32** \u7528\u591a\u884c\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u957f\u5ea6\u586b 0\u3002\n\n```\n$0\\r\\n\\r\\n\n\n```\n\n\u76f4\u89c2\u6253\u5370\u5982\u4e0b\uff1a\n\n```\n$0\n\n\n\n```\n\n\u6ce8\u610f\u8fd9\u91cc\u6709\u4e24\u4e2a`\\r\\n`\uff0c\u4e3a\u4ec0\u4e48\u662f\u4e24\u4e2a\uff0c\u56e0\u4e3a\u4e24\u4e2a`\\r\\n` \u4e4b\u95f4\u9694\u7684\u662f\u7a7a\u4e32\u3002\n\n## \u53d1\u9001\u6307\u4ee4\uff1a\u5ba2\u6237\u7aef -> \u670d\u52a1\u5668\n\n\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u7684\u6307\u4ee4\u53ea\u6709\u4e00\u79cd\u683c\u5f0f\uff0c\u591a\u884c\u5b57\u7b26\u4e32\u6570\u7ec4\u3002\u6bd4\u5982\u4e00\u4e2a\u7b80\u5355\u7684 set \u6307\u4ee4`set author codehole`\u4f1a\u88ab\u5e8f\u5217\u5316\u6210\u4e0b\u9762\u7684\u5b57\u7b26\u4e32\u3002\n\n```\n*3\\r\\n$3\\r\\nset\\r\\n$6\\r\\nauthor\\r\\n$8\\r\\ncodehole\\r\\n\n\n```\n\n\u5728\u63a7\u5236\u53f0\u8f93\u51fa\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u51fa\u8fd9\u662f\u5f88\u597d\u9605\u8bfb\u7684\u4e00\u79cd\u683c\u5f0f\u3002\n\n```\n*3\n$3\nset\n$6\nauthor\n$8\ncodehole\n\n\n```\n\n## \u53d1\u9001\u6307\u4ee4\uff1a\u670d\u52a1\u5668 -> \u5ba2\u6237\u7aef\n\n\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u56de\u590d\u7684\u54cd\u5e94\u8981\u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u6240\u4ee5\u6d88\u606f\u54cd\u5e94\u5728\u7ed3\u6784\u4e0a\u8981\u590d\u6742\u4e0d\u5c11\u3002\u4e0d\u8fc7\u518d\u590d\u6742\u7684\u54cd\u5e94\u6d88\u606f\u4e5f\u662f\u4ee5\u4e0a 5 \u4e2d\u57fa\u672c\u7c7b\u578b\u7684\u7ec4\u5408\u3002\n\n**\u5355\u884c\u5b57\u7b26\u4e32\u54cd\u5e94**\n\n```\n127.0.0.1:6379> set author codehole\nOK\n\n```\n\n\u8fd9\u91cc\u7684 OK \u5c31\u662f\u5355\u884c\u54cd\u5e94\uff0c\u6ca1\u6709\u4f7f\u7528\u5f15\u53f7\u62ec\u8d77\u6765\u3002\n\n```\n+OK\n\n\n```\n\n**\u9519\u8bef\u54cd\u5e94**\n\n```\n127.0.0.1:6379> incr author\n(error) ERR value is not an integer or out of range\n\n```\n\n\u8bd5\u56fe\u5bf9\u4e00\u4e2a\u5b57\u7b26\u4e32\u8fdb\u884c\u81ea\u589e\uff0c\u670d\u52a1\u5668\u629b\u51fa\u4e00\u4e2a\u901a\u7528\u7684\u9519\u8bef\u3002\n\n```\n-ERR value is not an integer or out of range\n\n\n```\n\n**\u6574\u6570\u54cd\u5e94**\n\n```\n127.0.0.1:6379> incr books\n(integer) 1\n\n```\n\n\u8fd9\u91cc\u7684`1`\u5c31\u662f\u6574\u6570\u54cd\u5e94\u3002\n\n```\n:1\n\n\n```\n\n**\u591a\u884c\u5b57\u7b26\u4e32\u54cd\u5e94**\n\n```\n127.0.0.1:6379> get author\n\"codehole\"\n\n```\n\n\u8fd9\u91cc\u4f7f\u7528\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\u7684\u5b57\u7b26\u4e32\u5c31\u662f\u591a\u884c\u5b57\u7b26\u4e32\u54cd\u5e94\u3002\n\n```\n$8\ncodehole\n\n\n```\n\n**\u6570\u7ec4\u54cd\u5e94**\n\n```\n127.0.0.1:6379> hset info name laoqian\n(integer) 1\n127.0.0.1:6379> hset info age 30\n(integer) 1\n127.0.0.1:6379> hset info sex male\n(integer) 1\n127.0.0.1:6379> hgetall info\n1) \"name\"\n2) \"laoqian\"\n3) \"age\"\n4) \"30\"\n5) \"sex\"\n6) \"male\"\n\n```\n\n\u8fd9\u91cc\u7684 hgetall \u547d\u4ee4\u8fd4\u56de\u7684\u5c31\u662f\u4e00\u4e2a\u6570\u503c\uff0c\u7b2c 0|2|4 \u4f4d\u7f6e\u7684\u5b57\u7b26\u4e32\u662f hash \u8868\u7684 key\uff0c\u7b2c 1|3|5 \u4f4d\u7f6e\u7684\u5b57\u7b26\u4e32\u662f value\uff0c\u5ba2\u6237\u7aef\u8d1f\u8d23\u5c06\u6570\u7ec4\u7ec4\u88c5\u6210\u5b57\u5178\u518d\u8fd4\u56de\u3002\n\n```\n*6\n$4\nname\n$6\nlaoqian\n$3\nage\n$2\n30\n$3\nsex\n$4\nmale\n\n\n```\n\n**\u5d4c\u5957**\n\n```\n127.0.0.1:6379> scan 0\n1) \"0\"\n2) 1) \"info\"\n   2) \"books\"\n   3) \"author\"\n\n```\n\nscan \u547d\u4ee4\u7528\u6765\u626b\u63cf\u670d\u52a1\u5668\u5305\u542b\u7684\u6240\u6709 key \u5217\u8868\uff0c\u5b83\u662f\u4ee5\u6e38\u6807\u7684\u5f62\u5f0f\u83b7\u53d6\uff0c\u4e00\u6b21\u53ea\u83b7\u53d6\u4e00\u90e8\u5206\u3002\n\nscan \u547d\u4ee4\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5d4c\u5957\u6570\u7ec4\u3002\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u503c\u8868\u793a\u6e38\u6807\u7684\u503c\uff0c\u5982\u679c\u8fd9\u4e2a\u503c\u4e3a\u96f6\uff0c\u8bf4\u660e\u5df2\u7ecf\u904d\u5386\u5b8c\u6bd5\u3002\u5982\u679c\u4e0d\u4e3a\u96f6\uff0c\u4f7f\u7528\u8fd9\u4e2a\u503c\u4f5c\u4e3a scan \u547d\u4ee4\u7684\u53c2\u6570\u8fdb\u884c\u4e0b\u4e00\u6b21\u904d\u5386\u3002\u6570\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u503c\u53c8\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u8fd9\u4e2a\u6570\u7ec4\u5c31\u662f key \u5217\u8868\u3002\n\n```\n*2\n$1\n0\n*3\n$4\ninfo\n$5\nbooks\n$6\nauthor\n\n```\n\n## \u5c0f\u7ed3\n\n\u867d\u7136 Redis \u534f\u8bae\u91cc\u6709\u5927\u91cf\u5197\u4f59\u7684\u56de\u8f66\u6362\u884c\u7b26\uff0c\u4f46\u662f\u8fd9\u5e76\u4e0d\u5f71\u54cd\u5b83\u6210\u4e3a\u4e92\u8054\u7f51\u6280\u672f\u9886\u57df\u975e\u5e38\u53d7\u6b22\u8fce\u7684\u4e00\u4e2a\u6587\u672c\u534f\u8bae\u3002\u6709\u5f88\u591a\u5f00\u6e90\u9879\u76ee\u4f7f\u7528 RESP \u4f5c\u4e3a\u5b83\u7684\u901a\u8baf\u534f\u8bae\u3002\u56e0\u4e3a\u5728\u6280\u672f\u9886\u57df\uff0c\u6027\u80fd\u5e76\u4e0d\u603b\u662f\u4ee3\u8868\u4e00\u5207\uff0c\u6709\u65f6\u8fd8\u8981\u8003\u8651\u7b80\u5355\u6027\u3001\u6613\u7406\u89e3\u6027\u548c\u6613\u5b9e\u73b0\u6027\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u8fdb\u884c\u9002\u5f53\u6743\u8861\u3002\n\nRedis \u534f\u8bae\u4f5c\u4e3a\u5f00\u6e90\u534f\u8bae\u4e2d\u7684\u4e00\u6735\u5947\u8469\uff0c\u5b83\u5e76\u6ca1\u6709\u5411\u7f51\u7edc\u6d41\u91cf\u503e\u659c\u8fdb\u884c\u6781\u81f4\u4f18\u5316\uff0c\u800c\u662f\u9009\u62e9\u4e86\u7167\u987e\u534f\u8bae\u7684\u76f4\u89c2\u6027\u3001\u53ef\u7406\u89e3\u6027\u3002\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u62ff\u53e6\u4e00\u4e2a\u5e7f\u4e3a\u4f7f\u7528\u7684\u534f\u8bae Protobuf \u4f5c\u4e3a\u6837\u672c\u505a\u4ecb\u7ecd\u3002\u76f8\u5bf9\u4e8e Redis\uff0cProtobuf \u5728\u6d41\u91cf\u4e0a\u505a\u5230\u4e86\u6781\u81f4\u4f18\u5316\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u7684\u534f\u8bae\uff0c\u6240\u4ee5\u6ce8\u5b9a\u5bf9\u4eba\u7c7b\u4e0d\u592a\u53cb\u597d\uff0c\u4f46\u662f\u5b83\u7684\u4f7f\u7528\u771f\u7684\u662f\u592a\u592a\u5e7f\u6cdb\u5566\uff0c\u8bfb\u8005\u4eec\u5fc5\u987b\u8010\u5fc3\u638c\u63e1\u3002\n\n## \u7ec3\u4e60\n\n\u8bf7\u8bfb\u8005\u5c1d\u8bd5\u4fee\u6539\u4e00\u4e0b redis-py \u7684\u6e90\u7801\uff0c\u5728\u91cc\u9762\u589e\u52a0\u8f93\u5165\u8f93\u51fa\u6d88\u606f\u7684\u6253\u5370\u3002\u7136\u540e\u89c2\u5bdf Redis \u5e38\u7528\u6307\u4ee4\u5bf9\u5e94\u7684\u8f93\u5165\u8f93\u51fa\u6d88\u606f\u7684\u5177\u4f53\u683c\u5f0f\u3002\n\n### \u6269\u5c55\u9605\u8bfb\n\n\u6700\u8fd1\uff0cRedis \u4f5c\u8005\u5bf9 RESP \u534f\u8bae\u8fdb\u884c\u4e86\u5347\u7ea7\uff0c\u53c8\u589e\u52a0\u4e86\u597d\u591a\u6570\u636e\u7c7b\u578b\u3002\u8fd9\u4e9b\u65b0\u5185\u5bb9\u4f3c\u4e4e\u8ba9\u672c\u6765\u5f88\u7b80\u5355\u7684\u6587\u672c\u534f\u8bae\u5728\u5347\u7ea7\u4e4b\u540e\u53d8\u5f97\u590d\u6742\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u70b9\u51fb\u4e0b\u9762\u94fe\u63a5\u9605\u8bfb\u3002\n\n*   [RESP3 \u534f\u8bae\u8349\u7a3f](https://gist.github.com/antirez/2bc68a9e9e45395e297d288453d5d54c)", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u534f\u8bae_2Redis_\u6587\u672c\u534f\u8bae\u7ed3\u6784.md", "create_date": "2020-02-18T21:31:51.759", "order": 4}}, {"model": "subject.chapter", "pk": 94, "fields": {"title": "\u5ba2\u6237\u7aef\uff1a\u6df1\u5165 RPC \u5ba2\u6237\u7aef\u8bbe\u8ba1", "topic": 4, "md5": "dae516fd3cbae30da844c8204eb2a91e", "md_body": "# \u5ba2\u6237\u7aef\uff1a\u6df1\u5165 RPC \u5ba2\u6237\u7aef\u8bbe\u8ba1\n\nRPC \u5ba2\u6237\u7aef\u5b9e\u73b0\u8d77\u6765\u8981\u6bd4\u670d\u52a1\u5668\u7b80\u5355\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u8bb2\u5ba2\u6237\u7aef\u7684\u5b9e\u73b0\u539f\u7406\u548c\u65b9\u6cd5\u3002\u5f53\u7136\uff0c\u5b9e\u73b0 RPC \u5ba2\u6237\u7aef\u4e5f\u5177\u6709\u4e00\u5b9a\u7684\u6311\u6218\u6027\uff0c\u5176\u6838\u5fc3\u96be\u70b9\u5728\u4e8e\u5ba2\u6237\u7aef\u5f80\u5f80\u5e76\u4e0d\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u591a\u7ebf\u7a0b\u4e0b\u5982\u4f55\u6d41\u7545\u4f7f\u7528\u5ba2\u6237\u7aef\u800c\u4e0d\u51fa\u73b0\u5e76\u53d1\u95ee\u9898\u3002\n\n\u6211\u4eec\u5c06\u6839\u636e\u4e0b\u56fe\u6240\u793a\u7684\u6a21\u578b\u56fe\u9010\u6b65\u8bb2\u89e3\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/5/11/1634e1ec1502a924?w=775&h=464&f=png&s=50901)\n\n\u5728\u591a\u7ebf\u7a0b\u5ba2\u6237\u7aef\u4e2d\uff0c\u5ba2\u6237\u7aef\u548c\u6570\u636e\u5e93\u4e4b\u95f4\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u8fde\u63a5\u6c60\u3002\u5f53\u7ebf\u7a0b\u4e2d\u7684\u4ee3\u7801\u9700\u8981\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u5148\u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u4e00\u4e2a\u8fde\u63a5\uff0c\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92\u5b8c\u6210\u540e\u518d\u5c06\u8fd9\u4e2a\u8fde\u63a5\u5f52\u8fd8\u7ed9\u7ebf\u7a0b\u6c60\u3002\u6240\u4ee5\u5bf9\u4e8e\u4e1a\u52a1\u7ebf\u7a0b\u6765\u8bf4\uff0c\u62ff\u5230\u7684\u8fde\u63a5\u4e0d\u4f1a\u540c\u65f6\u88ab\u5176\u5b83\u7ebf\u7a0b\u5171\u4eab\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u907f\u514d\u4e86\u5e76\u53d1\u95ee\u9898\u3002\n\n\u53e6\u5916\uff0c\u670d\u52a1\u5668\u7684\u6027\u80fd\u5f80\u5f80\u968f\u7740\u5e76\u53d1\u8fde\u63a5\u6570\u91cf\u7684\u589e\u52a0\u800c\u4e0b\u964d\uff0c\u6240\u4ee5\u5fc5\u987b\u4e25\u683c\u63a7\u5236\u6709\u6548\u8fde\u63a5\u7684\u6570\u91cf\u3002\u8fde\u63a5\u6c60\u7684\u8fde\u63a5\u6570\u91cf\u4e0a\u9650\u662f\u6570\u636e\u5e93\u7684\u4e00\u5c42\u5821\u5792\uff0c\u907f\u514d\u5f53\u4e1a\u52a1\u7e41\u5fd9\u3001\u7ebf\u7a0b\u589e\u591a\u65f6\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u660e\u663e\u7684\u538b\u529b\u3002\n\n## \u5b89\u5168\u9501\n\n\u8fde\u63a5\u6c60\u4e3a\u591a\u7ebf\u7a0b\u800c\u8bbe\u8ba1\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u8bbf\u95ee\u7ebf\u7a0b\u6c60\u5bf9\u8c61\uff0c\u6240\u4ee5\u7ebf\u7a0b\u6c60\u9700\u8981\u4f7f\u7528\u9501\u6765\u63a7\u5236\u6570\u636e\u7ed3\u6784\u7684\u5b89\u5168\u3002\u5b89\u5168\u9501\u53ef\u4ee5\u5e26\u6765\u5b89\u5168\uff0c\u4f46\u662f\u4e5f\u4f1a\u5bfc\u81f4\u6027\u80fd\u53d7\u635f\u3002\u9501\u7684\u4e34\u754c\u533a\u4ee3\u7801\u8981\u5c3d\u91cf\u907f\u514d\u8017\u65f6\u7684\u8ba1\u7b97\u548c IO \u64cd\u4f5c\u3002\u9501\u7684\u529b\u5ea6\u8fd8\u8981\u5c3d\u53ef\u80fd\u7684\u7ec6\uff0c\u4f46\u662f\u7ec6\u7c92\u5ea6\u7684\u9501\u4ee3\u7801\u7f16\u5199\u8d77\u6765\u4e5f\u662f\u6709\u4e00\u5b9a\u7684\u96be\u5ea6\uff0c\u5bb9\u6613\u51fa\u9519\u3002\n\n\u8003\u8651\u5230\u8fde\u63a5\u90fd\u662f\u7528\u6765\u8fdb\u884c\u76f8\u5bf9\u7f13\u6162\u7684 IO \u64cd\u4f5c\uff0c\u9501\u8fd9\u6837\u7684\u5185\u5b58\u578b\u64cd\u4f5c\u8017\u65f6\u76f8\u6bd4 IO \u64cd\u4f5c\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\uff0c\u6240\u4ee5\u91c7\u7528\u7c97\u7c92\u5ea6\u7684\u9501\u53ef\u80fd\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u660e\u667a\u7684\u9009\u62e9\uff0c\u5728\u6027\u80fd\u8bb8\u53ef\u7684\u524d\u63d0\u4e0b\uff0c\u4ee3\u7801\u5199\u5f97\u7b80\u5355\u4e0d\u5bb9\u6613\u51fa\u9519\u3002\n\n## \u61d2\u60f0\u8fde\u63a5\n\n\u8fde\u63a5\u6c60\u4e2d\u7684\u8fde\u63a5\u591a\u4e3a\u61d2\u60f0\u7684\u8fde\u63a5\uff0c\u5728\u9700\u8981\u7684\u65f6\u5019\u624d\u4f1a\u53bb\u5411\u6570\u636e\u5e93\u7533\u8bf7\u65b0\u7684\u8fde\u63a5\u3002\u5982\u679c\u4e00\u4e2a\u7cfb\u7edf\u975e\u5e38\u95f2\u7f6e\uff0c\u800c\u63d0\u524d\u5f00\u8f9f\u4e86\u592a\u591a\u7684\u8fde\u63a5\u6c60\u90a3\u662f\u5bf9\u8d44\u6e90\u7684\u6d6a\u8d39\u3002\n\n\u6bd4\u5982 Python \u7684\u5e94\u7528\u7a0b\u5e8f\u591a\u662f\u5355\u7ebf\u7a0b\u7a0b\u5e8f\uff0c\u4f46\u662f\u4e3a Python \u63d0\u4f9b\u7684\u8fde\u63a5\u6c60\u5e93\u4e3a\u4e86\u901a\u7528\u578b\u53ef\u4e0d\u80fd\u4e0d\u8003\u8651\u591a\u7ebf\u7a0b\uff0c\u6bd5\u7adf Python \u7684\u591a\u7ebf\u7a0b\u5728\u4e00\u4e9b\u573a\u5408\u4e5f\u662f\u4f1a\u7ecf\u5e38\u4f7f\u7528\u7684\u3002\u61d2\u60f0\u7684\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u4fdd\u8bc1\u53ea\u4f1a\u5bf9\u5355\u7ebf\u7a0b\u7684\u7a0b\u5e8f\u5f00\u8f9f\u4e00\u4e2a\u8fde\u63a5\u3002\n\n\u61d2\u60f0\u7684\u8fde\u63a5\u4e5f\u6709\u4e00\u4e2a\u4e0d\u597d\u7684\u5730\u65b9\uff0c\u8fd9\u4e5f\u662f\u51b7\u542f\u52a8\u5e38\u89c1\u7684\u95ee\u9898\u3002\n\n1.  \u5982\u679c\u6570\u636e\u5e93\u8fde\u63a5\u53c2\u6570\u4e0d\u6b63\u786e\uff0c\u9700\u8981\u5728\u6536\u5230\u7528\u6237\u7684\u8bf7\u6c42\u8fdb\u884c\u663e\u793a\u7684\u6570\u636e\u8bbf\u95ee\u65f6\u624d\u80fd\u53d1\u73b0\u3002\n2.  \u670d\u52a1\u5668\u7684\u4ee3\u7801\u9700\u8981\u7ecf\u5386\u4e00\u4e2a\u70ed\u8eab\u7684\u8fc7\u7a0b\uff0c\u65e9\u6765\u7684\u8bf7\u6c42\u9700\u8981\u989d\u5916\u4ed8\u51fa\u4e00\u6b21\u5efa\u7acb\u8fde\u63a5\u7684\u8017\u65f6\u4ee3\u4ef7\u3002\n\n## \u5065\u5eb7\u68c0\u67e5\n\n\u8fde\u63a5\u6c60\u4e2d\u7ba1\u7406\u7684\u8fde\u63a5\u53ef\u80fd\u4f1a\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\u800c\u635f\u574f\u65ad\u8fde\u3002\u8fde\u63a5\u6c60\u9700\u8981\u4fdd\u6301\u5185\u90e8\u7ba1\u7406\u7684\u8fde\u63a5\u662f\u5065\u5eb7\u53ef\u7528\u7684\u3002\n\n1.  \u7ebf\u7a0b\u4ece\u8fde\u63a5\u6c60\u4e2d\u7533\u8bf7\u8fde\u63a5\u8fd4\u56de\u4e4b\u524d\uff0c\u7ebf\u7a0b\u6c60\u8981\u5bf9\u8fde\u63a5\u8fdb\u884c\u68c0\u67e5\uff0c\u786e\u5b9a\u8fde\u63a5\u662f\u901a\u7545\u7684\u3002\n2.  \u7ebf\u7a0b\u5c06\u8fde\u63a5\u5f52\u8fd8\u7ed9\u8fde\u63a5\u6c60\u65f6\uff0c\u7ebf\u7a0b\u6c60\u5bf9\u8fde\u63a5\u8fdb\u884c\u68c0\u67e5\uff0c\u786e\u5b9a\u8fde\u63a5\u6ca1\u6709\u88ab\u641e\u574f\u3002\n3.  \u7ebf\u7a0b\u6c60\u5b9a\u65f6\u5bf9\u7ba1\u7406\u7684\u8fde\u63a5\u8fdb\u884c\u68c0\u67e5\n\n\u5982\u679c\u68c0\u67e5\u53d1\u73b0\u8fde\u63a5\u6709\u95ee\u9898\uff0c\u4e00\u822c\u7684\u505a\u6cd5\u6709\u4e24\u79cd\n\n1.  \u629b\u5f03\u5f53\u524d\u8fde\u63a5\uff0c\u8fde\u63a5\u6c60\u7684\u8fde\u63a5\u6570\u91cf\u51cf\u4e00\uff0c\u5982\u679c\u662f\u5728 borrow \u65b9\u6cd5\u91cc\uff0c\u90a3\u5c31\u518d\u91cd\u65b0\u53bb\u8fde\u63a5\u6c60\u7533\u8bf7\u4e00\u4e2a\n2.  \u4fee\u590d\u5f53\u524d\u8fde\u63a5\uff0c\u4e00\u822c\u4e5f\u5c31\u662f\u6267\u884c\u91cd\u8fde\u64cd\u4f5c\u3002\n\n## \u8d85\u65f6\u7b56\u7565\n\n\u5f53\u4e1a\u52a1\u7ebf\u7a0b\u7e41\u5fd9\u65f6\uff0c\u8fde\u63a5\u6c60\u5185\u90e8\u7684\u8fde\u63a5\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u591f\u7528\u7684\u573a\u666f\u3002\u4e00\u4e2a\u8bf7\u6c42 borrow \u7684\u7ebf\u7a0b\u7b49\u4e86\u5f88\u4e45\u4e5f\u7b49\u4e0d\u5230\u7a7a\u95f2\u7684\u8fde\u63a5\u3002\u8fd9\u5c31\u662f\u8d85\u65f6\u95ee\u9898\u3002\u8d85\u65f6\u95ee\u9898\u4e00\u822c\u6709\u4e09\u79cd\u89e3\u51b3\u65b9\u6848\n\n1.  \u6c38\u4e0d\u8d85\u65f6\uff0c\u7b49\u4e0d\u5230\u5c31\u63a5\u7740\u7b49\uff0c\u8fd9\u53ef\u80fd\u4e0d\u662f\u4e00\u79cd\u597d\u7684\u9009\u62e9\u3002\n2.  \u4e00\u5b9a\u7684\u65f6\u95f4\u62ff\u4e0d\u5230\u540e\uff0c\u5c31\u5411\u5916\u90e8\u8dd1\u51fa\u8d85\u65f6\u5f02\u5e38\uff0c\u4e2d\u65ad\u4e1a\u52a1\u903b\u8f91\u3002\n3.  \u5982\u679c\u53d1\u73b0\u8fde\u63a5\u6c60\u6ca1\u6709\u7a7a\u95f2\u8fde\u63a5\uff0c\u5c31\u53bb\u7533\u8bf7\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\u7ed9\u8c03\u7528\u65b9\u3002\u8c03\u7528\u65b9\u5f52\u8fd8\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u8fde\u63a5\u6c60\u8ba1\u7b97\u5f53\u524d\u7f13\u5b58\u7684\u8fde\u63a5\u6570\u91cf\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\uff0c\u5c31\u5c06\u5f53\u524d\u5f52\u8fd8\u7684\u8fde\u63a5\u76f4\u63a5\u9500\u6bc1\u3002\u4e5f\u5c31\u662f\u5373\u7528\u5373\u8d70\u3002\n\n## \u6027\u80fd\u8ffd\u8e2a\n\n\u597d\u7684\u8fde\u63a5\u6c60\u8fd8\u5e94\u8be5\u8003\u8651\u5230\u6027\u80fd\u7684\u53ef\u8ffd\u8e2a\u6027\uff0c\u5f53\u7528\u6237\u901a\u8fc7\u7ebf\u7a0b\u6c60\u5206\u914d\u7684\u8fde\u63a5\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u5b83\u7684\u6d88\u606f\u6267\u884c\u65f6\u95f4\u5e94\u8be5\u662f\u53ef\u4ee5\u88ab\u8ffd\u8e2a\u88ab\u7edf\u8ba1\u7684\u3002\u6240\u4ee5\u5f80\u5f80\u8fde\u63a5\u6c60\u8fd8\u9700\u8981\u5bf9\u539f\u751f\u7684\u8fde\u63a5\u8fdb\u884c\u4e00\u5b9a\u7a0b\u5ea6\u7684\u5305\u88c5\uff0c\u5728\u5173\u952e\u7684\u51fd\u6570\u8c03\u7528\u524d\u540e\u589e\u52a0\u6027\u80fd\u7edf\u8ba1\u4ee3\u7801\u3002\u5e76\u5bf9\u5916\u63d0\u4f9b\u76d1\u542c\u63a5\u53e3\uff0c\u4ee5\u4fbf\u5c06\u7edf\u8ba1\u4fe1\u606f\u4f20\u9012\u7ed9\u5916\u90e8\u76d1\u63a7\u6a21\u5757\u3002\n\n## \u591a\u8def\u590d\u7528 (multiplexing)\n\n\u4f20\u7edf\u7684 RPC \u5ba2\u6237\u7aef\u90fd\u662f\u4e00\u95ee\u4e00\u7b54\u7684\uff0c\u540c\u4e00\u4e2a\u8fde\u63a5\u4e0a\u8fde\u7eed\u7684\u4e24\u4e2a\u8bf7\u6c42\u5fc5\u987b\u6309\u5148\u540e\u987a\u5e8f\u6392\u961f\u83b7\u53d6\u7ed3\u679c\u3002\u9ad8\u7ea7 RPC \u7684\u5ba2\u6237\u7aef\u5f80\u5f80\u662f\u540c\u4e00\u4e2a\u94fe\u63a5\u4e0a\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u591a\u4e2a\u8bf7\u6c42\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e71\u5e8f\u6267\u884c\u3002\u901a\u8fc7\u5728\u8bf7\u6c42\u91cc\u589e\u52a0\u4e00\u4e2a\u552f\u4e00\u7684 ID \u8fdb\u884c\u6807\u8bc6\u3002\u670d\u52a1\u5668\u54cd\u5e94\u6d88\u606f\u643a\u5e26\u8bf7\u6c42 ID \u5230\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u5c06\u54cd\u5e94\u548c\u8bf7\u6c42\u8fdb\u884c\u5173\u8054\u3002\n\nHTTP1.x \u534f\u8bae\u662f\u57fa\u4e8e\u4e00\u95ee\u4e00\u7b54\u5f62\u5f0f\u7684\uff0c\u5230\u4e86 HTTP2.0 \u5c31\u5177\u5907\u4e86\u591a\u8def\u590d\u7528\u7684\u8fde\u63a5\uff0cGoogle \u5f00\u6e90\u7684 gRPC \u6b63\u662f\u57fa\u4e8e HTTP2.0 \u7684\u591a\u8def\u590d\u7528\u7684\u8fde\u63a5\u5c01\u88c5\u7684\u4e00\u6b3e\u9ad8\u6027\u80fd RPC \u6846\u67b6\u3002\n\n\u591a\u8def\u590d\u7528\u7684\u8fde\u63a5\u5f80\u5f80\u90fd\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5b83\u652f\u6301\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5199\u5165\u8bf7\u6c42\u800c\u4e0d\u4f1a\u51fa\u73b0\u5e76\u53d1\u95ee\u9898\u3002\u4f46\u662f\u5b9e\u73b0\u591a\u8def\u590d\u7528\u7684\u6548\u679c\u96be\u5ea6\u8f83\u5927\uff0c\u5b9e\u73b0\u4e00\u4e2a\u540c\u7b49\u529f\u80fd\u7684\u5ba2\u6237\u7aef\uff0c\u5b83\u7684\u5de5\u4f5c\u91cf\u5f80\u5f80\u662f\u540c\u6b65\u7684\u597d\u51e0\u500d\u3002\n\n## \u5355\u5411\u8bf7\u6c42\n\n\u4e3a\u4e86\u63d0\u5347\u4ea4\u4e92\u7684\u6027\u80fd\uff0c\u6709\u4e9b\u4e0d\u662f\u7279\u522b\u91cd\u8981\u7684\u8bf7\u6c42\u53ef\u4ee5\u4e0d\u9700\u8981\u670d\u52a1\u5668\u8fdb\u884c\u54cd\u5e94\uff0c\u5ba2\u6237\u7aef\u5728\u53d1\u9001\u5b8c\u8bf7\u6c42\u4e4b\u540e\u4e5f\u4e0d\u9700\u8981\u7b49\u5f85\u7ed3\u679c\u76f4\u63a5\u8fd4\u56de\u3002\u8fd9\u5c31\u662f oneway \u5355\u5411\u8bf7\u6c42\uff0c\u5355\u5411\u8bf7\u6c42\u5f80\u5f80\u9002\u7528\u4e8e\u5141\u8bb8\u5c11\u91cf\u4e22\u5931\u7684\u8bf7\u6c42\uff0c\u4f8b\u5982\u65e5\u5fd7\u4fe1\u606f\u3002\u56e0\u4e3a\u5ba2\u6237\u7aef\u5728\u53d1\u9001\u5b8c\u4e4b\u540e\u5e76\u4e0d\u5173\u5fc3\u670d\u52a1\u5668\u6709\u6ca1\u6709\u6536\u5230\uff0c\u6709\u53ef\u80fd\u8fde\u63a5\u7a81\u7136\u65ad\u5f00\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\u4e86\u3002\n\n## \u5fc3\u8df3\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b5028f7659c73?w=682&h=406&f=png&s=113853)\n\n\u5f53\u5ba2\u6237\u7aef\u957f\u671f\u7a7a\u95f2\u65f6\uff0c\u670d\u52a1\u5668\u5f80\u5f80\u4f1a\u81ea\u52a8\u5173\u95ed\u8fde\u63a5\u5df2\u51cf\u8f7b\u8d44\u6e90\u6d88\u8017\u3002\u5f53\u5ba2\u6237\u7aef\u518d\u6b21\u8bf7\u6c42\u65f6\uff0c\u5c31\u4f1a\u9047\u5230\u8fde\u63a5\u5df2\u65ad\u5f00\u7684\u9519\u8bef\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u9519\u8bef\uff0c\u4e00\u822c\u6709\u4e24\u79cd\u65b9\u6cd5\uff0c\u4e00\u79cd\u662f\u901a\u8fc7\u8bf7\u6c42\u9047\u5230\u8fde\u63a5\u9519\u8bef\u65f6\u8fdb\u884c\u91cd\u8fde\u91cd\u8bd5\uff0c\u53e6\u4e00\u79cd\u5c31\u662f\u901a\u8fc7\u5fc3\u8df3\u65b9\u5f0f\u544a\u77e5\u670d\u52a1\u5668\u4e0d\u8981\u5173\u95ed\u8fde\u63a5\u3002\n\n## \u5c0f\u7ed3\n\n\u5ba2\u6237\u7aef\u7684\u8bbe\u8ba1\u539f\u7406\u6211\u4eec\u5c31\u8bb2\u5230\u8fd9\u91cc\uff0c\u8bfb\u8005\u4eec\u4e5f\u8bb8\u90fd\u5f00\u59cb\u611f\u5230\u4e0d\u8010\u70e6\u4e86\uff0c\u67af\u71e5\u900f\u4e86\uff0c\u773c\u76ae\u5b50\u90fd\u8981\u6253\u67b6\u4e86\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/1637629c24504946?w=346&h=344&f=png&s=73785)\n\n\u4e0d\u6349\u6025\uff0c\u6fc0\u52a8\u4eba\u5fc3\u7684\u65f6\u523b\u9a6c\u4e0a\u5c31\u8981\u5230\u6765\uff0c\u524d\u65b9\u9ad8\u80fd\u9884\u8b66\uff0c\u4f1a\u7a81\u7136\u5192\u51fa\u5927\u91cf\u4ee3\u7801\u5b9e\u73b0\uff0c\u8bfb\u8005\u4eec\uff0c\u51c6\u5907\u8fce\u63a5\u6311\u6218\u5427\u3002\n\n## \u4f5c\u4e1a\n\n\u8bfb\u8005\u4eec\u8fd8\u662f\u53bb\u9605\u8bfb\u4e00\u4e0b redis-py \u7684\u6e90\u4ee3\u7801\u5427\uff0c\u770b\u770b\u5b83\u7684\u8fde\u63a5\u6c60\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u5ba2\u6237\u7aef\u6df1\u5165_RPC_\u5ba2\u6237\u7aef\u8bbe\u8ba1.md", "create_date": "2020-02-18T21:31:51.776", "order": 7}}, {"model": "subject.chapter", "pk": 95, "fields": {"title": "\u534f\u8bae 3\uff1aProtobuf \u4e8c\u8fdb\u5236\u534f\u8bae\u7ed3\u6784", "topic": 4, "md5": "144aaa80153b3017cc2b7fd6289d0551", "md_body": "# \u534f\u8bae 3\uff1aProtobuf \u4e8c\u8fdb\u5236\u534f\u8bae\u7ed3\u6784\n\n![](https://user-gold-cdn.xitu.io/2018/5/12/16351d7015b44acb?w=660&h=400&f=png&s=33303)\n\nProtobuf \u534f\u8bae\u662f Google \u5f00\u6e90\u7684\u4e8c\u8fdb\u5236 RPC \u901a\u8baf\u534f\u8bae\uff0c\u5b83\u53ef\u80fd\u662f\u4e92\u8054\u7f51\u5f00\u6e90\u9879\u76ee\u4e2d\u4f7f\u7528\u6700\u4e3a\u5e7f\u6cdb\u7684 RPC \u534f\u8bae\u3002\n\nProtobuf \u63d0\u4f9b\u4e86\u4e00\u79cd\u63cf\u8ff0\u901a\u8baf\u534f\u8bae\u7684\u63a5\u53e3\u63cf\u8ff0\u8bed\u8a00 IDL\uff0c\u901a\u8fc7\u7f16\u5199\u63a5\u53e3\u534f\u8bae\uff0cProtobuf \u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u591a\u79cd\u8bed\u8a00\u7684 RPC \u901a\u8baf\u4ee3\u7801\uff0c\u76ee\u524d\u5b98\u65b9\u5df2\u7ecf\u652f\u6301\u4e86\u8fd1 10 \u79cd\u8bed\u8a00\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/12/16351d85da46fab1?w=2152&h=374&f=png&s=143778)\n\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6700\u5de6\u8fb9\u4f7f\u7528 Protobuf \u7684 IDL \u8bed\u8a00\u7f16\u5199\u7684\u534f\u8bae\u63a5\u53e3\u3002\u4f7f\u7528 protoc \u5de5\u5177\u53ef\u4ee5\u76f4\u63a5\u6839\u636e\u534f\u8bae\u751f\u6210 RPC \u901a\u8baf\u7684\u6240\u6709\u4ee3\u7801\u3002\u53f3\u8fb9\u5206\u522b\u662f Java \u8bed\u8a00\u548c C++ \u8bed\u8a00\u76f4\u63a5\u4f7f\u7528 protoc \u751f\u6210\u7684\u4ee3\u7801\u8fdb\u884c RPC \u901a\u8baf\u7684\u4f8b\u5b50\u3002\n\n## \u534f\u8bae\u683c\u5f0f\n\n**\u952e\u503c\u5bf9**\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b4f7aa45e3255?w=818&h=68&f=png&s=9614)\n\nProtobuf \u4f20\u8f93\u7684\u662f\u4e00\u7cfb\u5217\u7684\u952e\u503c\u5bf9\uff0c\u5982\u679c\u8fde\u7eed\u7684\u952e\u91cd\u590d\u4e86\uff0c\u90a3\u8bf4\u660e\u4f20\u8f93\u7684\u503c\u662f\u4e00\u4e2a\u5217\u8868 (repeated)\u3002\u56fe\u4e0a\u7684 key3 \u5c31\u662f\u4e00\u4e2a\u5217\u8868\u7c7b\u578b (repeated)\u3002\n\n\u952e **key** \u4e24\u90e8\u5206\u7ec4\u6210\uff1a**tag** \u548c **type**\u3002\n\n*   **tag**\n\nProtobuf \u5c06\u5bf9\u8c61\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\u548c\u6b63\u6570\u5e8f\u5217 (tag) \u5bf9\u5e94\u8d77\u6765\uff0c\u5bf9\u5e94\u5173\u7cfb\u7684\u4fe1\u606f\u662f\u7531\u751f\u6210\u7684\u4ee3\u7801\u6765\u4fdd\u8bc1\u7684\u3002\u5728\u5e8f\u5217\u5316\u7684\u65f6\u5019\u7528\u6574\u6570\u503c\u6765\u4ee3\u66ff\u5b57\u6bb5\u540d\u79f0\uff0c\u4e8e\u662f\u4f20\u8f93\u6d41\u91cf\u5c31\u53ef\u4ee5\u5927\u5e45\u7f29\u51cf\u3002\u5982\u679c\u5b57\u6bb5\u8f83\u5c11\uff0c\u5b83\u5c31\u4f7f\u7528 4 \u4e2a bits \u6765\u8868\u793a\uff0c\u6700\u591a\u652f\u6301 16 \u4e2a\u5b57\u6bb5\u3002\u5982\u679c\u5b57\u6bb5\u6570\u91cf\u8d85\u8fc7 16 \u4e2a\uff0c\u90a3\u5c31\u518d\u52a0 1 \u4e2a\u5b57\u8282\uff0c\u5982\u679c\u8fd8\u4e0d\u591f\u90a3\u5c31\u518d\u52a0 1 \u4e2a\u5b57\u8282\u3002\u4f60\u4e5f\u8bb8\u731c\u5230\u4e86\uff0c\u8fd9\u4e2a tag \u503c\u4f7f\u7528\u7684\u662f varint \u7f16\u7801\u3002\u7406\u8bba\u4e0a\u5b57\u6bb5\u7684\u957f\u5ea6\u4e0d\u8bbe\u4e0a\u9650\uff0c\u56e0\u4e3a varint \u53ef\u4ee5\u901a\u8fc7\u6269\u5c55\u5b57\u8282\u6570\u652f\u6301\u4efb\u610f\u5927\u7684\u975e\u8d1f\u6574\u6570\u3002\n\n*   **type**\n\nProtobuf \u5c06\u5b57\u6bb5\u7c7b\u578b\u4e5f\u548c\u6b63\u6570\u5e8f\u5217 (type) \u5bf9\u5e94\u8d77\u6765\uff0c\u6bcf\u4e00\u79cd\u539f\u751f\u7684 java \u7c7b\u578b\u90fd\u552f\u4e00\u5bf9\u5e94\u4e00\u4e2a\u6b63\u6570\uff0c\u7c7b\u578b\u4fe1\u606f\u4e5f\u975e\u5e38\u8282\u7701\u3002type \u4f7f\u7528 3 \u4e2a bits \u8868\u793a\uff0c\u6700\u591a\u652f\u6301 8 \u79cd\u7c7b\u578b\u3002\n\n\u4e5f\u8bb8\u4f60\u4f1a\u8ba4\u4e3a 8 \u79cd\u7c7b\u578b\u600e\u4e48\u591f\u5462\uff1f\u653e\u5fc3\uff0c\u80af\u5b9a\u591f\u7684\uff01\u56e0\u4e3a\u4e00\u4e2a zigzag \u7c7b\u578b\u53ef\u4ee5\u8868\u793a\u6240\u6709\u7684\u7c7b\u6574\u6570\u7c7b\u578b\uff0cbyte/short/int/long/bool/enum/unsigned byte/unsigned short/unsigned int/unsigned long \u8fd9\u4e9b\u7c7b\u578b\u90fd\u53ef\u4ee5\u4f7f\u7528 zigzag \u8868\u793a\u3002\u800c Python \u8bed\u8a00\u7684\u6574\u6570\u66f4\u52a0\u7279\u522b\uff0c\u5b83\u6839\u672c\u5c31\u4e0d\u533a\u5206\u6574\u6570\u7684\u4f4d\u6570\uff0c\u751a\u81f3\u53ef\u4ee5\u662f\u4e00\u4e2a BigInteger\u3002varint \u7684\u7279\u957f\u5c31\u5728\u4e8e\u6b64\uff0c\u5b83\u53ef\u4ee5\u65e0\u9650\u6269\u5c55\u4f4d\u6570\u5927\u5c0f\uff0c\u53ef\u4ee5\u8868\u793a\u65e0\u9650\u7684\u6574\u6570\u503c\u3002\u800c\u5b57\u8282\u6570\u7ec4\u3001\u5b57\u7b26\u4e32\u548c\u5d4c\u5957\u5bf9\u8c61\u90fd\u53ef\u4ee5\u4f7f\u7528\u4e00\u79cd\u79f0\u4e4b\u4e3a length \u524d\u7f00 (length-delimited) \u7684\u7c7b\u578b\u6765\u8868\u793a\u3002\u53e6\u5916 float \u548c double \u7c7b\u578b\u5404\u5360\u4e00\u4e2a\u7c7b\u578b\u3002\u6700\u7ec8\u4f60\u770b\uff0c\u8fde 8 \u4e2a\u7c7b\u578b\u90fd\u6ca1\u6709\u4f7f\u7528\u5230\u3002\n\n**key = tag || type**\n\n![](https://user-gold-cdn.xitu.io/2018/5/12/1635319e4749b89a?w=1306&h=300&f=png&s=33939)\n\nProtobuf \u5c06\u5b57\u6bb5\u540d\u79f0\u5bf9\u5e94\u7684\u6574\u6570 (tag) \u548c\u5b57\u6bb5\u7c7b\u578b\u5bf9\u5e94\u7684\u6574\u6570 (type) \u5408\u5e76\u5728\u4e00\u8d77\u51d1\u6210\u4e00\u4e2a\u5b57\u8282\u3002\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u7684\u5b57\u6bb5\u6bd4\u8f83\u591a\uff0c\u5bf9\u5e94\u7684\u6b63\u6570\u6bd4\u8f83\u5927\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u4e24\u4e2a\u5b57\u8282\uff0c\u5982\u679c\u8fd8\u4e0d\u591f\uff0c\u90a3\u5c31\u4e09\u4e2a\u5b57\u8282\u3002\u65e0\u6240\u8c13\u5df2\u7ecf\u8bf4\u8fc7\u4e86\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f varint \u7f16\u7801\uff0c\u4e0d\u7ba1\u4f60\u5b57\u6bb5\u6709\u591a\u5c11\uff0c\u90fd\u53ef\u4ee5\u652f\u6301\u3002\u6700\u9ad8\u4f4d\u7684 0 \u548c 1 \u662f\u6807\u5fd7\u662f 1 \u4e2a\u5b57\u8282\u8fd8\u662f 2 \u4e2a\u5b57\u8282\uff0c\u5b83\u662f varint \u7f16\u7801\u7684\u6269\u5c55\u4f4d\u3002\n\n\u4e0b\u9762\u6211\u4eec\u770b value \u90e8\u5206\uff0cvalue \u90e8\u5206\u968f\u7740\u7c7b\u578b type \u7684\u4e0d\u540c\u800c\u5177\u6709\u4e0d\u540c\u7684\u5f62\u5f0f\n\n**\u6574\u6570**\n\nProtobuf \u7684\u6574\u6570\u6570\u503c\u4f7f\u7528 zigzag \u7f16\u7801\u3002zigzag \u7f16\u7801\u652f\u6301\u8d1f\u6570\u503c\uff0cvarint \u7f16\u7801\u7684\u90fd\u662f\u975e\u8d1f\u6570\u3002\u8fd9\u4e2a\u5728\u7b2c\u4e09\u8282\u5df2\u7ecf\u8bb2\u8fc7\u4e86\uff0c\u5b83\u4eec\u90fd\u662f\u53d8\u957f\u6574\u6570\u3002\n\n**\u6d6e\u70b9\u6570** \u6d6e\u70b9\u6570\u5206\u4e3a float \u548c double\uff0c\u5b83\u4eec\u5206\u522b\u4f7f\u7528 4 \u4e2a\u5b57\u8282\u548c 6 \u4e2a\u5b57\u8282\u5e8f\u5217\u5316\uff0c\u8fd9\u4e24\u4e2a\u7c7b\u578b\u7684 value \u6ca1\u6709\u505a\u4ec0\u4e48\u7279\u6b8a\u5904\u7406\uff0c\u5b83\u5c31\u662f\u6807\u51c6\u7684\u6d6e\u70b9\u6570\u3002\n\n**\u5b57\u7b26\u4e32**\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b4ff98c9e7aa9?w=684&h=101&f=png&s=8121)\n\nProtobuf \u7684\u5b57\u7b26\u4e32\u503c\u4f7f\u7528\u957f\u5ea6\u524d\u7f00\u7f16\u7801\u3002\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u540e\u9762\u76f8\u5e94\u957f\u5ea6\u7684\u5b57\u8282\u4e32\u5c31\u662f\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u3002\u5982\u679c\u5b57\u7b26\u4e32\u957f\u5ea6\u5f88\u957f\uff0c\u90a3\u4e48\u957f\u5ea6\u524d\u7f00\u5c31\u4e0d\u6b62\u4e00\u4e2a\u5b57\u8282\uff0c\u5b83\u53ef\u80fd\u662f\u4e24\u5b57\u8282\u4e09\u5b57\u8282\u56db\u5b57\u8282\uff0c\u4f60\u4e5f\u8bb8\u731c\u5230\u4e86\uff0c\u8fd9\u4e2a\u957f\u5ea6\u91c7\u7528\u7684\u662f varint \u7f16\u7801\u3002\n\n**\u5d4c\u5957**\n\nProtobuf \u652f\u6301\u7c7b\u578b\u5d4c\u5957\u3002\u5d4c\u5957\u7c7b\u578b\u7684 type \u540c\u5b57\u7b26\u4e32\u7684 type \u4e00\u6837\uff0c\u90fd\u662f length \u524d\u7f00\u3002\u7b2c\u4e00\u4e2a\u5b57\u8282 (varint) \u8868\u793a\u5b57\u8282\u957f\u5ea6\uff0c\u540e\u9762\u76f8\u5e94\u957f\u5ea6\u7684\u5b57\u8282\u4e32\u5c31\u662f\u5d4c\u5957\u5bf9\u8c61\u7684\u6574\u4e2a\u5185\u5bb9\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u4f1a\u9012\u5f52\u4f7f\u7528 Protobuf \u8fdb\u884c\u7f16\u7801\u89e3\u7801\u3002\n\n**\u53ef\u9009\u7c7b\u578b**\n\nProtobuf \u652f\u6301\u53ef\u9009\u7c7b\u578b\u3002\u4e0d\u8fc7\u4e8c\u8fdb\u5236\u6d41\u91cc\u9762\u53ef\u6ca1\u6709\u4f7f\u7528\u4efb\u4f55\u6807\u5fd7\u4e3a\u6765\u8868\u793a\u5b57\u6bb5\u662f\u5426\u53ef\u9009\u3002\u5b83\u53ea\u662f\u5728\u8fd0\u884c\u65f6\u505a\u4e86\u68c0\u67e5\uff0c\u5982\u679c\u4e00\u4e2a\u5fc5\u987b\u7684\u5b57\u6bb5\u7684 tag \u5728\u4e8c\u8fdb\u5236\u6d41\u91cc\u9762\u6ca1\u6709\u51fa\u73b0\uff0c\u90a3\u5c31\u4f1a\u629b\u51fa\u4e00\u4e2a\u8fd0\u884c\u65f6\u5f02\u5e38\u3002\u5f53Protobuf\u5347\u7ea7\u52303.0\u7684\u65f6\u5019\uff0c\u53ef\u9009\u7c7b\u578b\u6d88\u5931\u4e86\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u6240\u6709\u7684\u7c7b\u578b\u90fd\u662f\u53ef\u9009\u7c7b\u578b\u3002\u4e5f\u5c31\u662f\u8bf4\u53d1\u9001\u7aef\u5373\u4f7f\u6ca1\u6709\u586b\u5145\u8be5\u5b57\u6bb5\uff0c\u63a5\u6536\u7aef\u4e5f\u4e0d\u4f1a\u629b\u51fa\u9519\u8bef\u4e86\uff0c\u5b57\u6bb5\u53ef\u9009\u4e0e\u5426\u5b8c\u5168\u4f9d\u8d56\u4e8e\u7528\u6237\u81ea\u5df1\u53bb\u68c0\u67e5\u4e86\u3002\n\n## \u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\n\n```\nmessage Person {\n    required string user_name        = 1;  // \u5fc5\u987b\u5b57\u6bb5\n    optional int64  favourite_number = 2;  // \u53ef\u9009\u5b57\u6bb5\n    repeated string interests        = 3;  // \u5217\u8868\u7c7b\u578b\n}\n\n```\n\n```\nvar person = new Person{\n    user_name: \"Martin\",\n    favourite_number: 1337,\n    interests: [\"daydreaming\", \"hacking\"]\n}\n\n```\n\n![](https://user-gold-cdn.xitu.io/2018/5/12/163523f1ca7bd3bc?w=2292&h=958&f=png&s=79609)\n\n\u4e0a\u56fe\u7684\u4e8c\u8fdb\u5236\u5e8f\u5217\u5c31\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 person \u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u6570\u636e\uff0c\u5305\u542b\u4e86\u5b57\u7b26\u4e32\u3001\u6574\u6570\u548c\u6570\u7ec4 (\u5217\u8868) \u7c7b\u578b\u3002\u4ed4\u7ec6\u89c2\u5bdf\u8fd9\u5f20\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u5b57\u6bb5\u90fd\u6709\u4e00\u4e2a\u5171\u540c\u7684 tag|type \u524d\u7f00\u3002\u5982\u679c\u662f\u7c7b\u6574\u6570\uff0c\u540e\u9762\u5c31\u76f4\u63a5\u8ddf value\u3002\u5982\u679c\u662f length-delimeted \u7c7b\u578b\uff0c\u540e\u9762\u5c31\u5148\u8ddf\u4e00\u4e2a\u957f\u5ea6\uff0c\u518d\u8ddf\u4e00\u4e2a\u5b57\u8282\u4e32\u3002\u56e0\u4e3a\u6574\u6570\u91c7\u7528 zigzag \u7f16\u7801\uff0c\u6240\u4ee5 Protobuf \u5bf9\u6574\u6570\u7684 bits \u8981\u8fdb\u884c\u4e00\u4e9b\u8f6c\u6362 (\u56fe\u4e2d\u7684\u6574\u6570 1337)\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/4/163c8b1ad93b2165?w=622&h=222&f=png&s=19476)\n\n## \u6d88\u606f\u8fb9\u754c\n\n*   Protobuf \u5e76\u6ca1\u6709\u5b9a\u4e49\u6d88\u606f\u8fb9\u754c\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u6d88\u606f\u5934\u3002\u6d88\u606f\u5934\u4e00\u822c\u7531\u7528\u6237\u81ea\u5df1\u5b9a\u4e49\uff0c\u901a\u5e38\u4f7f\u7528\u957f\u5ea6\u524d\u7f00\u6cd5\u6765\u5b9a\u4e49\u8fb9\u754c\u3002\n*   \u540c\u6837 Protobuf \u4e5f\u6ca1\u6709\u5b9a\u4e49\u6d88\u606f\u7c7b\u578b\uff0c\u5f53\u670d\u52a1\u5668\u6536\u5230\u4e00\u4e32\u6d88\u606f\u65f6\uff0c\u5b83\u5fc5\u987b\u77e5\u9053\u5bf9\u5e94\u7684\u7c7b\u578b\uff0c\u7136\u540e\u9009\u62e9\u76f8\u5e94\u6d88\u606f\u7c7b\u578b\u7684\u89e3\u7801\u5668\u6765\u8bfb\u53d6\u6d88\u606f\u3002\u8fd9\u4e2a\u7c7b\u578b\u4fe1\u606f\u4e5f\u5fc5\u987b\u7531\u7528\u6237\u81ea\u5df1\u5728\u6d88\u606f\u5934\u91cc\u9762\u5b9a\u4e49\u3002\n\n## \u5c0f\u7ed3\n\nRedis \u7684\u534f\u8bae\u548c Protobuf \u7684\u534f\u8bae\u6211\u4eec\u90fd\u5206\u6790\u5b8c\u4e86\uff0c\u4f46\u662f\u5b83\u4eec\u771f\u7684\u5982\u770b\u4e0a\u9762\u4ecb\u7ecd\u7684\u90a3\u6837\u5f88\u5b8c\u7f8e\u4e48\uff1f\u5728\u5b9e\u6218\u5f00\u53d1\u4e2d\uff0c\u4f1a\u6709\u54ea\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5751\u5462\uff1f\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u4ece\u4e00\u4e2a\u6709\u610f\u601d\u7684\u89d2\u5ea6\u6765\u5206\u6790 Redis \u7684\u534f\u8bae\u4e3a\u4ec0\u4e48\u6709\u95ee\u9898\u3002\n\n## \u4f5c\u4e1a\n\nThrift \u662f Faceook \u5f00\u6e90\u7684\u53e6\u4e00\u6b3e\u5f00\u6e90 RPC \u6846\u67b6\uff0c\u5b83\u7684\u534f\u8bae\u548c Protobuf \u975e\u5e38\u7c7b\u4f3c\uff0c\u8bf7\u8bfb\u8005\u641c\u5bfb\u76f8\u5173\u6587\u6863\u4e86\u89e3 Thrift \u7684\u7ed3\u6784\u7f16\u7801\uff0c\u770b\u770b\u5b83\u4e0e Protobuf \u6709\u600e\u6837\u7684\u4e0d\u540c\uff1f\n\n*   [Avro, Protobuf \u548c Thrift \u534f\u8bae\u7684\u5f02\u540c](https://martin.kleppmann.com/2012/12/05/schema-evolution-in-avro-protocol-buffers-thrift.html)", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u534f\u8bae_3Protobuf_\u4e8c\u8fdb\u5236\u534f\u8bae\u7ed3\u6784.md", "create_date": "2020-02-18T21:31:51.791", "order": 5}}, {"model": "subject.chapter", "pk": 96, "fields": {"title": "\u534f\u8bae 4\uff1aRedis \u534f\u8bae\u7684\u7f3a\u9677", "topic": 4, "md5": "79c4333a6e24a70057657700fafd64f0", "md_body": "# \u534f\u8bae 4\uff1aRedis \u534f\u8bae\u7684\u7f3a\u9677\n\n\u672c\u8282\u6211\u4eec\u8981\u5206\u6790 Redis \u534f\u8bae\u8bbe\u8ba1\u7684\u7f3a\u9677\uff0c\u4f46\u662f\u8981\u7406\u89e3\u8fd9\u4e2a\u7f3a\u9677\u5c31\u5fc5\u987b\u5148\u660e\u767d\u4e0b\u9762\u51e0\u4e2a\u77e5\u8bc6\u70b9\uff0c\u6240\u4ee5\u5148\u4e0d\u76f4\u63a5\u544a\u8bc9\u5927\u5bb6 Redis \u534f\u8bae\u9519\u5728\u54ea\u91cc\u3002\n\n\u57fa\u672c\u534f\u8bae\u5f00\u53d1\u76f8\u5173\u7684\u5b9e\u6218\u7ecf\u9a8c\uff0c\u662f\u9ad8\u7ea7\u5f00\u53d1\u8005\u5fc5\u5907\u5185\u6838\u6280\u80fd\uff0c\u5404\u4f4d\u7cfb\u597d\u5b89\u5168\u5e26\uff0c\u6211\u4eec\u8981\u98d9\u8f66\u4e86\uff01\n\n## \u8fde\u63a5\u91cd\u8fde\n\nRPC \u662f\u5efa\u7acb\u5728 TCP \u534f\u8bae\u57fa\u7840\u4e0a\u8fdb\u884c\u6d88\u606f\u4f20\u9012\uff0c\u800c TCP \u8fde\u63a5\u5e76\u4e0d\u603b\u662f\u7a33\u5b9a\u7684\uff0c\u5b83\u4f1a\u53d7\u5230\u7f51\u7edc\u6ce2\u52a8\u7684\u5f71\u54cd\u800c\u5bfc\u81f4\u8fde\u63a5\u65ad\u5f00\u3002\u540c\u65f6\u5927\u90e8\u5206\u670d\u52a1\u5668\u4e5f\u4f1a\u9650\u5236\u7a7a\u95f2\u8fde\u63a5\u7684\u751f\u5b58\u671f\uff0c\u5982\u679c\u4e00\u4e2a TCP \u8fde\u63a5\u95f2\u7f6e\u8fc7\u4e45\uff0c\u4e5f\u4f1a\u88ab\u670d\u52a1\u5668\u4e3b\u52a8\u5173\u95ed\u3002\u5982\u679c\u8fd9\u4e2a RPC \u662f\u4ee5\u624b\u673a\u4f5c\u4e3a\u5ba2\u6237\u7aef\u53d1\u8d77\u7684\u8bf7\u6c42\uff0c\u90a3\u4e48\u8fd9\u79cd\u8fde\u63a5\u65ad\u5f00\u7684\u60c5\u51b5\u5c31\u66f4\u4e3a\u9891\u7e41\uff0c\u7528\u6237\u7684\u7f51\u7edc\u5207\u6362\u884c\u4e3a\u968f\u65f6\u90fd\u4f1a\u5f15\u53d1\u8fde\u63a5\u65ad\u5f00\u3002\n\n\u5f53 RPC \u8fde\u63a5\u65ad\u5f00\u65f6\uff0c\u5ba2\u6237\u7aef\u4e00\u822c\u90fd\u9700\u8981\u5b9e\u73b0\u8fde\u63a5\u91cd\u8fde\uff0c\u5426\u5219\u5ba2\u6237\u7aef\u5c06\u65e0\u6cd5\u7ee7\u7eed\u8fdb\u884c RPC \u4ea4\u4e92\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/10/1634852cf04bc12d?w=710&h=265&f=png&s=25693)\n\n## \u8bf7\u6c42\u91cd\u8bd5\n\n\u5f53 RPC \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u4e4b\u540e\uff0c\u8fde\u63a5\u7a81\u7136\u65ad\u5f00\uff0c\u8fd9\u4e2a\u65ad\u5f00\u53ef\u80fd\u53d1\u751f\u5728\u8bf7\u6c42\u9636\u6bb5\uff0c\u8fd9\u65f6\u670d\u52a1\u5668\u6ca1\u6709\u6536\u5230\u6d88\u606f\u3002\u4e5f\u53ef\u80fd\u53d1\u751f\u5728\u54cd\u5e94\u9636\u6bb5\uff0c\u8fd9\u65f6\u670d\u52a1\u5668\u5df2\u7ecf\u5904\u7406\u4e86\u6d88\u606f\uff0c\u53ea\u662f\u5ba2\u6237\u7aef\u6ca1\u6709\u6536\u5230\u56de\u590d\u5c31\u65ad\u5f00\u4e86\u3002\u5ba2\u6237\u7aef\u5e76\u4e0d\u603b\u662f\u53ef\u4ee5\u8f7b\u6613\u5224\u65ad\u51fa\u670d\u52a1\u5668\u662f\u5426\u5df2\u7ecf\u5904\u7406\u4e86\u6d88\u606f\u8fd8\u662f\u6839\u672c\u5c31\u6ca1\u6536\u5230\u3002\n\n\u7136\u540e\u5ba2\u6237\u7aef\u4f1a\u5c1d\u8bd5\u91cd\u8fde\uff0c\u8fde\u63a5\u6210\u529f\u540e\uff0c\u9700\u8981\u91cd\u8bd5\u4e4b\u524d\u7684\u8bf7\u6c42\u3002\u8fd9\u65f6\u95ee\u9898\u5c31\u6765\u4e86\uff0c\u5982\u679c\u8fde\u63a5\u7684\u65ad\u5f00\u662f\u5728\u54cd\u5e94\u9636\u6bb5\uff0c\u90a3\u4e48\u8bf7\u6c42\u6709\u53ef\u80fd\u4f1a\u88ab\u91cd\u590d\u6267\u884c\u3002\u4f46\u662f\u4e0d\u91cd\u8bd5\u7684\u8bdd\uff0c\u8fde\u63a5\u7684\u65ad\u5f00\u5982\u679c\u53d1\u751f\u5728\u8bf7\u6c42\u9636\u6bb5\uff0c\u90a3\u5c31\u53c8\u4f1a\u5bfc\u81f4\u8bf7\u6c42\u4e22\u5931\u3002\n\n\u6240\u4ee5\u5ba2\u6237\u7aef\u8fd9\u65f6\u5f88\u77db\u76fe\uff0c\u5230\u5e95\u662f\u91cd\u8bd5\u5462\u8fd8\u662f\u4e22\u5f03\u5462\uff1f\n\n## \u8bf7\u6c42\u552f\u4e00 ID\n\n\u4e3a\u4e86\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u5728\u6784\u9020\u8bf7\u6c42\u65f6\u8981\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u8d4b\u4e88\u4e00\u4e2a\u552f\u4e00 ID\u3002\n\n```\nclass Request {\n    UUID id; // \u6bcf\u4e2a\u8bf7\u6c42\u90fd\u6709\u4e00\u4e2a\u552f\u4e00 ID\n}\n\n```\n\n\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\u4f1a\u8bb0\u5f55\u8fd9\u4e2a\u552f\u4e00 ID\uff0c\u5f53\u8bf7\u6c42\u5904\u7406\u5b8c\u6210\u540e\uff0c\u4f1a\u5c06\u54cd\u5e94\u4e5f\u8bb0\u5f55\u4e0b\u6765\u548c\u8bf7\u6c42 ID \u5173\u8054\u4e0a\u3002\u5982\u679c\u8bf7\u6c42\u91cd\u590d\u53d1\u9001\u4e86\uff0c\u5c31\u53ef\u4ee5\u7acb\u5373\u8bc6\u522b\u51fa\u6765\u3002\u670d\u52a1\u5668\u9047\u5230\u91cd\u590d\u8bf7\u6c42\u65f6\uff0c\u4e0d\u5e94\u8be5\u76f4\u63a5\u62d2\u7edd\uff0c\u800c\u662f\u5c06\u524d\u9762\u8bb0\u5f55\u4e0b\u6765\u7684\u54cd\u5e94\u76f4\u63a5\u8fdb\u884c\u56de\u590d\u3002\n\n\u8003\u8651\u5230\u670d\u52a1\u5668\u7684\u5185\u5b58\u4e5f\u662f\u6709\u9650\u7684\uff0c\u4e0d\u53ef\u80fd\u8bb0\u5f55\u4e0b\u6240\u6709\u7684\u8bf7\u6c42 ID \u548c\u54cd\u5e94\uff0c\u6240\u4ee5\u4e00\u822c\u53ea\u4fdd\u7559\u8fd1\u4e00\u6bb5\u65f6\u95f4\u7684\u8bf7\u6c42 ID \u548c\u54cd\u5e94\u3002\n\n```\nclass Server {\n    Set<RequestId> pendingRequests; // \u6b63\u5728\u5904\u7406\u7684\u8bf7\u6c42\n    Cache<RequestId, Response> cachedResponses;  // \u5df2\u7ecf\u5904\u7406\u5b8c\u6bd5\u7684\u8bf7\u6c42\n}\n\n```\n\n## Redis \u5ba2\u6237\u7aef\u7684\u7f3a\u9677\n\n\u5982\u679c\u4ed4\u7ec6\u9605\u8bfb Redis \u7684\u5ba2\u6237\u7aef\u6e90\u7801\uff0c\u4f60\u4f1a\u53d1\u73b0 Redis \u5e76\u6ca1\u6709\u7ed9\u6bcf\u4e2a\u8bf7\u6c42\u8d4b\u4e88\u552f\u4e00 ID\uff0c\u5b83\u53ea\u662f\u7b80\u5355\u5730\u5728\u9047\u5230\u5f02\u5e38\u65f6\u91cd\u8bd5\u4e00\u4e0b\u3002\n\n```\ndef execute_command(self, *args, **options):\n    \"Execute a command and return a parsed response\"\n    pool = self.connection_pool\n    command_name = args[0]\n    connection = pool.get_connection(command_name, **options)  # \u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u8fde\u63a5\n    try:\n        connection.send_command(*args)  # \u53d1\u9001\u8bf7\u6c42\n        return self.parse_response(connection, command_name, **options)  # \u63a5\u6536\u5e76\u89e3\u6790\u8bf7\u6c42\n    except (ConnectionError, TimeoutError) as e:\n        connection.disconnect()  # \u5173\u95ed\u5f02\u5e38\u8fde\u63a5\n        if not connection.retry_on_timeout and isinstance(e, TimeoutError):\n            raise\n        connection.send_command(*args)  # \u91cd\u8bd5\n        return self.parse_response(connection, command_name, **options)\n    finally:\n        pool.release(connection)  # \u88ab\u8fde\u63a5\u6c60\u56de\u6536\n\n```\n\n> \u90a3 Redis \u7a76\u7adf\u662f\u5982\u4f55\u89e3\u51b3\u91cd\u590d\u7684\u95ee\u9898\uff1f\u4ea6\u6216\u5b83\u6839\u672c\u5c31\u6ca1\u89e3\u51b3\uff1f\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6839\u636e\u8fd4\u56de\u7684\u9519\u8bef\u7c7b\u578b\u9010\u4e2a\u5206\u6790:\n\n**ConnectionError**\n\n`ConnectionError` \u662f\u6307\u5728\u5efa\u7acb\u8fde\u63a5\u65f6\u5c31\u51fa\u4e86\u9519\uff0c\u6216\u8005\u662f\u4ece\u8fde\u63a5\u6c60\u91cc\u83b7\u53d6\u8fde\u63a5\u56e0\u4e3a\u7cfb\u7edf\u8fc7\u4e8e\u7e41\u5fd9\uff0c\u603b\u662f\u62ff\u4e0d\u5230\u3002\u8fd9\u79cd\u60c5\u51b5\u6beb\u65e0\u7591\u95ee\u662f\u9700\u8981\u91cd\u8bd5\u7684\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u6839\u672c\u8fd8\u6ca1\u6709\u5c1d\u8bd5\u53bb\u53d1\u9001\u6d88\u606f\u3002\n\n**TimeoutError**\n\n`TimeoutError` \u8981\u5206\u4e24\u79cd\u60c5\u51b5\u5bf9\u5f85\uff0c\u4e00\u79cd\u662f\u5728\u5199\u6d88\u606f\u65f6\u9047\u5230\u4e86\u8d85\u65f6\uff0c\u53e6\u4e00\u79cd\u662f\u5728\u8bfb\u6d88\u606f\u65f6\u9047\u5230\u4e86\u8d85\u65f6\u3002\n\n\u5199\u8d85\u65f6\u662f\u6307\u5185\u6838\u4e3a\u5f53\u524d\u5957\u63a5\u5b57\u5f00\u8f9f\u7684\u5199\u7f13\u5b58\u7a7a\u95f4\u5df2\u7ecf\u6ee1\u4e86\uff0c\u6709\u4e09\u79cd\u539f\u56e0\u4f1a\u5bfc\u81f4\u5199\u7f13\u51b2\u6ee1\u3002\n\n1.  \u5199\u65b9\u7684\u6d88\u606f\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\u8fdf\u8fdf\u8fbe\u5230\u4e0d\u4e86\u8bfb\u65b9\uff1b\n2.  \u8bfb\u65b9\u8001\u662f\u4e0d\u8bfb\u6d88\u606f\uff0c\u6240\u4ee5\u6ca1\u6709\u7ed9\u5199\u65b9\u5373\u65f6 ack\uff1b\n3.  \u5199\u65b9\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\u6536\u4e0d\u5230\u5bf9\u65b9\u7684 ack\uff1b\n\n![](https://user-gold-cdn.xitu.io/2018/5/10/16348f6d82f1d1b3?w=819&h=375&f=png&s=31221)\n\nTCP \u7684\u8d85\u65f6\u91cd\u4f20\u7b56\u7565\u8981\u6c42\u5fc5\u987b\u6536\u5230\u8bfb\u65b9\u7684 ack \u4e4b\u540e\u624d\u53ef\u4ee5\u5c06\u6570\u636e\u4ece\u5199\u7f13\u5b58\u4e2d\u79fb\u9664\uff0c\u5426\u5219\u4f1a\u7ee7\u7eed\u7559\u5728\u5199\u7f13\u51b2\u533a\u4ee5\u4fbf\u540e\u7eed\u53ef\u80fd\u7684 TCP \u91cd\u4f20\u3002\u5982\u679c\u4f60\u9519\u628a\u8fd9\u91cc\u7684 ack \u5f53\u6210\u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u5efa\u8bae\u9605\u8bfb\u4e00\u4e0b TCP \u534f\u8bae\u76f8\u5173\u7684\u6587\u7ae0\u3002\n\n\u5bf9\u4e8e\u5199\u65b9\u7684\u6d88\u606f\u8fbe\u5230\u4e0d\u4e86\u8bfb\u65b9\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u65e0\u6cd5\u9884\u6599\u8bfb\u65b9\u5728\u672a\u6765\u7684\u67d0\u4e2a\u65f6\u95f4\u70b9\u662f\u5426\u53c8\u53ef\u4ee5\u6536\u5230\u6d88\u606f\uff0c\u6240\u4ee5\u6b64\u65f6\u4e0d\u53ef\u4ee5\u968f\u610f\u91cd\u8bd5\u3002\n\n\u5bf9\u4e8e\u8bfb\u65b9\u8001\u662f\u4e0d\u8bfb\u6d88\u606f\u8fd9\u79cd\u60c5\u51b5 (accept \u4e86\u8fde\u63a5\u4f46\u662f\u6ca1\u6709\u8c03\u7528 read \u65b9\u6cd5)\uff0c\u6211\u4eec\u65e0\u6cd5\u9884\u6599\u8bfb\u65b9\u5728\u672a\u6765\u7684\u67d0\u4e2a\u65f6\u95f4\u662f\u5426\u4f1a\u7ee7\u7eed\u6062\u590d\u8bfb\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u65e0\u6cd5\u9884\u77e5\u670d\u52a1\u5668 (\u8bfb\u65b9) \u662f\u5426\u4f1a\u5904\u7406\u5f53\u524d\u7684\u6d88\u606f\u3002\u8fd9\u4e2a\u65f6\u5019\u9009\u62e9\u91cd\u8bd5\u53ea\u80fd\u662f\u778e\u5b50\u6478\u8c61\u65e0\u4ece\u5f97\u77e5\u662f\u5426\u4f1a\u5bfc\u81f4\u6d88\u606f\u91cd\u590d\u3002\n\n\u5982\u679c\u662f\u56e0\u4e3a\u5199\u65b9\u4e34\u65f6\u7684\u7f51\u7edc\u539f\u56e0\u6536\u4e0d\u5230\u8bfb\u65b9\u7684 ack \u624d\u5bfc\u81f4\u7684\u5199\u7f13\u51b2\u533a\u6ee1\uff0c\u8fd9\u65f6\u670d\u52a1\u5668\u65b9\u662f\u5df2\u7ecf\u8bfb\u53d6\u4e86\u6d88\u606f\u7684\u5e76\u8fdb\u884c\u5904\u7406\u4e86\u3002\u8fd9\u6837\u7684\u8d85\u65f6\u7406\u8bba\u4e0a\u662f\u4e0d\u5e94\u8be5\u91cd\u8bd5\u7684\uff0c\u91cd\u8bd5\u5fc5\u7136\u5bfc\u81f4\u6d88\u606f\u91cd\u590d\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/10/16348fa94a4e1eb4?w=833&h=321&f=png&s=21476)\n\n\u518d\u770b\u8bfb\u8d85\u65f6\uff0c\u8bfb\u8d85\u65f6\u662f\u6307\u6d88\u606f\u5df2\u7ecf\u5199\u8fdb (send) \u672c\u5730\u5199\u7f13\u51b2\u533a\u4e86\uff0c\u7136\u540e\u8c03\u7528 recv \u65b9\u6cd5\u7b49\u5f85\u5bf9\u65b9\u54cd\u5e94\u65f6\u5f88\u4e45\u6ca1\u6709\u6536\u5230\u4e00\u4e2a\u5b8c\u6574\u7684\u54cd\u5e94\u6d88\u606f\uff0c\u53ef\u80fd\u662f\u4e00\u4e2a\u5b57\u8282\u90fd\u6ca1\u6536\u5230\uff0c\u4e5f\u53ef\u80fd\u53ea\u662f\u6536\u5230\u4e86\u534a\u5305\u6d88\u606f\u3002\n\n\u6d88\u606f\u5199\u8fdb\u5199\u4e86\u7f13\u51b2\u533a\u5e76\u4e0d\u610f\u5473\u7740\u8bfb\u65b9\u4e00\u5b9a\u53ef\u4ee5\u6536\u5230\uff0crecv \u65b9\u6cd5\u4e00\u4e2a\u5b57\u8282\u90fd\u6ca1\u6536\u5230\u4e5f\u4e0d\u80fd\u786e\u5b9a\u662f\u670d\u52a1\u5668\u65b9\u6ca1\u6709\u5904\u7406\u8fd8\u662f\u5df2\u7ecf\u5904\u7406\u4e86\u4f46\u662f\u54cd\u5e94\u6d88\u606f\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\u5230\u8fbe\u4e0d\u4e86\u5199\u65b9\u3002\u4e5f\u53ea\u6709\u5728\u6536\u53d6\u5230\u534a\u5305\u6d88\u606f\u7684\u60c5\u51b5\u4e0b\u624d\u53ef\u4ee5\u786e\u8ba4\u6d88\u606f\u786e\u5b9e\u5df2\u7ecf\u88ab\u670d\u52a1\u5668\u5904\u7406\u8fc7\u4e86\u3002\u4e0d\u8fc7\u5c31 redis \u5ba2\u6237\u7aef\u7684\u5b9e\u73b0\u6765\u8bf4\uff0c\u4ee3\u7801\u91cc\u5e76\u6ca1\u6709\u660e\u786e\u533a\u5206\u662f\u4e00\u4e2a\u5b57\u8282\u90fd\u6ca1\u6536\u5230\u8fd8\u662f\u534a\u5305\u6d88\u606f\u3002\u6240\u4ee5\u5728\u8bfb\u8d85\u65f6\u7684\u60c5\u51b5\u4e0b\u9009\u62e9\u91cd\u8bd5\u4e5f\u662f\u4e00\u6837\u7684\u778e\u5b50\u6478\u8c61\u3002\n\n```\nclass StrictRedis(object):\n\n    def __init__(self, host='localhost', port=6379,\n                 db=0, password=None, socket_timeout=None,\n                 socket_connect_timeout=None,\n                 socket_keepalive=None, socket_keepalive_options=None,\n                 connection_pool=None, unix_socket_path=None,\n                 encoding='utf-8', encoding_errors='strict',\n                 charset=None, errors=None,\n                 decode_responses=False, retry_on_timeout=False,  # \u6ce8\u610f\u8fd9\u4e2a\u53c2\u6570\n                 ssl=False, ssl_keyfile=None, ssl_certfile=None,\n                 ssl_cert_reqs=None, ssl_ca_certs=None):\n\n```\n\n\u4e5f\u6b63\u662f\u56e0\u4e3a\u8fd9\u4e2a\u539f\u56e0\uff0cRedis \u7684 Client \u5bf9\u8c61\u6784\u9020\u5668\u63d0\u4f9b\u4e86\u4e00\u4e2a`retry_on_timeout`\u9009\u9879\u6765\u8ba9\u7528\u6237\u81ea\u5df1\u51b3\u5b9a\u8981\u4e0d\u8981\u5728`TimeoutError`\u65f6\u8fdb\u884c\u91cd\u8bd5\uff0c\u8ba9\u7528\u6237\u81ea\u5df1\u6765\u9009\u62e9\u5728\u8d85\u65f6\u51fa\u73b0\u65f6\u8981\u4e22\u5931\u8fd8\u662f\u91cd\u590d\uff0c\u5ba2\u6237\u7aef\u4ee3\u7801\u672c\u8eab\u662f\u65e0\u6cd5\u786e\u4fdd\u6d88\u606f\u662f\u5426\u4f1a\u91cd\u590d\u7684\u3002\n\nPython \u7684 Redis \u5ba2\u6237\u7aef\u6709\u7f3a\u9677\uff0c\u90a3\u4e48 Java \u7684 Redis \u5ba2\u6237\u7aef\u6709\u6ca1\u6709\u7f3a\u9677\u5462\uff1f\u7b54\u6848\u662f\u300c**\u6709**\u300d\u3002\u56e0\u4e3a\u95ee\u9898\u7684\u672c\u8d28\u4e0d\u5728\u4e8e\u7f16\u5199\u5ba2\u6237\u7aef\u7684\u7a0b\u5e8f\u5458\u7684\u4ee3\u7801\u80fd\u529b\u95ee\u9898\uff0c\u800c\u662f Redis \u670d\u52a1\u5668\u4ece\u6d88\u606f\u534f\u8bae\u7684\u8bbe\u8ba1\u4e0a\u5c31\u6ca1\u6709\u652f\u6301\u6d88\u606f\u53bb\u91cd\uff0c\u65e0\u8bba\u662f\u4ec0\u4e48\u8bed\u8a00\u7f16\u5199\u7684\u5ba2\u6237\u7aef\u90fd\u65e0\u6cd5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n## \u5c0f\u7ed3\n\n\u7531\u4e8e\u8fd9\u4e2a Redis \u7684\u534f\u8bae\u7f3a\u9677\u4ece\u6765\u6ca1\u6709\u88ab\u4eba\u63d0\u5230\u8fc7\uff0c\u8bfb\u8005\u5982\u679c\u62ff\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u53bb\u548c\u5468\u56f4\u7684\u540c\u5b66\u4eec\u5206\u4eab\uff0c\u53ef\u80fd\u4f1a\u88ab\u4eba\u4e0d\u7406\u89e3\u751a\u81f3\u88ab\u5632\u7b11\u3002\u4f46\u771f\u7406\u5f80\u5f80\u662f\u638c\u63e1\u5728\u5c11\u6570\u4eba\u624b\u91cc\uff0c\u4f60\u8981\u5c55\u73b0\u81ea\u5df1\u81ea\u4fe1\u7684\u5fae\u7b11\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/19/16375feb7ca66826?w=135&h=140&f=jpeg&s=5186)\n\n\u4e0b\u4e00\u8282\u6211\u4eec\u5c06\u8bb2\u89e3\u9ad8\u5e76\u53d1 RPC \u5ba2\u6237\u7aef\u7684\u8bbe\u8ba1\u8981\u6c42\u3002RPC \u5ba2\u6237\u7aef\u867d\u7136\u76f8\u6bd4\u670d\u52a1\u5668\u5f00\u53d1\u800c\u8a00\u8981\u7b80\u5355\u5f88\u591a\uff0c\u4f46\u662f\u5b9e\u73b0\u4e00\u4e2a\u5b8c\u5584\u7684\u5ba2\u6237\u7aef\u4e5f\u4e0d\u662f\u4e00\u4ef6\u5bb9\u6613\u7684\u4e8b\u3002\u4f46\u662f\u5b83\u6bd5\u7adf\u8981\u6bd4\u670d\u52a1\u5668\u7b80\u5355\u4e00\u4e9b\uff0c\u6240\u4ee5\u5148\u8bb2\u5ba2\u6237\u7aef\u5b9e\u73b0\uff0c\u6ca1\u9519\u3002", "md_File": "subject/\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1/\u534f\u8bae_4Redis_\u534f\u8bae\u7684\u7f3a\u9677.md", "create_date": "2020-02-18T21:31:51.808", "order": 6}}, {"model": "subject.chapter", "pk": 97, "fields": {"title": "Vue \u7684\u6784\u9020\u5668\u2014\u2014extend \u4e0e\u624b\u52a8\u6302\u8f7d\u2014\u2014$mount", "topic": 5, "md5": "63afde113d687f1fb9f55fc517efacf5", "md_body": "# Vue \u7684\u6784\u9020\u5668\u2014\u2014extend \u4e0e\u624b\u52a8\u6302\u8f7d\u2014\u2014$mount\n\n\u672c\u8282\u4ecb\u7ecd\u4e24\u4e2a Vue.js \u5185\u7f6e\u4f46\u5374\u4e0d\u5e38\u7528\u7684 API\u2014\u2014extend \u548c $mount\uff0c\u5b83\u4eec\u7ecf\u5e38\u4e00\u8d77\u4f7f\u7528\u3002\u4e0d\u5e38\u7528\uff0c\u662f\u56e0\u4e3a\u5728\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u57fa\u672c\u6ca1\u6709\u5b83\u4eec\u7684\u7528\u6b66\u4e4b\u5730\uff0c\u4f46\u5728\u72ec\u7acb\u7ec4\u4ef6\u5f00\u53d1\u65f6\uff0c\u5728\u4e00\u4e9b\u7279\u5b9a\u7684\u573a\u666f\u5b83\u4eec\u662f\u81f3\u5173\u91cd\u8981\u7684\u3002\n\n## \u4f7f\u7528\u573a\u666f\n\n\u6211\u4eec\u5728\u5199 Vue.js \u65f6\uff0c\u4e0d\u8bba\u662f\u7528 CDN \u7684\u65b9\u5f0f\u8fd8\u662f\u5728 Webpack \u91cc\u7528 npm \u5f15\u5165\u7684 Vue.js\uff0c\u90fd\u4f1a\u6709\u4e00\u4e2a\u6839\u8282\u70b9\uff0c\u5e76\u4e14\u521b\u5efa\u4e00\u4e2a\u6839\u5b9e\u4f8b\uff0c\u6bd4\u5982\uff1a\n\n```\n<body>\n  <div id=\"app\"></div>\n</body>\n<script>\n  const app = new Vue({\n    el: '#app'\n  });\n</script>\n\n```\n\nWebpack \u4e5f\u7c7b\u4f3c\uff0c\u4e00\u822c\u5728\u5165\u53e3\u6587\u4ef6 main.js \u91cc\uff0c\u6700\u540e\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f8b\uff1a\n\n```\nimport Vue from 'vue';\nimport App from './app.vue';\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n});\n\n```\n\n\u56e0\u4e3a\u7528 Webpack \u57fa\u672c\u90fd\u662f\u524d\u7aef\u8def\u7531\u7684\uff0c\u5b83\u7684 html \u91cc\u4e00\u822c\u90fd\u53ea\u6709\u4e00\u4e2a\u6839\u8282\u70b9 `<div id=\"app\"></div>`\uff0c\u5176\u4f59\u90fd\u662f\u901a\u8fc7 JavaScript \u5b8c\u6210\uff0c\u4e5f\u5c31\u662f\u8bb8\u591a\u7684 Vue.js \u7ec4\u4ef6\uff08\u6bcf\u4e2a\u9875\u9762\u4e5f\u662f\u4e00\u4e2a\u7ec4\u4ef6\uff09\u3002\n\n\u6709\u4e86\u521d\u59cb\u5316\u7684\u5b9e\u4f8b\uff0c\u4e4b\u540e\u6240\u6709\u7684\u9875\u9762\uff0c\u90fd\u7531 vue-router \u5e2e\u6211\u4eec\u7ba1\u7406\uff0c\u7ec4\u4ef6\u4e5f\u90fd\u662f\u7528 `import` \u5bfc\u5165\u540e\u5c40\u90e8\u6ce8\u518c\uff08\u4e5f\u6709\u5728 main.js \u5168\u5c40\u6ce8\u518c\u7684\uff09\uff0c\u4e0d\u7ba1\u54ea\u79cd\u65b9\u5f0f\uff0c\u7ec4\u4ef6\uff08\u6216\u9875\u9762\uff09\u7684\u521b\u5efa\u8fc7\u7a0b\u6211\u4eec\u662f\u65e0\u9700\u5173\u5fc3\u7684\uff0c\u53ea\u662f\u5199\u597d `.vue` \u6587\u4ef6\u5e76\u5bfc\u5165\u5373\u53ef\u3002\u8fd9\u6837\u7684\u7ec4\u4ef6\u4f7f\u7528\u65b9\u5f0f\uff0c\u6709\u51e0\u4e2a\u7279\u70b9\uff1a\n\n1.  \u6240\u6709\u7684\u5185\u5bb9\uff0c\u90fd\u662f\u5728 `#app` \u8282\u70b9\u5185\u6e32\u67d3\u7684\uff1b\n2.  \u7ec4\u4ef6\u7684\u6a21\u677f\uff0c\u662f\u4e8b\u5148\u5b9a\u4e49\u597d\u7684\uff1b\n3.  \u7531\u4e8e\u7ec4\u4ef6\u7684\u7279\u6027\uff0c\u6ce8\u518c\u7684\u7ec4\u4ef6\u53ea\u80fd\u5728\u5f53\u524d\u4f4d\u7f6e\u6e32\u67d3\u3002\n\n\u6bd4\u5982\u4f60\u8981\u4f7f\u7528\u4e00\u4e2a\u7ec4\u4ef6 `<i-date-picker>`\uff0c\u6e32\u67d3\u65f6\uff0c\u8fd9\u4e2a\u81ea\u5b9a\u4e49\u6807\u7b7e\u5c31\u4f1a\u88ab\u66ff\u6362\u4e3a\u7ec4\u4ef6\u7684\u5185\u5bb9\uff0c\u800c\u4e14\u5728\u54ea\u5199\u7684\u81ea\u5b9a\u4e49\u6807\u7b7e\uff0c\u5c31\u5728\u54ea\u91cc\u88ab\u66ff\u6362\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5e38\u89c4\u7684\u7ec4\u4ef6\u4f7f\u7528\u65b9\u5f0f\uff0c\u53ea\u80fd\u5728\u89c4\u5b9a\u7684\u5730\u65b9\u6e32\u67d3\u7ec4\u4ef6\uff0c\u8fd9\u5728\u4e00\u4e9b\u7279\u6b8a\u573a\u666f\u4e0b\u5c31\u6bd4\u8f83\u5c40\u9650\u4e86\uff0c\u4f8b\u5982\uff1a\n\n1.  \u7ec4\u4ef6\u7684\u6a21\u677f\u662f\u901a\u8fc7\u8c03\u7528\u63a5\u53e3\u4ece\u670d\u52a1\u7aef\u83b7\u53d6\u7684\uff0c\u9700\u8981\u52a8\u6001\u6e32\u67d3\u7ec4\u4ef6\uff1b\n2.  \u5b9e\u73b0\u7c7b\u4f3c\u539f\u751f `window.alert()` \u7684\u63d0\u793a\u6846\u7ec4\u4ef6\uff0c\u5b83\u7684\u4f4d\u7f6e\u662f\u5728 `<body>` \u4e0b\uff0c\u800c\u975e `<div id=\"app\">`\uff0c\u5e76\u4e14\u4e0d\u4f1a\u901a\u8fc7\u5e38\u89c4\u7684\u7ec4\u4ef6\u81ea\u5b9a\u4e49\u6807\u7b7e\u7684\u5f62\u5f0f\u4f7f\u7528\uff0c\u800c\u662f\u50cf JS \u8c03\u7528\u51fd\u6570\u4e00\u6837\u4f7f\u7528\u3002\n\n\u4e00\u822c\u6765\u8bf4\uff0c\u5728\u6211\u4eec\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u7ec4\u4ef6\u5c31\u5df2\u7ecf\u6e32\u67d3\u5c31\u4f4d\u4e86\uff0c\u5bf9\u4e8e\u573a\u666f 1\uff0c\u7ec4\u4ef6\u7684\u6e32\u67d3\u662f\u5f02\u6b65\u7684\uff0c\u751a\u81f3\u9884\u5148\u4e0d\u77e5\u9053\u6a21\u677f\u662f\u4ec0\u4e48\u3002\u5bf9\u4e8e\u573a\u666f 2\uff0c\u5176\u5b9e\u5e76\u4e0d\u964c\u751f\uff0c\u5728 jQuery \u65f6\u4ee3\uff0c\u901a\u8fc7\u64cd\u4f5c DOM\uff0c\u5f88\u5bb9\u6613\u5c31\u80fd\u5b9e\u73b0\uff0c\u4f60\u53ef\u4ee5\u6cbf\u7528\u8fd9\u79cd\u601d\u8def\uff0c\u53ea\u662f\u8fd9\u79cd\u505a\u6cd5\u4e0d\u90a3\u4e48 Vue\uff0c\u65e2\u7136\u4f7f\u7528 Vue.js \u4e86\uff0c\u5c31\u5e94\u8be5\u7528 Vue \u7684\u601d\u8def\u6765\u89e3\u51b3\u95ee\u9898\u3002\u5bf9\u4e8e\u8fd9\u4e24\u79cd\u573a\u666f\uff0cVue.extend \u548c vm.$mount \u8bed\u6cd5\u5c31\u6d3e\u4e0a\u7528\u573a\u4e86\u3002\n\n## \u7528\u6cd5\n\n\u4e0a\u6587\u6211\u4eec\u8bf4\u5230\uff0c\u521b\u5efa\u4e00\u4e2a Vue \u5b9e\u4f8b\u65f6\uff0c\u90fd\u4f1a\u6709\u4e00\u4e2a\u9009\u9879 `el`\uff0c\u6765\u6307\u5b9a\u5b9e\u4f8b\u7684\u6839\u8282\u70b9\uff0c\u5982\u679c\u4e0d\u5199 `el` \u9009\u9879\uff0c\u90a3\u7ec4\u4ef6\u5c31\u5904\u4e8e\u672a\u6302\u8f7d\u72b6\u6001\u3002`Vue.extend` \u7684\u4f5c\u7528\uff0c\u5c31\u662f\u57fa\u4e8e Vue \u6784\u9020\u5668\uff0c\u521b\u5efa\u4e00\u4e2a\u201c\u5b50\u7c7b\u201d\uff0c\u5b83\u7684\u53c2\u6570\u8ddf `new Vue` \u7684\u57fa\u672c\u4e00\u6837\uff0c\u4f46 `data` \u8981\u8ddf\u7ec4\u4ef6\u4e00\u6837\uff0c\u662f\u4e2a\u51fd\u6570\uff0c\u518d\u914d\u5408 `$mount` \uff0c\u5c31\u53ef\u4ee5\u8ba9\u7ec4\u4ef6\u6e32\u67d3\uff0c\u5e76\u4e14\u6302\u8f7d\u5230\u4efb\u610f\u6307\u5b9a\u7684\u8282\u70b9\u4e0a\uff0c\u6bd4\u5982 body\u3002\n\n\u6bd4\u5982\u4e0a\u6587\u7684\u573a\u666f\uff0c\u5c31\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a\n\n```\nimport Vue from 'vue';\n\nconst AlertComponent = Vue.extend({\n  template: '<div>{{ message }}</div>',\n  data () {\n    return {\n      message: 'Hello, Aresn'\n    };\n  },\n});\n\n```\n\n\u8fd9\u4e00\u6b65\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u6784\u9020\u5668\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53ef\u4ee5\u89e3\u51b3\u5f02\u6b65\u83b7\u53d6 template \u6a21\u677f\u7684\u95ee\u9898\uff0c\u4e0b\u9762\u8981\u624b\u52a8\u6e32\u67d3\u7ec4\u4ef6\uff0c\u5e76\u628a\u5b83\u6302\u8f7d\u5230 body \u4e0b\uff1a\n\n```\nconst component = new AlertComponent().$mount();\n\n```\n\n\u8fd9\u4e00\u6b65\uff0c\u6211\u4eec\u8c03\u7528\u4e86 `$mount` \u65b9\u6cd5\u5bf9\u7ec4\u4ef6\u8fdb\u884c\u4e86\u624b\u52a8\u6e32\u67d3\uff0c\u4f46\u5b83\u4ec5\u4ec5\u662f\u88ab\u6e32\u67d3\u597d\u4e86\uff0c\u5e76\u6ca1\u6709\u6302\u8f7d\u5230\u8282\u70b9\u4e0a\uff0c\u4e5f\u5c31\u663e\u793a\u4e0d\u4e86\u7ec4\u4ef6\u3002\u6b64\u65f6\u7684 `component` \u5df2\u7ecf\u662f\u4e00\u4e2a\u6807\u51c6\u7684 Vue \u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u56e0\u6b64\u5b83\u7684 `$el` \u5c5e\u6027\u4e5f\u53ef\u4ee5\u88ab\u8bbf\u95ee\uff1a\n\n```\ndocument.body.appendChild(component.$el);\n\n```\n\n\u5f53\u7136\uff0c\u9664\u4e86 body\uff0c\u4f60\u8fd8\u53ef\u4ee5\u6302\u8f7d\u5230\u5176\u5b83\u8282\u70b9\u4e0a\u3002\n\n`$mount` \u4e5f\u6709\u4e00\u4e9b\u5feb\u6377\u7684\u6302\u8f7d\u65b9\u5f0f\uff0c\u4ee5\u4e0b\u4e24\u79cd\u90fd\u662f\u53ef\u4ee5\u7684\uff1a\n\n```\n// \u5728 $mount \u91cc\u5199\u53c2\u6570\u6765\u6307\u5b9a\u6302\u8f7d\u7684\u8282\u70b9\nnew AlertComponent().$mount('#app');\n// \u4e0d\u7528 $mount\uff0c\u76f4\u63a5\u5728\u521b\u5efa\u5b9e\u4f8b\u65f6\u6307\u5b9a el \u9009\u9879\nnew AlertComponent({ el: '#app' });\n\n```\n\n\u5b9e\u73b0\u540c\u6837\u7684\u6548\u679c\uff0c\u9664\u4e86\u7528 extend \u5916\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u521b\u5efa Vue \u5b9e\u4f8b\uff0c\u5e76\u4e14\u7528\u4e00\u4e2a Render \u51fd\u6570\u6765\u6e32\u67d3\u4e00\u4e2a .vue \u6587\u4ef6\uff1a\n\n```\nimport Vue from 'vue';\nimport Notification from './notification.vue';\n\nconst props = {};  // \u8fd9\u91cc\u53ef\u4ee5\u4f20\u5165\u4e00\u4e9b\u7ec4\u4ef6\u7684 props \u9009\u9879\n\nconst Instance = new Vue({\n  render (h) {\n    return h(Notification, {\n      props: props\n    });\n  }\n});\n\nconst component = Instance.$mount();\ndocument.body.appendChild(component.$el);\n\n```\n\n\u8fd9\u6837\u65e2\u53ef\u4ee5\u4f7f\u7528 .vue \u6765\u5199\u590d\u6742\u7684\u7ec4\u4ef6\uff08\u6bd5\u7adf\u5728 template \u91cc\u5806\u5b57\u7b26\u4e32\u5f88\u75db\u82e6\uff09\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4f20\u5165\u9002\u5f53\u7684 props\u3002\u6e32\u67d3\u540e\uff0c\u5982\u679c\u60f3\u64cd\u4f5c Render \u7684 `Notification` \u5b9e\u4f8b\uff0c\u4e5f\u662f\u5f88\u7b80\u5355\u7684\uff1a\n\n```\nconst notification = Instance.$children[0];\n\n```\n\n\u56e0\u4e3a Instance \u4e0b\u53ea Render \u4e86 Notification \u4e00\u4e2a\u5b50\u7ec4\u4ef6\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528 `$children[0]` \u8bbf\u95ee\u5230\u3002\n\n> \u5982\u679c\u4f60\u8fd8\u4e0d\u7406\u89e3\u8fd9\u6837\u505a\u7684\u76ee\u7684\uff0c\u6ca1\u6709\u5173\u7cfb\uff0c\u540e\u9762\u5c0f\u8282\u7684\u4e24\u4e2a\u5b9e\u6218\u4f60\u4f1a\u611f\u53d7\u5230\u5b83\u7684\u7528\u6b66\u4e4b\u5730\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u662f\u7528 `$mount` \u624b\u52a8\u6e32\u67d3\u7684\u7ec4\u4ef6\uff0c\u5982\u679c\u8981\u9500\u6bc1\uff0c\u4e5f\u8981\u7528 `$destroy` \u6765\u624b\u52a8\u9500\u6bc1\u5b9e\u4f8b\uff0c\u5fc5\u8981\u65f6\uff0c\u4e5f\u53ef\u4ee5\u7528 `removeChild` \u628a\u8282\u70b9\u4ece DOM \u4e2d\u79fb\u9664\u3002\n\n## \u7ed3\u8bed\n\n\u8fd9\u4e24\u4e2a API \u5e76\u4e0d\u96be\u7406\u89e3\uff0c\u53ea\u662f\u4e0d\u5e38\u4f7f\u7528\u7f62\u4e86\uff0c\u56e0\u4e3a\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ea\u5173\u6ce8\u5728\u4e1a\u52a1\u5c42\uff0c\u5e76\u4f7f\u7528\u73b0\u6210\u7684\u7ec4\u4ef6\u5e93\u3002\n\n\u4f7f\u7528 Vue.js \u4e5f\u6709\u4e8c\u516b\u539f\u5219\uff0c\u5373 80% \u7684\u4eba\u770b\u8fc7 [Vue.js \u6587\u6863\u6559\u7a0b\u7bc7](https://cn.vuejs.org/v2/guide/)\uff0c20% \u7684\u4eba\u770b\u8fc7 [Vue.js \u6587\u6863 API](https://cn.vuejs.org/v2/api/)\u3002\n\n\u4e0b\u4e00\u8282\uff0c\u6211\u4eec\u6765\u505a\u70b9\u6709\u8da3\u7684\u4e1c\u897f\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [\u804a\u804a Vue.js \u7684 template \u7f16\u8bd1](https://juejin.im/post/59da1c116fb9a00a4a4cf6dd)", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/Vue_\u7684\u6784\u9020\u5668extend_\u4e0e\u624b\u52a8\u6302\u8f7dmount.md", "create_date": "2020-02-18T21:37:08.702", "order": 8}}, {"model": "subject.chapter", "pk": 98, "fields": {"title": "\u9012\u5f52\u7ec4\u4ef6\u4e0e\u52a8\u6001\u7ec4\u4ef6", "topic": 5, "md5": "3d9fc9f6f8e4b511645f5c1b7c46c1ef", "md_body": "# \u9012\u5f52\u7ec4\u4ef6\u4e0e\u52a8\u6001\u7ec4\u4ef6\n\n## \u9012\u5f52\u7ec4\u4ef6\n\n\u9012\u5f52\u7ec4\u4ef6\u5c31\u662f\u6307\u7ec4\u4ef6\u5728\u6a21\u677f\u4e2d\u8c03\u7528\u81ea\u5df1\uff0c\u5f00\u542f\u9012\u5f52\u7ec4\u4ef6\u7684\u5fc5\u8981\u6761\u4ef6\uff0c\u5c31\u662f\u5728\u7ec4\u4ef6\u4e2d\u8bbe\u7f6e\u4e00\u4e2a `name` \u9009\u9879\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u793a\u4f8b\uff1a\n\n```\n<template>\n  <div>\n    <my-component></my-component>\n  </div>\n</template>\n<script>\n  export default {\n    name: 'my-component'\n  }\n</script>\n\n```\n\n\u5728 Webpack \u4e2d\u5bfc\u5165\u4e00\u4e2a Vue.js \u7ec4\u4ef6\uff0c\u4e00\u822c\u662f\u901a\u8fc7 `import myComponent from 'xxx'` \u8fd9\u6837\u7684\u8bed\u6cd5\uff0c\u7136\u540e\u5728\u5f53\u524d\u7ec4\u4ef6\uff08\u9875\u9762\uff09\u7684 `components: { myComponent }` \u91cc\u6ce8\u518c\u7ec4\u4ef6\u3002\u8fd9\u79cd\u7ec4\u4ef6\u662f\u4e0d\u5f3a\u5236\u8bbe\u7f6e `name` \u5b57\u6bb5\u7684\uff0c\u7ec4\u4ef6\u7684\u540d\u5b57\u90fd\u662f\u4f7f\u7528\u8005\u5728 import \u8fdb\u6765\u540e\u81ea\u5b9a\u4e49\u7684\uff0c\u4f46\u9012\u5f52\u7ec4\u4ef6\u7684\u4f7f\u7528\u8005\u662f\u7ec4\u4ef6\u81ea\u8eab\uff0c\u5b83\u5f97\u77e5\u9053\u8fd9\u4e2a\u7ec4\u4ef6\u53eb\u4ec0\u4e48\uff0c\u56e0\u4e3a\u6ca1\u6709\u7528 `components` \u6ce8\u518c\uff0c\u6240\u4ee5 `name` \u5b57\u6bb5\u5c31\u662f\u5fc5\u987b\u7684\u4e86\u3002\u9664\u4e86\u9012\u5f52\u7ec4\u4ef6\u7528 `name`\uff0c\u6211\u4eec\u5728\u4e4b\u524d\u7684\u5c0f\u8282\u4e5f\u4ecb\u7ecd\u8fc7\uff0c\u7528\u4e00\u4e9b\u7279\u6b8a\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u904d\u5386\u5339\u914d\u7ec4\u4ef6\u7684 name \u9009\u9879\u6765\u5bfb\u627e\u7ec4\u4ef6\u5b9e\u4f8b\u3002\n\n\u4e0d\u8fc7\u5462\uff0c\u4e0a\u9762\u7684\u793a\u4f8b\u662f\u6709\u95ee\u9898\u7684\uff0c\u5982\u679c\u76f4\u63a5\u8fd0\u884c\uff0c\u4f1a\u629b\u51fa `max stack size exceeded` \u7684\u9519\u8bef\uff0c\u56e0\u4e3a\u7ec4\u4ef6\u4f1a\u65e0\u9650\u9012\u5f52\u4e0b\u53bb\uff0c\u6b7b\u5faa\u73af\u3002\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u8981\u7ed9\u9012\u5f52\u7ec4\u4ef6\u4e00\u4e2a\u9650\u5236\u6761\u4ef6\uff0c\u4e00\u822c\u4f1a\u5728\u9012\u5f52\u7ec4\u4ef6\u4e0a\u7528 `v-if` \u5728\u67d0\u4e2a\u5730\u65b9\u8bbe\u7f6e\u4e3a `false` \u6765\u7ec8\u7ed3\u3002\u6bd4\u5982\u6211\u4eec\u7ed9\u4e0a\u9762\u7684\u793a\u4f8b\u52a0\u4e00\u4e2a\u5c5e\u6027 count\uff0c\u5f53\u5927\u4e8e 5 \u65f6\u5c31\u4e0d\u518d\u9012\u5f52\uff1a\n\n```\n<template>\n  <div>\n    <my-component :count=\"count + 1\" v-if=\"count <= 5\"></my-component>\n  </div>\n</template>\n<script>\n  export default {\n    name: 'my-component',\n    props: {\n      count: {\n        type: Number,\n        default: 1\n      }\n    }\n  }\n</script>\n\n```\n\n\u6240\u4ee5\uff0c\u603b\u7ed3\u4e0b\u6765\uff0c\u5b9e\u73b0\u4e00\u4e2a\u9012\u5f52\u7ec4\u4ef6\u7684\u5fc5\u8981\u6761\u4ef6\u662f\uff1a\n\n*   \u8981\u7ed9\u7ec4\u4ef6\u8bbe\u7f6e **name**\uff1b\n*   \u8981\u6709\u4e00\u4e2a\u660e\u786e\u7684\u7ed3\u675f\u6761\u4ef6\n\n\u9012\u5f52\u7ec4\u4ef6\u5e38\u7528\u6765\u5f00\u53d1\u5177\u6709\u672a\u77e5\u5c42\u7ea7\u5173\u7cfb\u7684\u72ec\u7acb\u7ec4\u4ef6\uff0c\u5728\u4e1a\u52a1\u5f00\u53d1\u4e2d\u5f88\u5c11\u4f7f\u7528\u3002\u6bd4\u5982\u5e38\u89c1\u7684\u6709\u7ea7\u8054\u9009\u62e9\u5668\u548c\u6811\u5f62\u63a7\u4ef6\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/22/167398b8f5a828b1?w=1600&h=676&f=png&s=44587)\n\n\u8fd9\u7c7b\u7ec4\u4ef6\u4e00\u822c\u90fd\u662f\u6570\u636e\u9a71\u52a8\u578b\u7684\uff0c\u7236\u7ea7\u6709\u4e00\u4e2a\u5b57\u6bb5 children\uff0c\u7136\u540e\u9012\u5f52\u3002\u4e0b\u4e00\u8282\u7684\u5b9e\u6218\uff0c\u4f1a\u5f00\u53d1\u4e00\u4e2a\u6811\u5f62\u63a7\u4ef6 Tree\u3002\n\n## \u52a8\u6001\u7ec4\u4ef6\n\n\u6709\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5e0c\u671b\u6839\u636e\u4e00\u4e9b\u6761\u4ef6\uff0c\u52a8\u6001\u5730\u5207\u6362\u67d0\u4e2a\u7ec4\u4ef6\uff0c\u6216\u52a8\u6001\u5730\u9009\u62e9\u6e32\u67d3\u67d0\u4e2a\u7ec4\u4ef6\u3002\u5728\u4e4b\u524d\u5c0f\u8282\u4ecb\u7ecd\u51fd\u6570\u5f0f\u7ec4\u4ef6 Functional Render \u65f6\uff0c\u5df2\u7ecf\u8bf4\u8fc7\uff0c\u5b83\u662f\u4e00\u4e2a\u6ca1\u6709\u4e0a\u4e0b\u6587\u7684\u51fd\u6570\uff0c\u5e38\u7528\u4e8e\u7a0b\u5e8f\u5316\u5730\u5728\u591a\u4e2a\u7ec4\u4ef6\u4e2d\u9009\u62e9\u4e00\u4e2a\u3002\u4f7f\u7528 Render \u6216 Functional Render \u53ef\u4ee5\u89e3\u51b3\u52a8\u6001\u5207\u6362\u7ec4\u4ef6\u7684\u9700\u6c42\uff0c\u4e0d\u8fc7\u90a3\u662f\u57fa\u4e8e\u4e00\u4e2a JS \u5bf9\u8c61\uff08Render \u51fd\u6570\uff09\uff0c\u800c Vue.js \u63d0\u4f9b\u4e86\u53e6\u5916\u4e00\u4e2a\u5185\u7f6e\u7684\u7ec4\u4ef6 `<component>` \u548c `is` \u7279\u6027\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u5b9e\u73b0\u52a8\u6001\u7ec4\u4ef6\u3002\n\n\u5148\u6765\u770b\u4e00\u4e2a `<component>` \u548c `is` \u7684\u57fa\u672c\u793a\u4f8b\uff0c\u9996\u5148\u5b9a\u4e49\u4e09\u4e2a\u666e\u901a\u7ec4\u4ef6\uff1a\n\n```\n<!-- a.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 A\n  </div>\n</template>\n<script>\n  export default {\n\n  }\n</script>\n\n```\n\n```\n<!-- b.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 B\n  </div>\n</template>\n<script>\n  export default {\n\n  }\n</script>\n\n```\n\n```\n<!-- c.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 C\n  </div>\n</template>\n<script>\n  export default {\n\n  }\n</script>\n\n```\n\n\u7136\u540e\u5728\u7236\u7ec4\u4ef6\u4e2d\u5bfc\u5165\u8fd9 3 \u4e2a\u7ec4\u4ef6\uff0c\u5e76\u52a8\u6001\u5207\u6362\uff1a\n\n```\n<template>\n  <div>\n    <button @click=\"handleChange('A')\">\u663e\u793a A \u7ec4\u4ef6</button>\n    <button @click=\"handleChange('B')\">\u663e\u793a B \u7ec4\u4ef6</button>\n    <button @click=\"handleChange('C')\">\u663e\u793a C \u7ec4\u4ef6</button>\n\n    <component :is=\"component\"></component>\n  </div>\n</template>\n<script>\n  import componentA from '../components/a.vue';\n  import componentB from '../components/b.vue';\n  import componentC from '../components/c.vue';\n\n  export default {\n    data () {\n      return {\n        component: componentA\n      }\n    },\n    methods: {\n      handleChange (component) {\n        if (component === 'A') {\n          this.component = componentA;\n        } else if (component === 'B') {\n          this.component = componentB;\n        } else if (component === 'C') {\n          this.component = componentC;\n        }\n      }\n    }\n  }\n</script>\n\n```\n\n\u8fd9\u91cc\u7684 `is` \u52a8\u6001\u7ed1\u5b9a\u7684\u662f\u4e00\u4e2a\u7ec4\u4ef6\u5bf9\u8c61\uff08Object\uff09\uff0c\u5b83\u76f4\u63a5\u6307\u5411 a / b / c \u4e09\u4e2a\u7ec4\u4ef6\u4e2d\u7684\u4e00\u4e2a\u3002\u9664\u4e86\u76f4\u63a5\u7ed1\u5b9a\u4e00\u4e2a Object\uff0c\u8fd8\u53ef\u4ee5\u662f\u4e00\u4e2a String\uff0c\u6bd4\u5982\u6807\u7b7e\u540d\u3001\u7ec4\u4ef6\u540d\u3002\u4e0b\u9762\u7684\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u5c06\u539f\u751f\u7684\u6309\u94ae button \u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u5982\u679c\u4f20\u5165\u4e86 `prop: to`\uff0c\u90a3\u5b83\u4f1a\u6e32\u67d3\u4e3a\u4e00\u4e2a `<a>` \u6807\u7b7e\uff0c\u7528\u4e8e\u6253\u5f00\u8fd9\u4e2a\u94fe\u63a5\u5730\u5740\uff0c\u5982\u679c\u6ca1\u6709\u4f20\u5165 `to`\uff0c\u5c31\u5f53\u4f5c\u666e\u901a button \u4f7f\u7528\u3002\u6765\u770b\u4e0b\u9762\u7684\u793a\u4f8b\uff1a\n\n```\n<!-- button.vue -->\n<template>\n  <component :is=\"tagName\" v-bind=\"tagProps\">\n    <slot></slot>\n  </component>\n</template>\n<script>\n  export default {\n    props: {\n      // \u94fe\u63a5\u5730\u5740\n      to: {\n        type: String,\n        default: ''\n      },\n      // \u94fe\u63a5\u6253\u5f00\u65b9\u5f0f\uff0c\u5982 _blank\n      target: {\n        type: String,\n        default: '_self'\n      }\n    },\n    computed: {\n      // \u52a8\u6001\u6e32\u67d3\u4e0d\u540c\u7684\u6807\u7b7e\n      tagName () {\n        return this.to === '' ? 'button' : 'a';\n      },\n      // \u5982\u679c\u662f\u94fe\u63a5\uff0c\u628a\u8fd9\u4e9b\u5c5e\u6027\u90fd\u7ed1\u5b9a\u5728 component \u4e0a\n      tagProps () {\n        let props = {};\n\n        if (this.to) {\n          props = {\n            target: this.target,\n            href: this.to\n          }\n        }\n\n        return props;\n      }\n    }\n  }\n</script>\n\n```\n\n\u4f7f\u7528\u7ec4\u4ef6\uff1a\n\n```\n<template>\n  <div>\n    <i-button>\u666e\u901a\u6309\u94ae</i-button>\n    <br>\n    <i-button to=\"https://juejin.im\">\u94fe\u63a5\u6309\u94ae</i-button>\n    <br>\n    <i-button to=\"https://juejin.im\" target=\"_blank\">\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5\u6309\u94ae</i-button>\n  </div>\n</template>\n<script>\n  import iButton from '../components/a.vue';\n\n  export default {\n    components: { iButton }\n  }\n</script>\n\n```\n\n\u6700\u7ec8\u4f1a\u6e32\u67d3\u51fa\u4e00\u4e2a\u539f\u751f\u7684 `<button>` \u6309\u94ae\u548c\u4e24\u4e2a\u539f\u751f\u7684\u94fe\u63a5 `<a>`\uff0c\u4e14\u7b2c\u4e8c\u4e2a\u70b9\u51fb\u4f1a\u5728\u65b0\u7a97\u53e3\u4e2d\u6253\u5f00\u94fe\u63a5\uff0c\u5982\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/22/167398c004dc0c60?w=328&h=166&f=png&s=18861)\n\ni-button \u7ec4\u4ef6\u4e2d\u7684 `<component>` `is` \u7ed1\u5b9a\u7684\u5c31\u662f\u4e00\u4e2a\u6807\u7b7e\u540d\u79f0 button / a\uff0c\u5e76\u4e14\u901a\u8fc7 `v-bind` \u5c06\u4e00\u4e9b\u989d\u5916\u7684\u5c5e\u6027\u5168\u90e8\u7ed1\u5b9a\u5230\u4e86 `<component>` \u4e0a\u3002\n\n\u518d\u56de\u5230\u7b2c\u4e00\u4e2a a / b / c \u7ec4\u4ef6\u5207\u6362\u7684\u793a\u4f8b\uff0c\u5982\u679c\u8fd9\u7c7b\u7684\u7ec4\u4ef6\uff0c\u9891\u7e41\u5207\u6362\uff0c\u4e8b\u5b9e\u4e0a\u7ec4\u4ef6\u662f\u4f1a\u91cd\u65b0\u6e32\u67d3\u7684\uff0c\u6bd4\u5982\u6211\u4eec\u5728\u7ec4\u4ef6 A \u91cc\u52a0\u4e24\u4e2a\u751f\u547d\u5468\u671f\uff1a\n\n```\n<!-- a.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 A\n  </div>\n</template>\n<script>\n  export default {\n    mounted () {\n      console.log('\u7ec4\u4ef6\u521b\u5efa\u4e86');\n    },\n    beforeDestroy () {\n      console.log('\u7ec4\u4ef6\u9500\u6bc1\u4e86');\n    }\n  }\n</script>\n\n```\n\n\u53ea\u8981\u5207\u6362\u5230 A \u7ec4\u4ef6\uff0c`mounted` \u5c31\u4f1a\u89e6\u53d1\u4e00\u6b21\uff0c\u5207\u6362\u5230\u5176\u5b83\u7ec4\u4ef6\uff0c`beforeDestroy` \u4e5f\u4f1a\u89e6\u53d1\u4e00\u6b21\uff0c\u8bf4\u660e\u7ec4\u4ef6\u518d\u91cd\u65b0\u6e32\u67d3\uff0c\u8fd9\u6837\u6709\u53ef\u80fd\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\u3002\u4e3a\u4e86\u907f\u514d\u7ec4\u4ef6\u7684\u91cd\u590d\u6e32\u67d3\uff0c\u53ef\u4ee5\u5728 `<component>` \u5916\u5c42\u5957\u4e00\u4e2a Vue.js \u5185\u7f6e\u7684 `<keep-alive>` \u7ec4\u4ef6\uff0c\u8fd9\u6837\uff0c\u7ec4\u4ef6\u5c31\u4f1a\u88ab\u7f13\u5b58\u8d77\u6765\uff1a\n\n```\n<keep-alive>\n  <component :is=\"component\"></component>\n</keep-alive>\n\n```\n\n\u8fd9\u65f6\uff0c\u53ea\u6709 `mounted` \u89e6\u53d1\u4e86\uff0c\u5982\u679c\u4e0d\u79bb\u5f00\u5f53\u524d\u9875\u9762\uff0c\u5207\u6362\u5230\u5176\u5b83\u7ec4\u4ef6\uff0c`beforeDestroy` \u4e0d\u4f1a\u88ab\u89e6\u53d1\uff0c\u8bf4\u660e\u7ec4\u4ef6\u5df2\u7ecf\u88ab\u7f13\u5b58\u4e86\u3002\n\nkeep-alive \u8fd8\u6709\u4e00\u4e9b\u989d\u5916\u7684 props \u53ef\u4ee5\u914d\u7f6e\uff1a\n\n*   `include`\uff1a\u5b57\u7b26\u4e32\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u53ea\u6709\u540d\u79f0\u5339\u914d\u7684\u7ec4\u4ef6\u4f1a\u88ab\u7f13\u5b58\u3002\n*   `exclude`\uff1a\u5b57\u7b26\u4e32\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u4efb\u4f55\u540d\u79f0\u5339\u914d\u7684\u7ec4\u4ef6\u90fd\u4e0d\u4f1a\u88ab\u7f13\u5b58\u3002\n*   `max`\uff1a\u6570\u5b57\u3002\u6700\u591a\u53ef\u4ee5\u7f13\u5b58\u591a\u5c11\u7ec4\u4ef6\u5b9e\u4f8b\u3002\n\n## \u7ed3\u8bed\n\n\u8fd8\u6709\u4e00\u7c7b\u662f\u5f02\u6b65\u7ec4\u4ef6\uff0cVue.js \u6587\u6863\u5df2\u7ecf\u4ecb\u7ecd\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u53ef\u4ee5\u9605\u8bfb\u6587\u672b\u7684\u6269\u5c55\u9605\u8bfb 1\u3002\u4e8b\u5b9e\u4e0a\u5f02\u6b65\u7ec4\u4ef6\u6211\u4eec\u7528\u7684\u5f88\u591a\uff0c\u6bd4\u5982 router \u7684\u914d\u7f6e\u5217\u8868\uff0c\u4e00\u822c\u90fd\u662f\u7528\u7684\u5f02\u6b65\u7ec4\u4ef6\u5f62\u5f0f\uff1a\n\n```\n{\n  path: '/form',\n  component: () => import('./views/form.vue')\n}\n\n```\n\n\u8fd9\u6837\u6bcf\u4e2a\u9875\u9762\u624d\u4f1a\u5728\u8def\u7531\u5230\u65f6\u624d\u52a0\u8f7d\u5bf9\u5e94\u7684 JS \u6587\u4ef6\uff0c\u5426\u5219\u5165\u53e3\u6587\u4ef6\u4f1a\u975e\u5e38\u5e9e\u5927\u3002\n\n\u9012\u5f52\u7ec4\u4ef6\u3001\u52a8\u6001\u7ec4\u4ef6\u548c\u5f02\u6b65\u7ec4\u4ef6\u662f Vue.js \u4e2d\u76f8\u5bf9\u51b7\u95e8\u7684 3 \u79cd\u7ec4\u4ef6\u6a21\u5f0f\uff0c\u4e0d\u8fc7\u5728\u5c01\u88c5\u590d\u6742\u7684\u72ec\u7acb\u7ec4\u4ef6\u65f6\uff0c\u524d\u4e24\u8005\u4f1a\u7ecf\u5e38\u4f7f\u7528\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [\u5f02\u6b65\u7ec4\u4ef6](https://cn.vuejs.org/v2/guide/components-dynamic-async.html#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6)", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u9012\u5f52\u7ec4\u4ef6\u4e0e\u52a8\u6001\u7ec4\u4ef6.md", "create_date": "2020-02-18T21:37:08.759", "order": 14}}, {"model": "subject.chapter", "pk": 99, "fields": {"title": "\u57fa\u7840\uff1aVue.js \u7ec4\u4ef6\u7684\u4e09\u4e2a API\uff1aprop\u3001event\u3001slot", "topic": 5, "md5": "3d512385d910fac21b32b6a2a8a16b49", "md_body": "# \u57fa\u7840\uff1aVue.js \u7ec4\u4ef6\u7684\u4e09\u4e2a API\uff1aprop\u3001event\u3001slot\n\n> \u5982\u679c\u60a8\u5df2\u7ecf\u5bf9 Vue.js \u7ec4\u4ef6\u7684\u57fa\u7840\u7528\u6cd5\u4e86\u5982\u6307\u638c\uff0c\u53ef\u4ee5\u8df3\u8fc7\u672c\u5c0f\u8282\uff0c\u4e0d\u8fc7\u5f53\u505a\u590d\u4e60\u7a0d\u8bfb\u4e00\u4e0b\u4e5f\u65e0\u59a8\u3002\n\n## \u7ec4\u4ef6\u7684\u6784\u6210\n\n\u4e00\u4e2a\u518d\u590d\u6742\u7684\u7ec4\u4ef6\uff0c\u90fd\u662f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\u7684\uff1aprop\u3001event\u3001slot\uff0c\u5b83\u4eec\u6784\u6210\u4e86 Vue.js \u7ec4\u4ef6\u7684 API\u3002\u5982\u679c\u4f60\u5f00\u53d1\u7684\u662f\u4e00\u4e2a\u901a\u7528\u7ec4\u4ef6\uff0c\u90a3\u4e00\u5b9a\u8981\u4e8b\u5148\u8bbe\u8ba1\u597d\u8fd9\u4e09\u90e8\u5206\uff0c\u56e0\u4e3a\u7ec4\u4ef6\u4e00\u65e6\u53d1\u5e03\uff0c\u540e\u9762\u518d\u4fee\u6539 API \u5c31\u5f88\u56f0\u96be\u4e86\uff0c\u4f7f\u7528\u8005\u90fd\u662f\u5e0c\u671b\u4e0d\u65ad\u65b0\u589e\u529f\u80fd\uff0c\u4fee\u590d bug\uff0c\u800c\u4e0d\u662f\u7ecf\u5e38\u53d8\u66f4\u63a5\u53e3\u3002\u5982\u679c\u4f60\u9605\u8bfb\u522b\u4eba\u5199\u7684\u7ec4\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u4ece\u8fd9\u4e09\u4e2a\u90e8\u5206\u5c55\u5f00\uff0c\u5b83\u4eec\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5feb\u901f\u4e86\u89e3\u4e00\u4e2a\u7ec4\u4ef6\u7684\u6240\u6709\u529f\u80fd\u3002\n\n### \u5c5e\u6027 prop\n\n`prop` \u5b9a\u4e49\u4e86\u8fd9\u4e2a\u7ec4\u4ef6\u6709\u54ea\u4e9b\u53ef\u914d\u7f6e\u7684\u5c5e\u6027\uff0c\u7ec4\u4ef6\u7684\u6838\u5fc3\u529f\u80fd\u4e5f\u90fd\u662f\u5b83\u6765\u786e\u5b9a\u7684\u3002\u5199\u901a\u7528\u7ec4\u4ef6\u65f6\uff0cprops \u6700\u597d\u7528**\u5bf9\u8c61**\u7684\u5199\u6cd5\uff0c\u8fd9\u6837\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e2a\u5c5e\u6027\u8bbe\u7f6e\u7c7b\u578b\u3001\u9ed8\u8ba4\u503c\u6216\u81ea\u5b9a\u4e49\u6821\u9a8c\u5c5e\u6027\u7684\u503c\uff0c\u8fd9\u70b9\u5728\u7ec4\u4ef6\u5f00\u53d1\u4e2d\u5f88\u91cd\u8981\uff0c\u7136\u800c\u5f88\u591a\u4eba\u5374\u5ffd\u89c6\uff0c\u76f4\u63a5\u4f7f\u7528 props \u7684\u6570\u7ec4\u7528\u6cd5\uff0c\u8fd9\u6837\u7684\u7ec4\u4ef6\u5f80\u5f80\u662f\u4e0d\u4e25\u8c28\u7684\u3002\u6bd4\u5982\u6211\u4eec\u5c01\u88c5\u4e00\u4e2a\u6309\u94ae\u7ec4\u4ef6 `<i-button>`\uff1a\n\n```\n<template>\n  <button :class=\"'i-button-size' + size\" :disabled=\"disabled\"></button>\n</template>\n<script>\n  // \u5224\u65ad\u53c2\u6570\u662f\u5426\u662f\u5176\u4e2d\u4e4b\u4e00\n  function oneOf (value, validList) {\n    for (let i = 0; i < validList.length; i++) {\n      if (value === validList[i]) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  export default {\n    props: {\n      size: {\n        validator (value) {\n          return oneOf(value, ['small', 'large', 'default']);\n        },\n        default: 'default'\n      },\n      disabled: {\n        type: Boolean,\n        default: false\n      }\n    }\n  }\n</script>\n\n```\n\n\u4f7f\u7528\u7ec4\u4ef6\uff1a\n\n```\n<i-button size=\"large\"></i-button>\n<i-button disabled></i-button>\n\n```\n\n\u7ec4\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u4e24\u4e2a\u5c5e\u6027\uff1a\u5c3a\u5bf8 size \u548c \u662f\u5426\u7981\u7528 disabled\u3002\u5176\u4e2d size \u4f7f\u7528 `validator` \u8fdb\u884c\u4e86\u503c\u7684\u81ea\u5b9a\u4e49\u9a8c\u8bc1\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u7236\u7ea7\u4f20\u5165\u7684 size\uff0c\u5b83\u7684\u503c\u5fc5\u987b\u662f\u6307\u5b9a\u7684 **small\u3001large\u3001default** \u4e2d\u7684\u4e00\u4e2a\uff0c\u9ed8\u8ba4\u503c\u662f default\uff0c\u5982\u679c\u4f20\u5165\u8fd9\u4e09\u4e2a\u4ee5\u5916\u7684\u503c\uff0c\u90fd\u4f1a\u629b\u51fa\u4e00\u6761\u8b66\u544a\u3002\n\n\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7ec4\u4ef6\u91cc\u5b9a\u4e49\u7684 props\uff0c\u90fd\u662f**\u5355\u5411\u6570\u636e\u6d41**\uff0c\u4e5f\u5c31\u662f\u53ea\u80fd\u901a\u8fc7\u7236\u7ea7\u4fee\u6539\uff0c\u7ec4\u4ef6\u81ea\u5df1\u4e0d\u80fd\u4fee\u6539 props \u7684\u503c\uff0c\u53ea\u80fd\u4fee\u6539\u5b9a\u4e49\u5728 data \u91cc\u7684\u6570\u636e\uff0c\u975e\u8981\u4fee\u6539\uff0c\u4e5f\u662f\u901a\u8fc7\u540e\u9762\u4ecb\u7ecd\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u901a\u77e5\u7236\u7ea7\uff0c\u7531\u7236\u7ea7\u6765\u4fee\u6539\u3002\n\n\u5728\u4f7f\u7528\u7ec4\u4ef6\u65f6\uff0c\u4e5f\u53ef\u4ee5\u4f20\u5165\u4e00\u4e9b\u6807\u51c6\u7684 html \u7279\u6027\uff0c\u6bd4\u5982 **id**\u3001**class**\uff1a\n\n```\n<i-button id=\"btn1\" class=\"btn-submit\"></i-button>\n\n```\n\n\u8fd9\u6837\u7684 html \u7279\u6027\uff0c\u5728\u7ec4\u4ef6\u5185\u7684 `<button>` \u5143\u7d20\u4e0a\u4f1a\u7ee7\u627f\uff0c\u5e76\u4e0d\u9700\u8981\u5728 props \u91cc\u518d\u5b9a\u4e49\u4e00\u904d\u3002\u8fd9\u4e2a\u7279\u6027\u662f\u9ed8\u8ba4\u652f\u6301\u7684\uff0c\u5982\u679c\u4e0d\u671f\u671b\u5f00\u542f\uff0c\u5728\u7ec4\u4ef6\u9009\u9879\u91cc\u914d\u7f6e `inheritAttrs: false` \u5c31\u53ef\u4ee5\u7981\u7528\u4e86\u3002\n\n### \u63d2\u69fd slot\n\n\u5982\u679c\u8981\u7ed9\u4e0a\u9762\u7684\u6309\u94ae\u7ec4\u4ef6 `<i-button>` \u6dfb\u52a0\u4e00\u4e9b\u6587\u5b57\u5185\u5bb9\uff0c\u5c31\u8981\u7528\u5230\u7ec4\u4ef6\u7684\u7b2c\u4e8c\u4e2a API\uff1a\u63d2\u69fd slot\uff0c\u5b83\u53ef\u4ee5\u5206\u53d1\u7ec4\u4ef6\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u5728\u4e0a\u9762\u7684\u6309\u94ae\u7ec4\u4ef6\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u63d2\u69fd\uff1a\n\n```\n<template>\n  <button :class=\"'i-button-size' + size\" :disabled=\"disabled\">\n    <slot></slot>\n  </button>\n</template>\n\n```\n\n\u8fd9\u91cc\u7684 `<slot>` \u8282\u70b9\u5c31\u662f\u6307\u5b9a\u7684\u4e00\u4e2a\u63d2\u69fd\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u5728\u7ec4\u4ef6\u5185\u90e8\u5c31\u53ef\u4ee5\u6269\u5c55\u5185\u5bb9\u4e86\uff1a\n\n```\n<i-button>\u6309\u94ae 1</i-button>\n<i-button>\n  <strong>\u6309\u94ae 2</strong>\n</i-button>\n\n```\n\n\u5f53\u9700\u8981\u591a\u4e2a\u63d2\u69fd\u65f6\uff0c\u4f1a\u7528\u5230\u5177\u540d slot\uff0c\u6bd4\u5982\u4e0a\u9762\u7684\u7ec4\u4ef6\u6211\u4eec\u518d\u589e\u52a0\u4e00\u4e2a slot\uff0c\u7528\u4e8e\u8bbe\u7f6e\u53e6\u4e00\u4e2a\u56fe\u6807\u7ec4\u4ef6\uff1a\n\n```\n<template>\n  <button :class=\"'i-button-size' + size\" :disabled=\"disabled\">\n    <slot name=\"icon\"></slot>\n    <slot></slot>\n  </button>\n</template>\n\n```\n\n```\n<i-button>\n  <i-icon slot=\"icon\" type=\"checkmark\"></i-icon>\n  \u6309\u94ae 1\n</i-button>\n\n```\n\n\u8fd9\u6837\uff0c\u7236\u7ea7\u5185\u5b9a\u4e49\u7684\u5185\u5bb9\uff0c\u5c31\u4f1a\u51fa\u73b0\u5728\u7ec4\u4ef6\u5bf9\u5e94\u7684 slot \u91cc\uff0c\u6ca1\u6709\u5199\u540d\u5b57\u7684\uff0c\u5c31\u662f\u9ed8\u8ba4\u7684 slot\u3002\n\n\u5728\u7ec4\u4ef6\u7684 `<slot>` \u91cc\u4e5f\u53ef\u4ee5\u5199\u4e00\u4e9b\u9ed8\u8ba4\u7684\u5185\u5bb9\uff0c\u8fd9\u6837\u5728\u7236\u7ea7\u6ca1\u6709\u5199\u4efb\u4f55 slot \u65f6\uff0c\u5b83\u4eec\u5c31\u4f1a\u51fa\u73b0\uff0c\u6bd4\u5982\uff1a\n\n```\n<slot>\u63d0\u4ea4</slot>\n\n```\n\n### \u81ea\u5b9a\u4e49\u4e8b\u4ef6 event\n\n\u73b0\u5728\u6211\u4eec\u7ed9\u7ec4\u4ef6 `<i-button>` \u52a0\u4e00\u4e2a\u70b9\u51fb\u4e8b\u4ef6\uff0c\u76ee\u524d\u6709\u4e24\u79cd\u5199\u6cd5\uff0c\u6211\u4eec\u5148\u770b\u81ea\u5b9a\u4e49\u4e8b\u4ef6 event\uff08\u90e8\u5206\u4ee3\u7801\u7701\u7565\uff09\uff1a\n\n```\n<template>\n  <button @click=\"handleClick\">\n    <slot></slot>\n  </button>\n</template>\n<script>\n  export default {\n    methods: {\n      handleClick (event) {\n        this.$emit('on-click', event);\n      }\n    }\n  }\n</script>\n\n```\n\n\u901a\u8fc7 `$emit`\uff0c\u5c31\u53ef\u4ee5\u89e6\u53d1\u81ea\u5b9a\u4e49\u7684\u4e8b\u4ef6 `on-click` \uff0c\u5728\u7236\u7ea7\u901a\u8fc7 `@on-click` \u6765\u76d1\u542c\uff1a\n\n```\n<i-button @on-click=\"handleClick\"></i-button>\n\n```\n\n\u4e0a\u9762\u7684 click \u4e8b\u4ef6\uff0c\u662f\u5728\u7ec4\u4ef6\u5185\u90e8\u7684 `<button>` \u5143\u7d20\u4e0a\u58f0\u660e\u7684\uff0c\u8fd9\u91cc\u8fd8\u6709\u53e6\u4e00\u79cd\u65b9\u6cd5\uff0c\u76f4\u63a5\u5728\u7236\u7ea7\u58f0\u660e\uff0c\u4f46\u4e3a\u4e86\u533a\u5206\u539f\u751f\u4e8b\u4ef6\u548c\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u8981\u7528\u5230\u4e8b\u4ef6\u4fee\u9970\u7b26 `.native`\uff0c\u6240\u4ee5\u4e0a\u9762\u7684\u793a\u4f8b\u4e5f\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a\n\n```\n<i-button @click.native=\"handleClick\"></i-button>\n\n```\n\n\u5982\u679c\u4e0d\u5199 `.native` \u4fee\u9970\u7b26\uff0c\u90a3\u4e0a\u9762\u7684 `@click` \u5c31\u662f**\u81ea\u5b9a\u4e49\u4e8b\u4ef6** click\uff0c\u800c\u975e**\u539f\u751f\u4e8b\u4ef6** click\uff0c\u4f46\u6211\u4eec\u5728\u7ec4\u4ef6\u5185\u53ea\u89e6\u53d1\u4e86 `on-click` \u4e8b\u4ef6\uff0c\u800c\u4e0d\u662f `click`\uff0c\u6240\u4ee5\u76f4\u63a5\u5199 `@click` \u4f1a\u76d1\u542c\u4e0d\u5230\u3002\n\n## \u7ec4\u4ef6\u7684\u901a\u4fe1\n\n\u4e00\u822c\u6765\u8bf4\uff0c\u7ec4\u4ef6\u53ef\u4ee5\u6709\u4ee5\u4e0b\u51e0\u79cd\u5173\u7cfb\uff1a\n\n![\u7ec4\u4ef6\u5173\u7cfb](https://user-gold-cdn.xitu.io/2018/10/18/166864d066bbcf69?w=790&h=632&f=png&s=36436)\n\nA \u548c B\u3001B \u548c C\u3001B \u548c D \u90fd\u662f\u7236\u5b50\u5173\u7cfb\uff0cC \u548c D \u662f\u5144\u5f1f\u5173\u7cfb\uff0cA \u548c C \u662f\u9694\u4ee3\u5173\u7cfb\uff08\u53ef\u80fd\u9694\u591a\u4ee3\uff09\u3002\u7ec4\u4ef6\u95f4\u7ecf\u5e38\u4f1a\u901a\u4fe1\uff0cVue.js \u5185\u7f6e\u7684\u901a\u4fe1\u624b\u6bb5\u4e00\u822c\u6709\u4e24\u79cd\uff1a\n\n*   `ref`\uff1a\u7ed9\u5143\u7d20\u6216\u7ec4\u4ef6\u6ce8\u518c\u5f15\u7528\u4fe1\u606f\uff1b\n*   `$parent` / `$children`\uff1a\u8bbf\u95ee\u7236 / \u5b50\u5b9e\u4f8b\u3002\n\n\u8fd9\u4e24\u79cd\u90fd\u662f\u76f4\u63a5\u5f97\u5230\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u4f7f\u7528\u540e\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u7ec4\u4ef6\u7684\u65b9\u6cd5\u6216\u8bbf\u95ee\u6570\u636e\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u7528 ref \u6765\u8bbf\u95ee\u7ec4\u4ef6\uff08\u90e8\u5206\u4ee3\u7801\u7701\u7565\uff09\uff1a\n\n```\n// component-a\nexport default {\n  data () {\n    return {\n      title: 'Vue.js'\n    }\n  },\n  methods: {\n    sayHello () {\n      window.alert('Hello');\n    }\n  }\n}\n\n```\n\n```\n<template>\n  <component-a ref=\"comA\"></component-a>\n</template>\n<script>\n  export default {\n    mounted () {\n      const comA = this.$refs.comA;\n      console.log(comA.title);  // Vue.js\n      comA.sayHello();  // \u5f39\u7a97\n    }\n  }\n</script>\n\n```\n\n`$parent` \u548c `$children` \u7c7b\u4f3c\uff0c\u4e5f\u662f\u57fa\u4e8e\u5f53\u524d\u4e0a\u4e0b\u6587\u8bbf\u95ee\u7236\u7ec4\u4ef6\u6216\u5168\u90e8\u5b50\u7ec4\u4ef6\u7684\u3002\n\n\u8fd9\u4e24\u79cd\u65b9\u6cd5\u7684\u5f0a\u7aef\u662f\uff0c\u65e0\u6cd5\u5728**\u8de8\u7ea7**\u6216**\u5144\u5f1f**\u95f4\u901a\u4fe1\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u7ed3\u6784\uff1a\n\n```\n// parent.vue\n<component-a></component-a>\n<component-b></component-b>\n<component-b></component-b>\n\n```\n\n\u6211\u4eec\u60f3\u5728 component-a \u4e2d\uff0c\u8bbf\u95ee\u5230\u5f15\u7528\u5b83\u7684\u9875\u9762\u4e2d\uff08\u8fd9\u91cc\u5c31\u662f parent.vue\uff09\u7684\u4e24\u4e2a component-b \u7ec4\u4ef6\uff0c\u90a3\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c31\u5f97\u914d\u7f6e\u989d\u5916\u7684\u63d2\u4ef6\u6216\u5de5\u5177\u4e86\uff0c\u6bd4\u5982 Vuex \u548c Bus \u7684\u89e3\u51b3\u65b9\u6848\uff0c\u672c\u5c0f\u518c\u4e0d\u518d\u505a\u5b83\u4eec\u7684\u4ecb\u7ecd\uff0c\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u9605\u8bfb\u76f8\u5173\u5185\u5bb9\u3002\u4e0d\u8fc7\uff0c\u5b83\u4eec\u90fd\u662f\u4f9d\u8d56\u7b2c\u4e09\u65b9\u63d2\u4ef6\u7684\u5b58\u5728\uff0c\u8fd9\u5728\u5f00\u53d1\u72ec\u7acb\u7ec4\u4ef6\u65f6\u662f\u4e0d\u53ef\u53d6\u7684\uff0c\u800c\u5728\u5c0f\u518c\u7684\u540e\u7eed\u7ae0\u8282\uff0c\u4f1a\u9646\u7eed\u4ecb\u7ecd\u4e00\u4e9b\u9ed1\u79d1\u6280\uff0c\u5b83\u4eec\u5b8c\u5168\u4e0d\u4f9d\u8d56\u4efb\u4f55\u4e09\u65b9\u63d2\u4ef6\uff0c\u5c31\u53ef\u4ee5\u8f7b\u677e\u5f97\u5230\u4efb\u610f\u7684\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u6216\u5728\u4efb\u610f\u7ec4\u4ef6\u95f4\u8fdb\u884c\u901a\u4fe1\uff0c\u4e14\u9002\u7528\u4e8e\u4efb\u610f\u573a\u666f\u3002\n\n## \u7ed3\u8bed\n\n\u672c\u5c0f\u8282\u5e26\u60a8\u590d\u4e60\u4e86 Vue.js \u7ec4\u4ef6\u7684\u6838\u5fc3\u77e5\u8bc6\u70b9\uff0c\u867d\u7136\u8fd9\u5e76\u6ca1\u6709\u5b8c\u5168\u8986\u76d6 Vue.js \u7684 API\uff0c\u4f46\u5bf9\u4e8e\u7ec4\u4ef6\u5f00\u53d1\u6765\u8bf4\u5df2\u7ecf\u8db3\u591f\u4e86\uff0c\u540e\u7eed\u7ae0\u8282\u4e5f\u4f1a\u9646\u7eed\u6269\u5c55\u66f4\u591a\u7684\u7528\u6cd5\u3002\n\n\u57fa\u4e8e Vue.js \u5f00\u53d1\u72ec\u7acb\u7ec4\u4ef6\uff0c\u5e76\u4e0d\u662f\u65b0\u5947\u7684\u6311\u6218\uff0c\u5766\u7387\u5730\u8bb2\uff0c\u5b83\u672c\u8d28\u4e0a\u8fd8\u662f JavaScript\u3002\u638c\u63e1\u4e86 Vue.js \u7ec4\u4ef6\u7684\u8fd9\u4e09\u4e2a API \u540e\uff0c\u5269\u4e0b\u7684\u4fbf\u662f\u7a0b\u5e8f\u7684\u8bbe\u8ba1\u3002\u5728\u7ec4\u4ef6\u5f00\u53d1\u4e2d\uff0c\u6700\u96be\u7684\u73af\u8282\u5e94\u5f53\u662f\u89e3\u8026\u7ec4\u4ef6\u7684\u4ea4\u4e92\u903b\u8f91\uff0c\u5c3d\u91cf\u628a\u590d\u6742\u7684\u903b\u8f91\u5206\u53d1\u5230\u4e0d\u540c\u7684\u5b50\u7ec4\u4ef6\u4e2d\uff0c\u7136\u540e\u5f7c\u6b64\u5efa\u7acb\u8054\u7cfb\uff0c\u5728\u8fd9\u5176\u4e2d\uff0c\u8ba1\u7b97\u5c5e\u6027\uff08computed\uff09\u548c\u6df7\u5408\uff08mixins\uff09\u662f\u4e24\u4e2a\u91cd\u8981\u7684\u6280\u672f\u70b9\uff0c\u5408\u7406\u5229\u7528\uff0c\u5c31\u80fd\u53d1\u6325\u51fa Vue.js \u8bed\u8a00\u7684\u6700\u5927\u7279\u70b9\uff1a\u628a\u72b6\u6001\uff08\u6570\u636e\uff09\u7684\u7ef4\u62a4\u4ea4\u7ed9 Vue.js \u5904\u7406\uff0c\u6211\u4eec\u53ea\u4e13\u6ce8\u5728\u4ea4\u4e92\u4e0a\u3002\n\n\u5f53\u60a8\u6700\u7ec8\u8bfb\u5b8c\u672c\u5c0f\u518c\u65f6\uff0c\u5e94\u8be5\u4f1a\u603b\u7ed3\u51fa\u548c\u7b14\u8005\u4e00\u6837\u7684\u611f\u609f\uff1aVue.js \u7ec4\u4ef6\u5f00\u53d1\uff0c\u73a9\u5230\u6700\u540e\u8fd8\u662f\u5728\u62fc JavaScript \u529f\u5e95\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4f4d\u4f7f\u7528 Vue.js \u7684\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u9605\u8bfb\u5b8c\u672c\u5c0f\u518c\u90fd\u53ef\u4ee5\u5c1d\u8bd5\u5f00\u53d1\u548c\u7ef4\u62a4\u4e00\u5957\u5c5e\u4e8e\u81ea\u5df1\u7684\u7ec4\u4ef6\u5e93\uff0c\u5e76\u4e50\u5728\u5176\u4e2d\uff0c\u800c\u4e14\u4f60\u4f1a\u8d8a\u53d1\u89c9\u5f97\uff0c\u4e00\u4e2a\u7ec4\u4ef6\u6216\u4e00\u5957\u7ec4\u4ef6\u5e93\uff0c\u5c31\u662f\u878d\u5408\u4e86\u524d\u7aef\u7cbe\u9ad3\u7684\u4ea7\u51fa\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [Vue \u7ec4\u4ef6\u901a\u4fe1\u4e4b Bus](https://juejin.im/post/5a4353766fb9a044fb080927)\n*   [Vuex \u901a\u4fd7\u7248\u6559\u7a0b](https://juejin.im/entry/58cb4c36b123db00532076a2)", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u57fa\u7840Vue.js_\u7ec4\u4ef6\u7684\u4e09\u4e2a_APIpropeventslot.md", "create_date": "2020-02-18T21:37:08.762", "order": 2}}, {"model": "subject.chapter", "pk": 100, "fields": {"title": "\u5f00\u7bc7\uff1aVue.js \u7684\u7cbe\u9ad3\u2014\u2014\u7ec4\u4ef6", "topic": 5, "md5": "263d86df0971349d8dd599a846516a7c", "md_body": "# \u5f00\u7bc7\uff1aVue.js \u7684\u7cbe\u9ad3\u2014\u2014\u7ec4\u4ef6\n\n## \u5199\u5728\u524d\u9762\n\nVue.js\uff0c\u65e0\u7591\u662f\u5f53\u4e0b\u6700\u706b\u70ed\u7684\u524d\u7aef\u6846\u67b6 _Almost_\uff0c\u800c Vue.js \u6700\u7cbe\u9ad3\u7684\uff0c\u6b63\u662f\u5b83\u7684\u7ec4\u4ef6\u4e0e\u7ec4\u4ef6\u5316\u3002\u5199\u4e00\u4e2a Vue \u5de5\u7a0b\uff0c\u4e5f\u5c31\u662f\u5728\u5199\u4e00\u4e2a\u4e2a\u7684\u7ec4\u4ef6\u3002\n\n\u4e1a\u52a1\u573a\u666f\u662f\u5343\u53d8\u4e07\u5316\u7684\uff0c\u800c\u4e0d\u53d8\u7684\u662f Vue.js \u7ec4\u4ef6\u5f00\u53d1\u7684\u6838\u5fc3\u601d\u60f3\u548c\u4f7f\u7528\u6280\u5de7\uff0c\u638c\u63e1\u4e86 Vue.js \u7ec4\u4ef6\u7684\u5404\u79cd\u5f00\u53d1\u6a21\u5f0f\uff0c\u518d\u590d\u6742\u7684\u4e1a\u52a1\u573a\u666f\u4e5f\u53ef\u4ee5\u8f7b\u677e\u5316\u89e3\u3002\u672c\u5c0f\u518c\u5219\u7740\u91cd\u4ecb\u7ecd\u7b14\u8005\u5728 3 \u5e74\u7684 Vue.js \u5f00\u53d1\u53ca\u4e24\u5e74\u7684 [iView](https://github.com/iview/iview) \u5f00\u6e90\u4e2d\u79ef\u7d2f\u548c\u6c89\u6dc0\u7684\u5bf9 Vue.js \u7ec4\u4ef6\u7684\u89c1\u89e3\u548c\u7ecf\u9a8c\u3002\n\n\u672c\u5c0f\u518c**\u4e0d\u4f1a**\u4ecb\u7ecd Vue.js \u7684\u57fa\u7840\u7528\u6cd5\uff0c\u56e0\u4e3a\u5e02\u9762\u4e0a\u5df2\u7ecf\u6c89\u6dc0\u4e86\u5927\u91cf\u7684\u76f8\u5173\u6280\u672f\u8d44\u6599\uff0c\u800c\u4e14 Vue.js \u7684\u6587\u6863\u5df2\u7ecf\u8db3\u591f\u8be6\u7ec6\u3002\u5982\u679c\u60a8\u5c1a\u672a\u63a5\u89e6 Vue.js \u6216\u6b63\u6253\u7b97\u5f00\u59cb\u4e86\u89e3\uff0c\u63a8\u8350\u60a8\u5148\u9605\u8bfb\u7b14\u8005\u51fa\u7248\u7684[\u300aVue.js \u5b9e\u6218\u300b](https://item.jd.com/12215519.html)\uff08\u6e05\u534e\u5927\u5b66\u51fa\u7248\u793e\uff09\u4e00\u4e66\uff0c\u5b83\u9002\u5408\u521a\u63a5\u89e6 Vue.js \u7684\u5f00\u53d1\u8005\u3002\u56e0\u6b64\uff0c\u672c\u5c0f\u518c\u9002\u5408\u5df2\u7ecf\u4e86\u89e3\u6216\u4f7f\u7528\u8fc7 Vue.js \u7684\u5f00\u53d1\u8005\u3002\n\n\u8fd9\u4e00\u8282\uff0c\u6211\u4eec\u5148\u7b3c\u7edf\u5730\u804a\u804a Vue.js \u7ec4\u4ef6\u548c\u7ec4\u4ef6\u5316\u4ee5\u53ca\u672c\u5c0f\u518c\u5404\u7ae0\u8282\u7684\u68b3\u7406\u3002\n\n## \u7ec4\u4ef6\u7684\u5206\u7c7b\n\n\u4e00\u822c\u6765\u8bf4\uff0cVue.js \u7ec4\u4ef6\u4e3b\u8981\u5206\u6210\u4e09\u7c7b\uff1a\n\n1.  \u7531 `vue-router` \u4ea7\u751f\u7684\u6bcf\u4e2a\u9875\u9762\uff0c\u5b83\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u4e2a\u7ec4\u4ef6\uff08.vue\uff09\uff0c\u4e3b\u8981\u627f\u8f7d\u5f53\u524d\u9875\u9762\u7684 HTML \u7ed3\u6784\uff0c\u4f1a\u5305\u542b\u6570\u636e\u83b7\u53d6\u3001\u6570\u636e\u6574\u7406\u3001\u6570\u636e\u53ef\u89c6\u5316\u7b49\u5e38\u89c4\u4e1a\u52a1\u3002\u6574\u4e2a\u6587\u4ef6\u76f8\u5bf9\u8f83\u5927\uff0c\u4f46\u4e00\u822c\u4e0d\u4f1a\u6709 `props` \u9009\u9879\u548c `\u81ea\u5b9a\u4e49\u4e8b\u4ef6`\uff0c\u56e0\u4e3a\u5b83\u4f5c\u4e3a\u8def\u7531\u7684\u6e32\u67d3\uff0c\u4e0d\u4f1a\u88ab\u590d\u7528\uff0c\u56e0\u6b64\u4e5f\u4e0d\u4f1a\u5bf9\u5916\u63d0\u4f9b\u63a5\u53e3\u3002\n    \n    \u5728\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u5199\u7684\u5927\u90e8\u5206\u4ee3\u7801\u90fd\u662f\u8fd9\u7c7b\u7684\u7ec4\u4ef6\uff08\u9875\u9762\uff09\uff0c\u534f\u540c\u5f00\u53d1\u65f6\uff0c\u6bcf\u4eba\u7ef4\u62a4\u81ea\u5df1\u7684\u9875\u9762\uff0c\u5f88\u5c11\u6709\u4ea4\u96c6\u3002\u8fd9\u7c7b\u7ec4\u4ef6\u76f8\u5bf9\u662f\u6700\u597d\u5199\u7684\uff0c\u56e0\u4e3a\u4e3b\u8981\u662f\u8fd8\u539f\u8bbe\u8ba1\u7a3f\uff0c\u5b8c\u6210\u9700\u6c42\uff0c\u4e0d\u9700\u8981\u592a\u591a\u6a21\u5757\u548c\u67b6\u6784\u8bbe\u8ba1\u4e0a\u7684\u8003\u8651\u3002\n    \n2.  \u4e0d\u5305\u542b\u4e1a\u52a1\uff0c\u72ec\u7acb\u3001\u5177\u4f53\u529f\u80fd\u7684\u57fa\u7840\u7ec4\u4ef6\uff0c\u6bd4\u5982**\u65e5\u671f\u9009\u62e9\u5668**\u3001**\u6a21\u6001\u6846**\u7b49\u3002\u8fd9\u7c7b\u7ec4\u4ef6\u4f5c\u4e3a\u9879\u76ee\u7684\u57fa\u7840\u63a7\u4ef6\uff0c\u4f1a\u88ab\u5927\u91cf\u4f7f\u7528\uff0c\u56e0\u6b64\u7ec4\u4ef6\u7684 API \u8fdb\u884c\u8fc7\u9ad8\u5f3a\u5ea6\u7684\u62bd\u8c61\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0d\u540c\u914d\u7f6e\u5b9e\u73b0\u4e0d\u540c\u7684\u529f\u80fd\u3002\u6bd4\u5982\u7b14\u8005\u5f00\u6e90\u7684 iView\uff0c\u5c31\u662f\u5305\u542b\u4e86 50 \u591a\u4e2a\u8fd9\u6837\u57fa\u7840\u7ec4\u4ef6\u7684 UI \u7ec4\u4ef6\u5e93\u3002\n    \n    \u6bcf\u4e2a\u516c\u53f8\u90fd\u6709\u81ea\u5df1\u7684\u7ec4\u4ef6\u4f7f\u7528\u89c4\u8303\u6216\u7ec4\u4ef6\u5e93\uff0c\u4f46\u8981\u5f00\u53d1\u548c\u7ef4\u62a4\u4e00\u5957\u50cf iView \u8fd9\u6837\u7684\u7ec4\u4ef6\u5e93\uff0c\u6295\u5165\u7684\u4eba\u529b\u548c\u7cbe\u529b\u8fd8\u662f\u5f88\u91cd\u7684\uff0c\u6240\u4ee5\u51fa\u4e8e\u6210\u672c\u8003\u8651\uff0c\u5f88\u591a\u9879\u76ee\u90fd\u4f1a\u4f7f\u7528\u5df2\u6709\u7684\u5f00\u6e90\u7ec4\u4ef6\u5e93\u3002\n    \n    \u72ec\u7acb\u7ec4\u4ef6\u7684\u5f00\u53d1\u96be\u5ea6\u8981\u9ad8\u4e8e\u7b2c\u4e00\u7c7b\u7ec4\u4ef6\uff0c\u56e0\u4e3a\u5b83\u7684\u4fa7\u91cd\u70b9\u662f API \u7684\u8bbe\u8ba1\u3001\u517c\u5bb9\u6027\u3001\u6027\u80fd\u3001\u4ee5\u53ca\u590d\u6742\u7684\u529f\u80fd\u3002\u8fd9\u7c7b\u7ec4\u4ef6\u5bf9 JavaScript \u7684\u7f16\u7a0b\u80fd\u529b\u6709\u4e00\u5b9a\u8981\u6c42\uff0c\u4e5f\u4f1a\u5305\u542b\u975e\u5e38\u591a\u7684\u6280\u5de7\uff0c\u6bd4\u5982\u5728\u4e0d\u4f9d\u8d56 Vuex \u548c Bus\uff08\u56e0\u4e3a\u72ec\u7acb\u7ec4\u4ef6\uff0c\u65e0\u6cd5\u4f9d\u8d56\u5176\u5b83\u5e93\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u5404\u7ec4\u4ef6\u95f4\u7684\u901a\u4fe1\uff0c\u8fd8\u4f1a\u6d89\u53ca\u5f88\u591a\u8111\u58f3\u75bc\u7684\u903b\u8f91\uff0c\u6bd4\u5982\u65e5\u671f\u9009\u62e9\u5668\u8981\u8003\u8651\u4e0d\u540c\u65f6\u533a\u3001\u56fd\u5bb6\u7684\u65e5\u5386\u4e60\u60ef\uff0c\u652f\u6301\u591a\u79cd\u65e5\u671f\u683c\u5f0f\u3002\n    \n    \u672c\u5c0f\u518c\u4e5f\u4f1a\u91cd\u70b9\u4ecb\u7ecd\u6b64\u7c7b\u7ec4\u4ef6\u7684\u5404\u79cd\u5f00\u53d1\u6a21\u5f0f\u548c\u6280\u5de7\uff0c\u5bf9\u5e94\u4e0d\u540c\u7684\u6a21\u5f0f\uff0c\u4f1a\u5e26\u6709\u5177\u4f53\u7684\u7ec4\u4ef6\u5b9e\u6218\u3002\n    \n3.  \u4e1a\u52a1\u7ec4\u4ef6\u3002\u5b83\u4e0d\u50cf\u7b2c\u4e8c\u7c7b\u72ec\u7acb\u7ec4\u4ef6\u53ea\u5305\u542b\u67d0\u4e2a\u529f\u80fd\uff0c\u800c\u662f\u5728\u4e1a\u52a1\u4e2d\u88ab\u591a\u4e2a\u9875\u9762\u590d\u7528\u7684\uff0c\u5b83\u4e0e\u72ec\u7acb\u7ec4\u4ef6\u7684\u533a\u522b\u662f\uff0c\u4e1a\u52a1\u7ec4\u4ef6\u53ea\u5728\u5f53\u524d\u9879\u76ee\u4e2d\u4f1a\u7528\u5230\uff0c\u4e0d\u5177\u6709\u901a\u7528\u6027\uff0c\u800c\u4e14\u4f1a\u5305\u542b\u4e00\u4e9b\u4e1a\u52a1\uff0c\u6bd4\u5982\u6570\u636e\u8bf7\u6c42\uff1b\u800c\u72ec\u7acb\u7ec4\u4ef6\u4e0d\u542b\u4e1a\u52a1\uff0c\u5728\u4efb\u4f55\u9879\u76ee\u4e2d\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u529f\u80fd\u5355\u4e00\uff0c\u6bd4\u5982\u4e00\u4e2a\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8f93\u5165\u6846\u3002\n    \n    \u4e1a\u52a1\u7ec4\u4ef6\u66f4\u50cf\u662f\u4ecb\u4e8e\u7b2c\u4e00\u7c7b\u548c\u7b2c\u4e8c\u7c7b\u4e4b\u95f4\uff0c\u5728\u5f00\u53d1\u4e0a\u4e5f\u4e0e\u72ec\u7acb\u7ec4\u4ef6\u7c7b\u4f3c\uff0c\u4f46\u5bc4\u6258\u4e8e\u9879\u76ee\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u9879\u76ee\u4e2d\u7684\u6280\u672f\u6808\uff0c\u6bd4\u5982 Vuex\u3001axios\u3001echarts \u7b49\uff0c\u6240\u4ee5\u5b83\u7684\u5f00\u53d1\u96be\u5ea6\u76f8\u5bf9\u72ec\u7acb\u7ec4\u4ef6\u8981\u5bb9\u6613\u70b9\uff0c\u4f46\u4e5f\u6709\u5fc5\u8981\u8003\u8651\u7ec4\u4ef6\u7684\u53ef\u7ef4\u62a4\u6027\u548c\u590d\u7528\u6027\u3002\n    \n\n## \u5c0f\u518c\u7684\u5185\u5bb9\n\n\u56e0\u4e3a\u672c\u5c0f\u518c\u662f\u56f4\u7ed5 Vue.js \u7ec4\u4ef6\u5c55\u5f00\u7684\uff0c\u6240\u4ee5\u7b2c\u4e8c\u8282\u4f1a\u8bb2\u89e3 Vue.js \u7ec4\u4ef6\u7684\u4e09\u4e2a API\uff1a`prop`\u3001`event`\u3001`slot`\uff0c\u5f53\u7136\uff0c\u5982\u679c\u4f60\u5df2\u7ecf\u5f00\u53d1\u8fc7\u4e00\u4e9b\u72ec\u7acb\u7ec4\u4ef6\uff0c\u5b8c\u5168\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u8282\u5185\u5bb9\u3002\n\n3 - 7 \u5c0f\u8282\u4f1a\u4ecb\u7ecd\u7ec4\u4ef6\u95f4\u901a\u4fe1\u7684\u4e00\u4e9b\u65b9\u6cd5\u548c\u9ed1\u79d1\u6280\uff0c\u4e00\u90e8\u5206\u662f Vue.js \u5185\u7f6e\u7684\uff0c\u4e00\u90e8\u5206\u662f\u81ea\u884c\u5b9e\u73b0\u7684\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4f1a\u975e\u5e38\u5b9e\u7528\u3002\u540c\u65f6\u4e5f\u5229\u7528\u8fd9\u4e9b\u65b9\u6cd5\u5b8c\u6210\u4e86\u4e24\u4e2a\u5177\u4f53\u7684\u5b9e\u6218\u6848\u4f8b\uff1a\n\n1.  \u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8868\u5355\u7ec4\u4ef6 \u2014\u2014 Form\uff1b\n2.  \u7ec4\u5408\u591a\u9009\u6846\u7ec4\u4ef6 \u2014\u2014 CheckboxGroup & Checkbox\u3002\n\n\u672c\u5c0f\u518c\u90fd\u4f1a\u4ee5\u8fd9\u79cd\u6838\u5fc3\u79d1\u6280 + \u5bf9\u5e94\u5b9e\u6218\u7684\u5f62\u5f0f\u5c55\u5f00\u3002\n\n8 - 10 \u5c0f\u8282\u4ecb\u7ecd Vue \u7684\u6784\u9020\u5668 extend \u548c\u624b\u52a8\u6302\u8f7d\u7ec4\u4ef6 $mount \u7684\u7528\u6cd5\u53ca\u6848\u4f8b\u3002Vue.js \u9664\u4e86\u6211\u4eec\u6b63\u5e38 `new Vue()` \u5916\uff0c\u8fd8\u53ef\u4ee5\u624b\u52a8\u6302\u8f7d\u7684\uff0c\u8fd9 3 \u8282\u5c06\u4ecb\u7ecd\u624b\u52a8\u6302\u8f7d\u4e00\u4e2a Vue \u7ec4\u4ef6\u7684\u4f7f\u7528\u573a\u666f\u3002\u5176\u4e2d\u6d89\u53ca\u5230\u4e24\u4e2a\u6848\u4f8b\uff1a\n\n1.  \u52a8\u6001\u6e32\u67d3 .vue \u6587\u4ef6\u7684\u7ec4\u4ef6 \u2014\u2014 Display\uff1b\n2.  \u5168\u5c40\u901a\u77e5\u7ec4\u4ef6 \u2014\u2014 $Alert\u3002\n\n**Display** \u7ec4\u4ef6\u7528\u4e8e\u5c06 `.vue` \u6587\u4ef6\u6e32\u67d3\u51fa\u6765\uff0c\u7ebf\u4e0a\u7684\u6848\u4f8b\u662f [iView Run](https://run.iviewui.com/)\uff0c\u5b83\u4e0d\u9700\u8981\u4f60\u91cd\u65b0\u7f16\u8bd1\u9879\u76ee\uff0c\u5c31\u53ef\u4ee5\u6e32\u67d3\u4e00\u4e2a\u6807\u51c6\u7684 Vue.js \u7ec4\u4ef6\u3002\n\n**$Alert** \u662f\u5168\u5c40\u7684\u901a\u77e5\u7ec4\u4ef6\uff0c\u5b83\u7684\u8c03\u7528\u65b9\u6cd5\u4e0d\u540c\u4e8e\u5e38\u89c4\u7ec4\u4ef6\u3002\u5e38\u89c4\u7ec4\u4ef6\u4f7f\u7528\u65b9\u6cd5\u5f62\u5982\uff1a\n\n```\n<template>\n    <Alert content=\"\u901a\u77e5\u5185\u5bb9\" :duration=\"3\"></Alert>\n</template>\n<script>\n    import Alert from '../components/alert.vue';\n    \n    export default {\n        components: { Alert }\n    }\n</script>\n\n```\n\n\u800c `$Alert` \u7684\u8c03\u7528\u66f4\u63a5\u8fd1 JS \u8bed\u6cd5\uff1a\n\n```\nexport default {\n    methods: {\n        showMessage () {\n            this.$Alert({\n                content: '\u901a\u77e5\u5185\u5bb9',\n                duration: 3\n            });\n        }\n    }\n}\n\n```\n\n\u867d\u7136\u4e0e\u5e38\u89c4 Vue \u7ec4\u4ef6\u8c03\u7528\u65b9\u5f0f\u4e0d\u540c\uff0c\u4f46\u5e95\u5c42\u4ecd\u7136\u7531 Vue \u7ec4\u4ef6\u6784\u6210\u548c\u7ef4\u62a4\u3002\n\n11 - 12 \u5c0f\u8282\u4ecb\u7ecd Render \u51fd\u6570\u4e0e Functional Render\uff0c\u5e76\u5b8c\u6210\u4e00\u4e2a\u80fd\u591f\u6e32\u67d3\u81ea\u5b9a\u4e49\u5217\u7684 Table \u7ec4\u4ef6\u3002Render \u51fd\u6570\u4e5f\u662f Vue.js \u7ec4\u4ef6\u91cd\u8981\u7684\u4e00\u90e8\u5206\uff0c\u53ea\u4e0d\u8fc7\u5728\u5927\u591a\u6570\u4e1a\u52a1\u4e2d\u4e0d\u5e38\u4f7f\u7528\u3002\u672c\u5c0f\u8282\u4f1a\u4ecb\u7ecd\u5b83\u7684\u4f7f\u7528\u573a\u666f\u3002\n\n13 \u5c0f\u8282\u4ecb\u7ecd**\u4f5c\u7528\u57df slot\uff08slot-scope\uff09**\uff0c\u5e76\u57fa\u4e8e\u8fd9\u79cd\u65b9\u6cd5\u540c\u6837\u5b9e\u73b0 Table \u7ec4\u4ef6\u3002slot \u7528\u7684\u5f88\u591a\uff0c\u4f46 slot-scope \u5728\u4e1a\u52a1\u4e2d\u5e76\u4e0d\u5e38\u7528\uff0c\u4f46\u5728\u4e00\u4e9b\u7279\u5b9a\u573a\u666f\u4e0b\uff0c\u6bd4\u5982\u7ec4\u4ef6\u5185\u90e8\u6709\u5faa\u73af\u4f53\u65f6\uff0c\u4f1a\u975e\u5e38\u5b9e\u7528\u3002\n\n14 - 15 \u5c0f\u8282\u4ecb\u7ecd\u9012\u5f52\u7ec4\u4ef6\uff0c\u5e76\u5b8c\u6210\u6811\u5f62\u63a7\u4ef6 \u2014\u2014 Tree\u3002\n\n16 - 19 \u5c0f\u8282\u662f\u7efc\u5408\u62d3\u5c55\uff0c\u4f1a\u7740\u91cd\u8bb2\u89e3 Vue.js \u5bb9\u6613\u5ffd\u7565\u5374\u5f88\u91cd\u8981\u7684 API\uff0c\u4ee5\u53ca\u5bf9 Vue.js \u9762\u8bd5\u9898\u7684\u8be6\u7ec6\u5206\u6790\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u4f1a\u603b\u7ed3\u7b14\u8005\u5728\u4e24\u5e74\u7684 iView \u5f00\u6e90\u7ecf\u5386\u4e2d\u7684\u7ecf\u9a8c\uff0c\u9664\u4e86\u6280\u672f\u7ec6\u8282\u5916\uff0c\u8fd8\u5305\u62ec\u5f00\u6e90\u9879\u76ee\u7684\u6301\u7eed\u6027\u53d1\u5c55\u3001\u63a8\u5e7f\u7b49\u3002\n\n## \u7ed3\u8bed\n\n\u4e09\u5e74\u524d\uff0c\u6211\u5f00\u59cb\u63a5\u89e6 Vue.js \u6846\u67b6\uff0c\u5f53\u65f6\u5c31\u88ab\u5b83\u7684\u8f7b\u91cf\u3001\u7ec4\u4ef6\u5316\u548c\u53cb\u597d\u7684 API \u6240\u5438\u5f15\u3002\u4e0e\u6b64\u540c\u65f6\uff0c\u6211\u4e5f\u5f00\u6e90\u4e86 iView \u9879\u76ee\u3002\u4e09\u5e74\u7684\u78e8(c\u01cei )\u783a(k\u0113ng)\uff0c\u6c89\u6dc0\u4e86\u4e0d\u5c11\u5173\u4e8e Vue.js \u7ec4\u4ef6\u7684\u7ecf\u9a8c\u3002\n\n\u672c\u5c0f\u518c\u7684\u5185\u5bb9\u4e5f\u8bb8\u4e0d\u4f1a\u8ba9\u4f60\u7684\u6280\u672f\u4e00\u591c\u95f4\u7a81\u98de\u731b\u8fdb\uff0c\u4f46\u7edd\u5bf9\u4f7f\u4f60\u918d\u9190\u704c\u9876\u3002\n\n\u90a3\u4e48\uff0c\u8bf7\u51c6\u5907\u597d\u4e00\u53f0\u7535\u8111\u548c\u4e00\u676f\u5496\u5561\uff0c\u4e00\u8d77\u6765\u63a2\u7d22 Vue.js \u7684\u7cbe\u9ad3\u5427\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5f00\u7bc7Vue.js_\u7684\u7cbe\u9ad3\u7ec4\u4ef6.md", "create_date": "2020-02-18T21:37:08.781", "order": 1}}, {"model": "subject.chapter", "pk": 101, "fields": {"title": "\u66f4\u7075\u6d3b\u7684\u7ec4\u4ef6\uff1aRender \u51fd\u6570\u4e0e Functional Render", "topic": 5, "md5": "d74ede3f4ffcbecec590b30a262ba6e9", "md_body": "# \u66f4\u7075\u6d3b\u7684\u7ec4\u4ef6\uff1aRender \u51fd\u6570\u4e0e Functional Render\n\nVue.js 2.x \u4e0e Vue.js 1.x \u6700\u5927\u7684\u533a\u522b\u5c31\u5728\u4e8e 2.x \u4f7f\u7528\u4e86 Virtual DOM\uff08\u865a\u62df DOM\uff09\u6765\u66f4\u65b0 DOM \u8282\u70b9\uff0c\u63d0\u5347\u6e32\u67d3\u6027\u80fd\u3002\n\n\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u5199 Vue.js \u7ec4\u4ef6\uff0c\u6a21\u677f\u90fd\u662f\u5199\u5728 `<template>` \u5185\u7684\uff0c\u4f46\u5b83\u5e76\u4e0d\u662f\u6700\u7ec8\u5448\u73b0\u7684\u5185\u5bb9\uff0ctemplate \u53ea\u662f\u4e00\u79cd\u5bf9\u5f00\u53d1\u8005\u53cb\u597d\u7684\u8bed\u6cd5\uff0c\u80fd\u591f\u4e00\u773c\u770b\u5230 DOM \u8282\u70b9\uff0c\u5bb9\u6613\u7ef4\u62a4\uff0c\u5728 Vue.js \u7f16\u8bd1\u9636\u6bb5\uff0c\u4f1a\u89e3\u6790\u4e3a Virtual DOM\u3002\n\n\u4e0e DOM \u64cd\u4f5c\u76f8\u6bd4\uff0cVirtual DOM \u662f\u57fa\u4e8e JavaScript \u8ba1\u7b97\u7684\uff0c\u6240\u4ee5\u5f00\u9500\u4f1a\u5c0f\u5f88\u591a\u3002\u4e0b\u56fe\u6f14\u793a\u4e86 Virtual DOM \u8fd0\u884c\u7684\u8fc7\u7a0b\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/13/1670bc4c26b9c667?w=1964&h=636&f=png&s=105521)\n\n\u6b63\u5e38\u7684 DOM \u8282\u70b9\u5728 HTML \u4e2d\u662f\u8fd9\u6837\u7684\uff1a\n\n```\n<div id=\"main\">\n  <p>\u6587\u672c\u5185\u5bb9</p>\n  <p>\u6587\u672c\u5185\u5bb9</p>\n</div>\n\n```\n\n\u7528 Virtual DOM \u521b\u5efa\u7684 JavaScript \u5bf9\u8c61\u4e00\u822c\u4f1a\u662f\u8fd9\u6837\u7684\uff1a\n\n```\nconst vNode = {\n  tag: 'div',\n  attributes: {\n    id: 'main'\n  },\n  children: [\n    // p \u8282\u70b9\n  ]\n}\n\n```\n\nvNode \u5bf9\u8c61\u901a\u8fc7\u4e00\u4e9b\u7279\u5b9a\u7684\u9009\u9879\u63cf\u8ff0\u4e86\u771f\u5b9e\u7684 DOM \u7ed3\u6784\u3002\n\n\u5728 Vue.js \u4e2d\uff0c\u5bf9\u4e8e\u5927\u90e8\u5206\u573a\u666f\uff0c\u4f7f\u7528 template \u8db3\u4ee5\u5e94\u4ed8\uff0c\u4f46\u5982\u679c\u60f3\u5b8c\u5168\u53d1\u6325 JavaScript \u7684\u7f16\u7a0b\u80fd\u529b\uff0c\u6216\u5728\u4e00\u4e9b\u7279\u5b9a\u573a\u666f\u4e0b\uff08\u540e\u6587\u4ecb\u7ecd\uff09\uff0c\u9700\u8981\u4f7f\u7528 Vue.js \u7684 Render \u51fd\u6570\u3002\n\n## Render \u51fd\u6570\n\n\u6b63\u5982\u4e0a\u6587\u4ecb\u7ecd\u7684 Virtual DOM \u793a\u4f8b\u4e00\u6837\uff0cVue.js \u7684 Render \u51fd\u6570\u4e5f\u662f\u7c7b\u4f3c\u7684\u8bed\u6cd5\uff0c\u9700\u8981\u4f7f\u7528\u4e00\u4e9b\u7279\u5b9a\u7684\u9009\u9879\uff0c\u5c06 template \u7684\u5185\u5bb9\u6539\u5199\u6210\u4e00\u4e2a JavaScript \u5bf9\u8c61\u3002\n\n\u5bf9\u4e8e\u521d\u7ea7\u524d\u7aef\u5de5\u7a0b\u5e08\uff0c\u6216\u60f3\u5feb\u901f\u5efa\u7ad9\u7684\u9700\u6c42\uff0c\u76f4\u63a5\u4f7f\u7528 Render \u51fd\u6570\u5f00\u53d1 Vue.js \u7ec4\u4ef6\u662f\u8981\u6bd4 template \u56f0\u96be\u7684\uff0c\u539f\u56e0\u5728\u4e8e Render \u51fd\u6570\u8fd4\u56de\u7684\u662f\u4e00\u4e2a JS \u5bf9\u8c61\uff0c\u6ca1\u6709\u4f20\u7edf DOM \u7684\u5c42\u7ea7\u5173\u7cfb\uff0c\u914d\u5408\u4e0a if\u3001else\u3001for \u7b49\u8bed\u53e5\uff0c\u5c06\u8282\u70b9\u62c6\u5206\u6210\u4e0d\u540c JS \u5bf9\u8c61\u518d\u7ec4\u88c5\uff0c\u5982\u679c\u6a21\u677f\u590d\u6742\uff0c\u90a3\u4e00\u4e2a Render \u51fd\u6570\u662f\u96be\u8bfb\u4e14\u96be\u7ef4\u62a4\u7684\u3002\u6240\u4ee5\uff0c\u7edd\u5927\u90e8\u5206\u7ec4\u4ef6\u5f00\u53d1\u548c\u4e1a\u52a1\u5f00\u53d1\uff0c\u6211\u4eec\u76f4\u63a5\u4f7f\u7528 template \u8bed\u6cd5\u5c31\u53ef\u4ee5\u4e86\uff0c\u5e76\u4e0d\u9700\u8981\u7279\u610f\u4f7f\u7528 Render \u51fd\u6570\uff0c\u90a3\u6837\u53ea\u4f1a\u589e\u52a0\u8d1f\u62c5\uff0c\u540c\u65f6\u4e5f\u653e\u5f03\u4e86 Vue.js \u6700\u5927\u7684\u4f18\u52bf\uff08React \u65e0 template \u8bed\u6cd5\uff09\u3002\n\n\u5f88\u591a\u5b66\u4e60 Vue.js \u7684\u5f00\u53d1\u8005\u5728\u9047\u5230 Render \u51fd\u6570\u65f6\u90fd\u6709\u70b9\u201d\u8eb2\u907f\u201c\uff0c\u6216\u76f4\u63a5\u653e\u5f03\u8fd9\u90e8\u5206\uff0c\u8fd9\u5e76\u6ca1\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u4e0d\u7528 Render \u51fd\u6570\uff0c\u7167\u6837\u53ef\u4ee5\u5199\u51fa\u4f18\u79c0\u7684 Vue.js \u7a0b\u5e8f\u3002\u4e0d\u8fc7\uff0cRender \u51fd\u6570\u5e76\u6ca1\u6709\u60f3\u8c61\u4e2d\u7684\u90a3\u4e48\u590d\u6742\uff0c\u53ea\u662f\u914d\u7f6e\u9879\u7279\u522b\u591a\uff0c\u4e00\u65f6\u96be\u4ee5\u8bb0\u4f4f\uff0c\u4f46\u5f52\u6839\u5230\u5e95\uff0cRender \u51fd\u6570\u53ea\u6709 3 \u4e2a\u53c2\u6570\u3002\n\n\u6765\u770b\u4e00\u7ec4 template \u548c Render \u5199\u6cd5\u7684\u5bf9\u7167\uff1a\n\n```\n<template>\n  <div id=\"main\" class=\"container\" style=\"color: red\">\n    <p v-if=\"show\">\u5185\u5bb9 1</p>\n    <p v-else>\u5185\u5bb9 2</p>\n  </div>\n</template>\n<script>\n  export default {\n    data () {\n      return {\n        show: false\n      }\n    }\n  }\n</script>\n\n```\n\n```\nexport default {\n  data () {\n    return {\n      show: false\n    }\n  },\n  render: (h) => {\n    let childNode;\n    if (this.show) {\n      childNode = h('p', '\u5185\u5bb9 1');\n    } else {\n      childNode = h('p', '\u5185\u5bb9 2');\n    }\n    \n    return h('div', {\n      attrs: {\n        id: 'main'\n      },\n      class: {\n        container: true\n      },\n      style: {\n        color: 'red'\n      }\n    }, [childNode]);\n  }\n}\n\n```\n\n\u8fd9\u91cc\u7684 `h`\uff0c\u5373 `createElement`\uff0c\u662f Render \u51fd\u6570\u7684\u6838\u5fc3\u3002\u53ef\u4ee5\u770b\u5230\uff0ctemplate \u4e2d\u7684 **v-if / v-else** \u7b49\u6307\u4ee4\uff0c\u90fd\u88ab JS \u7684 **if / else** \u66ff\u4ee3\u4e86\uff0c\u90a3 **v-for** \u81ea\u7136\u4e5f\u4f1a\u88ab **for** \u8bed\u53e5\u66ff\u4ee3\u3002\n\nh \u6709 3 \u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f\uff1a\n\n1.  \u8981\u6e32\u67d3\u7684\u5143\u7d20\u6216\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a html \u6807\u7b7e\u3001\u7ec4\u4ef6\u9009\u9879\u6216\u4e00\u4e2a\u51fd\u6570\uff08\u4e0d\u5e38\u7528\uff09\uff0c\u8be5\u53c2\u6570\u4e3a\u5fc5\u586b\u9879\u3002\u793a\u4f8b\uff1a\n    \n    ```\n    // 1. html \u6807\u7b7e\n    h('div');\n    // 2. \u7ec4\u4ef6\u9009\u9879\n    import DatePicker from '../component/date-picker.vue';\n    h(DatePicker);\n    \n    ```\n    \n2.  \u5bf9\u5e94\u5c5e\u6027\u7684\u6570\u636e\u5bf9\u8c61\uff0c\u6bd4\u5982\u7ec4\u4ef6\u7684 props\u3001\u5143\u7d20\u7684 class\u3001\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u3001slot\u3001\u81ea\u5b9a\u4e49\u6307\u4ee4\u7b49\uff0c\u8be5\u53c2\u6570\u662f\u53ef\u9009\u7684\uff0c\u4e0a\u6587\u6240\u8bf4\u7684 Render \u914d\u7f6e\u9879\u591a\uff0c\u6307\u7684\u5c31\u662f\u8fd9\u4e2a\u53c2\u6570\u3002\u8be5\u53c2\u6570\u7684\u5b8c\u6574\u914d\u7f6e\u548c\u793a\u4f8b\uff0c\u53ef\u4ee5\u5230 Vue.js \u7684\u6587\u6863\u67e5\u770b\uff0c\u6ca1\u5fc5\u8981\u5168\u90e8\u8bb0\u4f4f\uff0c\u7528\u5230\u65f6\u67e5\u9605\u5c31\u597d\uff1a[createElement \u53c2\u6570](https://cn.vuejs.org/v2/guide/render-function.html#createElement-%E5%8F%82%E6%95%B0)\u3002\n    \n3.  \u5b50\u8282\u70b9\uff0c\u53ef\u9009\uff0cString \u6216 Array\uff0c\u5b83\u540c\u6837\u662f\u4e00\u4e2a h\u3002\u793a\u4f8b\uff1a\n    \n    ```\n    [\n      '\u5185\u5bb9',\n      h('p', '\u5185\u5bb9'),\n      h(Component, {\n        props: {\n          someProp: 'foo'\n        }\n      })\n    ]\n    \n    ```\n    \n\n### \u7ea6\u675f\n\n\u6240\u6709\u7684\u7ec4\u4ef6\u6811\u4e2d\uff0c\u5982\u679c vNode \u662f\u7ec4\u4ef6\u6216\u542b\u6709\u7ec4\u4ef6\u7684 slot\uff0c\u90a3\u4e48 vNode \u5fc5\u987b\u552f\u4e00\u3002\u4ee5\u4e0b\u4e24\u4e2a\u793a\u4f8b\u90fd\u662f**\u9519\u8bef**\u7684\uff1a\n\n```\n// \u5c40\u90e8\u58f0\u660e\u7ec4\u4ef6\nconst Child = {\n  render: (h) => {\n    return h('p', 'text');\n  }\n}\n\nexport default {\n  render: (h) => {\n    // \u521b\u5efa\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u4f7f\u7528\u7ec4\u4ef6 Child\n    const ChildNode = h(Child);\n    \n    return h('div', [\n      ChildNode,\n      ChildNode\n    ]);\n  }\n}\n\n```\n\n```\n{\n  render: (h) => {\n    return h('div', [\n      this.$slots.default,\n      this.$slots.default\n    ])\n  }\n}\n\n```\n\n\u91cd\u590d\u6e32\u67d3\u591a\u4e2a\u7ec4\u4ef6\u6216\u5143\u7d20\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u5faa\u73af\u548c\u5de5\u5382\u51fd\u6570\u6765\u89e3\u51b3\uff1a\n\n```\nconst Child = {\n  render: (h) => {\n    return h('p', 'text');\n  }\n}\n\nexport default {\n  render: (h) => {\n    const children = Array.apply(null, {\n      length: 5\n    }).map(() => {\n      return h(Child);\n    });\n    return h('div', children);\n  }\n}\n\n```\n\n\u5bf9\u4e8e\u542b\u6709\u7ec4\u4ef6\u7684 slot\uff0c\u590d\u7528\u6bd4\u8f83\u590d\u6742\uff0c\u9700\u8981\u5c06 slot \u7684\u6bcf\u4e2a\u5b50\u8282\u70b9\u90fd\u514b\u9686\u4e00\u4efd\uff0c\u4f8b\u5982\uff1a\n\n```\n{\n  render: (h) => {\n    function cloneVNode (vnode) {\n      // \u9012\u5f52\u904d\u5386\u6240\u6709\u5b50\u8282\u70b9\uff0c\u5e76\u514b\u9686\n      const clonedChildren = vnode.children && vnode.children.map(vnode => cloneVNode(vnode));\n      const cloned = h(vnode.tag, vnode.data, clonedChildren);\n      cloned.text = vnode.text;\n      cloned.isComment = vnode.isComment;\n      cloned.componentOptions = vnode.componentOptions;\n      cloned.elm = vnode.elm;\n      cloned.context = vnode.context;\n      cloned.ns = vnode.ns;\n      cloned.isStatic = vnode.isStatic;\n      cloned.key = vnode.key;\n\n      return cloned;\n    }\n\n    const vNodes = this.$slots.default === undefined ? [] : this.$slots.default;\n    const clonedVNodes = this.$slots.default === undefined ? [] : vNodes.map(vnode => cloneVNode(vnode));\n    \n    return h('div', [\n      vNodes,\n      clonedVNodes\n    ])\n  }\n}\n\n```\n\n\u5728 Render \u51fd\u6570\u91cc\u521b\u5efa\u4e86\u4e00\u4e2a cloneVNode \u7684\u5de5\u5382\u51fd\u6570\uff0c\u901a\u8fc7\u9012\u5f52\u5c06 slot \u6240\u6709\u5b50\u8282\u70b9\u90fd\u514b\u9686\u4e86\u4e00\u4efd\uff0c\u5e76\u5bf9 VNode \u7684\u5173\u952e\u5c5e\u6027\u4e5f\u8fdb\u884c\u4e86\u590d\u5236\u3002\n\n\u6df1\u5ea6\u514b\u9686 slot \u5e76\u975e Vue.js \u5185\u7f6e\u65b9\u6cd5\uff0c\u4e5f\u6ca1\u6709\u5f97\u5230\u63a8\u8350\uff0c\u5c5e\u4e8e\u9ed1\u79d1\u6280\uff0c\u5728\u4e00\u4e9b\u7279\u6b8a\u7684\u573a\u666f\u624d\u4f1a\u4f7f\u7528\u5230\uff0c\u6b63\u5e38\u4e1a\u52a1\u51e0\u4e4e\u662f\u7528\u4e0d\u5230\u7684\u3002\u6bd4\u5982 iView \u7ec4\u4ef6\u5e93\u7684\u7a7f\u68ad\u6846\u7ec4\u4ef6 Transfer\uff0c\u5c31\u7528\u5230\u4e86\u8fd9\u79cd\u65b9\u6cd5\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/13/1670bc4f017b9bf6?w=1246&h=654&f=png&s=108936)\n\n\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u662f\uff1a\n\n```\n<Transfer\n    :data=\"data\"\n    :target-keys=\"targetKeys\"\n    :render-format=\"renderFormat\">\n  <div :style=\"{float: 'right', margin: '5px'}\">\n    <Button size=\"small\" @click=\"reloadMockData\">Refresh</Button>\n  </div>\n</Transfer>\n\n```\n\n\u793a\u4f8b\u4e2d\u7684\u9ed8\u8ba4 slot \u662f\u4e00\u4e2a Refresh \u6309\u94ae\uff0c\u4f7f\u7528\u8005\u53ea\u5199\u4e86\u4e00\u904d\uff0c\u4f46\u5728 Transfer \u7ec4\u4ef6\u4e2d\uff0c\u662f\u901a\u8fc7\u514b\u9686 VNode \u7684\u65b9\u6cd5\uff0c\u663e\u793a\u4e86\u4e24\u904d\u3002\u5982\u679c\u4e0d\u8fd9\u6837\u505a\uff0c\u5c31\u8981\u58f0\u660e\u4e24\u4e2a\u5177\u540d slot\uff0c\u4f46\u662f\u5de6\u53f3\u4e24\u4e2a\u7684\u903b\u8f91\u53ef\u80fd\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u4f7f\u7528\u8005\u5c31\u8981\u5199\u4e24\u4e2a\u4e00\u6a21\u4e00\u6837\u7684 slot\uff0c\u8fd9\u662f\u4e0d\u53cb\u597d\u7684\u3002\n\n> Render \u51fd\u6570\u7684\u57fa\u672c\u7528\u6cd5\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982 v-model \u7684\u7528\u6cd5\u3001\u4e8b\u4ef6\u548c\u4fee\u9970\u7b26\u3001slot \u7b49\uff0c\u8bfb\u8005\u53ef\u4ee5\u5230 Vue.js \u6587\u6863\u9605\u8bfb\u3002[Vue.js \u6e32\u67d3\u51fd\u6570](https://cn.vuejs.org/v2/guide/render-function.html)\n\n## Render \u51fd\u6570\u4f7f\u7528\u573a\u666f\n\n\u4e0a\u6587\u8bf4\u5230\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u4e0d\u63a8\u8350\u76f4\u63a5\u4f7f\u7528 Render \u51fd\u6570\u7684\uff0c\u4f7f\u7528 template \u8db3\u4ee5\uff0c\u5728 Vue.js \u4e2d\uff0c\u4f7f\u7528 Render \u51fd\u6570\u7684\u573a\u666f\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b 4 \u70b9\uff1a\n\n1.  \u4f7f\u7528\u4e24\u4e2a\u76f8\u540c slot\u3002\u5728 template \u4e2d\uff0cVue.js \u4e0d\u5141\u8bb8\u4f7f\u7528\u4e24\u4e2a\u76f8\u540c\u7684 slot\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u793a\u4f8b\u662f\u9519\u8bef\u7684\uff1a\n    \n    ```\n    <template>\n      <div>\n        <slot></slot>\n        <slot></slot>\n      </div>\n    </template>\n    \n    ```\n    \n    \u89e3\u51b3\u65b9\u6848\u5c31\u662f\u4e0a\u6587\u4e2d\u8bb2\u5230\u7684**\u7ea6\u675f**\uff0c\u4f7f\u7528\u4e00\u4e2a\u6df1\u5ea6\u514b\u9686 VNode \u8282\u70b9\u7684\u65b9\u6cd5\u3002\n    \n2.  \u5728 SSR \u73af\u5883\uff08\u670d\u52a1\u7aef\u6e32\u67d3\uff09\uff0c\u5982\u679c\u4e0d\u662f\u5e38\u89c4\u7684 template \u5199\u6cd5\uff0c\u6bd4\u5982\u901a\u8fc7 Vue.extend \u548c new Vue \u6784\u9020\u6765\u751f\u6210\u7684\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u662f\u7f16\u8bd1\u4e0d\u8fc7\u7684\uff0c\u5728\u524d\u9762\u5c0f\u8282\u4e5f\u6709\u6240\u4ecb\u7ecd\u3002\u56de\u987e\u4e0a\u4e00\u8282\u7684 `$Alert` \u7ec4\u4ef6\u7684 notification.js \u6587\u4ef6\uff0c\u5f53\u65f6\u662f\u4f7f\u7528 Render \u51fd\u6570\u6765\u6e32\u67d3 Alert \u7ec4\u4ef6\uff0c\u5982\u679c\u6539\u6210\u53e6\u4e00\u79cd\u5199\u6cd5\uff0c\u5728 SSR \u4e2d\u4f1a\u62a5\u9519\uff0c\u5bf9\u6bd4\u4e24\u79cd\u5199\u6cd5\uff1a\n    \n    ```\n    // \u6b63\u786e\u5199\u6cd5\n    import Alert from './alert.vue';\n    import Vue from 'vue';\n    \n    Alert.newInstance = properties => {\n      const props = properties || {};\n    \n      const Instance = new Vue({\n        data: props,\n        render (h) {\n          return h(Alert, {\n            props: props\n          });\n        }\n      });\n    \n      const component = Instance.$mount();\n      document.body.appendChild(component.$el);\n    \n      const alert = Instance.$children[0];\n    \n      return {\n        add (noticeProps) {\n          alert.add(noticeProps);\n        },\n        remove (name) {\n          alert.remove(name);\n        }\n      }\n    };\n    \n    export default Alert;\n    \n    ```\n    \n    ```\n    // \u5728 SSR \u4e0b\u62a5\u9519\u7684\u5199\u6cd5\n    import Alert from './alert.vue';\n    import Vue from 'vue';\n    \n    Alert.newInstance = properties => {\n      const props = properties || {};\n    \n      const div = document.createElement('div');\n      div.innerHTML = `<Alert ${props}></Alert>`;\n      document.body.appendChild(div);\n      \n      const Instance = new Vue({\n        el: div,\n        data: props,\n        components: { Alert }\n      });\n    \n      const alert = Instance.$children[0];\n    \n      return {\n        add (noticeProps) {\n          alert.add(noticeProps);\n        },\n        remove (name) {\n          alert.remove(name);\n        }\n      }\n    };\n    \n    export default Alert;\n    \n    ```\n    \n3.  \u5728 runtime \u7248\u672c\u7684 Vue.js \u4e2d\uff0c\u5982\u679c\u4f7f\u7528 Vue.extend \u624b\u52a8\u6784\u9020\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u4f7f\u7528 template \u9009\u9879\u662f\u4f1a\u62a5\u9519\u7684\uff0c\u5728\u7b2c 9 \u8282\u4e2d\u4e5f\u6709\u6240\u4ecb\u7ecd\u3002\u89e3\u51b3\u65b9\u6848\u4e5f\u5f88\u7b80\u5355\uff0c\u628a template \u6539\u5199\u4e3a Render \u5c31\u53ef\u4ee5\u4e86\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u5f00\u53d1\u72ec\u7acb\u7ec4\u4ef6\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e Vue.js \u7248\u672c\u6765\u4f7f template \u9009\u9879\u53ef\u7528\uff0c\u4f46\u8fd9\u662f\u5728\u81ea\u5df1\u7684\u73af\u5883\uff0c\u65e0\u6cd5\u4fdd\u8bc1\u4f7f\u7528\u8005\u7684 Vue.js \u7248\u672c\uff0c\u6240\u4ee5\u5bf9\u4e8e\u63d0\u4f9b\u7ed9\u4ed6\u4eba\u7528\u7684\u7ec4\u4ef6\uff0c\u662f\u9700\u8981\u8003\u8651\u517c\u5bb9 runtime \u7248\u672c\u548c SSR \u73af\u5883\u7684\u3002\n    \n4.  \u8fd9\u53ef\u80fd\u662f\u4f7f\u7528 Render \u51fd\u6570\u6700\u91cd\u8981\u7684\u4e00\u70b9\u3002\u4e00\u4e2a Vue.js \u7ec4\u4ef6\uff0c\u6709\u4e00\u90e8\u5206\u5185\u5bb9\u9700\u8981\u4ece\u7236\u7ea7\u4f20\u9012\u6765\u663e\u793a\uff0c\u5982\u679c\u662f\u6587\u672c\u4e4b\u7c7b\u7684\uff0c\u76f4\u63a5\u901a\u8fc7 `props` \u5c31\u53ef\u4ee5\uff0c\u5982\u679c\u8fd9\u4e2a\u5185\u5bb9\u5e26\u6709\u6837\u5f0f\u6216\u590d\u6742\u4e00\u70b9\u7684 html \u7ed3\u6784\uff0c\u53ef\u4ee5\u4f7f\u7528 `v-html` \u6307\u4ee4\u6765\u6e32\u67d3\uff0c\u7236\u7ea7\u4f20\u9012\u7684\u4ecd\u7136\u662f\u4e00\u4e2a HTML Element \u5b57\u7b26\u4e32\uff0c\u4e0d\u8fc7\u5b83\u4ec5\u4ec5\u662f\u80fd\u89e3\u6790\u6b63\u5e38\u7684 html \u8282\u70b9\u4e14\u6709 XSS \u98ce\u9669\u3002\u5f53\u9700\u8981\u6700\u5927\u5316\u7a0b\u5ea6\u81ea\u5b9a\u4e49\u663e\u793a\u5185\u5bb9\u65f6\uff0c\u5c31\u9700\u8981 `Render` \u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u6e32\u67d3\u4e00\u4e2a\u5b8c\u6574\u7684 Vue.js \u7ec4\u4ef6\u3002\u4f60\u53ef\u80fd\u4f1a\u8bf4\uff0c\u7528 slot \u4e0d\u5c31\u597d\u4e86\uff1f\u7684\u786e\uff0cslot \u7684\u4f5c\u7528\u5c31\u662f\u505a\u5185\u5bb9\u5206\u53d1\u7684\uff0c\u4f46\u5728\u4e00\u4e9b\u7279\u6b8a\u7ec4\u4ef6\u4e2d\uff0c\u53ef\u80fd slot \u4e5f\u4e0d\u884c\u3002\u6bd4\u5982\u4e00\u4e2a\u8868\u683c\u7ec4\u4ef6 `Table`\uff0c\u5b83\u53ea\u63a5\u6536\u4e24\u4e2a props\uff1a\u5217\u914d\u7f6e columns \u548c\u884c\u6570\u636e data\uff0c\u4e0d\u8fc7\u67d0\u4e00\u5217\u7684\u5355\u5143\u683c\uff0c\u4e0d\u662f\u53ea\u5c06\u6570\u636e\u663e\u793a\u51fa\u6765\u90a3\u4e48\u7b80\u5355\uff0c\u53ef\u80fd\u5e26\u6709\u4e00\u4e9b\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u8fd9\u79cd\u573a\u666f\u53ea\u7528 slot \u662f\u4e0d\u884c\u7684\uff0c\u6ca1\u529e\u6cd5\u786e\u5b9a\u662f\u90a3\u4e00\u5217\u7684 slot\u3002\u8fd9\u79cd\u573a\u666f\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff0c\u5176\u4e00\u5c31\u662f Render \u51fd\u6570\uff0c\u4e0b\u4e00\u8282\u7684\u5b9e\u6218\u5c31\u662f\u5f00\u53d1\u8fd9\u6837\u4e00\u4e2a Table \u7ec4\u4ef6\uff1b\u53e6\u4e00\u79cd\u662f\u7528\u4f5c\u7528\u57df slot\uff08slot-scope\uff09\uff0c\u540e\u9762\u5c0f\u8282\u4e5f\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u3002\n    \n\n## Functional Render\n\nVue.js \u63d0\u4f9b\u4e86\u4e00\u4e2a `functional` \u7684\u5e03\u5c14\u503c\u9009\u9879\uff0c\u8bbe\u7f6e\u4e3a true \u53ef\u4ee5\u4f7f\u7ec4\u4ef6\u65e0\u72b6\u6001\u548c\u65e0\u5b9e\u4f8b\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709 data \u548c this \u4e0a\u4e0b\u6587\u3002\u8fd9\u6837\u7528 Render \u51fd\u6570\u8fd4\u56de\u865a\u62df\u8282\u70b9\u53ef\u4ee5\u66f4\u5bb9\u6613\u6e32\u67d3\uff0c\u56e0\u4e3a\u51fd\u6570\u5316\u7ec4\u4ef6\uff08Functional Render\uff09\u53ea\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u6e32\u67d3\u5f00\u9500\u8981\u5c0f\u5f88\u591a\u3002\n\n\u4f7f\u7528\u51fd\u6570\u5316\u7ec4\u4ef6\uff0cRender \u51fd\u6570\u63d0\u4f9b\u4e86\u7b2c\u4e8c\u4e2a\u53c2\u6570 context \u6765\u63d0\u4f9b\u4e34\u65f6\u4e0a\u4e0b\u6587\u3002\u7ec4\u4ef6\u9700\u8981\u7684 data\u3001props\u3001slots\u3001children\u3001parent \u90fd\u662f\u901a\u8fc7\u8fd9\u4e2a\u4e0a\u4e0b\u6587\u6765\u4f20\u9012\u7684\uff0c\u6bd4\u5982 this.level \u8981\u6539\u5199\u4e3a context.props.level\uff0cthis.$slots.default \u6539\u5199\u4e3a context.children\u3002\n\n> \u60a8\u53ef\u4ee5\u9605\u8bfb [Vue.js \u6587\u6863\u2014\u51fd\u6570\u5f0f\u7ec4\u4ef6](https://cn.vuejs.org/v2/guide/render-function.html#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6) \u6765\u67e5\u770b\u793a\u4f8b\u3002\n\n\u51fd\u6570\u5316\u7ec4\u4ef6\u5728\u4e1a\u52a1\u4e2d\u5e76\u4e0d\u662f\u5f88\u5e38\u7528\uff0c\u800c\u4e14\u4e5f\u6709\u7c7b\u4f3c\u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\uff0c\u6bd4\u5982\u67d0\u4e9b\u573a\u666f\u53ef\u4ee5\u7528 is \u7279\u6027\u6765\u52a8\u6001\u6302\u8f7d\u7ec4\u4ef6\u3002\u51fd\u6570\u5316\u7ec4\u4ef6\u4e3b\u8981\u9002\u7528\u4e8e\u4ee5\u4e0b\u4e24\u4e2a\u573a\u666f\uff1a\n\n*   \u7a0b\u5e8f\u5316\u5730\u5728\u591a\u4e2a\u7ec4\u4ef6\u4e2d\u9009\u62e9\u4e00\u4e2a\uff1b\n*   \u5728\u5c06 children\u3001props\u3001data \u4f20\u9012\u7ed9\u5b50\u7ec4\u4ef6\u4e4b\u524d\u64cd\u4f5c\u5b83\u4eec\u3002\n\n\u6bd4\u5982\u4e0a\u6587\u8bf4\u8fc7\u7684\uff0c\u67d0\u4e2a\u7ec4\u4ef6\u9700\u8981\u4f7f\u7528 Render \u51fd\u6570\u6765\u81ea\u5b9a\u4e49\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u4f20\u9012\u666e\u901a\u6587\u672c\u6216 v-html \u6307\u4ee4\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u7528 Functional Render\uff0c\u6765\u770b\u4e0b\u9762\u7684\u793a\u4f8b\uff1a\n\n1.  \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u51fd\u6570\u5316\u7ec4\u4ef6 **render.js**\uff1a\n    \n    ```\n    // render.js\n    export default {\n      functional: true,\n      props: {\n        render: Function\n      },\n      render: (h, ctx) => {\n        return ctx.props.render(h);\n      }\n    };\n    \n    ```\n    \n    \u5b83\u53ea\u5b9a\u4e49\u4e86\u4e00\u4e2a props\uff1arender\uff0c\u683c\u5f0f\u4e3a Function\uff0c\u56e0\u4e3a\u662f functional\uff0c\u6240\u4ee5\u5728 render \u91cc\u4f7f\u7528\u4e86\u7b2c\u4e8c\u4e2a\u53c2\u6570 `ctx` \u6765\u83b7\u53d6 props\u3002\u8fd9\u662f\u4e00\u4e2a\u4e2d\u95f4\u6587\u4ef6\uff0c\u5e76\u4e14\u53ef\u4ee5\u590d\u7528\uff0c\u5176\u5b83\u7ec4\u4ef6\u9700\u8981\u8fd9\u4e2a\u529f\u80fd\u65f6\uff0c\u90fd\u53ef\u4ee5\u5f15\u5165\u5b83\u3002\n    \n2.  \u521b\u5efa\u7ec4\u4ef6\uff1a\n    \n    ```\n    <!-- my-component.vue -->\n    <template>\n      <div>\n        <Render :render=\"render\"></Render>\n      </div>\n    </template>\n    <script>\n      import Render form './render.js';\n      \n      export default {\n        components: { Render },\n        props: {\n          render: Function\n        }\n      }\n    </script>\n    \n    ```\n    \n3.  \u4f7f\u7528\u4e0a\u9762\u7684 my-compoennt \u7ec4\u4ef6\uff1a\n    \n    ```\n    <!-- demo.vue -->\n    <template>\n      <div>\n        <my-component :render=\"render\"></my-component>\n      </div>\n    </template>\n    <script>\n      import myComponent from '../components/my-component.vue';\n      \n      export default {\n        components: { myComponent },\n        data () {\n          return {\n            render: (h) => {\n              return h('div', {\n                style: {\n                  color: 'red'\n                }\n              }, '\u81ea\u5b9a\u4e49\u5185\u5bb9');\n            }\n          }\n        }\n      }\n    </script>\n    \n    ```\n    \n\n\u8fd9\u91cc\u7684 render.js \u56e0\u4e3a\u53ea\u662f\u628a demo.vue \u4e2d\u7684 Render \u5185\u5bb9\u8fc7\u7ee7\uff0c\u5e76\u65e0\u5176\u5b83\u7528\u5904\uff0c\u6240\u4ee5\u7528\u4e86 Functional Render\u3002\n\n\u5c31\u6b64\u4f8b\u6765\u8bf4\uff0c\u5b8c\u5168\u53ef\u4ee5\u7528 slot \u53d6\u4ee3 Functional Render\uff0c\u90a3\u662f\u56e0\u4e3a\u53ea\u6709 `render` \u8fd9\u4e00\u4e2a prop\u3002\u5982\u679c\u793a\u4f8b\u4e2d\u7684 `<Render>` \u662f\u7528 `v-for` \u751f\u6210\u7684\uff0c\u4e5f\u5c31\u662f\u591a\u4e2a\u65f6\uff0c\u7528 \u4e00\u4e2a slot \u662f\u5b9e\u73b0\u4e0d\u4e86\u7684\uff0c\u90a3\u65f6\u7528 Render \u51fd\u6570\u5c31\u5f88\u65b9\u4fbf\u4e86\uff0c\u540e\u9762\u7ae0\u8282\u4f1a\u4e13\u95e8\u4ecb\u7ecd\u3002\n\n## \u7ed3\u8bed\n\n\u5982\u679c\u60f3\u6362\u4e00\u79cd\u601d\u8def\u5199 Vue.js\uff0c\u5c31\u8bd5\u8bd5 Render \u51fd\u6570\u5427\uff0c\u5b83\u4f1a\u8ba9\u4f60\u201c\u53c8\u7231\u53c8\u6068\u201d\uff01\n\n\u6ce8\uff1a\u672c\u8282\u90e8\u5206\u5185\u5bb9\u53c2\u8003\u4e86\u300aVue.js \u5b9e\u6218\u300b\uff08\u6e05\u534e\u5927\u5b66\u51fa\u7248\u793e\uff09\uff0c\u90e8\u5206\u4ee3\u7801\u53c2\u8003 [iView](https://github.com/iview/iview/blob/2.0/src/components/transfer/transfer.vue)\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u66f4\u7075\u6d3b\u7684\u7ec4\u4ef6Render_\u51fd\u6570\u4e0e_Functional_Render.md", "create_date": "2020-02-18T21:37:08.797", "order": 11}}, {"model": "subject.chapter", "pk": 102, "fields": {"title": "\u5b9e\u6218 2\uff1a\u7ec4\u5408\u591a\u9009\u6846\u7ec4\u4ef6\u2014\u2014CheckboxGroup & Checkbox", "topic": 5, "md5": "2896e3c984a91bffe94c4e513a564760", "md_body": "# \u5b9e\u6218 2\uff1a\u7ec4\u5408\u591a\u9009\u6846\u7ec4\u4ef6\u2014\u2014CheckboxGroup & Checkbox\n\n\u5728\u7b2c 5 \u8282\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u7ec4\u4ef6 Form\uff0c\u672c\u5c0f\u8282\u7ee7\u7eed\u5f00\u53d1\u4e00\u4e2a\u65b0\u7684\u7ec4\u4ef6\u2014\u2014\u7ec4\u5408\u591a\u9009\u6846 Checkbox\u3002\u5b83\u4f5c\u4e3a\u57fa\u7840\u7ec4\u4ef6\uff0c\u4e5f\u80fd\u96c6\u6210\u5728 Form \u5185\u5e76\u5e94\u7528\u5176\u9a8c\u8bc1\u89c4\u5219\u3002\n\n## Checkbox \u7ec4\u4ef6\u6982\u89c8\n\n\u591a\u9009\u6846\u7ec4\u4ef6\u4e5f\u662f\u7531\u4e24\u4e2a\u7ec4\u4ef6\u7ec4\u6210\uff1aCheckboxGroup \u548c Checkbox\u3002\u5355\u72ec\u4f7f\u7528\u65f6\uff0c\u53ea\u9700\u8981\u4e00\u4e2a Checkbox\uff0c\u7ec4\u5408\u4f7f\u7528\u65f6\uff0c\u4e24\u8005\u90fd\u8981\u7528\u5230\u3002\u6548\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/2/166d39853b7facd8?w=562&h=334&f=png&s=29035)\n\n\u5355\u72ec\u4f7f\u7528\uff0c\u5e38\u89c1\u7684\u573a\u666f\u6709\u6ce8\u518c\u65f6\u52fe\u9009\u4ee5\u540c\u610f\u6ce8\u518c\u6761\u6b3e\uff0c\u5b83\u53ea\u6709\u4e00\u4e2a\u72ec\u7acb\u7684 Checkbox \u7ec4\u4ef6\uff0c\u5e76\u4e14\u7ed1\u5b9a\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a\n\n```\n<template>\n  <i-checkbox v-model=\"single\">\u5355\u72ec\u9009\u9879</i-checkbox>\n</template>\n<script>\n  export default {\n    data () {\n      return {\n        single: false\n      }\n    }\n  }\n</script>\n\n```\n\n\u800c\u7ec4\u5408\u4f7f\u7528\u7684\u573a\u666f\u5c31\u5f88\u591a\u4e86\uff0c\u586b\u5199\u8868\u5355\u65f6\u4f1a\u7ecf\u5e38\u7528\u5230\uff0c\u5b83\u7684\u7ed3\u6784\u5982\u4e0b\uff1a\n\n```\n<template>\n  <i-checkbox-group v-model=\"multiple\">\n    <i-checkbox label=\"option1\">\u9009\u9879 1</i-checkbox>\n    <i-checkbox label=\"option2\">\u9009\u9879 2</i-checkbox>\n    <i-checkbox label=\"option3\">\u9009\u9879 3</i-checkbox>\n    <i-checkbox label=\"option4\">\u9009\u9879 4</i-checkbox>\n  </i-checkbox-group>\n</template>\n<script>\n  export default {\n    data () {\n      return {\n        multiple: ['option1', 'option3']\n      }\n    }\n  }\n</script>\n\n```\n\n`v-model` \u7528\u5728\u4e86 CheckboxGroup \u4e0a\uff0c\u7ed1\u5b9a\u7684\u503c\u4e3a\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u7684\u503c\u5c31\u662f\u5185\u90e8 Checkbox \u7ed1\u5b9a\u7684 label\u3002\n\n\u7528\u6cd5\u770b\u8d77\u6765\u6bd4 Form \u8981\u7b80\u5355\u591a\uff0c\u4e0d\u8fc7\u4e5f\u6709\u4e24\u4e2a\u4e2a\u6280\u672f\u96be\u70b9\uff1a\n\n*   Checkbox \u8981\u540c\u65f6\u652f\u6301\u5355\u72ec\u4f7f\u7528\u548c\u7ec4\u5408\u4f7f\u7528\u7684\u573a\u666f\uff1b\n*   CheckboxGroup \u548c Checkbox \u5185\u53ef\u80fd\u5d4c\u5957\u5176\u5b83\u7684\u5e03\u5c40\u7ec4\u4ef6\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u70b9\uff0c\u8981\u5728 Checkbox \u521d\u59cb\u5316\u65f6\u5224\u65ad\u662f\u5426\u7236\u7ea7\u6709 CheckboxGroup\uff0c\u5982\u679c\u6709\u5c31\u662f\u7ec4\u5408\u4f7f\u7528\u7684\uff0c\u5426\u5219\u5c31\u662f\u5355\u72ec\u4f7f\u7528\u3002\u800c\u7b2c\u4e8c\u70b9\uff0c\u6b63\u597d\u53ef\u4ee5\u7528\u4e0a\u4e00\u8282\u7684\u901a\u4fe1\u65b9\u6cd5\uff0c\u5f88\u5bb9\u6613\u5c31\u80fd\u89e3\u51b3\u3002\n\n\u4e24\u4e2a\u7ec4\u4ef6\u5e76\u884c\u5f00\u53d1\uff0c\u4f1a\u5bb9\u6613\u7406\u4e0d\u6e05\u903b\u8f91\uff0c\u4e0d\u59a8\u6211\u4eec\u5148\u5f00\u53d1\u72ec\u7acb\u7684 Checkbox \u7ec4\u4ef6\u3002\n\n## \u5355\u72ec\u4f7f\u7528\u7684 Checkbox\n\n\u8bbe\u8ba1\u4e00\u4e2a\u7ec4\u4ef6\u65f6\uff0c\u8fd8\u662f\u8981\u4ece\u5b83\u7684 3 \u4e2a API \u5165\u624b\uff1aprop\u3001event\u3001slot\u3002\n\n\u56e0\u4e3a\u8981\u5728 Checkbox \u7ec4\u4ef6\u4e0a\u76f4\u63a5\u4f7f\u7528 `v-model` \u6765\u53cc\u5411\u7ed1\u5b9a\u6570\u636e\uff0c\u90a3\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u4e2a prop \u5c31\u662f `value`\uff0c\u8fd8\u6709 event `input`\uff0c\u56e0\u4e3a v-model \u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff08\u5982\u679c\u4f60\u8fd8\u4e0d\u6e05\u695a\u8fd9\u79cd\u7528\u6cd5\uff0c\u53ef\u4ee5\u9605\u8bfb\u6700\u540e\u7684\u6269\u5c55\u9605\u8bfb 1\uff09\u3002\n\n\u7406\u8bba\u4e0a\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7ed9 `value` \u8bbe\u7f6e\u4e3a\u5e03\u5c14\u503c\u5373\u53ef\uff0c\u4e5f\u5c31\u662f true / false\uff0c\u4e0d\u8fc7\u4e3a\u4e86\u6269\u5c55\u6027\uff0c\u6211\u4eec\u518d\u5b9a\u4e49\u4e24\u4e2a props\uff1a`trueValue` \u548c `falseValue`\uff0c\u5b83\u4eec\u5141\u8bb8\u7528\u6237\u6307\u5b9a `value` \u7528\u4ec0\u4e48\u503c\u6765\u5224\u65ad\u662f\u5426\u9009\u4e2d\u3002\u56e0\u4e3a\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6570\u636e\u5e93\u4e2d\u5e76\u4e0d\u76f4\u63a5\u4fdd\u5b58 true / false\uff0c\u800c\u662f 1 / 0 \u6216\u5176\u5b83\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u5f3a\u5236\u4f7f\u7528 Boolean\uff0c\u4f7f\u7528\u8005\u5c31\u8981\u518d\u989d\u5916\u8f6c\u6362\u4e00\u6b21\uff0c\u8fd9\u6837\u7684 API \u8bbe\u8ba1\u4e0d\u592a\u53cb\u597d\u3002\n\n\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a `disabled` \u5c5e\u6027\u6765\u8868\u793a\u662f\u5426\u7981\u7528\u3002\n\n\u81ea\u5b9a\u4e49\u4e8b\u4ef6 events \u4e0a\u6587\u5df2\u7ecf\u8bf4\u4e86\u4e00\u4e2a `input`\uff0c\u7528\u4e8e\u5b9e\u73b0 v-model \u8bed\u6cd5\u7cd6\uff1b\u53e6\u4e00\u4e2a\u5c31\u662f `on-change`\uff0c\u5f53\u9009\u4e2d / \u53d6\u6d88\u9009\u4e2d\u65f6\u89e6\u53d1\uff0c\u7528\u4e8e\u901a\u77e5\u7236\u7ea7\u72b6\u6001\u53d1\u751f\u4e86\u53d8\u5316\u3002\n\nslot \u4f7f\u7528\u9ed8\u8ba4\u7684\u5c31\u597d\uff0c\u663e\u793a\u8f85\u52a9\u6587\u672c\u3002\n\n\u7406\u6e05\u695a\u4e86 API\uff0c\u5148\u6765\u5199\u4e00\u4e2a\u57fa\u7840\u7684 `v-model` \u529f\u80fd\uff0c\u8fd9\u5728\u5927\u90e8\u5206\u7ec4\u4ef6\u4e2d\u90fd\u7c7b\u4f3c\u3002\n\n\u5728 `src/components` \u4e0b\u65b0\u5efa\u76ee\u5f55 `checkbox`\uff0c\u5e76\u65b0\u5efa\u4e24\u4e2a\u6587\u4ef6 `checkbox.vue` \u548c `checkbox-group.vue`\u3002\u6211\u4eec\u5148\u6765\u770b Checkbox\uff1a\n\n```\n<!-- checkbox.vue -->\n<template>\n  <label>\n    <span>\n      <input\n             type=\"checkbox\"\n             :disabled=\"disabled\"\n             :checked=\"currentValue\"\n             @change=\"change\">\n    </span>\n    <slot></slot>\n  </label>\n</template>\n<script>\n  export default {\n    name: 'iCheckbox',\n    props: {\n      disabled: {\n        type: Boolean,\n        default: false\n      },\n      value: {\n        type: [String, Number, Boolean],\n        default: false\n      },\n      trueValue: {\n        type: [String, Number, Boolean],\n        default: true\n      },\n      falseValue: {\n        type: [String, Number, Boolean],\n        default: false\n      }\n    },\n    data () {\n      return {\n        currentValue: this.value\n      };\n    },\n    methods: {\n      change (event) {\n        if (this.disabled) {\n          return false;\n        }\n\n        const checked = event.target.checked;\n        this.currentValue = checked;\n\n        const value = checked ? this.trueValue : this.falseValue;\n        this.$emit('input', value);\n        this.$emit('on-change', value);\n      }\n    }\n  }\n</script>\n\n```\n\n\u56e0\u4e3a `value` \u88ab\u5b9a\u4e49\u4e3a prop\uff0c\u5b83\u53ea\u80fd\u7531\u7236\u7ea7\u4fee\u6539\uff0c\u672c\u8eab\u662f\u4e0d\u80fd\u4fee\u6539\u7684\uff0c\u5728 `<input>` \u89e6\u53d1 change \u4e8b\u4ef6\uff0c\u4e5f\u5c31\u662f\u70b9\u51fb\u9009\u62e9\u65f6\uff0c\u4e0d\u80fd\u7531 Checkbox \u6765\u4fee\u6539\u8fd9\u4e2a value\uff0c\u6240\u4ee5\u6211\u4eec\u5728 data \u91cc\u5b9a\u4e49\u4e86\u4e00\u4e2a `currentValue`\uff0c\u5e76\u628a\u5b83\u7ed1\u5b9a\u5728 `<input :checked=\"currentValue\">`\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728 Checkbox \u5185\u4fee\u6539 `currentValue`\u3002\u8fd9\u662f\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4f7f\u7528 `v-model` \u7684\u201c\u60ef\u7528\u4f0e\u4fe9\u201d\u3002\n\n\u4ee3\u7801\u770b\u8d77\u6765\u90fd\u5f88\u7b80\u5355\uff0c\u4f46\u6709\u4e09\u4e2a\u7ec6\u8282\u9700\u8981\u989d\u5916\u8bf4\u660e\uff1a\n\n1.  \u9009\u4e2d\u7684\u63a7\u4ef6\uff0c\u76f4\u63a5\u4f7f\u7528\u4e86 `<input type=\"checkbox\">`\uff0c\u800c\u6ca1\u6709\u7528 div + css \u6765\u81ea\u5df1\u5b9e\u73b0\u9009\u62e9\u7684\u903b\u8f91\u548c\u6837\u5f0f\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\uff0c\u4f7f\u7528 input \u5143\u7d20\uff0c\u4f60\u7684\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4ecd\u7136\u4e3a html \u5185\u7f6e\u7684\u57fa\u7840\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6d4f\u89c8\u5668\u9ed8\u8ba4\u7684\u884c\u4e3a\u548c\u5feb\u6377\u952e\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6d4f\u89c8\u5668\u77e5\u9053\u8fd9\u662f\u4e00\u4e2a\u9009\u62e9\u6846\uff0c\u800c\u6362\u6210 div + css\uff0c\u6d4f\u89c8\u5668\u53ef\u4e0d\u77e5\u9053\u8fd9\u662f\u4e2a\u4ec0\u4e48\u9b3c\u3002\u5982\u679c\u4f60\u89c9\u5f97\u539f\u751f\u7684 input \u4e11\uff0c\u6ca1\u5173\u7cfb\uff0c\u662f\u53ef\u4ee5\u7528 css \u7f8e\u5316\u7684\uff0c\u4e0d\u8fc7\u8fd9\u4e0d\u662f\u672c\u5c0f\u518c\u7684\u91cd\u70b9\uff0c\u5728\u6b64\u5c31\u4e0d\u4ecb\u7ecd\u4e86\u3002\n2.  `<input>`\u3001`<slot>` \u90fd\u662f\u5305\u88f9\u5728\u4e00\u4e2a `<label>` \u5143\u7d20\u5185\u7684\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\uff0c\u5f53\u70b9\u51fb `<slot>` \u91cc\u7684\u6587\u5b57\u65f6\uff0c`<input>` \u9009\u6846\u4e5f\u4f1a\u88ab\u89e6\u53d1\uff0c\u5426\u5219\u53ea\u6709\u70b9\u51fb\u90a3\u4e2a\u5c0f\u6846\u624d\u4f1a\u89e6\u53d1\uff0c\u90a3\u6837\u4e0d\u592a\u5bb9\u6613\u9009\u4e2d\uff0c\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\n3.  `currentValue` \u4ecd\u7136\u662f\u5e03\u5c14\u503c\uff08true / false\uff09\uff0c\u56e0\u4e3a\u5b83\u662f\u7ec4\u4ef6 Checkbox \u81ea\u5df1\u4f7f\u7528\u7684\uff0c\u5bf9\u4e8e\u4f7f\u7528\u8005\u65e0\u9700\u5173\u5fc3\uff0c\u800c value \u53ef\u4ee5\u662f String\u3001Number \u6216 Boolean\uff0c\u8fd9\u53d6\u51b3\u4e8e `trueValue` \u548c `falseValue` \u7684\u5b9a\u4e49\u3002\n\n\u73b0\u5728\u5b9e\u73b0\u7684 `v-model`\uff0c\u53ea\u662f\u7531\u5185\u800c\u5916\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u901a\u8fc7\u70b9\u51fb `<input>`\u9009\u62e9\uff0c\u4f1a\u901a\u77e5\u5230\u4f7f\u7528\u8005\uff0c\u800c\u4f7f\u7528\u8005\u624b\u52a8\u4fee\u6539\u4e86 prop `value` \uff0cCheckbox \u662f\u6ca1\u6709\u505a\u54cd\u5e94\u7684\uff0c\u90a3\u7ee7\u7eed\u8865\u5145\u4ee3\u7801\uff1a\n\n```\n<!-- checkbox.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<script>\n  export default {\n    watch: {\n      value (val) {\n        if (val === this.trueValue || val === this.falseValue) {\n          this.updateModel();\n        } else {\n          throw 'Value should be trueValue or falseValue.';\n        }\n      }\n    },\n    methods: {\n      updateModel () {\n        this.currentValue = this.value === this.trueValue;\n      }\n    }\n  }\n</script>\n\n```\n\n\u6211\u4eec\u5bf9 prop `value` \u4f7f\u7528 watch \u8fdb\u884c\u4e86\u76d1\u542c\uff0c\u5f53\u7236\u7ea7\u4fee\u6539\u5b83\u65f6\uff0c\u4f1a\u8c03\u7528 `updateModel` \u65b9\u6cd5\uff0c\u540c\u6b65\u4fee\u6539\u5185\u90e8\u7684 `currentValue` \u3002\u4e0d\u8fc7\uff0c\u4e0d\u662f\u6240\u6709\u7684\u503c\u7236\u7ea7\u90fd\u80fd\u4fee\u6539\u7684\uff0c\u6240\u4ee5\u7528 if \u6761\u4ef6\u5224\u65ad\u4e86\u7236\u7ea7\u4fee\u6539\u7684\u503c\u662f\u5426\u7b26\u5408 trueValue / falseValue \u6240\u8bbe\u7f6e\u7684\uff0c\u5426\u5219\u4f1a\u629b\u9519\u3002\n\nCheckbox \u4e5f\u662f\u4e00\u4e2a\u57fa\u7840\u7684\u8868\u5355\u7c7b\u7ec4\u4ef6\uff0c\u5b83\u5b8c\u5168\u53ef\u4ee5\u96c6\u6210\u5230 Form \u91cc\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528 Emitter \u5728 change \u4e8b\u4ef6\u89e6\u53d1\u65f6\uff0c\u5411 Form \u6d3e\u53d1\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u7528\u7b2c 5 \u8282\u7684 Form \u7ec4\u4ef6\u6765\u505a\u6570\u636e\u6821\u9a8c\u4e86\uff1a\n\n```\n<!-- checkbox.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<script>\n  import Emitter from '../../mixins/emitter.js';\n\n  export default {\n    mixins: [ Emitter ],\n    methods: {\n      change (event) {\n        // ... \n        this.$emit('input', value);\n        this.$emit('on-change', value);\n        this.dispatch('iFormItem', 'on-form-change', value);\n      }\n    },\n  }\n</script>\n\n```\n\n\u81f3\u6b64\uff0cCheckbox \u5df2\u7ecf\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\u4e86\uff0c\u5e76\u652f\u6301 Form \u7684\u6570\u636e\u6821\u9a8c\u3002\u4e0b\u9762\u6765\u770b\u7ec4\u5408\u4f7f\u7528\u3002\n\n### \u7ec4\u5408\u4f7f\u7528\u7684 CheckboxGroup\n\n> \u53cb\u60c5\u63d0\u793a\uff1a\u8bf7\u5148\u9605\u8bfb Vue.js \u6587\u6863\u7684 [https://cn.vuejs.org/v2/guide/forms.html#\u590d\u9009\u6846](https://cn.vuejs.org/v2/guide/forms.html#%E5%A4%8D%E9%80%89%E6%A1%86) \u5185\u5bb9\u3002\n\nCheckboxGroup \u7684 API \u5f88\u7b80\u5355\uff1a\n\n*   props\uff1a`value`\uff0c\u4e0e Checkbox \u7684\u7c7b\u4f3c\uff0c\u7528\u4e8e v-model \u53cc\u5411\u7ed1\u5b9a\u6570\u636e\uff0c\u683c\u5f0f\u4e3a\u6570\u7ec4\uff1b\n*   events\uff1a`on-change`\uff0c\u540c Checkbox\uff1b\n*   slots\uff1a\u9ed8\u8ba4\uff0c\u7528\u4e8e\u653e\u7f6e Checkbox\u3002\n\n\u5982\u679c\u5199\u4e86 CheckboxGroup\uff0c\u90a3\u5c31\u4ee3\u8868\u4f60\u8981\u7ec4\u5408\u4f7f\u7528\u591a\u9009\u6846\uff0c\u800c\u975e\u5355\u72ec\u4f7f\u7528\uff0c\u4e24\u79cd\u6a21\u5f0f\uff0c\u53ea\u80fd\u7528\u5176\u4e00\uff0c\u800c\u5224\u65ad\u7684\u4f9d\u636e\uff0c\u5c31\u662f\u662f\u5426\u7528\u4e86 CheckboxGroup \u7ec4\u4ef6\u3002\u6240\u4ee5\u5728 Checkbox \u7ec4\u4ef6\u5185\uff0c\u6211\u4eec\u7528\u4e0a\u4e00\u8282\u7684 `findComponentUpward` \u65b9\u6cd5\u5224\u65ad\u7236\u7ec4\u4ef6\u662f\u5426\u6709 `CheckboxGroup`\uff1a\n\n```\n<!-- checkbox.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<template>\n  <label>\n    <span>\n      <input\n             v-if=\"group\"\n             type=\"checkbox\"\n             :disabled=\"disabled\"\n             :value=\"label\"\n             v-model=\"model\"\n             @change=\"change\">\n      <input\n             v-else\n             type=\"checkbox\"\n             :disabled=\"disabled\"\n             :checked=\"currentValue\"\n             @change=\"change\">\n    </span>\n    <slot></slot>\n  </label>\n</template>\n<script>\n  import { findComponentUpward } from '../../utils/assist.js';\n\n  export default {\n    name: 'iCheckbox',\n    props: {\n      label: {\n        type: [String, Number, Boolean]\n      }\n    },\n    data () {\n      return {\n        model: [],\n        group: false,\n        parent: null\n      };\n    },\n    mounted () {\n      this.parent = findComponentUpward(this, 'iCheckboxGroup');\n\n      if (this.parent) {\n        this.group = true;\n      }\n\n      if (this.group) {\n        this.parent.updateModel(true);\n      } else {\n        this.updateModel();\n      }\n    },\n  }\n</script>\n\n```\n\n\u5728 mounted \u65f6\uff0c\u901a\u8fc7 findComponentUpward \u65b9\u6cd5\uff0c\u6765\u5224\u65ad\u7236\u7ea7\u662f\u5426\u6709 CheckboxGroup \u7ec4\u4ef6\uff0c\u5982\u679c\u6709\uff0c\u5c31\u5c06 `group` \u7f6e\u4e3a true\uff0c\u5e76\u89e6\u53d1 CheckboxGroup \u7684 `updateModel` \u65b9\u6cd5\uff0c\u4e0b\u6587\u4f1a\u4ecb\u7ecd\u5b83\u7684\u4f5c\u7528\u3002\n\n\u5728 template \u91cc\uff0c\u6211\u4eec\u53c8\u5199\u4e86\u4e00\u4e2a `<input>` \u6765\u533a\u5206\u662f\u5426\u662f group \u6a21\u5f0f\u3002Checkbox \u7684 data \u91cc\u65b0\u589e\u52a0\u7684 `model` \u6570\u636e\uff0c\u5176\u5b9e\u5c31\u662f\u7236\u7ea7 CheckboxGroup \u7684 `value`\uff0c\u4f1a\u5728\u4e0b\u6587\u7684 `updateModel` \u65b9\u6cd5\u91cc\u7ed9 Checkbox \u8d4b\u503c\u3002\n\nCheckbox \u65b0\u589e\u7684 prop\uff1a `label` \u53ea\u4f1a\u5728\u7ec4\u5408\u4f7f\u7528\u65f6\u6709\u6548\uff0c\u7ed3\u5408 `model` \u6765\u4f7f\u7528\uff0c\u7528\u6cd5\u5df2\u5728 Vue.js \u6587\u6863\u4e2d\u4ecb\u7ecd\u4e86 [https://cn.vuejs.org/v2/guide/forms.html#\u590d\u9009\u6846](https://cn.vuejs.org/v2/guide/forms.html#%E5%A4%8D%E9%80%89%E6%A1%86)\u3002\n\n\u5728\u7ec4\u5408\u6a21\u5f0f\u4e0b\uff0cCheckbox \u9009\u4e2d\uff0c\u5c31\u4e0d\u7528\u5bf9 Form \u6d3e\u53d1\u4e8b\u4ef6\u4e86\uff0c\u5e94\u8be5\u5728 CheckboxGroup \u4e2d\u6d3e\u53d1\uff0c\u6240\u4ee5\u5bf9 Checkbox \u505a\u6700\u540e\u7684\u4fee\u6539\uff1a\n\n```\n<!-- checkbox.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<script>\n  export default {\n    methods: {\n      change (event) {\n        if (this.disabled) {\n          return false;\n        }\n\n        const checked = event.target.checked;\n        this.currentValue = checked;\n\n        const value = checked ? this.trueValue : this.falseValue;\n        this.$emit('input', value);\n\n        if (this.group) {\n          this.parent.change(this.model);\n        } else {\n          this.$emit('on-change', value);\n          this.dispatch('iFormItem', 'on-form-change', value);\n        }\n      },\n      updateModel () {\n        this.currentValue = this.value === this.trueValue;\n      },\n    },\n  }\n</script>\n\n```\n\n\u5269\u4f59\u7684\u5de5\u4f5c\uff0c\u5c31\u662f\u5b8c\u6210 checkbox-gourp.vue \u6587\u4ef6\uff1a\n\n```\n<!-- checkbox-group.vue -->\n<template>\n  <div>\n    <slot></slot>\n  </div>\n</template>\n<script>\n  import { findComponentsDownward } from '../../utils/assist.js';\n  import Emitter from '../../mixins/emitter.js';\n\n  export default {\n    name: 'iCheckboxGroup',\n    mixins: [ Emitter ],\n    props: {\n      value: {\n        type: Array,\n        default () {\n          return [];\n        }\n      }\n    },\n    data () {\n      return {\n        currentValue: this.value,\n        childrens: []\n      };\n    },\n    methods: {\n      updateModel (update) {\n        this.childrens = findComponentsDownward(this, 'iCheckbox');\n        if (this.childrens) {\n          const { value } = this;\n          this.childrens.forEach(child => {\n            child.model = value;\n\n            if (update) {\n              child.currentValue = value.indexOf(child.label) >= 0;\n              child.group = true;\n            }\n          });\n        }\n      },\n      change (data) {\n        this.currentValue = data;\n        this.$emit('input', data);\n        this.$emit('on-change', data);\n        this.dispatch('iFormItem', 'on-form-change', data);\n      }\n    },\n    mounted () {\n      this.updateModel(true);\n    },\n    watch: {\n      value () {\n        this.updateModel(true);\n      }\n    }\n  };\n</script>\n\n\n```\n\n\u4ee3\u7801\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u9700\u8981\u4ecb\u7ecd\u7684\u5c31\u662f `updateModel` \u65b9\u6cd5\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u5171\u6709 3 \u4e2a\u5730\u65b9\u8c03\u7528\u4e86 `updateModel`\uff0c\u5176\u4e2d\u4e24\u4e2a\u662f CheckboxGroup \u7684 mounted \u521d\u59cb\u5316\u548c watch \u76d1\u542c\u7684 value \u53d8\u5316\u65f6\u8c03\u7528\uff1b\u53e6\u4e00\u4e2a\u662f\u5728 Checkbox \u91cc\u7684 mounted \u521d\u59cb\u5316\u65f6\u8c03\u7528\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4f5c\u7528\u5c31\u662f\u5728 CheckboxGroup \u91cc\u901a\u8fc7 `findComponentsDownward` \u65b9\u6cd5\u627e\u5230\u6240\u6709\u7684 Checkbox\uff0c\u7136\u540e\u628a CheckboxGroup \u7684 `value`\uff0c\u8d4b\u503c\u7ed9 Checkbox \u7684 `model`\uff0c\u5e76\u6839\u636e Checkbox \u7684 `label`\uff0c\u8bbe\u7f6e\u4e00\u6b21\u5f53\u524d Checkbox \u7684\u9009\u4e2d\u72b6\u6001\u3002\u8fd9\u6837\u65e0\u8bba\u662f\u7531\u5185\u800c\u5916\u9009\u62e9\uff0c\u6216\u7531\u5916\u5411\u5185\u4fee\u6539\u6570\u636e\uff0c\u90fd\u662f\u53cc\u5411\u7ed1\u5b9a\u7684\uff0c\u800c\u4e14\u652f\u6301\u52a8\u6001\u589e\u52a0 Checkbox \u7684\u6570\u91cf\u3002\n\n\u4ee5\u4e0a\u5c31\u662f\u7ec4\u5408\u591a\u9009\u7ec4\u4ef6\u2014\u2014CheckboxGroup & Checkbox \u7684\u5168\u90e8\u5185\u5bb9\uff0c\u4e0d\u77e5\u9053\u4f60\u662f\u5426 get \u5230\u4e86\u5462\uff01\n\n\u7559\u4e24\u4e2a\u5c0f\u4f5c\u4e1a\uff1a\n\n1.  \u5c06 CheckboxGroup \u548c Checkbox \u7ec4\u4ef6\u96c6\u6210\u5728 Form \u91cc\u5b8c\u6210\u4e00\u4e2a\u6570\u636e\u6821\u9a8c\u7684\u793a\u4f8b\uff1b\n2.  \u53c2\u8003\u672c\u8282\u7684\u4ee3\u7801\uff0c\u5b9e\u73b0\u4e00\u4e2a\u5355\u9009\u7ec4\u4ef6 Radio \u548c RadioGroup\u3002\n\n## \u7ed3\u8bed\n\n\u4f60\u770b\u5230\u7684\u7b80\u5355\u7ec4\u4ef6\uff0c\u5176\u5b9e\u90fd\u4e0d\u7b80\u5355\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [v-model \u6307\u4ee4\u5728\u7ec4\u4ef6\u4e2d\u600e\u4e48\u73a9](https://juejin.im/post/598bf7a3f265da3e252a1d6a)\n\n\u6ce8\uff1a\u672c\u8282\u90e8\u5206\u4ee3\u7801\u53c2\u8003 [iView](https://github.com/iview/iview/tree/2.0/src/components/checkbox)\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5b9e\u6218_2\u7ec4\u5408\u591a\u9009\u6846\u7ec4\u4ef6CheckboxGroup__Checkbox.md", "create_date": "2020-02-18T21:37:08.816", "order": 7}}, {"model": "subject.chapter", "pk": 103, "fields": {"title": "\u5b9e\u6218 1\uff1a\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8868\u5355\u7ec4\u4ef6\u2014\u2014Form", "topic": 5, "md5": "bfd571ed4684582e16a663e26b152320", "md_body": "# \u5b9e\u6218 1\uff1a\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8868\u5355\u7ec4\u4ef6\u2014\u2014Form\n\n\u5728\u7b2c 3 \u8282\u548c\u7b2c 4 \u8282\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u7ec4\u4ef6\u95f4\u7684\u4e24\u79cd\u901a\u4fe1\u65b9\u6cd5\uff1aprovide / inject \u548c dispatch / broadcast\uff0c\u524d\u8005\u662f Vue.js \u5185\u7f6e\u7684\uff0c\u4e3b\u8981\u7528\u4e8e\u5b50\u7ec4\u4ef6\u83b7\u53d6\u7236\u7ec4\u4ef6\uff08\u5305\u62ec\u8de8\u7ea7\uff09\u7684\u72b6\u6001\uff1b\u540e\u8005\u662f\u81ea\u884c\u5b9e\u73b0\u7684\u4e00\u79cd\u6df7\u5408\uff0c\u7528\u4e8e\u7236\u5b50\u7ec4\u4ef6\uff08\u5305\u62ec\u8de8\u7ea7\uff09\u95f4\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u901a\u4fe1\u3002\u672c\u5c0f\u8282\u5219\u57fa\u4e8e\u8fd9\u4e24\u79cd\u901a\u4fe1\u65b9\u6cd5\uff0c\u6765\u5b9e\u73b0\u4e00\u4e2a\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8868\u5355\u7ec4\u4ef6\u2014\u2014Form\u3002\n\n## Form \u7ec4\u4ef6\u6982\u89c8\n\n\u8868\u5355\u7c7b\u7ec4\u4ef6\u5728\u9879\u76ee\u4e2d\u4f1a\u5927\u91cf\u4f7f\u7528\uff0c\u6bd4\u5982\u8f93\u5165\u6846\uff08Input\uff09\u3001\u5355\u9009\uff08Radio\uff09\u3001\u591a\u9009\uff08Checkbox\uff09\u3001\u4e0b\u62c9\u9009\u62e9\u5668\uff08Select\uff09\u7b49\u3002\u5728\u4f7f\u7528\u8868\u5355\u7c7b\u7ec4\u4ef6\u65f6\uff0c\u4e5f\u4f1a\u7ecf\u5e38\u7528\u5230\u6570\u636e\u6821\u9a8c\uff0c\u5982\u679c\u6bcf\u6b21\u90fd\u5199\u6821\u9a8c\u7a0b\u5e8f\u6765\u5bf9\u6bcf\u4e00\u4e2a\u8868\u5355\u63a7\u4ef6\u6821\u9a8c\uff0c\u4f1a\u5f88\u4f4e\u6548\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u4e2a\u80fd\u591f\u6821\u9a8c\u57fa\u7840\u8868\u5355\u63a7\u4ef6\u7684\u7ec4\u4ef6\uff0c\u4e5f\u5c31\u662f\u672c\u8282\u8981\u5b8c\u6210\u7684 Form \u7ec4\u4ef6\u3002\u4e00\u822c\u7684\u7ec4\u4ef6\u5e93\u90fd\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u6bd4\u5982 iView\uff0c\u5b83\u80fd\u591f\u6821\u9a8c\u5185\u7f6e\u7684 15 \u79cd\u63a7\u4ef6\uff0c\u4e14\u652f\u6301\u6821\u9a8c\u81ea\u5b9a\u4e49\u7ec4\u4ef6\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n\uff08\u4e5f\u53ef\u4ee5\u5728\u7ebf\u8bbf\u95ee\u672c\u793a\u4f8b\u4f53\u9a8c\uff1a[https://run.iviewui.com/jwrqnFss](https://run.iviewui.com/jwrqnFss)\uff09\n\n![](https://user-gold-cdn.xitu.io/2018/10/30/166c3b75c37ef9a8?w=900&h=958&f=gif&s=1820338)\n\nForm \u7ec4\u4ef6\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff0c\u4e00\u4e2a\u662f\u5916\u5c42\u7684 `Form` \u8868\u5355\u57df\u7ec4\u4ef6\uff0c\u4e00\u7ec4\u8868\u5355\u63a7\u4ef6\u53ea\u6709\u4e00\u4e2a Form\uff0c\u800c\u5185\u90e8\u5305\u542b\u4e86\u591a\u4e2a `FormItem` \u7ec4\u4ef6\uff0c\u6bcf\u4e00\u4e2a\u8868\u5355\u63a7\u4ef6\u90fd\u88ab\u4e00\u4e2a FormItem \u5305\u88f9\u3002\u57fa\u672c\u7684\u7ed3\u6784\u770b\u8d77\u6765\u50cf\uff1a\n\n```\n<i-form>\n  <i-form-item>\n    <i-input v-model=\"form.name\"></i-input>\n  </i-form-item>\n  <i-form-item>\n    <i-input v-model=\"form.mail\"></i-input>\n  </i-form-item>\n</i-form>\n\n```\n\nForm \u8981\u7528\u5230\u6570\u636e\u6821\u9a8c\uff0c\u5e76\u5728\u5bf9\u5e94\u7684 FormItem \u4e2d\u7ed9\u51fa\u6821\u9a8c\u5931\u8d25\u7684\u63d0\u793a\uff0c\u6821\u9a8c\u6211\u4eec\u4f1a\u7528\u5230\u4e00\u4e2a\u5f00\u6e90\u5e93\uff1a[async-validator](https://github.com/yiminghe/async-validator)\uff0c\u57fa\u672c\u4e3b\u6d41\u7684\u7ec4\u4ef6\u5e93\u90fd\u662f\u57fa\u4e8e\u5b83\u505a\u7684\u6821\u9a8c\u3002\u4f7f\u7528\u5b83\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u6309\u8981\u6c42\u5199\u597d\u4e00\u4e2a\u6821\u9a8c\u89c4\u5219\u5c31\u597d\uff0c\u6bd4\u5982\uff1a\n\n```\n[\n  { required: true, message: '\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a', trigger: 'blur' },\n  { type: 'email', message: '\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e', trigger: 'blur' }\n]\n\n```\n\n\u8fd9\u4e2a\u4ee3\u8868\u8981\u6821\u9a8c\u7684\u6570\u636e\u5148\u5224\u65ad\u662f\u5426\u4e3a\u7a7a\uff08required: true\uff09\uff0c\u5982\u679c\u4e3a\u7a7a\uff0c\u5219\u63d0\u793a\u201c\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\u201d\uff0c\u89e6\u53d1\u6821\u9a8c\u7684\u4e8b\u4ef6\u4e3a\u5931\u7126\uff08trigger: 'blur'\uff09\uff0c\u5982\u679c\u7b2c\u4e00\u6761\u6ee1\u8db3\u8981\u6c42\uff0c\u518d\u8fdb\u884c\u7b2c\u4e8c\u6761\u7684\u9a8c\u8bc1\uff0c\u5224\u65ad\u662f\u5426\u4e3a\u90ae\u7bb1\u683c\u5f0f\uff08type: 'email'\uff09\u7b49\u7b49\uff0c\u8fd8\u652f\u6301\u81ea\u5b9a\u4e49\u6821\u9a8c\u89c4\u5219\u3002\u66f4\u8be6\u7ec6\u7684\u7528\u6cd5\u53ef\u4ee5\u53c2\u770b\u5b83\u7684\u6587\u6863\u3002\n\n## \u63a5\u53e3\u8bbe\u8ba1\n\n\u6211\u4eec\u5148\u4f7f\u7528\u6700\u65b0\u7684 Vue CLI 3 \u521b\u5efa\u4e00\u4e2a\u7a7a\u767d\u7684\u9879\u76ee\uff08\u5982\u679c\u4f60\u8fd8\u4e0d\u6e05\u695a Vue CLI 3 \u7684\u7528\u6cd5\uff0c\u9700\u8981\u5148\u8865\u4e60\u4e00\u4e0b\u4e86\uff0c\u53ef\u4ee5\u9605\u8bfb\u6587\u672b\u7684\u6269\u5c55\u9605\u8bfb 1\uff09\uff0c\u5e76\u4f7f\u7528 `vue-router` \u63d2\u4ef6\uff0c\u540c\u65f6\u5b89\u88c5\u597d `async-validator` \u5e93\u3002\n\n\u5728 `src/components` \u4e0b\u65b0\u5efa\u4e00\u4e2a `form` \u6587\u4ef6\u5939\uff0c\u5e76\u521d\u59cb\u5316\u4e24\u4e2a\u7ec4\u4ef6 `form.vue` \u548c `form-item.vue`\uff0c\u7136\u540e\u521d\u59cb\u5316\u9879\u76ee\uff0c\u914d\u7f6e\u8def\u7531\uff0c\u521b\u5efa\u4e00\u4e2a\u9875\u9762\u80fd\u591f\u88ab\u8bbf\u95ee\u5230\u3002\n\n> \u672c\u8282\u6240\u6709\u4ee3\u7801\u53ef\u4ee5\u5728 [https://github.com/icarusion/vue-component-book](https://github.com/icarusion/vue-component-book) \u4e2d\u67e5\u770b\uff0c\u4f60\u53ef\u4ee5\u4e00\u8fb9\u770b\u6e90\u7801\uff0c\u4e00\u8fb9\u9605\u8bfb\u672c\u8282\uff1b\u4e5f\u53ef\u4ee5\u8fb9\u9605\u8bfb\uff0c\u8fb9\u52a8\u624b\u5b9e\u73b0\u4e00\u904d\uff0c\u9047\u5230\u95ee\u9898\u518d\u53c2\u8003\u5b8c\u6574\u7684\u6e90\u7801\u3002\n\n\u7b2c 2 \u8282\u6211\u4eec\u4ecb\u7ecd\u5230\uff0c\u7f16\u5199\u4e00\u4e2a Vue.js \u7ec4\u4ef6\uff0c\u6700\u91cd\u8981\u7684\u662f\u8bbe\u8ba1\u597d\u5b83\u7684\u63a5\u53e3\uff0c\u4e00\u4e2a Vue.js \u7ec4\u4ef6\u7684\u63a5\u53e3\u6765\u81ea\u4e09\u4e2a\u90e8\u5206\uff1aprops\u3001slots\u3001events\u3002\u800c Form \u548c FormItem \u4e24\u4e2a\u7ec4\u4ef6\u4e3b\u8981\u505a\u6570\u636e\u6821\u9a8c\uff0c\u7528\u4e0d\u5230 events\u3002Form \u7684 slot \u5c31\u662f\u4e00\u7cfb\u5217\u7684 FormItem\uff0cFormItem \u7684 slot \u5c31\u662f\u5177\u4f53\u7684\u8868\u5355\u63a7\u4ef6\uff0c\u6bd4\u5982\u8f93\u5165\u6846 `<i-input>` \u3002\u90a3\u4e3b\u8981\u8bbe\u8ba1\u7684\u5c31\u662f props \u4e86\u3002\n\n\u5728 `Form` \u7ec4\u4ef6\u4e2d\uff0c\u5b9a\u4e49\u4e24\u4e2a props\uff1a\n\n*   model\uff1a\u8868\u5355\u63a7\u4ef6\u7ed1\u5b9a\u7684\u6570\u636e\u5bf9\u8c61\uff0c\u5728\u6821\u9a8c\u6216\u91cd\u7f6e\u65f6\u4f1a\u8bbf\u95ee\u8be5\u6570\u636e\u5bf9\u8c61\u4e0b\u5bf9\u5e94\u7684\u8868\u5355\u6570\u636e\uff0c\u7c7b\u578b\u4e3a Object\u3002\n*   rules\uff1a\u8868\u5355\u9a8c\u8bc1\u89c4\u5219\uff0c\u5373\u4e0a\u9762\u4ecb\u7ecd\u7684 async-validator \u6240\u4f7f\u7528\u7684\u6821\u9a8c\u89c4\u5219\uff0c\u7c7b\u578b\u4e3a Object\u3002\n\n\u5728 `FormItem` \u7ec4\u4ef6\u4e2d\uff0c\u4e5f\u5b9a\u4e49\u4e24\u4e2a props\uff1a\n\n*   label\uff1a\u5355\u4e2a\u8868\u5355\u7ec4\u4ef6\u7684\u6807\u7b7e\u6587\u672c\uff0c\u7c7b\u4f3c\u539f\u751f\u7684 `<label>` \u5143\u7d20\uff0c\u7c7b\u578b\u4e3a String\u3002\n*   prop\uff1a\u5bf9\u5e94\u8868\u5355\u57df Form \u7ec4\u4ef6 model \u91cc\u7684\u5b57\u6bb5\uff0c\u7528\u4e8e\u5728\u6821\u9a8c\u6216\u91cd\u7f6e\u65f6\u8bbf\u95ee\u8868\u5355\u7ec4\u4ef6\u7ed1\u5b9a\u7684\u6570\u636e\uff0c\u7c7b\u578b\u4e3a String\u3002\n\n\u5b9a\u4e49\u597d props\uff0c\u5c31\u53ef\u4ee5\u5199\u51fa\u5927\u6982\u7684\u7528\u4f8b\u4e86\uff1a\n\n```\n<template>\n  <div>\n    <i-form :model=\"formValidate\" :rules=\"ruleValidate\">\n      <i-form-item label=\"\u7528\u6237\u540d\" prop=\"name\">\n        <i-input v-model=\"formValidate.name\"></i-input>\n      </i-form-item>\n      <i-form-item label=\"\u90ae\u7bb1\" prop=\"mail\">\n        <i-input v-model=\"formValidate.mail\"></i-input>\n      </i-form-item>\n    </i-form>\n  </div>\n</template>\n<script>\n  import iForm from '../components/form/form.vue';\n  import iFormItem from '../components/form/form-item.vue';\n  import iInput from '../components/input/input.vue';\n\n  export default {\n    components: { iForm, iFormItem, iInput },\n    data () {\n      return {\n        formValidate: {\n          name: '',\n          mail: ''\n        },\n        ruleValidate: {\n          name: [\n            { required: true, message: '\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a', trigger: 'blur' }\n          ],\n          mail: [\n            { required: true, message: '\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a', trigger: 'blur' },\n            { type: 'email', message: '\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e', trigger: 'blur' }\n          ],\n        }\n      }\n    }\n  }\n</script>\n\n```\n\n\u6709\u4e24\u70b9\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a\n\n1.  \u8fd9\u91cc\u7684 `<i-input>` \u5e76\u4e0d\u662f\u539f\u751f\u7684 `<input>` \u8f93\u5165\u6846\uff0c\u800c\u662f\u4e00\u4e2a\u7279\u5236\u7684\u8f93\u5165\u6846\u7ec4\u4ef6\uff0c\u4e4b\u540e\u4f1a\u4ecb\u8bb2\u89e3\u7684\u529f\u80fd\u548c\u4ee3\u7801\uff1b\n2.  `<i-form-item>` \u7684\u5c5e\u6027 `prop` \u662f\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u5b83\u524d\u9762\u6ca1\u6709\u5192\u53f7\uff08\u5373\u4e0d\u662f `:prop=\"name\"`\uff09\u3002\n\n\u5f53\u524d\u7684\u4e24\u4e2a\u7ec4\u4ef6\u53ea\u662f\u4e2a\u6846\u6846\uff0c\u8fd8\u6ca1\u6709\u5b9e\u73b0\u4efb\u4f55\u529f\u80fd\uff0c\u4e0d\u8fc7\u4e07\u4e8b\u5f00\u5934\u96be\uff0c\u5b9a\u4e49\u597d\u63a5\u53e3\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u8865\u5168\u7ec4\u4ef6\u7684\u903b\u8f91\uff0c\u800c\u5bf9\u4e8e\u4f7f\u7528\u8005\uff0c\u77e5\u9053\u4e86 props\u3001events\u3001slots\uff0c\u5c31\u5df2\u7ecf\u80fd\u5199\u51fa\u4e0a\u4f8b\u7684\u4f7f\u7528\u4ee3\u7801\u4e86\u3002\n\n\u5230\u6b64\uff0cForm \u548c FormItem \u7684\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n<!-- form.vue -->\n<template>\n  <form>\n    <slot></slot>\n  </form>\n</template>\n<script>\n  export default {\n    name: 'iForm',\n    props: {\n      model: {\n        type: Object\n      },\n      rules: {\n        type: Object\n      }\n    }\n  }\n</script>\n\n```\n\n```\n<!-- form-item.vue -->\n<template>\n  <div>\n    <label v-if=\"label\">{{ label }}</label>\n    <div>\n      <slot></slot>\n    </div>\n  </div>\n</template>\n<script>\n  export default {\n    name: 'iFormItem',\n    props: {\n      label: {\n        type: String,\n        default: ''\n      },\n      prop: {\n        type: String\n      }\n    }\n  }\n</script>\n\n```\n\n## \u5728 Form \u4e2d\u7f13\u5b58 FormItem \u5b9e\u4f8b\n\n`Form` \u7ec4\u4ef6\u7684\u6838\u5fc3\u529f\u80fd\u662f\u6570\u636e\u6821\u9a8c\uff0c\u4e00\u4e2a Form \u4e2d\u5305\u542b\u4e86\u591a\u4e2a FormItem\uff0c\u5f53\u70b9\u51fb\u63d0\u4ea4\u6309\u94ae\u65f6\uff0c\u8981\u9010\u4e00\u5bf9\u6bcf\u4e2a FormItem \u5185\u7684\u8868\u5355\u7ec4\u4ef6\u6821\u9a8c\uff0c\u800c\u6821\u9a8c\u662f\u7531\u4f7f\u7528\u8005\u53d1\u8d77\uff0c\u5e76\u901a\u8fc7 `Form` \u6765\u8c03\u7528\u6bcf\u4e00\u4e2a `FormItem` \u7684\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u518d\u5c06\u6821\u9a8c\u7ed3\u679c\u6c47\u603b\u540e\uff0c\u901a\u8fc7 `Form` \u8fd4\u56de\u51fa\u53bb\u3002\u5927\u81f4\u7684\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/10/30/166c3b7f124cb84a?w=1046&h=610&f=png&s=42610)\n\n\u56e0\u4e3a\u8981\u5728 Form \u4e2d\u9010\u4e00\u8c03\u7528 FormItem \u7684\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u800c Form \u548c FormItem \u662f\u72ec\u7acb\u7684\uff0c\u9700\u8981\u9884\u5148\u5c06 FormItem \u7684\u6bcf\u4e2a\u5b9e\u4f8b\u7f13\u5b58\u5728 Form \u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u5c31\u9700\u8981\u7528\u5230\u7b2c 4 \u8282\u7684\u7ec4\u4ef6\u901a\u4fe1\u65b9\u6cd5\u3002\u5f53\u6bcf\u4e2a FormItem \u6e32\u67d3\u65f6\uff0c\u5c06\u5176\u81ea\u8eab\uff08this\uff09\u4f5c\u4e3a\u53c2\u6570\u901a\u8fc7 `dispatch` \u6d3e\u53d1\u5230 Form \u7ec4\u4ef6\u4e2d\uff0c\u7136\u540e\u901a\u8fc7\u4e00\u4e2a\u6570\u7ec4\u7f13\u5b58\u8d77\u6765\uff1b\u540c\u7406\u5f53 FormItem \u9500\u6bc1\u65f6\uff0c\u5c06\u5176\u4ece Form \u7f13\u5b58\u7684\u6570\u7ec4\u4e2d\u79fb\u9664\u3002\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// form-item.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\n\nimport Emitter from '../../mixins/emitter.js';\n\nexport default {\n  name: 'iFormItem',\n  mixins: [ Emitter ],\n  // \u7ec4\u4ef6\u6e32\u67d3\u65f6\uff0c\u5c06\u5b9e\u4f8b\u7f13\u5b58\u5728 Form \u4e2d\n  mounted () {\n    // \u5982\u679c\u6ca1\u6709\u4f20\u5165 prop\uff0c\u5219\u65e0\u9700\u6821\u9a8c\uff0c\u4e5f\u5c31\u65e0\u9700\u7f13\u5b58\n    if (this.prop) {\n      this.dispatch('iForm', 'on-form-item-add', this);\n    }\n  },\n  // \u7ec4\u4ef6\u9500\u6bc1\u524d\uff0c\u5c06\u5b9e\u4f8b\u4ece Form \u7684\u7f13\u5b58\u4e2d\u79fb\u9664\n  beforeDestroy () {\n    this.dispatch('iForm', 'on-form-item-remove', this);\n  }\n}\n\n```\n\n\u6ce8\u610f\uff0cVue.js \u7684\u7ec4\u4ef6\u6e32\u67d3\u987a\u5e8f\u662f\u7531\u5185\u800c\u5916\u7684\uff0c\u6240\u4ee5 FormItem \u8981\u5148\u4e8e Form \u6e32\u67d3\uff0c\u5728 FormItem \u7684 mounted \u89e6\u53d1\u65f6\uff0c\u6211\u4eec\u5411 Form \u6d3e\u53d1\u4e86\u4e8b\u4ef6 `on-form-item-add`\uff0c\u5e76\u5c06\u5f53\u524d FormItem \u7684\u5b9e\u4f8b\uff08this\uff09\u4f20\u9012\u7ed9\u4e86 Form\uff0c\u800c\u6b64\u65f6\uff0cForm \u7684 mounted \u5c1a\u672a\u89e6\u53d1\uff0c\u56e0\u4e3a Form \u5728\u6700\u5916\u5c42\uff0c\u5982\u679c\u5728 Form \u7684 mounted \u91cc\u76d1\u542c\u4e8b\u4ef6\uff0c\u662f\u4e0d\u53ef\u4ee5\u7684\uff0c\u6240\u4ee5\u8981\u5728\u5176 created \u5185\u76d1\u542c\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0cForm \u7684 created \u8981\u5148\u4e8e FormItem \u7684 mounted\u3002\u6240\u4ee5 Form \u7684\u76f8\u5173\u4ee3\u7801\u4e3a\uff1a\n\n```\n// form.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  name: 'iForm',\n  data () {\n    return {\n      fields: []\n    };\n  },\n  created () {\n    this.$on('on-form-item-add', (field) => {\n      if (field) this.fields.push(field);\n    });\n    this.$on('on-form-item-remove', (field) => {\n      if (field.prop) this.fields.splice(this.fields.indexOf(field), 1);\n    });\n  }\n}\n\n```\n\n\u5b9a\u4e49\u7684\u6570\u636e `fields` \u5c31\u662f\u7528\u6765\u7f13\u5b58\u6240\u6709 FormItem \u5b9e\u4f8b\u7684\u3002\n\n## \u89e6\u53d1\u6821\u9a8c\n\nForm \u652f\u6301\u4e24\u79cd\u4e8b\u4ef6\u6765\u89e6\u53d1\u6821\u9a8c\uff1a\n\n*   **blur**\uff1a\u5931\u53bb\u7126\u70b9\u65f6\u89e6\u53d1\uff0c\u5e38\u89c1\u7684\u6709\u8f93\u5165\u6846\u5931\u53bb\u7126\u70b9\u65f6\u89e6\u53d1\u6821\u9a8c\uff1b\n*   **change**\uff1a\u5b9e\u65f6\u8f93\u5165\u65f6\u89e6\u53d1\u6216\u9009\u62e9\u65f6\u89e6\u53d1\uff0c\u5e38\u89c1\u7684\u6709\u8f93\u5165\u6846\u5b9e\u65f6\u8f93\u5165\u65f6\u89e6\u53d1\u6821\u9a8c\u3001\u4e0b\u62c9\u9009\u62e9\u5668\u9009\u62e9\u9879\u76ee\u65f6\u89e6\u53d1\u6821\u9a8c\u7b49\u3002\n\n\u4ee5\u4e0a\u4e24\u4e2a\u4e8b\u4ef6\uff0c\u90fd\u662f\u6709\u5177\u4f53\u7684\u8868\u5355\u7ec4\u4ef6\u6765\u89e6\u53d1\u7684\uff0c\u6211\u4eec\u5148\u6765\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u8f93\u5165\u6846\u7ec4\u4ef6 `i-input`\u3002\u5728 `components` \u4e0b\u65b0\u5efa\u76ee\u5f55 `input`\uff0c\u5e76\u521b\u5efa\u6587\u4ef6 `input.vue`\uff1a\n\n```\n<!-- input.vue -->\n<template>\n  <input\n         type=\"text\"\n         :value=\"currentValue\"\n         @input=\"handleInput\"\n         @blur=\"handleBlur\"\n         />\n</template>\n<script>\n  import Emitter from '../../mixins/emitter.js';\n\n  export default {\n    name: 'iInput',\n    mixins: [ Emitter ],\n    props: {\n      value: {\n        type: String,\n        default: ''\n      },\n    },\n    data () {\n      return {\n        currentValue: this.value\n      }\n    },\n    watch: {\n      value (val) {\n        this.currentValue = val;\n      }\n    },\n    methods: {\n      handleInput (event) {\n        const value = event.target.value;\n        this.currentValue = value;\n        this.$emit('input', value);\n        this.dispatch('iFormItem', 'on-form-change', value);\n      },\n      handleBlur () {\n        this.dispatch('iFormItem', 'on-form-blur', this.currentValue);\n      }\n    }\n  }\n</script>\n\n```\n\nInput \u7ec4\u4ef6\u4e2d\uff0c\u7ed1\u5b9a\u5728 `<input>` \u5143\u7d20\u4e0a\u7684\u539f\u751f\u4e8b\u4ef6 `@input`\uff0c\u6bcf\u5f53\u8f93\u5165\u4e00\u4e2a\u5b57\u7b26\uff0c\u90fd\u4f1a\u8c03\u7528\u53e5\u67c4 `handleInput`\uff0c\u5e76\u901a\u8fc7 `dispatch` \u65b9\u6cd5\u5411\u4e0a\u7ea7\u7684 FormItem \u7ec4\u4ef6\u6d3e\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6 `on-form-change`\uff1b\u540c\u7406\uff0c\u7ed1\u5b9a\u7684\u539f\u751f\u4e8b\u4ef6 `@blur` \u4f1a\u5728 input \u5931\u7126\u65f6\u89e6\u53d1\uff0c\u5e76\u4f20\u9012\u4e8b\u4ef6 `on-form-blur`\u3002\n\n\u57fa\u7840\u7ec4\u4ef6\u6709\u4e86\uff0c\u63a5\u4e0b\u6765\u8981\u505a\u7684\uff0c\u662f\u5728 FormItem \u4e2d\u76d1\u542c\u6765\u81ea Input \u7ec4\u4ef6\u6d3e\u53d1\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u3002\u8fd9\u91cc\u53ef\u4ee5\u5728 mounted \u4e2d\u76d1\u542c\uff0c\u56e0\u4e3a\u4f60\u7684\u624b\u901f\u8fdc\u8d76\u4e0d\u4e0a\u7ec4\u4ef6\u6e32\u67d3\u7684\u901f\u5ea6\uff0c\u4e0d\u8fc7\u5728 created \u4e2d\u76d1\u542c\u4e5f\u662f\u6ca1\u4efb\u4f55\u95ee\u9898\u7684\u3002\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// form-item.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  methods: {\n    setRules () {\n      this.$on('on-form-blur', this.onFieldBlur);\n      this.$on('on-form-change', this.onFieldChange);\n    },\n  },\n  mounted () {\n    if (this.prop) {\n      this.dispatch('iForm', 'on-form-item-add', this);\n      this.setRules();\n    }\n  }\n}\n\n```\n\n\u901a\u8fc7\u8c03\u7528 `setRules` \u65b9\u6cd5\uff0c\u76d1\u542c\u8868\u5355\u7ec4\u4ef6\u7684\u4e24\u4e2a\u4e8b\u4ef6\uff0c\u5e76\u7ed1\u5b9a\u4e86\u53e5\u67c4\u51fd\u6570 `onFieldBlur` \u548c `onFieldChange`\uff0c\u5206\u522b\u5bf9\u5e94 blur \u548c change \u4e24\u79cd\u4e8b\u4ef6\u7c7b\u578b\u3002\u5f53 onFieldBlur \u6216 onFieldChange \u51fd\u6570\u89e6\u53d1\u65f6\uff0c\u5c31\u610f\u5473\u7740 FormItem \u8981\u5bf9**\u5f53\u524d\u7684\u6570\u636e**\u8fdb\u884c\u4e00\u6b21\u6821\u9a8c\u3002\u5f53\u524d\u7684\u6570\u636e\uff0c\u6307\u7684\u5c31\u662f\u901a\u8fc7\u8868\u5355\u57df Form \u4e2d\u5b9a\u4e49\u7684 props\uff1amodel\uff0c\u7ed3\u5408\u5f53\u524d FormItem \u5b9a\u4e49\u7684 props\uff1aprop \u6765\u786e\u5b9a\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u56de\u987e\u4e0a\u6587\u5199\u8fc7\u7684\u7528\u4f8b\u3002\n\n\u56e0\u4e3a FormItem \u4e2d\u53ea\u5b9a\u4e49\u4e86\u6570\u636e\u6e90\u7684\u67d0\u4e2a key \u540d\u79f0\uff08\u5373\u5c5e\u6027 prop\uff09\uff0c\u8981\u62ff\u5230 Form \u4e2d model \u91cc\u7684\u6570\u636e\uff0c\u9700\u8981\u7528\u5230\u7b2c 3 \u8282\u7684\u901a\u4fe1\u65b9\u6cd5 provide / inject\u3002\u6240\u4ee5\u5728 Form \u4e2d\uff0c\u628a\u6574\u4e2a\u5b9e\u4f8b\uff08this\uff09\u5411\u4e0b\u63d0\u4f9b\uff0c\u5e76\u5728 FormItem \u4e2d\u6ce8\u5165\uff1a\n\n```\n// form.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  provide() {\n    return {\n      form : this\n    };\n  }\n}\n\n```\n\n```\n// form-item.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  inject: ['form']\n}\n\n```\n\n\u51c6\u5907\u597d\u8fd9\u4e9b\uff0c\u63a5\u7740\u5c31\u662f\u6700\u6838\u5fc3\u7684\u6821\u9a8c\u529f\u80fd\u4e86\u3002blur \u548c change \u4e8b\u4ef6\u90fd\u4f1a\u89e6\u53d1\u6821\u9a8c\uff0c\u5b83\u4eec\u8c03\u7528\u540c\u4e00\u4e2a\u65b9\u6cd5\uff0c\u53ea\u662f\u53c2\u6570\u4e0d\u540c\u3002\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// form-item.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nimport AsyncValidator from 'async-validator';\n\nexport default {\n  inject: ['form'],\n  props: {\n    prop: {\n      type: String\n    },\n  },\n  data () {\n    return {\n      validateState: '',  // \u6821\u9a8c\u72b6\u6001\n      validateMessage: '',  // \u6821\u9a8c\u4e0d\u901a\u8fc7\u65f6\u7684\u63d0\u793a\u4fe1\u606f\n    }\n  },\n  computed: {\n    // \u4ece Form \u7684 model \u4e2d\u52a8\u6001\u5f97\u5230\u5f53\u524d\u8868\u5355\u7ec4\u4ef6\u7684\u6570\u636e\n    fieldValue () {\n      return this.form.model[this.prop];\n    }\n  },\n  methods: {\n    // \u4ece Form \u7684 rules \u5c5e\u6027\u4e2d\uff0c\u83b7\u53d6\u5f53\u524d FormItem \u7684\u6821\u9a8c\u89c4\u5219\n    getRules () {\n      let formRules = this.form.rules;\n\n      formRules = formRules ? formRules[this.prop] : [];\n\n      return [].concat(formRules || []);\n    },\n    // \u53ea\u652f\u6301 blur \u548c change\uff0c\u6240\u4ee5\u8fc7\u6ee4\u51fa\u7b26\u5408\u8981\u6c42\u7684 rule \u89c4\u5219\n    getFilteredRule (trigger) {\n      const rules = this.getRules();\n      return rules.filter(rule => !rule.trigger || rule.trigger.indexOf(trigger) !== -1);\n    },\n    /**\n     * \u6821\u9a8c\u6570\u636e\n     * @param trigger \u6821\u9a8c\u7c7b\u578b\n     * @param callback \u56de\u8c03\u51fd\u6570\n     */\n    validate(trigger, callback = function () {}) {\n      let rules = this.getFilteredRule(trigger);\n\n      if (!rules || rules.length === 0) {\n        return true;\n      }\n\n      // \u8bbe\u7f6e\u72b6\u6001\u4e3a\u6821\u9a8c\u4e2d\n      this.validateState = 'validating';\n\n      // \u4ee5\u4e0b\u4e3a async-validator \u5e93\u7684\u8c03\u7528\u65b9\u6cd5\n      let descriptor = {};\n      descriptor[this.prop] = rules;\n\n      const validator = new AsyncValidator(descriptor);\n      let model = {};\n\n      model[this.prop] = this.fieldValue;\n\n      validator.validate(model, { firstFields: true }, errors => {\n        this.validateState = !errors ? 'success' : 'error';\n        this.validateMessage = errors ? errors[0].message : '';\n\n        callback(this.validateMessage);\n      });\n    },\n    onFieldBlur() {\n      this.validate('blur');\n    },\n    onFieldChange() {\n      this.validate('change');\n    }\n  }\n}\n\n```\n\n\u5728 FormItem \u7684 `validate()` \u65b9\u6cd5\u4e2d\uff0c\u6700\u7ec8\u505a\u4e86\u4e24\u4ef6\u4e8b\uff1a\n\n1.  \u8bbe\u7f6e\u4e86\u5f53\u524d\u7684\u6821\u9a8c\u72b6\u6001 `validateState` \u548c\u6821\u9a8c\u4e0d\u901a\u8fc7\u63d0\u793a\u4fe1\u606f `validateMessage`\uff08\u901a\u8fc7\u503c\u4e3a\u7a7a\uff09\uff1b\n2.  \u5c06 validateMessage \u901a\u8fc7\u56de\u8c03 callback \u4f20\u9012\u7ed9\u8c03\u7528\u8005\uff0c\u8fd9\u91cc\u7684\u8c03\u7528\u8005\u662f onFieldBlur \u548c onFieldChange\uff0c\u5b83\u4eec\u53ea\u4f20\u5165\u4e86\u7b2c\u4e00\u4e2a\u53c2\u6570 `trigger`\uff0ccallback \u5e76\u672a\u4f20\u5165\uff0c\u56e0\u6b64\u4e5f\u4e0d\u4f1a\u89e6\u53d1\u56de\u8c03\uff0c\u800c\u8fd9\u4e2a\u56de\u8c03\u4e3b\u8981\u662f\u7ed9 Form \u7528\u7684\uff0c\u56e0\u4e3a Form \u4e2d\u53ef\u4ee5\u901a\u8fc7\u63d0\u4ea4\u6309\u94ae\u4e00\u6b21\u6027\u6821\u9a8c\u6240\u6709\u7684 FormItem\uff08\u540e\u6587\u4f1a\u4ecb\u7ecd\uff09\u8fd9\u91cc\u53ea\u662f\u8868\u5355\u7ec4\u4ef6\u89e6\u53d1\u4e8b\u4ef6\u65f6\uff0c\u5bf9\u5f53\u524d FormItem \u505a\u6821\u9a8c\u3002\n\n\u9664\u4e86\u6821\u9a8c\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u5f53\u524d\u6570\u636e\u8fdb\u884c\u91cd\u7f6e\u3002\u91cd\u7f6e\u662f\u6307\u5c06\u8868\u5355\u7ec4\u4ef6\u7684\u6570\u636e\u8fd8\u539f\u5230\u6700\u521d\u7ed1\u5b9a\u7684\u503c\uff0c\u800c\u4e0d\u662f\u6e05\u7a7a\uff0c\u56e0\u6b64\u9700\u8981\u9884\u5148\u7f13\u5b58\u4e00\u4efd\u521d\u59cb\u503c\u3002\u540c\u65f6\u6211\u4eec\u5c06\u6821\u9a8c\u4fe1\u606f\u4e5f\u663e\u793a\u5728\u6a21\u677f\u4e2d\uff0c\u5e76\u52a0\u4e00\u4e9b\u6837\u5f0f\u3002\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n<!-- form-item.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<template>\n  <div>\n    <label v-if=\"label\" :class=\"{ 'i-form-item-label-required': isRequired }\">{{ label }}</label>\n    <div>\n      <slot></slot>\n      <div v-if=\"validateState === 'error'\" class=\"i-form-item-message\">{{ validateMessage }}</div>\n    </div>\n  </div>\n</template>\n<script>\n  export default {\n    props: {\n      label: {\n        type: String,\n        default: ''\n      },\n      prop: {\n        type: String\n      },\n    },\n    data () {\n      return {\n        isRequired: false,  // \u662f\u5426\u4e3a\u5fc5\u586b\n        validateState: '',  // \u6821\u9a8c\u72b6\u6001\n        validateMessage: '',  // \u6821\u9a8c\u4e0d\u901a\u8fc7\u65f6\u7684\u63d0\u793a\u4fe1\u606f\n      }\n    },\n    mounted () {\n      // \u5982\u679c\u6ca1\u6709\u4f20\u5165 prop\uff0c\u5219\u65e0\u9700\u6821\u9a8c\uff0c\u4e5f\u5c31\u65e0\u9700\u7f13\u5b58\n      if (this.prop) {\n        this.dispatch('iForm', 'on-form-item-add', this);\n\n        // \u8bbe\u7f6e\u521d\u59cb\u503c\uff0c\u4ee5\u4fbf\u5728\u91cd\u7f6e\u65f6\u6062\u590d\u9ed8\u8ba4\u503c\n        this.initialValue = this.fieldValue;\n\n        this.setRules();\n      }\n    },\n    methods: {\n      setRules () {\n        let rules = this.getRules();\n        if (rules.length) {\n          rules.every((rule) => {\n            // \u5982\u679c\u5f53\u524d\u6821\u9a8c\u89c4\u5219\u4e2d\u6709\u5fc5\u586b\u9879\uff0c\u5219\u6807\u8bb0\u51fa\u6765\n            this.isRequired = rule.required;\n          });\n        }\n\n        this.$on('on-form-blur', this.onFieldBlur);\n        this.$on('on-form-change', this.onFieldChange);\n      },\n      // \u4ece Form \u7684 rules \u5c5e\u6027\u4e2d\uff0c\u83b7\u53d6\u5f53\u524d FormItem \u7684\u6821\u9a8c\u89c4\u5219\n      getRules () {\n        let formRules = this.form.rules;\n\n        formRules = formRules ? formRules[this.prop] : [];\n\n        return [].concat(formRules || []);\n      },\n      // \u91cd\u7f6e\u6570\u636e\n      resetField () {\n        this.validateState = '';\n        this.validateMessage = '';\n\n        this.form.model[this.prop] = this.initialValue;\n      },\n    }\n  }\n</script>\n<style>\n  .i-form-item-label-required:before {\n    content: '*';\n    color: red;\n  }\n  .i-form-item-message {\n    color: red;\n  }\n</style>\n\n```\n\n\u81f3\u6b64\uff0cFormItem \u4ee3\u7801\u5df2\u7ecf\u5b8c\u6210\uff0c\u4e0d\u8fc7\u5b83\u53ea\u5177\u6709\u5355\u72ec\u6821\u9a8c\u7684\u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u80fd\u5bf9\u81ea\u5df1\u7684\u4e00\u4e2a\u8868\u5355\u7ec4\u4ef6\u9a8c\u8bc1\uff0c\u4e0d\u80fd\u5bf9\u4e00\u4e2a\u8868\u5355\u57df\u91cc\u7684\u6240\u6709\u7ec4\u4ef6\u4e00\u6b21\u6027\u5168\u90e8\u6821\u9a8c\u3002\u800c\u5b9e\u73b0\u5168\u90e8\u6821\u9a8c\u548c\u5168\u90e8\u91cd\u7f6e\u7684\u529f\u80fd\uff0c\u8981\u5728 Form \u4e2d\u5b8c\u6210\u3002\n\n\u4e0a\u6587\u5df2\u7ecf\u4ecb\u7ecd\u5230\uff0c\u5728 `Form` \u7ec4\u4ef6\u4e2d\uff0c\u9884\u5148\u7f13\u5b58\u4e86\u5168\u90e8\u7684 FormItem \u5b9e\u4f8b\uff0c\u81ea\u7136\u4e5f\u80fd\u5728 Form \u4e2d\u8c03\u7528\u5b83\u4eec\u3002\u901a\u8fc7\u70b9\u51fb\u63d0\u4ea4\u6309\u94ae\u5168\u90e8\u6821\u9a8c\uff0c\u6216\u70b9\u51fb\u91cd\u7f6e\u6309\u94ae\u5168\u90e8\u91cd\u7f6e\u6570\u636e\uff0c\u53ea\u9700\u8981\u5728 Form \u4e2d\uff0c\u9010\u4e00\u8c03\u7528\u7f13\u5b58\u7684 FormItem \u5b9e\u4f8b\u4e2d\u7684 `validate` \u6216 `resetField` \u65b9\u6cd5\u3002\u76f8\u5173\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// form.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  data () {\n    return {\n      fields: []\n    };\n  },\n  methods: {\n    // \u516c\u5f00\u65b9\u6cd5\uff1a\u5168\u90e8\u91cd\u7f6e\u6570\u636e\n    resetFields() {\n      this.fields.forEach(field => {\n        field.resetField();\n      });\n    },\n    // \u516c\u5f00\u65b9\u6cd5\uff1a\u5168\u90e8\u6821\u9a8c\u6570\u636e\uff0c\u652f\u6301 Promise\n    validate(callback) {\n      return new Promise(resolve => {\n        let valid = true;\n        let count = 0;\n        this.fields.forEach(field => {\n          field.validate('', errors => {\n            if (errors) {\n              valid = false;\n            }\n            if (++count === this.fields.length) {\n              // \u5168\u90e8\u5b8c\u6210\n              resolve(valid);\n              if (typeof callback === 'function') {\n                callback(valid);\n              }\n            }\n          });\n        });\n      });\n    }\n  },\n}\n\n```\n\n\u867d\u7136\u8bf4 Vue.js \u7684 API \u53ea\u6765\u81ea prop\u3001event\u3001slot \u8fd9\u4e09\u4e2a\u90e8\u5206\uff0c\u4f46\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u9700\u8981\u901a\u8fc7 `ref` \u6765\u8bbf\u95ee\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u8c03\u7528\u5b83\u7684\u4e00\u4e9b\u5185\u7f6e\u65b9\u6cd5\uff0c\u6bd4\u5982\u4e0a\u9762\u7684 `validate` \u548c `resetFields` \u65b9\u6cd5\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u8005\u6765\u4e3b\u52a8\u8c03\u7528\u3002\n\nresetFields \u5f88\u7b80\u5355\uff0c\u5c31\u662f\u901a\u8fc7\u5faa\u73af\u9010\u4e00\u8c03\u7528 FormItem \u7684 resetField \u65b9\u6cd5\u6765\u91cd\u7f6e\u6570\u636e\u3002validate \u7a0d\u663e\u590d\u6742\uff0c\u5b83\u652f\u6301\u4e24\u79cd\u4f7f\u7528\u65b9\u6cd5\uff0c\u4e00\u79cd\u662f\u666e\u901a\u7684\u56de\u8c03\uff0c\u6bd4\u5982\uff1a\n\n```\n<template>\n  <div>\n    <i-form ref=\"form\"></i-form>\n    <button @click=\"handleSubmit\">\u63d0\u4ea4</button>\n  </div>\n</template>\n<script>\n  export default {\n    methods: {\n      handleSubmit () {\n        this.$refs.form.validate((valid) => {\n          if (valid) {\n            window.alert('\u63d0\u4ea4\u6210\u529f');\n          } else {\n            window.alert('\u8868\u5355\u6821\u9a8c\u5931\u8d25');\n          }\n        })\n      }\n    }\n  }\n</script>\n\n```\n\n\u540c\u65f6\u4e5f\u652f\u6301 Promise\uff0c\u4f8b\u5982\uff1a\n\n```\nhandleSubmit () {\n  const validate = this.$refs.form.validate();\n  \n  validate.then((valid) => {\n    if (valid) {\n      window.alert('\u63d0\u4ea4\u6210\u529f');\n    } else {\n      window.alert('\u8868\u5355\u6821\u9a8c\u5931\u8d25');\n    }\n  })\n}\n\n```\n\n\u5728 Form \u7ec4\u4ef6\u5b9a\u4e49\u7684 Promise \u4e2d\uff0c\u53ea\u8c03\u7528\u4e86 resolve(valid)\uff0c\u6ca1\u6709\u8c03\u7528 reject()\uff0c\u56e0\u6b64\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528 `.catch()` \uff0c\u4e0d\u8fc7\u806a\u660e\u7684\u4f60\u7a0d\u4f5c\u4fee\u6539\uff0c\u80af\u5b9a\u80fd\u591f\u652f\u6301\u5230\uff01\n\n\u5b8c\u6574\u7684\u7528\u4f8b\u5982\u4e0b\uff1a\n\n```\n<template>\n  <div>\n    <h3>\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8868\u5355\u7ec4\u4ef6\u2014\u2014Form</h3>\n    <i-form ref=\"form\" :model=\"formValidate\" :rules=\"ruleValidate\">\n      <i-form-item label=\"\u7528\u6237\u540d\" prop=\"name\">\n        <i-input v-model=\"formValidate.name\"></i-input>\n      </i-form-item>\n      <i-form-item label=\"\u90ae\u7bb1\" prop=\"mail\">\n        <i-input v-model=\"formValidate.mail\"></i-input>\n      </i-form-item>\n    </i-form>\n    <button @click=\"handleSubmit\">\u63d0\u4ea4</button>\n    <button @click=\"handleReset\">\u91cd\u7f6e</button>\n  </div>\n</template>\n<script>\n  import iForm from '../components/form/form.vue';\n  import iFormItem from '../components/form/form-item.vue';\n  import iInput from '../components/input/input.vue';\n\n  export default {\n    components: { iForm, iFormItem, iInput },\n    data () {\n      return {\n        formValidate: {\n          name: '',\n          mail: ''\n        },\n        ruleValidate: {\n          name: [\n            { required: true, message: '\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a', trigger: 'blur' }\n          ],\n          mail: [\n            { required: true, message: '\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a', trigger: 'blur' },\n            { type: 'email', message: '\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e', trigger: 'blur' }\n          ],\n        }\n      }\n    },\n    methods: {\n      handleSubmit () {\n        this.$refs.form.validate((valid) => {\n          if (valid) {\n            window.alert('\u63d0\u4ea4\u6210\u529f');\n          } else {\n            window.alert('\u8868\u5355\u6821\u9a8c\u5931\u8d25');\n          }\n        })\n      },\n      handleReset () {\n        this.$refs.form.resetFields();\n      }\n    }\n  }\n</script>\n\n```\n\n\u8fd0\u884c\u6548\u679c\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/10/30/166c3b8a77e382ec?w=1417&h=550&f=png&s=60805)\n\n\u5b8c\u6574\u7684\u793a\u4f8b\u6e90\u7801\u53ef\u901a\u8fc7 GitHub \u67e5\u770b\uff1a\n\n[https://github.com/icarusion/vue-component-book](https://github.com/icarusion/vue-component-book)\n\n> \u9879\u76ee\u57fa\u4e8e Vue CLI 3 \u6784\u5efa\uff0c\u4e0b\u8f7d\u5b89\u88c5\u4f9d\u8d56\u540e\uff0c\u901a\u8fc7 npm run serve \u53ef\u8bbf\u95ee\u3002\n\n## \u7ed3\u8bed\n\n\u7ec4\u4ef6\u6700\u7ec8\u7684\u6548\u679c\u770b\u8d77\u6765\u6709\u70b9 \u201clow\u201d\uff0c\u4f46\u5b83\u5b9e\u73b0\u7684\u529f\u80fd\u5374\u4e0d\u7b80\u5355\u3002\u901a\u8fc7\u8fd9\u4e2a\u5b9e\u6218\uff0c\u4f60\u6216\u8bb8\u5df2\u7ecf\u611f\u53d7\u5230\u672c\u5c0f\u518c\u4e00\u5f00\u59cb\u8bf4\u7684\uff0c\u7ec4\u4ef6\u5199\u5230\u6700\u540e\uff0c\u90fd\u662f\u5728\u62fc JavaScript \u529f\u5e95\u3002\u7684\u786e\uff0cVue.js \u7ec4\u4ef6\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b0\u7684\u4ee3\u7801\u7ec4\u7ec7\u5f62\u5f0f\uff0c\u4f46\u5f52\u6839\u5230\u5e95\uff0c\u662f\u79bb\u4e0d\u5f00 JS \u7684\u3002\n\n\u8fd9\u4e2a\u5b9e\u6218\uff0c\u4f60\u5e94\u8be5\u5bf9\u72ec\u7acb\u7ec4\u4ef6\u95f4\u7684\u901a\u4fe1\u7528\u6cd5\u6709\u8fdb\u4e00\u6b65\u7684\u8ba4\u77e5\u4e86\u5427\uff0c\u4e0d\u8fc7\uff0c\u8fd9\u8fd8\u4e0d\u662f\u7ec4\u4ef6\u901a\u4fe1\u7684\u7ec8\u6781\u65b9\u6848\uff0c\u4e0b\u4e00\u8282\uff0c\u6211\u4eec\u5c31\u6765\u770b\u770b\u9002\u7528\u4e8e\u4efb\u4f55\u573a\u666f\u7684\u7ec4\u4ef6\u901a\u4fe1\u65b9\u6848\u3002\n\n\u6ce8\uff1a\u672c\u8282\u90e8\u5206\u4ee3\u7801\u53c2\u8003 [iView](https://github.com/iview/iview/tree/2.0/src/components/form)\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [\u4e00\u4efd\u8d85\u7ea7\u8be6\u7ec6\u7684Vue-cli3.0\u4f7f\u7528\u6559\u7a0b](https://juejin.im/post/5bdec6e8e51d4505327a8952)", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5b9e\u6218_1\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8868\u5355\u7ec4\u4ef6Form.md", "create_date": "2020-02-18T21:37:08.833", "order": 5}}, {"model": "subject.chapter", "pk": 104, "fields": {"title": "\u5b9e\u6218 3\uff1a\u52a8\u6001\u6e32\u67d3 .vue \u6587\u4ef6\u7684\u7ec4\u4ef6\u2014\u2014 Display", "topic": 5, "md5": "6157a4e9a91055d6b96bb443468efcf7", "md_body": "# \u5b9e\u6218 3\uff1a\u52a8\u6001\u6e32\u67d3 .vue \u6587\u4ef6\u7684\u7ec4\u4ef6\u2014\u2014 Display\n\n\u4f60\u53ef\u80fd\u7528\u8fc7 [jsfiddle](https://jsfiddle.net/) \u6216 [jsbin](https://jsbin.com) \u4e4b\u7c7b\u7684\u7f51\u7ad9\uff0c\u5728\u91cc\u9762\u4f60\u53ef\u4ee5\u7528 CDN \u7684\u5f62\u5f0f\u5f15\u5165 Vue.js\uff0c\u7136\u540e\u5728\u7ebf\u5199\u793a\u4f8b\uff0c\u5b9e\u65f6\u8fd0\u884c\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a\n\n[https://jsfiddle.net/c87yh92v/](https://jsfiddle.net/c87yh92v/)\n\n\u4e0d\u8fc7\uff0c\u8fd9\u7c7b\u7f51\u7ad9\u4e3b\u8981\u662f\u4e00\u4e2a html\uff0c\u91cc\u9762\u5305\u542b js\u3001css \u90e8\u5206\uff0c\u6e32\u67d3\u4fa7\u662f\u7528 iframe \u5d4c\u5165\u4f60\u7f16\u5199\u7684 html\uff0c\u5e76\u5b9e\u65f6\u66f4\u65b0\u3002\u5728\u8fd9\u4e9b\u7f51\u7ad9\u5199\u793a\u4f8b\uff0c\u662f\u4e0d\u80fd\u76f4\u63a5\u5199 `.vue` \u6587\u4ef6\u7684\uff0c\u56e0\u4e3a\u6ca1\u6cd5\u8fdb\u884c\u7f16\u8bd1\u3002\n\n\u518d\u6765\u770b\u53e6\u4e00\u4e2a\u7f51\u7ad9 [iView Run](https://run.iviewui.com/)\uff08\u4e4b\u524d\u5c0f\u8282\u4e5f\u6709\u63d0\u5230\uff09\uff0c\u5b83\u662f\u80fd\u591f\u5728\u7ebf\u7f16\u5199\u4e00\u4e2a\u6807\u51c6\u7684 `.vue` \u6587\u4ef6\uff0c\u5e76\u53ca\u65f6\u6e32\u67d3\u7684\uff0c\u5b83\u4e5f\u9884\u7f6e\u4e86 iView \u73af\u5883\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 iView \u7ec4\u4ef6\u5e93\u5168\u90e8\u7684\u7ec4\u4ef6\u3002\u672c\u5c0f\u8282\uff0c\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u8fd9\u6837\u4e00\u4e2a\u80fd\u591f\u52a8\u6001\u6e32\u67d3 .vue \u6587\u4ef6\u7684 `Display` \u7ec4\u4ef6\uff0c\u5f53\u7136\uff0c\u7528\u5230\u7684\u6838\u5fc3\u6280\u672f\u5c31\u662f\u4e0a\u4e00\u8282\u7684 `extend` \u548c `$mount`\u3002\n\n## \u63a5\u53e3\u8bbe\u8ba1\n\n\u4e00\u4e2a\u5e38\u89c4\u7684 `.vue` \u6587\u4ef6\u4e00\u822c\u90fd\u4f1a\u5305\u542b 3 \u4e2a\u90e8\u5206\uff1a\n\n*   `<template>`\uff1a\u7ec4\u4ef6\u7684\u6a21\u677f\uff1b\n*   `<script>`\uff1a\u7ec4\u4ef6\u7684\u9009\u9879\uff0c\u4e0d\u5305\u542b `el`\uff1b\n*   `<style>`\uff1aCSS \u6837\u5f0f\u3002\n\n\u56de\u5fc6\u4e00\u4e0b\u7528 `extend` \u6765\u6784\u9020\u4e00\u4e2a\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u5b83\u7684\u9009\u9879 `template` \u5176\u5b9e\u5c31\u662f\u4e0a\u9762 `<template>` \u7684\u5185\u5bb9\uff0c\u5176\u4f59\u9009\u9879\u5bf9\u5e94\u7684\u662f `<script>`\uff0c\u6837\u5f0f `<style>` \u4e8b\u5b9e\u4e0a\u4e0e Vue.js \u65e0\u5173\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u4e0d\u7ba1\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u5f53\u62ff\u5230\u4e00\u4e2a .vue \u7684\u6587\u4ef6\uff08\u6574\u4f53\u5176\u5b9e\u662f\u5b57\u7b26\u4e32\uff09\uff0c\u53ea\u9700\u8981\u628a `<template>`\u3001`<script>`\u3001`<style>` \u4f7f\u7528\u6b63\u5219\u5206\u5272\uff0c\u628a\u5bf9\u5e94\u7684\u90e8\u5206\u4f20\u9012\u7ed9 extend \u521b\u5efa\u7684\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u3002\n\nDisplay \u662f\u4e00\u4e2a\u529f\u80fd\u578b\u7684\u7ec4\u4ef6\uff0c\u6ca1\u6709\u4ea4\u4e92\u548c\u4e8b\u4ef6\uff0c\u53ea\u9700\u8981\u4e00\u4e2a prop\uff1acode \u5c06 .vue \u7684\u5185\u5bb9\u4f20\u9012\u8fc7\u6765\uff0c\u5176\u4f59\u5de5\u4f5c\u90fd\u662f\u5728\u7ec4\u4ef6\u5185\u5b8c\u6210\u7684\uff0c\u8fd9\u5bf9\u4f7f\u7528\u8005\u5f88\u53cb\u597d\u3002\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8bbe\u8ba1\u6210\u4e09\u4e2a props\uff0c\u5206\u522b\u5bf9\u5e94 html\u3001js\u3001css\uff0c\u90a3\u5206\u5272\u7684\u5de5\u4f5c\u5c31\u8981\u4f7f\u7528\u8005\u6765\u5b8c\u6210\u3002\u51fa\u4e8e\u4f7f\u7528\u8005\u4f18\u5148\u539f\u5219\uff0c\u82e6\u6d3b\u7d2f\u6d3b\u5f53\u7136\u662f\u5728\u7ec4\u4ef6\u5185\u5b8c\u6210\u4e86\uff0c\u56e0\u6b64\u63a8\u8350\u7b2c\u4e00\u4e2a\u65b9\u6848\u3002\n\n## \u5b9e\u73b0\n\n\u5728 `src/components` \u76ee\u5f55\u4e0b\u521b\u5efa `display` \u76ee\u5f55\uff0c\u5e76\u65b0\u5efa `display.vue` \u6587\u4ef6\uff0c\u57fa\u672c\u7ed3\u6784\u5982\u4e0b\uff1a\n\n```\n<!-- display.vue -->\n<template>\n  <div ref=\"display\"></div>\n</template>\n<script>\n  export default {\n    props: {\n      code: {\n        type: String,\n        default: ''\n      }\n    },\n    data () {\n      return {\n        html: '',\n        js: '',\n        css: ''\n      }\n    },\n  }\n</script>\n\n```\n\n\u7236\u7ea7\u4f20\u9012 `code` \u540e\uff0c\u5c06\u5176\u5206\u5272\uff0c\u5e76\u4fdd\u5b58\u5728 data \u7684 html\u3001js\u3001css \u4e2d\uff0c\u540e\u7eed\u4f7f\u7528\u3002\n\n\u6211\u4eec\u4f7f\u7528\u6b63\u5219\uff0c\u57fa\u4e8e `<>` \u548c `</>` \u7684\u7279\u6027\u8fdb\u884c\u5206\u5272\uff1a\n\n```\n// display.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  methods: {\n    getSource (source, type) {\n      const regex = new RegExp(`<${type}[^>]*>`);\n      let openingTag = source.match(regex);\n\n      if (!openingTag) return '';\n      else openingTag = openingTag[0];\n\n      return source.slice(source.indexOf(openingTag) + openingTag.length, source.lastIndexOf(`</${type}>`));\n    },\n    splitCode () {\n      const script = this.getSource(this.code, 'script').replace(/export default/, 'return ');\n      const style = this.getSource(this.code, 'style');\n      const template = '<div id=\"app\">' + this.getSource(this.code, 'template') + '</div>';\n\n      this.js = script;\n      this.css = style;\n      this.html = template;\n    },\n  }\n}\n\n```\n\ngetSource \u65b9\u6cd5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff1a\n\n*   source\uff1a.vue \u6587\u4ef6\u4ee3\u7801\uff0c\u5373 props: code\uff1b\n*   type\uff1a\u5206\u5272\u7684\u90e8\u5206\uff0c\u4e5f\u5c31\u662f template\u3001script\u3001style\u3002\n\n\u5206\u5272\u540e\uff0c\u8fd4\u56de\u7684\u5185\u5bb9\u4e0d\u518d\u5305\u542b `<template>` \u7b49\u6807\u7b7e\uff0c\u76f4\u63a5\u662f\u5bf9\u5e94\u7684\u5185\u5bb9\uff0c\u5728 splitCode \u65b9\u6cd5\u4e2d\uff0c\u628a\u5206\u5272\u597d\u7684\u4ee3\u7801\u5206\u522b\u8d4b\u503c\u7ed9 data \u4e2d\u58f0\u660e\u7684 html\u3001js\u3001css\u3002\u6709\u4e24\u4e2a\u7ec6\u8282\u9700\u8981\u6ce8\u610f\uff1a\n\n1.  .vue \u7684 `<script>` \u90e8\u5206\u4e00\u822c\u90fd\u662f\u4ee5 `export default` \u5f00\u59cb\u7684\uff0c\u53ef\u4ee5\u770b\u5230\u5728 splitCode \u65b9\u6cd5\u4e2d\u5c06\u5b83\u66ff\u6362\u4e3a\u4e86 `return`\uff0c\u8fd9\u4e2a\u5728\u540e\u6587\u4f1a\u505a\u89e3\u91ca\uff0c\u5f53\u524d\u53ea\u8981\u6ce8\u610f\uff0c\u6211\u4eec\u5206\u5272\u5b8c\u7684\u4ee3\u7801\uff0c\u4ecd\u7136\u662f\u5b57\u7b26\u4e32\uff1b\n2.  \u5728\u5206\u5272\u7684 `<template>` \u5916\u5c42\u5957\u4e86\u4e00\u4e2a `<div id=\"app\">`\uff0c\u8fd9\u662f\u4e3a\u4e86\u5bb9\u9519\uff0c\u6709\u65f6\u4f7f\u7528\u8005\u4f20\u9012\u7684 `code` \u53ef\u80fd\u4f1a\u5fd8\u8bb0\u5728\u5916\u5c42\u5305\u4e00\u4e2a\u8282\u70b9\uff0c\u6ca1\u6709\u6839\u8282\u70b9\u7684\u7ec4\u4ef6\uff0c\u662f\u4f1a\u62a5\u9519\u7684\u3002\n\n\u51c6\u5907\u597d\u8fd9\u4e9b\u57fa\u7840\u5de5\u4f5c\u540e\uff0c\u5c31\u53ef\u4ee5\u7528 `extend` \u6e32\u67d3\u7ec4\u4ef6\u4e86\uff0c\u5728\u8fd9\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e2a\u95ee\u9898\uff1a\u4e0a\u6587\u8bf4\u5230\uff0c\u5f53\u524d\u7684 `this.js` \u662f\u5b57\u7b26\u4e32\uff0c\u800c extend \u63a5\u6536\u7684\u9009\u9879\u53ef\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u800c\u662f\u4e00\u4e2a\u5bf9\u8c61\u7c7b\u578b\uff0c\u90a3\u5c31\u8981\u5148\u628a this.js \u8f6c\u4e3a\u4e00\u4e2a\u5bf9\u8c61\u3002\n\n\u4e0d\u5356\u5173\u5b50\uff0c\u6765\u4ecb\u7ecd `new Function` \u7528\u6cd5\uff0c\u5148\u770b\u4e2a\u793a\u4f8b\uff1a\n\n```\nconst sum = new Function('a', 'b', 'return a + b');\n\nconsole.log(sum(2, 6)); // 8\n\n```\n\nnew Function \u7684\u8bed\u6cd5\uff1a\n\n```\nnew Function ([arg1[, arg2[, ...argN]],] functionBody)\n\n```\n\narg1, arg2, ... argN \u662f\u88ab\u51fd\u6570\u4f7f\u7528\u7684\u53c2\u6570\u540d\u79f0\uff0c**functionBody** \u662f\u4e00\u4e2a\u542b\u6709\u5305\u62ec\u51fd\u6570\u5b9a\u4e49\u7684 JavaScript \u8bed\u53e5\u7684**\u5b57\u7b26\u4e32**\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u793a\u4f8b\u4e2d\u7684\u5b57\u7b26\u4e32 `return a + b` \u88ab\u5f53\u505a\u8bed\u53e5\u6267\u884c\u4e86\u3002\n\n\u4e0a\u6587\u8bf4\u5230\uff0c`this.js` \u4e2d\u662f\u5c06 _export default_ \u66ff\u6362\u4e3a _return_ \u7684\uff0c\u5982\u679c\u5c06 this.js \u4f20\u5165 new Function \u91cc\uff0c\u90a3\u4e48 this.js \u5c31\u6267\u884c\u4e86\uff0c\u8fd9\u65f6\u56e0\u4e3a\u6709 return\uff0c\u8fd4\u56de\u7684\u5c31\u662f\u4e00\u4e2a\u5bf9\u8c61\u7c7b\u578b\u7684 this.js \u4e86\u3002\n\n\u5982\u679c\u4f60\u8fd8\u4e0d\u662f\u5f88\u7406\u89e3 new Function\uff0c\u53ef\u4ee5\u5230\u6587\u672b\u7684\u6269\u5c55\u9605\u8bfb\u8fdb\u4e00\u6b65\u4e86\u89e3\u3002\u9664\u4e86 new Function\uff0c\u4f60\u719f\u6089\u7684 `eval` \u51fd\u6570\u4e5f\u53ef\u4ee5\u4f7f\u7528\uff0c\u5b83\u4e0e new Function \u529f\u80fd\u7c7b\u4f3c\u3002\n\n\u77e5\u9053\u4e86\u8fd9\u4e9b\uff0c\u4e0b\u9762\u7684\u5185\u5bb9\u5c31\u5bb9\u6613\u7406\u89e3\u4e86\uff1a\n\n```\n<!-- display.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<template>\n  <div ref=\"display\"></div>\n</template>\n<script>\n  import Vue from 'vue';\n  \n  export default {\n    data () {\n      return {\n        component: null\n      }\n    },\n    methods: {\n      renderCode () {\n        this.splitCode();\n\n        if (this.html !== '' && this.js !== '') {\n          const parseStrToFunc = new Function(this.js)();\n\n          parseStrToFunc.template =  this.html;\n          const Component = Vue.extend( parseStrToFunc );\n          this.component = new Component().$mount();\n\n          this.$refs.display.appendChild(this.component.$el);\n        }\n      }\n    },\n    mounted () {\n      this.renderCode();\n    }\n  }\n</script>\n\n```\n\nextend \u6784\u9020\u7684\u5b9e\u4f8b\u901a\u8fc7 $mount \u6e32\u67d3\u540e\uff0c\u6302\u8f7d\u5230\u4e86\u7ec4\u4ef6\u552f\u4e00\u7684\u4e00\u4e2a\u8282\u70b9 `<div ref=\"display\">` \u4e0a\u3002\n\n\u73b0\u5728 html \u548c js \u90fd\u6709\u4e86\uff0c\u8fd8\u5269\u4e0b css\u3002\u52a0\u8f7d css \u6ca1\u6709\u4ec0\u4e48\u5947\u6280\u6deb\u5de7\uff0c\u5c31\u662f\u521b\u5efa\u4e00\u4e2a `<style>` \u6807\u7b7e\uff0c\u7136\u540e\u628a css \u5199\u8fdb\u53bb\uff0c\u518d\u63d2\u5165\u5230\u9875\u9762\u7684 `<head>` \u4e2d\uff0c\u8fd9\u6837 css \u5c31\u88ab\u6d4f\u89c8\u5668\u89e3\u6790\u4e86\u3002\u4e3a\u4e86\u4fbf\u4e8e\u540e\u9762\u5728 `this.code` \u53d8\u5316\u6216\u7ec4\u4ef6\u9500\u6bc1\u65f6\u79fb\u9664\u52a8\u6001\u521b\u5efa\u7684 `<style>` \u6807\u7b7e\uff0c\u6211\u4eec\u7ed9\u6bcf\u4e2a style \u6807\u7b7e\u52a0\u4e00\u4e2a\u968f\u673a id \u7528\u4e8e\u6807\u8bc6\u3002\n\n\u5728 `src/utils` \u76ee\u5f55\u4e0b\u65b0\u5efa `random_str.js` \u6587\u4ef6\uff0c\u5e76\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a\n\n```\n// \u751f\u6210\u968f\u673a\u5b57\u7b26\u4e32\nexport default function (len = 32) {\n  const $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890';\n  const maxPos = $chars.length;\n  let str = '';\n  for (let i = 0; i < len; i++) {\n    str += $chars.charAt(Math.floor(Math.random() * maxPos));\n  }\n  return str;\n}\n\n```\n\n\u4e0d\u96be\u7406\u89e3\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u4ece\u6307\u5b9a\u7684 a-zA-Z0-9 \u4e2d\u968f\u673a\u751f\u6210 32 \u4f4d\u7684\u5b57\u7b26\u4e32\u3002\n\n\u8865\u5168 renderCode \u65b9\u6cd5\uff1a\n\n```\n// display.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nimport randomStr from '../../utils/random_str.js';\n\nexport default {\n  data () {\n    return {\n      id: randomStr()\n    }\n  },\n  methods: {\n    renderCode () {\n      if (this.html !== '' && this.js !== '') {\n        // ...\n        if (this.css !== '') {\n          const style = document.createElement('style');\n          style.type = 'text/css';\n          style.id = this.id;\n          style.innerHTML = this.css;\n          document.getElementsByTagName('head')[0].appendChild(style);\n        }\n      }\n    }\n  }\n}\n\n```\n\n\u5f53 Display \u7ec4\u4ef6\u9500\u6bc1\u65f6\uff0c\u4e5f\u8981\u624b\u52a8\u9500\u6bc1 extend \u521b\u5efa\u7684\u5b9e\u4f8b\u4ee5\u53ca\u4e0a\u9762\u7684 css\uff1a\n\n```\n// display.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  methods: {\n    destroyCode () {\n      const $target = document.getElementById(this.id);\n      if ($target) $target.parentNode.removeChild($target);\n\n      if (this.component) {\n        this.$refs.display.removeChild(this.component.$el);\n        this.component.$destroy();\n        this.component = null;\n      }\n    }\n  },\n  beforeDestroy () {\n    this.destroyCode();\n  }\n}\n\n```\n\n\u5f53 `this.code` \u66f4\u65b0\u65f6\uff0c\u6574\u4e2a\u8fc7\u7a0b\u8981\u91cd\u65b0\u6765\u4e00\u6b21\uff0c\u6240\u4ee5\u8981\u5bf9 `code` \u8fdb\u884c watch \u76d1\u542c\uff1a\n\n```\n// display.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  watch: {\n    code () {\n      this.destroyCode();\n      this.renderCode();\n    }\n  }\n}\n\n```\n\n\u4ee5\u4e0a\u5c31\u662f Display \u7ec4\u4ef6\u7684\u6240\u6709\u5185\u5bb9\u3002\n\n## \u4f7f\u7528\n\n\u65b0\u5efa\u4e00\u6761\u8def\u7531\uff0c\u5e76\u5728 `src/views` \u4e0b\u65b0\u5efa\u9875\u9762 `display.vue` \u6765\u4f7f\u7528 Display \u7ec4\u4ef6\uff1a\n\n```\n<!-- src/views/display.vue -->\n<template>\n  <div>\n    <h3>\u52a8\u6001\u6e32\u67d3 .vue \u6587\u4ef6\u7684\u7ec4\u4ef6\u2014\u2014 Display</h3>\n\n    <i-display :code=\"code\"></i-display>\n  </div>\n</template>\n<script>\n  import iDisplay from '../components/display/display.vue';\n  import defaultCode from './default-code.js';\n\n  export default {\n    components: { iDisplay },\n    data () {\n      return {\n        code: defaultCode\n      }\n    }\n  }\n</script>\n\n```\n\n```\n// src/views/default-code.js\nconst code =\n`<template>\n    <div>\n        <input v-model=\"message\">\n        {{ message }}\n    </div>\n</template>\n<script>\n    export default {\n        data () {\n            return {\n                message: ''\n            }\n        }\n    }\n</script>`;\n\nexport default code;\n\n```\n\n\u5982\u679c\u4f7f\u7528\u7684\u662f Vue CLI 3 \u9ed8\u8ba4\u7684\u914d\u7f6e\uff0c\u76f4\u63a5\u8fd0\u884c\u65f6\uff0c\u4f1a\u629b\u51fa\u4e0b\u9762\u7684\u9519\u8bef\uff1a\n\n> \\[Vue warn\\]: You are using the runtime-only build of Vue where the template compiler is not available. Either pre-compile the templates into render functions, or use the compiler-included build.\n\n\u8fd9\u6d89\u53ca\u5230\u53e6\u4e00\u4e2a\u77e5\u8bc6\u70b9\uff0c\u5c31\u662f Vue.js \u7684\u7248\u672c\u3002\u5728\u4f7f\u7528 Vue.js 2 \u65f6\uff0c\u6709\u72ec\u7acb\u6784\u5efa\uff08standalone\uff09\u548c\u8fd0\u884c\u65f6\u6784\u5efa\uff08runtime-only\uff09\u4e24\u79cd\u7248\u672c\u53ef\u4f9b\u9009\u62e9\uff0c\u8be6\u7ec6\u7684\u4ecb\u7ecd\u8bf7\u9605\u8bfb\u6587\u672b\u6269\u5c55\u9605\u8bfb 2\u3002\n\nVue CLI 3 \u9ed8\u8ba4\u4f7f\u7528\u4e86 vue.runtime.js\uff0c\u5b83\u4e0d\u5141\u8bb8\u7f16\u8bd1 template \u6a21\u677f\uff0c\u56e0\u4e3a\u6211\u4eec\u5728 Vue.extend \u6784\u9020\u5b9e\u4f8b\u65f6\uff0c\u7528\u4e86 `template` \u9009\u9879\uff0c\u6240\u4ee5\u4f1a\u62a5\u9519\u3002\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff0c\u4e00\u662f\u624b\u52a8\u5c06 template \u6539\u5199\u4e3a Render \u51fd\u6570\uff0c\u4f46\u8fd9\u6210\u672c\u592a\u9ad8\uff1b\u53e6\u4e00\u79cd\u662f\u5bf9 Vue CLI 3 \u521b\u5efa\u7684\u5de5\u7a0b\u505a\u7b80\u5355\u7684\u914d\u7f6e\u3002\u6211\u4eec\u4f7f\u7528\u540e\u8005\u3002\n\n\u5728\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u65b0\u5efa\u6587\u4ef6 `vue.config.js`\uff1a\n\n```\nmodule.exports = {\n  runtimeCompiler: true\n};\n\n```\n\n\u5b83\u7684\u4f5c\u7528\u662f\uff0c\u662f\u5426\u4f7f\u7528\u5305\u542b\u8fd0\u884c\u65f6\u7f16\u8bd1\u5668\u7684 Vue \u6784\u5efa\u7248\u672c\u3002\u8bbe\u7f6e\u4e3a `true` \u540e\u5c31\u53ef\u4ee5\u5728 Vue \u7ec4\u4ef6\u4e2d\u4f7f\u7528 `template` \u9009\u9879\u4e86\uff0c\u4f46\u662f\u5e94\u7528\u989d\u5916\u589e\u52a0 10kb \u5de6\u53f3\uff08\u8fd8\u597d\u5427\uff09\u3002\n\n\u52a0\u4e86\u8fd9\u4e2a\u914d\u7f6e\uff0c\u62a5\u9519\u5c31\u6d88\u5931\u4e86\uff0c\u7ec4\u4ef6\u4e5f\u80fd\u6b63\u5e38\u663e\u793a\u3002\n\n\u4ee5\u4e0a\u5c31\u662f Display \u7ec4\u4ef6\u6240\u6709\u7684\u5185\u5bb9\uff0c\u5982\u679c\u4f60\u611f\u5174\u8da3\uff0c\u53ef\u4ee5\u628a\u5b83\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u505a\u6210 iView Run \u8fd9\u6837\u7684\u4ea7\u54c1\u3002\n\n## \u7ed3\u8bed\n\n\u8fd9\u4e2a\u5c0f\u5c0f\u7684 Display \u7ec4\u4ef6\uff0c\u80fd\u505a\u7684\u4e8b\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u8981\u5199\u4e00\u5957 Vue \u7ec4\u4ef6\u5e93\u7684\u6587\u6863\uff0c\u4f20\u7edf\u65b9\u6cd5\u662f\u5728\u5f00\u53d1\u73af\u5883\u5199\u4e00\u4e2a\u4e2a\u7684 .vue \u6587\u4ef6\uff0c\u7136\u540e\u7f16\u8bd1\u6253\u5305\u3001\u4e0a\u4f20\u8d44\u6e90\u3001\u4e0a\u7ebf\uff0c\u5982\u679c\u8981\u4fee\u6539\uff0c\u54ea\u6015\u4e00\u4e2a\u6807\u70b9\u7b26\u53f7\uff0c\u90fd\u8981\u91cd\u65b0\u7f16\u8bd1\u6253\u5305\u3001\u4e0a\u4f20\u8d44\u6e90\u3001\u4e0a\u7ebf\u3002\u6709\u4e86 Display \u7ec4\u4ef6\uff0c\u53ea\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u670d\u52a1\u6765\u5728\u7ebf\u4fee\u6539\u6587\u6863\u7684 .vue\uff0c\u5c31\u80fd\u5b9e\u65f6\u66f4\u65b0\uff0c\u4e0d\u7528\u6253\u5305\u3001\u4e0a\u4f20\u3001\u4e0a\u7ebf\u3002\n\n\u8fd8\u6709\u4e00\u70b9\u5f88\u91cd\u8981\u7684\u662f\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5728 iView Run \u91cc\uff0c\u9ed8\u8ba4\u662f\u76f4\u63a5\u53ef\u4ee5\u5199 iView \u7ec4\u4ef6\u5e93\u7684\u5168\u90e8\u7ec4\u4ef6\uff0c\u5e76\u6ca1\u6709\u989d\u5916\u5f15\u5165\uff0c\u8fd9\u662f\u56e0\u4e3a Display \u6240\u5728\u7684\u5de5\u7a0b\uff0c\u5df2\u7ecf\u5c06 iView \u5b89\u88c5\u5728\u4e86\u5168\u5c40\uff0cVue.extend \u5728\u6784\u9020\u5b9e\u4f8b\u65f6\uff0c\u5df2\u7ecf\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u5b89\u88c5\u7684\u63d2\u4ef6\u4e86\uff0c\u5982\u679c\u4f60\u8fd8\u5168\u5c40\u5b89\u88c5\u4e86\u5176\u5b83\u63d2\u4ef6\uff0c\u6bd4\u5982 axios\uff0c\u90fd\u662f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7684\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [new Function](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function)\n*   [Vue.js 2.0 \u72ec\u7acb\u6784\u5efa\u548c\u8fd0\u884c\u65f6\u6784\u5efa\u7684\u533a\u522b](https://jingsam.github.io/2016/10/23/standalone-vs-runtime-only-build-in-vuejs2.html)", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5b9e\u6218_3\u52a8\u6001\u6e32\u67d3_.vue_\u6587\u4ef6\u7684\u7ec4\u4ef6_Display.md", "create_date": "2020-02-18T21:37:08.852", "order": 9}}, {"model": "subject.chapter", "pk": 105, "fields": {"title": "\u5b9e\u6218 4\uff1a\u5168\u5c40\u63d0\u793a\u7ec4\u4ef6\u2014\u2014$Alert", "topic": 5, "md5": "f4fe517e08e52a118120b73c6a1cf449", "md_body": "# \u5b9e\u6218 4\uff1a\u5168\u5c40\u63d0\u793a\u7ec4\u4ef6\u2014\u2014$Alert\n\n\u6709\u4e00\u79cd Vue.js \u7ec4\u4ef6\uff0c\u5b83\u4e0d\u540c\u4e8e\u5e38\u89c4\u7684\u7ec4\u4ef6\uff0c\u4f46\u7ec4\u4ef6\u7ed3\u6784\u672c\u8eab\u5f88\u7b80\u5355\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u5168\u5c40\u63d0\u793a\u7ec4\u4ef6\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/10/166fcc05107e987c?w=3187&h=2087&f=png&s=265274)\n\n\u5b9e\u73b0\u8fd9\u6837\u4e00\u4e2a\u7ec4\u4ef6\u5e76\u4e0d\u96be\uff0c\u53ea\u9700\u8981\u7b80\u5355\u7684\u51e0\u884c div \u548c css\uff0c\u4f46\u4f7f\u7528\u8005\u53ef\u80fd\u8981\u8fd9\u6837\u6765\u663e\u793a\u7ec4\u4ef6\uff1a\n\n```\n<template>\n  <div>\n    <Alert v-if=\"show\">\u8fd9\u662f\u4e00\u6761\u63d0\u793a\u4fe1\u606f</Alert>\n    <button @click=\"show = true\">\u663e\u793a</button>\n  </div>\n</template>\n<script>\n  import Alert from '../component/alert.vue';\n\n  export default {\n    components: { Alert },\n    data () {\n      return {\n        show: false\n      }\n    }\n  }\n</script>\n\n```\n\n\u8fd9\u6837\u7684\u7528\u6cd5\uff0c\u6709\u4ee5\u4e0b\u7f3a\u70b9\uff1a\n\n*   \u6bcf\u4e2a\u4f7f\u7528\u7684\u5730\u65b9\uff0c\u90fd\u5f97\u6ce8\u518c\u7ec4\u4ef6\uff1b\n*   \u9700\u8981\u9884\u5148\u5c06 `<Alert>` \u653e\u7f6e\u5728\u6a21\u677f\u4e2d\uff1b\n*   \u9700\u8981\u989d\u5916\u7684 data \u6765\u63a7\u5236 Alert \u7684\u663e\u793a\u72b6\u6001\uff1b\n*   Alert \u7684\u4f4d\u7f6e\uff0c\u662f\u5728\u5f53\u524d\u7ec4\u4ef6\u4f4d\u7f6e\uff0c\u5e76\u975e\u5728 body \u4e0b\uff0c\u6709\u53ef\u80fd\u4f1a\u88ab\u5176\u5b83\u7ec4\u4ef6\u906e\u6321\u3002\n\n\u603b\u4e4b\u5bf9\u4f7f\u7528\u8005\u6765\u8bf4\u662f\u5f88\u4e0d\u53cb\u597d\u7684\uff0c\u90a3\u600e\u6837\u624d\u80fd\u4f18\u96c5\u5730\u5b9e\u73b0\u8fd9\u6837\u4e00\u4e2a\u7ec4\u4ef6\u5462\uff1f\u4e8b\u5b9e\u4e0a\uff0c\u539f\u751f\u7684 JavaScript \u65e9\u5df2\u7ed9\u51fa\u4e86\u7b54\u6848\uff1a\n\n```\n// \u5168\u5c40\u63d0\u793a\nwindow.alert('\u8fd9\u662f\u4e00\u6761\u63d0\u793a\u4fe1\u606f');\n// \u4e8c\u6b21\u786e\u8ba4\nconst confirm = window.confirm('\u786e\u8ba4\u5220\u9664\u5417\uff1f');\nif (confirm) {\n  // ok\n} else {\n  // cancel\n}\n\n```\n\n\u6240\u4ee5\uff0c\u7ed3\u8bba\u662f\uff1a\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u80fd\u7528 JavaScript \u8c03\u7528\u7ec4\u4ef6\u7684 API\u3002\n\n\u5982\u679c\u4f60\u4f7f\u7528\u8fc7 iView \u4e4b\u7c7b\u7684\u7ec4\u4ef6\u5e93\uff0c\u4e00\u5b9a\u5bf9\u5b83\u5185\u7f6e\u7684 $Message\u3001$Notice\u3001$Modal \u7b49\u7ec4\u4ef6\u5f88\u719f\u6089\uff0c\u672c\u8282\u5c31\u6765\u5f00\u53d1\u4e00\u4e2a\u5168\u5c40\u901a\u77e5\u7ec4\u4ef6\u2014\u2014$Alert\u3002\n\n## 1/3 \u5148\u628a\u7ec4\u4ef6\u5199\u597d\n\n\u6211\u4eec\u671f\u671b\u6700\u7ec8\u7684 API \u662f\u8fd9\u6837\u7684\uff1a\n\n```\nmethods: {\n  handleShow () {\n    this.$Alert({\n      content: '\u8fd9\u662f\u4e00\u6761\u63d0\u793a\u4fe1\u606f',\n      duration: 3\n    })\n  }\n}\n\n```\n\n`this.$Alert` \u53ef\u4ee5\u5728\u4efb\u4f55\u4f4d\u7f6e\u8c03\u7528\uff0c\u65e0\u9700\u5355\u72ec\u5f15\u5165\u3002\u8be5\u65b9\u6cd5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff1a\n\n*   content\uff1a\u63d0\u793a\u5185\u5bb9\uff1b\n*   duration\uff1a\u6301\u7eed\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\uff0c\u9ed8\u8ba4 1.5 \u79d2\uff0c\u5230\u65f6\u95f4\u81ea\u52a8\u6d88\u5931\u3002\n\n\u6700\u7ec8\u6548\u679c\u5982\u4e0b\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/10/166fcc09c43c2ad1?w=1208&h=314&f=gif&s=207241)\n\n\u6211\u4eec\u4ece\u6700\u7b80\u5355\u7684\u5165\u624b\uff0c\u4e0d\u8003\u8651\u5176\u5b83\uff0c\u5148\u5199\u4e00\u4e2a\u57fa\u672c\u7684 Alert \u7ec4\u4ef6\u3002\n\n\u5728 `src/component` \u4e0b\u65b0\u5efa `alert` \u76ee\u5f55\uff0c\u5e76\u521b\u5efa\u6587\u4ef6 `alert.vue`\uff1a\n\n\u901a\u77e5\u53ef\u4ee5\u662f\u591a\u4e2a\uff0c\u6211\u4eec\u7528\u4e00\u4e2a\u6570\u7ec4 `notices` \u6765\u7ba1\u7406\u6bcf\u6761\u901a\u77e5\uff1a\n\n```\n<!-- alert.vue -->\n<template>\n  <div class=\"alert\">\n    <div class=\"alert-main\" v-for=\"item in notices\" :key=\"item.name\">\n      <div class=\"alert-content\">{{ item.content }}</div>\n    </div>\n  </div>\n</template>\n<script>\n  export default {\n    data () {\n      return {\n        notices: []\n      }\n    }\n  }\n</script>\n<style>\n  .alert{\n    position: fixed;\n    width: 100%;\n    top: 16px;\n    left: 0;\n    text-align: center;\n    pointer-events: none;\n  }\n  .alert-content{\n    display: inline-block;\n    padding: 8px 16px;\n    background: #fff;\n    border-radius: 3px;\n    box-shadow: 0 1px 6px rgba(0, 0, 0, .2);\n    margin-bottom: 8px;\n  }\n</style>\n\n```\n\nAlert \u7ec4\u4ef6\u4e0d\u540c\u4e8e\u5e38\u89c4\u7684\u7ec4\u4ef6\u4f7f\u7528\u65b9\u5f0f\uff0c\u5b83\u6700\u7ec8\u662f\u901a\u8fc7 JS \u6765\u8c03\u7528\u7684\uff0c\u56e0\u6b64\u7ec4\u4ef6\u4e0d\u7528\u9884\u7559 props \u548c events \u63a5\u53e3\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u53ea\u8981\u7ed9\u6570\u7ec4 `notices` \u589e\u52a0\u6570\u636e\uff0c\u8fd9\u4e2a\u63d0\u793a\u7ec4\u4ef6\u5c31\u80fd\u663e\u793a\u5185\u5bb9\u4e86\uff0c\u6211\u4eec\u5148\u5047\u8bbe\uff0c\u6700\u7ec8\u4f1a\u901a\u8fc7 JS \u8c03\u7528 Alert \u7684\u4e00\u4e2a\u65b9\u6cd5 `add`\uff0c\u5e76\u5c06 `content` \u548c `duration` \u4f20\u5165\u8fdb\u6765\uff1a\n\n```\n<!-- alert.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<script>\n  let seed = 0;\n\n  function getUuid() {\n    return 'alert_' + (seed++);\n  }\n\n  export default {\n    data () {\n      return {\n        notices: []\n      }\n    },\n    methods: {\n      add (notice) {\n        const name = getUuid();\n\n        let _notice = Object.assign({\n          name: name\n        }, notice);\n\n        this.notices.push(_notice);\n\n        // \u5b9a\u65f6\u79fb\u9664\uff0c\u5355\u4f4d\uff1a\u79d2\n        const duration = notice.duration;\n        setTimeout(() => {\n          this.remove(name);\n        }, duration * 1000);\n      },\n      remove (name) {\n        const notices = this.notices;\n\n        for (let i = 0; i < notices.length; i++) {\n          if (notices[i].name === name) {\n            this.notices.splice(i, 1);\n            break;\n          }\n        }\n      }\n    }\n  }\n</script>\n\n```\n\n\u5728 `add` \u65b9\u6cd5\u4e2d\uff0c\u7ed9\u6bcf\u4e00\u6761\u4f20\u8fdb\u6765\u7684\u63d0\u793a\u6570\u636e\uff0c\u52a0\u4e86\u4e00\u4e2a\u4e0d\u91cd\u590d\u7684 `name` \u5b57\u6bb5\u6765\u6807\u8bc6\uff0c\u5e76\u901a\u8fc7 `setTimeout` \u521b\u5efa\u4e86\u4e00\u4e2a\u8ba1\u65f6\u5668\uff0c\u5f53\u5230\u8fbe\u6307\u5b9a\u7684 `duration` \u6301\u7eed\u65f6\u95f4\u540e\uff0c\u8c03\u7528 `remove` \u65b9\u6cd5\uff0c\u5c06\u5bf9\u5e94 `name` \u7684\u90a3\u6761\u63d0\u793a\u4fe1\u606f\u627e\u5230\uff0c\u5e76\u4ece\u6570\u7ec4\u4e2d\u79fb\u9664\u3002\n\n\u7531\u8fd9\u4e2a\u601d\u8def\uff0cAlert \u7ec4\u4ef6\u5c31\u53ef\u4ee5\u65e0\u9650\u6269\u5c55\uff0c\u53ea\u8981\u5728 add \u65b9\u6cd5\u4e2d\u4f20\u9012\u66f4\u591a\u7684\u53c2\u6570\uff0c\u5c31\u80fd\u652f\u6301\u66f4\u590d\u6742\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982\u662f\u5426\u663e\u793a\u624b\u52a8\u5173\u95ed\u6309\u94ae\u3001\u786e\u5b9a / \u53d6\u6d88\u6309\u94ae\uff0c\u751a\u81f3\u4f20\u5165\u4e00\u4e2a Render \u51fd\u6570\u90fd\u53ef\u4ee5\uff0c\u5b8c\u6210\u672c\u4f8b\u540e\uff0c\u8bfb\u8005\u53ef\u4ee5\u5c1d\u8bd5\u201d\u6539\u9020\u201c\u3002\n\n## 2/3 \u5b9e\u4f8b\u5316\u5c01\u88c5\n\n\u8fd9\u4e00\u6b65\uff0c\u6211\u4eec\u5bf9 Alert \u7ec4\u4ef6\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u8ba9\u5b83\u80fd\u591f\u5b9e\u4f8b\u5316\uff0c\u800c\u4e0d\u662f\u5e38\u89c4\u7684\u7ec4\u4ef6\u4f7f\u7528\u65b9\u6cd5\u3002\u5b9e\u4f8b\u5316\u7ec4\u4ef6\u6211\u4eec\u5728\u7b2c 8 \u8282\u4e2d\u4ecb\u7ecd\u8fc7\uff0c\u53ef\u4ee5\u4f7f\u7528 Vue.extend \u6216 new Vue\uff0c\u7136\u540e\u7528 $mount \u6302\u8f7d\u5230 body \u8282\u70b9\u4e0b\u3002\n\n\u5728 `src/components/alert` \u76ee\u5f55\u4e0b\u65b0\u5efa `notification.js` \u6587\u4ef6\uff1a\n\n```\n// notification.js\nimport Alert from './alert.vue';\nimport Vue from 'vue';\n\nAlert.newInstance = properties => {\n  const props = properties || {};\n\n  const Instance = new Vue({\n    data: props,\n    render (h) {\n      return h(Alert, {\n        props: props\n      });\n    }\n  });\n\n  const component = Instance.$mount();\n  document.body.appendChild(component.$el);\n\n  const alert = Instance.$children[0];\n\n  return {\n    add (noticeProps) {\n      alert.add(noticeProps);\n    },\n    remove (name) {\n      alert.remove(name);\n    }\n  }\n};\n\nexport default Alert;\n\n```\n\nnotification.js \u5e76\u4e0d\u662f\u6700\u7ec8\u7684\u6587\u4ef6\uff0c\u5b83\u53ea\u662f\u5bf9 alert.vue \u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b9\u6cd5 `newInstance`\u3002\u867d\u7136 alert.vue \u5305\u542b\u4e86 template\u3001script\u3001style \u4e09\u4e2a\u6807\u7b7e\uff0c\u5e76\u4e0d\u662f\u4e00\u4e2a JS \u5bf9\u8c61\uff0c\u90a3\u600e\u4e48\u80fd\u591f\u7ed9\u5b83\u6269\u5c55\u4e00\u4e2a\u65b9\u6cd5 `newInstance` \u5462\uff1f\u4e8b\u5b9e\u4e0a\uff0calert.vue \u4f1a\u88ab Webpack \u7684 vue-loader \u7f16\u8bd1\uff0c\u628a template \u7f16\u8bd1\u4e3a Render \u51fd\u6570\uff0c\u6700\u7ec8\u5c31\u4f1a\u6210\u4e3a\u4e00\u4e2a JS \u5bf9\u8c61\uff0c\u81ea\u7136\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c\u6269\u5c55\u3002\n\nAlert \u7ec4\u4ef6\u6ca1\u6709\u4efb\u4f55 props\uff0c\u8fd9\u91cc\u5728 Render Alert \u7ec4\u4ef6\u65f6\uff0c\u8fd8\u662f\u7ed9\u5b83\u52a0\u4e86 props\uff0c\u5f53\u7136\uff0c\u8fd9\u91cc\u7684 props \u662f\u7a7a\u5bf9\u8c61 {}\uff0c\u800c\u4e14\u5373\u4f7f\u4f20\u4e86\u5185\u5bb9\uff0c\u4e5f\u4e0d\u8d77\u4f5c\u7528\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u8fd8\u662f\u4e3a\u4e86\u6269\u5c55\u6027\uff0c\u5982\u679c\u8981\u5728 Alert \u4e0a\u6dfb\u52a0 props \u6765\u652f\u6301\u66f4\u591a\u7279\u6027\uff0c\u662f\u8981\u5728\u8fd9\u91cc\u4f20\u5165\u7684\u3002\u4e0d\u8fc7\u8bdd\u8bf4\u56de\u6765\uff0c\u56e0\u4e3a\u80fd\u62ff\u5230 Alert \u5b9e\u4f8b\uff0c\u7528 data \u6216 props \u90fd\u662f\u53ef\u4ee5\u7684\u3002\n\n\u5728\u7b2c 8 \u8282\u5df2\u7ecf\u89e3\u91ca\u8fc7\uff0c`const alert = Instance.$children[0];`\uff0c\u8fd9\u91cc\u7684 alert \u5c31\u662f Render \u7684 Alert \u7ec4\u4ef6\u5b9e\u4f8b\u3002\u5728 `newInstance` \u91cc\uff0c\u4f7f\u7528\u95ed\u5305\u66b4\u9732\u4e86\u4e24\u4e2a\u65b9\u6cd5 `add` \u548c `remove`\u3002\u8fd9\u91cc\u7684 add \u548c remove \u53ef\u4e0d\u662f alert.vue \u91cc\u7684 add \u548c remove\uff0c\u5b83\u4eec\u53ea\u662f\u540d\u5b57\u4e00\u6837\u3002\n\n## 3/3 \u5165\u53e3\n\n\u6700\u540e\u8981\u505a\u7684\uff0c\u5c31\u662f\u8c03\u7528 notification.js \u521b\u5efa\u5b9e\u4f8b\uff0c\u5e76\u901a\u8fc7 `add` \u628a\u6570\u636e\u4f20\u9012\u8fc7\u53bb\uff0c\u8fd9\u662f\u7ec4\u4ef6\u5f00\u53d1\u7684\u6700\u540e\u4e00\u6b65\uff0c\u4e5f\u662f\u6700\u7ec8\u7684\u5165\u53e3\u3002\u5728 `src/component/alert` \u4e0b\u521b\u5efa\u6587\u4ef6 `alert.js`\uff1a\n\n```\n// alert.js\nimport Notification from './notification.js';\n\nlet messageInstance;\n\nfunction getMessageInstance () {\n  messageInstance = messageInstance || Notification.newInstance();\n  return messageInstance;\n}\n\nfunction notice({ duration = 1.5, content = '' }) {\n  let instance = getMessageInstance();\n\n  instance.add({\n    content: content,\n    duration: duration\n  });\n}\n\nexport default {\n  info (options) {\n    return notice(options);\n  }\n}\n\n```\n\n`getMessageInstance` \u51fd\u6570\u7528\u6765\u83b7\u53d6\u5b9e\u4f8b\uff0c\u5b83\u4e0d\u4f1a\u91cd\u590d\u521b\u5efa\uff0c\u5982\u679c messageInstance \u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u4e86\uff0c\u53ea\u5728\u7b2c\u4e00\u6b21\u8c03\u7528 Notification \u7684 `newInstance` \u65f6\u6765\u521b\u5efa\u5b9e\u4f8b\u3002\n\nalert.js \u5bf9\u5916\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u6cd5 `info`\uff0c\u5982\u679c\u9700\u8981\u5404\u79cd\u663e\u793a\u6548\u679c\uff0c\u6bd4\u5982\u6210\u529f\u7684\u3001\u5931\u8d25\u7684\u3001\u8b66\u544a\u7684\uff0c\u53ef\u4ee5\u5728 info \u4e0b\u9762\u63d0\u4f9b\u66f4\u591a\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982 success\u3001fail\u3001warning \u7b49\uff0c\u5e76\u4f20\u9012\u4e0d\u540c\u53c2\u6570\u8ba9 Alert.vue \u77e5\u9053\u663e\u793a\u54ea\u79cd\u72b6\u6001\u7684\u56fe\u6807\u3002\u672c\u4f8b\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a info\uff0c\u4e8b\u5b9e\u4e0a\u4e5f\u53ef\u4ee5\u7701\u7565\u6389\uff0c\u76f4\u63a5\u5bfc\u51fa\u4e00\u4e2a\u9ed8\u8ba4\u7684\u51fd\u6570\uff0c\u8fd9\u6837\u5728\u8c03\u7528\u65f6\uff0c\u5c31\u4e0d\u7528 `this.$Alert.info()` \u4e86\uff0c\u76f4\u63a5 `this.$Alert()`\u3002\n\n\u6765\u770b\u4e00\u4e0b\u663e\u793a\u4e00\u4e2a\u4fe1\u606f\u63d0\u793a\u7ec4\u4ef6\u7684\u6d41\u7a0b\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/10/166fcc0fe6df06d2?w=1800&h=180&f=png&s=47285)\n\n\u6700\u540e\u628a alert.js \u4f5c\u4e3a\u63d2\u4ef6\u6ce8\u518c\u5230 Vue \u91cc\u5c31\u884c\uff0c\u5728\u5165\u53e3\u6587\u4ef6 `src/main.js`\u4e2d\uff0c\u901a\u8fc7 `prototype` \u7ed9 Vue \u6dfb\u52a0\u4e00\u4e2a\u5b9e\u4f8b\u65b9\u6cd5\uff1a\n\n```\n// src/main.js\nimport Vue from 'vue'\nimport App from './App.vue'\nimport router from './router'\nimport Alert from '../src/components/alert/alert.js'\n\nVue.config.productionTip = false\n\nVue.prototype.$Alert = Alert\n\nnew Vue({\n  router,\n  render: h => h(App)\n}).$mount('#app')\n\n\n```\n\n\u8fd9\u6837\u5728\u9879\u76ee\u4efb\u4f55\u5730\u65b9\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7 `this.$Alert` \u6765\u8c03\u7528 Alert \u7ec4\u4ef6\u4e86\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a alert \u7684\u8def\u7531\uff0c\u5e76\u5728 `src/views` \u4e0b\u521b\u5efa\u9875\u9762 `alert.vue`\uff1a\n\n```\n<!-- src/views/alert.vue -->\n<template>\n  <div>\n    <button @click=\"handleOpen1\">\u6253\u5f00\u63d0\u793a 1</button>\n    <button @click=\"handleOpen2\">\u6253\u5f00\u63d0\u793a 2</button>\n  </div>\n</template>\n<script>\n  export default {\n    methods: {\n      handleOpen1 () {\n        this.$Alert.info({\n          content: '\u6211\u662f\u63d0\u793a\u4fe1\u606f 1'\n        });\n      },\n      handleOpen2 () {\n        this.$Alert.info({\n          content: '\u6211\u662f\u63d0\u793a\u4fe1\u606f 2',\n          duration: 3\n        });\n      }\n    }\n  }\n</script>\n\n```\n\n`duration` \u5982\u679c\u4e0d\u4f20\u5165\uff0c\u9ed8\u8ba4\u662f 1.5 \u79d2\u3002\n\n\u4ee5\u4e0a\u5c31\u662f\u5168\u5c40\u901a\u77e5\u7ec4\u4ef6\u7684\u5168\u90e8\u5185\u5bb9\u3002\n\n## \u53cb\u60c5\u63d0\u793a\n\n\u672c\u793a\u4f8b\u7b97\u662f\u4e00\u4e2a MVP\uff08\u6700\u5c0f\u5316\u53ef\u884c\u65b9\u6848\uff09\uff0c\u8981\u5f00\u53d1\u4e00\u4e2a\u5b8c\u5584\u7684\u5168\u5c40\u901a\u77e5\u7ec4\u4ef6\uff0c\u8fd8\u9700\u8981\u66f4\u591a\u53ef\u7ef4\u62a4\u6027\u548c\u529f\u80fd\u6027\u7684\u8bbe\u8ba1\uff0c\u4f46\u79bb\u4e0d\u5f00\u672c\u4f8b\u7684\u8bbe\u8ba1\u601d\u8def\u3002\u4ee5\u4e0b\u51e0\u70b9\u662f\u540c\u7c7b\u7ec4\u4ef6\u4e2d\u503c\u5f97\u6ce8\u610f\u7684\uff1a\n\n1.  Alert.vue \u7684\u6700\u5916\u5c42\u662f\u6709\u4e00\u4e2a .alert \u8282\u70b9\u7684\uff0c\u5b83\u4f1a\u5728\u7b2c\u4e00\u6b21\u8c03\u7528 `$Alert` \u65f6\uff0c\u5728 body \u4e0b\u521b\u5efa\uff0c\u56e0\u4e3a\u4e0d\u5728 `<router-view>` \u5185\uff0c\u5b83\u4e0d\u53d7\u8def\u7531\u7684\u5f71\u54cd\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u7ecf\u521b\u5efa\uff0c\u9664\u975e\u5237\u65b0\u9875\u9762\uff0c\u8fd9\u4e2a\u8282\u70b9\u662f\u4e0d\u4f1a\u6d88\u5931\u7684\uff0c\u6240\u4ee5\u5728 alert.vue \u7684\u8bbe\u8ba1\u4e2d\uff0c\u5e76\u6ca1\u6709\u4e3b\u52a8\u9500\u6bc1\u8fd9\u4e2a\u7ec4\u4ef6\uff0c\u800c\u662f\u7ef4\u62a4\u4e86\u4e00\u4e2a\u5b50\u8282\u70b9\u6570\u7ec4 `notices`\u3002\n2.  .alert \u8282\u70b9\u662f `position: fixed` \u56fa\u5b9a\u7684\uff0c\u56e0\u6b64\u8981\u5408\u7406\u8bbe\u8ba1\u5b83\u7684 `z-index`\uff0c\u5426\u5219\u53ef\u80fd\u88ab\u5176\u5b83\u8282\u70b9\u906e\u6321\u3002\n3.  notification.js \u548c alert.vue \u662f\u53ef\u4ee5\u590d\u7528\u7684\uff0c\u5982\u679c\u8fd8\u8981\u5f00\u53d1\u5176\u5b83\u540c\u7c7b\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982\u4e8c\u6b21\u786e\u8ba4\u7ec4\u4ef6 `$Confirm`, \u53ea\u9700\u8981\u518d\u5199\u4e00\u4e2a\u5165\u53e3 `confirm.js`\uff0c\u5e76\u5c06 `alert.vue` \u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u5c06 `notices` \u6570\u7ec4\u7684\u5faa\u73af\u4f53\u5199\u4e3a\u4e00\u4e2a\u65b0\u7684\u7ec4\u4ef6\uff0c\u901a\u8fc7\u914d\u7f6e\u6765\u51b3\u5b9a\u662f\u6e32\u67d3 Alert \u8fd8\u662f Confirm\uff0c\u8fd9\u5728\u53ef\u7ef4\u62a4\u6027\u4e0a\u662f\u53cb\u597d\u7684\u3002\n4.  \u5728 notification.js \u7684 new Vue \u65f6\uff0c\u4f7f\u7528\u4e86 Render \u51fd\u6570\u6765\u6e32\u67d3 alert.vue\uff0c\u8fd9\u662f\u56e0\u4e3a\u4f7f\u7528 template \u5728 runtime \u7684 Vue.js \u7248\u672c\u4e0b\u662f\u4f1a\u62a5\u9519\u7684\u3002\n5.  \u672c\u4f8b\u7684 content \u53ea\u80fd\u662f\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u8981\u663e\u793a\u81ea\u5b9a\u4e49\u7684\u5185\u5bb9\uff0c\u9664\u4e86\u7528 `v-html` \u6307\u4ee4\uff0c\u4e5f\u80fd\u7528 Functional Render\uff08\u4e4b\u540e\u7ae0\u8282\u4f1a\u4ecb\u7ecd\uff09\u3002\n\n## \u7ed3\u8bed\n\nVue.js \u7684\u7cbe\u9ad3\u662f\u7ec4\u4ef6\uff0c\u7ec4\u4ef6\u7684\u7cbe\u9ad3\u662f JavaScript\u3002\u5c06 JavaScript \u5f00\u53d1\u4e2d\u7684\u6280\u5de7\u7ed3\u5408 Vue.js \u7ec4\u4ef6\uff0c\u5c31\u80fd\u73a9\u51fa\u4e0d\u4e00\u6837\u7684\u4e1c\u897f\u3002\n\n\u6ce8\uff1a\u672c\u8282\u90e8\u5206\u4ee3\u7801\u53c2\u8003 [iView](https://github.com/iview/iview/tree/2.0/src/components/base/notification)\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5b9e\u6218_4\u5168\u5c40\u63d0\u793a\u7ec4\u4ef6Alert.md", "create_date": "2020-02-18T21:37:08.874", "order": 10}}, {"model": "subject.chapter", "pk": 106, "fields": {"title": "\u5b9e\u6218 5\uff1a\u53ef\u7528 Render \u81ea\u5b9a\u4e49\u5217\u7684\u8868\u683c\u7ec4\u4ef6\u2014\u2014Table", "topic": 5, "md5": "8fc1fea5fb5ef2b914b1c52f34fc6c98", "md_body": "# \u5b9e\u6218 5\uff1a\u53ef\u7528 Render \u81ea\u5b9a\u4e49\u5217\u7684\u8868\u683c\u7ec4\u4ef6\u2014\u2014Table\n\n\u8868\u683c\u7ec4\u4ef6 Table \u662f\u4e2d\u540e\u53f0\u4ea7\u54c1\u4e2d\u6700\u5e38\u7528\u7684\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u7528\u4e8e\u5c55\u793a\u5927\u91cf\u7ed3\u6784\u5316\u7684\u6570\u636e\u3002\u5927\u591a\u6570\u7ec4\u4ef6\u5e93\u90fd\u63d0\u4f9b\u4e86\u8868\u683c\u7ec4\u4ef6\uff0c\u6bd4\u5982 [iView](https://www.iviewui.com/components/table)\uff0c\u529f\u80fd\u4e5f\u662f\u975e\u5e38\u5f3a\u5927\u3002\u6b63\u89c4\u7684\u8868\u683c\uff0c\u662f\u7531 `<table>`\u3001`<thead>`\u3001`<tbody>`\u3001`<tr>`\u3001`<th>`\u3001`<td>` \u8fd9\u4e9b\u6807\u7b7e\u7ec4\u6210\uff0c\u4e00\u822c\u5206\u4e3a\u8868\u5934 **columns** \u548c\u6570\u636e **data**\u3002\u672c\u5c0f\u8282\u5c31\u6765\u5f00\u53d1\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u8868\u683c\u7ec4\u4ef6 Table\uff0c\u5b83\u652f\u6301\u4f7f\u7528 Render \u51fd\u6570\u6765\u81ea\u5b9a\u4e49\u67d0\u4e00\u5217\u3002\n\n## \u5206\u6790\n\n\u5982\u679c\u8868\u683c\u53ea\u662f\u5448\u73b0\u6570\u636e\uff0c\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/15/16716c44a664e7f1?w=1876&h=502&f=png&s=60848)\n\n\u56e0\u4e3a\u7ed3\u6784\u7b80\u5355\uff0c\u6211\u4eec\u751a\u81f3\u4e0d\u9700\u8981\u7ec4\u4ef6\uff0c\u76f4\u63a5\u4f7f\u7528\u6807\u51c6\u7684 table \u7cfb\u5217\u6807\u7b7e\u5c31\u53ef\u4ee5\u3002\u4f46\u6709\u7684\u65f6\u5019\uff0c\u9664\u4e86\u5448\u73b0\u6570\u636e\uff0c\u4e5f\u4f1a\u5e26\u6709\u4e00\u4e9b\u4ea4\u4e92\uff0c\u6bd4\u5982\u6709\u4e00\u5217\u64cd\u4f5c\u680f\uff0c\u53ef\u4ee5\u7f16\u8f91\u6574\u884c\u7684\u6570\u636e\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/15/16716c54fc74a1a5?w=2088&h=456&f=gif&s=520544)\n\n\u5199\u4e00\u4e2a\u4e2a\u7684 table \u7cfb\u5217\u6807\u7b7e\u662f\u5f88\u9ebb\u70e6\u5e76\u4e14\u91cd\u590d\u7684\uff0c\u800c\u7ec4\u4ef6\u7684\u597d\u5904\u5c31\u662f\u7701\u53bb\u8fd9\u4e9b\u57fa\u7840\u7684\u5de5\u4f5c\uff0c\u6211\u4eec\u76f4\u63a5\u7ed9 Table \u7ec4\u4ef6\u4f20\u9012\u5217\u7684\u914d\u7f6e **columns** \u548c\u884c\u6570\u636e **data**\uff0c\u5176\u4f59\u7684\u90fd\u4ea4\u7ed9 Table \u7ec4\u4ef6\u505a\u4e86\u3002\n\n\u5f00\u53d1 Table \u7ec4\u4ef6\u524d\uff0c\u6709\u5fc5\u8981\u5148\u4e86\u89e3\u4e0a\u6587\u8bf4\u5230\u7684\u4e00\u7cfb\u5217 table \u6807\u7b7e\u3002\u4e00\u822c\u7684 table \u7ed3\u6784\u662f\u8fd9\u6837\u7684\uff1a\n\n```\n<table>\n  <thead>\n    <tr>\n      <th>\u59d3\u540d</th>\n      <th>\u5e74\u9f84</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>\u738b\u5c0f\u660e</td>\n      <td>18</td>\n    </tr>\n    <tr>\n      <td>\u5f20\u5c0f\u521a</td>\n      <td>25</td>\n    </tr>\n  </tbody>\n</table>\n\n```\n\n*   table\uff1a\u5b9a\u4e49 HTML \u8868\u683c\uff1b\n*   thead\uff1a\u5b9a\u4e49\u8868\u5934\uff1b\n*   tbody\uff1a\u5b9a\u4e49\u8868\u683c\u4e3b\u4f53\uff1b\n*   tr\uff1a\u5b9a\u4e49\u8868\u683c\u884c\uff1b\n*   th\uff1a\u5b9a\u4e49\u8868\u5934\u5355\u5143\u683c\uff1b\n*   td\uff1a\u5b9a\u4e49\u8868\u683c\u5355\u5143\u3002\n\n\u6807\u51c6\u7684\u8868\u683c\u7cfb\u5217\u6807\u7b7e\uff0c\u8ddf div+css \u5b9e\u73b0\u662f\u6709\u5f88\u5927\u533a\u522b\u7684\uff0c\u6bd4\u5982\u8868\u683c\u5728\u505a\u5355\u5143\u683c\u5408\u5e76\u65f6\uff0c\u6709\u63d0\u4f9b\u539f\u751f\u5c5e\u6027\uff0c\u7528 div \u5c31\u5f88\u9ebb\u70e6\u4e86\uff1b\u518d\u6bd4\u5982\u6e32\u67d3\u539f\u7406\u4e0a\u4e5f\u6709\u4e00\u5b9a\u7684\u533a\u522b\uff0ctable \u4f1a\u5728\u5185\u5bb9\u5168\u90e8\u4e0b\u8f7d\u5b8c\u540e\u52a0\u8f7d\u3002\u8be6\u7ec6\u7684\u4ecb\u7ecd\u53ef\u4ee5\u9605\u8bfb\u6587\u672b\u7684\u6269\u5c55\u9605\u8bfb 1\u3002\n\n\u77e5\u9053\u4e86\u8868\u683c\u7684\u7ed3\u6784\uff0c\u518d\u6765\u5206\u6790\u5982\u4f55\u5b9a\u5236 API\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8868\u683c\u5206\u4e3a\u4e86\u4e24\u90e8\u5206\uff0c\u8868\u5934 thead \u548c\u6570\u636e tbody\uff0c\u90a3 props \u4e5f\u5b9a\u4e49\u4e24\u4e2a\uff1a\n\n*   columns\uff1a\u5217\u914d\u7f6e\uff0c\u683c\u5f0f\u4e3a\u6570\u7ec4\uff0c\u5176\u4e2d\u6bcf\u4e00\u5217 column \u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u7528\u6765\u63cf\u8ff0\u8fd9\u4e00\u5217\u7684\u4fe1\u606f\uff0c\u5b83\u7684\u5177\u4f53\u8bf4\u660e\u5982\u4e0b\uff1a\n    \n    *   title\uff1a\u5217\u5934\u663e\u793a\u6587\u5b57\uff1b\n    *   key\uff1a\u5bf9\u5e94\u5217\u5185\u5bb9\u7684\u5b57\u6bb5\u540d\uff1b\n    *   render\uff1a\u81ea\u5b9a\u4e49\u6e32\u67d3\u5217\uff0c\u4f7f\u7528 Vue \u7684 Render \u51fd\u6570\uff0c\u4e0d\u5b9a\u4e49\u5219\u76f4\u63a5\u663e\u793a\u4e3a\u6587\u672c\u3002\n    \n    \u6bd4\u5982\uff1a\n    \n    ```\n    [\n      {\n        title: '\u59d3\u540d',\n        key: 'name'\n      },\n      {\n        title: '\u5e74\u9f84',\n        key: 'age'\n      }\n    ]\n    \n    ```\n    \n*   data\uff1a\u663e\u793a\u7684\u7ed3\u6784\u5316\u6570\u636e\uff0c\u683c\u5f0f\u4e3a\u6570\u7ec4\uff0c\u5176\u4e2d\u6bcf\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5c31\u662f\u4e00\u884c\u7684\u6570\u636e\uff0c\u6bd4\u5982\uff1a\n    \n    ```\n    [\n      {\n        name: '\u738b\u5c0f\u660e',\n        age: 18\n      },\n      {\n        name: '\u5f20\u5c0f\u521a',\n        age: 25\n      }\n    ]\n    \n    ```\n    \n\ncolumn \u5b9a\u4e49\u7684 `key` \u503c\uff0c\u4e0e data \u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u8fd9\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u6570\u636e\u63a5\u53e3\u5b9a\u4e49\u89c4\u5219\uff0c\u4e5f\u662f Vue.js \u7ec4\u4ef6\u4e2d\uff0c\u7528\u6570\u636e\u9a71\u52a8\u800c\u4e0d\u662f slot \u9a71\u52a8\u7684\u7ecf\u5178\u6848\u4f8b\u3002\n\n\u4e3a\u4ec0\u4e48 Table \u7ec4\u4ef6\u8981\u7528\u6570\u636e\u9a71\u52a8\uff0c\u800c\u4e0d\u662f slot \u9a71\u52a8\u5462\uff1fslot \u5728\u5f88\u591a\u7ec4\u4ef6\u4e2d\u7684\u786e\u5f88\u597d\u7528\uff0c\u4e0d\u8fc7 Table \u7ec4\u4ef6\u5305\u542b\u4e86\u5927\u91cf\u7684\u57fa\u7840\u8868\u683c\u6807\u7b7e\uff0c\u5982\u679c\u90fd\u4ea4\u7ed9\u4f7f\u7528\u8005\u7531 slot \u627f\u8f7d\u7684\u8bdd\uff0c\u5f00\u53d1\u6210\u672c\u4e0d\u4e9a\u4e8e\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a table \u4e86\uff0c\u800c\u6570\u636e\u9a71\u52a8\u5c31\u7b80\u5355\u7684\u591a\uff0c\u6570\u636e\u4e00\u822c\u4ece\u670d\u52a1\u7aef\u83b7\u53d6\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff08\u6216\u7b80\u5355\u5904\u7406\uff09\uff0c\u4f7f\u7528\u8005\u4e3b\u8981\u6765\u5b9a\u4e49\u6bcf\u5217\u7684\u914d\u7f6e **columns** \u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u56e0\u4e3a\u4e0d\u786e\u5b9a\u4f7f\u7528\u8005\u8981\u5bf9\u67d0\u4e00\u5217\u505a\u4ec0\u4e48\u4ea4\u4e92\uff0c\u6240\u4ee5\u4e0d\u80fd\u5728 Table \u5185\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u5217\u3002\u4f7f\u7528 Render \u51fd\u6570\u53ef\u4ee5\u5c06\u590d\u6742\u7684\u81ea\u5b9a\u4e49\u5217\u6a21\u677f\u7684\u5de5\u4f5c\u4ea4\u7ed9\u4f7f\u7528\u8005\u6765\u914d\u7f6e\uff0cTable \u5185\u53ea\u7528\u4e00\u4e2a Functional Render \u505a\u4e2d\u8f6c\u3002\n\n## \u5b8c\u6210\u57fa\u7840\u8868\u683c\n\n\u6211\u4eec\u5148\u6765\u5b8c\u6210\u4e00\u4e2a\u57fa\u7840\u7684\u8868\u683c\u7ec4\u4ef6\uff0c\u4e4b\u540e\u518d\u63a5\u5165 Render \u6765\u914d\u7f6e\u81ea\u5b9a\u4e49\u5217\u3002\n\n\u5728 `src/components` \u76ee\u5f55\u4e0b\u65b0\u5efa `table-render` \u76ee\u5f55\uff0c\u5e76\u521b\u5efa `table.vue` \u6587\u4ef6\uff1a\n\n```\n<!-- src/components/table-render/table.vue -->\n<template>\n  <table>\n    <thead>\n      <tr>\n        <th v-for=\"col in columns\">{{ col.title }}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr v-for=\"row in data\">\n        <td v-for=\"col in columns\">{{ row[col.key] }}</td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n<script>\n  export default {\n    props: {\n      columns: {\n        type: Array,\n        default () {\n          return [];\n        }\n      },\n      data: {\n        type: Array,\n        default () {\n          return [];\n        }\n      }\n    }\n  }\n</script>\n<style>\n  table{\n    width: 100%;\n    border-collapse: collapse;\n    border-spacing: 0;\n    empty-cells: show;\n    border: 1px solid #e9e9e9;\n  }\n  table th{\n    background: #f7f7f7;\n    color: #5c6b77;\n    font-weight: 600;\n    white-space: nowrap;\n  }\n  table td, table th{\n    padding: 8px 16px;\n    border: 1px solid #e9e9e9;\n    text-align: left;\n  }\n</style>\n\n```\n\n> props \u4e2d\u7684 columns \u548c data \u7684\u683c\u5f0f\u90fd\u662f\u6570\u7ec4\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c props \u7684\u7c7b\u578b\u662f**\u5bf9\u8c61**\u6216**\u6570\u7ec4**\uff0c\u5b83\u7684\u9ed8\u8ba4\u503c\u5fc5\u987b\u4ece\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\u83b7\u53d6\u3002\n\ntbody \u5185\u5d4c\u5957\u4f7f\u7528\u4e86\u4e24\u6b21 `v-for`\uff0c\u5916\u5c42\u5faa\u73af\u6570\u636e data\uff0c\u5185\u5c42\u5faa\u73af\u5217 columns\uff0c\u8fd9\u6837\u5c31\u586b\u5145\u4e86\u6bcf\u4e2a\u5355\u5143\u683c\u3002\n\n\u65b0\u5efa\u8def\u7531 `table-render`\uff0c\u5e76\u5728 `src/views/` \u76ee\u5f55\u4e0b\u65b0\u5efa\u9875\u9762 `table-render.vue`\uff1a\n\n```\n<!-- src/views/table-render.vue -->\n<template>\n  <div>\n    <table-render :columns=\"columns\" :data=\"data\"></table-render>\n  </div>\n</template>\n<script>\n  import TableRender from '../components/table-render/table.vue';\n\n  export default {\n    components: { TableRender },\n    data () {\n      return {\n        columns: [\n          {\n            title: '\u59d3\u540d',\n            key: 'name'\n          },\n          {\n            title: '\u5e74\u9f84',\n            key: 'age'\n          },\n          {\n            title: '\u51fa\u751f\u65e5\u671f',\n            key: 'birthday'\n          },\n          {\n            title: '\u5730\u5740',\n            key: 'address'\n          },\n          {\n            title: '\u64cd\u4f5c'\n          }\n        ],\n        data: [\n          {\n            name: '\u738b\u5c0f\u660e',\n            age: 18,\n            birthday: '919526400000',\n            address: '\u5317\u4eac\u5e02\u671d\u9633\u533a\u828d\u836f\u5c45'\n          },\n          {\n            name: '\u5f20\u5c0f\u521a',\n            age: 25,\n            birthday: '696096000000',\n            address: '\u5317\u4eac\u5e02\u6d77\u6dc0\u533a\u897f\u4e8c\u65d7'\n          },\n          {\n            name: '\u674e\u5c0f\u7ea2',\n            age: 30,\n            birthday: '563472000000',\n            address: '\u4e0a\u6d77\u5e02\u6d66\u4e1c\u65b0\u533a\u4e16\u7eaa\u5927\u9053'\n          },\n          {\n            name: '\u5468\u5c0f\u4f1f',\n            age: 26,\n            birthday: '687024000000',\n            address: '\u6df1\u5733\u5e02\u5357\u5c71\u533a\u6df1\u5357\u5927\u9053'\n          }\n        ]\n      }\n    }\n  }\n</script>\n\n```\n\n\u8fd0\u884c\u540e\u7684\u6548\u679c\u5982\u4e0b\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/15/16716c5b99ef76ac?w=1986&h=416&f=png&s=88452)\n\n\u8868\u683c\u5df2\u7ecf\u80fd\u6e32\u67d3\u51fa\u6765\u4e86\uff0c\u4f46\u73b0\u5728\u7684\u5355\u5143\u683c\u53ea\u662f\u5c06 data \u5f53\u4f5c\u7eaf\u6587\u672c\u6765\u663e\u793a\uff0c\u6240\u4ee5\u51fa\u751f\u65e5\u671f\u5217\u663e\u793a\u4e3a\u65f6\u95f4\u6233\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u5bf9\u65e5\u671f\u6709\u65f6\u4f1a\u4fdd\u5b58\u4e3a\u65f6\u95f4\u6233\u683c\u5f0f\u3002\u5982\u679c\u8981\u663e\u793a\u6b63\u5e38\u7684\u65e5\u671f\uff08\u59821991-5-14\uff09\uff0c\u76ee\u524d\u53ef\u4ee5\u53e6\u5199\u4e00\u4e2a\u8ba1\u7b97\u5c5e\u6027\uff08computed\uff09\uff0c\u624b\u52a8\u5c06\u65f6\u95f4\u6233\u6362\u7b97\u4e3a\u6807\u51c6\u65e5\u671f\u683c\u5f0f\u540e\uff0c\u6765\u52a8\u6001\u4fee\u6539 data \u91cc\u7684 `birthday` \u5b57\u6bb5\u3002\u8fd9\u6837\u505a\u5bf9\u4e8e\u51fa\u751f\u65e5\u671f\u8fd9\u6837\u7684\u6570\u636e\u8fd8\u597d\uff0c\u4f46\u5bf9\u4e8e**\u64cd\u4f5c**\u8fd9\u4e00\u5217\u5c31\u4e0d\u53ef\u53d6\u4e86\uff0c\u56e0\u4e3a\u5b83\u5e26\u6709\u4e1a\u52a1\u903b\u8f91\uff0c\u70b9\u51fb**\u7f16\u8f91**\u6309\u94ae\uff0c\u662f\u53ef\u4ee5\u5bf9\u5f53\u524d\u884c\u6570\u636e\u8fdb\u884c\u4fee\u6539\u7684\u3002\u8fd9\u65f6\u5c31\u8981\u7528\u5230 Render \u51fd\u6570\u3002\n\n## \u4f7f\u7528 Render \u81ea\u5b9a\u4e49\u5217\u6a21\u677f\n\n\u4e0a\u4e00\u8282\u6211\u4eec\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u51fd\u6570\u5f0f\u7ec4\u4ef6 Functional Render \u7684\u7528\u6cd5\uff0c\u5b83\u6ca1\u6709\u72b6\u6001\u548c\u4e0a\u4e0b\u6587\uff0c\u4e3b\u8981\u7528\u4e8e\u4e2d\u8f6c\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u7528\u5728\u672c\u8282\u7684 Table \u7ec4\u4ef6\u975e\u5e38\u5408\u9002\u3002\n\n\u5148\u5728 `src/components/table-render` \u76ee\u5f55\u4e0b\u65b0\u5efa `render.js` \u6587\u4ef6\uff1a\n\n```\n// src/components/table-render/render.js\nexport default {\n  functional: true,\n  props: {\n    row: Object,\n    column: Object,\n    index: Number,\n    render: Function\n  },\n  render: (h, ctx) => {\n    const params = {\n      row: ctx.props.row,\n      column: ctx.props.column,\n      index: ctx.props.index\n    };\n\n    return ctx.props.render(h, params);\n  }\n};\n\n```\n\nrender.js \u5b9a\u4e49\u4e86 4 \u4e2a props\uff1a\n\n*   **row**\uff1a\u5f53\u524d\u884c\u7684\u6570\u636e\uff1b\n*   **column**\uff1a\u5f53\u524d\u5217\u7684\u6570\u636e\uff1b\n*   **index**\uff1a\u5f53\u524d\u662f\u7b2c\u51e0\u884c\uff1b\n*   **render**\uff1a\u5177\u4f53\u7684 render \u51fd\u6570\u5185\u5bb9\u3002\n\n\u8fd9\u91cc\u7684 `render` \u9009\u9879\u5e76\u6ca1\u6709\u6e32\u67d3\u4efb\u4f55\u8282\u70b9\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de props \u4e2d\u5b9a\u4e49\u7684 render\uff0c\u5e76\u5c06 h \u548c\u5f53\u524d\u7684\u884c\u3001\u5217\u3001\u5e8f\u53f7\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u51fa\u53bb\u3002\u7136\u540e\u5728 table.vue \u91cc\u5c31\u53ef\u4ee5\u4f7f\u7528 render.js \u7ec4\u4ef6\uff1a\n\n```\n<!-- table.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<template>\n  <table>\n    <thead>\n      <tr>\n        <th v-for=\"col in columns\">{{ col.title }}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr v-for=\"(row, rowIndex) in data\">\n        <td v-for=\"col in columns\">\n          <template v-if=\"'render' in col\">\n            <Render :row=\"row\" :column=\"col\" :index=\"rowIndex\" :render=\"col.render\"></Render>\n          </template>\n          <template v-else>{{ row[col.key] }}</template>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n<script>\n  import Render from './render.js';\n\n  export default {\n    components: { Render },\n    props: {\n      columns: {\n        type: Array,\n        default () {\n          return [];\n        }\n      },\n      data: {\n        type: Array,\n        default () {\n          return [];\n        }\n      }\n    }\n  }\n</script>\n\n```\n\n\u5982\u679c columns \u4e2d\u7684\u67d0\u4e00\u5217\u914d\u7f6e\u4e86 render \u5b57\u6bb5\uff0c\u90a3\u5c31\u901a\u8fc7 render.js \u5b8c\u6210\u81ea\u5b9a\u4e49\u6a21\u677f\uff0c\u5426\u5219\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u6e32\u67d3\u3002\u6bd4\u5982\u5bf9\u51fa\u751f\u65e5\u671f\u8fd9\u5217\u663e\u793a\u4e3a\u6807\u51c6\u7684\u65e5\u671f\u683c\u5f0f\uff0c\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49 column\uff1a\n\n```\n// src/views/table-render.vie\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  data () {\n    return {\n      columns: [\n        // ...\n        {\n          title: '\u51fa\u751f\u65e5\u671f',\n          render: (h, { row, column, index }) => {\n            const date = new Date(parseInt(row.birthday));\n            const year = date.getFullYear();\n            const month = date.getMonth() + 1;\n            const day = date.getDate();\n            \n            const birthday = `${year}-${month}-${day}`;\n            \n            return h('span', birthday);\n          }\n        }\n      ]\n    }\n  }\n}\n\n```\n\n\u6548\u679c\u5982\u4e0b\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/15/16716c604e151fa0?w=1738&h=418&f=png&s=77318)\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0ccolumns \u91cc\u5b9a\u4e49\u7684 render\uff0c\u662f\u6709\u4e24\u4e2a\u53c2\u6570\u7684\uff0c\u7b2c\u4e00\u4e2a\u662f createElement\uff08\u5373 h\uff09\uff0c\u7b2c\u4e8c\u4e2a\u662f\u4ece render.js \u4f20\u8fc7\u6765\u7684\u5bf9\u8c61\uff0c\u5b83\u5305\u542b\u4e86\u5f53\u524d\u884c\u6570\u636e\uff08`row`\uff09\u3001\u5f53\u524d\u5217\u914d\u7f6e\uff08`column`\uff09\u3001\u5f53\u524d\u662f\u7b2c\u51e0\u884c\uff08`index`\uff09\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u57fa\u4e8e\u8fd9 3 \u4e2a\u53c2\u6570\u5f97\u5230\u4efb\u610f\u60f3\u8981\u7684\u7ed3\u679c\u3002\u7531\u4e8e\u662f\u81ea\u5b9a\u4e49\u5217\u4e86\uff0c\u663e\u793a\u4ec0\u4e48\u90fd\u662f\u4f7f\u7528\u8005\u51b3\u5b9a\u7684\uff0c\u56e0\u6b64\u5728\u4f7f\u7528\u4e86 render \u7684 column \u91cc\u53ef\u4ee5\u4e0d\u7528\u5199\u5b57\u6bb5 `key` \u3002\n\n\u5982\u679c\u4f60\u771f\u6b63\u7406\u89e3\u4e86\uff0c\u5e94\u8be5\u77e5\u9053 columns \u91cc\u5b9a\u4e49\u7684 render \u5b57\u6bb5\uff0c\u5b83\u4ec5\u4ec5\u662f\u540d\u5b57\u53eb render \u7684\u4e00\u4e2a\u666e\u901a\u51fd\u6570\uff0c\u5e76\u975e Vue.js \u5b9e\u4f8b\u7684 _render_ \u9009\u9879\uff0c\u53ea\u662f\u6211\u4eec\u6070\u5de7\u628a\u5b83\u53eb\u505a render \u800c\u5df2\uff0c\u5982\u679c\u613f\u610f\uff0c\u4e5f\u53ef\u4ee5\u6539\u4e3a\u5176\u5b83\u540d\u5b57\uff0c\u6bd4\u5982 renderRow\u3002\u771f\u6b63\u7684 Render \u51fd\u6570\u53ea\u6709\u4e00\u4e2a\u5730\u65b9\uff0c\u90a3\u5c31\u662f render.js \u4e2d\u7684 render \u9009\u9879\uff0c\u53ea\u662f\u5b83\u4ee3\u7406\u4e86 column \u4e2d\u7684 render\u3002\u8fd9\u91cc\u6709\u70b9\u7ed5\uff0c\u7406\u6e05\u8fd9\u4e2a\u5173\u7cfb\uff0c\u5c31\u5bf9 Functional Render \u5f7b\u5e95\u7406\u89e3\u4e86\u3002\n\n## \u4fee\u6539\u5f53\u524d\u884c\n\n\u6709\u4e86 render\uff0cTable \u7ec4\u4ef6\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u5269\u4f59\u5de5\u4f5c\u90fd\u662f\u4f7f\u7528\u8005\u6765\u914d\u7f6e columns \u5b8c\u6210\u5404\u79cd\u590d\u6742\u7684\u4e1a\u52a1\u903b\u8f91\u3002\u672c\u4f8b\u6765\u4ecb\u7ecd\u6700\u5e38\u89c1\u7684\u8868\u683c\u4e2d\u5bf9\u6574\u884c\u6570\u636e\u7f16\u8f91\u7684\u529f\u80fd\u3002\n\n**\u64cd\u4f5c**\u8fd9\u4e00\u5217\uff0c\u9ed8\u8ba4\u662f\u4e00\u4e2a**\u4fee\u6539**\u6309\u94ae\uff0c\u70b9\u51fb\u540e\uff0c\u53d8\u4e3a**\u4fdd\u5b58**\u548c**\u53d6\u6d88**\u4e24\u4e2a\u6309\u94ae\uff0c\u540c\u65f6\u672c\u884c\u5176\u5b83\u5404\u5217\u90fd\u53d8\u4e3a\u4e86\u8f93\u5165\u6846\uff0c\u5e76\u4e14\u521d\u59cb\u503c\u5c31\u662f\u521a\u624d\u5355\u5143\u683c\u7684\u6570\u636e\u3002\u53d8\u4e3a\u8f93\u5165\u6846\u540e\uff0c\u53ef\u4ee5\u4efb\u610f\u4fee\u6539\u5355\u5143\u683c\u6570\u636e\uff0c\u70b9\u51fb\u4fdd\u5b58\u6309\u94ae\u4fdd\u5b58\u6574\u884c\u6570\u636e\uff0c\u70b9\u51fb\u53d6\u6d88\u6309\u94ae\uff0c\u8fd8\u539f\u81f3\u4fee\u6539\u524d\u7684\u6570\u636e\u3002\n\n\u5f53\u8fdb\u5165\u7f16\u8f91\u72b6\u6001\u65f6\uff0c\u6bcf\u4e00\u5217\u7684\u8f93\u5165\u6846\u90fd\u8981\u6709\u4e00\u4e2a\u4e34\u65f6\u7684\u6570\u636e\u4f7f\u7528 `v-model` \u53cc\u5411\u7ed1\u5b9a\u6765\u54cd\u5e94\u4fee\u6539\uff0c\u6240\u4ee5\u5728 data \u91cc\u518d\u58f0\u660e\u56db\u4e2a\u6570\u636e\uff1a\n\n```\n// table-render.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\n{\n  data () {\n    return {\n      // ...\n      editName: '',  // \u7b2c\u4e00\u5217\u8f93\u5165\u6846\n      editAge: '',  // \u7b2c\u4e8c\u5217\u8f93\u5165\u6846\n      editBirthday: '',  // \u7b2c\u4e09\u5217\u8f93\u5165\u6846\n      editAddress: '',  // \u7b2c\u56db\u5217\u8f93\u5165\u6846\n    }\n  }\n}\n\n```\n\n\u540c\u65f6\u8fd8\u8981\u77e5\u9053\u662f\u5728\u4fee\u6539\u7b2c\u51e0\u884c\u7684\u6570\u636e\uff0c\u6240\u4ee5\u518d\u52a0\u4e00\u4e2a\u6570\u636e\u6807\u8bc6\u5f53\u524d\u6b63\u5728\u4fee\u6539\u7684\u884c\u5e8f\u53f7\uff08\u4ece 0 \u5f00\u59cb\uff09\uff1a\n\n```\n// table-render.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\n{\n  data () {\n    return {\n      // ...\n      editIndex: -1,  // \u5f53\u524d\u805a\u7126\u7684\u8f93\u5165\u6846\u7684\u884c\u6570\n    }\n  }\n}\n\n```\n\n`editIndex` \u9ed8\u8ba4\u7ed9\u4e86 -1\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u884c\u53f7\uff0c\u5f53\u70b9\u51fb\u4fee\u6539\u6309\u94ae\u65f6\uff0c\u518d\u5c06\u5b83\u7f6e\u4e3a\u6b63\u786e\u7684\u884c\u53f7\u3002\u6211\u4eec\u5148\u5b9a\u4e49\u64cd\u4f5c\u5217\u7684 render\uff1a\n\n```\n// table-render.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\n{\n  data () {\n    columns: [\n      // ...\n      {\n        title: '\u64cd\u4f5c',\n        render: (h, { row, index }) => {\n          // \u5982\u679c\u5f53\u524d\u884c\u662f\u7f16\u8f91\u72b6\u6001\uff0c\u5219\u6e32\u67d3\u4e24\u4e2a\u6309\u94ae\n          if (this.editIndex === index) {\n            return [\n              h('button', {\n                on: {\n                  click: () => {\n                    this.data[index].name = this.editName;\n                    this.data[index].age = this.editAge;\n                    this.data[index].birthday = this.editBirthday;\n                    this.data[index].address = this.editAddress;\n                    this.editIndex = -1;\n                  }\n                }\n              }, '\u4fdd\u5b58'),\n              h('button', {\n                style: {\n                  marginLeft: '6px'\n                },\n                on: {\n                  click: () => {\n                    this.editIndex = -1;\n                  }\n                }\n              }, '\u53d6\u6d88')\n            ];\n          } else {  // \u5f53\u524d\u884c\u662f\u9ed8\u8ba4\u72b6\u6001\uff0c\u6e32\u67d3\u4e3a\u4e00\u4e2a\u6309\u94ae\n            return h('button', {\n              on: {\n                click: () => {\n                  this.editName = row.name;\n                  this.editAge = row.age;\n                  this.editAddress = row.address;\n                  this.editBirthday = row.birthday;\n                  this.editIndex = index;\n                }\n              }\n            }, '\u4fee\u6539');\n          }\n        }\n      }\n    ]\n  }\n}\n\n```\n\nrender \u91cc\u7684 `if / else` \u53ef\u4ee5\u5148\u770b else\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u662f\u975e\u7f16\u8f91\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u8bf4 `editIndex` \u8fd8\u662f -1\u3002\u5f53\u70b9\u51fb**\u4fee\u6539**\u6309\u94ae\u65f6\uff0c\u628a render \u4e2d\u7b2c\u4e8c\u4e2a\u53c2\u6570 `{ row }` \u4e2d\u7684\u5404\u5217\u6570\u636e\u8d4b\u503c\u7ed9\u4e86\u4e4b\u524d\u5728 data \u4e2d\u58f0\u660e\u7684 4 \u4e2a\u6570\u636e\uff0c\u8fd9\u6837\u505a\u662f\u56e0\u4e3a\u4e4b\u540e\u70b9\u51fb**\u53d6\u6d88**\u6309\u94ae\u65f6\uff0ceditName \u7b49\u503c\u5df2\u7ecf\u4fee\u6539\u4e86\uff0c\u8fd8\u6ca1\u6709\u8fd8\u539f\uff0c\u6240\u4ee5\u5728\u5f00\u542f\u7f16\u8f91\u72b6\u6001\u7684\u540c\u65f6\uff0c\u521d\u59cb\u5316\u5404\u8f93\u5165\u6846\u7684\u503c\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u53d6\u6d88\u65f6\u91cd\u7f6e\uff09\u3002\u6700\u540e\u518d\u628a `editIndex` \u7f6e\u4e3a\u4e86\u5bf9\u5e94\u7684\u884c\u5e8f\u53f7 `{ index }`\uff0c\u6b64\u65f6 render \u7684 `if` \u6761\u4ef6 `this.editIndex === index` \u4e3a\u771f\uff0c\u7f16\u8f91\u5217\u53d8\u6210\u4e86\u4e24\u4e2a\u6309\u94ae\uff1a\u4fdd\u5b58\u548c\u53d6\u6d88\u3002\u70b9\u51fb\u4fdd\u5b58\uff0c\u76f4\u63a5\u4fee\u6539\u8868\u683c\u6e90\u6570\u636e data \u4e2d\u5bf9\u5e94\u7684\u5404\u5b57\u6bb5\u503c\uff0c\u5e76\u5c06 editIndex \u7f6e\u4e3a -1\uff0c\u9000\u51fa\u7f16\u8f91\u72b6\u6001\uff1b\u70b9\u51fb\u53d6\u6d88\uff0c\u4e0d\u4fdd\u5b58\u6e90\u6570\u636e\uff0c\u76f4\u63a5\u9000\u51fa\u7f16\u8f91\u72b6\u6001\u3002\n\n\u9664\u7f16\u8f91\u5217\uff0c\u5176\u5b83\u5404\u6570\u636e\u5217\u90fd\u6709\u4e24\u79cd\u72b6\u6001\uff1a\n\n1.  \u5f53 editIndex \u7b49\u4e8e\u5f53\u524d\u884c\u53f7 index \u65f6\uff0c\u5448\u73b0\u8f93\u5165\u6846\u72b6\u6001\uff1b\n2.  \u5f53 editIndex \u4e0d\u7b49\u4e8e\u5f53\u524d\u884c\u53f7 index \u65f6\uff0c\u5448\u73b0\u9ed8\u8ba4\u6570\u636e\u3002\n\n\u4ee5\u59d3\u540d\u4e3a\u4f8b\uff1a\n\n```\n// table-render.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\n{\n  data () {\n    columns: [\n      // ...\n      {\n        title: '\u59d3\u540d',\n        key: 'name',\n        render: (h, { row, index }) => {\n          let edit;\n\n          // \u5f53\u524d\u884c\u4e3a\u805a\u7126\u884c\u65f6\n          if (this.editIndex === index) {\n            edit = [h('input', {\n              domProps: {\n                value: row.name\n              },\n              on: {\n                input: (event) => {\n                  this.editName = event.target.value;\n                }\n              }\n            })];\n          } else {\n            edit = row.name;\n          }\n\n          return h('div', [\n            edit\n          ]);\n        }\n      }\n    ]\n  }\n}\n\n```\n\n\u53d8\u91cf `edit` \u6839\u636e editIndex \u5448\u73b0\u4e0d\u540c\u7684\u8282\u70b9\uff0c\u8fd8\u662f\u5148\u770b else\uff0c\u76f4\u63a5\u663e\u793a\u4e86\u5bf9\u5e94\u5b57\u6bb5\u7684\u6570\u636e\u3002\u5728\u805a\u7126\u65f6\uff08this.editIndex === index\uff09\uff0c\u6e32\u67d3\u4e00\u4e2a `input` \u8f93\u5165\u6846\uff0c\u521d\u59cb\u503c `value` \u901a\u8fc7 render \u7684 `domProps` \u7ed1\u5b9a\u4e86 `row.name`\uff08\u8fd9\u91cc\u4e5f\u53ef\u7ed1\u5b9a editName\uff09\uff0c\u5e76\u76d1\u542c\u4e86 input \u4e8b\u4ef6\uff0c\u5c06\u8f93\u5165\u7684\u5185\u5bb9\uff0c\u5b9e\u65f6\u7f13\u5b58\u5728\u6570\u636e `editName` \u4e2d\uff0c\u4f9b\u4fdd\u5b58\u65f6\u4f7f\u7528\u3002\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u91cc\u7ed1\u5b9a\u7684 value \u548c\u4e8b\u4ef6 input \u5c31\u662f\u8bed\u6cd5\u7cd6 `v-model` \u5728 Render \u51fd\u6570\u4e2d\u7684\u5199\u6cd5\uff0c\u5728 template \u4e2d\uff0c\u7ecf\u5e38\u5199\u4f5c `<input v-model=\"editName\">`\u3002\n\n\u5176\u5b83\u5217\u4e0e\u59d3\u540d\u7c7b\u4f3c\uff0c\u53ea\u662f\u5bf9\u4e8e\u7684\u5b57\u6bb5\u4e0d\u540c\uff1a\n\n```\n// table-render.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\n{\n  data () {\n    return {\n      columns: [\n        // ...\n        {\n          title: '\u5e74\u9f84',\n          key: 'age',\n          render: (h, { row, index }) => {\n            let edit;\n\n            // \u5f53\u524d\u884c\u4e3a\u805a\u7126\u884c\u65f6\n            if (this.editIndex === index) {\n              edit = [h('input', {\n                domProps: {\n                  value: row.age\n                },\n                on: {\n                  input: (event) => {\n                    this.editAge = event.target.value;\n                  }\n                }\n              })];\n            } else {\n              edit = row.age;\n            }\n\n            return h('div', [\n              edit\n            ]);\n          }\n        },\n        {\n          title: '\u51fa\u751f\u65e5\u671f',\n          render: (h, { row, index }) => {\n            let edit;\n\n            // \u5f53\u524d\u884c\u4e3a\u805a\u7126\u884c\u65f6\n            if (this.editIndex === index) {\n              edit = [h('input', {\n                domProps: {\n                  value: row.birthday\n                },\n                on: {\n                  input: (event) => {\n                    this.editBirthday = event.target.value;\n                  }\n                }\n              })];\n            } else {\n              const date = new Date(parseInt(row.birthday));\n              const year = date.getFullYear();\n              const month = date.getMonth() + 1;\n              const day = date.getDate();\n\n              edit = `${year}-${month}-${day}`;\n            }\n\n            return h('div', [\n              edit\n            ]);\n          }\n        },\n        {\n          title: '\u5730\u5740',\n          key: 'address',\n          render: (h, { row, index }) => {\n            let edit;\n\n            // \u5f53\u524d\u884c\u4e3a\u805a\u7126\u884c\u65f6\n            if (this.editIndex === index) {\n              edit = [h('input', {\n                domProps: {\n                  value: row.address\n                },\n                on: {\n                  input: (event) => {\n                    this.editAddress = event.target.value;\n                  }\n                }\n              })];\n            } else {\n              edit = row.address;\n            }\n\n            return h('div', [\n              edit\n            ]);\n          }\n        },\n      ]\n    }\n  }\n}\n\n```\n\n> \u5b8c\u6574\u7684\u4ee3\u7801\u89c1\uff1a[https://github.com/icarusion/vue-component-book/blob/master/src/views/table-render.vue](https://github.com/icarusion/vue-component-book/blob/master/src/views/table-render.vue)\n\n\u8fd9\u6837\uff0c\u53ef\u7f16\u8f91\u884c\u7684\u8868\u683c\u793a\u4f8b\u5c31\u5b8c\u6210\u4e86\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/15/16716c54fc74a1a5?w=2088&h=456&f=gif&s=520544)\n\n## \u7ed3\u8bed\n\n\u672c\u793a\u4f8b\u7684 Table \u7ec4\u4ef6\uff0c\u53ea\u5c55\u73b0\u4e86\u8868\u683c\u6700\u6838\u5fc3\u7684\u529f\u80fd\u2014\u2014\u81ea\u5b9a\u4e49\u5217\u6a21\u677f\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684 Table \u7ec4\u4ef6\u529f\u80fd\u8981\u590d\u6742\u7684\u591a\uff0c\u6bd4\u5982\u6392\u5e8f\u3001\u7b5b\u9009\u3001\u5217\u56fa\u5b9a\u3001\u8868\u5934\u56fa\u5b9a\u3001\u8868\u5934\u5d4c\u5957\u7b49\u3002\u4e07\u4e8b\u5f00\u5934\u96be\uff0c\u6253\u597d\u4e86 Table \u7684\u5730\u57fa\uff0c\u540e\u9762\u7684\u529f\u80fd\u53ef\u4ee5\u6301\u7eed\u5f00\u53d1\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u5f88\u591a Vue.js \u7684\u5f00\u53d1\u96be\u9898\uff0c\u90fd\u53ef\u4ee5\u7528 Render \u51fd\u6570\u6765\u89e3\u51b3\uff0c\u5b83\u6bd4 template \u6a21\u677f\u66f4\u7075\u6d3b\uff0c\u53ef\u4ee5\u5b8c\u5168\u53d1\u6325 JavaScript \u7684\u7f16\u7a0b\u80fd\u529b\uff0c\u56e0\u6b64\u5f88\u591a JS \u7684\u5f00\u53d1\u601d\u60f3\u90fd\u53ef\u4ee5\u501f\u9274\u3002\u5982\u679c\u4f60\u4e60\u60ef JSX\uff0c\u90a3\u5b8c\u5168\u53ef\u4ee5\u629b\u5f03\u4f20\u7edf\u7684 template \u5199\u6cd5\u3002\n\nRender \u51fd\u6570\u867d\u597d\uff0c\u4f46\u4e5f\u662f\u6709\u5f0a\u7aef\u7684\uff0c\u901a\u8fc7\u4e0a\u9762\u7684\u793a\u4f8b\u53ef\u4ee5\u53d1\u73b0\uff0c\u5199\u51fa\u6765\u7684 VNode \u5bf9\u8c61\u662f\u5f88\u96be\u8bfb\u7684\uff0c\u7ef4\u62a4\u6027\u4e5f\u6bd4 template \u5dee\u3002\u4e0b\u4e00\u8282\uff0c\u6211\u4eec\u5c06\u6539\u5199 Table \u7ec4\u4ef6\uff0c\u7528\u53e6\u4e00\u79cd\u601d\u60f3\u6765\u5b9e\u73b0\u540c\u6837\u7684\u529f\u80fd\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [Div \u548c Table \u7684\u533a\u522b](https://www.cnblogs.com/lovebear/archive/2012/04/18/2456081.html)", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5b9e\u6218_5\u53ef\u7528_Render_\u81ea\u5b9a\u4e49\u5217\u7684\u8868\u683c\u7ec4\u4ef6Table.md", "create_date": "2020-02-18T21:37:08.894", "order": 12}}, {"model": "subject.chapter", "pk": 107, "fields": {"title": "\u5b9e\u6218 6\uff1a\u53ef\u7528 slot-scope \u81ea\u5b9a\u4e49\u5217\u7684\u8868\u683c\u7ec4\u4ef6\u2014\u2014Table", "topic": 5, "md5": "5b3e21b1a86b892286f5aa36776201c4", "md_body": "# \u5b9e\u6218 6\uff1a\u53ef\u7528 slot-scope \u81ea\u5b9a\u4e49\u5217\u7684\u8868\u683c\u7ec4\u4ef6\u2014\u2014Table\n\n\u4e0a\u4e00\u8282\uff0c\u6211\u4eec\u57fa\u4e8e Render \u51fd\u6570\u5b9e\u73b0\u4e86\u5728\u8868\u683c\u4e2d\u81ea\u5b9a\u4e49\u5217\u6a21\u677f\u7684\u7ec4\u4ef6 Table\uff0c\u867d\u8bf4 Render \u51fd\u6570\u80fd\u591f\u5b8c\u5168\u53d1\u6325 JavaScript \u7684\u7f16\u7a0b\u80fd\u529b\uff0c\u5b9e\u73b0\u51e0\u4e4e\u6240\u6709\u7684\u81ea\u5b9a\u4e49\u5de5\u4f5c\uff0c\u4f46\u672c\u8d28\u4e0a\uff0c\u4f7f\u7528\u8005\u5199\u7684\u662f\u4e00\u4e2a\u5e9e\u5927\u7684 JS \u5bf9\u8c61\uff0c\u5b83\u4e0d\u5177\u5907 DOM \u7ed3\u6784\uff0c\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u90fd\u6bd4\u8f83\u5dee\u3002\u5bf9\u4e8e\u5927\u90e8\u5206\u5199 Vue.js \u7684\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u66f4\u503e\u5411\u4e8e\u4f7f\u7528 template \u7684\u8bed\u6cd5\uff0c\u6bd5\u7adf\u5b83\u662f Vue.js \u72ec\u6709\u7684\u7279\u6027\u3002\u672c\u5c0f\u8282\u5219\u5728\u4e0a\u4e00\u8282\u7684 Table \u7ec4\u4ef6\u57fa\u7840\u4e0a\u4fee\u6539\uff0c\u5b9e\u73b0\u4e00\u79cd\u8fbe\u5230\u540c\u6837\u6e32\u67d3\u6548\u679c\uff0c\u4f46\u5bf9\u4f7f\u7528\u8005\u66f4\u53cb\u597d\u7684 slot-scope \u5199\u6cd5\u3002\n\n## \u4ec0\u4e48\u662f slot-scope\n\nslot\uff08\u63d2\u69fd\uff09\u6211\u4eec\u90fd\u5f88\u719f\u6089\uff0c\u5b83\u662f Vue.js \u7ec4\u4ef6\u7684 3 \u4e2a API \u4e4b\u4e00\uff0c\u7528\u4e8e\u5206\u53d1\u5185\u5bb9\u3002\u90a3 slot-scope \u662f\u4ec0\u4e48\u5462\uff1f\u5148\u6765\u770b\u4e00\u4e2a\u573a\u666f\uff0c\u6bd4\u5982\u67d0\u7ec4\u4ef6\u62e5\u6709\u4e0b\u9762\u7684\u6a21\u677f\uff1a\n\n```\n<ul>\n  <li v-for=\"book in books\" :key=\"book.id\">\n    {{ book.name }}\n  </li>\n</ul>\n\n```\n\n\u4f7f\u7528\u8005\u4f20\u9012\u4e00\u4e2a\u6570\u7ec4 `books`\uff0c\u7531\u7ec4\u4ef6\u5185\u7684 `v-for` \u5faa\u73af\u663e\u793a\uff0c\u8fd9\u91cc\u7684 `{{ book.name }}` \u662f\u7eaf\u6587\u672c\u8f93\u51fa\uff0c\u5982\u679c\u60f3\u81ea\u5b9a\u4e49\u5b83\u7684\u6a21\u677f\uff08\u5373\u5185\u5bb9\u5206\u53d1\uff09\uff0c\u5c31\u8981\u7528\u5230 slot\uff0c\u4f46 slot \u53ea\u80fd\u662f\u56fa\u5b9a\u7684\u6a21\u677f\uff0c\u6ca1\u6cd5\u81ea\u5b9a\u4e49\u5faa\u73af\u4f53\u4e2d\u7684\u4e00\u4e2a\u5177\u4f53\u7684\u9879\uff0c\u4e8b\u5b9e\u4e0a\u8fd9\u8ddf\u4e0a\u4e00\u8282\u7684 Table \u573a\u666f\u662f\u7c7b\u4f3c\u7684\u3002\n\n\u5e38\u89c4\u7684 slot \u65e0\u6cd5\u5b9e\u73b0\u5bf9\u7ec4\u4ef6\u5faa\u73af\u4f53\u7684\u6bcf\u4e00\u9879\u8fdb\u884c\u4e0d\u540c\u7684\u5185\u5bb9\u5206\u53d1\uff0c\u8fd9\u5c31\u8981\u7528\u5230 slot-scope\uff0c\u5b83\u672c\u8d28\u4e0a\u8ddf slot \u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u53ef\u4ee5\u4f20\u9012\u53c2\u6570\u3002\u6bd4\u5982\u4e0a\u9762\u7684\u793a\u4f8b\uff0c\u4f7f\u7528 slot-scope \u5c01\u88c5\uff1a\n\n```\n<ul>\n  <li v-for=\"book in books\" :key=\"book.id\">\n    <slot :book=\"book\">\n      <!-- \u9ed8\u8ba4\u5185\u5bb9 -->\n      {{ book.name }}\n    </slot>\n  </li>\n</ul>\n\n```\n\n\u5728 slot \u4e0a\uff0c\u4f20\u9012\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u53c2\u6570 `book`\uff0c\u5b83\u7684\u503c\u7ed1\u5b9a\u7684\u662f\u5f53\u524d\u5faa\u73af\u9879\u7684\u6570\u636e book\uff0c\u8fd9\u6837\u5728\u7236\u7ea7\u4f7f\u7528\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728 slot \u4e2d\u8bbf\u95ee\u5b83\u4e86\uff1a\n\n```\n<book-list :books=\"books\">\n  <template slot-scope=\"slotProps\">\n    <span v-if=\"slotProps.book.sale\">\u9650\u65f6\u4f18\u60e0</span>\n    {{ slotProps.book.name }}\n  </template>\n</book-list>\n\n```\n\n\u4f7f\u7528 slot-scope \u6307\u5b9a\u7684\u53c2\u6570 `slotProps` \u5c31\u662f\u8fd9\u4e2a slot \u7684\u5168\u90e8\u53c2\u6570\uff0c\u5b83\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5728 slot-scope \u4e2d\u662f\u53ef\u4ee5\u4f20\u9012\u591a\u4e2a\u53c2\u6570\u7684\uff0c\u4e0a\u4f8b\u6211\u4eec\u53ea\u5199\u4e86\u4e00\u4e2a\u53c2\u6570 `book`\uff0c\u6240\u4ee5\u8bbf\u95ee\u5b83\u5c31\u662f `slotProps.book`\u3002\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528 ES6 \u7684\u89e3\u6784\uff0c\u80fd\u8ba9\u53c2\u6570\u4f7f\u7528\u8d77\u6765\u66f4\u65b9\u4fbf\uff1a\n\n```\n<book-list :books=\"books\">\n  <template slot-scope=\"{ book }\">\n    <span v-if=\"book.sale\">\u9650\u65f6\u4f18\u60e0</span>\n    {{ book.name }}\n  </template>\n</book-list>\n\n```\n\n\u9664\u4e86\u53ef\u4ee5\u4f20\u9012\u53c2\u6570\uff0c\u5176\u5b83\u7528\u6cd5\u8ddf slot \u662f\u4e00\u6837\u7684\uff0c\u6bd4\u5982\u4e5f\u53ef\u4ee5\u201c\u5177\u540d\u201d\uff1a\n\n```\n<slot :book=\"book\" name=\"book\">\n  {{ book.name }}\n</slot>\n\n```\n\n```\n<template slot-scope=\"{ book }\" slot=\"book\">\n  <span v-if=\"book.sale\">\u9650\u65f6\u4f18\u60e0</span>\n  {{ book.name }}\n</template>\n\n```\n\n\u8fd9\u5c31\u662f\u4f5c\u7528\u57df slot\uff08slot-scope\uff09\uff0c\u80fd\u591f\u5728\u7ec4\u4ef6\u7684\u5faa\u73af\u4f53\u4e2d\u505a\u5185\u5bb9\u5206\u53d1\uff0c\u6709\u4e86\u5b83\uff0cTable \u7ec4\u4ef6\u7684\u81ea\u5b9a\u4e49\u5217\u6a21\u677f\u5c31\u4e0d\u7528\u5199\u4e00\u957f\u4e32\u7684 Render \u51fd\u6570\u4e86\u3002\n\n\u4e3a\u4e86\u628a Render \u51fd\u6570\u548c slot-scope \u7406\u89e3\u900f\u5f7b\uff0c\u4e0b\u9762\u6211\u4eec\u7528 3 \u79cd\u65b9\u6cd5\u6765\u6539\u5199 Table\uff0c\u5b9e\u73b0 slot-scope \u81ea\u5b9a\u4e49\u5217\u6a21\u677f\u3002\n\n## \u65b9\u6848\u4e00\n\n\u7b2c\u4e00\u79cd\u65b9\u6848\uff0c\u7528\u6700\u7b80\u5355\u7684 slot-scope \u5b9e\u73b0\uff0c\u540c\u65f6\u4e5f\u517c\u5bb9 Render \u51fd\u6570\u7684\u65e7\u7528\u6cd5\u3002\u62f7\u8d1d\u4e0a\u4e00\u8282\u7684 Table \u7ec4\u4ef6\u76ee\u5f55\uff0c\u66f4\u540d\u4e3a `table-slot`\uff0c\u540c\u65f6\u4e5f\u62f7\u8d1d\u8def\u7531\uff0c\u66f4\u540d\u4e3a `table-slot.vue`\u3002\u4e3a\u4e86\u517c\u5bb9\u65e7\u7684 Render \u51fd\u6570\u7528\u6cd5\uff0c\u5728 columns \u7684\u5217\u914d\u7f6e column \u4e2d\uff0c\u65b0\u589e\u4e00\u4e2a\u5b57\u6bb5 `slot` \u6765\u6307\u5b9a slot-scope \u7684\u540d\u79f0\uff1a\n\n```\n<!-- src/components/table-slot/table.vue -->\n<template>\n  <table>\n    <thead>\n      <tr>\n        <th v-for=\"col in columns\">{{ col.title }}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr v-for=\"(row, rowIndex) in data\">\n        <td v-for=\"col in columns\">\n          <template v-if=\"'render' in col\">\n            <Render :row=\"row\" :column=\"col\" :index=\"rowIndex\" :render=\"col.render\"></Render>\n          </template>\n          <template v-else-if=\"'slot' in col\">\n            <slot :row=\"row\" :column=\"col\" :index=\"rowIndex\" :name=\"col.slot\"></slot>\n          </template>\n          <template v-else>{{ row[col.key] }}</template>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n\n```\n\n\u76f8\u6bd4\u539f\u5148\u7684\u6587\u4ef6\uff0c\u53ea\u5728 `'render' in col` \u7684\u6761\u4ef6\u4e0b\u65b0\u52a0\u4e86\u4e00\u4e2a `template` \u7684\u6807\u7b7e\uff0c\u5982\u679c\u4f7f\u7528\u8005\u7684 column \u914d\u7f6e\u4e86 render \u5b57\u6bb5\uff0c\u5c31\u4f18\u5148\u4ee5 Render \u51fd\u6570\u6e32\u67d3\uff0c\u7136\u540e\u518d\u5224\u65ad\u662f\u5426\u7528 slot-scope \u6e32\u67d3\u3002\u5728\u5b9a\u4e49\u7684\u4f5c\u7528\u57df slot \u4e2d\uff0c\u5c06\u884c\u6570\u636e `row`\u3001\u5217\u6570\u636e `column` \u548c\u7b2c\u51e0\u884c `index` \u4f5c\u4e3a slot \u7684\u53c2\u6570\uff0c\u5e76\u6839\u636e column \u4e2d\u6307\u5b9a\u7684 slot \u5b57\u6bb5\u503c\uff0c\u52a8\u6001\u8bbe\u7f6e\u4e86\u5177\u540d `name`\u3002\u4f7f\u7528\u8005\u5728\u914d\u7f6e columns \u65f6\uff0c\u53ea\u8981\u6307\u5b9a\u4e86\u67d0\u4e00\u5217\u7684 slot\uff0c\u90a3\u5c31\u53ef\u4ee5\u5728 Table \u7ec4\u4ef6\u4e2d\u4f7f\u7528 slot-scope\u3002\u6211\u4eec\u4ee5\u4e0a\u4e00\u8282\u7684\u53ef\u7f16\u8f91\u6574\u884c\u6570\u636e\u4e3a\u4f8b\uff0c\u7528 slot-scope \u7684\u5199\u6cd5\u5b9e\u73b0\u5b8c\u5168\u4e00\u6837\u7684\u6548\u679c\uff1a\n\n```\n<!-- src/views/table-slot.vue -->\n<template>\n  <div>\n    <table-slot :columns=\"columns\" :data=\"data\">\n      <template slot-scope=\"{ row, index }\" slot=\"name\">\n        <input type=\"text\" v-model=\"editName\" v-if=\"editIndex === index\" />\n        <span v-else>{{ row.name }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"age\">\n        <input type=\"text\" v-model=\"editAge\" v-if=\"editIndex === index\" />\n        <span v-else>{{ row.age }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"birthday\">\n        <input type=\"text\" v-model=\"editBirthday\" v-if=\"editIndex === index\" />\n        <span v-else>{{ getBirthday(row.birthday) }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"address\">\n        <input type=\"text\" v-model=\"editAddress\" v-if=\"editIndex === index\" />\n        <span v-else>{{ row.address }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"action\">\n        <div v-if=\"editIndex === index\">\n          <button @click=\"handleSave(index)\">\u4fdd\u5b58</button>\n          <button @click=\"editIndex = -1\">\u53d6\u6d88</button>\n        </div>\n        <div v-else>\n          <button @click=\"handleEdit(row, index)\">\u64cd\u4f5c</button>\n        </div>\n      </template>\n    </table-slot>\n  </div>\n</template>\n<script>\n  import TableSlot from '../components/table-slot/table.vue';\n\n  export default {\n    components: { TableSlot },\n    data () {\n      return {\n        columns: [\n          {\n            title: '\u59d3\u540d',\n            slot: 'name'\n          },\n          {\n            title: '\u5e74\u9f84',\n            slot: 'age'\n          },\n          {\n            title: '\u51fa\u751f\u65e5\u671f',\n            slot: 'birthday'\n          },\n          {\n            title: '\u5730\u5740',\n            slot: 'address'\n          },\n          {\n            title: '\u64cd\u4f5c',\n            slot: 'action'\n          }\n        ],\n        data: [\n          {\n            name: '\u738b\u5c0f\u660e',\n            age: 18,\n            birthday: '919526400000',\n            address: '\u5317\u4eac\u5e02\u671d\u9633\u533a\u828d\u836f\u5c45'\n          },\n          {\n            name: '\u5f20\u5c0f\u521a',\n            age: 25,\n            birthday: '696096000000',\n            address: '\u5317\u4eac\u5e02\u6d77\u6dc0\u533a\u897f\u4e8c\u65d7'\n          },\n          {\n            name: '\u674e\u5c0f\u7ea2',\n            age: 30,\n            birthday: '563472000000',\n            address: '\u4e0a\u6d77\u5e02\u6d66\u4e1c\u65b0\u533a\u4e16\u7eaa\u5927\u9053'\n          },\n          {\n            name: '\u5468\u5c0f\u4f1f',\n            age: 26,\n            birthday: '687024000000',\n            address: '\u6df1\u5733\u5e02\u5357\u5c71\u533a\u6df1\u5357\u5927\u9053'\n          }\n        ],\n        editIndex: -1,  // \u5f53\u524d\u805a\u7126\u7684\u8f93\u5165\u6846\u7684\u884c\u6570\n        editName: '',  // \u7b2c\u4e00\u5217\u8f93\u5165\u6846\uff0c\u5f53\u7136\u805a\u7126\u7684\u8f93\u5165\u6846\u7684\u8f93\u5165\u5185\u5bb9\uff0c\u4e0e data \u5206\u79bb\u907f\u514d\u91cd\u6784\u7684\u95ea\u70c1\n        editAge: '',  // \u7b2c\u4e8c\u5217\u8f93\u5165\u6846\n        editBirthday: '',  // \u7b2c\u4e09\u5217\u8f93\u5165\u6846\n        editAddress: '',  // \u7b2c\u56db\u5217\u8f93\u5165\u6846\n      }\n    },\n    methods: {\n      handleEdit (row, index) {\n        this.editName = row.name;\n        this.editAge = row.age;\n        this.editAddress = row.address;\n        this.editBirthday = row.birthday;\n        this.editIndex = index;\n      },\n      handleSave (index) {\n        this.data[index].name = this.editName;\n        this.data[index].age = this.editAge;\n        this.data[index].birthday = this.editBirthday;\n        this.data[index].address = this.editAddress;\n        this.editIndex = -1;\n      },\n      getBirthday (birthday) {\n        const date = new Date(parseInt(birthday));\n        const year = date.getFullYear();\n        const month = date.getMonth() + 1;\n        const day = date.getDate();\n\n        return `${year}-${month}-${day}`;\n      }\n    }\n  }\n</script>\n\n```\n\n\u793a\u4f8b\u4e2d\u5728 `<table-slot>` \u5185\u7684\u6bcf\u4e00\u4e2a `<template>` \u5c31\u5bf9\u5e94\u67d0\u4e00\u5217\u7684 slot-scope \u6a21\u677f\uff0c\u901a\u8fc7\u914d\u7f6e\u7684 `slot` \u5b57\u6bb5\uff0c\u6307\u5b9a\u5177\u540d\u7684 slot-scope\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u57fa\u672c\u662f\u628a Render \u51fd\u6570\u8fd8\u539f\u6210\u4e86 html \u7684\u5199\u6cd5\uff0c\u8fd9\u6837\u770b\u8d77\u6765\u76f4\u63a5\u591a\u4e86\uff0c\u6e32\u67d3\u6548\u679c\u662f\u5b8c\u5168\u4e00\u6837\u7684\u3002\u5728 slot-scope \u4e2d\uff0c\u5e73\u65f6\u600e\u4e48\u5199\u7ec4\u4ef6\uff0c\u8fd9\u91cc\u5c31\u600e\u4e48\u5199\uff0cVue.js \u6240\u6709\u7684 API \u90fd\u662f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7684\u3002\n\n\u65b9\u6848\u4e00\u662f\u6700\u4f18\u89e3\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u6848\u5c31\u53ef\u4ee5\u4e86\uff0c\u5176\u4f59\u4e24\u79cd\u65b9\u6848\u662f\u57fa\u4e8e Render \u7684\u3002\n\n## \u65b9\u6848\u4e8c\n\n\u7b2c\u4e8c\u79cd\u65b9\u6848\uff0c\u4e0d\u9700\u8981\u4fee\u6539\u539f\u5148\u7684 Table \u7ec4\u4ef6\u4ee3\u7801\uff0c\u53ea\u662f\u5728\u4f7f\u7528\u5c42\u9762\u4fee\u6539\u5373\u53ef\u3002\u5148\u6765\u770b\u5177\u4f53\u7684\u4f7f\u7528\u4ee3\u7801\uff0c\u7136\u540e\u518d\u505a\u5206\u6790\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684 Table \u7ec4\u4ef6\uff0c\u4ecd\u7136\u662f\u4e0a\u4e00\u8282 `src/components/table-render` \u7684\u7ec4\u4ef6\uff0c\u5b83\u53ea\u6709 Render \u51fd\u6570\uff0c\u6ca1\u6709\u5b9a\u4e49 slot-scope\uff1a\n\n```\n<!-- src/views/table-render.vue \u7684\u6539\u5199 -->\n<template>\n  <div>\n    <table-render ref=\"table\" :columns=\"columns\" :data=\"data\">\n      <template slot-scope=\"{ row, index }\" slot=\"name\">\n        <input type=\"text\" v-model=\"editName\" v-if=\"editIndex === index\" />\n        <span v-else>{{ row.name }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"age\">\n        <input type=\"text\" v-model=\"editAge\" v-if=\"editIndex === index\" />\n        <span v-else>{{ row.age }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"birthday\">\n        <input type=\"text\" v-model=\"editBirthday\" v-if=\"editIndex === index\" />\n        <span v-else>{{ getBirthday(row.birthday) }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"address\">\n        <input type=\"text\" v-model=\"editAddress\" v-if=\"editIndex === index\" />\n        <span v-else>{{ row.address }}</span>\n      </template>\n\n      <template slot-scope=\"{ row, index }\" slot=\"action\">\n        <div v-if=\"editIndex === index\">\n          <button @click=\"handleSave(index)\">\u4fdd\u5b58</button>\n          <button @click=\"editIndex = -1\">\u53d6\u6d88</button>\n        </div>\n        <div v-else>\n          <button @click=\"handleEdit(row, index)\">\u64cd\u4f5c</button>\n        </div>\n      </template>\n    </table-render>\n  </div>\n</template>\n<script>\n  import TableRender from '../components/table-render/table.vue';\n\n  export default {\n    components: { TableRender },\n    data () {\n      return {\n        columns: [\n          {\n            title: '\u59d3\u540d',\n            render: (h, { row, column, index }) => {\n              return h(\n                'div',\n                this.$refs.table.$scopedSlots.name({\n                  row: row,\n                  column: column,\n                  index: index\n                })\n              )\n            }\n          },\n          {\n            title: '\u5e74\u9f84',\n            render: (h, { row, column, index }) => {\n              return h(\n                'div',\n                this.$refs.table.$scopedSlots.age({\n                  row: row,\n                  column: column,\n                  index: index\n                })\n              )\n            }\n          },\n          {\n            title: '\u51fa\u751f\u65e5\u671f',\n            render: (h, { row, column, index }) => {\n              return h(\n                'div',\n                this.$refs.table.$scopedSlots.birthday({\n                  row: row,\n                  column: column,\n                  index: index\n                })\n              )\n            }\n          },\n          {\n            title: '\u5730\u5740',\n            render: (h, { row, column, index }) => {\n              return h(\n                'div',\n                this.$refs.table.$scopedSlots.address({\n                  row: row,\n                  column: column,\n                  index: index\n                })\n              )\n            }\n          },\n          {\n            title: '\u64cd\u4f5c',\n            render: (h, { row, column, index }) => {\n              return h(\n                'div',\n                this.$refs.table.$scopedSlots.action({\n                  row: row,\n                  column: column,\n                  index: index\n                })\n              )\n            }\n          }\n        ],\n        data: [],\n        editIndex: -1,  // \u5f53\u524d\u805a\u7126\u7684\u8f93\u5165\u6846\u7684\u884c\u6570\n        editName: '',  // \u7b2c\u4e00\u5217\u8f93\u5165\u6846\uff0c\u5f53\u7136\u805a\u7126\u7684\u8f93\u5165\u6846\u7684\u8f93\u5165\u5185\u5bb9\uff0c\u4e0e data \u5206\u79bb\u907f\u514d\u91cd\u6784\u7684\u95ea\u70c1\n        editAge: '',  // \u7b2c\u4e8c\u5217\u8f93\u5165\u6846\n        editBirthday: '',  // \u7b2c\u4e09\u5217\u8f93\u5165\u6846\n        editAddress: '',  // \u7b2c\u56db\u5217\u8f93\u5165\u6846\n      }\n    },\n    methods: {\n      handleEdit (row, index) {\n        this.editName = row.name;\n        this.editAge = row.age;\n        this.editAddress = row.address;\n        this.editBirthday = row.birthday;\n        this.editIndex = index;\n      },\n      handleSave (index) {\n        this.data[index].name = this.editName;\n        this.data[index].age = this.editAge;\n        this.data[index].birthday = this.editBirthday;\n        this.data[index].address = this.editAddress;\n        this.editIndex = -1;\n      },\n      getBirthday (birthday) {\n        const date = new Date(parseInt(birthday));\n        const year = date.getFullYear();\n        const month = date.getMonth() + 1;\n        const day = date.getDate();\n\n        return `${year}-${month}-${day}`;\n      }\n    },\n    mounted () {\n      this.data = [\n        {\n          name: '\u738b\u5c0f\u660e',\n          age: 18,\n          birthday: '919526400000',\n          address: '\u5317\u4eac\u5e02\u671d\u9633\u533a\u828d\u836f\u5c45'\n        },\n        {\n          name: '\u5f20\u5c0f\u521a',\n          age: 25,\n          birthday: '696096000000',\n          address: '\u5317\u4eac\u5e02\u6d77\u6dc0\u533a\u897f\u4e8c\u65d7'\n        },\n        {\n          name: '\u674e\u5c0f\u7ea2',\n          age: 30,\n          birthday: '563472000000',\n          address: '\u4e0a\u6d77\u5e02\u6d66\u4e1c\u65b0\u533a\u4e16\u7eaa\u5927\u9053'\n        },\n        {\n          name: '\u5468\u5c0f\u4f1f',\n          age: 26,\n          birthday: '687024000000',\n          address: '\u6df1\u5733\u5e02\u5357\u5c71\u533a\u6df1\u5357\u5927\u9053'\n        }\n      ];\n    }\n  }\n</script>\n\n```\n\n\u5728 slot-scope \u7684\u4f7f\u7528\u4e0a\uff08\u5373 template \u7684\u5185\u5bb9\uff09\uff0c\u4e0e\u65b9\u6848\u4e00\u662f\u5b8c\u5168\u4e00\u81f4\u7684\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5728 column \u7684\u5b9a\u4e49\u4e0a\uff0c\u4ecd\u7136\u4f7f\u7528\u4e86 render \u5b57\u6bb5\uff0c\u53ea\u4e0d\u8fc7\u6bcf\u4e2a render \u90fd\u6e32\u67d3\u4e86\u4e00\u4e2a div \u8282\u70b9\uff0c\u800c\u8fd9\u4e2a div \u7684\u5185\u5bb9\uff0c\u662f\u6307\u5b9a\u6765\u5728 `<table-render>` \u4e2d\u5b9a\u4e49\u7684 slot-scope\uff1a\n\n```\nrender: (h, { row, column, index }) => {\n  return h(\n    'div',\n    this.$refs.table.$scopedSlots.name({\n      row: row,\n      column: column,\n      index: index\n    })\n  )\n}\n\n```\n\n\u8fd9\u6b63\u662f Render \u51fd\u6570\u7075\u6d3b\u7684\u4e00\u4e2a\u4f53\u73b0\uff0c\u4f7f\u7528 `$scopedSlots` \u53ef\u4ee5\u8bbf\u95ee slot-scope\uff0c\u6240\u4ee5\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u7684\u610f\u601d\u662f\uff0cname \u8fd9\u4e00\u5217\u4ecd\u7136\u662f\u4f7f\u7528 Functional Render\uff0c\u53ea\u4e0d\u8fc7 Render \u7684\u662f\u4e00\u4e2a\u9884\u5148\u5b9a\u4e49\u597d\u7684 slot-scope \u6a21\u677f\u3002\n\n\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u793a\u4f8b\u4e2d\u7684 `data` \u9ed8\u8ba4\u662f\u7a7a\u6570\u7ec4\uff0c\u800c\u5728 mounted \u91cc\u624d\u8d4b\u503c\u7684\uff0c\u662f\u56e0\u4e3a\u8fd9\u6837\u5b9a\u4e49\u7684 slot-scope\uff0c\u521d\u59cb\u65f6\u8bfb\u53d6 `this.$refs.table.$scopedSlots` \u662f\u8bfb\u4e0d\u5230\u7684\uff0c\u4f1a\u62a5\u9519\uff0c\u5f53\u6ca1\u6709\u6570\u636e\u65f6\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53bb\u6e32\u67d3\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u62a5\u9519\u3002\n\n\u8fd9\u79cd\u65b9\u6848\u867d\u7136\u53ef\u884c\uff0c\u4f46\u5f52\u6839\u5230\u5e95\u662f\u4e00\u79cd hack\uff0c\u4e0d\u662f\u975e\u5e38\u63a8\u8350\uff0c\u4e4b\u6240\u4ee5\u5217\u51fa\u6765\uff0c\u662f\u4e3a\u4e86\u5bf9 Render \u548c slot-scope \u6709\u8fdb\u4e00\u6b65\u7684\u8ba4\u8bc6\u3002\n\n## \u65b9\u6848\u4e09\n\n\u7b2c 3 \u4e2d\u65b9\u6848\u7684\u601d\u8def\u548c\u7b2c 2 \u79cd\u662f\u4e00\u6837\u7684\uff0c\u5b83\u4ecb\u4e8e\u65b9\u6848 1 \u4e0e\u65b9\u6848 2 \u4e4b\u95f4\u3002\u8fd9\u79cd\u65b9\u6848\u8981\u4fee\u6539 Table \u7ec4\u4ef6\u4ee3\u7801\uff0c\u4f46\u662f\u7528\u4f8b\u4e0e\u65b9\u6848 1 \u5b8c\u5168\u4e00\u81f4\u3002\n\n\u5728\u65b9\u6848 2 \u4e2d\uff0c\u6211\u4eec\u662f\u901a\u8fc7\u4fee\u6539\u7528\u4f8b\u4f7f\u7528 slot-scope \u7684\uff0c\u4e5f\u5c31\u662f\u8bf4 Table \u7ec4\u4ef6\u672c\u8eab\u6ca1\u6709\u652f\u6301 slot-scope\uff0c\u662f\u6211\u4eec\u201c\u5f3a\u52a0\u201d\u4e0a\u53bb\u7684\uff0c\u5982\u679c\u628a\u5f3a\u52a0\u7684\u90e8\u5206\uff0c\u96c6\u6210\u5230 Table \u5185\uff0c\u90a3\u5bf9\u4f7f\u7528\u8005\u5c31\u5f88\u53cb\u597d\u4e86\uff0c\u540c\u65f6\u4e5f\u907f\u514d\u4e86\u521d\u59cb\u5316\u62a5\u9519\uff0c\u4e0d\u5f97\u4e0d\u628a data \u5199\u5728 mounted \u7684\u95ee\u9898\u3002\n\n\u4fdd\u6301\u65b9\u6848 1 \u7684\u7528\u4f8b\u4e0d\u53d8\uff0c\u4fee\u6539 `src/components/table-render` \u4e2d\u7684\u4ee3\u7801\u3002\u4e3a\u4e86\u540c\u65f6\u517c\u5bb9 Render \u4e0e slot-scope\uff0c\u6211\u4eec\u5728 `table-render` \u4e0b\u65b0\u5efa\u4e00\u4e2a slot.js \u7684\u6587\u4ef6\uff1a\n\n```\n// src/components/table-render/slot.js\nexport default {\n  functional: true,\n  inject: ['tableRoot'],\n  props: {\n    row: Object,\n    column: Object,\n    index: Number\n  },\n  render: (h, ctx) => {\n    return h('div', ctx.injections.tableRoot.$scopedSlots[ctx.props.column.slot]({\n      row: ctx.props.row,\n      column: ctx.props.column,\n      index: ctx.props.index\n    }));\n  }\n};\n\n```\n\n\u5b83\u4ecd\u7136\u662f\u4e00\u4e2a Functional Render\uff0c\u4f7f\u7528 `inject` \u6ce8\u5165\u4e86\u7236\u7ea7\u7ec4\u4ef6 table.vue\uff08\u4e0b\u6587\u6539\u5199\uff09 \u4e2d\u63d0\u4f9b\u7684\u5b9e\u4f8b `tableRoot`\u3002\u5728 render \u91cc\uff0c\u4e5f\u662f\u901a\u8fc7\u65b9\u6848 2 \u4e2d\u4f7f\u7528 `$scopedSlots` \u5b9a\u4e49\u7684 slot\uff0c\u4e0d\u8fc7\u8fd9\u662f\u5728\u7ec4\u4ef6\u7ea7\u522b\u5b9a\u4e49\uff0c\u5bf9\u7528\u6237\u6765\u8bf4\u662f\u900f\u660e\u7684\uff0c\u53ea\u8981\u6309\u65b9\u6848 1 \u7684\u7528\u4f8b\u6765\u5199\u5c31\u53ef\u4ee5\u4e86\u3002\n\ntable.vue \u4e5f\u8981\u505a\u4e00\u70b9\u4fee\u6539\uff1a\n\n```\n<!-- src/components/table-slot/table.vue \u7684\u6539\u5199\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<template>\n  <table>\n    <thead>\n      <tr>\n        <th v-for=\"col in columns\">{{ col.title }}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr v-for=\"(row, rowIndex) in data\">\n        <td v-for=\"col in columns\">\n          <template v-if=\"'render' in col\">\n            <Render :row=\"row\" :column=\"col\" :index=\"rowIndex\" :render=\"col.render\"></Render>\n          </template>\n          <template v-else-if=\"'slot' in col\">\n            <slot-scope :row=\"row\" :column=\"col\" :index=\"rowIndex\"></slot-scope>\n          </template>\n          <template v-else>{{ row[col.key] }}</template>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n<script>\n  import Render from './render.js';\n  import SlotScope from './slot.js';\n\n  export default {\n    components: { Render, SlotScope },\n    provide () {\n      return {\n        tableRoot: this\n      };\n    },\n    props: {\n      columns: {\n        type: Array,\n        default () {\n          return [];\n        }\n      },\n      data: {\n        type: Array,\n        default () {\n          return [];\n        }\n      }\n    }\n  }\n</script>\n\n```\n\n\u56e0\u4e3a slot-scope \u6a21\u677f\u662f\u5199\u5728 table.vue \u4e2d\u7684\uff08\u5bf9\u4f7f\u7528\u8005\u6765\u8bf4\uff0c\u76f8\u5f53\u4e8e\u5199\u5728\u7ec4\u4ef6 `<table-slot></table-slot>` \u4e4b\u95f4\uff09\uff0c\u6240\u4ee5\u5728 table.vue \u4e2d\u4f7f\u7528 provide \u5411\u4e0b\u63d0\u4f9b\u4e86 Table \u7684\u5b9e\u4f8b\uff0c\u8fd9\u6837\u5728 slot.js \u4e2d\u5c31\u53ef\u4ee5\u901a\u8fc7 inject \u8bbf\u95ee\u5230\u5b83\uff0c\u7ee7\u800c\u901a\u8fc7 `$scopedSlots` \u83b7\u53d6\u5230 slot\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728 Functional Render \u662f\u6ca1\u6709 this \u4e0a\u4e0b\u6587\u7684\uff0c\u90fd\u662f\u901a\u8fc7 h \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e34\u65f6\u4e0a\u4e0b\u6587 ctx \u6765\u8bbf\u95ee prop\u3001inject \u7b49\u7684\u3002\n\n\u65b9\u6848 3 \u4e5f\u662f\u63a8\u8350\u4f7f\u7528\u7684\uff0c\u5f53 Table \u7684\u529f\u80fd\u8db3\u591f\u590d\u6742\uff0c\u5c42\u7ea7\u4f1a\u5d4c\u5957\u7684\u6bd4\u8f83\u6df1\uff0c\u90a3\u65f6\u65b9\u6848 1 \u7684 slot \u5c31\u4e0d\u4f1a\u5b9a\u4e49\u5728\u7b2c\u4e00\u7ea7\u7ec4\u4ef6\u4e2d\uff0c\u4e2d\u95f4\u53ef\u80fd\u4f1a\u9694\u8bb8\u591a\u7ec4\u4ef6\uff0cslot \u5c31\u8981\u4e00\u5c42\u5c42\u4e2d\u8f6c\uff0c\u76f8\u6bd4\u5728\u4efb\u4f55\u5730\u65b9\u90fd\u80fd\u76f4\u63a5\u4f7f\u7528\u7684 Render \u5c31\u8981\u9ebb\u70e6\u4e86\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u7684\u7ec4\u4ef6\u5c42\u7ea7\u7b80\u5355\uff0c\u63a8\u8350\u7528\u7b2c\u4e00\u79cd\u65b9\u6848\uff1b\u5982\u679c\u4f60\u7684\u7ec4\u4ef6\u5df2\u7ecf\u6210\u578b\uff08\u67d0 API \u57fa\u4e8e Render \u51fd\u6570\uff09\uff0c\u4f46\u4e00\u65f6\u95f4\u4e0d\u65b9\u4fbf\u652f\u6301 slot-scope\uff0c\u800c\u4f7f\u7528\u8005\u53c8\u60f3\u7528\uff0c\u90a3\u5c31\u9009\u65b9\u6848 2\uff1b\u5982\u679c\u4f60\u7684\u7ec4\u4ef6\u5df2\u7ecf\u6210\u578b\uff08\u67d0 API \u57fa\u4e8e Render \u51fd\u6570\uff09\uff0c\u4f46\u7ec4\u4ef6\u5c42\u7ea7\u590d\u6742\uff0c\u8981\u6309\u65b9\u6848 1 \u90a3\u6837\u652f\u6301 slot-scope \u53ef\u80fd\u6539\u52a8\u8f83\u5927\uff0c\u8fd8\u6709\u53ef\u80fd\u5e26\u6765\u65b0\u7684 bug\uff0c\u90a3\u5c31\u7528\u65b9\u6848 3\uff0c\u5b83\u4e0d\u4f1a\u7834\u574f\u539f\u6709\u7684\u4efb\u4f55\u5185\u5bb9\uff0c\u4f46\u4f1a\u989d\u5916\u652f\u6301 slot-scope \u7528\u6cd5\uff0c\u5173\u952e\u662f\u6539\u52a8\u7b80\u5355\u3002\n\n## \u7ed3\u8bed\n\n\u7406\u8bba\u4e0a\uff0c\u7edd\u5927\u591a\u6570\u80fd\u7528 Render \u7684\u5730\u65b9\uff0c\u90fd\u53ef\u4ee5\u7528 slot-scope\u3002\u5bf9\u4e8e\u6781\u5ba2\u6765\u8bf4\uff0c\u559c\u6b22\u6311\u6218\u5404\u79cd\u65b0\u5947\u7684\u5199\u6cd5\uff0c\u6240\u4ee5\u4f1a\u5728 Vue.js \u4e2d\u5927\u91cf\u4f7f\u7528 Render \u51fd\u6570\u3001JSX \u751a\u81f3 TS\uff1b\u800c\u5bf9\u4e8e\u6c42\u7a33\u7684\u5f00\u53d1\u8005\u6765\u8bf4\uff0c\u5e38\u89c4\u7684 template\u3001slot\u3001slot-scope \u5199\u6cd5\u4f1a\u662f\u597d\u7684\u9009\u62e9\u3002\u5982\u679c\u975e\u8981\u9009\u4e00\u79cd\uff0c\u90a3\u8981\u4ece\u4f60\u56e2\u961f\u7684\u6574\u4f53\u60c5\u51b5\u6765\u5b9a\uff0c\u5982\u679c\u56e2\u961f\u5927\u90e8\u5206\u662f\u5199\u540e\u7aef\u4e3a\u4e3b\u7684\uff0c\u90a3\u53ef\u80fd\u66f4\u503e\u5411\u4e8e TS\uff1b\u5982\u679c\u5199\u8fc7 React\uff0c\u6216\u8bb8 JSX \u662f\u4e0d\u9519\u7684\u9009\u62e9\uff1b\u5982\u679c\u5b9e\u5728\u4e0d\u77e5\u9053\u9009\u4ec0\u4e48\uff0c\u90a3\u5c31\u6c42\u7a33\u5427\uff01", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5b9e\u6218_6\u53ef\u7528_slot-scope_\u81ea\u5b9a\u4e49\u5217\u7684\u8868\u683c\u7ec4\u4ef6Table.md", "create_date": "2020-02-18T21:37:08.916", "order": 13}}, {"model": "subject.chapter", "pk": 108, "fields": {"title": "\u5b9e\u6218 7\uff1a\u6811\u5f62\u63a7\u4ef6\u2014\u2014Tree", "topic": 5, "md5": "ededd9845bea0565eb7a75b7c531afae", "md_body": "# \u5b9e\u6218 7\uff1a\u6811\u5f62\u63a7\u4ef6\u2014\u2014Tree\n\n\u672c\u5c0f\u8282\u57fa\u4e8e Vue.js \u7684\u9012\u5f52\u7ec4\u4ef6\u77e5\u8bc6\uff0c\u6765\u5f00\u53d1\u4e00\u4e2a\u5e38\u89c1\u7684\u6811\u5f62\u63a7\u4ef6\u2014Tree\u3002\n\nTree \u7ec4\u4ef6\u662f\u9012\u5f52\u7c7b\u7ec4\u4ef6\u7684\u5178\u578b\u4ee3\u8868\uff0c\u5b83\u5e38\u7528\u4e8e\u6587\u4ef6\u5939\u3001\u7ec4\u7ec7\u67b6\u6784\u3001\u751f\u7269\u5206\u7c7b\u3001\u56fd\u5bb6\u5730\u533a\u7b49\u7b49\uff0c\u4e16\u95f4\u4e07\u7269\u7684\u5927\u591a\u6570\u7ed3\u6784\u90fd\u662f\u6811\u5f62\u7ed3\u6784\u3002\u4f7f\u7528\u6811\u63a7\u4ef6\u53ef\u4ee5\u5b8c\u6574\u5c55\u73b0\u5176\u4e2d\u7684\u5c42\u7ea7\u5173\u7cfb\uff0c\u5e76\u5177\u6709\u5c55\u5f00\u6536\u8d77\u9009\u62e9\u7b49\u4ea4\u4e92\u529f\u80fd\u3002\n\n\u672c\u8282\u8981\u5b9e\u73b0\u7684 Tree \u7ec4\u4ef6\u5177\u6709\u4ee5\u4e0b\u529f\u80fd\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/11/27/16753fd7a86231b6?w=428&h=364&f=gif&s=112651)\n\n*   \u8282\u70b9\u53ef\u4ee5\u65e0\u9650\u5ef6\u4f38\uff08\u9012\u5f52\uff09\uff1b\n*   \u53ef\u4ee5\u5c55\u5f00 / \u6536\u8d77\u5b50\u8282\u70b9\uff1b\n*   \u8282\u70b9\u53ef\u4ee5\u9009\u4e2d\uff0c\u9009\u4e2d\u7236\u8282\u70b9\uff0c\u5b83\u7684\u6240\u6709\u5b50\u8282\u70b9\u4e5f\u5168\u90e8\u88ab\u9009\u4e2d\uff0c\u540c\u6837\uff0c\u53cd\u9009\u7236\u8282\u70b9\uff0c\u5176\u6240\u6709\u5b50\u8282\u70b9\u4e5f\u53d6\u6d88\u9009\u62e9\uff1b\n*   \u540c\u4e00\u7ea7\u6240\u6709\u5b50\u8282\u70b9\u9009\u4e2d\u65f6\uff0c\u5b83\u7684\u7236\u7ea7\u4e5f\u81ea\u52a8\u9009\u4e2d\uff0c\u4e00\u76f4\u9012\u5f52\u5224\u65ad\u5230\u6839\u8282\u70b9\u3002\n\n## API\n\nTree \u662f\u5178\u578b\u7684\u6570\u636e\u9a71\u52a8\u578b\u7ec4\u4ef6\uff0c\u6240\u4ee5\u8282\u70b9\u7684\u914d\u7f6e\u5c31\u662f\u4e00\u4e2a data\uff0c\u91cc\u9762\u63cf\u8ff0\u4e86\u6240\u6709\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u56fe\u7247\u4e2d\u7684\u793a\u4f8b\u6570\u636e\u4e3a\uff1a\n\n```\ndata: [\n  {\n    title: 'parent 1',\n    expand: true,\n    children: [\n      {\n        title: 'parent 1-1',\n        expand: true,\n        children: [\n          {\n            title: 'leaf 1-1-1'\n          },\n          {\n            title: 'leaf 1-1-2'\n          }\n        ]\n      },\n      {\n        title: 'parent 1-2',\n        children: [\n          {\n            title: 'leaf 1-2-1'\n          },\n          {\n            title: 'leaf 1-2-1'\n          }\n        ]\n      }\n    ]\n  }\n]\n\n```\n\n\u6bcf\u4e2a\u8282\u70b9\u7684\u914d\u7f6e\uff08props\uff1adata\uff09\u63cf\u8ff0\u5982\u4e0b\uff1a\n\n*   **title**\uff1a\u8282\u70b9\u6807\u9898\uff08\u672c\u4f8b\u4e3a\u7eaf\u6587\u672c\u8f93\u51fa\uff0c\u53ef\u53c2\u8003 Table \u7684 Render \u6216 slot-scope \u5c06\u5176\u6269\u5c55\uff09\uff1b\n*   **expand**\uff1a\u662f\u5426\u5c55\u5f00\u76f4\u5b50\u8282\u70b9\u3002\u5f00\u542f\u540e\uff0c\u5176\u76f4\u5c5e\u5b50\u8282\u70b9\u5c06\u5c55\u5f00\uff1b\n*   **checked**\uff1a\u662f\u5426\u9009\u4e2d\u8be5\u8282\u70b9\u3002\u5f00\u542f\u540e\uff0c\u8be5\u8282\u70b9\u7684 Checkbox \u5c06\u9009\u4e2d\uff1b\n*   **children**\uff1a\u5b50\u8282\u70b9\u5c5e\u6027\u6570\u7ec4\u3002\n\n\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u6ca1\u6709 children \u5b57\u6bb5\uff0c\u90a3\u5b83\u5c31\u662f\u6700\u540e\u4e00\u4e2a\u8282\u70b9\uff0c\u8fd9\u4e5f\u662f\u9012\u5f52\u7ec4\u4ef6\u7ec8\u7ed3\u7684\u5224\u65ad\u4f9d\u636e\u3002\n\n\u540c\u65f6\u518d\u63d0\u4f9b\u4e00\u4e2a\u662f\u5426\u663e\u793a\u591a\u9009\u6846\u7684 props\uff1ashowCheckbox\uff0c\u4ee5\u53ca\u4e24\u4e2a events\uff1a\n\n*   **on-toggle-expand**\uff1a\u5c55\u5f00\u548c\u6536\u8d77\u5b50\u5217\u8868\u65f6\u89e6\u53d1\uff1b\n*   **on-check-change**\uff1a\u70b9\u51fb\u590d\u9009\u6846\u65f6\u89e6\u53d1\u3002\n\n\u56e0\u4e3a\u662f\u6570\u636e\u9a71\u52a8\uff0c\u7ec4\u4ef6\u7684 API \u90fd\u6bd4\u8f83\u7b80\u5355\uff0c\u8fd9\u4e00\u70b9\u8ddf Table \u7ec4\u4ef6\u662f\u4e00\u6837\u7684\uff0c\u5b83\u4eec\u590d\u6742\u7684\u903b\u8f91\u90fd\u5728\u7ec4\u4ef6\u672c\u8eab\u3002\n\n## \u5165\u53e3 tree.vue\n\n\u5728 `src/components` \u4e2d\u65b0\u5efa\u76ee\u5f55 `tree`\uff0c\u5e76\u5728 tree \u4e0b\u521b\u5efa\u4e24\u4e2a\u7ec4\u4ef6 `tree.vue` \u548c `node.vue`\u3002tree.vue \u662f\u7ec4\u4ef6\u7684\u5165\u53e3\uff0c\u7528\u4e8e\u63a5\u6536\u548c\u5904\u7406\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u4f20\u9012\u7ed9 node.vue\uff1bnode.vue \u5c31\u662f\u4e00\u4e2a\u9012\u5f52\u7ec4\u4ef6\uff0c\u5b83\u6784\u6210\u4e86\u6bcf\u4e00\u4e2a**\u8282\u70b9**\uff0c\u5373\u4e00\u4e2a\u53ef\u5c55\u5f00 / \u5173\u95ed\u7684\u6309\u94ae\uff08+\u6216-\uff09\u3001\u4e00\u4e2a\u591a\u9009\u6846\uff08\u4f7f\u7528\u7b2c 7 \u8282\u7684 Checkbox \u7ec4\u4ef6\uff09\u3001\u8282\u70b9\u6807\u9898\u4ee5\u53ca\u9012\u5f52\u7684\u4e0b\u4e00\u7ea7\u8282\u70b9\u3002\u53ef\u80fd\u73b0\u5728\u542c\u8d77\u6765\u6bd4\u8f83\u56f0\u60d1\uff0c\u4e0d\u8981\u614c\uff0c\u4e0b\u9762\u9010\u4e00\u5206\u89e3\u3002\n\ntree.vue \u4e3b\u8981\u8d1f\u8d23\u4e24\u4ef6\u4e8b\uff1a\n\n1.  \u5b9a\u4e49\u4e86\u7ec4\u4ef6\u7684\u5165\u53e3\uff0c\u5373\u7ec4\u4ef6\u7684 API\uff1b\n2.  \u5bf9\u63a5\u6536\u7684\u6570\u636e props\uff1adata \u521d\u6b65\u5904\u7406\uff0c\u4e3a\u4e86\u5728 tree.vue \u4e2d\u4e0d\u7834\u574f\u4f7f\u7528\u8005\u4f20\u9012\u7684\u6e90\u6570\u636e data\uff0c\u6240\u4ee5\u4f1a\u514b\u9686\u4e00\u4efd\u6570\u636e\uff08cloneData\uff09\u3002\n\n\u56e0\u4e3a\u4f20\u9012\u7684\u6570\u636e data \u662f\u4e00\u4e2a\u590d\u6742\u7684\u6570\u7ec4\u7ed3\u6784\uff0c\u514b\u9686\u5b83\u8981\u4f7f\u7528\u6df1\u62f7\u8d1d\uff0c\u56e0\u4e3a\u6d45\u62f7\u8d1d\u6570\u636e\u4ecd\u7136\u662f\u5f15\u7528\u5173\u7cfb\uff0c\u4f1a\u7834\u574f\u6e90\u6570\u636e\u3002\u6240\u4ee5\u5728\u5de5\u5177\u96c6 `src/utils/assist.js` \u4e2d\u65b0\u52a0\u4e00\u4e2a\u6df1\u62f7\u8d1d\u7684\u5de5\u5177\u51fd\u6570 `deepCopy`\uff1a\n\n```\n// assist.js\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nfunction typeOf(obj) {\n  const toString = Object.prototype.toString;\n  const map = {\n    '[object Boolean]'  : 'boolean',\n    '[object Number]'   : 'number',\n    '[object String]'   : 'string',\n    '[object Function]' : 'function',\n    '[object Array]'    : 'array',\n    '[object Date]'     : 'date',\n    '[object RegExp]'   : 'regExp',\n    '[object Undefined]': 'undefined',\n    '[object Null]'     : 'null',\n    '[object Object]'   : 'object'\n  };\n  return map[toString.call(obj)];\n}\n// deepCopy\nfunction deepCopy(data) {\n  const t = typeOf(data);\n  let o;\n\n  if (t === 'array') {\n    o = [];\n  } else if ( t === 'object') {\n    o = {};\n  } else {\n    return data;\n  }\n\n  if (t === 'array') {\n    for (let i = 0; i < data.length; i++) {\n      o.push(deepCopy(data[i]));\n    }\n  } else if ( t === 'object') {\n    for (let i in data) {\n      o[i] = deepCopy(data[i]);\n    }\n  }\n  return o;\n}\n\nexport {deepCopy};\n\n```\n\ndeepCopy \u51fd\u6570\u4f1a\u9012\u5f52\u5730\u5bf9\u6570\u7ec4\u6216\u5bf9\u8c61\u8fdb\u884c\u9010\u4e00\u5224\u65ad\uff0c\u5982\u679c\u67d0\u9879\u662f\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u518d\u62c6\u5206\u7ee7\u7eed\u5224\u65ad\uff0c\u800c\u5176\u5b83\u7c7b\u578b\u5c31\u76f4\u63a5\u8d4b\u503c\u4e86\uff0c\u6240\u4ee5\u6df1\u62f7\u8d1d\u7684\u6570\u636e\u4e0d\u4f1a\u7834\u574f\u539f\u6709\u7684\u6570\u636e\uff08\u66f4\u591a\u6df1\u62f7\u8d1d\u4e0e\u6d45\u62f7\u8d1d\u7684\u5185\u5bb9\uff0c\u53ef\u9605\u8bfb\u6269\u5c55\u9605\u8bfb 1\uff09\u3002\n\n\u5148\u6765\u770b tree.vue \u7684\u4ee3\u7801\uff1a\n\n```\n<!-- src/components/tree/tree.vue -->\n<template>\n  <div>\n    <tree-node\n      v-for=\"(item, index) in cloneData\"\n      :key=\"index\"\n      :data=\"item\"\n      :show-checkbox=\"showCheckbox\"\n    ></tree-node>\n  </div>\n</template>\n<script>\n  import TreeNode from './node.vue';\n  import { deepCopy } from '../../utils/assist.js';\n\n  export default {\n    name: 'Tree',\n    components: { TreeNode },\n    props: {\n      data: {\n        type: Array,\n        default () {\n          return [];\n        }\n      },\n      showCheckbox: {\n        type: Boolean,\n        default: false\n      }\n    },\n    data () {\n      return {\n        cloneData: []\n      }\n    },\n    created () {\n      this.rebuildData();\n    },\n    watch: {\n      data () {\n        this.rebuildData();\n      }\n    },\n    methods: {\n      rebuildData () {\n        this.cloneData = deepCopy(this.data);\n      }\n    }\n  }\n</script>\n\n```\n\n\u5728\u7ec4\u4ef6 created \u65f6\uff08\u4ee5\u53ca watch \u76d1\u542c data \u6539\u53d8\u65f6\uff09\uff0c\u8c03\u7528\u4e86 `rebuildData` \u65b9\u6cd5\u514b\u9686\u6e90\u6570\u636e\uff0c\u5e76\u8d4b\u503c\u7ed9\u4e86 `cloneData`\u3002\n\n\u5728 template \u4e2d\uff0c\u5148\u662f\u6e32\u67d3\u4e86\u4e00\u4e2a node.vue \u7ec4\u4ef6\uff08`<tree-node>`\uff09\uff0c\u8fd9\u4e00\u7ea7\u662f Tree \u7684\u6839\u8282\u70b9\uff0c\u56e0\u4e3a cloneDate \u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6240\u4ee5\u8fd9\u4e2a\u6839\u8282\u70b9\u4e0d\u4e00\u5b9a\u53ea\u6709\u4e00\u9879\uff0c\u6709\u53ef\u80fd\u662f\u5e76\u5217\u7684\u591a\u9879\u3002\u4e0d\u8fc7\u8fd9\u91cc\u4f7f\u7528\u7684 node.vue \u8fd8\u6ca1\u6709\u7528\u5230 Vue.js \u7684\u9012\u5f52\u7ec4\u4ef6\uff0c\u5b83\u53ea\u5904\u7406\u7b2c\u4e00\u7ea7\u6839\u8282\u70b9\u3002\n\n`<tree-node>` \u7ec4\u4ef6\uff08node.vue\uff09\u63a5\u6536\u4e24\u4e2a props\uff1a\n\n1.  showCheckbox\uff1a\u4e0e tree.vue \u7684 showCheckbox \u76f8\u540c\uff0c\u53ea\u662f\u8fdb\u884c\u4f20\u9012\uff1b\n2.  data\uff1anode.vue \u63a5\u6536\u7684 data \u662f\u4e00\u4e2a Object \u800c\u975e Array\uff0c\u56e0\u4e3a\u5b83\u53ea\u8d1f\u8d23\u6e32\u67d3\u5f53\u524d\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u5e76\u9012\u5f52\u6e32\u67d3\u4e0b\u4e00\u4e2a\u5b50\u8282\u70b9\uff08\u5373 children\uff09\uff0c\u6240\u4ee5\u8fd9\u91cc\u5bf9 cloneData \u8fdb\u884c\u5faa\u73af\uff0c\u5c06\u6bcf\u4e00\u9879\u8282\u70b9\u6570\u636e\u8d4b\u7ed9\u4e86 tree-node\u3002\n\n## \u9012\u5f52\u7ec4\u4ef6 node.vue\n\nnode.vue \u662f\u6811\u7ec4\u4ef6 Tree \u7684\u6838\u5fc3\uff0c\u800c\u4e00\u4e2a tree-node \u8282\u70b9\u5305\u542b 4 \u4e2a\u90e8\u5206\uff1a\n\n1.  \u5c55\u5f00\u4e0e\u5173\u95ed\u7684\u6309\u94ae\uff08+\u6216-\uff09\uff1b\n2.  \u591a\u9009\u6846\uff1b\n3.  \u8282\u70b9\u6807\u9898\uff1b\n4.  \u9012\u5f52\u5b50\u8282\u70b9\u3002\n\n\u5148\u6765\u770b node.vue \u7684\u57fa\u672c\u7ed3\u6784\uff1a\n\n```\n<!-- src/components/tree/node.vue -->\n<template>\n  <ul class=\"tree-ul\">\n    <li class=\"tree-li\">\n      <span class=\"tree-expand\" @click=\"handleExpand\">\n        <span v-if=\"data.children && data.children.length && !data.expand\">+</span>\n        <span v-if=\"data.children && data.children.length && data.expand\">-</span>\n      </span>\n      <i-checkbox\n        v-if=\"showCheckbox\"\n        :value=\"data.checked\"\n        @input=\"handleCheck\"\n      ></i-checkbox>\n      <span>{{ data.title }}</span>\n      <tree-node\n        v-if=\"data.expand\"\n        v-for=\"(item, index) in data.children\"\n        :key=\"index\"\n        :data=\"item\"\n        :show-checkbox=\"showCheckbox\"\n      ></tree-node>\n    </li>\n  </ul>\n</template>\n<script>\n  import iCheckbox from '../checkbox/checkbox.vue';\n\n  export default {\n    name: 'TreeNode',\n    components: { iCheckbox },\n    props: {\n      data: {\n        type: Object,\n        default () {\n          return {};\n        }\n      },\n      showCheckbox: {\n        type: Boolean,\n        default: false\n      }\n    }\n  }\n</script>\n<style>\n  .tree-ul, .tree-li{\n    list-style: none;\n    padding-left: 10px;\n  }\n  .tree-expand{\n    cursor: pointer;\n  }\n</style>\n\n```\n\n`props\uff1adata` \u5305\u542b\u4e86\u5f53\u524d\u8282\u70b9\u7684\u6240\u6709\u4fe1\u606f\uff0c\u6bd4\u5982\u662f\u5426\u5c55\u5f00\u5b50\u8282\u70b9\uff08expand\uff09\u3001\u662f\u5426\u9009\u4e2d\uff08checked\uff09\u3001\u5b50\u8282\u70b9\u6570\u636e\uff08children\uff09\u7b49\u3002\n\n\u7b2c\u4e00\u90e8\u5206 expand\uff0c\u5982\u679c\u5f53\u524d\u8282\u70b9\u4e0d\u542b\u6709\u5b50\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709 children \u5b57\u6bb5\u6216 children \u7684\u957f\u5ea6\u662f 0\uff0c\u90a3\u5c31\u8bf4\u660e\u5f53\u524d\u8282\u70b9\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u7ea7\u8282\u70b9\uff0c\u6240\u4ee5\u4e0d\u542b\u6709\u5c55\u5f00 / \u6536\u8d77\u7684\u6309\u94ae\u3002\n\n\u591a\u9009\u6846\u76f4\u63a5\u4f7f\u7528\u4e86\u7b2c 7 \u8282\u7684 Checkbox \u7ec4\u4ef6\uff08\u5355\u7528\u6a21\u5f0f\uff09\uff0c\u8fd9\u91cc\u5c06 prop: value \u548c\u4e8b\u4ef6 @input \u5206\u5f00\u7ed1\u5b9a\uff0c\u6ca1\u6709\u4f7f\u7528 `v-model` \u8bed\u6cd5\u7cd6\u3002value \u7ed1\u5b9a\u7684\u6570\u636e `data.checked` \u8868\u793a\u5f53\u524d\u8282\u70b9\u662f\u5426\u9009\u4e2d\uff0c\u5728\u70b9\u51fb\u591a\u9009\u6846\u65f6\uff0chandleCheck \u65b9\u6cd5\u4f1a\u4fee\u6539 data.checked \u6570\u636e\uff0c\u4e0b\u6587\u4f1a\u5206\u6790\u3002\u8fd9\u91cc\u4e4b\u6240\u4ee5\u4e0d\u4f7f\u7528 `v-model` \u800c\u662f\u5206\u5f00\u7ed1\u5b9a\uff0c\u662f\u56e0\u4e3a @input \u91cc\u8981\u989d\u5916\u505a\u4e00\u4e9b\u5904\u7406\uff0c\u4e0d\u662f\u5355\u7eaf\u7684\u4fee\u6539\u6570\u636e\u3002\n\n\u4e0a\u4e00\u8282\u6211\u4eec\u8bf4\u5230\uff0c\u4e00\u4e2a Vue.js \u9012\u5f52\u7ec4\u4ef6\u6709\u4e24\u4e2a\u5fc5\u8981\u6761\u4ef6\uff1aname \u7279\u6027\u548c\u7ec8\u7ed3\u6761\u4ef6\u3002name \u5df2\u7ecf\u6307\u5b9a\u4e3a `TreeNode`\uff0c\u800c\u8fd9\u4e2a\u7ec8\u7ed3\u9012\u5f52\u7684\u6761\u4ef6\uff0c\u5c31\u662f `v-for=\"(item, index) in data.children\"`\uff0c\u5f53 `data.children` \u4e0d\u5b58\u5728\u6216\u4e3a\u7a7a\u6570\u7ec4\u65f6\uff0c\u81ea\u7136\u5c31\u4e0d\u4f1a\u7ee7\u7eed\u6e32\u67d3\u5b50\u8282\u70b9\uff0c\u9012\u5f52\u4e5f\u5c31\u505c\u6b62\u4e86\u3002\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684 `v-if=\"data.expand\"` \u5e76\u4e0d\u662f\u9012\u5f52\u7ec4\u4ef6\u7684\u7ec8\u7ed3\u6761\u4ef6\uff0c\u867d\u7136\u5b83\u770b\u8d77\u6765\u50cf\u662f\u4e00\u4e2a\u53ef\u4ee5\u4e3a `false` \u7684\u5224\u65ad\u8bed\u53e5\uff0c\u4f46\u5b83\u7684\u7528\u5904\u662f\u5224\u65ad\u5f53\u524d\u8282\u70b9**\u7684\u5b50\u8282\u70b9**\u662f\u5426\u5c55\u5f00\uff08\u6e32\u67d3\uff09\uff0c\u5982\u679c\u5f53\u524d\u8282\u70b9\u4e0d\u5c55\u5f00\uff0c\u90a3\u5b83\u6240\u6709\u7684\u5b50\u8282\u70b9\u4e5f\u5c31\u4e0d\u4f1a\u5c55\u5f00\uff08\u6e32\u67d3\uff09\u3002\n\n\u4e0a\u9762\u7684\u4ee3\u7801\u4fdd\u7559\u4e86\u4e24\u4e2a\u65b9\u6cd5 `handleExpand` \u4e0e `handleCheck`\uff0c\u5148\u6765\u770b\u524d\u8005\u3002\n\n\u70b9\u51fb + \u53f7\u65f6\uff0c\u4f1a\u5c55\u5f00\u76f4\u5c5e\u5b50\u8282\u70b9\uff0c\u70b9\u51fb - \u53f7\u5173\u95ed\uff0c\u8fd9\u4e00\u6b65\u53ea\u9700\u5728 `handleExpand` \u4e2d\u4fee\u6539 data \u7684 expand \u6570\u636e\u5373\u53ef\uff0c\u540c\u65f6\uff0c\u6211\u4eec\u901a\u8fc7 Tree \u7684\u6839\u7ec4\u4ef6\uff08tree.vue\uff09\u89e6\u53d1\u4e00\u4e2a\u81ea\u5b9a\u4e49\u4e8b\u4ef6 `@on-toggle-expand`\uff08\u4e0a\u6587\u5df2\u4ecb\u7ecd\uff09\uff1a\n\n```\n// node.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nimport { findComponentUpward } from '../../utils/assist.js';\n\nexport default {\n  data () {\n    return {\n      tree: findComponentUpward(this, 'Tree')\n    }\n  },\n  methods: {\n    handleExpand () {\n      this.$set(this.data, 'expand', !this.data.expand);\n\n      if (this.tree) {\n        this.tree.emitEvent('on-toggle-expand', this.data);\n      }\n    },\n  }\n}\n\n```\n\n```\n// tree.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  methods: {\n    emitEvent (eventName, data) {\n      this.$emit(eventName, data, this.cloneData);\n    }\n  }\n}\n\n```\n\n\u5728 node.vue \u4e2d\uff0c\u901a\u8fc7 `findComponentUpward` \u5411\u4e0a\u627e\u5230\u4e86 Tree \u7684\u5b9e\u4f8b\uff0c\u5e76\u8c03\u7528\u5b83\u7684 `emitEvent` \u65b9\u6cd5\u6765\u89e6\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6 `@on-toggle-expand`\u3002\u4e4b\u6240\u4ee5\u4f7f\u7528 `findComponentUpward` \u5bfb\u627e\u7ec4\u4ef6\uff0c\u800c\u4e0d\u662f\u7528 `$parent`\uff0c\u662f\u56e0\u4e3a\u5f53\u524d\u7684 node.vue\uff0c\u5b83\u7684\u7236\u7ea7\u4e0d\u4e00\u5b9a\u5c31\u662f tree.vue\uff0c\u56e0\u4e3a\u5b83\u662f\u9012\u5f52\u7ec4\u4ef6\uff0c\u7236\u7ea7\u6709\u53ef\u80fd\u8fd8\u662f\u81ea\u5df1\u3002\n\n\u8fd9\u91cc\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0c\u4fee\u6539 data.expand\uff0c\u6211\u4eec\u662f\u901a\u8fc7 Vue \u7684 `$set` \u65b9\u6cd5\u6765\u4fee\u6539\uff0c\u5e76\u6ca1\u6709\u50cf\u4e0b\u9762\u8fd9\u6837\u4fee\u6539\uff1a\n\n```\nthis.data.expand = !this.data.expand;\n\n```\n\n\u8fd9\u6837\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u5982\u679c\u76f4\u63a5\u7528\u4e0a\u9762\u8fd9\u884c\u4ee3\u7801\u4fee\u6539\uff0c\u53d1\u73b0\u6570\u636e\u867d\u7136\u88ab\u4fee\u6539\u4e86\uff0c\u4f46\u662f\u89c6\u56fe\u5e76\u6ca1\u6709\u66f4\u65b0\uff08\u539f\u6765\u662f + \u53f7\uff0c\u70b9\u51fb\u540e\u8fd8\u662f + \u53f7\uff09\u3002\u8981\u7406\u89e3\u8fd9\u91cc\uff0c\u6211\u4eec\u5148\u770b\u4e0b\uff0c\u5230\u5e95\u4fee\u6539\u4e86\u4ec0\u4e48\u3002\u8fd9\u91cc\u7684 `this.data`\uff0c\u662f\u4e00\u4e2a props\uff0c\u5b83\u662f\u901a\u8fc7\u4e0a\u4e00\u7ea7\u4f20\u9012\u7684\uff0c\u8fd9\u4e2a\u4e0a\u4e00\u7ea7\u6709\u4e24\u79cd\u53ef\u80fd\uff0c\u4e00\u79cd\u662f\u9012\u5f52\u7684 node.vue\uff0c\u4e00\u79cd\u662f\u6839\u7ec4\u4ef6 tree.vue\uff0c\u4f46\u662f\u9012\u5f52\u7684 node.vue\uff0c\u6700\u7ec8\u4e5f\u662f\u7531 tree.vue \u4f20\u9012\u7684\uff0c\u8ffd\u6839\u6eaf\u6e90\uff0c\u8981\u4fee\u6539\u7684 `this.data` \u4e8b\u5b9e\u4e0a\u662f tree.vue \u7684 `cloneData`\u3002cloneData \u91cc\u7684\u8282\u70b9\u6570\u636e\uff0c\u662f\u4e0d\u4e00\u5b9a\u542b\u6709 `expand` \u6216 `checked` \u5b57\u6bb5\u7684\uff0c\u5982\u679c\u4e0d\u542b\u6709\uff0c\u76f4\u63a5\u901a\u8fc7 `this.data.expand` \u4fee\u6539\uff0c\u8fd9\u4e2a expand \u5c31\u4e0d\u662f\u53ef\u54cd\u5e94\u7684\u6570\u636e\uff0cVue.js \u662f\u65e0\u6cd5\u8ffd\u8e2a\u5230\u5b83\u7684\u53d8\u5316\uff0c\u89c6\u56fe\u81ea\u7136\u4e0d\u4f1a\u66f4\u65b0\uff0c\u800c `$set` \u7684\u7528\u6cd5\u5c31\u662f\u5bf9\u53ef\u54cd\u5e94\u5bf9\u8c61\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5c5e\u6027\uff0c\u5e76\u786e\u4fdd\u8fd9\u4e2a\u65b0\u5c5e\u6027\u540c\u6837\u662f\u54cd\u5e94\u5f0f\u7684\uff0c\u4e14\u89e6\u53d1\u89c6\u56fe\u66f4\u65b0\u3002\u603b\u7ed3\u6765\u8bf4\uff0c\u5982\u679c expand \u5b57\u6bb5\u4e00\u5f00\u59cb\u662f\u5b58\u5728\u7684\uff08\u4e0d\u7ba1 true \u6216 false\uff09\uff0c\u4e0d\u7ba1\u7528\u54ea\u79cd\u65b9\u5f0f\u4fee\u6539\u90fd\u662f\u53ef\u4ee5\u7684\uff0c\u5426\u5219\u5fc5\u987b\u7528 `$set` \u4fee\u6539\uff0c\u7ed3\u5408\u8d77\u6765\uff0c\u5e72\u8106\u76f4\u63a5\u7528 $set \u4e86\u3002\u540c\u7406\uff0c\u540e\u6587\u7684 `checked` \u4e5f\u662f\u4e00\u6837\u3002\n\n\u63a5\u4e0b\u6765\u662f\u6574\u4e2a Tree \u7ec4\u4ef6\u6700\u590d\u6742\u7684\u4e00\u90e8\u5206\uff0c\u5c31\u662f\u5904\u7406\u8282\u70b9\u7684\u54cd\u5e94\u72b6\u6001\u3002\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0c\u4e0d\u5c31\u662f\u9009\u4e2d\u6216\u53d6\u6d88\u9009\u4e2d\u5417\uff0c\u8ddf expand \u4e00\u6837\uff0c\u4fee\u6539\u6570\u636e\u5c31\u884c\u4e86\uff1f\u5982\u679c\u53ea\u662f\u8003\u8651\u4e00\u4e2a\u8282\u70b9\uff0c\u7684\u786e\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f46\u6811\u7ec4\u4ef6\u662f\u6709\u4e0a\u4e0b\u7ea7\u5173\u7cfb\u7684\uff0c\u5b83\u4eec\u5206\u4e3a\u4e24\u79cd\u903b\u8f91\uff0c\u5f53\u9009\u4e2d\uff08\u6216\u53d6\u6d88\u9009\u4e2d\uff09\u4e00\u4e2a\u8282\u70b9\u65f6\uff1a\n\n1.  \u5b83\u4e0b\u9762\u7684\u6240\u6709\u5b50\u8282\u70b9\u90fd\u4f1a\u88ab\u9009\u4e2d\uff1b\n2.  \u5982\u679c\u540c\u4e00\u7ea7\u6240\u6709\u5b50\u8282\u70b9\u9009\u4e2d\u65f6\uff0c\u5b83\u7684\u7236\u7ea7\u4e5f\u81ea\u52a8\u9009\u4e2d\uff0c\u4e00\u76f4\u9012\u5f52\u5224\u65ad\u5230\u6839\u8282\u70b9\u3002\n\n\u7b2c 1 \u4e2a\u903b\u8f91\u76f8\u5bf9\u7b80\u5355\uff0c\u5f53\u9009\u4e2d\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u53ea\u8981\u9012\u5f52\u5730\u904d\u5386\u5b83\u4e0b\u9762\u6240\u5c5e\u7684\u6240\u6709\u5b50\u8282\u70b9\u6570\u636e\uff0c\u4fee\u6539\u6240\u6709\u7684 `checked` \u5b57\u6bb5\u5373\u53ef\uff1a\n\n```\n// node.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  methods: {\n    handleCheck (checked) {\n      this.updateTreeDown(this.data, checked);\n\n      if (this.tree) {\n        this.tree.emitEvent('on-check-change', this.data);\n      }\n    },\n    updateTreeDown (data, checked) {\n      this.$set(data, 'checked', checked);\n\n      if (data.children && data.children.length) {\n        data.children.forEach(item => {\n          this.updateTreeDown(item, checked);\n        });\n      }\n    }\n  }\n}\n\n```\n\nupdateTreeDown \u53ea\u662f\u5411\u4e0b\u4fee\u6539\u4e86\u6240\u6709\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u5f53\u524d\u8282\u70b9\u7684\u6570\u636e\u91cc\uff0c\u662f\u5305\u542b\u5176\u6240\u6709\u5b50\u8282\u70b9\u6570\u636e\u7684\uff0c\u901a\u8fc7\u9012\u5f52\u904d\u5386\u53ef\u4ee5\u8f7b\u677e\u4fee\u6539\uff0c\u8fd9\u4e5f\u662f\u7b2c 1 \u79cd\u903b\u8f91\u7b80\u5355\u7684\u539f\u56e0\u3002\n\n\u518d\u6765\u770b\u7b2c 2 \u4e2a\u903b\u8f91\uff0c\u5b83\u7684\u96be\u70b9\u5728\u4e8e\uff0c\u65e0\u6cd5\u901a\u8fc7\u5f53\u524d\u8282\u70b9\u6570\u636e\uff0c\u4fee\u6539\u5230\u5b83\u7684\u7236\u8282\u70b9\uff0c\u56e0\u4e3a\u62ff\u4e0d\u5230\u3002\u5199\u5230\u8fd9\u91cc\uff0c\u6b63\u5e38\u7684\u601d\u8def\u5e94\u8be5\u662f\u5728 `this.updateTreeDown(this.data, checked);` \u7684\u4e0b\u9762\u518d\u5199\u4e00\u4e2a `updateTreeUp` \u7684\u65b9\u6cd5\uff0c\u5411\u4e0a\u904d\u5386\uff0c\u95ee\u9898\u5c31\u662f\uff0c\u600e\u6837\u5411\u4e0a\u904d\u5386\uff0c\u4e00\u79cd\u5e38\u89c4\u7684\u601d\u8def\u662f\uff0c\u628a `updateTreeUp` \u65b9\u6cd5\u5199\u5728 tree.vue \u91cc\uff0c\u5e76\u4e14\u5728 node.vue \u7684 `handleCheck` \u65b9\u6cd5\u91cc\uff0c\u901a\u8fc7 this.tree \u8c03\u7528\u6839\u7ec4\u4ef6\u7684 `updateTreeUp`\uff0c\u5e76\u4e14\u4f20\u9012\u5f53\u524d\u8282\u70b9\u7684\u6570\u636e\uff0c\u5728 tree.vue \u91cc\uff0c\u8981\u627e\u5230\u5f53\u524d\u8282\u70b9\u7684\u4f4d\u7f6e\uff0c\u90a3\u8fd8\u9700\u8981\u4e00\u5f00\u59cb\u5728 cloneData \u91cc\u9884\u5148\u7ed9\u6bcf\u4e2a\u8282\u70b9\u8bbe\u7f6e\u4e00\u4e2a\u552f\u4e00\u7684 key\uff0c\u540e\u9762\u7684\u903b\u8f91\u8bfb\u8005\u5e94\u8be5\u80fd\u60f3\u5230\u4e86\uff0c\u5c31\u662f\u901a\u8fc7 key \u627e\u5230\u8282\u70b9\u4f4d\u7f6e\uff0c\u5e76\u5411\u4e0a\u9012\u5f52\u5224\u65ad\u2026\u2026\u4f46\u662f\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u60f3\u7740\u5c31\u9ebb\u70e6\u3002\n\n\u6b63\u5e38\u7684\u601d\u8def\u4e0d\u592a\u597d\u89e3\u51b3\uff0c\u6211\u4eec\u5c31\u6362\u4e2a\u601d\u8def\u3002\u4e00\u4e2a\u8282\u70b9\uff0c\u9664\u4e86\u624b\u52a8\u9009\u4e2d\uff08\u6216\u53cd\u9009\uff09\uff0c\u8fd8\u6709\u5c31\u662f\u7b2c 2 \u79cd\u903b\u8f91\u7684\u88ab\u52a8\u9009\u4e2d\uff08\u6216\u53cd\u9009\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8fd9\u4e2a\u8282\u70b9\u7684\u6240\u6709\u76f4\u5c5e\u5b50\u8282\u70b9\uff08\u5c31\u662f\u5b83\u7684\u7b2c\u4e00\u7ea7\u5b50\u8282\u70b9\uff09\u90fd\u9009\u4e2d\uff08\u6216\u53cd\u9009\uff09\u65f6\uff0c\u8fd9\u4e2a\u8282\u70b9\u5c31\u81ea\u52a8\u88ab\u9009\u4e2d\uff08\u6216\u53cd\u9009\uff09\uff0c\u9012\u5f52\u5730\uff0c\u53ef\u4ee5\u4e00\u7ea7\u4e00\u7ea7\u54cd\u5e94\u4e0a\u53bb\u3002\u6709\u4e86\u8fd9\u4e2a\u601d\u8def\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 `watch` \u6765\u76d1\u542c\u5f53\u524d\u8282\u70b9\u7684\u5b50\u8282\u70b9\u662f\u5426\u90fd\u9009\u4e2d\uff0c\u8fdb\u800c\u4fee\u6539\u5f53\u524d\u7684 `checked` \u5b57\u6bb5\uff1a\n\n```\n// node.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  watch: {\n    'data.children': {\n      handler (data) {\n        if (data) {\n          const checkedAll = !data.some(item => !item.checked);\n          this.$set(this.data, 'checked', checkedAll);\n        }\n      },\n      deep: true\n    }\n  }\n}\n\n```\n\n\u5728 watch \u4e2d\uff0c\u76d1\u542c\u4e86 data.children \u7684\u6539\u53d8\uff0c\u5e76\u4e14\u662f\u6df1\u5ea6\u76d1\u542c\u7684\u3002\u8fd9\u6bb5\u4ee3\u7801\u7684\u610f\u601d\u662f\uff0c\u5f53 `data.children` \u4e2d\u7684\u6570\u636e\u7684\u67d0\u4e2a\u5b57\u6bb5\u53d1\u751f\u53d8\u5316\u65f6\uff08\u8fd9\u91cc\u5f53\u7136\u662f\u6307 checked \u5b57\u6bb5\uff09,\u4e5f\u5c31\u662f\u8bf4\u5b83\u7684\u67d0\u4e2a\u5b50\u8282\u70b9\u88ab\u9009\u4e2d\uff08\u6216\u53cd\u9009\uff09\u4e86\uff0c\u8fd9\u65f6\u6267\u884c\u7ed1\u5b9a\u7684\u53e5\u67c4 handler \u4e2d\u7684\u903b\u8f91\u3002`const checkedAll = !data.some(item => !item.checked);` \u4e5f\u662f\u4e00\u4e2a\u5de7\u5999\u7684\u7f29\u5199\uff0ccheckedAll \u6700\u7ec8\u8fd4\u56de\u7ed3\u679c\u5c31\u662f\u5f53\u524d\u5b50\u8282\u70b9\u662f\u5426\u90fd\u88ab\u9009\u4e2d\u4e86\u3002\n\n\u8fd9\u91cc\u975e\u5e38\u5de7\u5999\u5730\u5229\u7528\u4e86\u9012\u5f52\u7684\u7279\u6027\uff0c\u56e0\u4e3a node.vue \u662f\u4e00\u4e2a\u9012\u5f52\u7ec4\u4ef6\uff0c\u90a3\u6bcf\u4e00\u4e2a\u7ec4\u4ef6\u91cc\u90fd\u4f1a\u6709 watch \u76d1\u542c `data.children`\uff0c\u8981\u77e5\u9053\uff0c\u5f53\u524d\u7684\u8282\u70b9\u6709\u4e24\u4e2a\u201d\u8eab\u4efd\u201c\uff0c\u5b83\u65e2\u662f\u4e0b\u5c5e\u8282\u70b9\u7684\u7236\u8282\u70b9\uff0c\u540c\u65f6\u4e5f\u662f\u4e0a\u7ea7\u8282\u70b9\u7684\u5b50\u8282\u70b9\uff0c\u5b83\u4f5c\u4e3a\u4e0b\u5c5e\u8282\u70b9\u7684\u7236\u8282\u70b9\u88ab\u4fee\u6539\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u89e6\u53d1\u4e0a\u7ea7\u8282\u70b9\u4e2d\u7684 watch \u76d1\u542c\u51fd\u6570\u3002**\u8fd9\u5c31\u662f\u9012\u5f52**\u3002\n\n\u4ee5\u4e0a\u5c31\u662f Tree \u7ec4\u4ef6\u7684\u6240\u6709\u5185\u5bb9\uff0c\u5b8c\u6574\u7684\u4ee3\u7801\u89c1\uff1a [https://github.com/icarusion/vue-component-book/tree/master/src/components/tree](https://github.com/icarusion/vue-component-book/tree/master/src/components/tree)\n\n\u7528\u4f8b\uff1a[https://github.com/icarusion/vue-component-book/blob/master/src/views/tree.vue](https://github.com/icarusion/vue-component-book/blob/master/src/views/tree.vue)\n\n## \u7ed3\u8bed\n\n\u9012\u5f52\u5c31\u50cf\u4eba\u7c7b\u7e41\u884d\u4e00\u6837\uff0c\u8574\u85cf\u4e86\u65e0\u9650\u53ef\u80fd\uff0c\u5145\u6ee1\u7740\u795e\u5947\u4e0e\u667a\u6167\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [\u6d45\u62f7\u8d1d\u4e0e\u6df1\u62f7\u8d1d](https://juejin.im/post/5b5dcf8351882519790c9a2e)\n\n\u6ce8\uff1a\u672c\u8282\u90e8\u5206\u4ee3\u7801\u53c2\u8003 [iView](https://github.com/iview/iview/blob/2.0/src/utils/assist.js#L114)\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5b9e\u6218_7\u6811\u5f62\u63a7\u4ef6Tree.md", "create_date": "2020-02-18T21:37:08.935", "order": 15}}, {"model": "subject.chapter", "pk": 109, "fields": {"title": "\u62d3\u5c55\uff1aVue.js \u9762\u8bd5\u3001\u5e38\u89c1\u95ee\u9898\u7b54\u7591", "topic": 5, "md5": "bc0cf579ae14f1ead3a6fc490362e900", "md_body": "# \u62d3\u5c55\uff1aVue.js \u9762\u8bd5\u3001\u5e38\u89c1\u95ee\u9898\u7b54\u7591\n\n\u5728\u8fc7\u53bb\u7684\u5f88\u591a\u9762\u8bd5\u4e2d\uff0c\u6211\u4f1a\u7ecf\u5e38\u95ee\u5019\u9009\u4eba\u4e00\u4e9b\u5173\u4e8e Vue.js \u7684\u95ee\u9898\u3002\u8fd9\u4e9b\u95ee\u9898\u4ece\u9898\u9762\u6765\u770b\u5f88\u7b80\u5355\uff0c\u4f46\u4ed4\u7ec6\u60f3\u53c8\u4e0d\u662f\u90a3\u4e48\u7b80\u5355\uff0c\u4e0d\u540c\u7684\u4eba\uff0c\u4f1a\u7b54\u51fa\u4e0d\u540c\u7684\u5c42\u6b21\uff0c\u4ece\u800c\u66f4\u597d\u5730\u4e86\u89e3\u4e00\u4e2a\u4eba\u5bf9 Vue.js \u7684\u7406\u89e3\u7a0b\u5ea6\u3002\n\n## \u9898\u76ee\n\n### v-show \u4e0e v-if \u533a\u522b\n\n\u7b2c\u4e00\u9898\u5e94\u8be5\u662f\u6700\u7b80\u5355\u7684\uff0c\u63d0\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e5f\u662f\u60f3\u8ba9\u5019\u9009\u4eba\u4e0d\u90a3\u4e48\u7d27\u5f20\uff0c\u56e0\u4e3a\u4f46\u51e1\u7528\u8fc7 Vue.js\uff0c\u591a\u5c11\u77e5\u9053 `v-show` \u548c `v-if` \u7684\u533a\u522b\uff0c\u5426\u5219\u5c31\u6ca1\u5f97\u804a\u4e86\u3002\u4e0d\u8fc7\u8fd9\u6700\u7b80\u5355\u7684\u4e00\u9053\u9898\uff0c\u6709\u4e09\u4e2a\u5c42\u6b21\uff0c\u6211\u4f1a\u9010\u4e00\u8ffd\u95ee\u3002\u9996\u5148\uff0c\u57fa\u672c\u6240\u6709\u4eba\u90fd\u4f1a\u8bf4\u5230\uff1a\n\n`v-show` \u53ea\u662f CSS \u7ea7\u522b\u7684 `display: none;` \u548c `display: block;` \u4e4b\u95f4\u7684\u5207\u6362\uff0c\u800c `v-if` \u51b3\u5b9a\u662f\u5426\u4f1a\u9009\u62e9\u4ee3\u7801\u5757\u7684\u5185\u5bb9\uff08\u6216\u7ec4\u4ef6\uff09\u3002\n\n\u56de\u7b54\u8fd9\u4e9b\uff0c\u5df2\u7ecf\u53ef\u4ee5\u5f97\u5230 50 \u5206\u4e86\uff0c\u7d27\u63a5\u7740\u6211\u4f1a\u8ffd\u95ee\uff0c\u4ec0\u4e48\u65f6\u5019\u7528 v-show\uff0c\u4ec0\u4e48\u65f6\u5019\u7528 v-if \uff1f\u5230\u8fd9\u91cc\u4e00\u90e8\u5206\u4eba\u4f1a\u6bd4\u8f83\u541e\u5410\uff0c\u53ef\u80fd\u662f\u77e5\u9053\uff0c\u4f46\u8868\u8fbe\u4e0d\u51fa\u6765\u3002\u6211\u6bd4\u8f83\u503e\u5411\u7684\u56de\u7b54\u662f\uff1a\n\n\u9891\u7e41\u64cd\u4f5c\u65f6\uff0c\u4f7f\u7528 `v-show`\uff0c\u4e00\u6b21\u6027\u6e32\u67d3\u5b8c\u7684\uff0c\u4f7f\u7528 `v-if`\uff0c\u53ea\u8981\u610f\u601d\u5bf9\u5c31\u597d\u3002\n\n\u7b2c\u4e8c\u95ee\u53ef\u4ee5\u5f97\u5230 80 \u5206\u4e86\uff0c\u6700\u540e\u4e00\u95ee\u5f88\u5c11\u6709\u4eba\u80fd\u7b54\u4e0a\uff1a\\*\\*\u90a3\u4f7f\u7528 `v-if` \u5728\u6027\u80fd\u4f18\u5316\u4e0a\u6709\u4ec0\u4e48\u7ecf\u9a8c\uff1f\\*\\*\u8fd9\u662f\u4e00\u4e2a\u52a0\u5206\u9879\uff0c\u8981\u5bf9 Vue.js \u7684\u7ec4\u4ef6\u7f16\u8bd1\u6709\u4e00\u5b9a\u7684\u7406\u89e3\u3002\u8bf4\u4e00\u4e0b\u671f\u671b\u7684\u7b54\u6848\uff1a\n\n\u56e0\u4e3a\u5f53 `v-if=\"false\"` \u65f6\uff0c\u5185\u90e8\u7ec4\u4ef6\u662f\u4e0d\u4f1a\u6e32\u67d3\u7684\uff0c\u6240\u4ee5\u5728\u7279\u5b9a\u6761\u4ef6\u624d\u6e32\u67d3\u90e8\u5206\u7ec4\u4ef6\uff08\u6216\u5185\u5bb9\uff09\u65f6\uff0c\u53ef\u4ee5\u5148\u5c06\u6761\u4ef6\u8bbe\u7f6e\u4e3a `false`\uff0c\u9700\u8981\u65f6\uff08\u6216\u5f02\u6b65\uff0c\u6bd4\u5982 $nextTick\uff09\u518d\u8bbe\u7f6e\u4e3a `true`\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f18\u5148\u6e32\u67d3\u91cd\u8981\u7684\u5176\u5b83\u5185\u5bb9\uff0c\u5408\u7406\u5229\u7528\uff0c\u53ef\u4ee5\u8fdb\u884c\u6027\u80fd\u4f18\u5316\u3002\n\n### \u7ed1\u5b9a class \u7684\u6570\u7ec4\u7528\u6cd5\n\n\u52a8\u6001\u7ed1\u5b9a class \u5e94\u8be5\u4e0d\u964c\u751f\u5427\uff0c\u8fd9\u4e5f\u662f\u6700\u57fa\u672c\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u95ee\u9898\u5374\u6709\u70b9\u7ed5\uff0c\u4ec0\u4e48\u53eb\\*\\*\u7ed1\u5b9a class \u7684\u6570\u7ec4\u7528\u6cd5\uff1f\\*\\*\u6211\u4eec\u770b\u4e00\u4e0b\uff0c\u6700\u5e38\u7528\u7684\u7ed1\u5b9a class \u600e\u4e48\u5199\uff1a\n\n```\n<template>\n  <div :class=\"{show: isShow}\">\u5185\u5bb9</div>\n</template>\n<script>\n  export default {\n    data () {\n      return {\n        isShow: true\n      }\n    }\n  }\n</script>\n\n```\n\n\u7ed1\u5b9a class \u7684\u5bf9\u8c61\u7528\u6cd5\u80fd\u6ee1\u8db3\u5927\u90e8\u5206\u4e1a\u52a1\u9700\u6c42\uff0c\u4e0d\u8fc7\uff0c\u5728\u590d\u6742\u7684\u573a\u666f\u4e0b\uff0c\u4f1a\u7528\u5230**\u6570\u7ec4**\uff0c\u6765\u770b\u793a\u4f8b\uff1a\n\n```\n<template>\n  <div :class=\"classes\"></div>\n</template>\n<script>\n  export default {\n    computed: {\n      classes () {\n        return [\n          `${prefixCls}`,\n          `${prefixCls}-${this.type}`,\n          {\n            [`${prefixCls}-long`]: this.long,\n            [`${prefixCls}-${this.shape}`]: !!this.shape,\n            [`${prefixCls}-${this.size}`]: this.size !== 'default',\n            [`${prefixCls}-loading`]: this.loading != null && this.loading,\n            [`${prefixCls}-icon-only`]: !this.showSlot && (!!this.icon || !!this.customIcon || this.loading),\n            [`${prefixCls}-ghost`]: this.ghost\n          }\n        ];\n      }\n    }\n  }\n</script>\n\n```\n\n\u793a\u4f8b\u6765\u81ea iView \u7684 Button \u7ec4\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u6570\u7ec4\u91cc\uff0c\u53ef\u4ee5\u662f\u56fa\u5b9a\u7684\u503c\uff0c\u8fd8\u6709\u52a8\u6001\u503c\uff08\u5bf9\u8c61\uff09\u7684\u6df7\u5408\u3002\n\n### \u8ba1\u7b97\u5c5e\u6027\u548c watch \u7684\u533a\u522b\n\n\u56de\u7b54\u8be5\u9898\u524d\uff0c\u4e00\u822c\u90fd\u4f1a\u601d\u8003\u4e00\u4e0b\u3002\u5f88\u591a\u4eba\u4f1a\u504f\u9898\uff0c\u76f4\u63a5\u53bb\u7b54\u8ba1\u7b97\u5c5e\u6027\u548c watch \u600e\u4e48\u7528\uff0c\u8fd9\u662f\u4e0d\u5f97\u5206\u7684\uff0c\u56e0\u4e3a\u9898\u76ee\u662f\u95ee**\u533a\u522b**\uff0c\u5e76\u4e0d\u662f\u7528\u6cd5\u3002\n\n\u8ba1\u7b97\u5c5e\u6027\u662f\u81ea\u52a8\u76d1\u542c\u4f9d\u8d56\u503c\u7684\u53d8\u5316\uff0c\u4ece\u800c\u52a8\u6001\u8fd4\u56de\u5185\u5bb9\uff0c\u76d1\u542c\u662f\u4e00\u4e2a\u8fc7\u7a0b\uff0c\u5728\u76d1\u542c\u7684\u503c\u53d8\u5316\u65f6\uff0c\u53ef\u4ee5\u89e6\u53d1\u4e00\u4e2a\u56de\u8c03\uff0c\u5e76\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002\n\n\u6240\u4ee5\u533a\u522b\u6765\u6e90\u4e8e\u7528\u6cd5\uff0c\u53ea\u662f\u9700\u8981\u52a8\u6001\u503c\uff0c\u90a3\u5c31\u7528\u8ba1\u7b97\u5c5e\u6027\uff1b\u9700\u8981\u77e5\u9053\u503c\u7684\u6539\u53d8\u540e\u6267\u884c\u4e1a\u52a1\u903b\u8f91\uff0c\u624d\u7528 watch\uff0c\u7528\u53cd\u6216\u6df7\u7528\u867d\u7136\u53ef\u884c\uff0c\u4f46\u90fd\u662f\u4e0d\u6b63\u786e\u7684\u7528\u6cd5\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u4f1a\u5ef6\u4f38\u51fa\u51e0\u4e2a\u95ee\u9898\uff1a\n\n1.  computed \u662f\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u5b83\u6709\u54ea\u4e9b\u9009\u9879\uff1f\n    \n2.  computed \u548c methods \u6709\u4ec0\u4e48\u533a\u522b\uff1f\n    \n3.  computed \u662f\u5426\u80fd\u4f9d\u8d56\u5176\u5b83\u7ec4\u4ef6\u7684\u6570\u636e\uff1f\n    \n4.  watch \u662f\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u5b83\u6709\u54ea\u4e9b\u9009\u9879\uff1f\n    \n\n\u95ee\u9898 1\uff0c\u5df2\u7ecf\u5728 16 \u5c0f\u8282\u4ecb\u7ecd\u8fc7\uff0c\u6709 get \u548c set \u4e24\u4e2a\u9009\u9879\u3002\n\n\u95ee\u9898 2\uff0cmethods \u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5b83\u53ef\u4ee5\u63a5\u53d7\u53c2\u6570\uff0c\u800c computed \u4e0d\u80fd\uff1bcomputed \u662f\u53ef\u4ee5\u7f13\u5b58\u7684\uff0cmethods \u4e0d\u4f1a\uff1b\u4e00\u822c\u5728 `v-for` \u91cc\uff0c\u9700\u8981\u6839\u636e\u5f53\u524d\u9879\u52a8\u6001\u7ed1\u5b9a\u503c\u65f6\uff0c\u53ea\u80fd\u7528 methods \u800c\u4e0d\u80fd\u7528 computed\uff0c\u56e0\u4e3a computed \u4e0d\u80fd\u4f20\u53c2\u3002\n\n\u95ee\u9898 3\uff0ccomputed \u53ef\u4ee5\u4f9d\u8d56\u5176\u5b83 computed\uff0c\u751a\u81f3\u662f\u5176\u5b83\u7ec4\u4ef6\u7684 data\u3002\n\n\u95ee\u9898 4\uff0c\u7b2c 16 \u5c0f\u8282\u4e5f\u6709\u63d0\u5230\uff0c\u6709\u4ee5\u4e0b\u5e38\u7528\u7684\u914d\u7f6e\uff1a\n\n*   handler \u6267\u884c\u7684\u51fd\u6570\n*   deep \u662f\u5426\u6df1\u5ea6\n*   immediate \u662f\u5426\u7acb\u5373\u6267\u884c\n\n### \u4e8b\u4ef6\u4fee\u9970\u7b26\n\n\u8fd9\u4e2a\u95ee\u9898\u6211\u4f1a\u5148\u5199\u4e00\u6bb5\u4ee3\u7801\uff1a\n\n```\n<custom-component>\u5185\u5bb9</custom-component>\n\n```\n\n\u7136\u540e\u95ee\uff1a**\u600e\u6837\u7ed9\u8fd9\u4e2a\u81ea\u5b9a\u4e49\u7ec4\u4ef6 custom-component \u7ed1\u5b9a\u4e00\u4e2a`\u539f\u751f`\u7684 click \u4e8b\u4ef6\uff1f**\n\n\u6211\u4e00\u5f00\u59cb\u5e76\u4e0d\u4f1a\u95ee\u4ec0\u4e48\u662f\u4e8b\u4ef6\u4fee\u9970\u7b26\uff0c\u4f46\u662f\u5982\u679c\u5019\u9009\u4eba\u8bf4 `<custom-component @click=\"xxx\">`\uff0c\u5c31\u5df2\u7ecf\u9519\u4e86\uff0c\u8bf4\u660e\u5b83\u5bf9\u8fd9\u4e2a\u6ca1\u6709\u6982\u5ff5\u3002\u8fd9\u91cc\u7684 `@click` \u662f\u81ea\u5b9a\u4e49\u4e8b\u4ef6 click\uff0c\u5e76\u4e0d\u662f\u539f\u751f\u4e8b\u4ef6 click\u3002\u7ed1\u5b9a\u539f\u751f\u7684 click \u662f\u8fd9\u6837\u7684\uff1a\n\n```\n<custom-component @click.native=\"xxx\">\u5185\u5bb9</custom-component>\n\n```\n\n\u8be5\u95ee\u9898\u4f1a\u5f15\u7533\u5f88\u591a\uff0c\u6bd4\u5982\u5e38\u89c1\u7684\u4e8b\u4ef6\u4fee\u9970\u7b26\u6709\u54ea\u4e9b\uff1f\u5982\u679c\u4f60\u80fd\u8bf4\u4e0a `.exact`\uff0c\u8bf4\u660e\u4f60\u662f\u4e2a\u5f88\u7231\u63a2\u7d22\u7684\u4eba\uff0c\u4f1a\u5927\u5927\u52a0\u5206\u54e6\u3002\n\n> .exact \u662f Vue.js 2.5.0 \u65b0\u52a0\u7684\uff0c\u5b83\u5141\u8bb8\u4f60\u63a7\u5236\u7531\u7cbe\u786e\u7684\u7cfb\u7edf\u4fee\u9970\u7b26\u7ec4\u5408\u89e6\u53d1\u7684\u4e8b\u4ef6\uff0c\u6bd4\u5982\uff1a\n> \n> ```\n> <!-- \u5373\u4f7f Alt \u6216 Shift \u88ab\u4e00\u540c\u6309\u4e0b\u65f6\u4e5f\u4f1a\u89e6\u53d1 -->\n> <button @click.ctrl=\"onClick\">A</button>\n> \n> <!-- \u6709\u4e14\u53ea\u6709 Ctrl \u88ab\u6309\u4e0b\u7684\u65f6\u5019\u624d\u89e6\u53d1 -->\n> <button @click.ctrl.exact=\"onCtrlClick\">A</button>\n> \n> <!-- \u6ca1\u6709\u4efb\u4f55\u7cfb\u7edf\u4fee\u9970\u7b26\u88ab\u6309\u4e0b\u7684\u65f6\u5019\u624d\u89e6\u53d1 -->\n> <button @click.exact=\"onClick\">A</button>\n> \n> ```\n\n\u4f60\u53ef\u80fd\u8fd8\u9700\u8981\u4e86\u89e3\u5e38\u7528\u7684\u51e0\u4e2a\u4e8b\u4ef6\u4fee\u9970\u7b26\uff1a\n\n*   `.stop`\n*   `.prevent`\n*   `.capture`\n*   `.self`\n\n\u800c\u4e14\uff0c\u4e8b\u4ef6\u4fee\u9970\u7b26\u5728\u8fde\u7528\u65f6\uff0c\u662f\u6709\u5148\u540e\u987a\u5e8f\u7684\u3002\n\n### \u7ec4\u4ef6\u4e2d data \u4e3a\u4ec0\u4e48\u662f\u51fd\u6570\n\n\u4e3a\u4ec0\u4e48\u7ec4\u4ef6\u4e2d\u7684 data \u5fc5\u987b\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u7136\u540e return \u4e00\u4e2a\u5bf9\u8c61\uff0c\u800c new Vue \u5b9e\u4f8b\u91cc\uff0cdata \u53ef\u4ee5\u76f4\u63a5\u662f\u4e00\u4e2a\u5bf9\u8c61\uff1f\n\n\u56e0\u4e3a\u7ec4\u4ef6\u662f\u7528\u6765\u590d\u7528\u7684\uff0cJS \u91cc\u5bf9\u8c61\u662f\u5f15\u7528\u5173\u7cfb\uff0c\u8fd9\u6837\u4f5c\u7528\u57df\u6ca1\u6709\u9694\u79bb\uff0c\u800c new Vue \u7684\u5b9e\u4f8b\uff0c\u662f\u4e0d\u4f1a\u88ab\u590d\u7528\u7684\uff0c\u56e0\u6b64\u4e0d\u5b58\u5728\u5f15\u7528\u5bf9\u8c61\u7684\u95ee\u9898\u3002\n\n### keep-alive \u7684\u7406\u89e3\n\n\u8fd9\u662f\u4e2a\u6982\u5ff5\u9898\uff0c\u4e3b\u8981\u8003\u5bdf\u5019\u9009\u4eba\u662f\u5426\u77e5\u9053\u8fd9\u4e2a\u7528\u6cd5\u3002\u7b80\u5355\u8bf4\uff0c\u5c31\u662f\u628a\u4e00\u4e2a\u7ec4\u4ef6\u7684\u7f16\u8bd1\u7f13\u5b58\u8d77\u6765\u3002\u5728\u7b2c 14 \u8282\u6709\u8fc7\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u4e5f\u53ef\u4ee5\u770b\u770b [Vue.js \u7684\u6587\u6863](https://cn.vuejs.org/v2/guide/components-dynamic-async.html#%E5%9C%A8%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BD%BF%E7%94%A8-keep-alive)\u3002\n\n### \u9012\u5f52\u7ec4\u4ef6\u7684\u8981\u6c42\n\n\u56de\u7b54\u8fd9\u9053\u9898\uff0c\u9996\u5148\u4f60\u5f97\u77e5\u9053\u4ec0\u4e48\u662f**\u9012\u5f52\u7ec4\u4ef6**\u3002\u800c\u4e0d\u5230 10% \u7684\u4eba\u77e5\u9053\u9012\u5f52\u7ec4\u4ef6\u3002\u5176\u5b9e\u5728\u5b9e\u9645\u4e1a\u52a1\u4e2d\u7528\u7684\u786e\u5b9e\u4e0d\u591a\uff0c\u5728\u72ec\u7acb\u7ec4\u4ef6\u4e2d\u4f1a\u7ecf\u5e38\u4f7f\u7528\uff0c\u7b2c 14 \u8282\u548c 15 \u8282\u4e13\u95e8\u8bb2\u8fc7\u9012\u5f52\u7ec4\u4ef6\u3002\u90a3\u56de\u5230\u95ee\u9898\uff0c\u9012\u5f52\u7ec4\u4ef6\u7684\u8981\u6c42\u662f\u4ec0\u4e48\uff1f\u4e3b\u8981\u6709\u4e24\u4e2a\uff1a\n\n*   \u8981\u7ed9\u7ec4\u4ef6\u8bbe\u7f6e **name**\uff1b\n*   \u8981\u6709\u4e00\u4e2a\u660e\u786e\u7684\u7ed3\u675f\u6761\u4ef6\u3002\n\n### \u81ea\u5b9a\u4e49\u7ec4\u4ef6\u7684\u8bed\u6cd5\u7cd6 v-model \u662f\u600e\u6837\u5b9e\u73b0\u7684\n\n\u5728\u7b2c 16 \u8282\u5df2\u7ecf\u8be6\u7ec6\u4ecb\u7ecd\u8fc7\uff0c\u8fd9\u91cc\u7684 v-model\uff0c\u5e76\u4e0d\u662f\u7ed9\u666e\u901a\u8f93\u5165\u6846 `<input />` \u7528\u7684\u90a3\u79cd v-model\uff0c\u800c\u662f\u5728\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4e0a\u4f7f\u7528\u3002\u65e2\u7136\u662f\u8bed\u6cd5\u7cd6\uff0c\u5c31\u80fd\u591f\u8fd8\u539f\uff0c\u6211\u4eec\u5148\u8fd8\u539f\u4e00\u4e0b\uff1a\n\n```\n<template>\n  <div>\n    {{ currentValue }}\n    <button @click=\"handleClick\">Click</button>\n  </div>\n</template>\n<script>\n  export default {\n    props: {\n      value: {\n        type: Number,\n        default: 0\n      }\n    },\n    data () {\n      return {\n        currentValue: this.value\n      }\n    },\n    methods: {\n      handleClick () {\n        this.currentValue += 1;\n        this.$emit('input', this.currentValue);\n      }\n    },\n    watch: {\n      value (val) {\n        this.currentValue = val;\n      }\n    }\n  }\n</script>\n\n```\n\n\u8fd9\u4e2a\u7ec4\u4ef6\u4e2d\uff0c\u53ea\u6709\u4e00\u4e2a props\uff0c\u4f46\u662f\u540d\u5b57\u53eb `value`\uff0c\u5185\u90e8\u8fd8\u6709\u4e00\u4e2a `currentValue`\uff0c\u5f53\u6539\u53d8 currentValue \u65f6\uff0c\u4f1a\u89e6\u53d1\u4e00\u4e2a\u81ea\u5b9a\u4e49\u4e8b\u4ef6 `@input`\uff0c\u5e76\u628a currentValue \u7684\u503c\u8fd4\u56de\u3002\u8fd9\u5c31\u662f\u4e00\u4e2a `v-model` \u7684\u8bed\u6cd5\u7cd6\uff0c\u5b83\u8981\u6c42 props \u6709\u4e00\u4e2a\u53eb `value` \u7684\u9879\uff0c\u540c\u65f6\u89e6\u53d1\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u5fc5\u987b\u53eb `input`\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4e0a\u7528 `v-model` \u4e86\uff1a\n\n```\n<custom-component v-model=\"value\"></custom-component>\n\n```\n\n\u5982\u679c\u4f60\u80fd\u8bf4\u5230 `model` \u9009\u9879\uff0c\u7edd\u5bf9\u662f\u52a0\u5206\u7684\u3002\n\n### Vuex \u4e2d mutations \u548c actions \u7684\u533a\u522b\n\n\u4e3b\u8981\u7684\u533a\u522b\u662f\uff0cactions \u53ef\u4ee5\u6267\u884c\u5f02\u6b65\u3002actions \u662f\u8c03\u7528 mutations\uff0c\u800c mutations \u6765\u4fee\u6539 store\u3002\n\n### Render \u51fd\u6570\n\n\u8fd9\u662f\u6bd4\u8f83\u96be\u7684\u4e00\u9898\u4e86\uff0c\u56e0\u4e3a\u5f88\u5c11\u6709\u4eba\u4f1a\u53bb\u4e86\u89e3 Vue.js \u7684 Render \u51fd\u6570\uff0c\u56e0\u4e3a\u57fa\u672c\u7528\u4e0d\u5230\u3002Render \u51fd\u6570\u7684\u5185\u5bb9\u672c\u5c0f\u518c\u5df2\u7ecf\u5f88\u6df1\u5165\u7684\u8bb2\u89e3\u8fc7\u4e86\uff0c\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e00\u822c\u53ef\u4ee5\u4ece\u8fd9\u51e0\u4e2a\u65b9\u9762\u6765\u56de\u7b54\uff1a\n\n*   \u4ec0\u4e48\u662f Render \u51fd\u6570\uff0c\u5b83\u7684\u4f7f\u7528\u573a\u666f\u662f\u4ec0\u4e48\u3002\n*   createElement \u662f\u4ec0\u4e48\uff1f\n*   Render \u51fd\u6570\u6709\u54ea\u4e9b\u5e38\u7528\u7684\u53c2\u6570\uff1f\n\n\u8bf4\u5230 Render \u51fd\u6570\uff0c\u5c31\u8981\u8bf4\u5230\u865a\u62df DOM\uff08Virtual DOM\uff09,Virtual DOM \u5e76\u4e0d\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u7684 DOM\uff0c\u800c\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684 JavaScript \u5bf9\u8c61\uff0c\u5728\u72b6\u6001\u53d1\u751f\u53d8\u5316\u65f6\uff0cVirtual DOM \u4f1a\u8fdb\u884c Diff \u8fd0\u7b97\uff0c\u6765\u66f4\u65b0\u53ea\u9700\u8981\u88ab\u66ff\u6362\u7684 DOM\uff0c\u800c\u4e0d\u662f\u5168\u90e8\u91cd\u7ed8\u3002\n\n\u5b83\u7684\u4f7f\u7528\u573a\u666f\uff0c\u5c31\u662f\u5b8c\u5168\u53d1\u6325 JavaScript \u7684\u7f16\u7a0b\u80fd\u529b\uff0c\u6709\u65f6\u9700\u8981\u7ed3\u5408 JSX \u6765\u4f7f\u7528\u3002\n\ncreateElement \u662f Render \u51fd\u6570\u7684\u6838\u5fc3\uff0c\u5b83\u6784\u6210\u4e86 Vue Virtual DOM \u7684\u6a21\u677f\uff0c\u5b83\u6709 3 \u4e2a\u53c2\u6570\uff1a\n\n```\ncreateElement () {\n  // {String | Object | Function}\n  // \u4e00\u4e2a HTML \u6807\u7b7e\uff0c\u7ec4\u4ef6\u9009\u9879\uff0c\u6216\u4e00\u4e2a\u51fd\u6570\n  // \u5fc5\u987b return \u4e0a\u8ff0\u5176\u4e2d\u4e00\u4e2a\n  'div',\n    // {Object}\n    // \u4e00\u4e2a\u5bf9\u5e94\u5c5e\u6027\u7684\u6570\u636e\u5bf9\u8c61\uff0c\u53ef\u9009\n    // \u60a8\u53ef\u4ee5\u5728 template \u4e2d\u4f7f\u7528\n    {\n    // \u8be6\u7ec6\u7684\u5c5e\u6027\n  },\n    // {String | Array}\n    // \u5b50\u8282\u70b9\uff08VNodes\uff09\uff0c\u53ef\u9009\n    [\n    createElement('h1', 'hello world'),\n    createElement(MyComponent, {\n      props: {\n        someProps: 'foo'\n      }\n    }),\n    'bar'\n  ]\n}\n\n```\n\n\u5e38\u7528\u7684\u53c2\u6570\uff0c\u4e3b\u8981\u662f\u6307\u4e0a\u9762\u7b2c\u4e8c\u4e2a\u53c2\u6570\u91cc\u7684\u503c\u4e86\uff0c\u8fd9\u4e2a\u6bd4\u8f83\u591a\uff0c\u5f97\u53bb\u770b Vue.js \u7684\u6587\u6863\u3002\n\n### \u600e\u6837\u7406\u89e3\u5355\u5411\u6570\u636e\u6d41\n\n\u8fd9\u4e2a\u6982\u5ff5\u51fa\u73b0\u5728\u7ec4\u4ef6\u901a\u4fe1\u3002\u7236\u7ec4\u4ef6\u662f\u901a\u8fc7 prop \u628a\u6570\u636e\u4f20\u9012\u5230\u5b50\u7ec4\u4ef6\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a prop \u53ea\u80fd\u7531\u7236\u7ec4\u4ef6\u4fee\u6539\uff0c\u5b50\u7ec4\u4ef6\u4e0d\u80fd\u4fee\u6539\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002\u5b50\u7ec4\u4ef6\u60f3\u4fee\u6539\u65f6\uff0c\u53ea\u80fd\u901a\u8fc7 `$emit` \u6d3e\u53d1\u4e00\u4e2a\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u7236\u7ec4\u4ef6\u63a5\u6536\u5230\u540e\uff0c\u7531\u7236\u7ec4\u4ef6\u4fee\u6539\u3002\n\n\u4e00\u822c\u6765\u8bf4\uff0c\u5bf9\u4e8e\u5b50\u7ec4\u4ef6\u60f3\u8981\u66f4\u6539\u7236\u7ec4\u4ef6\u72b6\u6001\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u6709\u4e24\u79cd\u65b9\u6848\uff1a\n\n1.  \u5728\u5b50\u7ec4\u4ef6\u7684 data \u4e2d\u62f7\u8d1d\u4e00\u4efd prop\uff0cdata \u662f\u53ef\u4ee5\u4fee\u6539\u7684\uff0c\u4f46 prop \u4e0d\u80fd\uff1a\n    \n    ```\n    export default {\n      props: {\n        value: String\n      },\n      data () {\n        return {\n          currentValue: this.value\n        }\n      }\n    }\n    \n    ```\n    \n2.  \u5982\u679c\u662f\u5bf9 prop \u503c\u7684\u8f6c\u6362\uff0c\u53ef\u4ee5\u4f7f\u7528\u8ba1\u7b97\u5c5e\u6027\uff1a\n    \n    ```\n    export default {\n      props: ['size'],\n      computed: {\n        normalizedSize: function () {\n          return this.size.trim().toLowerCase();\n        }\n      }\n    }\n    \n    ```\n    \n\n\u5982\u679c\u4f60\u80fd\u63d0\u5230 v-model \u5b9e\u73b0\u6570\u636e\u7684\u53cc\u5411\u7ed1\u5b9a\u3001.sync \u7528\u6cd5\uff0c\u4f1a\u5927\u5927\u52a0\u5206\u7684\uff0c\u8fd9\u4e9b\u5728\u7b2c 16 \u8282\u5df2\u7ecf\u8be6\u7ec6\u4ecb\u7ecd\u8fc7\u3002\n\n### \u751f\u547d\u5468\u671f\n\n[Vue.js \u751f\u547d\u5468\u671f](https://cn.vuejs.org/v2/api/#%E9%80%89%E9%A1%B9-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90) \u4e3b\u8981\u6709 8 \u4e2a\u9636\u6bb5\uff1a\n\n*   \u521b\u5efa\u524d / \u540e\uff08beforeCreate / created\uff09\uff1a\u5728 beforeCreate \u9636\u6bb5\uff0cVue \u5b9e\u4f8b\u7684\u6302\u8f7d\u5143\u7d20 el \u548c\u6570\u636e\u5bf9\u8c61 data \u90fd\u4e3a undefined\uff0c\u8fd8\u672a\u521d\u59cb\u5316\u3002\u5728 created \u9636\u6bb5\uff0cVue \u5b9e\u4f8b\u7684\u6570\u636e\u5bf9\u8c61 data \u6709\u4e86\uff0cel \u8fd8\u6ca1\u6709\u3002\n    \n*   \u8f7d\u5165\u524d / \u540e\uff08beforeMount / mounted\uff09\uff1a\u5728 beforeMount \u9636\u6bb5\uff0cVue \u5b9e\u4f8b\u7684 $el \u548c data \u90fd\u521d\u59cb\u5316\u4e86\uff0c\u4f46\u8fd8\u662f\u6302\u8f7d\u4e4b\u524d\u4e3a\u865a\u62df\u7684 DOM \u8282\u70b9\uff0cdata \u5c1a\u672a\u66ff\u6362\u3002\u5728 mounted \u9636\u6bb5\uff0cVue \u5b9e\u4f8b\u6302\u8f7d\u5b8c\u6210\uff0cdata \u6210\u529f\u6e32\u67d3\u3002\n    \n*   \u66f4\u65b0\u524d / \u540e\uff08beforeUpdate / updated\uff09\uff1a\u5f53 data \u53d8\u5316\u65f6\uff0c\u4f1a\u89e6\u53d1 beforeUpdate \u548c updated \u65b9\u6cd5\u3002\u8fd9\u4e24\u4e2a\u4e0d\u5e38\u7528\uff0c\u4e14\u4e0d\u63a8\u8350\u4f7f\u7528\u3002\n    \n*   \u9500\u6bc1\u524d / \u540e\uff08beforeDestroy / destroyed\uff09\uff1abeforeDestroy \u662f\u5728 Vue \u5b9e\u4f8b\u9500\u6bc1\u524d\u89e6\u53d1\uff0c\u4e00\u822c\u5728\u8fd9\u91cc\u8981\u901a\u8fc7 removeEventListener \u89e3\u9664\u624b\u52a8\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u3002\u5b9e\u4f8b\u9500\u6bc1\u540e\uff0c\u89e6\u53d1 destroyed\u3002\n    \n\n### \u7ec4\u4ef6\u95f4\u901a\u4fe1\n\n\u672c\u5c0f\u518c\u4e00\u534a\u7684\u7bc7\u5e45\u90fd\u5728\u8bb2\u7ec4\u4ef6\u7684\u901a\u4fe1\uff0c\u5982\u679c\u80fd\u628a\u8fd9\u4e9b\u90fd\u5403\u900f\uff0c\u57fa\u672c\u4e0a Vue.js \u7684\u9762\u8bd5\u5c31\u7a33\u4e86\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u770b\u4f3c\u7b80\u5355\uff0c\u5374\u6bd4\u8f83\u5927\uff0c\u56de\u7b54\u65f6\uff0c\u53ef\u4ee5\u62c6\u5206\u4e3a\u51e0\u79cd\u573a\u666f\uff1a\n\n1.  \u7236\u5b50\u901a\u4fe1\uff1a\n    \n    \u7236\u5411\u5b50\u4f20\u9012\u6570\u636e\u662f\u901a\u8fc7 props\uff0c\u5b50\u5411\u7236\u662f\u901a\u8fc7 events\uff08$emit\uff09\uff1b\u901a\u8fc7\u7236\u94fe / \u5b50\u94fe\u4e5f\u53ef\u4ee5\u901a\u4fe1\uff08$parent / $children\uff09\uff1b`ref` \u4e5f\u53ef\u4ee5\u8bbf\u95ee\u7ec4\u4ef6\u5b9e\u4f8b\uff1bprovide / inject API\u3002\n    \n2.  \u5144\u5f1f\u901a\u4fe1\uff1a\n    \n    Bus\uff1bVuex\uff1b\n    \n3.  \u8de8\u7ea7\u901a\u4fe1\uff1a\n    \n    Bus\uff1bVuex\uff1bprovide / inject API\u3002\n    \n\n\u9664\u4e86\u5e38\u89c4\u7684\u901a\u4fe1\u65b9\u6cd5\uff0c\u672c\u518c\u4ecb\u7ecd\u7684 dispatch / broadcast \u548c findComponents \u7cfb\u5217\u65b9\u6cd5\u4e5f\u53ef\u4ee5\u8bf4\u7684\uff0c\u5982\u679c\u80fd\u8bf4\u5230\u8fd9\u4e9b\uff0c\u8bf4\u660e\u4f60\u5bf9 Vue.js \u7ec4\u4ef6\u5df2\u7ecf\u6709\u8f83\u6df1\u5165\u7684\u7814\u7a76\u3002\n\n### \u8def\u7531\u7684\u8df3\u8f6c\u65b9\u5f0f\n\n\u4e00\u822c\u6709\u4e24\u79cd\uff1a\n\n1.  \u901a\u8fc7 `<router-link to=\"home\">`\uff0crouter-link \u6807\u7b7e\u4f1a\u6e32\u67d3\u4e3a `<a>` \u6807\u7b7e\uff0c\u5728 template \u4e2d\u7684\u8df3\u8f6c\u90fd\u662f\u7528\u8fd9\u79cd\uff1b\n2.  \u53e6\u4e00\u79cd\u662f\u7f16\u7a0b\u5f0f\u5bfc\u822a\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7 JS \u8df3\u8f6c\uff0c\u6bd4\u5982 `router.push('/home')`\u3002\n\n### Vue.js 2.x \u53cc\u5411\u7ed1\u5b9a\u539f\u7406\n\n\u8fd9\u4e2a\u95ee\u9898\u51e0\u4e4e\u662f\u9762\u8bd5\u5fc5\u95ee\u7684\uff0c\u56de\u7b54\u4e5f\u662f\u6709\u6df1\u6709\u6d45\u3002\u57fa\u672c\u4e0a\u8981\u77e5\u9053\u6838\u5fc3\u7684 API \u662f\u901a\u8fc7 `Object.defineProperty()` \u6765\u52ab\u6301\u5404\u4e2a\u5c5e\u6027\u7684 setter / getter\uff0c\u5728\u6570\u636e\u53d8\u52a8\u65f6\u53d1\u5e03\u6d88\u606f\u7ed9\u8ba2\u9605\u8005\uff0c\u89e6\u53d1\u76f8\u5e94\u7684\u76d1\u542c\u56de\u8c03\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48 Vue.js 2.x \u4e0d\u652f\u6301 IE8 \u7684\u539f\u56e0\uff08IE 8 \u4e0d\u652f\u6301\u6b64 API\uff0c\u4e14\u65e0\u6cd5\u901a\u8fc7 polyfill \u5b9e\u73b0\uff09\u3002\n\nVue.js \u6587\u6863\u5df2\u7ecf\u5bf9 [\u6df1\u5165\u54cd\u5e94\u5f0f\u539f\u7406](https://cn.vuejs.org/v2/guide/reactivity.html) \u89e3\u91ca\u7684\u5f88\u900f\u5f7b\u4e86\u3002\n\n### \u4ec0\u4e48\u662f MVVM\uff0c\u4e0e MVC \u6709\u4ec0\u4e48\u533a\u522b\n\nMVVM \u6a21\u5f0f\u662f\u7531\u7ecf\u5178\u7684\u8f6f\u4ef6\u67b6\u6784 MVC \u884d\u751f\u6765\u7684\u3002\u5f53 View\uff08\u89c6\u56fe\u5c42\uff09\u53d8\u5316\u65f6\uff0c\u4f1a\u81ea\u52a8\u66f4\u65b0\u5230 ViewModel\uff08\u89c6\u56fe\u6a21\u578b\uff09\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002View \u548c ViewModel \u4e4b\u95f4\u901a\u8fc7\u53cc\u5411\u7ed1\u5b9a\uff08data-binding\uff09\u5efa\u7acb\u8054\u7cfb\u3002\u4e0e MVC \u4e0d\u540c\u7684\u662f\uff0c\u5b83\u6ca1\u6709 Controller \u5c42\uff0c\u800c\u662f\u6f14\u53d8\u4e3a ViewModel\u3002\n\nViewModel \u901a\u8fc7\u53cc\u5411\u6570\u636e\u7ed1\u5b9a\u628a View \u5c42\u548c Model \u5c42\u8fde\u63a5\u4e86\u8d77\u6765\uff0c\u800c View \u548c Model \u4e4b\u95f4\u7684\u540c\u6b65\u5de5\u4f5c\u662f\u7531 Vue.js \u5b8c\u6210\u7684\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u624b\u52a8\u64cd\u4f5c DOM\uff0c\u53ea\u9700\u8981\u7ef4\u62a4\u597d\u6570\u636e\u72b6\u6001\u3002\n\n## \u7ed3\u8bed\n\n\u4e00\u4e2a\u4eba\u7684\u7b80\u5386\uff0c\u662f\u7531\u7b80\u5355\u5230\u590d\u6742\u518d\u5230\u7b80\u5355\uff0c\u6280\u672f\u662f\u65e0\u6b62\u5c3d\u7684\uff0c\u63a5\u89e6\u7684\u8d8a\u591a\uff0c\u8d8a\u80fd\u611f\u5230\u81ea\u5df1\u7684\u6e3a\u5c0f\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u62d3\u5c55Vue.js_\u9762\u8bd5\u5e38\u89c1\u95ee\u9898\u7b54\u7591.md", "create_date": "2020-02-18T21:37:08.953", "order": 17}}, {"model": "subject.chapter", "pk": 110, "fields": {"title": "\u7ec4\u4ef6\u7684\u901a\u4fe1 1\uff1aprovide   inject", "topic": 5, "md5": "954fbd9ef61d4a5a7d59687eeaa10a20", "md_body": "# \u7ec4\u4ef6\u7684\u901a\u4fe1 1\uff1aprovide / inject\n\n\u4e0a\u4e00\u8282\u4e2d\u6211\u4eec\u8bf4\u5230\uff0c`ref` \u548c `$parent / $children` \u5728**\u8de8\u7ea7**\u901a\u4fe1\u65f6\u662f\u6709\u5f0a\u7aef\u7684\u3002\u5f53\u7ec4\u4ef6 A \u548c\u7ec4\u4ef6 B \u4e2d\u95f4\u9694\u4e86\u6570\u4ee3\uff08\u751a\u81f3\u4e0d\u786e\u5b9a\u5177\u4f53\u7ea7\u522b\uff09\u65f6\uff0c\u4ee5\u5f80\u4f1a\u501f\u52a9 Vuex \u6216 Bus \u8fd9\u6837\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4e0d\u5f97\u4e0d\u5f15\u5165\u4e09\u65b9\u5e93\u6765\u652f\u6301\u3002\u672c\u5c0f\u8282\u5219\u4ecb\u7ecd\u4e00\u79cd\u65e0\u4f9d\u8d56\u7684\u7ec4\u4ef6\u901a\u4fe1\u65b9\u6cd5\uff1aVue.js \u5185\u7f6e\u7684 provide / inject \u63a5\u53e3\u3002\n\n## \u4ec0\u4e48\u662f provide / inject\n\n`provide / inject` \u662f Vue.js 2.2.0 \u7248\u672c\u540e\u65b0\u589e\u7684 API\uff0c\u5728\u6587\u6863\u4e2d\u8fd9\u6837\u4ecb\u7ecd \uff1a\n\n> [https://cn.vuejs.org/v2/api/#provide-inject](https://cn.vuejs.org/v2/api/#provide-inject)\n> \n> \u8fd9\u5bf9\u9009\u9879\u9700\u8981\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u5141\u8bb8\u4e00\u4e2a\u7956\u5148\u7ec4\u4ef6\u5411\u5176\u6240\u6709\u5b50\u5b59\u540e\u4ee3\u6ce8\u5165\u4e00\u4e2a\u4f9d\u8d56\uff0c\u4e0d\u8bba\u7ec4\u4ef6\u5c42\u6b21\u6709\u591a\u6df1\uff0c\u5e76\u5728\u8d77\u4e0a\u4e0b\u6e38\u5173\u7cfb\u6210\u7acb\u7684\u65f6\u95f4\u91cc\u59cb\u7ec8\u751f\u6548\u3002\u5982\u679c\u4f60\u719f\u6089 React\uff0c\u8fd9\u4e0e React \u7684\u4e0a\u4e0b\u6587\u7279\u6027\u5f88\u76f8\u4f3c\u3002\n\n\u5e76\u4e14\u6587\u6863\u4e2d\u6709\u5982\u4e0b\u63d0\u793a\uff1a\n\n> provide \u548c inject \u4e3b\u8981\u4e3a\u9ad8\u9636\u63d2\u4ef6/\u7ec4\u4ef6\u5e93\u63d0\u4f9b\u7528\u4f8b\u3002\u5e76\u4e0d\u63a8\u8350\u76f4\u63a5\u7528\u4e8e\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u4e2d\u3002\n\n\u770b\u4e0d\u61c2\u4e0a\u9762\u7684\u4ecb\u7ecd\u6ca1\u6709\u5173\u7cfb\uff0c\u4e0d\u8fc7\u4e0a\u9762\u7684\u8fd9\u53e5\u63d0\u793a\u5e94\u8be5\u660e\u767d\uff0c\u5c31\u662f\u8bf4 Vue.js \u4e0d\u5efa\u8bae\u5728\u4e1a\u52a1\u4e2d\u4f7f\u7528\u8fd9\u5bf9 API\uff0c\u800c\u662f\u5728\u63d2\u4ef6 / \u7ec4\u4ef6\u5e93\uff08\u6bd4\u5982 iView\uff0c\u4e8b\u5b9e\u4e0a iView \u7684\u5f88\u591a\u7ec4\u4ef6\u90fd\u5728\u7528\uff09\u3002**\u4e0d\u8fc7\u5efa\u8bae\u5f52\u5efa\u8bae\uff0c\u5982\u679c\u4f60\u7528\u597d\u4e86\uff0c\u8fd9\u4e2a API \u4f1a\u975e\u5e38\u6709\u7528\u3002**\n\n\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e0b\u8fd9\u4e2a API \u600e\u4e48\u7528\uff0c\u5047\u8bbe\u6709\u4e24\u4e2a\u7ec4\u4ef6\uff1a **A.vue** \u548c **B.vue**\uff0cB \u662f A \u7684\u5b50\u7ec4\u4ef6\u3002\n\n```\n// A.vue\nexport default {\n  provide: {\n    name: 'Aresn'\n  }\n}\n\n// B.vue\nexport default {\n  inject: ['name'],\n  mounted () {\n    console.log(this.name);  // Aresn\n  }\n}\n\n```\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u5728 A.vue \u91cc\uff0c\u6211\u4eec\u8bbe\u7f6e\u4e86\u4e00\u4e2a **provide: name**\uff0c\u503c\u4e3a Aresn\uff0c\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u5c06 **name** \u8fd9\u4e2a\u53d8\u91cf\u63d0\u4f9b\u7ed9\u5b83\u7684\u6240\u6709\u5b50\u7ec4\u4ef6\u3002\u800c\u5728 B.vue \u4e2d\uff0c\u901a\u8fc7 `inject` \u6ce8\u5165\u4e86\u4ece A \u7ec4\u4ef6\u4e2d\u63d0\u4f9b\u7684 **name** \u53d8\u91cf\uff0c\u90a3\u4e48\u5728\u7ec4\u4ef6 B \u4e2d\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 **[this.name](http://this.name)** \u8bbf\u95ee\u8fd9\u4e2a\u53d8\u91cf\u4e86\uff0c\u5b83\u7684\u503c\u4e5f\u662f Aresn\u3002\u8fd9\u5c31\u662f provide / inject API \u6700\u6838\u5fc3\u7684\u7528\u6cd5\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a\n\n> provide \u548c inject \u7ed1\u5b9a\u5e76**\u4e0d\u662f\u53ef\u54cd\u5e94**\u7684\u3002\u8fd9\u662f\u523b\u610f\u4e3a\u4e4b\u7684\u3002\u7136\u800c\uff0c\u5982\u679c\u4f60\u4f20\u5165\u4e86\u4e00\u4e2a\u53ef\u76d1\u542c\u7684\u5bf9\u8c61\uff0c\u90a3\u4e48\u5176\u5bf9\u8c61\u7684\u5c5e\u6027\u8fd8\u662f\u53ef\u54cd\u5e94\u7684\u3002\n\n\u6240\u4ee5\uff0c\u4e0a\u9762 A.vue \u7684 name \u5982\u679c\u6539\u53d8\u4e86\uff0cB.vue \u7684 [this.name](http://this.name) \u662f\u4e0d\u4f1a\u6539\u53d8\u7684\uff0c\u4ecd\u7136\u662f Aresn\u3002\n\n## \u66ff\u4ee3 Vuex\n\n\u6211\u4eec\u77e5\u9053\uff0c\u5728\u505a Vue \u5927\u578b\u9879\u76ee\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 Vuex \u505a\u72b6\u6001\u7ba1\u7406\uff0c\u5b83\u662f\u4e00\u4e2a\u4e13\u4e3a Vue.js \u5f00\u53d1\u7684**\u72b6\u6001\u7ba1\u7406\u6a21\u5f0f**\uff0c\u7528\u4e8e\u96c6\u4e2d\u5f0f\u5b58\u50a8\u7ba1\u7406\u5e94\u7528\u7684\u6240\u6709\u7ec4\u4ef6\u7684\u72b6\u6001\uff0c\u5e76\u4ee5\u76f8\u5e94\u7684\u89c4\u5219\u4fdd\u8bc1\u72b6\u6001\u4ee5\u4e00\u79cd\u53ef\u9884\u6d4b\u7684\u65b9\u5f0f\u53d1\u751f\u53d8\u5316\u3002\n\n\u90a3\u4e86\u89e3\u4e86 provide / inject \u7684\u7528\u6cd5\uff0c\u4e0b\u9762\u6765\u770b\u600e\u6837\u66ff\u4ee3 Vuex\u3002\u5f53\u7136\uff0c\u6211\u4eec\u7684\u76ee\u7684\u5e76\u4e0d\u662f\u4e3a\u4e86\u66ff\u4ee3 Vuex\uff0c\u5b83\u8fd8\u662f\u6709\u76f8\u5f53\u5927\u7684\u7528\u5904\uff0c\u8fd9\u91cc\u53ea\u662f\u4ecb\u7ecd\u53e6\u4e00\u79cd\u53ef\u884c\u6027\u3002\n\n\u4f7f\u7528 Vuex\uff0c\u6700\u4e3b\u8981\u7684\u76ee\u7684\u662f\u8de8\u7ec4\u4ef6\u901a\u4fe1\u3001\u5168\u5c40\u6570\u636e\u7ef4\u62a4\u3001\u591a\u4eba\u534f\u540c\u5f00\u53d1\u3002\u9700\u6c42\u6bd4\u5982\u6709\uff1a\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u7ef4\u62a4\u3001\u901a\u77e5\u4fe1\u606f\u7ef4\u62a4\u7b49\u5168\u5c40\u7684\u72b6\u6001\u548c\u6570\u636e\u3002\n\n\u4e00\u822c\u5728 webpack \u4e2d\u4f7f\u7528 Vue.js\uff0c\u90fd\u4f1a\u6709\u4e00\u4e2a\u5165\u53e3\u6587\u4ef6 **main.js**\uff0c\u91cc\u9762\u901a\u5e38\u5bfc\u5165\u4e86 Vue\u3001VueRouter\u3001iView \u7b49\u5e93\uff0c\u901a\u5e38\u4e5f\u4f1a\u5bfc\u5165\u4e00\u4e2a\u5165\u53e3\u7ec4\u4ef6 `app.vue` \u4f5c\u4e3a\u6839\u7ec4\u4ef6\u3002\u4e00\u4e2a\u7b80\u5355\u7684 app.vue \u53ef\u80fd\u53ea\u6709\u4ee5\u4e0b\u4ee3\u7801\uff1a\n\n```\n<template>\n  <div>\n    <router-view></router-view>\n  </div>\n</template>\n<script>\n  export default {\n\n  }\n</script>\n\n```\n\n\u4f7f\u7528 provide / inject \u66ff\u4ee3 Vuex\uff0c\u5c31\u662f\u5728\u8fd9\u4e2a app.vue \u6587\u4ef6\u4e0a\u505a\u6587\u7ae0\u3002\n\n\u6211\u4eec\u628a app.vue \u7406\u89e3\u4e3a\u4e00\u4e2a\u6700\u5916\u5c42\u7684\u6839\u7ec4\u4ef6\uff0c\u7528\u6765\u5b58\u50a8\u6240\u6709\u9700\u8981\u7684\u5168\u5c40\u6570\u636e\u548c\u72b6\u6001\uff0c\u751a\u81f3\u662f\u8ba1\u7b97\u5c5e\u6027\uff08computed\uff09\u3001\u65b9\u6cd5\uff08methods\uff09\u7b49\u3002\u56e0\u4e3a\u4f60\u7684\u9879\u76ee\u4e2d\u6240\u6709\u7684\u7ec4\u4ef6\uff08\u5305\u542b\u8def\u7531\uff09\uff0c\u5b83\u7684\u7236\u7ec4\u4ef6\uff08\u6216\u6839\u7ec4\u4ef6\uff09\u90fd\u662f app.vue\uff0c\u6240\u4ee5\u6211\u4eec**\u628a\u6574\u4e2a app.vue \u5b9e\u4f8b\u901a\u8fc7 `provide` \u5bf9\u5916\u63d0\u4f9b**\u3002\n\n_app.vue\uff1a_\n\n```\n<template>\n  <div>\n    <router-view></router-view>\n  </div>\n</template>\n<script>\n  export default {\n    provide () {\n      return {\n        app: this\n      }\n    }\n  }\n</script>\n\n```\n\n\u4e0a\u9762\uff0c\u6211\u4eec\u628a\u6574\u4e2a app.vue \u7684\u5b9e\u4f8b `this` \u5bf9\u5916\u63d0\u4f9b\uff0c\u547d\u540d\u4e3a **app**\uff08\u8fd9\u4e2a\u540d\u5b57\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u63a8\u8350\u4f7f\u7528 app\uff0c\u4f7f\u7528\u8fd9\u4e2a\u540d\u5b57\u540e\uff0c\u5b50\u7ec4\u4ef6\u4e0d\u80fd\u518d\u4f7f\u7528\u5b83\u4f5c\u4e3a\u5c40\u90e8\u5c5e\u6027\uff09\u3002\u63a5\u4e0b\u6765\uff0c\u4efb\u4f55\u7ec4\u4ef6\uff08\u6216\u8def\u7531\uff09\u53ea\u8981\u901a\u8fc7 `inject` \u6ce8\u5165 app.vue \u7684 app \u7684\u8bdd\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 **[this.app.xxx](http://this.app.xxx)** \u6765\u8bbf\u95ee app.vue \u7684 `data`\u3001`computed`\u3001`methods` \u7b49\u5185\u5bb9\u3002\n\napp.vue \u662f\u6574\u4e2a\u9879\u76ee\u7b2c\u4e00\u4e2a\u88ab\u6e32\u67d3\u7684\u7ec4\u4ef6\uff0c\u800c\u4e14\u53ea\u4f1a\u6e32\u67d3\u4e00\u6b21\uff08\u5373\u4f7f\u5207\u6362\u8def\u7531\uff0capp.vue \u4e5f\u4e0d\u4f1a\u88ab\u518d\u6b21\u6e32\u67d3\uff09\uff0c\u5229\u7528\u8fd9\u4e2a\u7279\u6027\uff0c\u5f88\u9002\u5408\u505a\u4e00\u6b21\u6027\u5168\u5c40\u7684\u72b6\u6001\u6570\u636e\u7ba1\u7406\uff0c\u4f8b\u5982\uff0c\u6211\u4eec\u5c06\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u4fdd\u5b58\u8d77\u6765\uff1a\n\n_app.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\uff1a_\n\n```\n<script>\n  export default {\n    provide () {\n      return {\n        app: this\n      }\n    },\n    data () {\n      return {\n        userInfo: null\n      }\n    },\n    methods: {\n      getUserInfo () {\n        // \u8fd9\u91cc\u901a\u8fc7 ajax \u83b7\u53d6\u7528\u6237\u4fe1\u606f\u540e\uff0c\u8d4b\u503c\u7ed9 this.userInfo\uff0c\u4ee5\u4e0b\u4e3a\u4f2a\u4ee3\u7801\n        $.ajax('/user/info', (data) => {\n          this.userInfo = data;\n        });\n      }\n    },\n    mounted () {\n      this.getUserInfo();\n    }\n  }\n</script>\n\n```\n\n\u8fd9\u6837\uff0c\u4efb\u4f55\u9875\u9762\u6216\u7ec4\u4ef6\uff0c\u53ea\u8981\u901a\u8fc7 `inject` \u6ce8\u5165 `app` \u540e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee `userInfo` \u7684\u6570\u636e\u4e86\uff0c\u6bd4\u5982\uff1a\n\n```\n<template>\n  <div>\n    {{ app.userInfo }}\n  </div>\n</template>\n<script>\n  export default {\n    inject: ['app']\n  }\n</script>\n\n```\n\n\u662f\u4e0d\u662f\u5f88\u7b80\u5355\u5462\u3002\u9664\u4e86\u76f4\u63a5\u4f7f\u7528\u6570\u636e\uff0c\u8fd8\u53ef\u4ee5\u8c03\u7528\u65b9\u6cd5\u3002\u6bd4\u5982\u5728\u67d0\u4e2a\u9875\u9762\u91cc\uff0c\u4fee\u6539\u4e86\u4e2a\u4eba\u8d44\u6599\uff0c\u8fd9\u65f6\u4e00\u5f00\u59cb\u5728 `app.vue` \u91cc\u83b7\u53d6\u7684 `userInfo` \u5df2\u7ecf\u4e0d\u662f\u6700\u65b0\u7684\u4e86\uff0c\u9700\u8981\u91cd\u65b0\u83b7\u53d6\u3002\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\uff1a\n\n_\u67d0\u4e2a\u9875\u9762\uff1a_\n\n```\n<template>\n  <div>\n    {{ app.userInfo }}\n  </div>\n</template>\n<script>\n  export default {\n    inject: ['app'],\n    methods: {\n      changeUserInfo () {\n        // \u8fd9\u91cc\u4fee\u6539\u5b8c\u7528\u6237\u6570\u636e\u540e\uff0c\u901a\u77e5 app.vue \u66f4\u65b0\uff0c\u4ee5\u4e0b\u4e3a\u4f2a\u4ee3\u7801\n        $.ajax('/user/update', () => {\n          // \u76f4\u63a5\u901a\u8fc7 this.app \u5c31\u53ef\u4ee5\u8c03\u7528 app.vue \u91cc\u7684\u65b9\u6cd5\n          this.app.getUserInfo();\n        })\n      }\n    }\n  }\n</script>\n\n```\n\n\u540c\u6837\u975e\u5e38\u7b80\u5355\u3002\u53ea\u8981\u7406\u89e3\u4e86 `this.app` \u662f\u76f4\u63a5\u83b7\u53d6\u6574\u4e2a `app.vue` \u7684\u5b9e\u4f8b\u540e\uff0c\u4f7f\u7528\u8d77\u6765\u5c31\u5f97\u5fc3\u5e94\u624b\u4e86\u3002\u60f3\u4e00\u60f3\uff0c\u914d\u7f6e\u590d\u6742\u7684 Vuex \u7684\u5168\u90e8\u529f\u80fd\uff0c\u73b0\u5728\u662f\u4e0d\u662f\u90fd\u53ef\u4ee5\u901a\u8fc7 `provide / inject` \u6765\u5b9e\u73b0\u4e86\u5462\uff1f\n\n## \u8fdb\u9636\u6280\u5de7\n\n\u5982\u679c\u4f60\u7684\u9879\u76ee\u8db3\u591f\u590d\u6742\uff0c\u6216\u9700\u8981\u591a\u4eba\u534f\u540c\u5f00\u53d1\u65f6\uff0c\u5728 `app.vue` \u91cc\u4f1a\u5199\u975e\u5e38\u591a\u7684\u4ee3\u7801\uff0c\u591a\u5230\u7ed3\u6784\u590d\u6742\u96be\u4ee5\u7ef4\u62a4\u3002\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528 Vue.js \u7684\u6df7\u5408 `mixins`\uff0c\u5c06\u4e0d\u540c\u7684\u903b\u8f91\u5206\u5f00\u5230\u4e0d\u540c\u7684 js \u6587\u4ef6\u91cc\u3002\n\n\u6bd4\u5982\u4e0a\u9762\u7684\u7528\u6237\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u653e\u5230\u6df7\u5408\u91cc\uff1a\n\n_user.js\uff1a_\n\n```\nexport default {\n  data () {\n    return {\n      userInfo: null\n    }\n  },\n  methods: {\n    getUserInfo () {\n      // \u8fd9\u91cc\u901a\u8fc7 ajax \u83b7\u53d6\u7528\u6237\u4fe1\u606f\u540e\uff0c\u8d4b\u503c\u7ed9 this.userInfo\uff0c\u4ee5\u4e0b\u4e3a\u4f2a\u4ee3\u7801\n      $.ajax('/user/info', (data) => {\n        this.userInfo = data;\n      });\n    }\n  },\n  mounted () {\n    this.getUserInfo();\n  }\n}\n\n```\n\n\u7136\u540e\u5728 `app.vue` \u4e2d\u6df7\u5408\uff1a\n\n_app.vue\uff1a_\n\n```\n<script>\n  import mixins_user from '../mixins/user.js';\n\n  export default {\n    mixins: [mixins_user],\n    data () {\n      return {\n\n      }\n    }\n  }\n</script>\n\n```\n\n\u8fd9\u6837\uff0c\u8ddf\u7528\u6237\u4fe1\u606f\u76f8\u5173\u7684\u903b\u8f91\uff0c\u90fd\u53ef\u4ee5\u5728 `user.js` \u91cc\u7ef4\u62a4\uff0c\u6216\u8005\u7531\u67d0\u4e2a\u4eba\u6765\u7ef4\u62a4\uff0c`app.vue` \u4e5f\u5c31\u5f88\u5bb9\u6613\u7ef4\u62a4\u4e86\u3002\n\n## \u72ec\u7acb\u7ec4\u4ef6\u4e2d\u4f7f\u7528\n\n\u5982\u679c\u4f60\u987e\u5fcc Vue.js \u6587\u6863\u4e2d\u6240\u8bf4\uff0cprovide / inject \u4e0d\u63a8\u8350\u76f4\u63a5\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\uff0c\u90a3\u6ca1\u6709\u5173\u7cfb\uff0c\u4ecd\u7136\u4f7f\u7528\u4f60\u719f\u6089\u7684 Vuex \u6216 Bus \u6765\u7ba1\u7406\u4f60\u7684\u9879\u76ee\u5c31\u597d\u3002\u6211\u4eec\u4ecb\u7ecd\u7684\u8fd9\u5bf9 API\uff0c\u4e3b\u8981\u8fd8\u662f\u5728\u72ec\u7acb\u7ec4\u4ef6\u4e2d\u53d1\u6325\u4f5c\u7528\u7684\u3002\n\n\u53ea\u8981\u4e00\u4e2a\u7ec4\u4ef6\u4f7f\u7528\u4e86 `provide` \u5411\u4e0b\u63d0\u4f9b\u6570\u636e\uff0c\u90a3\u5176\u4e0b\u6240\u6709\u7684\u5b50\u7ec4\u4ef6\u90fd\u53ef\u4ee5\u901a\u8fc7 `inject` \u6765\u6ce8\u5165\uff0c\u4e0d\u7ba1\u4e2d\u95f4\u9694\u4e86\u591a\u5c11\u4ee3\uff0c\u800c\u4e14\u53ef\u4ee5\u6ce8\u5165\u591a\u4e2a\u6765\u81ea\u4e0d\u540c\u7236\u7ea7\u63d0\u4f9b\u7684\u6570\u636e\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e00\u65e6\u6ce8\u5165\u4e86\u67d0\u4e2a\u6570\u636e\uff0c\u6bd4\u5982\u4e0a\u9762\u793a\u4f8b\u4e2d\u7684 `app`\uff0c\u90a3\u8fd9\u4e2a\u7ec4\u4ef6\u4e2d\u5c31\u4e0d\u80fd\u518d\u58f0\u660e `app` \u8fd9\u4e2a\u6570\u636e\u4e86\uff0c\u56e0\u4e3a\u5b83\u5df2\u7ecf\u88ab\u7236\u7ea7\u5360\u6709\u3002\n\n\u72ec\u7acb\u7ec4\u4ef6\u4f7f\u7528 provide / inject \u7684\u573a\u666f\uff0c\u4e3b\u8981\u662f\u5177\u6709\u8054\u52a8\u5173\u7cfb\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982\u63a5\u4e0b\u6765\u5f88\u5feb\u4f1a\u4ecb\u7ecd\u7684\u7b2c\u4e00\u4e2a\u5b9e\u6218\uff1a\u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684\u8868\u5355\u7ec4\u4ef6 Form\u3002\u5b83\u5176\u5b9e\u662f\u4e24\u4e2a\u7ec4\u4ef6\uff0c\u4e00\u4e2a\u662f Form\uff0c\u4e00\u4e2a\u662f FormItem\uff0cFormItem \u662f Form \u7684\u5b50\u7ec4\u4ef6\uff0c\u5b83\u4f1a\u4f9d\u8d56 Form \u7ec4\u4ef6\u4e0a\u7684\u4e00\u4e9b\u7279\u6027\uff08props\uff09\uff0c\u6240\u4ee5\u5c31\u9700\u8981\u5f97\u5230\u7236\u7ec4\u4ef6 Form\uff0c\u8fd9\u5728 Vue.js 2.2.0 \u7248\u672c\u4ee5\u524d\uff0c\u662f\u6ca1\u6709 provide / inject \u8fd9\u5bf9 API \u7684\uff0c\u800c Form \u548c FormItem \u4e0d\u4e00\u5b9a\u662f\u7236\u5b50\u5173\u7cfb\uff0c\u4e2d\u95f4\u5f88\u53ef\u80fd\u95f4\u9694\u4e86\u5176\u5b83\u7ec4\u4ef6\uff0c\u6240\u4ee5\u4e0d\u80fd\u5355\u7eaf\u4f7f\u7528 `$parent` \u6765\u5411\u4e0a\u83b7\u53d6\u5b9e\u4f8b\u3002\u5728 Vue.js 2.2.0 \u4e4b\u524d\uff0c\u4e00\u79cd\u6bd4\u8f83\u53ef\u884c\u7684\u65b9\u6848\u662f\u7528\u8ba1\u7b97\u5c5e\u6027\u52a8\u6001\u83b7\u53d6\uff1a\n\n```\ncomputed: {\n  form () {\n    let parent = this.$parent;\n    while (parent.$options.name !== 'Form') {\n      parent = parent.$parent;\n    }\n    return parent;\n  }\n}\n\n```\n\n\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u53ef\u4ee5\u8bbe\u7f6e `name` \u9009\u9879\uff0c\u4f5c\u4e3a\u7ec4\u4ef6\u540d\u7684\u6807\u8bc6\uff0c\u5229\u7528\u8fd9\u4e2a\u7279\u70b9\uff0c\u901a\u8fc7\u5411\u4e0a\u904d\u5386\uff0c\u76f4\u5230\u627e\u5230\u9700\u8981\u7684\u7ec4\u4ef6\u3002\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u884c\uff0c\u4f46\u76f8\u6bd4\u4e00\u4e2a `inject` \u6765\u8bf4\uff0c\u592a\u8d39\u52b2\u4e86\uff0c\u800c\u4e14\u4e0d\u90a3\u4e48\u4f18\u96c5\u548c native\u3002\u5982\u679c\u7528 inject\uff0c\u53ef\u80fd\u53ea\u9700\u8981\u4e00\u884c\u4ee3\u7801\uff1a\n\n```\nexport default {\n  inject: ['form']\n}\n\n```\n\n\u4e0d\u8fc7\uff0c\u8fd9\u4e00\u5207\u7684\u524d\u63d0\u662f\u4f60\u4f7f\u7528 Vue.js 2.2.0 \u4ee5\u4e0a\u7248\u672c\u3002\n\n## \u7ed3\u8bed\n\n\u5982\u679c\u8fd9\u662f\u4f60\u7b2c\u4e00\u6b21\u542c\u8bf4 provide / inject \u8fd9\u5bf9 API\uff0c\u4e00\u5b9a\u89c9\u5f97\u5b83\u592a\u795e\u5947\u4e86\uff0c\u81f3\u5c11\u7b14\u8005\u7b2c\u4e00\u65f6\u95f4\u77e5\u6653\u65f6\u662f\u8fd9\u6837\u7684\u3002\u5b83\u89e3\u51b3\u4e86\u72ec\u7acb\u7ec4\u4ef6\u95f4\u901a\u4fe1\u7684\u95ee\u9898\uff0c\u7528\u597d\u4e86\u8fd8\u6709\u51fa\u4e4e\u610f\u6599\u7684\u6548\u679c\u3002\u7b14\u8005\u5728\u5f00\u53d1 [iView Developer](https://dev.iviewui.com) \u65f6\uff0c\u5168\u7ad9\u5c31\u662f\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u6765\u505a\u5168\u5c40\u6570\u636e\u7684\u7ba1\u7406\u7684\uff0c\u5982\u679c\u4f60\u6709\u673a\u4f1a\u4e00\u4e2a\u4eba\u505a\u4e00\u4e2a\u9879\u76ee\u65f6\uff0c\u4e0d\u59a8\u8bd5\u8bd5\u8fd9\u79cd\u65b9\u6cd5\u3002\n\n\u4e0b\u4e00\u8282\uff0c\u5c06\u4ecb\u7ecd\u53e6\u4e00\u79cd\u7ec4\u4ef6\u95f4\u901a\u4fe1\u7684\u65b9\u6cd5\uff0c\u4e0d\u540c\u4e8e provide / inject \u7684\u662f\uff0c\u5b83\u4eec\u4e0d\u662f Vue.js \u5185\u7f6e\u7684 API\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u7ec4\u4ef6\u7684\u901a\u4fe1_1provide___inject.md", "create_date": "2020-02-18T21:37:08.983", "order": 3}}, {"model": "subject.chapter", "pk": 111, "fields": {"title": "\u62d3\u5c55\uff1aVue.js \u5bb9\u6613\u5ffd\u7565\u7684 API \u8be6\u89e3", "topic": 5, "md5": "38a632fbd107fee6f009a1bae343f5d0", "md_body": "# \u62d3\u5c55\uff1aVue.js \u5bb9\u6613\u5ffd\u7565\u7684 API \u8be6\u89e3\n\n\u524d\u9762\u7684 15 \u5c0f\u8282\u5df2\u7ecf\u8986\u76d6\u4e86 Vue.js \u7ec4\u4ef6\u7684\u7edd\u5927\u90e8\u5206\u5185\u5bb9\uff0c\u4f46\u8fd8\u662f\u6709\u4e00\u4e9b API \u5bb9\u6613\u5ffd\u7565\u3002\u672c\u8282\u5219\u5bf9 Vue.js \u7684\u4e00\u4e9b\u91cd\u8981\u4e14\u6613\u5ffd\u7565\u7684 API \u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002\n\n## nextTick\n\nnextTick \u662f Vue.js \u63d0\u4f9b\u7684\u4e00\u4e2a\u51fd\u6570\uff0c\u5e76\u975e\u6d4f\u89c8\u5668\u5185\u7f6e\u3002nextTick \u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u56de\u8c03\u51fd\u6570 `cb`\uff0c\u5728\u4e0b\u4e00\u4e2a DOM \u66f4\u65b0\u5faa\u73af\u4e4b\u540e\u6267\u884c\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u793a\u4f8b\uff1a\n\n```\n<template>\n  <div>\n    <p v-if=\"show\" ref=\"node\">\u5185\u5bb9</p>\n    <button @click=\"handleShow\">\u663e\u793a</button>\n  </div>\n</template>\n<script>\n  export default {\n    data () {\n      return {\n        show: false\n      }\n    },\n    methods: {\n      handleShow () {\n        this.show = true;\n        console.log(this.$refs.node);  // undefined\n        this.$nextTick(() => {\n          console.log(this.$refs.node);  // <p>\u5185\u5bb9</p>\n        });\n      }\n    }\n  }\n</script>\n\n```\n\n\u5f53 `show` \u88ab\u7f6e\u4e3a true \u65f6\uff0c\u8fd9\u65f6 p \u8282\u70b9\u8fd8\u672a\u88ab\u6e32\u67d3\uff0c\u56e0\u6b64\u6253\u5370\u51fa\u7684\u662f undefined\uff0c\u800c\u5728 nextTick \u7684\u56de\u8c03\u91cc\uff0cp \u5df2\u7ecf\u6e32\u67d3\u597d\u4e86\uff0c\u8fd9\u65f6\u80fd\u6b63\u786e\u6253\u5370\u51fa\u8282\u70b9\u3002\n\nnextTick \u7684\u6e90\u7801\u5728 [https://github.com/vuejs/vue/blob/dev/src/core/util/next-tick.js](https://github.com/vuejs/vue/blob/dev/src/core/util/next-tick.js)\uff0c\u53ef\u4ee5\u770b\u5230\uff0cVue.js \u4f7f\u7528\u4e86 `Promise`\u3001`setTimeout` \u548c `setImmediate` \u4e09\u79cd\u65b9\u6cd5\u6765\u5b9e\u73b0 nextTick\uff0c\u5728\u4e0d\u540c\u73af\u5883\u4f1a\u4f7f\u7528\u4e0d\u540c\u7684\u65b9\u6cd5\u3002\n\n## v-model \u8bed\u6cd5\u7cd6\n\n`v-model` \u5e38\u7528\u4e8e\u8868\u5355\u5143\u7d20\u4e0a\u8fdb\u884c\u6570\u636e\u7684\u53cc\u5411\u7ed1\u5b9a\uff0c\u6bd4\u5982 `<input>`\u3002\u9664\u4e86\u539f\u751f\u7684\u5143\u7d20\uff0c\u5b83\u8fd8\u80fd\u5728\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u3002\n\nv-model \u662f\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff0c\u53ef\u4ee5\u62c6\u89e3\u4e3a props: value \u548c events: input\u3002\u5c31\u662f\u8bf4\u7ec4\u4ef6\u5fc5\u987b\u63d0\u4f9b\u4e00\u4e2a\u540d\u4e3a value \u7684 prop\uff0c\u4ee5\u53ca\u540d\u4e3a input \u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6761\u4ef6\uff0c\u4f7f\u7528\u8005\u5c31\u80fd\u5728\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4e0a\u4f7f\u7528 `v-model`\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u793a\u4f8b\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6570\u5b57\u9009\u62e9\u5668\uff1a\n\n```\n<template>\n  <div>\n    <button @click=\"increase(-1)\">\u51cf 1</button>\n    <span style=\"color: red;padding: 6px\">{{ currentValue }}</span>\n    <button @click=\"increase(1)\">\u52a0 1</button>\n  </div>\n</template>\n<script>\n  export default {\n    name: 'InputNumber',\n    props: {\n      value: {\n        type: Number\n      }\n    },\n    data () {\n      return {\n        currentValue: this.value\n      }\n    },\n    watch: {\n      value (val) {\n        this.currentValue = val;\n      }\n    },\n    methods: {\n      increase (val) {\n        this.currentValue += val;\n        this.$emit('input', this.currentValue);\n      }\n    }\n  }\n</script>\n\n```\n\nprops \u4e00\u822c\u4e0d\u80fd\u5728\u7ec4\u4ef6\u5185\u4fee\u6539\uff0c\u5b83\u662f\u901a\u8fc7\u7236\u7ea7\u4fee\u6539\u7684\uff0c\u56e0\u6b64\u5b9e\u73b0 v-model \u4e00\u822c\u90fd\u4f1a\u6709\u4e00\u4e2a `currentValue` \u7684\u5185\u90e8 data\uff0c\u521d\u59cb\u65f6\u4ece value \u83b7\u53d6\u4e00\u6b21\u503c\uff0c\u5f53 value \u4fee\u6539\u65f6\uff0c\u4e5f\u901a\u8fc7 watch \u76d1\u542c\u5230\u53ca\u65f6\u66f4\u65b0\uff1b\u7ec4\u4ef6\u4e0d\u4f1a\u4fee\u6539 value \u7684\u503c\uff0c\u800c\u662f\u4fee\u6539 currentValue\uff0c\u540c\u65f6\u5c06\u4fee\u6539\u7684\u503c\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e8b\u4ef6 `input` \u6d3e\u53d1\u7ed9\u7236\u7ec4\u4ef6\uff0c\u7236\u7ec4\u4ef6\u63a5\u6536\u5230\u540e\uff0c\u7531\u7236\u7ec4\u4ef6\u4fee\u6539 value\u3002\u6240\u4ee5\uff0c\u4e0a\u9762\u7684\u6570\u5b57\u9009\u62e9\u5668\u7ec4\u4ef6\u53ef\u4ee5\u6709\u4e0b\u9762\u4e24\u79cd\u4f7f\u7528\u65b9\u5f0f\uff1a\n\n```\n<template>\n  <InputNumber v-model=\"value\" />\n</template>\n<script>\n  import InputNumber from '../components/input-number/input-number.vue';\n\n  export default {\n    components: { InputNumber },\n    data () {\n      return {\n        value: 1\n      }\n    }\n  }\n</script>\n\n```\n\n\u6216\uff1a\n\n```\n<template>\n  <InputNumber :value=\"value\" @input=\"handleChange\" />\n</template>\n<script>\n  import InputNumber from '../components/input-number/input-number.vue';\n\n  export default {\n    components: { InputNumber },\n    data () {\n      return {\n        value: 1\n      }\n    },\n    methods: {\n      handleChange (val) {\n        this.value = val;\n      }\n    }\n  }\n</script>\n\n```\n\n\u5982\u679c\u4f60\u4e0d\u60f3\u7528 `value` \u548c `input` \u8fd9\u4e24\u4e2a\u540d\u5b57\uff0c\u4ece Vue.js 2.2.0 \u7248\u672c\u5f00\u59cb\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a `model` \u7684\u9009\u9879\uff0c\u53ef\u4ee5\u6307\u5b9a\u5b83\u4eec\u7684\u540d\u5b57\uff0c\u6240\u4ee5\u6570\u5b57\u9009\u62e9\u5668\u7ec4\u4ef6\u4e5f\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a\n\n```\n<template>\n  <div>\n    <button @click=\"increase(-1)\">\u51cf 1</button>\n    <span style=\"color: red;padding: 6px\">{{ currentValue }}</span>\n    <button @click=\"increase(1)\">\u52a0 1</button>\n  </div>\n</template>\n<script>\n  export default {\n    name: 'InputNumber',\n    props: {\n      number: {\n        type: Number\n      }\n    },\n    model: {\n      prop: 'number',\n      event: 'change'\n    },\n    data () {\n      return {\n        currentValue: this.number\n      }\n    },\n    watch: {\n      value (val) {\n        this.currentValue = val;\n      }\n    },\n    methods: {\n      increase (val) {\n        this.currentValue += val;\n        this.$emit('number', this.currentValue);\n      }\n    }\n  }\n</script>\n\n```\n\n\u5728 model \u9009\u9879\u91cc\uff0c\u5c31\u53ef\u4ee5\u6307\u5b9a prop \u548c event \u7684\u540d\u5b57\u4e86\uff0c\u800c\u4e0d\u4e00\u5b9a\u975e\u8981\u7528 value \u548c input\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u540d\u5b57\u5728\u4e00\u4e9b\u539f\u751f\u8868\u5355\u5143\u7d20\u91cc\uff0c\u6709\u5176\u5b83\u7528\u5904\u3002\n\n## .sync \u4fee\u9970\u7b26\n\n\u5982\u679c\u4f60\u4f7f\u7528\u8fc7 Vue.js 1.x\uff0c\u4e00\u5b9a\u5bf9 `.sync` \u4e0d\u964c\u751f\u3002\u5728 1.x \u91cc\uff0c\u53ef\u4ee5\u4f7f\u7528 .sync \u53cc\u5411\u7ed1\u5b9a\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u7236\u7ec4\u4ef6\u6216\u5b50\u7ec4\u4ef6\u90fd\u80fd\u4fee\u6539\u8fd9\u4e2a\u6570\u636e\uff0c\u662f\u53cc\u5411\u54cd\u5e94\u7684\u3002\u5728 Vue.js 2.x \u91cc\u5e9f\u5f03\u4e86\u8fd9\u79cd\u7528\u6cd5\uff0c\u76ee\u7684\u662f\u5c3d\u53ef\u80fd\u5c06\u7236\u5b50\u7ec4\u4ef6\u89e3\u8026\uff0c\u907f\u514d\u5b50\u7ec4\u4ef6\u65e0\u610f\u4e2d\u4fee\u6539\u4e86\u7236\u7ec4\u4ef6\u7684\u72b6\u6001\u3002\n\n\u4e0d\u8fc7\u5728 Vue.js 2.3.0 \u7248\u672c\uff0c\u53c8\u589e\u52a0\u4e86 `.sync` \u4fee\u9970\u7b26\uff0c\u4f46\u5b83\u7684\u7528\u6cd5\u4e0e 1.x \u7684\u4e0d\u5b8c\u5168\u76f8\u540c\u30022.x \u7684 .sync \u4e0d\u662f\u771f\u6b63\u7684\u53cc\u5411\u7ed1\u5b9a\uff0c\u800c\u662f\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff0c\u4fee\u6539\u6570\u636e\u8fd8\u662f\u5728\u7236\u7ec4\u4ef6\u5b8c\u6210\u7684\uff0c\u5e76\u975e\u5728\u5b50\u7ec4\u4ef6\u3002\n\n\u4ecd\u7136\u662f\u6570\u5b57\u9009\u62e9\u5668\u7684\u793a\u4f8b\uff0c\u8fd9\u6b21\u4e0d\u7528 v-model\uff0c\u800c\u662f\u7528 .sync\uff0c\u53ef\u4ee5\u8fd9\u6837\u6539\u5199\uff1a\n\n```\n<template>\n  <div>\n    <button @click=\"increase(-1)\">\u51cf 1</button>\n    <span style=\"color: red;padding: 6px\">{{ value }}</span>\n    <button @click=\"increase(1)\">\u52a0 1</button>\n  </div>\n</template>\n<script>\n  export default {\n    name: 'InputNumber',\n    props: {\n      value: {\n        type: Number\n      }\n    },\n    methods: {\n      increase (val) {\n        this.$emit('update:value', this.value + val);\n      }\n    }\n  }\n</script>\n\n```\n\n\u7528\u4f8b\uff1a\n\n```\n<template>\n  <InputNumber :value.sync=\"value\" />\n</template>\n<script>\n  import InputNumber from '../components/input-number/input-number.vue';\n\n  export default {\n    components: { InputNumber },\n    data () {\n      return {\n        value: 1\n      }\n    }\n  }\n</script>\n\n```\n\n\u770b\u8d77\u6765\u8981\u6bd4 v-model \u7684\u5b9e\u73b0\u7b80\u5355\u591a\uff0c\u5b9e\u73b0\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\u3002v-model \u5728\u4e00\u4e2a\u7ec4\u4ef6\u4e2d\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u4f46 .sync \u53ef\u4ee5\u8bbe\u7f6e\u5f88\u591a\u4e2a\u3002.sync \u867d\u597d\uff0c\u4f46\u4e5f\u6709\u9650\u5236\uff0c\u6bd4\u5982\uff1a\n\n*   **\u4e0d\u80fd**\u548c\u8868\u8fbe\u5f0f\u4e00\u8d77\u4f7f\u7528\uff08\u5982 `v-bind:title.sync=\"doc.title + '!'\"` \u662f\u65e0\u6548\u7684\uff09\uff1b\n*   **\u4e0d\u80fd**\u7528\u5728\u5b57\u9762\u91cf\u5bf9\u8c61\u4e0a\uff08\u5982 `v-bind.sync=\"{ title: doc.title }\"` \u662f\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u7684\uff09\u3002\n\n## $set\n\n\u5728\u4e0a\u4e00\u8282\u5df2\u7ecf\u4ecb\u7ecd\u8fc7 `$set`\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u4f1a\u7528\u5230\u5b83\uff1a\n\n1.  \u7531\u4e8e JavaScript \u7684\u9650\u5236\uff0cVue \u4e0d\u80fd\u68c0\u6d4b\u4ee5\u4e0b\u53d8\u52a8\u7684\u6570\u7ec4\uff1a\n    \n    1.  \u5f53\u5229\u7528\u7d22\u5f15\u76f4\u63a5\u8bbe\u7f6e\u4e00\u4e2a\u9879\u65f6\uff0c\u4f8b\u5982\uff1a`this.items[index] = value`;\n    2.  \u5f53\u4fee\u6539\u6570\u7ec4\u7684\u957f\u5ea6\u65f6\uff0c\u4f8b\u5982\uff1a`vm.items.length = newLength`\u3002\n2.  \u7531\u4e8e JavaScript \u7684\u9650\u5236\uff0c**Vue \u4e0d\u80fd\u68c0\u6d4b\u5bf9\u8c61\u5c5e\u6027\u7684\u6dfb\u52a0\u6216\u5220\u9664**\u3002\n    \n\n\u4e3e\u4f8b\u6765\u770b\uff0c\u5c31\u662f\uff1a\n\n```\n// \u6570\u7ec4\nexport default {\n  data () {\n    return {\n      items: ['a', 'b', 'c']\n    }\n  },\n  methods: {\n    handler () {\n      this.items[1] = 'x';  // \u4e0d\u662f\u54cd\u5e94\u6027\u7684\n    }\n  }\n}\n\n```\n\n\u4f7f\u7528 `$set`\uff1a\n\n```\n// \u6570\u7ec4\nexport default {\n  data () {\n    return {\n      items: ['a', 'b', 'c']\n    }\n  },\n  methods: {\n    handler () {\n      this.$set(this.items, 1, 'x');  // \u662f\u54cd\u5e94\u6027\u7684\n    }\n  }\n}\n\n```\n\n\u4ee5\u5bf9\u8c61\u4e3a\u4f8b\uff1a\n\n```\n// \u5bf9\u8c61\nexport default {\n  data () {\n    return {\n      item: {\n        a: 1\n      }\n    }\n  },\n  methods: {\n    handler () {\n      this.item.b = 2;  // \u4e0d\u662f\u54cd\u5e94\u6027\u7684\n    }\n  }\n}\n\n```\n\n\u4f7f\u7528 `$set`\uff1a\n\n```\n// \u5bf9\u8c61\nexport default {\n  data () {\n    return {\n      item: {\n        a: 1\n      }\n    }\n  },\n  methods: {\n    handler () {\n      this.$set(this.item, 'b', 2);  // \u662f\u54cd\u5e94\u6027\u7684\n    }\n  }\n}\n\n```\n\n\u53e6\u5916\uff0c\u6570\u7ec4\u7684\u4ee5\u4e0b\u65b9\u6cd5\uff0c\u90fd\u662f**\u53ef\u4ee5**\u89e6\u53d1\u89c6\u56fe\u66f4\u65b0\u7684\uff0c\u4e5f\u5c31\u662f\u54cd\u5e94\u6027\u7684\uff1a\n\n`push()`\u3001`pop()`\u3001`shift()`\u3001`unshift()`\u3001`splice()`\u3001`sort()`\u3001`reverse()`\u3002\n\n\u8fd8\u6709\u4e00\u79cd\u5c0f\u6280\u5de7\uff0c\u5c31\u662f\u5148 copy \u4e00\u4e2a\u6570\u7ec4\uff0c\u7136\u540e\u901a\u8fc7 index \u4fee\u6539\u540e\uff0c\u518d\u628a\u539f\u6570\u7ec4\u6574\u4e2a\u66ff\u6362\uff0c\u6bd4\u5982\uff1a\n\n```\nhandler () {\n  const data = [...this.items];\n  data[1] = 'x';\n  this.items = data;\n}\n\n```\n\n## \u8ba1\u7b97\u5c5e\u6027\u7684 set\n\n\u8ba1\u7b97\u5c5e\u6027\uff08computed\uff09\u5f88\u7b80\u5355\uff0c\u800c\u4e14\u4e5f\u4f1a\u5927\u91cf\u4f7f\u7528\uff0c\u4f46\u5927\u591a\u6570\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u662f\u7528\u5b83\u9ed8\u8ba4\u7684 get \u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u5e73\u65f6\u7684\u5e38\u89c4\u5199\u6cd5\uff0c\u901a\u8fc7 computed \u83b7\u53d6\u4e00\u4e2a\u4f9d\u8d56\u5176\u5b83\u72b6\u6001\u7684\u6570\u636e\u3002\u6bd4\u5982\uff1a\n\n```\ncomputed: {\n  fullName () {\n    return `${this.firstName} ${this.lastName}`;\n  }\n}\n\n```\n\n\u8fd9\u91cc\u7684 fullName \u4e8b\u5b9e\u4e0a\u53ef\u4ee5\u5199\u4e3a\u4e00\u4e2a Object\uff0c\u800c\u975e Function\uff0c\u53ea\u662f Function \u5f62\u5f0f\u662f\u6211\u4eec\u9ed8\u8ba4\u4f7f\u7528\u5b83\u7684 get \u65b9\u6cd5\uff0c\u5f53\u5199\u4e3a Object \u65f6\uff0c\u8fd8\u80fd\u4f7f\u7528\u5b83\u7684 set \u65b9\u6cd5\uff1a\n\n```\ncomputed: {\n  fullName: {\n    get () {\n      return `${this.firstName} ${this.lastName}`;\n    },\n    set (val) {\n      const names = val.split(' ');\n      this.firstName = names[0];\n      this.lastName = names[names.length - 1];\n    }\n  }\n}\n\n```\n\n\u8ba1\u7b97\u5c5e\u6027\u5927\u591a\u65f6\u5019\u53ea\u662f\u8bfb\u53d6\u7528\uff0c\u4f7f\u7528\u4e86 set \u540e\uff0c\u5c31\u53ef\u4ee5\u5199\u5165\u4e86\uff0c\u6bd4\u5982\u4e0a\u9762\u7684\u793a\u4f8b\uff0c\u5982\u679c\u6267\u884c `this.fullName = 'Aresn Liang'`\uff0ccomputed \u7684 set \u5c31\u4f1a\u8c03\u7528\uff0cfirstName \u548c lastName \u4f1a\u88ab\u8d4b\u503c\u4e3a Aresn \u548c Liang\u3002\n\n## \u5269\u4f59\u503c\u5f97\u6ce8\u610f\u7684 API\n\n\u8fd8\u6709\u4e00\u4e9b API\uff0c\u53ef\u80fd\u4e0d\u5e38\u7528\uff0c\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u77e5\u9053\u5c31\u597d\uff0c\u672c\u518c\u4e0d\u8be6\u7ec6\u5c55\u5f00\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u901a\u8fc7\u6307\u5f15\u5230 Vue.js \u6587\u6863\u67e5\u770b\u3002\n\n### [delimiters](https://cn.vuejs.org/v2/api/#delimiters)\n\n\u6539\u53d8\u7eaf\u6587\u672c\u63d2\u5165\u5206\u9694\u7b26\uff0cVue.js \u9ed8\u8ba4\u7684\u662f `{{ }}`\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u5176\u5b83\u4e00\u4e9b\u540e\u7aef\u6a21\u677f\uff0c\u6bd4\u5982 Python \u7684 Tornado \u6846\u67b6\uff0c\u90a3 Vue.js \u548c Tornado \u7684 `{{ }}` \u5c31\u51b2\u7a81\u4e86\uff0c\u8fd9\u65f6\u7528\u5b83\u53ef\u4ee5\u4fee\u6539\u4e3a\u6307\u5b9a\u7684\u5206\u9694\u7b26\u3002\n\n### [v-once](https://cn.vuejs.org/v2/api/#v-once)\n\n\u53ea\u6e32\u67d3\u5143\u7d20\u548c\u7ec4\u4ef6**\u4e00\u6b21**\u3002\u968f\u540e\u7684\u91cd\u65b0\u6e32\u67d3\uff0c\u5143\u7d20/\u7ec4\u4ef6\u53ca\u5176\u6240\u6709\u7684\u5b50\u8282\u70b9\u5c06\u88ab\u89c6\u4e3a\u9759\u6001\u5185\u5bb9\u5e76\u8df3\u8fc7\u3002\u8fd9\u53ef\u4ee5\u7528\u4e8e\u4f18\u5316\u66f4\u65b0\u6027\u80fd\u3002\n\n### [vm.$isServer](https://cn.vuejs.org/v2/api/#vm-isServer)\n\n\u5f53\u524d Vue \u5b9e\u4f8b\u662f\u5426\u8fd0\u884c\u4e8e\u670d\u52a1\u5668\uff0c\u5982\u679c\u4f60\u7684\u7ec4\u4ef6\u8981\u517c\u5bb9 SSR\uff0c\u5b83\u4f1a\u5f88\u6709\u7528\u3002\n\n### [inheritAttrs](https://cn.vuejs.org/v2/api/#inheritAttrs)\n\n\u4e00\u4e9b\u539f\u751f\u7684 html \u7279\u6027\uff0c\u6bd4\u5982 `id`\uff0c\u5373\u4f7f\u6ca1\u6709\u5b9a\u4e49 props\uff0c\u4e5f\u4f1a\u88ab\u96c6\u6210\u5230\u7ec4\u4ef6\u6839\u8282\u70b9\u4e0a\uff0c\u8bbe\u7f6e inheritAttrs \u4e3a false \u53ef\u4ee5\u5173\u95ed\u6b64\u7279\u6027\u3002\n\n### [errorHandler](https://cn.vuejs.org/v2/api/#errorHandler)\n\n\u4f7f\u7528 `errorHandler` \u53ef\u4ee5\u8fdb\u884c\u5f02\u5e38\u4fe1\u606f\u7684\u83b7\u53d6\u3002\n\n### [watch](https://cn.vuejs.org/v2/api/#watch)\n\n\u76d1\u542c\u72b6\u6001\u7684\u53d8\u5316\uff0c\u7528\u7684\u4e5f\u5f88\u591a\u4e86\uff0c\u4f46\u5b83\u548c computed \u4e00\u6837\uff0c\u4e5f\u6709 Object \u7684\u5199\u6cd5\uff0c\u8fd9\u6837\u80fd\u914d\u7f6e\u66f4\u591a\u7684\u9009\u9879\uff0c\u6bd4\u5982\uff1a\n\n*   handler \u6267\u884c\u7684\u51fd\u6570\n*   deep \u662f\u5426\u6df1\u5ea6\n*   immediate \u662f\u5426\u7acb\u5373\u6267\u884c\n\n\u5b8c\u6574\u7684\u914d\u7f6e\u53ef\u4ee5\u9605\u8bfb\u6587\u6863\u3002\n\n### [comments](https://cn.vuejs.org/v2/api/#comments)\n\n\u5f00\u542f\u4f1a\u4fdd\u7559 html \u6ce8\u91ca\u3002\n\n### [transition](https://cn.vuejs.org/v2/api/#transition)\n\n\u5185\u7f6e\u7684\u7ec4\u4ef6\uff0c\u53ef\u505a\u8fc7\u6e21\u6548\u679c\uff0c\u6bd4\u5982 CSS \u7684\u9ad8\u5ea6\u4ece 0 \u5230 auto\uff08\u4f7f\u7528\u7eaf CSS \u662f\u65e0\u6cd5\u5b9e\u73b0\u52a8\u753b\u7684\uff09\u3002\n\n## \u7ed3\u8bed\n\n\u5f7b\u5e95\u638c\u63e1\u4e00\u95e8\u8bed\u8a00\uff08\u6846\u67b6\uff09\uff0c\u4e0d\u9700\u8981\u9605\u8bfb\u5b83\u6240\u6709\u7684\u6e90\u7801\uff0c\u4f46\u81f3\u5c11\u8981\u9605\u8bfb\u5b83\u6240\u6709\u7684 [API](https://cn.vuejs.org/v2/api/)\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u62d3\u5c55Vue.js_\u5bb9\u6613\u5ffd\u7565\u7684_API_\u8be6\u89e3.md", "create_date": "2020-02-18T21:37:08.998", "order": 16}}, {"model": "subject.chapter", "pk": 112, "fields": {"title": "\u5199\u5728\u6700\u540e", "topic": 5, "md5": "029b1f60502db27680400309e19eec15", "md_body": "# \u5199\u5728\u6700\u540e\n\n\u4eb2\u7231\u7684\u8bfb\u8005\uff0c\u5230\u8fd9\u91cc\u672c\u5c0f\u518c\u5c31\u8981\u7ed3\u675f\u4e86\uff0c\u4f60\u662f\u5426\u4ece\u4e2d\u5b66\u4e60\u5230\u4e86\u5c5e\u4e8e\u4f60\u7684\u77e5\u8bc6\u5462\uff1f\u6211\u4eec\u6765\u56de\u987e\u4e00\u4e0b\u5c0f\u518c\u7684\u5185\u5bb9\u5427\u3002\n\nVue.js \u5728\u5f00\u53d1\u72ec\u7acb\u7ec4\u4ef6\u65f6\uff0c\u7531\u4e8e\u5b83\u7684\u7279\u6b8a\u6027\uff0c\u65e0\u6cd5\u4f7f\u7528 Vuex\u3001Bus \u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u63d2\u4ef6\u6765\u505a\u7ec4\u4ef6\u901a\u4fe1\uff0c\u56e0\u6b64\u5c0f\u518c\u63d0\u5230\u4e86 3 \u79cd\u7ec4\u4ef6\u95f4\u7684\u901a\u4fe1\u65b9\u6cd5\uff0c\u90fd\u662f\u652f\u6301\u8de8\u591a\u7ea7\u7684\uff1a\n\n1.  provide / inject\uff1a\u7531\u7236\u7ec4\u4ef6\u901a\u8fc7 `provide` \u5411\u4e0b\u63d0\u4f9b\u4e00\u4e2a\u6570\u636e\uff0c\u5b50\u7ec4\u4ef6\u5728\u9700\u8981\u65f6\uff0c\u901a\u8fc7 `inject` \u6ce8\u5165\u8fd9\u4e2a\u4f9d\u8d56\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7236\u7ea7\u7684\u6570\u636e\u4e86\u3002\n2.  dispatch / broadcast\uff1a\u7ec4\u4ef6\u5411\u4e0a\u6d3e\u53d1\u6216\u5411\u4e0b\u5e7f\u64ad\u4e00\u4e2a\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u7ec4\u4ef6\u901a\u8fc7 `$on` \u6765\u76d1\u542c\u3002\n3.  findComponents \u7cfb\u5217\uff1a\u5171\u5305\u542b 5 \u4e2a\u65b9\u6cd5\uff0c\u901a\u8fc7\u7ec4\u4ef6\u7684 `name` \u9009\u9879\uff0c\u904d\u5386\u627e\u5230\u5bf9\u5e94\u7684\u5b9e\u4f8b\uff0c\u8fd9\u662f\u7ec4\u4ef6\u901a\u4fe1\u7684\u7ec8\u6781\u65b9\u6848\uff0c\u9002\u7528\u4e8e\u6240\u6709\u573a\u666f\u3002\n\n\u672c\u518c\u603b\u5171\u8bb2\u89e3\u4e86 7 \u4e2a\u7ec4\u4ef6\u7684\u5b9e\u4f8b\uff1a\n\n1.  \u5177\u6709\u6570\u636e\u6821\u9a8c\u529f\u80fd\u7684 Form \u7ec4\u4ef6\uff0c\u5b83\u7528\u5230\u4e86\u7b2c 1 \u79cd\u7ec4\u4ef6\u901a\u4fe1\uff1b\n2.  \u7ec4\u5408\u591a\u9009\u6846 Checkbox \u7ec4\u4ef6\uff0c\u5b83\u7528\u5230\u4e86\u7b2c 2 \u79cd\u548c\u7b2c 3 \u79cd\u7ec4\u4ef6\u901a\u4fe1\uff1b\n3.  Display \u7ec4\u4ef6\uff0c\u5b83\u5229\u7528 Vue.js \u7684\u6784\u9020\u5668 extend \u548c\u624b\u52a8\u6302\u8f7d $mount API\uff1b\n4.  \u5168\u5c40\u901a\u77e5 $Alert \u7ec4\u4ef6\uff0c\u4e5f\u662f\u5229\u7528\u4e86 $mount API\uff0c\u4e0e\u4f20\u7edf\u7ec4\u4ef6\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u57fa\u4e8e Vue.js \u7ec4\u4ef6\u5f00\u53d1\uff0c\u4f46\u5374\u662f\u4ee5 JavaScript \u7684\u5f62\u5f0f\u8c03\u7528\u7684\uff0c\u5e76\u4e14\u7ec4\u4ef6\u4f1a\u5728 body \u8282\u70b9\u4e0b\u6e32\u67d3\uff1b\n5.  \u8868\u683c\u7ec4\u4ef6 Table\uff0c\u5178\u578b\u7684\u6570\u636e\u9a71\u52a8\u578b\u7ec4\u4ef6\uff0c\u4f7f\u7528\u4e86\u51fd\u6570\u5f0f\u7ec4\u4ef6\uff08Functional Render\uff09\u6765\u81ea\u5b9a\u4e49\u5217\u6a21\u677f\uff1b\n6.  \u8868\u683c\u7ec4\u4ef6 Table\uff0c\u4e0e\u4e0a\u4f8b\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u7684\u81ea\u5b9a\u4e49\u5217\u6a21\u677f\u4f7f\u7528\u4e86 `slot-scope`\uff1b\n7.  \u6811\u5f62\u63a7\u4ef6 Tree\uff0c\u5178\u578b\u7684\u6570\u636e\u9a71\u52a8\u578b\u7ec4\u4ef6\uff0c\u4e5f\u662f\u5178\u578b\u7684\u9012\u5f52\u7ec4\u4ef6\uff0c\u5176\u4e2d\u5229\u7528 computed \u505a\u7236\u5b50\u8282\u70b9\u8054\u52a8\u662f\u7cbe\u9ad3\u3002\n\n\u6700\u540e\u7684\u62d3\u5c55\u90e8\u5206\uff0c\u5bf9 Vue.js \u7ec4\u4ef6\u7684\u5e38\u89c1 API \u505a\u4e86\u8be6\u7ec6\u4ecb\u7ecd\uff0c\u4ee5\u53ca\u5e38\u89c1\u7684 Vue.js \u9762\u8bd5\u9898\u5206\u6790\u548c\u5bf9\u5f00\u6e90\u7684\u4e00\u4e9b\u89c1\u89e3\u3002\n\nVue.js \u7ec4\u4ef6\u5f00\u53d1\uff0c\u5f52\u6839\u5230\u5e95\u62fc\u7684\u662f JavaScript \u7684\u529f\u5e95\uff0cVue.js \u5728\u5176\u4e2d\u53ea\u662f\u51b3\u5b9a\u4e86\u5f00\u53d1\u6a21\u5f0f\uff0c\u6240\u4ee5\uff0c\u6253\u597d JavaScript \u57fa\u7840\u624d\u662f\u6700\u91cd\u8981\u7684\u3002\n\n\u6700\u540e\uff0c\u795d\u613f\u4eb2\u7231\u7684\u8bfb\u8005\u80fd\u5728\u7f16\u7a0b\u7684\u9053\u8def\u4e0a\u8d8a\u8d70\u8d8a\u8fdc\u3002\n\n**\u53e6\u5916\uff0c\u5982\u679c\u60a8\u6709\u5173\u4e8e Vue.js \u6216\u5176\u5b83\u524d\u7aef\u76f8\u5173\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u901a\u8fc7 [iView \u793e\u533a](https://dev.iviewui.com/issues) \u4ed8\u8d39\u5411\u7b14\u8005\u63d0\u95ee\uff0c\u5e0c\u671b\u80fd\u5bf9\u4e00\u90e8\u5206\u4eba\u6709\u6240\u5e2e\u52a9\u3002**", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u5199\u5728\u6700\u540e.md", "create_date": "2020-02-18T21:37:09.010", "order": 20}}, {"model": "subject.chapter", "pk": 113, "fields": {"title": "\u62d3\u5c55\uff1a\u5982\u4f55\u505a\u597d\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff08\u4e0a\u7bc7\uff09", "topic": 5, "md5": "430a66c61d580b6aacc9e81b38ab4db4", "md_body": "# \u62d3\u5c55\uff1a\u5982\u4f55\u505a\u597d\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff08\u4e0a\u7bc7\uff09\n\n## iView \u7684\u6545\u4e8b\n\n\u6bd5\u4e1a\u56db\u5e74\u4ee5\u6765\uff0c\u6211\u4e00\u76f4\u89c9\u5f97\u81ea\u5df1\u662f\u4e00\u4e2a\u5f88\u5e78\u8fd0\u7684\u4eba\uff0c\u5e78\u8fd0\u53c2\u4e0e\u8fc7\u521b\u4e1a\uff0c\u5e78\u8fd0\u4e00\u8def\u6709\u5927\u725b\u5e26\uff0c\u5e78\u8fd0\u5f00\u6e90\u4e86 iView \u9879\u76ee\u3002\n\n2016 \u5e74\u521d\uff0c\u6211\u8fd8\u662f\u4e00\u540d\u666e\u901a\u7684\u524d\u7aef\u5de5\u7a0b\u5e08\uff0c\u90a3\u65f6\u5019\u8fd8\u662f Vue.js 1.x \u7684\u65f6\u4ee3\uff0c\u77e5\u540d\u5ea6\u4e5f\u8fdc\u4e0d\u5982\u73b0\u5728\uff0c\u5728\u5927\u90e8\u5206\u4eba\u773c\u4e2d\uff0cVue.js \u5c31\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684 Angular\u3002\n\n\u6211\u6240\u5728\u7684\u516c\u53f8\u662f\u505a to B \u4e1a\u52a1\u7684\uff0c\u4e0e\u5927\u90e8\u5206\u516c\u53f8\u4e00\u6837\uff0c\u90a3\u65f6\u4e3b\u5bfc jQuery\uff0c\u628a Vue.js \u5f15\u5165\u56e2\u961f\u4e43\u81f3\u6574\u4e2a\u516c\u53f8\uff0c\u662f\u4e00\u4ef6\u5f88\u4e0d\u6613\u7684\u4e8b\uff0c\u56e0\u4e3a\u4e0d\u662f\u4f60\u81ea\u5df1\u5728\u7528\uff0c\u4f60\u8981\u8bf4\u670d\u6240\u6709\u4eba\u7528\uff0c\u73b0\u5728\u770b\u6765\uff0c\u5f53\u521d\u7684\u51b3\u5b9a\u662f\u5f88\u6b63\u786e\u7684\u3002\u5982\u679c\u4f60\u6709\u5174\u8da3\uff0c\u6b22\u8fce\u9605\u8bfb\u6269\u5c55\u9605\u8bfb 1\uff0c\u90a3\u7bc7\u6587\u7ae0\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u6211\u7684 Vue.js \u201c\u63a8\u5e7f\u53f2\u201d\u3002\n\n\u5230\u4e86 16 \u5e74 7 \u6708\uff0c\u6211\u4eec\u56e2\u961f\u5df2\u7ecf\u5b8c\u5168\u8ba4\u53ef\u4e86 Vue.js + Webpack \u7684\u6280\u672f\u6808\uff0c\u4e00\u76f4\u8df5\u884c\u81f3\u4eca\u3002\u4e00\u4e2a\u5076\u7136\u7684\u673a\u4f1a\uff0c\u516c\u53f8\u4e3e\u529e\u4e86\u4e00\u4e2a\u521b\u65b0\u5927\u8d5b\uff0c\u4f5c\u4e3a\u53ef\u89c6\u5316\u56e2\u961f\uff0c\u6211\u63d0\u8bae\u505a\u4e00\u5957\u81ea\u5df1\u7684\u7ec4\u4ef6\u5e93\u3002\u5f53\u521d\u4e5f\u53ea\u662f\u4e00\u4e2a\u60f3\u6cd5\uff0c\u62b1\u7740\u8bd5\u8bd5\u770b\u7684\u6001\u5ea6\u5c31\u62a5\u540d\u4e86\u3002\u6bd4\u8d5b\u7684\u76ee\u7684\u53ea\u662f\u547c\u5401\u5927\u5bb6\u521b\u65b0\uff0c\u540e\u7eed\u5c31\u6ca1\u6709\u52a8\u4f5c\u4e86\uff0c\u4f46\u662f\u6211\u6ca1\u6709\u5c31\u6b64\u653e\u4e0b\uff0c\u4ece\u90a3\u65f6\u8d77\uff0c\u51e0\u4e4e\u5168\u804c\u5f00\u53d1 iView\uff0c\u4e24\u5e74\u534a\u6765\uff0c\u6211\u6bcf\u5929\u7684\u5de5\u4f5c\u57fa\u672c\u5c31\u662f\u7ef4\u62a4 iView\u3002\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u4e00\u4e2a\u6210\u529f\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u5fc5\u987b\u6709 leader \u7684\u8ba4\u53ef\u548c\u516c\u53f8\u7684\u652f\u6301\uff0c\u7f3a\u4e00\u4e0d\u53ef\u3002\n\n\u90a3\u65f6\u4e0d\u6bd4\u73b0\u5728\uff0c\u4f18\u79c0\u7684 Vue.js \u7ec4\u4ef6\u5e93\u975e\u5e38\u5c11\uff0c\u6587\u732e\u66f4\u662f\u5c11\u5f97\u53ef\u601c\u3002\u4e00\u5f00\u59cb\u505a iView \u6ca1\u4ec0\u4e48\u5934\u7eea\uff0c\u53ea\u662f\u89c4\u5212\u4e86\u4e00\u5f20 MindNode \u8111\u56fe\uff0c\u7f57\u5217\u4e86\u4e00\u671f\u8981\u505a\u7684\u6240\u6709\u7ec4\u4ef6\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u63d2\u66f2\uff0c\u56e0\u4e3a\u8fd9\u5f20 todo \u7684\u8111\u56fe\u6709\u8d34\u5728 GitHub \u7684 Readme\uff0c\u4ee5\u81f3\u4e8e\u4e00\u5f00\u59cb\u5927\u90e8\u5206 issues \u90fd\u662f\u95ee\u8fd9\u4e2a\u8111\u56fe\u662f\u7528\u4ec0\u4e48\u8f6f\u4ef6\u505a\u7684\uff0c\u56e0\u4e3a\u505a\u7684\u5f88\u597d\u770b\uff0c\u7d22\u6027\u5199\u4e86\u4e2a\u63d0\u95ee\u987b\u77e5\uff0c\u6ce8\u660e\u4e86\u8111\u56fe\u662f\u7528 MindNode \u5236\u4f5c\u7684\u3002\n\n\u8d77\u521d\u5bf9\u5f00\u6e90\u5de5\u4f5c\u4e0d\u662f\u5f88\u4e86\u89e3\uff0c\u8fde\u4e00\u4e2a\u7f16\u8bd1\u5de5\u7a0b\u90fd\u642d\u4e0d\u8d77\u6765\uff0c\u60f3\u4e86\u6570\u65e5\u4e5f\u641e\u4e0d\u5b9a\u3002\u4e0e\u5927\u90e8\u5206\u4eba\u4e00\u6837\uff0c\u4e00\u5f00\u59cb\u4e5f\u662f\u8981\u53c2\u8003\u5176\u5b83\u4eba\u7684\u5f00\u6e90\u9879\u76ee\uff08\u5c31\u50cf\u73b0\u5728\u5f88\u591a\u4eba\u53c2\u8003 iView \u662f\u4e00\u6837\u7684\uff09\uff0c\u90a3\u662f\u6211\u53c2\u8003 Vux\uff08\u79fb\u52a8\u7aef\u7684 Vue.js \u7ec4\u4ef6\u5e93\uff0c\u5f53\u65f6\u6709 6k star\uff09\uff0c\u5411\u4f5c\u8005\u6350\u4e86\u676f\u5496\u5561\u94b1\uff0c\u987a\u4fbf\u52a0\u4e86\u597d\u53cb\uff08\u56e0\u4e3a\u662f\u652f\u4ed8\u5b9d\u6350\u8d60\uff0c\u80fd\u52a0\u597d\u53cb\uff09\uff0c\u8bf7\u6559\u4e86\u5de5\u7a0b\u7684\u95ee\u9898\uff0c\u8fd9\u624d\u4e00\u6b65\u6b65\u642d\u8d77\u6765\uff0c\u73b0\u5728\u60f3\u60f3\u771f\u662f\u5e78\u8fd0\u3002\n\n\u4e07\u4e8b\u5f00\u5934\u96be\uff0c\u628a\u5730\u57fa\u642d\u597d\uff0c\u5269\u4e0b\u7684\u90fd\u662f\u6dfb\u7816\u52a0\u74e6\u7684\u4e8b\u3002\u5dee\u4e0d\u591a 16 \u5e74\u5e95\uff0ciView \u4e00\u671f\u5b8c\u6210\u4e86\uff0843 \u4e2a\u7ec4\u4ef6\uff09\uff0c\u4e5f\u53d1\u5e03\u4e86\u7b2c\u4e00\u4e2a\u6b63\u5f0f\u7248\uff0c\u6709\u4e86\u7b2c\u4e00\u6279\u7528\u6237\uff08\u5f53\u7136\uff0c\u4e3b\u8981\u8fd8\u662f\u81ea\u5df1\u516c\u53f8\uff09\uff0c\u7136\u800c\u5728\u90a3\u4e2a\u65f6\u5019\uff0c\u53c8\u505a\u4e86\u4e00\u4e2a\u5728\u4eca\u5929\u770b\u6765\u7a0d\u665a\u4f46\u6b63\u786e\u7684\u51b3\u5b9a\u2014\u2014\u652f\u6301 Vue.js 2\u3002\n\n\u867d\u7136\u662f\u5f00\u6e90\u9879\u76ee\uff0c\u4f46\u4e3b\u8981\u8fd8\u662f\u5148\u6ee1\u8db3\u81ea\u5df1\u56e2\u961f\u548c\u516c\u53f8\u7684\u9700\u6c42\uff0c\u90a3\u4e2a\u65f6\u5019\u6240\u6709\u7684\u9879\u76ee\u90fd\u662f Vue.js 1.x \u7684\uff0c\u8fd8\u6ca1\u6709\u7528 Vue.js 2\uff0c\u4f46 2.x \u5df2\u7ecf\u53d1\u5e03\u6709\u4e00\u6bb5\u65f6\u95f4\u4e86\uff0c\u4ee5\u81f3\u4e8e\u5728 2017 \u5e74\u521d\uff0cGitHub \u6709\u5f88\u591a issues \u95ee\u4ec0\u4e48\u65f6\u5019\u652f\u6301 2.x\u3002\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u6ca1\u6709\u5347\u7ea7\u5230 2.x\uff0c\u4e3b\u8981\u56e0\u4e3a\u8981\u652f\u6301\u516c\u53f8\u7684\u9879\u76ee\uff0c\u800c\u6211\u5f53\u65f6\u4e5f\u89c9\u5f97\u5347\u7ea7\u5230 2.x \u662f\u4e00\u4e2a\u5f88\u8017\u65f6\u7684\u5de5\u4f5c\uff0c\u5c31\u6ca1\u6709\u652f\u6301\u3002\u540e\u6765\uff0c\u6709\u4e00\u4e2a\u4eba\u63d0\u4ea4\u4e86\u4e00\u4e2a\u975e\u5e38\u5927\u7684 PR\uff0c\u5c06\u6240\u6709\u7ec4\u4ef6\u90fd\u652f\u6301\u4e86 2.x\uff0c\u800c\u4e14\u53ea\u7528\u4e86\u4e00\u4e2a\u5468\u672b\u7684\u65f6\u95f4\u3002\u8fd9\u4ef6\u4e8b\u8ba9\u6211\u610f\u8bc6\u5230\u652f\u6301 Vue.js 2.x \u7684\u91cd\u8981\u6027\u4e86\uff0c\u4e8e\u662f\u82b1\u4e86 2 \u5468\u65f6\u95f4\u7814\u7a76\uff0c\u5e76\u5347\u7ea7\u5230\u4e86 2.x\uff08\u90a3\u4e2a pr \u6ca1\u6709\u76f4\u63a5\u5408\u5e76\uff0c\u800c\u662f\u53c2\u8003\uff0c\u56e0\u4e3a\u5f88\u591a\u5730\u65b9\u6709 bug\uff09\u3002\u63a5\u4e0b\u6765\u7684\u51e0\u4e2a\u6708\uff0c\u90fd\u5728\u4e0d\u65ad\u7ef4\u62a4\u65b0\u7684 iView\uff0c\u4f7f\u7528\u8005\u4e5f\u4e0d\u65ad\u589e\u591a\uff0c\u793e\u533a\u53c8\u91cd\u65b0\u6d3b\u8dc3\u8d77\u6765\u3002\n\n\u5982\u679c\u5f53\u521d\u6ca1\u6709\u53ca\u65f6\u8f6c\u578b\uff08\u73b0\u5728\u770b\u6765\u4ecd\u7136\u662f\u665a\u4e86\uff09\uff0c\u8fd8\u5728\u4e00\u5473\u5730\u7ef4\u62a4 Vue.js 1.x \u7248\u672c\uff0c\u90a3 iView \u4e5f\u8bb8\u65e9\u5c31\u5b8c\u4e86\u3002\u6709\u4e86\u597d\u7684\u5f00\u5934\uff0c\u5c31\u8981\u4e0d\u653e\u5f03\uff0c\u4e0d\u629b\u5f03\uff0c\u575a\u6301\u505a\u4e0b\u53bb\uff0c\u8ba4\u771f\u5904\u7406\u6bcf\u4e00\u4e2a PR\uff0c\u56e0\u4e3a\u8d28\u91cf\u662f\u4e00\u4e2a\u5f00\u6e90\u7ec4\u4ef6\u5e93\u6700\u91cd\u8981\u7684\uff0c\u4f46\u5e76\u4e0d\u662f\u6bcf\u4e00\u4e2a PR \u90fd\u9002\u5408 merge\uff0c\u5373\u4f7f\u4f5c\u8005\u4ed8\u51fa\u4e86\u5f88\u591a\u65f6\u95f4\u63d0\u4ea4\u8fd9\u4e2a PR\uff0c\u4e5f\u4f1a\u6709\u8d28\u91cf\u95ee\u9898\u3002\n\n\u6709\u4e86\u4e0d\u9519\u7684\u53e3\u7891\uff0c\u5728 2018 \u5e74\u7ee7\u7eed\u5b8c\u5584\uff0c\u76ee\u524d\u5df2\u7ecf\u662f\u540c\u7c7b\u4ea7\u54c1\u91cc\u529f\u80fd\u6700\u4e30\u5bcc\u7684\u7ec4\u4ef6\u5e93\uff0c\u800c\u4e14\u5728 18 \u5e74\u7684 7 \u6708 28 \u65e5\uff08iView \u4e24\u5468\u5e74\uff09\u6210\u529f\u4e3e\u884c\u4e86 3.0 \u53d1\u5e03\u4f1a\uff0c\u4e00\u5207\u90fd\u5728\u671d\u7740\u66f4\u597d\u7684\u4e00\u9762\u53d1\u5c55\u7740......\n\n\u8fd9\u5c31\u662f\u6211\u7684 iView \u5f00\u6e90\u7684\u6545\u4e8b\uff0c\u4e00\u4e2a\u6210\u529f\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u6216\u8bb8\u5e26\u6709\u4e00\u70b9\u5c0f\u5e78\u8fd0\uff0c\u56e0\u4e3a\u5982\u4eca\u7684\u540c\u7c7b\u5f00\u6e90\u4ea7\u54c1\u5df2\u7ecf\u6570\u4e0d\u80dc\u6570\u4e86\uff0c\u4e0d\u8fc7\u786e\u5b9e\u6709\u5f88\u591a\u503c\u5f97\u5206\u4eab\u7684\u5730\u65b9\uff0c\u5982\u679c\u4f60\u6253\u7b97\u505a\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u5e0c\u671b\u4e0b\u9762\u7684\u4e9b\u8bb8\u7ecf\u9a8c\u80fd\u591f\u5e2e\u52a9\u5230\u4f60\u3002\n\n## \u4e0d\u8981\u76f2\u76ee\u9020\u8f6e\u5b50\n\n\u6bcf\u4e00\u4e2a\u505a\u5f00\u6e90\u9879\u76ee\u7684\u5f00\u53d1\u8005\uff0c\u90fd\u662f\u6709\u76ee\u7684\u7684\uff0c\u5982\u679c\u4f60\u505a\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u6ca1\u6709\u4efb\u4f55\u76ee\u7684\uff0c\u90a3\u4f60\u7684\u76ee\u7684\u591a\u534a\u662f\u8981\u9020\u4e2a\u8f6e\u5b50\u6765\u63d0\u5347\u4e0b\u6280\u672f\u3002\n\n\u4e2d\u56fd\u5f53\u524d\u7684\u5f00\u6e90\u73af\u5883\u548c\u6c1b\u56f4\u867d\u4e0d\u662f\u5f88\u597d\uff0c\u201c\u62ff\u6765\u4e3b\u4e49\u201d\u8005\u5c45\u591a\uff0c\u4f46\u76f8\u6bd4\u51e0\u5e74\u524d\uff0c\u5df2\u662f\u4e0d\u9519\u4e86\uff0c\u66f4\u591a\u7684\u4eba\u559c\u6b22\u628a\u81ea\u5df1\u6770\u51fa\u7684\u4ee3\u7801\u5f00\u6e90\u51fa\u6765\u3002\u76ee\u524d\u591a\u6570\u201c\u6b63\u7ecf\u201d\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u90fd\u662f KPI \u5bfc\u5411\u7684\uff0c\u4e0d\u80fd\u8bf4\u9879\u76ee\u4e0d\u597d\uff0c\u53ea\u662f\u4e00\u5b9a\u65f6\u95f4\u540e\uff0c\u53ef\u80fd\u5c31\u4e0d\u7ef4\u62a4\u4e86\uff0c\u800c\u5f00\u6e90\u9879\u76ee\u4e0d\u4ec5\u4ec5\u8981\u89e3\u51b3\u95ee\u9898\uff0c\u6301\u7eed\u7ef4\u62a4\u4e5f\u662f\u89c2\u671b\u7740\u6700\u5728\u610f\u7684\u3002\n\n\u76f8\u6bd4 React\uff0cVue.js \u7684\u7ec4\u4ef6\u5e93\u5f00\u6e90\u9879\u76ee\u8981\u591a\u7684\u591a\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u5c31\u80fd\u770b\u5230\u51e0\u4e2a\u65b0\u7684\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a Vue.js \u66f4\u5bb9\u6613\u4e0a\u624b\uff0c\u5f00\u53d1\u8005\u5f88\u6d3b\u8dc3\u3002\u65e2\u7136\u5df2\u7ecf\u6709\u8fd9\u4e48\u7684\u540c\u7c7b\u9879\u76ee\u4e86\uff0c\u90a3\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6301\u7eed\u9020\u8f6e\u5b50\u5462\uff1f\u56e0\u4e3a\u4e2d\u56fd\u7684\u5f00\u53d1\u8005\u5c31\u662f\u559c\u6b22\u81ea\u5df1\u6298\u817e\u4e00\u4e2a\uff0c\u800c\u4e0d\u662f\u53bb\u7ef4\u62a4\u4e00\u4e2a\u73b0\u6210\u7684\u3002\n\n\u5c31\u4ee5 Vue.js \u7ec4\u4ef6\u5e93\u7684\u5f00\u6e90\u73b0\u8c61\u6765\u8bf4\uff0c\u6e90\u6e90\u4e0d\u65ad\u7684\u8f6e\u5b50\uff0c\u4e3b\u8981\u8fd8\u662f\u5e02\u9762\u4e0a\u5df2\u6709\u7684\u7ec4\u4ef6\u5e93\u4e0d\u80fd\u5b8c\u5168\u6ee1\u8db3\u81ea\u5df1\u7684\u4e1a\u52a1\uff0c\u4e3b\u8981\u8fd8\u662f UI \u5c42\u9762\u7684\uff0c\u5355\u8bba\u529f\u80fd\uff0c\u5e02\u9762\u4e0a\u6210\u719f\u7684\u7ec4\u4ef6\u5e93\u8db3\u591f\u5b8c\u5584\uff0c\u751a\u81f3\u8d85\u51fa\u4f60\u7684\u4e1a\u52a1\u9700\u6c42\u3002\u4e0d\u597d\u8bf4\u8fd9\u79cd\u73b0\u8c61\u662f\u597d\u662f\u574f\uff0c\u597d\u7684\u662f\u4ece\u5934\u5f00\u53d1\u4e00\u4e2a\u7ec4\u4ef6\u5e93\uff0c\u5bf9\u6280\u672f\u7684\u63d0\u5347\u8fd8\u662f\u6709\u7684\uff0c\u5b83\u4f1a\u7763\u4fc3\u4f60\u5b66\u4e60\u522b\u4eba\u7684\u4ee3\u7801\uff0c\u6765\u6539\u826f\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u5426\u5219\u9020\u4e00\u4e2a\u8fd8\u4e0d\u5982\u522b\u4eba\u7684\u8f6e\u5b50\u4e5f\u5c31\u6ca1\u610f\u4e49\u4e86\u3002\u5bf9\u4e8e\u516c\u53f8\u6765\u8bf4\uff0c\u4e5f\u6709\u4e86\u81ea\u5df1\u7684 UI \u7ec4\u4ef6\u5e93\u548c\u89c4\u8303\uff08\u867d\u7136\u5f88\u591a\u53ea\u662f fork \u540e\u6539\u7684\uff09\uff0c\u611f\u89c9\u7528\u81ea\u5df1\u7684\u4e1c\u897f\uff0c\u5bf9\u5185\u5bf9\u5916\u90fd\u662f\u4e00\u4ef6\u5f88\u81ea\u8c6a\u7684\u4e8b\u3002\u4e0d\u597d\u7684\u5c31\u662f\uff0c\u8fd9\u662f\u4e00\u79cd\u7a0b\u5e8f\u5458\u5411\u4ea7\u54c1\u6216 UI \u6216 leader \u7684\u59a5\u534f\uff0c\u56e0\u4e3a\u6ca1\u529e\u6cd5\u8bf4\u670d\u4ed6\u4eec\u4f7f\u7528\u5e02\u9762\u4e0a\u6210\u719f\u7684\u7ec4\u4ef6\u5e93\uff0c\u5426\u5219\uff0c\u5b8c\u5168\u53ef\u4ee5\u628a\u9020\u8f6e\u5b50\u7684\u7cbe\u529b\u7528\u4e8e\u7ef4\u62a4\u4e00\u4e2a\u6210\u719f\u7684\u9879\u76ee\u3002\n\n\u9020\u8f6e\u5b50\u8fd9\u4e2a\u8bcd\uff0c\u4f3c\u4e4e\u6210\u4e86\u524d\u7aef\u5708\u7684\u4ee3\u540d\u8bcd\uff0c\u7684\u786e\uff0c\u524d\u7aef\u7684\u9020\u8f6e\u5b50\u80fd\u529b\u662f\u6781\u5f3a\u7684\uff0c\u4f46\u4e0d\u80fd\u76f2\u76ee\u9020\u8f6e\u5b50\u3002\u5982\u679c\u4f60\u53ea\u662f\u4eff\u7167\u5176\u5b83\u5f00\u6e90\u9879\u76ee\u7ec3\u4e60\uff0c\u90a3\u5c31\u4e0d\u8bf4\u4e86\uff0c\u5982\u679c\u662f\u60f3\u8ba4\u771f\u505a\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u800c\u4e0d\u662f\u9020\u4e2a\u8f6e\u5b50\u73a9\u73a9\uff0c\u90a3\u4e00\u5b9a\u8981\u6784\u601d\u597d\u4f60\u8981\u505a\u7684\u4e1c\u897f\u3002\n\n\u4e00\u822c\u6765\u8bf4\uff0c\u5728\u51b3\u5b9a\u505a\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u524d\uff0c\u90fd\u662f\u8981\u505a\u5e02\u573a\u8c03\u7814\u7684\uff0c\u4f60\u8981\u5f88\u6e05\u695a\u7684\u77e5\u9053\uff0c\u81ea\u5df1\u505a\u7684\u9879\u76ee\u5f25\u8865\u4e86\u540c\u7c7b\u4ea7\u54c1\u7684\u54ea\u4e9b\u4e0d\u8db3\uff0c\u6216\u8005\u6709\u54ea\u4e9b\u65b0\u7684\u7279\u6027\uff0c\u56e0\u4e3a\u5b83\u4eec\u662f\u7528\u6237\u9009\u62e9\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u7684\u4e3b\u8981\u4f9d\u636e\uff0c\u5426\u5219\u5185\u5bb9\u90fd\u4e00\u6837\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u9009\u4e00\u4e2a\u6210\u719f\u7684\u5462\u3002\n\n\u5982\u679c\u67d0\u4e2a\u5f00\u6e90\u9879\u76ee\u5df2\u7ecf\u5f88\u4e0d\u9519\uff0c\u4f46\u4f60\u5e0c\u671b\u57fa\u4e8e\u5b83\u8fdb\u884c\u6539\u9020\uff0c\u4f46\u4e0d\u662f\u4ee5 PR \u7684\u5f62\u5f0f\uff0c\u90a3\u4f60\u53ef\u4ee5\u5728\u5f00\u6e90\u534f\u8bae\u5141\u8bb8\u7684\u524d\u63d0\u4e0b\uff0cfork \u540e\uff0c\u57fa\u4e8e\u67d0\u4e2a release \u72ec\u7acb\u7ef4\u62a4\u3002\n\n\u6bcf\u4e2a\u5f00\u6e90\u9879\u76ee\u90fd\u6709\u4e00\u4e2a\u6838\u5fc3\u7684\u529f\u80fd\uff0c\u6216\u662f\u89e3\u51b3\u7528\u6237\u7684\u6838\u5fc3\u75db\u70b9\uff0c\u6bd4\u5982 iView \u5c31\u662f\u89e3\u51b3\u7528\u6237\u5efa\u7ad9\u7684\u95ee\u9898\uff0c\u76f8\u6bd4\u540c\u7c7b\u4ea7\u54c1\uff0c\u5b83\u7684\u7279\u70b9\u5c31\u662f\u7ec4\u4ef6\u4e30\u5bcc\u7a0b\u5ea6\u6700\u9ad8\uff0c\u529f\u80fd\u4e5f\u662f\u6700\u5168\u9762\u7684\uff0c\u751f\u6001\u5b8c\u5584\uff0c\u6709\u6280\u672f\u652f\u6301\u6e20\u9053\u3002\u5982\u679c\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u89e3\u51b3\u7684\u95ee\u9898\u662f\u5176\u5b83\u4efb\u4f55\u5f00\u6e90\u9879\u76ee\u6ca1\u6709\u7684\uff0c\u90a3\u7528\u6237\u5f88\u6709\u53ef\u80fd\u4f1a\u4f7f\u7528\u3002\u4f46\u5bf9\u4e8e\u76f8\u540c\u529f\u80fd\u7684\uff0c\u7528\u6237\u66f4\u503e\u5411\u4e8e\u9009\u62e9\u8fd8\u5728\u7ef4\u62a4\u7684\u3001star \u6570\u591a\u7684\uff08star \u591a\uff0c\u8bf4\u660e\u8fd9\u4e2a\u9879\u76ee\u7684\u5173\u6ce8\u5ea6\u9ad8\uff0c\u66f4\u6d3b\u8dc3\uff09\u3002\u6240\u4ee5\uff0c\u5728\u505a\u5f00\u6e90\u65f6\uff0c\u4f60\u4e0d\u4ec5\u8981\u77e5\u9053\u81ea\u5df1\u4ea7\u54c1\u7684\u6838\u5fc3\u6280\u672f\u548c\u7279\u6027\uff0c\u8fd8\u8981\u4e86\u89e3\u5e02\u9762\u540c\u7c7b\u4ea7\u54c1\uff0c\u53bb\u5176\u7cdf\u7c95\uff0c\u53d6\u5176\u7cbe\u534e\uff0c\u4e0d\u65ad\u66f4\u65b0\u548c\u4fee\u590d bug\uff0c\u9010\u6e10\u5c31\u4f1a\u83b7\u5f97\u7b2c\u4e00\u6279\u7528\u6237\u3002\n\n## \u505a\u4e86\u4e1c\u897f\u8981\u7528\n\n\u867d\u7136\u6211\u8fd9\u4e24\u5e74\u7684\u5de5\u4f5c\u57fa\u672c\u5168\u662f\u5728\u7ef4\u62a4 iView \u5f00\u6e90\u9879\u76ee\uff0c\u4f46\u5076\u5c14\u4e5f\u4f1a\u7a7f\u63d2\u505a\u51e0\u4e2a\u9879\u76ee\uff0c\u56e0\u4e3a\u4f7f\u7528\u4e86\uff0c\u624d\u80fd\u66f4\u597d\u5730\u4e86\u89e3\u81ea\u5df1\u7684\u5f00\u6e90\u9879\u76ee\u3002\n\n\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0c\u6211\u6bcf\u5929\u90fd\u5728\u7ef4\u62a4 iView\uff0c\u8fd8\u6709\u6211\u4e0d\u4e86\u89e3\u7684\u5417\uff1f\u8fd8\u771f\u662f\uff0c\u7ef4\u62a4\u548c\u4f7f\u7528\u5b8c\u5168\u4e0d\u4e00\u6837\uff0c\u5728\u5f00\u53d1\u7ec4\u4ef6\u5e93\u65f6\uff0c\u5f80\u5f80\u53ea\u805a\u7126\u5728\u67d0\u4e2a\u7ec4\u4ef6\u4e0a\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86 API\uff0c\u7136\u540e\u901a\u8fc7\u6587\u6863\u544a\u8bc9\u4f7f\u7528\u8005\u600e\u4e48\u7528\uff0c\u6709\u4e9b\u529f\u80fd\u662f\u5b9e\u73b0\u4e86\uff0c\u7136\u800c\u7ef4\u62a4\u8005\u53ea\u77e5\u9053\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u529f\u80fd\uff0c\u5374\u4e0d\u77e5\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u597d\u4e0d\u597d\u7528\uff0c\u80fd\u7528\u548c\u597d\u7528\u662f\u4e24\u4e2a\u6982\u5ff5\u3002\n\n\u5f88\u591a feature\uff0c\u662f\u81ea\u5df1\u7528\u4e86\u624d\u63d0\u70bc\u51fa\u6765\u7684\u3002\u6bd4\u5982 iView \u7684 [\u5355\u5143\u683c\u7ec4\u4ef6 Cell](https://www.iviewui.com/components/cell) \u548c [\u76f8\u5bf9\u65f6\u95f4\u7ec4\u4ef6 Time](https://www.iviewui.com/components/time)\uff0c\u90fd\u662f\u6211\u5728\u505a\u9879\u76ee\u65f6\u53d1\u73b0\u5e76\u589e\u52a0\u7684\uff0c\u6ca1\u6709\u9879\u76ee\u7684\u652f\u6301\uff0c\u53ef\u80fd\u89c9\u5f97\u8fd9\u4e2a\u7ec4\u4ef6\u6ca1\u4ec0\u4e48\u610f\u4e49\uff0c\u5b8c\u5168\u5e94\u8be5\u7531\u4f7f\u7528\u8005\u5728\u4e1a\u52a1\u91cc\u81ea\u5df1\u5199\uff0c\u4f5c\u4e3a\u57fa\u7840\u7ec4\u4ef6\u540e\uff0c\u4f7f\u7528\u4f53\u9a8c\u786e\u5b9e\u597d\u5f88\u591a\u3002\n\n\u5982\u679c\u4f60\u8db3\u591f\u91cd\u89c6\u4f60\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u5e94\u8be5\u4eb2\u81ea\u4f7f\u7528\u5e76\u4e14\u5b89\u5229\u522b\u4eba\u4f7f\u7528\u6765\u6536\u96c6\u53cd\u9988\uff0c\u5bf9\u4e8e\u7ec4\u4ef6\u5e93\u6765\u8bf4\uff0c\u7ec6\u8282\u662f\u5f88\u91cd\u8981\u7684\uff0c\u800c\u5f88\u591a\u7ec6\u8282\u4e0e\u6211\u4eec\u7684\u7528\u6237\u4e60\u60ef\u6709\u5173\uff0c\u6bd4\u5982 iView \u5728 3.0 \u7248\u672c\u5f00\u59cb\uff0c\u5bf9\u6309\u94ae Button \u7ec4\u4ef6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b0\u7684 props\uff1a `to`\uff0c\u7528\u4e8e\u6307\u5b9a\u8df3\u8f6c\u8def\u5f84\uff0c\u4e4b\u524d\u7248\u672c\u5982\u679c\u70b9\u51fb\u6309\u94ae\u8df3\u8f6c\uff0c\u5fc5\u987b\u76d1\u542c\u5b83\u7684 `@click` \u4e8b\u4ef6\uff0c\u7136\u540e\u901a\u8fc7 vue-router \u7684\u7f16\u7a0b\u5f0f\u5bfc\u822a\uff08\u4e5f\u5c31\u662f\u901a\u8fc7 JS\uff09\u8df3\u8f6c\uff0c\u5982\u679c\u4e0d\u4eb2\u81ea\u4f7f\u7528\uff0c\u7edd\u5bf9\u4e0d\u77e5\u9053\u8fd9\u79cd\u539f\u5148\u7684\u8df3\u8f6c\u6a21\u5f0f\u5199\u8d77\u6765\u6709\u591a\u9ebb\u70e6\u3002\u5982\u679c\u4f60\u8db3\u591f\u6ce8\u91cd\u7ec6\u8282\uff0c\u8fd9\u4e2a Button \u7ec4\u4ef6\u5728\u8df3\u8f6c\u65f6\uff0c\u8fd8\u5e94\u8be5\u652f\u6301\u952e\u76d8\u7684 Command \u952e\uff08Windows \u4e3a Ctrl\uff0c\u8981\u505a\u517c\u5bb9\uff09\u5728\u65b0\u7a97\u53e3\u6253\u5f00\u94fe\u63a5\u3002\u8fd9\u4e9b\u7ec6\u8282\u90fd\u4e0e\u4f7f\u7528\u4e60\u60ef\u606f\u606f\u76f8\u5173\uff0c\u6240\u4ee5\uff0c\u4e00\u5b9a\u8981\u591a\u7528\u7528\u81ea\u5df1\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u5728\u4e00\u4e2a\u4e2a\u5c0f\u7ec6\u8282\u90fd\u5904\u7406\u597d\u540e\uff0c\u4f60\u4f1a\u7684\u5f00\u6e90\u9879\u76ee\u81ea\u7136\u4f1a\u84b8\u84b8\u65e5\u4e0a\u3002\n\n## \u7b2c\u4e00\u6279\u7528\u6237\n\n\u5f00\u6e90\u9879\u76ee\u505a\u597d\u540e\uff0c\u8981\u83b7\u5f97\u7b2c\u4e00\u6279\u4f7f\u7528\u8005\u3002\u73b0\u5728\u7684\u73af\u5883\uff0c\u5927\u591a\u662f\u516c\u53f8\u6216\u56e2\u961f\u4e3b\u5bfc\u505a\u5f00\u6e90\uff0c\u4e2a\u4eba\u7684\u5f88\u5c11\uff0c\u6240\u4ee5\u4f60\u7684\u516c\u53f8\u6216\u56e2\u961f\u81ea\u7136\u5c31\u662f\u7b2c\u4e00\u6279\u7528\u6237\uff0c\u505a\u5f00\u6e90\u7684\u4e3b\u8981\u76ee\u7684\uff0c\u4e5f\u662f\u670d\u52a1\u4ed6\u4eec\u3002\n\n\u7b2c\u4e00\u6279\u7528\u6237\u4e5f\u53ef\u4ee5\u7b97\u662f\u5f00\u6e90\u9879\u76ee\u7684\u5c0f\u767d\u9f20\uff0c\u4e00\u5f00\u59cb\u8bf4\u670d\u5168\u516c\u53f8\u4f7f\u7528\uff0c\u8fd8\u662f\u6bd4\u8f83\u56f0\u96be\u7684\uff0c\u53ef\u4ee5\u5148\u5c0f\u8303\u56f4\u63a8\u5e7f\u4f7f\u7528\u3002\u516c\u53f8\u90fd\u5e0c\u671b\u81ea\u5df1\u7684\u4ea7\u54c1\u7a33\u5b9a\uff0c\u800c\u65b0\u7684\u5f00\u6e90\u9879\u76ee\u524d\u671f\u5fc5\u5b9a\u4f1a\u6709\u4e0d\u5c11 bug\uff0c\u5728\u7ecf\u5386\u51e0\u4e2a\u5c0f\u9879\u76ee\u8bd5\u6c34\u540e\uff0c\u518d\u5c1d\u8bd5\u5411\u66f4\u591a\u7684\u56e2\u961f\u63a8\u5e7f\u3002\u56e0\u4e3a\u6709\u4e86\u6210\u529f\u6848\u4f8b\uff0c\u53c8\u662f\u201c\u81ea\u5bb6\u201d\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u7ed9\u81ea\u5df1\u4eba\u63a8\u5e7f\u8fd8\u662f\u6bd4\u8f83\u5bb9\u6613\u7684\u3002\n\n\u5728\u7b2c\u4e00\u6279\u7528\u6237\u7684\u63a8\u5e7f\u4e2d\uff0c\u4f60\u7684 leader \u53ef\u80fd\u4f1a\u8d77\u5230\u51b3\u5b9a\u6027\u4f5c\u7528\u3002\u4f60\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u516b\u6210\u5e02\u573a\u4e0a\u5df2\u7ecf\u6709\u540c\u7c7b\u7684\u4e86\uff0c\u4e0d\u5f97\u4e0d\u627f\u8ba4\uff0c\u5373\u4f7f\u8ba9\u201c\u81ea\u5df1\u4eba\u201d\u505a\u6280\u672f\u9009\u578b\uff0c\u4e5f\u66f4\u671f\u671b\u9009\u5e02\u9762\u4e0a\u6210\u719f\u7684\uff0c\u8fd9\u79cd\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u4f60\u7684 leader \u51fa\u6765\u201c\u62cd\u677f\u201d\u4e86\uff0c\u5426\u5219\uff0c\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u4e5f\u8bb8\u6c38\u8fdc\u4e0d\u4f1a\u6709\u7b2c\u4e00\u6279\u7528\u6237\u6765\u8bd5\u9519\u3002\u8bb0\u5f97\u5f53\u65f6\u6211\u5728\u56e2\u961f\u63a8\u5e7f Vue.js \u65f6\uff0c\u8d77\u521d\u4e5f\u662f\u5f88\u591a\u8d28\u7591\uff0c\u6709\u4e00\u90e8\u5206\u4eba\u575a\u6301\u4f7f\u7528 jQuery + \u524d\u7aef\u6a21\u677f\uff0c\u5f97\u5230 leader \u7684\u8ba4\u53ef\u540e\uff0c\u8bd5\u6c34\u4e86\u51e0\u4e2a\u9879\u76ee\uff0c\u5927\u5bb6\u90fd\u80fd\u611f\u53d7\u5230 Vue.js \u548c webpack \u5e26\u6765\u7684\u9ad8\u6548\u5f00\u53d1\u4f53\u9a8c\uff0c\u4ece\u6b64\u5c31\u6ca1\u4eba\u518d\u7528 jQuery \u4e86\u3002\u4e0d\u8fc7\u5462\uff0c\u4f60\u6700\u597d\u786e\u4fdd\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u8d28\u91cf\u8fd8\u4e0d\u9519\uff0c\u5426\u5219\u8fd9\u9505\u5c31\u5f97 leader \u66ff\u4f60\u80cc\u4e86\u3002\n\n\u4e0e\u5e02\u9762\u4e0a\u540c\u7c7b\u6210\u719f\u7684\u5f00\u6e90\u9879\u76ee\u76f8\u6bd4\uff0c\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u6700\u5927\u7684\u4f18\u52bf\u5c31\u662f\u4f60\u80fd\u4e3a\u7b2c\u4e00\u6279\u7528\u6237\u63d0\u4f9b\u4f18\u8d28\u7684\u201c\u552e\u540e\u201d\u670d\u52a1\u3002\u5982\u679c\u662f\u540c\u4e8b\u7684\u95ee\u9898\uff0c\u4f60\u53ef\u4ee5\u5f88\u5feb\u76f4\u63a5\u89e3\u7b54\uff1b\u5982\u679c\u662f\u901a\u8fc7 GitHub \u63d0\u4ea4\u7684 issues\uff08\u524d\u671f\u4e0d\u4f1a\u5f88\u591a\u4e86\uff09\uff0c\u5c3d\u91cf\u5728\u534a\u5c0f\u65f6\u5185\u56de\u590d\uff0c\u8fd9\u6837\u4f7f\u7528\u8005\u4f1a\u89c9\u5f97\u4f60\u786e\u5b9e\u5728\u7528\u5fc3\u7ef4\u62a4\u8fd9\u4e2a\u5f00\u6e90\u9879\u76ee\u3002\u901a\u8fc7\u524d\u671f\u7684\u53e3\u7891\u79ef\u7d2f\uff0c\u4f60\u7684\u7b2c\u4e00\u6279\u7528\u6237\u4e5f\u6210\u4e3a\u4e86\u6700\u5fe0\u5b9e\u7684\u7528\u6237\uff0c\u8fd9\u65f6\u53ef\u4ee5\u7ec4\u5efa\u5fae\u4fe1\u6216 QQ \u7fa4\uff0c\u66f4\u76f4\u63a5\u5730\u63d0\u4f9b\u201c\u552e\u540e\u201d\uff0c\u800c\u8fd9\u7b2c\u4e00\u6279\u5fe0\u5b9e\u7528\u6237\uff0c\u4f1a\u6210\u4e3a\u540e\u671f\u63a8\u5e7f\u7684\u91cd\u8981\u4eba\u8109\u3002\n\n## \u751f\u6001\n\n\u751f\u6001\uff08ecosystem\uff09\u4e0d\u662f\u4e0e\u751f\u4ff1\u6765\u7684\uff0c\u5f53\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u6709\u4e86\u4e00\u5b9a\u7684\u89c4\u6a21\u540e\uff0c\u53ef\u4ee5\u8003\u8651\u53d1\u5c55\u751f\u6001\u4f53\u7cfb\u3002\u6bd4\u5982 iView\uff0c\u8d77\u521d\u53ea\u662f\u4e00\u4e2a\u7ec4\u4ef6\u5e93\uff0c\u540e\u7eed\u9010\u6e10\u63d0\u4f9b\u4e86 iview-project \u5de5\u7a0b\u3001\u5177\u6709 GUI \u7684 iView CLI\uff08\u8fd9\u4e2a\u6982\u5ff5\u53ef\u6bd4 Vue CLI 3 \u65e9\u4e86\u4e00\u5e74\uff09\u3001\u540e\u53f0\u6a21\u677f iview-admin\u3001\u652f\u6301 Vue CLI 3 \u7684 vue-cli-plugin-iview\uff0c\u4ee5\u53ca\u4e1a\u52a1\u7ec4\u4ef6 iview-area \u548c markdown \u7f16\u8f91\u5668 iview-editor\uff0c\u518d\u5230\u540e\u6765\u652f\u6301 SSR\u3001TS\u3002\n\n\u5b8c\u5584\u7684\u751f\u6001\u4f53\u7cfb\u5bf9\u4e8e\u65b0\u7528\u6237\u6765\u8bf4\uff0c\u53ef\u4ee5\u6700\u5feb\u901f\u642d\u5efa\u4ea7\u54c1\uff0c\u51cf\u5c11\u5b66\u4e60\u548c\u5f00\u53d1\u6210\u672c\uff1b\u5bf9\u4e8e\u89c2\u671b\u8005\uff08\u6b63\u5728\u51b3\u5b9a\u662f\u5426\u4f7f\u7528\u7684\u4eba\uff09\u6765\u8bf4\uff0c\u66f4\u613f\u610f\u9009\u62e9\u751f\u6001\u5b8c\u5584\u7684\u5f00\u6e90\u9879\u76ee\u3002\u6240\u4ee5\uff0c\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u751f\u6001\u8d8a\u5b8c\u5584\uff0c\u4f7f\u7528\u8005\u4e5f\u4f1a\u8d8a\u591a\u3002\n\n\u751f\u6001\u7684\u53e6\u4e00\u4e2a\u597d\u5904\uff0c\u5c31\u662f\u8ba9\u7528\u6237\u4ea7\u751f\u4f9d\u8d56\u3002\u6700\u5178\u578b\u7684\u4f8b\u5b50\u5c31\u662f Vue \u5168\u5bb6\u6876\uff0c\u4e00\u822c\u521a\u63a5\u89e6\u7684\u4eba\uff0c\u53ea\u4f1a\u7528\u4e2a Vue.js\uff0c\u518d\u540e\u6765 vue-router\u3001vuex \u90fd\u662f\u5fc5\u987b\u7684\u4e86\uff0c\u518d\u540e\u6765\u642d\u914d\u4e00\u4e2a\u4e09\u65b9\u7684\u7ec4\u4ef6\u5e93\uff0c\u6bd4\u5982 iView\uff0c\u5404\u79cd\u4e1a\u52a1\u90fd\u80fd\u8f7b\u677e\u5e94\u5bf9\u3002\u4e00\u65e6\u7528\u6237\u5bf9\u4f60\u7684\u751f\u6001\u8db3\u591f\u4f9d\u8d56\uff0c\u5c31\u5f88\u96be\u66f4\u6362\u6280\u672f\u6808\u4e86\uff0c\u56e0\u4e3a\u751f\u6001\u7684\u6df1\u5165\uff0c\u66f4\u6362\u6210\u672c\u5f88\u5927\uff0c\u8fd9\u4e5f\u662f\u5f88\u591a\u4f01\u4e1a\u7684\u8001\u9879\u76ee\u6240\u8c13\u7684\u201c\u5386\u53f2\u539f\u56e0\u201d\u3002\n\n\u751f\u6001\u7684\u5efa\u8bbe\uff0c\u4e0d\u4e00\u5b9a\u90fd\u662f\u5b98\u65b9\u7684\u884c\u4e3a\uff0c\u4f46\u662f\u6700\u6838\u5fc3\u7684\u8fd8\u662f\u8981\u81ea\u5df1\u7ef4\u62a4\uff0c\u7528\u6237\u65e2\u7136\u9009\u62e9\u4f60\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u4fe1\u4efb\u4f60\u7684\u6280\u672f\u5b9e\u529b\uff0c\u653e\u5fc3\u7528\u4f60\u7684\u751f\u6001\u3002\u9879\u76ee\u5230\u4e86\u4e00\u5b9a\u89c4\u6a21\uff0c\u81ea\u7136\u6709\u4e0d\u5c11\u7b2c\u4e09\u65b9\u7684\u5f00\u53d1\u8005\u4e00\u8d77\u5efa\u8bbe\u751f\u6001\uff0c\u8fd9\u4e9b contributors \u90fd\u662f\u6700\u6709\u4ef7\u503c\u7684\u5f00\u53d1\u8005\uff0c\u5c3d\u91cf\u8054\u7cfb\u4ed6\u4eec\uff0c\u4e00\u8d77\u6765\u8d21\u732e\u66f4\u591a\u7684\u4ee3\u7801\u3002\n\n\u5bf9\u4e8e Vue.js \u7ec4\u4ef6\u5e93\u6765\u8bf4\uff0c\u751f\u6001\u4e00\u822c\u5206\u4e3a\u811a\u624b\u67b6\u3001\u540e\u53f0\u6a21\u677f\u548c\u4e1a\u52a1\u7ec4\u4ef6\u3002\u6700\u65b0\u7684 Vue CLI 3 \u63d0\u4f9b\u4e86\u63d2\u4ef6\u673a\u5236\uff0c\u73b0\u5728\u7684\u4e3b\u6d41\u505a\u6cd5\u90fd\u662f\u63d0\u4f9b\u4e00\u4e2a\u7c7b\u4f3c [vue-cli-plugin-iview](https://github.com/iview/vue-cli-plugin-iview) \u7684\u63d2\u4ef6\uff0c\u5f88\u5c11\u6709\u5355\u72ec\u63d0\u4f9b\u81ea\u5df1\u7684\u5de5\u7a0b\u4e86\uff0c\u5728\u6587\u6863\u91cc\uff0c\u8981\u63a8\u8350\u4f7f\u7528\u8005\u7528 Vue CLI 3 \u6765\u7ba1\u7406\u9879\u76ee\uff0c\u4eab\u53d7 Vue \u7684\u751f\u6001\u3002\u540e\u53f0\u6a21\u677f\u662f\u5f00\u7bb1\u5373\u7528\u7684\uff0c\u9ed8\u8ba4\u914d\u7f6e\u597d\u4e86\u8def\u7531\u3001\u6743\u9650\u7ba1\u7406\u3001\u591a\u8bed\u8a00\u3001\u767b\u5f55\u7b49\u5e38\u89c4\u7684\u540e\u53f0\u7cfb\u7edf\u529f\u80fd\uff0c\u4f7f\u7528\u8005 down \u4e0b\u6765\u540e\uff0c\u7a0d\u4f5c\u4fee\u6539\u5c31\u80fd\u5f88\u5feb\u5f00\u53d1\u81ea\u5df1\u7684\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\uff0c\u4e3b\u6d41\u7684 UI \u7ec4\u4ef6\u5e93\uff0c\u90fd\u4f1a\u63d0\u4f9b\u81ea\u5bb6\u7684\u540e\u53f0\u6a21\u677f\uff0c\u5f53\u7136\u4e5f\u6709\u7b2c\u4e09\u65b9\u4e13\u6ce8\u5728\u505a\u540e\u53f0\u6a21\u677f\u7684\u3002\u6700\u540e\u4e00\u7c7b\u4e1a\u52a1\u7ec4\u4ef6\uff0c\u6bd4\u5982\u57ce\u5e02\u7ea7\u8054\u9009\u62e9\u5668 [iview-area](https://github.com/iview/iview-area)\uff0c\u5b83\u57fa\u4e8e iView \u7684\u57fa\u7840\u7ec4\u4ef6\u5f00\u53d1\uff0c\u4f46\u53c8\u4e0d\u662f\u57fa\u7840\u7ec4\u4ef6\uff0c\u6240\u4ee5\u4e0d\u80fd\u5f52\u5230 iView \u91cc\uff0c\u53ea\u80fd\u4f5c\u4e3a\u72ec\u7acb\u7ec4\u4ef6\u5355\u72ec\u7ef4\u62a4\uff0c\u4e1a\u52a1\u7ec4\u4ef6\u7406\u8bba\u4e0a\u4f7f\u7528\u8005\u53ef\u4ee5\u81ea\u5df1\u5c01\u88c5\uff0c\u4f46\u662f\u91cd\u590d\u6027\u7684\u5de5\u4f5c\uff0c\u8fd8\u662f\u4ea4\u7ed9\u793e\u533a\u505a\u5427\uff0c\u8fd9\u5c31\u662f\u5f00\u6e90\u3002\n\n\u4e0b\u4e00\u7bc7\uff0c\u5c06\u4ecb\u7ecd\uff1a\n\n*   **\u6301\u7eed\u8fd0\u8425**\n*   **\u56fd\u9645\u5316**\n*   **\u8ba9\u66f4\u591a\u7684\u4eba\u53c2\u4e0e**\n*   **\u8ba9 Robot \u6765\u505a\u201c\u574f\u4eba\u201d**\n*   **\u8d5e\u52a9\u4e0e\u5546\u4e1a\u5316**\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [2016\u6211\u7684\u5fc3\u8def\u5386\u7a0b\uff1a\u4ece Vue \u5230 Webpack \u5230 iView](https://juejin.im/post/5880108f8d6d810058ae0def)", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u62d3\u5c55\u5982\u4f55\u505a\u597d\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u4e0a\u7bc7.md", "create_date": "2020-02-18T21:37:09.040", "order": 18}}, {"model": "subject.chapter", "pk": 114, "fields": {"title": "\u62d3\u5c55\uff1a\u5982\u4f55\u505a\u597d\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff08\u4e0b\u7bc7\uff09", "topic": 5, "md5": "b715898c30734d30dc4b43b787ecc85f", "md_body": "# \u62d3\u5c55\uff1a\u5982\u4f55\u505a\u597d\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff08\u4e0b\u7bc7\uff09\n\n## \u6301\u7eed\u8fd0\u8425\n\n\u9879\u76ee\u6709\u4e86\u4e00\u5b9a\u7684\u89c4\u6a21\u548c\u8fdb\u5c55\u540e\uff0c\u9700\u8981\u6301\u7eed\u8fd0\u8425\uff0c\u8ba9\u66f4\u591a\u7684\u4eba\u77e5\u9053\u548c\u4f7f\u7528\u3002\u8fd0\u8425\u5e76\u4e0d\u662f\u4e2a\u6280\u672f\u6d3b\uff0c\u5bf9\u4e8e\u7a0b\u5e8f\u5458\u6765\u8bf4\uff0c\u8fd8\u662f\u6216\u7f3a\u7684\u6280\u80fd\u3002\u6700\u7b80\u5355\u7684\u8fd0\u8425\u624b\u6bb5\uff0c\u5c31\u662f\u5728\u4e00\u4e9b\u6280\u672f\u793e\u533a\u5206\u4eab\u201c\u8f6f\u6587\u201d\uff0ciView \u5728\u65e9\u671f\u5c31\u662f\u8fd9\u6837\u505a\u7684\uff0c\u8fd8\u603b\u7ed3\u51fa\u4e86\u4e00\u4e2a \u201c500 star \u5b9a\u5f8b\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e00\u6b21\u5206\u4eab\u6587\u7ae0\uff0c\u5dee\u4e0d\u591a\u80fd\u5728 GitHub \u5e26\u6765 500 \u4e2a star\u3002star \u5bf9\u4e8e\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u6765\u8bf4\uff0c\u8fd8\u662f\u86ee\u91cd\u8981\u7684\uff0c\u5b83\u76f4\u63a5\u51b3\u5b9a\u4e86\u7528\u6237\u662f\u5426\u4f1a\u9009\u62e9\u4f60\u7684\u9879\u76ee\uff0c\u4f46\u7528\u6237\u90fd\u662f\u7a0b\u5e8f\u5458\uff0c\u53c8\u4e0d\u50bb\uff0c\u5982\u679c\u9879\u76ee\u8d28\u91cf\u4f4e\uff0cstar \u5c31\u53d8\u7684\u4e00\u6587\u4e0d\u503c\u4e86\uff0c\u8fd8\u4f1a\u574f\u4e86\u53e3\u7891\u3002\u5207\u8bb0\uff0c\u4e0d\u8981\u5237 star\uff0c\u524d\u7aef\u5708\u582a\u6bd4\u5a31\u4e50\u5708\uff0c\u4f1a\u88ab\u9488\u5bf9\u7684\u5f88\u60e8\u3002\n\n\u5f53\u7136\uff0c\u4e0d\u662f\u4ec0\u4e48\u5185\u5bb9\u90fd\u80fd\u53d1\uff0c\u6bd4\u5982\u66f4\u65b0\u65e5\u5fd7\uff0c\u6700\u597d\u5c31\u4e0d\u8981\u53d1\u4e86\uff0c\u9664\u975e\u50cf 2.0\u30013.0 \u8fd9\u79cd\u5927\u7248\u672c\u3002\u5373\u4f7f\u662f\u53d1\u5927\u7248\u672c\u7684\u66f4\u65b0\u5185\u5bb9\uff0c\u4e5f\u4e0d\u662f\u8bf4\u628a\u66f4\u65b0\u65e5\u5fd7\u4e00\u8d34\u5c31\u5b8c\u4e8b\uff0c\u5982\u679c\u4f60\u8db3\u591f\u91cd\u89c6\u4f60\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u5c31\u5e94\u8be5\u91cd\u89c6\u6bcf\u4e00\u7bc7\u6587\u7ae0\uff0c\u628a\u66f4\u65b0\u7684\u6838\u5fc3\u601d\u8def\u8bf4\u6e05\u695a\u3002\u5178\u578b\u7684\u6848\u4f8b\u53ef\u4ee5\u53c2\u8003 iView\uff1a\n\n*   [iView \u53d1\u5e03 3.0 \u7248\u672c\uff0c\u4ee5\u53ca\u5f00\u53d1\u8005\u793e\u533a\u7b49 5 \u6b3e\u65b0\u4ea7\u54c1](https://juejin.im/post/5b5e6f19e51d4515b01bf36e)\n*   [iView \u8fd1\u671f\u7684\u66f4\u65b0\uff0c\u4ee5\u53ca\u90a3\u4e9b\u201c\u4e0d\u4e3a\u4eba\u77e5\u201d\u7684\u6545\u4e8b](https://juejin.im/post/5aa5d56e51882555635df2b2)\n*   [iView \u53d1\u5e03\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf iview-admin\uff0c\u6ca1\u9519\uff0c\u5b83\u5c31\u662f\u4f60\u60f3\u8981\u7684](https://juejin.im/post/59e6a995518825619a01c433)\n\n\u6807\u9898\u7684\u91cd\u8981\u6027\u5c31\u4e0d\u5fc5\u8bf4\u4e86\uff0c\u5728\u4fe1\u606f\u7206\u70b8\u7684\u65f6\u4ee3\uff0c\u4f60\u7684\u6807\u9898\u4e0d\u591f\u5438\u5f15\u4eba\uff0c\u6839\u672c\u6ca1\u4eba\u770b\u3002\n\n\u76ee\u524d\uff0c\u6709\u51e0\u4e2a\u793e\u533a\u662f\u503c\u5f97\u5173\u6ce8\u548c\u79ef\u7d2f\u7c89\u4e1d\u7684\uff1a\n\n*   \u6398\u91d1\uff1a\u6bd4\u8f83\u6d3b\u8dc3\u7684\u7a0b\u5e8f\u5458\u793e\u533a\uff0c\u524d\u7aef\u5c5e\u6027\u8f83\u6d53\uff0c\u793e\u533a\u8fd0\u8425\u505a\u7684\u5f88\u597d\uff0c\u5bf9\u5f00\u6e90\u9879\u76ee\u6709\u6276\u6301\uff0c\u76f8\u5173\u7684\u6587\u7ae0\u9996\u6b21\u4eae\u76f8\uff0c\u5b98\u65b9\u90fd\u4f1a\u7ed9\u4e88\u4e00\u5b9a\u7684\u8d44\u6e90\u652f\u6301\u3002\n*   \u77e5\u4e4e\uff1a\u6d41\u91cf\u6700\u5927\u7684\u793e\u533a\uff0c\u5927 V \u5c5e\u6027\uff0c\u5982\u679c\u4f60\u662f\u521d\u5165\u77e5\u4e4e\uff0c\u53ef\u4ee5\u628a\u6587\u7ae0\u6295\u7a3f\u5230\u70ed\u95e8\u7684\u4e13\u680f\uff0c\u6bd4\u5982\u524d\u7aef\u8bc4\u8bba\u5916\u520a\u3001\u524d\u7aef\u4e4b\u5dc5\u7b49\u3002\u56e0\u4e3a\u81ea\u5df1\u8d77\u521d\u662f\u6ca1\u6709\u7c89\u4e1d\u8ba2\u9605\u7684\uff0c\u53d1\u8868\u4e86\u4e5f\u4e0d\u4f1a\u6709\u4eba\u770b\u5230\uff0c\u6295\u7a3f\u5c31\u4e0d\u4e00\u6837\u4e86\u3002\u800c\u4e14\uff0c\u88ab\u67d0\u4e2a\u5927 V \u8d5e\u4e00\u4e0b\uff0c\u90a3\u6548\u679c\u5c31\u50cf\u4e2d\u5956\u3002\n*   v2ex\uff1a\u4e0d\u7528\u89e3\u91ca\uff0c\u5c31\u662f\u5f88\u706b\u7684\u793e\u533a\u3002\n\n\u5f00\u6e90\u9879\u76ee\uff0c\u4e00\u822c\u90fd\u4f1a\u5728 GitHub \u6258\u7ba1\uff0c\u4e0d\u8fc7\u4e5f\u53ef\u4ee5\u5728\u5f00\u6e90\u4e2d\u56fd\uff08Gitee\uff09\u540c\u6b65\u4e00\u4efd\uff0c\u6bcf\u4e2a\u7248\u672c\u7684\u66f4\u65b0\u65e5\u5fd7\uff0c\u53ef\u4ee5\u4ee5\u65b0\u95fb\u7684\u5f62\u5f0f\uff0c\u5411\u5f00\u6e90\u4e2d\u56fd\u6295\u7a3f\u3002\u5f00\u6e90\u4e2d\u56fd\u5728\u56fd\u5185\u8fd8\u662f\u6709\u4e00\u5b9a\u7684\u5f71\u54cd\u529b\u7684\u3002\n\n\u9664\u4e86\u53d1\u8868\u6587\u7ae0\uff0c\u4e00\u4e9b\u6280\u672f\u5206\u4eab\u5927\u4f1a\u4e5f\u53ef\u4ee5\u5173\u6ce8\uff0c\u53ef\u4ee5\u4ee5\u516c\u53f8\u7684\u540d\u4e49\u7533\u8bf7\u6210\u4e3a\u5609\u5bbe\u505a\u5206\u4eab\u3002\u5982\u679c\u6709\u673a\u4f1a\uff0c\u8fd8\u53ef\u4ee5\u5230\u5176\u5b83\u516c\u53f8\u505a\u6280\u672f\u5206\u4eab\uff0c\u5c24\u5176\u662f\u5927\u5382\u5546\uff0c\u8fd9\u4e9b\u90fd\u662f\u96be\u5f97\u63a8\u5e7f\u5f00\u6e90\u9879\u76ee\u7684\u597d\u673a\u4f1a\u3002\u4f60\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u5982\u679c\u6709\u51e0\u4e2a BAT \u8fd9\u7c7b\u7684\u5927\u5382\u4f7f\u7528\uff0c\u90a3\u4f1a\u6210\u4e3a\u7ef4\u62a4\u8005\u3001\u793e\u533a\u7528\u6237\u548c\u89c2\u671b\u8005\u7684\u4fe1\u5fc3\u6765\u6e90\u3002\n\n\u8fd8\u6709\u53d1\u5e03\u4f1a\u3002\u5728\u56fd\u5185\uff0c\u5f00\u6e90\u9879\u76ee\u641e\u53d1\u5e03\u4f1a\u7684\uff0c\u636e\u6211\u6240\u77e5\u53ea\u6709 iView\u3002\u6ca1\u9519\uff0c18 \u5e74 7 \u6708\uff0ciView \u641e\u4e86\u4e00\u573a\u65b0\u54c1\u53d1\u5e03\u4f1a\uff0c\u7ebf\u4e0b\u8fdb\u884c\uff0c\u7ebf\u4e0a\u540c\u6b65\u76f4\u64ad\uff0c\u5f53\u65f6\u6709\u8d85\u8fc7 2 \u4e07\u7684\u5728\u7ebf\u7528\u6237\u89c2\u770b\uff0c\u63a8\u5e7f\u6548\u679c\u8fd8\u662f\u4e0d\u9519\u7684\u3002\u4e00\u573a\u201c\u5408\u683c\u201d\u7684\u6d3b\u52a8\uff0c\u8981\u5206**\u6d3b\u52a8\u524d**\u3001**\u6d3b\u52a8\u4e2d**\u3001**\u6d3b\u52a8\u540e**\u3002\u6d3b\u52a8\u5f00\u59cb\u524d\u4e00\u4e2a\u6708\uff0c\u5c31\u8981\u6563\u5e03\u6d88\u606f\uff0c\u8ba9\u7528\u6237\u6709\u4e2a\u521d\u6b65\u5370\u8c61\uff0c\u4e4b\u95f4\u8fd8\u53ef\u4ee5\u7206\u6599\u4e00\u4e9b\u6d3b\u52a8\u70ed\u70b9\uff1b\u6d3b\u52a8\u8fdb\u884c\u4e2d\uff0c\u8981\u6709\u4e13\u4eba\u8d1f\u8d23\u73b0\u573a\uff0c\u8fd8\u8981\u4e0e\u89c2\u4f17\u4e92\u52a8\uff1b\u6d3b\u52a8\u7ed3\u675f\u540e\uff0c\u8981\u52a0\u4e2a\u73ed\uff0c\u628a\u6838\u5fc3\u5185\u5bb9\u6574\u7406\u4e3a\u6587\u5b57\uff0c\u5728\u7b2c\u4e00\u65f6\u95f4\u901a\u8fc7\u5b98\u65b9\u6e20\u9053\u53d1\u8868\u51fa\u6765\u3002\u8fd9\u79cd\u5927\u89c4\u6a21\u7684\u6d3b\u52a8\uff0c\u6ca1\u6709\u516c\u53f8\u652f\u6301\uff0c\u4e2a\u4eba\u5f88\u96be\u5b8c\u6210\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e0d\u662f\u4e00\u4e24\u4e2a\u4eba\u7684\u4e8b\uff0c\u9700\u8981\u5f88\u591a\u5de5\u4f5c\u4eba\u5458\u4e00\u8d77\u5b8c\u6210\uff0c\u5e55\u524d\u5e55\u540e\u3001\u76f4\u64ad\u7684\u7f51\u7edc\u3001\u73b0\u573a wifi\uff0c\u8fd8\u8981\u5e94\u5bf9\u5404\u79cd\u7a81\u7834\u72b6\u51b5\uff0c\u4e0d\u8fc7\uff0c\u6700\u91cd\u8981\u7684\u8fd8\u662f\u6d3b\u52a8\u5185\u5bb9\u7684\u7b56\u5212\u51c6\u5907\u4e86\uff0c\u5426\u5219\u4e00\u5207\u90fd\u662f\u7eb8\u4e0a\u8c08\u5175\u3002\n\n\u8bb2\u5230\u8fd9\uff0c\u4f60\u53ef\u80fd\u4f1a\u8bf4\uff0c\u8001\u8001\u5b9e\u5b9e\u505a\u6280\u672f\u4e0d\u597d\u5417\uff0c\u975e\u8981\u5f04\u8fd9\u4e9b\u82b1\u91cc\u80e1\u54e8\u7684\u4e1c\u897f\u3002\u7684\u786e\uff0c\u63a8\u5e7f\u8fd9\u4ef6\u4e8b\uff0c\u5e76\u4e0d\u662f\u505a\u5f00\u6e90\u5fc5\u987b\u7684\uff0c\u8001\u5b9e\u505a\u6280\u672f\u6ca1\u6709\u9519\uff0c\u63a8\u5e7f\u53ea\u662f\u8ba9\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u66f4\u5feb\u4f20\u8fbe\u7ed9\u76ee\u6807\u7528\u6237\u3002\u505a\u8fd9\u4e9b\u4e8b\u7684\u76ee\u7684\u5c31\u4e00\u4e2a\uff0c\u8ba9\u66f4\u591a\u7684\u4eba\u4f7f\u7528\u4f60\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u8ba9\u66f4\u591a\u7684\u5f00\u53d1\u8005\u53c2\u4e0e\u8d21\u732e\u4ee3\u7801\u3002\n\n\u6700\u540e\u4e00\u70b9\uff0c\u5982\u679c\u4f60\u7684\u516c\u53f8\u6216\u56e2\u961f\u6709\u7ecf\u8d39\uff0c\u9002\u5f53\u6295\u653e\u4e00\u70b9\u5e7f\u544a\u4e5f\u662f\u4e0d\u9519\u7684\u3002\n\n## \u56fd\u9645\u5316\n\n\u662f\u65f6\u5019\u4e0e\u4e16\u754c\u63a5\u8f68\u4e86\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u56fd\u9645\u5316\uff08Internationalization\uff0c\u7b80\u79f0 i18n\uff09\u5206 3 \u4e2a\u90e8\u5206\uff0c\u9996\u5148\u662f\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u652f\u6301\u591a\u56fd\u8bed\u8a00\uff0c\u5bf9\u4e8e UI \u7ec4\u4ef6\u5e93\u6765\u8bf4\uff0c\u8fd9\u4e2a\u8fd8\u662f\u5f88\u597d\u652f\u6301\u7684\uff0c\u53ea\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u591a\u8bed\u8a00\u7684\u914d\u7f6e\u6587\u4ef6\u5c31\u884c\uff0c\u6bcf\u79cd\u8bed\u8a00\u4e00\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\u7531\u793e\u533a\u8d21\u732e\u66f4\u591a\u7684\u8bed\u8a00\u3002\u4ee5 Vue.js \u4e3a\u4f8b\uff0c\u793e\u533a\u4e5f\u63d0\u4f9b\u4e86 vue-i18n \u63d2\u4ef6\uff0c\u90a3\u4f60\u7684\u7ec4\u4ef6\u5e93\u8fd8\u8981\u517c\u5bb9 vue-i18n\uff0c\u53ef\u80fd\u8fd8\u8981\u8003\u8651\u517c\u5bb9\u591a\u4e2a\u4e3b\u6d41\u7684\u7248\u672c\u3002\n\n\u53e6\u4e00\u90e8\u5206\u662f\u6587\u6863\u7684\u56fd\u9645\u5316\uff0c\u9664\u4e86\u4e2d\u6587\uff0c\u81f3\u5c11\u5e94\u8be5\u63d0\u4f9b\u4e00\u4e2a\u82f1\u6587\u7248\u672c\uff0c\u6bd5\u7adf\u82f1\u6587\u7b97\u662f\u901a\u7528\u7684\u8bed\u8a00\u3002\u5982\u679c\u6587\u6863\u5185\u5bb9\u4e0d\u591a\uff0c\u53ef\u4ee5\u8ba9\u793e\u533a\u6765\u63d0\u4f9b\u66f4\u591a\u7684\u7ffb\u8bd1\u7248\u672c\u3002\u7ef4\u62a4\u591a\u8bed\u8a00\u7684\u6587\u6863\u662f\u4e00\u4ef6\u5f88\u8f9b\u82e6\u7684\u4e8b\uff0c\u8fd9\u610f\u5473\u7740\u6bcf\u4e00\u4e2a\u7248\u672c\u66f4\u65b0\u90fd\u662f\u4e2d\u82f1\u53cc\u8bed\u7684\uff0c\u5e76\u4e0d\u662f\u8bf4\u6587\u6863\u7ffb\u8bd1\u4e00\u904d\u5c31\u4e0d\u7ba1\u4e86\u3002\u597d\u5728\u7ffb\u8bd1\u6587\u6863\u662f\u4e2a\u4e00\u6b21\u6027\u7684\u6280\u672f\u6d3b\uff0c\u524d\u671f\u591a\u627e\u4e00\u4e9b\u82f1\u6587\u597d\u7684\u70ed\u5fc3\u7528\u6237\u4e00\u8d77\u7ffb\u8bd1\uff0c\u540e\u9762\u53ea\u8981\u786e\u4fdd\u6bcf\u6b21\u66f4\u65b0\u90fd\u4fdd\u6301\u4e2d\u82f1\u53cc\u8bed\u5c31\u597d\u4e86\u3002\n\n\u505a\u56fd\u9645\u5316\uff0c\u610f\u5473\u7740\u8981\u670d\u52a1\u56fd\u9645\u53cb\u4eba\uff0c\u90a3\u5c31\u4e0d\u80fd\u5f3a\u6c42\u4ed6\u4eec\u7528\u5fae\u4fe1\u6216 QQ\u3002\u5728\u5f00\u6e90\u754c\uff0c\u6bd4\u8f83\u901a\u7528\u7684\u662f [Gitter](https://gitter.im)\uff0c\u53ea\u9700\u8981\u5173\u8054\u4e00\u6b21 GitHub \u7684 repo \u5c31\u884c\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5b98\u65b9\u53ef\u4ee5\u5728 Twitter \u5f00\u901a\u4e00\u4e2a\u8d26\u6237\uff0c\u6765\u66f4\u65b0\u4e00\u4e9b\u52a8\u6001\uff0c\u4e0e\u5176\u5b83 Twitter \u4e92\u52a8\u3002[Discord](https://discordapp.com/) \u4e5f\u662f\u6280\u672f\u5708\u6bd4\u8f83\u70ed\u95e8\u7684\u4e00\u4e2a App\uff0c\u4ee5 Vue.js \u6765\u8bf4\uff0c\u4f60\u53ef\u4ee5\u52a0\u5165\u4e00\u4e2a\u540d\u4e3a **Vue Land** \u7684\u670d\u52a1\u5668\uff0c\u5728\u91cc\u9762\u627e\u5230 **#ui-libraries** \u7684\u9891\u9053\uff0c\u5c31\u53ef\u4ee5\u548c\u5168\u4e16\u754c\u7684\u5f00\u53d1\u8005\u8ba8\u8bba\u7ec4\u4ef6\u5e93\u7684\u8bdd\u9898\u4e86\u3002\n\n\u652f\u6301\u56fd\u9645\u5316\uff0c\u77ed\u671f\u6765\u770b\uff0c\u662f\u4e00\u4ef6\u4ed8\u51fa\u56de\u62a5\u6bd4\u5f88\u4f4e\u7684\u4e8b\uff0c\u4f46\u4ece\u957f\u8fdc\u5229\u76ca\u51fa\u53d1\uff0c\u5bf9\u56fd\u9645\u5316\u7684\u652f\u6301\uff0c\u6709\u52a9\u4e8e\u66f4\u591a\u7684\u56fd\u5916\u5f00\u53d1\u8005\u6210\u4e3a\u6838\u5fc3 maintainers\uff0c\u8ba9\u5168\u4e16\u754c\u80fd\u591f\u53c2\u4e0e\u8fdb\u6765\uff0c\u624d\u662f\u5f00\u6e90\u7684\u610f\u4e49\u6240\u5728\u3002\n\n## \u8ba9\u66f4\u591a\u7684\u4eba\u53c2\u4e0e\n\n\u5f00\u6e90\u9879\u76ee\u4ece\u6765\u5c31\u4e0d\u662f\u4e00\u4e2a\u4eba\u7684\u4e8b\uff0c\u4e00\u4e2a\u5065\u58ee\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u9700\u8981\u4e0d\u65ad\u6709\u4eba\u8d21\u732e\u4ee3\u7801\u3002\u5728\u9879\u76ee\u6709\u4e86\u4e00\u5b9a\u77e5\u540d\u5ea6\u548c\u4f7f\u7528\u4eba\u7fa4\u540e\uff0c\u81ea\u7136\u4f1a\u6709\u4e0d\u5c11 PR \u8fdb\u6765\uff0c\u77e5\u540d\u7684\u5f00\u6e90\u9879\u76ee contributors \u90fd\u6709\u51e0\u767e\u4eba\uff0c\u54ea\u6015\u4fee\u6539\u4e00\u884c\u4ee3\u7801\uff0c\u53ea\u8981\u88ab merge\uff0c\u5c31\u7b97\u4e00\u4e2a contributors\u3002\u6700\u6838\u5fc3\u7684\u7ef4\u62a4\u8005\u4e00\u822c\u4e0d\u4f1a\u8d85\u8fc7 5 \u4eba\uff0c\u800c\u4e14\u9664\u4e86\u4f5c\u8005\u672c\u4eba\uff0c\u5f88\u591a\u90fd\u662f\u9636\u6bb5\u6027\u7684\uff0c\u6bd5\u7adf\u662f\u5f00\u6e90\uff0c\u5927\u591a\u6570\u4eba\u8fd8\u662f\u517c\u804c\u505a\u7684\uff0c\u80fd\u8d21\u732e\u4e00\u70b9\u662f\u4e00\u70b9\uff0c\u4e1a\u52a1\u5fd9\u4e86\u5c31\u6ca1\u987e\u4e0d\u4e0a\u4e86\u3002\n\n\u4e3a\u5f00\u6e90\u9879\u76ee\u8d21\u732e\u4ee3\u7801\uff0c\u4e3b\u8981\u4ee5 PR \u7684\u5f62\u5f0f\u8fdb\u884c\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u7684 owner\uff0c\u5373\u4f7f organization \u7684\u5176\u4ed6\u6210\u5458\u6709\u76f4\u63a5 commit \u7684\u6743\u9650\uff0c\u4e5f\u5e94\u8be5\u5efa\u8bae\u4ed6\u4eec\u63d0\u4ea4 PR\uff0c\u800c\u4e0d\u662f\u76f4\u63a5 commit\uff0cowner \u9700\u8981\u8ba4\u771f review \u6bcf\u4e00\u4e2a PR \u4ee5\u786e\u4fdd\u4ee3\u7801\u8d28\u91cf\u3002\u4fee\u590d\u4e00\u4e2a\u95ee\u9898\u6700\u6015\u7684\uff0c\u662f\u5f15\u8d77\u65b0\u7684\u95ee\u9898\uff0c\u6216\u5bfc\u81f4\u4ee5\u524d\u5df2\u4fee\u590d\u7684\u95ee\u9898\u53c8\u590d\u73b0\uff0c\u6709\u65f6\u5019\uff0ccontributor \u53ef\u80fd\u53ea\u4e3a\u4e86 fix \u67d0\u4e00\u4e2a issue\uff0c\u4f46\u5b83\u5bf9\u6574\u4e2a\u9879\u76ee\u662f\u4e0d\u4e86\u89e3\u7684\uff0c\u800c\u4e14\u5bf9\u4ee5\u524d\u201c\u53d1\u751f\u7684\u4e8b\u60c5\u201d\u90fd\u4e0d\u4e86\u89e3\uff0c\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u4ed6\u770b\u4e0d\u5230\u7684\u95ee\u9898\uff0c\u8fd9\u79cd\u60c5\u51b5\u4f5c\u4e3a owner \u5c31\u8981\u8ba4\u771f\u5ba1\u67e5\u4e86\u3002\n\n\u53c2\u4e0e\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u7684\u65b9\u5f0f\u6709\u5f88\u591a\uff0c\u9664\u4e86\u6700\u76f4\u63a5\u7684 PR\uff0c\u8fd8\u53ef\u4ee5 review issues\u3002\u9879\u76ee\u6d3b\u8dc3\u65f6\uff0c\u6bcf\u5929\u90fd\u4f1a\u6709\u4e0d\u5c11 issues \u8fdb\u6765\uff0cowner \u53ef\u80fd\u6ca1\u65f6\u95f4\u53ca\u65f6\u5904\u7406\uff0c\u4f46\u53ef\u4ee5**\u6253\u6807\u7b7e**\uff08labels\uff09\u3002\u4e00\u4e2a issue \u88ab\u6807\u8bb0\u4e86 label\uff0c\u8bf4\u660e\u5df2\u7ecf\u5ba1\u6838\u8fc7\u6b64 issue\uff0c\u5e38\u89c1\u7684 label \u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a\n\n*   **bug**\uff1a\u5df2\u786e\u5b9a\u4e3a bug\uff1b\n*   **feature request**\uff1a\u5df2\u786e\u5b9a\u4e3a\u8bf7\u6c42\u65b0\u529f\u80fd\uff1b\n*   **invalid**\uff1a\u65e0\u6548\u7684 issue\uff0c\u4e00\u822c\u53ef\u4ee5\u76f4\u63a5\u5173\u95ed\uff1b\n*   **contribution welcome**\uff1aowner \u53ef\u80fd\u6682\u65f6\u6ca1\u6709\u7cbe\u529b\u5904\u7406\uff0c\u671f\u671b\u793e\u533a\u6765\u8d21\u732e\u4ee3\u7801\uff1b\n*   **provide example**\uff1aissue \u9700\u8981\u63d0\u4f9b\u590d\u73b0\u793a\u4f8b\uff1b\n*   **discussion**\uff1a\u6682\u65f6\u65e0\u6cd5\u65ad\u5b9a\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u8ba8\u8bba\uff1b\n*   **may be supported in the future**\uff1a\u5148\u6807\u8bb0\u4e00\u4e0b\uff0c\u4e5f\u8bb8\u672a\u6765\u4f1a\u652f\u6301\u3002\n\n\u7ba1\u7406 issues \u7684\u53e6\u4e00\u4e2a\u65b9\u5f0f\u662f\u7528\u597d**\u91cc\u7a0b\u7891**\uff08milestones\uff09\u529f\u80fd\u3002milestones \u53ef\u4ee5\u6309\u7167\u7248\u672c\u53f7\u521b\u5efa\uff0c\u628a\u671f\u671b\u5728\u8fd9\u4e2a\u7248\u672c\u89e3\u51b3\u7684 issues \u6dfb\u52a0\u8fdb\u53bb\uff0c\u53d1\u7248\u524d\u5bf9\u5f53\u524d milestone \u7684\u6240\u6709 issues \u96c6\u4e2d\u67e5\u770b\uff0c\u662f\u5426\u90fd\u5904\u7406\u5b8c\u6210\u4e86\u3002\n\n\u6709\u4e00\u4e9b**\u6709\u4ef7\u503c**\u7684 issues \u53ef\u80fd\u4f1a\u8017\u8d39\u4e0d\u5c11\u7cbe\u529b\u5904\u7406\uff0c\u800c\u4e14\u793e\u533a\u5f88\u591a\u7528\u6237\u90fd\u5e0c\u671b\u80fd\u591f\u89e3\u51b3\uff0cowner \u5f53\u7136\u4e5f\u5e0c\u671b\u5904\u7406\uff0c\u53ea\u662f\u6ca1\u6709\u65f6\u95f4\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0d\u59a8**\u6709\u507f\u60ac\u8d4f**\uff0c\u63a8\u8350\u4e00\u4e2a\u65b0\u8d77\u7684\u56fd\u5916\u793e\u533a [IssueHunt](https://issuehunt.io/)\uff0c\u7528\u6237\u53ef\u4ee5\u4e3a\u67d0\u4e00\u4e2a repo \u7684 issue \u4f17\u7b79\uff0c\u8c01\u5904\u7406\u4e86\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u5168\u90e8\u8d4f\u91d1\u3002\n\n\u6bcf\u4e00\u4e2a\u7248\u672c\u53d1\u5e03\u540e\uff0c\u8bb0\u5f97\u521b\u5efa\u4e00\u6761 release\uff0c\u8fd9\u6837\u505a\u4e00\u662f\u6709\u4e00\u4e2a\u7248\u672c\u66f4\u65b0\u65e5\u5fd7\u8bb0\u5f55\u7684\u5730\u65b9\uff0c\u4e8c\u662f watch \u4f60\u9879\u76ee\u7684\u4eba\u90fd\u53ef\u4ee5\u53ca\u65f6\u6536\u5230\u90ae\u4ef6\u901a\u77e5\u63d0\u9192\u5347\u7ea7\uff0c\u4e09\u662f release \u4f1a\u6253\u4e00\u4e2a tag\uff0c\u5176\u5b83\u8d21\u732e\u8005\u53ef\u4ee5\u5207\u6362\u5230\u6b64 tag\u3002release \u6700\u597d\u4e0d\u8981\u5728\u53d1\u7248\u524d\u518d\u521b\u5efa\uff0c\u4e0d\u7136\u6574\u7406\u8d77\u6765\u5f88\u8d39\u52b2\uff0c\u5efa\u8bae\u6bcf\u4e2a release \u53d1\u5e03\u540e\uff0c\u5c31\u65b0\u5efa\u4e0b\u4e00\u4e2a\u7248\u672c\u7684 release \u4f5c\u4e3a\u8349\u7a3f\uff08draft\uff09\uff0c\u5904\u7406\u4e00\u4e2a issue\uff0c\u5c31\u8bb0\u5f55\u4e00\u6761\uff0c\u907f\u514d\u9057\u6f0f\u3002\n\n\u7248\u672c\u53f7\u4e5f\u662f\u6709\u8bb2\u7a76\u7684\uff0c\u6bd4\u5982 3.2.1\uff0c\u8fd9\u91cc\u7684\u6700\u540e\u4e00\u4f4d\uff0c\u4ee3\u8868\u53ea\u6709 bug fixed\uff0c\u4e2d\u95f4\u4e00\u4f4d\u4ee3\u8868\u6709 new features\uff0c\u7b2c\u4e00\u4f4d\u4ee3\u8868\u6709 break changes\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u9664\u4e86\u7b2c\u4e00\u4f4d\uff0c\u5269\u4e0b\u7684\u7248\u672c\u90fd\u662f\u517c\u5bb9\u5f0f\u7684\uff0c\u5c31\u662f\u8bf4\u7528\u6237\u5347\u7ea7\u540e\u4e0d\u4f1a\u5f71\u54cd\u5f53\u524d\u9879\u76ee\uff0c\u5982\u679c\u6709 API \u7684\u53d8\u66f4\uff0c\u5e94\u8be5\u53d1\u5e03\u7b2c\u4e00\u4f4d\u7248\u672c\u53f7\u3002\n\n\u4ee3\u7801\u8d21\u732e\u8d8a\u6d3b\u8dc3\uff0c\u8d21\u732e\u8005\u8d8a\u591a\uff0c\u5f00\u6e90\u9879\u76ee\u4e5f\u8d8a\u5065\u58ee\uff0c\u4f5c\u4e3a owner\uff0c\u5e94\u8be5\u53ca\u65f6\u8054\u7edc\u6709\u4ef7\u503c\u7684\u8d21\u732e\u8005\uff0c\u4e00\u4e2a\u4eba\u7684\u80fd\u529b\u6bd5\u7adf\u662f\u6709\u9650\u7684\u3002\u5f53\u4f60\u4e0e\u4e16\u754c\u5404\u5730\u8bb2\u7740\u4e0d\u540c\u8bed\u8a00\u7684\u7684\u4eba\uff0c\u4e00\u8d77\u5b8c\u6210\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u4f1a\u89c9\u5f97\u5f00\u6e90\u771f\u662f\u4e00\u4ef6\u4e86\u4e0d\u8d77\u7684\u4e8b\u60c5\u3002\n\n## \u8ba9 Robot \u6765\u505a\u201c\u574f\u4eba\u201d\n\n\u5f00\u6e90\u9879\u76ee\u6709\u4e00\u5b9a\u7684\u89c4\u6a21\u540e\uff0c\u793e\u533a\u5c31\u4f1a\u5f88\u6d3b\u8dc3\uff0c\u6bcf\u5929\u90fd\u4f1a\u6709\u5927\u91cf\u7684 issues\uff0c\u8fd9\u4e9b issues \u8d8a\u79ef\u8d8a\u591a\uff0c\u4e0d\u53ca\u65f6\u5904\u7406\u6389\uff0c\u5bf9 owner \u6765\u8bf4\u5c31\u662f\u7cbe\u795e\u538b\u529b\u3002\u5728\u9879\u76ee\u521d\u671f\uff0c\u7531\u4e8e\u4f7f\u7528\u8005\u4e0d\u591a\uff0c\u662f\u9f13\u52b1\u63d0 issues \u7684\uff0c\u5efa\u8bae\u3001\u65b0\u529f\u80fd\u8bf7\u6c42\u3001bug \u53cd\u9988\u3001\u95ee\u9898\u54a8\u8be2\u7b49\u5404\u79cd\u5185\u5bb9\u90fd\u53ef\u4ee5\u63d0\u4ea4\uff0c\u800c\u4e14\u4f5c\u8005\u6709\u8db3\u591f\u7684\u65f6\u95f4\u548c\u7cbe\u529b\u6765\u8ba4\u771f\u56de\u7b54\u3002\u5230\u4e86\u4e00\u5b9a\u89c4\u6a21\u540e\uff0c\u53ef\u80fd\u4ec0\u4e48 issues \u90fd\u4f1a\u51fa\u73b0\uff0c\u4e0d\u4e4f\u4e00\u4e9b\u5e26\u6709\u6076\u610f\u7684\u3001\u8a00\u8bed\u653b\u51fb\u7684\uff0c\u5982\u679c\u76f4\u63a5\u5173\u95ed issue\uff0c\u53ef\u80fd\u8fd8\u4f1a\u7ee7\u7eed\u201c\u7ea0\u7f20\u201d\uff0c\u8bf4 owner \u6001\u5ea6\u4e0d\u597d\u4e4b\u7c7b\u7684\uff0c\u8fd9\u4e9b\u90fd\u662f\u7b14\u8005\u4eb2\u8eab\u7ecf\u5386\u8fc7\u7684\u3002\n\n\u9664\u4e86\u6076\u610f\u7684 issues\uff0c\u8fd8\u6709\u5f88\u591a issues \u4e0d\u7b26\u5408\u683c\u5f0f\u8981\u6c42\uff0c\u8fde\u4ee3\u7801\u683c\u5f0f\u5316\u90fd\u6ca1\u6709\uff0c\u751a\u81f3\u8fde\u95ee\u9898\u90fd\u8bf4\u4e0d\u6e05\u695a\uff0c\u4e5f\u6ca1\u6709\u63cf\u8ff0\uff0c\u5c31\u4e00\u4e2a\u6807\u9898\uff0c\u8fd9\u4e9b\u65e0\u6548\u7684 issues \u4e00\u4e2a\u4e2a\u56de\u590d\u90fd\u4f1a\u5360\u636e\u5927\u91cf\u7684\u7cbe\u529b\uff0c\u76f4\u63a5 close \u8fd8\u4f1a\u88ab\u8bf4\u6ca1\u5904\u7406\u600e\u4e48\u5c31\u5173\u95ed\u4e86\uff0c\u5b9e\u5c5e\u65e0\u5948\u3002\n\n\u8fd9\u65f6\u4f60\u9700\u8981\u4e00\u4e2a GitHub \u673a\u5668\u4eba\u6765\u5145\u5f53\u201c\u574f\u4eba\u201d\u7684\u89d2\u8272\uff0c\u4e5f\u5c31\u662f\u6ce8\u518c\u53e6\u4e00\u4e2a GitHub \u8d26\u6237\uff0c\u7528\u5b83\u6765\u5904\u7406\u4e00\u4e9b\u4e0d\u7b26\u5408\u8981\u6c42\u7684 issues\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u806a\u660e\u7684\u505a\u6cd5\uff0c\u5173\u95ed issues \u8fd9\u4e9b\u6d3b\u90fd\u8ba9 robot \u6765\u64cd\u4f5c\u3002\u6bd4\u5982 iView \u7684\u201c\u574f\u4eba\u201d\u5c31\u662f [iview-bot](https://github.com/iview-bot)\uff0c\u4e0d\u8fc7\u5b83\u662f\u4e00\u4e2a\u667a\u80fd\u7684 robot\uff0c\u4e0d\u9700\u8981 owner \u63a7\u5236\uff0c\u4f1a\u81ea\u52a8\u5173\u95ed\u4e0d\u5408\u683c\u7684 issues \u5e76\u56de\u590d\u63d0\u95ee\u8005\u3002GitHub \u63d0\u4f9b\u4e86 API \u6765\u63a5\u6536\u6bcf\u4e00\u4e2a issues \u5e76\u901a\u8fc7 API \u6765\u64cd\u4f5c issues\uff0c\u5305\u62ec\u5173\u95ed\u3001\u6253\u6807\u7b7e\u3001\u56de\u590d\u7b49\uff0c\u53ea\u8981\u7ed9 robot \u8bbe\u7f6e\u8db3\u591f\u7684\u6743\u9650\u5c31\u884c\u3002\u6bd4\u5982 iView \u7684 issues \u673a\u5668\u4eba\u4ee3\u7801\u662f [https://github.com/iview/iview-bot](https://github.com/iview/iview-bot)\u3002\u7528\u6237\u5982\u679c\u76f4\u63a5\u901a\u8fc7 GitHub \u63d0\u4ea4 issues\uff0c\u4f1a\u88ab robot \u7acb\u5373\u5173\u95ed\uff0c\u5e76\u56de\u590d\uff1a\n\n> Hello, this issue has been closed because it does not conform to our issue requirements. Please use the [Issue Helper](https://www.iviewui.com/new-issue) to create an issue - thank you!\n\n\u5c31\u662f\u8bf4\uff0c\u7528\u6237\u5fc5\u987b\u901a\u8fc7 [Issue Helper](https://www.iviewui.com/new-issue) \u8fd9\u4e2a\u9875\u9762\u63d0\u4ea4 issues \u624d\u53ef\u4ee5\uff0c\u4e0d\u662f\u901a\u8fc7\u5b83\u63d0\u4ea4\u7684\uff0c\u4f1a\u88ab\u68c0\u6d4b\u51fa\u6765\u7acb\u5373\u5173\u95ed\u3002\u5728\u8fd9\u4e2a\u9875\u9762\u4e2d\uff0c\u7528\u6237\u9700\u8981\u63d0\u4f9b\u8be6\u7ec6\u7684\u63cf\u8ff0\u624d\u80fd\u901a\u8fc7\u8868\u5355\u9a8c\u8bc1\u3002issues \u53ea\u63a5\u53d7 bug \u62a5\u544a\u6216\u662f\u65b0\u529f\u80fd\u8bf7\u6c42 (feature requests)\uff0c\u5bf9\u4e8e\u4f7f\u7528\u54a8\u8be2\u7b49\u5176\u5b83\u95ee\u9898\uff0c\u90fd\u4e0d\u80fd\u63d0\u4ea4\uff0c\u800c\u662f\u9f13\u52b1\u5230 Stackoverflow \u4e4b\u7c7b\u7684\u793e\u533a\u8ba8\u8bba\u3002\u5982\u679c\u662f Bug\uff0c\u8fd8\u5fc5\u987b\u63d0\u4f9b\u80fd\u591f\u6700\u5c0f\u5316\u590d\u73b0\u95ee\u9898\u7684\u5728\u7ebf\u94fe\u63a5\uff0c\u4ee5\u53ca\u8be6\u7ec6\u7684\u590d\u73b0\u6b65\u9aa4\u3002\n\nrobot \u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\uff1a\u7ffb\u8bd1\u3002\u5b83\u4f1a\u628a\u4e2d\u6587\u7684 issues \u81ea\u52a8\u7ffb\u8bd1\u4e3a\u82f1\u6587\u5e76\u628a\u7ffb\u8bd1\u5185\u5bb9\u81ea\u52a8\u521b\u5efa\u4e00\u6761\u56de\u590d\uff0c\u540c\u65f6\u6807\u9898\u4e5f\u4f1a\u4fee\u6539\u4e3a\u82f1\u6587\u3002\u5f00\u6e90\u9879\u76ee\u5230\u8fd9\u4e2a\u89c4\u6a21\uff0c\u4f7f\u7528\u8005\u548c\u8d21\u732e\u8005\u4e0d\u4ec5\u4ec5\u662f\u4e2d\u56fd\u4eba\u4e86\uff0c\u4e16\u754c\u5404\u5730\u7684\u5f00\u53d1\u8005\u90fd\u6709\uff0c\u4f7f\u7528\u82f1\u6587\u4f1a\u8ba9\u6240\u6709\u4eba\u90fd\u770b\u61c2 issues\u3002\n\n\u867d\u7136 robot \u80fd\u81ea\u52a8\u8fc7\u6ee4 80% \u4e0d\u5408\u683c\u7684 issues\uff0c\u4f46\u4ecd\u6709\u6d51\u6c34\u6478\u9c7c\u7684\u7528\u6237\u8df3\u8fc7\u8fd9\u4e9b\u9a8c\u8bc1\uff0c\u8fd9\u65f6\u53ef\u4ee5\u7ed9 robot \u8bbe\u7f6e\u4e00\u4e9b\u5feb\u6377\u56de\u590d\uff0c\u4eba\u4e3a\u6765 comment & close\uff1a\n\n*   Hello, this issue has been closed because similar problems exist or have been explained in the documentation, please check carefully. _\u5df2\u6709\u76f8\u540c issues\uff0c\u6216\u6587\u6863\u6709\u8bf4\u660e_\n    \n*   Hello, this issue has been closed because it is not required to submit or describe is not clear. _\u63cf\u8ff0\u4e0d\u6e05\u695a_\n    \n*   Hello, this issue has been closed because it has nothing to do with the **bug report** or **feature request**. Maybe you can ask normal question through [SegmentFault](https://segmentfault.com/t/iview) or [stackoverflow](https://stackoverflow.com/). _\u4e0d\u662f bug \u53cd\u9988\u6216 \u65b0\u529f\u80fd\u8bf7\u6c42\uff0c\u8bf7\u5230\u793e\u533a\u8ba8\u8bba_\n    \n*   Hello, this issue has been closed because it is not a bug, but a usage problem, please consult other communities. _\u7528\u6cd5\u4e0d\u5bf9_\n    \n*   Please provide online code. You can quickly create an example using the following online link\uff1a[https://run.iviewui.com/](https://run.iviewui.com/). _\u6ca1\u6709\u63d0\u4f9b\u5728\u7ebf\u793a\u4f8b_\n    \n\n\u5176\u5b9e\u5462\uff0c\u8fd9\u4e2a\u201c\u574f\u4eba\u201d\u4e5f\u6ca1\u90a3\u4e48\u574f\uff0c\u8fd8\u662f\u633a\u53ef\u7231\u7684\u3002\n\n## \u8d5e\u52a9\u4e0e\u5546\u4e1a\u5316\n\n\u5f00\u6e90\u9879\u76ee\u7684\u53d1\u5c55\u79bb\u4e0d\u5f00\u8d44\u91d1\u7684\u652f\u6301\uff0c\u5411\u793e\u533a\u5bfb\u6c42\u8d5e\u52a9\u5e76\u4e0d\u662f\u4e00\u4ef6\u201c\u7f9e\u803b\u201d\u7684\u4e8b\u60c5\uff0c\u800c\u662f\u7406\u6240\u5f53\u7136\u7684\u3002\n\n\u6700\u7b80\u5355\u7684\u8d5e\u52a9\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7\u4e8c\u7ef4\u7801\u6253\u8d4f\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5728\u56fd\u5185\u51e0\u4e4e\u6ca1\u6709\u4ec0\u4e48\u7528\uff0c\u4e2d\u56fd\u7684\u5f00\u53d1\u8005\u5927\u591a\u6bd4\u8f83\u201c\u56ca\u4e2d\u7f9e\u6da9\u201d\uff0c\u800c\u4e14\u7531\u4e8e\u6253\u8d4f\u7684\u533f\u540d\u6027\uff08\u5fae\u4fe1\uff09\uff0c\u65f6\u4e0d\u65f6\u6536\u5230\u4e2a 1 \u5206\u94b1\uff0c\u4e5f\u5c31\u5475\u5475\u4e86\u3002\n\n\u8fd9\u91cc\u63a8\u8350\u51e0\u79cd\u6bd4\u8f83\u597d\u7684\u201c\u52df\u8d44\u201d\u65b9\u5f0f\uff1a[patreon](https://www.patreon.com/) \u548c [opencollective](https://opencollective.com/) \u662f\u5f00\u6e90\u9879\u76ee\u6700\u5e38\u7528\u7684\uff0c\u53ef\u4ee5\u4e00\u6b21\u6027\u652f\u6301\uff0c\u6216\u5468\u671f\u6027\uff0c\u4ee5\u7f8e\u5143\u7ed3\u7b97\uff0c\u53ef\u8f6c\u81f3 PayPal\u3002\u4e0d\u8fc7\u8fd9\u4e24\u79cd\u90fd\u662f\u7f8e\u5143\uff0c\u800c\u4e14\u8f6c\u5230 owner \u8fd9\u91cc\uff0c\u6263\u9664\u624b\u7eed\u8d39\u53ef\u80fd\u5c11\u5f88\u591a\uff0c\u4e0d\u8fc7\u5bf9\u8d5e\u52a9\u8005\uff08\u5f80\u5f80\u662f\u4f01\u4e1a\uff09\u6765\u8bf4\uff0c\u597d\u5904\u5c31\u662f\u6709\u53d1\u7968\u3002\u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u901a\u8fc7\u5f00\u6e90\u4e2d\u56fd\u6765\u8d5e\u52a9\uff0c\u5f00\u6e90\u4e2d\u56fd\u7684\u7528\u6237\u8fd8\u662f\u6bd4\u8f83\u6177\u6168\u7684\u3002\n\n\u53e6\u4e00\u79cd\u662f\u6295\u653e\u5e7f\u544a\uff0c\u8fd9\u91cc\u63a8\u8350 [Carbon](https://www.carbonads.net/)\uff0c\u4e0d\u540c\u4e8e Google Ads \u7684\u662f\uff0c\u5b83\u7684\u5e7f\u544a\u90fd\u662f\u4e0e\u4e92\u8054\u7f51\u76f8\u5173\u7684\uff0c\u800c\u4e14\u6837\u5f0f\u53ef\u4ee5\u5b8c\u5168\u81ea\u5b9a\u4e49\uff0c\u5f88\u7f8e\u89c2\uff0c\u4e0d\u4f1a\u8ba9\u7528\u6237\u4ea7\u751f\u53cd\u611f\uff0c\u5e7f\u544a\u6839\u636e\u5c55\u793a\u548c\u70b9\u51fb\u8f6c\u5316\u4ed8\u8d39\u3002Carbon \u7684\u4e2d\u56fd\u5e02\u573a\u8d1f\u8d23\u4eba\u4e2d\u6587\u5f88\u6e9c\u54e6\uff0c\u4f5c\u4e3a\u4e2d\u56fd\u5f00\u53d1\u8005\uff0c\u4e0d\u7528\u62c5\u5fc3\u8c08\u4e0d\u6765\u3002\n\n\u4e0d\u8fc7\u5462\uff0c\u6700\u503c\u5f97\u63a8\u8350\u7684\u8fd8\u662f\u63a5\u5165**\u54c1\u724c\u5e7f\u544a**\uff0c\u4f46\u524d\u63d0\u662f\u4f60\u7684\u6587\u6863\u8981\u6709\u4e00\u5b9a\u7684\u6d41\u91cf\u3002\u5f00\u6e90\u9879\u76ee\u7684\u6587\u6863\u6709\u7740\u6700\u5927\u7684\u7279\u70b9\uff1a\u8bbf\u95ee\u8005\u51e0\u4e4e\u90fd\u662f\u7a0b\u5e8f\u5458\uff0c\u6240\u4ee5\u4f60\u8981\u662f\u6302\u4e2a\u67d0\u591a\u591a\u7684\u5e7f\u544a\uff0c\u51e0\u4e4e\u4f1a\u88ab\u55b7\u6b7b\u3002\u5728\u7ebf\u6559\u80b2\u3001\u4e91\u4e3b\u673a\u670d\u52a1\u5546\u90fd\u662f\u4e0d\u9519\u7684\u9009\u62e9\u3002\u4e00\u822c\u4e0d\u4f1a\u6709\u4eba\u4e3b\u52a8\u8054\u7cfb owner \u6295\u653e\u7684\uff0c\u9664\u975e\u50cf Vue.js \u8fd9\u79cd\u7ea7\u522b\u7684\uff0c\u4f46\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u53d1\u4e00\u5c01\u53cb\u597d\u7684\u90ae\u4ef6\u6765\u8be2\u95ee\u3002\u4e0d\u77e5\u9053\u53d1\u7ed9\u8c01\uff1f\u544a\u8bc9\u4f60\u4e2a\u597d\u529e\u6cd5\uff0c\u53bb\u5176\u5b83\u793e\u533a\uff08\u6bd4\u5982 v2ex\uff09\u770b\u770b\u90fd\u6709\u54ea\u4e9b\u91d1\u4e3b\u6295\u653e\u5c31\u77e5\u9053\u4e86\uff0c\u65e2\u7136\u5df2\u7ecf\u6295\u653e\uff0c\u8bf4\u660e\u6709\u6295\u653e\u5e7f\u544a\u7684\u9700\u6c42\uff0c\u90fd\u662f\u6f5c\u5728\u7684\u76ee\u6807\u201c\u5ba2\u6237\u201d\u3002\n\n\u518d\u6765\u8bf4\u8bf4\u5546\u4e1a\u5316\u3002\n\n\u5f00\u6e90\u5e76\u4e0d\u662f\u610f\u5473\u7740\u514d\u8d39\uff0c\u6839\u636e\u5f00\u6e90\u534f\u8bae\u7684\u4e0d\u540c\uff0c\u6709\u7684\u5f00\u6e90\u8f6f\u4ef6\u5728\u7528\u4e8e\u5546\u4e1a\u65f6\uff0c\u53ef\u80fd\u8981\u8d2d\u4e70\u6388\u6743\uff0c\u6e90\u7801\u662f\u5f00\u653e\u7684\uff0c\u4f46\u4e0d\u4e00\u5b9a\u53ef\u4ee5\u514d\u8d39\u4f7f\u7528\u3002\u4e0d\u8fc7\u80fd\u591f\u6536\u53d6\u6388\u6743\u8d39\uff0c\u4e5f\u8bf4\u660e\u4f60\u7684\u8f6f\u4ef6\u786e\u5b9e\u65e0\u53ef\u66ff\u4ee3\u3002\u4f01\u4e1a\u4e3a\u4e86\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u7ea0\u7eb7\uff0c\u80af\u5b9a\u662f\u613f\u610f\u8d2d\u4e70\u4f60\u7684\u8f6f\u4ef6\u7684\u3002\u4f46\u662f\u5bf9\u4e8e\u5927\u591a\u6570 MIT \u7684\u5f00\u6e90\u9879\u76ee\uff0c\u53ef\u4ee5\u5546\u4e1a\u5316\u5417\uff1f\u7b54\u6848\u662f\u80af\u5b9a\u7684\u3002\n\n\u9996\u5148\u8981\u77e5\u9053\uff0c\u80fd\u591f\u4ed8\u8d39\u7684\uff0c\u90fd\u662f\u4f01\u4e1a\uff0c\u800c\u975e\u4e2a\u4eba\uff0c\u4e2a\u4eba\u4e5f\u6ca1\u6709\u4ed8\u8d39\u7684\u5fc5\u8981\u3002\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u6a21\u5f0f\u5c31\u662f\u8f6f\u4ef6\u514d\u8d39\uff0c\u7136\u540e\u53ef\u4ee5\u5411\u4f01\u4e1a\u63d0\u4f9b\u989d\u5916\u7684\u4ed8\u8d39\u54a8\u8be2\u670d\u52a1\u6216\u987e\u95ee\u3002\u6700\u61c2\u5f00\u6e90\u9879\u76ee\u7684\u4eba\uff0c\u7edd\u5bf9\u662f\u8fd9\u4e2a\u9879\u76ee\u7684 owner\uff0c\u5982\u679c\u4f01\u4e1a\u662f\u6df1\u5ea6\u7528\u6237\uff0c\u8fd8\u662f\u5f88\u613f\u610f\u652f\u4ed8\u4e00\u4e9b\u8d39\u7528\u6765\u54a8\u8be2\u95ee\u9898\u7684\u3002\u6211\u662f\u505a to B \u4e1a\u52a1\u7684\uff0c\u6211\u4eec\u516c\u53f8\u4e5f\u662f\u505a to B \u7684\uff0c\u516c\u53f8\u9ad8\u7ba1\u5927\u591a\u4e5f\u6765\u81ea Oracle\uff08\u7b97\u662f\u6bd4\u8f83\u5927\u7684 to B \u4f01\u4e1a\u4e86\uff09\uff0c\u6240\u4ee5\u6211\u5bf9\u4f01\u4e1a\u670d\u52a1\u4e5f\u6709\u4e00\u5b9a\u7684\u7406\u89e3\uff0c\u4e00\u6b3e\u597d\u7684\u4ea7\u54c1\uff0c\u7edd\u5bf9\u662f\u6280\u672f\u52a0\u54a8\u8be2\u670d\u52a1\u3002\n\n\u5546\u4e1a\u5316\u8fd8\u662f\u6709\u5f88\u591a\u65b9\u5f0f\u7684\uff0c\u5177\u4f53\u8981\u770b\u5f00\u6e90\u9879\u76ee\u7684\u7c7b\u578b\u3002\u4ee5\u7ec4\u4ef6\u5e93\u4e3a\u4f8b\uff0c\u5b83\u672c\u8eab\u662f\u514d\u8d39\u7684\uff0c\u4e5f\u53ef\u4ee5\u65e0\u9650\u5236\u514d\u8d39\u4f7f\u7528\uff0c\u4f46\u53ef\u80fd\u63d0\u4f9b\u4ed8\u8d39\u7684\u9ad8\u7ea7\u7ec4\u4ef6\u6216\u6a21\u677f\u7cfb\u7edf\uff0c\u4ee5\u53ca\u5176\u5b83\u751f\u6001\u4ea7\u54c1\uff0c\u6bd4\u5982\u57fa\u4e8e\u7ec4\u4ef6\u5e93\u7684 IM \u7cfb\u7edf\u3002\n\n\u5f53\u7136\u4e86\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684\u5f00\u6e90\u9879\u76ee\u90fd\u8981\u5546\u4e1a\u5316\uff0c\u5927\u90e8\u5206\u8fd8\u662f\u5b8c\u5168\u514d\u8d39\u7684\uff0c\u5546\u4e1a\u5316\u4e5f\u6709\u5229\u5f0a\uff0c\u5982\u679c\u6ca1\u6709\u4e00\u5b9a\u7684\u5b9e\u529b\uff0c\u5f88\u6709\u53ef\u80fd\u641e\u7838\u54e6\uff01\n\n\u4ee5\u4e0a\uff0c\u5c31\u662f\u6211\u4ece\u4e8b\u5f00\u6e90\u5de5\u4f5c\u4e24\u5e74\u591a\u7684\u4e00\u4e9b\u6d45\u8584\u7ecf\u9a8c\uff0c\u5e0c\u671b\u80fd\u7ed9\u806a\u660e\u7684\u4f60\u5e26\u6765\u5e2e\u52a9\u3002\n\n## \u7ed3\u8bed\n\n\u6bcf\u4e2a\u5f00\u53d1\u8005\uff0c\u90fd\u5e94\u8be5\u5c1d\u8bd5\u7ef4\u62a4\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u3002\n\n\u6bcf\u4e2a\u5f00\u53d1\u8005\uff0c\u90fd\u5e94\u8be5\u62b1\u7740\u4e00\u9897\u656c\u754f\u4e4b\u5fc3\u4f7f\u7528\u4ed6\u4eba\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u800c\u4e0d\u662f\u201c\u7528\u4f60\u7684\u662f\u770b\u5f97\u8d77\u4f60\u201d\u3002\n\n\u6bcf\u4e2a\u5f00\u53d1\u8005\uff0c\u90fd\u5e94\u8be5\u9002\u5f53\u5730\u8d5e\u52a9\u4e00\u4e2a\u5e2e\u52a9\u8fc7\u4f60\u7684\u5f00\u6e90\u9879\u76ee\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u62d3\u5c55\u5982\u4f55\u505a\u597d\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\u4e0b\u7bc7.md", "create_date": "2020-02-18T21:37:09.057", "order": 19}}, {"model": "subject.chapter", "pk": 115, "fields": {"title": "\u7ec4\u4ef6\u7684\u901a\u4fe1 2\uff1a\u6d3e\u53d1\u4e0e\u5e7f\u64ad\u2014\u2014\u81ea\u884c\u5b9e\u73b0 dispatch \u548c broadcast \u65b9\u6cd5", "topic": 5, "md5": "0aff853f81709b421469a60340bac44b", "md_body": "# \u7ec4\u4ef6\u7684\u901a\u4fe1 2\uff1a\u6d3e\u53d1\u4e0e\u5e7f\u64ad\u2014\u2014\u81ea\u884c\u5b9e\u73b0 dispatch \u548c broadcast \u65b9\u6cd5\n\n\u4e0a\u4e00\u8bb2\u7684 provide / inject API \u4e3b\u8981\u89e3\u51b3\u4e86\u8de8\u7ea7\u7ec4\u4ef6\u95f4\u7684\u901a\u4fe1\u95ee\u9898\uff0c\u4e0d\u8fc7\u5b83\u7684\u4f7f\u7528\u573a\u666f\uff0c\u4e3b\u8981\u662f\u5b50\u7ec4\u4ef6\u83b7\u53d6\u4e0a\u7ea7\u7ec4\u4ef6\u7684\u72b6\u6001\uff0c\u8de8\u7ea7\u7ec4\u4ef6\u95f4\u5efa\u7acb\u4e86\u4e00\u79cd\u4e3b\u52a8\u63d0\u4f9b\u4e0e\u4f9d\u8d56\u6ce8\u5165\u7684\u5173\u7cfb\u3002\u7136\u540e\u6709\u4e24\u79cd\u573a\u666f\u5b83\u4e0d\u80fd\u5f88\u597d\u7684\u89e3\u51b3\uff1a\n\n*   \u7236\u7ec4\u4ef6\u5411\u5b50\u7ec4\u4ef6\uff08\u652f\u6301\u8de8\u7ea7\uff09\u4f20\u9012\u6570\u636e\uff1b\n*   \u5b50\u7ec4\u4ef6\u5411\u7236\u7ec4\u4ef6\uff08\u652f\u6301\u8de8\u7ea7\uff09\u4f20\u9012\u6570\u636e\u3002\n\n\u8fd9\u79cd\u7236\u5b50\uff08\u542b\u8de8\u7ea7\uff09\u4f20\u9012\u6570\u636e\u7684\u901a\u4fe1\u65b9\u5f0f\uff0cVue.js \u5e76\u6ca1\u6709\u63d0\u4f9b\u539f\u751f\u7684 API \u6765\u652f\u6301\uff0c\u800c\u662f\u63a8\u8350\u4f7f\u7528\u5927\u578b\u6570\u636e\u72b6\u6001\u7ba1\u7406\u5de5\u5177 Vuex\uff0c\u800c\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf\u4ecb\u7ecd\u8fc7 Vuex \u7684\u573a\u666f\u4e0e\u5728\u72ec\u7acb\u7ec4\u4ef6\uff08\u6216\u5e93\uff09\u4e2d\u4f7f\u7528\u7684\u9650\u5236\u3002\u672c\u5c0f\u8282\u5219\u4ecb\u7ecd\u4e00\u79cd\u5728\u7236\u5b50\u7ec4\u4ef6\u95f4\u901a\u4fe1\u7684\u65b9\u6cd5 `dispatch` \u548c `broadcast`\u3002\n\n## $on \u4e0e $emit\n\n\u5982\u679c\u60a8\u4f7f\u7528\u8fc7\u8f83\u65e9\u7684 Vue.js 1.x \u7248\u672c\uff0c\u80af\u5b9a\u5bf9 _$dispatch_ \u548c _$broadcast_ \u8fd9\u4e24\u4e2a\u5185\u7f6e\u7684\u65b9\u6cd5\u5f88\u719f\u6089\uff0c\u4e0d\u8fc7\u5b83\u4eec\u90fd\u5728 Vue.js 2.x \u91cc\u5e9f\u5f03\u4e86\u3002\u5728\u6b63\u5f0f\u4ecb\u7ecd\u4e3b\u89d2\u524d\uff0c\u6211\u4eec\u5148\u770b\u770b `$on` \u4e0e `$emit` \u8fd9\u4e24\u4e2a API\uff0c\u56e0\u4e3a\u5b83\u4eec\u662f\u672c\u8282\u5185\u5bb9\u7684\u57fa\u7840\u3002\n\n`$emit` \u4f1a\u5728**\u5f53\u524d\u7ec4\u4ef6**\u5b9e\u4f8b\u4e0a\u89e6\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u5e76\u4f20\u9012\u4e00\u4e9b\u53c2\u6570\u7ed9\u76d1\u542c\u5668\u7684\u56de\u8c03\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u90fd\u662f\u5728\u7236\u7ea7\u8c03\u7528\u8fd9\u4e2a\u7ec4\u4ef6\u65f6\uff0c\u4f7f\u7528 `@on` \u7684\u65b9\u5f0f\u6765\u76d1\u542c\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u7684\uff0c\u6bd4\u5982\u5728\u5b50\u7ec4\u4ef6\u4e2d\u89e6\u53d1\u4e8b\u4ef6\uff1a\n\n```\n// child.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565\nexport default {\n  methods: {\n    handleEmitEvent () {\n      this.$emit('test', 'Hello Vue.js');\n    }\n  }\n}\n\n```\n\n\u5728\u7236\u7ec4\u4ef6\u4e2d\u76d1\u542c\u7531 _child.vue_ \u89e6\u53d1\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6 **test**\uff1a\n\n```\n<!-- parent.vue\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565-->\n<template>\n  <child-component @test=\"handleEvent\">\n</template>\n<script>\n  export default {\n    methods: {\n      handleEvent (text) {\n      \tconsole.log(text);  // Hello Vue.js\n      }\n    }\n  }\n</script>\n\n```\n\n\u8fd9\u91cc\u770b\u4f3c\u662f\u5728\u7236\u7ec4\u4ef6 _parent.vue_ \u4e2d\u7ed1\u5b9a\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6 **test** \u7684\u5904\u7406\u53e5\u67c4\uff0c\u7136\u800c\u4e8b\u4ef6 test \u5e76\u4e0d\u662f\u5728\u7236\u7ec4\u4ef6\u4e0a\u89e6\u53d1\u7684\uff0c\u800c\u662f\u5728\u5b50\u7ec4\u4ef6 _child.vue_ \u91cc\u89e6\u53d1\u7684\uff0c\u53ea\u662f\u901a\u8fc7 `v-on` \u5728\u7236\u7ec4\u4ef6\u4e2d\u76d1\u542c\u3002\u65e2\u7136\u662f\u5b50\u7ec4\u4ef6\u81ea\u5df1\u89e6\u53d1\u7684\uff0c\u90a3\u5b83\u81ea\u5df1\u4e5f\u53ef\u4ee5\u76d1\u542c\u5230\uff0c\u8fd9\u5c31\u8981\u4f7f\u7528 `$on` \u6765\u76d1\u542c\u5b9e\u4f8b\u4e0a\u7684\u4e8b\u4ef6\uff0c\u6362\u8a00\u4e4b\uff0c\u7ec4\u4ef6\u4f7f\u7528 `$emit` \u5728\u81ea\u5df1\u5b9e\u4f8b\u4e0a\u89e6\u53d1\u4e8b\u4ef6\uff0c\u5e76\u7528 `$on` \u76d1\u542c\u5b83\u3002\n\n\u542c\u8d77\u6765\u8fd9\u79cd\u795e\uff08s\u0101o\uff09\u64cd\u4f5c\u6709\u70b9\u591a\u6b64\u4e00\u4e3e\uff0c\u6211\u4eec\u4e0d\u59a8\u5148\u6765\u770b\u4e2a\u793a\u4f8b\uff1a\n\n\uff08\u4e5f\u53ef\u901a\u8fc7\u5728\u7ebf\u94fe\u63a5 [https://run.iviewui.com/ggsomfHM](https://run.iviewui.com/ggsomfHM) \u76f4\u63a5\u8fd0\u884c\u8be5\u793a\u4f8b\uff09\n\n```\n<template>\n  <div>\n    <button @click=\"handleEmitEvent\">\u89e6\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6</button>\n  </div>\n</template>\n<script>\n  export default {\n    methods: {\n      handleEmitEvent () {\n        // \u5728\u5f53\u524d\u7ec4\u4ef6\u4e0a\u89e6\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6 test\uff0c\u5e76\u4f20\u503c\n        this.$emit('test', 'Hello Vue.js')\n      }\n    },\n    mounted () {\n      // \u76d1\u542c\u81ea\u5b9a\u4e49\u4e8b\u4ef6 test\n      this.$on('test', (text) => {\n        window.alert(text);\n      });\n    }\n  }\n</script>\n\n```\n\n`$on` \u76d1\u542c\u4e86\u81ea\u5df1\u89e6\u53d1\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6 test\uff0c\u56e0\u4e3a\u6709\u65f6\u4e0d\u786e\u5b9a\u4f55\u65f6\u4f1a\u89e6\u53d1\u4e8b\u4ef6\uff0c\u4e00\u822c\u4f1a\u5728 `mounted` \u6216 `created` \u94a9\u5b50\u4e2d\u6765\u76d1\u542c\u3002\n\n\u4ec5\u4e0a\u9762\u7684\u793a\u4f8b\uff0c\u7684\u786e\u662f\u591a\u6b64\u4e00\u4e3e\u7684\uff0c\u56e0\u4e3a\u5927\u53ef\u5728 handleEmitEvent \u91cc\u76f4\u63a5\u5199 window.alert(text)\uff0c\u6ca1\u5fc5\u8981\u7ed5\u4e00\u5708\u3002\n\n\u4e4b\u6240\u4ee5\u591a\u6b64\u4e00\u4e3e\uff0c\u662f\u56e0\u4e3a handleEmitEvent \u662f\u5f53\u524d\u7ec4\u4ef6\u5185\u7684 `<button>` \u8c03\u7528\u7684\uff0c\u5982\u679c\u8fd9\u4e2a\u65b9\u6cd5\u4e0d\u662f\u5b83\u81ea\u5df1\u8c03\u7528\uff0c\u800c\u662f\u5176\u5b83\u7ec4\u4ef6\u8c03\u7528\u7684\uff0c\u90a3\u8fd9\u4e2a\u7528\u6cd5\u5c31\u5927\u6709\u53ef\u4e3a\u4e86\u3002\n\n\u4e86\u89e3\u4e86 `$on` \u548c `$emit` \u7684\u7528\u6cd5\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u4e24\u4e2a\u201c\u8fc7\u65f6\u7684\u201d API\u3002\n\n## Vue.js 1.x \u7684 $dispatch \u4e0e $broadcast\n\n\u867d\u7136 Vue.js 1.x \u5df2\u7ecf\u6210\u4e3a\u8fc7\u53bb\u65f6\uff0c\u4f46\u4e3a\u4e86\u5145\u5206\u7406\u89e3\u672c\u8282\u901a\u4fe1\u65b9\u6cd5\u7684\u4f7f\u7528\u573a\u666f\uff0c\u8fd8\u662f\u6709\u5fc5\u8981\u6765\u4e86\u89e3\u4e00\u70b9\u5b83\u7684\u5386\u53f2\u3002\n\n\u5728 Vue.js 1.x \u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e24\u4e2a\u65b9\u6cd5\uff1a`$dispatch` \u548c `$broadcast` \uff0c\u524d\u8005\u7528\u4e8e\u5411\u4e0a\u7ea7\u6d3e\u53d1\u4e8b\u4ef6\uff0c\u53ea\u8981\u662f\u5b83\u7684\u7236\u7ea7\uff08\u4e00\u7ea7\u6216\u591a\u7ea7\u4ee5\u4e0a\uff09\uff0c\u90fd\u53ef\u4ee5\u5728\u7ec4\u4ef6\u5185\u901a\u8fc7 `$on` \uff08\u6216 events\uff0c2.x \u5df2\u5e9f\u5f03\uff09\u76d1\u542c\u5230\uff0c\u540e\u8005\u76f8\u53cd\uff0c\u662f\u7531\u4e0a\u7ea7\u5411\u4e0b\u7ea7\u5e7f\u64ad\u4e8b\u4ef6\u7684\u3002\n\n\u6765\u770b\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff1a\n\n```\n<!-- \u6ce8\u610f\uff1a\u8be5\u793a\u4f8b\u4e3a Vue.js 1.x \u7248\u672c -->\n<!-- \u5b50\u7ec4\u4ef6 -->\n<template>\n  <button @click=\"handleDispatch\">\u6d3e\u53d1\u4e8b\u4ef6</button>\n</template>\n<script>\nexport default {\n  methods: {\n    handleDispatch () {\n      this.$dispatch('test', 'Hello, Vue.js');\n    }\n  }\n}\n</script>\n\n```\n\n```\n<!-- \u7236\u7ec4\u4ef6\uff0c\u90e8\u5206\u4ee3\u7801\u7701\u7565 -->\n<template>\n  <child-component></child-component>\n</template>\n<script>\n  export default {\n    mounted () {\n      this.$on('test', (text) => {\n        console.log(text);  // Hello, Vue.js\n      });\n    }\n  }\n</script>\n\n```\n\n$broadcast \u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u65b9\u5411\u76f8\u53cd\u3002\u8fd9\u4e24\u79cd\u65b9\u6cd5\u4e00\u65e6\u53d1\u51fa\u4e8b\u4ef6\u540e\uff0c\u4efb\u4f55\u7ec4\u4ef6\u90fd\u662f\u53ef\u4ee5\u63a5\u6536\u5230\u7684\uff0c\u5c31\u8fd1\u539f\u5219\uff0c\u800c\u4e14\u4f1a\u5728\u7b2c\u4e00\u6b21\u63a5\u6536\u5230\u540e\u505c\u6b62\u5192\u6ce1\uff0c\u9664\u975e\u8fd4\u56de true\u3002\n\n\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u867d\u7136\u770b\u8d77\u6765\u5f88\u597d\u7528\uff0c\u4f46\u662f\u5728 Vue.js 2.x \u4e2d\u90fd\u5e9f\u5f03\u4e86\uff0c\u5b98\u65b9\u7ed9\u51fa\u7684\u89e3\u91ca\u662f\uff1a\n\n> \u56e0\u4e3a\u57fa\u4e8e\u7ec4\u4ef6\u6811\u7ed3\u6784\u7684\u4e8b\u4ef6\u6d41\u65b9\u5f0f\u6709\u65f6\u8ba9\u4eba\u96be\u4ee5\u7406\u89e3\uff0c\u5e76\u4e14\u5728\u7ec4\u4ef6\u7ed3\u6784\u6269\u5c55\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u53d8\u5f97\u8d8a\u6765\u8d8a\u8106\u5f31\u3002\n\n\u867d\u7136\u5728\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u5b83\u6ca1\u6709 Vuex \u8fd9\u6837\u4e13\u95e8\u7ba1\u7406\u72b6\u6001\u7684\u63d2\u4ef6\u6e05\u6670\u597d\u7528\uff0c\u4f46\u5bf9\u72ec\u7acb\u7ec4\u4ef6\uff08\u5e93\uff09\u7684\u5f00\u53d1\uff0c\u7edd\u5bf9\u662f\u798f\u97f3\u3002\u56e0\u4e3a\u72ec\u7acb\u7ec4\u4ef6\u4e00\u822c\u5c42\u7ea7\u5e76\u4e0d\u4f1a\u5f88\u590d\u6742\uff0c\u5e76\u4e14\u5265\u79bb\u4e86\u4e1a\u52a1\uff0c\u4e0d\u4f1a\u53d8\u7684\u96be\u4ee5\u7ef4\u62a4\u3002\n\n\u77e5\u9053\u4e86 _$dispatch_ \u548c _$broadcast_ \u7684\u524d\u4e16\u4eca\u751f\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u5728 Vue.js 2.x \u4e2d\u81ea\u884c\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u3002\n\n## \u81ea\u884c\u5b9e\u73b0 dispatch \u548c broadcast \u65b9\u6cd5\n\n\u81ea\u884c\u5b9e\u73b0\u7684 dispatch \u548c broadcast \u65b9\u6cd5\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u8ddf Vue.js 1.x \u7684 _$dispatch_ \u548c _$broadcast_ \u5177\u6709\u5b8c\u5168\u76f8\u540c\u7684\u4f53\u9a8c\uff0c\u4f46\u57fa\u672c\u529f\u80fd\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u89e3\u51b3\u7236\u5b50\u7ec4\u4ef6\uff08\u542b\u8de8\u7ea7\uff09\u95f4\u7684\u901a\u4fe1\u95ee\u9898\u3002\n\n\u901a\u8fc7\u76ee\u524d\u5df2\u77e5\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u8981\u5b9e\u73b0\u7684 dispatch \u548c broadcast \u65b9\u6cd5\uff0c\u5c06\u5177\u6709\u4ee5\u4e0b\u529f\u80fd\uff1a\n\n*   \u5728\u5b50\u7ec4\u4ef6\u8c03\u7528 dispatch \u65b9\u6cd5\uff0c\u5411\u4e0a\u7ea7\u6307\u5b9a\u7684\u7ec4\u4ef6\u5b9e\u4f8b\uff08\u6700\u8fd1\u7684\uff09\u4e0a\u89e6\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u5e76\u4f20\u9012\u6570\u636e\uff0c\u4e14\u8be5\u4e0a\u7ea7\u7ec4\u4ef6\u5df2\u9884\u5148\u901a\u8fc7 `$on` \u76d1\u542c\u4e86\u8fd9\u4e2a\u4e8b\u4ef6\uff1b\n*   \u76f8\u53cd\uff0c\u5728\u7236\u7ec4\u4ef6\u8c03\u7528 broadcast \u65b9\u6cd5\uff0c\u5411\u4e0b\u7ea7\u6307\u5b9a\u7684\u7ec4\u4ef6\u5b9e\u4f8b\uff08\u6700\u8fd1\u7684\uff09\u4e0a\u89e6\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u5e76\u4f20\u9012\u6570\u636e\uff0c\u4e14\u8be5\u4e0b\u7ea7\u7ec4\u4ef6\u5df2\u9884\u5148\u901a\u8fc7 `$on` \u76d1\u542c\u4e86\u8fd9\u4e2a\u4e8b\u4ef6\u3002\n\n\u5b9e\u73b0\u8fd9\u5bf9\u65b9\u6cd5\u7684\u5173\u952e\u70b9\u5728\u4e8e\uff0c\u5982\u4f55\u6b63\u786e\u5730\u5411\u4e0a\u6216\u5411\u4e0b\u627e\u5230\u5bf9\u5e94\u7684\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u5e76\u5728\u5b83\u4e0a\u9762\u89e6\u53d1\u65b9\u6cd5\u3002\u5728\u8bbe\u8ba1\u4e00\u4e2a\u65b0\u529f\u80fd\uff08features\uff09\u65f6\uff0c\u53ef\u4ee5\u5148\u786e\u5b9a\u8fd9\u4e2a\u529f\u80fd\u7684 API \u662f\u4ec0\u4e48\uff0c\u4e5f\u5c31\u662f\u8bf4\u65b9\u6cd5\u540d\u3001\u53c2\u6570\u3001\u4f7f\u7528\u6837\u4f8b\uff0c\u786e\u5b9a\u597d API\uff0c\u518d\u6765\u5199\u5177\u4f53\u7684\u4ee3\u7801\u3002\n\n\u56e0\u4e3a Vue.js \u5185\u7f6e\u7684\u65b9\u6cd5\uff0c\u624d\u662f\u4ee5 `$` \u5f00\u5934\u7684\uff0c\u6bd4\u5982 `$nextTick`\u3001`$emit` \u7b49\uff0c\u4e3a\u4e86\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u51b2\u7a81\u5e76\u9075\u5faa\u89c4\u8303\uff0c\u8fd9\u91cc\u7684 dispatch \u548c broadcast \u65b9\u6cd5\u540d\u524d\u4e0d\u52a0 `$`\u3002\u5e76\u4e14\u8be5\u65b9\u6cd5\u53ef\u80fd\u5728\u5f88\u591a\u7ec4\u4ef6\u4e2d\u90fd\u4f1a\u4f7f\u7528\uff0c\u590d\u7528\u8d77\u89c1\uff0c\u6211\u4eec\u5c01\u88c5\u5728\u6df7\u5408\uff08mixins\uff09\u91cc\u3002\u90a3\u5b83\u7684\u4f7f\u7528\u6837\u4f8b\u53ef\u80fd\u662f\u8fd9\u6837\u7684\uff1a\n\n```\n// \u90e8\u5206\u4ee3\u7801\u7701\u7565\nimport Emitter from '../mixins/emitter.js'\n\nexport default {\n  mixins: [ Emitter ],\n  methods: {\n    handleDispatch () {\n      this.dispatch();  // \u2460\n    },\n    handleBroadcast () {\n      this.broadcast();  // \u2461\n    }\n  }\n}\n\n```\n\n\u4e0a\u4f8b\u4e2d\u884c \u2460 \u548c\u884c \u2461 \u7684\u4e24\u4e2a\u65b9\u6cd5\u5c31\u662f\u5728\u5bfc\u5165\u7684\u6df7\u5408 **emitter.js** \u4e2d\u5b9a\u4e49\u7684\uff0c\u8fd9\u4e2a\u7a0d\u540e\u6211\u4eec\u518d\u8bb2\uff0c\u5148\u6765\u5206\u6790\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u5e94\u8be5\u4f20\u5165\u4ec0\u4e48\u53c2\u6570\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u4e3a\u4e86\u8ddf Vue.js 1.x \u7684\u65b9\u6cd5\u4e00\u81f4\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5e94\u5f53\u662f\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u540d\uff0c\u6bd4\u5982 \u201ctest\u201d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4f20\u9012\u7684\u6570\u636e\uff0c\u6bd4\u5982 \u201cHello, Vue.js\u201d\uff0c\u4f46\u5728\u8fd9\u91cc\uff0c\u6709\u4ec0\u4e48\u95ee\u9898\u5462\uff1f\u53ea\u901a\u8fc7\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u6211\u4eec\u6ca1\u529e\u6cd5\u77e5\u9053\u8981\u5728\u54ea\u4e2a\u7ec4\u4ef6\u4e0a\u89e6\u53d1\u4e8b\u4ef6\uff0c\u56e0\u4e3a\u81ea\u884c\u5b9e\u73b0\u7684\u8fd9\u5bf9\u65b9\u6cd5\uff0c\u4e0e Vue.js 1.x \u7684\u539f\u751f\u65b9\u6cd5\u673a\u7406\u4e0a\u662f\u6709\u533a\u522b\u7684\u3002\u4e0a\u6587\u8bf4\u5230\uff0c\u5b9e\u73b0\u8fd9\u5bf9\u65b9\u6cd5\u7684\u5173\u952e\u70b9\u5728\u4e8e\u51c6\u786e\u5730**\u627e\u5230\u7ec4\u4ef6\u5b9e\u4f8b**\u3002\u90a3\u5728\u5bfb\u627e\u7ec4\u4ef6\u5b9e\u4f8b\u4e0a\uff0c\u6211\u4eec\u7684\u201c\u60ef\u7528\u4f0e\u4fe9\u201d\u5c31\u662f\u901a\u8fc7\u904d\u5386\u6765\u5339\u914d\u7ec4\u4ef6\u7684 `name` \u9009\u9879\uff0c\u5728\u72ec\u7acb\u7ec4\u4ef6\uff08\u5e93\uff09\u91cc\uff0c\u6bcf\u4e2a\u7ec4\u4ef6\u7684 `name` \u503c\u5e94\u5f53\u662f\u552f\u4e00\u7684\uff0cname \u4e3b\u8981\u7528\u4e8e\u9012\u5f52\u7ec4\u4ef6\uff0c\u5728\u540e\u9762\u5c0f\u8282\u4f1a\u5355\u72ec\u4ecb\u7ecd\u3002\n\n\u5148\u6765\u770b\u4e0b **emitter.js** \u7684\u4ee3\u7801\uff1a\n\n```\nfunction broadcast(componentName, eventName, params) {\n  this.$children.forEach(child => {\n    const name = child.$options.name;\n\n    if (name === componentName) {\n      child.$emit.apply(child, [eventName].concat(params));\n    } else {\n      broadcast.apply(child, [componentName, eventName].concat([params]));\n    }\n  });\n}\nexport default {\n  methods: {\n    dispatch(componentName, eventName, params) {\n      let parent = this.$parent || this.$root;\n      let name = parent.$options.name;\n\n      while (parent && (!name || name !== componentName)) {\n        parent = parent.$parent;\n\n        if (parent) {\n          name = parent.$options.name;\n        }\n      }\n      if (parent) {\n        parent.$emit.apply(parent, [eventName].concat(params));\n      }\n    },\n    broadcast(componentName, eventName, params) {\n      broadcast.call(this, componentName, eventName, params);\n    }\n  }\n};\n\n```\n\n\u56e0\u4e3a\u662f\u7528\u4f5c mixins \u5bfc\u5165\uff0c\u6240\u4ee5\u5728 methods \u91cc\u5b9a\u4e49\u7684 dispatch \u548c broadcast \u65b9\u6cd5\u4f1a\u88ab\u6df7\u5408\u5230\u7ec4\u4ef6\u91cc\uff0c\u81ea\u7136\u5c31\u53ef\u4ee5\u7528 `this.dispatch` \u548c `this.broadcast` \u6765\u4f7f\u7528\u3002\n\n\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u90fd\u63a5\u6536\u4e86\u4e09\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u7ec4\u4ef6\u7684 `name` \u503c\uff0c\u7528\u4e8e\u5411\u4e0a\u6216\u5411\u4e0b\u9012\u5f52\u904d\u5386\u6765\u5bfb\u627e\u5bf9\u5e94\u7684\u7ec4\u4ef6\uff0c\u7b2c\u4e8c\u4e2a\u548c\u7b2c\u4e09\u4e2a\u5c31\u662f\u4e0a\u6587\u5206\u6790\u7684\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u540d\u79f0\u548c\u8981\u4f20\u9012\u7684\u6570\u636e\u3002\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u5728 dispatch \u91cc\uff0c\u901a\u8fc7 _while_ \u8bed\u53e5\uff0c\u4e0d\u65ad\u5411\u4e0a\u904d\u5386\u66f4\u65b0\u5f53\u524d\u7ec4\u4ef6\uff08\u5373\u4e0a\u4e0b\u6587\u4e3a\u5f53\u524d\u8c03\u7528\u8be5\u65b9\u6cd5\u7684\u7ec4\u4ef6\uff09\u7684\u7236\u7ec4\u4ef6\u5b9e\u4f8b\uff08\u53d8\u91cf parent \u5373\u4e3a\u7236\u7ec4\u4ef6\u5b9e\u4f8b\uff09\uff0c\u76f4\u5230\u5339\u914d\u5230\u5b9a\u4e49\u7684 `componentName` \u4e0e\u67d0\u4e2a\u4e0a\u7ea7\u7ec4\u4ef6\u7684 `name` \u9009\u9879\u4e00\u81f4\u65f6\uff0c\u7ed3\u675f\u5faa\u73af\uff0c\u5e76\u5728\u627e\u5230\u7684\u7ec4\u4ef6\u5b9e\u4f8b\u4e0a\uff0c\u8c03\u7528 `$emit` \u65b9\u6cd5\u6765\u89e6\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6 `eventName`\u3002broadcast \u65b9\u6cd5\u4e0e\u4e4b\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u662f\u5411\u4e0b\u904d\u5386\u5bfb\u627e\u3002\n\n\u6765\u770b\u4e00\u4e0b\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5\u3002\u6709 **A.vue** \u548c **B.vue** \u4e24\u4e2a\u7ec4\u4ef6\uff0c\u5176\u4e2d B \u662f A \u7684\u5b50\u7ec4\u4ef6\uff0c\u4e2d\u95f4\u53ef\u80fd\u8de8\u591a\u7ea7\uff0c\u5728 A \u4e2d\u5411 B \u901a\u4fe1\uff1a\n\n```\n<!-- A.vue -->\n<template>\n\t<button @click=\"handleClick\">\u89e6\u53d1\u4e8b\u4ef6</button>\n</template>\n<script>\n  import Emitter from '../mixins/emitter.js';\n  \n  export default {\n    name: 'componentA',\n    mixins: [ Emitter ],\n    methods: {\n      handleClick () {\n        this.broadcast('componentB', 'on-message', 'Hello Vue.js');\n      }\n    }\n  }\n</script>\n\n```\n\n```\n// B.vue\nexport default {\n  name: 'componentB',\n  created () {\n    this.$on('on-message', this.showMessage);\n  },\n  methods: {\n    showMessage (text) {\n      window.alert(text);\n    }\n  }\n}\n\n```\n\n\u540c\u7406\uff0c\u5982\u679c\u662f B \u5411 A \u901a\u4fe1\uff0c\u5728 B \u4e2d\u8c03\u7528 dispatch \u65b9\u6cd5\uff0c\u5728 A \u4e2d\u4f7f\u7528 $on \u76d1\u542c\u4e8b\u4ef6\u5373\u53ef\u3002\n\n\u4ee5\u4e0a\u5c31\u662f\u81ea\u884c\u5b9e\u73b0\u7684 dispatch \u548c broadcast \u65b9\u6cd5\uff0c\u76f8\u6bd4 Vue.js 1.x\uff0c\u6709\u4ee5\u4e0b\u4e0d\u540c\uff1a\n\n*   \u9700\u8981\u989d\u5916\u4f20\u5165\u7ec4\u4ef6\u7684 name \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1b\n*   \u65e0\u5192\u6ce1\u673a\u5236\uff1b\n*   \u7b2c\u4e09\u4e2a\u53c2\u6570\u4f20\u9012\u7684\u6570\u636e\uff0c\u53ea\u80fd\u662f\u4e00\u4e2a\uff08\u8f83\u591a\u65f6\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a\u5bf9\u8c61\uff09\uff0c\u800c Vue.js 1.x \u53ef\u4ee5\u4f20\u5165\u591a\u4e2a\u53c2\u6570\uff0c\u5f53\u7136\uff0c\u4f60\u5bf9 emitter.js \u7a0d\u4f5c\u4fee\u6539\uff0c\u4e5f\u80fd\u652f\u6301\u4f20\u5165\u591a\u4e2a\u53c2\u6570\uff0c\u53ea\u662f\u4e00\u822c\u573a\u666f\u4f20\u5165\u4e00\u4e2a\u5bf9\u8c61\u8db3\u4ee5\u3002\n\n## \u7ed3\u8bed\n\nVue.js \u7684\u7ec4\u4ef6\u901a\u4fe1\u5230\u6b64\u8fd8\u6ca1\u5b8c\u5168\u7ed3\u675f\uff0c\u5982\u679c\u4f60\u60f3\u201c\u8d81\u70ed\u6253\u94c1\u201d\u4e00\u53e3\u6c14\u770b\u5b8c\uff0c\u53ef\u4ee5\u5148\u9605\u8bfb\u7b2c 6 \u8282\u7ec4\u4ef6\u7684\u901a\u4fe1 3\u3002\u4ea6\u6216\u6309\u987a\u5e8f\u770b\u4e0b\u4e00\u8282\u7684\u5b9e\u6218\uff0c\u6765\u8fdb\u4e00\u6b65\u52a0\u6df1\u7406\u89e3 provide / inject \u548c dispatch / broadcast \u8fd9\u4e24\u5bf9\u901a\u4fe1\u65b9\u6cd5\u7684\u4f7f\u7528\u573a\u666f\u3002\n\n\u6ce8\uff1a\u672c\u8282\u90e8\u5206\u4ee3\u7801\u53c2\u8003 [iView](https://github.com/iview/iview/blob/2.0/src/mixins/emitter.js)\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u7ec4\u4ef6\u7684\u901a\u4fe1_2\u6d3e\u53d1\u4e0e\u5e7f\u64ad\u81ea\u884c\u5b9e\u73b0_dispatch_\u548c_broadcast_\u65b9\u6cd5.md", "create_date": "2020-02-18T21:37:09.329", "order": 4}}, {"model": "subject.chapter", "pk": 116, "fields": {"title": "\u7ec4\u4ef6\u7684\u901a\u4fe1 3\uff1a\u627e\u5230\u4efb\u610f\u7ec4\u4ef6\u5b9e\u4f8b\u2014\u2014findComponents \u7cfb\u5217\u65b9\u6cd5", "topic": 5, "md5": "3d855ac0fd6bfa3594dee08222dcec1e", "md_body": "# \u7ec4\u4ef6\u7684\u901a\u4fe1 3\uff1a\u627e\u5230\u4efb\u610f\u7ec4\u4ef6\u5b9e\u4f8b\u2014\u2014findComponents \u7cfb\u5217\u65b9\u6cd5\n\n## \u6982\u8ff0\n\n\u524d\u9762\u7684\u5c0f\u8282\u6211\u4eec\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u4e24\u79cd\u7ec4\u4ef6\u95f4\u901a\u4fe1\u7684\u65b9\u6cd5\uff1aprovide / inject \u548c dispatch / broadcast\u3002\u5b83\u4eec\u6709\u5404\u81ea\u7684\u4f7f\u7528\u573a\u666f\u548c\u5c40\u9650\uff0c\u6bd4\u5982\u524d\u8005\u591a\u7528\u4e8e\u5b50\u7ec4\u4ef6\u83b7\u53d6\u7236\u7ec4\u4ef6\u7684\u72b6\u6001\uff0c\u540e\u8005\u5e38\u7528\u4e8e\u7236\u5b50\u7ec4\u4ef6\u95f4\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u901a\u4fe1\u3002\n\n\u672c\u8282\u5c06\u4ecb\u7ecd\u7b2c 3 \u79cd\u7ec4\u4ef6\u901a\u4fe1\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f findComponents \u7cfb\u5217\u65b9\u6cd5\uff0c\u5b83\u5e76\u975e Vue.js \u5185\u7f6e\uff0c\u800c\u662f\u9700\u8981\u81ea\u884c\u5b9e\u73b0\uff0c\u4ee5\u5de5\u5177\u51fd\u6570\u7684\u5f62\u5f0f\u6765\u4f7f\u7528\uff0c\u5b83\u662f\u4e00\u7cfb\u5217\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u8bf4\u662f\u7ec4\u4ef6\u901a\u4fe1\u7684\u7ec8\u6781\u65b9\u6848\u3002findComponents \u7cfb\u5217\u65b9\u6cd5\u6700\u7ec8\u90fd\u662f\u8fd4\u56de\u7ec4\u4ef6\u7684\u5b9e\u4f8b\uff0c\u8fdb\u800c\u53ef\u4ee5\u8bfb\u53d6\u6216\u8c03\u7528\u8be5\u7ec4\u4ef6\u7684\u6570\u636e\u548c\u65b9\u6cd5\u3002\n\n\u5b83\u9002\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a\n\n*   \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0a\u627e\u5230\u6700\u8fd1\u7684\u6307\u5b9a\u7ec4\u4ef6\uff1b\n*   \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0a\u627e\u5230\u6240\u6709\u7684\u6307\u5b9a\u7ec4\u4ef6\uff1b\n*   \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0b\u627e\u5230\u6700\u8fd1\u7684\u6307\u5b9a\u7ec4\u4ef6\uff1b\n*   \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0b\u627e\u5230\u6240\u6709\u6307\u5b9a\u7684\u7ec4\u4ef6\uff1b\n*   \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u627e\u5230\u6307\u5b9a\u7ec4\u4ef6\u7684\u5144\u5f1f\u7ec4\u4ef6\u3002\n\n5 \u4e2a\u4e0d\u540c\u7684\u573a\u666f\uff0c\u5bf9\u5e94 5 \u4e2a\u4e0d\u540c\u7684\u51fd\u6570\uff0c\u5b9e\u73b0\u539f\u7406\u4e5f\u5927\u540c\u5c0f\u5f02\u3002\n\n## \u5b9e\u73b0\n\n5 \u4e2a\u51fd\u6570\u7684\u539f\u7406\uff0c\u90fd\u662f\u901a\u8fc7\u9012\u5f52\u3001\u904d\u5386\uff0c\u627e\u5230\u6307\u5b9a\u7ec4\u4ef6\u7684 `name` \u9009\u9879\u5339\u914d\u7684\u7ec4\u4ef6\u5b9e\u4f8b\u5e76\u8fd4\u56de\u3002\n\n> \u672c\u8282\u4ee5\u53ca\u540e\u7eed\u7ae0\u8282\uff0c\u90fd\u662f\u57fa\u4e8e\u4e0a\u4e00\u8282\u7684\u5de5\u7a0b\u6765\u5b8c\u6210\uff0c\u540e\u7eed\u4e0d\u518d\u91cd\u590d\u8bf4\u660e\u3002\n> \n> \u5b8c\u6574\u6e90\u7801\u5730\u5740\uff1a[https://github.com/icarusion/vue-component-book](https://github.com/icarusion/vue-component-book)\n\n\u5728\u76ee\u5f55 `src` \u4e0b\u65b0\u5efa\u6587\u4ef6\u5939 `utils` \u7528\u6765\u653e\u7f6e\u5de5\u5177\u51fd\u6570\uff0c\u5e76\u65b0\u5efa\u6587\u4ef6 `assist.js`\uff0c\u672c\u8282\u6240\u6709\u51fd\u6570\u90fd\u5728\u8fd9\u4e2a\u6587\u4ef6\u91cc\u5b8c\u6210\uff0c\u6bcf\u4e2a\u51fd\u6570\u90fd\u901a\u8fc7 `export` \u5bf9\u5916\u63d0\u4f9b\uff08\u5982\u679c\u4f60\u4e0d\u4e86\u89e3 export\uff0c\u8bf7\u67e5\u770b\u6269\u5c55\u9605\u8bfb1\uff09\u3002\n\n### \u5411\u4e0a\u627e\u5230\u6700\u8fd1\u7684\u6307\u5b9a\u7ec4\u4ef6\u2014\u2014findComponentUpward\n\n\u5148\u770b\u4ee3\u7801\uff1a\n\n```\n// assist.js\n// \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0a\u627e\u5230\u6700\u8fd1\u7684\u6307\u5b9a\u7ec4\u4ef6\nfunction findComponentUpward (context, componentName) {\n  let parent = context.$parent;\n  let name = parent.$options.name;\n\n  while (parent && (!name || [componentName].indexOf(name) < 0)) {\n    parent = parent.$parent;\n    if (parent) name = parent.$options.name;\n  }\n  return parent;\n}\nexport { findComponentUpward };\n\n```\n\nfindComponentUpward \u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u5f53\u524d\u4e0a\u4e0b\u6587\uff0c\u6bd4\u5982\u4f60\u8981\u57fa\u4e8e\u54ea\u4e2a\u7ec4\u4ef6\u6765\u5411\u4e0a\u5bfb\u627e\uff0c\u4e00\u822c\u90fd\u662f\u57fa\u4e8e\u5f53\u524d\u7684\u7ec4\u4ef6\uff0c\u4e5f\u5c31\u662f\u4f20\u5165 `this`\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8981\u627e\u7684\u7ec4\u4ef6\u7684 `name` \u3002\n\nfindComponentUpward \u65b9\u6cd5\u4f1a\u5728 while \u8bed\u53e5\u91cc\u4e0d\u65ad\u5411\u4e0a\u8986\u76d6\u5f53\u524d\u7684 `parent` \u5bf9\u8c61\uff0c\u901a\u8fc7\u5224\u65ad\u7ec4\u4ef6\uff08\u5373 parent\uff09\u7684 name \u4e0e\u4f20\u5165\u7684 componentName \u662f\u5426\u4e00\u81f4\uff0c\u76f4\u5230\u76f4\u5230\u6700\u8fd1\u7684\u4e00\u4e2a\u7ec4\u4ef6\u4e3a\u6b62\u3002\n\n\u4e0e dispatch \u4e0d\u540c\u7684\u662f\uff0cfindComponentUpward \u662f\u76f4\u63a5\u62ff\u5230\u7ec4\u4ef6\u7684\u5b9e\u4f8b\uff0c\u800c\u975e\u901a\u8fc7\u4e8b\u4ef6\u901a\u77e5\u7ec4\u4ef6\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u793a\u4f8b\uff0c\u6709\u7ec4\u4ef6 A \u548c\u7ec4\u4ef6 B\uff0cA \u662f B \u7684\u7236\u7ec4\u4ef6\uff0c\u5728 B \u4e2d\u83b7\u53d6\u548c\u8c03\u7528 A \u4e2d\u7684\u6570\u636e\u548c\u65b9\u6cd5\uff1a\n\n```\n<!-- component-a.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 A\n    <component-b></component-b>\n  </div>\n</template>\n<script>\n  import componentB from './component-b.vue';\n\n  export default {\n    name: 'componentA',\n    components: { componentB },\n    data () {\n      return {\n        name: 'Aresn'\n      }\n    },\n    methods: {\n      sayHello () {\n        console.log('Hello, Vue.js');\n      }\n    }\n  }\n</script>\n\n```\n\n```\n<!-- component-b.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 B\n  </div>\n</template>\n<script>\n  import { findComponentUpward } from '../utils/assist.js';\n\n  export default {\n    name: 'componentB',\n    mounted () {\n      const comA = findComponentUpward(this, 'componentA');\n      \n      if (comA) {\n        console.log(comA.name);  // Aresn\n        comA.sayHello();  // Hello, Vue.js\n      }\n    }\n  }\n</script>\n\n```\n\n\u4f7f\u7528\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u5728\u9700\u8981\u7684\u5730\u65b9\u8c03\u7528 findComponentUpward \u65b9\u6cd5\u5c31\u884c\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e00\u822c\u90fd\u662f\u4f20\u5165 this\uff0c\u5373\u5f53\u524d\u7ec4\u4ef6\u7684\u4e0a\u4e0b\u6587\uff08\u5b9e\u4f8b\uff09\u3002\n\n\u4e0a\u4f8b\u7684 comA\uff0c\u4fdd\u9669\u8d77\u89c1\uff0c\u52a0\u4e86\u4e00\u5c42 `if (comA)` \u6765\u5224\u65ad\u662f\u5426\u627e\u5230\u4e86\u7ec4\u4ef6 A\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u7684\u7ec4\u4ef6\u800c\u8c03\u7528\u7684\u8bdd\uff0c\u662f\u4f1a\u62a5\u9519\u7684\u3002\n\nfindComponentUpward \u53ea\u4f1a\u627e\u5230\u6700\u8fd1\u7684\u4e00\u4e2a\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u5982\u679c\u8981\u627e\u5230\u5168\u90e8\u7b26\u5408\u8981\u6c42\u7684\u7ec4\u4ef6\uff0c\u5c31\u9700\u8981\u7528\u5230\u4e0b\u9762\u7684\u8fd9\u4e2a\u65b9\u6cd5\u3002\n\n### \u5411\u4e0a\u627e\u5230\u6240\u6709\u7684\u6307\u5b9a\u7ec4\u4ef6\u2014\u2014findComponentsUpward\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// assist.js\n// \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0a\u627e\u5230\u6240\u6709\u7684\u6307\u5b9a\u7ec4\u4ef6\nfunction findComponentsUpward (context, componentName) {\n  let parents = [];\n  const parent = context.$parent;\n\n  if (parent) {\n    if (parent.$options.name === componentName) parents.push(parent);\n    return parents.concat(findComponentsUpward(parent, componentName));\n  } else {\n    return [];\n  }\n}\nexport { findComponentsUpward };\n\n```\n\n\u4e0e findComponentUpward \u4e0d\u540c\u7684\u662f\uff0cfindComponentsUpward \u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u5305\u542b\u4e86\u6240\u6709\u627e\u5230\u7684\u7ec4\u4ef6\u5b9e\u4f8b\uff08\u6ce8\u610f\u51fd\u6570\u540d\u79f0\u4e2d\u591a\u4e86\u4e00\u4e2a\u201cs\u201d\uff09\u3002\n\nfindComponentsUpward \u7684\u4f7f\u7528\u573a\u666f\u8f83\u5c11\uff0c\u4e00\u822c\u53ea\u7528\u5728\u9012\u5f52\u7ec4\u4ef6\u91cc\u9762\uff08\u540e\u9762\u5c0f\u8282\u4f1a\u4ecb\u7ecd\uff09\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u51fd\u6570\u662f\u4e00\u76f4\u5411\u4e0a\u5bfb\u627e\u7236\u7ea7\uff08parent\uff09\u7684\uff0c\u53ea\u6709\u9012\u5f52\u7ec4\u4ef6\u7684\u7236\u7ea7\u624d\u662f\u81ea\u8eab\u3002\u4e8b\u5b9e\u4e0a\uff0ciView \u5728\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u90fd\u662f\u7528\u5728\u9012\u5f52\u7ec4\u4ef6\u7684\u573a\u666f\uff0c\u6bd4\u5982\u83dc\u5355\u7ec4\u4ef6 Menu\u3002\u7531\u4e8e\u9012\u5f52\u7ec4\u4ef6\u5728 Vue.js \u7ec4\u4ef6\u91cc\u9762\u5e76\u4e0d\u5e38\u7528\uff0c\u90a3\u81ea\u7136 findComponentsUpward \u4e5f\u4e0d\u5e38\u7528\u4e86\u3002\n\n### \u5411\u4e0b\u627e\u5230\u6700\u8fd1\u7684\u6307\u5b9a\u7ec4\u4ef6\u2014\u2014findComponentDownward\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// assist.js\n// \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0b\u627e\u5230\u6700\u8fd1\u7684\u6307\u5b9a\u7ec4\u4ef6\nfunction findComponentDownward (context, componentName) {\n  const childrens = context.$children;\n  let children = null;\n\n  if (childrens.length) {\n    for (const child of childrens) {\n      const name = child.$options.name;\n\n      if (name === componentName) {\n        children = child;\n        break;\n      } else {\n        children = findComponentDownward(child, componentName);\n        if (children) break;\n      }\n    }\n  }\n  return children;\n}\nexport { findComponentDownward };\n\n```\n\n`context.$children` \u5f97\u5230\u7684\u662f\u5f53\u524d\u7ec4\u4ef6\u7684\u5168\u90e8\u5b50\u7ec4\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u904d\u5386\u4e00\u904d\uff0c\u627e\u5230\u6709\u6ca1\u6709\u5339\u914d\u5230\u7684\u7ec4\u4ef6 `name`\uff0c\u5982\u679c\u6ca1\u627e\u5230\uff0c\u7ee7\u7eed\u9012\u5f52\u627e\u6bcf\u4e2a $children \u7684 $children\uff0c\u76f4\u5230\u627e\u5230\u6700\u8fd1\u7684\u4e00\u4e2a\u4e3a\u6b62\u3002\n\n\u6765\u770b\u4e2a\u793a\u4f8b\uff0c\u4ecd\u7136\u662f A\u3001B \u4e24\u4e2a\u7ec4\u4ef6\uff0cA \u662f B \u7684\u7236\u7ec4\u4ef6\uff0c\u5728 A \u4e2d\u627e\u5230 B\uff1a\n\n```\n<!-- component-b.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 B\n  </div>\n</template>\n<script>\n  export default {\n    name: 'componentB',\n    data () {\n      return {\n        name: 'Aresn'\n      }\n    },\n    methods: {\n      sayHello () {\n        console.log('Hello, Vue.js');\n      }\n    }\n  }\n</script>\n\n```\n\n```\n<!-- component-a.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 A\n    <component-b></component-b>\n  </div>\n</template>\n<script>\n  import componentB from './component-b.vue';\n  import { findComponentDownward } from '../utils/assist.js';\n\n  export default {\n    name: 'componentA',\n    components: { componentB },\n    mounted () {\n      const comB = findComponentDownward(this, 'componentB');\n      if (comB) {\n        console.log(comB.name);  // Aresn\n        comB.sayHello();  // Hello, Vue.js\n      }\n    }\n  }\n</script>\n\n```\n\n\u793a\u4f8b\u4e2d\u7684 A \u548c B \u662f\u7236\u5b50\u5173\u7cfb\uff0c\u56e0\u6b64\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528 `ref` \u6765\u8bbf\u95ee\uff0c\u4f46\u5982\u679c\u4e0d\u662f\u7236\u5b50\u5173\u7cfb\uff0c\u4e2d\u95f4\u95f4\u9694\u591a\u4ee3\uff0c\u7528\u5b83\u5c31\u5f88\u65b9\u4fbf\u4e86\u3002\n\n### \u5411\u4e0b\u627e\u5230\u6240\u6709\u6307\u5b9a\u7684\u7ec4\u4ef6\u2014\u2014findComponentsDownward\n\n\u5982\u679c\u8981\u5411\u4e0b\u627e\u5230\u6240\u6709\u7684\u6307\u5b9a\u7ec4\u4ef6\uff0c\u8981\u7528\u5230 findComponentsDownward \u51fd\u6570\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// assist.js\n// \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u5411\u4e0b\u627e\u5230\u6240\u6709\u6307\u5b9a\u7684\u7ec4\u4ef6\nfunction findComponentsDownward (context, componentName) {\n  return context.$children.reduce((components, child) => {\n    if (child.$options.name === componentName) components.push(child);\n    const foundChilds = findComponentsDownward(child, componentName);\n    return components.concat(foundChilds);\n  }, []);\n}\nexport { findComponentsDownward };\n\n```\n\n\u8fd9\u4e2a\u51fd\u6570\u5b9e\u73b0\u7684\u65b9\u5f0f\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u5de7\u5999\u4f7f\u7528 `reduce` \u505a\u7d2f\u52a0\u5668\uff0c\u5e76\u7528\u9012\u5f52\u5c06\u627e\u5230\u7684\u7ec4\u4ef6\u5408\u5e76\u4e3a\u4e00\u4e2a\u6570\u7ec4\u5e76\u8fd4\u56de\uff0c\u4ee3\u7801\u91cf\u8f83\u5c11\uff0c\u4f46\u7406\u89e3\u8d77\u6765\u7a0d\u56f0\u96be\u3002\n\n\u7528\u6cd5\u4e0e findComponentDownward \u5927\u540c\u5c0f\u5f02\uff0c\u5c31\u4e0d\u518d\u5199\u7528\u4f8b\u4e86\u3002\n\n### \u627e\u5230\u6307\u5b9a\u7ec4\u4ef6\u7684\u5144\u5f1f\u7ec4\u4ef6\u2014\u2014findBrothersComponents\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n// assist.js\n// \u7531\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u627e\u5230\u6307\u5b9a\u7ec4\u4ef6\u7684\u5144\u5f1f\u7ec4\u4ef6\nfunction findBrothersComponents (context, componentName, exceptMe = true) {\n  let res = context.$parent.$children.filter(item => {\n    return item.$options.name === componentName;\n  });\n  let index = res.findIndex(item => item._uid === context._uid);\n  if (exceptMe) res.splice(index, 1);\n  return res;\n}\nexport { findBrothersComponents };\n\n```\n\n\u76f8\u6bd4\u5176\u5b83 4 \u4e2a\u51fd\u6570\uff0cfindBrothersComponents \u591a\u4e86\u4e00\u4e2a\u53c2\u6570 `exceptMe`\uff0c\u662f\u5426\u628a\u672c\u8eab\u9664\u5916\uff0c\u9ed8\u8ba4\u662f true\u3002\u5bfb\u627e\u5144\u5f1f\u7ec4\u4ef6\u7684\u65b9\u6cd5\uff0c\u662f\u5148\u83b7\u53d6 `context.$parent.$children`\uff0c\u4e5f\u5c31\u662f\u7236\u7ec4\u4ef6\u7684\u5168\u90e8\u5b50\u7ec4\u4ef6\uff0c\u8fd9\u91cc\u9762\u5f53\u524d\u5305\u542b\u4e86\u672c\u8eab\uff0c\u6240\u6709\u4e5f\u4f1a\u6709\u7b2c\u4e09\u4e2a\u53c2\u6570 exceptMe\u3002Vue.js \u5728\u6e32\u67d3\u7ec4\u4ef6\u65f6\uff0c\u90fd\u4f1a\u7ed9\u6bcf\u4e2a\u7ec4\u4ef6\u52a0\u4e00\u4e2a\u5185\u7f6e\u7684\u5c5e\u6027 `_uid`\uff0c\u8fd9\u4e2a \\_uid \u662f\u4e0d\u4f1a\u91cd\u590d\u7684\uff0c\u501f\u6b64\u6211\u4eec\u53ef\u4ee5\u4ece\u4e00\u7cfb\u5217\u5144\u5f1f\u7ec4\u4ef6\u4e2d\u628a\u81ea\u5df1\u6392\u9664\u6389\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u7ec4\u4ef6 A \u662f\u7ec4\u4ef6 B \u7684\u7236\u7ea7\uff0c\u5728 B \u4e2d\u627e\u5230\u6240\u6709\u5728 A \u4e2d\u7684\u5144\u5f1f\u7ec4\u4ef6\uff08\u4e5f\u5c31\u662f\u6240\u6709\u5728 A \u4e2d\u7684 B \u7ec4\u4ef6\uff09\uff1a\n\n```\n<!-- component-a.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 A\n    <component-b></component-b>\n  </div>\n</template>\n<script>\n  import componentB from './component-b.vue';\n  \n  export default {\n    name: 'componentA',\n    components: { componentB }\n  }\n</script>\n\n```\n\n```\n<!-- component-b.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 B\n  </div>\n</template>\n<script>\n  import { findBrothersComponents } from '../utils/assist.js';\n  \n  export default {\n    name: 'componentB',\n    mounted () {\n      const comsB = findBrothersComponents(this, 'componentB');\n      console.log(comsB);  // \u2460 []\uff0c\u7a7a\u6570\u7ec4\n    }\n  }\n</script>\n\n```\n\n\u5728 \u2460 \u7684\u4f4d\u7f6e\uff0c\u6253\u5370\u51fa\u7684\u5185\u5bb9\u4e3a\u7a7a\u6570\u7ec4\uff0c\u539f\u56e0\u662f\u5f53\u524d A \u4e2d\u53ea\u6709\u4e00\u4e2a B\uff0c\u800c findBrothersComponents \u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u9ed8\u8ba4\u662f true\uff0c\u4e5f\u5c31\u662f\u5c06\u81ea\u5df1\u9664\u5916\u3002\u5982\u679c\u5728 A \u4e2d\u518d\u5199\u4e00\u4e2a B\uff1a\n\n```\n<!-- component-a.vue -->\n<template>\n  <div>\n    \u7ec4\u4ef6 A\n    <component-b></component-b>\n    <component-b></component-b>\n  </div>\n</template>\n\n```\n\n\u8fd9\u65f6\u5c31\u4f1a\u6253\u5370\u51fa `[VueComponent]`\uff0c\u6709\u4e00\u4e2a\u7ec4\u4ef6\u4e86\uff0c\u4f46\u8981\u6ce8\u610f\u5728\u63a7\u5236\u53f0\u4f1a\u6253\u5370\u4e24\u904d\uff0c\u56e0\u4e3a\u5728 A \u4e2d\u5199\u4e86\u4e24\u4e2a B\uff0c\u800c `console.log` \u662f\u5728 B \u4e2d\u5b9a\u4e49\u7684\uff0c\u6240\u4ee5\u4e24\u4e2a\u90fd\u4f1a\u6267\u884c\u5230\u3002\u5982\u679c\u4f60\u770b\u61c2\u4e86\u8fd9\u91cc\uff0c\u90a3\u5e94\u8be5\u660e\u767d\u6253\u5370\u7684\u4e24\u904d `[VueComponent]`\uff0c\u5206\u522b\u662f\u53e6\u4e00\u4e2a `<component-b>`\uff08\u5982\u679c\u6ca1\u6709\u641e\u61c2\uff0c\u8981\u4ed4\u7ec6\u7422\u78e8\u7422\u78e8\u54e6\uff09\u3002\n\n\u5982\u679c\u5c06 B \u4e2d findBrothersComponents \u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff1a\n\n```\n// component-b.vue\nexport default {\n  name: 'componentB',\n  mounted () {\n    const comsB = findBrothersComponents(this, 'componentB', false);\n    console.log(comsB);\n  }\n}\n\n```\n\n\u6b64\u65f6\u5c31\u4f1a\u6253\u5370\u51fa `[VueComponent, VueComponent]`\uff0c\u4e5f\u5c31\u662f\u5305\u542b\u81ea\u8eab\u4e86\u3002\n\n\u4ee5\u4e0a\u5c31\u662f 5 \u4e2a\u51fd\u6570\u7684\u8be6\u7ec6\u4ecb\u7ecd\uff0cget \u5230\u8fd9 5 \u4e2a\uff0c\u4ee5\u540e\u5c31\u518d\u4e5f\u4e0d\u7528\u62c5\u5fc3\u7ec4\u4ef6\u901a\u4fe1\u4e86\u3002\n\n## \u7ed3\u8bed\n\n\u53ea\u6709\u4f60\u8ba4\u771f\u5f00\u53d1\u8fc7 Vue.js \u72ec\u7acb\u7ec4\u4ef6\uff0c\u624d\u4f1a\u660e\u767d\u8fd9 5 \u4e2a\u51fd\u6570\u7684\u5f3a\u5927\u4e4b\u5904\u3002\n\n## \u6269\u5c55\u9605\u8bfb\n\n*   [ES6 Module \u7684\u8bed\u6cd5](http://es6.ruanyifeng.com/#docs/module)\n\n\u6ce8\uff1a\u672c\u8282\u90e8\u5206\u4ee3\u7801\u53c2\u8003 [iView](https://github.com/iview/iview/blob/2.0/src/utils/assist.js)\u3002", "md_File": "subject/Vue.js \u7ec4\u4ef6\u7cbe\u8bb2/\u7ec4\u4ef6\u7684\u901a\u4fe1_3\u627e\u5230\u4efb\u610f\u7ec4\u4ef6\u5b9e\u4f8bfindComponents_\u7cfb\u5217\u65b9\u6cd5.md", "create_date": "2020-02-18T21:37:09.344", "order": 6}}, {"model": "subject.chapter", "pk": 117, "fields": {"title": "\u672c\u5c0f\u518c\u6240\u5b9e\u73b0\u7684 API \u529f\u80fd", "topic": 6, "md5": "58f949ec9054c374e1f6c06c4f456922", "md_body": "# \u672c\u5c0f\u518c\u6240\u5b9e\u73b0\u7684 API \u529f\u80fd\r\n\r\n## \u672c\u5c0f\u518c\u6240\u5b9e\u73b0\u7684\u529f\u80fd\r\n\r\n\u672c\u5c0f\u518c\u901a\u8fc7\u5b9e\u73b0\u4e00\u4e2a\u8d26\u53f7\u7cfb\u7edf\uff0c\u6765\u6f14\u793a\u5982\u4f55\u6784\u5efa\u4e00\u4e2a\u771f\u5b9e\u7684 API \u670d\u52a1\u5668\uff0c\u6784\u5efa\u65b9\u6cd5\u548c\u6280\u672f\u662f\u7b14\u8005\u6839\u636e\u591a\u5e74\u7684\u5927\u578b API \u670d\u52a1\u5668\u5f00\u53d1\u7ecf\u9a8c\u4e0d\u65ad\u4f18\u5316\u6c89\u6dc0\u800c\u6210\u3002\u901a\u8fc7\u5b9e\u6218\u5c55\u793a\u4e86 API \u6784\u5efa\u8fc7\u7a0b\u4e2d\u5404\u4e2a\u6d41\u7a0b\uff08\u51c6\u5907 -> \u8bbe\u8ba1 -> \u5f00\u53d1 -> \u6d4b\u8bd5 -> \u90e8\u7f72\uff09\u7684\u5b9e\u73b0\u65b9\u6cd5\uff0c\u5c0f\u518c\u6db5\u76d6\u7684\u5185\u5bb9\u5982\u4e0b\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff09\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/7/163d80b52d60ef11?w=1938&h=1292&f=png&s=202203)\r\n\r\n\u8be6\u7ec6\u4e3a\uff1a\r\n\r\n+ \u51c6\u5907\u9636\u6bb5\r\n\t+ \u5982\u4f55\u5b89\u88c5\u548c\u914d\u7f6e Go \u5f00\u53d1\u73af\u5883\r\n\t+ \u5982\u4f55\u5b89\u88c5\u548c\u914d\u7f6e Vim IDE\r\n+ \u8bbe\u8ba1\u9636\u6bb5\r\n\t+ API \u6784\u5efa\u6280\u672f\u9009\u578b\r\n\t+ API \u57fa\u672c\u539f\u7406\r\n\t+ API \u89c4\u8303\u8bbe\u8ba1\r\n+ \u5f00\u53d1\u9636\u6bb5\r\n\t+ \u5982\u4f55\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\r\n\t+ \u5982\u4f55\u7ba1\u7406\u548c\u8bb0\u5f55\u65e5\u5fd7\r\n\t+ \u5982\u4f55\u505a\u6570\u636e\u5e93\u7684 CURD \u64cd\u4f5c\r\n\t+ \u5982\u4f55\u81ea\u5b9a\u4e49\u9519\u8bef Code\r\n\t+ \u5982\u4f55\u8bfb\u53d6\u548c\u8fd4\u56de HTTP \u8bf7\u6c42\r\n\t+ \u5982\u4f55\u8fdb\u884c\u4e1a\u52a1\u903b\u8f91\u5f00\u53d1\r\n\t+ \u5982\u4f55\u5bf9\u8bf7\u6c42\u63d2\u5165\u81ea\u5df1\u7684\u5904\u7406\u903b\u8f91\r\n\t+ \u5982\u4f55\u8fdb\u884c API \u8eab\u4efd\u9a8c\u8bc1\r\n\t+ \u5982\u4f55\u8fdb\u884c HTTPS \u52a0\u5bc6\r\n\t+ \u5982\u4f55\u7528 Makefile \u7ba1\u7406 API \u6e90\u7801\r\n\t+ \u5982\u4f55\u7ed9 API \u547d\u4ee4\u6dfb\u52a0\u7248\u672c\u529f\u80fd\r\n\t+ \u5982\u4f55\u7ba1\u7406 API \u547d\u4ee4\r\n\t+ \u5982\u4f55\u751f\u6210 Swagger \u5728\u7ebf\u6587\u6863\r\n+ \u6d4b\u8bd5\u9636\u6bb5\r\n\t+ \u5982\u4f55\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\r\n\t+ \u5982\u4f55\u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\uff08\u51fd\u6570\u6027\u80fd\uff09\r\n\t+ \u5982\u4f55\u505a\u6027\u80fd\u5206\u6790\r\n\t+ API \u6027\u80fd\u6d4b\u8bd5\u548c\u8c03\u4f18\r\n+ \u90e8\u7f72\u9636\u6bb5\r\n\t+ \u5982\u4f55\u7528 Nginx \u90e8\u7f72 API \u670d\u52a1\r\n\t+ \u5982\u4f55\u505a API \u9ad8\u53ef\u7528\r\n\r\n\u901a\u8fc7\u4ee5\u4e0a\u5404\u529f\u80fd\u7684\u4ecb\u7ecd\uff0c\u8bfb\u8005\u53ef\u4ee5\u5b8c\u6574\u3001\u7cfb\u7edf\u5730\u5b66\u4e60 API \u6784\u5efa\u65b9\u6cd5\u548c\u6280\u5de7\uff0c\u7b14\u8005\u4e5f\u4f1a\u5728\u6587\u7ae0\u4e2d\u878d\u5165\u81ea\u5df1\u7684\u5f00\u53d1\u7ecf\u9a8c\u4ee5\u4f9b\u8bfb\u8005\u53c2\u8003\u3002\r\n\r\n## \u8d26\u53f7\u7cfb\u7edf\u4e1a\u52a1\u529f\u80fd\r\n\r\n\u672c\u5c0f\u518c\u4e3a\u4e86\u6f14\u793a\uff0c\u6784\u5efa\u4e86\u4e00\u4e2a\u8d26\u53f7\u7cfb\u7edf\uff08\u540e\u9762\u7edf\u79f0\u4e3a`apiserver`\uff09\uff0c\u529f\u80fd\u5982\u4e0b\uff1a\r\n\r\n+ API \u670d\u52a1\u5668\u72b6\u6001\u68c0\u67e5\r\n+ \u767b\u5f55\u7528\u6237\r\n+ \u65b0\u589e\u7528\u6237\r\n+ \u5220\u9664\u7528\u6237\r\n+ \u66f4\u65b0\u7528\u6237\r\n+ \u83b7\u53d6\u6307\u5b9a\u7528\u6237\u7684\u8be6\u7ec6\u4fe1\u606f\r\n+ \u83b7\u53d6\u7528\u6237\u5217\u8868\r\n\r\n## \u672c\u5c0f\u518c\u6267\u884c\u73af\u5883\r\n\r\n\u672c\u5c0f\u518c\u6240\u6709\u7684\u8f6f\u4ef6\u5b89\u88c5\uff0c\u8fd0\u884c\u5747\u662f\u5728 CentOS 7.1 \u7cfb\u7edf\u4e0a\u6267\u884c\u7684\u3002\r\n\r\n\u7406\u8bba\u4e0a\u672c\u5c0f\u518c\u6240\u6784\u5efa\u7684 API \u53ef\u4ee5\u5728\u6240\u6709\u7684 Unix/Linux \u7cfb\u7edf\u4e0a\u7f16\u8bd1\u548c\u8fd0\u884c\uff0c\u5c0f\u518c\u4e2d\u7684\u8f6f\u4ef6\u5b89\u88c5\u7528\u7684\u662f `yum` \u5de5\u5177\uff0c\u5c0f\u518c\u4e2d\u6240\u5217\u4e3e\u7684 yum \u8f6f\u4ef6\u7406\u8bba\u4e0a\u53ef\u4ee5\u5728 CentOS 6 \u548c CentOS 7 \u4e0a\u76f4\u63a5\u6267\u884c `yum` \u547d\u4ee4\u5b89\u88c5\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u4ecb\u7ecd\u4e86\u5c0f\u518c\u6240\u8981\u5b9e\u73b0\u7684 API \u529f\u80fd\uff0c\u4ee5\u53ca API \u7cfb\u7edf\u7684\u4e1a\u52a1\u529f\u80fd\uff0c\u8ba9\u8bfb\u8005\u5728\u5b9e\u6218\u524d\u5bf9\u5c0f\u518c\u6240\u8981\u6784\u5efa\u7684\u7cfb\u7edf\u6709\u4e2a\u6574\u4f53\u4e86\u89e3\uff0c\u4ee5\u4fbf\u4e8e\u63a5\u4e0b\u6765\u7684\u5b66\u4e60\u3002\u5c0f\u518c\u6bcf\u4e00\u8282\u90fd\u4f1a\u63d0\u4f9b\u6e90\u7801\uff0c\u4f9b\u8bfb\u8005\u5b66\u4e60\u53c2\u8003\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/0\u672c\u5c0f\u518c\u6240\u5b9e\u73b0\u7684_API_\u529f\u80fd.md", "create_date": "2020-02-18T21:37:38.101", "order": 1}}, {"model": "subject.chapter", "pk": 118, "fields": {"title": "RESTful API \u4ecb\u7ecd", "topic": 6, "md5": "70399ee3212e773cbdc708727290475a", "md_body": "# RESTful API \u4ecb\u7ecd\r\n\r\n## \u4ec0\u4e48\u662f API\r\n\r\nAPI\uff08Application Programming Interface\uff0c\u5e94\u7528\u7a0b\u5e8f\u7f16\u7a0b\u63a5\u53e3\uff09\u662f\u4e00\u4e9b\u9884\u5148\u5b9a\u4e49\u7684\u51fd\u6570\u6216\u8005\u63a5\u53e3\uff0c\u76ee\u7684\u662f\u63d0\u4f9b\u5e94\u7528\u7a0b\u5e8f\u4e0e\u5f00\u53d1\u4eba\u5458\u57fa\u4e8e\u67d0\u8f6f\u4ef6\u6216\u786c\u4ef6\u5f97\u4ee5\u8bbf\u95ee\u4e00\u7ec4\u4f8b\u7a0b\u7684\u80fd\u529b\uff0c\u800c\u53c8\u65e0\u987b\u8bbf\u95ee\u6e90\u7801\uff0c\u6216\u7406\u89e3\u5185\u90e8\u5de5\u4f5c\u673a\u5236\u7684\u7ec6\u8282\u3002\r\n\r\n\u8981\u5b9e\u73b0\u4e00\u4e2a API \u670d\u52a1\u5668\uff0c\u9996\u5148\u8981\u8003\u8651\u4e24\u4e2a\u65b9\u9762\uff1aAPI \u98ce\u683c\u548c\u5a92\u4f53\u7c7b\u578b\u3002Go \u8bed\u8a00\u4e2d\u5e38\u7528\u7684 API \u98ce\u683c\u662f RPC \u548c REST\uff0c\u5e38\u7528\u7684\u5a92\u4f53\u7c7b\u578b\u662f JSON\u3001XML \u548c Protobuf\u3002\u5728 Go API \u5f00\u53d1\u4e2d\u5e38\u7528\u7684\u7ec4\u5408\u662f gRPC + Protobuf \u548c REST + JSON\u3002\r\n\r\n## REST \u7b80\u4ecb\r\n\r\nREST \u4ee3\u8868\u8868\u73b0\u5c42\u72b6\u6001\u8f6c\u79fb\uff08REpresentational State Transfer\uff09\uff0c\u7531 Roy Fielding \u5728\u4ed6\u7684 [\u8bba\u6587](https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm) \u4e2d\u63d0\u51fa\u3002REST \u662f\u4e00\u79cd\u8f6f\u4ef6\u67b6\u6784\u98ce\u683c\uff0c\u4e0d\u662f\u6280\u672f\u6846\u67b6\uff0cREST \u6709\u4e00\u7cfb\u5217\u89c4\u8303\uff0c\u6ee1\u8db3\u8fd9\u4e9b\u89c4\u8303\u7684 API \u5747\u53ef\u79f0\u4e3a RESTful API\u3002REST \u89c4\u8303\u4e2d\u6709\u5982\u4e0b\u51e0\u4e2a\u6838\u5fc3\uff1a\r\n\r\n1. REST \u4e2d\u4e00\u5207\u5b9e\u4f53\u90fd\u88ab\u62bd\u8c61\u6210\u8d44\u6e90\uff0c\u6bcf\u4e2a\u8d44\u6e90\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6 \u2014\u2014 URI\uff0c\u6240\u6709\u7684\u884c\u4e3a\u90fd\u5e94\u8be5\u662f\u5728\u8d44\u6e90\u4e0a\u7684 CRUD \u64cd\u4f5c\r\n2. \u4f7f\u7528\u6807\u51c6\u7684\u65b9\u6cd5\u6765\u66f4\u6539\u8d44\u6e90\u7684\u72b6\u6001\uff0c\u5e38\u89c1\u7684\u64cd\u4f5c\u6709\uff1a\u8d44\u6e90\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\r\n3. \u65e0\u72b6\u6001\uff1a\u8fd9\u91cc\u7684\u65e0\u72b6\u6001\u662f\u6307\u6bcf\u4e2a RESTful API \u8bf7\u6c42\u90fd\u5305\u542b\u4e86\u6240\u6709\u8db3\u591f\u5b8c\u6210\u672c\u6b21\u64cd\u4f5c\u7684\u4fe1\u606f\uff0c\u670d\u52a1\u5668\u7aef\u65e0\u987b\u4fdd\u6301 Session\r\n\r\n> \u65e0\u72b6\u6001\u5bf9\u4e8e\u670d\u52a1\u7aef\u7684\u5f39\u6027\u6269\u5bb9\u662f\u5f88\u91cd\u8981\u7684\u3002\r\n\r\n\r\nREST \u98ce\u683c\u867d\u7136\u9002\u7528\u4e8e\u5f88\u591a\u4f20\u8f93\u534f\u8bae\uff0c\u4f46\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0cREST \u7531\u4e8e\u5929\u751f\u548c HTTP \u534f\u8bae\u76f8\u8f85\u76f8\u6210\uff0c\u56e0\u6b64 HTTP \u534f\u8bae\u5df2\u7ecf\u6210\u4e86\u5b9e\u73b0 RESTful API \u4e8b\u5b9e\u4e0a\u7684\u6807\u51c6\u3002\u5728 HTTP \u534f\u8bae\u4e2d\u901a\u8fc7 POST\u3001DELETE\u3001PUT\u3001GET \u65b9\u6cd5\u6765\u5bf9\u5e94 REST \u8d44\u6e90\u7684\u589e\u3001\u5220\u3001\u6539\u3001\u67e5\u64cd\u4f5c\uff0c\u5177\u4f53\u7684\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a\r\n\r\n| HTTP \u65b9\u6cd5 | \u884c\u4e3a | URI | \u793a\u4f8b\u8bf4\u660e |\r\n|---|---|---| --- |\r\n| GET | \u83b7\u53d6\u8d44\u6e90\u5217\u8868| /users | \u83b7\u53d6\u7528\u6237\u5217\u8868|\r\n| GET | \u83b7\u53d6\u4e00\u4e2a\u5177\u4f53\u7684\u8d44\u6e90 | /users/admin | \u83b7\u53d6 admin \u7528\u6237\u7684\u8be6\u7ec6\u4fe1\u606f |\r\n| POST | \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8d44\u6e90 | /users | \u521b\u5efa\u4e00\u4e2a\u65b0\u7528\u6237 |\r\n| PUT | \u4ee5\u6574\u4f53\u7684\u65b9\u5f0f\u66f4\u65b0\u4e00\u4e2a\u8d44\u6e90 | /users/1 |  \u66f4\u65b0 id \u4e3a 1 \u7684\u7528\u6237 |\r\n| DELETE | \u5220\u9664\u670d\u52a1\u5668\u4e0a\u7684\u4e00\u4e2a\u8d44\u6e90 | /users/1 | \u5220\u9664 id \u4e3a 1 \u7684\u7528\u6237|\r\n\r\n## RPC \u7b80\u4ecb \r\n\r\n\u6839\u636e\u7ef4\u57fa\u767e\u79d1\u7684\u5b9a\u4e49\uff1a\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff08Remote Procedure Call\uff0cRPC\uff09\u662f\u4e00\u4e2a\u8ba1\u7b97\u673a\u901a\u4fe1\u534f\u8bae\u3002\u8be5\u534f\u8bae\u5141\u8bb8\u8fd0\u884c\u4e8e\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u7a0b\u5e8f\u8c03\u7528\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u5b50\u7a0b\u5e8f\uff0c\u800c\u7a0b\u5e8f\u5458\u65e0\u987b\u989d\u5916\u5730\u4e3a\u8fd9\u4e2a\u4ea4\u4e92\u4f5c\u7528\u7f16\u7a0b\u3002\r\n\r\n\u901a\u4fd7\u6765\u8bb2\uff0c\u5c31\u662f\u670d\u52a1\u7aef\u5b9e\u73b0\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u5ba2\u6237\u7aef\u4f7f\u7528 RPC \u6846\u67b6\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u7684\u5b9e\u73b0\uff0c\u5e76\u83b7\u53d6\u8fd4\u56de\u503c\u3002RPC \u5c4f\u853d\u4e86\u5e95\u5c42\u7684\u7f51\u7edc\u901a\u4fe1\u7ec6\u8282\uff0c\u4f7f\u5f97\u5f00\u53d1\u4eba\u5458\u65e0\u987b\u5173\u6ce8\u7f51\u7edc\u7f16\u7a0b\u7684\u7ec6\u8282\uff0c\u800c\u5c06\u66f4\u591a\u7684\u65f6\u95f4\u548c\u7cbe\u529b\u653e\u5728\u4e1a\u52a1\u903b\u8f91\u672c\u8eab\u7684\u5b9e\u73b0\u4e0a\uff0c\u4ece\u800c\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\u3002\r\n\r\nRPC \u7684\u8c03\u7528\u8fc7\u7a0b\u5982\u4e0b\uff08\u56fe\u7247\u6765\u81ea [How RPC Works](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc738291(v=ws.10))\uff09\uff1a\r\n\r\n![\u7f51\u56fe](https://user-gold-cdn.xitu.io/2018/6/17/1640cdbb95ac1a37)\r\n\r\n1. Client \u901a\u8fc7\u672c\u5730\u8c03\u7528\uff0c\u8c03\u7528 Client Stub\r\n2. Client Stub \u5c06\u53c2\u6570\u6253\u5305\uff08\u4e5f\u53eb Marshalling\uff09\u6210\u4e00\u4e2a\u6d88\u606f\uff0c\u7136\u540e\u53d1\u9001\u8fd9\u4e2a\u6d88\u606f\r\n3. Client \u6240\u5728\u7684 OS \u5c06\u6d88\u606f\u53d1\u9001\u7ed9 Server\r\n4. Server \u7aef\u63a5\u6536\u5230\u6d88\u606f\u540e\uff0c\u5c06\u6d88\u606f\u4f20\u9012\u7ed9 Server Stub\r\n5. Server Stub \u5c06\u6d88\u606f\u89e3\u5305\uff08\u4e5f\u53eb Unmarshalling\uff09\u5f97\u5230\u53c2\u6570\r\n6. Server Stub \u8c03\u7528\u670d\u52a1\u7aef\u7684\u5b50\u7a0b\u5e8f\uff08\u51fd\u6570\uff09\uff0c\u5904\u7406\u5b8c\u540e\uff0c\u5c06\u6700\u7ec8\u7ed3\u679c\u6309\u7167\u76f8\u53cd\u7684\u6b65\u9aa4\u8fd4\u56de\u7ed9 Client\r\n\r\n> Stub \u8d1f\u8d23\u8c03\u7528\u53c2\u6570\u548c\u8fd4\u56de\u503c\u7684\u6d41\u5316\uff08serialization\uff09\u3001\u53c2\u6570\u7684\u6253\u5305\u89e3\u5305\uff0c\u4ee5\u53ca\u8d1f\u8d23\u7f51\u7edc\u5c42\u7684\u901a\u4fe1\u3002Client \u7aef\u4e00\u822c\u53eb Stub\uff0cServer \u7aef\u4e00\u822c\u53eb Skeleton\u3002\r\n\r\n## REST vs RPC\r\n\r\n\u5728\u505a API \u670d\u52a1\u5668\u5f00\u53d1\u65f6\uff0c\u5f88\u591a\u4eba\u90fd\u4f1a\u9047\u5230\u8fd9\u4e2a\u95ee\u9898 \u2014\u2014 \u9009\u62e9 REST \u8fd8\u662f RPC\u3002RPC \u76f8\u6bd4 REST \u7684\u4f18\u70b9\u4e3b\u8981\u6709 3 \u70b9\uff1a\r\n1. RPC+Protobuf \u91c7\u7528\u7684\u662f TCP \u505a\u4f20\u8f93\u534f\u8bae\uff0cREST \u76f4\u63a5\u4f7f\u7528 HTTP \u505a\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u8fd9\u79cd\u533a\u522b\u5bfc\u81f4 REST \u5728\u8c03\u7528\u6027\u80fd\u4e0a\u4f1a\u6bd4 RPC+Protobuf \u4f4e\r\n2. RPC \u4e0d\u50cf REST \u90a3\u6837\uff0c\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u90fd\u8981\u62bd\u8c61\u6210\u5bf9\u8d44\u6e90\u7684\u589e\u5220\u6539\u67e5\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6709\u5f88\u591a\u64cd\u4f5c\u5f88\u96be\u62bd\u8c61\u6210\u8d44\u6e90\uff0c\u6bd4\u5982\u767b\u5f55\u64cd\u4f5c\u3002\u6240\u4ee5\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u5e76\u4e0d\u80fd\u4e25\u683c\u6309\u7167 REST \u89c4\u8303\u6765\u5199 API\uff0cRPC \u5c31\u4e0d\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\r\n3. RPC \u5c4f\u853d\u7f51\u7edc\u7ec6\u8282\u3001\u6613\u7528\uff0c\u548c\u672c\u5730\u8c03\u7528\u7c7b\u4f3c\r\n\r\n> \u8fd9\u91cc\u7684\u6613\u7528\u6307\u7684\u662f\u8c03\u7528\u65b9\u5f0f\u4e0a\u7684\u6613\u7528\u6027\u3002\u5728\u505a RPC \u5f00\u53d1\u65f6\uff0c\u5f00\u53d1\u8fc7\u7a0b\u5f88\u70e6\u7410\uff0c\u9700\u8981\u5148\u5199\u4e00\u4e2a DSL \u63cf\u8ff0\u6587\u4ef6\uff0c\u7136\u540e\u7528\u4ee3\u7801\u751f\u6210\u5668\u751f\u6210\u5404\u79cd\u8bed\u8a00\u4ee3\u7801\uff0c\u5f53\u63cf\u8ff0\u6587\u4ef6\u6709\u66f4\u6539\u65f6\uff0c\u5fc5\u987b\u91cd\u65b0\u5b9a\u4e49\u548c\u7f16\u8bd1\uff0c\u7ef4\u62a4\u6027\u5dee\u3002\r\n\r\n\u4f46\u662f REST \u76f8\u8f83 RPC \u4e5f\u6709\u5f88\u591a\u4f18\u52bf\uff1a\r\n\r\n1. \u8f7b\u91cf\u7ea7\uff0c\u7b80\u5355\u6613\u7528\uff0c\u7ef4\u62a4\u6027\u548c\u6269\u5c55\u6027\u90fd\u6bd4\u8f83\u597d\r\n2. REST \u76f8\u5bf9\u66f4\u89c4\u8303\uff0c\u66f4\u6807\u51c6\uff0c\u66f4\u901a\u7528\uff0c\u65e0\u8bba\u54ea\u79cd\u8bed\u8a00\u90fd\u652f\u6301 HTTP \u534f\u8bae\uff0c\u53ef\u4ee5\u5bf9\u63a5\u5916\u90e8\u5f88\u591a\u7cfb\u7edf\uff0c\u53ea\u8981\u6ee1\u8db3 HTTP \u8c03\u7528\u5373\u53ef\uff0c\u66f4\u9002\u5408\u5bf9\u5916\uff0cRPC \u4f1a\u6709\u8bed\u8a00\u9650\u5236\uff0c\u4e0d\u540c\u8bed\u8a00\u7684 RPC \u8c03\u7528\u8d77\u6765\u5f88\u9ebb\u70e6\r\n4. JSON \u683c\u5f0f\u53ef\u8bfb\u6027\u66f4\u5f3a\uff0c\u5f00\u53d1\u8c03\u8bd5\u90fd\u5f88\u65b9\u4fbf\r\n5. \u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e25\u683c\u6309\u7167 REST \u89c4\u8303\u6765\u5199 API\uff0cAPI \u770b\u8d77\u6765\u66f4\u6e05\u6670\uff0c\u66f4\u5bb9\u6613\u88ab\u5927\u5bb6\u7406\u89e3\r\n> \u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e25\u683c\u6309\u7167 REST \u89c4\u8303\u6765\u5199\u5f88\u96be\uff0c\u53ea\u80fd\u5c3d\u53ef\u80fd RESTful \u5316\u3002\r\n\r\n\u5176\u5b9e\u4e1a\u754c\u666e\u904d\u91c7\u7528\u7684\u505a\u6cd5\u662f\uff0c\u5185\u90e8\u7cfb\u7edf\u4e4b\u95f4\u8c03\u7528\u7528 RPC\uff0c\u5bf9\u5916\u7528 REST\uff0c\u56e0\u4e3a\u5185\u90e8\u7cfb\u7edf\u4e4b\u95f4\u53ef\u80fd\u8c03\u7528\u5f88\u9891\u7e41\uff0c\u9700\u8981 RPC \u7684\u9ad8\u6027\u80fd\u652f\u6491\u3002\u5bf9\u5916\u7528 REST \u66f4\u6613\u7406\u89e3\uff0c\u66f4\u901a\u7528\u4e9b\u3002\u5f53\u7136\u4ee5\u73b0\u6709\u7684\u670d\u52a1\u5668\u6027\u80fd\uff0c\u5982\u679c\u4e24\u4e2a\u7cfb\u7edf\u95f4\u8c03\u7528\u4e0d\u662f\u7279\u522b\u9891\u7e41\uff0c\u5bf9\u6027\u80fd\u8981\u6c42\u4e0d\u662f\u975e\u5e38\u9ad8\uff0c\u4ee5\u7b14\u8005\u7684\u5f00\u53d1\u7ecf\u9a8c\u6765\u770b\uff0cREST \u7684\u6027\u80fd\u5b8c\u5168\u53ef\u4ee5\u6ee1\u8db3\u3002\u672c\u5c0f\u518c\u4e0d\u662f\u8ba8\u8bba\u5fae\u670d\u52a1\uff0c\u6240\u4ee5\u4e0d\u5b58\u5728\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u9ad8\u9891\u8c03\u7528\u573a\u666f\uff0c\u6b64\u5916 REST \u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u80fd\u591f\u6ee1\u8db3\u7edd\u5927\u90e8\u5206\u7684\u9700\u6c42\u573a\u666f\uff0c\u6240\u4ee5 RPC \u7684\u6027\u80fd\u4f18\u52bf\u53ef\u4ee5\u5ffd\u7565\uff0c\u76f8\u53cd\u57fa\u4e8e REST \u7684\u5176\u4ed6\u4f18\u52bf\uff0c\u7b14\u8005\u66f4\u503e\u5411\u4e8e\u7528 REST \u6765\u6784\u5efa API \u670d\u52a1\u5668\uff0c\u672c\u5c0f\u518c\u6b63\u662f\u7528 REST \u98ce\u683c\u6765\u6784\u5efa API \u7684\u3002\r\n\r\n## \u5a92\u4f53\u7c7b\u578b\u9009\u62e9\r\n\r\n\u5a92\u4f53\u7c7b\u578b\u662f\u72ec\u7acb\u4e8e\u5e73\u53f0\u7684\u7c7b\u578b\uff0c\u8bbe\u8ba1\u7528\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\u95f4\u7684\u901a\u4fe1\uff0c\u5a92\u4f53\u7c7b\u578b\u7528\u4e8e\u4f20\u9012\u4fe1\u606f\uff0c\u4e00\u4e2a\u6b63\u5f0f\u7684\u89c4\u8303\u5b9a\u4e49\u4e86\u8fd9\u4e9b\u4fe1\u606f\u5e94\u8be5\u5982\u4f55\u8868\u793a\u3002HTTP \u7684 REST \u80fd\u591f\u63d0\u4f9b\u591a\u79cd\u4e0d\u540c\u7684\u54cd\u5e94\u5f62\u5f0f\uff0c\u5e38\u89c1\u7684\u662f XML \u548c JSON\u3002JSON \u65e0\u8bba\u4ece\u5f62\u5f0f\u4e0a\u8fd8\u662f\u4f7f\u7528\u65b9\u6cd5\u4e0a\u90fd\u66f4\u7b80\u5355\u3002\u76f8\u6bd4 XML\uff0cJSON \u7684\u5185\u5bb9\u66f4\u52a0\u7d27\u51d1\uff0c\u6570\u636e\u5c55\u73b0\u5f62\u5f0f\u76f4\u89c2\u6613\u61c2\uff0c\u5f00\u53d1\u6d4b\u8bd5\u90fd\u975e\u5e38\u65b9\u4fbf\uff0c\u6240\u4ee5\u5728\u5a92\u4f53\u7c7b\u578b\u9009\u62e9\u4e0a\uff0c\u9009\u62e9\u4e86 JSON \u683c\u5f0f\uff0c\u8fd9\u4e5f\u662f\u5f88\u591a\u5927\u516c\u53f8\u6240\u91c7\u7528\u7684\u683c\u5f0f\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u4ecb\u7ecd\u4e86\u8f6f\u4ef6\u67b6\u6784\u4e2d API \u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5e76\u7b80\u5355\u4ecb\u7ecd\u4e86\u76f8\u5e94\u7684\u6280\u672f\uff0c\u901a\u8fc7\u5bf9\u6bd4\uff0c\u5f97\u51fa\u672c\u5c0f\u518c\u6240\u91c7\u7528\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1aAPI \u98ce\u683c\u91c7\u7528 REST\uff0c\u5a92\u4f53\u7c7b\u578b\u9009\u62e9 JSON\u3002\u901a\u8fc7\u672c\u5c0f\u8282\u7684\u5b66\u4e60\uff0c\u8bfb\u8005\u53ef\u4ee5\u4e86\u89e3\u5c0f\u518c\u6240\u6784\u5efa API \u670d\u52a1\u5668\u6838\u5fc3\u6280\u672f\u7684\u9009\u578b\u548c\u539f\u56e0\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/1RESTful_API_\u4ecb\u7ecd.md", "create_date": "2020-02-18T21:37:38.118", "order": 2}}, {"model": "subject.chapter", "pk": 119, "fields": {"title": "Go API \u5f00\u53d1\u73af\u5883\u914d\u7f6e", "topic": 6, "md5": "d1d75846d77214e01fb1b25e02a827f8", "md_body": "# Go API \u5f00\u53d1\u73af\u5883\u914d\u7f6e\r\n\r\n## Go \u547d\u4ee4\u5b89\u88c5\r\n\r\nGo \u6709\u591a\u79cd\u5b89\u88c5\u65b9\u5f0f\uff0c\u6bd4\u5982 Go \u6e90\u7801\u5b89\u88c5\u3001Go \u6807\u51c6\u5305\u5b89\u88c5\u3001\u7b2c\u4e09\u65b9\u5de5\u5177\uff08yum\u3001apt-get \u7b49\uff09\u5b89\u88c5\u3002\u672c\u5c0f\u518c API \u8fd0\u884c\u5728 Linux \u670d\u52a1\u5668\u4e0a\uff0c\u9009\u62e9\u901a\u8fc7\u6807\u51c6\u5305\u6765\u5b89\u88c5 Go \u7f16\u8bd1\u73af\u5883\u3002Go \u63d0\u4f9b\u4e86\u6bcf\u4e2a\u5e73\u53f0\u6253\u597d\u5305\u7684\u4e00\u952e\u5b89\u88c5\uff0c\u8fd9\u4e9b\u5305\u9ed8\u8ba4\u4f1a\u5b89\u88c5\u5230\u5982\u4e0b\u76ee\u5f55\uff1a`/usr/local/go`\u3002\u5f53\u7136\u4f60\u53ef\u4ee5\u6539\u53d8\u5b83\u4eec\u7684\u5b89\u88c5\u4f4d\u7f6e\uff0c\u4f46\u662f\u6539\u53d8\u4e4b\u540e\u4f60\u5fc5\u987b\u5728\u4f60\u7684\u73af\u5883\u53d8\u91cf\u4e2d\u8bbe\u7f6e\u5982\u4e0b\u4e24\u4e2a\u73af\u5883\u53d8\u91cf\uff1a\r\n+ GOROOT\uff1aGOROOT \u5c31\u662f Go \u7684\u5b89\u88c5\u8def\u5f84\r\n+ GOPATH\uff1aGOPATH \u662f\u4f5c\u4e3a\u7f16\u8bd1\u540e\u4e8c\u8fdb\u5236\u7684\u5b58\u653e\u76ee\u7684\u5730\u548c import \u5305\u65f6\u7684\u641c\u7d22\u8def\u5f84\r\n\r\n\u5047\u5b9a\u4f60\u60f3\u8981\u5b89\u88c5 Go \u7684\u76ee\u5f55\u4e3a `$GO_INSTALL_DIR`\uff0c\u540e\u9762\u66ff\u6362\u4e3a\u76f8\u5e94\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u5b89\u88c5\u6b65\u9aa4\u5982\u4e0b\u3002\r\n\r\n1. \u4e0b\u8f7d\u5b89\u88c5\u5305\r\n\r\n\u5b89\u88c5\u5305\u4e0b\u8f7d\u5730\u5740\u4e3a [golang.org](https://golang.org/dl/)\uff0c\u5982\u679c\u6253\u4e0d\u5f00\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u5730\u5740\uff1a[golang.google.cn](https://golang.google.cn/dl/)\u3002\r\n\r\nLinux \u7248\u672c\u9009\u62e9 goxxxxx.linux-amd64.tar.gz \u683c\u5f0f\u7684\u5b89\u88c5\u5305\uff0c\u8fd9\u91cc\u5728 Linux \u670d\u52a1\u5668\u4e0a\u76f4\u63a5\u7528 `wget` \u547d\u4ee4\u4e0b\u8f7d\uff1a\r\n\r\n```\r\n$ wget https://dl.google.com/go/go1.10.2.linux-amd64.tar.gz\r\n```\r\n\r\n2. \u8bbe\u7f6e\u5b89\u88c5\u76ee\u5f55 \r\n```\r\n$ export GO_INSTALL_DIR=$HOME\r\n```\r\n> \u8fd9\u91cc\u6211\u4eec\u5b89\u88c5\u5230\u7528\u6237\u4e3b\u76ee\u5f55\u4e0b\u3002\r\n\r\n3. \u89e3\u538b Go \u5b89\u88c5\u5305\r\n\r\n```\r\n$ tar -xvzf go1.10.2.linux-amd64.tar.gz -C $GO_INSTALL_DIR\r\n```\r\n\r\n4. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\r\n\r\n```\r\n$ export GO_INSTALL_DIR=$HOME\r\n$ export GOROOT=$GO_INSTALL_DIR/go\r\n$ export GOPATH=$HOME/mygo\r\n$ export PATH=$GOPATH/bin:$PATH:$GO_INSTALL_DIR/go/bin\r\n```\r\n\u5982\u679c\u4e0d\u60f3\u6bcf\u6b21\u767b\u5f55\u7cfb\u7edf\u90fd\u8bbe\u7f6e\u4e00\u6b21\u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u5c06\u4e0a\u9762 4 \u884c\u8ffd\u52a0\u5230 `$HOME/.bashrc` \u6587\u4ef6\u4e2d\u3002\r\n\r\n5. \u6267\u884c `go version` \u68c0\u67e5 Go \u662f\u5426\u6210\u529f\u5b89\u88c5\r\n\r\n```\r\n$ go version\r\ngo version go1.10.2 linux/amd64\r\n```\r\n\r\n\u770b\u5230 `go version` \u547d\u4ee4\u8f93\u51fa go \u7248\u672c\u53f7 `go1.10.2 linux/amd64`\uff0c\u8bf4\u660e go \u547d\u4ee4\u5b89\u88c5\u6210\u529f\u3002\r\n\r\n6. \u521b\u5efa `$GOPATH/src` \u76ee\u5f55\r\n\r\n`$GOPATH/src` \u662f Go \u6e90\u7801\u5b58\u653e\u7684\u76ee\u5f55\uff0c\u6240\u4ee5\u5728\u6b63\u5f0f\u5f00\u59cb\u7f16\u7801\u524d\u8981\u5148\u786e\u4fdd `$GOPATH/src` \u76ee\u5f55\u5b58\u5728\uff0c\u6267\u884c\u547d\u4ee4\uff1a\r\n\r\n```\r\n$ mkdir -p $GOPATH/src\r\n```\r\n\r\n## Vim \u914d\u7f6e\r\n\r\n\u56e0\u4e3a Vim \u662f Linux \u4e0b\u5f00\u53d1\u7684\u6700\u57fa\u672c\u5de5\u5177\uff0c\u4e3a\u4e86\u901a\u7528\u8fd9\u91cc\u57fa\u4e8e Vim \u6765\u914d\u7f6e\u5f00\u53d1\u73af\u5883\u3002\u5982\u679c\u8981\u914d\u7f6e\u4e00\u4e2a Vim IDE \u6709\u5f88\u591a\u6b65\u9aa4\u9700\u8981\u4e00\u6b65\u4e00\u6b65\u53bb\u505a\uff0c\u7b14\u8005\u8c03\u7814\u4e86\u5f88\u591a Go vim ide \u7684\u914d\u7f6e\u65b9\u6cd5\uff0c\u7f16\u5199\u4e86\u4e00\u4e2a\u5b89\u88c5\u5de5\u5177\uff0c\u8fd9\u91cc\u76f4\u63a5\u7528\u8be5\u5de5\u5177\u6765\u914d\u7f6e\uff0c\u5177\u4f53\u914d\u7f6e\u6b65\u9aa4\u5982\u4e0b\u3002\r\n1. \u4e0b\u8f7d Vim \u914d\u7f6e\u5de5\u5177\r\n\r\n```\r\n$ git clone https://github.com/lexkong/lexVim\r\n```\r\n\r\n2. \u8fdb\u5165 lexVim \u76ee\u5f55\uff0c\u4e0b\u8f7d go ide \u9700\u8981\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a\r\n```\r\n$ cd lexVim\r\n$ git clone https://github.com/lexkong/vim-go-ide-bin\r\n```\r\n> \u90fd\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5927\u6982\u6709 141MB\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85 :-)\r\n\r\n3. \u542f\u52a8\u5b89\u88c5\u811a\u672c\uff1a\r\n```\r\n$ ./start_vim.sh\r\n```\r\n\r\n\u542f\u52a8\u540e\uff0c\u4f1a\u8fdb\u5165\u4e00\u4e2a\u4ea4\u4e92\u73af\u5883\uff0c\u4f9d\u6b21\u8f93\u5165\uff1a `1 -> yourname -> youremail@qq.com`\uff0c\u811a\u672c\u6700\u540e\u8f93\u51fa `this vim config is success !`\u8bf4\u660e\u5b89\u88c5\u6210\u529f\u3002\u5f88\u7b80\u5355\uff0c\u53ea\u9700 3 \u4e2a\u9009\u62e9\u5373\u53ef\u5b89\u88c5\u6210\u529f\uff0c\u914d\u7f6e IDE so easy\u3002\r\n\r\n## Vim IDE \u5e38\u7528\u529f\u80fd\r\n\r\n\u5728 Go \u9879\u76ee\u5f00\u53d1\u4e2d\u6700\u5e38\u7528\u7684\u529f\u80fd\u662f\uff1a\r\n\r\n+ `gd` \u6216\u8005`ctrl + ]` \u8df3\u8f6c\u5230\u5bf9\u5e94\u7684\u51fd\u6570\u5b9a\u4e49\u5904\r\n+ `ctrl + t` \u6807\u7b7e\u9000\u6808\r\n+ `ctrl + o` \u8df3\u8f6c\u5230\u524d\u4e00\u4e2a\u4f4d\u7f6e\r\n+ `<F4>` \u6700\u8fd1\u6587\u4ef6\u5217\u8868\r\n+ `<F5>` \u5728 Vim \u7684\u4e0a\u9762\u6253\u5f00\u6587\u4ef6\u67e5\u627e\u7a97\u53e3\r\n+ `<F9>` \u751f\u6210\u4f9b\u51fd\u6570\u8df3\u8f6c\u7684 tag\r\n+ `<F2>` \u6253\u5f00\u76ee\u5f55\u7a97\u53e3\uff0c\u518d\u6309\u4f1a\u5173\u95ed\u76ee\u5f55\u7a97\u53e3\r\n+ `<F6>` \u6dfb\u52a0\u51fd\u6570\u6ce8\u91ca\r\n\r\n> \u5728\u4ee3\u7801\u95f4\u8df3\u6765\u8df3\u53bb\uff0c\u5c06\u5149\u6807\u653e\u5728\u67d0\u4e2a\u51fd\u6570\u8c03\u7528\u4e0a\uff0c\u6309 `ctl + ]` \u5c31\u4f1a\u8df3\u5230\u51fd\u6570\u7684\u5b9a\u4e49\u5904\uff0c\u6309 `ctrl + o` \u5c31\u4f1a\u8df3\u56de\u6765\u3002\r\n>\r\n> \u66f4\u591a Go vim ide \u529f\u80fd\u8bf7\u53c2\u8003 [Vim IDE \u529f\u80fd](https://github.com/lexkong/lexVim/blob/master/doc/ide.md)\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u201c\u5de5\u6b32\u5584\u5176\u4e8b\uff0c\u5fc5\u5148\u5229\u5176\u5668\u3002\u201d\u5728\u5f00\u59cb Go \u5f00\u53d1\u4e4b\u524d\uff0c\u9700\u8981\u5b89\u88c5\u57fa\u672c\u7684 Go \u7f16\u8bd1\u5de5\u5177\uff0c\u8bbe\u7f6e\u57fa\u672c\u7684\u73af\u5883\u53d8\u91cf\u3002\u5982\u679c\u6709\u4e00\u4e2a\u987a\u624b\u7684\u5f00\u53d1\u5de5\u5177\u5c31\u66f4\u597d\u4e86\u3002\u8be5\u5c0f\u8282\u5411\u8bfb\u8005\u4ecb\u7ecd\u4e86\uff1a\r\n1. \u5982\u4f55\u5b89\u88c5 Go \u7f16\u8bd1\u73af\u5883\r\n2. \u5982\u4f55\u914d\u7f6e Vim IDE\r\n\r\n\u5f00\u5934\u7684\u8fd9 4 \u5c0f\u8282\u4ecb\u7ecd\u4e86 API \u5f00\u53d1\u7684\u4e00\u4e9b\u57fa\u672c\u7684\u77e5\u8bc6\uff0c\u5e76\u505a\u4e86\u5f00\u53d1\u524d\u7684\u51c6\u5907\u5de5\u4f5c\uff0c\u63a5\u4e0b\u6765\u5f00\u59cb API \u5f00\u53d1\u5b9e\u6218\uff0c\u4e00\u6b65\u4e00\u6b65\u6559\u4f60\u6784\u5efa\u4e00\u4e2a\u8d26\u53f7\u7ba1\u7406\u7684 API \u670d\u52a1\uff0c\u6ee1\u6ee1\u7684\u5e72\u8d27\u7b49\u4f60\u6765 Get\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/3Go_API_\u5f00\u53d1\u73af\u5883\u914d\u7f6e.md", "create_date": "2020-02-18T21:37:38.120", "order": 4}}, {"model": "subject.chapter", "pk": 120, "fields": {"title": "API \u6d41\u7a0b\u548c\u4ee3\u7801\u7ed3\u6784", "topic": 6, "md5": "cbf9360da02960d4d5977b44d52153d2", "md_body": "# API \u6d41\u7a0b\u548c\u4ee3\u7801\u7ed3\u6784\n\n\u4e3a\u4e86\u4f7f\u8bfb\u8005\u5728\u5f00\u59cb\u5b9e\u6218\u4e4b\u524d\u5bf9 API \u5f00\u53d1\u6709\u4e2a\u6574\u4f53\u7684\u4e86\u89e3\uff0c\u8fd9\u91cc\u9009\u62e9\u4e86\u4e24\u4e2a\u6d41\u7a0b\u6765\u4ecb\u7ecd\uff1a\n\n+ HTTP API \u670d\u52a1\u5668\u542f\u52a8\u6d41\u7a0b\n+ HTTP \u8bf7\u6c42\u5904\u7406\u6d41\u7a0b\n\n\u672c\u5c0f\u8282\u4e5f\u63d0\u524d\u7ed9\u51fa\u4e86\u7a0b\u5e8f\u4ee3\u7801\u7ed3\u6784\u56fe\uff0c\u8ba9\u8bfb\u8005\u4ece\u5b8f\u89c2\u4e0a\u4e86\u89e3\u5c06\u8981\u6784\u5efa\u7684 API \u670d\u52a1\u5668\u7684\u529f\u80fd\u3002\n\n## HTTP API \u670d\u52a1\u5668\u542f\u52a8\u6d41\u7a0b\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163acb3ab9fd10ff?w=1633&h=1134&f=png&s=108152)\n\n\u5982\u4e0a\u56fe\uff0c\u5728\u542f\u52a8\u4e00\u4e2a API \u547d\u4ee4\u540e\uff0cAPI \u547d\u4ee4\u4f1a\u9996\u5148\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u6839\u636e\u914d\u7f6e\u505a\u540e\u9762\u7684\u5904\u7406\u5de5\u4f5c\u3002\u901a\u5e38\u4f1a\u5c06\u65e5\u5fd7\u76f8\u5173\u7684\u914d\u7f6e\u8bb0\u5f55\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5728\u89e3\u6790\u5b8c\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u5c31\u53ef\u4ee5\u52a0\u8f7d\u65e5\u5fd7\u5305\u521d\u59cb\u5316\u51fd\u6570\uff0c\u6765\u521d\u59cb\u5316\u65e5\u5fd7\u5b9e\u4f8b\uff0c\u4f9b\u540e\u9762\u7684\u7a0b\u5e8f\u8c03\u7528\u3002\u63a5\u4e0b\u6765\u4f1a\u521d\u59cb\u5316\u6570\u636e\u5e93\u5b9e\u4f8b\uff0c\u5efa\u7acb\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u4f9b\u540e\u9762\u5bf9\u6570\u636e\u5e93\u7684 CRUD \u64cd\u4f5c\u4f7f\u7528\u3002\u5728\u5efa\u7acb\u5b8c\u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u9700\u8981\u8bbe\u7f6e HTTP\uff0c\u901a\u5e38\u5305\u62ec 3 \u65b9\u9762\u7684\u8bbe\u7f6e\uff1a\n\n1. \u8bbe\u7f6e Header\n2. \u6ce8\u518c\u8def\u7531\n3. \u6ce8\u518c\u4e2d\u95f4\u4ef6\n\n\u4e4b\u540e\u4f1a\u8c03\u7528 `net/http` \u5305\u7684 `ListenAndServe()` \u65b9\u6cd5\u542f\u52a8 HTTP \u670d\u52a1\u5668\u3002\n\n\u5728\u542f\u52a8 HTTP \u7aef\u53e3\u4e4b\u524d\uff0c\u7a0b\u5e8f\u4f1a go \u4e00\u4e2a\u534f\u7a0b\uff0c\u6765ping HTTP \u670d\u52a1\u5668\u7684 `/sd/health` \u63a5\u53e3\uff0c\u5982\u679c\u7a0b\u5e8f\u6210\u529f\u542f\u52a8\uff0cping \u534f\u7a0b\u5728 timeout \u4e4b\u524d\u4f1a\u6210\u529f\u8fd4\u56de\uff0c\u5982\u679c\u7a0b\u5e8f\u542f\u52a8\u5931\u8d25\uff0c\u5219 ping \u534f\u7a0b\u6700\u7ec8\u4f1a timeout\uff0c\u5e76\u7ec8\u6b62\u6574\u4e2a\u7a0b\u5e8f\u3002\n\n> \u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u3001\u521d\u59cb\u5316 Log \u3001\u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u987a\u5e8f\u6839\u636e\u81ea\u5df1\u7684\u559c\u597d\u548c\u9700\u6c42\u6765\u6392\u5373\u53ef\u3002\n\n## HTTP \u8bf7\u6c42\u5904\u7406\u6d41\u7a0b\n\n![\u7f51\u56fe](https://user-gold-cdn.xitu.io/2018/5/30/163adeb520ed5673?w=633&h=401&f=png&s=62914)\n\n\u4e00\u6b21\u5b8c\u6574\u7684 HTTP \u8bf7\u6c42\u5904\u7406\u6d41\u7a0b\u5982\u4e0a\u56fe\u6240\u793a\u3002\uff08\u56fe\u7247\u51fa\u81ea[\u300aHTTP \u6743\u5a01\u6307\u5357\u300b](https://book.douban.com/subject/10746113/)\uff0c\u63a8\u8350\u60f3\u5168\u9762\u7406\u89e3 HTTP \u7684\u8bfb\u8005\u9605\u8bfb\u6b64\u4e66\u3002\uff09\n\n**1. \u5efa\u7acb\u8fde\u63a5**\n\n\u5ba2\u6237\u7aef\u53d1\u9001 HTTP \u8bf7\u6c42\u540e\uff0c\u670d\u52a1\u5668\u4f1a\u6839\u636e\u57df\u540d\u8fdb\u884c\u57df\u540d\u89e3\u6790\uff0c\u5c31\u662f\u5c06\u7f51\u7ad9\u540d\u79f0\u8f6c\u53d8\u6210 IP \u5730\u5740\uff1alocalhost -> 127.0.0.1\uff0cLinux hosts\u6587\u4ef6\u3001DNS \u57df\u540d\u89e3\u6790\u7b49\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u79cd\u529f\u80fd\u3002\u4e4b\u540e\u901a\u8fc7\u53d1\u8d77 TCP \u7684\u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u3002TCP \u4e09\u6b21\u8fde\u63a5\u8bf7\u53c2\u8003 [TCP \u4e09\u6b21\u63e1\u624b\u8be6\u89e3\u53ca\u91ca\u653e\u8fde\u63a5\u8fc7\u7a0b](https://blog.csdn.net/oney139/article/details/8103223)\uff0c\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\u5c31\u53ef\u4ee5\u53d1\u9001 HTTP \u8bf7\u6c42\u4e86\u3002\n\n**2. \u63a5\u6536\u8bf7\u6c42**\n\nHTTP \u670d\u52a1\u5668\u8f6f\u4ef6\u8fdb\u7a0b\uff0c\u8fd9\u91cc\u6307\u7684\u662f API \u670d\u52a1\u5668\uff0c\u5728\u63a5\u6536\u5230\u8bf7\u6c42\u4e4b\u540e\uff0c\u9996\u5148\u6839\u636e HTTP \u8bf7\u6c42\u884c\u7684\u4fe1\u606f\u6765\u89e3\u6790\u5230 HTTP \u65b9\u6cd5\u548c\u8def\u5f84\uff0c\u5728\u4e0a\u56fe\u6240\u793a\u7684\u62a5\u6587\u4e2d\uff0c\u65b9\u6cd5\u662f `GET`\uff0c\u8def\u5f84\u662f `/index.html`\uff0c\u4e4b\u540e\u6839\u636e API \u670d\u52a1\u5668\u6ce8\u518c\u7684\u8def\u7531\u4fe1\u606f\uff08\u5927\u6982\u53ef\u4ee5\u7406\u89e3\u4e3a\uff1aHTTP \u65b9\u6cd5 + \u8def\u5f84\u548c\u5177\u4f53\u5904\u7406\u51fd\u6570\u7684\u6620\u5c04\uff09\u627e\u5230\u5177\u4f53\u7684\u5904\u7406\u51fd\u6570\u3002\n\n**3. \u5904\u7406\u8bf7\u6c42**\n\n\u5728\u63a5\u6536\u5230\u8bf7\u6c42\u4e4b\u540e\uff0cAPI \u901a\u5e38\u4f1a\u89e3\u6790 HTTP \u8bf7\u6c42\u62a5\u6587\u83b7\u53d6\u8bf7\u6c42\u5934\u548c\u6d88\u606f\u4f53\uff0c\u7136\u540e\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c\u76f8\u5e94\u7684\u4e1a\u52a1\u5904\u7406\uff0cHTTP \u6846\u67b6\u4e00\u822c\u90fd\u6709\u81ea\u5e26\u7684\u89e3\u6790\u51fd\u6570\uff0c\u53ea\u9700\u8981\u8f93\u5165 HTTP \u8bf7\u6c42\u62a5\u6587\uff0c\u5c31\u53ef\u4ee5\u89e3\u6790\u5230\u9700\u8981\u7684\u8bf7\u6c42\u5934\u548c\u6d88\u606f\u4f53\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\uff1a\u5305\u542b\u5bf9\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u548c\u4e0d\u5305\u542b\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\u3002\u5927\u578b\u7cfb\u7edf\u4e2d\u901a\u5e38\u4e24\u79cd\u90fd\u4f1a\u6709\uff1a\n1. \u5305\u542b\u5bf9\u6570\u636e\u5e93\u7684\u64cd\u4f5c\uff1a\u9700\u8981\u8bbf\u95ee\u6570\u636e\u5e93\uff08\u589e\u5220\u6539\u67e5\uff09\uff0c\u7136\u540e\u83b7\u53d6\u6307\u5b9a\u7684\u6570\u636e\uff0c\u5bf9\u6570\u636e\u5904\u7406\u540e\u6784\u5efa\u6307\u5b9a\u7684\u54cd\u5e94\u7ed3\u6784\u4f53\uff0c\u8fd4\u56de\u54cd\u5e94\u5305\u3002\u6570\u636e\u5e93\u901a\u5e38\u7528\u7684\u662f MySQL\uff0c\u56e0\u4e3a\u514d\u8d39\uff0c\u529f\u80fd\u548c\u6027\u80fd\u4e5f\u90fd\u80fd\u6ee1\u8db3\u4f01\u4e1a\u7ea7\u5e94\u7528\u7684\u8981\u6c42\u3002\n2. \u4e0d\u5305\u542b\u5bf9\u6570\u636e\u5e93\u7684\u64cd\u4f5c\uff1a\u8fdb\u884c\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u540e\uff0c\u6784\u5efa\u6307\u5b9a\u7684\u54cd\u5e94\u7ed3\u6784\u4f53\uff0c\u8fd4\u56de\u54cd\u5e94\u5305\u3002\n\n**4. \u8bb0\u5f55\u4e8b\u52a1\u5904\u7406\u8fc7\u7a0b**\n\n\u5728\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u8bb0\u5f55\u4e00\u4e9b\u5173\u952e\u4fe1\u606f\uff0c\u65b9\u4fbf\u540e\u671f Debug \u7528\u3002\u5728 Go \u4e2d\u6709\u5404\u79cd\u5404\u6837\u7684\u65e5\u5fd7\u5305\u53ef\u4ee5\u7528\u6765\u8bb0\u5f55\u8fd9\u4e9b\u4fe1\u606f\u3002\n\n## HTTP \u8bf7\u6c42\u548c\u54cd\u5e94\u683c\u5f0f\u4ecb\u7ecd\n\n\u4e00\u4e2a HTTP \u8bf7\u6c42\u62a5\u6587\u7531\u8bf7\u6c42\u884c\uff08request line\uff09\u3001\u8bf7\u6c42\u5934\u90e8\uff08header\uff09\u3001\u7a7a\u884c\u548c\u8bf7\u6c42\u6570\u636e\u56db\u90e8\u5206\u7ec4\u6210\uff0c\u4e0b\u56fe\u662f\u8bf7\u6c42\u62a5\u6587\u7684\u4e00\u822c\u683c\u5f0f\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/27/1643f2e4e3da9dcd?w=2393&h=1385&f=png&s=274398)\n    \n+ \u7b2c\u4e00\u884c\u5fc5\u987b\u662f\u4e00\u4e2a\u8bf7\u6c42\u884c\uff08request line\uff09\uff0c\u7528\u6765\u8bf4\u660e\u8bf7\u6c42\u7c7b\u578b\u3001\u8981\u8bbf\u95ee\u7684\u8d44\u6e90\u4ee5\u53ca\u6240\u4f7f\u7528\u7684 HTTP \u7248\u672c\n+ \u7d27\u63a5\u7740\u662f\u4e00\u4e2a\u5934\u90e8\uff08header\uff09\u5c0f\u8282\uff0c\u7528\u6765\u8bf4\u660e\u670d\u52a1\u5668\u8981\u4f7f\u7528\u7684\u9644\u52a0\u4fe1\u606f\n+ \u4e4b\u540e\u662f\u4e00\u4e2a\u7a7a\u884c\n+ \u518d\u540e\u9762\u53ef\u4ee5\u6dfb\u52a0\u4efb\u610f\u7684\u5176\u4ed6\u6570\u636e\uff08\u79f0\u4e4b\u4e3a\u4e3b\u4f53\uff1abody\uff09\n\n> HTTP \u54cd\u5e94\u683c\u5f0f\u8ddf\u8bf7\u6c42\u683c\u5f0f\u7c7b\u4f3c\uff0c\u4e5f\u662f\u7531 4 \u4e2a\u90e8\u5206\u7ec4\u6210\uff1a\u72b6\u6001\u884c\u3001\u6d88\u606f\u62a5\u5934\u3001\u7a7a\u884c\u548c\u54cd\u5e94\u6570\u636e\u3002\n\n## \u76ee\u5f55\u7ed3\u6784\n\n```\n\u251c\u2500\u2500 admin.sh                     # \u8fdb\u7a0b\u7684start|stop|status|restart\u63a7\u5236\u6587\u4ef6\n\u251c\u2500\u2500 conf                         # \u914d\u7f6e\u6587\u4ef6\u7edf\u4e00\u5b58\u653e\u76ee\u5f55\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 config.yaml              # \u914d\u7f6e\u6587\u4ef6\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 server.crt               # TLS\u914d\u7f6e\u6587\u4ef6\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 server.key\n\u251c\u2500\u2500 config                       # \u4e13\u95e8\u7528\u6765\u5904\u7406\u914d\u7f6e\u548c\u914d\u7f6e\u6587\u4ef6\u7684Go package\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 config.go                 \n\u251c\u2500\u2500 db.sql                       # \u5728\u90e8\u7f72\u65b0\u73af\u5883\u65f6\uff0c\u53ef\u4ee5\u767b\u5f55MySQL\u5ba2\u6237\u7aef\uff0c\u6267\u884csource db.sql\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868\n\u251c\u2500\u2500 docs                         # swagger\u6587\u6863\uff0c\u6267\u884c swag init \u751f\u6210\u7684\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 docs.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 swagger\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 swagger.json\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 swagger.yaml\n\u251c\u2500\u2500 handler                      # \u7c7b\u4f3cMVC\u67b6\u6784\u4e2d\u7684C\uff0c\u7528\u6765\u8bfb\u53d6\u8f93\u5165\uff0c\u5e76\u5c06\u5904\u7406\u6d41\u7a0b\u8f6c\u53d1\u7ed9\u5b9e\u9645\u7684\u5904\u7406\u51fd\u6570\uff0c\u6700\u540e\u8fd4\u56de\u7ed3\u679c\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 handler.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sd                       # \u5065\u5eb7\u68c0\u67e5handler\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 check.go \n\u2502\u00a0\u00a0 \u2514\u2500\u2500 user                     # \u6838\u5fc3\uff1a\u7528\u6237\u4e1a\u52a1\u903b\u8f91handler\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 create.go            # \u65b0\u589e\u7528\u6237\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 delete.go            # \u5220\u9664\u7528\u6237\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 get.go               # \u83b7\u53d6\u6307\u5b9a\u7684\u7528\u6237\u4fe1\u606f\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 list.go              # \u67e5\u8be2\u7528\u6237\u5217\u8868\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 login.go             # \u7528\u6237\u767b\u5f55\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 update.go            # \u66f4\u65b0\u7528\u6237\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 user.go              # \u5b58\u653e\u7528\u6237handler\u516c\u7528\u7684\u51fd\u6570\u3001\u7ed3\u6784\u4f53\u7b49\n\u251c\u2500\u2500 main.go                      # Go\u7a0b\u5e8f\u552f\u4e00\u5165\u53e3\n\u251c\u2500\u2500 Makefile                     # Makefile\u6587\u4ef6\uff0c\u4e00\u822c\u5927\u578b\u8f6f\u4ef6\u7cfb\u7edf\u90fd\u662f\u91c7\u7528make\u6765\u4f5c\u4e3a\u7f16\u8bd1\u5de5\u5177\n\u251c\u2500\u2500 model                        # \u6570\u636e\u5e93\u76f8\u5173\u7684\u64cd\u4f5c\u7edf\u4e00\u653e\u5728\u8fd9\u91cc\uff0c\u5305\u62ec\u6570\u636e\u5e93\u521d\u59cb\u5316\u548c\u5bf9\u8868\u7684\u589e\u5220\u6539\u67e5\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 init.go                  # \u521d\u59cb\u5316\u548c\u8fde\u63a5\u6570\u636e\u5e93\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 model.go                 # \u5b58\u653e\u4e00\u4e9b\u516c\u7528\u7684go struct\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 user.go                  # \u7528\u6237\u76f8\u5173\u7684\u6570\u636e\u5e93CURD\u64cd\u4f5c\n\u251c\u2500\u2500 pkg                          # \u5f15\u7528\u7684\u5305\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 auth                     # \u8ba4\u8bc1\u5305\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 auth.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 constvar                 # \u5e38\u91cf\u7edf\u4e00\u5b58\u653e\u4f4d\u7f6e\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 constvar.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 errno                    # \u9519\u8bef\u7801\u5b58\u653e\u4f4d\u7f6e\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 code.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 errno.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 token\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 token.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 version                  # \u7248\u672c\u5305\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 base.go\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 doc.go\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 version.go\n\u251c\u2500\u2500 README.md                    # API\u76ee\u5f55README\n\u251c\u2500\u2500 router                       # \u8def\u7531\u76f8\u5173\u5904\u7406\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 middleware               # API\u670d\u52a1\u5668\u7528\u7684\u662fGin Web\u6846\u67b6\uff0cGin\u4e2d\u95f4\u4ef6\u5b58\u653e\u4f4d\u7f6e\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 auth.go \n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 header.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 logging.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 requestid.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 router.go\n\u251c\u2500\u2500 service                      # \u5b9e\u9645\u4e1a\u52a1\u5904\u7406\u51fd\u6570\u5b58\u653e\u4f4d\u7f6e\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 service.go\n\u251c\u2500\u2500 util                         # \u5de5\u5177\u7c7b\u51fd\u6570\u5b58\u653e\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 util.go \n\u2502   \u2514\u2500\u2500 util_test.go\n\u2514\u2500\u2500 vendor                         # vendor\u76ee\u5f55\u7528\u6765\u7ba1\u7406\u4f9d\u8d56\u5305\n    \u251c\u2500\u2500 github.com\n    \u251c\u2500\u2500 golang.org\n    \u251c\u2500\u2500 gopkg.in\n    \u2514\u2500\u2500 vendor.json\n```\n\nGo API \u9879\u76ee\u4e2d\uff0c\u4e00\u822c\u90fd\u4f1a\u5305\u62ec\u8fd9\u4e9b\u529f\u80fd\u9879\uff1aMakefile \u6587\u4ef6\u3001\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\u3001RESTful API \u670d\u52a1\u5668\u7684 handler \u76ee\u5f55\u3001model \u76ee\u5f55\u3001\u5de5\u5177\u7c7b\u76ee\u5f55\u3001vendor \u76ee\u5f55\uff0c\u4ee5\u53ca\u5b9e\u9645\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u51fd\u6570\u6240\u5b58\u653e\u7684 service \u76ee\u5f55\u3002\u8fd9\u4e9b\u90fd\u5728\u4e0a\u8ff0\u7684\u4ee3\u7801\u7ed3\u6784\u4e2d\u6709\u5217\u51fa\uff0c\u65b0\u52a0\u529f\u80fd\u65f6\u5c06\u4ee3\u7801\u653e\u5165\u5bf9\u5e94\u529f\u80fd\u7684\u76ee\u5f55/\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u6574\u4e2a\u9879\u76ee\u4ee3\u7801\u7ed3\u6784\u66f4\u52a0\u6e05\u6670\uff0c\u975e\u5e38\u6709\u5229\u4e8e\u540e\u671f\u7684\u67e5\u627e\u548c\u7ef4\u62a4\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u8282\u901a\u8fc7\u4ecb\u7ecd API \u670d\u52a1\u5668\u542f\u52a8\u6d41\u7a0b\u548c HTTP \u8bf7\u6c42\u5904\u7406\u6d41\u7a0b\uff0c\u6765\u8ba9\u8bfb\u8005\u5bf9 API \u670d\u52a1\u5668\u4e2d\u7684\u5173\u952e\u6d41\u7a0b\u6709\u4e2a\u5b8f\u89c2\u7684\u4e86\u89e3\uff0c\u66f4\u597d\u5730\u7406\u89e3 API \u670d\u52a1\u5668\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002API \u670d\u52a1\u5668\u6e90\u7801\u7ed3\u6784\u4e5f\u975e\u5e38\u91cd\u8981\uff0c\u4e00\u4e2a\u597d\u7684\u6e90\u7801\u7ed3\u6784\u901a\u5e38\u80fd\u8ba9\u903b\u8f91\u66f4\u52a0\u6e05\u6670\uff0c\u7f16\u5199\u66f4\u52a0\u987a\u7545\uff0c\u540e\u671f\u7ef4\u62a4\u66f4\u52a0\u5bb9\u6613\uff0c\u672c\u5c0f\u518c\u4ecb\u7ecd\u4e86\u7b14\u8005\u503e\u5411\u7684\u6e90\u7801\u7ec4\u7ec7\u7ed3\u6784\uff0c\u4f9b\u8bfb\u8005\u53c2\u8003\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/2API_\u6d41\u7a0b\u548c\u4ee3\u7801\u7ed3\u6784.md", "create_date": "2020-02-18T21:37:38.141", "order": 3}}, {"model": "subject.chapter", "pk": 121, "fields": {"title": "\u57fa\u7840 3\uff1a\u8bb0\u5f55\u548c\u7ba1\u7406 API \u65e5\u5fd7", "topic": 6, "md5": "5d0c8b5885dc8079a1cb1a9c76af4827", "md_body": "# \u8bb0\u5f55\u548c\u7ba1\u7406 API \u65e5\u5fd7\n\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\n\n+ Go \u65e5\u5fd7\u5305\u6570\u91cf\u4f17\u591a\uff0c\u529f\u80fd\u4e0d\u540c\u3001\u6027\u80fd\u4e0d\u540c\uff0c\u672c\u5c0f\u518c\u4ecb\u7ecd\u4e00\u4e2a\u7b14\u8005\u8ba4\u4e3a\u6bd4\u8f83\u597d\u7684\u65e5\u5fd7\u5e93\uff0c\u5e76\u7ed9\u51fa\u539f\u56e0\n+ \u4ecb\u7ecd\u5982\u4f55\u521d\u59cb\u5316\u65e5\u5fd7\u5305\n+ \u4ecb\u7ecd\u5982\u4f55\u8c03\u7528\u65e5\u5fd7\u5305\n+ \u4ecb\u7ecd\u5982\u4f55\u8f6c\u5b58\uff08rotate\uff09\u65e5\u5fd7\u6587\u4ef6\n\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo03](https://github.com/lexkong/apiserver_demos/tree/master/demo03)\n>\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\n>\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo02](https://github.com/lexkong/apiserver_demos/tree/master/demo02) \u6765\u5f00\u53d1\u7684\u3002\n\n## \u65e5\u5fd7\u5305\u4ecb\u7ecd\n\napiserver \u6240\u91c7\u7528\u7684\u65e5\u5fd7\u5305 [lexkong/log](https://github.com/lexkong/log) \u662f\u7b14\u8005\u6839\u636e\u5f00\u53d1\u7ecf\u9a8c\uff0c\u5e76\u8c03\u7814 GitHub \u4e0a\u7684 \u5f00\u6e90log \u5305\u540e\u5c01\u88c5\u7684\u4e00\u4e2a\u65e5\u5fd7\u5305\uff0c\u4e5f\u662f\u7b14\u8005\u6240\u5728\u9879\u76ee\u4f7f\u7528\u7684\u65e5\u5fd7\u5305\u3002\u5b83\u53c2\u8003\u534e\u4e3a [paas-lager](https://github.com/ServiceComb/paas-lager)\uff0c\u505a\u4e86\u4e00\u4e9b\u4fbf\u6377\u6027\u7684\u6539\u52a8\uff0c\u529f\u80fd\u5b8c\u5168\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u66f4\u4e3a\u4fbf\u6377\u3002\u76f8\u8f83\u4e8e Go \u7684\u5176\u4ed6\u65e5\u5fd7\u5305\uff0c\u8be5\u65e5\u5fd7\u5305\u6709\u5982\u4e0b\u7279\u70b9\uff1a\n\n+ \u652f\u6301\u65e5\u5fd7\u8f93\u51fa\u6d41\u914d\u7f6e\uff0c\u53ef\u4ee5\u8f93\u51fa\u5230 stdout \u6216 file\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u8f93\u51fa\u5230 stdout \u548c file\n+ \u652f\u6301\u8f93\u51fa\u4e3a JSON \u6216 plaintext \u683c\u5f0f\n+ \u652f\u6301\u5f69\u8272\u8f93\u51fa\n+ \u652f\u6301 log rotate \u529f\u80fd\n+ \u9ad8\u6027\u80fd\n\n## \u521d\u59cb\u5316\u65e5\u5fd7\u5305\n\n**\u5728 `conf/config.yaml` \u4e2d\u6dfb\u52a0 log \u914d\u7f6e**\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b436f7649e2e7?w=800&h=337&f=png&s=29514)\n\n**\u5728 `config/config.go` \u4e2d\u6dfb\u52a0\u65e5\u5fd7\u521d\u59cb\u5316\u4ee3\u7801**\n\n```go\npackage config\n\nimport (\n    ....\n    \"github.com/lexkong/log\"\n    ....\n)\n....\nfunc Init(cfg string) error {\n    ....\n    // \u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6\n    if err := c.initConfig(); err != nil {\n        return err\n    }\n\n    // \u521d\u59cb\u5316\u65e5\u5fd7\u5305\n    c.initLog()\n    ....\n}\n\nfunc (c *Config) initConfig() error {\n    ....\n}\n\nfunc (c *Config) initLog() {\n    passLagerCfg := log.PassLagerCfg {\n        Writers:        viper.GetString(\"log.writers\"),\n        LoggerLevel:    viper.GetString(\"log.logger_level\"),\n        LoggerFile:     viper.GetString(\"log.logger_file\"),\n        LogFormatText:  viper.GetBool(\"log.log_format_text\"),\n        RollingPolicy:  viper.GetString(\"log.rollingPolicy\"),\n        LogRotateDate:  viper.GetInt(\"log.log_rotate_date\"),\n        LogRotateSize:  viper.GetInt(\"log.log_rotate_size\"),\n        LogBackupCount: viper.GetInt(\"log.log_backup_count\"),\n    }\n\n    log.InitWithConfig(&passLagerCfg)\n}  \n\n// \u76d1\u63a7\u914d\u7f6e\u6587\u4ef6\u53d8\u5316\u5e76\u70ed\u52a0\u8f7d\u7a0b\u5e8f\nfunc (c *Config) watchConfig() {\n    ....\n}\n```\n\n\u8fd9\u91cc\u8981\u6ce8\u610f\uff0c\u65e5\u5fd7\u521d\u59cb\u5316\u51fd\u6570 `c.initLog()` \u8981\u653e\u5728\u914d\u7f6e\u521d\u59cb\u5316\u51fd\u6570 `c.initConfig()` \u4e4b\u540e\uff0c\u56e0\u4e3a\u65e5\u5fd7\u521d\u59cb\u5316\u51fd\u6570\u8981\u8bfb\u53d6\u65e5\u5fd7\u76f8\u5173\u7684\u914d\u7f6e\u3002`func (c *Config) initLog()` \u662f\u65e5\u5fd7\u521d\u59cb\u5316\u51fd\u6570\uff0c\u4f1a\u8bbe\u7f6e\u65e5\u5fd7\u5305\u7684\u5404\u9879\u53c2\u6570\uff0c\u53c2\u6570\u4e3a\uff1a\n\n+ `writers`\uff1a\u8f93\u51fa\u4f4d\u7f6e\uff0c\u6709\u4e24\u4e2a\u53ef\u9009\u9879 \u2014\u2014 file \u548c stdout\u3002\u9009\u62e9 file \u4f1a\u5c06\u65e5\u5fd7\u8bb0\u5f55\u5230 `logger_file` \u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u9009\u62e9 stdout \u4f1a\u5c06\u65e5\u5fd7\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e24\u8005\u540c\u65f6\u9009\u62e9\n+ `logger_level`\uff1a\u65e5\u5fd7\u7ea7\u522b\uff0cDEBUG\u3001INFO\u3001WARN\u3001ERROR\u3001FATAL\n+ `logger_file`\uff1a\u65e5\u5fd7\u6587\u4ef6\n+ `log_format_text`\uff1a\u65e5\u5fd7\u7684\u8f93\u51fa\u683c\u5f0f\uff0cJSON \u6216\u8005 plaintext\uff0c`true` \u4f1a\u8f93\u51fa\u6210\u975e JSON \u683c\u5f0f\uff0c`false` \u4f1a\u8f93\u51fa\u6210 JSON \u683c\u5f0f\n+ `rollingPolicy`\uff1arotate \u4f9d\u636e\uff0c\u53ef\u9009\u7684\u6709 daily \u548c size\u3002\u5982\u679c\u9009 daily \u5219\u6839\u636e\u5929\u8fdb\u884c\u8f6c\u5b58\uff0c\u5982\u679c\u662f size \u5219\u6839\u636e\u5927\u5c0f\u8fdb\u884c\u8f6c\u5b58\n+ `log_rotate_date`\uff1arotate \u8f6c\u5b58\u65f6\u95f4\uff0c\u914d \u5408`rollingPolicy: daily` \u4f7f\u7528\n+ `log_rotate_size`\uff1arotate \u8f6c\u5b58\u5927\u5c0f\uff0c\u914d\u5408 `rollingPolicy: size` \u4f7f\u7528\n+ `log_backup_count`\uff1a\u5f53\u65e5\u5fd7\u6587\u4ef6\u8fbe\u5230\u8f6c\u5b58\u6807\u51c6\u65f6\uff0clog \u7cfb\u7edf\u4f1a\u5c06\u8be5\u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u538b\u7f29\u5907\u4efd\uff0c\u8fd9\u91cc\u6307\u5b9a\u4e86\u5907\u4efd\u6587\u4ef6\u7684\u6700\u5927\u4e2a\u6570\n\n## \u8c03\u7528\u65e5\u5fd7\u5305\n\n\u65e5\u5fd7\u521d\u59cb\u5316\u597d\u4e86\uff0c\u5c06 [demo02](https://github.com/lexkong/apiserver_demos/tree/master/demo02) \u4e2d\u7684 log \u7528 [lexkong/log](https://github.com/lexkong/log) \u5305\u6765\u66ff\u6362\u3002\u66ff\u6362\u524d\uff08\u8fd9\u91cc grep \u51fa\u4e86\u9700\u8981\u66ff\u6362\u7684\u884c\uff0c\u8bfb\u8005\u53ef\u81ea\u884c\u786e\u8ba4\u66ff\u6362\u540e\u7684\u6548\u679c\uff09\uff1a\n\n```\n$ grep log * -R\nconfig/config.go:\t\"log\"\nconfig/config.go:\t\tlog.Printf(\"Config file changed: %s\", e.Name)\nmain.go:\t\"log\"\nmain.go:\t\t\tlog.Fatal(\"The router has no response, or it might took too long to start up.\", err)\nmain.go:\t\tlog.Print(\"The router has been deployed successfully.\")\nmain.go:\tlog.Printf(\"Start to listening the incoming requests on http address: %s\", viper.GetString(\"addr\"))\nmain.go:\tlog.Printf(http.ListenAndServe(viper.GetString(\"addr\"), g).Error())\nmain.go:\t\tlog.Print(\"Waiting for the router, retry in 1 second.\")\n```\n\n\u66ff\u6362\u540e\u7684\u6e90\u7801\u6587\u4ef6\u89c1 [demo03](https://github.com/lexkong/apiserver_demos/tree/master/demo03)\u3002\n\n## \u7f16\u8bd1\u5e76\u8fd0\u884c\n\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\n\n```\n$ git clone https://github.com/lexkong/apiserver_demos\n```\n\n2. \u5c06 `apiserver_demos/demo03 `\u590d\u5236\u4e3a `$GOPATH/src/apiserver`\n\n```\n$ cp -a apiserver_demos/demo03/ $GOPATH/src/apiserver\n```\n\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\n\n```\n$ cd $GOPATH/src/apiserver\n$ gofmt -w .\n$ go tool vet .\n$ go build -v .\n```\n\n4. \u542f\u52a8 apiserver\n\n```\n$ ./apiserver\n```\n\n\u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u770b\u5230 apiserver \u6709 JSON \u683c\u5f0f\u7684\u65e5\u5fd7\u8f93\u51fa\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/7/163d94888f441a2e?w=1738&h=281&f=png&s=38252)\n\n## \u7ba1\u7406\u65e5\u5fd7\u6587\u4ef6\n\n\u8fd9\u91cc\u5c06\u65e5\u5fd7\u8f6c\u5b58\u7b56\u7565\u8bbe\u7f6e\u4e3a `size`\uff0c\u8f6c\u5b58\u5927\u5c0f\u8bbe\u7f6e\u4e3a 1 MB\n\n```yaml\n  rollingPolicy: size\n  log_rotate_size: 1\n```\n\n\u5e76\u5728 `main` \u51fd\u6570\u4e2d\u52a0\u5165\u6d4b\u8bd5\u4ee3\u7801\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/5/31/163b4bc062cc4033?w=1336&h=266&f=png&s=12866)\n\n\n\u542f\u52a8 apiserver \u540e\u53d1\u73b0\uff0c\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efa\u4e86 log/apiserver.log \u65e5\u5fd7\u6587\u4ef6\uff1a\n\n```\n$ ls log/\napiserver.log\n```\n\n\u7a0b\u5e8f\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u53d1\u73b0\u53c8\u521b\u5efa\u4e86 zip \u6587\u4ef6\uff1a\n\n```\n$ ls log/\napiserver.log  apiserver.log.20180531134509631.zip\n```\n\n\u8be5 zip \u6587\u4ef6\u5c31\u662f\u5f53 apiserver.log \u5927\u5c0f\u8d85\u8fc7 1MB \u540e\uff0c\u65e5\u5fd7\u7cfb\u7edf\u5c06\u4e4b\u524d\u7684\u65e5\u5fd7\u538b\u7f29\u6210 zip \u6587\u4ef6\u540e\u7684\u6587\u4ef6\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u8282\u901a\u8fc7\u5177\u4f53\u5b9e\u4f8b\u8bb2\u89e3\u4e86\u5982\u4f55\u914d\u7f6e\u3001\u4f7f\u7528\u548c\u7ba1\u7406\u65e5\u5fd7\u3002  ", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/6\u57fa\u7840_3\u8bb0\u5f55\u548c\u7ba1\u7406_API_\u65e5\u5fd7.md", "create_date": "2020-02-18T21:37:38.165", "order": 7}}, {"model": "subject.chapter", "pk": 122, "fields": {"title": "\u57fa\u7840 4\uff1a\u5b89\u88c5 MySQL \u5e76\u521d\u59cb\u5316\u8868", "topic": 6, "md5": "67065295bc973564567157911aaf8709", "md_body": "# \u5b89\u88c5 MySQL \u5e76\u521d\u59cb\u5316\u8868\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u5982\u4f55\u5b89\u88c5 MySQL \u6570\u636e\u5e93\r\n+ \u5982\u4f55\u521b\u5efa\u793a\u4f8b\u9700\u8981\u7684\u6570\u636e\u5e93\u548c\u8868\r\n\r\n\u672c\u8282\u4e3b\u8981\u662f\u4e3a\u7b2c 12 \u8282\u300c\u7528\u6237\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u300d\u505a\u51c6\u5907\u5de5\u4f5c\u3002\r\n\r\n## \u51c6\u5907\u5de5\u4f5c\r\n\r\n**\u5b89\u88c5 MySQL**\r\n\r\napiserver \u7528\u7684\u662f MySQL\uff0c\u6240\u4ee5\u9996\u5148\u8981\u786e\u4fdd\u670d\u52a1\u5668\u4e0a\u5b89\u88c5\u6709 MySQL\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u6765\u68c0\u67e5\u662f\u5426\u5b89\u88c5\u4e86 MySQL\uff08CentOS 7 \u4e0a\u662f mariadb-server\uff0cCentOS 6 \u4e0a\u662f mysql-server\uff0c\u8fd9\u91cc\u4ee5 CentOS 7 \u4e3a\u4f8b\uff09\uff1a\r\n```\r\n$ rpm -q mariadb-server\r\n```\r\n\u5982\u679c\u63d0\u793a `package mariadb-server is not installed` \u5219\u8bf4\u660e\u6ca1\u6709\u5b89\u88c5 MySQL\uff0c\u9700\u8981\u624b\u52a8\u5b89\u88c5\u3002\u5982\u679c\u51fa\u73b0 `mariadb-server-xxx.xxx.xx.el7.x86_64` \u5219\u8bf4\u660e\u5df2\u7ecf\u5b89\u88c5\u3002\r\n\r\n\u5b89\u88c5 MySQL \u7684\u6b65\u9aa4\u4e3a\uff1a\r\n\r\n1. \u5b89\u88c5 MySQL \u548c MySQL \u5ba2\u6237\u7aef\r\n\r\n\r\n```\r\n$ sudo yum -y install mariadb  mariadb-server\r\n```\r\n\r\n2. \u542f\u52a8 MySQL\r\n\r\n```\r\n$ sudo systemctl start mariadb\r\n```\r\n\r\n3. \u8bbe\u7f6e\u5f00\u673a\u542f\u52a8\r\n\r\n```\r\n$ sudo systemctl enable mariadb\r\n```\r\n\r\n4. \u8bbe\u7f6e\u521d\u59cb\u5bc6\u7801\r\n\r\n```\r\n$ sudo mysqladmin -u root password root\r\n```\r\n\r\n> \u56e0\u4e3a\u7248\u6743\u539f\u56e0\uff0c\u5728 CentOS 7 \u4e2d\u7528\u7684\u662f\u57fa\u4e8e MySQL fork \u7684\u4e00\u4e2a\u5f00\u6e90\u5206\u652f MariaDB\uff0c\u5b83\u7684\u529f\u80fd\u548c\u7528\u6cd5\u8ddf MySQL \u5b8c\u5168\u4e00\u6837\u3002\r\n> \r\n> \u5982\u679c\u4f60\u7684\u7cfb\u7edf\u4e4b\u524d\u5df2\u7ecf\u5b89\u88c5\u8fc7 MySQL\uff0c\u9700\u8981\u5728 conf/config.yaml \u914d\u7f6e\u6587\u4ef6\u4e2d\u66f4\u65b0\u914d\u7f6e\u3002\r\n\r\n**\u521b\u5efa\u793a\u4f8b\u9700\u8981\u7684\u6570\u636e\u5e93\u548c\u8868**\r\n\r\n1. \u521b\u5efa `db.sql`\uff0c\u5185\u5bb9\u4e3a\uff1a\r\n\r\n```sql\r\n/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;\r\n/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;\r\n/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;\r\n/*!40101 SET NAMES utf8 */;\r\n/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;\r\n/*!40103 SET TIME_ZONE='+00:00' */;\r\n/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;\r\n/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;\r\n/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;\r\n/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;\r\n\r\nCREATE DATABASE /*!32312 IF NOT EXISTS*/ `db_apiserver` /*!40100 DEFAULT CHARACTER SET utf8 */;\r\n\r\nUSE `db_apiserver`;\r\n\r\n--\r\n-- Table structure for table `tb_users`\r\n--\r\n\r\nDROP TABLE IF EXISTS `tb_users`;\r\n/*!40101 SET @saved_cs_client     = @@character_set_client */;\r\n/*!40101 SET character_set_client = utf8 */;\r\nCREATE TABLE `tb_users` (\r\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\r\n  `username` varchar(255) NOT NULL,\r\n  `password` varchar(255) NOT NULL,\r\n  `createdAt` timestamp NULL DEFAULT NULL,\r\n  `updatedAt` timestamp NULL DEFAULT NULL,\r\n  `deletedAt` timestamp NULL DEFAULT NULL,\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `username` (`username`),\r\n  KEY `idx_tb_users_deletedAt` (`deletedAt`)\r\n) ENGINE=MyISAM AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;\r\n/*!40101 SET character_set_client = @saved_cs_client */;\r\n\r\n--\r\n-- Dumping data for table `tb_users`\r\n--\r\n\r\nLOCK TABLES `tb_users` WRITE;\r\n/*!40000 ALTER TABLE `tb_users` DISABLE KEYS */;\r\nINSERT INTO `tb_users` VALUES (0,'admin','$2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG','2018-05-27 16:25:33','2018-05-27 16:25:33',NULL);\r\n/*!40000 ALTER TABLE `tb_users` ENABLE KEYS */;\r\nUNLOCK TABLES;\r\n/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;\r\n\r\n/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;\r\n/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;\r\n/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;\r\n/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;\r\n/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;\r\n/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;\r\n/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;\r\n\r\n-- Dump completed on 2018-05-28  0:25:41\r\n```\r\n\r\n2. \u767b\u5f55 MySQL:\r\n\r\n```\r\n$ mysql -uroot -p \r\n```\r\n3. source `db.sql`\r\n\r\n```\r\nmysql> source db.sql\r\n```\r\n\u53ef\u4ee5\u770b\u5230\uff0cdb.sql \u521b\u5efa\u4e86 `db_apiserver` \u6570\u636e\u5e93\u548c `tb_users` \u8868\uff0c\u5e76\u9ed8\u8ba4\u6dfb\u52a0\u4e86\u4e00\u6761\u8bb0\u5f55\uff08\u7528\u6237\u540d\uff1aadmin\uff0c\u5bc6\u7801\uff1aadmin\uff09\uff1a\r\n\r\n```sql\r\nmysql> select * from tb_users \\G;\r\n*************************** 1. row ***************************\r\n       id: 0\r\n username: admin\r\n password: $2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG\r\ncreatedAt: 2018-05-28 00:25:33\r\nupdatedAt: 2018-05-28 00:25:33\r\ndeletedAt: NULL\r\n1 row in set (0.00 sec)\r\n```\r\n\r\n## \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u6570\u636e\u5e93\u914d\u7f6e\r\n\r\nAPI \u542f\u52a8\u9700\u8981\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u6240\u4ee5\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6 `conf/config.yaml` \u4e2d\u914d\u7f6e\u6570\u636e\u5e93\u7684 IP\u3001\u7aef\u53e3\u3001\u7528\u6237\u540d\u3001\u5bc6\u7801\u548c\u6570\u636e\u5e93\u540d\u4fe1\u606f\u3002\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/2/163be547b5b845dd?w=1713&h=1087&f=png&s=95176)\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u901a\u8fc7\u4e00\u6b65\u6b65\u64cd\u4f5c\uff0c\u4ecb\u7ecd\u4e86\u5982\u4f55\u5b89\u88c5 MySQL \u6570\u636e\u5e93\uff0c\u4ee5\u53ca\u5982\u4f55\u521b\u5efa\u5c0f\u518c\u793a\u4f8b\u9700\u8981\u7684\u6570\u636e\u5e93\u548c\u8868\uff0c\u4e3a\u540e\u9762\u7684\u5c0f\u8282\u4f5c\u597d\u73af\u5883\u51c6\u5907\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/7\u57fa\u7840_4\u5b89\u88c5_MySQL_\u5e76\u521d\u59cb\u5316\u8868.md", "create_date": "2020-02-18T21:37:38.184", "order": 8}}, {"model": "subject.chapter", "pk": 123, "fields": {"title": "\u57fa\u7840 1\uff1a\u542f\u52a8\u4e00\u4e2a\u6700\u7b80\u5355\u7684 RESTful API \u670d\u52a1\u5668", "topic": 6, "md5": "f49cee8436f5960850e3f69b88c9c47b", "md_body": "# \u542f\u52a8\u4e00\u4e2a\u6700\u7b80\u5355\u7684 RESTful API \u670d\u52a1\u5668\n\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\n\n+ \u542f\u52a8\u4e00\u4e2a\u6700\u7b80\u5355\u7684 RESTful API \u670d\u52a1\u5668\n+ \u8bbe\u7f6e HTTP Header\n+ API \u670d\u52a1\u5668\u5065\u5eb7\u68c0\u67e5\u548c\u72b6\u6001\u67e5\u8be2\n+ \u7f16\u8bd1\u5e76\u6d4b\u8bd5 API\n\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo01](https://github.com/lexkong/apiserver_demos/tree/master/demo01)\n>\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\n\n```!\n\u5982\u65e0\u7279\u522b\u8bf4\u660e\uff0c\u672c\u5c0f\u518c\u7684\u64cd\u4f5c\u548c\u7f16\u8bd1\u76ee\u5f55\u5747\u662f API \u6e90\u7801\u7684\u6839\u76ee\u5f55\uff0c\u5e76\u4e14\u672c API \u670d\u52a1\u5668\u540d\u5b57\uff08\u4e5f\u662f\u4e8c\u8fdb\u5236\u547d\u4ee4\u7684\u540d\u5b57\uff09\u5c0f\u518c\u4e2d\u7edf\u4e00\u53eb\u4f5c apiserver\u3002\n```\n\n## REST Web \u6846\u67b6\u9009\u62e9\n\n\u8981\u7f16\u5199\u4e00\u4e2a RESTful \u98ce\u683c\u7684 API \u670d\u52a1\u5668\uff0c\u9996\u5148\u9700\u8981\u4e00\u4e2a RESTful Web \u6846\u67b6\uff0c\u7b14\u8005\u7ecf\u8fc7\u8c03\u7814\u9009\u62e9\u4e86 GitHub star \u6570\u6700\u591a\u7684 [Gin](https://github.com/gin-gonic/gin)\u3002\u91c7\u7528\u8f7b\u91cf\u7ea7\u7684 Gin \u6846\u67b6\uff0c\u5177\u6709\u5982\u4e0b\u4f18\u70b9\uff1a\u9ad8\u6027\u80fd\u3001\u6269\u5c55\u6027\u5f3a\u3001\u7a33\u5b9a\u6027\u5f3a\u3001\u76f8\u5bf9\u800c\u8a00\u6bd4\u8f83\u7b80\u6d01\uff08\u67e5\u770b [\u6027\u80fd\u5bf9\u6bd4](https://github.com/gin-gonic/gin/blob/master/BENCHMARKS.md)\uff09\u3002\u5173\u4e8e Gin \u7684\u66f4\u591a\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 [Golang \u5fae\u6846\u67b6 Gin \u7b80\u4ecb](https://www.jianshu.com/p/a31e4ee25305)\u3002\n\n## \u52a0\u8f7d\u8def\u7531\uff0c\u5e76\u542f\u52a8 HTTP \u670d\u52a1\n\nmain.go \u4e2d\u7684 `main()` \u51fd\u6570\u662f Go \u7a0b\u5e8f\u7684\u5165\u53e3\u51fd\u6570\uff0c\u5728 `main()` \u51fd\u6570\u4e2d\u4e3b\u8981\u505a\u4e00\u4e9b\u914d\u7f6e\u6587\u4ef6\u89e3\u6790\u3001\u7a0b\u5e8f\u521d\u59cb\u5316\u548c\u8def\u7531\u52a0\u8f7d\u4e4b\u7c7b\u7684\u4e8b\u60c5\uff0c\u6700\u7ec8\u8c03\u7528 `http.ListenAndServe()` \u5728\u6307\u5b9a\u7aef\u53e3\u542f\u52a8\u4e00\u4e2a HTTP \u670d\u52a1\u5668\u3002\u672c\u5c0f\u8282\u662f\u4e00\u4e2a\u7b80\u5355\u7684 HTTP \u670d\u52a1\u5668\uff0c\u4ec5\u521d\u59cb\u5316\u4e00\u4e2a Gin \u5b9e\u4f8b\uff0c\u52a0\u8f7d\u8def\u7531\u5e76\u542f\u52a8 HTTP \u670d\u52a1\u5668\u3002\n\n**\u7f16\u5199\u5165\u53e3\u51fd\u6570**\n\n\u7f16\u5199 `main()` \u51fd\u6570\uff0cmain.go \u4ee3\u7801\uff1a\n```go\npackage main\n\nimport (\n\t\"log\"\n\t\"net/http\"\n\n\t\"apiserver/router\"\n\n\t\"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n\t// Create the Gin engine.\n\tg := gin.New()\n    \n    // gin middlewares\n\tmiddlewares := []gin.HandlerFunc{}\n\n\t// Routes.\n\trouter.Load(\n\t\t// Cores.\n\t\tg,\n\n\t\t// Middlewares.\n\t\tmiddlewares...,\n\t)\n\n\tlog.Printf(\"Start to listening the incoming requests on http address: %s\", \":8080\")\n\tlog.Printf(http.ListenAndServe(\":8080\", g).Error())\n}\n```\n\n**\u52a0\u8f7d\u8def\u7531**\n\n`main()` \u51fd\u6570\u901a\u8fc7\u8c03\u7528 `router.Load` \u51fd\u6570\u6765\u52a0\u8f7d\u8def\u7531\uff08\u51fd\u6570\u8def\u5f84\u4e3a router/router.go\uff0c\u5177\u4f53\u51fd\u6570\u5b9e\u73b0\u53c2\u7167 [demo01/router/router.go](https://github.com/lexkong/apiserver_demos/blob/master/demo01/router/router.go)\uff09\uff1a\n\n```go\n    \"apiserver/handler/sd\"\n    \n    ....\n    \n    // The health check handlers\n    svcd := g.Group(\"/sd\")\n    {   \n        svcd.GET(\"/health\", sd.HealthCheck)\n        svcd.GET(\"/disk\", sd.DiskCheck)\n        svcd.GET(\"/cpu\", sd.CPUCheck)\n        svcd.GET(\"/ram\", sd.RAMCheck)\n    }   \n```\n\n\u8be5\u4ee3\u7801\u5757\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53eb sd \u7684\u5206\u7ec4\uff0c\u5728\u8be5\u5206\u7ec4\u4e0b\u6ce8\u518c\u4e86 `/health`\u3001`/disk`\u3001`/cpu`\u3001`/ram` HTTP \u8def\u5f84\uff0c\u5206\u522b\u8def\u7531\u5230 `sd.HealthCheck`\u3001`sd.DiskCheck`\u3001`sd.CPUCheck`\u3001`sd.RAMCheck` \u51fd\u6570\u3002sd \u5206\u7ec4\u4e3b\u8981\u7528\u6765\u68c0\u67e5 API Server \u7684\u72b6\u6001\uff1a\u5065\u5eb7\u72b6\u51b5\u3001\u670d\u52a1\u5668\u786c\u76d8\u3001CPU \u548c\u5185\u5b58\u4f7f\u7528\u91cf\u3002\u5177\u4f53\u51fd\u6570\u5b9e\u73b0\u53c2\u7167 [demo01/handler/sd/check.go](https://github.com/lexkong/apiserver_demos/blob/master/demo01/handler/sd/check.go)\u3002\n\n**\u8bbe\u7f6e HTTP Header**\n\n`router.Load` \u51fd\u6570\u901a\u8fc7 `g.Use()` \u6765\u4e3a\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u8bbe\u7f6e Header\uff0c\u5728 router/router.go \u6587\u4ef6\u4e2d\u8bbe\u7f6e Header\uff1a\n\n```go\n    g.Use(gin.Recovery())\n    g.Use(middleware.NoCache)\n    g.Use(middleware.Options)\n    g.Use(middleware.Secure)\n```\n\n+ `gin.Recovery()`\uff1a\u5728\u5904\u7406\u67d0\u4e9b\u8bf7\u6c42\u65f6\u53ef\u80fd\u56e0\u4e3a\u7a0b\u5e8f bug \u6216\u8005\u5176\u4ed6\u5f02\u5e38\u60c5\u51b5\u5bfc\u81f4\u7a0b\u5e8f panic\uff0c\u8fd9\u65f6\u5019\u4e3a\u4e86\u4e0d\u5f71\u54cd\u4e0b\u4e00\u6b21\u8bf7\u6c42\u7684\u8c03\u7528\uff0c\u9700\u8981\u901a\u8fc7 `gin.Recovery()`\u6765\u6062\u590d API \u670d\u52a1\u5668\n+ `middleware.NoCache`\uff1a\u5f3a\u5236\u6d4f\u89c8\u5668\u4e0d\u4f7f\u7528\u7f13\u5b58\n+ `middleware.Options`\uff1a\u6d4f\u89c8\u5668\u8de8\u57df OPTIONS \u8bf7\u6c42\u8bbe\u7f6e\n+ `middleware.Secure`\uff1a\u4e00\u4e9b\u5b89\u5168\u8bbe\u7f6e\n\n> `middleware`\u5305\u7684\u5b9e\u73b0\u89c1 [demo01/router/middleware](https://github.com/lexkong/apiserver_demos/tree/master/demo01/router/middleware)\u3002\n\n## API \u670d\u52a1\u5668\u5065\u5eb7\u72b6\u6001\u81ea\u68c0\n\n\u6709\u65f6\u5019 API \u8fdb\u7a0b\u8d77\u6765\u4e0d\u4ee3\u8868 API \u670d\u52a1\u5668\u6b63\u5e38\uff0c\u7b14\u8005\u66fe\u7ecf\u5c31\u9047\u5230\u8fc7\u8fd9\u79cd\u95ee\u9898\uff1aAPI \u8fdb\u7a0b\u5b58\u5728\uff0c\u4f46\u662f\u670d\u52a1\u5668\u5374\u4e0d\u80fd\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002\u56e0\u6b64\u5728\u542f\u52a8 API \u670d\u52a1\u5668\u65f6\uff0c\u5982\u679c\u80fd\u591f\u6700\u540e\u505a\u4e00\u4e2a\u81ea\u68c0\u4f1a\u66f4\u597d\u4e9b\u3002\u7b14\u8005\u5728 apiserver \u4e2d\u4e5f\u6dfb\u52a0\u4e86\u81ea\u68c0\u7a0b\u5e8f\uff0c\u5728\u542f\u52a8 HTTP \u7aef\u53e3\u524d go \u4e00\u4e2a `pingServer` \u534f\u7a0b\uff0c\u542f\u52a8 HTTP \u7aef\u53e3\u540e\uff0c\u8be5\u534f\u7a0b\u4e0d\u65ad\u5730 ping `/sd/health` \u8def\u5f84\uff0c\u5982\u679c\u5931\u8d25\u6b21\u6570\u8d85\u8fc7\u4e00\u5b9a\u6b21\u6570\uff0c\u5219\u7ec8\u6b62 HTTP \u670d\u52a1\u5668\u8fdb\u7a0b\u3002\u901a\u8fc7\u81ea\u68c0\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u5730\u4fdd\u8bc1\u542f\u52a8\u540e\u7684 API \u670d\u52a1\u5668\u5904\u4e8e\u5065\u5eb7\u72b6\u6001\u3002\u81ea\u68c0\u90e8\u5206\u4ee3\u7801\u4f4d\u4e8e main.go \u4e2d\uff1a\n\n```go\nfunc main() {\n    ....\n       \n    // Ping the server to make sure the router is working.\n    go func() {\n        if err := pingServer(); err != nil {\n            log.Fatal(\"The router has no response, or it might took too long to start up.\", err)\n        }   \n        log.Print(\"The router has been deployed successfully.\")\n    }()\n    ....\n}\n\n// pingServer pings the http server to make sure the router is working.\nfunc pingServer() error {\n    for i := 0; i < 10; i++ {\n        // Ping the server by sending a GET request to `/health`.\n        resp, err := http.Get(\"http://127.0.0.1:8080\" + \"/sd/health\")\n        if err == nil && resp.StatusCode == 200 {\n            return nil \n        }   \n       \n        // Sleep for a second to continue the next ping.\n        log.Print(\"Waiting for the router, retry in 1 second.\")\n        time.Sleep(time.Second)\n    }  \n    return errors.New(\"Cannot connect to the router.\")\n}   \n```\n\n\u5728 `pingServer()` \u51fd\u6570\u4e2d\uff0c`http.Get` \u5411 `http://127.0.0.1:8080/sd/health` \u53d1\u9001 HTTP GET \u8bf7\u6c42\uff0c\u5982\u679c\u51fd\u6570\u6b63\u786e\u6267\u884c\u5e76\u4e14\u8fd4\u56de\u7684 HTTP StatusCode \u4e3a 200\uff0c\u5219\u8bf4\u660e API \u670d\u52a1\u5668\u53ef\u7528\uff0c`pingServer` \u51fd\u6570\u8f93\u51fa\u90e8\u7f72\u6210\u529f\u63d0\u793a\uff1b\u5982\u679c\u8d85\u8fc7\u6307\u5b9a\u6b21\u6570\uff0c`pingServer` \u76f4\u63a5\u7ec8\u6b62 API Server \u8fdb\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163b007651a5d35f?w=1698&h=409&f=png&s=57328)\n\n> `/sd/health` \u8def\u5f84\u4f1a\u5339\u914d\u5230 `handler/sd/check.go` \u4e2d\u7684 `HealthCheck` \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u53ea\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\uff1aOK\u3002\n\n## \u7f16\u8bd1\u6e90\u7801\n\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\n```\n$ git clone https://github.com/lexkong/apiserver_demos\n```\n\n2. \u5c06 `apiserver_demos/demo01` \u590d\u5236\u4e3a `$GOPATH/src/apiserver` \n```\n$ cp -a apiserver_demos/demo01/ $GOPATH/src/apiserver\n```\n\n3. \u9996\u6b21\u7f16\u8bd1\u9700\u8981\u4e0b\u8f7d `vendor` \u5305\n    \n\u56e0\u4e3a apiserver \u529f\u80fd\u6bd4\u8f83\u4e30\u5bcc\uff0c\u9700\u8981\u7528\u5230\u5f88\u591a Go package\uff0c\u7edf\u8ba1\u4e86\u4e0b\u9700\u8981\u7528\u5230 60 \u4e2a\u975e\u6807\u51c6 Go \u5305\u3002\u4e3a\u4e86\u8ba9\u8bfb\u8005\u66f4\u5bb9\u6613\u5730\u4e0a\u624b\u7f16\u5199\u4ee3\u7801\uff0c\u8fd9\u91cc\u5c06\u8fd9\u4e9b\u4f9d\u8d56\u7528 go vendor \u8fdb\u884c\u7ba1\u7406\uff0c\u5e76\u653e\u5728 GitHub \u4e0a\u4f9b\u8bfb\u8005\u4e0b\u8f7d\u5b89\u88c5\uff0c\u5b89\u88c5\u65b9\u6cd5\u4e3a\uff1a\n\n```\n$ cd $GOPATH/src\n$ git clone https://github.com/lexkong/vendor\n```\n\n4. \u8fdb\u5165 apiserver \u76ee\u5f55\u7f16\u8bd1\u6e90\u4ee3\u7801\n\n```\n$ cd $GOPATH/src/apiserver\n$ gofmt -w .   \n$ go tool vet .\n$ go build -v .\n```\n\u7f16\u8bd1\u540e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u5b58\u653e\u5728\u5f53\u524d\u76ee\u5f55\uff0c\u540d\u5b57\u8ddf\u76ee\u5f55\u540d\u76f8\u540c\uff1a`apiserver`\u3002\n\n> \u7b14\u8005\u5efa\u8bae\u6bcf\u6b21\u7f16\u8bd1\u524d\u5bf9 Go \u6e90\u7801\u8fdb\u884c\u683c\u5f0f\u5316\u548c\u4ee3\u7801\u9759\u6001\u68c0\u67e5\uff0c\u4ee5\u53d1\u73b0\u6f5c\u5728\u7684 Bug \u6216\u53ef\u7591\u7684\u6784\u9020\u3002\n\n## cURL \u5de5\u5177\u6d4b\u8bd5 API\n\n**cURL \u5de5\u5177\u7b80\u4ecb**\n\n\u672c\u5c0f\u518c\u91c7\u7528 cURL \u5de5\u5177\u6765\u6d4b\u8bd5 RESTful API\uff0c\u6807\u51c6\u7684 Linux \u53d1\u884c\u7248\u90fd\u5b89\u88c5\u4e86 cURL \u5de5\u5177\u3002cURL \u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b8c\u6210\u5bf9 REST API \u7684\u8c03\u7528\u573a\u666f\uff0c\u6bd4\u5982\uff1a\u8bbe\u7f6e Header\uff0c\u6307\u5b9a HTTP \u8bf7\u6c42\u65b9\u6cd5\uff0c\u6307\u5b9a HTTP \u6d88\u606f\u4f53\uff0c\u6307\u5b9a\u6743\u9650\u8ba4\u8bc1\u4fe1\u606f\u7b49\u3002\u901a\u8fc7 `-v` \u9009\u9879\u4e5f\u80fd\u8f93\u51fa REST \u8bf7\u6c42\u7684\u6240\u6709\u8fd4\u56de\u4fe1\u606f\u3002cURL \u529f\u80fd\u5f88\u5f3a\u5927\uff0c\u6709\u5f88\u591a\u53c2\u6570\uff0c\u8fd9\u91cc\u5217\u51fa REST \u6d4b\u8bd5\u5e38\u7528\u7684\u53c2\u6570\uff1a\n\n```\n-X/--request [GET|POST|PUT|DELETE|\u2026]  \u6307\u5b9a\u8bf7\u6c42\u7684 HTTP \u65b9\u6cd5\n-H/--header                           \u6307\u5b9a\u8bf7\u6c42\u7684 HTTP Header\n-d/--data                             \u6307\u5b9a\u8bf7\u6c42\u7684 HTTP \u6d88\u606f\u4f53\uff08Body\uff09\n-v/--verbose                          \u8f93\u51fa\u8be6\u7ec6\u7684\u8fd4\u56de\u4fe1\u606f\n-u/--user                             \u6307\u5b9a\u8d26\u53f7\u3001\u5bc6\u7801\n-b/--cookie                           \u8bfb\u53d6 cookie  \n```\n\n\u5178\u578b\u7684\u6d4b\u8bd5\u547d\u4ee4\u4e3a\uff1a\n\n```\n$ curl -v -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/user -d'{\"username\":\"admin\",\"password\":\"admin1234\"}'\n```\n\n**\u542f\u52a8 API Server**\n\n```\n$ ./apiserver\n[GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production.\n - using env:   export GIN_MODE=release\n - using code:  gin.SetMode(gin.ReleaseMode)\n\n[GIN-debug] GET    /sd/health                --> apiserver/handler/sd.HealthCheck (5 handlers)\n[GIN-debug] GET    /sd/disk                  --> apiserver/handler/sd.DiskCheck (5 handlers)\n[GIN-debug] GET    /sd/cpu                   --> apiserver/handler/sd.CPUCheck (5 handlers)\n[GIN-debug] GET    /sd/ram                   --> apiserver/handler/sd.RAMCheck (5 handlers)\nStart to listening the incoming requests on http address: :8080\nThe router has been deployed successfully.\n```\n\n**\u53d1\u9001 HTTP GET \u8bf7\u6c42**\n\n```bash\n$ curl -XGET http://127.0.0.1:8080/sd/health\nOK\n\n$ curl -XGET http://127.0.0.1:8080/sd/disk\nOK - Free space: 16321MB (15GB) / 51200MB (50GB) | Used: 31%\n\n$ curl -XGET http://127.0.0.1:8080/sd/cpu\nCRITICAL - Load average: 2.39, 2.13, 1.97 | Cores: 2\n\n$ curl -XGET http://127.0.0.1:8080/sd/ram\nOK - Free space: 455MB (0GB) / 8192MB (8GB) | Used: 5%\n```\n\n\u53ef\u4ee5\u770b\u5230 HTTP \u670d\u52a1\u5668\u5747\u80fd\u6b63\u786e\u54cd\u5e94\u8bf7\u6c42\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u8282\u901a\u8fc7\u5177\u4f53\u7684\u4f8b\u5b50\u6559\u8bfb\u8005\u5feb\u901f\u542f\u52a8\u4e00\u4e2a API \u670d\u52a1\u5668\uff0c\u8fd9\u53ea\u662f\u4e00\u4e2a\u7a0d\u5fae\u590d\u6742\u70b9\u7684 \"Hello World\"\u3002\u8bfb\u8005\u53ef\u4ee5\u5148\u901a\u8fc7\u8be5 Hello World \u719f\u6089 Go API \u5f00\u53d1\u6d41\u7a0b\uff0c\u540e\u7eed\u5c0f\u8282\u4f1a\u57fa\u4e8e\u8fd9\u4e2a\u7b80\u5355\u7684 API \u670d\u52a1\u5668\uff0c\u4e00\u6b65\u6b65\u6784\u5efa\u4e00\u4e2a\u4f01\u4e1a\u7ea7\u7684 API \u670d\u52a1\u5668\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/4\u57fa\u7840_1\u542f\u52a8\u4e00\u4e2a\u6700\u7b80\u5355\u7684_RESTful_API_\u670d\u52a1\u5668.md", "create_date": "2020-02-18T21:37:38.190", "order": 5}}, {"model": "subject.chapter", "pk": 124, "fields": {"title": "\u57fa\u7840 5\uff1a\u521d\u59cb\u5316 MySQL \u6570\u636e\u5e93\u5e76\u5efa\u7acb\u8fde\u63a5", "topic": 6, "md5": "7b635d9ad4703b1940e5e2ec942a0de2", "md_body": "# \u521d\u59cb\u5316 MySQL \u6570\u636e\u5e93\u5e76\u5efa\u7acb\u8fde\u63a5\n\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\n\n+ Go ORM \u6570\u91cf\u4f17\u591a\uff0c\u672c\u5c0f\u518c\u4ecb\u7ecd\u4e00\u4e2a\u7b14\u8005\u8ba4\u4e3a\u6bd4\u8f83\u597d\u7684 ORM \u5305\uff0c\u5e76\u7ed9\u51fa\u539f\u56e0\n+ \u4ecb\u7ecd\u5982\u4f55\u521d\u59cb\u5316\u6570\u636e\u5e93\n+ \u4ecb\u7ecd\u5982\u4f55\u8fde\u63a5\u6570\u636e\u5e93\n\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo04](https://github.com/lexkong/apiserver_demos/tree/master/demo04)\n>\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\n>\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo03](https://github.com/lexkong/apiserver_demos/tree/master/demo03) \u6765\u5f00\u53d1\u7684\u3002\n>\n> apiserver \u7528\u7684 ORM \u662f GitHub \u4e0a star \u6570\u6700\u591a\u7684 [gorm](https://github.com/jinzhu/gorm)\uff0c\u76f8\u8f83\u4e8e\u5176\u4ed6 ORM\uff0c\u5b83\u7528\u8d77\u6765\u66f4\u65b9\u4fbf\uff0c\u66f4\u7a33\u5b9a\uff0c\u793e\u533a\u4e5f\u66f4\u6d3b\u8dc3\u3002\n\n\n## \u521d\u59cb\u5316\u6570\u636e\u5e93\n\n**\u5728 `model/init.go` \u4e2d\u6dfb\u52a0\u6570\u636e\u521d\u59cb\u5316\u4ee3\u7801**\n\n\u56e0\u4e3a\u4e00\u4e2a API \u670d\u52a1\u5668\u53ef\u80fd\u9700\u8981\u540c\u65f6\u8bbf\u95ee\u591a\u4e2a\u6570\u636e\u5e93\uff0c\u4e3a\u4e86\u5bf9\u591a\u4e2a\u6570\u636e\u5e93\u8fdb\u884c\u521d\u59cb\u5316\u548c\u8fde\u63a5\u7ba1\u7406\uff0c\u8fd9\u91cc\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53eb `Database` \u7684 struct\uff1a\n\n```go\ntype Database struct {\n    Self   *gorm.DB\n    Docker *gorm.DB\n} \n```\n\n`Database` \u7ed3\u6784\u4f53\u6709\u4e2a `Init()` \u65b9\u6cd5\u7528\u6765\u521d\u59cb\u5316\u8fde\u63a5\uff1a\n\n```go\nfunc (db *Database) Init() {\n    DB = &Database {\n        Self:   GetSelfDB(),\n        Docker: GetDockerDB(),\n    }\n} \n```\n\n`Init()` \u51fd\u6570\u4f1a\u8c03\u7528 `GetSelfDB()` \u548c `GetDockerDB()` \u65b9\u6cd5\u6765\u540c\u65f6\u521b\u5efa\u4e24\u4e2a `Database` \u7684\u6570\u636e\u5e93\u5bf9\u8c61\u3002\u8fd9\u4e24\u4e2a Get \u65b9\u6cd5\u6700\u7ec8\u90fd\u4f1a\u8c03\u7528 `func openDB(username, password, addr, name string) *gorm.DB` \u65b9\u6cd5\u6765\u5efa\u7acb\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u4e0d\u540c\u6570\u636e\u5e93\u5b9e\u4f8b\u4f20\u5165\u4e0d\u540c\u7684 username\u3001password\u3001addr \u548c\u540d\u5b57\u4fe1\u606f\uff0c\u4ece\u800c\u5efa\u7acb\u4e0d\u540c\u7684\u6570\u636e\u5e93\u8fde\u63a5\u3002`openDB` \u51fd\u6570\u4e3a\uff1a\n\n```go\nfunc openDB(username, password, addr, name string) *gorm.DB {\n    config := fmt.Sprintf(\"%s:%s@tcp(%s)/%s?charset=utf8&parseTime=%t&loc=%s\",\n        username,   \n        password,   \n        addr,\n        name,\n        true,\n        //\"Asia/Shanghai\"),\n        \"Local\")    \n       \n    db, err := gorm.Open(\"mysql\", config)\n    if err != nil { \n        log.Errorf(err, \"Database connection failed. Database name: %s\", name)\n    }  \n       \n    // set for db connection\n    setupDB(db)     \n       \n    return db\n}      \n```\n\n\u53ef\u4ee5\u770b\u5230\uff0c`openDB()` \u6700\u7ec8\u8c03\u7528 `gorm.Open()` \u6765\u5efa\u7acb\u4e00\u4e2a\u6570\u636e\u5e93\u8fde\u63a5\u3002\n\n\u5b8c\u6574\u7684 model/init.go \u6e90\u7801\u6587\u4ef6\u8bf7\u53c2\u8003 [demo04/model/init.go](https://github.com/lexkong/apiserver_demos/tree/master/demo04)\u3002\n\n**\u4e3b\u51fd\u6570\u4e2d\u589e\u52a0\u6570\u636e\u5e93\u521d\u59cb\u5316\u5165\u53e3**\n\n```go\npackage main\n        \nimport (\n    ...\n    \"apiserver/model\"\n        \n    ...\n)       \n        \n...      \n        \nfunc main() {\n    ...\n    \n    // init db\n    model.DB.Init()\n    defer model.DB.Close()\n        \n    ...\n}\n```\n\n\u901a\u8fc7 `model.DB.Init()` \u6765\u5efa\u7acb\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u901a\u8fc7 `defer model.DB.Close()` \u6765\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u3002\n\n## \u7f16\u8bd1\u5e76\u8fd0\u884c\n\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\n\n```\n$ git clone https://github.com/lexkong/apiserver_demos\n```\n\n2. \u5c06`apiserver_demos/demo04`\u590d\u5236\u4e3a`$GOPATH/src/apiserver`\n```\n$ cp -a apiserver_demos/demo04/ $GOPATH/src/apiserver\n```\n\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\n\n```\n$ cd $GOPATH/src/apiserver\n$ gofmt -w .\n$ go tool vet .\n$ go build -v .\n```\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u7ed3\u4ecb\u7ecd\u4e86\u5982\u4f55\u7528 `gorm` \u5efa\u7acb\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u4e3a\u4e4b\u540e\u7684\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u4f5c\u51c6\u5907\u3002\u81f3\u4e8e\u5177\u4f53\u600e\u4e48\u4f7f\u7528 `gorm` \u6765\u8fdb\u884c\u589e\u5220\u6539\u67e5\u7b49\u64cd\u4f5c\uff0c\u8bf7\u53c2\u8003 [GORM \u6307\u5357](http://gorm.io/zh_CN/docs/index.html)\u3002\n\n> \u672c\u5c0f\u8282\u53ea\u662f\u4ecb\u7ecd\u4e86\u5982\u4f55\u521d\u59cb\u5316\u6570\u636e\u5e93\uff0c\u81f3\u4e8e\u600e\u4e48\u5bf9\u6570\u636e\u5e93\u505a CURD \u64cd\u4f5c\uff0c\u8bf7\u53c2\u8003\u7b2c 12 \u8282\uff1a\u7528\u6237\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/8\u57fa\u7840_5\u521d\u59cb\u5316_MySQL_\u6570\u636e\u5e93\u5e76\u5efa\u7acb\u8fde\u63a5.md", "create_date": "2020-02-18T21:37:38.203", "order": 9}}, {"model": "subject.chapter", "pk": 125, "fields": {"title": "\u57fa\u7840 2\uff1a\u914d\u7f6e\u6587\u4ef6\u8bfb\u53d6", "topic": 6, "md5": "8b4893137d46798afff2cb5ffb3ea1f8", "md_body": "# \u914d\u7f6e\u6587\u4ef6\u8bfb\u53d6\n\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\n\n+ \u4ecb\u7ecd apiserver \u6240\u91c7\u7528\u7684\u914d\u7f6e\u89e3\u51b3\u65b9\u6848\n+ \u4ecb\u7ecd\u5982\u4f55\u914d\u7f6e apiserver \u5e76\u8bfb\u53d6\u5176\u914d\u7f6e\uff0c\u4ee5\u53ca\u914d\u7f6e\u7684\u9ad8\u7ea7\u7528\u6cd5\n\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo02](https://github.com/lexkong/apiserver_demos/tree/master/demo02)\n>\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\n>\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo01](https://github.com/lexkong/apiserver_demos/tree/master/demo01) \u6765\u5f00\u53d1\u7684\u3002\n\n## Viper \u7b80\u4ecb\n\n[Viper](https://github.com/spf13/viper) \u662f\u56fd\u5916\u5927\u795e **spf13** \u7f16\u5199\u7684\u5f00\u6e90\u914d\u7f6e\u89e3\u51b3\u65b9\u6848\uff0c\u5177\u6709\u5982\u4e0b\u7279\u6027:\n+ \u8bbe\u7f6e\u9ed8\u8ba4\u503c\n+ \u53ef\u4ee5\u8bfb\u53d6\u5982\u4e0b\u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\uff1aJSON\u3001TOML\u3001YAML\u3001HCL\n+ \u76d1\u63a7\u914d\u7f6e\u6587\u4ef6\u6539\u52a8\uff0c\u5e76\u70ed\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\n+ \u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6\u914d\u7f6e\n+ \u4ece\u8fdc\u7a0b\u914d\u7f6e\u4e2d\u5fc3\u8bfb\u53d6\u914d\u7f6e\uff08etcd/consul\uff09\uff0c\u5e76\u76d1\u63a7\u53d8\u52a8\n+ \u4ece\u547d\u4ee4\u884c flag \u8bfb\u53d6\u914d\u7f6e\n+ \u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u914d\u7f6e\n+ \u652f\u6301\u76f4\u63a5\u8bbe\u7f6e\u914d\u7f6e\u9879\u7684\u503c\n\nViper \u914d\u7f6e\u8bfb\u53d6\u987a\u5e8f\uff1a\n+ `viper.Set()` \u6240\u8bbe\u7f6e\u7684\u503c\n+ \u547d\u4ee4\u884c flag\n+ \u73af\u5883\u53d8\u91cf\n+ \u914d\u7f6e\u6587\u4ef6\n+ \u914d\u7f6e\u4e2d\u5fc3\uff1aetcd/consul\n+ \u9ed8\u8ba4\u503c\n\n\u4ece\u4e0a\u9762\u8fd9\u4e9b\u7279\u6027\u6765\u770b\uff0cViper \u6beb\u65e0\u7591\u95ee\u662f\u975e\u5e38\u5f3a\u5927\u7684\uff0c\u800c\u4e14 Viper \u7528\u8d77\u6765\u4e5f\u5f88\u65b9\u4fbf\uff0c\u5728\u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u8bfb\u53d6\u914d\u7f6e\u53ea\u9700\u8981\u8c03\u7528 `viper.GetString()`\u3001`viper.GetInt()` \u548c `viper.GetBool()` \u7b49\u51fd\u6570\u5373\u53ef\u3002\n\nViper \u4e5f\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u8bfb\u53d6\u591a\u4e2a\u5c42\u7ea7\u7684\u914d\u7f6e\uff0c\u6bd4\u5982\u8fd9\u6837\u4e00\u4e2a YAML \u683c\u5f0f\u7684\u914d\u7f6e\uff1a\n\n```yaml\ncommon:\n  database:\n    name: test\n    host: 127.0.0.1\n```\n\u5982\u679c\u8981\u8bfb\u53d6 host \u914d\u7f6e\uff0c\u6267\u884c `viper.GetString(\"common.database.host\")` \u5373\u53ef\u3002\n\napiserver \u91c7\u7528 YAML \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u91c7\u7528 YAML \u683c\u5f0f\uff0c\u662f\u56e0\u4e3a YAML \u8868\u8fbe\u7684\u683c\u5f0f\u66f4\u4e30\u5bcc\uff0c\u53ef\u8bfb\u6027\u66f4\u5f3a\u3002\n\n## \u521d\u59cb\u5316\u914d\u7f6e\n\n**\u4e3b\u51fd\u6570\u4e2d\u589e\u52a0\u914d\u7f6e\u521d\u59cb\u5316\u5165\u53e3**\n\n```go\npackage main\n\nimport (\n\t\"errors\"\n\t\"log\"\n\t\"net/http\"\n\t\"time\"\n\n\t\"apiserver/config\"\n\t\n\t ...\n\t\n\t\"github.com/spf13/pflag\"\n)\n\nvar (\n\tcfg = pflag.StringP(\"config\", \"c\", \"\", \"apiserver config file path.\")\n)\n\nfunc main() {\n\tpflag.Parse()\n\n\t// init config\n\tif err := config.Init(*cfg); err != nil {\n\t\tpanic(err)\n\t}\n\n\t// Create the Gin engine.\n\tg := gin.New()\n\n\t...\n}\n\n```\n\n\u5728 `main` \u51fd\u6570\u4e2d\u589e\u52a0\u4e86 `config.Init(*cfg)` \u8c03\u7528\uff0c\u7528\u6765\u521d\u59cb\u5316\u914d\u7f6e\uff0c`cfg` \u53d8\u91cf\u503c\u4ece\u547d\u4ee4\u884c flag \u4f20\u5165\uff0c\u53ef\u4ee5\u4f20\u503c\uff0c\u6bd4\u5982 `./apiserver -c config.yaml`\uff0c\u4e5f\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u5982\u679c\u4e3a\u7a7a\u4f1a\u9ed8\u8ba4\u8bfb\u53d6 `conf/config.yaml`\u3002\n\n\n**\u89e3\u6790\u914d\u7f6e**\n\n`main` \u51fd\u6570\u901a\u8fc7 `config.Init` \u51fd\u6570\u6765\u89e3\u6790\u5e76 watch \u914d\u7f6e\u6587\u4ef6\uff08\u51fd\u6570\u8def\u5f84\uff1a`config/config.go`\uff09\uff0cconfig.go \u6e90\u7801\u4e3a\uff1a\n\n```go\npackage config\n\nimport (\n\t\"log\"\n\t\"strings\"\n\n\t\"github.com/fsnotify/fsnotify\"\n\t\"github.com/spf13/viper\"\n)\n\ntype Config struct {\n\tName string\n}\n\nfunc Init(cfg string) error {\n\tc := Config {\n\t\tName: cfg,\n\t}\n\n\t// \u521d\u59cb\u5316\u914d\u7f6e\u6587\u4ef6\n\tif err := c.initConfig(); err != nil {\n\t\treturn err\n\t}\n\n\t// \u76d1\u63a7\u914d\u7f6e\u6587\u4ef6\u53d8\u5316\u5e76\u70ed\u52a0\u8f7d\u7a0b\u5e8f\n\tc.watchConfig()\n\n\treturn nil\n}\n\nfunc (c *Config) initConfig() error {\n\tif c.Name != \"\" {\n\t\tviper.SetConfigFile(c.Name) // \u5982\u679c\u6307\u5b9a\u4e86\u914d\u7f6e\u6587\u4ef6\uff0c\u5219\u89e3\u6790\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\n\t} else {\n\t\tviper.AddConfigPath(\"conf\") // \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\uff0c\u5219\u89e3\u6790\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\n\t\tviper.SetConfigName(\"config\")\n\t}\n\tviper.SetConfigType(\"yaml\") // \u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f\u4e3aYAML\n\tviper.AutomaticEnv() // \u8bfb\u53d6\u5339\u914d\u7684\u73af\u5883\u53d8\u91cf\n\tviper.SetEnvPrefix(\"APISERVER\") // \u8bfb\u53d6\u73af\u5883\u53d8\u91cf\u7684\u524d\u7f00\u4e3aAPISERVER\n\treplacer := strings.NewReplacer(\".\", \"_\") \n\tviper.SetEnvKeyReplacer(replacer)\n\tif err := viper.ReadInConfig(); err != nil { // viper\u89e3\u6790\u914d\u7f6e\u6587\u4ef6\n\t\treturn err\n\t}\n\n\treturn nil\n}\n\n// \u76d1\u63a7\u914d\u7f6e\u6587\u4ef6\u53d8\u5316\u5e76\u70ed\u52a0\u8f7d\u7a0b\u5e8f\nfunc (c *Config) watchConfig() {\n\tviper.WatchConfig()\n\tviper.OnConfigChange(func(e fsnotify.Event) {\n\t\tlog.Printf(\"Config file changed: %s\", e.Name)\n\t})\n}\n\n```\n\n`config.Init()` \u901a\u8fc7 `initConfig()` \u51fd\u6570\u6765\u89e3\u6790\u914d\u7f6e\u6587\u4ef6\uff0c\u901a\u8fc7 `watchConfig()` \u51fd\u6570\u6765 watch \u914d\u7f6e\u6587\u4ef6\uff0c\u4e24\u4e2a\u51fd\u6570\u89e3\u6790\u5982\u4e0b\uff1a\n1. `func (c *Config) initConfig() error`\n\n    \u8bbe\u7f6e\u5e76\u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u3002\u5982\u679c\u6307\u5b9a\u4e86\u914d\u7f6e\u6587\u4ef6 `*cfg` \u4e0d\u4e3a\u7a7a\uff0c\u5219\u89e3\u6790\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5426\u5219\u89e3\u6790\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6 `conf/config.yaml`\u3002\u901a\u8fc7\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8fde\u63a5\u4e0d\u540c\u7684\u73af\u5883\uff08\u5f00\u53d1\u73af\u5883\u3001\u6d4b\u8bd5\u73af\u5883\uff09\u5e76\u52a0\u8f7d\u4e0d\u540c\u7684\u914d\u7f6e\uff0c\u65b9\u4fbf\u5f00\u53d1\u548c\u6d4b\u8bd5\u3002\n\n    \u901a\u8fc7\u5982\u4e0b\u8bbe\u7f6e\n\n    ```go\n    viper.AutomaticEnv() \n    viper.SetEnvPrefix(\"APISERVER\")\n    replacer := strings.NewReplacer(\".\", \"_\")\n    ```\n    \u53ef\u4ee5\u4f7f\u7a0b\u5e8f\u8bfb\u53d6\u73af\u5883\u53d8\u91cf\uff0c\u5177\u4f53\u6548\u679c\u7a0d\u540e\u4f1a\u6f14\u793a\u3002\n\n    `config.Init` \u51fd\u6570\u4e2d\u7684 `viper.ReadInConfig()` \u51fd\u6570\u6700\u7ec8\u4f1a\u8c03\u7528 Viper \u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u3002\n\n2. `func (c *Config) watchConfig()`\n\n    \u901a\u8fc7\u8be5\u51fd\u6570\u7684 viper \u8bbe\u7f6e\uff0c\u53ef\u4ee5\u4f7f viper \u76d1\u63a7\u914d\u7f6e\u6587\u4ef6\u53d8\u66f4\uff0c\u5982\u6709\u53d8\u66f4\u5219\u70ed\u66f4\u65b0\u7a0b\u5e8f\u3002\u6240\u8c13\u70ed\u66f4\u65b0\u662f\u6307\uff1a\u53ef\u4ee5\u4e0d\u91cd\u542f API \u8fdb\u7a0b\uff0c\u4f7f API \u52a0\u8f7d\u6700\u65b0\u914d\u7f6e\u9879\u7684\u503c\u3002\n\n## \u914d\u7f6e\u5e76\u8bfb\u53d6\u914d\u7f6e\n\nAPI \u670d\u52a1\u5668\u7aef\u53e3\u53f7\u53ef\u80fd\u7ecf\u5e38\u9700\u8981\u53d8\u66f4\uff0cAPI \u670d\u52a1\u5668\u542f\u52a8\u65f6\u95f4\u53ef\u80fd\u4f1a\u53d8\u957f\uff0c\u81ea\u68c0\u7a0b\u5e8f\u8d85\u65f6\u65f6\u95f4\u9700\u8981\u662f\u53ef\u914d\u7684\uff08\u901a\u8fc7\u8bbe\u7f6e\u6b21\u6570\uff09\uff0c\u53e6\u5916 API \u9700\u8981\u6839\u636e\u4e0d\u540c\u7684\u5f00\u53d1\u6a21\u5f0f\uff08\u5f00\u53d1\u3001\u751f\u4ea7\u3001\u6d4b\u8bd5\uff09\u6765\u5339\u914d\u4e0d\u540c\u7684\u884c\u4e3a\u3002\u5f00\u53d1\u6a21\u5f0f\u4e5f\u9700\u8981\u662f\u53ef\u914d\u7f6e\u7684\uff0c\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\uff0c\u65b0\u5efa\u914d\u7f6e\u6587\u4ef6 `conf/config.yaml`\uff08\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u540d\u5b57\u56fa\u5b9a\u4e3a `config.yaml`\uff09\uff0c`config.yaml` \u7684\u5185\u5bb9\u4e3a\uff1a\n\n```yaml\nrunmode: debug               # \u5f00\u53d1\u6a21\u5f0f, debug, release, test\naddr: :6663                  # HTTP\u7ed1\u5b9a\u7aef\u53e3\nname: apiserver              # API Server\u7684\u540d\u5b57\nurl: http://127.0.0.1:6663   # pingServer\u51fd\u6570\u8bf7\u6c42\u7684API\u670d\u52a1\u5668\u7684ip:port\nmax_ping_count: 10           # pingServer\u51fd\u6570\u5c1d\u8bd5\u7684\u6b21\u6570\n```\n\n\u5728 `main` \u51fd\u6570\u4e2d\u5c06\u76f8\u5e94\u7684\u914d\u7f6e\u6539\u6210\u4ece\u914d\u7f6e\u6587\u4ef6\u8bfb\u53d6\uff0c\u9700\u8981\u66ff\u6362\u7684\u914d\u7f6e\u89c1\u4e0b\u56fe\u4e2d\u7ea2\u6846\u90e8\u5206\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163b187c103c8d6a?w=2124&h=1188&f=jpeg&s=199767)\n\n\u66ff\u6362\u540e\uff0c\u4ee3\u7801\u4e3a\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163b186688700fb1?w=2290&h=1177&f=jpeg&s=225497)\n\n\n\u53e6\u5916\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u7684 `runmode` \u8c03\u7528 `gin.SetMode` \u6765\u8bbe\u7f6e gin \u7684\u8fd0\u884c\u6a21\u5f0f\uff1a\n\n```go\nfunc main() { \n    pflag.Parse()\n                 \n    // init config\n    if err := config.Init(*cfg); err != nil {\n        panic(err)\n    }            \n                 \n    // Set gin mode.\n    gin.SetMode(viper.GetString(\"runmode\"))\n                 \n    ....\n                 \n}\n```\n\ngin \u6709 3 \u79cd\u8fd0\u884c\u6a21\u5f0f\uff1adebug\u3001release \u548c test\uff0c\u5176\u4e2d debug \u6a21\u5f0f\u4f1a\u6253\u5370\u5f88\u591a debug \u4fe1\u606f\u3002\n\n## \u7f16\u8bd1\u5e76\u8fd0\u884c\n\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\n```\n$ git clone https://github.com/lexkong/apiserver_demos\n```\n\n2. \u5c06 `apiserver_demos/demo02` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\n```\n$ cp -a apiserver_demos/demo02/ $GOPATH/src/apiserver\n```\n\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\n\n```\n$ cd $GOPATH/src/apiserver\n$ gofmt -w .\n$ go tool vet .\n$ go build -v .\n```\n\n4. \u4fee\u6539 `conf/config.yaml` \u5c06\u7aef\u53e3\u4fee\u6539\u4e3a `8888`\uff0c\u5e76\u542f\u52a8 apiserver\n\n\u4fee\u6539\u540e\u914d\u7f6e\u6587\u4ef6\u4e3a\uff1a\n\n```yaml\nrunmode: debug               # \u5f00\u53d1\u6a21\u5f0f, debug, release, test\naddr: :8888                  # HTTP\u7ed1\u5b9a\u7aef\u53e3\nname: apiserver              # API Server\u7684\u540d\u5b57\nurl: http://127.0.0.1:8888   # pingServer\u51fd\u6570\u8bf7\u6c42\u7684API\u670d\u52a1\u5668\u7684ip:port\nmax_ping_count: 10           # pingServer\u51fd\u6570try\u7684\u6b21\u6570\n```\n\n\u4fee\u6539\u540e\u542f\u52a8 apiserver\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163b196425b26f4c?w=2096&h=450&f=jpeg&s=123918)\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u542f\u52a8 apiserver \u540e\u7aef\u53e3\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u7aef\u53e3\u3002\n\n## Viper \u9ad8\u7ea7\u7528\u6cd5\n\n**\u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6\u914d\u7f6e**\n\n\u5728\u672c\u8282\u7b2c\u4e00\u90e8\u5206\u4ecb\u7ecd\u8fc7\uff0cViper \u53ef\u4ee5\u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6\u914d\u7f6e\uff0c\u8fd9\u662f\u4e2a\u975e\u5e38\u6709\u7528\u7684\u529f\u80fd\u3002\u73b0\u5728\u8d8a\u6765\u8d8a\u591a\u7684\u7a0b\u5e8f\u662f\u8fd0\u884c\u5728 Kubernetes \u5bb9\u5668\u96c6\u7fa4\u4e2d\u7684\uff0c\u5728 API \u670d\u52a1\u5668\u8fc1\u79fb\u5230\u5bb9\u5668\u96c6\u7fa4\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 Kubernetes \u6765\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u7136\u540e\u7a0b\u5e8f\u8bfb\u53d6\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\u6765\u914d\u7f6e API \u670d\u52a1\u5668\u3002\u8bfb\u8005\u4e0d\u9700\u8981\u4e86\u89e3\u5982\u4f55\u901a\u8fc7 Kubernetes \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u53ea\u9700\u8981\u77e5\u9053 Viper \u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u73af\u5883\u53d8\u91cf\u5373\u53ef\u3002\n\n\u4f8b\u5982\uff0c\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6765\u8bbe\u7f6e API Server \u7aef\u53e3\uff1a\n\n```\n$ export APISERVER_ADDR=:7777\n$ export APISERVER_URL=http://127.0.0.1:7777\n$ ./apiserver \n[GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production.\n - using env:\texport GIN_MODE=release\n - using code:\tgin.SetMode(gin.ReleaseMode)\n\n[GIN-debug] GET    /sd/health                --> apiserver/handler/sd.HealthCheck (5 handlers)\n[GIN-debug] GET    /sd/disk                  --> apiserver/handler/sd.DiskCheck (5 handlers)\n[GIN-debug] GET    /sd/cpu                   --> apiserver/handler/sd.CPUCheck (5 handlers)\n[GIN-debug] GET    /sd/ram                   --> apiserver/handler/sd.RAMCheck (5 handlers)\nStart to listening the incoming requests on http address: :7777\nThe router has been deployed successfully.\n```\n\n\u4ece\u8f93\u51fa\u53ef\u4ee5\u770b\u5230\uff0c\u8bbe\u7f6e `APISERVER_ADDR=:7777` \u548c `APISERVER_URL=http://127.0.0.1:7777` \u540e\uff0c\u542f\u52a8 apiserver\uff0cAPI \u670d\u52a1\u5668\u7684\u7aef\u53e3\u53d8\u4e3a `7777`\u3002\n\n\u73af\u5883\u53d8\u91cf\u540d\u683c\u5f0f\u4e3a `config/config.go` \u6587\u4ef6\u4e2d `viper.SetEnvPrefix(\"APISERVER\")` \u6240\u8bbe\u7f6e\u7684\u524d\u7f00\u548c\u914d\u7f6e\u540d\u79f0\u5927\u5199\uff0c\u4e8c\u8005\u7528 `_` \u8fde\u63a5\uff0c\u6bd4\u5982 `APISERVER_RUNMODE`\u3002\u5982\u679c\u914d\u7f6e\u9879\u662f\u5d4c\u5957\u7684\uff0c\u60c5\u51b5\u53ef\u7c7b\u63a8\uff0c\u6bd4\u5982\n\n```yaml\n....\nmax_ping_count: 10           # pingServer\u51fd\u6570try\u7684\u6b21\u6570\ndb:                    \n  name: db_apiserver\n```\n\n\u5bf9\u5e94\u7684\u73af\u5883\u53d8\u91cf\u540d\u4e3a `APISERVER_DB_NAME`\u3002\n\n**\u70ed\u66f4\u65b0**\n\n\u5728 `main` \u51fd\u6570\u4e2d\u6dfb\u52a0\u5982\u4e0b\u6d4b\u8bd5\u4ee3\u7801\uff08`for {}` \u90e8\u5206\uff0c\u5faa\u73af\u6253\u5370 `runmode` \u7684\u503c\uff09\uff1a\n\n```go\nimport (\n    \"fmt\"\n    ....\n)\n\nvar (\n    cfg = pflag.StringP(\"config\", \"c\", \"\", \"apiserver config file path.\")\n)\n\nfunc main() {\n    pflag.Parse()\n\n    // init config\n    \tif err := config.Init(*cfg); err != nil {\n    \tpanic(err)\n    }\n\n    for {\n        fmt.Println(viper.GetString(\"runmode\"))\n        time.Sleep(4*time.Second)\n    }\n    ....\n}\n```\n\n\u7f16\u8bd1\u5e76\u542f\u52a8 `apiserver` \u540e\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4e2d `runmode` \u4e3a `test`\uff0c\u53ef\u4ee5\u770b\u5230 `runmode` \u7684\u503c\u4ece `debug` \u53d8\u4e3a `test`\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/5/30/163b1badcd31585c?w=1626&h=236&f=jpeg&s=46035)\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u8282\u5c55\u793a\u4e86\u5982\u4f55\u7528\u5f3a\u5927\u7684\u914d\u7f6e\u7ba1\u7406\u5de5\u5177 Viper \u6765\u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u5e76\u8bfb\u53d6\u914d\u7f6e\uff0c\u8fd8\u6f14\u793a\u4e86 Viper \u7684\u9ad8\u7ea7\u7528\u6cd5\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/5\u57fa\u7840_2\u914d\u7f6e\u6587\u4ef6\u8bfb\u53d6.md", "create_date": "2020-02-18T21:37:38.229", "order": 6}}, {"model": "subject.chapter", "pk": 126, "fields": {"title": "\u57fa\u7840 7\uff1a\u8bfb\u53d6\u548c\u8fd4\u56de HTTP \u8bf7\u6c42", "topic": 6, "md5": "a27558633dcb2b1829628cc842334449", "md_body": "# \u8bfb\u53d6\u548c\u8fd4\u56de HTTP \u8bf7\u6c42\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u5982\u4f55\u8bfb\u53d6 HTTP \u8bf7\u6c42\u6570\u636e\r\n+ \u5982\u4f55\u8fd4\u56de\u6570\u636e\r\n+ \u5982\u4f55\u5b9a\u5236\u4e1a\u52a1\u7684\u8fd4\u56de\u683c\u5f0f\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo06](https://github.com/lexkong/apiserver_demos/tree/master/demo06)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo05](https://github.com/lexkong/apiserver_demos/tree/master/demo05) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## \u8bfb\u53d6\u548c\u8fd4\u56de\u53c2\u6570\r\n\r\n\u5728\u4e1a\u52a1\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u8bfb\u53d6\u8bf7\u6c42\u53c2\u6570\uff08\u6d88\u606f\u4f53\u548c HTTP Header\uff09\uff0c\u7ecf\u8fc7\u4e1a\u52a1\u5904\u7406\u540e\u8fd4\u56de\u6307\u5b9a\u683c\u5f0f\u7684\u6d88\u606f\u3002apiserver \u4e5f\u5c55\u793a\u4e86\u5982\u4f55\u8fdb\u884c\u53c2\u6570\u7684\u8bfb\u53d6\u548c\u8fd4\u56de\uff0c\u4e0b\u9762\u5c55\u793a\u4e86\u5982\u4f55\u8bfb\u53d6\u548c\u8fd4\u56de\u53c2\u6570\uff1a\r\n\r\n**\u8bfb\u53d6 HTTP \u4fe1\u606f\uff1a** \u5728 API \u5f00\u53d1\u4e2d\u9700\u8981\u8bfb\u53d6\u7684\u53c2\u6570\u901a\u5e38\u4e3a\uff1aHTTP Header\u3001\u8def\u5f84\u53c2\u6570\u3001URL\u53c2\u6570\u3001\u6d88\u606f\u4f53\uff0c\u8bfb\u53d6\u8fd9\u4e9b\u53c2\u6570\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 `gin` \u6846\u67b6\u81ea\u5e26\u7684\u51fd\u6570\uff1a\r\n\r\n+ `Param()`\uff1a\u8fd4\u56de URL \u7684\u53c2\u6570\u503c\uff0c\u4f8b\u5982\r\n\r\n```go\r\n router.GET(\"/user/:id\", func(c *gin.Context) {\r\n     // a GET request to /user/john\r\n     id := c.Param(\"id\") // id == \"john\"\r\n })\r\n```\r\n+ `Query()`\uff1a\u8bfb\u53d6 URL \u4e2d\u7684\u5730\u5740\u53c2\u6570\uff0c\u4f8b\u5982\r\n\r\n```go\r\n   // GET /path?id=1234&name=Manu&value=\r\n   c.Query(\"id\") == \"1234\"\r\n   c.Query(\"name\") == \"Manu\"\r\n   c.Query(\"value\") == \"\"\r\n   c.Query(\"wtf\") == \"\"  \r\n```\r\n\r\n+ `DefaultQuery()`\uff1a\u7c7b\u4f3c `Query()`\uff0c\u4f46\u662f\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u4f1a\u8fd4\u56de\u9ed8\u8ba4\u503c\uff0c\u4f8b\u5982\r\n\r\n```go\r\n //GET /?name=Manu&lastname=\r\n c.DefaultQuery(\"name\", \"unknown\") == \"Manu\"\r\n c.DefaultQuery(\"id\", \"none\") == \"none\"\r\n c.DefaultQuery(\"lastname\", \"none\") == \"\"\r\n```\r\n\r\n+ `Bind()`\uff1a\u68c0\u67e5 `Content-Type` \u7c7b\u578b\uff0c\u5c06\u6d88\u606f\u4f53\u4f5c\u4e3a\u6307\u5b9a\u7684\u683c\u5f0f\u89e3\u6790\u5230 Go struct \u53d8\u91cf\u4e2d\u3002apiserver \u91c7\u7528\u7684\u5a92\u4f53\u7c7b\u578b\u662f JSON\uff0c\u6240\u4ee5 `Bind()` \u662f\u6309 JSON \u683c\u5f0f\u89e3\u6790\u7684\u3002\r\n\r\n+ `GetHeader()`\uff1a\u83b7\u53d6 HTTP \u5934\u3002\r\n\r\n**\u8fd4\u56deHTTP\u6d88\u606f\uff1a** \u56e0\u4e3a\u8981\u8fd4\u56de\u6307\u5b9a\u7684\u683c\u5f0f\uff0capiserver \u5c01\u88c5\u4e86\u81ea\u5df1\u7684\u8fd4\u56de\u51fd\u6570\uff0c\u901a\u8fc7\u7edf\u4e00\u7684\u8fd4\u56de\u51fd\u6570 `SendResponse` \u6765\u683c\u5f0f\u5316\u8fd4\u56de\uff0c\u5c0f\u8282\u540e\u7eed\u90e8\u5206\u6709\u8be6\u7ec6\u4ecb\u7ecd\u3002\r\n\r\n## \u589e\u52a0\u8fd4\u56de\u51fd\u6570\r\n\r\nAPI \u8fd4\u56de\u5165\u53e3\u51fd\u6570\uff0c\u4f9b\u6240\u6709\u7684\u670d\u52a1\u6a21\u5757\u8fd4\u56de\u65f6\u8c03\u7528\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c06\u5165\u53e3\u51fd\u6570\u6dfb\u52a0\u5728 `handler` \u76ee\u5f55\u4e0b\uff0c`handler/handler.go` \u7684\u6e90\u7801\u4e3a\uff1a\r\n\r\n```go\r\npackage handler\r\n\r\nimport (\r\n\t\"net/http\"\r\n\r\n\t\"apiserver/pkg/errno\"\r\n\r\n\t\"github.com/gin-gonic/gin\"\r\n)\r\n\r\ntype Response struct {\r\n\tCode    int         `json:\"code\"`\r\n\tMessage string      `json:\"message\"`\r\n\tData    interface{} `json:\"data\"`\r\n}\r\n\r\nfunc SendResponse(c *gin.Context, err error, data interface{}) {\r\n\tcode, message := errno.DecodeErr(err)\r\n\r\n\t// always return http.StatusOK\r\n\tc.JSON(http.StatusOK, Response{\r\n\t\tCode:    code,\r\n\t\tMessage: message,\r\n\t\tData:    data,\r\n\t})\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u683c\u5f0f\u56fa\u5b9a\u4e3a\uff1a\r\n\r\n```go\r\ntype Response struct {\r\n\tCode    int         `json:\"code\"`\r\n\tMessage string      `json:\"message\"`\r\n\tData    interface{} `json:\"data\"`\r\n}\r\n```\r\n\r\n\u5728\u8fd4\u56de\u7ed3\u6784\u4f53\u4e2d\uff0c\u56fa\u5b9a\u6709 `Code` \u548c `Message` \u53c2\u6570\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u901a\u8fc7\u51fd\u6570 `DecodeErr()` \u89e3\u6790 error \u7c7b\u578b\u7684\u53d8\u91cf\u800c\u6765\uff08`DecodeErr()` \u5728\u4e0a\u4e00\u8282\u4ecb\u7ecd\u8fc7\uff09\u3002`Data` \u57df\u4e3a `interface{}` \u7c7b\u578b\uff0c\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u81ea\u5df1\u7684\u9700\u6c42\u6765\u8fd4\u56de\uff0c\u53ef\u4ee5\u662f map\u3001int\u3001string\u3001struct\u3001array \u7b49 Go \u8bed\u8a00\u53d8\u91cf\u7c7b\u578b\u3002`SendResponse()` \u51fd\u6570\u901a\u8fc7 `errno.DecodeErr(err)` \u6765\u89e3\u6790\u51fa code \u548c message\uff0c\u5e76\u586b\u5145\u5728 `Response` \u7ed3\u6784\u4f53\u4e2d\u3002\r\n\r\n## \u5728\u4e1a\u52a1\u5904\u7406\u51fd\u6570\u4e2d\u8bfb\u53d6\u548c\u8fd4\u56de\u6570\u636e\r\n\r\n\u901a\u8fc7\u6539\u5199\u4e0a\u4e00\u8282 `handler/user/create.go` \u6e90\u6587\u4ef6\u4e2d\u7684 `Create()` \u51fd\u6570\uff0c\u6765\u6f14\u793a\u5982\u4f55\u8bfb\u53d6\u548c\u8fd4\u56de\u6570\u636e\uff0c\u6539\u5199\u540e\u7684\u6e90\u7801\u4e3a\uff1a\r\n\r\n```go\r\npackage user\r\n\r\nimport (\r\n\t\"fmt\"\r\n\r\n\t. \"apiserver/handler\"\r\n\t\"apiserver/pkg/errno\"\r\n\r\n\t\"github.com/gin-gonic/gin\"\r\n\t\"github.com/lexkong/log\"\r\n)\r\n\r\n// Create creates a new user account.\r\nfunc Create(c *gin.Context) {\r\n\tvar r CreateRequest\r\n\tif err := c.Bind(&r); err != nil {\r\n\t\tSendResponse(c, errno.ErrBind, nil)\r\n\t\treturn\r\n\t}\r\n\r\n\tadmin2 := c.Param(\"username\")\r\n\tlog.Infof(\"URL username: %s\", admin2)\r\n\r\n\tdesc := c.Query(\"desc\")\r\n\tlog.Infof(\"URL key param desc: %s\", desc)\r\n\r\n\tcontentType := c.GetHeader(\"Content-Type\")\r\n\tlog.Infof(\"Header Content-Type: %s\", contentType)\r\n\r\n\tlog.Debugf(\"username is: [%s], password is [%s]\", r.Username, r.Password)\r\n\tif r.Username == \"\" {\r\n\t\tSendResponse(c, errno.New(errno.ErrUserNotFound, fmt.Errorf(\"username can not found in db: xx.xx.xx.xx\")), nil)\r\n\t\treturn\r\n\t}\r\n\r\n\tif r.Password == \"\" {\r\n\t\tSendResponse(c, fmt.Errorf(\"password is empty\"), nil)\r\n\t}\r\n\r\n\trsp := CreateResponse{\r\n\t\tUsername: r.Username,\r\n\t}\r\n\r\n\t// Show the user information.\r\n\tSendResponse(c, nil, rsp)\r\n}\r\n```\r\n\r\n\u8fd9\u91cc\u4e5f\u9700\u8981\u66f4\u65b0\u4e0b\u8def\u7531\uff0c`router/router.go`\uff08\u8be6\u89c1 [demo06/router/router.go](https://github.com/lexkong/apiserver_demos/blob/master/demo06/router/router.go)\uff09\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/1/163ba4612fd06a34?w=1426&h=123&f=png&s=8879)\r\n\r\n\u4e0a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u901a\u8fc7 `Bind()`\u3001`Param()`\u3001`Query()` \u548c `GetHeader()` \u6765\u83b7\u53d6\u76f8\u5e94\u7684\u53c2\u6570\u3002\r\n\r\n\u6839\u636e\u7b14\u8005\u7684\u7814\u53d1\u7ecf\u9a8c\uff0c\u5efa\u8bae\uff1a\u5982\u679c\u6d88\u606f\u4f53\u6709 JSON \u53c2\u6570\u9700\u8981\u4f20\u9012\uff0c\u9488\u5bf9\u6bcf\u4e00\u4e2a API \u63a5\u53e3\u5b9a\u4e49\u72ec\u7acb\u7684 go struct \u6765\u63a5\u6536\uff0c\u6bd4\u5982 `CreateRequest` \u548c `CreateResponse`\uff0c\u5e76\u5c06\u8fd9\u4e9b\u7ed3\u6784\u4f53\u7edf\u4e00\u653e\u5728\u4e00\u4e2a Go \u6587\u4ef6\u4e2d\uff0c\u4ee5\u65b9\u4fbf\u540e\u671f\u7ef4\u62a4\u548c\u4fee\u6539\u3002\u8fd9\u6837\u505a\u53ef\u4ee5\u4f7f\u4ee3\u7801\u7ed3\u6784\u66f4\u52a0\u89c4\u6574\u548c\u6e05\u6670\uff0c\u672c\u4f8b\u7edf\u4e00\u653e\u5728 `handler/user/user.go` \u4e2d\uff0c\u6e90\u7801\u4e3a\uff1a\r\n\r\n```go\r\npackage user\r\n\r\ntype CreateRequest struct {\r\n\tUsername string `json:\"username\"`\r\n\tPassword string `json:\"password\"`\r\n}\r\n\r\ntype CreateResponse struct {\r\n\tUsername string `json:\"username\"`\r\n}\r\n```\r\n\r\n## \u7f16\u8bd1\u5e76\u8fd0\u884c\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo06` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\r\n\r\n```\r\n$ cp -a apiserver_demos/demo06/ $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ gofmt -w .\r\n$ go tool vet .\r\n$ go build -v .\r\n```\r\n\r\n## \u6d4b\u8bd5\r\n\r\n\u542f\u52a8apiserver\uff1a`./apiserver`\uff0c\u53d1\u9001 HTTP \u8bf7\u6c42\uff1a\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user/admin2?desc=test -d'{\"username\":\"admin\",\"password\":\"admin\"}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"username\": \"admin\"\r\n  }\r\n}\r\n```\r\n\r\n\u67e5\u770b apiserver \u65e5\u5fd7\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/1/163ba431f72ac9fd?w=1900&h=625&f=png&s=105750)\r\n\r\n\u53ef\u4ee5\u770b\u5230\u6210\u529f\u8bfb\u53d6\u4e86\u8bf7\u6c42\u4e2d\u7684\u5404\u7c7b\u53c2\u6570\u3002\u5e76\u4e14 `curl` \u547d\u4ee4\u8fd4\u56de\u7684\u7ed3\u679c\u683c\u5f0f\u4e3a\u6307\u5b9a\u7684\u683c\u5f0f\uff1a\r\n\r\n```json\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"username\": \"admin\"\r\n  }\r\n}\r\n```\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u4ecb\u7ecd\u4e86\u5982\u4f55\u8fdb\u884c HTTP \u8bf7\u6c42\u7684\u8bfb\u53d6\u548c\u8fd4\u56de\uff0c\u8bfb\u53d6\u4e3b\u8981\u7528 `gin` \u6846\u67b6\u81ea\u5e26\u7684\u51fd\u6570\uff0c\u8fd4\u56de\u8981\u7edf\u4e00\u7528\u51fd\u6570 `SendResponse`\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/10\u57fa\u7840_7\u8bfb\u53d6\u548c\u8fd4\u56de_HTTP_\u8bf7\u6c42.md", "create_date": "2020-02-18T21:37:38.249", "order": 11}}, {"model": "subject.chapter", "pk": 127, "fields": {"title": "\u57fa\u7840 6\uff1a\u81ea\u5b9a\u4e49\u4e1a\u52a1\u9519\u8bef\u4fe1\u606f", "topic": 6, "md5": "25b93b5b895f0547e1cd3bde3b8ffa40", "md_body": "# \u81ea\u5b9a\u4e49\u4e1a\u52a1\u9519\u8bef\u4fe1\u606f\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u5982\u4f55\u81ea\u5b9a\u4e49\u4e1a\u52a1\u81ea\u5df1\u7684\u9519\u8bef\u4fe1\u606f\r\n+ \u5b9e\u9645\u5f00\u53d1\u4e2d\u662f\u5982\u4f55\u5904\u7406\u9519\u8bef\u7684\r\n+ \u5b9e\u9645\u5f00\u53d1\u4e2d\u5e38\u89c1\u7684\u9519\u8bef\u7c7b\u578b\r\n+ \u901a\u8fc7\u5f15\u5165\u65b0\u5305 `errno` \u6765\u5b9e\u73b0\u6b64\u529f\u80fd\uff0c\u4f1a\u5c55\u793a\u8be5\u5305\u7684\u5982\u4e0b\u7528\u6cd5\uff1a\r\n  + \u5982\u4f55\u65b0\u5efa Err \u7c7b\u578b\u7684\u9519\u8bef\r\n  + \u5982\u4f55\u4ece Err \u7c7b\u578b\u7684\u9519\u8bef\u4e2d\u83b7\u53d6 code \u548c message\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo05](https://github.com/lexkong/apiserver_demos/tree/master/demo05)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo04](https://github.com/lexkong/apiserver_demos/tree/master/demo04) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## \u4e3a\u4ec0\u4e48\u8981\u5b9a\u5236\u4e1a\u52a1\u81ea\u5df1\u7684\u9519\u8bef\u7801\r\n\r\n\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u5f15\u5165\u9519\u8bef\u7801\u6709\u5982\u4e0b\u597d\u5904\uff1a\r\n\r\n+ \u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u5b9a\u4f4d\u95ee\u9898\u548c\u5b9a\u4f4d\u4ee3\u7801\u884c\uff08\u770b\u5230\u9519\u8bef\u7801\u77e5\u9053\u4ec0\u4e48\u610f\u601d\uff0cgrep \u9519\u8bef\u7801\u53ef\u4ee5\u5b9a\u4f4d\u5230\u9519\u8bef\u7801\u6240\u5728\u884c\uff09\r\n+ \u5982\u679c API \u5bf9\u5916\u5f00\u653e\uff0c\u6709\u4e2a\u9519\u8bef\u7801\u4f1a\u66f4\u4e13\u4e1a\u4e9b\r\n+ \u9519\u8bef\u7801\u5305\u542b\u4e00\u5b9a\u7684\u4fe1\u606f\uff0c\u901a\u8fc7\u9519\u8bef\u7801\u53ef\u4ee5\u5224\u65ad\u51fa\u9519\u8bef\u7ea7\u522b\u3001\u9519\u8bef\u6a21\u5757\u548c\u5177\u4f53\u9519\u8bef\u4fe1\u606f\r\n+ \u5728\u5b9e\u9645\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u4e00\u4e2a\u6761\u9519\u8bef\u4fe1\u606f\u9700\u8981\u5305\u542b\u4e24\u90e8\u5206\u5185\u5bb9\uff1a\u76f4\u63a5\u5c55\u793a\u7ed9\u7528\u6237\u7684 `message` \u548c\u7528\u4e8e\u5f00\u53d1\u4eba\u5458 debug \u7684 `error` \u3002`message` \u53ef\u80fd\u4f1a\u76f4\u63a5\u5c55\u793a\u7ed9\u7528\u6237\uff0c`error` \u662f\u7528\u4e8e debug \u7684\u9519\u8bef\u4fe1\u606f\uff0c\u53ef\u80fd\u5305\u542b\u654f\u611f/\u5185\u90e8\u4fe1\u606f\uff0c\u4e0d\u5b9c\u5bf9\u5916\u5c55\u793a\r\n+ \u4e1a\u52a1\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u9700\u8981\u5224\u65ad\u9519\u8bef\u662f\u54ea\u79cd\u7c7b\u578b\u4ee5\u4fbf\u505a\u76f8\u5e94\u7684\u903b\u8f91\u5904\u7406\uff0c\u901a\u8fc7\u5b9a\u5236\u7684\u9519\u8bef\u7801\u5f88\u5bb9\u6613\u505a\u5230\u8fd9\u70b9\uff0c\u4f8b\u5982\uff1a\r\n\r\n```go\r\n    if err == errno.ErrBind {\r\n        ...\r\n    }   \r\n```\r\n\r\n+ Go \u4e2d\u7684 HTTP \u670d\u52a1\u5668\u5f00\u53d1\u90fd\u662f\u5f15\u7528 `net/http` \u5305\uff0c\u8be5\u5305\u4e2d\u53ea\u6709 60 \u4e2a\u9519\u8bef\u7801\uff0c\u57fa\u672c\u90fd\u662f\u8ddf HTTP \u8bf7\u6c42\u76f8\u5173\u7684\u3002\u5728\u5927\u578b\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u4e9b\u9519\u8bef\u7801\u5b8c\u5168\u4e0d\u591f\u7528\uff0c\u800c\u4e14\u8ddf\u4e1a\u52a1\u6ca1\u6709\u4efb\u4f55\u5173\u8054\uff0c\u6ee1\u8db3\u4e0d\u4e86\u4e1a\u52a1\u9700\u6c42\u3002\r\n\r\n## \u5728 apiserver \u4e2d\u5f15\u5165\u9519\u8bef\u7801\r\n\r\n\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u65b0\u5305 `errno` \u6765\u505a\u9519\u8bef\u7801\u7684\u5b9a\u5236\uff0c\u8be6\u89c1 [demo05/pkg/errno](https://github.com/lexkong/apiserver_demos/tree/master/demo05/pkg/errno)\u3002\r\n\r\n```\r\n$ ls pkg/errno/\r\ncode.go  errno.go\r\n```\r\n`errno` \u5305\u7531\u4e24\u4e2a Go \u6587\u4ef6\u7ec4\u6210\uff1a`code.go` \u548c `errno.go`\u3002`code.go` \u7528\u6765\u7edf\u4e00\u5b58\u81ea\u5b9a\u4e49\u7684\u9519\u8bef\u7801\uff0c`code.go` \u7684\u4ee3\u7801\u4e3a\uff1a\r\n\r\n```go\r\npackage errno\r\n\r\nvar (\r\n\t// Common errors\r\n\tOK                  = &Errno{Code: 0, Message: \"OK\"}\r\n\tInternalServerError = &Errno{Code: 10001, Message: \"Internal server error\"}\r\n\tErrBind             = &Errno{Code: 10002, Message: \"Error occurred while binding the request body to the struct.\"}\r\n\r\n\t// user errors\r\n\tErrUserNotFound      = &Errno{Code: 20102, Message: \"The user was not found.\"}\r\n)\r\n```\r\n\r\n**\u4ee3\u7801\u89e3\u6790**\r\n\r\n\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e00\u4e2a\u9519\u8bef\u7c7b\u578b\u901a\u5e38\u5305\u542b\u4e24\u90e8\u5206\uff1aCode \u90e8\u5206\uff0c\u7528\u6765\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a\u9519\u8bef\uff1bMessage \u90e8\u5206\uff0c\u7528\u6765\u5c55\u793a\u9519\u8bef\u4fe1\u606f\uff0c\u8fd9\u90e8\u5206\u9519\u8bef\u4fe1\u606f\u901a\u5e38\u4f9b\u524d\u7aef\u76f4\u63a5\u5c55\u793a\u3002\u8fd9\u4e24\u90e8\u5206\u6620\u5c04\u5728 `errno` \u5305\u4e2d\u5373\u4e3a `&Errno{Code: 0, Message: \"OK\"}`\u3002\r\n\r\n**\u9519\u8bef\u7801\u8bbe\u8ba1**\r\n\r\n\u76ee\u524d\u9519\u8bef\u7801\u6ca1\u6709\u4e00\u4e2a\u7edf\u4e00\u7684\u8bbe\u8ba1\u6807\u51c6\uff0c\u7b14\u8005\u7814\u7a76\u4e86 BAT \u548c\u65b0\u6d6a\u5f00\u653e\u5e73\u53f0\u5bf9\u5916\u516c\u5e03\u7684\u9519\u8bef\u7801\u8bbe\u8ba1\uff0c\u53c2\u8003\u65b0\u6d6a\u5f00\u653e\u5e73\u53f0 [Error code](http://open.weibo.com/wiki/Error_code) \u7684\u8bbe\u8ba1\uff0c\u5982\u4e0b\u662f\u8bbe\u8ba1\u8bf4\u660e\uff1a\r\n\r\n\u9519\u8bef\u8fd4\u56de\u503c\u683c\u5f0f\uff1a\r\n\r\n```json\r\n{\r\n  \"code\": 10002,\r\n  \"message\": \"Error occurred while binding the request body to the struct.\"\r\n}\r\n```\r\n\r\n\u9519\u8bef\u4ee3\u7801\u8bf4\u660e\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/1/163b938084a7e9e9?w=1098&h=131&f=png&s=9673)\r\n\r\n+ \u670d\u52a1\u7ea7\u522b\u9519\u8bef\uff1a1 \u4e3a\u7cfb\u7edf\u7ea7\u9519\u8bef\uff1b2 \u4e3a\u666e\u901a\u9519\u8bef\uff0c\u901a\u5e38\u662f\u7531\u7528\u6237\u975e\u6cd5\u64cd\u4f5c\u5f15\u8d77\u7684\r\n+ \u670d\u52a1\u6a21\u5757\u4e3a\u4e24\u4f4d\u6570\uff1a\u4e00\u4e2a\u5927\u578b\u7cfb\u7edf\u7684\u670d\u52a1\u6a21\u5757\u901a\u5e38\u4e0d\u8d85\u8fc7\u4e24\u4f4d\u6570\uff0c\u5982\u679c\u8d85\u8fc7\uff0c\u8bf4\u660e\u8fd9\u4e2a\u7cfb\u7edf\u8be5\u62c6\u5206\u4e86\r\n+ \u9519\u8bef\u7801\u4e3a\u4e24\u4f4d\u6570\uff1a\u9632\u6b62\u4e00\u4e2a\u6a21\u5757\u5b9a\u5236\u8fc7\u591a\u7684\u9519\u8bef\u7801\uff0c\u540e\u671f\u4e0d\u597d\u7ef4\u62a4\r\n+ code = 0 \u8bf4\u660e\u662f\u6b63\u786e\u8fd4\u56de\uff0ccode > 0 \u8bf4\u660e\u662f\u9519\u8bef\u8fd4\u56de\r\n+ \u9519\u8bef\u901a\u5e38\u5305\u62ec\u7cfb\u7edf\u7ea7\u9519\u8bef\u7801\u548c\u670d\u52a1\u7ea7\u9519\u8bef\u7801\r\n+ \u5efa\u8bae\u4ee3\u7801\u4e2d\u6309\u670d\u52a1\u6a21\u5757\u5c06\u9519\u8bef\u5206\u7c7b\r\n+ \u9519\u8bef\u7801\u5747\u4e3a >= 0 \u7684\u6570\r\n+ \u5728 apiserver \u4e2d HTTP Code \u56fa\u5b9a\u4e3a `http.StatusOK`\uff0c\u9519\u8bef\u7801\u901a\u8fc7 code \u6765\u8868\u793a\u3002\r\n\r\n## \u9519\u8bef\u4fe1\u606f\u5904\u7406\r\n\r\n\u901a\u8fc7 `errno.go` \u6765\u5bf9\u81ea\u5b9a\u4e49\u7684\u9519\u8bef\u8fdb\u884c\u5904\u7406\uff0c`errno.go` \u7684\u4ee3\u7801\u4e3a\uff1a\r\n\r\n```go\r\npackage errno\r\n\r\nimport \"fmt\"\r\n\r\ntype Errno struct {\r\n\tCode    int\r\n\tMessage string\r\n}\r\n\r\nfunc (err Errno) Error() string {\r\n\treturn err.Message\r\n}\r\n\r\n// Err represents an error\r\ntype Err struct {\r\n\tCode    int\r\n\tMessage string\r\n\tErr     error\r\n}\r\n\r\nfunc New(errno *Errno, err error) *Err {\r\n\treturn &Err{Code: errno.Code, Message: errno.Message, Err: err}\r\n}\r\n\r\nfunc (err *Err) Add(message string) error {\r\n\terr.Message += \" \" + message\r\n\treturn err\r\n}\r\n\r\nfunc (err *Err) Addf(format string, args ...interface{}) error {\r\n\terr.Message += \" \" + fmt.Sprintf(format, args...)\r\n\treturn err\r\n}\r\n\r\nfunc (err *Err) Error() string {\r\n\treturn fmt.Sprintf(\"Err - code: %d, message: %s, error: %s\", err.Code, err.Message, err.Err)\r\n}\r\n\r\nfunc IsErrUserNotFound(err error) bool {\r\n\tcode, _ := DecodeErr(err)\r\n\treturn code == ErrUserNotFound.Code\r\n}\r\n\r\nfunc DecodeErr(err error) (int, string) {\r\n\tif err == nil {\r\n\t\treturn OK.Code, OK.Message\r\n\t}\r\n\r\n\tswitch typed := err.(type) {\r\n\tcase *Err:\r\n\t\treturn typed.Code, typed.Message\r\n\tcase *Errno:\r\n\t\treturn typed.Code, typed.Message\r\n\tdefault:\r\n\t}\r\n\r\n\treturn InternalServerError.Code, err.Error()\r\n}\r\n```\r\n\r\n**\u4ee3\u7801\u89e3\u6790**\r\n\r\n`errno.go` \u6e90\u7801\u6587\u4ef6\u4e2d\u6709\u4e24\u4e2a\u6838\u5fc3\u51fd\u6570 `New()` \u548c `DecodeErr()`\uff0c\u4e00\u4e2a\u7528\u6765\u65b0\u5efa\u5b9a\u5236\u7684\u9519\u8bef\uff0c\u4e00\u4e2a\u7528\u6765\u89e3\u6790\u5b9a\u5236\u7684\u9519\u8bef\uff0c\u7a0d\u540e\u4f1a\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u3002\r\n\r\n`errno.go` \u540c\u65f6\u4e5f\u63d0\u4f9b\u4e86 `Add()` \u548c `Addf()` \u51fd\u6570\uff0c\u5982\u679c\u60f3\u5bf9\u5916\u5c55\u793a\u66f4\u591a\u7684\u4fe1\u606f\u53ef\u4ee5\u8c03\u7528\u6b64\u51fd\u6570\uff0c\u4f7f\u7528\u65b9\u6cd5\u4e0b\u9762\u6709\u4ecb\u7ecd\u3002\r\n\r\n## \u9519\u8bef\u7801\u5b9e\u6218\r\n\r\n\u4e0a\u9762\u4ecb\u7ecd\u4e86\u9519\u8bef\u7801\u7684\u4e00\u4e9b\u77e5\u8bc6\uff0c\u8fd9\u4e00\u90e8\u5206\u8bb2\u5f00\u53d1\u4e2d\u662f\u5982\u4f55\u4f7f\u7528 `errno` \u5305\u6765\u5904\u7406\u9519\u8bef\u4fe1\u606f\u7684\u3002\u4e3a\u4e86\u6f14\u793a\uff0c\u6211\u4eec\u65b0\u589e\u4e00\u4e2a\u521b\u5efa\u7528\u6237\u7684 API\uff1a\r\n\r\n1. `router/router.go` \u4e2d\u6dfb\u52a0\u8def\u7531\uff0c\u8be6\u89c1 [demo05/router/router.go](https://github.com/lexkong/apiserver_demos/blob/master/demo05/router/router.go)\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/1/163b9570311afe43?w=1049&h=674&f=png&s=44258)\r\n\r\n2. `handler` \u76ee\u5f55\u4e0b\u589e\u52a0\u4e1a\u52a1\u5904\u7406\u51fd\u6570 `handler/user/create.go`\uff0c\u8be6\u89c1 [demo05/handler/user/create.go](https://github.com/lexkong/apiserver_demos/blob/master/demo05/handler/user/create.go)\u3002\r\n\r\n## \u7f16\u8bd1\u5e76\u8fd0\u884c\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo05` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\r\n\r\n```\r\n$ cp -a apiserver_demos/demo05/ $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ gofmt -w .\r\n$ go tool vet .\r\n$ go build -v .\r\n```\r\n\r\n## \u6d4b\u8bd5\u9a8c\u8bc1\r\n\r\n\u542f\u52a8 apiserver\uff1a`./apiserver`\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user\r\n\r\n{\r\n  \"code\": 10002,\r\n  \"message\": \"Error occurred while binding the request body to the struct.\"\r\n}\r\n```\r\n\r\n\u56e0\u4e3a\u6ca1\u6709\u4f20\u5165\u4efb\u4f55\u53c2\u6570\uff0c\u6240\u4ee5\u8fd4\u56de `errno.ErrBind` \u9519\u8bef\u3002\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"username\":\"admin\"}'\r\n\r\n{\r\n  \"code\": 10001,\r\n  \"message\": \"password is empty\"\r\n}\r\n```\r\n\r\n\u56e0\u4e3a\u6ca1\u6709\u4f20\u5165 `password`\uff0c\u6240\u4ee5\u8fd4\u56de `fmt.Errorf(\"password is empty\")` \u9519\u8bef\uff0c\u8be5\u9519\u8bef\u4fe1\u606f\u4e0d\u662f\u5b9a\u5236\u7684\u9519\u8bef\u7c7b\u578b\uff0c`errno.DecodeErr(err)` \u89e3\u6790\u65f6\u4f1a\u89e3\u6790\u4e3a\u9ed8\u8ba4\u7684 `errno.InternalServerError` \u9519\u8bef\uff0c\u6240\u4ee5\u8fd4\u56de\u7ed3\u679c\u4e2d code \u4e3a `10001`\uff0cmessage \u4e3a `err.Error()`\u3002\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"password\":\"admin\"}'\r\n\r\n{\r\n  \"code\": 20102,\r\n  \"message\": \"The user was not found. This is add message.\"\r\n}\r\n```\r\n\r\n\u56e0\u4e3a\u6ca1\u6709\u4f20\u5165 `username`\uff0c\u6240\u4ee5\u8fd4\u56de `errno.ErrUserNotFound` \u9519\u8bef\u4fe1\u606f\uff0c\u5e76\u901a\u8fc7 `Add()` \u51fd\u6570\u5728 message \u4fe1\u606f\u540e\u8ffd\u52a0\u4e86 `This is add message.` \u4fe1\u606f\u3002\r\n\r\n\u901a\u8fc7\r\n\r\n```go\r\n   if errno.IsErrUserNotFound(err) {\r\n        log.Debug(\"err type is ErrUserNotFound\")\r\n    }   \r\n```\r\n\r\n\u6f14\u793a\u4e86\u5982\u4f55\u901a\u8fc7\u5b9a\u5236\u9519\u8bef\u65b9\u4fbf\u5730\u5bf9\u6bd4\u662f\u4e0d\u662f\u67d0\u4e2a\u9519\u8bef\uff0c\u5728\u8be5\u8bf7\u6c42\u4e2d\uff0capiserver \u4f1a\u8f93\u51fa\u5982\u4e0b\u9519\u8bef\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/1/163b9c03a0a6033e?w=1902&h=646&f=png&s=103787)\r\n\r\n\u53ef\u4ee5\u770b\u5230\u5728\u540e\u53f0\u65e5\u5fd7\u4e2d\u4f1a\u8f93\u51fa\u654f\u611f\u4fe1\u606f `username can not found in db: xx.xx.xx.xx`\uff0c\u4f46\u662f\u8fd4\u56de\u7ed9\u7528\u6237\u7684 message \uff08`{\"code\":20102,\"message\":\"The user was not found. This is add message.\"}`\uff09\u4e0d\u5305\u542b\u8fd9\u4e9b\u654f\u611f\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f9b\u524d\u7aef\u76f4\u63a5\u5bf9\u5916\u5c55\u793a\u3002\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"username\":\"admin\",\"password\":\"admin\"}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\"\r\n}\r\n```\r\n\r\n\u5982\u679c `err = nil`\uff0c\u5219 `errno.DecodeErr(err)` \u4f1a\u8fd4\u56de\u6210\u529f\u7684 `code: 0` \u548c `message: OK`\u3002\r\n\r\n> \u5982\u679c API \u662f\u5bf9\u5916\u7684\uff0c\u9519\u8bef\u4fe1\u606f\u6570\u91cf\u6709\u9650\uff0c\u5219\u5236\u5b9a\u9519\u8bef\u7801\u975e\u5e38\u5bb9\u6613\uff0c\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528\u9519\u8bef\u7801\u3002\u5982\u679c\u662f\u5185\u90e8\u7cfb\u7edf\uff0c\u7279\u522b\u662f\u5e9e\u5927\u7684\u7cfb\u7edf\uff0c\u5185\u90e8\u9519\u8bef\u4f1a\u975e\u5e38\u591a\uff0c\u8fd9\u65f6\u5019\u6ca1\u5fc5\u8981\u4e3a\u6bcf\u4e00\u4e2a\u9519\u8bef\u5236\u5b9a\u9519\u8bef\u7801\uff0c\u800c\u53ea\u9700\u4e3a\u5e38\u89c1\u7684\u9519\u8bef\u5236\u5b9a\u9519\u8bef\u7801\uff0c\u5bf9\u4e8e\u666e\u901a\u7684\u9519\u8bef\uff0c\u7cfb\u7edf\u5728\u5904\u7406\u65f6\u4f1a\u7edf\u4e00\u4f5c\u4e3a `InternalServerError` \u5904\u7406\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u5b9e\u9645\u5f00\u53d1\u4e2d\u662f\u5982\u4f55\u5904\u7406\u4e1a\u52a1\u9519\u8bef\u4fe1\u606f\u7684\uff0c\u5e76\u7ed9\u51fa\u4e86\u7b14\u8005\u503e\u5411\u7684\u9519\u8bef\u7801\u89c4\u8303\u4f9b\u8bfb\u8005\u53c2\u8003\uff0c\u6700\u540e\u901a\u8fc7\u5927\u91cf\u7684\u5b9e\u4f8b\u6765\u5c55\u793a\u5982\u4f55\u901a\u8fc7 `errno` \u5305\u6765\u5904\u7406\u4e0d\u540c\u573a\u666f\u7684\u9519\u8bef\u3002\r\n", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/9\u57fa\u7840_6\u81ea\u5b9a\u4e49\u4e1a\u52a1\u9519\u8bef\u4fe1\u606f.md", "create_date": "2020-02-18T21:37:38.250", "order": 10}}, {"model": "subject.chapter", "pk": 128, "fields": {"title": "\u57fa\u7840 8\uff1a\u7528\u6237\u4e1a\u52a1\u903b\u8f91\u5904\u7406", "topic": 6, "md5": "ac29168140faee24a0741784a9279045", "md_body": "# \u7528\u6237\u4e1a\u52a1\u903b\u8f91\u5904\u7406\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n\u8fd9\u4e00\u8282\u662f\u6838\u5fc3\u5c0f\u8282\uff0c\u8bb2\u89e3\u5982\u4f55\u5904\u7406\u7528\u6237\u4e1a\u52a1\uff0c\u8fd9\u4e5f\u662f API \u7684\u6838\u5fc3\u529f\u80fd\u3002\u672c\u5c0f\u8282\u4f1a\u8bb2\u89e3\u5b9e\u9645\u5f00\u53d1\u4e2d\u9700\u8981\u7684\u4e00\u4e9b\u91cd\u8981\u529f\u80fd\u70b9\uff0c\u5e76\u6839\u636e\u7b14\u8005\u7684\u5f00\u53d1\u7ecf\u9a8c\uff0c\u7ed9\u51fa\u4e00\u4e9b\u5efa\u8bae\u3002\u529f\u80fd\u70b9\u5305\u62ec\uff1a\r\n\r\n+ \u5404\u79cd\u573a\u666f\u7684\u4e1a\u52a1\u903b\u8f91\u5904\u7406\r\n    + \u521b\u5efa\u7528\u6237\r\n    + \u5220\u9664\u7528\u6237\r\n    + \u66f4\u65b0\u7528\u6237\r\n    + \u67e5\u8be2\u7528\u6237\u5217\u8868\r\n    + \u67e5\u8be2\u6307\u5b9a\u7528\u6237\u7684\u4fe1\u606f\r\n+ \u6570\u636e\u5e93\u7684 CURD \u64cd\u4f5c\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo07](https://github.com/lexkong/apiserver_demos/tree/master/demo07)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo06](https://github.com/lexkong/apiserver_demos/tree/master/demo06) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## \u914d\u7f6e\u8def\u7531\u4fe1\u606f\r\n\r\n\u9700\u8981\u5148\u5728 `router/router.go` \u6587\u4ef6\u4e2d\uff0c\u914d\u7f6e\u8def\u7531\u4fe1\u606f\uff1a\r\n\r\n```go\r\nfunc Load(g *gin.Engine, mw ...gin.HandlerFunc) *gin.Engine {\r\n    ...\r\n\t// \u7528\u6237\u8def\u7531\u8bbe\u7f6e\r\n\tu := g.Group(\"/v1/user\")\r\n\t{\r\n\t\tu.POST(\"\", user.Create)         // \u521b\u5efa\u7528\u6237\r\n\t\tu.DELETE(\"/:id\", user.Delete)   // \u5220\u9664\u7528\u6237 \r\n\t\tu.PUT(\"/:id\", user.Update)      // \u66f4\u65b0\u7528\u6237\r\n\t\tu.GET(\"\", user.List)            // \u7528\u6237\u5217\u8868\r\n\t\tu.GET(\"/:username\", user.Get)   // \u83b7\u53d6\u6307\u5b9a\u7528\u6237\u7684\u8be6\u7ec6\u4fe1\u606f\r\n\t}\r\n    ...\r\n\treturn g\r\n}\r\n```\r\n\r\n> \u5728 RESTful API \u5f00\u53d1\u4e2d\uff0cAPI \u7ecf\u5e38\u4f1a\u53d8\u52a8\uff0c\u4e3a\u4e86\u517c\u5bb9\u8001\u7684 API\uff0c\u5f15\u5165\u4e86\u7248\u672c\u7684\u6982\u5ff5\uff0c\u6bd4\u5982\u4e0a\u4f8b\u4e2d\u7684 `/v1/user`\uff0c\u8bf4\u660e\u8be5 API \u7248\u672c\u662f `v1`\u3002\r\n>\r\n> \u5f88\u591a RESTful API \u6700\u4f73\u5b9e\u8df5\u6587\u7ae0\u4e2d\u5747\u5efa\u8bae\u4f7f\u7528\u7248\u672c\u63a7\u5236\uff0c\u7b14\u8005\u8fd9\u91cc\u4e5f\u5efa\u8bae\u5bf9 API \u4f7f\u7528\u7248\u672c\u63a7\u5236\u3002\r\n\r\n## \u6ce8\u518c\u65b0\u7684\u9519\u8bef\u7801\r\n\r\n\u5728 `pkg/errno/code.go` \u6587\u4ef6\u4e2d\uff08\u8be6\u89c1 [demo07/pkg/errno/code.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/pkg/errno/code.go)\uff09\uff0c\u65b0\u589e\u5982\u4e0b\u9519\u8bef\u7801\uff1a\r\n\r\n```go\r\nvar (\r\n\t// Common errors\r\n        ...\r\n\r\n\tErrValidation       = &Errno{Code: 20001, Message: \"Validation failed.\"}\r\n\tErrDatabase         = &Errno{Code: 20002, Message: \"Database error.\"}\r\n\tErrToken            = &Errno{Code: 20003, Message: \"Error occurred while signing the JSON web token.\"}\r\n\r\n\t// user errors\r\n\tErrEncrypt           = &Errno{Code: 20101, Message: \"Error occurred while encrypting the user password.\"}\r\n\tErrTokenInvalid      = &Errno{Code: 20103, Message: \"The token was invalid.\"}\r\n\tErrPasswordIncorrect = &Errno{Code: 20104, Message: \"The password was incorrect.\"}\r\n)\r\n```\r\n\r\n## \u65b0\u589e\u7528\u6237\r\n\r\n\u66f4\u65b0 `handler/user/create.go` \u4e2d `Create()` \u7684\u903b\u8f91\uff0c\u66f4\u65b0\u540e\u7684\u5185\u5bb9\u89c1 [demo07/handler/user/create.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/handler/user/create.go)\u3002\r\n\r\n\u521b\u5efa\u7528\u6237\u903b\u8f91\uff1a\r\n\r\n1. \u4ece HTTP \u6d88\u606f\u4f53\u83b7\u53d6\u53c2\u6570\uff08\u7528\u6237\u540d\u548c\u5bc6\u7801\uff09\r\n2. \u53c2\u6570\u6821\u9a8c\r\n3. \u52a0\u5bc6\u5bc6\u7801\r\n4. \u5728\u6570\u636e\u5e93\u4e2d\u6dfb\u52a0\u6570\u636e\u8bb0\u5f55\r\n5. \u8fd4\u56de\u7ed3\u679c\uff08\u8fd9\u91cc\u662f\u7528\u6237\u540d\uff09\r\n\r\n\u4ece HTTP \u6d88\u606f\u4f53\u89e3\u6790\u53c2\u6570\uff0c\u524d\u9762\u5c0f\u8282\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u3002\r\n\r\n\u53c2\u6570\u6821\u9a8c\u8fd9\u91cc\u7528\u7684\u662f `gopkg.in/go-playground/validator.v9` \u5305\uff08\u8be6\u89c1 [go-playground/validator](https://github.com/go-playground/validator)\uff09\uff0c\u5b9e\u9645\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u8be5\u5305\u53ef\u80fd\u4e0d\u80fd\u6ee1\u8db3\u6821\u9a8c\u9700\u6c42\uff0c\u8fd9\u65f6\u5019\u53ef\u5728\u7a0b\u5e8f\u4e2d\u52a0\u5165\u81ea\u5df1\u7684\u6821\u9a8c\u903b\u8f91\uff0c\u6bd4\u5982\u5728 `handler/user/creater.go` \u4e2d\u6dfb\u52a0\u6821\u9a8c\u51fd\u6570 `checkParam`\uff1a\r\n\r\n```go\r\npackage user\r\n\r\nimport (\r\n    ...\r\n)\r\n\r\n// Create creates a new user account.\r\nfunc Create(c *gin.Context) {\r\n\tlog.Info(\"User Create function called.\", lager.Data{\"X-Request-Id\": util.GetReqID(c)})\r\n\tvar r CreateRequest\r\n\tif err := c.Bind(&r); err != nil {\r\n\t\tSendResponse(c, errno.ErrBind, nil)\r\n\t\treturn\r\n\t}\r\n\r\n\tif err := r.checkParam(); err != nil {\r\n\t\tSendResponse(c, err, nil)\r\n\t\treturn\r\n\t}\r\n        ...\r\n}\r\n\r\nfunc (r *CreateRequest) checkParam() error {\r\n\tif r.Username == \"\" {\r\n\t\treturn errno.New(errno.ErrValidation, nil).Add(\"username is empty.\")\r\n\t}\r\n\r\n\tif r.Password == \"\" {\r\n\t\treturn errno.New(errno.ErrValidation, nil).Add(\"password is empty.\")\r\n\t}\r\n\r\n\treturn nil\r\n}\r\n```\r\n\r\n\u4f8b\u5b50\u901a\u8fc7 `Encrypt()` \u5bf9\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\uff1a\r\n\r\n```go\r\n// Encrypt the user password.\r\nfunc (u *UserModel) Encrypt() (err error) {\r\n    u.Password, err = auth.Encrypt(u.Password)\r\n    return\r\n}      \r\n```\r\n\r\n`Encrypt()` \u51fd\u6570\u5f15\u7528 `auth.Encrypt()` \u6765\u8fdb\u884c\u5bc6\u7801\u52a0\u5bc6\uff0c\u5177\u4f53\u5b9e\u73b0\u89c1 [demo07/pkg/auth/auth.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/pkg/auth/auth.go)\u3002\r\n\r\n\u6700\u540e\u4f8b\u5b50\u901a\u8fc7 `u.Create()` \u51fd\u6570\u6765\u5411\u6570\u636e\u5e93\u4e2d\u6dfb\u52a0\u8bb0\u5f55\uff0cORM \u7528\u7684\u662f `gorm`\uff0c`gorm` \u8be6\u7ec6\u7528\u6cd5\u8bf7\u53c2\u8003 [GORM \u6307\u5357](http:\u6670//gorm.io/zh_CN/docs/index.html)\u3002\u5728 `Create()` \u51fd\u6570\u4e2d\u5f15\u7528\u7684\u6570\u636e\u5e93\u5b9e\u4f8b\u662f `DB.Self`\uff0c\u8be5\u5b9e\u4f8b\u5728 API \u542f\u52a8\u4e4b\u524d\u5df2\u7ecf\u5b8c\u6210\u521d\u59cb\u5316\u3002`DB` \u662f\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u3002\r\n\r\n> \u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e3a\u4e86\u5b89\u5168\uff0c\u6570\u636e\u5e93\u4e2d\u662f\u7981\u6b62\u4fdd\u5b58\u5bc6\u7801\u7684\u660e\u6587\u4fe1\u606f\u7684\uff0c\u5bc6\u7801\u9700\u8981\u52a0\u5bc6\u4fdd\u5b58\u3002\r\n>\r\n> \u7b14\u8005\u5c06\u63a5\u6536\u548c\u5904\u7406\u76f8\u5173\u7684 Go \u7ed3\u6784\u4f53\u7edf\u4e00\u653e\u5728 `handler/user/user.go` \u6587\u4ef6\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u7a0b\u5e8f\u7ed3\u6784\u66f4\u6e05\u6670\uff0c\u529f\u80fd\u66f4\u805a\u7126\u3002\u5f53\u7136\u6bcf\u4e2a\u4eba\u4e60\u60ef\u4e0d\u4e00\u6837\uff0c\u8bfb\u8005\u6839\u636e\u81ea\u5df1\u7684\u4e60\u60ef\u653e\u7f6e\u5373\u53ef\u3002`handler/user/user.go` \u5bf9 `UserInfo` \u7ed3\u6784\u4f53\u7684\u5904\u7406\uff0c\u4e5f\u51fa\u4e8e\u76f8\u540c\u7684\u76ee\u7684\u3002\r\n\r\n## \u5220\u9664\u7528\u6237\r\n\r\n\u5220\u9664\u7528\u6237\u4ee3\u7801\u8be6\u89c1 [demo07/handler/user/delete.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/handler/user/delete.go)\u3002\r\n\r\n\u5220\u9664\u65f6\uff0c\u9996\u5148\u6839\u636e URL \u8def\u5f84 `DELETE http://127.0.0.1/v1/user/1` \u89e3\u6790\u51fa id \u7684\u503c 1\uff0c\u8be5 id \u5b9e\u9645\u4e0a\u5c31\u662f\u6570\u636e\u5e93\u4e2d\u7684 id \u7d22\u5f15\uff0c\u8c03\u7528 `model.DeleteUser()` \u51fd\u6570\u5220\u9664\uff0c\u51fd\u6570\u8be6\u89c1 [demo07/model/user.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/model/user.go)\u3002\r\n\r\n## \u66f4\u65b0\u7528\u6237\r\n\r\n\u66f4\u65b0\u7528\u6237\u4ee3\u7801\u8be6\u89c1 [demo07/handler/user/update.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/handler/user/update.go)\u3002\r\n\r\n\u66f4\u65b0\u7528\u6237\u903b\u8f91\u8ddf\u521b\u5efa\u7528\u6237\u5dee\u4e0d\u591a\uff0c\u5728\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u5b57\u6bb5\u540e\uff0c\u9700\u8981\u6307\u5b9a gorm model \u4e2d\u7684 id \u5b57\u6bb5\u7684\u503c\uff0c\u56e0\u4e3a gorm \u5728\u66f4\u65b0\u65f6\u9ed8\u8ba4\u662f\u6309\u7167 id \u6765\u5339\u914d\u8bb0\u5f55\u7684\u3002\u901a\u8fc7\u89e3\u6790 `PUT http://127.0.0.1/v1/user/1` \u6765\u83b7\u53d6 id\u3002\r\n\r\n\r\n## \u67e5\u8be2\u7528\u6237\u5217\u8868\r\n\r\n\u67e5\u8be2\u7528\u6237\u5217\u8868\u4ee3\u7801\u8be6\u89c1 [demo07/handler/user/list.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/handler/user/list.go)\u3002\r\n\r\n\u4e00\u822c\u5728 handler \u4e2d\u4e3b\u8981\u505a\u89e3\u6790\u53c2\u6570\u3001\u8fd4\u56de\u6570\u636e\u64cd\u4f5c\uff0c\u7b80\u5355\u7684\u903b\u8f91\u4e5f\u53ef\u4ee5\u5728 handler \u4e2d\u505a\uff0c\u50cf\u65b0\u589e\u7528\u6237\u3001\u5220\u9664\u7528\u6237\u3001\u66f4\u65b0\u7528\u6237\uff0c\u4ee3\u7801\u91cf\u4e0d\u5927\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u653e\u5728 handler \u4e2d\u3002\u6709\u4e9b\u4ee3\u7801\u91cf\u5f88\u5927\u7684\u903b\u8f91\u5c31\u4e0d\u9002\u5408\u653e\u5728 handler \u4e2d\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u5bfc\u81f4 handler \u903b\u8f91\u4e0d\u662f\u5f88\u6e05\u6670\uff0c\u8fd9\u65f6\u5019\u5b9e\u9645\u5904\u7406\u7684\u90e8\u5206\u901a\u5e38\u653e\u5728 `service` \u5305\u4e2d\u3002\u6bd4\u5982\u672c\u4f8b\u7684 `LisUser()` \u51fd\u6570\uff1a\r\n\r\n```go\r\npackage user\r\n   \r\nimport (\r\n    \"apiserver/service\"\r\n    ...\r\n)  \r\n   \r\n// List list the users in the database.\r\nfunc List(c *gin.Context) {\r\n    ...\r\n    infos, count, err := service.ListUser(r.Username, r.Offset, r.Limit)\r\n    if err != nil {\r\n        SendResponse(c, err, nil)\r\n        return\r\n    }\r\n    ...\r\n}\r\n```\r\n\r\n\u67e5\u8be2\u4e00\u4e2a REST \u8d44\u6e90\u5217\u8868\uff0c\u901a\u5e38\u9700\u8981\u505a\u5206\u9875\uff0c\u5982\u679c\u4e0d\u505a\u5206\u9875\u8fd4\u56de\u7684\u5217\u8868\u8fc7\u591a\uff0c\u4f1a\u5bfc\u81f4 API \u54cd\u5e94\u5f88\u6162\uff0c\u524d\u7aef\u4f53\u9a8c\u4e5f\u4e0d\u597d\u3002\u672c\u4f8b\u4e2d\u7684\u67e5\u8be2\u51fd\u6570\u505a\u4e86\u5206\u9875\uff0c\u6536\u5230\u7684\u8bf7\u6c42\u4e2d\u4f20\u5165\u7684 `offset` \u548c `limit` \u53c2\u6570\uff0c\u5206\u522b\u5bf9\u5e94\u4e8e MySQL \u7684 `offset` \u548c `limit`\u3002\r\n\r\n`service.ListUser()` \u51fd\u6570\u7528\u6765\u505a\u5177\u4f53\u7684\u67e5\u8be2\u5904\u7406\uff0c\u4ee3\u7801\u8be6\u89c1 [demo07/service/service.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/service/service.go)\u3002\r\n\r\n\u5728 `ListUser()` \u51fd\u6570\u4e2d\u7528\u4e86 `sync` \u5305\u6765\u505a\u5e76\u884c\u67e5\u8be2\uff0c\u4ee5\u4f7f\u54cd\u5e94\u5ef6\u65f6\u66f4\u5c0f\u3002\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u67e5\u8be2\u6570\u636e\u540e\uff0c\u901a\u5e38\u9700\u8981\u5bf9\u6570\u636e\u505a\u4e00\u4e9b\u5904\u7406\uff0c\u6bd4\u5982 `ListUser()` \u51fd\u6570\u4e2d\u4f1a\u5bf9\u6bcf\u4e2a\u7528\u6237\u8bb0\u5f55\u8fd4\u56de\u4e00\u4e2a sayHello \u5b57\u6bb5\u3002sayHello \u53ea\u662f\u7b80\u5355\u8f93\u51fa\u4e86\u4e00\u4e2a `Hello shortId` \u5b57\u7b26\u4e32\uff0c\u5176\u4e2d shortId \u662f\u901a\u8fc7 `util.GenShortId()` \u6765\u751f\u6210\u7684\uff08`GenShortId` \u5b9e\u73b0\u8be6\u89c1 [demo07/util/util.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/util/util.go)\uff09\u3002\u50cf\u8fd9\u7c7b\u64cd\u4f5c\u901a\u5e38\u4f1a\u589e\u52a0 API \u7684\u54cd\u5e94\u5ef6\u65f6\uff0c\u5982\u679c\u5217\u8868\u6761\u76ee\u8fc7\u591a\uff0c\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u8bb0\u5f55\u90fd\u8981\u505a\u4e00\u4e9b\u7c7b\u4f3c\u7684\u903b\u8f91\u5904\u7406\uff0c\u8fd9\u4f1a\u4f7f\u5f97\u6574\u4e2a API \u5ef6\u65f6\u5f88\u9ad8\uff0c\u6240\u4ee5\u7b14\u8005\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u901a\u5e38\u4f1a\u505a\u5e76\u884c\u5904\u7406\u3002\u6839\u636e\u7b14\u8005\u7ecf\u9a8c\uff0c\u6548\u679c\u63d0\u5347\u5341\u5206\u660e\u663e\u3002\r\n\r\n\u8bfb\u8005\u5e94\u8be5\u5df2\u7ecf\u6ce8\u610f\u5230\u4e86\uff0c\u5728 `ListUser()` \u5b9e\u73b0\u4e2d\uff0c\u6709 `sync.Mutex` \u548c `IdMap` \u7b49\u90e8\u5206\u4ee3\u7801\uff0c\u4f7f\u7528 `sync.Mutex` \u662f\u56e0\u4e3a\u5728\u5e76\u53d1\u5904\u7406\u4e2d\uff0c\u66f4\u65b0\u540c\u4e00\u4e2a\u53d8\u91cf\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0c\u901a\u5e38\u9700\u8981\u505a\u9501\u5904\u7406\u3002\r\n\r\n\u4f7f\u7528 `IdMap` \u662f\u56e0\u4e3a\u67e5\u8be2\u7684\u5217\u8868\u901a\u5e38\u9700\u8981\u6309\u65f6\u95f4\u987a\u5e8f\u8fdb\u884c\u6392\u5e8f\uff0c\u4e00\u822c\u6570\u636e\u5e93\u67e5\u8be2\u540e\u7684\u5217\u8868\u5df2\u7ecf\u6392\u8fc7\u5e8f\u4e86\uff0c\u4f46\u662f\u4e3a\u4e86\u51cf\u5c11\u5ef6\u65f6\uff0c\u7a0b\u5e8f\u4e2d\u7528\u4e86\u5e76\u53d1\uff0c\u8fd9\u65f6\u5019\u4f1a\u6253\u4e71\u6392\u5e8f\uff0c\u6240\u4ee5\u901a\u8fc7 `IdMap` \u6765\u8bb0\u5f55\u5e76\u53d1\u5904\u7406\u524d\u7684\u987a\u5e8f\uff0c\u5904\u7406\u540e\u518d\u91cd\u65b0\u590d\u4f4d\u3002\r\n\r\n## \u83b7\u53d6\u6307\u5b9a\u7528\u6237\u7684\u8be6\u7ec6\u4fe1\u606f\r\n\r\n\u4ee3\u7801\u8be6\u89c1 [demo07/handler/user/get.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/handler/user/get.go)\u3002\r\n\r\n\u83b7\u53d6\u6307\u5b9a\u7528\u6237\u4fe1\u606f\u65f6\uff0c\u9996\u5148\u6839\u636e URL \u8def\u5f84 `GET http://127.0.0.1/v1/user/admin` \u89e3\u6790\u51fa username \u7684\u503c admin\uff0c\u7136\u540e\u8c03\u7528 `model.GetUser()` \u51fd\u6570\u67e5\u8be2\u8be5\u7528\u6237\u7684\u6570\u636e\u5e93\u8bb0\u5f55\u5e76\u8fd4\u56de\uff0c\u51fd\u6570\u8be6\u89c1 [demo07/model/user.go](https://github.com/lexkong/apiserver_demos/blob/master/demo07/model/user.go)\u3002\r\n\r\n## \u7f16\u8bd1\u5e76\u8fd0\u884c\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo07` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\r\n\r\n```\r\n$ cp -a apiserver_demos/demo07/ $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ gofmt -w .\r\n$ go tool vet .\r\n$ go build -v .\r\n```\r\n\r\n**\u521b\u5efa\u7528\u6237**\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"username\":\"kong\",\"password\":\"kong123\"}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"username\": \"kong\"\r\n  }\r\n}\r\n```\r\n\r\n**\u67e5\u8be2\u7528\u6237\u5217\u8868**\r\n\r\n```\r\n$ curl -XGET -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"offset\": 0, \"limit\": 20}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"totalCount\": 2,\r\n    \"userList\": [\r\n      {\r\n        \"id\": 2,\r\n        \"username\": \"kong\",\r\n        \"sayHello\": \"Hello qhXO5iIig\",\r\n        \"password\": \"$2a$10$vE9jG71oyzstWVwB/QfU3u00Pxb.ye8hFIDvnyw60nHBv/xsJZoUO\",\r\n        \"createdAt\": \"2018-06-02 14:47:54\",\r\n        \"updatedAt\": \"2018-06-02 14:47:54\"\r\n      },\r\n      {\r\n        \"id\": 0,\r\n        \"username\": \"admin\",\r\n        \"sayHello\": \"Hello qhXO5iSmgz\",\r\n        \"password\": \"$2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG\",\r\n        \"createdAt\": \"2018-05-28 00:25:33\",\r\n        \"updatedAt\": \"2018-05-28 00:25:33\"\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230\uff0c\u65b0\u589e\u4e86\u4e00\u4e2a\u7528\u6237 `kong`\uff0c\u6570\u636e\u5e93 id \u7d22\u5f15\u4e3a `2`\u3002`admin` \u7528\u6237\u662f\u4e0a\u4e00\u8282\u4e2d\u521d\u59cb\u5316\u6570\u636e\u5e93\u65f6\u521d\u59cb\u5316\u7684\u3002\r\n\r\n> \u7b14\u8005\u5efa\u8bae\u5728 API \u8bbe\u8ba1\u65f6\uff0c\u5bf9\u8d44\u6e90\u5217\u8868\u8fdb\u884c\u5206\u9875\u3002\r\n\r\n**\u83b7\u53d6\u7528\u6237\u8be6\u7ec6\u4fe1\u606f**\r\n\r\n```\r\n$ curl -XGET -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user/kong\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"username\": \"kong\",\r\n    \"password\": \"$2a$10$vE9jG71oyzstWVwB/QfU3u00Pxb.ye8hFIDvnyw60nHBv/xsJZoUO\"\r\n  }\r\n}\r\n```\r\n**\u66f4\u65b0\u7528\u6237**\r\n\r\n\u5728 **\u67e5\u8be2\u7528\u6237\u5217\u8868** \u90e8\u5206\uff0c\u4f1a\u8fd4\u56de\u7528\u6237\u7684\u6570\u636e\u5e93\u7d22\u5f15\u3002\u4f8b\u5982\uff0c\u7528\u6237 `kong` \u7684\u6570\u636e\u5e93 id \u7d22\u5f15\u662f `2`\uff0c\u6240\u4ee5\u8fd9\u91cc\u8c03\u7528\u5982\u4e0b URL \u66f4\u65b0 `kong` \u7528\u6237\uff1a\r\n\r\n```\r\n$ curl -XPUT -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user/2 -d'{\"username\":\"kong\",\"password\":\"kongmodify\"}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": null\r\n}\r\n```\r\n\r\n\u83b7\u53d6 `kong` \u7528\u6237\u4fe1\u606f\uff1a\r\n\r\n```\r\n$ curl -XGET -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user/kong\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"username\": \"kong\",\r\n    \"password\": \"$2a$10$E0kwtmtLZbwW/bDQ8qI8e.eHPqhQOW9tvjwpyo/p05f/f4Qvr3OmS\"\r\n  }\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230\u5bc6\u7801\u5df2\u7ecf\u6539\u53d8\uff08\u65e7\u5bc6\u7801\u4e3a `$2a$10$vE9jG71oyzstWVwB/QfU3u00Pxb.ye8hFIDvnyw60nHBv/xsJZoUO`\uff09\u3002\r\n\r\n**\u5220\u9664\u7528\u6237**\r\n\r\n\u5728 **\u67e5\u8be2\u7528\u6237\u5217\u8868** \u90e8\u5206\uff0c\u4f1a\u8fd4\u56de\u7528\u6237\u7684\u6570\u636e\u5e93\u7d22\u5f15\u3002\u4f8b\u5982\uff0c\u7528\u6237 `kong` \u7684\u6570\u636e\u5e93 id \u7d22\u5f15\u662f `2`\uff0c\u6240\u4ee5\u8fd9\u91cc\u8c03\u7528\u5982\u4e0b URL \u5220\u9664 `kong` \u7528\u6237\uff1a\r\n\r\n```\r\n$ curl -XDELETE -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user/2\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": null\r\n}\r\n```\r\n\r\n\u83b7\u53d6\u7528\u6237\u5217\u8868\uff1a\r\n\r\n```\r\n$ curl -XGET -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"offset\": 0, \"limit\": 20}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"totalCount\": 1,\r\n    \"userList\": [\r\n      {\r\n        \"id\": 0,\r\n        \"username\": \"admin\",\r\n        \"sayHello\": \"Hello EnqntiSig\",\r\n        \"password\": \"$2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG\",\r\n        \"createdAt\": \"2018-05-28 00:25:33\",\r\n        \"updatedAt\": \"2018-05-28 00:25:33\"\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230\u7528\u6237 `kong` \u672a\u51fa\u73b0\u5728\u7528\u6237\u5217\u8868\u4e2d\uff0c\u8bf4\u660e\u4ed6\u5df2\u88ab\u6210\u529f\u5220\u9664\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u901a\u8fc7\u5bf9\u7528\u6237\u589e\u5220\u6539\u67e5\u548c\u67e5\u8be2\u5217\u8868\u7684\u64cd\u4f5c\uff0c\u4ecb\u7ecd\u4e86\u5b9e\u9645\u5f00\u53d1\u4e2d\u5982\u4f55\u5bf9 REST \u8d44\u6e90\u8fdb\u884c\u64cd\u4f5c\uff0c\u5e76\u7ed3\u5408\u7b14\u8005\u7684\u5b9e\u9645\u5f00\u53d1\u7ecf\u9a8c\u7ed9\u51fa\u4e86\u4e00\u4e9b\u5f00\u53d1\u4e60\u60ef\u548c\u5efa\u8bae\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/11\u57fa\u7840_8\u7528\u6237\u4e1a\u52a1\u903b\u8f91\u5904\u7406.md", "create_date": "2020-02-18T21:37:38.275", "order": 12}}, {"model": "subject.chapter", "pk": 129, "fields": {"title": "\u57fa\u7840 9\uff1aHTTP \u8c03\u7528\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5904\u7406\u903b\u8f91", "topic": 6, "md5": "8b9903b6b33feab620d6e359cf3281c6", "md_body": "# HTTP \u8c03\u7528\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5904\u7406\u903b\u8f91\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u4ecb\u7ecd gin middleware \u57fa\u672c\u7528\u6cd5\r\n+ \u4ecb\u7ecd\u5982\u4f55\u7528 gin middleware \u7279\u6027\u7ed9 API \u6dfb\u52a0\u552f\u4e00\u8bf7\u6c42 ID \u548c\u8bb0\u5f55\u8bf7\u6c42\u4fe1\u606f\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo08](https://github.com/lexkong/apiserver_demos/tree/master/demo08)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo07](https://github.com/lexkong/apiserver_demos/tree/master/demo07) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## \u9700\u6c42\u80cc\u666f\r\n\r\n\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u5bf9\u6bcf\u4e2a\u8bf7\u6c42/\u8fd4\u56de\u505a\u4e00\u4e9b\u7279\u5b9a\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u8bb0\u5f55\u8bf7\u6c42\u7684 log \u4fe1\u606f\uff0c\u5728\u8fd4\u56de\u4e2d\u63d2\u5165\u4e00\u4e2a Header\uff0c\u5bf9\u90e8\u5206\u63a5\u53e3\u8fdb\u884c\u9274\u6743\uff0c\u8fd9\u4e9b\u90fd\u9700\u8981\u4e00\u4e2a\u7edf\u4e00\u7684\u5165\u53e3\uff0c\u903b\u8f91\u5982\u4e0b\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/6/163d48f5200db6e1?w=1761&h=1214&f=png&s=99186)\r\n\r\n\u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u901a\u8fc7\u5f15\u5165 middleware \u4e2d\u95f4\u4ef6\u6765\u89e3\u51b3\u3002Go \u7684 `net/http` \u8bbe\u8ba1\u7684\u4e00\u5927\u7279\u70b9\u662f\u7279\u522b\u5bb9\u6613\u6784\u5efa\u4e2d\u95f4\u4ef6\u3002apiserver \u6240\u4f7f\u7528\u7684 gin \u6846\u67b6\u4e5f\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u7684\u4e2d\u95f4\u4ef6\u3002\r\n\r\n## gin middleware \u4e2d\u95f4\u4ef6\r\n\r\n\u5728 gin \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u6cd5\u4f7f\u7528 middleware\uff1a\r\n\r\n```go\r\ng := gin.New()\r\ng.Use(middleware.AuthMiddleware())\r\n```\r\n\r\n\u5176\u4e2d `middleware.AuthMiddleware()` \u662f `func(*gin.Context)` \u7c7b\u578b\u7684\u51fd\u6570\u3002\u4e2d\u95f4\u4ef6\u53ea\u5bf9\u6ce8\u518c\u8fc7\u7684\u8def\u7531\u51fd\u6570\u8d77\u4f5c\u7528\u3002\r\n\r\n\u5728 gin \u4e2d\u53ef\u4ee5\u8bbe\u7f6e 3 \u79cd\u7c7b\u578b\u7684 middleware\uff1a\r\n\r\n+ \u5168\u5c40\u4e2d\u95f4\u4ef6\r\n+ \u5355\u4e2a\u8def\u7531\u4e2d\u95f4\u4ef6\r\n+ \u7fa4\u7ec4\u4e2d\u95f4\u4ef6\r\n\r\n\u8fd9\u91cc\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u8fd9 3 \u79cd\u4e2d\u95f4\u4ef6\u3002\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/6/163d4a97c4d6c438?w=1369&h=830&f=png&s=68458)\r\n\r\n+ \u5168\u5c40\u4e2d\u95f4\u4ef6\uff1a\u6ce8\u518c\u4e2d\u95f4\u4ef6\u7684\u8fc7\u7a0b\u4e4b\u524d\u8bbe\u7f6e\u7684\u8def\u7531\uff0c\u5c06\u4e0d\u4f1a\u53d7\u6ce8\u518c\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\u3002\u53ea\u6709\u6ce8\u518c\u4e86\u4e2d\u95f4\u4ef6\u4e4b\u540e\u4ee3\u7801\u7684\u8def\u7531\u51fd\u6570\u89c4\u5219\uff0c\u624d\u4f1a\u88ab\u4e2d\u95f4\u4ef6\u88c5\u9970\u3002\r\n+ \u5355\u4e2a\u8def\u7531\u4e2d\u95f4\u4ef6\uff1a\u9700\u8981\u5728\u6ce8\u518c\u8def\u7531\u65f6\u6ce8\u518c\u4e2d\u95f4\u4ef6  \r\n  `r.GET(\"/benchmark\", MyBenchLogger(), benchEndpoint)`\r\n+ \u7fa4\u7ec4\u4e2d\u95f4\u4ef6\uff1a\u53ea\u8981\u5728\u7fa4\u7ec4\u8def\u7531\u4e0a\u6ce8\u518c\u4e2d\u95f4\u4ef6\u51fd\u6570\u5373\u53ef\u3002\r\n\r\n## \u4e2d\u95f4\u4ef6\u5b9e\u8df5\r\n\r\n\u4e3a\u4e86\u6f14\u793a\u4e2d\u95f4\u4ef6\u7684\u529f\u80fd\uff0c\u8fd9\u91cc\u7ed9 apiserver \u65b0\u589e\u4e24\u4e2a\u529f\u80fd\uff1a\r\n\r\n1. \u5728\u8bf7\u6c42\u548c\u8fd4\u56de\u7684 Header \u4e2d\u63d2\u5165 `X-Request-Id`\uff08`X-Request-Id` \u503c\u4e3a 32 \u4f4d\u7684 UUID\uff0c\u7528\u4e8e\u552f\u4e00\u6807\u8bc6\u4e00\u6b21 HTTP \u8bf7\u6c42\uff09\r\n2. \u65e5\u5fd7\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u6536\u5230\u7684\u8bf7\u6c42\r\n\r\n**\u63d2\u5165 `X-Request-Id`**\r\n\r\n\u9996\u5148\u9700\u8981\u5b9e\u73b0 `middleware.RequestId()` \u4e2d\u95f4\u4ef6\uff0c\u5728 `router/middleware` \u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a Go \u6e90\u6587\u4ef6 requestid.go\uff0c\u5185\u5bb9\u4e3a\uff08\u8be6\u89c1 [demo08/router/middleware/requestid.go](https://github.com/lexkong/apiserver_demos/blob/master/demo08/router/middleware/requestid.go)\uff09\uff1a\r\n\r\n```go\r\npackage middleware\r\n\r\nimport (\r\n\t\"github.com/gin-gonic/gin\"\r\n\t\"github.com/satori/go.uuid\"\r\n)\r\n\r\nfunc RequestId() gin.HandlerFunc {\r\n\treturn func(c *gin.Context) {\r\n\t\t// Check for incoming header, use it if exists\r\n\t\trequestId := c.Request.Header.Get(\"X-Request-Id\")\r\n\r\n\t\t// Create request id with UUID4\r\n\t\tif requestId == \"\" {\r\n\t\t\tu4, _ := uuid.NewV4()\r\n\t\t\trequestId = u4.String()\r\n\t\t}\r\n\r\n\t\t// Expose it for use in the application\r\n\t\tc.Set(\"X-Request-Id\", requestId)\r\n\r\n\t\t// Set X-Request-Id header\r\n\t\tc.Writer.Header().Set(\"X-Request-Id\", requestId)\r\n\t\tc.Next()\r\n\t}\r\n}\r\n```\r\n\r\n\u8be5\u4e2d\u95f4\u4ef6\u8c03\u7528 `github.com/satori/go.uuid` \u5305\u751f\u6210\u4e00\u4e2a 32 \u4f4d\u7684 UUID\uff0c\u5e76\u901a\u8fc7 `c.Writer.Header().Set(\"X-Request-Id\", requestId)` \u8bbe\u7f6e\u5728\u8fd4\u56de\u5305\u7684 Header \u4e2d\u3002\r\n\r\n\u8be5\u4e2d\u95f4\u4ef6\u662f\u4e2a\u5168\u5c40\u4e2d\u95f4\u4ef6\uff0c\u9700\u8981\u5728 `main` \u51fd\u6570\u4e2d\u901a\u8fc7 `g.Use()` \u51fd\u6570\u52a0\u8f7d\uff1a\r\n\r\n```go \r\nfunc main() {\r\n    ...\r\n    // Routes.\r\n    router.Load(\r\n        // Cores.\r\n        g,  \r\n            \r\n        // Middlwares.\r\n        middleware.RequestId(),\r\n    )       \r\n    ...\r\n}\r\n```\r\n\r\n`main` \u51fd\u6570\u8c03\u7528 `router.Load()`\uff0c\u51fd\u6570 `router.Load()` \u6700\u7ec8\u8c03\u7528 `g.Use()` \u52a0\u8f7d\u8be5\u4e2d\u95f4\u4ef6\u3002\r\n\r\n**\u65e5\u5fd7\u8bb0\u5f55\u8bf7\u6c42**\r\n\r\n\u540c\u6837\uff0c\u9700\u8981\u5148\u5b9e\u73b0\u65e5\u5fd7\u8bf7\u6c42\u4e2d\u95f4\u4ef6 `middleware.Logging()`\uff0c\u7136\u540e\u5728 `main` \u51fd\u6570\u4e2d\u901a\u8fc7 `g.Use()` \u52a0\u8f7d\u8be5\u4e2d\u95f4\u4ef6\uff1a\r\n\r\n```go\r\nfunc main() {\r\n    ...\r\n    // Routes.\r\n    router.Load(\r\n        // Cores.\r\n        g,  \r\n            \r\n        // Middlwares.\r\n        middleware.Logging(),\r\n    )       \r\n    ...\r\n}\r\n```\r\n\r\n`middleware.Logging()` \u5b9e\u73b0\u7a0d\u5fae\u590d\u6742\u70b9\uff0c\u8bfb\u8005\u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u6e90\u7801\u5b9e\u73b0\uff1a[demo08/router/middleware/logging.go](https://github.com/lexkong/apiserver_demos/blob/master/demo08//router/middleware/logging.go)\u3002\r\n\r\n\u8fd9\u91cc\u6709\u51e0\u70b9\u9700\u8981\u8bf4\u660e\uff1a\r\n\r\n1. \u8be5\u4e2d\u95f4\u4ef6\u9700\u8981\u622a\u83b7 HTTP \u7684\u8bf7\u6c42\u4fe1\u606f\uff0c\u7136\u540e\u6253\u5370\u8bf7\u6c42\u4fe1\u606f\uff0c\u56e0\u4e3a HTTP \u7684\u8bf7\u6c42 Body\uff0c\u5728\u8bfb\u53d6\u8fc7\u540e\u4f1a\u88ab\u7f6e\u7a7a\uff0c\u6240\u4ee5\u8fd9\u91cc\u8bfb\u53d6\u5b8c\u540e\u4f1a\u91cd\u65b0\u8d4b\u503c\uff1a\r\n\r\n```go\r\nvar bodyBytes []byte\r\nif c.Request.Body != nil {\r\n    bodyBytes, _ = ioutil.ReadAll(c.Request.Body)\r\n}             \r\n\r\n// Restore the io.ReadCloser to its original state\r\nc.Request.Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes))\r\n```\r\n\r\n2. \u622a\u83b7 HTTP \u7684 Response \u66f4\u9ebb\u70e6\u4e9b\uff0c\u539f\u7406\u662f\u91cd\u5b9a\u5411 HTTP \u7684 Response \u5230\u6307\u5b9a\u7684 IO \u6d41\uff0c\u8be6\u89c1\u6e90\u7801\u6587\u4ef6\u3002\r\n3. \u622a\u83b7 HTTP \u7684 Request \u548c Response \u540e\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u9700\u8981\u7684\u4fe1\u606f\uff0c\u6700\u7ec8\u7a0b\u5e8f\u901a\u8fc7 `log.Infof()` \u8bb0\u5f55 HTTP \u7684\u8bf7\u6c42\u4fe1\u606f\u3002\r\n4. \u8be5\u4e2d\u95f4\u4ef6\u53ea\u8bb0\u5f55\u4e1a\u52a1\u8bf7\u6c42\uff0c\u6bd4\u5982 /v1/user \u548c /login \u8def\u5f84\u3002\r\n\r\n## \u7f16\u8bd1\u5e76\u6d4b\u8bd5\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo08` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\r\n\r\n```\r\n$ cp -a apiserver_demos/demo08 $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ gofmt -w .\r\n$ go tool vet .\r\n$ go build -v .\r\n```\r\n\r\n**\u6d4b\u8bd5 `middleware.RequestId()` \u4e2d\u95f4\u4ef6**\r\n\r\n\u53d1\u9001 HTTP \u8bf7\u6c42 \u2014\u2014 \u67e5\u8be2\u7528\u6237\u5217\u8868\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/6/163d4c476135f3fe?w=1900&h=661&f=png&s=81367)\r\n\r\n\u53ef\u4ee5\u770b\u5230\uff0cHTTP \u8fd4\u56de\u7684 Header \u6709 32 \u4f4d\u7684 UUID\uff1a`X-Request-Id: 1f8b1ae2-8009-4921-b354-86f25022dfa0`\u3002\r\n\r\n**\u6d4b\u8bd5 `middleware.Logging()` \u4e2d\u95f4\u4ef6**\r\n\r\n\u5728 API \u65e5\u5fd7\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u6709 HTTP \u8bf7\u6c42\u8bb0\u5f55\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/6/163d4c93ba35c6a4?w=1916&h=858&f=png&s=146763)\r\n\r\n\u65e5\u5fd7\u8bb0\u5f55\u4e86 HTTP \u8bf7\u6c42\u7684\u5982\u4e0b\u4fe1\u606f\uff0c\u4f9d\u6b21\u4e3a\uff1a\r\n\r\n1. \u8017\u65f6\r\n2. \u8bf7\u6c42 IP\r\n3. HTTP \u65b9\u6cd5 HTTP \u8def\u5f84\r\n4. \u8fd4\u56de\u7684 Code \u548c Message\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u901a\u8fc7\u5177\u4f53\u5b9e\u4f8b\u5c55\u793a\uff0c\u5982\u4f55\u901a\u8fc7 gin \u7684 middleware \u7279\u6027\u6765\u5bf9 HTTP \u8bf7\u6c42\u8fdb\u884c\u5fc5\u8981\u7684\u903b\u8f91\u5904\u7406\u3002\u4e0b\u4e00\u5c0f\u8282\u5373\u662f\u57fa\u4e8e gin \u4e2d\u95f4\u4ef6\u5b9e\u73b0\u7684\u3002\r\n", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/12\u57fa\u7840_9HTTP_\u8c03\u7528\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5904\u7406\u903b\u8f91.md", "create_date": "2020-02-18T21:37:38.286", "order": 13}}, {"model": "subject.chapter", "pk": 130, "fields": {"title": "\u57fa\u7840 10\uff1aAPI \u8eab\u4efd\u9a8c\u8bc1", "topic": 6, "md5": "663d82e0d0b72dd8ef3c7bef1cbe8d1d", "md_body": "# API \u8eab\u4efd\u9a8c\u8bc1\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u4ecb\u7ecd API \u8eab\u4efd\u9a8c\u8bc1\u7684\u5e38\u7528\u673a\u5236\r\n+ \u4ecb\u7ecd\u5982\u4f55\u8fdb\u884c API \u8eab\u4efd\u9a8c\u8bc1\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo09](https://github.com/lexkong/apiserver_demos/tree/master/demo09)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo08](https://github.com/lexkong/apiserver_demos/tree/master/demo08) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## API \u8eab\u4efd\u9a8c\u8bc1\r\n\r\n\u5728\u5178\u578b\u4e1a\u52a1\u573a\u666f\u4e2d\uff0c\u4e3a\u4e86\u533a\u5206\u7528\u6237\u548c\u5b89\u5168\u4fdd\u5bc6\uff0c\u5fc5\u987b\u5bf9 API \u8bf7\u6c42\u8fdb\u884c\u9274\u6743\uff0c\r\n\u4f46\u662f\u4e0d\u80fd\u8981\u6c42\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u90fd\u8fdb\u884c\u767b\u5f55\u64cd\u4f5c\u3002\u5408\u7406\u505a\u6cd5\u662f\uff0c\u5728\u7b2c\u4e00\u6b21\u767b\u5f55\u4e4b\u540e\u4ea7\u751f\u4e00\u4e2a\u6709\u4e00\u5b9a\u6709\u6548\u671f\u7684 token\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u4e8e\u6d4f\u89c8\u5668\u7684 Cookie \u6216 LocalStorage \u4e4b\u4e2d\uff0c\u4e4b\u540e\u7684\u8bf7\u6c42\u90fd\u643a\u5e26\u8be5 token \uff0c\u8bf7\u6c42\u5230\u8fbe\u670d\u52a1\u5668\u7aef\u540e\uff0c\u670d\u52a1\u5668\u7aef\u7528\u8be5 token \u5bf9\u8bf7\u6c42\u8fdb\u884c\u9274\u6743\u3002\u5728\u7b2c\u4e00\u6b21\u767b\u5f55\u4e4b\u540e\uff0c\u670d\u52a1\u5668\u4f1a\u5c06\u8fd9\u4e2a token \u7528\u6587\u4ef6\u3001\u6570\u636e\u5e93\u6216\u7f13\u5b58\u670d\u52a1\u5668\u7b49\u65b9\u6cd5\u5b58\u4e0b\u6765\uff0c\u7528\u4e8e\u4e4b\u540e\u8bf7\u6c42\u4e2d\u7684\u6bd4\u5bf9\u3002\u6216\u8005\uff0c\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\u662f\uff0c\u76f4\u63a5\u7528\u5bc6\u94a5\u5bf9\u7528\u6237\u4fe1\u606f\u548c\u65f6\u95f4\u6233\u8fdb\u884c\u7b7e\u540d\u5bf9\u79f0\u52a0\u5bc6\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7701\u4e0b\u989d\u5916\u7684\u5b58\u50a8\uff0c\u4e5f\u53ef\u4ee5\u51cf\u5c11\u6bcf\u4e00\u6b21\u8bf7\u6c42\u65f6\u5bf9\u6570\u636e\u5e93\u7684\u67e5\u8be2\u538b\u529b\u3002\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5728\u4e1a\u754c\u5df2\u7ecf\u6709\u4e00\u79cd\u6807\u51c6\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u8be5\u65b9\u5f0f\u88ab\u79f0\u4e3a JSON Web Token\uff08JWT\uff0c\u97f3\u540c jot\uff0c\u8be6\u89c1 [JWT RFC 7519](https://tools.ietf.org/html/rfc7519)\uff09\u3002\r\n\r\n> token \u7684\u610f\u601d\u662f\u201c\u4ee4\u724c\u201d\uff0c\u91cc\u9762\u5305\u542b\u4e86\u7528\u4e8e\u8ba4\u8bc1\u7684\u4fe1\u606f\u3002\u8fd9\u91cc\u7684 token \u662f\u6307 JSON Web Token\uff08JWT\uff09\u3002\r\n\r\n## JWT \u7b80\u4ecb\r\n\r\n**JWT \u8ba4\u8bc1\u6d41\u7a0b**\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/18/164107dc88e79a61?w=1833&h=1431&f=png&s=89827)\r\n\r\n1. \u5ba2\u6237\u7aef\u4f7f\u7528\u7528\u6237\u540d\u548c\u5bc6\u7801\u8bf7\u6c42\u767b\u5f55\r\n2. \u670d\u52a1\u7aef\u6536\u5230\u8bf7\u6c42\u540e\u4f1a\u53bb\u9a8c\u8bc1\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u540d\u548c\u5bc6\u7801\u8ddf\u6570\u636e\u5e93\u8bb0\u5f55\u4e0d\u4e00\u81f4\u5219\u9a8c\u8bc1\u5931\u8d25\uff0c\u5982\u679c\u4e00\u81f4\u5219\u9a8c\u8bc1\u901a\u8fc7\uff0c\u670d\u52a1\u7aef\u4f1a\u7b7e\u53d1\u4e00\u4e2a Token \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\r\n3. \u5ba2\u6237\u7aef\u6536\u5230\u8bf7\u6c42\u540e\u4f1a\u5c06 Token \u7f13\u5b58\u8d77\u6765\uff0c\u6bd4\u5982\u653e\u5728\u6d4f\u89c8\u5668 Cookie \u4e2d\u6216\u8005\u672c\u5730\u5b58\u50a8\u4e2d\uff0c\u4e4b\u540e\u6bcf\u6b21\u8bf7\u6c42\u90fd\u4f1a\u643a\u5e26\u8be5 Token\r\n4. \u670d\u52a1\u7aef\u6536\u5230\u8bf7\u6c42\u540e\u4f1a\u9a8c\u8bc1\u8bf7\u6c42\u4e2d\u643a\u5e26\u7684 Token\uff0c\u9a8c\u8bc1\u901a\u8fc7\u5219\u8fdb\u884c\u4e1a\u52a1\u903b\u8f91\u5904\u7406\u5e76\u6210\u529f\u8fd4\u56de\u6570\u636e\r\n\r\n\u5728 JWT \u4e2d\uff0cToken \u6709\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u4e2d\u95f4\u7528 `.` \u9694\u5f00\uff0c\u5e76\u4f7f\u7528 Base64 \u7f16\u7801\uff1a\r\n\r\n+ header\r\n+ payload\r\n+ signature\r\n\r\n\u5982\u4e0b\u662f JWT \u4e2d\u7684\u4e00\u4e2a Token \u793a\u4f8b\uff1a\r\n\r\n```\r\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\r\n```\r\n\r\n**header \u4ecb\u7ecd**\r\n\r\nJWT Token \u7684 header \u4e2d\uff0c\u5305\u542b\u4e24\u90e8\u5206\u4fe1\u606f\uff1a\r\n1. Token \u7684\u7c7b\u578b\r\n2. Token \u6240\u4f7f\u7528\u7684\u52a0\u5bc6\u7b97\u6cd5\r\n\r\n\u4f8b\u5982\uff1a\r\n```json\r\n{\r\n  \"typ\": \"JWT\",\r\n  \"alg\": \"HS256\"\r\n}\r\n```\r\n\r\n\u8be5\u4f8b\u8bf4\u660e Token \u7c7b\u578b\u662f JWT\uff0c\u52a0\u5bc6\u7b97\u6cd5\u662f HS256\uff08alg \u7b97\u6cd5\u53ef\u4ee5\u6709\u591a\u79cd\uff09\u3002\r\n\r\n**Payload \u8f7d\u8377\u4ecb\u7ecd**\r\n\r\nPayload \u4e2d\u643a\u5e26 Token \u7684\u5177\u4f53\u5185\u5bb9\uff0c\u91cc\u9762\u6709\u4e00\u4e9b\u6807\u51c6\u7684\u5b57\u6bb5\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u6dfb\u52a0\u989d\u5916\u7684\u5b57\u6bb5\uff0c\u6765\u8868\u8fbe\u66f4\u4e30\u5bcc\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e9b\u4fe1\u606f\u6765\u505a\u66f4\u4e30\u5bcc\u7684\u5904\u7406\uff0c\u6bd4\u5982\u8bb0\u5f55\u8bf7\u6c42\u7528\u6237\u540d\uff0c\u6807\u51c6\u5b57\u6bb5\u6709\uff1a\r\n\r\n+ iss\uff1aJWT Token \u7684\u7b7e\u53d1\u8005\r\n+ sub\uff1a\u4e3b\u9898\r\n+ exp\uff1aJWT Token \u8fc7\u671f\u65f6\u95f4\r\n+ aud\uff1a\u63a5\u6536 JWT Token \u7684\u4e00\u65b9\r\n+ iat\uff1aJWT Token \u7b7e\u53d1\u65f6\u95f4\r\n+ nbf\uff1aJWT Token \u751f\u6548\u65f6\u95f4 \r\n+ jti\uff1aJWT Token ID\r\n\r\n\u672c\u4f8b\u4e2d\u7684 payload \u5185\u5bb9\u4e3a\uff1a\r\n\r\n```json\r\n{\r\n \"id\": 2,\r\n \"username\": \"kong\",\r\n \"nbf\": 1527931805,\r\n \"iat\": 1527931805\r\n}\r\n```\r\n\r\n**Signature \u7b7e\u540d\u4ecb\u7ecd**\r\n\r\n`Signature` \u662f Token \u7684\u7b7e\u540d\u90e8\u5206\uff0c\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u751f\u6210\uff1a\r\n1. \u7528 Base64 \u5bf9 header.payload \u8fdb\u884c\u7f16\u7801\r\n2. \u7528 Secret \u5bf9\u7f16\u7801\u540e\u7684\u5185\u5bb9\u8fdb\u884c\u52a0\u5bc6\uff0c\u52a0\u5bc6\u540e\u7684\u5185\u5bb9\u5373\u4e3a `Signature`\r\n\r\nSecret \u76f8\u5f53\u4e8e\u4e00\u4e2a\u5bc6\u7801\uff0c\u5b58\u50a8\u5728\u670d\u52a1\u7aef\uff0c\u4e00\u822c\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u914d\u7f6e Secret \u7684\u503c\uff0c\u672c\u4f8b\u4e2d\u662f\u914d\u7f6e\u5728 `conf/config.yaml` \u914d\u7f6e\u6587\u4ef6\u4e2d:\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/2/163bfc8ea855234a?w=1939&h=729&f=png&s=79670)\r\n\r\n\u6700\u540e\u751f\u6210\u7684 Token \u50cf\u8fd9\u6837\uff1a\r\n\r\n```\r\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\r\n```\r\n\u7b7e\u540d\u540e\u670d\u52a1\u7aef\u4f1a\u8fd4\u56de\u751f\u6210\u7684 Token\uff0c\u5ba2\u6237\u7aef\u4e0b\u6b21\u8bf7\u6c42\u4f1a\u643a\u5e26\u8be5 Token\uff0c\u670d\u52a1\u7aef\u6536\u5230 Token \u540e\u4f1a\u89e3\u6790\u51fa header.payload\uff0c\u7136\u540e\u7528\u76f8\u540c\u7684\u52a0\u5bc6\u7b97\u6cd5\u548c\u5bc6\u7801\u5bf9 header.payload \u518d\u8fdb\u884c\u4e00\u6b21\u52a0\u5bc6\uff0c\u5e76\u5bf9\u6bd4\u52a0\u5bc6\u540e\u7684 Token \u548c\u6536\u5230\u7684 Token \u662f\u5426\u76f8\u540c\uff0c\u5982\u679c\u76f8\u540c\u5219\u9a8c\u8bc1\u901a\u8fc7\uff0c\u4e0d\u76f8\u540c\u5219\u8fd4\u56de `HTTP 401 Unauthorized` \u7684\u9519\u8bef\u3002\r\n\r\n> \u8be6\u7ec6\u7684 JWT \u4ecb\u7ecd\u53c2\u8003 [JWT \u2013 \u57fa\u4e8e Token \u7684\u8eab\u4efd\u9a8c\u8bc1](https://blog.csdn.net/qq_28098067/article/details/52036493)\u3002\r\n\r\n## \u5982\u4f55\u8fdb\u884c API \u8eab\u4efd\u9a8c\u8bc1\r\n\r\nAPI \u8eab\u4efd\u8ba4\u8bc1\u5305\u62ec\u4e24\u6b65\uff1a\r\n1. \u7b7e\u53d1 token\r\n2. API \u6dfb\u52a0\u8ba4\u8bc1 middleware\r\n\r\n**\u7b7e\u53d1 token**\r\n\r\n\u9996\u5148\u8981\u5b9e\u73b0\u767b\u5f55\u63a5\u53e3\u3002\u5728\u767b\u5f55\u63a5\u53e3\u4e2d\u91c7\u7528\u660e\u6587\u6821\u9a8c\u7528\u6237\u540d\u5bc6\u7801\u7684\u65b9\u5f0f\uff0c\u767b\u5f55\u6210\u529f\u4e4b\u540e\u518d\u4ea7\u751f token\u3002\u5728 `router/router.go` \u6587\u4ef6\u4e2d\u6dfb\u52a0\u767b\u5f55\u5165\u53e3\uff1a\r\n\r\n```go\r\n// api for authentication functionalities\r\ng.POST(\"/login\", user.Login)\r\n```\r\n\r\n\u5728 `handler/user/login.go`\uff08\u8be6\u89c1 [demo09/handler/user/login.go](https://github.com/lexkong/apiserver_demos/blob/master/demo09/handler/user/login.go)\uff09\u4e2d\u6dfb\u52a0 login \u7684\u5177\u4f53\u5b9e\u73b0\uff1a\r\n\r\n1. \u89e3\u6790\u7528\u6237\u540d\u548c\u5bc6\u7801\r\n2. \u901a\u8fc7 `auth.Compare()` \u5bf9\u6bd4\u5bc6\u7801\u662f\u5426\u662f\u6570\u636e\u5e93\u4fdd\u5b58\u7684\u5bc6\u7801\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u8fd4\u56de `errno.ErrPasswordIncorrect` \u9519\u8bef\r\n3. \u5982\u679c\u76f8\u540c\uff0c\u6388\u6743\u901a\u8fc7\uff0c\u901a\u8fc7 `token.Sign()` \u7b7e\u53d1 token \u5e76\u8fd4\u56de\r\n\r\n> `auth.Compare()` \u7684\u5b9e\u73b0\u8be6\u89c1 [demo09/pkg/auth/auth.go](https://github.com/lexkong/apiserver_demos/blob/master/demo09/pkg/auth/auth.go)\u3002\r\n>\r\n> `token.Sign()` \u7684\u5b9e\u73b0\u8be6\u89c1 [demo09/pkg/token/token.go](https://github.com/lexkong/apiserver_demos/blob/master/demo09/pkg/token/token.go)\u3002\r\n\r\n**API \u6dfb\u52a0\u8ba4\u8bc1 middleware**\r\n\r\n\u5728 `router/router.go` \u4e2d\u5bf9 user handler \u6dfb\u52a0\u6388\u6743 middleware\uff1a\r\n\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/2/163bfbb7b2c4758a?w=1755&h=594&f=png&s=45796)\r\n\r\n\u901a\u8fc7\u8be5 middleware\uff0c\u6240\u6709\u5bf9 `/v1/user` \u8def\u5f84\u7684\u8bf7\u6c42\uff0c\u90fd\u4f1a\u7ecf\u8fc7 `middleware.AuthMiddleware()` \u4e2d\u95f4\u4ef6\u7684\u5904\u7406\uff1atoken \u6821\u9a8c\u3002`middleware.AuthMiddleware()` \u51fd\u6570\u662f\u901a\u8fc7\u8c03\u7528 `token.ParseRequest()` \u6765\u8fdb\u884c token \u6821\u9a8c\u7684\u3002\r\n\r\n> `middleware.AuthMiddleware()` \u5b9e\u73b0\u8be6\u89c1 [demo09/router/middleware/auth.go](https://github.com/lexkong/apiserver_demos/blob/master/demo09/router/middleware/auth.go)\u3002\r\n>\r\n> `token.ParseRequest()` \u5b9e\u73b0\u8be6\u89c1 [demo09/pkg/token/token.go](https://github.com/lexkong/apiserver_demos/blob/master/demo09/pkg/token/token.go)\u3002\r\n\r\n## \u7f16\u8bd1\u5e76\u6d4b\u8bd5\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo09` \u590d\u5236\u4e3a` $GOPATH/src/apiserver`\r\n```\r\n$ cp -a apiserver_demos/demo09/ $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ gofmt -w .\r\n$ go tool vet .\r\n$ go build -v .\r\n```\r\n\r\n\u4e0a\u6587\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\uff0cAPI \u8eab\u4efd\u9a8c\u8bc1\u9996\u5148\u9700\u8981\u767b\u5f55\uff0c\u767b\u5f55\u6210\u529f\u540e\u4f1a\u7b7e\u53d1 token\uff0c\u4e4b\u540e\u8bf7\u6c42\u65f6\u5728 HTTP Header \u4e2d\u5e26\u4e0a token \u5373\u53ef\u3002\r\n\r\n1. \u7528\u6237\u767b\u5f55\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/login -d'{\"username\":\"admin\",\"password\":\"admin\"}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\"\r\n  }\r\n}\r\n```\r\n\r\n\u8fd4\u56de\u7684 token \u4e3a `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ`\u3002\r\n\r\n2. \u8bf7\u6c42\u65f6\u5982\u679c\u4e0d\u643a\u5e26\u7b7e\u53d1\u7684 token\uff0c\u4f1a\u7981\u6b62\u8bf7\u6c42\r\n\r\n```\r\n$ curl -XPOST -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"username\":\"user1\",\"password\":\"user1234\"}'\r\n\r\n{\r\n  \"code\": 20103,\r\n  \"message\": \"The token was invalid.\",\r\n  \"data\": null\r\n}\r\n```\r\n\r\n3. \u8bf7\u6c42\u65f6\u643a\u5e26 token\r\n\r\n```\r\n$ curl -XPOST -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\" -H \"Content-Type: application/json\" http://127.0.0.1:8080/v1/user -d'{\"username\":\"user1\",\"password\":\"user1234\"}'\r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"username\": \"user1\"\r\n  }\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230\u643a\u5e26 token \u540e\u9a8c\u8bc1\u901a\u8fc7\uff0c\u6210\u529f\u521b\u5efa\u7528\u6237\u3002\u901a\u8fc7 HTTP Header `Authorization: Bearer $token` \u6765\u643a\u5e26 token\u3002\u643a\u5e26 token \u540e\u4e0d\u9700\u8981\u518d\u6b21\u67e5\u8be2\u6570\u636e\u5e93\u6838\u5bf9\u5bc6\u7801\uff0c\u5373\u53ef\u5b8c\u6210\u6388\u6743\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u4ecb\u7ecd\u4e86 API \u8eab\u4efd\u9a8c\u8bc1\u7684\u76f8\u5173\u77e5\u8bc6\u3002apiserver \u91c7\u7528\u7684\u8ba4\u8bc1\u65b9\u5f0f\u4e3a JWT\uff0c\u5c0f\u8282\u7b80\u5355\u4ecb\u7ecd\u4e86 JWT \u7684\u8ba4\u8bc1\u6d41\u7a0b\uff0c\u5e76\u901a\u8fc7\u5b9e\u4f8b\u5c55\u793a\u4e86\u5177\u4f53\u5982\u4f55\u8fdb\u884c JWT \u8ba4\u8bc1\u3002\r\n\r\n\u901a\u8fc7\u4ee5\u4e0a\u5c0f\u8282\u7684\u5b66\u4e60\uff0c\u8bfb\u8005\u5df2\u7ecf\u53ef\u4ee5\u8fdb\u884c\u57fa\u672c\u7684 API \u5f00\u53d1\u4e86\uff0c\u4e0b\u4e00\u8282\u5f00\u59cb\u4ecb\u7ecd API \u5f00\u53d1\u7684\u8fdb\u9636\u5185\u5bb9\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/13\u57fa\u7840_10API_\u8eab\u4efd\u9a8c\u8bc1.md", "create_date": "2020-02-18T21:37:38.305", "order": 14}}, {"model": "subject.chapter", "pk": 131, "fields": {"title": "\u8fdb\u9636 1\uff1a\u7528 HTTPS \u52a0\u5bc6 API \u8bf7\u6c42", "topic": 6, "md5": "4d4b2cdbad7b76da5490bec08b1e4a4d", "md_body": "# \u7528 HTTPS \u52a0\u5bc6 API \u8bf7\u6c42\n\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\n\n+ \u4ecb\u7ecd HTTPS \u57fa\u672c\u539f\u7406\n+ \u4ecb\u7ecd\u5982\u4f55\u7528 HTTPS \u52a0\u5bc6 API \u8bf7\u6c42\uff0c\u5e76\u6d4b\u8bd5\u52a0\u5bc6\u6548\u679c\n\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo10](https://github.com/lexkong/apiserver_demos/tree/master/demo10)\n>\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\n>\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo09](https://github.com/lexkong/apiserver_demos/tree/master/demo09) \u6765\u5f00\u53d1\u7684\u3002\n\n\n## \u4ec0\u4e48\u662f HTTPS\n\n\u5728\u524d\u9762\u7684\u5c0f\u8282\u4e2d\uff0c\u5ba2\u6237\u7aef\u4e0e API \u670d\u52a1\u5668\u8bf7\u6c42\u54cd\u5e94\u7528\u7684\u662f HTTP\uff0c\u4e0d\u8fc7 HTTP \u662f\u660e\u6587\u7684\uff0c\u5728\u7f51\u7edc\u4e0a\u8fdb\u884c\u4f20\u8f93\u53ef\u80fd\u4f1a\u88ab\u7a83\u542c\u3001\u7be1\u6539\u751a\u81f3\u5192\u5145\uff0c\u56e0\u6b64\u5bf9\u4e8e\u4e00\u4e2a\u4f01\u4e1a\u7ea7\u7684 API \u670d\u52a1\u5668\u6765\u8bf4\uff0c\u901a\u5e38\u9700\u8981\u91c7\u7528\u66f4\u5b89\u5168\u7684 HTTPS \u534f\u8bae\u3002\n\nHTTPS\uff08\u5168\u79f0 Hyper Text Transfer Protocol over Secure Socket Layer\uff09\uff0c\u662f\u4ee5\u5b89\u5168\u4e3a\u76ee\u6807\u7684 HTTP \u901a\u9053\uff0c\u7b80\u5355\u8bb2\u662f HTTP \u7684\u5b89\u5168\u7248\u3002\u5373 HTTP \u4e0b\u52a0\u5165 SSL \u5c42\uff0cHTTPS \u7684\u5b89\u5168\u57fa\u7840\u662f SSL\uff0c\u56e0\u6b64\u52a0\u5bc6\u7684\u8be6\u7ec6\u5185\u5bb9\u5c31\u9700\u8981 SSL\u3002\n\n>  SSL\uff1a\u5b89\u5168\u5957\u63a5\u5c42\uff0c\u662f Netscape \u516c\u53f8\u8bbe\u8ba1\u7684\u4e3b\u8981\u7528\u4e8e Web \u7684\u5b89\u5168\u4f20\u8f93\u534f\u8bae\u3002\u8fd9\u79cd\u534f\u8bae\u5728 Web \u4e0a\u83b7\u5f97\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\u3002\u901a\u8fc7\u8bc1\u4e66\u8ba4\u8bc1\u6765\u786e\u4fdd\u5ba2\u6237\u7aef\u548c\u7f51\u7ad9\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u6570\u636e\u662f\u52a0\u5bc6\u5b89\u5168\u7684\u3002\n>\n> TLS \u662f SSL \u7684\u5347\u7ea7\u7248\uff0c\u4f7f\u7528\u5c42\u9762\uff0c\u8bfb\u8005\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e8c\u8005\u65e0\u533a\u522b\u3002\n\n##  HTTPS \u7684\u5b9e\u73b0\u539f\u7406\n\nHTTPS \u5728\u4f20\u8f93\u6570\u636e\u4e4b\u524d\u9700\u8981\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\u4e0e\u670d\u52a1\u7aef\uff08\u7f51\u7ad9\uff09\u4e4b\u95f4\u8fdb\u884c\u4e00\u6b21\u63e1\u624b\uff0c\u5728\u63e1\u624b\u8fc7\u7a0b\u4e2d\u5c06\u786e\u7acb\u53cc\u65b9\u52a0\u5bc6\u4f20\u8f93\u6570\u636e\u7684\u5bc6\u7801\u4fe1\u606f\u3002\n\n\u6709\u4e24\u79cd\u57fa\u672c\u7684\u52a0\u89e3\u5bc6\u7b97\u6cd5\u7c7b\u578b\uff1a\n\n1. \u5bf9\u79f0\u52a0\u5bc6\uff1a\u5bc6\u94a5\u53ea\u6709\u4e00\u4e2a\uff0c\u52a0\u5bc6\u89e3\u5bc6\u4e3a\u540c\u4e00\u4e2a\u5bc6\u7801\uff0c\u4e14\u52a0\u89e3\u5bc6\u901f\u5ea6\u5feb\uff0c\u5178\u578b\u7684\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u6709 DES\u3001AES \u7b49\u3002\n\n2. \u975e\u5bf9\u79f0\u52a0\u5bc6\uff1a\u5bc6\u94a5\u6210\u5bf9\u51fa\u73b0\uff08\u4e14\u6839\u636e\u516c\u94a5\u65e0\u6cd5\u63a8\u77e5\u79c1\u94a5\uff0c\u6839\u636e\u79c1\u94a5\u4e5f\u65e0\u6cd5\u63a8\u77e5\u516c\u94a5\uff09\uff0c\u52a0\u5bc6\u89e3\u5bc6\u4f7f\u7528\u4e0d\u540c\u5bc6\u94a5\uff08\u516c\u94a5\u52a0\u5bc6\u9700\u8981\u79c1\u94a5\u89e3\u5bc6\uff0c\u79c1\u94a5\u52a0\u5bc6\u9700\u8981\u516c\u94a5\u89e3\u5bc6\uff09\uff0c\u76f8\u5bf9\u5bf9\u79f0\u52a0\u5bc6\u901f\u5ea6\u8f83\u6162\uff0c\u5178\u578b\u7684\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u6709 RSA\u3001DSA \u7b49\u3002\n\n\u4e0b\u56fe\u662f HTTPS \u7684\u901a\u4fe1\u8fc7\u7a0b\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/7/163dae1f30eba0a6?w=369&h=408&f=jpeg&s=28302)\n\n\u6d41\u7a0b\u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a\n\n1. SSL \u5ba2\u6237\u7aef\u901a\u8fc7 TCP \u548c\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\uff08443 \u7aef\u53e3\uff09\uff0c\u5e76\u4e14\u5728\u4e00\u822c\u7684 TCP \u8fde\u63a5\u534f\u5546\uff08\u63e1\u624b\uff09\u8fc7\u7a0b\u4e2d\u8bf7\u6c42\u8bc1\u4e66\u3002\n    \n    \u5373\u5ba2\u6237\u7aef\u53d1\u51fa\u4e00\u4e2a\u6d88\u606f\u7ed9\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u6d88\u606f\u91cc\u9762\u5305\u542b\u4e86\u81ea\u5df1\u53ef\u5b9e\u73b0\u7684\u7b97\u6cd5\u5217\u8868\u548c\u5176\u5b83\u4e00\u4e9b\u9700\u8981\u7684\u6d88\u606f\uff0cSSL \u7684\u670d\u52a1\u5668\u7aef\u4f1a\u56de\u5e94\u4e00\u4e2a\u6570\u636e\u5305\uff0c\u8fd9\u91cc\u9762\u786e\u5b9a\u4e86\u8fd9\u6b21\u901a\u4fe1\u6240\u9700\u8981\u7684\u7b97\u6cd5\uff0c\u7136\u540e\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u8bc1\u4e66\u3002\uff08\u8bc1\u4e66\u91cc\u9762\u5305\u542b\u4e86\u670d\u52a1\u5668\u4fe1\u606f \u2014\u2014 \u57df\u540d\u3001\u7533\u8bf7\u8bc1\u4e66\u7684\u516c\u53f8\u3001\u516c\u5171\u79d8\u94a5\u3002\uff09                 \n2. \u5ba2\u6237\u7aef\u5728\u6536\u5230\u670d\u52a1\u5668\u8fd4\u56de\u7684\u8bc1\u4e66\u540e\uff0c\u5224\u65ad\u7b7e\u53d1\u8fd9\u4e2a\u8bc1\u4e66\u7684\u516c\u5171\u7b7e\u53d1\u673a\u6784\uff0c\u5e76\u4f7f\u7528\u8fd9\u4e2a\u673a\u6784\u7684\u516c\u5171\u79d8\u94a5\u786e\u8ba4\u7b7e\u540d\u662f\u5426\u6709\u6548\uff0c\u5ba2\u6237\u7aef\u8fd8\u4f1a\u786e\u4fdd\u8bc1\u4e66\u4e2d\u5217\u51fa\u7684\u57df\u540d\u5c31\u662f\u5b83\u6b63\u5728\u8fde\u63a5\u7684\u57df\u540d\u3002\n\n3. \u5982\u679c\u786e\u8ba4\u8bc1\u4e66\u6709\u6548\uff0c\u90a3\u4e48\u751f\u6210\u5bf9\u79f0\u79d8\u94a5\u5e76\u4f7f\u7528\u670d\u52a1\u5668\u7684\u516c\u5171\u79d8\u94a5\u8fdb\u884c\u52a0\u5bc6\u3002\u7136\u540e\u628a\u5b83\u53d1\u9001\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u4f7f\u7528\u5b83\u7684\u79c1\u94a5\u89e3\u5bc6\u51fa\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u7136\u540e\u628a\u5185\u5bb9\u901a\u8fc7\u4f1a\u8bdd\u5bc6\u94a5\u5bf9\u79f0\u52a0\u5bc6\uff0c\u8fd9\u6837\u4e24\u53f0\u8ba1\u7b97\u673a\u53ef\u4ee5\u5f00\u59cb\u8fdb\u884c\u5bf9\u79f0\u52a0\u5bc6\u8fdb\u884c\u901a\u4fe1\u3002\n\nHTTPS \u901a\u4fe1\u7684\u4f18\u70b9\uff1a\n\n1. \u5ba2\u6237\u7aef\u4ea7\u751f\u7684\u5bc6\u94a5\u53ea\u6709\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u80fd\u5f97\u5230\uff1b\n2. \u52a0\u5bc6\u7684\u6570\u636e\u53ea\u6709\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u624d\u80fd\u5f97\u5230\u660e\u6587\uff1b\n3. \u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u901a\u4fe1\u662f\u5b89\u5168\u7684\u3002\n\n## Go \u8bed\u8a00 HTTPS \u652f\u6301\n\nGo \u8bed\u8a00\u7684 `net/http` \u5305\u4e2d\u7684 `ListenAndServeTLS()` \u51fd\u6570\u63d0\u4f9b\u4e86\u5bf9 HTTPS \u7684\u652f\u6301\u3002`ListenAndServeTLS()` \u51fd\u6570\u7684\u539f\u578b\u4e3a\uff1a\n\n```go\nfunc ListenAndServeTLS(addr string, certFile string, keyFile string, handler Handler) error\n```\n\n\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e2a\u51fd\u6570\u539f\u578b\u5176\u5b9e\u548c HTTP \u65b9\u5f0f\u7684\u5dee\u522b\u5c31\u5728\u4e8e\uff0c\u9700\u8981\u63d0\u4f9b\u6570\u5b57\u8bc1\u4e66 certFile \u548c\u79c1\u94a5\u6587\u4ef6 keyFile\u3002\u5728\u6d4b\u8bd5\u73af\u5883\uff0c\u6211\u4eec\u6ca1\u6709\u5fc5\u8981\u82b1\u94b1\u53bb\u8d2d\u4e70\u4ec0\u4e48\u8bc1\u4e66\uff0c\u5229\u7528 OpenSSL \u5de5\u5177\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u751f\u6210\u79c1\u94a5\u6587\u4ef6\u548c\u81ea\u7b7e\u53d1\u7684\u6570\u5b57\u8bc1\u4e66\u3002\n\n\n## API Server \u6dfb\u52a0 HTTPS \u652f\u6301\n\n\u5728 apiserver \u4e2d\u6dfb\u52a0 HTTPS \u529f\u80fd\uff0c\u6b65\u9aa4\u5f88\u7b80\u5355\uff0c\u5927\u6982\u5206\u4e3a\u4ee5\u4e0b\u4e09\u6b65\u3002\n\n1. \u751f\u6210\u79c1\u94a5\u6587\u4ef6\uff08server.key\uff09\u548c\u81ea\u7b7e\u53d1\u7684\u6570\u5b57\u8bc1\u4e66\uff08server.crt\uff09\uff1a\n\n```\n$ openssl req -new -nodes -x509 -out conf/server.crt -keyout conf/server.key -days 3650 -subj \"/C=DE/ST=NRW/L=Earth/O=Random Company/OU=IT/CN=127.0.0.1/emailAddress=xxxxx@qq.com\"\n```\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163cf724c4b040d0?w=956&h=75&f=png&s=5862)\n\n2. \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u79c1\u94a5\u6587\u4ef6\u3001\u6570\u5b57\u8bc1\u4e66\u6587\u4ef6\u7684\u8def\u5f84\u548c HTTPS \u7aef\u53e3\uff0c\u4f9b `ListenAndServeTLS()` \u51fd\u6570\u8c03\u7528\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163cf71f93559335?w=990&h=251&f=png&s=27287)\n\n3. \u5728 `main` \u51fd\u6570\u4e2d\u589e\u52a0 `ListenAndServeTLS()` \u8c03\u7528\uff0c\u542f\u52a8 HTTPS \u7aef\u53e3\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163cf74236089563?w=1457&h=503&f=png&s=42677)\n\n`main` \u51fd\u6570\u7684\u903b\u8f91\u662f\uff1a\u5982\u679c\u63d0\u4f9b\u4e86 TLS \u8bc1\u4e66\u548c\u79c1\u94a5\u5219\u542f\u52a8 HTTPS \u7aef\u53e3\u3002\n\n> \u521b\u5efa\u8bc1\u4e66\u548c\u5bc6\u94a5\u9700\u8981 Linux \u5b89\u88c5 `openssl` \u5de5\u5177\uff0c\u5927\u90e8\u5206 Linux \u53d1\u884c\u7248\u5df2\u7ecf\u9ed8\u8ba4\u5b89\u88c5\uff0c\u5982\u679c\u6ca1\u6709\u5b89\u88c5\u8bf7\u5b89\u88c5\u3002\n\n## \u7f16\u8bd1\u5e76\u6d4b\u8bd5\n\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\n\n```\n$ git clone https://github.com/lexkong/apiserver_demos\n```\n\n2. \u5c06 `apiserver_demos/demo10` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\n\n```\n$ cp -a apiserver_demos/demo10/ $GOPATH/src/apiserver\n```\n\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\n\n```\n$ cd $GOPATH/src/apiserver\n$ gofmt -w .\n$ go tool vet .\n$ go build -v .\n```\n\n**\u8bf7\u6c42\u65f6\u4e0d\u643a\u5e26 CA \u8bc1\u4e66\u548c\u79c1\u94a5**\n\n```\n$ curl -XGET -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\" -H \"Content-Type: application/json\" https://127.0.0.1:8081/v1/user\n\ncurl: (60) Peer certificate cannot be authenticated with known CA certificates\nMore details here: http://curl.haxx.se/docs/sslcerts.html\n\ncurl performs SSL certificate verification by default, using a \"bundle\"\n of Certificate Authority (CA) public keys (CA certs). If the default\n bundle file isn't adequate, you can specify an alternate file\n using the --cacert option.\nIf this HTTPS server uses a certificate signed by a CA represented in\n the bundle, the certificate verification probably failed due to a\n problem with the certificate (it might be expired, or the name might\n not match the domain name in the URL).\nIf you'd like to turn off curl's verification of the certificate, use\n the -k (or --insecure) option.\n```\n\n\u53ef\u4ee5\u770b\u5230\u8bf7\u6c42\u8ba4\u8bc1\u5931\u8d25\u3002\n\n> \u8bf7\u6c42\u534f\u8bae\u9700\u8981\u662f HTTPS\uff0c\u8bf7\u6c42\u7684\u7aef\u53e3\u9700\u8981\u662f HTTPS \u7684 8081 \u7aef\u53e3\u3002\n\n**\u8bf7\u6c42\u65f6\u643a\u5e26 CA \u8bc1\u4e66\u548c\u79c1\u94a5**\n\n```\n$ curl -XGET -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\" -H \"Content-Type: application/json\" https://127.0.0.1:8081/v1/user --cacert conf/server.crt --cert conf/server.crt --key conf/server.key\n\n{\n  \"code\": 0,\n  \"message\": \"OK\",\n  \"data\": {\n    \"totalCount\": 1,\n    \"userList\": [\n      {\n        \"id\": 0,\n        \"username\": \"admin\",\n        \"sayHello\": \"Hello qybyTdSmg\",\n        \"password\": \"$2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG\",\n        \"createdAt\": \"2018-05-28 00:25:33\",\n        \"updatedAt\": \"2018-05-28 00:25:33\"\n      }\n    ]\n  }\n}\n\n```\n\n\u6210\u529f\u8bf7\u6c42\u3002\n\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u8282\u662f API \u5f00\u53d1\u7684\u8fdb\u9636\u5185\u5bb9\uff0c\u8bb2\u89e3\u4e86\u5982\u4f55\u7ed9 HTTP \u8bf7\u6c42\u8fdb\u884c\u6570\u636e\u52a0\u5bc6\u3002\u5728\u4f01\u4e1a\u7ea7\u7684 API \u670d\u52a1\u5668\u4e2d\uff0c\u901a\u5e38\u4f1a\u8fdb\u884c HTTPS \u52a0\u5bc6\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/14\u8fdb\u9636_1\u7528_HTTPS_\u52a0\u5bc6_API_\u8bf7\u6c42.md", "create_date": "2020-02-18T21:37:38.324", "order": 15}}, {"model": "subject.chapter", "pk": 132, "fields": {"title": "\u8fdb\u9636 2\uff1a\u7528 Makefile \u7ba1\u7406 API \u9879\u76ee", "topic": 6, "md5": "78cb32547cfc996d67e598ad75eb874c", "md_body": "# \u7528 Makefile \u7ba1\u7406 API \u9879\u76ee\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u4ecb\u7ecd Makefile\r\n+ \u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Makefile\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo11](https://github.com/lexkong/apiserver_demos/tree/master/demo11)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo10](https://github.com/lexkong/apiserver_demos/tree/master/demo10) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## \u4e3a\u4ec0\u4e48\u9700\u8981 Makefile\r\n\r\nGo \u8bed\u8a00\u7684 `go` \u547d\u4ee4\u81ea\u5e26\u6e90\u7801\u7ba1\u7406\u529f\u80fd\uff0c\u6bd4\u5982\u901a\u8fc7 `go build` \u53ef\u4ee5\u5b9e\u73b0\u5bf9\u6e90\u7801\u7684\u7f16\u8bd1\uff0c\u4f46\u662f Go \u81ea\u5e26\u7684\u6e90\u7801\u7ba1\u7406\u529f\u80fd\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u8fd8\u662f\u6ee1\u8db3\u4e0d\u4e86\u9700\u6c42\uff0c\u6709\u65f6\u5019\u6267\u884c `go build` \u65f6\uff0c\u4f1a\u9644\u5e26\u5f88\u591a\u7f16\u8bd1\u53c2\u6570\uff0c\u76f4\u63a5\u6267\u884c `go build` \u547d\u4ee4\u4e5f\u4f1a\u5f88\u9ebb\u70e6\u3002\u8fd9\u65f6\u5019\u4e00\u822c\u662f\u901a\u8fc7\u66f4\u4e13\u4e1a\u7684 Makefile \u6765\u7ba1\u7406\u6e90\u7801\uff0c\u901a\u8fc7 Makefile \u53ef\u4ee5\u5b9e\u73b0\u8bf8\u5982\uff1a\u7f16\u8bd1\u3001\u5b89\u88c5\u3001\u6e05\u7406\u7b49\u529f\u80fd\uff0c\u5176\u5b9e\u9700\u8981\u7684\u7ba1\u7406\u529f\u80fd\u90fd\u53ef\u4ee5\u901a\u8fc7 Makefile \u6765\u6dfb\u52a0\uff0cMakefile \u751f\u6765\u5c31\u662f\u505a\u8fd9\u4e9b\u7684\u3002\r\n\r\n## Makefile \u7b80\u4ecb\r\n\r\n\u4e00\u4e2a\u5de5\u7a0b\u4e2d\u7684\u6e90\u6587\u4ef6\u4e0d\u8ba1\u5176\u6570\uff0c\u5176\u6309\u7c7b\u578b\u3001\u529f\u80fd\u3001\u6a21\u5757\u5206\u522b\u653e\u5728\u82e5\u5e72\u4e2a\u76ee\u5f55\u4e2d\uff0cMakefile \u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217\u7684\u89c4\u5219\u6765\u6307\u5b9a\uff0c\u54ea\u4e9b\u6587\u4ef6\u9700\u8981\u5148\u7f16\u8bd1\uff0c\u54ea\u4e9b\u6587\u4ef6\u9700\u8981\u540e\u7f16\u8bd1\uff0c\u54ea\u4e9b\u6587\u4ef6\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\uff0c\u751a\u81f3\u4e8e\u8fdb\u884c\u66f4\u590d\u6742\u7684\u529f\u80fd\u64cd\u4f5c\uff0c\u56e0\u4e3a Makefile \u5c31\u50cf\u4e00\u4e2a Shell \u811a\u672c\u4e00\u6837\uff0c\u5176\u4e2d\u4e5f\u53ef\u4ee5\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u7684\u547d\u4ee4\uff08\u6458\u81ea\u767e\u5ea6\u767e\u79d1\uff09\u3002\r\n\r\n**makefile \u7684\u89c4\u5219**\r\n\r\nMakefile \u57fa\u672c\u683c\u5f0f\u5982\u4e0b:\r\n\r\n```makefile\r\ntarget ... : prerequisites ...\r\n    command\r\n    ...\r\n```\r\n\r\n\u5176\u4e2d\uff1a\r\n\r\n+ target        - \u7f16\u8bd1\u6587\u4ef6\u8981\u751f\u6210\u7684\u76ee\u6807\r\n+ prerequisites - \u7f16\u8bd1\u6587\u4ef6\u9700\u8981\u7684\u4f9d\u8d56\r\n+ command       - \u4f9d\u8d56\u751f\u6210\u76ee\u6807\u6240\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\uff08\u4efb\u610f\u7684 shell \u547d\u4ee4\uff09\uff0cMakefile \u4e2d\u7684\u547d\u4ee4\u5fc5\u987b\u4ee5 [tab] \u5f00\u5934\r\n\r\n\r\n\u6bd4\u5982\u6211\u4eec\u5e73\u65f6\u4f7f\u7528\u7684 `gcc a.c b.c -o test` \u8fd9\u91cc\u7684 test \u5c31\u662f\u6211\u4eec\u8981\u751f\u6210\u7684\u76ee\u6807\uff0c a.c\u3001b.c\u5c31\u662f\u6211\u4eec\u751f\u6210\u76ee\u6807\u9700\u8981\u7684\u4f9d\u8d56\uff0c\u800c `gcc a.c b.c -o test` \u5219\u662f\u547d\u4ee4\u3002\u5c06\u8fd9\u884c\u547d\u4ee4\u7528 Makefile \u7684\u65b9\u5f0f\u6765\u5199\u5c31\u662f\uff1a\r\n\r\n```makefile\r\ntest: a.c b.c\r\n    gcc a.c b.c -o test\r\n```\r\n\r\n## API Server \u6dfb\u52a0 Makefile\r\n\r\n\u5728 apiserver \u6839\u76ee\u5f55\u4e0b\u65b0\u5efa\u6587\u4ef6 `Makefile`\uff0c\u5185\u5bb9\u4e3a\uff1a\r\n\r\n```makefile\r\nall: gotool\r\n\t@go build -v .\r\nclean:\r\n\trm -f apiserver\r\n\tfind . -name \"[._]*.s[a-w][a-z]\" | xargs -i rm -f {}\r\ngotool:\r\n\tgofmt -w .\r\n\tgo tool vet . |& grep -v vendor;true\r\nca:\r\n\topenssl req -new -nodes -x509 -out conf/server.crt -keyout conf/server.key -days 3650 -subj \"/C=DE/ST=NRW/L=Earth/O=Random Company/OU=IT/CN=127.0.0.1/emailAddress=xxxxx@qq.com\"\r\n\r\nhelp:\r\n\t@echo \"make - compile the source code\"\r\n\t@echo \"make clean - remove binary file and vim swp files\"\r\n\t@echo \"make gotool - run go tool 'fmt' and 'vet'\"\r\n\t@echo \"make ca - generate ca files\"\r\n\r\n.PHONY: clean gotool ca help\r\n```\r\n\r\n\u4e0a\u9762\u7684 Makefile \u6587\u4ef6\u4e2d\uff0c`.PHONY` \u662f\u4e2a\u4f2a\u76ee\u6807\uff0c\u5f62\u5f0f\u4e0a\u662f\u4e00\u4e2a\u76ee\u6807\uff0c\u4f46\u662f\u4e0d\u9700\u8981\u4f9d\u8d56\uff0c\u4f2a\u76ee\u6807\u4e00\u822c\u53ea\u662f\u4e3a\u4e86\u6267\u884c\u76ee\u6807\u4e0b\u9762\u7684\u547d\u4ee4\uff08\u6bd4\u5982 clean \u5c31\u662f\u4f2a\u76ee\u6807\uff09\u3002`@` \u653e\u5728\u884c\u9996\uff0c\u8868\u793a\u4e0d\u6253\u5370\u6b64\u884c\u3002\u9ed8\u8ba4\u5728\u7f16\u8bd1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u628a\u6b64\u884c\u7684\u5c55\u5f00\u6548\u679c\u5b57\u7b26\u4e32\u6253\u5370\u51fa\u6765\u3002\r\n\r\n\u4e0a\u9762\u7684 Makefile \u5b9e\u73b0\u4e86\u5982\u4e0b\u529f\u80fd\uff1a\r\n\r\n+ `make`\uff1a\u6267\u884c `go build -v .` \u751f\u6210 Go \u4e8c\u8fdb\u5236\u6587\u4ef6\r\n+ `make gotool`\uff1a\u6267\u884c `gofmt -w .` \u548c `go tool vet .`\uff08\u683c\u5f0f\u5316\u4ee3\u7801\u548c\u6e90\u7801\u9759\u6001\u68c0\u67e5\uff09\r\n+ `make clean`\uff1a\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff1a\u5220\u9664\u4e8c\u8fdb\u5236\u6587\u4ef6\u3001\u5220\u9664 vim swp \u6587\u4ef6\r\n+ `make ca`\uff1a\u751f\u6210\u8bc1\u4e66\r\n+ `make help`\uff1a\u6253\u5370 help \u4fe1\u606f\r\n\r\n## \u7f16\u8bd1\r\n\r\n\u5728\u524d\u9762\u5404\u5c0f\u8282\u4e2d\u7f16\u8bd1\u4e8c\u8fdb\u5236\u5747\u662f\u901a\u8fc7 `go build -v .` \u7684\u65b9\u5f0f\uff0c\u6dfb\u52a0 Makefile \u540e\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u6765\u7f16\u8bd1\uff1a\r\n\r\n```\r\n$ make\r\n```\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u7b80\u5355\u4ecb\u7ecd\u4e86 Makefile\uff0c\u5e76\u4ecb\u7ecd\u4e86 apiserver \u6240\u4f7f\u7528\u7684 Makefile \u6587\u4ef6\uff0c\u901a\u8fc7\u8be5\u5c0f\u8282\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u901a\u8fc7 Makefile \u6765\u7ba1\u7406\u548c\u7f16\u8bd1 API \u6e90\u7801\u3002\r\n\r\n\u672c\u5c0f\u518c\u4e0d\u662f\u4e13\u95e8\u4ecb\u7ecd Makefile \u7684\uff0c\u60f3\u8981\u4e86\u89e3\u66f4\u591a Makefile \u77e5\u8bc6\uff0c\u8bf7\u53c2\u8003 [Makefile\u4f7f\u7528\u603b\u7ed3](https://www.cnblogs.com/wang_yb/p/3990952.html)\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/15\u8fdb\u9636_2\u7528_Makefile_\u7ba1\u7406_API_\u9879\u76ee.md", "create_date": "2020-02-18T21:37:38.343", "order": 16}}, {"model": "subject.chapter", "pk": 133, "fields": {"title": "\u8fdb\u9636 3\uff1a\u7ed9 API \u547d\u4ee4\u589e\u52a0\u7248\u672c\u529f\u80fd", "topic": 6, "md5": "0d9f036266fb1c6b3be5a1785cd5c35f", "md_body": "# \u7ed9 API \u547d\u4ee4\u589e\u52a0\u7248\u672c\u529f\u80fd\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u5982\u4f55\u7ed9 apiserver \u589e\u52a0\u7248\u672c\u529f\u80fd\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo12](https://github.com/lexkong/apiserver_demos/tree/master/demo12)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo11](https://github.com/lexkong/apiserver_demos/tree/master/demo11) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n\r\n## \u4e3a\u4ec0\u4e48\u9700\u8981\u7248\u672c\r\n\r\n\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5f53\u5f00\u53d1\u5b8c\u4e00\u4e2a apiserver \u7279\u6027\u540e\uff0c\u4f1a\u7f16\u8bd1 apiserver \u4e8c\u8fdb\u5236\u6587\u4ef6\u5e76\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\uff0c\u5f88\u591a\u65f6\u5019\u4e3a\u4e86\u5b9a\u4f4d\u95ee\u9898\u548c\u51fa\u4e8e\u5b89\u5168\u76ee\u7684\uff08\u4e0d\u80fd\u53d1\u9519\u7248\u672c\uff09\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u5f53\u524d apiserver \u7684\u7248\u672c\uff0c\u4ee5\u53ca\u4e00\u4e9b\u7f16\u8bd1\u65f6\u5019\u7684\u4fe1\u606f\uff0c\u5982\u7f16\u8bd1\u65f6 Go \u7684\u7248\u672c\u3001Git \u76ee\u5f55\u662f\u5426 clean\uff0c\u4ee5\u53ca\u57fa\u4e8e\u54ea\u4e2a git commmit \u6765\u7f16\u8bd1\u7684\u3002\u5728\u4e00\u4e2a\u7f16\u8bd1\u597d\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u53ef\u4ee5\u7528\u7c7b\u4f3c `./app_name -v` \u7684\u65b9\u5f0f\u6765\u83b7\u53d6\u7248\u672c\u4fe1\u606f\u3002\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u4fe1\u606f\u5199\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u7a0b\u5e8f\u8fd0\u884c\u65f6\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u53d6\u5f97\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c\u663e\u793a\u3002\u4f46\u662f\u5728\u90e8\u7f72\u7a0b\u5e8f\u65f6\uff0c\u9664\u4e86\u4e8c\u8fdb\u5236\u6587\u4ef6\u8fd8\u9700\u8981\u989d\u5916\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0d\u662f\u5f88\u65b9\u4fbf\u3002\u6216\u8005\u5c06\u8fd9\u4e9b\u4fe1\u606f\u5199\u5165\u4ee3\u7801\u4e2d\uff0c\u8fd9\u6837\u4e0d\u9700\u8981\u989d\u5916\u7684\u914d\u7f6e\uff0c\u4f46\u8981\u5728\u6bcf\u6b21\u7f16\u8bd1\u65f6\u4fee\u6539\u4ee3\u7801\u6587\u4ef6\uff0c\u4e5f\u6bd4\u8f83\u9ebb\u70e6\u3002Go \u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u597d\u7684\u65b9\u5f0f\uff1a\u901a\u8fc7 `-ldflags -X importpath.name=value`\uff08\u8be6\u89c1 [-ldflags -X importpath.name=value](https://golang.org/cmd/link/)\uff09\u6765\u7ed9\u7a0b\u5e8f\u81ea\u52a8\u6dfb\u52a0\u7248\u672c\u4fe1\u606f\u3002\r\n\r\n> \u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u7edd\u5927\u90e8\u5206\u90fd\u662f\u7528 Git \u6765\u505a\u6e90\u7801\u7248\u672c\u7ba1\u7406\u7684\uff0c\u6240\u4ee5 apiserver \u7684\u7248\u672c\u529f\u80fd\u4e5f\u57fa\u4e8e Git\u3002\r\n\r\n## \u7ed9 `apiserver` \u6dfb\u52a0\u7248\u672c\u529f\u80fd\r\n\r\n\u5047\u8bbe\u6211\u4eec\u7a0b\u5e8f\u53d1\u5e03\u7684\u6d41\u7a0b\u662f\u8fd9\u6837\uff1a\r\n\r\n1. \u7f16\u7801\u5b8c\u6210\uff0c\u63d0\u4ea4\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u6d4b\u8bd5\r\n2. \u6d4b\u8bd5\u5de5\u7a0b\u5e08\u6d4b\u8bd5\u4ee3\u7801\uff0c\u63d0\u4ea4 bug\uff0c\u66f4\u6539 bug \u5e76\u91cd\u65b0\u6d4b\u8bd5\u540e\u9a8c\u8bc1\u901a\u8fc7\r\n3. \u5f00\u53d1\u4eba\u5458\u628a\u9a8c\u8bc1\u901a\u8fc7\u7684\u4ee3\u7801\u5408\u5e76\u5230 master \u5206\u652f\uff0c\u5e76\u6253\u4e0a\u7248\u672c\u53f7\uff1a`git tag -a v1.0.0`\r\n4. \u5f00\u53d1\u4eba\u5458\u5c06 `v1.0.0` \u7248\u672c\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\r\n\r\n\u6700\u7ec8\u53d1\u5e03\u540e\uff0c\u6211\u4eec\u5e0c\u671b\u901a\u8fc7 `./apiserver -v` \u53c2\u6570\u63d0\u4f9b\u5982\u4e0b\u7248\u672c\u4fe1\u606f\uff1a\r\n\r\n+ \u7248\u672c\u53f7\r\n+ git commit\r\n+ git tree \u5728\u7f16\u8bd1\u65f6\u7684\u72b6\u6001\r\n+ \u6784\u5efa\u65f6\u95f4\r\n+ go \u7248\u672c\r\n+ go \u7f16\u8bd1\u5668\r\n+ \u8fd0\u884c\u5e73\u53f0\r\n\r\n\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd\uff0c\u6211\u4eec\u9996\u5148\u8981\u5728 `main` \u51fd\u6570\u4e2d\u6dfb\u52a0\u7528\u4e8e\u63a5\u6536 `-v` \u53c2\u6570\u7684\u5165\u53e3\uff08\u8be6\u89c1 [demo12/main.go](https://github.com/lexkong/apiserver_demos/blob/master/demo12/main.go)\uff09\uff1a\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"encoding/json\"\r\n\t\"fmt\"\r\n\t\"os\"\r\n\t...\r\n\tv \"apiserver/pkg/version\"\r\n\t...\r\n)\r\n\r\nvar (\r\n\tversion = pflag.BoolP(\"version\", \"v\", false, \"show version info.\")\r\n)\r\n\r\nfunc main() {\r\n\tpflag.Parse()\r\n\tif *version {\r\n\t\tv := v.Get()\r\n\t\tmarshalled, err := json.MarshalIndent(&v, \"\", \"  \")\r\n\t\tif err != nil {\r\n\t\t\tfmt.Printf(\"%v\\n\", err)\r\n\t\t\tos.Exit(1)\r\n\t\t}\r\n\r\n\t\tfmt.Println(string(marshalled))\r\n\t\treturn\r\n\t}\r\n\t...\r\n}\r\n```\r\n\r\n\u901a\u8fc7 `pflag` \u6765\u89e3\u6790\u547d\u4ee4\u884c\u4e0a\u4f20\u5165\u7684 `-v` \u53c2\u6570\u3002\r\n\r\n\u901a\u8fc7 `pkg/version` \u7684 `Get()` \u51fd\u6570\u6765\u83b7\u53d6 apiserver \u7684\u7248\u672c\u4fe1\u606f\u3002\r\n\r\n\u901a\u8fc7 `json.MarshalIndent` \u6765\u683c\u5f0f\u5316\u6253\u5370\u7248\u672c\u4fe1\u606f\u3002\r\n\r\n\r\n`pkg/version` \u7684 `Get()` \u51fd\u6570\u5b9e\u73b0\u4e3a\uff08\u8be6\u89c1 [demo12/pkg/version](https://github.com/lexkong/apiserver_demos/tree/master/demo12/pkg/version)\uff09\uff1a\r\n\r\n```go\r\nfunc Get() Info {\r\n\treturn Info{\r\n\t\tGitTag:       gitTag,\r\n\t\tGitCommit:    gitCommit,\r\n\t\tGitTreeState: gitTreeState,\r\n\t\tBuildDate:    buildDate,\r\n\t\tGoVersion:    runtime.Version(),\r\n\t\tCompiler:     runtime.Compiler,\r\n\t\tPlatform:     fmt.Sprintf(\"%s/%s\", runtime.GOOS, runtime.GOARCH),\r\n\t}\r\n}\r\n```\r\n\r\n\u5176\u4e2d `gitTag`\u3001`gitCommit`\u3001`gitTreeState` \u7b49\u53d8\u91cf\u7684\u503c\u662f\u901a\u8fc7 `-ldflags -X importpath.name=value` \u5728\u7f16\u8bd1\u65f6\u4f20\u5230\u7a0b\u5e8f\u4e2d\u7684\u3002\u4e3a\u6b64\u6211\u4eec\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u4f20\u5165\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5728 Makefile \u4e2d\u6dfb\u52a0\u5982\u4e0b\u4fe1\u606f\uff08\u8be6\u89c1 [demo12/Makefile](https://github.com/lexkong/apiserver_demos/blob/master/demo12/Makefile)\uff09\uff1a\r\n\r\n```makefile\r\nSHELL := /bin/bash \r\nBASEDIR = $(shell pwd)\r\n \r\n# build with verison infos\r\nversionDir = \"apiserver/pkg/version\"\r\ngitTag = $(shell if [ \"`git describe --tags --abbrev=0 2>/dev/null`\" != \"\" ];then git describe --tags --abbrev=0; else git log --pretty=format:'%h' -n 1; fi)\r\nbuildDate = $(shell TZ=Asia/Shanghai date +%FT%T%z)\r\ngitCommit = $(shell git log --pretty=format:'%H' -n 1)\r\ngitTreeState = $(shell if git status|grep -q 'clean';then echo clean; else echo dirty; fi)\r\n \r\nldflags=\"-w -X ${versionDir}.gitTag=${gitTag} -X ${versionDir}.buildDate=${buildDate} -X ${versionDir}.gitCommit=${gitCommit} -X ${versionDir}.gitTreeState=${gitTreeState}\"\r\n```\r\n\r\n\u5e76\u5728 `go build` \u4e2d\u6dfb\u52a0\u8fd9\u4e9b flag\uff1a\r\n\r\n```makefile\r\ngo build -v -ldflags ${ldflags} .\r\n```\r\n\r\n> `-w` \u4e3a\u53bb\u6389\u8c03\u8bd5\u4fe1\u606f\uff08\u65e0\u6cd5\u4f7f\u7528 gdb \u8c03\u8bd5\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u7f16\u8bd1\u540e\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u66f4\u5c0f\u3002\r\n\r\n## \u7f16\u8bd1\u5e76\u6d4b\u8bd5\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo12` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\r\n\r\n```\r\n$ cp -a apiserver_demos/demo12/ $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ make\r\n```\r\n\r\n**\u67e5\u770b apiserver \u7248\u672c**\r\n\r\n```\r\n$ ./apiserver -v\r\n\r\n{\r\n  \"gitTag\": \"7322949\",\r\n  \"gitCommit\": \"732294928b3c4dff5b898fde0bb5313752e1173e\",\r\n  \"gitTreeState\": \"dirty\",\r\n  \"buildDate\": \"2018-06-05T07:43:26+0800\",\r\n  \"goVersion\": \"go1.10.2\",\r\n  \"compiler\": \"gc\",\r\n  \"platform\": \"linux/amd64\"\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230 `./apiserver -v` \u8f93\u51fa\u4e86\u6211\u4eec\u9700\u8981\u7684\u7248\u672c\u4fe1\u606f\u3002\r\n\r\n> \u5728\u4e0a\u4e00\u5c0f\u8282\u4e2d\u6211\u4eec\u5df2\u7ecf\u7ed9 `apiserver` \u6dfb\u52a0\u8fc7 Makefile \u6587\u4ef6\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u7528 Makefile \u4ee5\u53ca Go \u672c\u8eab\u6240\u652f\u6301\u7684\u7f16\u8bd1\u7279\u6027\uff0c\u5b9e\u73b0\u7f16\u8bd1\u65f6\u81ea\u52a8\u751f\u6210\u7248\u672c\u53f7\u7684\u529f\u80fd\u3002\u540e\u7eed\u5c0f\u8282\u7f16\u8bd1 API \u6e90\u7801\u5747\u4f1a\u901a\u8fc7 `make` \u6765\u7f16\u8bd1\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/16\u8fdb\u9636_3\u7ed9_API_\u547d\u4ee4\u589e\u52a0\u7248\u672c\u529f\u80fd.md", "create_date": "2020-02-18T21:37:38.358", "order": 17}}, {"model": "subject.chapter", "pk": 134, "fields": {"title": "\u8fdb\u9636 4\uff1a\u7ed9 API \u589e\u52a0\u542f\u52a8\u811a\u672c", "topic": 6, "md5": "999213e3e4f70b3c2eaa4c8709556e3c", "md_body": "# \u7ed9 API \u589e\u52a0\u542f\u52a8\u811a\u672c\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u5982\u4f55\u7ba1\u7406 apiserver \u542f\u52a8\u547d\u4ee4\uff0c\u5305\u62ec\u542f\u52a8\u3001\u91cd\u542f\u3001\u505c\u6b62\u548c\u67e5\u770b\u8fd0\u884c\u72b6\u6001\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo13](https://github.com/lexkong/apiserver_demos/tree/master/demo13)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo12](https://github.com/lexkong/apiserver_demos/tree/master/demo12) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n\r\n## \u4e3a\u4ec0\u4e48\u8981\u6dfb\u52a0\u542f\u52a8\u811a\u672c\r\n\r\n\u901a\u8fc7\u6dfb\u52a0\u670d\u52a1\u5668\u542f\u52a8\u811a\u672c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u542f\u52a8\u3001\u91cd\u542f\u3001\u505c\u6b62\u548c\u67e5\u770b\u670d\u52a1\u7684\u72b6\u6001\u3002\u4e00\u4e9b\u76d1\u63a7\u7cfb\u7edf\u3001\u53d1\u5e03\u7cfb\u7edf\u9700\u8981\u6709\u65b9\u6cd5\u544a\u8bc9\u5b83\u600e\u4e48\u542f\u505c\u548c\u67e5\u770b\u670d\u52a1\u72b6\u6001\uff0c\u8fd9\u65f6\u5019\u5982\u679c\u6709\u4e2a\u670d\u52a1\u63a7\u5236\u811a\u672c\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u6dfb\u52a0\uff0c\u8981\u4e0d\u7136\u8f93\u5165\u4e00\u5806\u542f\u52a8\u53c2\u6570\u4e0d\u4ec5\u70e6\u7410\u8fd8\u5bb9\u6613\u51fa\u9519\u3002\r\n\r\n## \u6dfb\u52a0\u542f\u52a8\u811a\u672c\r\n\r\napiserver \u662f\u901a\u8fc7 `admin.sh` \u811a\u672c\u6765\u5b9e\u73b0\u670d\u52a1\u542f\u52a8\u3001\u91cd\u542f\u3001\u505c\u6b62\u548c\u67e5\u770b\u670d\u52a1\u72b6\u6001\u64cd\u4f5c\u7684\uff08\u8be6\u89c1 [demo13/admin.sh](https://github.com/lexkong/apiserver_demos/blob/master/demo13/admin.sh)\uff09\uff0c\u6e90\u7801\u4e3a\uff1a\r\n\r\n```\r\n#!/bin/bash\r\n\r\nSERVER=\"apiserver\"\r\nBASE_DIR=$PWD\r\nINTERVAL=2\r\n\r\n# \u547d\u4ee4\u884c\u53c2\u6570\uff0c\u9700\u8981\u624b\u52a8\u6307\u5b9a\r\nARGS=\"\"\r\n\r\nfunction start()\r\n{\r\n\tif [ \"`pgrep $SERVER -u $UID`\" != \"\" ];then\r\n\t\techo \"$SERVER already running\"\r\n\t\texit 1\r\n\tfi\r\n\r\n\tnohup $BASE_DIR/$SERVER $ARGS  server &>/dev/null &\r\n\r\n\techo \"sleeping...\" &&  sleep $INTERVAL\r\n\r\n\t# check status\r\n\tif [ \"`pgrep $SERVER -u $UID`\" == \"\" ];then\r\n\t\techo \"$SERVER start failed\"\r\n\t\texit 1\r\n\tfi\r\n}\r\n\r\nfunction status() \r\n{\r\n\tif [ \"`pgrep $SERVER -u $UID`\" != \"\" ];then\r\n\t\techo $SERVER is running\r\n\telse\r\n\t\techo $SERVER is not running\r\n\tfi\r\n}\r\n\r\nfunction stop() \r\n{\r\n\tif [ \"`pgrep $SERVER -u $UID`\" != \"\" ];then\r\n\t\tkill -9 `pgrep $SERVER -u $UID`\r\n\tfi\r\n\r\n\techo \"sleeping...\" &&  sleep $INTERVAL\r\n\r\n\tif [ \"`pgrep $SERVER -u $UID`\" != \"\" ];then\r\n\t\techo \"$SERVER stop failed\"\r\n\t\texit 1\r\n\tfi\r\n}\r\n\r\ncase \"$1\" in\r\n\t'start')\r\n\tstart\r\n\t;;  \r\n\t'stop')\r\n\tstop\r\n\t;;  \r\n\t'status')\r\n\tstatus\r\n\t;;  \r\n\t'restart')\r\n\tstop && start\r\n\t;;  \r\n\t*)  \r\n\techo \"usage: $0 {start|stop|restart|status}\"\r\n\texit 1\r\n\t;;  \r\nesac\r\n\r\n```\r\n\r\n> \u770b shell \u6e90\u7801\u53d1\u73b0\u5728 start \u548c stop \u65f6\u4f1a sleep \u51e0\u79d2\uff0c\u8fd9\u662f\u56e0\u4e3a API \u670d\u52a1\u5668\u7684\u542f\u52a8\u9700\u8981\u65f6\u95f4\u53bb\u505a\u51c6\u5907\u5de5\u4f5c\uff0c\u505c\u6b62\u4e5f\u9700\u8981\u65f6\u95f4\u53bb\u505a\u6e05\u7406\u5de5\u4f5c\u3002\r\n\r\n## \u7f16\u8bd1\u5e76\u6d4b\u8bd5\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo13` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\r\n```\r\n$ cp -a apiserver_demos/demo13/ $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ make\r\n```\r\n\r\n**\u67e5\u770b `admin.sh` \u7528\u6cd5**\r\n\r\n```\r\n$ ./admin.sh -h\r\nusage: ./admin.sh {start|stop|restart|status}\r\n```\r\n\r\n**\u67e5\u770b `apiserver` \u8fd0\u884c\u72b6\u6001**\r\n\r\n```\r\n$ ./admin.sh status\r\napiserver is not running\r\n```\r\n\r\n**\u542f\u52a8 `apiserver`**\r\n\r\n```\r\n$ ./admin.sh start\r\nsleeping...\r\n```\r\n\r\n**\u67e5\u770b `apiserver` \u72b6\u6001**\r\n\r\n```\r\n$ ./admin.sh status\r\napiserver is running\r\n```\r\n\r\n**\u91cd\u542f `apiserver`**\r\n\r\n```\r\n$ ./admin.sh restart\r\nsleeping...\r\nsleeping...\r\n```\r\n\r\n**\u505c\u6b62 `apiserver`**\r\n\r\n```\r\n$ ./admin.sh stop\r\nsleeping...\r\n```\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u5c0f\u7ed3\u5c55\u793a\u4e86\u5982\u4f55\u7528 `admin.sh` \u53bb\u7ba1\u7406 API \u670d\u52a1\u5668\uff1a\u542f\u52a8\u3001\u91cd\u542f\u3001\u505c\u6b62\u548c\u67e5\u770b\u72b6\u6001\u3002\u8be5 `admin.sh` \u547d\u4ee4\u5728\u8fdb\u884c start\u3001stop\u3001restart \u548c status \u64cd\u4f5c\u65f6\u505a\u4e86\u5f88\u591a\u68c0\u67e5\u5de5\u4f5c\uff0c\u4ee5\u786e\u4fdd\u8fd0\u884c\u7ed3\u679c\u662f\u6b63\u786e\u7684\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/17\u8fdb\u9636_4\u7ed9_API_\u589e\u52a0\u542f\u52a8\u811a\u672c.md", "create_date": "2020-02-18T21:37:38.375", "order": 18}}, {"model": "subject.chapter", "pk": 135, "fields": {"title": "\u8fdb\u9636 5\uff1a\u57fa\u4e8e Nginx \u7684 API \u90e8\u7f72\u65b9\u6848", "topic": 6, "md5": "404890ce8da3bb46b9da2c1c9a543e8d", "md_body": "# \u57fa\u4e8e Nginx \u7684 API \u90e8\u7f72\u65b9\u6848\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u4ecb\u7ecd Nginx\r\n+ \u4ecb\u7ecd\u5982\u4f55\u5b89\u88c5 Nginx\r\n+ \u4ecb\u7ecd\u5982\u4f55\u914d\u7f6e Nginx\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo14](https://github.com/lexkong/apiserver_demos/tree/master/demo14)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo13](https://github.com/lexkong/apiserver_demos/tree/master/demo13) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## Nginx \u4ecb\u7ecd\r\n\r\nNginx \u662f\u4e00\u4e2a\u81ea\u7531\u3001\u5f00\u6e90\u3001\u9ad8\u6027\u80fd\u53ca\u8f7b\u91cf\u7ea7\u7684 HTTP \u670d\u52a1\u5668\u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5b83\u6709\u5f88\u591a\u529f\u80fd\uff0c\u4e3b\u8981\u529f\u80fd\u4e3a\uff1a\r\n\r\n1. \u6b63\u5411\u4ee3\u7406\r\n2. \u53cd\u5411\u4ee3\u7406\r\n3. \u8d1f\u8f7d\u5747\u8861 \r\n4. HTTP \u670d\u52a1\u5668\uff08\u5305\u542b\u52a8\u9759\u5206\u79bb\uff09\r\n\r\n\u672c\u5c0f\u518c\u4f7f\u7528\u4e86 Nginx \u53cd\u5411\u4ee3\u7406\u548c\u8d1f\u8f7d\u5747\u8861\u7684\u529f\u80fd\u3002\r\n\r\n> Nginx \u7684\u66f4\u8be6\u7ec6\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 [nginx\u7b80\u6613\u6559\u7a0b](https://www.cnblogs.com/jingmoxukong/p/5945200.html)\u3002\r\n\r\n## Nginx \u53cd\u5411\u4ee3\u7406\u529f\u80fd\r\n\r\nNginx \u6700\u5e38\u7528\u7684\u529f\u80fd\u4e4b\u4e00\u662f\u4f5c\u4e3a\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002\u53cd\u5411\u4ee3\u7406\uff08Reverse Proxy\uff09\u662f\u6307\u4ee5\u4ee3\u7406\u670d\u52a1\u5668\u6765\u63a5\u6536 Internet \u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5185\u90e8\u7f51\u7edc\u4e0a\u7684\u670d\u52a1\u5668\uff0c\u5e76\u5c06\u4ece\u670d\u52a1\u5668\u4e0a\u5f97\u5230\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9 Internet \u4e0a\u8bf7\u6c42\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6\u4ee3\u7406\u670d\u52a1\u5668\u5bf9\u5916\u5c31\u8868\u73b0\u4e3a\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff08\u6458\u81ea\u767e\u5ea6\u767e\u79d1\uff09\u3002\r\n\r\n\u4e3a\u4ec0\u4e48\u9700\u8981\u53cd\u5411\u4ee3\u7406\u5462\uff1f\u5728\u5b9e\u9645\u7684\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u670d\u52a1\u90e8\u7f72\u7684\u7f51\u7edc\uff08\u5185\u7f51\uff09\u8ddf\u5916\u90e8\u7f51\u7edc\uff08\u5916\u7f51\uff09\u901a\u5e38\u662f\u4e0d\u901a\u7684\uff0c\u9700\u8981\u901a\u8fc7\u4e00\u53f0\u65e2\u80fd\u591f\u8bbf\u95ee\u5185\u7f51\u53c8\u80fd\u591f\u8bbf\u95ee\u5916\u7f51\u7684\u670d\u52a1\u5668\u6765\u505a\u4e2d\u8f6c\uff0c\u8fd9\u79cd\u670d\u52a1\u5668\u5c31\u662f\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002Nginx \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u7b80\u5355\u7684\u914d\u7f6e\u5982\u4e0b\uff1a\r\n\r\n```nginx\r\n    server {                     \r\n        listen      80;           \r\n        server_name  apiserver.com;    \r\n        client_max_body_size 1024M;\r\n                                 \r\n        location / {             \r\n            proxy_set_header Host $http_host;\r\n            proxy_set_header X-Forwarded-Host $http_host;\r\n            proxy_set_header X-Real-IP $remote_addr;\r\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n            proxy_pass  http://127.0.0.1:8080/;\r\n            client_max_body_size 100m;\r\n        }                        \r\n    }                            \r\n```\r\n\r\nNginx \u5728\u505a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u65f6\uff0c\u80fd\u591f\u6839\u636e\u4e0d\u540c\u7684\u914d\u7f6e\u89c4\u5219\u8f6c\u53d1\u5230\u540e\u7aef\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\u3002\r\n\r\n## Nginx \u8d1f\u8f7d\u5747\u8861\u529f\u80fd\r\n\r\nNginx \u53e6\u4e00\u4e2a\u5e38\u7528\u7684\u529f\u80fd\u662f\u8d1f\u8f7d\u5747\u8861\uff0c\u6240\u8c13\u7684\u8d1f\u8f7d\u5747\u8861\u5c31\u662f\u6307\u5f53 Nginx \u6536\u5230\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u4f1a\u6839\u636e\u8d1f\u8f7d\u7b56\u7565\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u4e0d\u540c\u7684\u540e\u7aef\u670d\u52a1\u5668\u4e0a\u3002\u6bd4\u5982\uff0capiserver \u90e8\u7f72\u5728\u4e24\u53f0\u670d\u52a1\u5668 A \u548c B \u4e0a\uff0c\u5f53\u8bf7\u6c42\u5230\u8fbe Nginx \u540e\uff0cNginx \u4f1a\u6839\u636e A \u548c B \u670d\u52a1\u5668\u4e0a\u7684\u8d1f\u8f7d\u60c5\u51b5\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u8d1f\u8f7d\u8f83\u5c0f\u7684\u90a3\u53f0\u670d\u52a1\u5668\u4e0a\u3002\u8fd9\u91cc\u8981\u6c42 apiserver \u662f\u65e0\u72b6\u6001\u7684\u670d\u52a1\u3002\r\n\r\n## \u5b89\u88c5\u548c\u542f\u52a8 Nginx\uff08\u9700\u8981\u5207\u6362\u5230 root \u7528\u6237\uff09\r\n\r\n1. \u5b89\u88c5 Nginx\uff08CentOS 7.x \u5b89\u88c5\u6d41\u7a0b\uff09\r\n\r\n```\r\n$ yum -y install nginx\r\n```\r\n\r\n2. \u786e\u8ba4 Nginx \u5b89\u88c5\u6210\u529f\r\n\r\n```\r\n$ nginx -v\r\n```\r\n\r\n3. \u542f\u52a8 Nginx\r\n\r\n```\r\n$ systemctl start nginx\r\n```\r\n\r\n4. \u8bbe\u7f6e\u5f00\u673a\u542f\u52a8\r\n\r\n```\r\n$ systemctl enable nginx\r\n```\r\n\r\n5. \u67e5\u770b Nginx \u542f\u52a8\u72b6\u6001\r\n\r\n```\r\n$ systemctl status nginx\r\n```\r\n\r\n**Nginx \u5e38\u7528\u547d\u4ee4**\r\n\r\nNginx \u5e38\u7528\u547d\u4ee4\u5982\u4e0b\uff08\u6267\u884c `which nginx` \u53ef\u4ee5\u627e\u5230 Nginx \u547d\u4ee4\u6240\u5728\u7684\u8def\u5f84\uff09\uff1a\r\n\r\n```\r\nnginx -s stop       \u5feb\u901f\u5173\u95ed Nginx\uff0c\u53ef\u80fd\u4e0d\u4fdd\u5b58\u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u8fc5\u901f\u7ec8\u6b62 Web \u670d\u52a1\r\nnginx -s quit       \u5e73\u7a33\u5173\u95ed Nginx\uff0c\u4fdd\u5b58\u76f8\u5173\u4fe1\u606f\uff0c\u6709\u5b89\u6392\u7684\u7ed3\u675f Web \u670d\u52a1\r\nnginx -s reload     \u56e0\u6539\u53d8\u4e86 Nginx \u76f8\u5173\u914d\u7f6e\uff0c\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u800c\u91cd\u8f7d\r\nnginx -s reopen     \u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\nnginx -c filename   \u4e3a Nginx \u6307\u5b9a\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u6765\u4ee3\u66ff\u9ed8\u8ba4\u7684\r\nnginx -t            \u4e0d\u8fd0\u884c\uff0c\u800c\u4ec5\u4ec5\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6\u3002Nginx \u5c06\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\u7684\u6b63\u786e\u6027\uff0c\u5e76\u5c1d\u8bd5\u6253\u5f00\u914d\u7f6e\u6587\u4ef6\u4e2d\u6240\u5f15\u7528\u5230\u7684\u6587\u4ef6\r\nnginx -v            \u663e\u793a Nginx \u7684\u7248\u672c\r\nnginx -V            \u663e\u793a Nginx \u7684\u7248\u672c\u3001\u7f16\u8bd1\u5668\u7248\u672c\u548c\u914d\u7f6e\u53c2\u6570\r\n```\r\n\r\n> Nginx \u9ed8\u8ba4\u76d1\u542c 80 \u7aef\u53e3\uff0c\u542f\u52a8 Nginx \u524d\u8981\u786e\u4fdd 80 \u7aef\u53e3\u6ca1\u6709\u88ab\u5360\u7528\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 Nginx \u914d\u7f6e\u6587\u4ef6 `/etc/nginx/nginx.conf` \u6539 Nginx \u76d1\u542c\u7aef\u53e3\u3002\r\n\r\n## \u914d\u7f6e Nginx \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\r\n\r\n\u5047\u5b9a\u8981\u8bbf\u95ee\u7684 API \u670d\u52a1\u5668\u57df\u540d\u4e3a `apiserver.com`\uff0c\u5728 `/etc/nginx/nginx.conf` \u914d\u7f6e API \u670d\u52a1\u5668\u7684 `server` \u5165\u53e3\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/5/163ce6bd14b27589?w=1128&h=785&f=png&s=44586)\r\n\r\n\u5b8c\u6210 nginx.conf \u5185\u5bb9\u5982\u4e0b\uff1a\r\n\r\n```nginx\r\nuser  nginx;\r\nworker_processes  1;\r\n\r\nerror_log  /var/log/nginx/error.log warn;\r\npid        /var/run/nginx.pid;\r\n\r\n\r\nevents {\r\n    worker_connections  1024;\r\n}\r\n\r\nhttp {\r\n    include       /etc/nginx/mime.types;\r\n    default_type  application/octet-stream;\r\n\r\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n                      '$status $body_bytes_sent \"$http_referer\" '\r\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\r\n\r\n    access_log  /var/log/nginx/access.log  main;\r\n\r\n    sendfile        on;\r\n    #tcp_nopush     on;\r\n\r\n    keepalive_timeout  65;\r\n\r\n    #gzip  on;\r\n\r\n    include /etc/nginx/conf.d/*.conf;\r\n\r\n    server {  \r\n        listen      80;                                                        \r\n        server_name  apiserver.com;                                              \r\n        client_max_body_size 1024M;\r\n\r\n        location / {\r\n            proxy_set_header Host $http_host;\r\n            proxy_set_header X-Forwarded-Host $http_host;\r\n            proxy_set_header X-Real-IP $remote_addr;\r\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n            proxy_pass  http://127.0.0.1:8080/;\r\n            client_max_body_size 5m;\r\n        }\r\n    } \r\n}\r\n```\r\n\r\n**\u914d\u7f6e\u8bf4\u660e**\r\n\r\n+ \u7531\u4e8e Nginx \u9ed8\u8ba4\u5141\u8bb8\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u5927\u5355\u6587\u4ef6\u5b57\u8282\u6570\u4e3a 1MB\uff0c\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u53ef\u80fd\u592a\u5c0f\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c06\u6b64\u9650\u5236\u6539\u4e3a 5MB\uff08`client_max_body_size 5m`\uff09\r\n+  `server_name`\uff1a\u8bf4\u660e\u4f7f\u7528\u54ea\u4e2a\u57df\u540d\u6765\u8bbf\u95ee\r\n+  `proxy_pass`\uff1a\u53cd\u5411\u4ee3\u7406\u7684\u8def\u5f84\uff08\u8fd9\u91cc\u662f\u672c\u673a\u7684 API \u670d\u52a1\uff0c\u6240\u4ee5IP\u4e3a 127.0.0.1\u3002\u7aef\u53e3\u8981\u548c API \u670d\u52a1\u7aef\u53e3\u4e00\u81f4\uff1a8080\uff09\r\n\r\n> \u5982\u679c\u9700\u8981\u4e0a\u4f20\u56fe\u7247\u4e4b\u7c7b\u7684\uff0c\u53ef\u80fd\u9700\u8981\u8bbe\u7f6e\u6210\u66f4\u5927\u7684\u503c\uff0c\u6bd4\u5982 50m\u3002\r\n>\r\n> \u56e0\u4e3a Nginx \u914d\u7f6e\u9009\u9879\u6bd4\u8f83\u591a\uff0c\u8ddf\u5b9e\u9645\u9700\u6c42\u548c\u73af\u5883\u6709\u5173\uff0c\u6240\u4ee5\u8fd9\u91cc\u7684\u914d\u7f6e\u662f\u57fa\u7840\u7684\u3001\u672a\u7ecf\u4f18\u5316\u7684\u914d\u7f6e\uff0c\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u9700\u8981\u8bfb\u8005\u518d\u505a\u8c03\u8282\u3002\r\n\r\n**\u6d4b\u8bd5**\r\n\r\n1. \u914d\u7f6e\u5b8c Nginx \u540e\u91cd\u542f Nginx\r\n\r\n```\r\n$ systemctl restart nginx\r\n```\r\n\r\n2. \u5728\u7f16\u8bd1\u5b8c apiserver \u540e\uff0c\u542f\u52a8 API \u670d\u52a1\u5668\r\n\r\n```\r\n$ ./apiserver\r\n```\r\n3. \u5728 `/etc/hosts` \u4e2d\u6dfb\u52a0\u4e00\u884c\uff1a`127.0.0.1 apiserver.com`\r\n\r\n4. \u53d1\u9001 HTTP \u8bf7\u6c42\r\n\r\n```\r\n$ curl -XGET -H \"Content-Type: application/json\" -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\" http://apiserver.com/v1/user \r\n\r\n{\r\n  \"code\": 0,\r\n  \"message\": \"OK\",\r\n  \"data\": {\r\n    \"totalCount\": 1,\r\n    \"userList\": [\r\n      {\r\n        \"id\": 0,\r\n        \"username\": \"admin\",\r\n        \"sayHello\": \"Hello Jypl3DSig\",\r\n        \"password\": \"$2a$10$veGcArz47VGj7l9xN7g2iuT9TF21jLI1YGXarGzvARNdnt4inC9PG\",\r\n        \"createdAt\": \"2018-05-28 00:25:33\",\r\n        \"updatedAt\": \"2018-05-28 00:25:33\"\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230\u6210\u529f\u901a\u8fc7\u4ee3\u7406\u8bbf\u95ee\u540e\u7aef\u7684 API \u670d\u52a1\u3002\r\n\r\n**\u8bf7\u6c42\u6d41\u7a0b\u8bf4\u660e**\r\n\r\n\u5728\u7528 `curl` \u8bf7\u6c42 `http://apiserver.com/v1/user` \u540e\uff0c\u540e\u7aef\u7684\u8bf7\u6c42\u6d41\u7a0b\u5b9e\u9645\u4e0a\u662f\u8fd9\u6837\u7684\uff1a\r\n\r\n1. \u56e0\u4e3a\u5728 `/etc/hosts` \u4e2d\u914d\u7f6e\u4e86 `127.0.0.1 apiserver.com`\uff0c\u6240\u4ee5\u8bf7\u6c42 `http://apiserver.com/v1/use` \u5b9e\u9645\u4e0a\u662f\u8bf7\u6c42\u672c\u673a\u7684 Nginx \u7aef\u53e3\uff08`127.0.0.1:80`\uff09\r\n2. Nginx \u5728\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u89e3\u6790\u5230\u8bf7\u6c42\u57df\u540d\u4e3a `apiserver.com`\uff0c\u6839\u636e\u8bf7\u6c42\u57df\u540d\u53bb\u5339\u914d Nginx \u7684 server \u914d\u7f6e\uff0c\u5339\u914d\u5230 `server_name  apiserver.com` \u914d\u7f6e\r\n3. \u5339\u914d\u5230 server \u540e\uff0c\u628a\u8bf7\u6c42\u8f6c\u53d1\u5230\u8be5 server \u7684 `proxy_pass` \u8def\u5f84\r\n4. \u7b49\u5f85 API \u670d\u52a1\u5668\u8fd4\u56de\u7ed3\u679c\uff0c\u5e76\u8fd4\u56de\u5ba2\u6237\u7aef\r\n\r\n## \u914d\u7f6e Nginx \u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\r\n\r\n\u8d1f\u8f7d\u5747\u8861\u7684\u6f14\u793a\u9700\u8981\u591a\u4e2a\u540e\u7aef\u670d\u52a1\uff0c\u4e3a\u6b64\u6211\u4eec\u5728\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u591a\u4e2a apiserver\uff0c\u914d\u7f6e\u4e0d\u540c\u7684\u7aef\u53e3\uff088080\u30018082\uff09\uff0c\u5e76\u91c7\u7528 Nginx \u9ed8\u8ba4\u7684\u8f6e\u8be2\u8f6c\u53d1\u7b56\u7565\uff08\u8f6e\u8be2\uff1a\u6bcf\u4e2a\u8bf7\u6c42\u6309\u65f6\u95f4\u987a\u5e8f\u9010\u4e00\u5206\u914d\u5230\u4e0d\u540c\u7684\u540e\u7aef\u670d\u52a1\u5668\uff09\u3002\r\n\r\n\u5728 `/etc/nginx/nginx.conf` \u4e2d\u6dfb\u52a0 `upstream ` \u914d\u7f6e\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/5/163ce86c83907507?w=1147&h=877&f=png&s=49330)\r\n\r\n**\u914d\u7f6e\u8bf4\u660e**\r\n\r\n+ \u56e0\u4e3a\u6709\u591a\u4e2a\u540e\u7aef\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u4e4b\u524d\u56fa\u5b9a\u7684\u540e\u7aef `proxy_pass  http://127.0.0.1:8080/` \u6362\u6210\u5177\u6709\u591a\u4e2a\u540e\u7aef\u7684 `apiserver.com`\uff08\u901a\u8fc7 `upstream`\uff09\r\n+ `upstream` \u914d\u7f6e\u4e2d\u914d\u7f6e\u591a\u4e2a\u540e\u7aef\uff08ip:port\uff09\r\n\r\n```nginx\r\n    upstream apiserver.com {\r\n        server 127.0.0.1:8080;\r\n        server 127.0.0.1:8082;\r\n    }   \r\n```\r\n\r\n**\u6d4b\u8bd5**\r\n\r\n1. \u914d\u7f6e\u5b8c Nginx \u540e\u91cd\u542f Nginx\r\n\r\n```\r\n$ systemctl restart nginx\r\n```\r\n\r\n2. \u8fd9\u91cc\u9700\u8981\u6784\u5efa\u5e76\u53d1\u8bf7\u6c42\uff0c\u7f16\u5199\u6d4b\u8bd5\u811a\u672c `test.sh`\uff0c\u5185\u5bb9\u4e3a\uff1a\r\n\r\n```\r\n#!/bin/bash\r\n\r\n\r\nfor n in $(seq 1 1 10)\r\ndo\r\n    nohup curl -XGET -H \"Content-Type: application/json\" -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1MjgwMTY5MjIsImlkIjowLCJuYmYiOjE1MjgwMTY5MjIsInVzZXJuYW1lIjoiYWRtaW4ifQ.LjxrK9DuAwAzUD8-9v43NzWBN7HXsSLfebw92DKd1JQ\" http://apiserver.com/v1/user &>/dev/null\r\ndone\r\n```\r\n\r\n3. \u4e3a\u4e86\u5c55\u793a\u54ea\u4e2a API \u88ab\u8c03\u7528\uff0c\u9700\u8981\u5728\u67e5\u8be2\u7528\u6237\u5217\u8868\u7684\u5165\u53e3\u51fd\u6570\uff08`handler/user/list.go `\u6587\u4ef6\u4e2d\u7684 `List()` \u51fd\u6570\uff09\u4e2d\u6dfb\u52a0\u65e5\u5fd7\u6253\u5370\u4fe1\u606f\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/5/163ce972c78297b1?w=961&h=728&f=png&s=34502)\r\n\r\n4. \u5728\u76f8\u540c\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u4e24\u4e2a\u4e0d\u540c\u7684 HTTP \u7aef\u53e3\uff1a8080 \u548c 8082\r\n5. \u6267\u884c test.sh \u811a\u672c\r\n\r\n```\r\n$ ./test.sh\r\n```\r\n\r\n\u89c2\u5bdf API \u65e5\u5fd7\uff0c\u53ef\u4ee5\u770b\u5230\u8bf7\u6c42\u88ab\u5747\u8861\u5730\u8f6c\u53d1\u5230\u540e\u7aef\u7684\u4e24\u4e2a\u670d\u52a1\uff1a\r\n\r\napiserver1\uff088080 \u7aef\u53e3\uff09\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/5/163ce8e0330b4ac1?w=1361&h=564&f=png&s=86186)\r\n\r\napiserver2\uff088082 \u7aef\u53e3\uff09:\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/5/163ce8e1f0308e86?w=1415&h=548&f=png&s=82778)\r\n\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0cAPI \u670d\u52a1\u5668\u6240\u5728\u7684\u7f51\u7edc\u901a\u5e38\u4e0d\u80fd\u76f4\u63a5\u901a\u8fc7\u5916\u7f51\u8bbf\u95ee\uff0c\u9700\u8981\u901a\u8fc7\u53ef\u4ece\u5916\u7f51\u8bbf\u95ee\u7684 Nginx \u670d\u52a1\u5668\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u5185\u7f51\u7684 API \u670d\u52a1\u5668\u3002\u5e76\u4e14\u968f\u7740\u4e1a\u52a1\u89c4\u6a21\u8d8a\u6765\u8d8a\u5927\uff0c\u8bf7\u6c42\u91cf\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u8fd9\u65f6\u5019\u9700\u8981\u5c06 API \u6a2a\u5411\u6269\u5bb9\uff0c\u4e5f\u9700\u8981 Nginx\u3002\u6240\u4ee5\u5728\u5b9e\u9645\u7684 API \u670d\u52a1\u90e8\u7f72\u4e2d Nginx \u7ecf\u5e38\u80fd\u6d3e\u4e0a\u7528\u573a\u3002\u901a\u8fc7\u672c\u5c0f\u8282\u7684\u5b66\u4e60\uff0c\u8bfb\u8005\u53ef\u4ee5\u4e86\u89e3\u5230\u5982\u4f55\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\u90e8\u7f72 API \u670d\u52a1\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/18\u8fdb\u9636_5\u57fa\u4e8e_Nginx_\u7684_API_\u90e8\u7f72\u65b9\u6848.md", "create_date": "2020-02-18T21:37:38.392", "order": 19}}, {"model": "subject.chapter", "pk": 136, "fields": {"title": "\u8fdb\u9636 6\uff1aAPI \u9ad8\u53ef\u7528\u65b9\u6848", "topic": 6, "md5": "074af2eb32ae4bcb8e024c5f5bb3064c", "md_body": "# API \u9ad8\u53ef\u7528\u65b9\u6848\n\n\u672c\u5c0f\u8282\u4e3a\u53ef\u9009\u5c0f\u8282\u3002\u56e0\u4e3a\u8be5\u65b9\u6848\u9700\u8981\u6709\u81f3\u5c11\u4e24\u53f0\u670d\u52a1\u5668\uff0c\u6ca1\u6709\u591a\u53f0\u670d\u52a1\u5668\u7684\u8bfb\u8005\u53ea\u9700\u8981\u4e86\u89e3\u5373\u53ef\u3002\n\n## \u65b9\u6848\u4ecb\u7ecd\n\nNginx \u81ea\u5e26\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\uff0c\u5e76\u4e14\u5f53 Nginx \u540e\u7aef\u67d0\u4e2a\u670d\u52a1\u5668\u6302\u6389\u540e\uff0cNginx \u4f1a\u81ea\u52a8\u5254\u9664\u8be5\u670d\u52a1\u5668\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u53ef\u7528\u7684\u670d\u52a1\u5668\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0\u4e86\u540e\u7aef API \u670d\u52a1\u7684\u9ad8\u53ef\u7528\uff08HA\uff09\u3002\u4f46\u662f Nginx \u662f\u5355\u70b9\u7684\uff0c\u5982\u679c Nginx \u6302\u4e86\uff0c\u540e\u7aef\u7684\u6240\u6709\u670d\u52a1\u5668\u5c31\u90fd\u4e0d\u80fd\u8bbf\u95ee\uff0c\u6240\u4ee5\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e5f\u9700\u8981\u5bf9 Nginx \u505a\u9ad8\u53ef\u7528\u3002\n\nKeepalived \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u670d\u52a1\u5668\u9ad8\u53ef\u7528\u6216\u70ed\u5907\u89e3\u51b3\u65b9\u6848\uff0cKeepalived \u4e3b\u8981\u6765\u9632\u6b62\u670d\u52a1\u5668\u5355\u70b9\u6545\u969c\u7684\u53d1\u751f\u95ee\u9898\uff0c\u53ef\u4ee5\u901a\u8fc7 Keepalived \u5bf9\u524d\u7aef Nginx \u5b9e\u73b0\u9ad8\u53ef\u7528\u3002Keepalived + Nginx \u7684\u9ad8\u53ef\u7528\u65b9\u6848\u5177\u6709\u5982\u4e0b\u7279\u70b9\uff1a\n\n1. \u670d\u52a1\u529f\u80fd\u5f3a\u5927\n2. \u7ef4\u62a4\u7b80\u5355\n\n## Keepalived \u7b80\u4ecb\n\nKeepalived \u4ee5 VRRP \u534f\u8bae\u4e3a\u57fa\u7840\u6765\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027\u3002VRRP\uff08Virtual Router Redundancy Protocol\uff0c\u865a\u62df\u8def\u7531\u5197\u4f59\u534f\u8bae\uff09\u662f\u7528\u4e8e\u5b9e\u73b0\u8def\u7531\u5668\u5197\u4f59\u7684\u534f\u8bae\uff0c\u5b83\u5c06\u4e24\u53f0\u6216\u591a\u53f0\u8def\u7531\u5668\u8bbe\u5907\u865a\u62df\u6210\u4e00\u4e2a\u8bbe\u5907\uff0c\u5bf9\u5916\u63d0\u4f9b\u865a\u62df\u8def\u7531\u5668 IP\uff08\u4e00\u4e2a\u6216\u591a\u4e2a\uff09\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163cec3864bd8244?w=2316&h=663&f=png&s=101125)\n\n\u5728\u4e0a\u56fe\u4e2d\uff0c\u5c06 Nginx + Keepalived \u90e8\u7f72\u5728\u4e24\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u62e5\u6709\u4e24\u4e2a\u771f\u5b9e\u7684 IP\uff08IP1 \u548c IP2\uff09\uff0c\u901a\u8fc7\u4e00\u5b9a\u7684\u6280\u672f\uff08\u5982 LVS\uff09\u865a\u62df\u51fa\u4e00\u4e2a\u865a\u62df IP\uff08VIP\uff09\uff0c\u5916\u754c\u8bf7\u6c42\u901a\u8fc7\u8bbf\u95ee VIP \u6765\u8bbf\u95ee\u670d\u52a1\u3002\u5728\u4e24\u53f0 Nginx + Keepalived \u7684\u670d\u52a1\u5668\u4e0a\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u53f0\u4f1a\u63a5\u7ba1 VIP\uff08\u53eb\u505a Master\uff09\u63d0\u4f9b\u670d\u52a1\uff0c\u53e6\u4e00\u53f0\uff08\u53eb\u505a Slave\uff09\u4f1a\u68c0\u6d4b Master \u7684\u5fc3\u8df3\uff0c\u5f53\u53d1\u73b0 Master \u505c\u6b62\u5fc3\u8df3\u540e\uff0cSlave \u4f1a\u81ea\u52a8\u63a5\u7ba1 VIP \u4ee5\u63d0\u4f9b\u670d\u52a1\uff08\u6b64\u65f6\uff0cSlave \u53d8\u6210 Master\uff09\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u5b9e\u73b0 Nginx \u7684\u9ad8\u53ef\u7528\uff0c\u901a\u8fc7\u7b2c 19 \u8282\u53ef\u4ee5\u77e5\u9053\uff0cNginx \u53ef\u4ee5\u5bf9\u540e\u53f0 API \u670d\u52a1\u5668\u505a\u9ad8\u53ef\u7528\uff0c\u8fd9\u6837\u901a\u8fc7 Nginx + Keepalived \u7684\u7ec4\u5408\u65b9\u6848\u5c31\u5b9e\u73b0\u4e86\u6574\u4e2a API \u96c6\u7fa4\u7684\u9ad8\u53ef\u7528\u3002\n\n## \u90e8\u7f72\n\nKeepalived + Nginx \u7684\u90e8\u7f72\u65b9\u6848\u7f51\u4e0a\u6709\u5f88\u591a\u8be6\u7ec6\u7684\u6559\u7a0b\u3002\u56e0\u4e3a\u5c0f\u518c\u7bc7\u5e45\u9650\u5236\uff0c\u8fd9\u91cc\u4e0d\u518d\u8be6\u7ec6\u8bf4\u660e\uff0c\u8bfb\u8005\u5982\u9700\u4e86\u89e3\uff0c\u8bf7\u53c2\u8003 [Keepalived+Nginx\u5b9e\u73b0\u9ad8\u53ef\u7528\uff08HA\uff09](https://blog.csdn.net/xyang81/article/details/52556886)\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/19\u8fdb\u9636_6API_\u9ad8\u53ef\u7528\u65b9\u6848.md", "create_date": "2020-02-18T21:37:38.408", "order": 20}}, {"model": "subject.chapter", "pk": 137, "fields": {"title": "\u8fdb\u9636 7\uff1ago test \u6d4b\u8bd5\u4f60\u7684\u4ee3\u7801", "topic": 6, "md5": "73f32725279c7c660d7251349041b35e", "md_body": "# go test \u6d4b\u8bd5\u4f60\u7684\u4ee3\u7801\n\n\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e0d\u4ec5\u8981\u5f00\u53d1\u529f\u80fd\uff0c\u66f4\u91cd\u8981\u7684\u662f\u786e\u4fdd\u8fd9\u4e9b\u529f\u80fd\u7a33\u5b9a\u53ef\u9760\uff0c\u5e76\u4e14\u62e5\u6709\u4e00\u4e2a\u4e0d\u9519\u7684\u6027\u80fd\uff0c\u8981\u786e\u4fdd\u8fd9\u4e9b\u5c31\u8981\u5bf9\u4ee3\u7801\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5f00\u53d1\u4eba\u5458\u901a\u5e38\u4f1a\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\u548c\u6027\u80fd\u6d4b\u8bd5\u3002\u4e0d\u540c\u7684\u8bed\u8a00\u901a\u5e38\u90fd\u6709\u81ea\u5df1\u7684\u6d4b\u8bd5\u5305/\u6a21\u5757\uff0cGo \u8bed\u8a00\u4e5f\u4e00\u6837\uff0c\u5728 Go \u4e2d\u53ef\u4ee5\u901a\u8fc7 testing \u5305\u5bf9\u4ee3\u7801\u8fdb\u884c\u5355\u5143\u548c\u6027\u80fd\u6d4b\u8bd5\uff0c\u4e0b\u9762\u5c31\u6765\u8be6\u7ec6\u4ecb\u7ecd\u3002\n\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\n\n+ \u5982\u4f55\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\n+ \u5982\u4f55\u8fdb\u884c\u538b\u529b/\u6027\u80fd\u6d4b\u8bd5\n+ \u5982\u4f55\u8fdb\u884c\u6027\u80fd\u5206\u6790\n\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo15](https://github.com/lexkong/apiserver_demos/tree/master/demo15)\n>\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\n>\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo14](https://github.com/lexkong/apiserver_demos/tree/master/demo14) \u6765\u5f00\u53d1\u7684\u3002\n\n\n## Go \u8bed\u8a00\u6d4b\u8bd5\u652f\u6301\n\nGo \u8bed\u8a00\u6709\u81ea\u5e26\u7684\u6d4b\u8bd5\u6846\u67b6 testing\uff0c\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u5355\u5143\u6d4b\u8bd5\u548c\u6027\u80fd\u6d4b\u8bd5\uff0c\u901a\u8fc7 `go test` \u547d\u4ee4\u6765\u6267\u884c\u5355\u5143\u6d4b\u8bd5\u548c\u6027\u80fd\u6d4b\u8bd5\u3002\n\n`go test` \u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\u65f6\uff0c\u662f\u4ee5 go \u5305\u4e3a\u5355\u4f4d\u8fdb\u884c\u6d4b\u8bd5\u7684\u3002\u6267\u884c\u65f6\u9700\u8981\u6307\u5b9a\u5305\u540d\uff0c\u6bd4\u5982\uff1a`go test \u5305\u540d`\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u5305\u540d\uff0c\u9ed8\u8ba4\u4f1a\u9009\u62e9\u6267\u884c\u547d\u4ee4\u65f6\u6240\u5728\u7684\u5305\u3002`go test` \u5728\u6267\u884c\u65f6\u4f1a\u904d\u5386\u4ee5 `_test.go` \u7ed3\u5c3e\u7684\u6e90\u7801\u6587\u4ef6\uff0c\u6267\u884c\u5176\u4e2d\u4ee5 `Test`\u3001`Benchmark`\u3001`Example` \u5f00\u5934\u7684\u6d4b\u8bd5\u51fd\u6570\u3002\u5176\u4e2d\u6e90\u7801\u6587\u4ef6\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u89c4\u8303\uff1a\n\n+ \u6587\u4ef6\u540d\u5fc5\u987b\u662f `_test.go` \u7ed3\u5c3e\uff0c\u8ddf\u6e90\u6587\u4ef6\u5728\u540c\u4e00\u4e2a\u5305\u3002\n+ \u6d4b\u8bd5\u7528\u4f8b\u51fd\u6570\u5fc5\u987b\u4ee5 Test\u3001Benchmark\u3001Example \u5f00\u5934\n+ \u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\u65f6\u7684\u987a\u5e8f\uff0c\u4f1a\u6309\u7167\u6e90\u7801\u4e2d\u7684\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\n+ \u5355\u5143\u6d4b\u8bd5\u51fd\u6570 TestXxx() \u7684\u53c2\u6570\u662f testing.T\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u7c7b\u578b\u6765\u8bb0\u5f55\u9519\u8bef\u6216\u6d4b\u8bd5\u72b6\u6001\n+ \u6027\u80fd\u6d4b\u8bd5\u51fd\u6570 BenchmarkXxx() \u7684\u53c2\u6570\u662f testing.B\uff0c\u51fd\u6570\u5185\u4ee5 b.N \u4f5c\u4e3a\u5faa\u73af\u6b21\u6570\uff0c\u5176\u4e2d N \u4f1a\u52a8\u6001\u53d8\u5316\n+ \u793a\u4f8b\u51fd\u6570 ExampleXxx()  \u6ca1\u6709\u53c2\u6570\uff0c\u6267\u884c\u5b8c\u4f1a\u5c06\u8f93\u51fa\u4e0e\u6ce8\u91ca `// Output:` \u8fdb\u884c\u5bf9\u6bd4\n+ \u6d4b\u8bd5\u51fd\u6570\u539f\u578b\uff1afunc TestXxx(t *testing.T)\uff0cXxx \u90e8\u5206\u4e3a\u4efb\u610f\u5b57\u6bcd\u6570\u5b57\u7ec4\u5408\uff0c\u9996\u5b57\u6bcd\u5927\u5199\uff0c\u4f8b\u5982\uff1a `TestgenShortId` \u662f\u9519\u8bef\u7684\u51fd\u6570\u540d\uff0c`TestGenShortId` \u662f\u6b63\u786e\u7684\u51fd\u6570\u540d\n+ \u901a\u8fc7\u8c03\u7528 testing.T \u7684 Error\u3001Errorf\u3001FailNow\u3001Fatal\u3001FatalIf \u65b9\u6cd5\u6765\u8bf4\u660e\u6d4b\u8bd5\u4e0d\u901a\u8fc7\uff0c\u901a\u8fc7\u8c03\u7528 Log\u3001Logf \u65b9\u6cd5\u6765\u8bb0\u5f55\u6d4b\u8bd5\u4fe1\u606f\uff1a\n    ```\n    t.Log t.Logf     # \u6b63\u5e38\u4fe1\u606f \n    t.Error t.Errorf # \u6d4b\u8bd5\u5931\u8d25\u4fe1\u606f \n    t.Fatal t.Fatalf # \u81f4\u547d\u9519\u8bef\uff0c\u6d4b\u8bd5\u7a0b\u5e8f\u9000\u51fa\u7684\u4fe1\u606f\n    t.Fail     # \u5f53\u524d\u6d4b\u8bd5\u6807\u8bb0\u4e3a\u5931\u8d25\n    t.Failed   # \u67e5\u770b\u5931\u8d25\u6807\u8bb0\n    t.FailNow  # \u6807\u8bb0\u5931\u8d25\uff0c\u5e76\u7ec8\u6b62\u5f53\u524d\u6d4b\u8bd5\u51fd\u6570\u7684\u6267\u884c\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u53ea\u80fd\u5728\u8fd0\u884c\u6d4b\u8bd5\u51fd\u6570\u7684 Goroutine \u4e2d\u8c03\u7528 t.FailNow \u65b9\u6cd5\uff0c\u800c\u4e0d\u80fd\u5728\u6211\u4eec\u5728\u6d4b\u8bd5\u4ee3\u7801\u521b\u5efa\u51fa\u7684 Goroutine \u4e2d\u8c03\u7528\u5b83\n    t.Skip     # \u8c03\u7528 t.Skip \u65b9\u6cd5\u76f8\u5f53\u4e8e\u5148\u540e\u5bf9 t.Log \u548c t.SkipNow \u65b9\u6cd5\u8fdb\u884c\u8c03\u7528\uff0c\u800c\u8c03\u7528 t.Skipf \u65b9\u6cd5\u5219\u76f8\u5f53\u4e8e\u5148\u540e\u5bf9 t.Logf \u548c t.SkipNow \u65b9\u6cd5\u8fdb\u884c\u8c03\u7528\u3002\u65b9\u6cd5 t.Skipped \u7684\u7ed3\u679c\u503c\u4f1a\u544a\u77e5\u6211\u4eec\u5f53\u524d\u7684\u6d4b\u8bd5\u662f\u5426\u5df2\u88ab\u5ffd\u7565\n    t.Parallel # \u6807\u8bb0\u4e3a\u53ef\u5e76\u884c\u8fd0\u7b97\n    ```\n\n## \u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\uff08\u5bf9 `GenShortId` \u51fd\u6570\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff09\n\n1. \u5728 `util` \u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6 `util_test.go`\uff0c\u5185\u5bb9\u4e3a\uff1a\n\n```go\npackage util\n\nimport (\n\t\"testing\"\n)\n\nfunc TestGenShortId(t *testing.T) {\n\tshortId, err := GenShortId()\n\tif shortId == \"\" || err != nil {\n\t\tt.Error(\"GenShortId failed!\")\n\t}\n\n\tt.Log(\"GenShortId test pass\")\n}\n```\n\n\u4ece\u7528\u4f8b\u53ef\u4ee5\u770b\u51fa\uff0c\u5982\u679c `GenShortId()` \u8fd4\u56de\u7684 `shortId` \u4e3a\u7a7a\u6216\u8005 `err` \u4e0d\u4e3a\u7a7a\uff0c\u5219\u8c03\u7528 `t.Error()` \u51fd\u6570\u6807\u660e\u8be5\u7528\u4f8b\u6d4b\u8bd5\u4e0d\u901a\u8fc7\u3002\n\n**\u6267\u884c\u7528\u4f8b**\n\n\u5728 `util` \u76ee\u5f55\u4e0b\u6267\u884c\u547d\u4ee4 `go test`\uff1a\n\n```\n$ cd util/\n$ go test\nPASS\nok  \tapiserver/util\t0.006s\n```\n\n\u8981\u67e5\u770b\u66f4\u8be6\u7ec6\u7684\u6267\u884c\u4fe1\u606f\u53ef\u4ee5\u6267\u884c `go test -v`\uff1a\n\n```\n$ go test -v\n=== RUN   TestGenShortId\n--- PASS: TestGenShortId (0.00s)\n\tutil_test.go:13: GenShortId test pass\nPASS\nok  \tapiserver/util\t0.006s\n```\n\n\u6839\u636e `go test` \u7684\u8f93\u51fa\u53ef\u4ee5\u77e5\u9053 `TestGenShortId` \u7528\u4f8b\u6d4b\u8bd5\u901a\u8fc7\u3002\n\n\u5982\u679c\u8981\u6267\u884c\u6d4b\u8bd5 N \u6b21\u53ef\u4ee5\u4f7f\u7528 `-count N`\uff1a\n\n```\n$ go test -v -count 2\n=== RUN   TestGenShortId\n--- PASS: TestGenShortId (0.00s)\n\tutil_test.go:13: GenShortId test pass\n=== RUN   TestGenShortId\n--- PASS: TestGenShortId (0.00s)\n\tutil_test.go:13: GenShortId test pass\nPASS\nok  \tapiserver/util\t0.006s\n```\n## \u7f16\u5199\u6027\u80fd\u6d4b\u8bd5\u7528\u4f8b\n\n\u5728 `util/util_test.go` \u6d4b\u8bd5\u6587\u4ef6\u4e2d\uff0c\u65b0\u589e\u4e24\u4e2a\u6027\u80fd\u6d4b\u8bd5\u51fd\u6570\uff1a`BenchmarkGenShortId()` \u548c `BenchmarkGenShortIdTimeConsuming()`\uff08\u8be6\u89c1 [demo15/util/util_test.go](https://github.com/lexkong/apiserver_demos/blob/master/demo15/util/util_test.go)\uff09\uff1a\n\n```go\nfunc BenchmarkGenShortId(b *testing.B) {\n\tfor i := 0; i < b.N; i++ {\n\t\tGenShortId()\n\t}\n}\n\nfunc BenchmarkGenShortIdTimeConsuming(b *testing.B) {\n\tb.StopTimer() // \u8c03\u7528\u8be5\u51fd\u6570\u505c\u6b62\u538b\u529b\u6d4b\u8bd5\u7684\u65f6\u95f4\u8ba1\u6570\n\n\tshortId, err := GenShortId()\n\tif shortId == \"\" || err != nil {\n\t\tb.Error(err)\n\t}\n\n\tb.StartTimer() // \u91cd\u65b0\u5f00\u59cb\u65f6\u95f4\n\n\tfor i := 0; i < b.N; i++ {\n\t\tGenShortId()\n\t}\n}\n\n```\n\n**\u8bf4\u660e**\n\n+ \u6027\u80fd\u6d4b\u8bd5\u51fd\u6570\u540d\u5fc5\u987b\u4ee5 Benchmark \u5f00\u5934\uff0c\u5982 BenchmarkXxx \u6216 Benchmark_xxx\n+ `go test` \u9ed8\u8ba4\u4e0d\u4f1a\u6267\u884c\u538b\u529b\u6d4b\u8bd5\u51fd\u6570\uff0c\u9700\u8981\u901a\u8fc7\u6307\u5b9a\u53c2\u6570 `-test.bench` \u6765\u8fd0\u884c\u538b\u529b\u6d4b\u8bd5\u51fd\u6570\uff0c`-test.bench` \u540e\u8ddf\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5982 `go test -test.bench=\".*\"` \u8868\u793a\u6267\u884c\u6240\u6709\u7684\u538b\u529b\u6d4b\u8bd5\u51fd\u6570\n+ \u5728\u538b\u529b\u6d4b\u8bd5\u4e2d\uff0c\u9700\u8981\u5728\u5faa\u73af\u4f53\u4e2d\u6307\u5b9a `testing.B.N` \u6765\u5faa\u73af\u6267\u884c\u538b\u529b\u6d4b\u8bd5\u4ee3\u7801\n\n**\u6267\u884c\u538b\u529b\u6d4b\u8bd5**\n\n\u5728 `util` \u76ee\u5f55\u4e0b\u6267\u884c\u547d\u4ee4 `go test -test.bench=\".*\"`\uff1a\n\n```\n$ go test -test.bench=\".*\"\ngoos: linux\ngoarch: amd64\npkg: apiserver/util\nBenchmarkGenShortId-2                \t  500000\t      2291 ns/op\nBenchmarkGenShortIdTimeConsuming-2   \t  500000\t      2333 ns/op\nPASS\nok  \tapiserver/util\t2.373s\n```\n\n+ \u4e0a\u9762\u7684\u7ed3\u679c\u663e\u793a\uff0c\u6211\u4eec\u6ca1\u6709\u6267\u884c\u4efb\u4f55 TestXXX \u7684\u5355\u5143\u6d4b\u8bd5\u51fd\u6570\uff0c\u53ea\u6267\u884c\u4e86\u538b\u529b\u6d4b\u8bd5\u51fd\u6570\n+ \u7b2c\u4e00\u6761\u663e\u793a\u4e86 `BenchmarkGenShortId` \u6267\u884c\u4e86 500000 \u6b21\uff0c\u6bcf\u6b21\u7684\u6267\u884c\u5e73\u5747\u65f6\u95f4\u662f 2291 \u7eb3\u79d2\n+ \u7b2c\u4e8c\u6761\u663e\u793a\u4e86 `BenchmarkGenShortIdTimeConsuming` \u6267\u884c\u4e86 500000\uff0c\u6bcf\u6b21\u7684\u5e73\u5747\u6267\u884c\u65f6\u95f4\u662f 2333 \u7eb3\u79d2\n+ \u6700\u540e\u4e00\u6761\u663e\u793a\u603b\u6267\u884c\u65f6\u95f4\n\n> `BenchmarkGenShortIdTimeConsuming` \u6bd4 `BenchmarkGenShortId` \u591a\u4e86\u4e24\u4e2a\u8c03\u7528 `b.StopTimer()` \u548c `b.StartTimer()`\u3002\n> + `b.StopTimer()`\uff1a\u8c03\u7528\u8be5\u51fd\u6570\u505c\u6b62\u538b\u529b\u6d4b\u8bd5\u7684\u65f6\u95f4\u8ba1\u6570\n> + `b.StartTimer()`\uff1a\u91cd\u65b0\u5f00\u59cb\u65f6\u95f4\n> \n> \u5728 `b.StopTimer()` \u548c `b.StartTimer()` \u4e4b\u95f4\u53ef\u4ee5\u505a\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\uff0c\u8fd9\u6837\u8fd9\u4e9b\u65f6\u95f4\u4e0d\u5f71\u54cd\u6211\u4eec\u6d4b\u8bd5\u51fd\u6570\u672c\u8eab\u7684\u6027\u80fd\u3002\n\n## \u67e5\u770b\u6027\u80fd\u5e76\u751f\u6210\u51fd\u6570\u8c03\u7528\u56fe\n\n1. \u6267\u884c\u547d\u4ee4\uff1a\n\n```\n$ go test -bench=\".*\" -cpuprofile=cpu.profile ./util\n```\n\n\u4e0a\u8ff0\u547d\u4ee4\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210 `cpu.profile` \u548c `util.test` \u6587\u4ef6\u3002\n\n2. \u6267\u884c `go tool pprof util.test cpu.profile` \u67e5\u770b\u6027\u80fd\uff08\u8fdb\u5165\u4ea4\u4e92\u754c\u9762\u540e\u6267\u884c `top` \u6307\u4ee4\uff09\uff1a\n\n```\n$ go tool pprof util.test cpu.profile\n\nFile: util.test\nType: cpu\nTime: Jun 5, 2018 at 7:28pm (CST)\nDuration: 4.93s, Total samples = 4.97s (100.78%)\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) top\nShowing nodes accounting for 3480ms, 70.02% of 4970ms total\nDropped 34 nodes (cum <= 24.85ms)\nShowing top 10 nodes out of 75\n      flat  flat%   sum%        cum   cum%\n    1890ms 38.03% 38.03%     1900ms 38.23%  syscall.Syscall\n     500ms 10.06% 48.09%      620ms 12.47%  runtime.mallocgc\n     240ms  4.83% 52.92%     3700ms 74.45%  vendor/github.com/teris-io/shortid.(*Abc).Encode\n     150ms  3.02% 55.94%      200ms  4.02%  runtime.scanobject\n     140ms  2.82% 58.75%      640ms 12.88%  runtime.makeslice\n     140ms  2.82% 61.57%      280ms  5.63%  runtime.slicerunetostring\n     120ms  2.41% 63.98%      120ms  2.41%  math.Log\n     110ms  2.21% 66.20%     2430ms 48.89%  io.ReadAtLeast\n     110ms  2.21% 68.41%      110ms  2.21%  runtime._ExternalCode\n      80ms  1.61% 70.02%      140ms  2.82%  runtime.deferreturn\n(pprof) \n```\n\npprof \u7a0b\u5e8f\u4e2d\u6700\u91cd\u8981\u7684\u547d\u4ee4\u5c31\u662f `topN`\uff0c\u6b64\u547d\u4ee4\u7528\u4e8e\u663e\u793a profile \u6587\u4ef6\u4e2d\u7684\u6700\u9760\u524d\u7684 N \u4e2a\u6837\u672c\uff08sample\uff09\uff0c\u5b83\u7684\u8f93\u51fa\u683c\u5f0f\u5404\u5b57\u6bb5\u7684\u542b\u4e49\u4f9d\u6b21\u662f\uff1a\n\n1. \u91c7\u6837\u70b9\u843d\u5728\u8be5\u51fd\u6570\u4e2d\u7684\u603b\u65f6\u95f4\n2. \u91c7\u6837\u70b9\u843d\u5728\u8be5\u51fd\u6570\u4e2d\u7684\u767e\u5206\u6bd4\n3. \u4e0a\u4e00\u9879\u7684\u7d2f\u79ef\u767e\u5206\u6bd4\n4. \u91c7\u6837\u70b9\u843d\u5728\u8be5\u51fd\u6570\uff0c\u4ee5\u53ca\u88ab\u5b83\u8c03\u7528\u7684\u51fd\u6570\u4e2d\u7684\u603b\u65f6\u95f4\n5. \u91c7\u6837\u70b9\u843d\u5728\u8be5\u51fd\u6570\uff0c\u4ee5\u53ca\u88ab\u5b83\u8c03\u7528\u7684\u51fd\u6570\u4e2d\u7684\u603b\u6b21\u6570\u767e\u5206\u6bd4\n6. \u51fd\u6570\u540d\n\n\u6b64\u5916\uff0c\u5728 pprof \u7a0b\u5e8f\u4e2d\u8fd8\u53ef\u4ee5\u4f7f\u7528 `svg` \u6765\u751f\u6210\u51fd\u6570\u8c03\u7528\u5173\u7cfb\u56fe\uff08\u9700\u8981\u5b89\u88c5 graphviz\uff09\uff0c\u4f8b\u5982\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/5/163d01d751cb3087?w=693&h=768&f=png&s=99002)\n\n\u8be5\u8c03\u7528\u56fe\u751f\u6210\u65b9\u6cd5\u5982\u4e0b\uff1a\n\n1. \u5b89\u88c5 `graphviz` \u547d\u4ee4\n\n```\n# yum -y install graphviz.x86_64\n```\n\n2. \u6267\u884c `go tool pprof` \u751f\u6210 svg \u56fe\uff1a\n\n```\n$ go tool pprof util.test cpu.profile\nFile: util.test\nType: cpu\nTime: Jun 5, 2018 at 7:28pm (CST)\nDuration: 4.93s, Total samples = 4.97s (100.78%)\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) svg\nGenerating report in profile001.svg\n```\n\n`svg` \u5b50\u547d\u4ee4\u4f1a\u63d0\u793a\u5728 `$GOPATH/src` \u76ee\u5f55\u4e0b\u751f\u6210\u4e86\u4e00\u4e2a svg \u6587\u4ef6 `profile001.svg`\u3002\n\n> \u5173\u4e8e\u5982\u4f55\u770b\u61c2 pprof \u4fe1\u606f\uff0c\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863 [Profiling Go Programs](https://blog.golang.org/profiling-go-programs)\u3002\n>\n> \u5173\u4e8e\u5982\u4f55\u505a\u6027\u80fd\u5206\u6790\uff0c\u8bf7\u53c2\u8003\u90dd\u6797\u5927\u795e\u7684\u6587\u7ae0 [go tool pprof](https://github.com/hyper0x/go_command_tutorial/blob/master/0.12.md)\u3002\n\n## \u6d4b\u8bd5\u8986\u76d6\u7387\n\n\u6211\u4eec\u5199\u5355\u5143\u6d4b\u8bd5\u7684\u65f6\u5019\u5e94\u8be5\u60f3\u5f97\u5f88\u5168\u9762\uff0c\u80fd\u591f\u8986\u76d6\u5230\u6240\u6709\u7684\u6d4b\u8bd5\u7528\u4f8b\uff0c\u4f46\u6709\u65f6\u4e5f\u4f1a\u6f0f\u8fc7\u4e00\u4e9b case\uff0cgo \u63d0\u4f9b\u4e86 cover \u5de5\u5177\u6765\u7edf\u8ba1\u6d4b\u8bd5\u8986\u76d6\u7387\u3002\n\n`go test -coverprofile=cover.out`\uff1a\u5728\u6d4b\u8bd5\u6587\u4ef6\u76ee\u5f55\u4e0b\u8fd0\u884c\u6d4b\u8bd5\u5e76\u7edf\u8ba1\u6d4b\u8bd5\u8986\u76d6\u7387\n\n`go tool cover -func=cover.out`\uff1a\u5206\u6790\u8986\u76d6\u7387\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u51fa\u54ea\u4e9b\u51fd\u6570\u6ca1\u6709\u6d4b\u8bd5\uff0c\u54ea\u4e9b\u51fd\u6570\u5185\u90e8\u7684\u5206\u652f\u6ca1\u6709\u6d4b\u8bd5\u5b8c\u5168\uff0ccover \u5de5\u5177\u4f1a\u901a\u8fc7\u6267\u884c\u4ee3\u7801\u7684\u884c\u6570\u4e0e\u603b\u884c\u6570\u7684\u6bd4\u4f8b\u8868\u793a\u51fa\u8986\u76d6\u7387\n\n**\u6d4b\u8bd5\u8986\u76d6\u7387**\n\n```\n$ go test -coverprofile=cover.out\nPASS\ncoverage: 14.3% of statements\nok  \tapiserver/util\t0.006s\n[api@centos util]$ go tool cover -func=cover.out\napiserver/util/util.go:8:\tGenShortId\t100.0%\napiserver/util/util.go:12:\tGetReqID\t0.0%\ntotal:\t\t\t\t(statements)\t14.3%\n```\n\n\u53ef\u4ee5\u770b\u5230 `GenShortId()` \u51fd\u6570\u6d4b\u8bd5\u8986\u76d6\u7387\u4e3a 100%\uff0c`GetReqID()` \u6d4b\u8bd5\u8986\u76d6\u7387\u4e3a 0%\u3002\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u8282\u7b80\u5355\u4ecb\u7ecd\u4e86\u5982\u4f55\u7528 testing \u5305\u505a\u5355\u5143\u548c\u6027\u80fd\u6d4b\u8bd5\u3002\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u8981\u517b\u6210\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\u4ee3\u7801\u7684\u597d\u4e60\u60ef\uff0c\u5728\u9879\u76ee\u4e0a\u7ebf\u524d\uff0c\u6700\u597d\u5bf9\u4e00\u4e9b\u4e1a\u52a1\u903b\u8f91\u6bd4\u8f83\u590d\u6742\u7684\u51fd\u6570\u505a\u4e00\u4e9b\u6027\u80fd\u6d4b\u8bd5\uff0c\u63d0\u524d\u53d1\u73b0\u6027\u80fd\u95ee\u9898\u3002\n\n\u81f3\u4e8e\u600e\u4e48\u53bb\u5206\u6790\u6027\u80fd\uff0c\u6bd4\u5982\u67e5\u627e\u8017\u65f6\u6700\u4e45\u7684\u51fd\u6570\u7b49\uff0c\u7b14\u8005\u94fe\u63a5\u4e86\u90dd\u6797\u5927\u795e\u4e13\u4e1a\u7684\u5206\u6790\u65b9\u6cd5\uff08[go tool pprof](https://github.com/hyper0x/go_command_tutorial/blob/master/0.12.md)\uff09\uff0c\u66f4\u6df1\u7684\u5206\u6790\u6280\u5de7\u9700\u8981\u8bfb\u8005\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u81ea\u5df1\u53bb\u63a2\u7d22\u3002\n", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/20\u8fdb\u9636_7go_test_\u6d4b\u8bd5\u4f60\u7684\u4ee3\u7801.md", "create_date": "2020-02-18T21:37:38.425", "order": 21}}, {"model": "subject.chapter", "pk": 138, "fields": {"title": "\u8fdb\u9636 8\uff1aAPI \u6027\u80fd\u5206\u6790", "topic": 6, "md5": "48649a8bbfd9e6a36c6a6da4557762c4", "md_body": "# API \u6027\u80fd\u5206\u6790\r\n\r\n\u4f5c\u4e3a\u5f00\u53d1\uff0c\u6211\u4eec\u4e00\u822c\u90fd\u5c40\u9650\u5728\u529f\u80fd\u4e0a\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u5bf9\u4e00\u4e9b\u6027\u80fd\u4e0a\u7684\u7ec6\u8282\u6211\u4eec\u5f80\u5f80\u6ca1\u6709\u53bb\u5173\u6ce8\uff0c\u5982\u679c\u6211\u4eec\u5728\u4e0a\u7ebf\u7684\u65f6\u5019\u5bf9\u9879\u76ee\u6574\u4f53\u6027\u80fd\u6ca1\u6709\u4e00\u4e2a\u5168\u9762\u7684\u4e86\u89e3\u7684\u8bdd\uff0c\u5f53\u6d41\u91cf\u8d8a\u6765\u8d8a\u5927\u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\uff0c\u6bd4\u5982 CPU \u5360\u7528\u9ad8\u3001\u5185\u5b58\u4f7f\u7528\u7387\u9ad8\u7b49\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u4e9b\u6027\u80fd\u74f6\u9888\uff0c\u6211\u4eec\u5728\u5f00\u53d1\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u901a\u8fc7\u4e00\u5b9a\u7684\u624b\u6bb5\u6765\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u6027\u80fd\u5206\u6790\u3002\r\n\r\nGo \u8bed\u8a00\u5df2\u7ecf\u4e3a\u5f00\u53d1\u8005\u5185\u7f6e\u914d\u5957\u4e86\u5f88\u591a\u6027\u80fd\u8c03\u4f18\u76d1\u63a7\u7684\u597d\u5de5\u5177\u548c\u65b9\u6cd5\uff0c\u8fd9\u5927\u5927\u63d0\u5347\u4e86\u6211\u4eec profile \u5206\u6790\u7684\u6548\u7387\uff0c\u501f\u52a9\u8fd9\u4e9b\u5de5\u5177\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u6765\u5bf9 Go \u7a0b\u5e8f\u8fdb\u884c\u6027\u80fd\u5206\u6790\u3002\u5728 Go \u8bed\u8a00\u5f00\u53d1\u4e2d\uff0c\u901a\u5e38\u501f\u52a9\u4e8e\u5185\u7f6e\u7684 pprof \u5de5\u5177\u5305\u6765\u8fdb\u884c\u6027\u80fd\u5206\u6790\u3002\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u5982\u4f55\u7528 pprof \u5de5\u5177\u5bf9 API \u7a0b\u5e8f\u8fdb\u884c\u6027\u80fd\u5206\u6790\r\n\r\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo16](https://github.com/lexkong/apiserver_demos/tree/master/demo16)\r\n>\r\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\r\n>\r\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo15](https://github.com/lexkong/apiserver_demos/tree/master/demo15) \u6765\u5f00\u53d1\u7684\u3002\r\n\r\n## pprof \u662f\u4ec0\u4e48\r\n\r\n[PProf](https://github.com/google/pprof) \u662f\u4e00\u4e2a Go \u7a0b\u5e8f\u6027\u80fd\u5206\u6790\u5de5\u5177\uff0c\u53ef\u4ee5\u5206\u6790 CPU\u3001\u5185\u5b58\u7b49\u6027\u80fd\u3002Go \u5728\u8bed\u8a00\u5c42\u9762\u4e0a\u96c6\u6210\u4e86 profile \u91c7\u6837\u5de5\u5177\uff0c\u53ea\u9700\u5728\u4ee3\u7801\u4e2d\u7b80\u5355\u5730\u5f15\u5165 `runtime/ppro` \u6216\u8005 `net/http/pprof` \u5305\u5373\u53ef\u83b7\u53d6\u7a0b\u5e8f\u7684 profile \u6587\u4ef6\uff0c\u5e76\u901a\u8fc7\u8be5\u6587\u4ef6\u6765\u8fdb\u884c\u6027\u80fd\u5206\u6790\u3002\r\n\r\n> runtime/pprof \u8fd8\u53ef\u4ee5\u4e3a\u63a7\u5236\u53f0\u7a0b\u5e8f\u6216\u8005\u6d4b\u8bd5\u7a0b\u5e8f\u4ea7\u751f pprof \u6570\u636e\u3002\r\n>\r\n> \u5176\u5b9e net/http/pprof \u4e2d\u53ea\u662f\u4f7f\u7528 runtime/pprof \u5305\u6765\u8fdb\u884c\u5c01\u88c5\u4e86\u4e00\u4e0b\uff0c\u5e76\u5728 HTTP \u7aef\u53e3\u4e0a\u66b4\u9732\u51fa\u6765\u3002\r\n\r\n##  \u4f7f\u7528 pprof\r\n\r\n\u5728 `gin` \u4e2d\u4f7f\u7528 pprof \u529f\u80fd\uff0c\u9700\u8981\u7528\u5230 `github.com/gin-contrib/pprof` middleware\uff0c\u4f7f\u7528\u65f6\u53ea\u9700\u8981\u8c03\u7528 `pprof.Register()` \u51fd\u6570\u5373\u53ef\u3002\u672c\u4f8b\u4e2d\uff0c\u901a\u8fc7\u5728`router/router.go`\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\u6765\u5b9e\u73b0\uff08\u8be6\u89c1 [demo16/router/router.go](https://github.com/lexkong/apiserver_demos/blob/master/demo16/router/router.go)\uff09\uff1a\r\n\r\n```go\r\npackage router\r\n\r\nimport (\r\n\t\"github.com/gin-contrib/pprof\"\r\n\t....\r\n)\r\n\r\n// Load loads the middlewares, routes, handlers.\r\nfunc Load(g *gin.Engine, mw ...gin.HandlerFunc) *gin.Engine {\r\n\t// pprof router\r\n\tpprof.Register(g)\r\n\t....\r\n}\r\n```\r\n\r\n## \u7f16\u8bd1\r\n\r\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\r\n\r\n```\r\n$ git clone https://github.com/lexkong/apiserver_demos\r\n```\r\n\r\n2. \u5c06 `apiserver_demos/demo16` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\r\n\r\n```\r\n$ cp -a apiserver_demos/demo16/ $GOPATH/src/apiserver\r\n```\r\n\r\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\r\n\r\n```\r\n$ cd $GOPATH/src/apiserver\r\n$ make\r\n```\r\n\r\n## \u83b7\u53d6 profile \u91c7\u96c6\u4fe1\u606f\r\n\r\n\u901a\u8fc7 `go tool pprof http://127.0.0.1:8080/debug/pprof/profile`\uff0c\u53ef\u4ee5\u83b7\u53d6 profile \u91c7\u96c6\u4fe1\u606f\u5e76\u5206\u6790\u3002\r\n\r\n\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u6d4f\u89c8\u5668\u8bbf\u95ee `http://localhost:8080/debug/pprof` \u6765\u67e5\u770b\u5f53\u524d API \u670d\u52a1\u7684\u72b6\u6001\uff0c\u5305\u62ec CPU \u5360\u7528\u60c5\u51b5\u548c\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u7b49\u3002\r\n\r\n> \u6267\u884c\u547d\u4ee4\u540e\uff0c\u9700\u8981\u7b49\u5f85 30s\uff0cpprof \u4f1a\u8fdb\u884c\u91c7\u6837\u3002\r\n\r\n## \u6027\u80fd\u5206\u6790\r\n\r\n\u5728\u4e0a\u4e00\u5c0f\u8282\u6211\u4eec\u4ecb\u7ecd\u51fd\u6570\u6027\u80fd\u6d4b\u8bd5\u65f6\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u6027\u80fd\u5206\u6790\u7684\u4e00\u90e8\u5206\u77e5\u8bc6\uff0c\u4e3a\u4e86\u4f7f\u5185\u5bb9\u5b8c\u6574\uff0c\u6211\u4eec\u8fd9\u91cc\u518d\u6b21\u4ecb\u7ecd\u4e0b\u76f8\u5173\u77e5\u8bc6\u3002\r\n\r\n\u901a\u8fc7\u4e0a\u4e00\u90e8\u5206\u6211\u4eec\u5df2\u7ecf\u83b7\u53d6\u5230\u4e86\u7a0b\u5e8f\u7684 profile \u4fe1\u606f\uff0c\u5e76\u4e14\u8fdb\u5165\u5230\u4e86 pprof \u7684\u4ea4\u4e92\u754c\u9762\uff0c\u5728\u4ea4\u4e92\u754c\u9762\u6267\u884c topN \u53ef\u4ee5\u83b7\u53d6\u91c7\u6837\u4fe1\u606f\u3002\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/18/1640f2473cbb42e5?w=1895&h=992&f=jpeg&s=230852)\r\n\r\n\u901a\u8fc7 topN \u7684\u8f93\u51fa\u53ef\u4ee5\u5206\u6790\u51fa\u54ea\u4e9b\u51fd\u6570\u5360\u7528 CPU \u65f6\u95f4\u7247\u6700\u591a\uff0c\u8fd9\u4e9b\u51fd\u6570\u53ef\u80fd\u5b58\u5728\u6027\u80fd\u95ee\u9898\u3002\u6027\u80fd\u5206\u6790\u8be6\u7ec6\u9632\u8303\u8bf7\u53c2\u8003\uff1a\r\n\r\n\u5982\u679c\u89c9\u5f97\u4e0d\u76f4\u89c2\uff0c\u53ef\u4ee5\u76f4\u63a5\u751f\u6210\u51fd\u6570\u8c03\u7528\u56fe\uff0c\u901a\u8fc7\u8c03\u7528\u56fe\u6765\u5224\u65ad\u54ea\u4e9b\u51fd\u6570\u8017\u65f6\u6700\u4e45\uff0c\u5728 pprof \u4ea4\u4e92\u754c\u9762\uff0c\u6267\u884c `svg` \u751f\u6210 svg \u6587\u4ef6\u3002\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/18/1640f2b2bad74529?w=1562&h=102&f=jpeg&s=12706)\r\n\u7528\u6d4f\u89c8\u5668\u6253\u5f00 profile001.svg\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/18/1640f28660d6d4a0?w=2539&h=1192&f=jpeg&s=216904)\r\n\r\n\u6846\u6846\u6700\u5927\u7684\u51fd\u6570\u8017\u65f6\u6bd4\u8f83\u4e45\uff0c\u8bf4\u660e\u51fd\u6570\u53ef\u80fd\u5b58\u5728\u6027\u80fd\u95ee\u9898\u3002\r\n\r\n> \u786e\u4fdd\u7cfb\u7edf\u5df2\u7ecf\u5b89\u88c5 `graphviz` \u547d\u4ee4\u3002\r\n\r\n## \u5c0f\u7ed3\r\n\r\n\u672c\u8282\u5c55\u793a\u4e86\u5982\u4f55\u5bf9 API \u670d\u52a1\u8fdb\u884c\u6027\u80fd\u5206\u6790\uff0c\u8fd9\u91cc\u53ea\u662f\u4ecb\u7ecd\u4e86\u5982\u4f55\u6dfb\u52a0\u6027\u80fd\u5206\u6790\u5165\u53e3\u548c\u57fa\u672c\u7684\u6d41\u7a0b\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/21\u8fdb\u9636_8API_\u6027\u80fd\u5206\u6790.md", "create_date": "2020-02-18T21:37:38.443", "order": 22}}, {"model": "subject.chapter", "pk": 139, "fields": {"title": "\u8fdb\u9636 9\uff1a\u751f\u6210 Swagger \u5728\u7ebf\u6587\u6863", "topic": 6, "md5": "c5a55a14cb1dcab6afb799612bec162a", "md_body": "# \u751f\u6210 Swagger \u5728\u7ebf\u6587\u6863\n\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\n\n+ \u5982\u4f55\u7ed9 API \u6dfb\u52a0 Swagger \u6587\u6863\u529f\u80fd\n+ \u5982\u4f55\u7f16\u5199 API \u6587\u6863\n\n> \u672c\u5c0f\u8282\u6e90\u7801\u4e0b\u8f7d\u8def\u5f84\uff1a[demo17](https://github.com/lexkong/apiserver_demos/tree/master/demo17)\n>\n> \u53ef\u5148\u4e0b\u8f7d\u6e90\u7801\u5230\u672c\u5730\uff0c\u7ed3\u5408\u6e90\u7801\u7406\u89e3\u540e\u7eed\u5185\u5bb9\uff0c\u8fb9\u5b66\u8fb9\u7ec3\u3002\n>\n> \u672c\u5c0f\u8282\u7684\u4ee3\u7801\u662f\u57fa\u4e8e [demo16](https://github.com/lexkong/apiserver_demos/tree/master/demo16) \u6765\u5f00\u53d1\u7684\u3002\n\n## \u80cc\u666f\n\n\u5f00\u53d1 API \u670d\u52a1\uff0cAPI \u6587\u6863\u5fc5\u4e0d\u53ef\u5c11\uff0c\u5f88\u591a\u4eba\u9009\u62e9\u624b\u5199 API \u6587\u6863\uff0c\u624b\u5199 API \u6587\u6863\u6709\u5f88\u591a\u95ee\u9898\uff0c\u6bd4\u5982\u5de5\u4f5c\u91cf\u5927\u3001\u624b\u5199\u5bb9\u6613\u51fa\u9519\u3001\u66f4\u65b0\u9ebb\u70e6\u3001\u683c\u5f0f\u4e0d\u56fa\u5b9a\u3001\u7ef4\u62a4\u56f0\u96be\u7b49\u3002\u6240\u4ee5\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u5efa\u8bae\u81ea\u52a8\u751f\u6210 API \u6587\u6863\u3002\n\n\u672c\u5c0f\u518c\u6240\u7528\u7684 API \u670d\u52a1\u5668 RESTful \u6846\u67b6\u91c7\u7528\u7684\u662f `gin`\uff0c`gin` \u5728 GitHub \u4e0a\u6709\u5f88\u591a middleware \u53ef\u7528\uff0c\u5176\u4e2d\u5c31\u6709\u53ef\u4ee5\u81ea\u52a8\u751f\u6210 Swagger \u6587\u6863\u7684 `gin-swagger` middleware\u3002\n\n# Swagger \u7b80\u4ecb\n\nSwagger \u662f\u4e00\u4e2a\u5f3a\u5927\u7684 API \u6587\u6863\u6784\u5efa\u5de5\u5177\uff0c\u53ef\u4ee5\u81ea\u52a8\u4e3a RESTful API \u751f\u6210 Swagger \u683c\u5f0f\u7684\u6587\u6863\uff0c\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u4e2d\u67e5\u770b API \u6587\u6863\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u63a5\u53e3\u6765\u8fd4\u56de API \u6587\u6863\uff08JSON \u683c\u5f0f\uff09\u3002Swagger \u901a\u5e38\u4f1a\u5c55\u793a\u5982\u4e0b\u4fe1\u606f\uff1a\n1. HTTP \u65b9\u6cd5\uff08GET\u3001POST\u3001PUT\u3001DELETE \u7b49\uff09\n2. URL \u8def\u5f84\n3. HTTP \u6d88\u606f\u4f53\uff08\u6d88\u606f\u4f53\u4e2d\u7684\u53c2\u6570\u540d\u548c\u7c7b\u578b\uff09\n4. \u53c2\u6570\u4f4d\u7f6e\n5. \u53c2\u6570\u662f\u5426\u5fc5\u9009\n6. \u8fd4\u56de\u7684\u53c2\u6570\uff08\u53c2\u6570\u540d\u548c\u7c7b\u578b\uff09\n7. \u8bf7\u6c42\u548c\u8fd4\u56de\u7684\u5a92\u4f53\u7c7b\u578b\n\nSwagger \u8fd8\u6709\u4e00\u4e2a\u5f3a\u5927\u7684\u529f\u80fd\uff1a\u53ef\u4ee5\u901a\u8fc7 API \u6587\u6863\u63cf\u8ff0\u7684\u53c2\u6570\u6765\u6784\u5efa\u8bf7\u6c42\uff0c\u6d4b\u8bd5 API\u3002\n\n\u6d4f\u89c8\u5668\u8bbf\u95ee\u622a\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/18/1640ef86266cb60a?w=2525&h=813&f=jpeg&s=71333)\n\nJSON \u8fd4\u56de\u622a\u56fe\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/18/1640ef885d3efee4?w=2059&h=942&f=jpeg&s=98919)\n\n## Swagger \u914d\u7f6e\u6b65\u9aa4\n\n\u6211\u4eec\u7528 [gin-swagger](https://github.com/swaggo/gin-swagger) gin middleware\u6765\u751f\u6210 Swagger API \u6587\u6863\u3002\u6b65\u9aa4\u5982\u4e0b\uff1a\n\n1. \u5b89\u88c5 `swag` \u547d\u4ee4\n\n```\n$ mkdir -p $GOPATH/src/github.com/swaggo\n$ cd $GOPATH/src/github.com/swaggo\n$ git clone https://github.com/swaggo/swag\n$ cd swag/cmd/swag/\n$ go install -v\n```\n\n> \u56e0\u4e3a\u8be5\u5305\u5f15\u7528 `golang.org` \u4e2d\u7684\u5305\uff0c\u800c\u7f51\u7edc\u73af\u5883\u539f\u56e0\uff0c\u4e00\u822c\u5f88\u96be\u8fde\u4e0a `golang.org`\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u91c7\u7528 `go get` \u65b9\u5f0f\u5b89\u88c5\u3002\n>\n> swag \u7684\u4f9d\u8d56\u5305\u5df2\u7ecf\u5305\u542b\u5728\u7b2c 4 \u8282\u7684 vendor \u5305\u4e0b\u3002\n\n2. \u8fdb\u5165 apiserver \u6839\u76ee\u5f55\u6267\u884c `swag init`\n\n```\n$ cd $GOPATH/src/apiserver\n$ swag init\n```\n\n3. \u4e0b\u8f7d `gin-swagger`\n\n```\n$ cd $GOPATH/src/github.com/swaggo\n$ git clone https://github.com/swaggo/gin-swagger\n```\n\n4. \u5728 `router/router.go` \u4e2d\u6dfb\u52a0 swagger \u8def\u7531\uff08\u8be6\u89c1 [demo17/router/router.go](https://github.com/lexkong/apiserver_demos/blob/master/demo17/router/router.go)\uff09\n\n\n    ![](https://user-gold-cdn.xitu.io/2018/6/18/1640f3fac8635ff0?w=2164&h=1259&f=jpeg&s=196291)\n\n5. \u7f16\u5199 API \u6ce8\u91ca\uff0cSwagger \u4e2d\u9700\u8981\u5c06\u76f8\u5e94\u7684\u6ce8\u91ca\u6216\u6ce8\u89e3\u7f16\u5199\u5230\u65b9\u6cd5\u4e0a\uff0c\u518d\u5229\u7528\u751f\u6210\u5668\u81ea\u52a8\u751f\u6210\u8bf4\u660e\u6587\u4ef6\n\n\u8fd9\u91cc\u7528\u521b\u5efa\u7528\u6237 API \u6765\u4e3e\u4f8b\uff0c\u5176\u5b83 API \u8bf7\u53c2\u8003 [demo17/handler/user](https://github.com/lexkong/apiserver_demos/tree/master/demo17/handler/user) \u4e0b\u7684 API \u6587\u4ef6\u3002\n\n```go\npackage user\n\nimport (\n    ...\n)\n\n\n// @Summary Add new user to the database\n// @Description Add a new user\n// @Tags user\n// @Accept  json\n// @Produce  json\n// @Param user body user.CreateRequest true \"Create a new user\"\n// @Success 200 {object} user.CreateResponse \"{\"code\":0,\"message\":\"OK\",\"data\":{\"username\":\"kong\"}}\"\n// @Router /user [post]\nfunc Create(c *gin.Context) {\n    ...\n}\n\n```\n\n6. \u6267\u884c `swag init`\uff0c\u5728 apiserver \u6839\u76ee\u5f55\u4e0b\u751f\u6210 `docs` \u76ee\u5f55\n\n```\n$ swag init\n```\n\n**\u6587\u6863\u8bed\u6cd5\u8bf4\u660e**\n\n+ Summary\uff1a\u7b80\u5355\u9610\u8ff0 API \u7684\u529f\u80fd\n+ Description\uff1aAPI \u8be6\u7ec6\u63cf\u8ff0\n+ Tags\uff1aAPI \u6240\u5c5e\u5206\u7c7b\n+ Accept\uff1aAPI \u63a5\u6536\u53c2\u6570\u7684\u683c\u5f0f\n+ Produce\uff1a\u8f93\u51fa\u7684\u6570\u636e\u683c\u5f0f\uff0c\u8fd9\u91cc\u662f JSON \u683c\u5f0f\n+ Param\uff1a\u53c2\u6570\uff0c\u5206\u4e3a 6 \u4e2a\u5b57\u6bb5\uff0c\u5176\u4e2d\u7b2c 6 \u4e2a\u5b57\u6bb5\u662f\u53ef\u9009\u7684\uff0c\u5404\u5b57\u6bb5\u542b\u4e49\u4e3a\uff1a\n  1. \u53c2\u6570\u540d\u79f0\n  2. \u53c2\u6570\u5728 HTTP \u8bf7\u6c42\u4e2d\u7684\u4f4d\u7f6e\uff08body\u3001path\u3001query\uff09 \n  3. \u53c2\u6570\u7c7b\u578b\uff08string\u3001int\u3001bool \u7b49\uff09 \n  4. \u662f\u5426\u5fc5\u987b\uff08true\u3001false\uff09\n  5. \u53c2\u6570\u63cf\u8ff0\n  6. \u9009\u9879\uff0c\u8fd9\u91cc\u7528\u7684\u662f `default()` \u7528\u6765\u6307\u5b9a\u9ed8\u8ba4\u503c\n+ Success\uff1a\u6210\u529f\u8fd4\u56de\u6570\u636e\u683c\u5f0f\uff0c\u5206\u4e3a 4 \u4e2a\u5b57\u6bb5\n  1. HTTP \u8fd4\u56de Code\n  2. \u8fd4\u56de\u6570\u636e\u7c7b\u578b\n  3. \u8fd4\u56de\u6570\u636e\u6a21\u578b\n  4. \u8bf4\u660e\n+ \u8def\u7531\u683c\u5f0f\uff0c\u5206\u4e3a 2 \u4e2a\u5b57\u6bb5\uff1a \n  1. API \u8def\u5f84\n  2. HTTP \u65b9\u6cd5\n  \n> API \u6587\u6863\u7f16\u5199\u89c4\u5219\u8bf7\u53c2\u8003 [See Declarative Comments Format](https://swaggo.github.io/swaggo.io/declarative_comments_format/)\u3002\n>\n> API \u6587\u6863\u6709\u66f4\u65b0\u65f6\uff0c\u8981\u91cd\u65b0\u6267\u884c `swag init` \u5e76\u91cd\u65b0\u7f16\u8bd1 apiserver\u3002\n\n\n## \u7f16\u8bd1\u5e76\u8fd0\u884c\n\n1. \u4e0b\u8f7d apiserver_demos \u6e90\u7801\u5305\uff08\u5982\u524d\u9762\u5df2\u7ecf\u4e0b\u8f7d\u8fc7\uff0c\u8bf7\u5ffd\u7565\u6b64\u6b65\u9aa4\uff09\n\n```\n$ git clone https://github.com/lexkong/apiserver_demos\n```\n\n2. \u5c06 `apiserver_demos/demo17` \u590d\u5236\u4e3a `$GOPATH/src/apiserver`\n\n```\n$ cp -a apiserver_demos/demo17/ $GOPATH/src/apiserver\n```\n\n3. \u5728 apiserver \u76ee\u5f55\u4e0b\u7f16\u8bd1\u6e90\u7801\n\n```\n$ cd $GOPATH/src/apiserver\n$ make\n```\n\n\u6267\u884c `./apiserver` \u542f\u52a8 apiserver \u540e\uff0c\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\uff1a `http://localhost:8080/swagger/index.html` \u8bbf\u95ee Swagger 2.0 API\u6587\u6863\u3002\n\nAPI \u603b\u89c8\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/18/1640f0143a77544d?w=2514&h=1169&f=jpeg&s=121870)\n\n\u70b9\u51fb `/login`\uff0c\u67e5\u770b login API \u8be6\u60c5\uff1a\n\n![](https://user-gold-cdn.xitu.io/2018/6/6/163d0b2e58caaf13?w=1809&h=929&f=png&s=55566)\n\n## \u5c0f\u7ed3\n\n\u672c\u5c0f\u8282\u4ecb\u7ecd\u4e86\u5982\u4f55\u751f\u6210 Swagger \u6587\u6863\uff0c\u5e76\u6f14\u793a\u4e86\u5177\u4f53\u7684\u6548\u679c\u3002\u672c\u5c0f\u8282\u4e5f\u662f\u52a8\u624b\u64cd\u4f5c\u7684\u6700\u540e\u4e00\u4e2a\u5c0f\u8282\uff0c\u81f3\u6b64\u606d\u559c\u4f60\u6210\u529f\u6784\u5efa\u4e86\u4e00\u4e2a\u4f01\u4e1a\u7ea7\u7684 API \u670d\u52a1\u5668\uff0c[demo17](https://github.com/lexkong/apiserver_demos/tree/master/demo17) \u5373\u4e3a\u6b64 API \u670d\u52a1\u5668\u7684\u6700\u7ec8\u6e90\u7801\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/22\u8fdb\u9636_9\u751f\u6210_Swagger_\u5728\u7ebf\u6587\u6863.md", "create_date": "2020-02-18T21:37:38.461", "order": 23}}, {"model": "subject.chapter", "pk": 140, "fields": {"title": "\u8fdb\u9636 10\uff1aAPI \u6027\u80fd\u6d4b\u8bd5\u548c\u8c03\u4f18", "topic": 6, "md5": "edecbfe53675318a36689032615593cc", "md_body": "# API \u6027\u80fd\u6d4b\u8bd5\u548c\u8c03\u4f18\r\n\r\n## \u672c\u8282\u6838\u5fc3\u5185\u5bb9\r\n\r\n+ \u7b80\u5355\u4ecb\u7ecd API \u6027\u80fd\u6d4b\u8bd5\u77e5\u8bc6\r\n+ \u4ecb\u7ecd\u5982\u4f55\u8fdb\u884c API \u6027\u80fd\u6d4b\u8bd5\r\n+ \u7b80\u5355\u4ecb\u7ecd\u5982\u4f55\u8fdb\u884c API \u6027\u80fd\u5206\u6790\r\n+ \u7ed9\u51fa apiserver \u7684\u6027\u80fd\u6570\u636e\r\n\r\n> \u672c\u8282\u6700\u540e\u4f1a\u7ed9\u51fa\u6027\u80fd\u6d4b\u8bd5\u811a\u672c\uff1a`wrktest.sh`\uff0c\u811a\u672c\u89c1 `demo17/wrktest.sh`\r\n\r\n##  \u6027\u80fd\u6d4b\u8bd5\r\n\r\n\u5728 API \u4e0a\u7ebf\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053 API \u7684\u6027\u80fd\uff0c\u4ee5\u4fbf\u77e5\u9053 API \u670d\u52a1\u5668\u6240\u80fd\u627f\u8f7d\u7684\u6700\u5927\u8bf7\u6c42\u91cf\u3001\u6027\u80fd\u74f6\u9888\uff0c\u518d\u6839\u636e\u4e1a\u52a1\u7684\u9700\u6c42\u91cf\u6765\u5bf9 API \u8fdb\u884c\u6027\u80fd\u8c03\u4f18\u6216\u8005\u6269\u7f29\u5bb9\u3002\u901a\u8fc7\u8fd9\u4e9b\u53ef\u4ee5\u4f7f API \u7a33\u5b9a\u5730\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5e76\u4e14\u8bf7\u6c42\u5728\u5408\u7406\u7684\u65f6\u95f4\u5185\u8fd4\u56de\u3002\r\n\r\n## API \u6027\u80fd\u6d4b\u8bd5\u6307\u6807\r\n\r\nAPI \u6027\u80fd\u6d4b\u8bd5\uff0c\u5927\u7684\u65b9\u9762\u5305\u62ec API \u6846\u67b6\u7684\u6027\u80fd\u548c\u6307\u5b9a API \u7684\u6027\u80fd\uff0c\u56e0\u4e3a\u6307\u5b9a API \u7684\u6027\u80fd\u8ddf\u8be5 API \u5177\u4f53\u7684\u5b9e\u73b0\u6709\u5173\uff0c\u6bd4\u5982\u6709\u65e0\u6570\u636e\u5e93\u8fde\u63a5\uff0c\u6709\u65e0\u590d\u6742\u7684\u903b\u8f91\u5904\u7406\u7b49\uff0c\u8131\u79bb\u4e86\u5177\u4f53\u5b9e\u73b0\u6765\u63a2\u8ba8\u5355\u4e2a API \u7684\u6027\u80fd\u662f\u6beb\u65e0\u610f\u4e49\u7684\uff0c\u6240\u4ee5\u672c\u5c0f\u8282\u53ea\u63a2\u8ba8 API \u6846\u67b6\u7684\u6027\u80fd\u3002\r\n\r\n\u8861\u91cf API \u6027\u80fd\u7684\u6307\u6807\u4e3b\u8981\u6709 3 \u4e2a\uff1a\r\n\r\n1. \u5e76\u53d1\u6570\uff08Concurrent\uff09\r\n\r\n    \u5e76\u53d1\u6570\u662f\u6307\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185\uff0c\u540c\u65f6\u6b63\u5728\u4f7f\u7528\u7cfb\u7edf\u7684\u7528\u6237\u4e2a\u6570\u3002\r\n\r\n    \u5e7f\u4e49\u4e0a\u7684\u5e76\u53d1\u6570\u662f\u6307\u540c\u65f6\u4f7f\u7528\u7cfb\u7edf\u7684\u7528\u6237\u4e2a\u6570\uff0c\u8fd9\u4e9b\u7528\u6237\u53ef\u80fd\u8c03\u7528\u4e0d\u540c\u7684 API\u3002\u4e25\u683c\u610f\u4e49\u4e0a\u7684\u5e76\u53d1\u6570\u662f\u6307\u540c\u65f6\u8bf7\u6c42\u540c\u4e00\u4e2a API \u7684\u7528\u6237\u4e2a\u6570\u3002\u672c\u5c0f\u8282\u6240\u8ba8\u8bba\u7684\u5e76\u53d1\u6570\u662f\u4e25\u683c\u610f\u4e49\u4e0a\u7684\u5e76\u53d1\u6570\u3002\r\n\r\n2. \u6bcf\u79d2\u67e5\u8be2\u6570\uff08QPS\uff09\r\n\r\n    \u6bcf\u79d2\u67e5\u8be2\u6570 QPS \u662f\u5bf9\u4e00\u4e2a\u7279\u5b9a\u7684\u67e5\u8be2\u670d\u52a1\u5668\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u6240\u5904\u7406\u6d41\u91cf\u591a\u5c11\u7684\u8861\u91cf\u6807\u51c6\u3002\r\n    \r\n    QPS = \u5e76\u53d1\u6570 / \u5e73\u5747\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u3002\r\n\r\n3. \u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\uff08TTLB\uff09\r\n\r\n    \u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u6307\u7684\u662f\u4ece\u5ba2\u6237\u7aef\u53d1\u51fa\u8bf7\u6c42\u5230\u5f97\u5230\u54cd\u5e94\u7684\u6574\u4e2a\u65f6\u95f4\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4ece\u5ba2\u6237\u7aef\u53d1\u8d77\u7684\u4e00\u4e2a\u8bf7\u6c42\u5f00\u59cb\uff0c\u5230\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u7aef\u7684\u54cd\u5e94\u7ed3\u675f\u3002\u5728\u4e00\u4e9b\u5de5\u5177\u4e2d\uff0c\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u901a\u5e38\u4f1a\u88ab\u79f0\u4e3a TTLB\uff08Time to last byte\uff0c\u610f\u601d\u662f\u4ece\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u5f00\u59cb\uff0c\u5230\u5ba2\u6237\u7aef\u6536\u5230\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u7684\u54cd\u5e94\u4e3a\u6b62\u6240\u6d88\u8d39\u7684\u65f6\u95f4\uff09\u3002\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u7684\u5355\u4f4d\u4e00\u822c\u4e3a\"\u79d2\u201d\u6216\u201c\u6beb\u79d2\u201d\u3002\r\n\r\n\u8861\u91cf API \u6027\u80fd\u7684\u6700\u4e3b\u8981\u6307\u6807\u662f QPS\uff0c\u4f46\u662f\u5728\u8bf4\u660e QPS \u65f6\uff0c\u9700\u8981\u6307\u660e\u662f\u591a\u5c11\u5e76\u53d1\u6570\u4e0b\u7684 QPS\uff0c\u5426\u5219\u6beb\u65e0\u610f\u4e49\uff0c\u56e0\u4e3a\u4e0d\u540c\u5e76\u53d1\u6570\u4e0b\u7684 QPS \u662f\u4e0d\u540c\u7684\u3002\u6bd4\u5982\u5355\u7528\u6237 100 QPS \u548c 100 \u7528\u6237 100 QPS \u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u6982\u5ff5\uff0c\u524d\u8005\u8bf4\u660e API \u53ef\u4ee5\u5728\u4e00\u79d2\u5185\u4e32\u884c\u6267\u884c 100 \u4e2a\u8bf7\u6c42\uff0c\u800c\u540e\u8005\u8bf4\u660e\u5728\u5e76\u53d1\u6570\u4e3a 100 \u7684\u60c5\u51b5\u4e0b\uff0cAPI \u53ef\u4ee5\u5728\u4e00\u79d2\u5185\u5904\u7406 100 \u4e2a\u8bf7\u6c42\u3002\u5f53 QPS \u76f8\u540c\u65f6\uff0c\u5e76\u53d1\u6570\u8d8a\u5927\uff0c\u8bf4\u660e API \u6027\u80fd\u8d8a\u597d\uff0c\u5e76\u53d1\u5904\u7406\u80fd\u529b\u8d8a\u5f3a\u3002\r\n\r\n\u5728\u5e76\u53d1\u6570\u8bbe\u7f6e\u8fc7\u5927\u65f6\uff0cAPI \u540c\u65f6\u8981\u5904\u7406\u5f88\u591a\u8bf7\u6c42\uff0c\u4f1a\u9891\u7e41\u5207\u6362\u8fdb\u7a0b\uff0c\u800c\u771f\u6b63\u7528\u4e8e\u5904\u7406\u8bf7\u6c42\u7684\u65f6\u95f4\u53d8\u5c11\uff0c\u4f7f\u5f97 QPS \u53cd\u800c\u4f1a\u964d\u4f4e\u3002\u5e76\u53d1\u6570\u8bbe\u7f6e\u8fc7\u5927\u65f6\uff0c\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u4e5f\u4f1a\u53d8\u5927\u3002API \u4f1a\u6709\u4e00\u4e2a\u5408\u9002\u7684\u5e76\u53d1\u6570\uff0c\u5728\u8be5\u5e76\u53d1\u6570\u4e0b\uff0cAPI \u7684 QPS \u53ef\u4ee5\u8fbe\u5230\u6700\u5927\uff0c\u4f46\u8be5\u5e76\u53d1\u6570\u4e0d\u4e00\u5b9a\u662f\u6700\u4f73\u5e76\u53d1\u6570\uff0c\u8fd8\u8981\u53c2\u8003\u8be5\u5e76\u53d1\u6570\u4e0b\u7684\u5e73\u5747\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u3002\r\n\r\n## API \u6027\u80fd\u6d4b\u8bd5\u65b9\u6cd5\r\n\r\nLinux \u4e0b\u6709\u5f88\u591a Web \u6027\u80fd\u6d4b\u8bd5\u5de5\u5177\uff0c\u5e38\u7528\u7684\u6709 Jmeter\u3001AB\u3001Webbench \u548c Wrk\u3002\u6bcf\u4e2a\u5de5\u5177\u90fd\u6709\u81ea\u5df1\u7684\u7279\u70b9\uff0c\u672c\u5c0f\u8282\u7528 Wrk \u6765\u5bf9 API \u8fdb\u884c\u6027\u80fd\u6d4b\u8bd5\u3002Wrk \u975e\u5e38\u7b80\u5355\uff0c\u5b89\u88c5\u65b9\u4fbf\uff0c\u6d4b\u8bd5\u7ed3\u679c\u4e5f\u76f8\u5bf9\u4e13\u4e1a\u4e9b\uff0c\u5e76\u4e14\u53ef\u4ee5\u652f\u6301 Lua \u811a\u672c\u6765\u521b\u5efa\u66f4\u590d\u6742\u7684\u6d4b\u8bd5\u573a\u666f\u3002\r\n\r\n### Wrk \u5b89\u88c5\r\n\r\n\u5b89\u88c5\u6b65\u9aa4\u5982\u4e0b\uff08\u9700\u8981\u5207\u6362\u5230 root \u7528\u6237\uff09\uff1a\r\n\r\n1. Clone wrk repo\r\n\r\n```\r\ngit clone https://github.com/wg/wrk\r\n```\r\n\r\n2. \u6267\u884c `make`\u548c `make install` \u5b89\u88c5\r\n\r\n```\r\nmake\r\ncp ./wrk /usr/bin\r\n```\r\n\r\n### Wrk \u4f7f\u7528\u7b80\u4ecb\r\n\r\n**Wrk \u4f7f\u7528\u65b9\u6cd5**\r\n\r\nWrk \u4f7f\u7528\u8d77\u6765\u4e0d\u590d\u6742\uff0c\u6267\u884c `wrk --help` \u53ef\u4ee5\u770b\u5230 wrk \u7684\u6240\u6709\u8fd0\u884c\u53c2\u6570\uff1a\r\n\r\n```\r\n$ wrk --help\r\nUsage: wrk <options> <url>\r\n  Options:\r\n    -c, --connections <N>  Connections to keep open\r\n    -d, --duration    <T>  Duration of test\r\n    -t, --threads     <N>  Number of threads to use\r\n\r\n    -s, --script      <S>  Load Lua script file\r\n    -H, --header      <H>  Add header to request\r\n        --latency          Print latency statistics\r\n        --timeout     <T>  Socket/request timeout\r\n    -v, --version          Print version details\r\n\r\n  Numeric arguments may include a SI unit (1k, 1M, 1G)\r\n  Time arguments may include a time unit (2s, 2m, 2h)\r\n```\r\n\r\n\u5e38\u7528\u7684\u53c2\u6570\u4e3a\uff1a\r\n\r\n+ `-t`: \u7ebf\u7a0b\u6570\uff08\u7ebf\u7a0b\u6570\u4e0d\u8981\u592a\u591a\uff0c\u662f\u6838\u6570\u7684 2 \u5230 4 \u500d\u5373\u53ef\uff0c\u591a\u4e86\u53cd\u800c\u4f1a\u56e0\u4e3a\u7ebf\u7a0b\u5207\u6362\u8fc7\u591a\u9020\u6210\u6548\u7387\u964d\u4f4e\uff09\r\n+ `-c`: \u5e76\u53d1\u6570\r\n+ `-d`: \u6d4b\u8bd5\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a 10s\r\n+ `-T`: \u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\r\n+ `-H`: \u6307\u5b9a\u8bf7\u6c42\u7684 HTTP Header\uff0c\u6709\u4e9b API \u9700\u8981\u4f20\u5165\u4e00\u4e9b Header\uff0c\u53ef\u901a\u8fc7 Wrk \u7684 `-H` \u53c2\u6570\u6765\u4f20\u5165\r\n+ `--latency`: \u6253\u5370\u54cd\u5e94\u65f6\u95f4\u5206\u5e03\r\n+ `-s`: \u6307\u5b9a Lua \u811a\u672c\uff0cLua \u811a\u672c\u53ef\u4ee5\u5b9e\u73b0\u66f4\u590d\u6742\u7684\u8bf7\u6c42\r\n\r\n**Wrk \u7ed3\u679c\u89e3\u6790**\r\n\r\n\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u5982\u4e0b\uff1a\r\n\r\n```\r\n$ wrk -t144 -c3000 -d30s -T30s --latency http://127.0.0.1:8080/sd/health\r\nRunning 30s test @ http://127.0.0.1:8088/sd/health\r\n  144 threads and 3000 connections\r\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\r\n    Latency    32.01ms   39.32ms 488.62ms   87.93%\r\n    Req/Sec     1.00k   251.79     3.35k    69.00%\r\n  Latency Distribution\r\n     50%   25.05ms\r\n     75%   55.36ms\r\n     90%   78.45ms\r\n     99%  166.76ms\r\n  4329733 requests in 30.10s, 1.81GB read\r\n  Socket errors: connect 0, read 5, write 0, timeout 64\r\nRequests/sec: 143850.26\r\nTransfer/sec:     61.46MB\r\n```\r\n\r\n+ `144 threads and 3000 connections`: \u7528 144 \u4e2a\u7ebf\u7a0b\u6a21\u62df 3000 \u4e2a\u8fde\u63a5\uff0c\u5206\u522b\u5bf9\u5e94 `-t` \u548c `-c` \u53c2\u6570\r\n+ `Thread Stats`\uff1a \u7ebf\u7a0b\u7edf\u8ba1\r\n\t+ `Latency`: \u54cd\u5e94\u65f6\u95f4\uff0c\u6709\u5e73\u5747\u503c\u3001\u6807\u51c6\u504f\u5dee\u3001\u6700\u5927\u503c\u3001\u6b63\u8d1f\u4e00\u4e2a\u6807\u51c6\u5dee\u5360\u6bd4\r\n\t+ `Req/Sec`: \u6bcf\u4e2a\u7ebf\u7a0b\u6bcf\u79d2\u5b8c\u6210\u7684\u8bf7\u6c42\u6570, \u540c\u6837\u6709\u5e73\u5747\u503c\u3001\u6807\u51c6\u504f\u5dee\u3001\u6700\u5927\u503c\u3001\u6b63\u8d1f\u4e00\u4e2a\u6807\u51c6\u5dee\u5360\u6bd4\r\n+ `Latency Distribution`: \u54cd\u5e94\u65f6\u95f4\u5206\u5e03\r\n\t+ `50%`: 50% \u7684\u54cd\u5e94\u65f6\u95f4\u4e3a\uff1a4.74ms\r\n\t+ `75%`: 75% \u7684\u54cd\u5e94\u65f6\u95f4\u4e3a\uff1a23.42ms\r\n\t+ `90%`: 90% \u7684\u54cd\u5e94\u65f6\u95f4\u4e3a\uff1a82.88ms\r\n\t+ `99%`: 99% \u7684\u54cd\u5e94\u65f6\u95f4\u4e3a\uff1a236.39ms\r\n+ `19373531 requests in 30.10s, 1.35GB read`: 30s \u5b8c\u6210\u7684\u603b\u8bf7\u6c42\u6570\uff0819373531\uff09\u548c\u6570\u636e\u8bfb\u53d6\u91cf\uff081.35GB\uff09\r\n+ `Socket errors: connect 0, read 5, write 0, timeout 64`: \u9519\u8bef\u7edf\u8ba1\r\n+ `Requests/sec`: QPS\r\n+ `Transfer/sec`: TPS\r\n\r\n## apiserver \u7b2c\u4e00\u6b21\u6027\u80fd\u6d4b\u8bd5\r\n\r\n> \u6d4b\u8bd5\u670d\u52a1\u5668\u914d\u7f6e\uff1a6 \u6838 12G\r\n\r\n\u5728 apiserver \u4e2d\uff0cGin middleware\uff1a `Logging` \u4f1a\u8bb0\u5f55\u8bf7\u6c42\u53c2\u6570\u548c\u8fd4\u56de\u53c2\u6570\uff0c\u8be5 middleare \u5f88\u6d88\u8017\u6027\u80fd\uff0c\u4e3a\u4e86\u6d4b\u8bd5\u6846\u67b6\u7684\u6027\u80fd\uff0c\u8fd9\u91cc\u6682\u65f6\u5c06\u8be5 middleware \u7981\u6389\uff0c\u5728 main.go \u51fd\u6570\u4e2d\u5c06 `middleware.Logging()` \u4e00\u884c\u6ce8\u91ca\u6389\uff0c\u5982\u56fe\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/24/164312436d105b7b?w=2003&h=616&f=png&s=32255)\r\n\r\n\u7f16\u8bd1\u5e76\u8fd0\u884c `apiserver`\r\n\r\n```\r\n$ make\r\n$ ./apiserver\r\n```\r\n\r\n\u6267\u884c wrk \u547d\u4ee4\u6d4b\u8bd5 API \u6027\u80fd\uff08\u5206\u522b\u6d4b\u8bd5\u591a\u4e2a\u5e76\u53d1\u6570\uff1a`200 500 1000 3000 5000 10000 15000 20000 25000 50000 100000 200000 500000 1000000`\uff09\r\n\r\n```\r\n$ wrk --latency -t144 -d60s -T300s http://127.0.0.1:8080/sd/health -c 200\r\n```\r\n\r\n> \u8c03\u7528 `apiserver` \u7684\u5065\u5eb7\u68c0\u67e5\u63a5\u53e3\uff1a`/sd/health`\r\n\r\n\u6839\u636e\u6d4b\u8bd5\u6570\u636e\u7ed8\u5236\u51fa QPS & TTLB \u56fe\u548c\u6210\u529f\u7387\u56fe\uff1a\r\n\r\n**QPS & \u5e73\u5747\u54cd\u5e94\u65f6\u95f4:**\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/24/164326289814ddd1?w=640&h=480&f=png&s=6393)\r\n\r\n**\u6210\u529f\u7387**\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/24/1643263075791269?w=640&h=480&f=png&s=3913)\r\n\r\n\u901a\u8fc7\u4e0a\u9762\u4e8c\u56fe\u53ef\u4ee5\u770b\u5230\uff0capiserver \u5728\u5e76\u53d1\u6570\u4e3a 5000 \u65f6\uff0cQPS \u6700\u5927\uff0c\u4e3a 146953\uff0c\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\u4e3a 52.75ms\uff0c\u5728\u5e76\u53d1\u6570\u8fbe\u5230 50000 \u65f6\uff0c\u6210\u529f\u7387\u5f00\u59cb\u4e0b\u964d\u3002\r\n\r\n\u90a3\u4e48\u8be5 apiserver \u7684 QPS \u5904\u4e8e\u4ec0\u4e48\u6c34\u5e73\u5462\uff1f\u4e00\u65b9\u9762\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u9700\u8981\u6765\u5bf9\u6bd4\uff0c\u53e6\u4e00\u65b9\u9762\u53ef\u4ee5\u5bf9\u6bd4\u6027\u80fd\u66f4\u597d\u7684 Web \u6846\u67b6\u3002\u8fd9\u91cc\u7528 `net/http` \u6784\u5efa\u6700\u7b80\u5355\u7684 HTTP \u670d\u52a1\u5668\uff0c\u6d4b\u8bd5\u6027\u80fd\u5e76\u4f5c\u5bf9\u6bd4\uff08\u76f8\u540c\u7684\u6d4b\u8bd5\u5de5\u5177\u548c\u6d4b\u8bd5\u670d\u52a1\u5668\uff09\uff0cHTTP \u670d\u52a1\u6e90\u7801\u4e3a\uff1a\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"fmt\"\r\n\t\"log\"\r\n\t\"net/http\"\r\n)\r\n\r\nfunc main() {\r\n\thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\r\n\t\tmessage := \"OK\"\r\n\t\tfmt.Fprintln(w, \"\\n\"+message)\r\n\t})\r\n\r\n\tlog.Fatal(http.ListenAndServe(\":6667\", nil))\r\n}\r\n```\r\n\r\n\u53ef\u4ee5\u770b\u5230\u8be5 HTTP \u670d\u52a1\u5668\u5f88\u7b80\u5355\uff0c\u53ea\u662f\u5229\u7528 `net/http` \u5305\u6700\u539f\u751f\u7684\u529f\u80fd\uff0c\u5728 Go \u4e2d\u51e0\u4e4e\u6240\u6709\u7684 Web \u6846\u67b6\u90fd\u662f\u57fa\u4e8e `net/http` \u5305\u5c01\u88c5\u7684\uff0c\u65e2\u7136\u662f\u5c01\u88c5\uff0c\u76f8\u5bf9\u4e8e\u539f\u751f\u7684\u6027\u80fd\u80af\u5b9a\u6709\u6240\u4e0d\u53ca\uff0c\u6240\u4ee5\u8fd9\u91cc\u62ff `net/http` \u76f4\u63a5\u542f\u52a8\u7684 HTTP \u670d\u52a1\u5668\u6765\u505a\u5bf9\u6bd4\uff0c\u5bf9\u6bd4\u7ed3\u679c\u5982\u4e0b\uff1a\r\n\r\n**QPS & \u5e73\u5747\u54cd\u5e94\u65f6\u95f4\u5bf9\u6bd4**\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/24/164326abb2c45da8?w=640&h=480&f=png&s=7104)\r\n\r\n**\u6210\u529f\u7387\u5bf9\u6bd4**\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/24/164326adde2e5c40?w=640&h=480&f=png&s=3997)\r\n\r\n\u901a\u8fc7\u4e0a\u9762\u4e24\u4e2a\u5bf9\u6bd4\u56fe\u53ef\u4ee5\u770b\u51fa\uff0capiserver \u5728 QPS\u3001\u54cd\u5e94\u65f6\u95f4\u548c\u6210\u529f\u7387\u4e0a\u90fd\u4e0d\u5982\u539f\u751f\u7684 HTTP Server\uff0c\u7279\u522b\u662f QPS\uff0c\u6700\u5927 QPS \u53ea\u6709\u539f\u751f HTTP Server \u6700\u5927 QPS \u7684 22%\uff0c\u6027\u80fd\u9700\u8981\u8c03\u4f18\u3002\r\n\r\n> \u770b\u5230\u9700\u8981\u7ed8\u56fe\uff0c\u662f\u4e0d\u662f\u89c9\u5f97\u6709\u70b9\u9ebb\u70e6\uff0c\u4e0d\u614c\uff0c\u7b14\u8005\u6700\u540e\u4f1a\u5949\u4e0a\u81ea\u52a8\u5316\u6d4b\u8bd5\u811a\u672c\uff0c\u8be5\u811a\u672c\u4f1a\u81ea\u52a8\u89e3\u6790 wrk \u7ed3\u679c\u5e76\u751f\u6210\u9700\u8981\u7684\u56fe\u8868\u3002\r\n\r\n## apiserver \u6027\u80fd\u5206\u6790\r\n\r\n> API \u6027\u80fd\u5206\u6790\u6d89\u53ca\u7684\u8303\u56f4\u6bd4\u8f83\u5e7f\uff0c\u672c\u5c0f\u8282\u4e0d\u662f\u4e13\u95e8\u6559\u8bfb\u8005\u5982\u4f55\u8fdb\u884c\u8be6\u7ec6\u7684\u6027\u80fd\u5206\u6790\u7684\u6559\u7a0b\uff0c\u8fd9\u91cc\u4ec5\u4ec5\u5c55\u793a\u6027\u80fd\u5206\u6790\u7684\u6b65\u9aa4\u548c\u57fa\u672c\u601d\u8def\u3002\r\n\r\n\u5728\u6267\u884c\u6027\u80fd\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd0\u884c `go tool pprof http://127.0.0.1:8080/debug/pprof/profile`\uff0c\u91c7\u96c6 30s \u7684\u6027\u80fd\u6570\u636e\u5e76\u67e5\u770b\u8017\u65f6\u6bd4\u8f83\u4e45\u7684 20 \u4e2a\u51fd\u6570\uff1a\r\n\r\n```\r\n(pprof) top20\r\nShowing nodes accounting for 1.57mins, 52.96% of 2.97mins total\r\nDropped 510 nodes (cum <= 0.01mins)\r\nShowing top 20 nodes out of 199\r\n      flat  flat%   sum%        cum   cum%\r\n  0.37mins 12.35% 12.35%   0.37mins 12.35%  runtime.futex\r\n  0.28mins  9.49% 21.84%   0.30mins 10.02%  syscall.Syscall\r\n  0.12mins  4.10% 25.95%   0.30mins 10.27%  runtime.lock\r\n  0.12mins  4.09% 30.04%   0.30mins 10.05%  runtime.mallocgc\r\n  0.12mins  3.98% 34.02%   0.12mins  3.98%  runtime.epollwait\r\n  0.09mins  2.94% 36.96%   0.09mins  2.94%  runtime.usleep\r\n  0.08mins  2.74% 39.70%   0.96mins 32.43%  runtime.findrunnable\r\n  0.06mins  2.01% 41.71%   0.15mins  4.94%  runtime.runqgrab\r\n  0.04mins  1.31% 43.03%   0.04mins  1.31%  runtime.memmove\r\n  0.03mins  1.14% 44.17%   0.03mins  1.14%  runtime.heapBitsSetType\r\n  0.03mins  1.12% 45.29%   0.07mins  2.20%  runtime.scanobject\r\n  0.03mins  1.07% 46.36%   0.03mins  1.07%  runtime.procyield\r\n  0.03mins  1.03% 47.39%   0.03mins  1.03%  crypto/sha256.block\r\n  0.03mins  0.98% 48.38%   0.26mins  8.66%  runtime.unlock\r\n  0.03mins  0.88% 49.26%   0.03mins  0.88%  runtime.greyobject\r\n  0.02mins  0.82% 50.08%   0.02mins  0.82%  runtime.osyield\r\n  0.02mins  0.76% 50.84%   0.02mins  0.76%  runtime.runqempty\r\n  0.02mins  0.72% 51.56%   0.03mins  0.92%  runtime.step\r\n  0.02mins  0.71% 52.27%   0.05mins  1.54%  runtime.mapassign_faststr\r\n  0.02mins  0.69% 52.96%   0.14mins  4.73%  runtime.netpoll\r\n```\r\n\r\n\u5728 [go tool pprof](https://github.com/hyper0x/go_command_tutorial/blob/master/0.12.md) \u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ctop \u547d\u4ee4\u8f93\u51fa\u7684\u5217\u8868\u4e2d\u53ea\u5305\u542b\u672c\u5730\u53d6\u6837\u8ba1\u6570\u6700\u5927\u7684\u524d\u5341\u4e2a\u51fd\u6570\uff0c\u7edf\u8ba1\u7684\u662f\u8fd9\u4e9b\u51fd\u6570\u672c\u8eab\u8fd0\u884c\u7684\u6267\u884c\u65f6\u95f4\uff0c\u5b9e\u9645\u4e0a\u6211\u4eec\u8fd8\u9700\u8981\u77e5\u9053\uff0c\u51fd\u6570\u4e2d\u6709\u6ca1\u6709\u8c03\u7528\u8017\u65f6\u7684\u51fd\u6570\u4ee5\u53ca\u6267\u884c\u5176\u5b83\u51fd\u6570\u6240\u8017\u8d39\u7684\u65f6\u95f4\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u9700\u8981\u6309\u7d2f\u79ef\u53d6\u6837\u8ba1\u6570\u6765\u6392\u5e8f\uff0c\u8fd9\u5728 pprof \u4e2d\u9700\u8981\u52a0\u4e0a `-cum` \u53c2\u6570\uff1a\r\n\r\n```\r\n(pprof) top -cum\r\nShowing nodes accounting for 6.38s, 3.58% of 178.08s total\r\nDropped 510 nodes (cum <= 0.89s)\r\nShowing top 10 nodes out of 199\r\n      flat  flat%   sum%        cum   cum%\r\n     0.31s  0.17%  0.17%    104.25s 58.54%  net/http.(*conn).serve\r\n     0.08s 0.045%  0.22%     63.81s 35.83%  net/http.serverHandler.ServeHTTP\r\n     0.09s 0.051%  0.27%     63.73s 35.79%  vendor/github.com/gin-gonic/gin.(*Engine).ServeHTTP\r\n     0.15s 0.084%  0.35%     63.08s 35.42%  vendor/github.com/gin-gonic/gin.(*Engine).handleHTTPRequest\r\n     0.09s 0.051%   0.4%     60.25s 33.83%  runtime.mcall\r\n     0.22s  0.12%  0.53%     59.60s 33.47%  vendor/github.com/gin-gonic/gin.(*Context).Next\r\n     0.04s 0.022%  0.55%     59.58s 33.46%  vendor/github.com/gin-gonic/gin.RecoveryWithWriter.func1\r\n     0.50s  0.28%  0.83%     59.20s 33.24%  runtime.schedule\r\n     0.02s 0.011%  0.84%     59.16s 33.22%  apiserver/router/middleware.NoCache\r\n     4.88s  2.74%  3.58%     57.76s 32.43%  runtime.findrunnable\r\n    ....\r\n```\r\n> \u4e3a\u4e86\u80fd\u591f\u67e5\u770b\u5230\u6240\u6709\u51fd\u6570\u7684\u8017\u65f6\u6392\u540d\uff0c\u4f60\u9700\u8981\u5217\u51fa\u66f4\u591a\u7684\u51fd\u6570\uff08\u672c\u5c0f\u8282\u5217\u51fa\u4e86 top100\uff09\u3002\r\n\r\n\u5982\u679c\u4f60\u5bf9\u4ee3\u7801\u5f88\u719f\u6089\uff0c\u901a\u8fc7\u6700\u540e\u4e00\u5217\u7684\u51fd\u6570\u540d\uff0c\u4f60\u5e94\u8be5\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7a0b\u5e8f\u4e2d\u6240\u8c03\u7528\u51fd\u6570\u7684\u4f4d\u7f6e\uff0c\u5e76\u8fdb\u884c\u4f18\u5316\u3002\u56e0\u4e3a top100 \u5185\u5bb9\u8fc7\u591a\uff0c\u8fd9\u91cc\u7b5b\u9009\u7a0b\u5e8f\u4e2d\u6240\u8c03\u7528\u7684\u51fd\u6570\uff08\u987a\u5e8f\u4e0d\u53d8\uff09\u3002\r\n\r\n```\r\nShowing nodes accounting for 67.31s, 37.80% of 178.08s total\r\nDropped 510 nodes (cum <= 0.89s)\r\nShowing top 50 nodes out of 199\r\n      flat  flat%   sum%        cum   cum%\r\n     0.31s  0.17%  0.17%    104.25s 58.54%  net/http.(*conn).serve\r\n     0.08s 0.045%  0.22%     63.81s 35.83%  net/http.serverHandler.ServeHTTP\r\n     0.09s 0.051%  0.27%     63.73s 35.79%  vendor/github.com/gin-gonic/gin.(*Engine).ServeHTTP\r\n     0.15s 0.084%  0.35%     63.08s 35.42%  vendor/github.com/gin-gonic/gin.(*Engine).handleHTTPRequest\r\n     0.09s 0.051%   0.4%     60.25s 33.83%  runtime.mcall\r\n     0.22s  0.12%  0.53%     59.60s 33.47%  vendor/github.com/gin-gonic/gin.(*Context).Next\r\n     0.04s 0.022%  0.55%     59.58s 33.46%  vendor/github.com/gin-gonic/gin.RecoveryWithWriter.func1\r\n     0.50s  0.28%  0.83%     59.20s 33.24%  runtime.schedule\r\n     0.02s 0.011%  0.84%     59.16s 33.22%  apiserver/router/middleware.NoCache\r\n     4.88s  2.74%  3.58%     57.76s 32.43%  runtime.findrunnable\r\n     0.05s 0.028%  3.61%     56.76s 31.87%  runtime.park_m\r\n     0.05s 0.028%  3.64%     56.72s 31.85%  apiserver/router/middleware.Options\r\n     0.06s 0.034%  3.67%     55.32s 31.06%  apiserver/router/middleware.RequestId.func1\r\n     0.07s 0.039%  3.71%     51.34s 28.83%  apiserver/router/middleware.AuthMiddleware.func1\r\n     0.11s 0.062%  3.77%     51.17s 28.73%  apiserver/pkg/token.ParseRequest\r\n     0.05s 0.028%  3.80%     26.59s 14.93%  apiserver/pkg/token.Parse\r\n     0.07s 0.039%  3.84%     26.12s 14.67%  vendor/github.com/dgrijalva/jwt-go.Parse\r\n     0.10s 0.056%  3.90%     26.05s 14.63%  vendor/github.com/dgrijalva/jwt-go.(*Parser).Parse\r\n     0.29s  0.16%  4.06%     25.84s 14.51%  vendor/github.com/dgrijalva/jwt-go.(*Parser).ParseWithClaims\r\n     ...\r\n     0.05s 0.028% 36.28%     11.08s  6.22%  vendor/github.com/spf13/viper.GetString\r\n     0.02s 0.011% 36.29%     11.03s  6.19%  vendor/github.com/spf13/viper.(*Viper).GetString\r\n     0.12s 0.067% 36.36%     10.92s  6.13%  vendor/github.com/spf13/viper.(*Viper).Get\r\n```\r\n\r\n\u4ece\u4e0a\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053 apiserver \u4e2d\u51fd\u6570\u8017\u65f6\u6392\u540d\u5982\u4e0b\uff1a\r\n\r\n1. `apiserver/router/middleware.NoCache`: Gin middleware\uff0c\u5f3a\u5236\u6d4f\u89c8\u5668\u4e0d\u4f7f\u7528\u7f13\u5b58\r\n2. `apiserver/router/middleware.Options`: Gin middleware\uff0c\u8de8\u57df\u8bbe\u7f6e\r\n3. `apiserver/router/middleware.RequestId.func1`: Gin middleware\uff0c\u8bb0\u5f55 RequestId\r\n4. `apiserver/router/middleware.AuthMiddleware.func1`: Gin middleware\uff0cJWT \u8ba4\u8bc1\r\n5. `apiserver/pkg/token.ParseRequest`: Token \u529f\u80fd\uff0cJWT \u8ba4\u8bc1\u76f8\u5173\r\n6. `apiserver/pkg/token.Parse`: Token \u529f\u80fd\uff0cJWT \u8ba4\u8bc1\u76f8\u5173\r\n7. `vendor/github.com/dgrijalva/jwt-go.Parse`: Token \u529f\u80fd\uff0cJW \u8ba4\u8bc1\u76f8\u5173\r\n8. `vendor/github.com/dgrijalva/jwt-go.(*Parser).Parse`: Token \u529f\u80fd\uff0cJWT \u8ba4\u8bc1\u76f8\u5173\r\n9. `vendor/github.com/dgrijalva/jwt-go.(*Parser).ParseWithClaims`: Token \u529f\u80fd\uff0cJWT \u8ba4\u8bc1\u76f8\u5173\r\n10. `vendor/github.com/spf13/viper.GetString`:  `pkg/token/token.go` \u4e2d\u83b7\u53d6 jwt_secret \u7684\u503c\r\n11. `vendor/github.com/spf13/viper.(*Viper).GetString`: `pkg/token/token.go` \u4e2d\u83b7\u53d6 jwt_secret \u7684\u503c\r\n12. `vendor/github.com/spf13/viper.(*Viper).Get`: `pkg/token/token.go`\u4e2d\u83b7\u53d6 jwt_secret \u7684\u503c\r\n\r\n\u4e0a\u9762\u7684\u5217\u8868\u4e2d\u53ef\u4ee5\u770b\u5230\u6709 ServeHTTP \u5b57\u6837\u7684\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u662f gin/http \u81ea\u5e26\u7684\u51fd\u6570\uff0c\u9700\u8981\u7684\u51fd\u6570\uff0c\u65e0\u6cd5\u8fdb\u884c\u4f18\u5316\uff0c\u6240\u4ee5\u4e0a\u8ff0\u5217\u8868\u6ca1\u6709\u5217\u51fa\u3002\u53ef\u4ee5\u770b\u5230\u4e3b\u8981\u662f Gin middleware \u8017\u65f6\u8f83\u4e45\uff0c\u8fd9\u91cc\u5904\u7406\u65b9\u6cd5\u662f\u5220\u9664\u4e0d\u9700\u8981\u7684 Gin middleware\uff0c\u5220\u9664 Middleware \u5982\u4e0b\uff1a\r\n\r\n1. middleware.RequestId\uff08main.go \u6587\u4ef6\u4e2d\uff09\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/25/164328b7f9edba30?w=1542&h=394&f=png&s=17332)\r\n\r\n2. middleware.NoCache \u548c middleware.Options\uff08router/router.go \u6587\u4ef6\u4e2d\uff09\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/25/164328ba8751e252?w=1834&h=492&f=png&s=44737)\r\n\r\n\r\n\u5220\u9664\u65e0\u7528\u7684 Gin middleware \u91cd\u65b0\u7f16\u8bd1 apiserver\uff0c\u542f\u52a8 apiserver\uff0c\u6d4b\u8bd5\u6027\u80fd\u540e\uff0c\u518d\u8ddf\u539f\u751f\u7684 HTTP Server \u5bf9\u6bd4\uff0c\u7ed3\u679c\u5982\u4e0b\u3002\r\n\r\n**QPS & \u5e73\u5747\u54cd\u5e94\u65f6\u95f4\u5bf9\u6bd4**\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/24/164327a1d8bfeb4d?w=640&h=480&f=png&s=7959)\r\n\r\n**\u6210\u529f\u7387\u5bf9\u6bd4**\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/6/24/164327a4a217a566?w=640&h=480&f=png&s=3801)\r\n\r\n\u53ef\u4ee5\u770b\u5230\u5220\u9664\u65e0\u7528 Gin middleware \u540e\uff0capiserver \u7684\u6027\u80fd\u6709\u4e86\u5f88\u5927\u7684\u63d0\u5347\uff0c\u5e76\u53d1\u6570\u4e3a 25000 \u65f6\uff0cQPS \u6700\u5927\uff0c\u4e3a 553335\uff08\u5b9e\u9645\u4e0a\u5e76\u53d1\u6570\u4e3a 50000 \u65f6\u4f9d\u7136\u80fd\u8fbe\u5230\u5f88\u9ad8\u7684 QPS: 538144\uff09\uff0c\u54cd\u5e94\u65f6\u95f4\u4e3a 222.91ms\uff0cQPS \u5f88\u9ad8\uff0c\u662f\u539f\u751f HTTP Server \u7684 85.34%\u3002\u6210\u529f\u7387\u57fa\u672c\u8ddf\u539f\u751f\u7684 HTTP Server \u4e00\u81f4\u3002\u4f18\u5316\u540e\u7684 API \u670d\u52a1\u5668\u53ef\u4ee5\u652f\u6301\u5f88\u9ad8\u7684\u5e76\u53d1\uff0c\u5728 20w+ \u7684\u5e76\u53d1\u4e0b\uff0cAPI \u670d\u52a1\u5668\u8bf7\u6c42\u6210\u529f\u7387\u53ef\u4ee5\u8fbe\u5230 99.16%\u3002\u8fd9\u4e9b\u6027\u80fd\u8fdc\u8fdc\u597d\u4e8e\u4f01\u4e1a\u7ea7 API \u670d\u52a1\u5668\u7684\u8981\u6c42\u3002\r\n\r\n## \u6027\u80fd\u6d4b\u8bd5\u81ea\u52a8\u5316\r\n\r\n\u672c\u5c0f\u8282\u7684\u6027\u80fd\u6d4b\u8bd5\u811a\u672c\u8bf7\u53c2\u8003\u6700\u7ec8\u6e90\u7801\u76ee\u5f55\u4e0b\u7684 `wrktest.sh` \u811a\u672c\u3002\u811a\u672c\u5927\u81f4\u6d41\u7a0b\u662f\uff1a\u5148\u6267\u884c wrk \u6d4b\u8bd5\uff0c\u6536\u96c6\u6d4b\u8bd5\u6570\u636e\uff0c\u683c\u5f0f\u5316\u6d4b\u8bd5\u6570\u636e\uff0c\u6700\u540e\u8c03\u7528 gnuplot \u751f\u6210\u56fe\u8868\u3002\r\n\r\n\u786e\u4fdd\u7cfb\u7edf\u5b89\u88c5\u4e86 gnuplot\uff0c\u5982\u679c\u6ca1\u6709\u5b89\u88c5\uff0cCentOS \u7cfb\u7edf\u4e2d\u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5\uff1a\r\n\r\n```\r\nyum -y install gnuplot\r\n```\r\n\r\n## \u9644\u4ef6\uff1aAPI \u6027\u80fd\u6d4b\u8bd5\u6570\u636e\r\n\r\n**\u539f\u751f\u7684 HTTP Server \u6027\u80fd\u6570\u636e**\r\n\r\n```\r\n\u5e76\u53d1\u6570 QPS \u5e73\u5747\u54cd\u5e94\u65f6\u95f4(\u6beb\u79d2) \u6210\u529f\u7387\r\n\r\n200 107975.55 2.18 100.00\r\n500 387894.92 2.52 100.00\r\n1000 512223.67 5.89 100.00\r\n3000 599781.96 27.75 100.00\r\n5000 623458.30 52.72 100.00\r\n10000 640701.55 134.92 100.00\r\n15000 644269.17 222.44 100.00\r\n20000 646675.63 257.28 100.00\r\n25000 648380.78 344.17 100.00\r\n50000 642420.16 305.24 99.99\r\n100000 572197.78 118.41 99.84\r\n200000 372247.81 154.68 99.31\r\n500000 110261.20 181.90 96.90\r\n1000000 20954.71 198.87 83.15\r\n```\r\n\r\n**\u4f18\u5316\u524d apiserver \u6027\u80fd\u6570\u636e**\r\n\r\n```\r\n\u5e76\u53d1\u6570 QPS \u5e73\u5747\u54cd\u5e94\u65f6\u95f4(\u6beb\u79d2) \u6210\u529f\u7387\r\n\r\n200 145651.44 1.28 100.00\r\n500 143562.75 4.30 100.00\r\n1000 144860.93 8.79 100.00\r\n3000 147833.70 30.91 100.00\r\n5000 146953.40 52.75 100.00\r\n10000 144015.46 108.19 100.00\r\n15000 140960.03 164.76 100.00\r\n20000 140586.00 218.57 100.00\r\n25000 140783.38 272.12 100.00\r\n50000 139312.92 462.26 99.93\r\n100000 127629.61 419.98 99.28\r\n200000 90035.14 483.31 97.14\r\n500000 25118.75 743.60 86.08\r\n1000000 12304.60 819.44 71.78\r\n```\r\n**\u4f18\u5316\u540e apiserver \u6027\u80fd\u6570\u636e**\r\n\r\n```\r\n\u5e76\u53d1\u6570 QPS \u5e73\u5747\u54cd\u5e94\u65f6\u95f4(\u6beb\u79d2) \u6210\u529f\u7387\r\n\r\n200 540539.65 0.44213 100.00\r\n500 536362.78 1.89 100.00\r\n1000 529081.92 5.61 100.00\r\n3000 535506.99 30.00 100.00\r\n5000 539251.92 55.10 100.00\r\n10000 541375.64 131.69 100.00\r\n15000 547164.96 127.14 100.00\r\n20000 550434.18 282.16 100.00\r\n25000 553335.38 222.91 100.00\r\n50000 538144.69 174.27 99.98\r\n100000 457695.17 130.28 99.80\r\n200000 305915.69 193.37 99.16\r\n500000 87672.39 241.65 96.14\r\n1000000 20351.67 231.12 82.99\r\n```\r\n\r\n## \u603b\u7ed3\r\n\r\n\u672c\u5c0f\u8282\u4ecb\u7ecd\u4e86\u5982\u4f55\u8fdb\u884c API \u7684\u6027\u80fd\u6d4b\u8bd5\uff0c\u5e76\u7ed9\u51fa\u4e86\u672c\u5c0f\u518c apiserver \u7684\u6027\u80fd\u6570\u636e\uff0c\u6700\u540e\u7b14\u8005\u9644\u4e0a\u4e86\u81ea\u5df1\u6d4b\u8bd5\u7528\u7684\u81ea\u52a8\u5316\u6d4b\u8bd5\u811a\u672c\u3002\r\n\r\n\u672c\u5c0f\u8282\u4ecb\u7ecd\u7684\u662f\u6846\u67b6\u7684\u6027\u80fd\uff0c\u5177\u4f53\u5230\u67d0\u4e2a\u63a5\u53e3\u7684\u6027\u80fd\uff0c\u56e0\u4e3a\u5f71\u54cd\u56e0\u7d20\u6bd4\u8f83\u591a\uff0c\u9700\u8981\u8bfb\u8005\u81ea\u5df1\u53bb\u4f18\u5316\uff0c\u8fd9\u91cc\u7ed9\u51fa HTTP \u63a5\u53e3\u6027\u80fd\u8981\u6c42\uff0c\u4f9b\u8bfb\u8005\u5728\u4f18\u5316\u65f6\u53c2\u8003\u3002\r\n\r\n| \u6307\u6807\u540d\u79f0 | \u8981\u6c42 | \u4f18\u5148\u7ea7 |\r\n| ----| ---- | ---- | ---- |\r\n| \u54cd\u5e94\u65f6\u95f4 | 500 ms | 1 |\r\n| \u8bf7\u6c42\u6210\u529f\u7387 | 99% | 2 |\r\n| QPS | \u5728\u6ee1\u8db3\u9884\u671f\u8981\u6c42\u7684\u60c5\u51b5\u4e0b\u670d\u52a1\u5668\u72b6\u6001\u7a33\u5b9a\uff0c\u5355\u53f0\u670d\u52a1\u5668 QPS \u8981\u6c42\u5728 1000+ | 3 |\r\n", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/23\u8fdb\u9636_10API_\u6027\u80fd\u6d4b\u8bd5\u548c\u8c03\u4f18.md", "create_date": "2020-02-18T21:37:38.478", "order": 24}}, {"model": "subject.chapter", "pk": 141, "fields": {"title": "\u62d3\u5c55 2\uff1aGo \u89c4\u8303\u6307\u5357", "topic": 6, "md5": "fa0a6a496df271a37b62642d215116eb", "md_body": "# Go \u89c4\u8303\u6307\u5357\r\n\r\n## \u8bf4\u660e\r\n\r\n\u672c\u5c0f\u8282\u662f\u62d3\u5c55\u5185\u5bb9\uff0c\u7b14\u8005\u4f1a\u4e0d\u5b9a\u671f\u66f4\u65b0 Go \u89c4\u8303\u6307\u5357\uff0c\u4f7f\u8be5\u6307\u5357\u7684\u5185\u5bb9\u5c3d\u53ef\u80fd\u5168\uff0c\u5e76\u4fdd\u8bc1\u89c4\u8303\u7684\u5b9e\u7528\u6027\u3002\r\n> \u8bf4\u660e\uff1a\u672c\u6307\u5357\u53c2\u8003\u4e86\u7f51\u7edc\u4e0a\u5404\u79cd REST \u6700\u4f73\u5b9e\u8df5\uff0c\u7ed3\u5408\u7b14\u8005\u7684\u5b9e\u9645\u7ecf\u9a8c\u6c47\u603b\u800c\u6765\u3002\r\n\r\n\r\n## Go \u89c4\u8303\u6307\u5357\r\n\r\n1. \u5199\u5b8c\u4ee3\u7801\u90fd\u5fc5\u987b\u683c\u5f0f\u5316\uff0c\u4fdd\u8bc1\u4ee3\u7801\u4f18\u96c5\uff1agofmt goimports\r\n2. \u7f16\u8bd1\u524d\u5148\u6267\u884c\u4ee3\u7801\u9759\u6001\u5206\u6790\uff1ago vet pathxxx/\r\n3. package \u540d\u5b57\uff1a\u5305\u540d\u4e0e\u76ee\u5f55\u4fdd\u6301\u4e00\u81f4\uff0c\u5c3d\u91cf\u6709\u610f\u4e49\uff0c\u7b80\u77ed\uff0c\u4e0d\u548c\u6807\u51c6\u5e93\u51b2\u7a81\uff0c \u5168\u5c0f\u5199\uff0c\u4e0d\u8981\u6709\u4e0b\u5212\u7ebf\r\n4. \u7ade\u6001\u68c0\u6d4b\uff1ago build \u2013race (\u6d4b\u8bd5\u73af\u5883\u7f16\u8bd1\u65f6\u52a0\u4e0a -race \u9009\u9879\uff0c\u751f\u4ea7\u73af\u5883\u5fc5\u987b\u53bb\u6389\uff0c\u56e0\u4e3a race \u9650\u5236\u6700\u591a goroutine \u6570\u91cf\u4e3a 8192 \u4e2a)\r\n5. \u6bcf\u884c\u957f\u5ea6\u7ea6\u5b9a\uff1a\u4e00\u884c\u4e0d\u8981\u592a\u957f\uff0c\u8d85\u8fc7\u8bf7\u4f7f\u7528\u6362\u884c\u5c55\u793a\uff0c\u5c3d\u91cf\u4fdd\u6301\u683c\u5f0f\u4f18\u96c5\uff1b\u5355\u4e2a\u6587\u4ef6\u4e5f\u4e0d\u8981\u592a\u5927\uff0c\u6700\u597d\u4e0d\u8981\u8d85\u8fc7 500 \u884c\r\n6. \u591a\u8fd4\u56de\u503c\u6700\u591a\u8fd4\u56de\u4e09\u4e2a\uff0c\u8d85\u8fc7\u4e09\u4e2a\u8bf7\u4f7f\u7528 struct\r\n7. \u53d8\u91cf\u540d\u91c7\u7528\u9a7c\u5cf0\u6cd5\uff0c\u4e0d\u8981\u6709\u4e0b\u5212\u7ebf\uff0c\u4e0d\u8981\u5168\u90e8\u5927\u5199\r\n8. \u5728\u903b\u8f91\u5904\u7406\u4e2d\u7981\u7528 panic\uff0c\u9664\u975e\u4f60\u77e5\u9053\u4f60\u5728\u505a\u4ec0\u4e48\r\n9. \u9519\u8bef\u5904\u7406\u7684\u539f\u5219\u5c31\u662f\u4e0d\u80fd\u4e22\u5f03\u4efb\u4f55\u6709\u8fd4\u56de err \u7684\u8c03\u7528\uff0c\u4e0d\u8981\u91c7\u7528_\u4e22\u5f03\uff0c\u5fc5\u987b\u5168\u90e8\u5904\u7406\u3002\u63a5\u6536\u5230\u9519\u8bef\uff0c\u8981\u4e48\u8fd4\u56de err\uff0c\u8981\u4e48\u5b9e\u5728\u4e0d\u884c\u5c31 panic\uff0c\u6216\u8005\u4f7f\u7528 log \u8bb0\u5f55\u4e0b\u6765\u3002\r\n\u4e0d\u8981\u8fd9\u6837\u5199:\r\n\r\n```go\r\nif err != nil {\r\n\r\n    // error handling\r\n\r\n} else {\r\n\r\n    // normal code\r\n\r\n}\r\n```\r\n\r\n\u800c\u5e94\u8be5\u662f:\r\n\r\n```go\r\nif err != nil {\r\n\r\n    // error handling\r\n\r\n    return // or continue, etc.\r\n}\r\n\r\n// normal code\r\n```\r\n\r\n10. \u5e38\u7528\u7684\u9996\u5b57\u6bcd\u7f29\u5199\u540d\u8bcd\uff0c\u4f7f\u7528\u5168\u5c0f\u5199\u6216\u8005\u5168\u5927\u5199\uff0c\u5982 UIN URL HTTP ID IP OK\r\n11. Receiver:\uff1a\u7528\u4e00\u4e24\u4e2a\u5b57\u7b26\uff0c\u80fd\u591f\u8868\u793a\u51fa\u7c7b\u578b\uff0c\u4e0d\u8981\u4f7f\u7528 me self this\r\n12. \u53c2\u6570\u4f20\u9012:\r\n+ \u5bf9\u4e8e\u5c11\u91cf\u6570\u636e\uff0c\u4e0d\u8981\u4f20\u9012\u6307\u9488\r\n+ \u5bf9\u4e8e\u5927\u91cf\u6570\u636e\u7684 struct \u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u6307\u9488\r\n+ \u4f20\u5165\u53c2\u6570\u662f map\uff0cslice\uff0cchan\uff0cinterface\uff0cstring \u4e0d\u8981\u4f20\u9012\u6307\u9488\r\n13. \u6bcf\u4e2a\u57fa\u7840\u5e93\u90fd\u5fc5\u987b\u6709\u5b9e\u9645\u53ef\u8fd0\u884c\u7684\u4f8b\u5b50, \u57fa\u7840\u5e93\u7684\u63a5\u53e3\u90fd\u8981\u6709\u5355\u5143\u6d4b\u8bd5\u7528\u4f8b\r\n14. \u4e0d\u8981\u5728 for \u5faa\u73af\u91cc\u9762\u4f7f\u7528 defer\uff0cdefer\u53ea\u6709\u5728\u51fd\u6570\u9000\u51fa\u65f6\u624d\u4f1a\u6267\u884c\r\n15. panic \u6355\u83b7\u53ea\u80fd\u5230goroutine\u6700\u9876\u5c42\uff0c\u6bcf\u4e2a\u81ea\u5df1\u542f\u52a8\u7684 goroutine\uff0c\u5fc5\u987b\u5728\u5165\u53e3\u5904\u5c31\u6355\u83b7panic\uff0c\u5e76\u6253\u5370\u51fa\u8be6\u7ec6\u7684\u5806\u6808\u4fe1\u606f\r\n16. Go \u7684\u5185\u7f6e\u7c7b\u578bslice\u3001map\u3001chan\u90fd\u662f\u5f15\u7528\uff0c\u521d\u6b21\u4f7f\u7528\u524d\uff0c\u90fd\u5fc5\u987b\u5148\u7528 make \u5206\u914d\u597d\u5bf9\u8c61\uff0c\u4e0d\u7136\u4f1a\u6709\u7a7a\u6307\u9488\u5f02\u5e38\r\n17. \u4f7f\u7528 map \u65f6\u9700\u8981\u6ce8\u610f\uff1amap \u521d\u6b21\u4f7f\u7528\uff0c\u5fc5\u987b\u7528 make \u521d\u59cb\u5316\uff1bmap \u662f\u5f15\u7528\uff0c\u4e0d\u7528\u62c5\u5fc3\u8d4b\u503c\u5185\u5b58\u62f7\u8d1d\uff1b\u5e76\u53d1\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u52a0\u9501\uff1brange \u904d\u5386\u65f6\u987a\u5e8f\u4e0d\u786e\u5b9a\uff0c\u4e0d\u53ef\u4f9d\u8d56\uff1b\u4e0d\u80fd\u4f7f\u7528 slice\u3001map \u548c func \u4f5c\u4e3a key\r\n18. import \u5728\u591a\u884c\u7684\u60c5\u51b5\u4e0b\uff0cgoimports \u4f1a\u81ea\u52a8\u5e2e\u4f60\u683c\u5f0f\u5316\uff0c\u4f46\u662f\u6211\u4eec\u8fd9\u91cc\u8fd8\u662f\u89c4\u8303\u4e00\u4e0b import \u7684\u4e00\u4e9b\u89c4\u8303\uff0c\u5982\u679c\u4f60\u5728\u4e00\u4e2a\u6587\u4ef6\u91cc\u9762\u5f15\u5165\u4e86\u4e00\u4e2a package\uff0c\u8fd8\u662f\u5efa\u8bae\u91c7\u7528\u5982\u4e0b\u683c\u5f0f\uff1a\r\n\r\n```go\r\nimport (\r\n    \"fmt\"\r\n)\r\n```\r\n\r\n\u5982\u679c\u4f60\u7684\u5305\u5f15\u5165\u4e86\u4e09\u79cd\u7c7b\u578b\u7684\u5305\uff0c\u6807\u51c6\u5e93\u5305\uff0c\u7a0b\u5e8f\u5185\u90e8\u5305\uff0c\u7b2c\u4e09\u65b9\u5305\uff0c\u5efa\u8bae\u91c7\u7528\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u7ec4\u7ec7\u4f60\u7684\u5305\uff1a\r\n\r\n```go\r\nimport (\r\n    \"encoding/json\"\r\n    \"strings\"\r\n\r\n    \"myproject/models\"\r\n    \"myproject/controller\"\r\n    \"myproject/utils\"\r\n\r\n    \"github.com/astaxie/beego\"\r\n    \"github.com/go-sql-driver/mysql\"\r\n)   \r\n```\r\n\r\n\u6709\u987a\u5e8f\u7684\u5f15\u5165\u5305\uff0c\u4e0d\u540c\u7684\u7c7b\u578b\u91c7\u7528\u7a7a\u683c\u5206\u79bb\uff0c\u7b2c\u4e00\u79cd\u5b9e\u6807\u51c6\u5e93\uff0c\u7b2c\u4e8c\u662f\u9879\u76ee\u5305\uff0c\u7b2c\u4e09\u662f\u7b2c\u4e09\u65b9\u5305\u3002\r\n\r\n19. \u5982\u679c\u4f60\u7684\u51fd\u6570\u5f88\u77ed\u5c0f\uff0c\u5c11\u4e8e 10 \u884c\u4ee3\u7801\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\uff0c\u4e0d\u7136\u8bf7\u76f4\u63a5\u4f7f\u7528\u7c7b\u578b\uff0c\u56e0\u4e3a\u5982\u679c\u4f7f\u7528\u547d\u540d\u53d8\u91cf\u5f88\u5bb9\u6613\u5f15\u8d77\u9690\u85cf\u7684 bug\u3002\r\n\u5f53\u7136\u5982\u679c\u662f\u6709\u591a\u4e2a\u76f8\u540c\u7c7b\u578b\u7684\u53c2\u6570\u8fd4\u56de\uff0c\u90a3\u4e48\u547d\u540d\u53c2\u6570\u53ef\u80fd\u66f4\u6e05\u6670\uff1a\r\n\r\n```go\r\nfunc (f *Foo) Location() (float64, float64, error)\r\n```\r\n\r\n20. \u957f\u53e5\u5b50\u6253\u5370\u6216\u8005\u8c03\u7528\uff0c\u4f7f\u7528\u53c2\u6570\u8fdb\u884c\u683c\u5f0f\u5316\u5206\u884c\r\n\u6211\u4eec\u5728\u8c03\u7528 `fmt.Sprint` \u6216\u8005 `log.Sprint` \u4e4b\u7c7b\u7684\u51fd\u6570\u65f6\uff0c\u6709\u65f6\u5019\u4f1a\u9047\u5230\u5f88\u957f\u7684\u53e5\u5b50\uff0c\u6211\u4eec\u9700\u8981\u5728\u53c2\u6570\u8c03\u7528\u5904\u8fdb\u884c\u591a\u884c\u5206\u5272\uff1a\r\n\r\n\u4e0b\u9762\u662f\u9519\u8bef\u7684\u65b9\u5f0f\uff1a\r\n\r\n```go\r\nlog.Printf(\u201cA long format string: %s %d %d %s\u201d, myStringParameter, len(a),\r\n    expected.Size, defrobnicate(\u201cAnotherlongstringparameter\u201d,\r\n        expected.Growth.Nanoseconds() /1e6))\r\n```\r\n\r\n\u5e94\u8be5\u662f\u5982\u4e0b\u7684\u65b9\u5f0f\uff1a\r\n\r\n```go\r\nlog.Printf( \r\n    \u201cA long format string: %s %d %d %s\u201d, \r\n    myStringParameter,\r\n    len(a),\r\n    expected.Size,\r\n    defrobnicate(\r\n        \u201cAnotherlongstringparameter\u201d,\r\n        expected.Growth.Nanoseconds()/1e6, \r\n    ),\r\n\uff09   \r\n```\r\n\r\n21. \u6ce8\u610f\u95ed\u5305\u7684\u8c03\u7528\r\n\u5728\u5faa\u73af\u4e2d\u8c03\u7528\u51fd\u6570\u6216\u8005 goroutine \u65b9\u6cd5\uff0c\u4e00\u5b9a\u8981\u91c7\u7528\u663e\u793a\u7684\u53d8\u91cf\u8c03\u7528\uff0c\u4e0d\u8981\u5728\u95ed\u5305\u51fd\u6570\u91cc\u8c03\u7528\u5faa\u73af\u7684\u53c2\u6570\r\n\r\n```go\r\nfori:=0;i<limit;i++{\r\n    go func(){ DoSomething(i) }() //\u9519\u8bef\u7684\u505a\u6cd5\r\n    go func(i int){ DoSomething(i) }(i)//\u6b63\u786e\u7684\u505a\u6cd5\r\n}\r\n```\r\n\r\n22. recieved \u662f\u503c\u7c7b\u578b\u8fd8\u662f\u6307\u9488\u7c7b\u578b\r\n\u5230\u5e95\u662f\u91c7\u7528\u503c\u7c7b\u578b\u8fd8\u662f\u6307\u9488\u7c7b\u578b\u4e3b\u8981\u53c2\u8003\u5982\u4e0b\u539f\u5219\uff1a\r\n\r\n```go\r\nfunc(w Win) Tally(playerPlayer)int    //w\u4e0d\u4f1a\u6709\u4efb\u4f55\u6539\u53d8 \r\nfunc(w *Win) Tally(playerPlayer)int    //w\u4f1a\u6539\u53d8\u6570\u636e\r\n```\r\n23. struct \u58f0\u660e\u548c\u521d\u59cb\u5316\u683c\u5f0f\u91c7\u7528\u591a\u884c\uff1a\r\n\u5b9a\u4e49\u5982\u4e0b\uff1a\r\n\r\n```go\r\ntype User struct{\r\n    Username  string\r\n    Email     string\r\n}\r\n```\r\n\u521d\u59cb\u5316\u5982\u4e0b\uff1a\r\n\r\n```go\r\nu := User{\r\n    Username: \"astaxie\",\r\n    Email:    \"astaxie@gmail.com\",\r\n}\r\n```\r\n\r\n24. \u53d8\u91cf\u547d\u540d\r\n+ \u548c\u7ed3\u6784\u4f53\u7c7b\u4f3c\uff0c\u53d8\u91cf\u540d\u79f0\u4e00\u822c\u9075\u5faa\u9a7c\u5cf0\u6cd5\uff0c\u9996\u5b57\u6bcd\u6839\u636e\u8bbf\u95ee\u63a7\u5236\u539f\u5219\u5927\u5199\u6216\u8005\u5c0f\u5199\uff0c\u4f46\u9047\u5230\u7279\u6709\u540d\u8bcd\u65f6\uff0c\u9700\u8981\u9075\u5faa\u4ee5\u4e0b\u89c4\u5219\uff1a\r\n  + \u5982\u679c\u53d8\u91cf\u4e3a\u79c1\u6709\uff0c\u4e14\u7279\u6709\u540d\u8bcd\u4e3a\u9996\u4e2a\u5355\u8bcd\uff0c\u5219\u4f7f\u7528\u5c0f\u5199\uff0c\u5982 apiClient\r\n  + \u5176\u5b83\u60c5\u51b5\u90fd\u5e94\u5f53\u4f7f\u7528\u8be5\u540d\u8bcd\u539f\u6709\u7684\u5199\u6cd5\uff0c\u5982 APIClient\u3001repoID\u3001UserID\r\n  + \u9519\u8bef\u793a\u4f8b\uff1aUrlArray\uff0c\u5e94\u8be5\u5199\u6210 urlArray \u6216\u8005 URLArray\r\n+ \u82e5\u53d8\u91cf\u7c7b\u578b\u4e3a bool \u7c7b\u578b\uff0c\u5219\u540d\u79f0\u5e94\u4ee5 Has\u3001Is\u3001Can \u6216 Allow \u5f00\u5934\r\n\r\n```go\r\nvar isExist bool\r\nvar hasConflict bool\r\nvar canManage bool\r\nvar allowGitHook bool\r\n```\r\n25. \u5e38\u91cf\u547d\u540d\r\n\u5e38\u91cf\u5747\u9700\u4f7f\u7528\u5168\u90e8\u5927\u5199\u5b57\u6bcd\u7ec4\u6210\uff0c\u5e76\u4f7f\u7528\u4e0b\u5212\u7ebf\u5206\u8bcd\r\n\r\n```go\r\nconst APP_VER = \"1.0\"\r\n```", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/25\u62d3\u5c55_2Go_\u89c4\u8303\u6307\u5357.md", "create_date": "2020-02-18T21:37:38.496", "order": 26}}, {"model": "subject.chapter", "pk": 142, "fields": {"title": "\u62d3\u5c55 1\uff1aGo \u5f00\u53d1\u6280\u5de7", "topic": 6, "md5": "da44605107f069f7c7441015c09d4a86", "md_body": "# Go \u5f00\u53d1\u6280\u5de7\r\n\r\n## \u8bf4\u660e\r\n\r\n\u672c\u5c0f\u8282\u662f\u62d3\u5c55\u5185\u5bb9\uff0c\u7b14\u8005\u4f1a\u4e0d\u5b9a\u671f\u66f4\u65b0 Go \u5f00\u53d1\u6280\u5de7\uff0c\u4f7f\u8be5\u6280\u5de7\u7684\u5185\u5bb9\u5c3d\u53ef\u80fd\u5168\uff0c\u5e76\u4fdd\u8bc1\u6280\u5de7\u7684\u5b9e\u7528\u6027\u3002\r\n\r\n## Go \u5f00\u53d1\u6280\u5de7\r\n\r\n1. package \u7684\u540d\u5b57\u548c\u76ee\u5f55\u540d\u4e00\u6837\uff0cmain \u9664\u5916\r\n2. string \u8868\u793a\u7684\u662f\u4e0d\u53ef\u53d8\u7684\u5b57\u7b26\u4e32\u53d8\u91cf\uff0c\u5bf9 string \u7684\u4fee\u6539\u662f\u6bd4\u8f83\u91cd\u7684\u64cd\u4f5c\uff0c\u57fa\u672c\u4e0a\u90fd\u9700\u8981\u91cd\u65b0\u7533\u8bf7\u5185\u5b58\uff0c\u5982\u679c\u6ca1\u6709\u7279\u6b8a\u9700\u8981\uff0c\u9700\u8981\u4fee\u6539\u65f6\u591a\u4f7f\u7528 []byte\r\n3. \u5c3d\u91cf\u4f7f\u7528 strings \u5e93\u64cd\u4f5c string\uff0c\u8fd9\u6837\u505a\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\r\n4. append \u8981\u5c0f\u5fc3\u81ea\u52a8\u5206\u914d\u5185\u5b58\uff0cappend \u8fd4\u56de\u7684\u53ef\u80fd\u662f\u65b0\u5206\u914d\u7684\u5730\u5740\r\n5. \u5982\u679c\u8981\u76f4\u63a5\u4fee\u6539 map \u7684 value \u503c\uff0c\u5219 value \u53ea\u80fd\u662f\u6307\u9488\uff0c\u5426\u5219\u8981\u8986\u76d6\u539f\u6765\u7684\u503c\r\n6. map \u5728\u5e76\u53d1\u4e2d\u9700\u8981\u52a0\u9501\r\n7. \u7f16\u8bd1\u8fc7\u7a0b\u65e0\u6cd5\u68c0\u67e5 interface{} \u7684\u8f6c\u6362\uff0c\u53ea\u6709\u8fd0\u884c\u65f6\u68c0\u67e5\uff0c\u5c0f\u5fc3\u5f15\u8d77 panic\r\n8. \u4f7f\u7528 defer\uff0c\u4fdd\u8bc1\u9000\u51fa\u51fd\u6570\u65f6\u91ca\u653e\u8d44\u6e90\r\n9. \u5c3d\u91cf\u5c11\u7528\u5168\u5c40\u53d8\u91cf\uff0c\u901a\u8fc7\u53c2\u6570\u4f20\u9012\uff0c\u4f7f\u6bcf\u4e2a\u51fd\u6570\u90fd\u662f\u201c\u65e0\u72b6\u6001\u201d\u7684\uff0c\u8fd9\u6837\u51cf\u5c11\u8026\u5408\uff0c\u4e5f\u65b9\u4fbf\u5206\u5de5\u548c\u5355\u5143\u6d4b\u8bd5\r\n10. \u53c2\u6570\u5982\u679c\u6bd4\u8f83\u591a\uff0c\u5c06\u76f8\u5173\u53c2\u6570\u5b9a\u4e49\u6210\u7ed3\u6784\u4f53\u4f20\u9012", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/24\u62d3\u5c55_1Go_\u5f00\u53d1\u6280\u5de7.md", "create_date": "2020-02-18T21:37:38.515", "order": 25}}, {"model": "subject.chapter", "pk": 143, "fields": {"title": "\u603b\u7ed3", "topic": 6, "md5": "feb7340d2141372a6f4eb37177f0fc5b", "md_body": "# \u603b\u7ed3\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u5b8c\u6210\u4e86\u672c\u5c0f\u518c\u7684\u5b66\u4e60\u3002\u901a\u8fc7\u524d\u9762\u5404\u5c0f\u8282\u7684\u5b66\u4e60\uff0c\u76f8\u4fe1\u4f60\u5df2\u7ecf\u5bf9 API \u5f00\u53d1\u7684\u6574\u4e2a\u6d41\u7a0b\u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u4e5f\u77e5\u9053\u5982\u4f55\u53bb\u6784\u5efa\u6d41\u7a0b\u4e2d\u7684\u6bcf\u4e2a\u529f\u80fd\u3002\u672c\u5c0f\u518c\u662f\u4e00\u4e2a\u5165\u95e8\u6559\u7a0b\uff0c\u66f4\u590d\u6742\u7684\u573a\u666f\uff0c\u9700\u8981\u5728\u5177\u4f53\u7684\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u7531\u8bfb\u8005\u53bb\u63a2\u7d22\u3002\u8fd9\u662f\u4e00\u4e2a\u5927\u578b\u7684\u5b9e\u6218\u7c7b\u5c0f\u518c\uff0c\u7b14\u8005\u8017\u8d39\u4e86\u4e0d\u5c11\u7cbe\u529b\u6765\u6784\u5efa\u8fd9\u672c\u5c0f\u518c\uff0c\u4e5f\u5e0c\u671b\u8fd9\u672c\u5c0f\u518c\u786e\u5b9e\u80fd\u591f\u5e2e\u52a9\u5230\u5927\u5bb6\u3002Go \u8bed\u8a00\u8d8a\u6765\u8d8a\u706b\uff0c\u5e0c\u671b\u901a\u8fc7\u672c\u5c0f\u518c\u7684\u5b66\u4e60\uff0c\u80fd\u4f7f\u4f60\u53ca\u65e9\u642d\u4e0a Go \u7684\u987a\u98ce\u8f66\u3002\n\n\u6700\u540e\u611f\u8c22\u5927\u5bb6\u7684\u5173\u6ce8\uff0c\u5c0f\u518c\u6709\u4e9b\u4e0d\u5b8c\u5584\u7684\u5730\u65b9\u8fd8\u8bf7\u5927\u5bb6\u591a\u591a\u5305\u5bb9\uff0c\u795d\u5927\u5bb6\u5de5\u4f5c\u987a\u5229\uff0c\u4e8b\u4e8b\u987a\u610f\u3002", "md_File": "subject/\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1/26\u603b\u7ed3.md", "create_date": "2020-02-18T21:37:38.531", "order": 27}}, {"model": "subject.chapter", "pk": 144, "fields": {"title": "\u8ba4\u8bc1authentication", "topic": 7, "md5": "82035d889c69d5092bc7de814096d02a", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/authentication/)  \r\n> [\u524d\u5f80\u6398\u91d1\u9605\u8bfb](https://juejin.im/post/5aaa7d11518825558154b69a)  \r\n\r\n# \u8eab\u4efd\u9a8c\u8bc1\r\n\r\n\u8eab\u4efd\u9a8c\u8bc1\u662f\u5c06\u4f20\u5165\u8bf7\u6c42\u4e0e\u4e00\u7ec4\u8bc6\u522b\u51ed\u8bc1\uff08\u4f8b\u5982\u8bf7\u6c42\u7684\u7528\u6237\u6216\u5176\u7b7e\u540d\u7684\u4ee4\u724c\uff09\u76f8\u5173\u8054\u7684\u673a\u5236\u3002\u7136\u540e\uff0c\u6743\u9650\u548c\u9650\u5236\u7b56\u7565\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u51ed\u636e\u6765\u786e\u5b9a\u8bf7\u6c42\u662f\u5426\u5e94\u8be5\u88ab\u5141\u8bb8\u3002\r\n\r\nREST framework \u63d0\u4f9b\u4e86\u8bb8\u591a\u5f00\u7bb1\u5373\u7528\u7684\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u4f60\u5b9e\u65bd\u81ea\u5b9a\u4e49\u65b9\u6848\u3002\r\n\r\n\u8eab\u4efd\u9a8c\u8bc1\u59cb\u7ec8\u5728\u89c6\u56fe\u7684\u5f00\u59cb\u5904\u8fd0\u884c\uff0c\u5728\u6267\u884c\u6743\u9650\u548c\u9650\u5236\u68c0\u67e5\u4e4b\u524d\uff0c\u5728\u5141\u8bb8\u7ee7\u7eed\u6267\u884c\u4efb\u4f55\u5176\u4ed6\u4ee3\u7801\u4e4b\u524d\u3002\r\n\r\n`request.user` \u5c5e\u6027\u901a\u5e38\u4f1a\u8bbe\u7f6e\u4e3a `contrib.auth` \u5305\u7684 `User` \u7c7b\u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002\r\n\r\n`request.auth` \u5c5e\u6027\u7528\u4e8e\u5176\u4ed6\u8eab\u4efd\u9a8c\u8bc1\u4fe1\u606f\uff0c\u4f8b\u5982\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u8868\u793a\u8bf7\u6c42\u5df2\u7b7e\u540d\u7684\u8eab\u4efd\u9a8c\u8bc1\u4ee4\u724c\u3002\r\n\r\n---\r\n\r\n**\u6ce8\u610f\uff1a** \u4e0d\u8981\u5fd8\u8bb0\uff0c **\u8eab\u4efd\u9a8c\u8bc1\u672c\u8eab\u4e0d\u4f1a\uff08\u5141\u8bb8\u6216\u4e0d\u5141\u8bb8\uff09\u4f20\u5165\u7684\u8bf7\u6c42**\uff0c\u5b83\u53ea\u662f\u6807\u8bc6\u8bf7\u6c42\u7684\u51ed\u636e\u3002\r\n\r\n---\r\n\r\n## \u5982\u4f55\u786e\u5b9a\u8eab\u4efd\u9a8c\u8bc1\r\n\r\n\u8ba4\u8bc1\u65b9\u6848\u603b\u662f\u88ab\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u7c7b\u7684\u5217\u8868\u3002  REST framework \u5c06\u5c1d\u8bd5\u4f7f\u7528\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u7c7b\u8fdb\u884c\u8ba4\u8bc1\uff0c\u5e76\u5c06\u4f7f\u7528\u6210\u529f\u8ba4\u8bc1\u7684\u7b2c\u4e00\u4e2a\u7c7b\u7684\u8fd4\u56de\u503c\u6765\u8bbe\u7f6e `request.user` \u548c `request.auth` \u3002\r\n\r\n\u5982\u679c\u6ca1\u6709\u7c7b\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5219\u5c06 `request.user` \u8bbe\u7f6e\u4e3a `django.contrib.auth.models.AnonymousUser` \u7684\u5b9e\u4f8b\uff0c\u5e76\u5c06 `request.auth` \u8bbe\u7f6e\u4e3a `None`.\r\n\r\n\u53ef\u4ee5\u4f7f\u7528 `UNAUTHENTICATED_USER` \u548c `UNAUTHENTICATED_TOKEN` \u8bbe\u7f6e\u4fee\u6539\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u7684 `request.user` \u548c `request.auth` \u7684\u503c\u3002\r\n\r\n## \u8bbe\u7f6e\u8ba4\u8bc1\u65b9\u6848\r\n\r\n\u9ed8\u8ba4\u7684\u8ba4\u8bc1\u65b9\u6848\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_AUTHENTICATION_CLASSES`  setting \u5168\u5c40\u8bbe\u7f6e\u3002\u4f8b\u5982\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_AUTHENTICATION_CLASSES': (\r\n        'rest_framework.authentication.BasicAuthentication',\r\n        'rest_framework.authentication.SessionAuthentication',\r\n    )\r\n}\r\n```\r\n\r\n\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e `APIView` \u7c7b\u7684\u89c6\u56fe\uff0c\u5728\u6bcf\u4e2a\u89c6\u56fe\u6216\u6bcf\u4e2a\u89c6\u56fe\u96c6\u7684\u57fa\u7840\u4e0a\u8bbe\u7f6e\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u3002\r\n\r\n``` python\r\nfrom rest_framework.authentication import SessionAuthentication, BasicAuthentication\r\nfrom rest_framework.permissions import IsAuthenticated\r\nfrom rest_framework.response import Response\r\nfrom rest_framework.views import APIView\r\n\r\nclass ExampleView(APIView):\r\n    authentication_classes = (SessionAuthentication, BasicAuthentication)\r\n    permission_classes = (IsAuthenticated,)\r\n\r\n    def get(self, request, format=None):\r\n        content = {\r\n            'user': unicode(request.user),  # `django.contrib.auth.User` instance.\r\n            'auth': unicode(request.auth),  # None\r\n        }\r\n        return Response(content)\r\n```\r\n\r\n\u6216\u8005\uff0c\u5982\u679c\u60a8\u5c06 `@api_view` \u88c5\u9970\u5668\u4e0e\u57fa\u4e8e\u51fd\u6570\u7684\u89c6\u56fe\u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n``` python\r\n@api_view(['GET'])\r\n@authentication_classes((SessionAuthentication, BasicAuthentication))\r\n@permission_classes((IsAuthenticated,))\r\ndef example_view(request, format=None):\r\n    content = {\r\n        'user': unicode(request.user),  # `django.contrib.auth.User` instance.\r\n        'auth': unicode(request.auth),  # None\r\n    }\r\n    return Response(content)\r\n```\r\n\r\n## \u672a\u7ecf\u6388\u6743\u548c\u7981\u6b62\u54cd\u5e94\r\n\r\n\u5f53\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u88ab\u62d2\u7edd\u65f6\uff0c\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u9519\u8bef\u4ee3\u7801\u53ef\u80fd\u662f\u5408\u9002\u7684\u3002\r\n\r\n* [HTTP 401 Unauthorized][http401]\r\n* [HTTP 403 Permission Denied][http403]\r\n\r\nHTTP 401 \u54cd\u5e94\u5fc5\u987b\u59cb\u7ec8\u5305\u542b `WWW-Authenticate` header\uff0c\u8be5 header \u6307\u793a\u5ba2\u6237\u7aef\u5982\u4f55\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002 HTTP 403 \u54cd\u5e94\u4e0d\u5305\u542b `WWW-Authenticate` header\u3002\r\n\r\n\u5c06\u4f7f\u7528\u54ea\u79cd\u54cd\u5e94\u53d6\u51b3\u4e8e\u8ba4\u8bc1\u65b9\u6848\u3002\u5c3d\u7ba1\u53ef\u80fd\u6b63\u5728\u4f7f\u7528\u591a\u79cd\u8ba4\u8bc1\u65b9\u6848\uff0c\u4f46\u53ea\u80fd\u4f7f\u7528\u4e00\u79cd\u65b9\u6848\u6765\u786e\u5b9a\u54cd\u5e94\u7684\u7c7b\u578b\u3002 **\u5728\u786e\u5b9a\u54cd\u5e94\u7c7b\u578b\u65f6\u4f7f\u7528\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u7684\u7b2c\u4e00\u4e2a\u8ba4\u8bc1\u7c7b**\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5f53\u8bf7\u6c42\u53ef\u4ee5\u6210\u529f\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u4ecd\u7136\u53ef\u80fd\u4f1a\u56e0\u4e3a\u6743\u9650\u800c\u88ab\u62d2\u7edd\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u59cb\u7ec8\u4f7f\u7528 `403 Permission Denied` \u54cd\u5e94\uff0c\u800c\u4e0d\u7ba1\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u5982\u4f55\u3002\r\n\r\n## Apache mod_wsgi \u7279\u5b9a\u7684\u914d\u7f6e\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4f7f\u7528 mod_wsgi \u90e8\u7f72\u5230 Apache\uff0c\u6388\u6743 header \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u4f20\u9012\u5230 WSGI \u5e94\u7528\u7a0b\u5e8f\uff0c\u56e0\u4e3a\u5b83\u5047\u5b9a\u8ba4\u8bc1\u5c06\u7531 Apache \u5904\u7406\uff0c\u800c\u4e0d\u662f\u5728\u5e94\u7528\u7a0b\u5e8f\u7ea7\u522b\u5904\u7406\u3002\r\n\r\n\u5982\u679c\u60a8\u6b63\u5728\u90e8\u7f72\u5230 Apache \u5e76\u4f7f\u7528\u4efb\u4f55\u57fa\u4e8e\u975e\u4f1a\u8bdd\u7684\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5219\u9700\u8981\u660e\u786e\u914d\u7f6e mod_wsgi \u4ee5\u5c06\u6240\u9700\u7684 headers \u4f20\u9012\u7ed9\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u5728\u9002\u5f53\u7684\u4e0a\u4e0b\u6587\u4e2d\u6307\u5b9a `WSGIPassAuthorization` \u6307\u4ee4\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a `'On'` \u6765\u5b8c\u6210\u3002\r\n\r\n``` python\r\n# this can go in either server config, virtual host, directory or .htaccess\r\nWSGIPassAuthorization On\r\n```\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## BasicAuthentication\r\n\r\n\u8be5\u8ba4\u8bc1\u65b9\u6848\u4f7f\u7528 HTTP Basic Authentication\uff0c\u5e76\u6839\u636e\u7528\u6237\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u8fdb\u884c\u7b7e\u540d\u3002Basic Authentication \u901a\u5e38\u53ea\u9002\u7528\u4e8e\u6d4b\u8bd5\u3002\r\n\r\n\u5982\u679c\u6210\u529f\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c`BasicAuthentication` \u5c06\u63d0\u4f9b\u4ee5\u4e0b\u51ed\u636e\u3002\r\n\r\n* `request.user` \u662f\u4e00\u4e2a Django `User` \u5b9e\u529b.\r\n* `request.auth` \u662f `None`.\r\n\r\n\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u54cd\u5e94\u88ab\u62d2\u7edd\u5c06\u5bfc\u81f4 `HTTP 401 Unauthorized` \u7684\u54cd\u5e94\u548c\u76f8\u5e94\u7684 WWW-Authenticate header\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nWWW-Authenticate: Basic realm=\"api\"\r\n```\r\n\r\n**\u6ce8\u610f\uff1a** \u5982\u679c\u60a8\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528 `BasicAuthentication`\uff0c\u5219\u5fc5\u987b\u786e\u4fdd\u60a8\u7684 API \u4ec5\u53ef\u901a\u8fc7 `https` \u8bbf\u95ee\u3002\u60a8\u8fd8\u5e94\u8be5\u786e\u4fdd\u60a8\u7684 API \u5ba2\u6237\u7aef\u5c06\u59cb\u7ec8\u5728\u767b\u5f55\u65f6\u91cd\u65b0\u8bf7\u6c42\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u5c06\u8fd9\u4e9b\u8be6\u7ec6\u4fe1\u606f\u5b58\u50a8\u5230\u6301\u4e45\u5316\u5b58\u50a8\u4e2d\u3002\r\n\r\n## TokenAuthentication\r\n\r\n\u6b64\u8ba4\u8bc1\u65b9\u6848\u4f7f\u7528\u7b80\u5355\u7684\u57fa\u4e8e\u4ee4\u724c\u7684 HTTP \u8ba4\u8bc1\u65b9\u6848\u3002\u4ee4\u724c\u8eab\u4efd\u9a8c\u8bc1\u9002\u7528\u4e8e client-server \u67b6\u6784\uff0c\u4f8b\u5982\u672c\u673a\u684c\u9762\u548c\u79fb\u52a8\u5ba2\u6237\u7aef\u3002\r\n\r\n\u8981\u4f7f\u7528 `TokenAuthentication` \u65b9\u6848\uff0c\u60a8\u9700\u8981\u5c06\u8ba4\u8bc1\u7c7b\u914d\u7f6e\u4e3a\u5305\u542b `TokenAuthentication` \uff0c\u5e76\u5728 `INSTALLED_APPS` \u8bbe\u7f6e\u4e2d\u53e6\u5916\u5305\u542b `rest_framework.authtoken` \uff1a\r\n\r\n``` python\r\nINSTALLED_APPS = (\r\n    ...\r\n    'rest_framework.authtoken'\r\n)\r\n```\r\n\r\n---\r\n\r\n**\u6ce8\u610f\uff1a** \u786e\u4fdd\u5728\u66f4\u6539\u8bbe\u7f6e\u540e\u8fd0\u884c `manage.py migrate` \u3002 `rest_framework.authtoken` \u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b Django \u6570\u636e\u5e93\u8fc1\u79fb\u3002\r\n\r\n---\r\n\r\n\u60a8\u8fd8\u9700\u8981\u4e3a\u60a8\u7684\u7528\u6237\u521b\u5efa\u4ee4\u724c\u3002\r\n\r\n``` python\r\nfrom rest_framework.authtoken.models import Token\r\n\r\ntoken = Token.objects.create(user=...)\r\nprint token.key\r\n```\r\n\r\n\u5bf9\u4e8e\u5ba2\u6237\u7aef\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4ee4\u724c\u5bc6\u94a5\u5e94\u5305\u542b\u5728 `Authorization` HTTP header \u4e2d\u3002\u5173\u952e\u5b57\u5e94\u4ee5\u5b57\u7b26\u4e32\u6587\u5b57 \u201cToken\u201d \u4e3a\u524d\u7f00\uff0c\u7528\u7a7a\u683c\u5206\u9694\u4e24\u4e2a\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nAuthorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b\r\n```\r\n\r\n**\u6ce8\u610f\uff1a** \u5982\u679c\u60a8\u60f3\u5728 header \u4e2d\u4f7f\u7528\u4e0d\u540c\u7684\u5173\u952e\u5b57\uff08\u4f8b\u5982 `Bearer`\uff09\uff0c\u53ea\u9700\u5b50\u7c7b\u5316 `TokenAuthentication` \u5e76\u8bbe\u7f6e `keyword` \u7c7b\u53d8\u91cf\u3002\r\n\r\n\u5982\u679c\u6210\u529f\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c`TokenAuthentication` \u5c06\u63d0\u4f9b\u4ee5\u4e0b\u51ed\u636e\u3002\r\n\r\n* `request.user` \u662f\u4e00\u4e2a Django `User` \u5b9e\u4f8b.\r\n* `request.auth` \u662f\u4e00\u4e2a `rest_framework.authtoken.models.Token` \u5b9e\u4f8b.\r\n\r\n\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u54cd\u5e94\u88ab\u62d2\u7edd\u5c06\u5bfc\u81f4 `HTTP 401 Unauthorized` \u7684\u54cd\u5e94\u548c\u76f8\u5e94\u7684 WWW-Authenticate header\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nWWW-Authenticate: Token\r\n```\r\n\r\n`curl` \u547d\u4ee4\u884c\u5de5\u5177\u53ef\u80fd\u5bf9\u6d4b\u8bd5\u4ee4\u724c\u8ba4\u8bc1\u7684 API \u6709\u7528\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\ncurl -X GET http://127.0.0.1:8000/api/example/ -H 'Authorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b'\r\n```\r\n\r\n---\r\n\r\n**\u6ce8\u610f\uff1a** \u5982\u679c\u60a8\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528 `TokenAuthentication`\uff0c\u5219\u5fc5\u987b\u786e\u4fdd\u60a8\u7684 API \u53ea\u80fd\u901a\u8fc7 `https` \u8bbf\u95ee\u3002\r\n\r\n---\r\n\r\n#### \u751f\u6210\u4ee4\u724c\r\n\r\n##### \u901a\u8fc7\u4f7f\u7528\u4fe1\u53f7\r\n\r\n\u5982\u679c\u60a8\u5e0c\u671b\u6bcf\u4e2a\u7528\u6237\u90fd\u62e5\u6709\u4e00\u4e2a\u81ea\u52a8\u751f\u6210\u7684\u4ee4\u724c\uff0c\u5219\u53ea\u9700\u6355\u6349\u7528\u6237\u7684 `post_save` \u4fe1\u53f7\u5373\u53ef\u3002\r\n\r\n``` python\r\nfrom django.conf import settings\r\nfrom django.db.models.signals import post_save\r\nfrom django.dispatch import receiver\r\nfrom rest_framework.authtoken.models import Token\r\n\r\n@receiver(post_save, sender=settings.AUTH_USER_MODEL)\r\ndef create_auth_token(sender, instance=None, created=False, **kwargs):\r\n    if created:\r\n        Token.objects.create(user=instance)\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u60a8\u9700\u8981\u786e\u4fdd\u5c06\u6b64\u4ee3\u7801\u7247\u6bb5\u653e\u7f6e\u5728\u5df2\u5b89\u88c5\u7684 `models.py` \u6a21\u5757\u6216 Django \u542f\u52a8\u65f6\u5c06\u5bfc\u5165\u7684\u5176\u4ed6\u67d0\u4e2a\u4f4d\u7f6e\u3002\r\n\r\n\u5982\u679c\u60a8\u5df2\u7ecf\u521b\u5efa\u4e86\u4e00\u4e9b\u7528\u6237\uff0c\u5219\u53ef\u4ee5\u4e3a\u6240\u6709\u73b0\u6709\u7528\u6237\u751f\u6210\u4ee4\u724c\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom django.contrib.auth.models import User\r\nfrom rest_framework.authtoken.models import Token\r\n\r\nfor user in User.objects.all():\r\n    Token.objects.get_or_create(user=user)\r\n```\r\n\r\n##### \u901a\u8fc7\u66b4\u9732\u4e00\u4e2a API \u7aef\u70b9\r\n\r\n\u4f7f\u7528 `TokenAuthentication` \u65f6\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u4e3a\u5ba2\u6237\u63d0\u4f9b\u4e00\u79cd\u673a\u5236\uff0c\u4ee5\u83b7\u53d6\u7ed9\u5b9a\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\u4ee4\u724c\u3002  REST framework \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5185\u7f6e\u7684\u89c6\u56fe\u6765\u652f\u6301\u8fd9\u79cd\u884c\u4e3a\u3002\u8981\u4f7f\u7528\u5b83\uff0c\u8bf7\u5c06 `obtain_auth_token` \u89c6\u56fe\u6dfb\u52a0\u5230\u60a8\u7684 URLconf \u4e2d\uff1a\r\n\r\n``` python\r\nfrom rest_framework.authtoken import views\r\nurlpatterns += [\r\n    url(r'^api-token-auth/', views.obtain_auth_token)\r\n]\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u6a21\u5f0f\u7684 URL \u90e8\u5206\u53ef\u4ee5\u662f\u4efb\u4f55\u4f60\u60f3\u4f7f\u7528\u7684\u3002\r\n\r\n\u5f53\u4f7f\u7528\u8868\u5355\u6570\u636e\u6216 JSON \u5c06\u6709\u6548\u7684 `username` \u548c `password` \u5b57\u6bb5\u53d1\u5e03\u5230\u89c6\u56fe\u65f6\uff0c `obtain_auth_token` \u89c6\u56fe\u5c06\u8fd4\u56de JSON \u54cd\u5e94\uff1a\r\n\r\n``` python\r\n{ 'token' : '9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b' }\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u7f3a\u7701\u7684 `obtain_auth_token` \u89c6\u56fe\u663e\u5f0f\u4f7f\u7528 JSON \u8bf7\u6c42\u548c\u54cd\u5e94\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u4f60\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u7684\u6e32\u67d3\u5668\u548c\u89e3\u6790\u5668\u7c7b\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u6743\u9650\u6216\u9650\u5236\u5e94\u7528\u4e8e `obtain_auth_token` \u89c6\u56fe\u3002 \u5982\u679c\u60a8\u5e0c\u671b\u5e94\u7528 throttling \uff0c\u5219\u9700\u8981\u91cd\u5199\u89c6\u56fe\u7c7b\uff0c\u5e76\u4f7f\u7528 `throttle_classes` \u5c5e\u6027\u5305\u542b\u5b83\u4eec\u3002\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u81ea\u5b9a\u4e49 `obtain_auth_token` \u89c6\u56fe\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f `ObtainAuthToken` \u89c6\u56fe\u7c7b\u6765\u5b9e\u73b0\uff0c\u5e76\u5728\u4f60\u7684 url conf \u4e2d\u4f7f\u7528\u5b83\u3002\r\n\r\n\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u4f1a\u8fd4\u56de\u8d85\u51fa `token` \u503c\u7684\u5176\u4ed6\u7528\u6237\u4fe1\u606f\uff1a\r\n\r\n``` python\r\nfrom rest_framework.authtoken.views import ObtainAuthToken\r\nfrom rest_framework.authtoken.models import Token\r\nfrom rest_framework.response import Response\r\n\r\nclass CustomAuthToken(ObtainAuthToken):\r\n\r\n    def post(self, request, *args, **kwargs):\r\n        serializer = self.serializer_class(data=request.data,\r\n                                           context={'request': request})\r\n        serializer.is_valid(raise_exception=True)\r\n        user = serializer.validated_data['user']\r\n        token, created = Token.objects.get_or_create(user=user)\r\n        return Response({\r\n            'token': token.key,\r\n            'user_id': user.pk,\r\n            'email': user.email\r\n        })\r\n```\r\n\r\n\u8fd8\u6709 `urls.py`:\r\n\r\n``` python\r\nurlpatterns += [\r\n    url(r'^api-token-auth/', CustomAuthToken.as_view())\r\n]\r\n```\r\n\r\n\r\n##### \u4f7f\u7528 Django admin\r\n\r\n\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ba1\u7406\u754c\u9762\u624b\u52a8\u521b\u5efa\u4ee4\u724c\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u7528\u6237\u7fa4\u5f88\u5927\uff0c\u6211\u4eec\u5efa\u8bae\u60a8\u5bf9 `TokenAdmin` \u7c7b\u8fdb\u884c\u4fee\u8865\u4ee5\u6839\u636e\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u5b9a\u5236\uff0c\u66f4\u5177\u4f53\u5730\u8bf4\uff0c\u5c06 `user` \u5b57\u6bb5\u58f0\u660e\u4e3a `raw_field`\u3002\r\n\r\n`your_app/admin.py`:\r\n\r\n``` python\r\nfrom rest_framework.authtoken.admin import TokenAdmin\r\n\r\nTokenAdmin.raw_id_fields = ('user',)\r\n```\r\n\r\n\r\n#### \u4f7f\u7528 Django manage.py \u547d\u4ee4\r\n\r\n\u4ece\u7248\u672c 3.6.4 \u5f00\u59cb\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u751f\u6210\u7528\u6237\u4ee4\u724c\uff1a\r\n\r\n``` python\r\n./manage.py drf_create_token <username>\r\n```\r\n\r\n\u6b64\u547d\u4ee4\u5c06\u8fd4\u56de\u7ed9\u5b9a\u7528\u6237\u7684 API \u4ee4\u724c\uff0c\u5982\u679c\u5b83\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u5b83\uff1a\r\n\r\n``` python\r\nGenerated token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b for user user1\r\n```\r\n\r\n\u5982\u679c\u60a8\u60f3\u91cd\u65b0\u751f\u6210\u4ee4\u724c\uff08\u4f8b\u5982\uff0c\u5b83\u5df2\u88ab\u6cc4\u6f0f\uff09\uff0c\u5219\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u9644\u52a0\u53c2\u6570\uff1a\r\n\r\n``` python\r\n./manage.py drf_create_token -r <username>\r\n```\r\n\r\n\r\n## SessionAuthentication\r\n\r\n\u6b64\u8ba4\u8bc1\u65b9\u6848\u4f7f\u7528 Django \u7684\u9ed8\u8ba4 session \u540e\u7aef\u8fdb\u884c\u8ba4\u8bc1\u3002Session \u8eab\u4efd\u9a8c\u8bc1\u9002\u7528\u4e8e\u4e0e\u60a8\u7684\u7f51\u7ad9\u5728\u540c\u4e00\u4f1a\u8bdd\u73af\u5883\u4e2d\u8fd0\u884c\u7684 AJAX \u5ba2\u6237\u7aef\u3002\r\n\r\n\u5982\u679c\u6210\u529f\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5219 `SessionAuthentication` \u4f1a\u63d0\u4f9b\u4ee5\u4e0b\u51ed\u636e\u3002\r\n\r\n* `request.user` \u662f\u4e00\u4e2a Django `User` \u5b9e\u4f8b.\r\n* `request.auth` \u662f `None`.\r\n\r\n\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u54cd\u5e94\u88ab\u62d2\u7edd\u5c06\u5bfc\u81f4 `HTTP 403 Forbidden` \u54cd\u5e94\u3002\r\n\r\n\u5982\u679c\u60a8\u5728 SessionAuthentication \u4e2d\u4f7f\u7528 AJAX \u98ce\u683c\u7684 API\uff0c\u5219\u9700\u8981\u786e\u4fdd\u4e3a\u4efb\u4f55 \u201c\u4e0d\u5b89\u5168\u201d \u7684 HTTP \u65b9\u6cd5\u8c03\u7528\uff08\u4f8b\u5982 `PUT`\uff0c`PATCH`\uff0c`POST` \u6216 `DELETE` \u8bf7\u6c42\uff09\u5305\u542b\u6709\u6548\u7684 CSRF \u4ee4\u724c\u3002\r\n\r\n**\u8b66\u544a**: \u521b\u5efa\u767b\u5f55\u9875\u9762\u65f6\u5e94\u8be5\u59cb\u7ec8\u4f7f\u7528 Django \u7684\u6807\u51c6\u767b\u5f55\u89c6\u56fe\u3002\u8fd9\u5c06\u786e\u4fdd\u60a8\u7684\u767b\u5f55\u89c6\u56fe\u5f97\u5230\u9002\u5f53\u7684\u4fdd\u62a4\u3002\r\n\r\nREST framework \u4e2d\u7684 CSRF \u9a8c\u8bc1\u4e0e\u6807\u51c6 Django \u7565\u6709\u4e0d\u540c\uff0c\u56e0\u4e3a\u9700\u8981\u540c\u65f6\u652f\u6301\u57fa\u4e8e session \u548c\u975e\u57fa\u4e8e session \u7684\u8eab\u4efd\u9a8c\u8bc1\u3002\u8fd9\u610f\u5473\u7740\u53ea\u6709\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u624d\u9700\u8981 CSRF \u4ee4\u724c\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u6ca1\u6709 CSRF \u4ee4\u724c\u7684\u60c5\u51b5\u4e0b\u53d1\u9001\u533f\u540d\u8bf7\u6c42\u3002\u6b64\u884c\u4e3a\u4e0d\u9002\u7528\u4e8e\u5e94\u59cb\u7ec8\u5e94\u7528 CSRF \u9a8c\u8bc1\u7684\u767b\u5f55\u89c6\u56fe\u3002\r\n\r\n\r\n## RemoteUserAuthentication\r\n\r\n\u8fd9\u79cd\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u5141\u8bb8\u60a8\u5c06\u8eab\u4efd\u9a8c\u8bc1\u59d4\u6258\u7ed9\u60a8\u7684 Web \u670d\u52a1\u5668\uff0c\u8be5\u670d\u52a1\u5668\u8bbe\u7f6e `REMOTE_USER` \u73af\u5883\u53d8\u91cf\u3002\r\n\r\n\u8981\u4f7f\u7528\u5b83\uff0c\u4f60\u5fc5\u987b\u5728\u4f60\u7684 `AUTHENTICATION_BACKENDS` \u8bbe\u7f6e\u4e2d\u6709 `django.contrib.auth.backends.RemoteUserBackend` \uff08\u6216\u8005\u4e00\u4e2a\u5b50\u7c7b\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c`RemoteUserBackend` \u4e3a\u4e0d\u5b58\u5728\u7684\u7528\u6237\u540d\u521b\u5efa `User` \u5bf9\u8c61\u3002\u8981\u6539\u53d8\u8fd9\u4e2a\u548c\u5176\u4ed6\u884c\u4e3a\uff0c\u8bf7\u53c2\u8003 Django \u6587\u6863\u3002\r\n\r\n\u5982\u679c\u6210\u529f\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c`RemoteUserAuthentication` \u5c06\u63d0\u4f9b\u4ee5\u4e0b\u51ed\u636e\uff1a\r\n\r\n* `request.user` \u662f\u4e00\u4e2a Django `User` \u5b9e\u4f8b.\r\n* `request.auth` \u662f `None`.\r\n\r\n\u6709\u5173\u914d\u7f6e\u9a8c\u8bc1\u65b9\u6cd5\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u60a8\u7684 Web \u670d\u52a1\u5668\u7684\u6587\u6863\uff0c\u4f8b\u5982\uff1a\r\n\r\n* [Apache Authentication How-To](https://httpd.apache.org/docs/2.4/howto/auth.html)\r\n* [NGINX (Restricting Access)](https://www.nginx.com/resources/admin-guide/#restricting_access)\r\n\r\n\r\n# \u81ea\u5b9a\u4e49\u8eab\u4efd\u8ba4\u8bc1\r\n\r\n\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\uff0c\u8bf7\u7ee7\u627f `BaseAuthentication` \u5e76\u91cd\u5199 `.authenticate(self, request)` \u65b9\u6cd5\u3002\u5982\u679c\u8ba4\u8bc1\u6210\u529f\uff0c\u8be5\u65b9\u6cd5\u5e94\u8fd4\u56de `(user, auth)` \u7684\u4e8c\u5143\u7ec4\uff0c\u5426\u5219\u8fd4\u56de `None`\u3002\r\n\r\n\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u60f3\u8981\u4ece `.authenticate()` \u65b9\u6cd5\u5f15\u53d1 `AuthenticationFailed` \u5f02\u5e38\u800c\u4e0d\u662f\u8fd4\u56de `None`\u3002\r\n\r\n\u901a\u5e38\u4f60\u5e94\u8be5\u91c7\u53d6\u7684\u65b9\u6cd5\u662f\uff1a\r\n\r\n* \u5982\u679c\u4e0d\u5c1d\u8bd5\u8ba4\u8bc1\uff0c\u5219\u8fd4\u56de `None`\u3002\u4efb\u4f55\u5176\u4ed6\u6b63\u5728\u4f7f\u7528\u7684\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u4ecd\u5c06\u88ab\u68c0\u67e5\u3002\r\n* \u5982\u679c\u5c1d\u8bd5\u8eab\u4efd\u9a8c\u8bc1\u4f46\u5931\u8d25\u4e86\uff0c\u8bf7\u5f15\u53d1 `AuthenticationFailed` \u5f02\u5e38\u3002\u65e0\u8bba\u662f\u5426\u8fdb\u884c\u4efb\u4f55\u6743\u9650\u68c0\u67e5\uff0c\u90fd\u5c06\u7acb\u5373\u8fd4\u56de\u9519\u8bef\u54cd\u5e94\uff0c\u5e76\u4e14\u4e0d\u518d\u68c0\u67e5\u4efb\u4f55\u5176\u4ed6\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u3002\r\n\r\n\u60a8\u4e5f *\u53ef\u4ee5* \u91cd\u5199 `.authenticate_header(self, request)` \u65b9\u6cd5\u3002\u5982\u679c\u5b9e\u73b0\uff0c\u5b83\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u5c06\u7528\u4f5c `HTTP 401 Unauthorized` \u54cd\u5e94\u4e2d\u7684 WWW-Authenticate header \u7684\u503c\u3002\r\n\r\n\u5982\u679c\u672a\u8986\u76d6 `.authenticate_header()` \u65b9\u6cd5\uff0c\u90a3\u4e48\u5f53\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u88ab\u62d2\u7edd\u8bbf\u95ee\u65f6\uff0c\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u5c06\u8fd4\u56de `HTTP 403 Forbidden` \u54cd\u5e94\u3002\r\n\r\n---\r\n\r\n**Note:** \u5f53\u8bf7\u6c42\u5bf9\u8c61\u7684 `.user` \u6216 `.auth` \u5c5e\u6027\u8c03\u7528\u60a8\u7684\u81ea\u5b9a\u4e49\u8eab\u4efd\u9a8c\u8bc1\u5668\u65f6\uff0c\u60a8\u53ef\u80fd\u4f1a\u770b\u5230 `AttributeError` \u4f5c\u4e3a `WrappedAttributeError` \u88ab\u91cd\u65b0\u5f15\u53d1\u3002\u8fd9\u5bf9\u4e8e\u9632\u6b62\u539f\u59cb\u5f02\u5e38\u88ab\u5916\u90e8\u5c5e\u6027\u8bbf\u95ee\u6240\u6291\u5236\u662f\u5fc5\u8981\u7684\u3002Python \u4e0d\u4f1a\u8bc6\u522b `AttributeError` \u6765\u81ea\u60a8\u7684\u81ea\u5b9a\u4e49\u8eab\u4efd\u9a8c\u8bc1\u5668\uff0c\u800c\u662f\u4f1a\u5047\u8bbe\u8bf7\u6c42\u5bf9\u8c61\u6ca1\u6709 `.user` \u6216 `.auth` \u5c5e\u6027\u3002\u8fd9\u4e9b\u9519\u8bef\u5e94\u8be5\u7531\u60a8\u7684\u9a8c\u8bc1\u5668\u4fee\u590d\u6216\u4ee5\u5176\u4ed6\u65b9\u5f0f\u5904\u7406\u3002\r\n\r\n---\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4e0b\u9762\u7684\u793a\u4f8b\u5c06\u6839\u636e\u540d\u4e3a \u201cX_USERNAME\u201d \u7684\u81ea\u5b9a\u4e49\u8bf7\u6c42\u5934\u4e2d\u7684\u7528\u6237\u540d\u5bf9\u4efb\u4f55\u4f20\u5165\u8bf7\u6c42\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\r\n\r\n``` python\r\nfrom django.contrib.auth.models import User\r\nfrom rest_framework import authentication\r\nfrom rest_framework import exceptions\r\n\r\nclass ExampleAuthentication(authentication.BaseAuthentication):\r\n    def authenticate(self, request):\r\n        username = request.META.get('X_USERNAME')\r\n        if not username:\r\n            return None\r\n\r\n        try:\r\n            user = User.objects.get(username=username)\r\n        except User.DoesNotExist:\r\n            raise exceptions.AuthenticationFailed('No such user')\r\n\r\n        return (user, None)\r\n```\r\n\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/authentication.md", "create_date": "2020-02-20T13:10:40.492", "order": 12}}, {"model": "subject.chapter", "pk": 145, "fields": {"title": "\u5185\u5bb9\u534f\u5546content-negotiation", "topic": 7, "md5": "4e0770f0210e5d166a4249e8ac1dd36a", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/content-negotiation/)  \r\n\r\n# \u5185\u5bb9\u534f\u5546\r\n\r\n\r\n\u5185\u5bb9\u534f\u5546\u662f\u57fa\u4e8e\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u504f\u597d\u9009\u62e9\u591a\u79cd\u53ef\u80fd\u7684\u8868\u793a\u4e4b\u4e00\u4ee5\u8fd4\u56de\u5ba2\u6237\u7aef\u7684\u8fc7\u7a0b\u3002\r\n\r\n## \u786e\u5b9a\u63a5\u53d7\u7684\u6e32\u67d3\u5668\r\n\r\nREST framework \u6839\u636e\u53ef\u7528\u7684\u6e32\u67d3\u5668\uff0c\u6bcf\u4e2a\u6e32\u67d3\u5668\u7684\u4f18\u5148\u7ea7\u4ee5\u53ca\u5ba2\u6237\u7aef\u7684 `Accept:` header\uff0c\u4f7f\u7528\u7b80\u5355\u7684\u5185\u5bb9\u534f\u5546\u98ce\u683c\u6765\u786e\u5b9a\u5e94\u5c06\u54ea\u4e9b\u5a92\u4f53\u7c7b\u578b\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u6240\u4f7f\u7528\u7684\u98ce\u683c\u90e8\u5206\u7531\u5ba2\u6237\u7aef\u9a71\u52a8\uff0c\u90e8\u5206\u7531\u670d\u52a1\u5668\u9a71\u52a8\u3002\r\n\r\n1. \u66f4\u5177\u4f53\u7684\u5a92\u4f53\u7c7b\u578b\u4f18\u5148\u4e8e\u8f83\u4e0d\u7279\u5b9a\u7684\u5a92\u4f53\u7c7b\u578b\u3002\r\n2. \u5982\u679c\u591a\u79cd\u5a92\u4f53\u7c7b\u578b\u5177\u6709\u76f8\u540c\u7684\u7279\u6027\uff0c\u5219\u4f18\u5148\u6839\u636e\u4e3a\u7ed9\u5b9a\u89c6\u56fe\u914d\u7f6e\u7684\u6e32\u67d3\u5668\u6392\u5e8f\u3002\r\n\r\n\u4f8b\u5982\uff0c\u7ed9\u51fa\u4ee5\u4e0b `Accept` header:\r\n\r\n``` python\r\napplication/json; indent=4, application/json, application/yaml, text/html, */*\r\n```\r\n\r\n\u6bcf\u79cd\u7ed9\u5b9a\u5a92\u4f53\u7c7b\u578b\u7684\u4f18\u5148\u7ea7\u4e3a\uff1a\r\n\r\n* `application/json; indent=4`\r\n* `application/json`, `application/yaml` \u548c `text/html`\r\n* `*/*`\r\n\r\n\u5982\u679c\u6240\u8bf7\u6c42\u7684\u89c6\u56fe\u4ec5\u7528 `YAML` \u548c `HTML` \u7684\u6e32\u67d3\u5668\u914d\u7f6e\uff0c\u5219 REST framework \u5c06\u9009\u62e9 `renderer_classes` \u5217\u8868\u6216 `DEFAULT_RENDERER_CLASSES` \u8bbe\u7f6e\u4e2d\u9996\u5148\u5217\u51fa\u7684\u6e32\u67d3\u5668\u3002\r\n\r\n\r\n---\r\n\r\n**\u6ce8\u610f**:  \u786e\u5b9a\u504f\u597d\u65f6\uff0cREST framework \u4e0d\u4f1a\u8003\u8651 \"q\" \u503c\u3002\u4f7f\u7528 \"q\" \u503c\u4f1a\u5bf9\u7f13\u5b58\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\uff0c\u4f5c\u8005\u8ba4\u4e3a\u8fd9\u662f\u5bf9\u5185\u5bb9\u534f\u5546\u7684\u4e00\u79cd\u4e0d\u5fc5\u8981\u548c\u8fc7\u4e8e\u590d\u6742\u7684\u65b9\u6cd5\u3002\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u5185\u5bb9\u534f\u5546\r\n\r\n\u4f60\u4e0d\u592a\u53ef\u80fd\u5e0c\u671b\u4e3a REST framework \u63d0\u4f9b\u81ea\u5b9a\u4e49\u5185\u5bb9\u534f\u5546\u65b9\u6848\uff0c\u4f46\u5982\u679c\u9700\u8981\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u505a\u3002\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u5185\u5bb9\u534f\u5546\u65b9\u6848\uff0c\u8bf7\u8986\u76d6 `BaseContentNegotiation`\u3002\r\n\r\nREST framework \u7684\u5185\u5bb9\u534f\u5546\u7c7b\u5904\u7406\u9009\u62e9\u9002\u5f53\u7684\u8bf7\u6c42\u89e3\u6790\u5668\u548c\u9002\u5f53\u7684\u54cd\u5e94\u6e32\u67d3\u5668\uff0c\u56e0\u6b64\u4f60\u5e94\u8be5\u5b9e\u73b0 `.select_parser(request, parsers)` \u548c `.select_renderer(request, renderers, format_suffix)` \u65b9\u6cd5\u3002\r\n\r\n`select_parser()` \u65b9\u6cd5\u5e94\u4ece\u53ef\u7528\u89e3\u6790\u5668\u5217\u8868\u4e2d\u8fd4\u56de\u4e00\u4e2a\u89e3\u6790\u5668\u5b9e\u4f8b\uff0c\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u89e3\u6790\u5668\u53ef\u4ee5\u5904\u7406\u4f20\u5165\u8bf7\u6c42\uff0c\u5219\u8fd4\u56de `None`\u3002\r\n\r\n`select_renderer()` \u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de\uff08\u6e32\u67d3\u5668\u5b9e\u4f8b\uff0c\u5a92\u4f53\u7c7b\u578b\uff09\u7684\u4e8c\u5143\u7ec4\uff0c\u6216\u5f15\u53d1 `NotAcceptable` \u5f02\u5e38\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4ee5\u4e0b\u662f\u81ea\u5b9a\u4e49\u5185\u5bb9\u534f\u5546\u7c7b\uff0c\u5b83\u5728\u9009\u62e9\u9002\u5f53\u7684\u89e3\u6790\u5668\u6216\u6e32\u67d3\u5668\u65f6\u4f1a\u5ffd\u7565\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002\r\n\r\n``` python\r\nfrom rest_framework.negotiation import BaseContentNegotiation\r\n\r\nclass IgnoreClientContentNegotiation(BaseContentNegotiation):\r\n    def select_parser(self, request, parsers):\r\n        \"\"\"\r\n        Select the first parser in the `.parser_classes` list.\r\n        \"\"\"\r\n        return parsers[0]\r\n\r\n    def select_renderer(self, request, renderers, format_suffix):\r\n        \"\"\"\r\n        Select the first renderer in the `.renderer_classes` list.\r\n        \"\"\"\r\n        return (renderers[0], renderers[0].media_type)\r\n```\r\n\r\n## \u8bbe\u7f6e\u5185\u5bb9\u534f\u5546\r\n\r\n\u9ed8\u8ba4\u5185\u5bb9\u534f\u5546\u7c7b\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_CONTENT_NEGOTIATION_CLASS` setting \u5168\u5c40\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8bbe\u7f6e\u5c06\u4f7f\u7528\u6211\u4eec\u7684\u793a\u4f8b `IgnoreClientContentNegotiation` \u7c7b\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_CONTENT_NEGOTIATION_CLASS': 'myapp.negotiation.IgnoreClientContentNegotiation',\r\n}\r\n```\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 `API\u200b\u200bView` \u57fa\u4e8e\u7c7b\u7684\u89c6\u56fe\u8bbe\u7f6e\u7528\u4e8e\u5355\u4e2a\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u7684\u5185\u5bb9\u534f\u5546\u3002\r\n\r\n``` python\r\nfrom myapp.negotiation import IgnoreClientContentNegotiation\r\nfrom rest_framework.response import Response\r\nfrom rest_framework.views import APIView\r\n\r\nclass NoNegotiationView(APIView):\r\n    \"\"\"\r\n    An example view that does not perform content negotiation.\r\n    \"\"\"\r\n    content_negotiation_class = IgnoreClientContentNegotiation\r\n\r\n    def get(self, request, format=None):\r\n        return Response({\r\n            'accepted media type': request.accepted_renderer.media_type\r\n        })\r\n```", "md_File": "subject/django-rest-framework-api-guide/content-negotiation.md", "create_date": "2020-02-20T13:10:40.504", "order": 19}}, {"model": "subject.chapter", "pk": 146, "fields": {"title": "\u5f02\u5e38exceptions", "topic": 7, "md5": "734f1709400be1322da77eb58deaca94", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/exceptions/)  \r\n\r\n\r\n# \u5f02\u5e38\r\n\r\n\r\n\r\n## REST framework \u89c6\u56fe\u4e2d\u7684\u5f02\u5e38\u5904\u7406\r\n\r\nREST framework \u7684\u89c6\u56fe\u5904\u7406\u5404\u79cd\u5f02\u5e38\uff0c\u5e76\u8fd4\u56de\u9002\u5f53\u7684\u9519\u8bef\u54cd\u5e94\u3002\r\n\r\n\u9700\u8981\u5904\u7406\u7684\u5f02\u5e38\u60c5\u51b5\u6709\uff1a\r\n\r\n* \u5728 REST framework \u5185\u5f15\u53d1\u7684 `APIException`\u7684\u5b50\u7c7b\u3002\r\n* Django \u7684 `Http404` \u5f02\u5e38\u3002\r\n* Django \u7684 `PermissionDenied` \u5f02\u5e38\u3002\r\n\r\n\u5728\u6bcf\u79cd\u60c5\u51b5\u4e0b\uff0cREST framework \u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709\u9002\u5f53\u72b6\u6001\u7801\u548c\u5185\u5bb9\u7c7b\u578b\u7684\u54cd\u5e94\u3002\u54cd\u5e94\u7684\u4e3b\u4f53\u5c06\u5305\u542b\u6709\u5173\u9519\u8bef\u6027\u8d28\u7684\u5176\u4ed6\u7ec6\u8282\u3002\r\n\r\n\u5927\u591a\u6570\u9519\u8bef\u54cd\u5e94\u5c06\u5305\u542b\u54cd\u5e94\u6b63\u6587\u4e2d\u7684\u5173\u952e `detail`\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8bf7\u6c42\uff1a\r\n\r\n```\r\nDELETE http://api.example.com/foo/bar HTTP/1.1\r\nAccept: application/json\r\n```\r\n\r\n\u53ef\u80fd\u4f1a\u6536\u5230\u9519\u8bef\u54cd\u5e94\uff0c\u6307\u51fa\u5728\u8be5\u8d44\u6e90\u4e0a\u4e0d\u5141\u8bb8\u4f7f\u7528 `DELETE` \u65b9\u6cd5\uff1a\r\n\r\n```\r\nHTTP/1.1 405 Method Not Allowed\r\nContent-Type: application/json\r\nContent-Length: 42\r\n\r\n{\"detail\": \"Method 'DELETE' not allowed.\"}\r\n```\r\n\r\n\u9a8c\u8bc1\u9519\u8bef\u7684\u5904\u7406\u65b9\u5f0f\u7a0d\u6709\u4e0d\u540c\uff0c\u4f46\u90fd\u662f\u5c06\u5b57\u6bb5\u540d\u79f0\u4f5c\u4e3a\u54cd\u5e94\u4e2d\u7684\u5173\u952e\u5b57\u3002\u5982\u679c\u9a8c\u8bc1\u9519\u8bef\u4e0d\u662f\u7279\u5b9a\u4e8e\u67d0\u4e2a\u5b57\u6bb5\u7684\uff0c\u90a3\u4e48\u5b83\u5c06\u4f7f\u7528 \u201cnon_field_errors\u201d \u952e\uff0c\u6216\u8005\u4e3a `NON_FIELD_ERRORS_KEY` setting \u8bbe\u7f6e\u7684\u5b57\u7b26\u4e32\u503c\u3002\r\n\r\n\u793a\u4f8b\u9a8c\u8bc1\u9519\u8bef\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n```\r\nHTTP/1.1 400 Bad Request\r\nContent-Type: application/json\r\nContent-Length: 94\r\n\r\n{\"amount\": [\"A valid integer is required.\"], \"description\": [\"This field may not be blank.\"]}\r\n```\r\n\r\n## \u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\r\n\r\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u5904\u7406\u51fd\u6570\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\uff0c\u8be5\u51fd\u6570\u5c06 API \u89c6\u56fe\u4e2d\u5f15\u53d1\u7684\u5f02\u5e38\u8f6c\u6362\u4e3a\u54cd\u5e94\u5bf9\u8c61\u3002\u8fd9\u4f7f\u4f60\u53ef\u4ee5\u63a7\u5236 API \u9519\u8bef\u54cd\u5e94\u7684\u6837\u5f0f\u3002\r\n\r\n\u8be5\u51fd\u6570\u5fc5\u987b\u5e26\u6709\u4e00\u5bf9\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u8981\u5904\u7406\u7684\u5f02\u5e38\uff0c\u7b2c\u4e8c\u4e2a\u662f\u5305\u542b\u4efb\u4f55\u989d\u5916\u4e0a\u4e0b\u6587\uff08\u4f8b\u5982\u5f53\u524d\u6b63\u5728\u5904\u7406\u7684\u89c6\u56fe\uff09\u7684\u5b57\u5178\u3002\u5f02\u5e38\u5904\u7406\u51fd\u6570\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a `Response` \u5bf9\u8c61\uff0c\u6216\u8005\u5982\u679c\u65e0\u6cd5\u5904\u7406\u5f02\u5e38\uff0c\u5219\u8fd4\u56de `None`\u3002\u5982\u679c\u5904\u7406\u7a0b\u5e8f\u8fd4\u56de `None`\uff0c\u90a3\u4e48\u5f02\u5e38\u5c06\u88ab\u91cd\u65b0\u629b\u51fa\uff0cDjango \u5c06\u8fd4\u56de\u4e00\u4e2a\u6807\u51c6\u7684 HTTP 500 'server error' \u54cd\u5e94\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u786e\u4fdd\u6240\u6709\u9519\u8bef\u54cd\u5e94\u90fd\u5305\u542b\u54cd\u5e94\u6b63\u6587\u4e2d\u7684 HTTP \u72b6\u6001\u7801\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n```\r\nHTTP/1.1 405 Method Not Allowed\r\nContent-Type: application/json\r\nContent-Length: 62\r\n\r\n{\"status_code\": 405, \"detail\": \"Method 'DELETE' not allowed.\"}\r\n```\r\n\r\n\u4e3a\u4e86\u6539\u53d8\u54cd\u5e94\u7684\u98ce\u683c\uff0c\u4f60\u53ef\u4ee5\u7f16\u5199\u4e0b\u9762\u7684\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\uff1a\r\n\r\n``` python\r\nfrom rest_framework.views import exception_handler\r\n\r\ndef custom_exception_handler(exc, context):\r\n    # Call REST framework's default exception handler first,\r\n    # to get the standard error response.\r\n    response = exception_handler(exc, context)\r\n\r\n    # Now add the HTTP status code to the response.\r\n    if response is not None:\r\n        response.data['status_code'] = response.status_code\r\n\r\n    return response\r\n```\r\n\r\ncontext \u53c2\u6570\u4e0d\u88ab\u9ed8\u8ba4\u5904\u7406\u7a0b\u5e8f\u4f7f\u7528\uff0c\u4f46\u662f\u5982\u679c\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u9700\u8981\u66f4\u591a\u4fe1\u606f\uff0c\u4f8b\u5982\u5f53\u524d\u6b63\u5728\u5904\u7406\u7684\u89c6\u56fe\uff08\u53ef\u4ee5\u4f5c\u4e3a `context['view']` \u8bbf\u95ee\uff09\uff0c\u5219\u8be5\u53c2\u6570\u53ef\u80fd\u5f88\u6709\u7528\u3002\r\n\r\n\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u8fd8\u5fc5\u987b\u4f7f\u7528 `EXCEPTION_HANDLER` setting key \u5728\u4f60\u7684\u8bbe\u7f6e\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'EXCEPTION_HANDLER': 'my_project.my_app.utils.custom_exception_handler'\r\n}\r\n```\r\n\r\n\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219 `'EXCEPTION_HANDLER'` setting \u9ed8\u8ba4\u4e3a\u7531 REST framework \u63d0\u4f9b\u7684\u6807\u51c6\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'EXCEPTION_HANDLER': 'rest_framework.views.exception_handler'\r\n}\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u53ea\u4f1a\u6839\u636e\u7531\u5f02\u5e38\u4ea7\u751f\u7684\u54cd\u5e94\u8c03\u7528\u3002\u5b83\u4e0d\u4f1a\u7528\u4e8e\u89c6\u56fe\u76f4\u63a5\u8fd4\u56de\u7684\u4efb\u4f55\u54cd\u5e94\uff0c\u4f8b\u5982\u5728\u5e8f\u5217\u5316\u9a8c\u8bc1\u5931\u8d25\u65f6\u901a\u7528\u89c6\u56fe\u8fd4\u56de\u7684 `HTTP_400_BAD_REQUEST` \u54cd\u5e94\u3002\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## APIException\r\n\r\n**\u7b7e\u540d:** `APIException()`\r\n\r\n\u5728 `APIView` \u7c7b\u6216 `@api_view` \u4e2d\u5f15\u53d1\u7684\u6240\u6709\u5f02\u5e38\u7684\u57fa\u7c7b\u3002\r\n\r\n\u8981\u81ea\u5b9a\u4e49\u5f02\u5e38\uff0c\u8bf7\u7ee7\u627f `APIException`\uff0c\u5e76\u5728\u8be5\u7c7b\u4e0a\u8bbe\u7f6e `.status_code`\uff0c`.default_detail` \u548c `default_code` \u5c5e\u6027\u3002\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u7684 API \u4f9d\u8d56\u4e8e\u53ef\u80fd\u65e0\u6cd5\u8bbf\u95ee\u7684\u7b2c\u4e09\u65b9\u670d\u52a1\uff0c\u5219\u53ef\u80fd\u9700\u8981\u4e3a \"503 Service Unavailable\" HTTP \u54cd\u5e94\u7801\u5c01\u88c5\u5f02\u5e38\u3002\u4f60\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a\r\n\r\n``` python\r\nfrom rest_framework.exceptions import APIException\r\n\r\nclass ServiceUnavailable(APIException):\r\n    status_code = 503\r\n    default_detail = 'Service temporarily unavailable, try again later.'\r\n    default_code = 'service_unavailable'\r\n```\r\n\r\n#### \u68c0\u67e5 API \u5f02\u5e38\r\n\r\n\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u5c5e\u6027\u53ef\u7528\u4e8e\u68c0\u67e5 API \u5f02\u5e38\u7684\u72b6\u6001\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u4e3a\u4f60\u7684\u9879\u76ee\u6784\u5efa\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u3002\r\n\r\n\u53ef\u7528\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u6709\uff1a\r\n\r\n* `.detail` - \u8fd4\u56de\u9519\u8bef\u7684\u6587\u672c\u63cf\u8ff0\u3002\r\n* `.get_codes()` - \u8fd4\u56de\u9519\u8bef\u7684\u4ee3\u7801\u6807\u8bc6\u7b26\u3002\r\n* `.get_full_details()` - \u8fd4\u56de\u6587\u672c\u63cf\u8ff0\u548c\u4ee3\u7801\u6807\u8bc6\u7b26\u3002\r\n\r\n\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u9519\u8bef\u8be6\u60c5\u5c06\u662f\u4e00\u4e2a\u7b80\u5355\u7684 item\uff1a\r\n\r\n``` bash\r\n>>> print(exc.detail)\r\nYou do not have permission to perform this action.\r\n>>> print(exc.get_codes())\r\npermission_denied\r\n>>> print(exc.get_full_details())\r\n{'message':'You do not have permission to perform this action.','code':'permission_denied'}\r\n```\r\n\r\n\u5728\u9a8c\u8bc1\u9519\u8bef\u7684\u60c5\u51b5\u4e0b\uff0c\u9519\u8bef\u8be6\u60c5\u5c06\u662f item \u5217\u8868\u6216\u5b57\u5178\uff1a\r\n\r\n``` bash\r\n>>> print(exc.detail)\r\n{\"name\":\"This field is required.\",\"age\":\"A valid integer is required.\"}\r\n>>> print(exc.get_codes())\r\n{\"name\":\"required\",\"age\":\"invalid\"}\r\n>>> print(exc.get_full_details())\r\n{\"name\":{\"message\":\"This field is required.\",\"code\":\"required\"},\"age\":{\"message\":\"A valid integer is required.\",\"code\":\"invalid\"}}\r\n```\r\n\r\n## ParseError\r\n\r\n**\u7b7e\u540d:** `ParseError(detail=None, code=None)`\r\n\r\n\u5728\u8bbf\u95ee `request.data` \u65f6\u5305\u542b\u683c\u5f0f\u9519\u8bef\u7684\u6570\u636e\u5219\u4f1a\u5f15\u53d1\u6b64\u5f02\u5e38\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801 \"400 Bad Request\" \u7684\u54cd\u5e94\u3002\r\n\r\n## AuthenticationFailed\r\n\r\n**\u7b7e\u540d:** `AuthenticationFailed(detail=None, code=None)`\r\n\r\n\u5f53\u4f20\u5165\u7684\u8bf7\u6c42\u5305\u542b\u4e0d\u6b63\u786e\u7684\u8eab\u4efd\u9a8c\u8bc1\u65f6\u5f15\u53d1\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801 \"401 Unauthenticated\" \u7684\u54cd\u5e94\uff0c\u4f46\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4 \"403 Forbidden\" \u54cd\u5e94\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u6240\u4f7f\u7528\u7684\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u3002\r\n\r\n## NotAuthenticated\r\n\r\n**\u7b7e\u540d:** `NotAuthenticated(detail=None, code=None)`\r\n\r\n\u5f53\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u672a\u901a\u8fc7\u6743\u9650\u68c0\u67e5\u65f6\u5f15\u53d1\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801 \"401 Unauthenticated\" \u7684\u54cd\u5e94\uff0c\u4f46\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4 \"403 Forbidden\" \u54cd\u5e94\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u6240\u4f7f\u7528\u7684\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u3002\r\n\r\n## PermissionDenied\r\n\r\n**\u7b7e\u540d:** `PermissionDenied(detail=None, code=None)`\r\n\r\n\u5f53\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u672a\u901a\u8fc7\u6743\u9650\u68c0\u67e5\u65f6\u5f15\u53d1\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801 \"403 Forbidden\" \u7684\u54cd\u5e94\u3002\r\n\r\n## NotFound\r\n\r\n**\u7b7e\u540d:** `NotFound(detail=None, code=None)`\r\n\r\n\u5f53\u8d44\u6e90\u4e0d\u5b58\u5728\u4e8e\u7ed9\u5b9a\u7684 URL \u65f6\u5f15\u53d1\u3002\u8fd9\u4e2a\u5f02\u5e38\u76f8\u5f53\u4e8e\u6807\u51c6\u7684 `Http404` Django \u5f02\u5e38\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801\u4e3a \"404 Not Found\" \u7684\u54cd\u5e94\u3002\r\n\r\n## MethodNotAllowed\r\n\r\n**\u7b7e\u540d:** `MethodNotAllowed(method, detail=None, code=None)`\r\n\r\n\u5f53\u8bf7\u6c42\u53d1\u751f\u65f6\uff0c\u627e\u4e0d\u5230\u89c6\u56fe\u4e0a\u5bf9\u5e94\u7684\u5904\u7406\u65b9\u6cd5\u65f6\u5f15\u53d1\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801\u4e3a \"405 Method Not Allowed\" \u7684\u54cd\u5e94\u3002\r\n\r\n## NotAcceptable\r\n\r\n**\u7b7e\u540d:** `NotAcceptable(detail=None, code=None)`\r\n\r\n\u5f53\u8bf7\u6c42\u53d1\u751f\u65f6\uff0c\u4efb\u4f55\u53ef\u7528\u6e32\u67d3\u5668\u90fd\u4e0d\u7b26\u5408 `Accept` header \u65f6\u5f15\u53d1\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801\u4e3a \"406 Not Acceptable\" \u7684\u54cd\u5e94\u3002\r\n\r\n## UnsupportedMediaType\r\n\r\n**\u7b7e\u540d:** `UnsupportedMediaType(media_type, detail=None, code=None)`\r\n\r\n\u5982\u679c\u5728\u8bbf\u95ee `request.data` \u65f6\u6ca1\u6709\u53ef\u4ee5\u5904\u7406\u8bf7\u6c42\u6570\u636e\u7684\u5185\u5bb9\u7c7b\u578b\u7684\u89e3\u6790\u5668\uff0c\u5c31\u4f1a\u5f15\u53d1\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801 \"415 Unsupported Media Type\" \u7684\u54cd\u5e94\u3002\r\n\r\n## Throttled\r\n\r\n**\u7b7e\u540d:** `Throttled(wait=None, detail=None, code=None)`\r\n\r\n\u4f20\u5165\u7684\u8bf7\u6c42\u672a\u901a\u8fc7\u9650\u6d41\u68c0\u67e5\u65f6\u5f15\u53d1\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801 \"429 Too Many Requests\" \u7684\u54cd\u5e94\u3002\r\n\r\n## ValidationError\r\n\r\n**\u7b7e\u540d:** `ValidationError(detail, code=None)`\r\n\r\n`ValidationError` \u5f02\u5e38\u4e0e\u5176\u4ed6 `APIException` \u7c7b\u7565\u6709\u4e0d\u540c\uff1a\r\n\r\n* `detail` \u53c2\u6570\u662f\u5fc5\u9700\u7684\uff0c\u4e0d\u662f\u53ef\u9009\u7684\u3002\r\n* `detail` \u53c2\u6570\u53ef\u4ee5\u662f\u9519\u8bef\u8be6\u60c5\u5217\u8868\u6216\u5b57\u5178\uff0c\u4e5f\u53ef\u4ee5\u662f\u5d4c\u5957\u7684\u6570\u636e\u7ed3\u6784\u3002\r\n* \u6309\u7167\u60ef\u4f8b\uff0c\u4f60\u5e94\u8be5\u5bfc\u5165 serializers \u6a21\u5757\u5e76\u4f7f\u7528\u5b8c\u5168\u9650\u5b9a\u7684 `ValidationError` \u6837\u5f0f\uff0c\u4ee5\u533a\u522b\u4e8e Django \u5185\u7f6e\u7684\u9a8c\u8bc1\u9519\u8bef\u3002\u4f8b\u5982\uff1a `raise serializers.ValidationError('This field must be an integer value.')`\r\n\r\n`ValidationError` \u7c7b\u5e94\u8be5\u7528\u4e8e\u5e8f\u5217\u5316\u7c7b\u548c\u5b57\u6bb5\u9a8c\u8bc1\u4ee5\u53ca\u9a8c\u8bc1\u5668\u7c7b\u3002\u4f7f\u7528 `raise_exception` \u5173\u952e\u5b57\u53c2\u6570\u8c03\u7528 `serializer.is_valid` \u65f6\u4e5f\u4f1a\u5f15\u53d1\u6b64\u95ee\u9898\uff1a\r\n\r\n``` python\r\nserializer.is_valid(raise_exception=True)\r\n```\r\n\r\n\u901a\u7528\u89c6\u56fe\u4f7f\u7528 `raise_exception=True` \u6807\u5fd7\uff0c\u610f\u5473\u7740\u4f60\u53ef\u4ee5\u5728 API \u4e2d\u5168\u5c40\u8986\u76d6\u9a8c\u8bc1\u9519\u8bef\u54cd\u5e94\u7684\u6837\u5f0f\u3002\u4e3a\u6b64\uff0c\u8bf7\u4f7f\u7528\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\uff0c\u5982\u4e0a\u6240\u8ff0\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u5f02\u5e38\u4f1a\u5bfc\u81f4 HTTP \u72b6\u6001\u7801 \"400 Bad Request\" \u7684\u54cd\u5e94\u3002\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/exceptions.md", "create_date": "2020-02-20T13:10:40.526", "order": 24}}, {"model": "subject.chapter", "pk": 147, "fields": {"title": "format-suffixes", "topic": 7, "md5": "ebb3a8c4e06a3b4f2700198dbc6afb2e", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/format-suffixes/)  \r\n\r\n# Format \u540e\u7f00\r\n\r\n\r\n\r\nWeb API \u7684\u5e38\u89c1\u6a21\u5f0f\u662f\u5728 URL \u4e0a\u4f7f\u7528\u6587\u4ef6\u6269\u5c55\u540d\u6765\u4e3a\u7ed9\u5b9a\u7684\u5a92\u4f53\u7c7b\u578b\u63d0\u4f9b\u7aef\u70b9\u3002 \u4f8b\u5982\uff0c`'http://example.com/api/users.json'` \u7528\u4e8e\u63d0\u4f9b JSON \u8868\u793a\u3002\r\n\r\n\u5728 URLconf \u4e2d\u4e3a\u4f60\u7684 API \u6dfb\u52a0 format-suffix \u6a21\u5f0f\u662f\u5bb9\u6613\u51fa\u9519\u548c\u975e DRY \u7684\uff0c\u56e0\u6b64 REST framework \u63d0\u4f9b\u4e86\u5c06\u8fd9\u4e9b\u6a21\u5f0f\u6dfb\u52a0\u5230 URLconf \u7684\u5feb\u6377\u65b9\u5f0f\u3002\r\n\r\n## format_suffix_patterns\r\n\r\n**\u7b7e\u540d**: `format_suffix_patterns(urlpatterns, suffix_required=False, allowed=None)`\r\n\r\n\u8fd4\u56de\u4e00\u4e2a URL pattern \u5217\u8868\uff0c\u5176\u4e2d\u5305\u542b\u9644\u52a0\u5230\u6bcf\u4e2a URL pattern \u7684\u683c\u5f0f\u540e\u7f00\u6a21\u5f0f\u3002\r\n\r\n\u53c2\u6570\uff1a\r\n\r\n* **urlpatterns**: \u5fc5\u9700\u3002\u4e00\u4e2a URL pattern \u5217\u8868\u3002\r\n* **suffix_required**:  \u53ef\u9009\u3002\u4e00\u4e2a boolean \u503c\uff0c\u6307\u5b9a URL \u4e2d\u7684\u540e\u7f00\u662f\u5426\u53ef\u9009\u6216\u5f3a\u5236\u3002\u9ed8\u8ba4\u4e3a `False`\uff0c\u8fd9\u610f\u5473\u7740\u540e\u7f00\u9ed8\u8ba4\u662f\u53ef\u9009\u7684\u3002\r\n* **allowed**:  \u53ef\u9009\u3002\u6709\u6548\u683c\u5f0f\u540e\u7f00\u7684\u5217\u8868\u6216\u5143\u7ec4\u3002\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\uff0c\u5c06\u4f7f\u7528\u901a\u914d\u7b26\u683c\u5f0f\u540e\u7f00\u6a21\u5f0f\u3002\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom rest_framework.urlpatterns import format_suffix_patterns\r\nfrom blog import views\r\n\r\nurlpatterns = [\r\n    url(r'^/$', views.apt_root),\r\n    url(r'^comments/$', views.comment_list),\r\n    url(r'^comments/(?P<pk>[0-9]+)/$', views.comment_detail)\r\n]\r\n\r\nurlpatterns = format_suffix_patterns(urlpatterns, allowed=['json', 'html'])\r\n```\r\n\r\n\u5728\u4f7f\u7528 `format_suffix_patterns` \u65f6\uff0c\u4f60\u5fc5\u987b\u786e\u4fdd\u5c06 `'format'` \u5173\u952e\u5b57\u53c2\u6570\u6dfb\u52a0\u5230\u76f8\u5e94\u7684\u89c6\u56fe\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\n@api_view(('GET', 'POST'))\r\ndef comment_list(request, format=None):\r\n    # do stuff...\r\n```\r\n\r\n\u6216\u8005\u57fa\u4e8e\u7c7b\u89c6\u56fe\uff1a\r\n\r\n``` python\r\nclass CommentList(APIView):\r\n    def get(self, request, format=None):\r\n        # do stuff...\r\n\r\n    def post(self, request, format=None):\r\n        # do stuff...\r\n```\r\n\r\n\u6240\u4f7f\u7528\u7684 kwarg \u7684\u540d\u79f0\u53ef\u4ee5\u4f7f\u7528 `FORMAT_SUFFIX_KWARG` setting \u8fdb\u884c\u4fee\u6539\u3002\r\n\r\n\u53e6\u8bf7\u6ce8\u610f\uff0c`format_suffix_patterns` \u4e0d\u652f\u6301\u964d\u5e8f\u5305\u542b URL patterns\u3002\r\n\r\n### \u4e0e `i18n_patterns` \u4e00\u8d77\u4f7f\u7528\r\n\r\n\u5982\u679c\u4f7f\u7528 Django \u63d0\u4f9b\u7684 `i18n_patterns` \u51fd\u6570\u4ee5\u53ca `format_suffix_patterns`\uff0c\u5219\u5e94\u786e\u4fdd\u5c06 `i18n_patterns` \u51fd\u6570\u7528\u4f5c\u6700\u7ec8\u6216\u6700\u5916\u5c42\u51fd\u6570\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nurl patterns = [\r\n    \u2026\r\n]\r\n\r\nurlpatterns = i18n_patterns(\r\n    format_suffix_patterns(urlpatterns, allowed=['json', 'html'])\r\n)\r\n```\r\n\r\n---\r\n\r\n## \u67e5\u8be2\u53c2\u6570 format\r\n\r\n\u683c\u5f0f\u540e\u7f00\u7684\u66ff\u4ee3\u65b9\u6cd5\u662f\u5c06\u8bf7\u6c42\u7684 format \u5305\u542b\u5728\u67e5\u8be2\u53c2\u6570\u4e2d\u3002REST framework \u9ed8\u8ba4\u63d0\u4f9b\u6b64\u9009\u9879\uff0c\u5e76\u4e14\u5b83\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u7528\u4e8e\u5728\u4e0d\u540c\u7684\u53ef\u7528\u8868\u793a\u4e4b\u95f4\u5207\u6362\u3002\r\n\r\n\u8981\u4f7f\u7528\u5176\u77ed\u683c\u5f0f\u8868\u793a\uff0c\u8bf7\u4f7f\u7528 `format` \u67e5\u8be2\u53c2\u6570\u3002\u4f8b\u5982\uff1a `http://example.com/organizations/?format=csv`\u3002\r\n\r\n\u6b64\u67e5\u8be2\u53c2\u6570\u7684\u540d\u79f0\u53ef\u4ee5\u4f7f\u7528 `URL_FORMAT_OVERRIDE` \u8bbe\u7f6e\u8fdb\u884c\u4fee\u6539\u3002\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a `None` \u4ee5\u7981\u7528\u6b64\u884c\u4e3a\u3002\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/format-suffixes.md", "create_date": "2020-02-20T13:10:40.545", "order": 22}}, {"model": "subject.chapter", "pk": 148, "fields": {"title": "\u5143\u6570\u636emetadata", "topic": 7, "md5": "673db4cfbd19d2d0118ef9d6e42cb7af", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/metadata/)  \r\n\r\n\r\n# \u5143\u6570\u636e\r\n\r\n\r\nREST framework \u5305\u542b\u4e00\u4e2a\u53ef\u914d\u7f6e\u7684\u673a\u5236\uff0c\u7528\u4e8e\u786e\u5b9a API \u5982\u4f55\u54cd\u5e94 `OPTIONS` \u8bf7\u6c42\u3002\u8fd9\u4f7f\u4f60\u53ef\u4ee5\u8fd4\u56de API schema \u6216\u5176\u4ed6\u8d44\u6e90\u4fe1\u606f\u3002\r\n\r\n\u5bf9\u4e8e HTTP `OPTIONS` \u8bf7\u6c42\u5e94\u8be5\u8fd4\u56de\u54ea\u79cd\u98ce\u683c\u7684\u54cd\u5e94\uff0c\u76ee\u524d\u8fd8\u6ca1\u6709\u4efb\u4f55\u88ab\u5e7f\u6cdb\u91c7\u7528\u7684\u7ea6\u5b9a\uff0c\u6240\u4ee5\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u79cd\u4e13\u95e8\u7684\u98ce\u683c\u6765\u8fd4\u56de\u4e00\u4e9b\u6709\u7528\u7684\u4fe1\u606f\u3002\r\n\r\n\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\u54cd\u5e94\uff0c\u6f14\u793a\u9ed8\u8ba4\u8fd4\u56de\u7684\u4fe1\u606f\u3002\r\n\r\n``` python\r\nHTTP 200 OK\r\nAllow: GET, POST, HEAD, OPTIONS\r\nContent-Type: application/json\r\n\r\n{\r\n    \"name\": \"To Do List\",\r\n    \"description\": \"List existing 'To Do' items, or create a new item.\",\r\n    \"renders\": [\r\n        \"application/json\",\r\n        \"text/html\"\r\n    ],\r\n    \"parses\": [\r\n        \"application/json\",\r\n        \"application/x-www-form-urlencoded\",\r\n        \"multipart/form-data\"\r\n    ],\r\n    \"actions\": {\r\n        \"POST\": {\r\n            \"note\": {\r\n                \"type\": \"string\",\r\n                \"required\": false,\r\n                \"read_only\": false,\r\n                \"label\": \"title\",\r\n                \"max_length\": 100\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## \u8bbe\u7f6e\u5143\u6570\u636e scheme\r\n\r\n\u4f60\u53ef\u4ee5\u4f7f\u7528 `'DEFAULT_METADATA_CLASS'` settings key \u5168\u5c40\u8bbe\u7f6e\u5143\u6570\u636e\u7c7b\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_METADATA_CLASS': 'rest_framework.metadata.SimpleMetadata'\r\n}\r\n```\r\n\r\n\u6216\u8005\u4f60\u53ef\u4ee5\u5355\u72ec\u8bbe\u7f6e\u4e00\u4e2a\u89c6\u56fe\u7684\u5143\u6570\u636e\u7c7b\uff1a\r\n\r\n``` python\r\nclass APIRoot(APIView):\r\n    metadata_class = APIRootMetadata\r\n\r\n    def get(self, request, format=None):\r\n        return Response({\r\n            ...\r\n        })\r\n```\r\n\r\nREST framework \u5305\u53ea\u5305\u542b\u4e00\u4e2a\u540d\u4e3a `SimpleMetadata` \u7684\u5143\u6570\u636e\u7c7b\u5b9e\u73b0\u3002\u5982\u679c\u4f60\u60f3\u4f7f\u7528\u53e6\u4e00\u79cd\u98ce\u683c\uff0c\u4f60\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5143\u6570\u636e\u7c7b\u3002\r\n\r\n## \u521b\u5efa schema \u7aef\u70b9\r\n\r\n\u5982\u679c\u4f60\u5bf9\u521b\u5efa\u901a\u8fc7\u5e38\u89c4 GET \u8bf7\u6c42\u8bbf\u95ee\u7684 schema \u7aef\u70b9\u6709\u7279\u5b9a\u8981\u6c42\uff0c\u5219\u53ef\u4ee5\u8003\u8651\u91cd\u65b0\u4f7f\u7528\u5143\u6570\u636e API \u6765\u5b9e\u73b0\u6b64\u76ee\u7684\u3002\r\n\r\n\u4f8b\u5982\uff0c\u53ef\u4ee5\u5728\u89c6\u56fe\u96c6\u4e0a\u4f7f\u7528\u4ee5\u4e0b\u9644\u52a0\u8def\u7531\u6765\u63d0\u4f9b\u53ef\u94fe\u63a5\u7684 schema \u7aef\u70b9\u3002\r\n\r\n``` python\r\n@list_route(methods=['GET'])\r\ndef schema(self, request):\r\n    meta = self.metadata_class()\r\n    data = meta.determine_metadata(request, self)\r\n    return Response(data)\r\n```\r\n\r\n\u6709\u51e0\u4e2a\u539f\u56e0\u53ef\u4ee5\u9009\u62e9\u91c7\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u5305\u62ec `OPTIONS` \u54cd\u5e94\u4e0d\u80fd\u7f13\u5b58\u3002\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u5143\u6570\u636e\u7c7b\r\n\r\n\u5982\u679c\u4f60\u60f3\u63d0\u4f9b\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5143\u6570\u636e\u7c7b\uff0c\u4f60\u5e94\u8be5\u7ee7\u627f `BaseMetadata` \u5e76\u4e14\u5b9e\u73b0 `determine_metadata(self, request, view)` \u65b9\u6cd5\u3002\r\n\r\n\u4f60\u53ef\u80fd\u60f3\u8981\u505a\u7684\u4e8b\u60c5\u5305\u62ec\u8fd4\u56de schema \u4fe1\u606f\uff0c\u4f7f\u7528 JSON schema \u7b49\u683c\u5f0f\uff0c\u6216\u5c06\u8c03\u8bd5\u4fe1\u606f\u8fd4\u56de\u7ed9\u7ba1\u7406\u5458\u7528\u6237\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4ee5\u4e0b\u7c7b\u53ef\u7528\u4e8e\u9650\u5b9a\u8fd4\u56de\u5230 `OPTIONS` \u8bf7\u6c42\u7684\u4fe1\u606f\u3002\r\n\r\n``` python\r\nclass MinimalMetadata(BaseMetadata):\r\n    \"\"\"\r\n    Don't include field and other information for `OPTIONS` requests.\r\n    Just return the name and description.\r\n    \"\"\"\r\n    def determine_metadata(self, request, view):\r\n        return {\r\n            'name': view.get_view_name(),\r\n            'description': view.get_view_description()\r\n        }\r\n```\r\n\r\n\u7136\u540e\u914d\u7f6e\u4f60\u7684\u8bbe\u7f6e\u4ee5\u4f7f\u7528\u6b64\u81ea\u5b9a\u4e49\u7c7b\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_METADATA_CLASS': 'myproject.apps.core.MinimalMetadata'\r\n}\r\n```\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/metadata.md", "create_date": "2020-02-20T13:10:40.561", "order": 20}}, {"model": "subject.chapter", "pk": 149, "fields": {"title": "\u5e8f\u5217\u5316\u5b57\u6bb5fields", "topic": 7, "md5": "bc8d8c86efef59f0ec43fcd0f53533cb", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/fields/)\r\n\r\n\r\n# Serializer \u5b57\u6bb5\r\n\r\n> Form \u7c7b\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\u4e0d\u4ec5\u8d1f\u8d23\u9a8c\u8bc1\u6570\u636e\uff0c\u8fd8\u8d1f\u8d23 \u201c\u6e05\u6d17\u201d \u5b83 \u2014 \u5c06\u5176\u89c4\u8303\u5316\u4e3a\u4e00\u81f4\u7684\u683c\u5f0f\u3002  \r\n>\r\n> &mdash; [Django \u6587\u6863][cite]\r\n\r\n\u5e8f\u5217\u5316\u5b57\u6bb5\u5904\u7406\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c\u5176\u4ed6\u6570\u636e\u7c7b\u578b\uff08\u6bd4\u5982\u81ea\u5b9a\u4e49\u7684\u7c7b\uff09\u4e4b\u95f4\u7684\u8f6c\u6362\u3002\u5b83\u4eec\u8fd8\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4ee5\u53ca\u4ece\u5176\u7236\u5bf9\u8c61\u4e2d\u68c0\u7d22\u548c\u8bbe\u7f6e\u503c\u3002\r\n\r\n---\r\n\r\n**\u6ce8\u610f\uff1a** \u5e8f\u5217\u5316\u5b57\u6bb5\u90fd\u58f0\u660e\u5728 `fields.py`  \u4e2d\uff0c\u4f46\u6309\u7167\u60ef\u4f8b\uff0c\u5e94\u8be5\u4f7f\u7528 `from rest_framework import serializers` \uff0c\u5e76\u7528 `serializers.<FieldName>` \u7684\u65b9\u5f0f\u5f15\u7528\u3002\r\n\r\n---\r\n\r\n## \u6838\u5fc3\u53c2\u6570\r\n\r\n\u6bcf\u4e2a\u5e8f\u5217\u5316\u5b57\u6bb5\u7c7b\u7684\u6784\u9020\u51fd\u6570\u90fd\u9700\u8981\u4e00\u4e9b\u53c2\u6570\u3002\u67d0\u4e9b\u5b57\u6bb5\u7c7b\u9700\u8981\u9644\u52a0\u7279\u5b9a\u4e8e\u8be5\u5b57\u6bb5\u7684\u53c2\u6570\uff0c\u4f46\u5e94\u59cb\u7ec8\u63a5\u53d7\u4ee5\u4e0b\u53c2\u6570\uff1a\r\n\r\n### `read_only`\r\n\r\n\u53ea\u8bfb\u5b57\u6bb5\u5305\u542b\u4e8e\u8f93\u51fa API \u4e2d\uff0c\u4e0d\u5e94\u8be5\u5305\u542b\u5728\u9700\u8981\u521b\u5efa\u6216\u66f4\u65b0\u64cd\u4f5c\u7684\u8f93\u5165 API \u4e2d\u3002\u5728\u5e8f\u5217\u5316\u7c7b\u8f93\u5165\u4e2d\u9519\u8bef\u7684\u5305\u542b 'read_only' \u4f1a\u88ab\u5ffd\u7565\u3002\r\n\r\n\u5c06\u5176\u8bbe\u7f6e\u4e3a `True` \u53ef\u786e\u4fdd\u5728\u5e8f\u5217\u5316\u8868\u793a\u65f6\u4f7f\u7528\u8be5\u5b57\u6bb5\uff0c\u4f46\u5728\u53cd\u5e8f\u5217\u5316\u671f\u95f4\u521b\u5efa\u6216\u66f4\u65b0\u5b9e\u4f8b\u65f6\u4e0d\u4f7f\u7528\u8be5\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u4e3a `False`\r\n\r\n### `write_only`\r\n\r\n\u5c06\u5176\u8bbe\u7f6e\u4e3a `True` \u4ee5\u786e\u4fdd\u5728\u66f4\u65b0\u6216\u521b\u5efa\u5b9e\u4f8b\u65f6\u53ef\u4ee5\u4f7f\u7528\u8be5\u5b57\u6bb5\uff0c\u4f46\u5728\u5e8f\u5217\u5316\u8868\u793a\u65f6\u4e0d\u5305\u62ec\u8be5\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u4e3a `False`\r\n\r\n### `required`\r\n\r\n\u5982\u679c\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u8be5\u63d0\u4f9b\u5b57\u6bb5\uff0c\u901a\u5e38\u4f1a\u51fa\u73b0\u9519\u8bef\u3002\u5982\u679c\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u4e0d\u9700\u8981\u6b64\u5b57\u6bb5\uff0c\u5219\u5e94\u8be5\u8bbe\u7f6e\u4e3a false\u3002\r\n\r\n\u5c06\u6b64\u8bbe\u7f6e\u4e3a `False` \u8fd8\u5141\u8bb8\u5728\u5e8f\u5217\u5316\u5b9e\u4f8b\u65f6\u4ece\u8f93\u51fa\u4e2d\u7701\u7565\u5bf9\u8c61\u5c5e\u6027\u6216\u5b57\u5178\u5bc6\u94a5\u3002\u5982\u679c\u5bc6\u94a5\u4e0d\u5b58\u5728\uff0c\u5b83\u5c06\u4e0d\u4f1a\u5305\u542b\u5728\u8f93\u51fa\u8868\u793a\u4e2d\u3002\r\n\r\n\u9ed8\u8ba4\u4e3a `True`\r\n\r\n### `allow_null`\r\n\r\n\u5982\u679c\u628a `None` \u4f20\u9012\u7ed9\u5e8f\u5217\u5316\u5b57\u6bb5\uff0c\u901a\u5e38\u4f1a\u5f15\u53d1\u9519\u8bef\u3002\u5982\u679c `None` \u5e94\u88ab\u89c6\u4e3a\u6709\u6548\u503c\uff0c\u5219\u5c06\u6b64\u5173\u952e\u5b57\u53c2\u6570\u8bbe\u7f6e\u4e3a `True` \u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5c06\u6b64\u53c2\u6570\u8bbe\u7f6e\u4e3a `True` \u5c06\u610f\u5473\u7740\u5e8f\u5217\u5316\u8f93\u51fa\u7684\u7f3a\u7701\u503c\u4e3a `null`\uff0c\u4f46\u5e76\u4e0d\u610f\u5473\u7740\u8f93\u5165\u53cd\u5e8f\u5217\u5316\u7684\u7f3a\u7701\u503c\u3002\r\n\r\n\u9ed8\u8ba4\u4e3a `False`\r\n\r\n### `default`\r\n\r\n\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u4f1a\u7ed9\u51fa\u9ed8\u8ba4\u503c\uff0c\u5728\u6ca1\u6709\u63d0\u4f9b\u8f93\u5165\u503c\u65f6\uff0c\u5c06\u4f7f\u7528\u8be5\u9ed8\u8ba4\u503c\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u9ed8\u8ba4\u884c\u4e3a\u662f\u4e0d\u586b\u5145\u8be5\u5c5e\u6027\u3002\r\n\r\n\u90e8\u5206\u66f4\u65b0\u64cd\u4f5c\u65f6\u4e0d\u5e94\u8be5\u4f7f\u7528 `default`\u3002\u56e0\u4e3a\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u4f20\u5165\u6570\u636e\u4e2d\u63d0\u4f9b\u7684\u5b57\u6bb5\u624d\u4f1a\u8fd4\u56de\u9a8c\u8bc1\u503c\u3002\r\n\r\n\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u51fd\u6570\u6216\u5176\u4ed6\u53ef\u8c03\u7528\u7684\u5bf9\u8c61\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6bcf\u6b21\u4f7f\u7528\u8be5\u503c\u65f6\u90fd\u4f1a\u5bf9\u5176\u8fdb\u884c\u8c03\u7528\u3002\u88ab\u8c03\u7528\u65f6\uff0c\u5b83\u5c06\u4e0d\u4f1a\u6536\u5230\u4efb\u4f55\u53c2\u6570\u3002\u5982\u679c\u53ef\u8c03\u7528\u5bf9\u8c61\u5177\u6709 `set_context` \u65b9\u6cd5\uff0c\u90a3\u4e48\u5728\u6bcf\u6b21\u5c06\u5b57\u6bb5\u5b9e\u4f8b\u4f5c\u4e3a\u53c2\u6570\u83b7\u53d6\u503c\u4e4b\u524d\u90fd\u4f1a\u8c03\u7528\u8be5\u65b9\u6cd5\u3002\u8fd9\u4e0e\u9a8c\u8bc1\u5668\u7684\u5de5\u4f5c\u65b9\u5f0f\u76f8\u540c\u3002\r\n\r\n\u5728\u5e8f\u5217\u5316\u5b9e\u4f8b\u65f6\uff0c\u5982\u679c\u5bf9\u8c61\u5c5e\u6027\u6216\u5b57\u5178\u5173\u952e\u5b57\u4e0d\u5b58\u5728\u4e8e\u5b9e\u4f8b\u4e2d\uff0c\u5c06\u4f7f\u7528\u7f3a\u7701\u503c\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u610f\u5473\u7740\u8be5\u5b57\u6bb5\u4e0d\u662f\u5fc5\u9700\u7684\u3002\u540c\u65f6\u5305\u62ec `default` \u548c `required` \u7684\u5173\u952e\u5b57\u53c2\u6570\u90fd\u662f\u65e0\u6548\u7684\uff0c\u4f1a\u5f15\u53d1\u9519\u8bef\u3002\r\n\r\n### `source`\r\n\r\n\u5c06\u7528\u4e8e\u586b\u5145\u5b57\u6bb5\u7684\u5c5e\u6027\u7684\u540d\u79f0\u3002\u53ef\u4ee5\u662f\u4e00\u4e2a\u53ea\u63a5\u53d7 `self` \u53c2\u6570\u7684\u65b9\u6cd5\uff0c\u5982 `URLField(source='get_absolute_url')`\uff0c\u6216\u8005\u4f7f\u7528\u70b9\u7b26\u53f7\u6765\u904d\u5386\u5c5e\u6027\uff0c\u5982 `EmailField(source='user.email')`\u3002\u5728\u4f7f\u7528\u70b9\u7b26\u53f7\u65f6\uff0c\u5982\u679c\u5728\u5c5e\u6027\u904d\u5386\u671f\u95f4\u4efb\u4f55\u5bf9\u8c61\u4e0d\u5b58\u5728\u6216\u4e3a\u7a7a\uff0c\u5219\u53ef\u80fd\u9700\u8981\u63d0\u4f9b\u7f3a\u7701\u503c\u3002\r\n\r\n`source ='*'` \u5177\u6709\u7279\u6b8a\u542b\u4e49\uff0c\u7528\u4e8e\u8868\u793a\u6574\u4e2a\u5bf9\u8c61\u5e94\u8be5\u4f20\u9012\u5230\u8be5\u5b57\u6bb5\u3002\u8fd9\u5bf9\u521b\u5efa\u5d4c\u5957\u8868\u793a\u6216\u5bf9\u4e8e\u9700\u8981\u8bbf\u95ee\u5b8c\u6574\u5bf9\u8c61\u4ee5\u786e\u5b9a\u8f93\u51fa\u8868\u793a\u7684\u5b57\u6bb5\u975e\u5e38\u6709\u7528\u3002\r\n\r\n\u9ed8\u8ba4\u4e3a\u8be5\u5b57\u6bb5\u7684\u540d\u79f0\u3002\r\n\r\n### `validators`\r\n\r\n\u5e94\u8be5\u5e94\u7528\u4e8e\u4f20\u5165\u5b57\u6bb5\u8f93\u5165\u7684\u9a8c\u8bc1\u51fd\u6570\u5217\u8868\uff0c\u8be5\u5217\u8868\u4e2d\u7684\u51fd\u6570\u5e94\u8be5\u5f15\u53d1\u9a8c\u8bc1\u9519\u8bef\u6216\u4ec5\u8fd4\u56de\u3002\u9a8c\u8bc1\u5668\u51fd\u6570\u901a\u5e38\u5e94\u8be5\u5f15\u53d1 `serializers.ValidationError` \uff0c\u4f46 Django \u7684\u5185\u7f6e `ValidationError` \u4e5f\u652f\u6301\u4e0e Django \u4ee3\u7801\u5e93\u6216\u7b2c\u4e09\u65b9 Django \u5305\u4e2d\u5b9a\u4e49\u7684\u9a8c\u8bc1\u5668\u517c\u5bb9\u3002\r\n\r\n### `error_messages`\r\n\r\n\u4e00\u4e2a\u5b57\u5178\uff0ckey \u662f\u9519\u8bef\u4ee3\u7801\uff0c value \u662f\u5bf9\u5e94\u7684\u9519\u8bef\u4fe1\u606f\u3002\r\n\r\n### `label`\r\n\r\n\u4e00\u4e2a\u7b80\u77ed\u7684\u6587\u672c\u5b57\u7b26\u4e32\uff0c\u53ef\u7528\u4f5c HTML \u8868\u5355\u5b57\u6bb5\u6216\u5176\u4ed6\u63cf\u8ff0\u6027\u5143\u7d20\u4e2d\u5b57\u6bb5\u7684\u540d\u79f0\u3002\r\n\r\n### `help_text`\r\n\r\n\u4e00\u4e2a\u6587\u672c\u5b57\u7b26\u4e32\uff0c\u53ef\u7528\u4f5c HTML \u8868\u5355\u5b57\u6bb5\u6216\u5176\u4ed6\u63cf\u8ff0\u6027\u5143\u7d20\u4e2d\u5b57\u6bb5\u7684\u63cf\u8ff0\u3002\r\n\r\n### `initial`\r\n\r\n\u5e94\u8be5\u7528\u4e8e\u9884\u586b\u5145 HTML \u8868\u5355\u5b57\u6bb5\u7684\u503c\u3002\u4f60\u53ef\u80fd\u4f1a\u4f20\u9012\u4e00\u4e2a\u53ef\u8c03\u7528\u5bf9\u8c61\uff0c\u5c31\u50cf\u4f60\u5bf9\u4efb\u4f55\u5e38\u89c4 Django `Field` \u6240\u505a\u7684\u4e00\u6837\uff1a\r\n\r\n``` python\r\nimport datetime\r\nfrom rest_framework import serializers\r\nclass ExampleSerializer(serializers.Serializer):\r\n    day = serializers.DateField(initial=datetime.date.today)\r\n```\r\n\r\n### `style`\r\n\r\n\u53ef\u7528\u4e8e\u63a7\u5236\u6e32\u67d3\u5668\u6e32\u67d3\u5b57\u6bb5\u7684\u952e\u503c\u5bf9\u7684\u5b57\u5178\u3002\r\n\r\n\u8fd9\u91cc\u6709\u4e24\u4e2a\u4f8b\u5b50\u662f `'input_type'` \u548c `'base_template'` \uff1a\r\n\r\n``` python\r\n# Use <input type=\"password\"> for the input.\r\npassword = serializers.CharField(\r\n    style={'input_type': 'password'}\r\n)\r\n\r\n# Use a radio input instead of a select input.\r\ncolor_channel = serializers.ChoiceField(\r\n    choices=['red', 'green', 'blue'],\r\n    style={'base_template': 'radio.html'}\r\n)\r\n```\r\n\r\n---\r\n\r\n# Boolean \u5b57\u6bb5\r\n\r\n## BooleanField\r\n\r\n\u8868\u793a\u4e00\u4e2a boolean \u503c\u3002\r\n\r\n\u4f7f\u7528 HTML \u7f16\u7801\u8868\u5355\u65f6\u9700\u8981\u6ce8\u610f\uff0c\u7701\u7565\u4e00\u4e2a boolean \u503c\u88ab\u89c6\u4e3a\u5c06\u5b57\u6bb5\u8bbe\u7f6e\u4e3a `False`\uff0c\u5373\u4f7f\u5b83\u6307\u5b9a\u4e86 `default=True` \u9009\u9879\u3002\u8fd9\u662f\u56e0\u4e3a HTML \u590d\u9009\u6846\u901a\u8fc7\u7701\u7565\u8be5\u503c\u6765\u8868\u793a\u672a\u9009\u4e2d\u7684\u72b6\u6001\uff0c\u6240\u4ee5 REST framework \u5c06\u7701\u7565\u770b\u4f5c\u662f\u7a7a\u7684\u590d\u9009\u6846\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5c06\u4f7f\u7528 `required=False` \u9009\u9879\u751f\u6210\u9ed8\u8ba4\u7684 `BooleanField` \u5b9e\u4f8b\uff08\u56e0\u4e3a Django `models.BooleanField` \u59cb\u7ec8\u4e3a `blank=True`\uff09\u3002\u5982\u679c\u60f3\u8981\u66f4\u6539\u6b64\u884c\u4e3a\uff0c\u8bf7\u5728\u5e8f\u5217\u5316\u7c7b\u4e0a\u663e\u5f0f\u58f0\u660e `BooleanField`\u3002\r\n\r\n\u5bf9\u5e94\u4e0e `django.db.models.fields.BooleanField`.\r\n\r\n**\u7b7e\u540d\uff1a** `BooleanField()`\r\n\r\n## NullBooleanField\r\n\r\n\u8868\u793a\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u5b83\u4e5f\u63a5\u53d7 `None` \u4f5c\u4e3a\u6709\u6548\u503c\u3002\r\n\r\n\u5bf9\u5e94\u4e0e `django.db.models.fields.NullBooleanField`.\r\n\r\n**\u7b7e\u540d\uff1a** `NullBooleanField()`\r\n\r\n---\r\n\r\n# \u5b57\u7b26\u4e32\u5b57\u6bb5\r\n\r\n## CharField\r\n\r\n\u8868\u793a\u6587\u672c\u3002\u53ef\u4ee5\u4f7f\u7528 `max_length` \uff0c `min_length` \u9a8c\u8bc1\uff08\u6216\u9650\u5b9a\uff09\u6587\u672c\u7684\u957f\u77ed\u3002\r\n\r\n\u5bf9\u5e94\u4e0e `django.db.models.fields.CharField` \u6216 `django.db.models.fields.TextField`.\r\n\r\n**\u7b7e\u540d\uff1a** `CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)`\r\n\r\n- `max_length` - \u9a8c\u8bc1\u8f93\u5165\u6240\u5305\u542b\u7684\u5b57\u7b26\u6570\u4e0d\u8d85\u8fc7\u8fd9\u4e2a\u6570\u76ee\u3002\r\n- `min_length` - \u9a8c\u8bc1\u8f93\u5165\u6240\u5305\u542b\u7684\u5b57\u7b26\u6570\u4e0d\u5c11\u4e8e\u8fd9\u4e2a\u6570\u76ee\u3002\r\n- `allow_blank` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u5219\u7a7a\u5b57\u7b26\u4e32\u5e94\u88ab\u89c6\u4e3a\u6709\u6548\u503c\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `False`\uff0c\u90a3\u4e48\u7a7a\u5b57\u7b26\u4e32\u88ab\u8ba4\u4e3a\u662f\u65e0\u6548\u7684\u5e76\u4f1a\u5f15\u53d1\u9a8c\u8bc1\u9519\u8bef\u3002\u9ed8\u8ba4\u4e3a `False`\u3002\r\n- `trim_whitespace` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u5219\u524d\u540e\u7a7a\u767d\u5c06\u88ab\u5220\u9664\u3002\u9ed8\u8ba4\u4e3a `True`\u3002\r\n\r\n`allow_null` \u9009\u9879\u4e5f\u53ef\u7528\u4e8e\u5b57\u7b26\u4e32\u5b57\u6bb5\uff0c\u5c3d\u7ba1\u5b83\u76f8\u5bf9\u4e8e `allow_blank` \u6765\u8bf4\u4e0d\u88ab\u63a8\u8350\u3002\u540c\u65f6\u8bbe\u7f6e `allow_blank=True` \u548c `allow_null=True` \u662f\u6709\u6548\u7684\uff0c\u4f46\u8fd9\u6837\u505a\u610f\u5473\u7740\u5b57\u7b26\u4e32\u8868\u793a\u5141\u8bb8\u6709\u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u7a7a\u503c\uff0c\u8fd9\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u548c\u5fae\u5999\u7684\u5e94\u7528\u7a0b\u5e8f\u9519\u8bef\u3002\r\n\r\n## EmailField\r\n\r\n\u8868\u793a\u6587\u672c\uff0c\u5c06\u6587\u672c\u9a8c\u8bc1\u4e3a\u6709\u6548\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u3002\r\n\r\n\u5bf9\u5e94\u4e0e `django.db.models.fields.EmailField`\r\n\r\n**\u7b7e\u540d\uff1a** `EmailField(max_length=None, min_length=None, allow_blank=False)`\r\n\r\n## RegexField\r\n\r\n\u8868\u793a\u6587\u672c\uff0c\u7528\u4e8e\u9a8c\u8bc1\u7ed9\u5b9a\u7684\u503c\u662f\u5426\u4e0e\u67d0\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u3002\r\n\r\n\u5bf9\u5e94\u4e0e `django.forms.fields.RegexField`.\r\n\r\n**\u7b7e\u540d\uff1a** `RegexField(regex, max_length=None, min_length=None, allow_blank=False)`\r\n\r\n\u5f3a\u5236\u7684 `regex` \u53c2\u6570\u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u7f16\u8bd1\u597d\u7684 Python \u6b63\u5219\u8868\u8fbe\u5f0f\u5bf9\u8c61\u3002\r\n\r\n\u4f7f\u7528 Django \u7684 `django.core.validators.RegexValidator` \u8fdb\u884c\u9a8c\u8bc1\u3002\r\n\r\n## SlugField\r\n\r\n\u4e00\u4e2a\u6839\u636e\u6a21\u5f0f `[a-zA-Z0-9_-]+` \u9a8c\u8bc1\u8f93\u5165\u7684 `RegexField` \u3002\r\n\r\n\u5bf9\u5e94\u4e0e `django.db.models.fields.SlugField`.\r\n\r\n**\u7b7e\u540d\uff1a** `SlugField(max_length=50, min_length=None, allow_blank=False)`\r\n\r\n## URLField\r\n\r\n\u4e00\u4e2a\u6839\u636e URL \u5339\u914d\u6a21\u5f0f\u9a8c\u8bc1\u8f93\u5165\u7684 `RegexField`\u3002\u5b8c\u5168\u5408\u683c\u7684 URL \u683c\u5f0f\u4e3a `http://<host>/<path>`\u3002\r\n\r\n\u5bf9\u5e94\u4e0e `django.db.models.fields.URLField`.  \u4f7f\u7528 Django \u7684 `django.core.validators.URLValidator` \u8fdb\u884c\u9a8c\u8bc1\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `URLField(max_length=200, min_length=None, allow_blank=False)`\r\n\r\n## UUIDField\r\n\r\n\u786e\u4fdd\u8f93\u5165\u7684\u5b57\u6bb5\u662f\u6709\u6548\u7684 UUID \u5b57\u7b26\u4e32\u3002`to_internal_value` \u65b9\u6cd5\u5c06\u8fd4\u56de\u4e00\u4e2a `uuid.UUID` \u5b9e\u4f8b\u3002\u5728\u8f93\u51fa\u65f6\uff0c\u5b57\u6bb5\u5c06\u4ee5\u89c4\u8303\u7684\u8fde\u5b57\u7b26\u683c\u5f0f\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\uff1a\r\n\r\n```\r\n\"de305d54-75b4-431b-adb2-eb6b9e546013\"\r\n```\r\n\r\n**\u7b7e\u540d\uff1a** `UUIDField(format='hex_verbose')`\r\n\r\n- `format`: \u786e\u5b9a uuid \u503c\u7684\u8868\u793a\u5f62\u5f0f\r\n    - `'hex_verbose'` - \u6743\u5a01\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u5f62\u5f0f\uff0c\u5305\u542b\u8fde\u5b57\u7b26\uff1a `\"5ce0e9a5-5ffa-654b-cee0-1238041fb31a\"`\r\n    - `'hex'` - \u7d27\u51d1\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u5f62\u5f0f\uff0c \u4e0d\u5305\u542b\u8fde\u5b57\u7b26\uff1a`\"5ce0e9a55ffa654bcee01238041fb31a\"`\r\n    - `'int'` - 128 \u4f4d\u6574\u6570\u8868\u793a\u5f62\u5f0f\uff1a`\"123456789012312313134124512351145145114\"`\r\n    - `'urn'` - RFC 4122 URN \u8868\u793a\u5f62\u5f0f\uff1a `\"urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a\"`\r\n  \u4fee\u6539 `format` \u4ec5\u5f71\u54cd\u8868\u793a\u503c\u3002\u6240\u6709\u683c\u5f0f\u90fd\u88ab `to_internal_value` \u63a5\u53d7\u3002\r\n\r\n## FilePathField\r\n\r\n\u4e00\u4e2a\u5176\u9009\u9879\u4ec5\u9650\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e0a\u67d0\u4e2a\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u540d\u7684\u5b57\u6bb5\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.forms.fields.FilePathField`.\r\n\r\n**\u7b7e\u540d\uff1a** `FilePathField(path, match=None, recursive=False, allow_files=True, allow_folders=False, required=None, **kwargs)`\r\n\r\n- `path` - FilePathField \u5e94\u8be5\u4ece\u4e2d\u9009\u62e9\u7684\u76ee\u5f55\u7684\u7edd\u5bf9\u6587\u4ef6\u7cfb\u7edf\u8def\u5f84\u3002\r\n- `match` - \u7528\u6765\u8fc7\u6ee4\u6587\u4ef6\u540d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0cstring \u7c7b\u578b\u3002\r\n- `recursive` - \u6307\u5b9a\u662f\u5426\u5e94\u8be5\u5305\u542b\u8def\u5f84\u7684\u6240\u6709\u5b50\u76ee\u5f55\u3002\u9ed8\u8ba4\u503c\u662f `False`\u3002\r\n- `allow_files` - \u662f\u5426\u5e94\u8be5\u5305\u542b\u6307\u5b9a\u4f4d\u7f6e\u7684\u6587\u4ef6\u3002\u9ed8\u8ba4\u503c\u4e3a `True`\u3002\u8fd9\u4e2a\u53c2\u6570\u6216 `allow_folders` \u5fc5\u987b\u662f `True`\u3002\uff08\u4e24\u4e2a\u5c5e\u6027\u5fc5\u987b\u6709\u4e00\u4e2a\u4e3a `true`\uff09\r\n- `allow_folders` - \u662f\u5426\u5e94\u8be5\u5305\u542b\u6307\u5b9a\u4f4d\u7f6e\u7684\u6587\u4ef6\u5939\u3002\u9ed8\u8ba4\u503c\u662f `False`\u3002\u8fd9\u4e2a\u53c2\u6570\u6216 `allow_files` \u5fc5\u987b\u662f `True`\u3002\uff08\u4e24\u4e2a\u5c5e\u6027\u5fc5\u987b\u6709\u4e00\u4e2a\u4e3a `true`\uff09\r\n\r\n## IPAddressField\r\n\r\n\u786e\u4fdd\u8f93\u5165\u662f\u6709\u6548\u7684 IPv4 \u6216 IPv6 \u5b57\u7b26\u4e32\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.forms.fields.IPAddressField` \u548c `django.forms.fields.GenericIPAddressField`.\r\n\r\n**\u7b7e\u540d\uff1a** `IPAddressField(protocol='both', unpack_ipv4=False, **options)`\r\n\r\n- `protocol` \u5c06\u6709\u6548\u8f93\u5165\u9650\u5236\u4e3a\u6307\u5b9a\u7684\u534f\u8bae\u3002\u63a5\u53d7\u7684\u503c\u662f `'both'` \uff08\u9ed8\u8ba4\uff09\uff0c`'IPv4'` \u6216 `'IPv6'` \u3002\u5339\u914d\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u3002\r\n- `unpack_ipv4` \u89e3\u538b IPv4 \u6620\u5c04\u7684\u5730\u5740\uff0c\u5982 `::ffff:192.0.2.1`\u3002\u5982\u679c\u542f\u7528\u6b64\u9009\u9879\uff0c\u5219\u8be5\u5730\u5740\u5c06\u89e3\u538b\u5230 192.0.2.1\u3002 \u9ed8\u8ba4\u662f\u7981\u7528\u7684\u3002\u53ea\u80fd\u5728 `protocol` \u8bbe\u7f6e\u4e3a `'both'` \u65f6\u4f7f\u7528\u3002\r\n\r\n---\r\n\r\n# \u6570\u5b57\u5b57\u6bb5\r\n\r\n## IntegerField\r\n\r\n\u8868\u793a\u6574\u6570\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.db.models.fields.IntegerField`, `django.db.models.fields.SmallIntegerField`, `django.db.models.fields.PositiveIntegerField` \u548c `django.db.models.fields.PositiveSmallIntegerField`\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `IntegerField(max_value=None, min_value=None)`\r\n\r\n- `max_value` \u9a8c\u8bc1\u6240\u63d0\u4f9b\u7684\u6570\u5b57\u4e0d\u5927\u4e8e\u8fd9\u4e2a\u503c\u3002\r\n- `min_value` \u9a8c\u8bc1\u6240\u63d0\u4f9b\u7684\u6570\u5b57\u4e0d\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u3002\r\n\r\n## FloatField\r\n\r\n\u8868\u793a\u6d6e\u70b9\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.db.models.fields.FloatField`.\r\n\r\n**\u7b7e\u540d\uff1a** `FloatField(max_value=None, min_value=None)`\r\n\r\n- `max_value` \u9a8c\u8bc1\u6240\u63d0\u4f9b\u7684\u6570\u5b57\u4e0d\u5927\u4e8e\u8fd9\u4e2a\u503c\u3002\r\n- `min_value` \u9a8c\u8bc1\u6240\u63d0\u4f9b\u7684\u6570\u5b57\u4e0d\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u3002\r\n\r\n## DecimalField\r\n\r\n\u8868\u793a\u5341\u8fdb\u5236\uff0c\u7531 Python \u7528 `Decimal` \u5b9e\u4f8b\u8868\u793a\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.db.models.fields.DecimalField`.\r\n\r\n**\u7b7e\u540d\uff1a** `DecimalField(max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None)`\r\n\r\n- `max_digits` \u5141\u8bb8\u7684\u6700\u5927\u4f4d\u6570\u3002\u5b83\u5fc5\u987b\u662f `None` \u6216\u5927\u4e8e\u7b49\u4e8e `decimal_places` \u7684\u6574\u6570\u3002\r\n- `decimal_places` \u5c0f\u6570\u4f4d\u6570\u3002\r\n- `coerce_to_string` \u5982\u679c\u5e94\u8fd4\u56de\u5b57\u7b26\u4e32\u503c\uff0c\u5219\u8bbe\u7f6e\u4e3a `True` ;\u5982\u679c\u5e94\u8fd4\u56de `Decimal` \u5bf9\u8c61\uff0c\u5219\u8bbe\u7f6e\u4e3a `False` \u3002\u9ed8\u8ba4\u503c\u4e0e `COERCE_DECIMAL_TO_STRING` settings key \u7684\u503c\u76f8\u540c\uff0c\u9664\u975e\u88ab\u8986\u76d6\uff0c\u5426\u5219\u8be5\u503c\u5c06\u4e3a `True`\u3002\u5982\u679c\u5e8f\u5217\u5316\u5bf9\u8c61\u8fd4\u56de `Decimal` \u5bf9\u8c61\uff0c\u5219\u6700\u7ec8\u7684\u8f93\u51fa\u683c\u5f0f\u5c06\u7531\u6e32\u67d3\u5668\u51b3\u5b9a\u3002\u8bf7\u6ce8\u610f\uff0c\u8bbe\u7f6e `localize` \u5c06\u5f3a\u5236\u8be5\u503c\u4e3a `True`\u3002\r\n- `max_value` \u9a8c\u8bc1\u6240\u63d0\u4f9b\u7684\u6570\u5b57\u4e0d\u5927\u4e8e\u8fd9\u4e2a\u503c\u3002\r\n- `min_value` \u9a8c\u8bc1\u6240\u63d0\u4f9b\u7684\u6570\u5b57\u4e0d\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u3002\r\n- `localize` \u8bbe\u7f6e\u4e3a `True` \u4ee5\u542f\u7528\u57fa\u4e8e\u5f53\u524d\u8bed\u8a00\u73af\u5883\u7684\u8f93\u5165\u548c\u8f93\u51fa\u672c\u5730\u5316\u3002\u8fd9\u4e5f\u4f1a\u8feb\u4f7f `coerce_to_string` \u4e3a `True` \u3002\u9ed8\u8ba4\u4e3a `False` \u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4f60\u5728 settings \u6587\u4ef6\u4e2d\u8bbe\u7f6e\u4e86 `USE_L10N=True`\uff0c\u5219\u4f1a\u542f\u7528\u6570\u636e\u683c\u5f0f\u5316\u3002\r\n- `rounding` \u8bbe\u7f6e\u91cf\u5316\u5230\u914d\u7f6e\u7cbe\u5ea6\u65f6\u4f7f\u7528\u7684\u820d\u5165\u6a21\u5f0f\u3002 \u6709\u6548\u503c\u662f `decimal` \u6a21\u5757\u820d\u5165\u6a21\u5f0f\u3002\u9ed8\u8ba4\u4e3a `None`\u3002\r\n#### \u7528\u6cd5\u793a\u4f8b\r\n\r\n\u82e5\u8981\u9a8c\u8bc1\u6570\u5b57\u5230999\uff0c\u7cbe\u786e\u5230 2 \u4f4d\u5c0f\u6570\uff0c\u5e94\u8be5\u4f7f\u7528\uff1a\r\n\r\n    serializers.DecimalField(max_digits=5, decimal_places=2)\r\n\r\n\u752810\u4f4d\u5c0f\u6570\u6765\u9a8c\u8bc1\u6570\u5b57\u4e0d\u8d85\u8fc710\u4ebf\uff1a\r\n\r\n    serializers.DecimalField(max_digits=19, decimal_places=10)\r\n\r\n\u8fd9\u4e2a\u5b57\u6bb5\u8fd8\u63a5\u53d7\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\uff0c`coerce_to_string`\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u5219\u8868\u793a\u5c06\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8f93\u51fa\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `False`\uff0c\u5219\u8868\u793a\u5c06\u4fdd\u7559\u4e3a `Decimal` \u5b9e\u4f8b\uff0c\u6700\u7ec8\u8868\u793a\u5f62\u5f0f\u5c06\u7531\u6e32\u67d3\u5668\u786e\u5b9a\u3002\r\n\r\n\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a\u4e0e `COERCE_DECIMAL_TO_STRING` setting \u76f8\u540c\u7684\u503c\uff0c\u9664\u975e\u53e6\u884c\u8bbe\u7f6e\uff0c\u5426\u5219\u8be5\u503c\u4e3a `True`\u3002\r\n\r\n---\r\n\r\n# \u65e5\u671f\u548c\u65f6\u95f4\u5b57\u6bb5\r\n\r\n## DateTimeField\r\n\r\n\u8868\u793a\u65e5\u671f\u548c\u65f6\u95f4\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.db.models.fields.DateTimeField`.\r\n\r\n**\u7b7e\u540d\uff1a** `DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)`\r\n\r\n* `format` - \u8868\u793a\u8f93\u51fa\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u9ed8\u8ba4\u4e3a\u4e0e `DATETIME_FORMAT` settings key \u76f8\u540c\u7684\u503c\uff0c\u9664\u975e\u8bbe\u7f6e\uff0c\u5426\u5219\u5c06\u4e3a `'iso-8601'`\u3002\u8bbe\u7f6e\u4e3a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5219\u8868\u660e `to_representation` \u8fd4\u56de\u503c\u5e94\u8be5\u88ab\u5f3a\u5236\u4e3a\u5b57\u7b26\u4e32\u8f93\u51fa\u3002\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5982\u4e0b\u6240\u8ff0\u3002\u5c06\u6b64\u503c\u8bbe\u7f6e\u4e3a `None` \u8868\u793a Python  `datetime` \u5bf9\u8c61\u5e94\u7531 `to_representation` \u8fd4\u56de\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u65e5\u671f\u65f6\u95f4\u7f16\u7801\u5c06\u7531\u6e32\u67d3\u5668\u786e\u5b9a\u3002\r\n* `input_formats` - \u8868\u793a\u53ef\u7528\u4e8e\u89e3\u6790\u65e5\u671f\u7684\u8f93\u5165\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u5c06\u4f7f\u7528 `DATETIME_INPUT_FORMATS` \u8bbe\u7f6e\uff0c\u8be5\u8bbe\u7f6e\u9ed8\u8ba4\u4e3a `['iso-8601']`\u3002\r\n\r\n#### `DateTimeField` \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u3002\r\n\r\n\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u53ef\u4ee5\u662f\u660e\u786e\u6307\u5b9a\u7684 Python strftime \u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f\u4f7f\u7528 ISO 8601 \u98ce\u683c datetime \u7684\u7279\u6b8a\u5b57\u7b26\u4e32 `iso-8601` \u3002\uff08\u4f8b\u5982 `'2013-01-29T12:34:56.000000Z'`\uff09\r\n\r\n\u5f53\u4e00\u4e2a `None` \u503c\u88ab\u7528\u4e8e\u683c\u5f0f\u5316 `datetime` \u5bf9\u8c61\u65f6\uff0c`to_representation` \u5c06\u8fd4\u56de\uff0c\u6700\u7ec8\u7684\u8f93\u51fa\u8868\u793a\u5c06\u7531\u6e32\u67d3\u5668\u7c7b\u51b3\u5b9a\u3002\r\n\r\n#### `auto_now` \u548c `auto_now_add` \u6a21\u578b\u5b57\u6bb5\u3002\r\n\r\n\u4f7f\u7528 `ModelSerializer` \u6216 `HyperlinkedModelSerializer` \u65f6\uff0c\u8bf7\u6ce8\u610f\uff0c`auto_now=True`\u6216 `auto_now_add=True` \u7684\u6a21\u578b\u5b57\u6bb5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5c06\u4f7f\u7528 `read_only=True` \u3002\r\n\r\n\u5982\u679c\u60f3\u8986\u76d6\u6b64\u884c\u4e3a\uff0c\u5219\u9700\u8981\u5728\u5e8f\u5217\u5316\u7c7b\u4e2d\u660e\u786e\u58f0\u660e `DateTimeField`\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass CommentSerializer(serializers.ModelSerializer):\r\n    created = serializers.DateTimeField()\r\n\r\n    class Meta:\r\n        model = Comment\r\n```\r\n\r\n## DateField\r\n\r\n\u8868\u793a\u65e5\u671f\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.db.models.fields.DateField`\r\n\r\n**\u7b7e\u540d\uff1a** `DateField(format=api_settings.DATE_FORMAT, input_formats=None)`\r\n\r\n* `format` - \u8868\u793a\u8f93\u51fa\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u9ed8\u8ba4\u4e3a\u4e0e `DATE_FORMAT` settings key \u76f8\u540c\u7684\u503c\uff0c\u9664\u975e\u8bbe\u7f6e\uff0c\u5426\u5219\u5c06\u4e3a `'iso-8601'`\u3002\u8bbe\u7f6e\u4e3a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5219\u8868\u660e `to_representation` \u8fd4\u56de\u503c\u5e94\u8be5\u88ab\u5f3a\u5236\u4e3a\u5b57\u7b26\u4e32\u8f93\u51fa\u3002\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5982\u4e0b\u6240\u8ff0\u3002\u5c06\u6b64\u503c\u8bbe\u7f6e\u4e3a `None` \u8868\u793a Python  `date` \u5bf9\u8c61\u5e94\u7531 `to_representation` \u8fd4\u56de\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u65e5\u671f\u65f6\u95f4\u7f16\u7801\u5c06\u7531\u6e32\u67d3\u5668\u786e\u5b9a\u3002\r\n* `input_formats` - \u8868\u793a\u53ef\u7528\u4e8e\u89e3\u6790\u65e5\u671f\u7684\u8f93\u5165\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u5c06\u4f7f\u7528 `DATE_INPUT_FORMATS` \u8bbe\u7f6e\uff0c\u8be5\u8bbe\u7f6e\u9ed8\u8ba4\u4e3a `['iso-8601']`\u3002\r\n\r\n#### `DateField` \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\r\n\r\n\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u53ef\u4ee5\u662f\u660e\u786e\u6307\u5b9a\u7684 Python strftime \u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f\u4f7f\u7528 ISO 8601 \u98ce\u683c date \u7684\u7279\u6b8a\u5b57\u7b26\u4e32 `iso-8601` \u3002\uff08\u4f8b\u5982 `'2013-01-29'`\uff09\r\n\r\n## TimeField\r\n\r\n\u8868\u793a\u65f6\u95f4\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.db.models.fields.TimeField`\r\n\r\n**\u7b7e\u540d\uff1a** `TimeField(format=api_settings.TIME_FORMAT, input_formats=None)`\r\n\r\n* `format` - \u8868\u793a\u8f93\u51fa\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u9ed8\u8ba4\u4e3a\u4e0e `TIME_FORMAT` settings key \u76f8\u540c\u7684\u503c\uff0c\u9664\u975e\u8bbe\u7f6e\uff0c\u5426\u5219\u5c06\u4e3a `'iso-8601'`\u3002\u8bbe\u7f6e\u4e3a\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5219\u8868\u660e `to_representation` \u8fd4\u56de\u503c\u5e94\u8be5\u88ab\u5f3a\u5236\u4e3a\u5b57\u7b26\u4e32\u8f93\u51fa\u3002\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5982\u4e0b\u6240\u8ff0\u3002\u5c06\u6b64\u503c\u8bbe\u7f6e\u4e3a `None` \u8868\u793a Python  `time` \u5bf9\u8c61\u5e94\u7531 `to_representation` \u8fd4\u56de\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u65e5\u671f\u65f6\u95f4\u7f16\u7801\u5c06\u7531\u6e32\u67d3\u5668\u786e\u5b9a\u3002\r\n* `input_formats` - \u8868\u793a\u53ef\u7528\u4e8e\u89e3\u6790\u65e5\u671f\u7684\u8f93\u5165\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002 \u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u5c06\u4f7f\u7528 `TIME_INPUT_FORMATS` \u8bbe\u7f6e\uff0c\u8be5\u8bbe\u7f6e\u9ed8\u8ba4\u4e3a `['iso-8601']`\u3002\r\n\r\n#### `TimeField` \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\r\n\r\n\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u53ef\u4ee5\u662f\u660e\u786e\u6307\u5b9a\u7684 Python strftime \u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f\u4f7f\u7528 ISO 8601 \u98ce\u683c time \u7684\u7279\u6b8a\u5b57\u7b26\u4e32 `iso-8601` \u3002\uff08\u4f8b\u5982 `'12:34:56.000000'`\uff09\r\n\r\n## DurationField\r\n\r\n\u8868\u793a\u6301\u7eed\u65f6\u95f4\u3002\r\n\u5bf9\u5e94\u4e8e `django.db.models.fields.DurationField`\r\n\r\n\u8fd9\u4e9b\u5b57\u6bb5\u7684 `validated_data` \u5c06\u5305\u542b\u4e00\u4e2a `datetime.timedelta` \u5b9e\u4f8b\u3002\u8be5\u8868\u793a\u5f62\u5f0f\u662f\u9075\u5faa\u683c\u5f0f `'[DD] [HH:[MM:]]ss[.uuuuuu]'` \u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `DurationField()`\r\n\r\n---\r\n\r\n# \u9009\u62e9\u5b57\u6bb5\r\n\r\n## ChoiceField\r\n\r\n\u53ef\u4ee5\u4ece\u4e00\u4e2a\u6709\u9650\u7684\u9009\u62e9\u4e2d\u63a5\u53d7\u503c\u7684\u5b57\u6bb5\u3002\r\n\r\n\u5982\u679c\u76f8\u5e94\u7684\u6a21\u578b\u5b57\u6bb5\u5305\u542b `choices=\u2026` \u53c2\u6570\uff0c\u5219\u7531 `ModelSerializer` \u81ea\u52a8\u751f\u6210\u5b57\u6bb5\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `ChoiceField(choices)`\r\n\r\n- `choices` - \u6709\u6548\u503c\u5217\u8868\uff0c\u6216 `(key, display_name)` \u5143\u7ec4\u5217\u8868\u3002\r\n- `allow_blank` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u5219\u7a7a\u5b57\u7b26\u4e32\u5e94\u88ab\u89c6\u4e3a\u6709\u6548\u503c\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `False`\uff0c\u90a3\u4e48\u7a7a\u5b57\u7b26\u4e32\u88ab\u8ba4\u4e3a\u662f\u65e0\u6548\u7684\u5e76\u4f1a\u5f15\u53d1\u9a8c\u8bc1\u9519\u8bef\u3002\u9ed8\u8ba4\u662f `False`\u3002\r\n- `html_cutoff` - \u5982\u679c\u8bbe\u7f6e\uff0c\u8fd9\u5c06\u662f HTML \u9009\u62e9\u4e0b\u62c9\u83dc\u5355\u4e2d\u663e\u793a\u7684\u9009\u9879\u7684\u6700\u5927\u6570\u91cf\u3002\u53ef\u7528\u4e8e\u786e\u4fdd\u81ea\u52a8\u751f\u6210\u5177\u6709\u975e\u5e38\u5927\u53ef\u4ee5\u9009\u62e9\u7684 ChoiceField\uff0c\u800c\u4e0d\u4f1a\u963b\u6b62\u6a21\u677f\u7684\u6e32\u67d3\u3002\u9ed8\u8ba4\u662f `None`.\r\n- `html_cutoff_text` - \u6307\u5b9a\u4e00\u4e2a\u6587\u672c\u6307\u793a\u5668\uff0c\u5728\u622a\u65ad\u5217\u8868\u65f6\u663e\u793a\uff0c\u6bd4\u5982\u5728 HTML \u9009\u62e9\u4e0b\u62c9\u83dc\u5355\u4e2d\u5df2\u7ecf\u622a\u65ad\u4e86\u6700\u5927\u6570\u91cf\u7684\u9879\u76ee\u3002\u9ed8\u8ba4\u5c31\u4f1a\u663e\u793a `\"More than {count} items\u2026\"`\r\n\r\n`Allow_blank` \u548c `allow_null` \u90fd\u662f `ChoiceField` \u4e0a\u7684\u6709\u6548\u9009\u9879\uff0c\u4f46\u5f3a\u70c8\u5efa\u8bae\u53ea\u4f7f\u7528\u4e00\u4e2a\u800c\u4e0d\u662f\u4e24\u4e2a\u90fd\u7528\u3002\u5bf9\u4e8e\u6587\u672c\u9009\u62e9\uff0c`allow_blank` \u5e94\u8be5\u662f\u9996\u9009\uff0c`allow_null` \u5e94\u8be5\u662f\u6570\u5b57\u6216\u5176\u4ed6\u975e\u6587\u672c\u9009\u9879\u7684\u9996\u9009\u3002\r\n\r\n## MultipleChoiceField\r\n\r\n\u53ef\u4ee5\u63a5\u53d7\u4e00\u7ec4\u96f6\u3001\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\u7684\u5b57\u6bb5\uff0c\u4ece\u6709\u9650\u7684\u4e00\u7ec4\u9009\u62e9\u4e2d\u9009\u62e9\u3002\u91c7\u53d6\u4e00\u4e2a\u5fc5\u586b\u7684\u53c2\u6570\u3002 `to_internal_value` \u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u9009\u5b9a\u503c\u7684 `set`\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `MultipleChoiceField(choices)`\r\n\r\n- `choices` - \u6709\u6548\u503c\u5217\u8868\uff0c\u6216 `(key, display_name)` \u5143\u7ec4\u5217\u8868\u3002\r\n- `allow_blank` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u5219\u7a7a\u5b57\u7b26\u4e32\u5e94\u88ab\u89c6\u4e3a\u6709\u6548\u503c\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `False`\uff0c\u90a3\u4e48\u7a7a\u5b57\u7b26\u4e32\u88ab\u8ba4\u4e3a\u662f\u65e0\u6548\u7684\u5e76\u4f1a\u5f15\u53d1\u9a8c\u8bc1\u9519\u8bef\u3002\u9ed8\u8ba4\u662f `False`\u3002\r\n- `html_cutoff` - \u5982\u679c\u8bbe\u7f6e\uff0c\u8fd9\u5c06\u662f HTML \u9009\u62e9\u4e0b\u62c9\u83dc\u5355\u4e2d\u663e\u793a\u7684\u9009\u9879\u7684\u6700\u5927\u6570\u91cf\u3002\u53ef\u7528\u4e8e\u786e\u4fdd\u81ea\u52a8\u751f\u6210\u5177\u6709\u975e\u5e38\u5927\u53ef\u4ee5\u9009\u62e9\u7684 ChoiceField\uff0c\u800c\u4e0d\u4f1a\u963b\u6b62\u6a21\u677f\u7684\u6e32\u67d3\u3002\u9ed8\u8ba4\u662f `None`.\r\n- `html_cutoff_text` - \u6307\u5b9a\u4e00\u4e2a\u6587\u672c\u6307\u793a\u5668\uff0c\u5728\u622a\u65ad\u5217\u8868\u65f6\u663e\u793a\uff0c\u6bd4\u5982\u5728 HTML \u9009\u62e9\u4e0b\u62c9\u83dc\u5355\u4e2d\u5df2\u7ecf\u622a\u65ad\u4e86\u6700\u5927\u6570\u91cf\u7684\u9879\u76ee\u3002\u9ed8\u8ba4\u5c31\u4f1a\u663e\u793a `\"More than {count} items\u2026\"`\r\n\r\n`Allow_blank` \u548c `allow_null` \u90fd\u662f `ChoiceField` \u4e0a\u7684\u6709\u6548\u9009\u9879\uff0c\u4f46\u5f3a\u70c8\u5efa\u8bae\u53ea\u4f7f\u7528\u4e00\u4e2a\u800c\u4e0d\u662f\u4e24\u4e2a\u90fd\u7528\u3002\u5bf9\u4e8e\u6587\u672c\u9009\u62e9\uff0c`allow_blank` \u5e94\u8be5\u662f\u9996\u9009\uff0c`allow_null` \u5e94\u8be5\u662f\u6570\u5b57\u6216\u5176\u4ed6\u975e\u6587\u672c\u9009\u9879\u7684\u9996\u9009\u3002\r\n\r\n---\r\n\r\n# \u6587\u4ef6\u4e0a\u4f20\u5b57\u6bb5\r\n\r\n#### \u89e3\u6790\u548c\u6587\u4ef6\u4e0a\u4f20\u3002\r\n\r\n `FileField`\u548c `ImageField` \u7c7b\u53ea\u9002\u7528\u4e8e `MultiPartParser` \u6216 `FileUploadParser` \u3002\u5927\u591a\u6570\u89e3\u6790\u5668\uff0c\u4f8b\u5982\uff0c e.g. JSON \u4e0d\u652f\u6301\u6587\u4ef6\u4e0a\u4f20\u3002 Django \u7684\u5e38\u89c4 `FILE_UPLOAD_HANDLERS` \u7528\u4e8e\u5904\u7406\u4e0a\u4f20\u7684\u6587\u4ef6\u3002\r\n\r\n## FileField\r\n\r\n\u8868\u793a\u6587\u4ef6\u3002\u6267\u884c Django \u7684\u6807\u51c6 FileField \u9a8c\u8bc1\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.forms.fields.FileField`.\r\n\r\n**\u7b7e\u540d\uff1a** `FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)`\r\n\r\n - `max_length` - \u6307\u5b9a\u6587\u4ef6\u540d\u7684\u6700\u5927\u957f\u5ea6\u3002\r\n - `allow_empty_file` - \u6307\u5b9a\u662f\u5426\u5141\u8bb8\u7a7a\u6587\u4ef6\u3002\r\n- `use_url` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u5219 URL \u5b57\u7b26\u4e32\u503c\u5c06\u7528\u4e8e\u8f93\u51fa\u8868\u793a\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `False`\uff0c\u5219\u6587\u4ef6\u540d\u5b57\u7b26\u4e32\u503c\u5c06\u7528\u4e8e\u8f93\u51fa\u8868\u793a\u3002\u9ed8\u8ba4\u4e3a `UPLOADED_FILES_USE_URL` settings key \u7684\u503c\uff0c\u9664\u975e\u53e6\u6709\u8bbe\u7f6e\uff0c\u5426\u5219\u4e3a `True`\u3002\r\n\r\n## ImageField\r\n\r\n\u8868\u793a\u56fe\u7247\u3002\u9a8c\u8bc1\u4e0a\u4f20\u7684\u6587\u4ef6\u5185\u5bb9\u662f\u5426\u5339\u914d\u5df2\u77e5\u7684\u56fe\u7247\u683c\u5f0f\u3002\r\n\r\n\u5bf9\u5e94\u4e8e `django.forms.fields.ImageField`.\r\n\r\n**\u7b7e\u540d\uff1a** `ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)`\r\n\r\n - `max_length` - \u6307\u5b9a\u6587\u4ef6\u540d\u7684\u6700\u5927\u957f\u5ea6\u3002\r\n - `allow_empty_file` - \u6307\u5b9a\u662f\u5426\u5141\u8bb8\u7a7a\u6587\u4ef6\u3002\r\n- `use_url` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u5219 URL \u5b57\u7b26\u4e32\u503c\u5c06\u7528\u4e8e\u8f93\u51fa\u8868\u793a\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `False`\uff0c\u5219\u6587\u4ef6\u540d\u5b57\u7b26\u4e32\u503c\u5c06\u7528\u4e8e\u8f93\u51fa\u8868\u793a\u3002\u9ed8\u8ba4\u4e3a `UPLOADED_FILES_USE_URL` settings key \u7684\u503c\uff0c\u9664\u975e\u53e6\u6709\u8bbe\u7f6e\uff0c\u5426\u5219\u4e3a `True`\u3002\r\n\r\n\u9700\u8981 `Pillow` \u5e93\u6216 `PIL` \u5e93\u3002  \u5efa\u8bae\u4f7f\u7528 `Pillow` \u5e93\u3002 \u56e0\u4e3a `PIL` \u5df2\u7ecf\u4e0d\u518d\u7ef4\u62a4\u3002\r\n\r\n---\r\n\r\n# \u590d\u5408\u5b57\u6bb5\r\n\r\n## ListField\r\n\r\n\u9a8c\u8bc1\u5bf9\u8c61\u5217\u8868\u7684\u5b57\u6bb5\u7c7b\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `ListField(child=<A_FIELD_INSTANCE>, min_length=None, max_length=None)`\r\n\r\n- `child` - \u5e94\u8be5\u7528\u4e8e\u9a8c\u8bc1\u5217\u8868\u4e2d\u7684\u5bf9\u8c61\u7684\u5b57\u6bb5\u5b9e\u4f8b\u3002\u5982\u679c\u672a\u63d0\u4f9b\u6b64\u53c2\u6570\uff0c\u5219\u5217\u8868\u4e2d\u7684\u5bf9\u8c61\u5c06\u4e0d\u4f1a\u88ab\u9a8c\u8bc1\u3002\r\n- `min_length` - \u9a8c\u8bc1\u5217\u8868\u4e2d\u5305\u542b\u7684\u5143\u7d20\u6570\u91cf\u4e0d\u5c11\u4e8e\u8fd9\u4e2a\u6570\u3002\r\n- `max_length` - \u9a8c\u8bc1\u5217\u8868\u4e2d\u5305\u542b\u7684\u5143\u7d20\u6570\u91cf\u4e0d\u8d85\u8fc7\u8fd9\u4e2a\u6570\u3002\r\n\r\n\u4f8b\u5982\uff0c\u8981\u9a8c\u8bc1\u6574\u6570\u5217\u8868\uff1a\r\n``` python\r\nscores = serializers.ListField(\r\n   child=serializers.IntegerField(min_value=0, max_value=100)\r\n)\r\n```\r\n`ListField` \u7c7b\u8fd8\u652f\u6301\u4e00\u79cd\u58f0\u660e\u5f0f\u98ce\u683c\uff0c\u5141\u8bb8\u7f16\u5199\u53ef\u91cd\u7528\u7684\u5217\u8868\u5b57\u6bb5\u7c7b\u3002\r\n\r\n``` python\r\nclass StringListField(serializers.ListField):\r\n    child = serializers.CharField()\r\n```\r\n\r\n\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u5728\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u91cd\u65b0\u4f7f\u7528\u6211\u4eec\u81ea\u5b9a\u4e49\u7684 `StringListField` \u7c7b\uff0c\u800c\u65e0\u9700\u4e3a\u5176\u63d0\u4f9b `child` \u53c2\u6570\u3002\r\n\r\n## DictField\r\n\r\n\u9a8c\u8bc1\u5bf9\u8c61\u5b57\u5178\u7684\u5b57\u6bb5\u7c7b\u3002`DictField` \u4e2d\u7684\u952e\u603b\u662f\u88ab\u5047\u5b9a\u4e3a\u5b57\u7b26\u4e32\u503c\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `DictField(child=<A_FIELD_INSTANCE>)`\r\n\r\n- `child` - \u5e94\u8be5\u7528\u4e8e\u9a8c\u8bc1\u5b57\u5178\u4e2d\u7684\u503c\u7684\u5b57\u6bb5\u5b9e\u4f8b\u3002\u5982\u679c\u672a\u63d0\u4f9b\u6b64\u53c2\u6570\uff0c\u5219\u6620\u5c04\u4e2d\u7684\u503c\u5c06\u4e0d\u4f1a\u88ab\u9a8c\u8bc1\u3002\r\n\r\n\u4f8b\u5982\uff0c\u8981\u521b\u5efa\u4e00\u4e2a\u9a8c\u8bc1\u5b57\u7b26\u4e32\u5230\u5b57\u7b26\u4e32\u6620\u5c04\u7684\u5b57\u6bb5\uff0c\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a\r\n\r\n``` python\r\ndocument = DictField(child=CharField())\r\n```\r\n\r\n\u4f60\u4e5f\u53ef\u4ee5\u50cf\u4f7f\u7528 `ListField` \u4e00\u6837\u4f7f\u7528\u58f0\u660e\u5f0f\u98ce\u683c\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass DocumentField(DictField):\r\n    child = CharField()\r\n```\r\n\r\n## JSONField\r\n\r\n\u9a8c\u8bc1\u4f20\u5165\u7684\u6570\u636e\u7ed3\u6784\u7531\u6709\u6548 JSON \u57fa\u5143\u7ec4\u6210\u7684\u5b57\u6bb5\u7c7b\u3002\u5728\u5176\u4e8c\u8fdb\u5236\u6a21\u5f0f\u4e0b\uff0c\u5b83\u5c06\u8868\u793a\u5e76\u9a8c\u8bc1 JSON \u7f16\u7801\u7684\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `JSONField(binary)`\r\n\r\n- `binary` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u90a3\u4e48\u8be5\u5b57\u6bb5\u5c06\u8f93\u51fa\u5e76\u9a8c\u8bc1 JSON \u7f16\u7801\u7684\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f\u539f\u59cb\u6570\u636e\u7ed3\u6784\u3002\u9ed8\u8ba4\u662f `False`.\r\n\r\n---\r\n\r\n# \u5176\u4ed6\u7c7b\u578b\u7684\u5b57\u6bb5\r\n\r\n## ReadOnlyField\r\n\r\n\u53ea\u662f\u7b80\u5355\u5730\u8fd4\u56de\u5b57\u6bb5\u7684\u503c\u800c\u4e0d\u8fdb\u884c\u4fee\u6539\u7684\u5b57\u6bb5\u7c7b\u3002\r\n\r\n\u5f53\u5305\u542b\u4e0e\u5c5e\u6027\u76f8\u5173\u7684\u5b57\u6bb5\u540d\u800c\u4e0d\u662f\u6a21\u578b\u5b57\u6bb5\u65f6\uff0c\u6b64\u5b57\u6bb5\u9ed8\u8ba4\u4e0e `ModelSerializer` \u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `ReadOnlyField()`\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c `has_expired` \u662f `Account` \u6a21\u578b\u4e2d\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u5219\u4ee5\u4e0b\u5e8f\u5217\u5316\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u5c06\u5176\u751f\u6210\u4e3a `ReadOnlyField` \uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = ('id', 'account_name', 'has_expired')\r\n```\r\n\r\n## HiddenField\r\n\r\n\u4e0d\u6839\u636e\u7528\u6237\u8f93\u5165\u83b7\u53d6\u503c\u7684\u5b57\u6bb5\u7c7b\uff0c\u800c\u662f\u4ece\u9ed8\u8ba4\u503c\u6216\u53ef\u8c03\u7528\u503c\u4e2d\u83b7\u53d6\u503c\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `HiddenField()`\r\n\r\n\u4f8b\u5982\uff0c\u8981\u5305\u542b\u59cb\u7ec8\u63d0\u4f9b\u5f53\u524d\u65f6\u95f4\u7684\u5b57\u6bb5\u4f5c\u4e3a\u5e8f\u5217\u5316\u7c7b\u9a8c\u8bc1\u6570\u636e\u7684\u4e00\u90e8\u5206\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5185\u5bb9\uff1a\r\n\r\n``` python\r\nmodified = serializers.HiddenField(default=timezone.now)\r\n```\r\n\r\n\u5982\u679c\u9700\u8981\u6839\u636e\u67d0\u4e9b\u9884\u5148\u63d0\u4f9b\u7684\u5b57\u6bb5\u503c\u8fd0\u884c\u67d0\u4e9b\u9a8c\u8bc1\uff0c\u5219\u901a\u5e38\u53ea\u9700\u8981 `HiddenField` \u7c7b\uff0c\u800c\u4e0d\u662f\u5c06\u6240\u6709\u8fd9\u4e9b\u5b57\u6bb5\u516c\u5f00\u7ed9\u6700\u7ec8\u7528\u6237\u3002\r\n\r\n## ModelField\r\n\r\n\u53ef\u4ee5\u7ed1\u5b9a\u5230\u4efb\u610f\u6a21\u578b\u5b57\u6bb5\u7684\u901a\u7528\u5b57\u6bb5\u3002`ModelField` \u7c7b\u5c06\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u7684\u4efb\u52a1\u59d4\u6258\u7ed9\u5176\u5173\u8054\u7684\u6a21\u578b\u5b57\u6bb5\u3002\u8be5\u5b57\u6bb5\u53ef\u7528\u4e8e\u4e3a\u81ea\u5b9a\u4e49\u6a21\u578b\u5b57\u6bb5\u521b\u5efa\u5e8f\u5217\u5316\u5b57\u6bb5\uff0c\u800c\u65e0\u9700\u521b\u5efa\u65b0\u7684\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u5b57\u6bb5\u3002\r\n\r\n`ModelSerializer` \u4f7f\u7528\u6b64\u5b57\u6bb5\u6765\u5bf9\u5e94\u81ea\u5b9a\u4e49\u6a21\u578b\u5b57\u6bb5\u7c7b\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `ModelField(model_field=<Django ModelField instance>)`\r\n\r\n`ModelField` \u7c7b\u901a\u5e38\u7528\u4e8e\u5185\u90e8\u4f7f\u7528\uff0c\u4f46\u5982\u679c\u9700\u8981\uff0c\u53ef\u4ee5\u7531 API \u4f7f\u7528\u3002\u4e3a\u4e86\u6b63\u786e\u5b9e\u4f8b\u5316 `ModelField`\uff0c\u5fc5\u987b\u4f20\u9012\u4e00\u4e2a\u9644\u52a0\u5230\u5b9e\u4f8b\u5316\u6a21\u578b\u7684\u5b57\u6bb5\u3002\u4f8b\u5982\uff1a`ModelField(model_field=MyModel()._meta.get_field('custom_field'))`\r\n\r\n## SerializerMethodField\r\n\r\n\u8fd9\u662f\u4e00\u4e2a\u53ea\u8bfb\u5b57\u6bb5\u3002\u5b83\u901a\u8fc7\u8c03\u7528\u5b83\u6240\u8fde\u63a5\u7684\u5e8f\u5217\u5316\u7c7b\u7684\u65b9\u6cd5\u6765\u83b7\u5f97\u5b83\u7684\u503c\u3002\u5b83\u53ef\u7528\u4e8e\u5c06\u4efb\u4f55\u7c7b\u578b\u7684\u6570\u636e\u6dfb\u52a0\u5230\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u8868\u793a\u4e2d\u3002\r\n\r\n**\u7b7e\u540d\uff1a** `SerializerMethodField(method_name=None)`\r\n\r\n- `method_name` - \u8981\u8c03\u7528\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u65b9\u6cd5\u7684\u540d\u79f0\u3002\u5982\u679c\u4e0d\u5305\u542b\uff0c\u5219\u9ed8\u8ba4\u4e3a `get_<field_name>`.\r\n\r\n\u7531 `method_name` \u53c2\u6570\u5f15\u7528\u7684\u5e8f\u5217\u5316\u65b9\u6cd5\u5e94\u8be5\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff08\u9664\u4e86 `self`\uff09\uff0c\u8fd9\u662f\u8981\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u3002\u5b83\u5e94\u8be5\u8fd4\u56de\u4f60\u60f3\u8981\u5305\u542b\u5728\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u8868\u793a\u4e2d\u7684\u4efb\u4f55\u5185\u5bb9\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom django.contrib.auth.models import User\r\nfrom django.utils.timezone import now\r\nfrom rest_framework import serializers\r\n\r\nclass UserSerializer(serializers.ModelSerializer):\r\n    days_since_joined = serializers.SerializerMethodField()\r\n\r\n    class Meta:\r\n        model = User\r\n\r\n    def get_days_since_joined(self, obj):\r\n        return (now() - obj.date_joined).days\r\n```\r\n\r\n\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u5b57\u6bb5\r\n\r\n\u5982\u679c\u4f60\u60f3\u521b\u5efa\u81ea\u5b9a\u4e49\u5b57\u6bb5\uff0c\u5219\u9700\u8981\u5bf9 `Field` \u8fdb\u884c\u5b50\u7c7b\u5316\uff0c\u7136\u540e\u91cd\u5199 `.to_representation()` \u548c `.to_internal_value()` \u65b9\u6cd5\u4e2d\u7684\u4e00\u4e2a\u6216\u4e24\u4e2a\u3002\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u7528\u4e8e\u5728\u521d\u59cb\u6570\u636e\u7c7b\u578b\u548c\u57fa\u672c\u5e8f\u5217\u5316\u6570\u636e\u7c7b\u578b\u4e4b\u95f4\u8fdb\u884c\u8f6c\u6362\u3002\u57fa\u672c\u6570\u636e\u7c7b\u578b\u901a\u5e38\u662f number\uff0cstring\uff0c boolean\uff0c `date`/`time`/`datetime` \u6216 `None` \u3002\u5b83\u4eec\u4e5f\u53ef\u4ee5\u662f\u4efb\u4f55\u4ec5\u5305\u542b\u5176\u4ed6\u57fa\u672c\u5bf9\u8c61\u7684\u5217\u8868\u6216\u5b57\u5178\u3002\u5176\u4ed6\u7c7b\u578b\u53ef\u80fd\u4f1a\u652f\u6301\uff0c\u4f46\u5177\u4f53\u53d6\u51b3\u4e8e\u4f60\u4f7f\u7528\u7684\u6e32\u67d3\u5668\u3002\r\n\r\n\u8c03\u7528 `.to_representation()` \u65b9\u6cd5\u5c06\u521d\u59cb\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u4e3a\u57fa\u672c\u7684\u53ef\u5e8f\u5217\u5316\u6570\u636e\u7c7b\u578b\u3002\r\n\r\n\u8c03\u7528 `to_internal_value()` \u65b9\u6cd5\u5c06\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6062\u590d\u4e3a\u5176\u5185\u90e8 python \u8868\u793a\u5f62\u5f0f\u3002\u5982\u679c\u6570\u636e\u65e0\u6548\uff0c\u6b64\u65b9\u6cd5\u5e94\u8be5\u5f15\u53d1 `serializers.ValidationError` \u5f02\u5e38\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c2.x \u7248\u672c\u4e2d\u5b58\u5728\u7684 `WritableField` \u7c7b\u4e0d\u518d\u5b58\u5728\u3002 \u5e94\u6b64\uff0c\u5982\u679c\u5b57\u6bb5\u9700\u8981\u652f\u6301\u6570\u636e\u8f93\u5165\uff0c\u5219\u5e94\u8be5\u7ee7\u627f `Field` \u5e76\u8986\u76d6 `to_internal_value()`\u3002\r\n\r\n## \u770b\u51e0\u4e2a\u6817\u5b50\r\n\r\n### \u57fa\u672c\u7684\u81ea\u5b9a\u4e49\u5b57\u6bb5\r\n\r\n\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5e8f\u5217\u5316\u4ee3\u8868 RGB \u989c\u8272\u503c\u7684\u7c7b\u7684\u4f8b\u5b50\uff1a\r\n\r\n``` python\r\nclass Color(object):\r\n    \"\"\"\r\n    A color represented in the RGB colorspace.\r\n    \"\"\"\r\n    def __init__(self, red, green, blue):\r\n        assert(red >= 0 and green >= 0 and blue >= 0)\r\n        assert(red < 256 and green < 256 and blue < 256)\r\n        self.red, self.green, self.blue = red, green, blue\r\n\r\nclass ColorField(serializers.Field):\r\n    \"\"\"\r\n    Color objects are serialized into 'rgb(#, #, #)' notation.\r\n    \"\"\"\r\n    def to_representation(self, obj):\r\n        return \"rgb(%d, %d, %d)\" % (obj.red, obj.green, obj.blue)\r\n\r\n    def to_internal_value(self, data):\r\n        data = data.strip('rgb(').rstrip(')')\r\n        red, green, blue = [int(col) for col in data.split(',')]\r\n        return Color(red, green, blue)\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b57\u6bb5\u503c\u88ab\u89c6\u4e3a\u6620\u5c04\u5230\u5bf9\u8c61\u7684\u5c5e\u6027\u3002\u5982\u679c\u9700\u8981\u81ea\u5b9a\u4e49\u5b57\u6bb5\u503c\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u5219\u9700\u8981\u8986\u76d6  `.get_attribute()` \u548c/\u6216 `.get_value()`\u3002\r\n\r\n\u8ba9\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u53ef\u4ee5\u7528\u6765\u8868\u793a\u88ab\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u7c7b\u540d\u7684\u5b57\u6bb5\uff1a\r\n\r\n``` python\r\nclass ClassNameField(serializers.Field):\r\n    def get_attribute(self, obj):\r\n        # We pass the object instance onto `to_representation`,\r\n        # not just the field attribute.\r\n        return obj\r\n\r\n    def to_representation(self, obj):\r\n        \"\"\"\r\n        Serialize the object's class name.\r\n        \"\"\"\r\n        return obj.__class__.__name__\r\n```\r\n\r\n### \u629b\u51fa\u9a8c\u8bc1\u9519\u8bef\r\n\r\n\u6211\u4eec\u4e0a\u9762\u7684 `ColorField` \u7c7b\u76ee\u524d\u4e0d\u6267\u884c\u4efb\u4f55\u6570\u636e\u9a8c\u8bc1\u3002\u4e3a\u4e86\u8868\u793a\u65e0\u6548\u6570\u636e\uff0c\u6211\u4eec\u5e94\u8be5\u5f15\u53d1\u4e00\u4e2a `serializers.ValidationError`\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\ndef to_internal_value(self, data):\r\n    if not isinstance(data, six.text_type):\r\n        msg = 'Incorrect type. Expected a string, but got %s'\r\n        raise ValidationError(msg % type(data).__name__)\r\n\r\n    if not re.match(r'^rgb\\([0-9]+,[0-9]+,[0-9]+\\)$', data):\r\n        raise ValidationError('Incorrect format. Expected `rgb(#,#,#)`.')\r\n\r\n    data = data.strip('rgb(').rstrip(')')\r\n    red, green, blue = [int(col) for col in data.split(',')]\r\n\r\n    if any([col > 255 or col < 0 for col in (red, green, blue)]):\r\n        raise ValidationError('Value out of range. Must be between 0 and 255.')\r\n\r\n    return Color(red, green, blue)\r\n```\r\n\r\n`.fail()` \u65b9\u6cd5\u662f\u5f15\u53d1 `ValidationError` \u7684\u5feb\u6377\u65b9\u5f0f\uff0c\u5b83\u4ece `error_messages` \u5b57\u5178\u4e2d\u63a5\u6536\u6d88\u606f\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\ndefault_error_messages = {\r\n    'incorrect_type': 'Incorrect type. Expected a string, but got {input_type}',\r\n    'incorrect_format': 'Incorrect format. Expected `rgb(#,#,#)`.',\r\n    'out_of_range': 'Value out of range. Must be between 0 and 255.'\r\n}\r\n\r\ndef to_internal_value(self, data):\r\n    if not isinstance(data, six.text_type):\r\n        self.fail('incorrect_type', input_type=type(data).__name__)\r\n\r\n    if not re.match(r'^rgb\\([0-9]+,[0-9]+,[0-9]+\\)$', data):\r\n        self.fail('incorrect_format')\r\n\r\n    data = data.strip('rgb(').rstrip(')')\r\n    red, green, blue = [int(col) for col in data.split(',')]\r\n\r\n    if any([col > 255 or col < 0 for col in (red, green, blue)]):\r\n        self.fail('out_of_range')\r\n\r\n    return Color(red, green, blue)\r\n```\r\n\r\n\u8fd9\u79cd\u98ce\u683c\u8ba9\u4f60\u7684\u9519\u8bef\u4fe1\u606f\u66f4\u6e05\u6670\uff0c\u5e76\u4e14\u4e0e\u4ee3\u7801\u5206\u79bb\uff0c\u5e94\u8be5\u662f\u9996\u9009\u3002\r\n\r\n### \u4f7f\u7528 `source='*'`\r\n\r\n\u8fd9\u91cc\u6211\u4eec\u5c06\u4e3e\u4e00\u4e2a\u5177\u6709 `x_coordinate` \u548c `y_coordinate` \u5c5e\u6027\u7684\u5e73\u9762 `DataPoint` \u6a21\u578b\u7684\u793a\u4f8b\u3002\r\n\r\n``` python\r\nclass DataPoint(models.Model):\r\n    label = models.CharField(max_length=50)\r\n    x_coordinate = models.SmallIntegerField()\r\n    y_coordinate = models.SmallIntegerField()\r\n```\r\n\r\n\u4f7f\u7528\u81ea\u5b9a\u4e49\u5b57\u6bb5\u548c `source ='*'`\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u4f9b\u5750\u6807\u5bf9\u7684\u5d4c\u5957\u8868\u793a\u5f62\u5f0f\uff1a\r\n\r\n``` python\r\nclass CoordinateField(serializers.Field):\r\n\r\n    def to_representation(self, obj):\r\n        ret = {\r\n            \"x\": obj.x_coordinate,\r\n            \"y\": obj.y_coordinate\r\n        }\r\n        return ret\r\n\r\n    def to_internal_value(self, data):\r\n        ret = {\r\n            \"x_coordinate\": data[\"x\"],\r\n            \"y_coordinate\": data[\"y\"],\r\n        }\r\n        return ret\r\n\r\n\r\nclass DataPointSerializer(serializers.ModelSerializer):\r\n    coordinates = CoordinateField(source='*')\r\n\r\n    class Meta:\r\n        model = DataPoint\r\n        fields = ['label', 'coordinates']\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u6b64\u793a\u4f8b\u4e0d\u5904\u7406\u9a8c\u8bc1\u3002\u4f7f\u7528 `source ='*'` \u7684\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\u53ef\u4ee5\u66f4\u597d\u5730\u5904\u7406\u5750\u6807\u5d4c\u5957\uff0c\u5e76\u4e14\u5e26\u6709\u4e24\u4e2a `IntegerField` \u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u6709\u81ea\u5df1\u7684 `source` \u6307\u5411\u76f8\u5173\u5b57\u6bb5\u3002\r\n\r\n\u7136\u800c\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u7684\u5173\u952e\u70b9\u662f\uff1a\r\n\r\n* `to_representation` \u4f20\u9012\u6574\u4e2a `DataPoint` \u5bf9\u8c61\uff0c \u5e76\u4e14\u4f1a\u6620\u5c04\u5230\u6240\u9700\u7684\u8f93\u51fa\u3002\r\n\r\n``` python\r\n>>> instance = DataPoint(label='Example', x_coordinate=1, y_coordinate=2)\r\n>>> out_serializer = DataPointSerializer(instance)\r\n>>> out_serializer.data\r\nReturnDict([('label', 'Example'), ('coordinates', {'x': 1, 'y': 2})])\r\n```\r\n\r\n* \u9664\u975e\u6211\u4eec\u7684\u5b57\u6bb5\u662f\u53ea\u8bfb\u7684\uff0c\u5426\u5219 `to_internal_value` \u5fc5\u987b\u6620\u5c04\u56de\u9002\u5408\u66f4\u65b0\u76ee\u6807\u5bf9\u8c61\u7684\u5b57\u5178\u3002\u4f7f\u7528 `source='*'` \uff0c`to_internal_value` \u7684\u8fd4\u56de\u5c06\u66f4\u65b0\u6839\u9a8c\u8bc1\u7684\u6570\u636e\u5b57\u5178\uff0c\u800c\u4e0d\u662f\u5355\u4e2a\u952e\u3002\r\n\r\n``` python\r\n>>> data = {\r\n...     \"label\": \"Second Example\",\r\n...     \"coordinates\": {\r\n...         \"x\": 3,\r\n...         \"y\": 4,\r\n...     }\r\n... }\r\n>>> in_serializer = DataPointSerializer(data=data)\r\n>>> in_serializer.is_valid()\r\nTrue\r\n>>> in_serializer.validated_data\r\nOrderedDict([('label', 'Second Example'),\r\n             ('y_coordinate', 4),\r\n             ('x_coordinate', 3)])\r\n```\r\n\r\n\u4e3a\u4e86\u5b8c\u6574\u6027\uff0c\u6211\u4eec\u518d\u6b21\u505a\u540c\u6837\u7684\u4e8b\u60c5\uff0c\u4f46\u662f\u4f7f\u7528\u4e0a\u9762\u5efa\u8bae\u7684\u5d4c\u5957\u5e8f\u5217\u5316\u65b9\u6cd5\uff1a\r\n\r\n``` python\r\nclass NestedCoordinateSerializer(serializers.Serializer):\r\n    x = serializers.IntegerField(source='x_coordinate')\r\n    y = serializers.IntegerField(source='y_coordinate')\r\n\r\n\r\nclass DataPointSerializer(serializers.ModelSerializer):\r\n    coordinates = NestedCoordinateSerializer(source='*')\r\n\r\n    class Meta:\r\n        model = DataPoint\r\n        fields = ['label', 'coordinates']\r\n```\r\n\r\n\u8fd9\u91cc\uff0c\u6211\u4eec\u5728 `IntegerField` \u58f0\u660e\u4e2d\u5904\u7406\u76ee\u6807\u548c\u6e90\u5c5e\u6027\u5bf9\uff08`x` \u548c `x_coordinate`\uff0c`y` \u548c `y_coordinate` \uff09\u4e4b\u95f4\u7684\u6620\u5c04\u3002\u8fd9\u662f\u4f7f\u7528\u4e86 `source ='*'` \u7684 `NestedCoordinateSerializer` \u3002\r\n\r\n\u65b0\u7684 `DataPointSerializer` \u5c55\u73b0\u51fa\u4e0e\u81ea\u5b9a\u4e49\u5b57\u6bb5\u65b9\u6cd5\u76f8\u540c\u7684\u884c\u4e3a\u3002\r\n\r\n\u5e8f\u5217\u5316\uff1a\r\n\r\n``` python\r\n>>> out_serializer = DataPointSerializer(instance)\r\n>>> out_serializer.data\r\nReturnDict([('label', 'testing'),\r\n            ('coordinates', OrderedDict([('x', 1), ('y', 2)]))])\r\n```\r\n\r\n\u53cd\u5e8f\u5217\u5316\uff1a\r\n\r\n``` python\r\n>>> in_serializer = DataPointSerializer(data=data)\r\n>>> in_serializer.is_valid()\r\nTrue\r\n>>> in_serializer.validated_data\r\nOrderedDict([('label', 'still testing'),\r\n             ('x_coordinate', 3),\r\n             ('y_coordinate', 4)])\r\n```\r\n\r\n\u867d\u7136\u6ca1\u6709\u7f16\u5199\u9a8c\u8bc1\uff0c\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528\u5185\u7f6e\u7684\u9a8c\u8bc1\u65b9\u5f0f\uff1a\r\n\r\n``` python\r\n>>> invalid_data = {\r\n...     \"label\": \"still testing\",\r\n...     \"coordinates\": {\r\n...         \"x\": 'a',\r\n...         \"y\": 'b',\r\n...     }\r\n... }\r\n>>> invalid_serializer = DataPointSerializer(data=invalid_data)\r\n>>> invalid_serializer.is_valid()\r\nFalse\r\n>>> invalid_serializer.errors\r\nReturnDict([('coordinates',\r\n             {'x': ['A valid integer is required.'],\r\n              'y': ['A valid integer is required.']})])\r\n```\r\n\r\n\u51fa\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u53ef\u4ee5\u9996\u5148\u5c1d\u8bd5\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\u65b9\u6cd5\u3002\u5f53\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\u53d8\u5f97\u4e0d\u53ef\u884c\u6216\u8fc7\u4e8e\u590d\u6742\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u5b57\u6bb5\u65b9\u6cd5\u3002\r\n\r\n\r\n[cite]: https://docs.djangoproject.com/en/stable/ref/forms/api/#django.forms.Form.cleaned_data\r\n[html-and-forms]: ../topics/html-and-forms.md\r\n[FILE_UPLOAD_HANDLERS]: https://docs.djangoproject.com/en/stable/ref/settings/#std:setting-FILE_UPLOAD_HANDLERS\r\n[strftime]: https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior\r\n[iso8601]: https://www.w3.org/TR/NOTE-datetime\r\n[drf-compound-fields]: https://drf-compound-fields.readthedocs.io\r\n[drf-extra-fields]: https://github.com/Hipo/drf-extra-fields\r\n[djangorestframework-recursive]: https://github.com/heywbj/django-rest-framework-recursive\r\n[django-rest-framework-gis]: https://github.com/djangonauts/django-rest-framework-gis\r\n[django-rest-framework-hstore]: https://github.com/djangonauts/django-rest-framework-hstore\r\n[django-hstore]: https://github.com/djangonauts/django-hstore\r\n[python-decimal-rounding-modes]: https://docs.python.org/3/library/decimal.html#rounding-modes\r\n", "md_File": "subject/django-rest-framework-api-guide/fields.md", "create_date": "2020-02-20T13:10:40.578", "order": 10}}, {"model": "subject.chapter", "pk": 150, "fields": {"title": "\u901a\u7528\u89c6\u56fegenericviews", "topic": 7, "md5": "f471a94970a177e8de60d5bc722a59e7", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/generic-views/)\r\n\r\n## \u901a\u7528\u89c6\u56fe\r\n\r\n\u57fa\u4e8e\u7c7b\u7684\u89c6\u56fe\u7684\u4e00\u4e2a\u4e3b\u8981\u4f18\u70b9\u662f\u5b83\u4eec\u5141\u8bb8\u4f60\u7f16\u5199\u53ef\u91cd\u590d\u4f7f\u7528\u7684\u884c\u4e3a\u3002 REST framework \u901a\u8fc7\u63d0\u4f9b\u5927\u91cf\u9884\u6784\u5efa\u89c6\u56fe\u6765\u63d0\u4f9b\u5e38\u7528\u6a21\u5f0f\uff0c\u4ece\u800c\u5145\u5206\u5229\u7528\u4e86\u8fd9\u4e00\u70b9\u3002\r\n\r\nREST framework  \u63d0\u4f9b\u7684\u901a\u7528\u89c6\u56fe\u5141\u8bb8\u60a8\u5feb\u901f\u6784\u5efa\u7d27\u5bc6\u6620\u5c04\u5230\u6570\u636e\u5e93\u6a21\u578b\u7684 API \u89c6\u56fe\u3002\r\n\r\n\u5982\u679c\u901a\u7528\u89c6\u56fe\u4e0d\u7b26\u5408\u9700\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e38\u89c4\u7684 `APIView` \u7c7b\uff0c\u6216\u8005\u5229\u7528 mixin \u7279\u6027\u548c\u57fa\u7c7b\u7ec4\u5408\u51fa\u53ef\u91cd\u7528\u7684\u89c6\u56fe\u3002\r\n\r\n### \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u901a\u5e38\uff0c\u5728\u4f7f\u7528\u901a\u7528\u89c6\u56fe\u65f6\uff0c\u60a8\u9700\u8981\u7ee7\u627f\u8be5\u89c6\u56fe\uff0c\u5e76\u8bbe\u7f6e\u51e0\u4e2a\u7c7b\u5c5e\u6027\u3002  \r\n\r\n``` python\r\nfrom django.contrib.auth.models import User\r\nfrom myapp.serializers import UserSerializer\r\nfrom rest_framework import generics\r\nfrom rest_framework.permissions import IsAdminUser\r\n\r\nclass UserList(generics.ListCreateAPIView):\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    permission_classes = (IsAdminUser,)\r\n```\r\n\r\n\u5bf9\u4e8e\u66f4\u590d\u6742\u7684\u60c5\u51b5\uff0c\u60a8\u53ef\u80fd\u8fd8\u60f3\u91cd\u5199\u89c6\u56fe\u7c7b\u4e2d\u7684\u5404\u79cd\u65b9\u6cd5\u3002\u4f8b\u5982\u3002\r\n\r\n``` python\r\nclass UserList(generics.ListCreateAPIView):\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    permission_classes = (IsAdminUser,)\r\n\r\n    def list(self, request):\r\n        # \u6ce8\u610f\u4f7f\u7528`get_queryset()`\u800c\u4e0d\u662f`self.queryset`\r\n        queryset = self.get_queryset()\r\n        serializer = UserSerializer(queryset, many=True)\r\n        return Response(serializer.data)\r\n```\r\n\r\n\u5bf9\u4e8e\u975e\u5e38\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u60a8\u53ef\u80fd\u60f3\u8981\u4f7f\u7528 `.as_view()` \u65b9\u6cd5\u6765\u4f20\u9012\u7c7b\u5c5e\u6027\u3002\u4f8b\u5982\uff0c\u60a8\u7684 URLconf \u53ef\u80fd\u5305\u542b\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u6761\u76ee\u7684\u5185\u5bb9\uff1a\r\n\r\n``` python\r\nurl(r'^/users/', ListCreateAPIView.as_view(queryset=User.objects.all(), serializer_class=UserSerializer), name='user-list')\r\n```\r\n\r\n> \u76f4\u63a5\u5728 URLconf \u4e2d\u8bbe\u7f6e\u76f8\u5173\u5c5e\u6027\u53c2\u6570\uff0c\u8fd9\u6837\u8fde\u89c6\u56fe\u7c7b\u90fd\u4e0d\u7528\u5199\u4e86\u3002\r\n\r\n\r\n\r\n## API \u53c2\u8003\r\n\r\n### GenericAPIView\r\n\r\n`GenericAPIView` \u7c7b\u7ee7\u627f\u4e8e REST framework \u7684 `APIView` \u7c7b\uff0c\u4e3a\u6807\u51c6\u5217\u8868\u548c\u8be6\u7ec6\u89c6\u56fe\u6dfb\u52a0\u4e86\u5e38\u89c1\u7684\u884c\u4e3a\u3002\r\n\r\n\u5185\u7f6e\u7684\u6bcf\u4e00\u4e2a\u5177\u4f53\u7684\u901a\u7528\u89c6\u56fe\u90fd\u662f\u901a\u8fc7\u5c06 `GenericAPIView` \u7c7b\u548c\u4e00\u4e2a\u6216\u591a\u4e2a minxin \u7c7b\u76f8\u4e92\u7ed3\u5408\u6765\u6784\u5efa\u7684\u3002\r\n\r\n#### \u5c5e\u6027\r\n\r\n##### \u57fa\u672c\u8bbe\u7f6e\r\n\r\n\u4ee5\u4e0b\u5c5e\u6027\u63a7\u5236\u57fa\u672c\u89c6\u56fe\u884c\u4e3a\u3002\r\n\r\n* `queryset` - \u7528\u4e8e\u4ece\u6b64\u89c6\u56fe\u8fd4\u56de\u5bf9\u8c61\u7684\u67e5\u8be2\u96c6\u3002\u901a\u5e38\uff0c\u60a8\u5fc5\u987b\u8bbe\u7f6e\u6b64\u5c5e\u6027\uff0c\u6216\u8986\u76d6 `get_queryset()`\u65b9\u6cd5\u3002\u5982\u679c\u4f60\u91cd\u5199\u4e86\u4e00\u4e2a\u89c6\u56fe\u65b9\u6cd5\uff0c\u5728\u89c6\u56fe\u65b9\u6cd5\u4e2d\uff0c\u4f60\u5e94\u8be5\u8c03\u7528 `get_queryset()` \u800c\u4e0d\u662f\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e2a\u5c5e\u6027\uff0c\u8fd9\u4e00\u70b9\u5f88\u91cd\u8981\uff01\u56e0\u4e3a REST \u4f1a\u5728\u5185\u90e8\u5bf9 `queryset` \u7684\u7ed3\u679c\u8fdb\u884c\u7f13\u5b58\u7528\u4e8e\u540e\u7eed\u6240\u6709\u8bf7\u6c42\u3002\r\n* `serializer_class` - \u7528\u4e8e\u9a8c\u8bc1\u548c\u53cd\u5e8f\u5217\u5316\u8f93\u5165\u4ee5\u53ca\u5e8f\u5217\u5316\u8f93\u51fa\u7684\u5e8f\u5217\u5316\u7c7b\u3002\u901a\u5e38\uff0c\u60a8\u5fc5\u987b\u8bbe\u7f6e\u6b64\u5c5e\u6027\uff0c\u6216\u8986\u76d6 `get_serializer_class()` \u65b9\u6cd5\u3002\r\n* `lookup_field` - \u7528\u4e8e\u6267\u884c\u5404\u4e2a\u6a21\u578b\u5b9e\u4f8b\u7684\u5bf9\u8c61\u67e5\u627e\u7684\u6a21\u578b\u5b57\u6bb5\u3002\u9ed8\u8ba4\u4e3a `'pk'`\u3002\u8bf7\u6ce8\u610f\uff0c\u4f7f\u7528 hyperlinked  API \u65f6\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u503c\uff0c\u5219\u9700\u8981\u786e\u4fdd API \u89c6\u56fe\u548c\u5e8f\u5217\u5316\u7c7b\u8bbe\u7f6e\u4e86  lookup field\u3002\r\n* `lookup_url_kwarg` - \u7528\u4e8e\u5bf9\u8c61\u67e5\u627e\u7684 URL \u5173\u952e\u5b57\u53c2\u6570\u3002URL conf \u5e94\u8be5\u5305\u542b\u4e0e\u6b64\u503c\u76f8\u5bf9\u5e94\u7684\u5173\u952e\u5b57\u53c2\u6570\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528\u4e0e `lookup_field` \u76f8\u540c\u7684\u503c\u3002\r\n\r\n\u5173\u4e8e\u540e\u4e24\u4e2a\u53c2\u6570\uff0c\u6211\u8fd9\u91cc\u9644\u4e0a\u5bf9\u8c61\u67e5\u8be2\u7684\u6e90\u7801\u5927\u5bb6\u5c31\u5e94\u8be5\u4e86\u89e3\u4e86\u3002\r\n\r\n\u7701\u7565\u90e8\u5206\u4ee3\u7801\uff0c\u65b9\u4fbf\u7406\u89e3\r\n\r\n``` python\r\ndef get_object(self):\r\n\t# \u5148\u83b7\u53d6\u6570\u636e\u96c6\r\n    queryset = self.filter_queryset(self.get_queryset())\r\n\t# \u62ff\u5230\u67e5\u8be2\u53c2\u6570\u7684 key\r\n    lookup_url_kwarg = self.lookup_url_kwarg or self.lookup_field\r\n\t# \u7ec4\u88c5\u6210 {key:value} \u7684\u5f62\u5f0f\r\n    filter_kwargs = {self.lookup_field: self.kwargs[lookup_url_kwarg]}\r\n    # \u67e5\u8be2\r\n    obj = get_object_or_404(queryset, **filter_kwargs)\r\n\t# \u6700\u540e\u8fd4\u56de\r\n    return obj\r\n```\r\n\r\n##### \u5206\u9875\r\n\r\n\u4e0e\u5217\u8868\u89c6\u56fe\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u4ee5\u4e0b\u5c5e\u6027\u7528\u4e8e\u63a7\u5236\u5206\u9875\u3002\r\n\r\n * `pagination_class` - \u5bf9\u5217\u8868\u8fdb\u884c\u5206\u9875\u65f6\u4f7f\u7528\u7684\u5206\u9875\u7c7b\u3002\u9ed8\u8ba4\u503c\u4e0e `DEFAULT_PAGINATION_CLASS` \u8bbe\u7f6e\u76f8\u540c\uff0c\u5373 `rest_framework.pagination.PageNumberPagination`\u3002\u8bbe\u7f6e `pagination_class = None` \u5c06\u7981\u7528\u6b64\u89c6\u56fe\u7684\u5206\u9875\u3002\r\n\r\n##### \u8fc7\u6ee4\r\n\r\n * `filter_backends` - \u7528\u4e8e\u8fc7\u6ee4\u67e5\u8be2\u96c6\u7684\u8fc7\u6ee4\u5668\u7c7b\u7684\u5217\u8868\u3002\u9ed8\u8ba4\u503c\u4e0e `DEFAULT_FILTER_BACKENDS` \u8bbe\u7f6e\u7684\u503c\u76f8\u540c\u3002\r\n\r\n\r\n#### \u65b9\u6cd5\r\n\r\n##### \u57fa\u672c\u65b9\u6cd5\r\n\r\n\r\n`get_queryset(self)`\r\n\r\n\u5e94\u8be5\u8fd4\u56de\u5217\u8868\u89c6\u56fe\u7684\u67e5\u8be2\u96c6\uff0c\u5e76\u5e94\u8be5\u5c06\u5176\u7528\u4f5c\u67e5\u770b\u8be6\u7ec6\u89c6\u56fe\u7684\u57fa\u7840\u3002\u9ed8\u8ba4\u8fd4\u56de\u7531 `queryset` \u5c5e\u6027\u6307\u5b9a\u7684\u67e5\u8be2\u96c6\u3002\r\n\r\n\u5e94\u8be5\u59cb\u7ec8\u4f7f\u7528\u6b64\u65b9\u6cd5\uff0c \u800c\u4e0d\u662f\u76f4\u63a5\u8bbf\u95ee `self.queryset`\uff0c\u56e0\u4e3a REST \u4f1a\u5728\u5185\u90e8\u5bf9 `self.queryset` \u7684\u7ed3\u679c\u8fdb\u884c\u7f13\u5b58\u7528\u4e8e\u540e\u7eed\u6240\u6709\u8bf7\u6c42\u3002\r\n\r\n\u53ef\u4ee5\u8986\u76d6\u4ee5\u63d0\u4f9b\u52a8\u6001\u884c\u4e3a\uff0c\u4f8b\u5982\u9488\u5bf9\u4e0d\u540c\u7528\u6237\u7684\u8bf7\u6c42\u8fd4\u56de\u4e0d\u540c\u7684\u6570\u636e\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n``` python\r\ndef get_queryset(self):\r\n    user = self.request.user\r\n    return user.accounts.all()\r\n```\r\n\r\n`get_object(self)`\r\n\r\n\u5e94\u8be5\u8fd4\u56de\u8be6\u7ec6\u89c6\u56fe\u7684\u5bf9\u8c61\u5b9e\u4f8b\u3002\u9ed8\u8ba4\u4f7f\u7528 `lookup_field` \u53c2\u6570\u6765\u8fc7\u6ee4\u57fa\u672c\u67e5\u8be2\u96c6\u3002\r\n\r\n\u53ef\u4ee5\u8986\u76d6\u4ee5\u63d0\u4f9b\u66f4\u590d\u6742\u7684\u884c\u4e3a\uff0c\u4f8b\u5982\u57fa\u4e8e\u591a\u4e2a URL kwarg \u7684\u5bf9\u8c61\u67e5\u627e\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n``` python\r\ndef get_object(self):\r\n    queryset = self.get_queryset()\r\n    filter = {}\r\n    for field in self.multiple_lookup_fields:\r\n        filter[field] = self.kwargs[field]\r\n\r\n    obj = get_object_or_404(queryset, **filter)\r\n    self.check_object_permissions(self.request, obj)\r\n    return obj\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u7684 API \u4e0d\u5305\u542b\u4efb\u4f55\u5bf9\u8c61\u7ea7\u6743\u9650\uff0c\u60a8\u53ef\u4ee5\u9009\u62e9\u6392\u9664 `self.check_object_permissions`\uff0c\u5e76\u7b80\u5355\u5730\u4ece `get_object_or_404` \u4e2d\u67e5\u627e\u8fd4\u56de\u5bf9\u8c61\u3002\r\n\r\n\r\n`filter_queryset(self, queryset)`\r\n\r\n\u7ed9\u5b9a\u4e00\u4e2a\u67e5\u8be2\u96c6\uff0c\u4f7f\u7528\u8fc7\u6ee4\u5668\u8fdb\u884c\u8fc7\u6ee4\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u67e5\u8be2\u96c6\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n``` python\r\ndef filter_queryset(self, queryset):\r\n    filter_backends = (CategoryFilter,)\r\n\r\n    if 'geo_route' in self.request.query_params:\r\n        filter_backends = (GeoRouteFilter, CategoryFilter)\r\n    elif 'geo_point' in self.request.query_params:\r\n        filter_backends = (GeoPointFilter, CategoryFilter)\r\n\r\n    for backend in list(filter_backends):\r\n        queryset = backend().filter_queryset(self.request, queryset, view=self)\r\n\r\n    return queryset\r\n```\r\n\r\n`get_serializer_class(self)`\r\n\r\n\u8fd4\u56de\u7528\u4e8e\u5e8f\u5217\u5316\u7684\u7c7b\u3002\u9ed8\u8ba4\u8fd4\u56de `serializer_class` \u5c5e\u6027\u3002\r\n\r\n\u53ef\u4ee5\u88ab\u8986\u76d6\u4ee5\u63d0\u4f9b\u52a8\u6001\u884c\u4e3a\uff0c\u4f8b\u5982\u4f7f\u7528\u4e0d\u540c\u7684\u5e8f\u5217\u5316\u5668\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u6216\u4e3a\u4e0d\u540c\u7c7b\u578b\u7684\u7528\u6237\u63d0\u4f9b\u4e0d\u540c\u7684\u5e8f\u5217\u5316\u5668\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n``` python\r\ndef get_serializer_class(self):\r\n    if self.request.user.is_staff:\r\n        return FullAccountSerializer\r\n    return BasicAccountSerializer\r\n```\r\n\r\n##### \u4fdd\u5b58\u548c\u5220\u9664\u94a9\u5b50\uff08hook\uff09\r\n\r\n\u4ee5\u4e0b\u65b9\u6cd5\u7531 mixin \u7c7b\u63d0\u4f9b\uff0c\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u91cd\u5199\u5bf9\u8c61\u7684\u4fdd\u5b58\u548c\u5220\u9664\u884c\u4e3a\u3002\r\n\r\n * `perform_create(self, serializer)` - \u4fdd\u5b58\u65b0\u5bf9\u8c61\u5b9e\u4f8b\u65f6\u7531 `CreateModelMixin` \u8c03\u7528\u3002\r\n * `perform_update(self, serializer)` - \u5728\u4fdd\u5b58\u73b0\u6709\u5bf9\u8c61\u5b9e\u4f8b\u65f6\u7531 `UpdateModelMixin` \u8c03\u7528\u3002\r\n * `perform_destroy(self, instance)` - \u5220\u9664\u5bf9\u8c61\u5b9e\u4f8b\u65f6\u7531 `DestroyModelMixin` \u8c03\u7528\u3002\r\n\r\n\u8fd9\u4e9b\u94a9\u5b50\uff08hook\uff09\u5bf9\u8bbe\u7f6e\u8bf7\u6c42\u4e2d\u9690\u542b\u7684\u4f46\u4e0d\u5c5e\u4e8e\u8bf7\u6c42\u6570\u636e\u7684\u5c5e\u6027\u7279\u522b\u6709\u7528\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u6839\u636e\u8bf7\u6c42\u7528\u6237\u6216\u57fa\u4e8e URL \u5173\u952e\u5b57\u53c2\u6570\u5728\u5bf9\u8c61\u4e0a\u8bbe\u7f6e\u5c5e\u6027\u3002\r\n\r\n``` python\r\ndef perform_create(self, serializer):\r\n    serializer.save(user=self.request.user)\r\n```\r\n\u8fd9\u4e9b\u8986\u76d6\u70b9\u5bf9\u4e8e\u6dfb\u52a0\u4fdd\u5b58\u5bf9\u8c61\u4e4b\u524d\u6216\u4e4b\u540e\u53d1\u751f\u7684\u884c\u4e3a\uff08\u5982\u53d1\u9001\u786e\u8ba4\u7535\u5b50\u90ae\u4ef6\u6216\u8bb0\u5f55\u66f4\u65b0\uff09\u4e5f\u7279\u522b\u6709\u7528\u3002\r\n\r\n``` python\r\ndef perform_create(self, serializer):\r\n    queryset = SignupRequest.objects.filter(user=self.request.user)\r\n    if queryset.exists():\r\n        raise ValidationError('You have already signed up')\r\n    serializer.save(user=self.request.user)\r\n```\r\n\r\n\u6ce8\u610f\uff1a\u8fd9\u4e9b\u65b9\u6cd5\u66ff\u4ee3\u65e7\u5f0f\u7248\u672c2.x `pre_save`\uff0c`post_save`\uff0c`pre_delete` \u548c `post_delete` \u65b9\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u4e0d\u518d\u53ef\u7528\u3002\r\n\r\n\r\n##### \u5176\u4ed6\u65b9\u6cd5\r\n\r\n\u901a\u5e38\u4e0d\u9700\u8981\u91cd\u5199\u4ee5\u4e0b\u65b9\u6cd5\uff0c\u4f46\u5982\u679c\u4f7f\u7528 `GenericAPIView` \u7f16\u5199\u81ea\u5b9a\u4e49\u89c6\u56fe\uff0c\u5219\u53ef\u80fd\u9700\u8981\u8c03\u7528\u5b83\u4eec\u3002\r\n\r\n * `get_serializer_context(self)` - \u8fd4\u56de\u5305\u542b\u5e94\u8be5\u63d0\u4f9b\u7ed9\u5e8f\u5217\u5316\u7684\u4efb\u4f55\u989d\u5916\u4e0a\u4e0b\u6587\u7684\u5b57\u5178\u3002\u9ed8\u8ba4\u5305\u62ec `'request'`, `'view'` \u548c `'format'` \u952e\u3002\r\n * `get_serializer(self, instance=None, data=None, many=False, partial=False)` - \u8fd4\u56de\u4e00\u4e2a\u5e8f\u5217\u5316\u5668\u5b9e\u4f8b\u3002\r\n * `get_paginated_response(self, data)` - \u8fd4\u56de\u5206\u9875\u6837\u5f0f\u7684 `Response` \u5bf9\u8c61\u3002\r\n * `paginate_queryset(self, queryset)` - \u6839\u636e\u9700\u8981\u4e3a\u67e5\u8be2\u96c6\u5206\u9875\uff0c\u6216\u8005\u8fd4\u56de\u4e00\u4e2a\u9875\u9762\u5bf9\u8c61\uff1b\u5982\u679c\u6ca1\u6709\u4e3a\u8be5\u89c6\u56fe\u914d\u7f6e\u5206\u9875\uff0c\u5219\u4e3a `None`\u3002\r\n * `filter_queryset(self, queryset)` - \u7ed9\u5b9a\u4e00\u4e2a\u67e5\u8be2\u96c6\uff0c\u4f7f\u7528\u8fc7\u6ee4\u5668\u8fdb\u884c\u8fc7\u6ee4\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u67e5\u8be2\u96c6\u3002\r\n\r\n\r\n## Mixins \r\n\r\nmixin \u7c7b\u7528\u4e8e\u63d0\u4f9b\u57fa\u672c\u89c6\u56fe\u884c\u4e3a\u7684\u64cd\u4f5c\u3002\u8bf7\u6ce8\u610f\uff0cmixin \u7c7b\u63d0\u4f9b\u4e86\u64cd\u4f5c\u65b9\u6cd5\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5b9a\u4e49\u5904\u7406\u65b9\u6cd5\uff0c\u5982 `.get()` \u548c `.post()`\u3002\u8fd9\u5141\u8bb8\u66f4\u7075\u6d3b\u7684\u884c\u4e3a\u7ec4\u5408\u3002\r\n\r\nmixin \u7c7b\u53ef\u4ee5\u4ece `rest_framework.mixins` \u4e2d\u5bfc\u5165\u3002\r\n\r\n### ListModelMixin\r\n\r\n\u63d0\u4f9b\u4e00\u4e2a `.list(request, *args, **kwargs)` \u65b9\u6cd5\uff0c\u5b9e\u73b0\u4e86\u5217\u51fa\u4e00\u4e2a\u67e5\u8be2\u96c6\u3002\r\n\r\n\u5982\u679c\u67e5\u8be2\u96c6\u5df2\u586b\u5145\uff0c\u5219\u8fd4\u56de `200 OK` \u54cd\u5e94\uff0c\u5e76\u5c06 queryset \u7684\u5e8f\u5217\u5316\u8868\u793a\u5f62\u5f0f\u4f5c\u4e3a\u54cd\u5e94\u7684\u4e3b\u4f53\u3002\u54cd\u5e94\u6570\u636e\u53ef\u4ee5\u8bbe\u7f6e\u5206\u9875\u3002\r\n\r\n\r\n### CreateModelMixin\r\n\r\n\u63d0\u4f9b `.create(request, *args, **kwargs)` \u65b9\u6cd5\uff0c\u5b9e\u73b0\u521b\u5efa\u548c\u4fdd\u5b58\u65b0\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u5982\u679c\u521b\u5efa\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a `201 Created` \u54cd\u5e94\uff0c\u5e76\u5c06\u8be5\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u8868\u793a\u5f62\u5f0f\u4f5c\u4e3a\u54cd\u5e94\u7684\u4e3b\u4f53\u3002\u5982\u679c\u8868\u793a\u5305\u542b\u540d\u4e3a url \u7684\u952e\uff0c\u5219\u54cd\u5e94\u7684 `Location` header  \u5c06\u586b\u5145\u8be5\u503c\u3002\r\n\r\n\u5982\u679c\u4e3a\u521b\u5efa\u5bf9\u8c61\u63d0\u4f9b\u7684\u8bf7\u6c42\u6570\u636e\u65e0\u6548\uff0c\u5219\u5c06\u8fd4\u56de `400 Bad Request` \u54cd\u5e94\uff0c\u5e76\u5c06\u9519\u8bef\u7ec6\u8282\u4f5c\u4e3a\u54cd\u5e94\u7684\u4e3b\u4f53\u3002\r\n\r\n### RetrieveModelMixin\r\n\r\n\u63d0\u4f9b `.retrieve(request, *args, **kwargs)` \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u5b9e\u73b0\u5728\u54cd\u5e94\u4e2d\u8fd4\u56de\u73b0\u6709\u7684\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u5982\u679c\u53ef\u4ee5\u83b7\u53d6\u5bf9\u8c61\uff0c\u5219\u8fd4\u56de `200 OK` \u54cd\u5e94\uff0c\u5e76\u5c06\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u8868\u793a\u4f5c\u4e3a\u54cd\u5e94\u7684\u4e3b\u4f53\u3002\u5426\u5219\uff0c\u5c06\u8fd4\u56de\u4e00\u4e2a `404 Not Found`\u3002\r\n\r\n\r\n\r\n### UpdateModelMixin\r\n\r\n\u63d0\u4f9b `.update(request, *args, **kwargs)` \u65b9\u6cd5\uff0c\u5b9e\u73b0\u66f4\u65b0\u548c\u4fdd\u5b58\u73b0\u6709\u6a21\u578b\u5b9e\u4f8b\u3002\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a `.partial_update(request, *args, **kwargs)` \u65b9\u6cd5\uff0c\u5b83\u4e0e\u66f4\u65b0\u65b9\u6cd5\u7c7b\u4f3c\uff0c\u53ea\u662f\u66f4\u65b0\u7684\u6240\u6709\u5b57\u6bb5\u90fd\u662f\u53ef\u9009\u7684\u3002\u8fd9\u5141\u8bb8\u652f\u6301 HTTP `PATCH` \u8bf7\u6c42\u3002\r\n\r\n\u5982\u679c\u6210\u529f\u66f4\u65b0\u5bf9\u8c61\uff0c\u5219\u8fd4\u56de `200 OK` \u54cd\u5e94\uff0c\u5e76\u5c06\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u8868\u793a\u5f62\u5f0f\u4f5c\u4e3a\u54cd\u5e94\u7684\u4e3b\u4f53\u3002\r\n\r\n\u5982\u679c\u63d0\u4f9b\u7684\u7528\u4e8e\u66f4\u65b0\u5bf9\u8c61\u7684\u8bf7\u6c42\u6570\u636e\u65e0\u6548\uff0c\u5219\u5c06\u8fd4\u56de `400 Bad Request` \u54cd\u5e94\uff0c\u5e76\u5c06\u9519\u8bef\u7ec6\u8282\u4f5c\u4e3a\u54cd\u5e94\u7684\u4e3b\u4f53\u3002\r\n\r\n\r\n### DestroyModelMixin\r\n\r\n\u63d0\u4f9b\u4e00\u4e2a `.destroy(request, *args, **kwargs)` \u65b9\u6cd5\uff0c\u5b9e\u73b0\u73b0\u6709\u6a21\u578b\u5b9e\u4f8b\u7684\u5220\u9664\u3002\r\n\r\n\u5982\u679c\u4e00\u4e2a\u5bf9\u8c61\u88ab\u5220\u9664\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a `204 No Content` \uff0c\u5426\u5219\u5b83\u5c06\u8fd4\u56de\u4e00\u4e2a `404 Not Found`\u3002\r\n\r\n\r\n\r\n## \u5185\u7f6e\u89c6\u56fe\u7c7b\u5217\u8868\r\n\r\n\u4ee5\u4e0b\u7c7b\u662f\u5177\u4f53\u7684\u901a\u7528\u89c6\u56fe\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4f60\u5e94\u8be5\u90fd\u662f\u4f7f\u7528\u7684\u5b83\u4eec\uff0c\u9664\u975e\u9700\u8981\u9ad8\u5ea6\u7684\u81ea\u5b9a\u4e49\u884c\u4e3a\u3002\r\n\r\n\r\n\u8fd9\u4e9b\u89c6\u56fe\u7c7b\u53ef\u4ee5\u4ece `rest_framework.generics` \u4e2d\u5bfc\u5165\u3002\r\n\r\n\r\n### CreateAPIView\r\n\r\n\u4ec5\u7528\u4e8e\u521b\u5efa\u5b9e\u4f8b\u3002\r\n\r\n\u63d0\u4f9b\u4e00\u4e2a `post` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, `CreateModelMixin`\r\n\r\n### ListAPIView\r\n\r\n\u4ec5\u7528\u4e8e\u8bfb\u53d6\u6a21\u578b\u5b9e\u4f8b\u5217\u8868\u3002\r\n\r\n\u63d0\u4f9b\u4e00\u4e2a `get` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, `ListModelMixin`\r\n\r\n### RetrieveAPIView\r\n\r\n\u4ec5\u7528\u4e8e\u67e5\u8be2\u5355\u4e2a\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u63d0\u4f9b\u4e00\u4e2a `get` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, `RetrieveModelMixin`\r\n\r\n### DestroyAPIView\r\n\r\n\u4ec5\u7528\u4e8e\u5220\u9664\u5355\u4e2a\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u63d0\u4f9b\u4e00\u4e2a `delete` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, `DestroyModelMixin`\r\n\r\n\r\n### UpdateAPIView\r\n\r\n\u4ec5\u7528\u4e8e\u66f4\u65b0\u5355\u4e2a\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u63d0\u4f9b `put` \u548c `patch` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, `UpdateModelMixin`\r\n\r\n### ListCreateAPIView\r\n\r\n\u65e2\u53ef\u4ee5\u83b7\u53d6\u4e5f\u53ef\u4ee5\u5b9e\u4f8b\u96c6\u5408\uff0c\u4e5f\u53ef\u4ee5\u521b\u5efa\u5b9e\u4f8b\u5217\u8868\r\n\r\n\u63d0\u4f9b `get` \u548c `post` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, ` ListModelMixin`\uff0c`CreateModelMixin`\r\n\r\n### RetrieveUpdateAPIView\r\n\r\n\u65e2\u53ef\u4ee5\u67e5\u8be2\u4e5f\u53ef\u4ee5\u66f4\u65b0\u5355\u4e2a\u5b9e\u4f8b\r\n\r\n\u63d0\u4f9b `get`\uff0c`put` \u548c `patch` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, ` RetrieveModelMixin`\uff0c`UpdateModelMixin`\r\n\r\n### RetrieveDestroyAPIView\r\n\r\n\u65e2\u53ef\u4ee5\u67e5\u8be2\u4e5f\u53ef\u4ee5\u5220\u9664\u5355\u4e2a\u5b9e\u4f8b\r\n\r\n\u63d0\u4f9b `get` \u548c `delete` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, ` RetrieveModelMixin`\uff0c`DestroyModelMixin`\r\n\r\n### RetrieveUpdateDestroyAPIView\r\n\r\n\u540c\u65f6\u652f\u6301\u67e5\u8be2\uff0c\u66f4\u65b0\uff0c\u5220\u9664\r\n\r\n\u63d0\u4f9b `get`\uff0c`put`\uff0c`patch` \u548c `delete` \u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5\u3002\r\n\r\n\u7ee7\u627f\u81ea\uff1a `GenericAPIView `, ` RetrieveModelMixin`\uff0c`UpdateModelMixin`\uff0c`DestroyModelMixin`\r\n\r\n## \u81ea\u5b9a\u4e49\u901a\u7528\u89c6\u56fe\u7c7b\r\n\r\n\u901a\u5e38\u4f60\u4f1a\u60f3\u4f7f\u7528\u73b0\u6709\u7684\u901a\u7528\u89c6\u56fe\uff0c\u7136\u540e\u7a0d\u5fae\u5b9a\u5236\u4e00\u4e0b\u884c\u4e3a\u3002\u5982\u679c\u60a8\u53d1\u73b0\u81ea\u5df1\u5728\u591a\u4e2a\u5730\u65b9\u91cd\u590d\u4f7f\u7528\u4e86\u4e00\u4e9b\u81ea\u5b9a\u4e49\u884c\u4e3a\uff0c\u5219\u53ef\u80fd\u9700\u8981\u5c06\u884c\u4e3a\u91cd\u6784\u4e3a\u666e\u901a\u7c7b\uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u5c06\u5176\u5e94\u7528\u4e8e\u4efb\u4f55\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u3002\r\n\r\n\r\n\r\n### \u81ea\u5b9a\u4e49 mixins\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u9700\u8981\u6839\u636e URL conf \u4e2d\u7684\u591a\u4e2a\u5b57\u6bb5\u67e5\u627e\u5bf9\u8c61\uff0c\u5219\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a mixin \u7c7b\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n``` python\r\nclass MultipleFieldLookupMixin(object):\r\n    \"\"\"\r\n    \u5c06\u6b64 mixin \u5e94\u7528\u4e8e\u4efb\u4f55\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u4ee5\u83b7\u53d6\u591a\u4e2a\u5b57\u6bb5\u8fc7\u6ee4\r\n    \u57fa\u4e8e`lookup_fields`\u5c5e\u6027\uff0c\u800c\u4e0d\u662f\u9ed8\u8ba4\u7684\u5355\u4e2a\u5b57\u6bb5\u8fc7\u6ee4\u3002\r\n    \"\"\"\r\n    def get_object(self):\r\n        queryset = self.get_queryset()             # \u83b7\u53d6\u57fa\u672c\u7684\u67e5\u8be2\u96c6\r\n        queryset = self.filter_queryset(queryset)  # \u4f7f\u7528\u8fc7\u6ee4\u5668\r\n        filter = {}\r\n        for field in self.lookup_fields:\r\n            if self.kwargs[field]: # \u5ffd\u7565\u7a7a\u5b57\u6bb5\r\n                filter[field] = self.kwargs[field]\r\n        obj = get_object_or_404(queryset, **filter)  # \u67e5\u627e\u5bf9\u8c61\r\n        self.check_object_permissions(self.request, obj)\r\n        return obj\r\n```\r\n\r\n\u968f\u540e\u53ef\u4ee5\u5728\u9700\u8981\u5e94\u7528\u81ea\u5b9a\u4e49\u884c\u4e3a\u7684\u4efb\u200b\u200b\u4f55\u65f6\u5019\uff0c\u5c06\u8be5 mixin \u5e94\u7528\u4e8e\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u3002\r\n\r\n``` python\r\nclass RetrieveUserView(MultipleFieldLookupMixin, generics.RetrieveAPIView):\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    lookup_fields = ('account', 'username')\r\n```\r\n\r\n\u5982\u679c\u60a8\u9700\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u884c\u4e3a\uff0c\u90a3\u4e48\u4f7f\u7528\u81ea\u5b9a\u4e49 mixins \u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\r\n\r\n\r\n### \u81ea\u5b9a\u4e49\u57fa\u7c7b\r\n\r\n\u5982\u679c\u60a8\u5728\u591a\u4e2a\u89c6\u56fe\u4e2d\u4f7f\u7528 mixin\uff0c\u60a8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u521b\u5efa\u81ea\u5df1\u7684\u4e00\u7ec4\u57fa\u672c\u89c6\u56fe\uff0c\u7136\u540e\u5728\u6574\u4e2a\u9879\u76ee\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass BaseRetrieveView(MultipleFieldLookupMixin,\r\n                       generics.RetrieveAPIView):\r\n    pass\r\n\r\nclass BaseRetrieveUpdateDestroyView(MultipleFieldLookupMixin,\r\n                                    generics.RetrieveUpdateDestroyAPIView):\r\n    pass\r\n```\r\n\r\n\u5982\u679c\u81ea\u5b9a\u4e49\u884c\u4e3a\u59cb\u7ec8\u9700\u8981\u5728\u6574\u4e2a\u9879\u76ee\u4e2d\u7684\u5927\u91cf\u89c6\u56fe\u4e2d\u91cd\u590d\u4f7f\u7528\uff0c\u90a3\u4e48\u4f7f\u7528\u81ea\u5b9a\u4e49\u57fa\u7c7b\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\r\n\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/genericviews.md", "create_date": "2020-02-20T13:10:40.597", "order": 4}}, {"model": "subject.chapter", "pk": 151, "fields": {"title": "\u8fc7\u6ee4filtering", "topic": 7, "md5": "edd2c4264a5f58e62ef1aa38c35b655c", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/filtering/)  \r\n\r\n\r\n# \u8fc7\u6ee4\r\n\r\n\r\nREST framework \u7684\u901a\u7528\u5217\u8868\u89c6\u56fe\u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u4ece\u6a21\u578b\u7ba1\u7406\u5668\u8fd4\u56de\u6574\u4e2a\u67e5\u8be2\u96c6\u3002\u901a\u5e38\u4f60\u4f1a\u5e0c\u671b API \u9650\u5236\u67e5\u8be2\u96c6\u8fd4\u56de\u7684\u6761\u76ee\u3002\r\n\r\n\u7b5b\u9009 `GenericAPIView` \u5b50\u7c7b\u7684\u67e5\u8be2\u96c6\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u91cd\u5199 `.get_queryset()` \u65b9\u6cd5\u3002\r\n\r\n\u91cd\u5199\u6b64\u65b9\u6cd5\u5141\u8bb8\u4f60\u4ee5\u591a\u79cd\u4e0d\u540c\u65b9\u5f0f\u81ea\u5b9a\u4e49\u89c6\u56fe\u8fd4\u56de\u7684\u67e5\u8be2\u96c6\u3002\r\n\r\n## \u6839\u636e\u5f53\u524d\u7528\u6237\u8fdb\u884c\u8fc7\u6ee4\r\n\r\n\u4f60\u53ef\u80fd\u9700\u8981\u8fc7\u6ee4\u67e5\u8be2\u96c6\uff0c\u4ee5\u786e\u4fdd\u53ea\u8fd4\u56de\u4e0e\u5f53\u524d\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\u76f8\u5173\u7684\u7ed3\u679c\u3002\r\n\r\n\u4f60\u53ef\u4ee5\u57fa\u4e8e `request.user` \u7684\u503c\u8fdb\u884c\u7b5b\u9009\u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom myapp.models import Purchase\r\nfrom myapp.serializers import PurchaseSerializer\r\nfrom rest_framework import generics\r\n\r\nclass PurchaseList(generics.ListAPIView):\r\n    serializer_class = PurchaseSerializer\r\n\r\n    def get_queryset(self):\r\n        \"\"\"\r\n        This view should return a list of all the purchases\r\n        for the currently authenticated user.\r\n        \"\"\"\r\n        user = self.request.user\r\n        return Purchase.objects.filter(purchaser=user)\r\n```\r\n\r\n\r\n## \u6839\u636e URL \u8fdb\u884c\u8fc7\u6ee4\r\n\r\n\u53e6\u4e00\u79cd\u8fc7\u6ee4\u65b9\u5f0f\u53ef\u80fd\u6d89\u53ca\u57fa\u4e8e URL \u7684\u67d0\u4e2a\u90e8\u5206\u9650\u5236\u67e5\u8be2\u96c6\u3002\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u7684 URL \u914d\u7f6e\u5305\u542b\u8fd9\u6837\u7684\u6761\u76ee\uff1a\r\n\r\n``` python\r\nurl('^purchases/(?P<username>.+)/$', PurchaseList.as_view()),\r\n```\r\n\r\n\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a\u89c6\u56fe\uff0c\u8fd4\u56de\u7531 URL \u7684\u7528\u6237\u540d\u90e8\u5206\u8fc7\u6ee4\u7684 purchase \u67e5\u8be2\u96c6\uff1a\r\n\r\n``` python\r\nclass PurchaseList(generics.ListAPIView):\r\n    serializer_class = PurchaseSerializer\r\n\r\n    def get_queryset(self):\r\n        \"\"\"\r\n        This view should return a list of all the purchases for\r\n        the user as determined by the username portion of the URL.\r\n        \"\"\"\r\n        username = self.kwargs['username']\r\n        return Purchase.objects.filter(purchaser__username=username)\r\n```\r\n\r\n## \u6839\u636e\u67e5\u8be2\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4\r\n\r\n\u8fc7\u6ee4\u521d\u59cb\u67e5\u8be2\u96c6\u7684\u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u662f\u6839\u636e url \u4e2d\u7684\u67e5\u8be2\u53c2\u6570\u786e\u5b9a\u521d\u59cb\u67e5\u8be2\u96c6\u3002\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u8986\u76d6 `.get_queryset()` \u6765\u5904\u7406\u8bf8\u5982 `http://example.com/api/purchases?username=denvercoder9` \u7684URL\uff0c\u5e76\u4e14\u53ea\u6709\u5728 URL \u4e2d\u5305\u542b `username` \u53c2\u6570\u65f6\u624d\u8fc7\u6ee4\u67e5\u8be2\u96c6\uff1a\r\n\r\n``` python\r\nclass PurchaseList(generics.ListAPIView):\r\n    serializer_class = PurchaseSerializer\r\n\r\n    def get_queryset(self):\r\n        \"\"\"\r\n        Optionally restricts the returned purchases to a given user,\r\n        by filtering against a `username` query parameter in the URL.\r\n        \"\"\"\r\n        queryset = Purchase.objects.all()\r\n        username = self.request.query_params.get('username', None)\r\n        if username is not None:\r\n            queryset = queryset.filter(purchaser__username=username)\r\n        return queryset\r\n```\r\n\r\n---\r\n\r\n# \u901a\u7528\u8fc7\u6ee4\u5668\r\n\r\n\u9664\u4e86\u80fd\u591f\u8986\u76d6\u9ed8\u8ba4\u7684\u67e5\u8be2\u96c6\u5916\uff0cREST framework \u8fd8\u5305\u62ec\u5bf9\u901a\u7528\u8fc7\u6ee4\u540e\u7aef\u7684\u652f\u200b\u200b\u6301\uff0c\u4f7f\u4f60\u53ef\u4ee5\u8f7b\u677e\u6784\u5efa\u590d\u6742\u7684\u641c\u7d22\u548c\u8fc7\u6ee4\u5668\u3002\r\n\r\n\u901a\u7528\u8fc7\u6ee4\u5668\u4e5f\u53ef\u4ee5\u5728\u53ef\u6d4f\u89c8\u7684 API \u548c\u7ba1\u7406 API \u4e2d\u5c06\u81ea\u5df1\u6e32\u67d3\u4e3a HTML \u63a7\u4ef6\u3002\r\n\r\n![Filter Example](http://www.django-rest-framework.org/img/filter-controls.png)\r\n\r\n## \u8bbe\u7f6e\u8fc7\u6ee4\u5668\u540e\u7aef\r\n\r\n\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_FILTER_BACKENDS` setting \u5168\u5c40\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u8fc7\u6ee4\u5668\u540e\u7aef\u3002\u4f8b\u5982\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_FILTER_BACKENDS': ('django_filters.rest_framework.DjangoFilterBackend',)\r\n}\r\n```\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e `GenericAPIView` \u7c7b\u7684\u89c6\u56fe\uff0c\u5728\u6bcf\u4e2a\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u7684\u57fa\u7840\u4e0a\u8bbe\u7f6e\u8fc7\u6ee4\u5668\u540e\u7aef\u3002\r\n\r\n``` python\r\nimport django_filters.rest_framework\r\nfrom django.contrib.auth.models import User\r\nfrom myapp.serializers import UserSerializer\r\nfrom rest_framework import generics\r\n\r\nclass UserListView(generics.ListAPIView):\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    filter_backends = (django_filters.rest_framework.DjangoFilterBackend,)\r\n```\r\n\r\n## \u8fc7\u6ee4\u548c\u5bf9\u8c61\u67e5\u627e\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4e3a\u4e00\u4e2a\u89c6\u56fe\u914d\u7f6e\u4e86\u4e00\u4e2a\u8fc7\u6ee4\u5668\u540e\u7aef\uff0c\u90a3\u4e48\u9664\u4e86\u7528\u4e8e\u7b5b\u9009\u5217\u8868\u89c6\u56fe\u4e4b\u5916\uff0c\u5b83\u8fd8\u5c06\u7528\u4e8e\u7b5b\u9009\u8fd4\u56de\u5355\u4e2a\u5bf9\u8c61\u7684\u67e5\u8be2\u96c6\u3002\r\n\r\n\u4f8b\u5982\uff0c\u6839\u636e\u524d\u9762\u7684\u793a\u4f8b\u4ee5\u53ca ID \u4e3a `4675` \u7684\u4ea7\u54c1\uff0c\u4ee5\u4e0b URL \u5c06\u8fd4\u56de\u76f8\u5e94\u7684\u5bf9\u8c61\uff0c\u6216\u8fd4\u56de 404 \u54cd\u5e94\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u7ed9\u5b9a\u4ea7\u54c1\u5b9e\u4f8b\u662f\u5426\u6ee1\u8db3\u8fc7\u6ee4\u6761\u4ef6\uff1a\r\n\r\n``` python\r\nhttp://example.com/api/products/4675/?category=clothing&max_price=10.00\r\n```\r\n\r\n## \u8986\u76d6\u521d\u59cb\u67e5\u8be2\u96c6\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u4f60\u53ef\u4ee5\u540c\u65f6\u91cd\u5199\u7684 `.get_queryset()` \u548c\u901a\u7528\u8fc7\u6ee4\uff0c\u5e76\u4e14\u6240\u6709\u5185\u5bb9\u90fd\u5c06\u6309\u9884\u671f\u5de5\u4f5c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4ea7\u54c1\u4e0e\u7528\u6237\u5177\u6709\u591a\u5bf9\u591a\u5173\u7cfb\uff0c\u5219\u53ef\u80fd\u9700\u8981\u7f16\u5199\u4e00\u4e2a\u5982\u4e0b\u6240\u793a\u7684\u89c6\u56fe\uff1a\r\n\r\n``` python\r\nclass PurchasedProductsList(generics.ListAPIView):\r\n    \"\"\"\r\n    Return a list of all the products that the authenticated\r\n    user has ever purchased, with optional filtering.\r\n    \"\"\"\r\n    model = Product\r\n    serializer_class = ProductSerializer\r\n    filter_class = ProductFilter\r\n\r\n    def get_queryset(self):\r\n        user = self.request.user\r\n        return user.purchase_set.all()\r\n```\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## DjangoFilterBackend\r\n\r\n`django-filter` \u5e93\u5305\u542b\u4e00\u4e2a `DjangoFilterBackend` \u7c7b\uff0c\u5b83\u652f\u6301 REST framework \u5bf9\u5b57\u6bb5\u8fc7\u6ee4\u8fdb\u884c\u9ad8\u5ea6\u5b9a\u5236\u3002\r\n\r\n\u8981\u4f7f\u7528 `DjangoFilterBackend`\uff0c\u9996\u5148\u5b89\u88c5 `django-filter`\u3002\u7136\u540e\u5c06 `django_filters` \u6dfb\u52a0\u5230 Django \u7684 `INSTALLED_APPS` \u4e2d\r\n\r\n``` python\r\npip install django-filter\r\n```\r\n\r\n\u4f60\u73b0\u5728\u5e94\u8be5\u5c06\u8fc7\u6ee4\u5668\u540e\u7aef\u6dfb\u52a0\u5230\u8bbe\u7f6e\u4e2d\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_FILTER_BACKENDS': ('django_filters.rest_framework.DjangoFilterBackend',)\r\n}\r\n```\r\n\r\n\u6216\u8005\u5c06\u8fc7\u6ee4\u5668\u540e\u7aef\u6dfb\u52a0\u5230\u5355\u4e2a\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u3002\r\n\r\n``` python\r\nfrom django_filters.rest_framework import DjangoFilterBackend\r\n\r\nclass UserListView(generics.ListAPIView):\r\n    ...\r\n    filter_backends = (DjangoFilterBackend,)\r\n```\r\n\r\n\u5982\u679c\u4f60\u53ea\u9700\u8981\u7b80\u5355\u7684\u57fa\u4e8e\u7b49\u5f0f\u7684\u8fc7\u6ee4\uff0c\u5219\u53ef\u4ee5\u5728\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u4e0a\u8bbe\u7f6e `filter_fields` \u5c5e\u6027\uff0c\u5217\u51fa\u4f60\u8981\u8fc7\u6ee4\u7684\u4e00\u7ec4\u5b57\u6bb5\u3002\r\n\r\n``` python\r\nclass ProductList(generics.ListAPIView):\r\n    queryset = Product.objects.all()\r\n    serializer_class = ProductSerializer\r\n    filter_backends = (DjangoFilterBackend,)\r\n    filter_fields = ('category', 'in_stock')\r\n```\r\n\r\n\u8fd9\u5c06\u81ea\u52a8\u4e3a\u7ed9\u5b9a\u5b57\u6bb5\u521b\u5efa\u4e00\u4e2a `FilterSet` \u7c7b\uff0c\u5e76\u5141\u8bb8\u4f60\u53d1\u51fa\u5982\u4e0b\u8bf7\u6c42\uff1a\r\n\r\n``` python\r\nhttp://example.com/api/products?category=clothing&in_stock=True\r\n```\r\n\r\n\u5bf9\u4e8e\u66f4\u9ad8\u7ea7\u7684\u8fc7\u6ee4\u8981\u6c42\uff0c\u4f60\u5e94\u8be5\u5728\u89c6\u56fe\u4e0a\u5728\u6307\u5b9a `FilterSet` \u7c7b\u3002\u4f60\u53ef\u4ee5\u5728 [django-filter \u6587\u6863](https://django-filter.readthedocs.io/en/latest/index.html)\u4e2d\u9605\u8bfb\u6709\u5173 `FilterSet` \u7684\u66f4\u591a\u4fe1\u606f\u3002\u8fd8\u5efa\u8bae\u4f60\u9605\u8bfb [DRF integration](https://django-filter.readthedocs.io/en/latest/guide/rest_framework.html)\u3002\r\n\r\n\r\n## SearchFilter\r\n\r\n`SearchFilter` \u7c7b\u652f\u6301\u7b80\u5355\u7684\u57fa\u4e8e\u5355\u4e2a\u67e5\u8be2\u53c2\u6570\u7684\u641c\u7d22\uff0c\u5e76\u4e14\u57fa\u4e8e Django \u7ba1\u7406\u5458\u7684\u641c\u7d22\u529f\u80fd\u3002\r\n\r\n\u5728\u4f7f\u7528\u65f6\uff0c\u53ef\u6d4f\u89c8\u7684 API \u5c06\u5305\u542b\u4e00\u4e2a `SearchFilter` \u63a7\u4ef6\uff1a\r\n\r\n![Search Filter](http://www.django-rest-framework.org/img/search-filter.png)\r\n\r\n`SearchFilter` \u7c7b\u5c06\u4ec5\u5728\u89c6\u56fe\u5177\u6709 `search_fields` \u5c5e\u6027\u96c6\u7684\u60c5\u51b5\u4e0b\u5e94\u7528\u3002`search_fields` \u5c5e\u6027\u5e94\u8be5\u662f\u6a21\u578b\u4e0a\u6587\u672c\u7c7b\u578b\u5b57\u6bb5\u7684\u540d\u79f0\u5217\u8868\uff0c\u4f8b\u5982 `CharField` \u6216 `TextField`\u3002\r\n\r\n``` python\r\nclass UserListView(generics.ListAPIView):\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    filter_backends = (filters.SearchFilter,)\r\n    search_fields = ('username', 'email')\r\n```\r\n\r\n\u8fd9\u5c06\u5141\u8bb8\u5ba2\u6237\u7aef\u901a\u8fc7\u67e5\u8be2\u6765\u8fc7\u6ee4\u5217\u8868\u4e2d\u7684\u9879\u76ee\uff0c\u4f8b\u5982\uff1a\r\n\r\n```\r\nhttp://example.com/api/users?search=russell\r\n```\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u67e5\u627e API \u53cc\u4e0b\u5212\u7ebf\u8868\u793a\u6cd5\u5bf9 ForeignKey \u6216 ManyToManyField \u6267\u884c\u76f8\u5173\u67e5\u627e\uff1a\r\n\r\n``` python\r\nsearch_fields = ('username', 'email', 'profile__profession')\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u641c\u7d22\u5c06\u4f7f\u7528\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u90e8\u5206\u5339\u914d\u3002\u641c\u7d22\u53c2\u6570\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u641c\u7d22\u8bcd\uff0c\u5b83\u4eec\u5e94\u8be5\u662f\u7a7a\u683c\u548c\uff08\u6216\uff09\u9017\u53f7\u5206\u9694\u7684\u3002\u5982\u679c\u4f7f\u7528\u591a\u4e2a\u641c\u7d22\u6761\u4ef6\uff0c\u5219\u53ea\u6709\u5728\u6240\u6709\u63d0\u4f9b\u7684\u6761\u4ef6\u5339\u914d\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u8c61\u624d\u4f1a\u8fd4\u56de\u5230\u5217\u8868\u4e2d\u3002\r\n\r\n\u641c\u7d22\u884c\u4e3a\u53ef\u4ee5\u901a\u8fc7\u5c06\u5404\u79cd\u5b57\u7b26\u9884\u5148\u6dfb\u52a0\u5230 `search_fields` \u6765\u9650\u5236\u3002\r\n\r\n* '^' \u5339\u914d\u8d77\u59cb\u90e8\u5206\u3002\r\n* '=' \u5b8c\u5168\u5339\u914d\u3002\r\n* '@' \u5168\u6587\u641c\u7d22\u3002\uff08\u76ee\u524d\u53ea\u652f\u6301 Django \u7684 MySQL \u540e\u7aef\u3002\uff09\r\n* '$' \u6b63\u5219\u5339\u914d\u3002\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nsearch_fields = ('=username', '=email')\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u641c\u7d22\u53c2\u6570\u88ab\u547d\u540d\u4e3a `'search'` \uff0c\u4f46\u8fd9\u53ef\u80fd\u4f1a\u88ab `SEARCH_PARAM` setting \u8986\u76d6\u3002\r\n\r\n\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 [Django \u6587\u6863](https://docs.djangoproject.com/en/stable/ref/contrib/admin/#django.contrib.admin.ModelAdmin.search_fields)\u3002\r\n\r\n---\r\n\r\n## OrderingFilter\r\n\r\n`OrderingFilter` \u7c7b\u652f\u6301\u7b80\u5355\u67e5\u8be2\u53c2\u6570\u63a7\u5236\u7ed3\u679c\u7684\u6392\u5e8f\u3002\r\n\r\n![Ordering Filter](http://www.django-rest-framework.org/img/ordering-filter.png)\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u67e5\u8be2\u53c2\u6570\u88ab\u547d\u540d\u4e3a `'ordering'`\uff0c\u4f46\u8fd9\u53ef\u80fd\u4f1a\u88ab `ORDERING_PARAM` setting \u8986\u76d6\u3002\r\n\r\n\u4f8b\u5982\uff0c\u8981\u901a\u8fc7 username \u5bf9\u7528\u6237\u6392\u5e8f\uff1a\r\n\r\n```\r\nhttp://example.com/api/users?ordering=username\r\n```\r\n\r\n\u5ba2\u6237\u7aef\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728\u5b57\u6bb5\u540d\u79f0\u524d\u52a0 ' - ' \u6765\u6307\u5b9a\u53cd\u5411\u6392\u5e8f\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n```\r\nhttp://example.com/api/users?ordering=-username \r\n```\r\n\r\n\u4e5f\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u6392\u5e8f\uff1a\r\n\r\n```\r\nhttp://example.com/api/users?ordering=account,username\r\n```\r\n\r\n### \u6307\u5b9a\u53ef\u4ee5\u6839\u636e\u54ea\u4e9b\u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f\r\n\r\n\u5efa\u8bae\u4f60\u660e\u786e\u6307\u5b9a API \u5e94\u8be5\u5141\u8bb8\u5728\u6392\u5e8f\u8fc7\u6ee4\u5668\u4e2d\u4f7f\u7528\u54ea\u4e9b\u5b57\u6bb5\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u4e00\u4e2a `ordering_fields` \u5c5e\u6027\u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nclass UserListView(generics.ListAPIView):\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    filter_backends = (filters.OrderingFilter,)\r\n    ordering_fields = ('username', 'email')\r\n```\r\n\r\n\u8fd9\u6709\u52a9\u4e8e\u9632\u6b62\u610f\u5916\u7684\u6570\u636e\u6cc4\u6f0f\uff0c\u4f8b\u5982\u5141\u8bb8\u7528\u6237\u6839\u636e\u5bc6\u7801\u54c8\u5e0c\u5b57\u6bb5\u6216\u5176\u4ed6\u654f\u611f\u6570\u636e\u8fdb\u884c\u6392\u5e8f\u3002\r\n\r\n\u5982\u679c\u4f60\u672a\u5728\u89c6\u56fe\u4e0a\u6307\u5b9a `ordering_fields` \u5c5e\u6027\uff0c\u5219\u8fc7\u6ee4\u5668\u7c7b\u5c06\u9ed8\u8ba4\u5141\u8bb8\u7528\u6237\u8fc7\u6ee4\u7531 `serializer_class` \u5c5e\u6027\u6307\u5b9a\u7684\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u4efb\u4f55\u53ef\u8bfb\u5b57\u6bb5\u3002\r\n\r\n\u5982\u679c\u4f60\u786e\u4fe1\u89c6\u56fe\u4f7f\u7528\u7684\u67e5\u8be2\u96c6\u4e0d\u5305\u542b\u4efb\u4f55\u654f\u611f\u6570\u636e\uff0c\u5219\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u7279\u6b8a\u503c `'__all__'` \u660e\u786e\u6307\u5b9a\u89c6\u56fe\u5141\u8bb8\u5728\u4efb\u4f55\u6a21\u578b\u5b57\u6bb5\u6216\u67e5\u8be2\u96c6\u805a\u5408\u4e0a\u8fdb\u884c\u6392\u5e8f\u3002\r\n\r\n``` python\r\nclass BookingsListView(generics.ListAPIView):\r\n    queryset = Booking.objects.all()\r\n    serializer_class = BookingSerializer\r\n    filter_backends = (filters.OrderingFilter,)\r\n    ordering_fields = '__all__'\r\n```\r\n\r\n### \u6307\u5b9a\u9ed8\u8ba4\u987a\u5e8f\r\n\r\n\u5982\u679c\u5728\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u4e86 `ordering` \u5c5e\u6027\uff0c\u5219\u5c06\u7528\u4f5c\u9ed8\u8ba4\u6392\u5e8f\u3002\r\n\r\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4f60\u5e94\u8be5\u901a\u8fc7\u5728\u521d\u59cb\u67e5\u8be2\u96c6\u4e0a\u8bbe\u7f6e `order_by` \u6765\u63a7\u5236\u6b64\u64cd\u4f5c\uff0c\u4f46\u662f\u901a\u8fc7\u5728\u89c6\u56fe\u4e0a\u4f7f\u7528 `ordering` \u53c2\u6570\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u6392\u5e8f\u65b9\u5f0f\uff0c\u7136\u540e\u53ef\u4ee5\u5c06\u5176\u4f5c\u4e3a\u4e0a\u4e0b\u6587\u81ea\u52a8\u4f20\u9012\u5230\u6e32\u67d3\u7684\u6a21\u677f\u3002\u8fd9\u53ef\u4ee5\u81ea\u52a8\u6e32\u67d3\u5217\u6807\u9898\uff0c\u5982\u679c\u5b83\u4eec\u7528\u4e8e\u6392\u5e8f\u7ed3\u679c\u3002\r\n\r\n``` python\r\nclass UserListView(generics.ListAPIView):\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    filter_backends = (filters.OrderingFilter,)\r\n    ordering_fields = ('username', 'email')\r\n    ordering = ('username',)\r\n```\r\n\r\n`ordering` \u5c5e\u6027\u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6216\u8005\u5b57\u7b26\u4e32\u5217\u8868\uff08\u5143\u7ec4\uff09\u3002\r\n\r\n---\r\n\r\n## DjangoObjectPermissionsFilter\r\n\r\n`DjangoObjectPermissionsFilter` \u65e8\u5728\u4e0e [`django-guardian`](https://django-guardian.readthedocs.io/) \u8f6f\u4ef6\u5305\u4e00\u8d77\u4f7f\u7528\uff0c\u6dfb\u52a0\u4e86\u81ea\u5b9a\u4e49 `'view'` \u7684\u6743\u9650\u3002\u8fc7\u6ee4\u5668\u5c06\u786e\u4fdd\u67e5\u8be2\u96c6\u4ec5\u8fd4\u56de\u7528\u6237\u5177\u6709\u9002\u5f53\u67e5\u770b\u6743\u9650\u7684\u5bf9\u8c61\u3002\r\n\r\n\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f `DjangoObjectPermissionsFilter`\uff0c\u90a3\u4e48\u4f60\u53ef\u80fd\u8fd8\u9700\u8981\u6dfb\u52a0\u9002\u5f53\u7684\u5bf9\u8c61\u6743\u9650\u7c7b\uff0c\u4ee5\u786e\u4fdd\u7528\u6237\u53ea\u6709\u5728\u5177\u6709\u9002\u5f53\u5bf9\u8c61\u6743\u9650\u7684\u60c5\u51b5\u4e0b\u624d\u80fd\u5bf9\u5b9e\u4f8b\u8fdb\u884c\u64cd\u4f5c\u3002\u505a\u5230\u8fd9\u4e00\u70b9\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u7ee7\u627f `DjangoObjectPermissions` \u5e76\u4e3a `perms_map` \u5c5e\u6027\u6dfb\u52a0 `'view'` \u6743\u9650\u3002\r\n\r\n\u4f7f\u7528 `DjangoObjectPermissionsFilter` \u548c `DjangoObjectPermissions` \u7684\u5b8c\u6574\u793a\u4f8b\u53ef\u80fd\u5982\u4e0b\u6240\u793a\u3002\r\n\r\n**permissions.py**:\r\n\r\n``` python\r\nclass CustomObjectPermissions(permissions.DjangoObjectPermissions):\r\n    \"\"\"\r\n    Similar to `DjangoObjectPermissions`, but adding 'view' permissions.\r\n    \"\"\"\r\n    perms_map = {\r\n        'GET': ['%(app_label)s.view_%(model_name)s'],\r\n        'OPTIONS': ['%(app_label)s.view_%(model_name)s'],\r\n        'HEAD': ['%(app_label)s.view_%(model_name)s'],\r\n        'POST': ['%(app_label)s.add_%(model_name)s'],\r\n        'PUT': ['%(app_label)s.change_%(model_name)s'],\r\n        'PATCH': ['%(app_label)s.change_%(model_name)s'],\r\n        'DELETE': ['%(app_label)s.delete_%(model_name)s'],\r\n    }\r\n```\r\n\r\n**views.py**:\r\n\r\n``` python\r\nclass EventViewSet(viewsets.ModelViewSet):\r\n    \"\"\"\r\n    Viewset that only lists events if user has 'view' permissions, and only\r\n    allows operations on individual events if user has appropriate 'view', 'add',\r\n    'change' or 'delete' permissions.\r\n    \"\"\"\r\n    queryset = Event.objects.all()\r\n    serializer_class = EventSerializer\r\n    filter_backends = (filters.DjangoObjectPermissionsFilter,)\r\n    permission_classes = (myapp.permissions.CustomObjectPermissions,)\r\n```\r\n\r\n\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u901a\u7528\u8fc7\u6ee4\u5668\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u63d0\u4f9b\u81ea\u5df1\u7684\u901a\u7528\u8fc7\u6ee4\u5668\u540e\u7aef\uff0c\u6216\u8005\u7f16\u5199\u4e00\u4e2a\u53ef\u4f9b\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u4f7f\u7528\u7684\u53ef\u5b89\u88c5\u5e94\u7528\u7a0b\u5e8f\u3002\r\n\r\n\u4e3a\u6b64\uff0c\u8bf7\u7ee7\u627f `BaseFilterBackend`\uff0c\u5e76\u8986\u76d6 `.filter_queryset(self, request, queryset, view)` \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\uff0c\u8fc7\u6ee4\u7684\u67e5\u8be2\u96c6\u3002\r\n\r\n\u9664\u4e86\u5141\u8bb8\u5ba2\u6237\u7aef\u6267\u884c\u641c\u7d22\u548c\u8fc7\u6ee4\u5916\uff0c\u901a\u7528\u8fc7\u6ee4\u5668\u540e\u7aef\u53ef\u7528\u4e8e\u9650\u5236\u54ea\u4e9b\u5bf9\u8c61\u5e94\u8be5\u5bf9\u7ed9\u5b9a\u7684\u8bf7\u6c42\u6216\u7528\u6237\u53ef\u89c1\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4f60\u53ef\u80fd\u9700\u8981\u9650\u5236\u7528\u6237\u53ea\u80fd\u770b\u5230\u4ed6\u4eec\u521b\u5efa\u7684\u5bf9\u8c61\u3002\r\n\r\n``` python\r\nclass IsOwnerFilterBackend(filters.BaseFilterBackend):\r\n    \"\"\"\r\n    Filter that only allows users to see their own objects.\r\n    \"\"\"\r\n    def filter_queryset(self, request, queryset, view):\r\n        return queryset.filter(owner=request.user)\r\n```\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8986\u76d6\u89c6\u56fe\u4e0a\u7684 `get_queryset()`\u6765\u5b9e\u73b0\u76f8\u540c\u7684\u884c\u4e3a\uff0c\u4f46\u4f7f\u7528\u8fc7\u6ee4\u5668\u540e\u7aef\u5141\u8bb8\u4f60\u66f4\u8f7b\u677e\u5730\u5c06\u6b64\u9650\u5236\u6dfb\u52a0\u5230\u591a\u4e2a\u89c6\u56fe\uff0c\u6216\u8005\u5c06\u5176\u5e94\u7528\u4e8e\u6574\u4e2a API\u3002\r\n\r\n## \u81ea\u5b9a\u4e49\u63a5\u53e3\r\n\r\n\u901a\u7528\u8fc7\u6ee4\u5668\u4e5f\u53ef\u4ee5\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u6e32\u67d3\u63a5\u53e3\u3002\u4e3a\u6b64\uff0c\u4f60\u5e94\u8be5\u5b9e\u73b0\u4e00\u4e2a `to_html()` \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u8fc7\u6ee4\u5668\u7684\u6e32\u67d3 HTML \u8868\u793a\u3002\u6b64\u65b9\u6cd5\u5e94\u5177\u6709\u4ee5\u4e0b\u7b7e\u540d\uff1a\r\n\r\n`to_html(self, request, queryset, view)`\r\n\r\n\u8be5\u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u6e32\u67d3\u7684 HTML \u5b57\u7b26\u4e32\u3002\r\n\r\n## Pagination & schemas\r\n\r\n\u901a\u8fc7\u5b9e\u73b0 `get_schema_fields()` \u65b9\u6cd5\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u8fc7\u6ee4\u5668\u63a7\u4ef6\u53ef\u7528\u4e8e REST framework \u63d0\u4f9b\u7684\u6a21\u5f0f\u81ea\u52a8\u751f\u6210\u3002\u6b64\u65b9\u6cd5\u5e94\u5177\u6709\u4ee5\u4e0b\u7b7e\u540d\uff1a\r\n\r\n`get_schema_fields(self, view)`\r\n\r\n\u8be5\u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a `coreapi.Field` \u5b9e\u4f8b\u5217\u8868\u3002\r\n", "md_File": "subject/django-rest-framework-api-guide/filtering.md", "create_date": "2020-02-20T13:10:40.615", "order": 16}}, {"model": "subject.chapter", "pk": 152, "fields": {"title": "\u5206\u9875pagination", "topic": 7, "md5": "0645bd4fbfb804bf00e2fd2be7456461", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/pagination/)  \r\n\r\n\r\n\r\n# \u5206\u9875\r\n\r\nREST framework \u5305\u542b\u5bf9\u53ef\u5b9a\u5236\u5206\u9875\u6837\u5f0f\u7684\u652f\u6301\u3002\u8fd9\u4f7f\u4f60\u53ef\u4ee5\u5c06\u8f83\u5927\u7684\u7ed3\u679c\u96c6\u5206\u6210\u5355\u72ec\u7684\u6570\u636e\u9875\u9762\u3002\r\n\r\n\u5206\u9875 API \u652f\u6301\uff1a\r\n\r\n* \u4ee5\u5206\u9875\u94fe\u63a5\u7684\u5f62\u5f0f\u4f5c\u4e3a\u54cd\u5e94\u5185\u5bb9\u7684\u4e00\u90e8\u5206\u3002\r\n* \u4ee5\u5206\u9875\u94fe\u63a5\u7684\u5f62\u5f0f\u5305\u542b\u5728\u54cd\u5e94\u7684 header \u4e2d\uff0c\u5982 `Content-Range` \u6216 `Link`.\r\n\r\n\u5185\u7f6e\u7684\u6837\u5f0f\u76ee\u524d\u662f\u4ee5\u5206\u9875\u94fe\u63a5\u7684\u5f62\u5f0f\u4f5c\u4e3a\u54cd\u5e94\u5185\u5bb9\u7684\u4e00\u90e8\u5206\u3002\u4f7f\u7528\u53ef\u6d4f\u89c8\u7684 API \u65f6\uff0c\u6b64\u6837\u5f0f\u66f4\u6613\u4e8e\u8bbf\u95ee\u3002\r\n\r\n\u5206\u9875\u4ec5\u5728\u4f60\u4f7f\u7528\u901a\u7528\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u65f6\u81ea\u52a8\u6267\u884c\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u5e38\u89c4 `APIView`\uff0c\u5219\u9700\u8981\u81ea\u5df1\u8c03\u7528\u5206\u9875 API \u4ee5\u786e\u4fdd\u8fd4\u56de\u5206\u9875\u54cd\u5e94\u3002\u793a\u4f8b\u8bf7\u53c2\u9605 `mixins.ListModelMixin` \u548c `generics.GenericAPIView` \u7c7b\u7684\u6e90\u4ee3\u7801\u3002\r\n\r\n\u53ef\u4ee5\u901a\u8fc7\u5c06\u5206\u9875\u7c7b\u8bbe\u7f6e\u4e3a `None`\uff0c\u5173\u95ed\u5206\u9875\u3002\r\n\r\n## \u8bbe\u7f6e\u5206\u9875\u6837\u5f0f\r\n\r\n\u5206\u9875\u6837\u5f0f\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_PAGINATION_CLASS` \u548c `PAGE_SIZE` setting key \u5168\u5c40\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0c\u8981\u4f7f\u7528\u5185\u7f6e\u7684 limit/offset \u5206\u9875\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.LimitOffsetPagination',\r\n    'PAGE_SIZE': 100\r\n}\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u4f60\u9700\u8981\u8bbe\u7f6e\u5206\u9875\u7c7b\u548c\u5e94\u4f7f\u7528\u7684\u9875\u9762\u5927\u5c0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c`DEFAULT_PAGINATION_CLASS` \u548c `PAGE_SIZE` \u90fd\u662f `None`\u3002\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 `pagination_class` \u5c5e\u6027\u5728\u5355\u4e2a\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u5206\u9875\u7c7b\u3002\u901a\u5e38\uff0c\u4f60\u5e0c\u671b\u5728\u6574\u4e2a API \u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u5206\u9875\u6837\u5f0f\uff0c\u4f46\u4f60\u53ef\u80fd\u5e0c\u671b\u5728\u6bcf\u4e2a\u89c6\u56fe\u7684\u57fa\u7840\u4e0a\u66f4\u6539\u5206\u9875\u7684\u5404\u4e2a\u65b9\u9762\uff0c\u4f8b\u5982\u9ed8\u8ba4\u6216\u6700\u5927\u9875\u9762\u5927\u5c0f\u3002\r\n\r\n## \u4fee\u6539\u5206\u9875\u6837\u5f0f\r\n\r\n\u5982\u679c\u8981\u4fee\u6539\u5206\u9875\u6837\u5f0f\u7684\u7279\u5b9a\u65b9\u9762\uff0c\u5219\u9700\u8981\u7ee7\u627f\u5176\u4e2d\u4e00\u4e2a\u5206\u9875\u7c7b\uff0c\u5e76\u8bbe\u7f6e\u8981\u66f4\u6539\u7684\u5c5e\u6027\u3002\r\n\r\n``` python\r\nclass LargeResultsSetPagination(PageNumberPagination):\r\n    page_size = 1000\r\n    page_size_query_param = 'page_size'\r\n    max_page_size = 10000\r\n\r\nclass StandardResultsSetPagination(PageNumberPagination):\r\n    page_size = 100\r\n    page_size_query_param = 'page_size'\r\n    max_page_size = 1000\r\n```\r\n\r\n\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 `.pagination_class` \u5c5e\u6027\u5c06\u65b0\u6837\u5f0f\u5e94\u7528\u4e8e\u89c6\u56fe\uff1a\r\n\r\n``` python\r\nclass BillingRecordsView(generics.ListAPIView):\r\n    queryset = Billing.objects.all()\r\n    serializer_class = BillingRecordsSerializer\r\n    pagination_class = LargeResultsSetPagination\r\n```\r\n\r\n\u6216\u8005\u4f7f\u7528 `DEFAULT_PAGINATION_CLASS` setting key \u5168\u5c40\u5e94\u7528\u6837\u5f0f\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PAGINATION_CLASS': 'apps.core.pagination.StandardResultsSetPagination'\r\n}\r\n```\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## PageNumberPagination\r\n\r\n\u6b64\u5206\u9875\u6837\u5f0f\u5728\u8bf7\u6c42\u67e5\u8be2\u53c2\u6570\u4e2d\u63a5\u53d7\u4e00\u4e2a\u9875\u7801\u503c\u3002\r\n\r\n**Request**:\r\n\r\n```\r\nGET https://api.example.org/accounts/?page=4\r\n```\r\n\r\n**Response**:\r\n\r\n``` python\r\nHTTP 200 OK\r\n{\r\n    \"count\": 1023\r\n    \"next\": \"https://api.example.org/accounts/?page=5\",\r\n    \"previous\": \"https://api.example.org/accounts/?page=3\",\r\n    \"results\": [\r\n       \u2026\r\n    ]\r\n}\r\n```\r\n\r\n#### Setup\r\n\r\n\u8981\u5168\u5c40\u542f\u7528 `PageNumberPagination` \u6837\u5f0f\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\uff0c\u5e76\u6839\u636e\u9700\u8981\u8bbe\u7f6e `PAGE_SIZE`\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',\r\n    'PAGE_SIZE': 100\r\n}\r\n```\r\n\r\n\u5982\u679c\u4f7f\u7528\u7684\u662f `GenericAPIView` \u7684\u5b50\u7c7b\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e `pagination_class` \u5c5e\u6027\u4ee5\u5728\u6bcf\u4e2a\u89c6\u56fe\u7684\u57fa\u7840\u4e0a\u9009\u62e9 `PageNumberPagination`\u3002\r\n\r\n#### Configuration\r\n\r\n`PageNumberPagination` \u7c7b\u5305\u542b\u4e00\u4e9b\u53ef\u4ee5\u88ab\u8986\u76d6\u4ee5\u4fee\u6539\u5206\u9875\u6837\u5f0f\u7684\u5c5e\u6027\u3002\r\n\r\n\u8981\u8bbe\u7f6e\u8fd9\u4e9b\u5c5e\u6027\uff0c\u4f60\u5e94\u8be5\u7ee7\u627f `PageNumberPagination` \u7c7b\uff0c\u7136\u540e\u50cf\u4e0a\u9762\u90a3\u6837\u542f\u7528\u4f60\u7684\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\u3002\r\n\r\n* `django_paginator_class` - \u8981\u4f7f\u7528\u7684 Django Paginator \u7c7b\u3002\u9ed8\u8ba4\u662f `django.core.paginator.Paginator`\uff0c\u5bf9\u4e8e\u5927\u591a\u6570\u7528\u4f8b\u6765\u8bf4\u5e94\u8be5\u6ca1\u95ee\u9898\u3002\r\n* `page_size` - \u6307\u5b9a\u9875\u9762\u5927\u5c0f\u7684\u6570\u5b57\u503c\u3002\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u4f1a\u8986\u76d6 `PAGE_SIZE` setting\u3002\u9ed8\u8ba4\u503c\u4e0e `PAGE_SIZE` setting key \u76f8\u540c\u3002\r\n* `page_query_param` - \u4e00\u4e2a\u5b57\u7b26\u4e32\u503c\uff0c\u6307\u5b9a\u7528\u4e8e\u5206\u9875\u63a7\u4ef6\u7684\u67e5\u8be2\u53c2\u6570\u7684\u540d\u79f0\u3002\r\n* `page_size_query_param` - \u4e00\u4e2a\u5b57\u7b26\u4e32\u503c\uff0c\u6307\u5b9a\u67e5\u8be2\u53c2\u6570\u7684\u540d\u79f0\uff0c\u5141\u8bb8\u5ba2\u6237\u7aef\u6839\u636e\u6bcf\u4e2a\u8bf7\u6c42\u8bbe\u7f6e\u9875\u9762\u5927\u5c0f\u3002\u9ed8\u8ba4\u4e3a `None`\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u53ef\u80fd\u65e0\u6cd5\u63a7\u5236\u6240\u8bf7\u6c42\u7684\u9875\u9762\u5927\u5c0f\u3002\r\n* `max_page_size` - \u4e00\u4e2a\u6570\u5b57\u503c\uff0c\u8868\u793a\u5141\u8bb8\u7684\u6700\u5927\u9875\u9762\u5927\u5c0f\u3002\u8be5\u5c5e\u6027\u4ec5\u5728 `page_size_query_param` \u4e5f\u88ab\u8bbe\u7f6e\u65f6\u6709\u6548\u3002\r\n* `last_page_strings` - \u5b57\u7b26\u4e32\u5217\u8868\u6216\u5143\u7ec4\uff0c\u7528\u4e8e\u6307\u5b9a\u53ef\u80fd\u4e0e `page_query_param` \u4e00\u8d77\u4f7f\u7528\u7684\u503c\uff0c\u7528\u4ee5\u8bf7\u6c42\u96c6\u5408\u4e2d\u7684\u6700\u7ec8\u9875\u9762\u3002\u9ed8\u8ba4\u4e3a `('last',)`\r\n* `template` - \u5728\u53ef\u6d4f\u89c8 API \u4e2d\u6e32\u67d3\u5206\u9875\u63a7\u4ef6\u65f6\u4f7f\u7528\u7684\u6a21\u677f\u7684\u540d\u79f0\u3002\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6\u4ee5\u4fee\u6539\u6e32\u67d3\u6837\u5f0f\uff0c\u6216\u8bbe\u7f6e\u4e3a `None` \u4ee5\u5b8c\u5168\u7981\u7528 HTML \u5206\u9875\u63a7\u4ef6\u3002\u9ed8\u8ba4\u4e3a `\"rest_framework/pagination/numbers.html\"`\u3002\r\n\r\n---\r\n\r\n## LimitOffsetPagination\r\n\r\n\u8fd9\u79cd\u5206\u9875\u6837\u5f0f\u53cd\u6620\u4e86\u67e5\u627e\u591a\u4e2a\u6570\u636e\u5e93\u8bb0\u5f55\u65f6\u4f7f\u7528\u7684\u8bed\u6cd5\u3002\u5ba2\u6237\u7aef\u5305\u542b \u201climit\u201d \u548c \u201coffset\u201d \u67e5\u8be2\u53c2\u6570\u3002limit \u8868\u793a\u8981\u8fd4\u56de\u7684 item \u7684\u6700\u5927\u6570\u91cf\uff0c\u5e76\u4e14\u7b49\u540c\u4e8e\u5176\u4ed6\u6837\u5f0f\u4e2d\u7684 `page_size`\u3002offset \u6307\u5b9a\u67e5\u8be2\u7684\u8d77\u59cb\u4f4d\u7f6e\u4e0e\u5b8c\u6574\u7684\u672a\u5206\u7c7b item \u96c6\u7684\u5173\u7cfb\u3002\r\n\r\n**Request**:\r\n\r\n``` python\r\nGET https://api.example.org/accounts/?limit=100&offset=400\r\n```\r\n\r\n**Response**:\r\n\r\n``` python\r\nHTTP 200 OK\r\n{\r\n    \"count\": 1023\r\n    \"next\": \"https://api.example.org/accounts/?limit=100&offset=500\",\r\n    \"previous\": \"https://api.example.org/accounts/?limit=100&offset=300\",\r\n    \"results\": [\r\n       \u2026\r\n    ]\r\n}\r\n```\r\n\r\n#### Setup\r\n\r\n\u8981\u5168\u5c40\u542f\u7528 `LimitOffsetPagination` \u6837\u5f0f\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.LimitOffsetPagination'\r\n}\r\n```\r\n\r\n\u6216\u8005\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a `PAGE_SIZE` \u952e\u3002\u5982\u679c\u4f7f\u7528\u4e86 `PAGE_SIZE` \u53c2\u6570\uff0c\u5219 `limit` \u67e5\u8be2\u53c2\u6570\u5c06\u662f\u53ef\u9009\u7684\uff0c\u5e76\u4e14\u53ef\u80fd\u4f1a\u88ab\u5ba2\u6237\u7aef\u5ffd\u7565\u3002\r\n\r\n\u5982\u679c\u4f7f\u7528\u7684\u662f `GenericAPIView` \u5b50\u7c7b\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e `pagination_class` \u5c5e\u6027\u4ee5\u57fa\u4e8e\u6bcf\u4e2a\u89c6\u56fe\u9009\u62e9 `LimitOffsetPagination`\u3002\r\n\r\n#### Configuration\r\n\r\n`LimitOffsetPagination` \u7c7b\u5305\u542b\u4e00\u4e9b\u53ef\u4ee5\u88ab\u8986\u76d6\u4ee5\u4fee\u6539\u5206\u9875\u6837\u5f0f\u7684\u5c5e\u6027\u3002\r\n\r\n\u8981\u8bbe\u7f6e\u8fd9\u4e9b\u5c5e\u6027\uff0c\u5e94\u8be5\u7ee7\u627f `LimitOffsetPagination` \u7c7b\uff0c\u7136\u540e\u50cf\u4e0a\u9762\u90a3\u6837\u542f\u7528\u4f60\u7684\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\u3002\r\n\r\n* `default_limit` - \u4e00\u4e2a\u6570\u5b57\u503c\uff0c\u6307\u5b9a\u5ba2\u6237\u7aef\u5728\u67e5\u8be2\u53c2\u6570\u4e2d\u672a\u63d0\u4f9b\u7684 limit \u3002\u9ed8\u8ba4\u503c\u4e0e `PAGE_SIZE` setting key \u76f8\u540c\u3002\r\n* `limit_query_param` - \u4e00\u4e2a\u5b57\u7b26\u4e32\u503c\uff0c\u6307\u793a \u201climit\u201d \u67e5\u8be2\u53c2\u6570\u7684\u540d\u79f0\u3002\u9ed8\u8ba4\u4e3a `'limit'`\u3002\r\n* `offset_query_param` - \u4e00\u4e2a\u5b57\u7b26\u4e32\u503c\uff0c\u6307\u793a \u201coffset\u201d \u67e5\u8be2\u53c2\u6570\u7684\u540d\u79f0\u3002\u9ed8\u8ba4\u4e3a `'offset'`\u3002\r\n* `max_limit` - \u4e00\u4e2a\u6570\u5b57\u503c\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u53ef\u4ee5\u8981\u6c42\u7684\u6700\u5927\u5141\u8bb8 limit\u3002\u9ed8\u8ba4\u4e3a `None`\u3002\r\n* `template` - \u5728\u53ef\u6d4f\u89c8 API \u4e2d\u6e32\u67d3\u5206\u9875\u63a7\u4ef6\u65f6\u4f7f\u7528\u7684\u6a21\u677f\u7684\u540d\u79f0\u3002\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6\u4ee5\u4fee\u6539\u6e32\u67d3\u6837\u5f0f\uff0c\u6216\u8bbe\u7f6e\u4e3a `None` \u4ee5\u5b8c\u5168\u7981\u7528 HTML \u5206\u9875\u63a7\u4ef6\u3002\u9ed8\u8ba4\u4e3a `\"rest_framework/pagination/numbers.html\"`\u3002\r\n\r\n---\r\n\r\n## CursorPagination\r\n\r\n\u57fa\u4e8e\u6e38\u6807\u7684\u5206\u9875\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e0d\u900f\u660e\u7684 \u201c\u6e38\u6807\u201d \u6307\u793a\u5668\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528\u8be5\u6307\u793a\u5668\u6765\u7ffb\u9605\u7ed3\u679c\u96c6\u3002\u6b64\u5206\u9875\u6837\u5f0f\u4ec5\u63d0\u4f9b\u524d\u5411\u548c\u53cd\u5411\u63a7\u4ef6\uff0c\u5e76\u4e14\u4e0d\u5141\u8bb8\u5ba2\u6237\u7aef\u5bfc\u822a\u5230\u4efb\u610f\u4f4d\u7f6e\u3002\r\n\r\n\u57fa\u4e8e\u6e38\u6807\u7684\u5206\u9875\u9700\u8981\u5728\u7ed3\u679c\u96c6\u4e2d\u5b58\u5728\u552f\u4e00\u7684\uff0c\u4e0d\u53d8\u7684 item \u987a\u5e8f\u3002\u8fd9\u79cd\u6392\u5e8f\u901a\u5e38\u53ef\u4ee5\u662f\u8bb0\u5f55\u4e0a\u7684\u521b\u5efa\u65f6\u95f4\u6233\uff0c\u56e0\u4e3a\u8fd9\u786e\u4fdd\u4e86\u6392\u5e8f\u7684\u4e00\u81f4\u6027\u3002\r\n\r\n\u57fa\u4e8e\u6e38\u6807\u7684\u5206\u9875\u6bd4\u5176\u4ed6\u65b9\u6848\u66f4\u590d\u6742\u3002\u5b83\u8fd8\u8981\u6c42\u7ed3\u679c\u96c6\u6e32\u67d3\u56fa\u5b9a\u987a\u5e8f\uff0c\u5e76\u4e14\u4e0d\u5141\u8bb8\u5ba2\u6237\u7aef\u4efb\u610f\u7d22\u5f15\u7ed3\u679c\u96c6\u3002\u4f46\u5b83\u786e\u5b9e\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u597d\u5904\uff1a\r\n\r\n* \u63d0\u4f9b\u4e00\u81f4\u7684\u5206\u9875\u89c6\u56fe\u3002\u6b63\u786e\u4f7f\u7528\u65f6 `CursorPagination` \u786e\u4fdd\u5ba2\u6237\u7aef\u5728\u5206\u9875\u65f6\u4e0d\u4f1a\u770b\u5230\u540c\u4e00\u4e2a item\uff0c\u5373\u4f7f\u5728\u5206\u9875\u8fc7\u7a0b\u4e2d\u5176\u4ed6\u5ba2\u6237\u7aef\u6b63\u5728\u63d2\u5165\u65b0 item\u3002\r\n* \u652f\u6301\u4f7f\u7528\u975e\u5e38\u5927\u7684\u6570\u636e\u96c6\u3002\u4f7f\u7528\u6781\u5927\u6570\u636e\u96c6\u5206\u9875\u65f6\uff0c\u4f7f\u7528\u57fa\u4e8e\u504f\u79fb\u91cf\u7684\u5206\u9875\u6837\u5f0f\u53ef\u80fd\u4f1a\u53d8\u5f97\u6548\u7387\u4f4e\u4e0b\u6216\u65e0\u6cd5\u4f7f\u7528\u3002\u57fa\u4e8e\u6e38\u6807\u7684\u5206\u9875\u65b9\u6848\u5177\u6709\u56fa\u5b9a\u65f6\u95f4\u5c5e\u6027\uff0c\u5e76\u4e14\u4e0d\u4f1a\u968f\u7740\u6570\u636e\u96c6\u5927\u5c0f\u7684\u589e\u52a0\u800c\u51cf\u6162\u3002\r\n\r\n#### \u7ec6\u8282\u548c\u9650\u5236\r\n\r\n\u6b63\u786e\u4f7f\u7528\u57fa\u4e8e\u6e38\u6807\u7684\u5206\u9875\u9700\u8981\u7a0d\u5fae\u6ce8\u610f\u7ec6\u8282\u3002\u4f60\u9700\u8981\u8003\u8651\u5e0c\u671b\u5c06\u8be5\u65b9\u6848\u5e94\u7528\u4e8e\u4f55\u79cd\u987a\u5e8f\u3002\u9ed8\u8ba4\u662f\u6309 `\"-created\"` \u6392\u5e8f\u3002\u8fd9\u5047\u8bbe\u5728\u6a21\u578b\u5b9e\u4f8b\u4e0a\u5fc5\u987b\u6709\u4e00\u4e2a \u201ccreated\u201d \u65f6\u95f4\u6233\u5b57\u6bb5\uff0c\u5e76\u4e14\u4f1a\u6e32\u67d3\u4e00\u4e2a \u201c\u65f6\u95f4\u8f74\u201d \u6837\u5f0f\u5206\u9875\u89c6\u56fe\uff0c\u5176\u4e2d\u6700\u8fd1\u6dfb\u52a0\u7684 item \u662f\u7b2c\u4e00\u4e2a\u3002\r\n\r\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199\u5206\u9875\u7c7b\u4e0a\u7684 `'ordering'` \u5c5e\u6027\u6216\u8005\u5c06 `OrderingFilter` \u8fc7\u6ee4\u5668\u7c7b\u4e0e `CursorPagination` \u4e00\u8d77\u4f7f\u7528\u6765\u4fee\u6539\u6392\u5e8f\u3002\u4e0e `OrderingFilter` \u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u4f60\u5e94\u8be5\u8003\u8651\u9650\u5236\u7528\u6237\u53ef\u4ee5\u6392\u5e8f\u7684\u5b57\u6bb5\u3002\r\n\r\n\u6b63\u786e\u4f7f\u7528\u6e38\u6807\u5206\u9875\u5e94\u8be5\u6709\u4e00\u4e2a\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u6392\u5e8f\u5b57\u6bb5\uff1a\r\n\r\n* \u5728\u521b\u5efa\u65f6\u5e94\u8be5\u662f\u4e00\u4e2a\u4e0d\u53d8\u7684\u503c\uff0c\u4f8b\u5982\u65f6\u95f4\u6233\uff0cslug\uff0c\u6216\u5176\u4ed6\u53ea\u8bbe\u7f6e\u4e00\u6b21\u7684\u5b57\u6bb5\u3002\r\n* \u5e94\u8be5\u662f\u72ec\u7279\u7684\uff0c\u6216\u51e0\u4e4e\u72ec\u4e00\u65e0\u4e8c\u7684\u3002\u6beb\u79d2\u7cbe\u5ea6\u65f6\u95f4\u6233\u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\u3002\u8fd9\u79cd\u6e38\u6807\u5206\u9875\u7684\u5b9e\u73b0\u4f7f\u7528\u4e86\u4e00\u79cd\u667a\u80fd\u7684 \u201c\u4f4d\u7f6e + \u504f\u79fb\u201d \u98ce\u683c\uff0c\u5141\u8bb8\u5b83\u6b63\u786e\u5730\u652f\u6301\u975e\u4e25\u683c\u552f\u4e00\u7684\u503c\u4f5c\u4e3a\u6392\u5e8f\u3002\r\n* \u5e94\u8be5\u662f\u53ef\u4ee5\u5f3a\u5236\u4e3a\u5b57\u7b26\u4e32\u7684\u975e\u7a7a\u503c\u3002\r\n* \u4e0d\u5e94\u8be5\u662f\u4e00\u4e2a float\u3002\u7cbe\u5ea6\u9519\u8bef\u5f88\u5bb9\u6613\u5bfc\u81f4\u9519\u8bef\u7684\u7ed3\u679c\u3002\u63d0\u793a\uff1a\u6539\u7528\u5c0f\u6570\u3002\uff08\u5982\u679c\u4f60\u5df2\u7ecf\u6709\u4e00\u4e2a float \u5b57\u6bb5\u5e76\u4e14\u5fc5\u987b\u5bf9\u5176\u8fdb\u884c\u5206\u9875\uff0c\u5219\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230[\u4f7f\u7528\u5c0f\u6570\u6765\u9650\u5b9a\u7cbe\u5ea6\u7684\u793a\u4f8b](https://gist.github.com/keturn/8bc88525a183fd41c73ffb729b8865be#file-fpcursorpagination-py)\u3002\uff09\r\n* \u8be5\u5b57\u6bb5\u5e94\u8be5\u6709\u4e00\u4e2a\u6570\u636e\u5e93\u7d22\u5f15\u3002\r\n\r\n\u4f7f\u7528\u4e0d\u6ee1\u8db3\u8fd9\u4e9b\u7ea6\u675f\u6761\u4ef6\u7684\u6392\u5e8f\u5b57\u6bb5\u901a\u5e38\u4ecd\u7136\u6709\u6548\uff0c\u4f46\u662f\u4f60\u5c06\u5931\u53bb\u6e38\u6807\u5206\u9875\u7684\u4e00\u4e9b\u597d\u5904\u3002\r\n\r\n#### Setup\r\n\r\n\u8981\u5168\u5c40\u542f\u7528 `CursorPagination` \u6837\u5f0f\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\uff0c\u6839\u636e\u9700\u8981\u4fee\u6539 `PAGE_SIZE`\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.CursorPagination',\r\n    'PAGE_SIZE': 100\r\n}\r\n```\r\n\r\n\u5982\u679c\u4f7f\u7528\u7684\u662f `GenericAPIView` \u5b50\u7c7b\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e `pagination_class` \u5c5e\u6027\u4ee5\u57fa\u4e8e\u6bcf\u4e2a\u89c6\u56fe\u9009\u62e9 `CursorPagination`\u3002\r\n\r\n#### Configuration\r\n\r\n`CursorPagination` \u7c7b\u5305\u542b\u4e00\u4e9b\u53ef\u4ee5\u88ab\u8986\u76d6\u4ee5\u4fee\u6539\u5206\u9875\u6837\u5f0f\u7684\u5c5e\u6027\u3002\r\n\r\n\u8981\u8bbe\u7f6e\u8fd9\u4e9b\u5c5e\u6027\uff0c\u4f60\u5e94\u8be5\u7ee7\u627f `CursorPagination` \u7c7b\uff0c\u7136\u540e\u50cf\u4e0a\u9762\u90a3\u6837\u542f\u7528\u4f60\u7684\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\u3002\r\n\r\n* `page_size` = \u6307\u5b9a\u9875\u9762\u5927\u5c0f\u7684\u6570\u5b57\u503c\u3002\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u4f1a\u8986\u76d6 `PAGE_SIZE` \u8bbe\u7f6e\u3002\u9ed8\u8ba4\u503c\u4e0e `PAGE_SIZE` setting key \u76f8\u540c\u3002\r\n* `cursor_query_param` = \u4e00\u4e2a\u5b57\u7b26\u4e32\u503c\uff0c\u6307\u5b9a \u201c\u6e38\u6807\u201d \u67e5\u8be2\u53c2\u6570\u7684\u540d\u79f0\u3002\u9ed8\u8ba4\u4e3a `'cursor'`.\r\n* `ordering` = \u8fd9\u5e94\u8be5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6216\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6307\u5b9a\u5c06\u5e94\u7528\u57fa\u4e8e\u6e38\u6807\u7684\u5206\u9875\u7684\u5b57\u6bb5\u3002\u4f8b\u5982\uff1a `ordering = 'slug'`\u3002\u9ed8\u8ba4\u4e3a `-created`\u3002\u8be5\u503c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728\u89c6\u56fe\u4e0a\u4f7f\u7528 `OrderingFilter` \u6765\u8986\u76d6\u3002\r\n* `template` = \u5728\u53ef\u6d4f\u89c8 API \u4e2d\u6e32\u67d3\u5206\u9875\u63a7\u4ef6\u65f6\u4f7f\u7528\u7684\u6a21\u677f\u7684\u540d\u79f0\u3002\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6\u4ee5\u4fee\u6539\u6e32\u67d3\u6837\u5f0f\uff0c\u6216\u8bbe\u7f6e\u4e3a `None` \u4ee5\u5b8c\u5168\u7981\u7528 HTML \u5206\u9875\u63a7\u4ef6\u3002\u9ed8\u8ba4\u4e3a `\"rest_framework/pagination/previous_and_next.html\"`\u3002\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u5206\u9875\u6837\u5f0f\r\n\r\n\u8981\u521b\u5efa\u81ea\u5b9a\u4e49\u5206\u9875\u5e8f\u5217\u5316\u7c7b\uff0c\u4f60\u5e94\u8be5\u7ee7\u627f `pagination.BasePagination` \u5e76\u8986\u76d6 `paginate_queryset(self, queryset, request, view=None)` \u548c `get_paginated_response(self, data)` \u65b9\u6cd5\uff1a\r\n\r\n* `paginate_queryset` \u65b9\u6cd5\u88ab\u4f20\u9012\u7ed9\u521d\u59cb\u67e5\u8be2\u96c6\uff0c\u5e76\u4e14\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u53ea\u5305\u542b\u8bf7\u6c42\u9875\u9762\u4e2d\u7684\u6570\u636e\u7684\u53ef\u8fed\u4ee3\u5bf9\u8c61\u3002\r\n* `get_paginated_response` \u65b9\u6cd5\u4f20\u9012\u5e8f\u5217\u5316\u7684\u9875\u9762\u6570\u636e\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a `Response` \u5b9e\u4f8b\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c`paginate_queryset` \u65b9\u6cd5\u53ef\u4ee5\u5728\u5206\u9875\u5b9e\u4f8b\u4e0a\u8bbe\u7f6e\u72b6\u6001\uff0c\u800c\u540e `get_paginated_response` \u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528\u5b83\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u5047\u8bbe\u6211\u4eec\u60f3\u7528\u4e00\u4e2a\u4fee\u6539\u540e\u7684\u683c\u5f0f\u66ff\u6362\u9ed8\u8ba4\u7684\u5206\u9875\u8f93\u51fa\u6837\u5f0f\uff0c\u8be5\u6837\u5f0f\u5305\u542b\u5d4c\u5957\u7684 \u201clinks\u201d key\uff08\u5305\u542b\u4e0a\u4e00\u9875\uff0c\u4e0b\u4e00\u9875\u94fe\u63a5\uff09\u3002\u6211\u4eec\u53ef\u4ee5\u50cf\u8fd9\u6837\u6307\u5b9a\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\uff1a\r\n\r\n``` python\r\nclass CustomPagination(pagination.PageNumberPagination):\r\n    def get_paginated_response(self, data):\r\n        return Response({\r\n            'links': {\r\n                'next': self.get_next_link(),\r\n                'previous': self.get_previous_link()\r\n            },\r\n            'count': self.page.paginator.count,\r\n            'results': data\r\n        })\r\n```\r\n\r\n\u7136\u540e\u6211\u4eec\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7c7b\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PAGINATION_CLASS': 'my_project.apps.core.pagination.CustomPagination',\r\n    'PAGE_SIZE': 100\r\n}\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4f60\u5173\u5fc3\u5982\u4f55\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u663e\u793a\u952e\u7684\u987a\u5e8f\uff0c\u5219\u53ef\u4ee5\u5728\u6784\u5efa\u5206\u9875\u54cd\u5e94\u7684\u4e3b\u4f53\u65f6\u9009\u62e9\u4f7f\u7528 `OrderedDict`\uff0c\u8fd9\u662f\u53ef\u9009\u7684\u3002\r\n\r\n## \u4f7f\u7528\u4f60\u7684\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\r\n\r\n\u8981\u9ed8\u8ba4\u4f7f\u7528\u4f60\u7684\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\uff0c\u8bf7\u4f7f\u7528 `DEFAULT_PAGINATION_CLASS` setting\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PAGINATION_CLASS': 'my_project.apps.core.pagination.LinkHeaderPagination',\r\n    'PAGE_SIZE': 100\r\n}\r\n```\r\n\u5217\u8868\u7aef\u70b9\u7684 API \u54cd\u5e94\u73b0\u5728\u5c06\u5305\u542b\u4e00\u4e2a `Link` header\uff0c\u800c\u4e0d\u662f\u5c06\u5206\u9875\u94fe\u63a5\u5305\u542b\u4e3a\u54cd\u5e94\u4e3b\u4f53\u7684\u4e00\u90e8\u5206\u3002\r\n\r\n## \u5206\u9875\u548c\u6a21\u5f0f\r\n\r\n\u901a\u8fc7\u5b9e\u73b0 `get_schema_fields()` \u65b9\u6cd5\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u5206\u9875\u63a7\u4ef6\u53ef\u7528\u4e8e REST framework \u63d0\u4f9b\u7684\u6a21\u5f0f\u81ea\u52a8\u751f\u6210\u3002\u6b64\u65b9\u6cd5\u5e94\u5177\u6709\u4ee5\u4e0b\u7b7e\u540d\uff1a\r\n\r\n`get_schema_fields(self, view)`\r\n\r\n\u8be5\u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a `coreapi.Field` \u5b9e\u4f8b\u5217\u8868\u3002\r\n\r\n---\r\n\r\n![Link Header](http://www.django-rest-framework.org/img/link-header-pagination.png)\r\n\r\n*\u81ea\u5b9a\u4e49\u5206\u9875\u6837\u5f0f\uff0c\u4f7f\u7528  'Link' header*\r\n\r\n---\r\n\r\n# HTML \u5206\u9875\u63a7\u4ef6\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u5206\u9875\u7c7b\u5c06\u5bfc\u81f4 HTML \u5206\u9875\u63a7\u4ef6\u663e\u793a\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u3002\u6709\u4e24\u79cd\u5185\u7f6e\u663e\u793a\u6837\u5f0f\u3002 `PageNumberPagination` \u548c `LimitOffsetPagination` \u7c7b\u663e\u793a\u5305\u542b\u4e0a\u4e00\u9875\u548c\u4e0b\u4e00\u9875\u63a7\u4ef6\u7684\u9875\u7801\u5217\u8868\u3002 `CursorPagination` \u7c7b\u663e\u793a\u66f4\u7b80\u5355\u7684\u6837\u5f0f\uff0c\u53ea\u663e\u793a\u4e0a\u4e00\u9875\u548c\u4e0b\u4e00\u9875\u63a7\u4ef6\u3002\r\n\r\n## \u81ea\u5b9a\u4e49\u63a7\u4ef6\r\n\r\n\u4f60\u53ef\u4ee5\u8986\u76d6\u6e32\u67d3 HTML \u5206\u9875\u63a7\u4ef6\u7684\u6a21\u677f\u3002\u8fd9\u4e24\u79cd\u5185\u7f6e\u5f0f\u6837\u662f\uff1a\r\n\r\n* `rest_framework/pagination/numbers.html`\r\n* `rest_framework/pagination/previous_and_next.html`\r\n\r\n\u5728\u5168\u5c40\u6a21\u677f\u76ee\u5f55\u4e2d\u63d0\u4f9b\u5177\u6709\u8fd9\u4e9b\u8def\u5f84\u7684\u6a21\u677f\u5c06\u8986\u76d6\u76f8\u5173\u5206\u9875\u7c7b\u7684\u9ed8\u8ba4\u6e32\u67d3\u3002\r\n\r\n\u6216\u8005\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728\u73b0\u6709\u7c7b\u7684\u5b50\u7c7b\u4e0a\u5b8c\u5168\u7981\u7528 HTML \u5206\u9875\u63a7\u4ef6\uff0c\u5c06 `template=None` \u8bbe\u7f6e\u4e3a\u8be5\u7c7b\u7684\u5c5e\u6027\u3002\u7136\u540e\uff0c\u4f60\u9700\u8981\u914d\u7f6e\u4f60\u7684 `DEFAULT_PAGINATION_CLASS` setting key\uff0c\u4ee5\u5c06\u4f60\u7684\u81ea\u5b9a\u4e49\u7c7b\u7528\u4f5c\u9ed8\u8ba4\u5206\u9875\u6837\u5f0f\u3002\r\n\r\n#### \u4f4e\u7ea7 API\r\n\r\n\u7528\u4e8e\u786e\u5b9a\u5206\u9875\u7c7b\u662f\u5426\u5e94\u663e\u793a\u63a7\u4ef6\u7684\u4f4e\u7ea7 API \u4f5c\u4e3a\u5206\u9875\u5b9e\u4f8b\u4e0a\u7684 `display_page_controls` \u5c5e\u6027\u516c\u5f00\u3002\u5982\u679c\u9700\u8981\u663e\u793aHTML \u5206\u9875\u63a7\u4ef6\uff0c\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\u5e94\u8be5\u5728 `paginate_queryset` \u65b9\u6cd5\u4e2d\u8bbe\u7f6e\u4e3a `True` \u3002\r\n\r\n`.to_html()` \u548c `.get_html_context()` \u65b9\u6cd5\u4e5f\u53ef\u4ee5\u5728\u81ea\u5b9a\u4e49\u5206\u9875\u7c7b\u4e2d\u91cd\u5199\uff0c\u4ee5\u4fbf\u8fdb\u4e00\u6b65\u81ea\u5b9a\u4e49\u63a7\u4ef6\u7684\u6e32\u67d3\u65b9\u5f0f\u3002\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/pagination.md", "create_date": "2020-02-20T13:10:40.631", "order": 17}}, {"model": "subject.chapter", "pk": 153, "fields": {"title": "\u6e32\u67d3renderers", "topic": 7, "md5": "272778e3cd8706765b64c6f68b6a2134", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/renderers/)\r\n\r\n\r\n## \u6e32\u67d3\r\n\r\nREST framework \u5305\u542b\u8bb8\u591a\u5185\u7f6e\u7684\u6e32\u67d3\u5668\u7c7b\uff0c\u5141\u8bb8\u60a8\u4f7f\u7528\u5404\u79cd media type \u8fd4\u56de\u54cd\u5e94\u3002\u540c\u65f6\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u6e32\u67d3\u5668\u3002\r\n\r\n### \u5982\u4f55\u786e\u5b9a\u4f7f\u7528\u54ea\u4e2a\u6e32\u67d3\u5668\r\n\r\n\u89c6\u56fe\u7684\u6e32\u67d3\u5668\u96c6\u5408\u59cb\u7ec8\u88ab\u5b9a\u4e49\u4e3a\u7c7b\u5217\u8868\u3002\u5f53\u8c03\u7528\u89c6\u56fe\u65f6\uff0cREST framework \u5c06\u5bf9\u8bf7\u6c42\u5185\u5bb9\u8fdb\u884c\u5206\u6790\uff0c\u5e76\u786e\u5b9a\u6700\u5408\u9002\u7684\u6e32\u67d3\u5668\u4ee5\u6ee1\u8db3\u8bf7\u6c42\u3002\u5185\u5bb9\u5206\u6790\u7684\u57fa\u672c\u8fc7\u7a0b\u5305\u62ec\u68c0\u67e5\u8bf7\u6c42\u7684 `Accept` header\uff0c\u4ee5\u786e\u5b9a\u5b83\u5728\u54cd\u5e94\u4e2d\u671f\u671b\u7684 media type\u3002\u6216\u8005\uff0c\u7528 URL \u4e0a\u7684\u683c\u5f0f\u540e\u7f00\u660e\u786e\u8868\u793a\u3002\u4f8b\u5982\uff0cURL `http://example.com/api/users_count.json` \u53ef\u80fd\u59cb\u7ec8\u8fd4\u56de JSON \u6570\u636e\u3002\r\n\r\n\r\n### \u8bbe\u7f6e\u6e32\u67d3\u5668\r\n\r\n\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_RENDERER_CLASSES` \u8bbe\u7f6e\u5168\u5c40\u7684\u9ed8\u8ba4\u6e32\u67d3\u5668\u96c6\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8bbe\u7f6e\u5c06\u4f7f\u7528JSON\u4f5c\u4e3a\u4e3b\u8981 media type\uff0c\u5e76\u4e14\u8fd8\u5305\u542b\u81ea\u63cf\u8ff0 API\u3002\r\n\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_RENDERER_CLASSES': (\r\n        'rest_framework.renderers.JSONRenderer',\r\n        'rest_framework.renderers.BrowsableAPIRenderer',\r\n    )\r\n}\r\n```\r\n\r\n\u8fd8\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e `API\u200b\u200bView` \u7684\u89c6\u56fe\u7c7b\u6765\u8bbe\u7f6e\u5355\u4e2a\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u7684\u6e32\u67d3\u5668\u3002\r\n\r\n``` python\r\nfrom django.contrib.auth.models import User\r\nfrom rest_framework.renderers import JSONRenderer\r\nfrom rest_framework.response import Response\r\nfrom rest_framework.views import APIView\r\n\r\nclass UserCountView(APIView):\r\n    \"\"\"\r\n    A view that returns the count of active users in JSON.\r\n    \"\"\"\r\n    renderer_classes = (JSONRenderer, )\r\n\r\n    def get(self, request, format=None):\r\n        user_count = User.objects.filter(active=True).count()\r\n        content = {'user_count': user_count}\r\n        return Response(content)\r\n```\r\n\r\n\u6216\u8005\u662f\u5728\u57fa\u4e8e `@api_view` \u88c5\u9970\u5668\u7684\u51fd\u6570\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u3002\r\n\r\n``` python\r\n@api_view(['GET'])\r\n@renderer_classes((JSONRenderer,))\r\ndef user_count_view(request, format=None):\r\n    \"\"\"\r\n    A view that returns the count of active users in JSON.\r\n    \"\"\"\r\n    user_count = User.objects.filter(active=True).count()\r\n    content = {'user_count': user_count}\r\n    return Response(content)\r\n```\r\n\r\n### \u6e32\u67d3\u5668\u7c7b\u7684\u4f18\u5148\u7ea7\r\n\r\n\u5728\u4e3a API \u6307\u5b9a\u6e32\u67d3\u5668\u7c7b\u65f6\uff0c\u9700\u8981\u8003\u8651\u5b83\u4eec\u5904\u7406\u6bcf\u79cd\u5a92\u4f53\u7c7b\u578b\u65f6\u7684\u4f18\u5148\u7ea7\uff0c\u8fd9\u70b9\u5f88\u91cd\u8981\u3002\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709\u6307\u5b9a\u63a5\u53d7\u6570\u636e\u7684\u8868\u73b0\u5f62\u5f0f\uff0c\u4f8b\u5982\u53d1\u9001 `Accept\uff1a*/*` header\uff0c\u6216\u8005\u6839\u672c\u4e0d\u5305\u542b `Accept` header\uff0c\u5219 REST framework \u5c06\u9009\u62e9\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6e32\u67d3\u5668\u7528\u4e8e\u54cd\u5e94\u3002\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u7684 API \u63d0\u4f9b JSON \u54cd\u5e94\u548c\u53ef\u6d4f\u89c8\u7684 HTML API\uff0c\u5219\u53ef\u80fd\u9700\u8981\u5c06 `JSONRenderer` \u4f5c\u4e3a\u9ed8\u8ba4\u6e32\u67d3\u5668\uff0c\u4ee5\u4fbf\u5c06 `JSON` \u54cd\u5e94\u53d1\u9001\u7ed9\u672a\u6307\u5b9a `Accept` header \u7684\u5ba2\u6237\u7aef\u3002\r\n\r\n\u5982\u679c\u4f60\u7684 API \u5305\u542b\u53ef\u6839\u636e\u8bf7\u6c42\u540c\u65f6\u5904\u7406\u5e38\u89c4\u7f51\u9875\u548c API \u54cd\u5e94\u7684\u89c6\u56fe\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u8003\u8651\u5c06 `TemplateHTMLRenderer` \u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u6e32\u67d3\u5668\uff0c\u4ee5\u4fbf\u4e0e\u53d1\u9001 broken accept headers \u7684\u8001\u5f0f\u6d4f\u89c8\u5668\u5f88\u597d\u5730\u914d\u5408\u4f7f\u7528\u3002\r\n\r\n## API \u53c2\u8003\r\n\r\n### JSONRenderer\r\n\r\n\u4f7f\u7528 utf-8 \u7f16\u7801\u5c06\u8bf7\u6c42\u6570\u636e\u5448\u73b0\u4e3a `JSON`\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u9ed8\u8ba4\u98ce\u683c\u5305\u542b unicode \u5b57\u7b26\uff0c\u5e76\u4f7f\u7528\u7d27\u51d1\u98ce\u683c\u5448\u73b0\uff08\u6ca1\u6709\u591a\u4f59\u7684\u7a7a\u767d\uff09\u54cd\u5e94\uff1a\r\n\r\n``` python\r\n{\"unicode black star\":\"\u2605\",\"value\":999}\r\n```\r\n\r\n\u5ba2\u6237\u7aef\u53ef\u80fd\u8fd8\u4f1a\u5305\u542b \u201c\u7f29\u8fdb\u201d media type \u53c2\u6570\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8fd4\u56de\u7684 `JSON` \u5c06\u4f1a\u7f29\u8fdb\u3002\r\n\r\n\u6bd4\u5982\uff1a `Accept: application/json; indent=4`\u3002\r\n\r\n``` python\r\n{\r\n    \"unicode black star\": \"\u2605\",\r\n    \"value\": 999\r\n}\r\n```\r\n\r\n\u4f7f\u7528 `UNICODE_JSON` \u548c `COMPACT_JSON` \u8bbe\u7f6e\u952e\u53ef\u4ee5\u66f4\u6539\u9ed8\u8ba4\u7684 JSON \u7f16\u7801\u98ce\u683c\u3002\r\n\r\n**.media_type**\uff1a `application/json`\r\n\r\n**.format**\uff1a `'.json'`\r\n\r\n**.charset**\uff1a `None`\r\n\r\n\r\n\r\n\r\n### TemplateHTMLRenderer\r\n\r\n\r\n\u4f7f\u7528 Django \u7684\u6807\u51c6\u6a21\u677f\u5c06\u6570\u636e\u5448\u73b0\u4e3a HTML\u3002\u4e0e\u5176\u4ed6\u6e32\u67d3\u5668\u4e0d\u540c\uff0c\u4f20\u9012\u7ed9 `Response` \u7684\u6570\u636e\u4e0d\u9700\u8981\u5e8f\u5217\u5316\u3002\u53e6\u5916\uff0c\u521b\u5efa `Response` \u65f6\u53ef\u80fd\u9700\u8981\u5305\u542b `template_name` \u53c2\u6570\u3002\r\n\r\nTemplateHTMLRenderer \u5c06\u521b\u5efa\u4e00\u4e2a `RequestContext`\uff0c\u4f7f\u7528 `response.data` \u4f5c\u4e3a\u4e0a\u4e0b\u6587\u5b57\u5178\uff0c\u5e76\u786e\u5b9a\u7528\u4e8e\u5448\u73b0\u4e0a\u4e0b\u6587\u7684\u6a21\u677f\u540d\u79f0\u3002\r\n\r\n\u6a21\u677f\u540d\u79f0\u7531\uff08\u6309\u4f18\u5148\u987a\u5e8f\uff09\u786e\u5b9a\uff1a  \r\n1. \u4f20\u9012\u7ed9 response \u7684\u663e\u5f0f `template_name` \u53c2\u6570\u3002\r\n2. \u5728\u6b64\u7c7b\u4e0a\u8bbe\u7f6e\u660e\u786e\u7684 `.template_name` \u5c5e\u6027\u3002\r\n3. \u8c03\u7528 `view.get_template_names()` \u7684\u8fd4\u56de\u7ed3\u679c\u3002\r\n\r\n\r\n\u4f7f\u7528 `TemplateHTMLRenderer` \u7684\u89c6\u56fe\u793a\u4f8b\uff1a\r\n\r\n``` python\r\nclass UserDetail(generics.RetrieveAPIView):\r\n    \"\"\"\r\n    A view that returns a templated HTML representation of a given user.\r\n    \"\"\"\r\n    queryset = User.objects.all()\r\n    renderer_classes = (TemplateHTMLRenderer,)\r\n\r\n    def get(self, request, *args, **kwargs):\r\n        self.object = self.get_object()\r\n        return Response({'user': self.object}, template_name='user_detail.html')\r\n```\r\n\r\n\u4f60\u53ef\u4ee5\u4f7f\u7528 `TemplateHTMLRenderer` \u6765\u4f7f REST framework \u8fd4\u56de\u5e38\u89c4 HTML \u9875\u9762\uff0c\u6216\u8005\u4ece\u5355\u4e2a\u7aef\u70b9\uff08a single endpoint\uff09\u8fd4\u56de HTML \u548c API \u54cd\u5e94\u3002\r\n\r\n\u5982\u679c\u4f60\u6b63\u5728\u6784\u5efa\u4f7f\u7528 `TemplateHTMLRenderer` \u4ee5\u53ca\u5176\u4ed6\u6e32\u67d3\u5668\u7c7b\u7684\u7f51\u7ad9\uff0c\u5219\u5e94\u8003\u8651\u5c06 `TemplateHTMLRenderer` \u5217\u4e3a `renderer_classes` \u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u7c7b\uff0c\u4ee5\u4fbf\u5373\u4f7f\u5bf9\u4e8e\u53d1\u9001\u683c\u5f0f\u9519\u8bef\u7684 `ACCEPT:` header \u7684\u6d4f\u89c8\u5668\uff0c\u4e5f\u4f1a\u4f18\u5148\u8003\u8651\u5b83\u3002\r\n\r\n\r\n**.media_type**\uff1a `text/html`\r\n\r\n**.format**\uff1a `'.html'`\r\n\r\n**.charset**\uff1a `utf-8`\r\n\r\n\r\n### StaticHTMLRenderer\r\n\r\n\u4e00\u4e2a\u7b80\u5355\u7684\u6e32\u67d3\u5668\uff0c\u5b83\u53ea\u662f\u8fd4\u56de\u9884\u6e32\u67d3\u7684 HTML\u3002\u4e0e\u5176\u4ed6\u6e32\u67d3\u5668\u4e0d\u540c\uff0c\u4f20\u9012\u7ed9\u54cd\u5e94\u5bf9\u8c61\u7684\u6570\u636e\u5e94\u8be5\u662f\u8868\u793a\u8981\u8fd4\u56de\u7684\u5185\u5bb9\u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n\r\n\u4f7f\u7528 `StaticHTMLRenderer` \u7684\u89c6\u56fe\u793a\u4f8b\uff1a\r\n\r\n``` python\r\n@api_view(('GET',))\r\n@renderer_classes((StaticHTMLRenderer,))\r\ndef simple_html_view(request):\r\n    data = '<html><body><h1>Hello, world</h1></body></html>'\r\n    return Response(data)\r\n```\r\n\r\n\u4f60\u53ef\u4ee5\u4f7f\u7528 `StaticHTMLRenderer` \u6765\u4f7f REST framework \u8fd4\u56de\u5e38\u89c4 HTML \u9875\u9762\uff0c\u6216\u8005\u4ece\u5355\u4e2a\u7aef\u70b9\uff08a single endpoint\uff09\u8fd4\u56de HTML \u548c API \u54cd\u5e94\u3002\r\n\r\n\r\n**.media_type**\uff1a `text/html`\r\n\r\n**.format**\uff1a `'.html'`\r\n\r\n**.charset**\uff1a `utf-8`\r\n\r\n\r\n\r\n### BrowsableAPIRenderer\r\n\r\n\u5c06\u6570\u636e\u5448\u73b0\u4e3a\u53ef\u6d4f\u89c8\u7684 HTML API\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/3/6/161faa6cbcca4e26?w=791&h=696&f=png&s=39050)\r\n\r\n\r\n\u8be5\u6e32\u67d3\u5668\u5c06\u786e\u5b9a\u54ea\u4e2a\u5176\u4ed6\u6e32\u67d3\u5668\u88ab\u8d4b\u4e88\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c\u5e76\u4f7f\u7528\u8be5\u6e32\u67d3\u5668\u5728 HTML \u9875\u9762\u4e2d\u663e\u793a API \u98ce\u683c\u54cd\u5e94\u3002\r\n\r\n\r\n**.media_type**\uff1a `text/html`\r\n\r\n**.format**\uff1a `'.api'`\r\n\r\n**.charset**\uff1a `utf-8`\r\n\r\n**.template**\uff1a `'rest_framework/api.html'`\r\n\r\n\r\n**\u81ea\u5b9a\u4e49 BrowsableAPIRenderer**\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9664 `BrowsableAPIRenderer` \u4e4b\u5916\uff0c\u54cd\u5e94\u5185\u5bb9\u5c06\u4f7f\u7528\u6700\u9ad8\u4f18\u5148\u7ea7\u7684\u6e32\u67d3\u5668\u6e32\u67d3\u3002\u5982\u679c\u4f60\u9700\u8981\u81ea\u5b9a\u4e49\u6b64\u884c\u4e3a\uff0c\u4f8b\u5982\uff0c\u5c06 HTML \u7528\u4f5c\u9ed8\u8ba4\u8fd4\u56de\u683c\u5f0f\uff0c\u4f46\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u4f7f\u7528 JSON\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u8986\u76d6 `get_default_renderer()` \u65b9\u6cd5\u6765\u5b9e\u73b0\u3002\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass CustomBrowsableAPIRenderer(BrowsableAPIRenderer):\r\n    def get_default_renderer(self, view):\r\n        return JSONRenderer()\r\n```\r\n\r\n\r\n### AdminRenderer\r\n\r\n\u5c06\u6570\u636e\u5448\u73b0\u4e3a HTML\uff0c\u4ee5\u663e\u793a\u7c7b\u4f3c\u7ba1\u7406\u5458\u7684\u5185\u5bb9\uff1a\r\n\r\n![](https://user-gold-cdn.xitu.io/2018/3/6/161faa6cbcd71d07?w=996&h=528&f=png&s=55904)\r\n\r\n\r\n\u8be5\u6e32\u67d3\u5668\u9002\u7528\u4e8e CRUD \u98ce\u683c\u7684 Web API\uff0c\u8be5 API \u8fd8\u5e94\u63d0\u4f9b\u7528\u4e8e\u7ba1\u7406\u6570\u636e\u7684\u7528\u6237\u53cb\u597d\u754c\u9762\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c `AdminRenderer`  \u5bf9\u4e8e\u5d4c\u5957\u6216\u5217\u51fa\u5e8f\u5217\u5316\u8f93\u5165\u7684\u89c6\u56fe\u4e0d\u8d77\u4f5c\u7528\uff0c\u56e0\u4e3a HTML \u8868\u5355\u65e0\u6cd5\u6b63\u786e\u652f\u6301\u5b83\u4eec\u3002\r\n\r\n**\u6ce8\u610f**\uff1a\u5f53\u6570\u636e\u4e2d\u5b58\u5728\u6b63\u786e\u914d\u7f6e\u7684 `URL_FIELD_NAME` \uff08\u9ed8\u8ba4\u4e3a `url`\uff09\u5c5e\u6027\u65f6\uff0c `AdminRenderer` \u4ec5\u80fd\u591f\u5305\u542b\u6307\u5411\u8be6\u7ec6\u9875\u9762\u7684\u94fe\u63a5\u3002\u5bf9\u4e8e `HyperlinkedModelSerializer` \uff0c\u60c5\u51b5\u5c31\u662f\u8fd9\u6837\uff0c\u4f46\u5bf9\u4e8e `ModelSerializer` \u7c7b\u6216\u666e\u901a `Serializer` \u7c7b\uff0c\u4f60\u9700\u8981\u786e\u4fdd\u660e\u786e\u5305\u542b\u8be5\u5b57\u6bb5\u3002\u4f8b\u5982\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u6a21\u578b `get_absolute_url` \u65b9\u6cd5\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    url = serializers.CharField(source='get_absolute_url', read_only=True)\r\n\r\n    class Meta:\r\n        model = Account\r\n```\r\n\r\n**.media_type**\uff1a `text/html`\r\n\r\n**.format**\uff1a `'.admin'`\r\n\r\n**.charset**\uff1a `utf-8`\r\n\r\n**.template**\uff1a `'rest_framework/admin.html'`\r\n\r\n\r\n\r\n### HTMLFormRenderer\r\n\r\n\u5c06\u5e8f\u5217\u5316\u8fd4\u56de\u7684\u6570\u636e\u5448\u73b0\u4e3a HTML \u8868\u5355\u3002\u8be5\u6e32\u67d3\u5668\u7684\u8f93\u51fa\u4e0d\u5305\u542b\u5c01\u95ed\u7684 `<form>` \u6807\u7b7e\uff0c\u9690\u85cf\u7684 CSRF \u8f93\u5165\u6216\u4efb\u4f55\u63d0\u4ea4\u6309\u94ae\u3002\r\n\r\n\u8fd9\u4e2a\u6e32\u67d3\u5668\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528\uff0c\u800c\u662f\u53ef\u4ee5\u901a\u8fc7\u5c06\u4e00\u4e2a\u5e8f\u5217\u5316\u5668\u5b9e\u4f8b\u4f20\u9012\u7ed9 `render_form` \u6a21\u677f\u6807\u7b7e\u6765\u5728\u6a21\u677f\u4e2d\u4f7f\u7528\u3002\r\n\r\n``` python\r\n{% load rest_framework %}\r\n\r\n<form action=\"/submit-report/\" method=\"post\">\r\n    {% csrf_token %}\r\n    {% render_form serializer %}\r\n    <input type=\"submit\" value=\"Save\" />\r\n</form>\r\n```\r\n\r\n**.media_type**\uff1a `text/html`\r\n\r\n**.format**\uff1a `'.form'`\r\n\r\n**.charset**\uff1a `utf-8`\r\n\r\n**.template**\uff1a `'rest_framework/horizontal/form.html'`\r\n\r\n\r\n### MultiPartRenderer\r\n\r\n\u8be5\u6e32\u67d3\u5668\u7528\u4e8e\u5448\u73b0 HTML multipart form \u6570\u636e\u3002\u5b83\u4e0d\u9002\u5408\u4f5c\u4e3a\u54cd\u5e94\u6e32\u67d3\u5668\uff0c\u800c\u662f\u7528\u4e8e\u521b\u5efa\u6d4b\u8bd5\u8bf7\u6c42\uff0c\u4f7f\u7528REST framework \u7684\u6d4b\u8bd5\u5ba2\u6237\u7aef\u548c\u6d4b\u8bd5\u8bf7\u6c42\u5de5\u5382\u3002\r\n\r\n**.media_type**\uff1a `multipart/form-data; boundary=BoUnDaRyStRiNg`\r\n\r\n**.format**\uff1a `'.multipart'`\r\n\r\n**.charset**\uff1a `utf-8`\r\n\r\n## \u81ea\u5b9a\u4e49\u6e32\u67d3\u5668\r\n\r\n\r\n\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6e32\u67d3\u5668\uff0c\u60a8\u5e94\u8be5\u7ee7\u627f `BaseRenderer` \uff0c\u8bbe\u7f6e `.media_type` \u548c `.format` \u5c5e\u6027\uff0c\u5e76\u5b9e\u73b0 `.render(self, data, media_type=None, renderer_context=None)` \u65b9\u6cd5\u3002\r\n\r\n\r\n\u8be5\u65b9\u6cd5\u5e94\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u5c06\u7528\u4f5c HTTP \u54cd\u5e94\u7684\u4e3b\u4f53\u3002\r\n\r\n\u4f20\u9012\u7ed9 `.render()` \u65b9\u6cd5\u7684\u53c2\u6570\u662f\uff1a\r\n\r\n\r\n### `data`\r\n\r\n\r\n\u8bf7\u6c42\u6570\u636e\uff0c\u7531 `Response()` \u5b9e\u4f8b\u5316\u65f6\u8bbe\u7f6e\u3002\r\n\r\n### `media_type=None`\r\n\r\n\u53ef\u9009\u7684\u3002\u5982\u679c\u63d0\u4f9b\uff0c\u8fd9\u662f\u63a5\u53d7\u7684\u5a92\u4f53\u7c7b\u578b\uff0c\u7531\u5185\u5bb9\u534f\u5546\uff08content negotiation\uff09\u9636\u6bb5\u786e\u5b9a\u3002\r\n\r\n\u4f9d\u8d56\u4e8e\u5ba2\u6237\u7aef\u7684 `Accept:` header\uff0c\u5b83\u53ef\u4ee5\u6bd4\u6e32\u67d3\u5668\u7684 `media_type` \u5c5e\u6027\u66f4\u5177\u4f53\uff0c\u5e76\u4e14\u53ef\u80fd\u5305\u542b\u5a92\u4f53\u7c7b\u578b\u53c2\u6570\u3002\u6bd4\u5982 `\"application/json; nested=true\"` \u3002\r\n\r\n\r\n### `renderer_context=None`\r\n\r\n\r\n\u53ef\u9009\u7684\u3002\u5982\u679c\u63d0\u4f9b\uff0c\u5b83\u662f\u89c6\u56fe\u63d0\u4f9b\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u5b57\u5178\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5c06\u5305\u62ec\u4ee5\u4e0b\u952e\uff1a`view` , `request` , `response` , `args` , `kwargs` \u3002\r\n\r\n\r\n### \u4e3e\u4e2a\u6817\u5b50\r\n\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\u7eaf\u6587\u672c\u6e32\u67d3\u5668\uff0c\u5b83\u5c06\u8fd4\u56de\u5e26\u6709\u6570\u636e\u53c2\u6570\u7684\u54cd\u5e94\u4f5c\u4e3a\u54cd\u5e94\u7684\u5185\u5bb9\u3002\r\n\r\n``` python\r\nfrom django.utils.encoding import smart_unicode\r\nfrom rest_framework import renderers\r\n\r\n\r\nclass PlainTextRenderer(renderers.BaseRenderer):\r\n    media_type = 'text/plain'\r\n    format = 'txt'\r\n\r\n    def render(self, data, media_type=None, renderer_context=None):\r\n        return data.encode(self.charset)\r\n```\r\n\r\n\r\n### \u8bbe\u7f6e charset \r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6e32\u67d3\u5668\u7c7b\u88ab\u5047\u5b9a\u4e3a\u4f7f\u7528 UTF-8 \u7f16\u7801\u3002\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u7f16\u7801\uff0c\u8bf7\u5728\u6e32\u67d3\u5668\u4e0a\u8bbe\u7f6e `charset` \u5c5e\u6027\u3002\r\n\r\n``` python\r\nclass PlainTextRenderer(renderers.BaseRenderer):\r\n    media_type = 'text/plain'\r\n    format = 'txt'\r\n    charset = 'iso-8859-1'\r\n\r\n    def render(self, data, media_type=None, renderer_context=None):\r\n        return data.encode(self.charset)\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u6e32\u67d3\u5668\u7c7b\u8fd4\u56de\u4e00\u4e2a unicode \u5b57\u7b26\u4e32\uff0c\u5219\u54cd\u5e94\u5185\u5bb9\u5c06\u88ab `Response` \u7c7b\u5f3a\u5236\u4e3a\u4e00\u4e2a bytestring\uff0c\u8bf7\u5728\u6e32\u67d3\u5668\u4e0a\u8bbe\u7f6e `charset` \u5c5e\u6027\u7528\u4e8e\u786e\u5b9a\u7f16\u7801\u3002\r\n\r\n\u5982\u679c\u6e32\u67d3\u5668\u8fd4\u56de\u4ee3\u8868\u539f\u59cb\u4e8c\u8fdb\u5236\u5185\u5bb9\u7684\u5b57\u7b26\u4e32\uff0c\u5219\u5e94\u5c06 `charset`  \u503c\u8bbe\u7f6e\u4e3a `None`\uff0c\u8fd9\u5c06\u786e\u4fdd\u54cd\u5e94\u7684 `Content-Type` header \u4e0d\u4f1a\u8bbe\u7f6e `charset` \u503c\u3002\r\n\r\n\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u80fd\u8fd8\u60f3\u5c06 `render_style` \u5c5e\u6027\u8bbe\u7f6e\u4e3a `'binary'`\u3002\u8fd9\u6837\u505a\u4e5f\u5c06\u786e\u4fdd\u53ef\u6d4f\u89c8\u7684 API \u4e0d\u4f1a\u5c1d\u8bd5\u5c06\u4e8c\u8fdb\u5236\u5185\u5bb9\u663e\u793a\u4e3a\u5b57\u7b26\u4e32\u3002\r\n\r\n``` python\r\nclass JPEGRenderer(renderers.BaseRenderer):\r\n    media_type = 'image/jpeg'\r\n    format = 'jpg'\r\n    charset = None\r\n    render_style = 'binary'\r\n\r\n    def render(self, data, media_type=None, renderer_context=None):\r\n        return data\r\n```\r\n\r\n## \u6e32\u67d3\u5668\u7684\u9ad8\u7ea7\u7528\u6cd5\r\n\r\n\u4f60\u53ef\u4ee5\u4f7f\u7528 REST framework \u7684\u6e32\u67d3\u5668\u6765\u505a\u4e00\u4e9b\u975e\u5e38\u7075\u6d3b\u7684\u4e8b\u60c5\u3002\u4f8b\u5982...  \r\n* \u6839\u636e\u8bf7\u6c42\u7684 media type\uff0c\u63d0\u4f9b\u6765\u81ea\u540c\u4e00\u7aef\u70b9\u7684\u5e73\u9762\u6216\u5d4c\u5957\uff08flat or nested\uff09\u8868\u793a\u3002\r\n* \u540c\u65f6\u5904\u7406\u5e38\u89c4 HTML \u7f51\u9875\u548c\u6765\u81ea\u76f8\u540c\u7aef\u70b9\u7684\u57fa\u4e8e JSON \u7684 API \u54cd\u5e94\u3002\r\n* \u6307\u5b9a API \u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u591a\u79cd HTML \u8868\u793a\u5f62\u5f0f\u3002\r\n* \u4e0d\u7528\u660e\u786e\u6307\u5b9a\u6e32\u67d3\u5668\u7684 media type\uff0c\u4f8b\u5982\u4f7f\u7528 `media_type ='image/*'`\uff0c\u5e76\u4f7f\u7528 `Accept` header \u6539\u53d8\u54cd\u5e94\u7684\u7f16\u7801\u3002\r\n\r\n\r\n### media type \u7684\u53d8\u5316\r\n\r\n\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u5e0c\u671b\u89c6\u56fe\u6839\u636e\u63a5\u53d7\u7684 media type \u4f7f\u7528\u4e0d\u540c\u7684\u5e8f\u5217\u5316\u98ce\u683c\u3002\u5982\u679c\u9700\u8981\u8fd9\u6837\u505a\uff0c\u53ef\u4ee5\u8bbf\u95ee `request.accepted_renderer` \u4ee5\u786e\u5b9a\u5c06\u7528\u4e8e\u54cd\u5e94\u7684\u534f\u5546\uff08negotiate\uff09\u6e32\u67d3\u5668\u3002\r\n\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\n@api_view(('GET',))\r\n@renderer_classes((TemplateHTMLRenderer, JSONRenderer))\r\ndef list_users(request):\r\n    \"\"\"\r\n    A view that can return JSON or HTML representations\r\n    of the users in the system.\r\n    \"\"\"\r\n    queryset = Users.objects.filter(active=True)\r\n\r\n    if request.accepted_renderer.format == 'html':\r\n        # TemplateHTMLRenderer takes a context dict,\r\n        # and additionally requires a 'template_name'.\r\n        # It does not require serialization.\r\n        data = {'users': queryset}\r\n        return Response(data, template_name='list_users.html')\r\n\r\n    # JSONRenderer requires serialized data as normal.\r\n    serializer = UserSerializer(instance=queryset)\r\n    data = serializer.data\r\n    return Response(data)\r\n```\r\n\r\n### \u4e0d\u660e\u786e\u7684 media type\r\n\r\n\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u9700\u8981\u6e32\u67d3\u5668\u6765\u63d0\u4f9b\u4e00\u7cfb\u5217 media type \u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 `media_type` \u503c\uff08\u5982 `image/*`\u6216`*/*`\uff09\u6765\u6307\u5b9a\u5b83\u5e94\u8be5\u54cd\u5e94\u7684 media type \u3002\r\n\r\n\u5982\u679c\u6ca1\u6709\u660e\u786e\u6307\u5b9a\u6e32\u67d3\u5668\u7684 media type \uff0c\u5219\u5e94\u786e\u4fdd\u5728\u8fd4\u56de\u54cd\u5e94\u65f6\u4f7f\u7528 `content_type` \u5c5e\u6027\u660e\u786e\u6307\u5b9a media type \u3002\u6bd4\u5982\uff1a\r\n\r\n``` python\r\nreturn Response(data, content_type='image/png')\r\n```\r\n\r\n### \u8bbe\u8ba1\u4f60\u7684 media type\r\n\r\n\r\n\u51fa\u4e8e\u8bb8\u591a Web API \u7684\u76ee\u7684\uff0c\u5177\u6709\u8d85\u94fe\u63a5\u5173\u7cfb\u7684\u7b80\u5355 JSON \u54cd\u5e94\u53ef\u80fd\u5c31\u8db3\u591f\u4e86\u3002\u5982\u679c\u4f60\u60f3\u5b8c\u5168\u878d\u5165 RESTful \u8bbe\u8ba1\u548c HATEOAS\uff0c\u5219\u9700\u8981\u66f4\u8be6\u7ec6\u5730\u8003\u8651 media type \u7684\u8bbe\u8ba1\u548c\u4f7f\u7528\u3002\r\n\r\n\r\n### HTML error \u89c6\u56fe\r\n\r\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u65e0\u8bba\u5904\u7406\u5e38\u89c4\u54cd\u5e94\u8fd8\u662f\u5f15\u53d1\u5f02\u5e38\u7684\u54cd\u5e94\uff08\u4f8b\u5982 `Http404` \u6216 `PermissionDenied` \u5f02\u5e38\uff09\u6216 `APIException` \u7684\u5b50\u7c7b\u5f15\u8d77\u7684\u54cd\u5e94\uff0c\u6e32\u67d3\u5668\u90fd\u4f1a\u6709\u76f8\u540c\u7684\u8868\u73b0\u3002\r\n\r\n\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f `TemplateHTMLRenderer` \u6216 `StaticHTMLRenderer`\uff0c\u5e76\u4e14\u5f15\u53d1\u5f02\u5e38\uff0c\u5219\u884c\u4e3a\u4f1a\u7a0d\u6709\u4e0d\u540c\uff0c\u53cd\u6620\u4e86 Django \u5bf9\u9519\u8bef\u89c6\u56fe\u7684\u9ed8\u8ba4\u5904\u7406\u3002\r\n\r\n\u7531 HTML \u6e32\u67d3\u5668\u5f15\u53d1\u548c\u5904\u7406\u7684\u5f02\u5e38\u5c06\u5c1d\u8bd5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u4e4b\u4e00\uff08\u6309\u4f18\u5148\u987a\u5e8f\uff09\u8fdb\u884c\u6e32\u67d3\u3002  \r\n* \u52a0\u8f7d\u5e76\u6e32\u67d3\u6a21\u677f `{status_code}.html`\u3002\r\n* \u52a0\u8f7d\u5e76\u6e32\u67d3\u6a21\u677f `api_exception.html`\u3002\r\n* \u6e32\u67d3 HTTP \u72b6\u6001\u7801\u548c\u6587\u672c\uff0c\u4f8b\u5982 \"404 Not Found\"\u3002\r\n\r\n\u6a21\u677f\u5c06\u4f7f\u7528 `RequestContext` \u8fdb\u884c\u6e32\u67d3\uff0c\u5176\u4e2d\u5305\u542b `status_code` \u548c `details` \u952e\u3002\r\n\r\n> \u6ce8\u610f\uff1a\u5982\u679c `DEBUG = True`\uff0c\u5219\u4f1a\u663e\u793a Django \u7684\u6807\u51c6\u9519\u8bef\u56de\u6eaf\u9875\u9762\uff0c\u800c\u4e0d\u662f\u663e\u793a HTTP \u72b6\u6001\u7801\u548c\u6587\u672c\u3002\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/renderers.md", "create_date": "2020-02-20T13:10:40.647", "order": 8}}, {"model": "subject.chapter", "pk": 154, "fields": {"title": "\u6743\u9650permissions", "topic": 7, "md5": "8320bc887fd429375f3f508f307a59c6", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/permissions/)  \r\n\r\n\r\n# \u6743\u9650\r\n\r\n\r\n\u4e0e authentication \u548c throttling \u4e00\u8d77\uff0cpermission \u51b3\u5b9a\u662f\u5e94\u8be5\u63a5\u53d7\u8fd8\u662f\u62d2\u7edd\u8bbf\u95ee\u8bf7\u6c42\u3002\r\n\r\n\u6743\u9650\u68c0\u67e5\u603b\u662f\u5728\u89c6\u56fe\u7684\u6700\u5f00\u59cb\u5904\u8fd0\u884c\uff0c\u5728\u4efb\u4f55\u5176\u4ed6\u4ee3\u7801\u88ab\u5141\u8bb8\u8fdb\u884c\u4e4b\u524d\u3002\u6743\u9650\u68c0\u67e5\u901a\u5e38\u4f1a\u4f7f\u7528 `request.user` \u548c `request.auth` \u5c5e\u6027\u4e2d\u7684\u8ba4\u8bc1\u4fe1\u606f\u6765\u786e\u5b9a\u662f\u5426\u5141\u8bb8\u4f20\u5165\u8bf7\u6c42\u3002\r\n\r\n\u6743\u9650\u7528\u4e8e\u6388\u4e88\u6216\u62d2\u7edd\u4e0d\u540c\u7c7b\u522b\u7684\u7528\u6237\u8bbf\u95ee API \u7684\u4e0d\u540c\u90e8\u5206\u3002\r\n\r\n\u6700\u7b80\u5355\u7684\u6743\u9650\u662f\u5141\u8bb8\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u8bbf\u95ee\uff0c\u5e76\u62d2\u7edd\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u8bbf\u95ee\u3002\u8fd9\u5bf9\u5e94\u4e8e REST framework \u4e2d\u7684 `IsAuthenticated` \u7c7b\u3002\r\n\r\n\u7a0d\u5fae\u5bbd\u677e\u7684\u6743\u9650\u4f1a\u5141\u8bb8\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u5b8c\u5168\u8bbf\u95ee\uff0c\u800c\u672a\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u53ea\u80fd\u8fdb\u884c\u53ea\u8bfb\u8bbf\u95ee\u3002\u8fd9\u5bf9\u5e94\u4e8e REST framework \u4e2d\u7684 `IsAuthenticatedOrReadOnly` \u7c7b\u3002\r\n\r\n## \u5982\u4f55\u786e\u5b9a\u6743\u9650\r\n\r\nREST framework \u4e2d\u7684\u6743\u9650\u603b\u662f\u88ab\u5b9a\u4e49\u4e3a\u6743\u9650\u7c7b\u7684\u5217\u8868\u3002\r\n\r\n\u5728\u8fd0\u884c\u89c6\u56fe\u7684\u4e3b\u4f53\u4e4b\u524d\uff0c\u68c0\u67e5\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u6743\u9650\u3002\u5982\u679c\u4efb\u4f55\u6743\u9650\u68c0\u67e5\u5931\u8d25\uff0c\u5219\u4f1a\u5f15\u53d1 `exceptions.PermissionDenied` \u6216 `exceptions.NotAuthenticated` \u5f02\u5e38\uff0c\u5e76\u4e14\u89c6\u56fe\u7684\u4e3b\u4f53\u4e0d\u4f1a\u518d\u8fd0\u884c\u3002\r\n\r\n\u5f53\u6743\u9650\u68c0\u67e5\u5931\u8d25\u65f6\uff0c\u6839\u636e\u4ee5\u4e0b\u89c4\u5219\uff0c\u5c06\u8fd4\u56de \u201c403 Forbidden\u201d \u6216 \u201c401 Unauthorized\u201d \u54cd\u5e94\uff1a\r\n\r\n* \u8be5\u8bf7\u6c42\u5df2\u6210\u529f\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4f46\u6743\u9650\u88ab\u62d2\u7edd\u3002 *&mdash; \u5c06\u8fd4\u56de 403 Forbidden \u54cd\u5e94\u3002*\r\n* \u8be5\u8bf7\u6c42\u672a\u6210\u529f\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5e76\u4e14\u6700\u9ad8\u4f18\u5148\u7ea7\u8eab\u4efd\u9a8c\u8bc1\u7c7b\u672a\u6dfb\u52a0 `WWW-Authenticate` header\u3002*&mdash; \u5c06\u8fd4\u56de 403 Forbidden \u54cd\u5e94\u3002*\r\n* \u8be5\u8bf7\u6c42\u672a\u6210\u529f\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4e0d\u8fc7\u6700\u9ad8\u4f18\u5148\u7ea7\u8eab\u4efd\u9a8c\u8bc1\u7c7b\u6dfb\u52a0\u4e86 `WWW-Authenticate` header\u3002*&mdash; \u8fd4\u56de\u4e00\u4e2a HTTP 401 Unauthorized \u54cd\u5e94\uff0c\u5e76\u4f1a\u5e26\u4e0a\u4e00\u4e2a\u9002\u5f53\u7684 `WWW-Authenticate` header\u3002*\r\n\r\n## \u5bf9\u8c61\u7ea7\u6743\u9650\r\n\r\nREST framework \u6743\u9650\u8fd8\u652f\u6301\u5bf9\u8c61\u7ea7\u6743\u9650\u3002\u5bf9\u8c61\u7ea7\u6743\u9650\u7528\u4e8e\u786e\u5b9a\u662f\u5426\u5141\u8bb8\u7528\u6237\u5bf9\u7279\u5b9a\u5bf9\u8c61\u8fdb\u884c\u64cd\u4f5c\uff0c\u8be5\u7279\u5b9a\u5bf9\u8c61\u901a\u5e38\u662f\u6307\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n`.get_object()` \u88ab\u8c03\u7528\u65f6\uff0c\u5bf9\u8c61\u7ea7\u6743\u9650\u7531 REST framework \u7684\u901a\u7528\u89c6\u56fe\u6267\u884c\u3002\u4e0e\u89c6\u56fe\u7ea7\u6743\u9650\u4e00\u6837\uff0c\u5982\u679c\u7528\u6237\u4e0d\u88ab\u5141\u8bb8\u5bf9\u7ed9\u5b9a\u5bf9\u8c61\u8fdb\u884c\u64cd\u4f5c\uff0c\u5219\u4f1a\u5f15\u53d1 `exceptions.PermissionDenied` \u5f02\u5e38\u3002\r\n\r\n\u5982\u679c\u60a8\u6b63\u5728\u7f16\u5199\u81ea\u5df1\u7684\u89c6\u56fe\u5e76\u5e0c\u671b\u5f3a\u5236\u6267\u884c\u5bf9\u8c61\u7ea7\u6743\u9650\uff0c\u6216\u8005\u5982\u679c\u60a8\u5728\u901a\u7528\u89c6\u56fe\u4e0a\u91cd\u5199\u4e86 `get_object` \u65b9\u6cd5\uff0c\u90a3\u4e48\u5c06\u9700\u8981\u663e\u5f0f\u5730\u5728\u4f60\u68c0\u7d22\u8be5\u5bf9\u8c61\u65f6\u8c03\u7528 `.check_object_permissions(request, obj)` \u65b9\u6cd5\u3002\r\n\r\n\u8fd9\u5c06\u5f15\u53d1 `PermissionDenied` \u6216 `NotAuthenticated` \u5f02\u5e38\uff0c\u6216\u8005\u53ea\u662f\u5728\u89c6\u56fe\u5177\u6709\u9002\u5f53\u7684\u6743\u9650\u65f6\u624d\u8fd4\u56de\u3002\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\ndef get_object(self):\r\n    obj = get_object_or_404(self.get_queryset(), pk=self.kwargs[\"pk\"])\r\n    self.check_object_permissions(self.request, obj)\r\n    return obj\r\n```\r\n\r\n#### \u5bf9\u8c61\u7ea7\u6743\u9650\u7684\u9650\u5236\r\n\r\n\u51fa\u4e8e\u6027\u80fd\u539f\u56e0\uff0c\u901a\u7528\u89c6\u56fe\u5728\u8fd4\u56de\u5bf9\u8c61\u5217\u8868\u65f6\u4e0d\u4f1a\u81ea\u52a8\u5c06\u5bf9\u8c61\u7ea7\u6743\u9650\u5e94\u7528\u4e8e\u67e5\u8be2\u96c6\u4e2d\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u3002\r\n\r\n\u901a\u5e38\uff0c\u5f53\u60a8\u4f7f\u7528\u5bf9\u8c61\u7ea7\u6743\u9650\u65f6\uff0c\u60a8\u8fd8\u9700\u8981\u9002\u5f53\u5730\u8fc7\u6ee4\u67e5\u8be2\u96c6\uff0c\u4ee5\u786e\u4fdd\u7528\u6237\u53ea\u80fd\u770b\u5230\u4ed6\u4eec\u88ab\u5141\u8bb8\u67e5\u770b\u7684\u5b9e\u4f8b\u3002\r\n\r\n## \u8bbe\u7f6e\u6743\u9650\u7b56\u7565\r\n\r\n\u9ed8\u8ba4\u6743\u9650\u7b56\u7565\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_PERMISSION_CLASSES` setting \u5168\u5c40\u8bbe\u7f6e\u3002\u4f8b\u5982\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PERMISSION_CLASSES': (\r\n        'rest_framework.permissions.IsAuthenticated',\r\n    )\r\n}\r\n```\r\n\r\n\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5219\u6b64\u8bbe\u7f6e\u9ed8\u8ba4\u4e3a\u5141\u8bb8\u65e0\u9650\u5236\u8bbf\u95ee\uff1a\r\n\r\n``` python\r\n'DEFAULT_PERMISSION_CLASSES': (\r\n   'rest_framework.permissions.AllowAny',\r\n)\r\n```\r\n\r\n\u60a8\u8fd8\u53ef\u4ee5\u5728\u57fa\u4e8e `APIView` \u7c7b\u7684\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u8eab\u4efd\u9a8c\u8bc1\u7b56\u7565\u3002\r\n\r\n``` python\r\nfrom rest_framework.permissions import IsAuthenticated\r\nfrom rest_framework.response import Response\r\nfrom rest_framework.views import APIView\r\n\r\nclass ExampleView(APIView):\r\n    permission_classes = (IsAuthenticated,)\r\n\r\n    def get(self, request, format=None):\r\n        content = {\r\n            'status': 'request was permitted'\r\n        }\r\n        return Response(content)\r\n```\r\n\r\n\u6216\u8005\u5728\u57fa\u4e8e `@api_view` \u88c5\u9970\u5668\u7684\u51fd\u6570\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u3002\r\n\r\n``` python\r\nfrom rest_framework.decorators import api_view, permission_classes\r\nfrom rest_framework.permissions import IsAuthenticated\r\nfrom rest_framework.response import Response\r\n\r\n@api_view(['GET'])\r\n@permission_classes((IsAuthenticated, ))\r\ndef example_view(request, format=None):\r\n    content = {\r\n        'status': 'request was permitted'\r\n    }\r\n    return Response(content)\r\n```\r\n\r\n__\u6ce8\u610f\uff1a__ \u5f53\u4f60\u901a\u8fc7\u7c7b\u5c5e\u6027\u6216\u88c5\u9970\u5668\u8bbe\u7f6e\u65b0\u7684\u6743\u9650\u7c7b\u65f6\uff0c`settings.py` \u6587\u4ef6\u4e2d\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u4f1a\u88ab\u5ffd\u7565\u3002\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## AllowAny\r\n\r\n`AllowAny` \u6743\u9650\u7c7b\u5c06\u5141\u8bb8\u4e0d\u53d7\u9650\u5236\u7684\u8bbf\u95ee\uff0c\u800c\u4e0d\u7ba1\u8be5\u8bf7\u6c42\u662f\u5426\u5df2\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u6216\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u3002\r\n\r\n\u4e5f\u4e0d\u4e00\u5b9a\u975e\u8981\u7528\u6b64\u6743\u9650\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e3a\u6743\u9650\u8bbe\u7f6e\u7a7a\u5217\u8868\u6216\u5143\u7ec4\u6765\u5b9e\u73b0\u76f8\u540c\u7684\u7ed3\u679c\uff0c\u4f46\u662f\u4f60\u4f1a\u53d1\u73b0\uff0c\u4f7f\u7528\u6b64\u6743\u9650\u4f7f\u610f\u56fe\u66f4\u52a0\u6e05\u6670\u3002\r\n\r\n## IsAuthenticated\r\n\r\n`IsAuthenticated` \u6743\u9650\u7c7b\u5c06\u62d2\u7edd\u4efb\u4f55\u672a\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u7684\u8bbf\u95ee\u3002\r\n\r\n \u5982\u679c\u4f60\u5e0c\u671b API \u53ea\u80fd\u7531\u6ce8\u518c\u7528\u6237\u8bbf\u95ee\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6b64\u6743\u9650\u3002\r\n\r\n## IsAdminUser\r\n\r\n`IsAdminUser` \u6743\u9650\u4ec5\u5141\u8bb8 `user.is_staff` \u4e3a `True` \u7528\u6237\u8bbf\u95ee\uff0c\u5176\u4ed6\u4efb\u4f55\u7528\u6237\u90fd\u5c06\u88ab\u62d2\u7edd\u3002\r\n\r\n\u5982\u679c\u4f60\u5e0c\u671b API \u53ea\u80fd\u88ab\u90e8\u5206\u53d7\u4fe1\u4efb\u7684\u7ba1\u7406\u5458\u8bbf\u95ee\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6b64\u6743\u9650\u3002\r\n\r\n## IsAuthenticatedOrReadOnly\r\n\r\n`IsAuthenticatedOrReadOnly` \u5141\u8bb8\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u6267\u884c\u4efb\u4f55\u8bf7\u6c42\u3002\u672a\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u53ea\u80fd\u8bf7\u6c42 \u201c\u5b89\u5168\u201d \u7684\u65b9\u6cd5\uff1a `GET`\uff0c `HEAD` \u6216 `OPTIONS`\u3002\r\n\r\n\u5982\u679c\u4f60\u5e0c\u671b API \u5141\u8bb8\u533f\u540d\u7528\u6237\u62e5\u6709\u8bfb\u53d6\u6743\u9650\uff0c\u5e76\u4e14\u53ea\u5141\u8bb8\u5bf9\u5df2\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u6267\u884c\u5199\u5165\u6743\u9650\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6b64\u6743\u9650\u3002\r\n\r\n## DjangoModelPermissions\r\n\r\n\u6b64\u6743\u9650\u7c7b\u4e0e Django \u7684\u6807\u51c6 `django.contrib.auth` \u6a21\u578b\u6743\u9650\u7ed1\u5b9a\u3002\u6b64\u6743\u9650\u53ea\u80fd\u5e94\u7528\u4e8e\u5177\u6709 `.queryset` \u5c5e\u6027\u96c6\u7684\u89c6\u56fe\u3002\u53ea\u6709\u5728\u7528\u6237\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u5e76\u5206\u914d\u4e86\u76f8\u5173\u6a21\u578b\u6743\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u6709\u6743\u9650\u8bbf\u95ee\u3002\r\n\r\n* `POST` \u8bf7\u6c42\u8981\u6c42\u7528\u6237\u5728\u6a21\u578b\u4e0a\u5177\u6709 `add` \u6743\u9650\u3002\r\n* `PUT` \u548c `PATCH` \u8bf7\u6c42\u8981\u6c42\u7528\u6237\u5728\u6a21\u578b\u4e0a\u5177\u6709 `change` \u6743\u9650\u3002\r\n* `DELETE` \u8bf7\u6c42\u8981\u6c42\u7528\u6237\u5728\u6a21\u578b\u4e0a\u5177\u6709 `delete` \u6743\u9650\u3002\r\n\r\n\u9ed8\u8ba4\u884c\u4e3a\u4e5f\u53ef\u4ee5\u88ab\u91cd\u5199\u4ee5\u652f\u6301\u81ea\u5b9a\u4e49\u6a21\u578b\u6743\u9650\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u80fd\u60f3\u8981\u5305\u542b GET \u8bf7\u6c42\u7684 `view` \u6a21\u578b\u6743\u9650\u3002\r\n\r\n\u8981\u81ea\u5b9a\u4e49\u6a21\u578b\u6743\u9650\uff0c\u8bf7\u7ee7\u627f `DjangoModelPermissions` \u5e76\u8bbe\u7f6e `.perms_map` \u5c5e\u6027\u3002\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6e90\u4ee3\u7801\u3002\r\n\r\n#### \u4f7f\u7528\u4e0d\u5305\u542b `queryset` \u5c5e\u6027\u7684\u89c6\u56fe\u3002\r\n\r\n\u5982\u679c\u4f60\u5c06\u6b64\u6743\u9650\u4e0e\u91cd\u5199 `get_queryset()` \u65b9\u6cd5\u7684\u89c6\u56fe\u4e00\u8d77\u4f7f\u7528\uff0c\u5219\u89c6\u56fe\u4e0a\u53ef\u80fd\u6ca1\u6709 `queryset` \u5c5e\u6027\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 sentinel \u67e5\u8be2\u96c6\u6807\u8bb0\u89c6\u56fe\uff0c\u4ee5\u4fbf\u6b64\u7c7b\u53ef\u4ee5\u786e\u5b9a\u6240\u9700\u7684\u6743\u9650\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nqueryset = User.objects.none()  # Required for DjangoModelPermissions\r\n```\r\n\r\n## DjangoModelPermissionsOrAnonReadOnly\r\n\r\n\u4e0e `DjangoModelPermissions` \u7c7b\u4f3c\uff0c\u4f46\u4e5f\u5141\u8bb8\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u5bf9 API \u8fdb\u884c\u53ea\u8bfb\u8bbf\u95ee\u3002\r\n\r\n## DjangoObjectPermissions\r\n\r\n\u8be5\u6743\u9650\u7c7b\u4e0e Django \u7684\u6807\u51c6\u5bf9\u8c61\u6743\u9650\u6846\u67b6\u7ed1\u5b9a\uff0c\u8be5\u6846\u67b6\u5141\u8bb8\u5bf9\u6bcf\u4e2a\u6a21\u578b\u5bf9\u8c61\u8fdb\u884c\u6743\u9650\u9a8c\u8bc1\u3002\u4e3a\u4e86\u4f7f\u7528\u6b64\u6743\u9650\u7c7b\uff0c\u4f60\u8fd8\u9700\u8981\u6dfb\u52a0\u652f\u6301\u5bf9\u8c61\u7ea7\u6743\u9650\u7684\u6743\u9650\u540e\u7aef\uff0c\u4f8b\u5982 [django-guardian](https://github.com/lukaszb/django-guardian)\u3002\r\n\r\n\u4e0e `DjangoModelPermissions` \u4e00\u6837\uff0c\u6b64\u6743\u9650\u53ea\u80fd\u5e94\u7528\u4e8e\u5177\u6709 `.queryset` \u5c5e\u6027\u6216 `.get_queryset()` \u65b9\u6cd5\u7684\u89c6\u56fe\u3002\u53ea\u6709\u5728\u7528\u6237\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u5e76\u4e14\u5177\u6709\u76f8\u5173\u7684\u6bcf\u4e2a\u5bf9\u8c61\u6743\u9650\u548c\u76f8\u5173\u7684\u6a21\u578b\u6743\u9650\u540e\uff0c\u624d\u6709\u6743\u9650\u8bbf\u95ee\u3002\r\n\r\n* `POST` \u8bf7\u6c42\u8981\u6c42\u7528\u6237\u5bf9\u6a21\u578b\u5b9e\u4f8b\u5177\u6709 `add` \u6743\u9650\u3002\r\n* `PUT` \u548c `PATCH` \u8bf7\u6c42\u8981\u6c42\u7528\u6237\u5bf9\u6a21\u578b\u5b9e\u4f8b\u5177\u6709 `change` \u6743\u9650\u3002\r\n* `DELETE` \u8bf7\u6c42\u8981\u6c42\u7528\u6237\u5bf9\u6a21\u578b\u5b9e\u4f8b\u5177\u6709 `delete` \u6743\u9650\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c`DjangoObjectPermissions` \u4e0d\u9700\u8981 `django-guardian` \u8f6f\u4ef6\u5305\uff0c\u5e76\u4e14\u540c\u6837\u652f\u6301\u5176\u4ed6\u5bf9\u8c61\u7ea7\u522b\u7684\u540e\u7aef\u3002\r\n\r\n\u4e0e `DjangoModelPermissions` \u4e00\u6837\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f `DjangoObjectPermissions` \u5e76\u8bbe\u7f6e `.perms_map` \u5c5e\u6027\u6765\u81ea\u5b9a\u4e49\u6a21\u578b\u6743\u9650\u3002\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6e90\u4ee3\u7801\u3002\r\n\r\n---\r\n\r\n**\u6ce8\u610f**: \u5982\u679c\u4f60\u9700\u8981\u83b7\u53d6 `GET`\uff0c`HEAD` \u548c `OPTIONS` \u8bf7\u6c42\u7684\u5bf9\u8c61\u7ea7 `view` \u6743\u9650\uff0c\u5219\u8fd8\u9700\u8981\u8003\u8651\u6dfb\u52a0 `DjangoObjectPermissionsFilter` \u7c7b\uff0c\u4ee5\u786e\u4fdd\u5217\u8868\u7aef\u70b9\u53ea\u8fd4\u56de\u5305\u542b\u7528\u6237\u5177\u6709\u67e5\u770b\u6743\u9650\u7684\u5bf9\u8c61\u7684\u7ed3\u679c\u3002\r\n\r\n---\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u6743\u9650\r\n\r\n\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6743\u9650\uff0c\u8bf7\u7ee7\u627f `BasePermission` \u5e76\u5b9e\u73b0\u4ee5\u4e0b\u65b9\u6cd5\u4e2d\u7684\u4e00\u4e2a\u6216\u4e24\u4e2a\uff1a\r\n\r\n* `.has_permission(self, request, view)`\r\n* `.has_object_permission(self, request, view, obj)`\r\n\r\n\u5982\u679c\u8bf7\u6c42\u88ab\u6388\u4e88\u8bbf\u95ee\u6743\u9650\uff0c\u5219\u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de `True`\uff0c\u5426\u5219\u8fd4\u56de `False`\u3002\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u6d4b\u8bd5\u4e00\u4e2a\u8bf7\u6c42\u662f\u4e00\u4e2a\u8bfb\u64cd\u4f5c\u8fd8\u662f\u4e00\u4e2a\u5199\u64cd\u4f5c\uff0c\u4f60\u5e94\u8be5\u6839\u636e\u5e38\u91cf `SAFE_METHODS` \u68c0\u67e5\u8bf7\u6c42\u65b9\u6cd5\uff0c `SAFE_METHODS` \u662f\u4e00\u4e2a\u5305\u542b `'GET'`\uff0c`'OPTIONS'` \u548c `'HEAD'` \u7684\u5143\u7ec4\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nif request.method in permissions.SAFE_METHODS:\r\n    # Check permissions for read-only request\r\nelse:\r\n    # Check permissions for write request\r\n```\r\n\r\n---\r\n\r\n**Note**: \u53ea\u6709\u5728\u89c6\u56fe\u7ea7\u522b `has_permission` \u68c0\u67e5\u5df2\u901a\u8fc7\u65f6\u624d\u4f1a\u8c03\u7528\u5b9e\u4f8b\u7ea7\u522b\u7684 `has_object_permission` \u65b9\u6cd5\u3002\u8fd8\u8981\u6ce8\u610f\uff0c\u4e3a\u4e86\u8fd0\u884c\u5b9e\u4f8b\u7ea7\u68c0\u67e5\uff0c\u89c6\u56fe\u4ee3\u7801\u5e94\u8be5\u663e\u5f0f\u8c03\u7528 `.check_object_permissions(request, obj)`\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u901a\u7528\u89c6\u56fe\uff0c\u90a3\u4e48\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u4e3a\u60a8\u5904\u7406\u3002\uff08\u57fa\u4e8e\u51fd\u6570\u7684\u89c6\u56fe\u5c06\u9700\u8981\u660e\u786e\u68c0\u67e5\u5bf9\u8c61\u6743\u9650\uff0c\u5728\u5931\u8d25\u65f6\u5f15\u53d1 `PermissionDenied`\u3002\uff09\r\n\r\n---\r\n\r\n\u5982\u679c\u6d4b\u8bd5\u5931\u8d25\uff0c\u81ea\u5b9a\u4e49\u6743\u9650\u5c06\u5f15\u53d1 `PermissionDenied` \u5f02\u5e38\u3002\u8981\u66f4\u6539\u4e0e\u5f02\u5e38\u76f8\u5173\u7684\u9519\u8bef\u6d88\u606f\uff0c\u8bf7\u76f4\u63a5\u5728\u4f60\u7684\u81ea\u5b9a\u4e49\u6743\u9650\u4e0a\u5b9e\u73b0 `message` \u5c5e\u6027\u3002\u5426\u5219\u5c06\u4f7f\u7528 `PermissionDenied` \u7684 `default_detail` \u5c5e\u6027\u3002\r\n\r\n``` python\r\nfrom rest_framework import permissions\r\n\r\nclass CustomerAccessPermission(permissions.BasePermission):\r\n    message = 'Adding customers not allowed.'\r\n\r\n    def has_permission(self, request, view):\r\n         ...\r\n```\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4ee5\u4e0b\u662f\u4e00\u4e2a\u6743\u9650\u7c7b\u7684\u793a\u4f8b\uff0c\u8be5\u6743\u9650\u7c7b\u5c06\u4f20\u5165\u8bf7\u6c42\u7684 IP \u5730\u5740\u4e0e\u9ed1\u540d\u5355\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5e76\u5728 IP \u88ab\u5217\u5165\u9ed1\u540d\u5355\u65f6\u62d2\u7edd\u8be5\u8bf7\u6c42\u3002\r\n\r\n``` python\r\nfrom rest_framework import permissions\r\n\r\nclass BlacklistPermission(permissions.BasePermission):\r\n    \"\"\"\r\n    Global permission check for blacklisted IPs.\r\n    \"\"\"\r\n\r\n    def has_permission(self, request, view):\r\n        ip_addr = request.META['REMOTE_ADDR']\r\n        blacklisted = Blacklist.objects.filter(ip_addr=ip_addr).exists()\r\n        return not blacklisted\r\n```\r\n\r\n\u9664\u4e86\u9488\u5bf9\u6240\u6709\u4f20\u5165\u8bf7\u6c42\u8fd0\u884c\u7684\u5168\u5c40\u6743\u9650\uff0c\u8fd8\u53ef\u4ee5\u521b\u5efa\u5bf9\u8c61\u7ea7\u6743\u9650\uff0c\u8fd9\u4e9b\u6743\u9650\u4ec5\u9488\u5bf9\u5f71\u54cd\u7279\u5b9a\u5bf9\u8c61\u5b9e\u4f8b\u7684\u64cd\u4f5c\u6267\u884c\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass IsOwnerOrReadOnly(permissions.BasePermission):\r\n    \"\"\"\r\n    Object-level permission to only allow owners of an object to edit it.\r\n    Assumes the model instance has an `owner` attribute.\r\n    \"\"\"\r\n\r\n    def has_object_permission(self, request, view, obj):\r\n        # Read permissions are allowed to any request,\r\n        # so we'll always allow GET, HEAD or OPTIONS requests.\r\n        if request.method in permissions.SAFE_METHODS:\r\n            return True\r\n\r\n        # Instance must have an attribute named `owner`.\r\n        return obj.owner == request.user\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u901a\u7528\u89c6\u56fe\u5c06\u68c0\u67e5\u9002\u5f53\u7684\u5bf9\u8c61\u7ea7\u6743\u9650\uff0c\u4f46\u5982\u679c\u4f60\u6b63\u5728\u7f16\u5199\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49\u89c6\u56fe\uff0c\u5219\u9700\u8981\u786e\u4fdd\u68c0\u67e5\u81ea\u5df1\u7684\u5bf9\u8c61\u7ea7\u6743\u9650\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u62e5\u6709\u5bf9\u8c61\u5b9e\u4f8b\u540e\u4ece\u89c6\u56fe\u4e2d\u8c03\u7528 `self.check_object_permissions(request, obj)` \u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002\u5982\u679c\u4efb\u4f55\u5bf9\u8c61\u7ea7\u6743\u9650\u68c0\u67e5\u5931\u8d25\uff0c\u6b64\u8c03\u7528\u5c06\u5f15\u53d1\u9002\u5f53\u7684 `APIException`\uff0c\u5426\u5219\u5c06\u7b80\u5355\u5730\u8fd4\u56de\u3002\r\n\r\n\u53e6\u8bf7\u6ce8\u610f\uff0c\u901a\u7528\u89c6\u56fe\u5c06\u4ec5\u68c0\u67e5\u5355\u4e2a\u6a21\u578b\u5b9e\u4f8b\u7684\u89c6\u56fe\u7684\u5bf9\u8c61\u7ea7\u6743\u9650\u3002\u5982\u679c\u4f60\u9700\u8981\u5217\u8868\u89c6\u56fe\u7684\u5bf9\u8c61\u7ea7\u8fc7\u6ee4\uff0c\u5219\u9700\u8981\u5355\u72ec\u8fc7\u6ee4\u67e5\u8be2\u96c6\u3002\r\n", "md_File": "subject/django-rest-framework-api-guide/permissions.md", "create_date": "2020-02-20T13:10:40.664", "order": 14}}, {"model": "subject.chapter", "pk": 155, "fields": {"title": "\u89e3\u6790parsers", "topic": 7, "md5": "759aa1c8a7d14c08fb8046be15381ae1", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/parsers/)\r\n\r\n\r\n## \u89e3\u6790\u5668\r\n\r\nREST framework \u5305\u542b\u8bb8\u591a\u5185\u7f6e\u7684\u89e3\u6790\u5668\u7c7b\uff0c\u5141\u8bb8\u63a5\u53d7\u5404\u79cd\u5a92\u4f53\u7c7b\u578b\uff08media types\uff09\u7684\u8bf7\u6c42\u3002\u8fd8\u652f\u6301\u81ea\u5b9a\u4e49\u89e3\u6790\u5668\uff0c\u8fd9\u4f7f\u4f60\u53ef\u4ee5\u7075\u6d3b\u5730\u8bbe\u8ba1 API \u63a5\u53d7\u7684\u5a92\u4f53\u7c7b\u578b\u3002\r\n\r\n### \u5982\u4f55\u786e\u5b9a\u4f7f\u7528\u54ea\u4e2a\u89e3\u6790\u5668\r\n\r\n\u89c6\u56fe\u7684\u6709\u6548\u89e3\u6790\u5668\u96c6\u59cb\u7ec8\u5b9a\u4e49\u4e3a\u7c7b\u5217\u8868\u3002\u5f53\u8bbf\u95ee `request.data` \u65f6\uff0cREST framework \u5c06\u68c0\u67e5\u4f20\u5165\u8bf7\u6c42\u7684 `Content-Type` \uff0c\u5e76\u786e\u5b9a\u4f7f\u7528\u54ea\u4e2a\u89e3\u6790\u5668\u6765\u89e3\u6790\u8bf7\u6c42\u5185\u5bb9\u3002\r\n\r\n> **\u6ce8\u610f**\uff1a\u5728\u5f00\u53d1\u5ba2\u6237\u7aef\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u8bf7\u52a1\u5fc5\u786e\u4fdd\u5728 HTTP \u8bf7\u6c42\u4e2d\u53d1\u9001\u6570\u636e\u65f6\u8bbe\u7f6e\u4e86 `Content-Type` \u3002  \r\n> \u5982\u679c\u4f60\u4e0d\u8bbe\u7f6e content type\uff0c\u5927\u591a\u6570\u5ba2\u6237\u7aef\u5c06\u9ed8\u8ba4\u4f7f\u7528 `'application / x-www-form-urlencoded'` \uff0c\u8fd9\u53ef\u80fd\u4e0d\u662f\u4f60\u60f3\u8981\u7684\u3002\r\n> \u4f8b\u5982\uff0c\u5982\u679c\u4f60\u4f7f\u7528 jQuery \u548c `.ajax()` \u65b9\u6cd5\u53d1\u9001 `json` \u6570\u636e\uff0c\u5219\u5e94\u786e\u4fdd\u5305\u542b `contentType:'application/json'` \u8bbe\u7f6e\u3002\r\n\r\n### \u8bbe\u7f6e\u89e3\u6790\u5668\r\n\r\n\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_PARSER_CLASSES` \u8bbe\u7f6e\u9ed8\u8ba4\u7684\u5168\u5c40\u89e3\u6790\u5668\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8bbe\u7f6e\u5c06\u53ea\u5141\u8bb8\u5e26\u6709 `JSON` \u5185\u5bb9\u7684\u8bf7\u6c42\uff0c\u800c\u4e0d\u662f\u9ed8\u8ba4\u7684 JSON \u6216\u8868\u5355\u6570\u636e\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PARSER_CLASSES': (\r\n        'rest_framework.parsers.JSONParser',\r\n    )\r\n}\r\n```\r\n\r\n\u8fd8\u53ef\u4ee5\u5728\u57fa\u4e8e\u7c7b\uff08`API\u200b\u200bView` \uff09\u7684\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u5355\u4e2a\u89c6\u56fe\u6216\u89c6\u56fe\u96c6\u7684\u89e3\u6790\u5668\u3002\r\n\r\n``` python\r\nfrom rest_framework.parsers import JSONParser\r\nfrom rest_framework.response import Response\r\nfrom rest_framework.views import APIView\r\n\r\nclass ExampleView(APIView):\r\n    \"\"\"\r\n    A view that can accept POST requests with JSON content.\r\n    \"\"\"\r\n    parser_classes = (JSONParser,)\r\n\r\n    def post(self, request, format=None):\r\n        return Response({'received data': request.data})\r\n```\r\n\r\n\u6216\u8005\u548c `@api_view` \u88c5\u9970\u5668\u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n```python\r\nfrom rest_framework.decorators import api_view\r\nfrom rest_framework.decorators import parser_classes\r\nfrom rest_framework.parsers import JSONParser\r\n\r\n@api_view(['POST'])\r\n@parser_classes((JSONParser,))\r\ndef example_view(request, format=None):\r\n    \"\"\"\r\n    A view that can accept POST requests with JSON content.\r\n    \"\"\"\r\n    return Response({'received data': request.data})\r\n```\r\n\r\n## API \u53c2\u8003\r\n\r\n\r\n### JSONParser\r\n\r\n\u89e3\u6790 JSON \u8bf7\u6c42\u5185\u5bb9\u3002\r\n\r\n**.media_type**\uff1a `application/json`\r\n\r\n\r\n\r\n### FormParser\r\n\r\n\u89e3\u6790 HTML \u8868\u5355\u5185\u5bb9\u3002`request.data` \u662f\u4e00\u4e2a `QueryDict` \u5b57\u5178\uff0c\u5305\u542b\u6240\u6709\u8868\u5355\u53c2\u6570\u3002  \r\n\r\n\u901a\u5e38\u9700\u8981\u540c\u65f6\u4f7f\u7528 `FormParser` \u548c `MultiPartParser`\uff0c\u4ee5\u5b8c\u5168\u652f\u6301 HTML \u8868\u5355\u6570\u636e\u3002\r\n\r\n**.media_type**\uff1a `application/x-www-form-urlencoded`\r\n\r\n\r\n### MultiPartParser\r\n\r\n\u89e3\u6790\u6587\u4ef6\u4e0a\u4f20\u7684 multipart  HTML \u8868\u5355\u5185\u5bb9\u3002 `request.data` \u662f\u4e00\u4e2a `QueryDict`\uff08\u5176\u4e2d\u5305\u542b\u8868\u5355\u53c2\u6570\u548c\u6587\u4ef6\uff09\u3002\r\n\r\n\r\n\r\n\u901a\u5e38\u9700\u8981\u540c\u65f6\u4f7f\u7528 `FormParser` \u548c `MultiPartParser`\uff0c\u4ee5\u5b8c\u5168\u652f\u6301 HTML \u8868\u5355\u6570\u636e\u3002\r\n\r\n**.media_type**\uff1a `application/form-data`\r\n\r\n\r\n### FileUploadParser\r\n\r\n\u89e3\u6790\u6587\u4ef6\u4e0a\u4f20\u5185\u5bb9\u3002  `request.data` \u662f\u4e00\u4e2a `QueryDict` \uff08\u53ea\u5305\u542b\u4e00\u4e2a\u5b58\u6709\u6587\u4ef6\u7684 `'file'` key\uff09\u3002\r\n\r\n\r\n\u5982\u679c\u4e0e `FileUploadParser` \u4e00\u8d77\u4f7f\u7528\u7684\u89c6\u56fe\u662f\u7528 `filename` URL \u5173\u952e\u5b57\u53c2\u6570\u8c03\u7528\u7684\uff0c\u90a3\u4e48\u8be5\u53c2\u6570\u5c06\u7528\u4f5c\u6587\u4ef6\u540d\u3002\r\n\r\n\u5982\u679c\u5728\u6ca1\u6709 `filename` URL \u5173\u952e\u5b57\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u8c03\u7528\uff0c\u5219\u5ba2\u6237\u7aef\u5fc5\u987b\u5728 `Content-Disposition` HTTP header \u4e2d\u8bbe\u7f6e\u6587\u4ef6\u540d\u3002\u4f8b\u5982 `Content-Disposition: attachment; filename=upload.jpg`\u3002\r\n\r\n**.media_type**\uff1a `*/*`\r\n\r\n\u8bf7\u6ce8\u610f\uff1a\r\n* `FileUploadParser` \u7528\u4e8e\u672c\u5730\u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u5c06\u6587\u4ef6\u4f5c\u4e3a\u539f\u59cb\u6570\u636e\u8bf7\u6c42\u4e0a\u4f20\u3002\u5bf9\u4e8e\u57fa\u4e8e Web \u7684\u4e0a\u4f20\uff0c\u6216\u8005\u5bf9\u4e8e\u5177\u6709\u5206\u6bb5\u4e0a\u4f20\u652f\u6301\u7684\u672c\u5730\u5ba2\u6237\u7aef\uff0c\u60a8\u5e94\u8be5\u4f7f\u7528 `MultiPartParser` \u89e3\u6790\u5668\u3002\r\n* \u7531\u4e8e\u6b64\u89e3\u6790\u5668\u7684 `media_type` \u4e0e\u4efb\u4f55 content type \u90fd\u5339\u914d\uff0c\u56e0\u6b64 `FileUploadParser` \u901a\u5e38\u5e94\u8be5\u662f\u5728 API \u89c6\u56fe\u4e0a\u8bbe\u7f6e\u7684\u552f\u4e00\u89e3\u6790\u5668\u3002\r\n* `FileUploadParser` \u9075\u5faa Django \u7684\u6807\u51c6 `FILE_UPLOAD_HANDLERS` \u8bbe\u7f6e\u548c `request.upload_handlers` \u5c5e\u6027\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Django \u6587\u6863\u3002\r\n\r\n\u57fa\u672c\u7528\u6cd5\u793a\u4f8b\uff1a\r\n\r\n``` python\r\n# views.py\r\nclass FileUploadView(views.APIView):\r\n    parser_classes = (FileUploadParser,)\r\n\r\n    def put(self, request, filename, format=None):\r\n        file_obj = request.data['file']\r\n        # ...\r\n        # do some stuff with uploaded file\r\n        # ...\r\n        return Response(status=204)\r\n\r\n# urls.py\r\nurlpatterns = [\r\n    # ...\r\n    url(r'^upload/(?P<filename>[^/]+)$', FileUploadView.as_view())\r\n]\r\n```\r\n\r\n\r\n\r\n## \u81ea\u5b9a\u4e49\u89e3\u6790\r\n\r\n\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u89e3\u6790\u5668\uff0c\u5e94\u8be5\u7ee7\u627f `BaseParser`\uff0c\u8bbe\u7f6e `.media_type` \u5c5e\u6027\u5e76\u5b9e\u73b0 `.parse(self,stream,media_type,parser_context)` \u65b9\u6cd5\u3002\r\n\r\n\r\n\u8be5\u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de\u5c06\u7528\u4e8e\u586b\u5145 `request.data` \u5c5e\u6027\u7684\u6570\u636e\u3002\r\n\r\n\r\n\u4f20\u9012\u7ed9 `.parse()` \u7684\u53c2\u6570\u662f\uff1a\r\n\r\n### stream\r\n\r\n\u8868\u793a\u8bf7\u6c42\u6b63\u6587\u7684\u6d41\u5f0f\u5bf9\u8c61\u3002\r\n\r\n### media_type\r\n\r\n\u53ef\u9009\u3002\u5982\u679c\u63d0\u4f9b\uff0c\u5219\u8fd9\u662f\u4f20\u5165\u8bf7\u6c42\u5185\u5bb9\u7684 media type\u3002\r\n\r\n\u6839\u636e\u8bf7\u6c42\u7684 `Content-Type:` header\uff0c\u53ef\u4ee5\u6bd4\u6e32\u67d3\u5668\u7684 `media_type` \u5c5e\u6027\u66f4\u5177\u4f53\uff0c\u5e76\u4e14\u53ef\u80fd\u5305\u542b media type \u53c2\u6570\u3002\u6bd4\u5982 `\"text/plain; charset=utf-8\"` \u3002\r\n\r\n### parser_context\r\n\r\n\u53ef\u9009\u3002\u5982\u679c\u63d0\u4f9b\uff0c\u5219\u8be5\u53c2\u6570\u5c06\u662f\u4e00\u4e2a\u5305\u542b\u89e3\u6790\u8bf7\u6c42\u5185\u5bb9\u53ef\u80fd\u9700\u8981\u7684\u4efb\u4f55\u5176\u4ed6\u4e0a\u4e0b\u6587\u7684\u5b57\u5178\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5c06\u5305\u62ec\u4ee5\u4e0b key\uff1a`view`\uff0c`request`\uff0c`args`\uff0c`kwargs`\u3002\r\n\r\n\r\n\r\n### \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\u7eaf\u6587\u672c\u89e3\u6790\u5668\uff0c\u5b83\u5c06\u4f7f\u7528\u8868\u793a\u8bf7\u6c42\u6b63\u6587\u7684\u5b57\u7b26\u4e32\u586b\u5145 `request.data` \u5c5e\u6027\u3002\r\n\r\n``` python\r\nclass PlainTextParser(BaseParser):\r\n    \"\"\"\r\n    Plain text parser.\r\n    \"\"\"\r\n    media_type = 'text/plain'\r\n\r\n    def parse(self, stream, media_type=None, parser_context=None):\r\n        \"\"\"\r\n        Simply return a string representing the body of the request.\r\n        \"\"\"\r\n        return stream.read()\r\n```\r\n\r\n\r\n## \u7b2c\u4e09\u65b9\u5305\r\n\r\n\u4ee5\u4e0b\u662f\u53ef\u7528\u7684\u7b2c\u4e09\u65b9\u5305\u3002\r\n\r\n\r\n### YAML\r\n\r\n[REST framework YAML](https://jpadilla.github.io/django-rest-framework-yaml/) \u63d0\u4f9b YAML \u89e3\u6790\u548c\u6e32\u67d3\u652f\u6301\u3002\u5b83\u4ee5\u524d\u76f4\u63a5\u5305\u542b\u5728 REST framework \u5305\u4e2d\uff0c\u73b0\u5728\u4f5c\u4e3a\u7b2c\u4e09\u65b9\u5305\u3002\r\n\r\n#### \u5b89\u88c5\u548c\u914d\u7f6e\r\n\r\n\u4f7f\u7528pip\u5b89\u88c5\u3002\r\n\r\n``` bash\r\n$ pip install djangorestframework-yaml\r\n```\r\n\r\n\u4fee\u6539 REST framework settings\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PARSER_CLASSES': (\r\n        'rest_framework_yaml.parsers.YAMLParser',\r\n    ),\r\n    'DEFAULT_RENDERER_CLASSES': (\r\n        'rest_framework_yaml.renderers.YAMLRenderer',\r\n    ),\r\n}\r\n```\r\n\r\n### XML\r\n\r\n[REST Framework XML](https://jpadilla.github.io/django-rest-framework-xml/) \u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u975e\u6b63\u5f0f XML \u683c\u5f0f\u3002\u5b83\u4ee5\u524d\u76f4\u63a5\u5305\u542b\u5728 REST framework \u5305\u4e2d\uff0c\u73b0\u5728\u4f5c\u4e3a\u7b2c\u4e09\u65b9\u5305\u3002\r\n\r\n\r\n\r\n#### \u5b89\u88c5\u548c\u914d\u7f6e\r\n\r\n\r\n\u4f7f\u7528pip\u5b89\u88c5\u3002\r\n\r\n``` bash\r\n$ pip install djangorestframework-xml\r\n```\r\n\r\n\u4fee\u6539 REST framework settings\u3002\r\n\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_PARSER_CLASSES': (\r\n        'rest_framework_xml.parsers.XMLParser',\r\n    ),\r\n    'DEFAULT_RENDERER_CLASSES': (\r\n        'rest_framework_xml.renderers.XMLRenderer',\r\n    ),\r\n}\r\n```\r\n\r\n\r\n### [MessagePack](https://github.com/juanriaza/django-rest-framework-msgpack)\r\n\r\n\r\n### [CamelCase JSON](https://github.com/vbabiy/djangorestframework-camel-case)\r\n\r\n## \u53cb\u60c5\u63d0\u793a\r\n\r\n\u914d\u5408\u6e90\u7801\u9605\u8bfb\u6548\u679c\u66f4\u4f73\u54e6", "md_File": "subject/django-rest-framework-api-guide/parsers.md", "create_date": "2020-02-20T13:10:40.681", "order": 7}}, {"model": "subject.chapter", "pk": 156, "fields": {"title": "\u5e8f\u5217\u5316\u5173\u7cfbrelations", "topic": 7, "md5": "1f9c5364c56730c39f26d1ac9f48e549", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/relations/)  \r\n\r\n\r\n\r\n# Serializer \u5173\u7cfb\r\n\r\n\u5173\u7cfb\u5b57\u6bb5\u7528\u4e8e\u8868\u793a\u6a21\u578b\u5173\u7cfb\u3002 \u5b83\u4eec\u53ef\u4ee5\u5e94\u7528\u4e8e `ForeignKey`\uff0c`ManyToManyField` \u548c `OneToOneField` \u5173\u7cfb\uff0c\u53cd\u5411\u5173\u7cfb\u4ee5\u53ca `GenericForeignKey` \u7b49\u81ea\u5b9a\u4e49\u5173\u7cfb\u3002\r\n\r\n\r\n\r\n> **\u6ce8\u610f\uff1a** \u5173\u7cfb\u5b57\u6bb5\u5728 `relations.py` \u4e2d\u58f0\u660e\uff0c\u4f46\u6309\u7167\u60ef\u4f8b\uff0c\u4f60\u5e94\u8be5\u4ece `serializers` \u6a21\u5757\u5bfc\u5165\u5b83\u4eec\uff0c\u4f7f\u7528 `from rest_framework import serializers` \u5f15\u5165\uff0c\u5e76\u50cf `serializers.<FieldName>` \u8fd9\u6837\u5f15\u7528\u5b57\u6bb5\u3002\r\n\r\n\r\n\r\n#### \u68c0\u67e5\u5173\u7cfb\u3002\r\n\r\n\u5728\u4f7f\u7528 `ModelSerializer` \u7c7b\u65f6\uff0c\u5c06\u81ea\u52a8\u4e3a\u4f60\u751f\u6210\u5e8f\u5217\u5316\u5b57\u6bb5\u548c\u5173\u7cfb\u3002\u68c0\u67e5\u8fd9\u4e9b\u81ea\u52a8\u751f\u6210\u7684\u5b57\u6bb5\u53ef\u4ee5\u5b66\u4e60\u5982\u4f55\u5b9a\u5236\u5173\u7cfb\u98ce\u683c\u3002\r\n\r\n\u4e3a\u6b64\uff0c\u4f7f\u7528 `python manage.py shell` \u6253\u5f00 Django shell\uff0c\u7136\u540e\u5bfc\u5165\u5e8f\u5217\u5316\u7c7b\uff0c\u5b9e\u4f8b\u5316\u5b83\u5e76\u6253\u5370\u5bf9\u8c61\u8868\u793a\u5f62\u5f0f...\r\n\r\n``` python\r\n>>> from myapp.serializers import AccountSerializer\r\n>>> serializer = AccountSerializer()\r\n>>> print repr(serializer)  # Or `print(repr(serializer))` in Python 3.x.\r\nAccountSerializer():\r\n    id = IntegerField(label='ID', read_only=True)\r\n    name = CharField(allow_blank=True, max_length=100, required=False)\r\n    owner = PrimaryKeyRelatedField(queryset=User.objects.all())\r\n```\r\n\r\n# API \u53c2\u8003\r\n\r\n\u4e3a\u4e86\u89e3\u91ca\u5404\u79cd\u7c7b\u578b\u7684\u5173\u7cfb\u5b57\u6bb5\uff0c\u6211\u4eec\u5c06\u4e3a\u6211\u4eec\u7684\u793a\u4f8b\u4f7f\u7528\u51e0\u4e2a\u7b80\u5355\u7684\u6a21\u578b\u3002\u6211\u4eec\u7684\u6a21\u578b\u5c06\u4f7f\u7528\u97f3\u4e50\u4e13\u8f91\uff0c\u4ee5\u53ca\u6bcf\u5f20\u4e13\u8f91\u4e2d\u5217\u51fa\u7684\u66f2\u76ee\u3002\r\n\r\n``` python\r\nclass Album(models.Model):\r\n    album_name = models.CharField(max_length=100)\r\n    artist = models.CharField(max_length=100)\r\n\r\nclass Track(models.Model):\r\n    album = models.ForeignKey(Album, related_name='tracks', on_delete=models.CASCADE)\r\n    order = models.IntegerField()\r\n    title = models.CharField(max_length=100)\r\n    duration = models.IntegerField()\r\n\r\n    class Meta:\r\n        unique_together = ('album', 'order')\r\n        ordering = ['order']\r\n\r\n    def __unicode__(self):\r\n        return '%d: %s' % (self.order, self.title)\r\n```\r\n\r\n## StringRelatedField\r\n\r\n`StringRelatedField` \u7528\u4e8e\u4f7f\u7528 `__unicode__` \u65b9\u6cd5\u8868\u793a\u5173\u7cfb\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n``` python\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    tracks = serializers.StringRelatedField(many=True)\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'tracks')\r\n```\r\n\r\n\u5c06\u5e8f\u5217\u5316\u4e3a\u4ee5\u4e0b\u5f62\u5f0f\u3002\r\n\r\n```\r\n{\r\n    'album_name': 'Things We Lost In The Fire',\r\n    'artist': 'Low',\r\n    'tracks': [\r\n        '1: Sunflower',\r\n        '2: Whitetail',\r\n        '3: Dinosaur Act',\r\n        ...\r\n    ]\r\n}\r\n```\r\n\r\n\u8be5\u5b57\u6bb5\u662f\u53ea\u8bfb\u7684\u3002\r\n\r\n**\u53c2\u6570**:\r\n\r\n* `many` - \u5982\u679c\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u5c31\u5c06\u6b64\u53c2\u6570\u8bbe\u7f6e\u4e3a `True`.\r\n\r\n## PrimaryKeyRelatedField\r\n\r\n`PrimaryKeyRelatedField` \u7528\u4e8e\u4f7f\u7528\u5176\u4e3b\u952e\u8868\u793a\u5173\u7cfb\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5e8f\u5217\u5316\u7c7b\uff1a\r\n\r\n``` python\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    tracks = serializers.PrimaryKeyRelatedField(many=True, read_only=True)\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'tracks')\r\n```\r\n\r\n\u5c06\u5e8f\u5217\u5316\u4e3a\u8fd9\u6837\u7684\u8868\u793a\uff1a\r\n\r\n```\r\n{\r\n    'album_name': 'Undun',\r\n    'artist': 'The Roots',\r\n    'tracks': [\r\n        89,\r\n        90,\r\n        91,\r\n        ...\r\n    ]\r\n}\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u5b57\u6bb5\u662f\u53ef\u8bfb\u5199\u7684\uff0c\u4f46\u60a8\u53ef\u4ee5\u4f7f\u7528 `read_only` \u6807\u5fd7\u66f4\u6539\u6b64\u884c\u4e3a\u3002\r\n\r\n**\u53c2\u6570**:\r\n\r\n* `queryset` - \u9a8c\u8bc1\u5b57\u6bb5\u8f93\u5165\u65f6\u7528\u4e8e\u6a21\u578b\u5b9e\u4f8b\u67e5\u8be2\u7684\u67e5\u8be2\u96c6\u3002\u5fc5\u987b\u663e\u5f0f\u5730\u8bbe\u7f6e\u67e5\u8be2\u96c6\uff0c\u6216\u8bbe\u7f6e `read_only=True`\u3002\r\n* `many` - \u5982\u679c\u5e94\u7528\u4e8e\u4e00\u5bf9\u591a\u5173\u7cfb\uff0c\u5219\u5e94\u5c06\u6b64\u53c2\u6570\u8bbe\u7f6e\u4e3a `True`\u3002\r\n* `allow_null` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u90a3\u4e48\u8be5\u5b57\u6bb5\u5c06\u63a5\u53d7 `None` \u503c\u6216\u53ef\u4e3a\u7a7a\u7684\u5173\u7cfb\u7684\u7a7a\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u4e3a `False`\u3002\r\n* `pk_field` - \u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5b57\u6bb5\u6765\u63a7\u5236\u4e3b\u952e\u503c\u7684\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u3002\u4f8b\u5982\uff0c `pk_field=UUIDField(format='hex')` \u4f1a\u5c06 UUID \u4e3b\u952e\u5e8f\u5217\u5316\u4e3a\u5176\u7d27\u51d1\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u5f62\u5f0f\u3002\r\n\r\n\r\n## HyperlinkedRelatedField\r\n\r\n`HyperlinkedRelatedField` \u7528\u4e8e\u4f7f\u7528\u8d85\u94fe\u63a5\u6765\u8868\u793a\u5173\u7cfb\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5e8f\u5217\u5316\u7c7b\uff1a\r\n\r\n``` python\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    tracks = serializers.HyperlinkedRelatedField(\r\n        many=True,\r\n        read_only=True,\r\n        view_name='track-detail'\r\n    )\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'tracks')\r\n```\r\n\r\n\u5c06\u5e8f\u5217\u5316\u4e3a\u8fd9\u6837\u7684\u8868\u793a\uff1a\r\n\r\n```\r\n{\r\n    'album_name': 'Graceland',\r\n    'artist': 'Paul Simon',\r\n    'tracks': [\r\n        'http://www.example.com/api/tracks/45/',\r\n        'http://www.example.com/api/tracks/46/',\r\n        'http://www.example.com/api/tracks/47/',\r\n        ...\r\n    ]\r\n}\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u5b57\u6bb5\u662f\u53ef\u8bfb\u5199\u7684\uff0c\u4f46\u60a8\u53ef\u4ee5\u4f7f\u7528 `read_only` \u6807\u5fd7\u66f4\u6539\u6b64\u884c\u4e3a\u3002\r\n\r\n---\r\n\r\n**\u6ce8\u610f**\uff1a\u8be5\u5b57\u6bb5\u662f\u4e3a\u6620\u5c04\u5230\u63a5\u53d7\u5355\u4e2a URL \u5173\u952e\u5b57\u53c2\u6570\u7684 URL \u7684\u5bf9\u8c61\u800c\u8bbe\u8ba1\u7684\uff0c\u5982\u4f7f\u7528 `lookup_field` \u548c `lookup_url_kwarg` \u53c2\u6570\u8bbe\u7f6e\u7684\u5bf9\u8c61\u3002\r\n\r\n\u8fd9\u9002\u7528\u4e8e\u5305\u542b\u5355\u4e2a\u4e3b\u952e\u6216 slug \u53c2\u6570\u4f5c\u4e3a URL \u4e00\u90e8\u5206\u7684 URL\u3002\r\n\r\n\u5982\u679c\u9700\u8981\u66f4\u590d\u6742\u7684\u8d85\u94fe\u63a5\u8868\u793a\uff0c\u4f60\u9700\u8981\u81ea\u5b9a\u4e49\u8be5\u5b57\u6bb5\uff0c\u7a0d\u540e\u4f1a\u8be6\u89e3\u3002\r\n\r\n---\r\n\r\n**\u53c2\u6570**\uff1a\r\n\r\n* `view_name` - \u7528\u4f5c\u5173\u7cfb\u76ee\u6807\u7684\u89c6\u56fe\u540d\u79f0\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u6807\u51c6\u8def\u7531\u5668\u7c7b\uff0c\u5219\u8fd9\u5c06\u662f\u4e00\u4e2a\u683c\u5f0f\u4e3a `<modelname>-detail` \u7684\u5b57\u7b26\u4e32\u3002**\u5fc5\u586b**.\r\n* `queryset` - \u9a8c\u8bc1\u5b57\u6bb5\u8f93\u5165\u65f6\u7528\u4e8e\u6a21\u578b\u5b9e\u4f8b\u67e5\u8be2\u7684\u67e5\u8be2\u96c6\u3002\u5fc5\u987b\u663e\u5f0f\u5730\u8bbe\u7f6e\u67e5\u8be2\u96c6\uff0c\u6216\u8bbe\u7f6e `read_only=True`\u3002\r\n* `many` - \u5982\u679c\u5e94\u7528\u4e8e\u4e00\u5bf9\u591a\u5173\u7cfb\uff0c\u5219\u5e94\u5c06\u6b64\u53c2\u6570\u8bbe\u7f6e\u4e3a `True`\u3002\r\n* `allow_null` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u90a3\u4e48\u8be5\u5b57\u6bb5\u5c06\u63a5\u53d7 `None` \u503c\u6216\u53ef\u4e3a\u7a7a\u7684\u5173\u7cfb\u7684\u7a7a\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u4e3a `False`\u3002\r\n* `lookup_field` - \u7528\u4e8e\u67e5\u627e\u7684\u76ee\u6807\u5b57\u6bb5\u3002\u5bf9\u5e94\u4e8e\u5f15\u7528\u89c6\u56fe\u4e0a\u7684 URL \u5173\u952e\u5b57\u53c2\u6570\u3002\u9ed8\u8ba4\u662f `'pk'`.\r\n* `lookup_url_kwarg` - \u4e0e\u67e5\u627e\u5b57\u6bb5\u5bf9\u5e94\u7684 URL conf \u4e2d\u5b9a\u4e49\u7684\u5173\u952e\u5b57\u53c2\u6570\u7684\u540d\u79f0\u3002\u9ed8\u8ba4\u4f7f\u7528\u4e0e `lookup_field` \u76f8\u540c\u7684\u503c\u3002\r\n* `format` - \u5982\u679c\u4f7f\u7528\u683c\u5f0f\u540e\u7f00\uff0c\u5219\u8d85\u94fe\u63a5\u5b57\u6bb5\u5c06\u4f7f\u7528\u4e0e\u76ee\u6807\u76f8\u540c\u7684\u683c\u5f0f\u540e\u7f00\uff0c\u9664\u975e\u4f7f\u7528 `format` \u53c2\u6570\u8fdb\u884c\u8986\u76d6\u3002\r\n\r\n## SlugRelatedField\r\n\r\n`SlugRelatedField` \u7528\u4e8e\u4f7f\u7528\u76ee\u6807\u4e0a\u7684\u5b57\u6bb5\u6765\u8868\u793a\u5173\u7cfb\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5e8f\u5217\u5316\u7c7b\uff1a\r\n\r\n``` python\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    tracks = serializers.SlugRelatedField(\r\n        many=True,\r\n        read_only=True,\r\n        slug_field='title'\r\n     )\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'tracks')\r\n```\r\n\r\n\u5c06\u5e8f\u5217\u5316\u4e3a\u8fd9\u6837\u7684\u8868\u793a\uff1a\r\n\r\n``` python\r\n{\r\n    'album_name': 'Dear John',\r\n    'artist': 'Loney Dear',\r\n    'tracks': [\r\n        'Airport Surroundings',\r\n        'Everything Turns to You',\r\n        'I Was Only Going Out',\r\n        ...\r\n    ]\r\n}\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u5b57\u6bb5\u662f\u53ef\u8bfb\u5199\u7684\uff0c\u4f46\u60a8\u53ef\u4ee5\u4f7f\u7528 `read_only` \u6807\u5fd7\u66f4\u6539\u6b64\u884c\u4e3a\u3002\r\n\r\n\u5c06 `SlugRelatedField` \u7528\u4f5c\u8bfb\u5199\u5b57\u6bb5\u65f6\uff0c\u901a\u5e38\u9700\u8981\u786e\u4fdd slug \u5b57\u6bb5\u4e0e `unique=True` \u7684\u6a21\u578b\u5b57\u6bb5\u76f8\u5bf9\u5e94\u3002\r\n\r\n**\u53c2\u6570**\uff1a\r\n\r\n* `slug_field` - \u7528\u6765\u8868\u793a\u76ee\u6807\u7684\u5b57\u6bb5\u3002\u8fd9\u5e94\u8be5\u662f\u552f\u4e00\u6807\u8bc6\u7ed9\u5b9a\u5b9e\u4f8b\u7684\u5b57\u6bb5\u3002\u4f8b\u5982\uff0c `username`\u3002**\u5fc5\u586b**\r\n* `queryset` - \u9a8c\u8bc1\u5b57\u6bb5\u8f93\u5165\u65f6\u7528\u4e8e\u6a21\u578b\u5b9e\u4f8b\u67e5\u8be2\u7684\u67e5\u8be2\u96c6\u3002\u5fc5\u987b\u663e\u5f0f\u5730\u8bbe\u7f6e\u67e5\u8be2\u96c6\uff0c\u6216\u8bbe\u7f6e `read_only=True`\u3002\r\n* `many` - \u5982\u679c\u5e94\u7528\u4e8e\u4e00\u5bf9\u591a\u5173\u7cfb\uff0c\u5219\u5e94\u5c06\u6b64\u53c2\u6570\u8bbe\u7f6e\u4e3a `True`\u3002\r\n* `allow_null` - \u5982\u679c\u8bbe\u7f6e\u4e3a `True`\uff0c\u90a3\u4e48\u8be5\u5b57\u6bb5\u5c06\u63a5\u53d7 `None` \u503c\u6216\u53ef\u4e3a\u7a7a\u7684\u5173\u7cfb\u7684\u7a7a\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u4e3a `False`\u3002\r\n\r\n## HyperlinkedIdentityField\r\n\r\n\u6b64\u5b57\u6bb5\u53ef\u4ee5\u4f5c\u4e3a\u8eab\u4efd\u5173\u7cfb\u5e94\u7528\uff0c\u4f8b\u5982 `HyperlinkedModelSerializer` \u4e0a\u7684 `'url'` \u5b57\u6bb5\u3002\u5b83\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5bf9\u8c61\u7684\u5c5e\u6027\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5e8f\u5217\u5316\u7c7b\uff1a\r\n\r\n``` python\r\nclass AlbumSerializer(serializers.HyperlinkedModelSerializer):\r\n    track_listing = serializers.HyperlinkedIdentityField(view_name='track-list')\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'track_listing')\r\n```\r\n\r\n\u5c06\u5e8f\u5217\u5316\u4e3a\u8fd9\u6837\u7684\u8868\u793a\uff1a\r\n\r\n``` python\r\n{\r\n    'album_name': 'The Eraser',\r\n    'artist': 'Thom Yorke',\r\n    'track_listing': 'http://www.example.com/api/track_list/12/',\r\n}\r\n```\r\n\r\n\u8be5\u5b57\u6bb5\u59cb\u7ec8\u4e3a\u53ea\u8bfb\u3002\r\n\r\n**\u53c2\u6570**\uff1a\r\n\r\n* `view_name` - \u7528\u4f5c\u5173\u7cfb\u76ee\u6807\u7684\u89c6\u56fe\u540d\u79f0\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u6807\u51c6\u8def\u7531\u5668\u7c7b\uff0c\u5219\u8fd9\u5c06\u662f\u4e00\u4e2a\u683c\u5f0f\u4e3a `<modelname>-detail` \u7684\u5b57\u7b26\u4e32\u3002**\u5fc5\u586b**\u3002\r\n* `lookup_field` - \u7528\u4e8e\u67e5\u627e\u7684\u76ee\u6807\u5b57\u6bb5\u3002\u5bf9\u5e94\u4e8e\u5f15\u7528\u89c6\u56fe\u4e0a\u7684 URL \u5173\u952e\u5b57\u53c2\u6570\u3002\u9ed8\u8ba4\u662f `'pk'`\u3002\r\n* `lookup_url_kwarg` - \u4e0e\u67e5\u627e\u5b57\u6bb5\u5bf9\u5e94\u7684 URL conf \u4e2d\u5b9a\u4e49\u7684\u5173\u952e\u5b57\u53c2\u6570\u7684\u540d\u79f0\u3002\u9ed8\u8ba4\u4f7f\u7528\u4e0e `lookup_field` \u76f8\u540c\u7684\u503c\u3002\r\n* `format` - \u5982\u679c\u4f7f\u7528\u683c\u5f0f\u540e\u7f00\uff0c\u5219\u8d85\u94fe\u63a5\u5b57\u6bb5\u5c06\u4f7f\u7528\u4e0e\u76ee\u6807\u76f8\u540c\u7684\u683c\u5f0f\u540e\u7f00\uff0c\u9664\u975e\u4f7f\u7528 `format` \u53c2\u6570\u8fdb\u884c\u8986\u76d6\u3002\r\n\r\n---\r\n\r\n# \u5d4c\u5957\u5173\u7cfb\r\n\r\n\u5d4c\u5957\u5173\u7cfb\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u5e8f\u5217\u5316\u7c7b\u4f5c\u4e3a\u5b57\u6bb5\u6765\u8868\u8fbe\u3002\r\n\r\n\u5982\u679c\u8be5\u5b57\u6bb5\u7528\u4e8e\u8868\u793a\u4e00\u5bf9\u591a\u5173\u7cfb\uff0c\u5219\u5e94\u5c06 `many=True` \u6807\u5fd7\u6dfb\u52a0\u5230\u5e8f\u5217\u5316\u5b57\u6bb5\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5e8f\u5217\u5316\u7c7b\uff1a\r\n\r\n``` python\r\nclass TrackSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Track\r\n        fields = ('order', 'title', 'duration')\r\n\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    tracks = TrackSerializer(many=True, read_only=True)\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'tracks')\r\n```\r\n\r\n\u5c06\u5e8f\u5217\u5316\u4e3a\u8fd9\u6837\u7684\u5d4c\u5957\u8868\u793a\uff1a\r\n\r\n``` python\r\n>>> album = Album.objects.create(album_name=\"The Grey Album\", artist='Danger Mouse')\r\n>>> Track.objects.create(album=album, order=1, title='Public Service Announcement', duration=245)\r\n<Track: Track object>\r\n>>> Track.objects.create(album=album, order=2, title='What More Can I Say', duration=264)\r\n<Track: Track object>\r\n>>> Track.objects.create(album=album, order=3, title='Encore', duration=159)\r\n<Track: Track object>\r\n>>> serializer = AlbumSerializer(instance=album)\r\n>>> serializer.data\r\n{\r\n    'album_name': 'The Grey Album',\r\n    'artist': 'Danger Mouse',\r\n    'tracks': [\r\n        {'order': 1, 'title': 'Public Service Announcement', 'duration': 245},\r\n        {'order': 2, 'title': 'What More Can I Say', 'duration': 264},\r\n        {'order': 3, 'title': 'Encore', 'duration': 159},\r\n        ...\r\n    ],\r\n}\r\n```\r\n\r\n## \u53ef\u5199\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\u662f\u53ea\u8bfb\u7684\u3002\u5982\u679c\u8981\u652f\u6301\u5bf9\u5d4c\u5957\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u5199\u64cd\u4f5c\uff0c\u5219\u9700\u8981\u521b\u5efa `create()` \u548c/\u6216 `update()` \u65b9\u6cd5\uff0c\u4ee5\u660e\u786e\u6307\u5b9a\u5e94\u5982\u4f55\u4fdd\u5b58\u5b50\u5173\u7cfb\u3002\r\n\r\n``` python\r\nclass TrackSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Track\r\n        fields = ('order', 'title', 'duration')\r\n\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    tracks = TrackSerializer(many=True)\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'tracks')\r\n\r\n    def create(self, validated_data):\r\n        tracks_data = validated_data.pop('tracks')\r\n        album = Album.objects.create(**validated_data)\r\n        for track_data in tracks_data:\r\n            Track.objects.create(album=album, **track_data)\r\n        return album\r\n\r\n>>> data = {\r\n    'album_name': 'The Grey Album',\r\n    'artist': 'Danger Mouse',\r\n    'tracks': [\r\n        {'order': 1, 'title': 'Public Service Announcement', 'duration': 245},\r\n        {'order': 2, 'title': 'What More Can I Say', 'duration': 264},\r\n        {'order': 3, 'title': 'Encore', 'duration': 159},\r\n    ],\r\n}\r\n>>> serializer = AlbumSerializer(data=data)\r\n>>> serializer.is_valid()\r\nTrue\r\n>>> serializer.save()\r\n<Album: Album object>\r\n```\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u5173\u7cfb\u5b57\u6bb5\r\n\r\n\u5728\u6781\u5c11\u6570\u60c5\u51b5\u4e0b\uff0c\u73b0\u6709\u7684\u5173\u7cfb\u7c7b\u578b\u90fd\u4e0d\u7b26\u5408\u60a8\u9700\u8981\u7684\u8868\u793a\u5f62\u5f0f\uff0c\u4f60\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5b8c\u5168\u81ea\u5b9a\u4e49\u7684\u5173\u7cfb\u5b57\u6bb5\uff0c\u8be5\u5b57\u6bb5\u51c6\u786e\u63cf\u8ff0\u5e94\u8be5\u5982\u4f55\u4ece\u6a21\u578b\u5b9e\u4f8b\u751f\u6210\u8f93\u51fa\u8868\u793a\u3002\r\n\r\n\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u5173\u7cfb\u5b57\u6bb5\uff0c\u60a8\u5e94\u8be5\u91cd\u5199 `RelatedField`\uff0c\u5e76\u5b9e\u73b0 `.to_representation(self, value)` \u65b9\u6cd5\u3002\u6b64\u65b9\u6cd5\u5c06\u5b57\u6bb5\u7684\u76ee\u6807\u4f5c\u4e3a `value` \u53c2\u6570\uff0c\u5e76\u8fd4\u56de\u5e94\u7528\u4e8e\u5e8f\u5217\u5316\u76ee\u6807\u7684\u8868\u793a\u3002`value` \u53c2\u6570\u901a\u5e38\u662f\u4e00\u4e2a\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u5982\u679c\u8981\u5b9e\u73b0\u8bfb\u5199\u5173\u7cfb\u5b57\u6bb5\uff0c\u5219\u8fd8\u5fc5\u987b\u5b9e\u73b0 `.to_internal_value(self, data)` \u65b9\u6cd5\u3002\r\n\r\n\u8981\u63d0\u4f9b\u57fa\u4e8e `context` \u7684\u52a8\u6001\u67e5\u8be2\u96c6\uff0c\u8fd8\u53ef\u4ee5\u8986\u76d6 `.get_queryset(self)`\uff0c\u800c\u4e0d\u662f\u5728\u7c7b\u4e0a\u6307\u5b9a `.queryset` \u6216\u521d\u59cb\u5316\u8be5\u5b57\u6bb5\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u5173\u7cfb\u5b57\u6bb5\uff0c\u4f7f\u7528\u5b83\u7684\u987a\u5e8f\uff0c\u6807\u9898\u548c\u6301\u7eed\u65f6\u95f4\u5c06\u97f3\u8f68\u5e8f\u5217\u5316\u4e3a\u81ea\u5b9a\u4e49\u5b57\u7b26\u4e32\u8868\u793a\u3002\r\n\r\n``` python\r\nimport time\r\n\r\nclass TrackListingField(serializers.RelatedField):\r\n    def to_representation(self, value):\r\n        duration = time.strftime('%M:%S', time.gmtime(value.duration))\r\n        return 'Track %d: %s (%s)' % (value.order, value.name, duration)\r\n\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    tracks = TrackListingField(many=True)\r\n\r\n    class Meta:\r\n        model = Album\r\n        fields = ('album_name', 'artist', 'tracks')\r\n```\r\n\r\n\u5c06\u5e8f\u5217\u5316\u4e3a\u8fd9\u6837\u7684\u8868\u793a\uff1a\r\n\r\n``` python\r\n{\r\n    'album_name': 'Sometimes I Wish We Were an Eagle',\r\n    'artist': 'Bill Callahan',\r\n    'tracks': [\r\n        'Track 1: Jim Cain (04:39)',\r\n        'Track 2: Eid Ma Clack Shaw (04:19)',\r\n        'Track 3: The Wind and the Dove (04:34)',\r\n        ...\r\n    ]\r\n}\r\n```\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u8d85\u94fe\u63a5\u5b57\u6bb5\r\n\r\n\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u81ea\u5b9a\u4e49\u8d85\u94fe\u63a5\u5b57\u6bb5\u7684\u884c\u4e3a\uff0c\u4ee5\u8868\u793a\u9700\u8981\u591a\u4e2a\u67e5\u8be2\u5b57\u6bb5\u7684 URL\u3002\r\n\r\n\u60a8\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f `HyperlinkedRelatedField` \u6765\u5b9e\u73b0\u6b64\u76ee\u7684\u3002\u6709\u4e24\u4e2a\u53ef\u4ee5\u88ab\u8986\u76d6\u7684\u65b9\u6cd5\uff1a\r\n\r\n**get_url(self, obj, view_name, request, format)**\r\n\r\n`get_url` \u65b9\u6cd5\u7528\u4e8e\u5c06\u5bf9\u8c61\u5b9e\u4f8b\u6620\u5c04\u5230\u5176 URL \u8868\u793a\u3002\r\n\r\n\u5982\u679c `view_name` \u548c `lookup_field` \u5c5e\u6027\u672a\u914d\u7f6e\u4e3a\u6b63\u786e\u5339\u914d URL conf\uff0c\u53ef\u80fd\u4f1a\u5f15\u53d1 `NoReverseMatch` \u3002\r\n\r\n**get_object(self, queryset, view_name, view_args, view_kwargs)**\r\n\r\n\u5982\u679c\u60a8\u60f3\u652f\u6301\u53ef\u5199\u7684\u8d85\u94fe\u63a5\u5b57\u6bb5\uff0c\u90a3\u4e48\u60a8\u8fd8\u9700\u8981\u91cd\u5199 `get_object`\uff0c\u4ee5\u4fbf\u5c06\u4f20\u5165\u7684 URL \u6620\u5c04\u56de\u5b83\u4eec\u8868\u793a\u7684\u5bf9\u8c61\u3002\u5bf9\u4e8e\u53ea\u8bfb\u8d85\u94fe\u63a5\u5b57\u6bb5\uff0c\u4e0d\u9700\u8981\u91cd\u5199\u6b64\u65b9\u6cd5\u3002\r\n\r\n\u6b64\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5e94\u8be5\u662f\u4e0e\u5339\u914d\u7684 URL conf \u53c2\u6570\u5bf9\u5e94\u7684\u5bf9\u8c61\u3002\r\n\r\n\u53ef\u80fd\u4f1a\u5f15\u53d1 `ObjectDoesNotExist` \u5f02\u5e38\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5e26\u6709\u4e24\u4e2a\u5173\u952e\u5b57\u53c2\u6570\u7684 customer \u5bf9\u8c61\u7684 URL\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n```\r\n/api/<organization_slug>/customers/<customer_pk>/\r\n```\r\n\r\n\u8fd9\u6ca1\u529e\u6cd5\u7528\u4ec5\u63a5\u53d7\u5355\u4e2a\u67e5\u627e\u5b57\u6bb5\u7684\u9ed8\u8ba4\u5b9e\u73b0\u6765\u8868\u793a\u3002\r\n\r\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u7ee7\u627f `HyperlinkedRelatedField` \u5e76\u91cd\u5199\u5176\u4e2d\u7684\u65b9\u6cd5\u6765\u83b7\u5f97\u6211\u4eec\u60f3\u8981\u7684\u884c\u4e3a\uff1a\r\n\r\n``` python\r\nfrom rest_framework import serializers\r\nfrom rest_framework.reverse import reverse\r\n\r\nclass CustomerHyperlink(serializers.HyperlinkedRelatedField):\r\n    # We define these as class attributes, so we don't need to pass them as arguments.\r\n    view_name = 'customer-detail'\r\n    queryset = Customer.objects.all()\r\n\r\n    def get_url(self, obj, view_name, request, format):\r\n        url_kwargs = {\r\n            'organization_slug': obj.organization.slug,\r\n            'customer_pk': obj.pk\r\n        }\r\n        return reverse(view_name, kwargs=url_kwargs, request=request, format=format)\r\n\r\n    def get_object(self, view_name, view_args, view_kwargs):\r\n        lookup_kwargs = {\r\n           'organization__slug': view_kwargs['organization_slug'],\r\n           'pk': view_kwargs['customer_pk']\r\n        }\r\n        return self.get_queryset().get(**lookup_kwargs)\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u60f3\u5c06\u6b64\u98ce\u683c\u4e0e\u901a\u7528\u89c6\u56fe\u4e00\u8d77\u4f7f\u7528\uff0c\u90a3\u4e48\u60a8\u8fd8\u9700\u8981\u8986\u76d6\u89c6\u56fe\u4e0a\u7684 `.get_object` \u4ee5\u83b7\u5f97\u6b63\u786e\u7684\u67e5\u627e\u884c\u4e3a\u3002\r\n\r\n\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u5efa\u8bae\u5c3d\u53ef\u80fd\u5728 API \u8868\u793a\u65b9\u5f0f\u4e0b\u4f7f\u7528\u5e73\u9762\u98ce\u683c\uff0c\u4f46\u5d4c\u5957 URL \u98ce\u683c\u5728\u9002\u5ea6\u4f7f\u7528\u65f6\u4e5f\u662f\u5408\u7406\u7684\u3002\r\n\r\n---\r\n\r\n# \u8fdb\u4e00\u6b65\u8bf4\u660e\r\n\r\n## `queryset` \u53c2\u6570\r\n\r\n`queryset` \u53c2\u6570\u53ea\u5bf9\u53ef\u5199\u5173\u7cfb\u5b57\u6bb5\u662f\u5fc5\u9700\u7684\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u7528\u4e8e\u6267\u884c\u6a21\u578b\u5b9e\u4f8b\u67e5\u627e\uff0c\u8be5\u67e5\u627e\u4ece\u57fa\u672c\u7528\u6237\u8f93\u5165\u6620\u5c04\u5230\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u5728 2.x \u7248\u672c\u4e2d\uff0c\u5982\u679c\u6b63\u5728\u4f7f\u7528 `ModelSerializer` \u7c7b\uff0c\u5219\u5e8f\u5217\u5316\u7c7b\u6709\u65f6\u4f1a\u81ea\u52a8\u786e\u5b9a `queryset` \u53c2\u6570\u3002\r\n\r\n\u6b64\u884c\u4e3a\u73b0\u200b\u200b\u5728\u66ff\u6362\u4e3a\u59cb\u7ec8\u4e3a\u53ef\u5199\u5173\u7cfb\u5b57\u6bb5\u4f7f\u7528\u663e\u5f0f `queryset` \u53c2\u6570\u3002\r\n\r\n\u8fd9\u6837\u505a\u53ef\u4ee5\u51cf\u5c11 `ModelSerializer` \u63d0\u4f9b\u7684\u9690\u85cf \u201c\u9b54\u672f\u201d \u6570\u91cf\uff08\u6307 `ModelSerializer` \u5728\u5185\u90e8\u5e2e\u6211\u4eec\u5b8c\u6210\u7684\u5de5\u4f5c\uff09\uff0c\u4f7f\u5b57\u6bb5\u7684\u884c\u4e3a\u66f4\u52a0\u6e05\u6670\uff0c\u5e76\u786e\u4fdd\u5728\u4f7f\u7528 `ModelSerializer` \u5feb\u6377\u65b9\u5f0f\uff08\u9ad8\u5ea6\u5c01\u88c5\u8fc7\uff0c\u4f7f\u7528\u7b80\u5355\uff09\u6216\u4f7f\u7528\u5b8c\u5168\u663e\u5f0f\u7684 `Serializer` \u7c7b\u4e4b\u95f4\u8f6c\u6362\u662f\u5fae\u4e0d\u8db3\u9053\u7684\u3002\r\n\r\n## \u81ea\u5b9a\u4e49 HTML \u663e\u793a\r\n\r\n\u6a21\u578b\u5185\u7f6e\u7684 `__str__` \u65b9\u6cd5\u7528\u6765\u751f\u6210\u7528\u4e8e\u586b\u5145 `choices` \u5c5e\u6027\u7684\u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\u8868\u793a\u5f62\u5f0f\u3002\u8fd9\u4e9b choices \u7528\u4e8e\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u586b\u5145\u9009\u62e9\u7684 HTML input\u3002\r\n\r\n\u8981\u4e3a\u8fd9\u4e9b input \u63d0\u4f9b\u81ea\u5b9a\u4e49\u8868\u793a\uff0c\u8bf7\u91cd\u5199 `RelatedField` \u5b50\u7c7b\u7684 `display_value()` \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5c06\u63a5\u6536\u4e00\u4e2a\u6a21\u578b\u5bf9\u8c61\uff0c\u5e76\u4e14\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u9002\u5408\u8868\u793a\u5b83\u7684\u5b57\u7b26\u4e32\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass TrackPrimaryKeyRelatedField(serializers.PrimaryKeyRelatedField):\r\n    def display_value(self, instance):\r\n        return 'Track: %s' % (instance.title)\r\n```\r\n\r\n## Select field cutoffs\r\n\r\n\u5728\u6e32\u67d3\u53ef\u6d4f\u89c8\u7684 API \u5173\u7cfb\u5b57\u6bb5\u65f6\uff0c\u9ed8\u8ba4\u53ea\u663e\u793a\u6700\u591a 1000 \u4e2a\u53ef\u9009 item\u3002\u5982\u679c\u5b58\u5728\u66f4\u591a\u9879\u76ee\uff0c\u5219\u4f1a\u663e\u793a \"More than 1000 items\u2026\" \u7684 disabled \u9009\u9879\u3002\r\n\r\n\u6b64\u884c\u4e3a\u65e8\u5728\u9632\u6b62\u7531\u4e8e\u663e\u793a\u5927\u91cf\u5173\u7cfb\u800c\u5bfc\u81f4\u6a21\u677f\u65e0\u6cd5\u5728\u53ef\u63a5\u53d7\u7684\u65f6\u95f4\u8303\u56f4\u5185\u5b8c\u6210\u6e32\u67d3\u3002\r\n\r\n\u6709\u4e24\u4e2a\u5173\u952e\u5b57\u53c2\u6570\u53ef\u7528\u4e8e\u63a7\u5236\u6b64\u884c\u4e3a\uff1a\r\n\r\n- `html_cutoff` - \u8bbe\u7f6e HTML select \u4e0b\u62c9\u83dc\u5355\u4e2d\u663e\u793a\u7684\u9009\u9879\u7684\u6700\u5927\u6570\u91cf\u3002\u8bbe\u7f6e\u4e3a `None` \u53ef\u4ee5\u7981\u7528\u4efb\u4f55\u9650\u5236\u3002\u9ed8\u8ba4\u4e3a `1000`\u3002\r\n- `html_cutoff_text` - \u8bbe\u7f6e\u4e00\u4e2a\u6587\u672c\u5b57\u7b26\u4e32\uff0c\u5728 HTML select \u4e0b\u62c9\u83dc\u5355\u8d85\u51fa\u6700\u5927\u663e\u793a\u6570\u91cf\u65f6\u663e\u793a\u3002\u9ed8\u8ba4\u662f `\"More than {count} items\u2026\"`\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u5728 settings \u4e2d\u7528 `HTML_SELECT_CUTOFF` \u548c `HTML_SELECT_CUTOFF_TEXT` \u6765\u5168\u5c40\u63a7\u5236\u8fd9\u4e9b\u8bbe\u7f6e\u3002\r\n\r\n\u5728\u5f3a\u5236\u6267\u884c cutoff \u7684\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u6539\u4e3a\u5728 HTML \u8868\u5355\u4e2d\u4f7f\u7528\u7b80\u5355\u7684 input \u5b57\u6bb5\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 `style` \u5173\u952e\u5b57\u53c2\u6570\u6765\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nassigned_to = serializers.SlugRelatedField(\r\n   queryset=User.objects.all(),\r\n   slug_field='username',\r\n   style={'base_template': 'input.html'}\r\n)\r\n```\r\n\r\n## \u53cd\u5411\u5173\u7cfb\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u53cd\u5411\u5173\u7cfb\u4e0d\u4f1a\u81ea\u52a8\u5305\u542b\u5728 `ModelSerializer` \u548c `HyperlinkedModelSerializer` \u7c7b\u4e2d\u3002\u8981\u5305\u542b\u53cd\u5411\u5173\u7cfb\uff0c\u60a8\u5fc5\u987b\u660e\u786e\u5c06\u5176\u6dfb\u52a0\u5230\u5b57\u6bb5\u5217\u8868\u4e2d\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        fields = ('tracks', ...)\r\n```\r\n\r\n\u901a\u5e38\u9700\u8981\u786e\u4fdd\u5df2\u7ecf\u5728\u5173\u7cfb\u4e0a\u8bbe\u7f6e\u4e86\u9002\u5f53\u7684 `related_name` \u53c2\u6570\uff0c\u53ef\u4ee5\u5c06\u5176\u7528\u4f5c\u5b57\u6bb5\u540d\u79f0\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass Track(models.Model):\r\n    album = models.ForeignKey(Album, related_name='tracks', on_delete=models.CASCADE)\r\n    ...\r\n```\r\n\r\n\u5982\u679c\u4f60\u8fd8\u6ca1\u6709\u4e3a\u53cd\u5411\u5173\u7cfb\u8bbe\u7f6e\u76f8\u5173\u540d\u79f0\uff0c\u5219\u9700\u8981\u5728 `fields` \u53c2\u6570\u4e2d\u4f7f\u7528\u81ea\u52a8\u751f\u6210\u7684\u76f8\u5173\u540d\u79f0\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass AlbumSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        fields = ('track_set', ...)\r\n```\r\n\r\n## \u901a\u7528\u5173\u7cfb\r\n\r\n\u5982\u679c\u8981\u5e8f\u5217\u5316\u901a\u7528\u5916\u952e\uff0c\u5219\u9700\u8981\u81ea\u5b9a\u4e49\u5b57\u6bb5\uff0c\u4ee5\u660e\u786e\u786e\u5b9a\u5982\u4f55\u5e8f\u5217\u5316\u5173\u7cfb\u3002\r\n\r\n\u4f8b\u5982\uff0c\u7ed9\u5b9a\u4e00\u4e2a\u4ee5\u4e0b\u6a21\u578b\u7684\u6807\u7b7e\uff0c\u8be5\u6807\u7b7e\u4e0e\u5176\u4ed6\u4efb\u610f\u6a21\u578b\u5177\u6709\u901a\u7528\u5173\u7cfb\uff1a\r\n\r\n``` python\r\nclass TaggedItem(models.Model):\r\n    \"\"\"\r\n    Tags arbitrary model instances using a generic relation.\r\n\r\n    See: https://docs.djangoproject.com/en/stable/ref/contrib/contenttypes/\r\n    \"\"\"\r\n    tag_name = models.SlugField()\r\n    content_type = models.ForeignKey(ContentType, on_delete=models.CASCADE)\r\n    object_id = models.PositiveIntegerField()\r\n    tagged_object = GenericForeignKey('content_type', 'object_id')\r\n\r\n    def __unicode__(self):\r\n        return self.tag_name\r\n```\r\n\r\n\u4ee5\u4e0b\u4e24\u79cd\u6a21\u5f0f\u53ef\u4ee5\u7528\u76f8\u5173\u7684\u6807\u7b7e\uff1a\r\n\r\n``` python\r\nclass Bookmark(models.Model):\r\n    \"\"\"\r\n    A bookmark consists of a URL, and 0 or more descriptive tags.\r\n    \"\"\"\r\n    url = models.URLField()\r\n    tags = GenericRelation(TaggedItem)\r\n\r\n\r\nclass Note(models.Model):\r\n    \"\"\"\r\n    A note consists of some text, and 0 or more descriptive tags.\r\n    \"\"\"\r\n    text = models.CharField(max_length=1000)\r\n    tags = GenericRelation(TaggedItem)\r\n```\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u53ef\u7528\u4e8e\u5e8f\u5217\u5316\u6807\u7b7e\u5b9e\u4f8b\u7684\u81ea\u5b9a\u4e49\u5b57\u6bb5\uff0c\u5e76\u4f7f\u7528\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u7c7b\u578b\u6765\u786e\u5b9a\u5b83\u5e94\u8be5\u5982\u4f55\u5e8f\u5217\u5316\u3002\r\n\r\n``` python\r\nclass TaggedObjectRelatedField(serializers.RelatedField):\r\n    \"\"\"\r\n    A custom field to use for the `tagged_object` generic relationship.\r\n    \"\"\"\r\n\r\n    def to_representation(self, value):\r\n        \"\"\"\r\n        Serialize tagged objects to a simple textual representation.\r\n        \"\"\"\r\n        if isinstance(value, Bookmark):\r\n            return 'Bookmark: ' + value.url\r\n        elif isinstance(value, Note):\r\n            return 'Note: ' + value.text\r\n        raise Exception('Unexpected type of tagged object')\r\n```\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u7684\u5173\u7cfb\u5177\u6709\u5d4c\u5957\u8868\u793a\uff0c\u5219\u53ef\u4ee5\u5728 `.to_representation()` \u65b9\u6cd5\u4e2d\u4f7f\u7528\u6240\u9700\u7684\u5e8f\u5217\u5316\u7c7b\uff1a\r\n\r\n``` python\r\n    def to_representation(self, value):\r\n        \"\"\"\r\n        Serialize bookmark instances using a bookmark serializer,\r\n        and note instances using a note serializer.\r\n        \"\"\"\r\n        if isinstance(value, Bookmark):\r\n            serializer = BookmarkSerializer(value)\r\n        elif isinstance(value, Note):\r\n            serializer = NoteSerializer(value)\r\n        else:\r\n            raise Exception('Unexpected type of tagged object')\r\n\r\n        return serializer.data\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u4f7f\u7528 `GenericRelation` \u5b57\u6bb5\u8868\u793a\u7684\u53cd\u5411\u901a\u7528\u952e\u53ef\u4ee5\u4f7f\u7528\u5e38\u89c4\u5173\u7cfb\u5b57\u6bb5\u7c7b\u578b\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u56e0\u4e3a\u5173\u7cfb\u4e2d\u76ee\u6807\u7684\u7c7b\u578b\u603b\u662f\u5df2\u77e5\u7684\u3002\r\n\r\n## \u5177\u6709 Through \u6a21\u578b\u7684 ManyToManyFields\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5c06\u6307\u5b9a\u5e26\u6709 `through` \u6a21\u578b\u7684 `ManyToManyField` \u7684\u5173\u7cfb\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u3002\r\n\r\n\u5982\u679c\u4f60\u8981\u660e\u786e\u6307\u5b9a\u4e00\u4e2a\u6307\u5411\u5177\u6709 through \u6a21\u578b\u7684 `ManyToManyField` \u7684\u5173\u7cfb\u5b57\u6bb5\uff0c\u8bf7\u786e\u4fdd\u5c06 `read_only` \u8bbe\u7f6e\u4e3a `True` \u3002\r\n", "md_File": "subject/django-rest-framework-api-guide/relations.md", "create_date": "2020-02-20T13:10:40.697", "order": 11}}, {"model": "subject.chapter", "pk": 157, "fields": {"title": "\u8bf7\u6c42requests", "topic": 7, "md5": "9b534a90c3e0c6b07752557dba2968f6", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/requests/)\r\n\r\n\r\n\r\n> \u5982\u679c\u4f60\u6b63\u5728\u5f00\u53d1\u57fa\u4e8e REST \u7684 web API \u670d\u52a1...... \u5e94\u8be5\u5ffd\u7565 request.POST\u3002 \r\n> \u2014 *Malcom Tredinnick\uff0cDjango \u5f00\u53d1\u7ec4*\r\n\r\nREST framework \u7684 `Request` \u7c7b\u6269\u5c55\u4e0e\u6807\u51c6\u7684 `HttpRequest`\uff0c\u5e76\u505a\u4e86\u76f8\u5e94\u7684\u589e\u5f3a\uff0c\u6bd4\u5982\u66f4\u52a0\u7075\u6d3b\u7684\u8bf7\u6c42\u89e3\u6790\uff08request parsing\uff09\u548c\u8ba4\u8bc1\uff08request authentication\uff09\u3002\r\n\r\n## Request \u89e3\u6790\r\n\r\nREST framwork \u7684 `Request` \u5bf9\u8c61\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u8bf7\u6c42\u89e3\u6790\uff0c\u5141\u8bb8\u4f60\u4f7f\u7528 JSON data \u6216 \u5176\u4ed6 media types \u50cf\u901a\u5e38\u5904\u7406\u8868\u5355\u6570\u636e\u4e00\u6837\u5904\u7406\u8bf7\u6c42\u3002\r\n\r\n### .data\r\n\r\n`request.data` \u8fd4\u56de\u8bf7\u6c42\u4e3b\u9898\u7684\u89e3\u6790\u5185\u5bb9\u3002\u8fd9\u8ddf\u6807\u51c6\u7684 `request.POST` \u548c `request.FILES` \u7c7b\u4f3c\uff0c\u5e76\u4e14\u8fd8\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a\r\n*  \u5305\u62ec\u6240\u6709\u89e3\u6790\u7684\u5185\u5bb9\uff0c\u6587\u4ef6\uff08file\uff09 \u548c \u975e\u6587\u4ef6\uff08non-file inputs\uff09\u3002\r\n*  \u652f\u6301\u89e3\u6790 `POST` \u4ee5\u5916\u7684 HTTP method \uff0c \u6bd4\u5982 `PUT`\uff0c `PATCH`\u3002\r\n*  \u66f4\u52a0\u7075\u6d3b\uff0c\u4e0d\u4ec5\u4ec5\u652f\u6301\u8868\u5355\u6570\u636e\uff0c\u4f20\u5165\u540c\u6837\u7684 JSON \u6570\u636e\u4e00\u6837\u53ef\u4ee5\u6b63\u786e\u89e3\u6790\uff0c\u5e76\u4e14\u4e0d\u7528\u505a\u989d\u5916\u7684\u5904\u7406\uff08\u610f\u601d\u662f\u524d\u7aef\u4e0d\u7ba1\u63d0\u4ea4\u7684\u662f\u8868\u5355\u6570\u636e\uff0c\u8fd8\u662f JSON \u6570\u636e\uff0c`.data` \u90fd\u80fd\u591f\u6b63\u786e\u89e3\u6790\uff09\u3002\r\n\r\n*.data \u5177\u4f53\u64cd\u4f5c\uff0c\u4ee5\u540e\u518d\u8bf4\uff5e*\r\n\r\n### .query_params\r\n\r\n`request.query_params` \u7b49\u540c\u4e8e `request.GET`\uff0c\u4e0d\u8fc7\u5176\u540d\u5b57\u66f4\u52a0\u5bb9\u6613\u7406\u89e3\u3002\r\n\r\n\u4e3a\u4e86\u4ee3\u7801\u66f4\u52a0\u6e05\u6670\u53ef\u8bfb\uff0c\u63a8\u8350\u4f7f\u7528 `request.query_params` \uff0c\u800c\u4e0d\u662f Django \u4e2d\u7684 `request.GET`\uff0c\u8fd9\u6837\u90a3\u591f\u8ba9\u4f60\u7684\u4ee3\u7801\u66f4\u52a0\u660e\u663e\u7684\u4f53\u73b0\u51fa ----- \u4efb\u4f55 HTTP method \u7c7b\u578b\u90fd\u53ef\u80fd\u5305\u542b\u67e5\u8be2\u53c2\u6570\uff08query parameters\uff09\uff0c\u800c\u4e0d\u4ec5\u4ec5\u53ea\u662f 'GET' \u8bf7\u6c42\u3002\r\n\r\n### .parsers\r\n\r\n`APIView` \u7c7b\u6216\u8005 `@api_view` \u88c5\u9970\u5668\u5c06\u6839\u636e\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u7684 `parser_classes` \u6216 `settings` \u6587\u4ef6\u4e2d\u7684 `DEFAULT_PARSER_CLASSES` \u8bbe\u7f6e\u6765\u786e\u4fdd\u6b64\u5c5e\u6027\uff08`.parsers`\uff09\u81ea\u52a8\u8bbe\u7f6e\u4e3a `Parser` \u5b9e\u4f8b\u5217\u8868\u3002\r\n\r\n**\u901a\u5e38\u4e0d\u9700\u8981\u5173\u6ce8\u8be5\u5c5e\u6027......**\r\n\r\n\u5982\u679c\u4f60\u975e\u8981\u770b\u770b\u5b83\u91cc\u9762\u662f\u4ec0\u4e48\uff0c\u53ef\u4ee5\u6253\u5370\u51fa\u6765\u770b\u770b\uff0c\u5927\u6982\u957f\u8fd9\u6837\uff1a\r\n``` bash\r\n[<rest_framework.parsers.JSONParser object at 0x7fa850202d68>, <rest_framework.parsers.FormParser object at 0x7fa850202be0>, <rest_framework.parsers.MultiPartParser object at 0x7fa850202860>]\r\n```\r\n\u6069\uff0c\u5305\u542b\u4e09\u4e2a\u89e3\u6790\u5668 `JSONParser`\uff0c`FormParser`\uff0c`MultiPartParser`\u3002\r\n\r\n> \u6ce8\u610f\uff1a \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u683c\u5f0f\u9519\u8bef\u7684\u5185\u5bb9\uff0c\u5219\u8bbf\u95ee `request.data` \u53ef\u80fd\u4f1a\u5f15\u53d1 `ParseError` \u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c REST framework \u7684 `APIView` \u7c7b\u6216\u8005 `@api_view` \u88c5\u9970\u5668\u5c06\u6355\u83b7\u9519\u8bef\u5e76\u8fd4\u56de `400 Bad Request` \u54cd\u5e94\u3002\r\n> \u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u5185\u5bb9\u65e0\u6cd5\u89e3\u6790\uff08\u4e0d\u540c\u4e8e\u683c\u5f0f\u9519\u8bef\uff09\uff0c\u5219\u4f1a\u5f15\u53d1 `UnsupportedMediaType` \u5f02\u5e38\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u88ab\u6355\u83b7\u5e76\u8fd4\u56de `415 Unsupported Media Type` \u54cd\u5e94\u3002\r\n\r\n\r\n## \u5185\u5bb9\u534f\u5546\r\n\r\n\u8be5\u8bf7\u6c42\u516c\u5f00\u4e86\u4e00\u4e9b\u5c5e\u6027\uff0c\u5141\u8bb8\u4f60\u786e\u5b9a\u5185\u5bb9\u534f\u5546\u9636\u6bb5\u7684\u7ed3\u679c\u3002\u8fd9\u4f7f\u4f60\u53ef\u4ee5\u5b9e\u65bd\u4e00\u4e9b\u884c\u4e3a\uff0c\u4f8b\u5982\u4e3a\u4e0d\u540c\u5a92\u4f53\u7c7b\u578b\u9009\u62e9\u4e0d\u540c\u7684\u5e8f\u5217\u5316\u65b9\u6848\u3002\r\n\r\n### .accepted_renderer\r\n\r\n\u6e32\u67d3\u5668\u5b9e\u4f8b\u662f\u7531\u5185\u5bb9\u534f\u5546\u9636\u6bb5\u9009\u62e9\u7684\u3002\r\n\r\n### .accepted_media_type\r\n\r\n\u8868\u793a\u5185\u5bb9\u534f\u5546\u9636\u6bb5\u63a5\u53d7\u7684 media type \u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n## \u8ba4\u8bc1\uff08Authentication\uff09\r\n\r\nREST framework \u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff1a\r\n* \u53ef\u4ee5\u5728 API \u7684\u4e0d\u540c\u90e8\u5206\u4f7f\u7528\u4e0d\u540c\u7684\u8ba4\u8bc1\u7b56\u7565\u3002\r\n* \u652f\u6301\u540c\u65f6\u4f7f\u7528\u591a\u4e2a\u8eab\u4efd\u9a8c\u8bc1\u7b56\u7565\u3002\r\n* \u63d0\u4f9b\u4e0e\u4f20\u5165\u8bf7\u6c42\u5173\u8054\u7684\u7528\u6237\uff08user\uff09\u548c\u4ee4\u724c\uff08token\uff09\u4fe1\u606f\u3002\r\n\r\n### .user\r\n\r\n`request.user` \u901a\u5e38\u4f1a\u8fd4\u56de `django.contrib.auth.models.User` \u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u4f46\u5176\u884c\u4e3a\u53d6\u51b3\u4e8e\u6b63\u5728\u4f7f\u7528\u7684\u8eab\u4efd\u9a8c\u8bc1\u7b56\u7565\u3002\r\n\r\n\u5982\u679c\u8bf7\u6c42\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5219 `request.user` \u7684\u9ed8\u8ba4\u503c\u662f `django.contrib.auth.models.AnonymousUser` \u7684\u5b9e\u4f8b\uff08\u5c31\u662f\u533f\u540d\u7528\u6237\uff09\u3002\r\n\r\n*\u5173\u4e8e `.user` \u7684\u66f4\u591a\u5185\u5bb9\uff0c\u4ee5\u540e\u518d\u8bf4\uff5e*\r\n\r\n### .auth\r\n\r\n`request.auth` \u8fd4\u56de\u4efb\u4f55\u9644\u52a0\u7684\u8ba4\u8bc1\u4e0a\u4e0b\u6587\uff08authentication context\uff09\u3002`request.auth` \u7684\u786e\u5207\u884c\u4e3a\u53d6\u51b3\u4e8e\u6b63\u5728\u4f7f\u7528\u7684\u8eab\u4efd\u9a8c\u8bc1\u7b56\u7565\uff0c\u4f46\u5b83\u901a\u5e38\u53ef\u80fd\u662f\u8bf7\u6c42\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u4ee4\u724c\uff08token\uff09\u5b9e\u4f8b\u3002\r\n\r\n\u5982\u679c\u8bf7\u6c42\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\uff0c\u6216\u8005\u6ca1\u6709\u9644\u52a0\u4e0a\u4e0b\u6587\uff08context\uff09\uff0c\u5219 `request.auth` \u7684\u9ed8\u8ba4\u503c\u4e3a `None`\u3002\r\n\r\n*\u5173\u4e8e `.auth` \u7684\u66f4\u591a\u5185\u5bb9\uff0c\u4ee5\u540e\u518d\u8bf4\uff5e*\r\n\r\n### .authenticators\r\n\r\n`APIView` \u7c7b\u6216 `@api_view` \u88c5\u9970\u5668\u5c06\u786e\u4fdd\u6839\u636e\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u7684 `authentication_classes` \u6216\u57fa\u4e8e `settings` \u6587\u4ef6\u4e2d\u7684 `DEFAULT_AUTHENTICATORS` \u8bbe\u7f6e\u5c06\u6b64\u5c5e\u6027\uff08`.authenticators`\uff09\u81ea\u52a8\u8bbe\u7f6e\u4e3a `Authentication` \u5b9e\u4f8b\u5217\u8868\u3002\r\n\r\n**\u901a\u5e38\u4e0d\u9700\u8981\u5173\u6ce8\u8be5\u5c5e\u6027...... **\r\n\r\n> \u6ce8\u610f\uff1a\u8c03\u7528 `.user` \u6216 `.auth` \u5c5e\u6027\u65f6\u53ef\u80fd\u4f1a\u5f15\u53d1 `WrappedAttributeError` \u5f02\u5e38\u3002\u8fd9\u4e9b\u9519\u8bef\u6e90\u4e8e authenticator  \u4f5c\u4e3a\u4e00\u4e2a\u6807\u51c6\u7684 `AttributeError` \uff0c\u4e3a\u4e86\u9632\u6b62\u5b83\u4eec\u88ab\u5916\u90e8\u5c5e\u6027\u8bbf\u95ee\u4fee\u6539\uff0c\u6709\u5fc5\u8981\u91cd\u65b0\u63d0\u5347\u4e3a\u4e0d\u540c\u7684\u5f02\u5e38\u7c7b\u578b\u3002Python \u65e0\u6cd5\u8bc6\u522b\u6765\u81ea authenticator  \u7684 `AttributeError`\uff0c\u5e76\u4f1a\u7acb\u5373\u5047\u5b9a\u8bf7\u6c42\u5bf9\u8c61\u6ca1\u6709 `.user` \u6216 `.auth` \u5c5e\u6027\u3002authenticator \u9700\u8981\u4fee\u590d\u3002\r\n\r\n\u591a\u8bf4\u51e0\u53e5\r\n\r\n`.authenticators` \u5176\u5b9e\u5b58\u7684\u5c31\u662f\u5f53\u524d\u4f7f\u7528\u7684\u8ba4\u8bc1\u5668\uff08authenticator\uff09\u5217\u8868\uff0c\u6253\u5370\u51fa\u6765\u5927\u6982\u662f\u8fd9\u6837\uff1a\r\n\r\n``` bash\r\n[<rest_framework.authentication.SessionAuthentication object at 0x7f8ae4528710>, <rest_framework.authentication.BasicAuthentication object at 0x7f8ae45286d8>]\r\n```\r\n\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u4f7f\u7528\u7684\u8ba4\u8bc1\u5668\uff08authenticator\uff09\u5305\u62ec `SessionAuthentication` \u548c `BasicAuthentication`\u3002\r\n\r\n## \u6d4f\u89c8\u5668\u589e\u5f3a\r\n\r\nREST framework \u652f\u6301\u57fa\u4e8e\u6d4f\u89c8\u5668\u7684 `PUT`\uff0c`PATCH`\uff0c`DELETE` \u8868\u5355\u3002\r\n\r\n### .method\r\n\r\n`request.method` \u8fd4\u56de\u8bf7\u6c42 HTTP \u65b9\u6cd5\u7684\u5927\u5199\u5b57\u7b26\u4e32\u8868\u793a\u5f62\u5f0f\u3002\u5982 `GET`,`POST`...\u3002\r\n\r\n\u900f\u660e\u5730\u652f\u6301\u57fa\u4e8e\u6d4f\u89c8\u5668\u7684 `PUT`\uff0c`PATCH` \u548c `DELETE` \u8868\u5355\u3002\r\n\r\n*\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u4ee5\u540e\u518d\u8bf4\uff5e*\r\n\r\n### .content_type\r\n\r\n`request.content_type` \u8fd4\u56de\u8868\u793a HTTP \u8bf7\u6c42\u6b63\u6587\u7684\u5a92\u4f53\u7c7b\u578b\uff08media type\uff09\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\uff08\u6bd4\u5982\uff1a `text/plain` , `text/html` \u7b49\uff09\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u5a92\u4f53\u7c7b\u578b\uff0c\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002\r\n\r\n\u901a\u5e38\u4e0d\u9700\u8981\u76f4\u63a5\u8bbf\u95ee\u6b64\u5c5e\u6027\uff0c\u4e00\u822c\u90fd\u4f9d\u8d56\u4e0e REST \u6846\u67b6\u7684\u9ed8\u8ba4\u8bf7\u6c42\u89e3\u6790\u884c\u4e3a\u3002\r\n\r\n\u4e0d\u5efa\u8bae\u4f7f\u7528 `request.META.get('HTTP_CONTENT_TYPE')` \u6765\u83b7\u53d6 content type \u3002\r\n\r\n*\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u4ee5\u540e\u518d\u8bf4\uff5e*\r\n\r\n### .stream\r\n\r\n`request.stream` \u8fd4\u56de\u4e00\u4e2a\u4ee3\u8868\u8bf7\u6c42\u4e3b\u4f53\u5185\u5bb9\u7684\u6d41\u3002\r\n\r\n\u901a\u5e38\u4e0d\u9700\u8981\u76f4\u63a5\u8bbf\u95ee\u6b64\u5c5e\u6027\uff0c\u4e00\u822c\u90fd\u4f9d\u8d56\u4e0e REST \u6846\u67b6\u7684\u9ed8\u8ba4\u8bf7\u6c42\u89e3\u6790\u884c\u4e3a\u3002\r\n\r\n## \u6807\u51c6\u7684 HttpRequest \u5c5e\u6027\r\n\r\n\u7531\u4e8e REST framework \u7684 `Request ` \u6269\u5c55\u4e8e Django \u7684 `HttpRequest`\uff0c\u6240\u6709\u5176\u4ed6\u6807\u51c6\u5c5e\u6027\u548c\u65b9\u6cd5\u4e5f\u53ef\u7528\u3002\u4f8b\u5982`request.META` \u548c `request.session` \u5b57\u5178\u90fd\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u7531\u4e8e\u5b9e\u73b0\u539f\u56e0\uff0c`Request` \u7c7b\u4e0d\u4f1a\u4ece `HttpRequest` \u7c7b\u7ee7\u627f\uff0c\u800c\u662f\u4f7f\u7528\u7ec4\u5408\u6269\u5c55\u7c7b\uff08\u4f18\u5148\u4f7f\u7528\u7ec4\u5408\uff0c\u800c\u975e\u7ee7\u627f\uff0c\u6069\uff0c\u8001\u94c1\u6ca1\u6bdb\u75c5 0.0\uff09\r\n", "md_File": "subject/django-rest-framework-api-guide/requests.md", "create_date": "2020-02-20T13:10:40.718", "order": 1}}, {"model": "subject.chapter", "pk": 158, "fields": {"title": "\u54cd\u5e94responses", "topic": 7, "md5": "b73623de58bcbc1994096c298b06a230", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/responses/)\r\n\r\n## Responses\r\n\r\n> \u4e0e\u57fa\u672c\u7684 HttpResponse \u5bf9\u8c61\u4e0d\u540c\uff0cTemplateResponse \u5bf9\u8c61\u4fdd\u7559\u4e86\u89c6\u56fe\u63d0\u4f9b\u7684\u7528\u4e8e\u8ba1\u7b97\u54cd\u5e94\u7684\u4e0a\u4e0b\u6587\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u76f4\u5230\u9700\u8981\u65f6\u624d\u4f1a\u8ba1\u7b97\u6700\u7ec8\u7684\u54cd\u5e94\u8f93\u51fa\uff0c\u4e5f\u5c31\u662f\u5728\u540e\u9762\u7684\u54cd\u5e94\u8fc7\u7a0b\u4e2d\u8fdb\u884c\u8ba1\u7b97\u3002\r\n> \u2014 *Django \u6587\u6863*\r\n\r\nREST framework \u901a\u8fc7\u63d0\u4f9b\u4e00\u4e2a `Response` \u7c7b\u6765\u652f\u6301 HTTP \u5185\u5bb9\u534f\u5546\uff0c\u8be5\u7c7b\u5141\u8bb8\u4f60\u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u8fd4\u56de\u4e0d\u540c\u7684\u8868\u73b0\u5f62\u5f0f\uff08\u5982\uff1a JSON \uff0cHTML \u7b49\uff09\u3002\r\n\r\n`Response` \u662f Django \u7684 `SimpleTemplateResponse` \u7684\u5b50\u7c7b\u3002`Response` \u5bf9\u8c61\u4f7f\u7528\u6570\u636e\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u6570\u636e\u5e94\u7531 Python \u5bf9\u8c61\uff08native Python primitives\uff09\u7ec4\u6210\u3002\u7136\u540e REST framework \u4f7f\u7528\u6807\u51c6\u7684 HTTP \u5185\u5bb9\u534f\u5546\u6765\u786e\u5b9a\u5b83\u5e94\u8be5\u5982\u4f55\u6e32\u67d3\u6700\u7ec8\u54cd\u5e94\u7684\u5185\u5bb9\u3002\r\n\r\n\r\n\u5f53\u7136\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4e0d\u4f7f\u7528 `Response` \u7c7b\uff0c\u76f4\u63a5\u8fd4\u56de\u5e38\u89c4 `HttpResponse` \u6216 `StreamingHttpResponse` \u5bf9\u8c61\u3002 \u4f7f\u7528 `Response` \u7c7b\u53ea\u662f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u597d\u7684\u4ea4\u4e92\u65b9\u5f0f\uff0c\u5b83\u53ef\u4ee5\u8fd4\u56de\u591a\u79cd\u683c\u5f0f\u3002\r\n\r\n\r\n\u9664\u975e\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u9700\u8981\u5927\u5e45\u5ea6\u5b9a\u5236 REST framework \uff0c\u5426\u5219\u5e94\u8be5\u59cb\u7ec8\u5bf9\u8fd4\u56de `Response` \u5bf9\u8c61\u7684\u89c6\u56fe\u4f7f\u7528 `APIView` \u7c7b\u6216 `@api_view` \u88c5\u9970\u5668\u3002\u8fd9\u6837\u505a\u53ef\u4ee5\u786e\u4fdd\u89c6\u56fe\u6267\u884c\u5185\u5bb9\u534f\u5546\uff0c\u5e76\u5728\u89c6\u56fe\u8fd4\u56de\u4e4b\u524d\u4e3a\u54cd\u5e94\u9009\u62e9\u9002\u5f53\u7684\u6e32\u67d3\u5668\u3002\r\n\r\n\r\n## \u521b\u5efa response\r\n\r\n### Response()\r\n\r\n\u4e0e\u666e\u901a `HttpResponse` \u5bf9\u8c61\u4e0d\u540c\uff0c\u60a8\u4e0d\u4f1a\u4f7f\u7528\u6e32\u67d3\u7684\u5185\u5bb9\u5b9e\u4f8b\u5316 `Response` \u5bf9\u8c61\u3002\u76f8\u53cd\uff0c\u60a8\u4f20\u9012\u7684\u662f\u672a\u6e32\u67d3\u7684\u6570\u636e\uff0c\u53ef\u80fd\u5305\u542b\u4efb\u4f55 Python \u5bf9\u8c61\u3002\r\n\r\n\u7531\u4e8e `Response` \u7c7b\u4f7f\u7528\u7684\u6e32\u67d3\u5668\u4e0d\u80fd\u5904\u7406\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\uff08\u6bd4\u5982 Django \u7684\u6a21\u578b\u5b9e\u4f8b\uff09\uff0c\u6240\u4ee5\u9700\u8981\u5728\u521b\u5efa `Response` \u5bf9\u8c61\u4e4b\u524d\u5c06\u6570\u636e\u5e8f\u5217\u5316\u4e3a\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\u3002\r\n\r\n\u4f60\u53ef\u4ee5\u4f7f\u7528 REST framework \u7684 `Serializer ` \u7c7b\u6765\u6267\u884c\u5e8f\u5217\u5316\u7684\u64cd\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u7528\u81ea\u5df1\u7684\u65b9\u5f0f\u6765\u5e8f\u5217\u5316\u3002\r\n\r\n\r\n**\u6784\u9020\u65b9\u6cd5**: `Response(data, status=None, template_name=None, headers=None, content_type=None)`  \r\n\r\n\r\n\u53c2\u6570\uff1a\r\n * `data`\uff1a \u54cd\u5e94\u7684\u5e8f\u5217\u5316\u6570\u636e\u3002\r\n * `status`\uff1a \u54cd\u5e94\u7684\u72b6\u6001\u4ee3\u7801\u3002\u9ed8\u8ba4\u4e3a200\u3002\r\n * `template_name`\uff1a \u9009\u62e9 `HTMLRenderer` \u65f6\u4f7f\u7528\u7684\u6a21\u677f\u540d\u79f0\u3002\r\n * `headers`\uff1a \u8bbe\u7f6e HTTP header\uff0c\u5b57\u5178\u7c7b\u578b\u3002\r\n * `content_type`\uff1a \u54cd\u5e94\u7684\u5185\u5bb9\u7c7b\u578b\uff0c\u901a\u5e38\u6e32\u67d3\u5668\u4f1a\u6839\u636e\u5185\u5bb9\u534f\u5546\u7684\u7ed3\u679c\u81ea\u52a8\u8bbe\u7f6e\uff0c\u4f46\u6709\u4e9b\u65f6\u5019\u9700\u8981\u624b\u52a8\u6307\u5b9a\u3002\r\n\r\n\r\n## \u5c5e\u6027\r\n\r\n### .data\r\n\r\n\u8fd8\u6ca1\u6709\u6e32\u67d3\uff0c\u4f46\u5df2\u7ecf\u5e8f\u5217\u5316\u7684\u54cd\u5e94\u6570\u636e\u3002\r\n\r\n### .status_code\r\n\r\n\u72b6\u6001\u7801\r\n\r\n### .content\r\n\r\n\u5c06\u4f1a\u8fd4\u56de\u7684\u54cd\u5e94\u5185\u5bb9\uff0c\u5fc5\u987b\u5148\u8c03\u7528 `.render()` \u65b9\u6cd5\uff0c\u624d\u80fd\u8bbf\u95ee `.content` \u3002\r\n\r\n### .template_name\r\n\r\n\u53ea\u6709\u5728 response \u7684\u6e32\u67d3\u5668\u662f `HTMLRenderer` \u6216\u5176\u4ed6\u81ea\u5b9a\u4e49\u6a21\u677f\u6e32\u67d3\u5668\u65f6\u624d\u9700\u8981\u63d0\u4f9b\u3002\r\n\r\n### .accepted_renderer\r\n\r\n\u7528\u4e8e\u5c06\u4f1a\u8fd4\u56de\u7684\u54cd\u5e94\u5185\u5bb9\u7684\u6e32\u67d3\u5668\u5b9e\u4f8b\u3002\r\n\r\n\u4ece\u89c6\u56fe\u8fd4\u56de\u54cd\u5e94\u4e4b\u524d\u7531 `APIView` \u6216 `@api_view` \u81ea\u52a8\u8bbe\u7f6e\u3002\r\n\r\n### .accepted_media_type\r\n\r\n\u5185\u5bb9\u534f\u5546\u9636\u6bb5\u9009\u62e9\u7684\u5a92\u4f53\u7c7b\u578b\u3002\r\n\r\n\u4ece\u89c6\u56fe\u8fd4\u56de\u54cd\u5e94\u4e4b\u524d\u7531 `APIView` \u6216 `@api_view` \u81ea\u52a8\u8bbe\u7f6e\u3002\r\n\r\n### .renderer_context\r\n\r\n\u5c06\u4f20\u9012\u7ed9\u6e32\u67d3\u5668\u7684 `.render()` \u65b9\u6cd5\u7684\u9644\u52a0\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u5b57\u5178\u3002\r\n\r\n\u4ece\u89c6\u56fe\u8fd4\u56de\u54cd\u5e94\u4e4b\u524d\u7531 `APIView` \u6216 `@api_view` \u81ea\u52a8\u8bbe\u7f6e\u3002\r\n\r\n## \u6807\u51c6 HttpResponse \u5c5e\u6027\r\n\r\n`Response` \u7c7b\u6269\u5c55\u4e8e `SimpleTemplateResponse`\uff0c\u5e76\u4e14\u54cd\u5e94\u4e2d\u4e5f\u63d0\u4f9b\u4e86\u6240\u6709\u5e38\u7528\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u7528\u6807\u51c6\u65b9\u5f0f\u5728\u54cd\u5e94\u4e2d\u8bbe\u7f6e header\uff1a\r\n``` python\r\nresponse = Response()\r\nresponse['Cache-Control'] = 'no-cache'\r\n```\r\n\r\n### .render()\r\n\r\n\u4e0e\u5176\u4ed6\u4efb\u4f55 `TemplateResponse` \u4e00\u6837\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5\u5c06\u54cd\u5e94\u7684\u5e8f\u5217\u5316\u6570\u636e\u5448\u73b0\u4e3a\u6700\u7ec8\u54cd\u5e94\u5185\u5bb9\u3002\u54cd\u5e94\u5185\u5bb9\u5c06\u8bbe\u7f6e\u4e3a\u5728 `accepted_renderer` \u5b9e\u4f8b\u4e0a\u8c03\u7528 `.render(data\uff0caccepted_media_type\uff0crenderer_context)` \u65b9\u6cd5\u7684\u7ed3\u679c\u3002\r\n\r\n\u901a\u5e38\u4e0d\u9700\u8981\u81ea\u5df1\u8c03\u7528 `.render()` \uff0c\u56e0\u4e3a\u5b83\u662f\u7531 Django \u5904\u7406\u7684\u3002\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/responses.md", "create_date": "2020-02-20T13:10:40.732", "order": 2}}, {"model": "subject.chapter", "pk": 159, "fields": {"title": "reverse", "topic": 7, "md5": "8d43fc7c5c309fd954d8fe2761873783", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/reverse/)  \r\n\r\n\r\n# \u8fd4\u56de URL\r\n\r\n\r\n\u901a\u5e38\uff0c\u4ece Web API\uff08\u4f8b\u5982 `http://example.com/foobar`\uff09\u8fd4\u56de\u7edd\u5bf9 URI \u53ef\u80fd\u662f\u66f4\u597d\u7684\u505a\u6cd5\uff0c\u800c\u4e0d\u662f\u8fd4\u56de\u76f8\u5bf9 URI\uff0c\u4f8b\u5982 `/foobar`\u3002\r\n\r\n\u8fd9\u6837\u505a\u7684\u597d\u5904\u6709\uff1a\r\n\r\n* \u5b83\u66f4\u660e\u786e\u3002\r\n* \u5b83\u4e3a\u4f60\u7684 API \u5ba2\u6237\u7aef\u7559\u4e0b\u66f4\u5c11\u7684\u5de5\u4f5c\u3002\r\n* \u5f53\u5b57\u7b26\u4e32\u5728\u8bf8\u5982 JSON \u8fd9\u6837\u7684\u8868\u793a\u4e2d\u6ca1\u6709\u672c\u5730 URI \u7c7b\u578b\u65f6\uff0c\u5b83\u7684\u542b\u4e49\u662f\u6ca1\u6709\u6b67\u4e49\u7684\u3002\r\n* \u5b83\u4f7f\u5f97\u4f7f\u7528\u8d85\u94fe\u63a5\u6807\u8bb0 HTML \u8868\u793a\u7b49\u4e8b\u60c5\u53d8\u5f97\u5f88\u5bb9\u6613\u3002\r\n\r\nREST framework \u63d0\u4f9b\u4e86\u4e24\u4e2a\u5b9e\u7528\u51fd\u6570\uff0c\u53ef\u4ee5\u66f4\u7b80\u5355\u5730\u4ece Web API \u8fd4\u56de\u7edd\u5bf9 URI\u3002\r\n\r\n\u4f7f\u7528\u5b83\u4eec\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4f46\u662f\u5982\u679c\u4f60\u8fd9\u6837\u505a\uff0c\u81ea\u63cf\u8ff0 API \u5c06\u80fd\u591f\u81ea\u52a8\u4e3a\u4f60\u8f93\u51fa\u8d85\u94fe\u63a5\uff0c\u8fd9\u4f7f\u5f97\u6d4f\u89c8 API \u53d8\u5f97\u66f4\u5bb9\u6613\u3002\r\n\r\n## reverse\r\n\r\n**\u7b7e\u540d:** `reverse(viewname, *args, **kwargs)`\r\n\r\n\u5177\u6709\u4e0e `django.urls.reverse` \u76f8\u540c\u7684\u884c\u4e3a\uff0c\u9664\u4e86\u5b83\u8fd4\u56de\u4e00\u4e2a\u5b8c\u5168\u9650\u5b9a\u7684 URL\uff0c\u4f7f\u7528 request \u6765\u786e\u5b9a\u4e3b\u673a\u548c\u7aef\u53e3\u3002\r\n\r\n\u4f60\u5e94\u8be5\u5c06 request \u4f5c\u4e3a\u5173\u952e\u5b57\u53c2\u6570\u5305\u542b\u5728\u8be5\u51fd\u6570\u4e2d\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom rest_framework.reverse import reverse\r\nfrom rest_framework.views import APIView\r\nfrom django.utils.timezone import now\r\n\r\nclass APIRootView(APIView):\r\n    def get(self, request):\r\n        year = now().year\r\n        data = {\r\n            ...\r\n            'year-summary-url': reverse('year-summary', args=[year], request=request)\r\n        }\r\n        return Response(data)\r\n```\r\n\r\n## reverse_lazy\r\n\r\n**\u7b7e\u540d:** `reverse_lazy(viewname, *args, **kwargs)`\r\n\r\n\u5177\u6709\u4e0e `django.urls.reverse_lazy` \u76f8\u540c\u7684\u884c\u4e3a\uff0c\u9664\u4e86\u5b83\u8fd4\u56de\u4e00\u4e2a\u5b8c\u5168\u9650\u5b9a\u7684 URL\uff0c\u4f7f\u7528 request \u6765\u786e\u5b9a\u4e3b\u673a\u548c\u7aef\u53e3\u3002\r\n\r\n\u4e0e `reverse` \u51fd\u6570\u4e00\u6837\uff0c\u4f60\u5e94\u8be5\u5c06 `request` \u4f5c\u4e3a\u5173\u952e\u5b57\u53c2\u6570\u5305\u542b\u5728\u51fd\u6570\u4e2d\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\napi_root = reverse_lazy('api-root', request=request)\r\n```", "md_File": "subject/django-rest-framework-api-guide/reverse.md", "create_date": "2020-02-20T13:10:40.746", "order": 23}}, {"model": "subject.chapter", "pk": 160, "fields": {"title": "\u8def\u7531routers", "topic": 7, "md5": "9d6f5411580672d0e5513f72cf7cd61d", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/routers/)\r\n\r\n## \u8def\u7531\r\n\r\n\r\n\u4e00\u4e9b Web \u6846\u67b6\uff08\u5982 Rails\uff09\u63d0\u4f9b\u4e86\u4e00\u79cd\u80fd\u591f\u81ea\u52a8\u786e\u5b9a\u5e94\u7528\u7a0b\u5e8f\u7684 URL \u5982\u4f55\u6620\u5c04\u5230\u5904\u7406\u8bf7\u6c42\u7684\u529f\u80fd\u3002\r\n\r\nREST framework \u589e\u52a0\u4e86\u5bf9 Django \u81ea\u52a8 URL \u8def\u7531\u7684\u652f\u6301\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u79cd\u5c06\u89c6\u56fe\u903b\u8f91\u8fde\u63a5\u5230\u4e00\u7ec4 URL \u7684\u7b80\u5355\uff0c\u9ad8\u6548\u548c\u4e00\u81f4\u7684\u65b9\u5f0f\u3002\r\n\r\n### \u7528\u6cd5\r\n\r\n\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 `SimpleRouter` \u7684\u7b80\u5355 URL \u914d\u7f6e\u793a\u4f8b\u3002\r\n\r\n``` python\r\nfrom rest_framework import routers\r\n\r\nrouter = routers.SimpleRouter()\r\nrouter.register(r'users', UserViewSet)\r\nrouter.register(r'accounts', AccountViewSet)\r\nurlpatterns = router.urls\r\n```\r\n\r\n`register()` \u65b9\u6cd5\u6709\u4e24\u4e2a\u5fc5\u987b\u53c2\u6570\uff1a  \r\n * `prefix` - \u8bbe\u7f6e\u8fd9\u7ec4\u8def\u7531\u7684\u524d\u7f00\u3002\r\n * `viewset` - \u8bbe\u7f6e\u5bf9\u5e94\u7684\u89c6\u56fe\u96c6\u7c7b\u3002\r\n\r\n\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u9644\u52a0\u53c2\u6570\uff1a  \r\n\r\n * `base_name` - \u7528\u4e8e\u521b\u5efa\u7684 URL \u540d\u79f0\u7684\u57fa\u7840\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5c06\u6839\u636e\u89c6\u56fe\u96c6\u7684 `queryset` \u5c5e\u6027\u81ea\u52a8\u751f\u6210\u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u89c6\u56fe\u96c6\u4e0d\u5305\u542b `queryset` \u5c5e\u6027\uff0c\u5219\u5728\u6ce8\u518c\u89c6\u56fe\u96c6\u65f6\u5fc5\u987b\u8bbe\u7f6e `base_name`\u3002\r\n\r\n\r\n\u4e0a\u9762\u7684\u4f8b\u5b50\u4f1a\u751f\u6210\u4ee5\u4e0b URL \u6a21\u5f0f\uff1a  \r\n\r\n* URL pattern: `^users/$` Name:  `'user-list'`  \r\n* URL pattern: `^users/{pk}/$` Name:  `'user-detail'`  \r\n* URL pattern: `^accounts/$` Name:  `'account-list'`  \r\n* URL pattern: `^accounts/{pk}/$` Name:  `'account-detail'`  \r\n\r\n> \u6ce8\u610f\uff1a`base_name` \u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u89c6\u56fe\u540d\u79f0\u6a21\u5f0f\u7684\u521d\u59cb\u90e8\u5206\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u662f `user` \u6216 `account` \u90e8\u5206\u3002\r\n\r\n\u901a\u5e38\uff0c\u60a8\u4e0d\u9700\u8981\u6307\u5b9a `base_name` \u53c2\u6570\uff0c\u4f46\u662f\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u89c6\u56fe\u96c6\u5b9a\u4e49\u4e86\u81ea\u5b9a\u4e49 `get_queryset` \u65b9\u6cd5\uff0c\u90a3\u4e48\u8be5\u89c6\u56fe\u96c6\u53ef\u80fd\u6ca1\u6709\u8bbe\u7f6e `.queryset` \u5c5e\u6027\u3002\u5982\u679c\u6b64\u65f6\u5c1d\u8bd5\u6ce8\u518c\u8be5\u89c6\u56fe\uff0c\u5219\u4f1a\u770b\u5230\u5982\u4e0b\u6240\u793a\u7684\u9519\u8bef\uff1a\r\n\r\n``` text\r\n'base_name' argument not specified, and could not automatically determine the name from the viewset, as it does not have a '.queryset' attribute.\r\n```\r\n> `'base_name'` \u53c2\u6570\u672a\u6307\u5b9a\uff0c\u5e76\u4e14\u65e0\u6cd5\u81ea\u52a8\u786e\u5b9a\u89c6\u56fe\u4e2d\u7684\u540d\u79f0\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709' `.queryset'` \u5c5e\u6027\u3002\r\n\r\n\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u5728\u6ce8\u518c\u89c6\u56fe\u96c6\u65f6\u663e\u5f0f\u8bbe\u7f6e `base_name` \u53c2\u6570\uff0c\u56e0\u4e3a\u5b83\u65e0\u6cd5\u4ece\u6a21\u578b\u540d\u79f0\u4e2d\u81ea\u52a8\u786e\u5b9a\u3002\r\n\r\n\r\n#### \u4f7f\u7528 `include` \u4e0e\u8def\u7531\r\n\r\n\u8def\u7531\u5b9e\u4f8b\u4e0a\u7684 `.urls` \u5c5e\u6027\u662f\u4e00\u4e2a\u6807\u51c6\u7684 URL patterns\u3002\u5173\u4e8e\u5982\u4f55\u5305\u542b\u8fd9\u4e9b URL\uff0c\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u6837\u5f0f\u3002\r\n\r\n\u4f8b\u5982\uff0c\u53ef\u4ee5\u5c06 `router.urls` \u9644\u52a0\u5230\u73b0\u6709\u89c6\u56fe\u7684\u5217\u8868\u4e2d...\r\n\r\n\r\n``` python\r\nrouter = routers.SimpleRouter()\r\nrouter.register(r'users', UserViewSet)\r\nrouter.register(r'accounts', AccountViewSet)\r\n\r\nurlpatterns = [\r\n    url(r'^forgot-password/$', ForgotPasswordFormView.as_view()),\r\n]\r\n\r\nurlpatterns += router.urls\r\n```\r\n\r\n\u53e6\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 Django \u7684 `include` \u51fd\u6570\uff0c\u6bd4\u5982...\r\n\r\n``` python\r\nurlpatterns = [\r\n    url(r'^forgot-password/$', ForgotPasswordFormView.as_view()),\r\n    url(r'^', include(router.urls)),\r\n]\r\n```\r\n\u8fd8\u53ef\u4ee5\u8bbe\u7f6e namespace\u3002\r\n\r\n``` python\r\nurlpatterns = [\r\n    url(r'^forgot-password/$', ForgotPasswordFormView.as_view()),\r\n    url(r'^api/', include(router.urls, namespace='api')),\r\n]\r\n```\r\n\r\n\u5982\u679c\u5bf9\u8d85\u94fe\u63a5\u5e8f\u5217\u5316\u5668\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\uff0c\u5219\u8fd8\u9700\u8981\u786e\u4fdd\u5e8f\u5217\u5316\u5668\u4e0a\u7684\u4efb\u4f55 `view_name` \u53c2\u6570\u90fd\u80fd\u6b63\u786e\u53cd\u6620\u547d\u540d\u7a7a\u95f4\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u60a8\u9700\u8981\u4e3a\u8d85\u94fe\u63a5\u5230\u7528\u6237\u8be6\u7ec6\u4fe1\u606f\u89c6\u56fe\u7684\u5e8f\u5217\u5316\u7a0b\u5e8f\u5b57\u6bb5\u5305\u542b\u8bf8\u5982 `view_name='api:user-detail'` \u4e4b\u7c7b\u7684\u53c2\u6570\u3002\r\n\r\n#### \u989d\u5916\u7684\u94fe\u63a5\u548c\u64cd\u4f5c\r\n\r\n\u7528 `@detail_route` \u6216 `@list_route` \u88c5\u9970\u7684 \u89c6\u56fe\u4e0a\u7684\u4efb\u4f55\u65b9\u6cd5 \u4e5f\u5c06\u88ab\u8def\u7531\u3002\u4f8b\u5982\uff0c\u5728 `UserViewSet` \u7c7b\u4e2d\u7ed9\u51fa\u8fd9\u6837\u7684\u65b9\u6cd5\uff1a\r\n\r\n``` python\r\nfrom myapp.permissions import IsAdminOrIsSelf\r\nfrom rest_framework.decorators import detail_route\r\n\r\nclass UserViewSet(ModelViewSet):\r\n    ...\r\n\r\n    @detail_route(methods=['post'], permission_classes=[IsAdminOrIsSelf])\r\n    def set_password(self, request, pk=None):\r\n        ...\r\n```\r\n\r\n\u4f1a\u751f\u6210\u4ee5\u4e0bURL\u6a21\u5f0f\uff1a\r\n* URL pattern:  `^users/{pk}/set_password/$` Name:  `'user-set-password'`\r\n\r\n\r\n\u5982\u679c\u60a8\u4e0d\u60f3\u4f7f\u7528\u9ed8\u8ba4\u751f\u6210\u7684 URL \u6a21\u5f0f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 url_path \u53c2\u6570\u5bf9\u5176\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u5c06\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u64cd\u4f5c\u7684URL\u66f4\u6539\u4e3a `^users/{pk}/change-password/$`\uff0c\u5219\u53ef\u4ee5\u7f16\u5199\uff1a\r\n\r\n``` python\r\nfrom myapp.permissions import IsAdminOrIsSelf\r\nfrom rest_framework.decorators import detail_route\r\n\r\nclass UserViewSet(ModelViewSet):\r\n    ...\r\n\r\n    @detail_route(methods=['post'], permission_classes=[IsAdminOrIsSelf], url_path='change-password')\r\n    def set_password(self, request, pk=None):\r\n        ...\r\n```\r\n\r\n\u4e0a\u9762\u7684\u4f8b\u5b50\u73b0\u5728\u5c06\u751f\u6210\u4ee5\u4e0bURL\u6a21\u5f0f\uff1a\r\n\r\n* URL pattern:  `^users/{pk}/change-password/$` Name:  `'user-change-password'`\r\n\r\n\u5982\u679c\u60a8\u4e0d\u60f3\u4f7f\u7528\u751f\u6210\u7684\u9ed8\u8ba4\u540d\u79f0\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 url_name \u53c2\u6570\u5bf9\u5176\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u5c06\u81ea\u5b9a\u4e49\u64cd\u4f5c\u7684\u540d\u79f0\u66f4\u6539\u4e3a `'user-change-password'`\uff0c\u5219\u53ef\u4ee5\u7f16\u5199\uff1a\r\n\r\n``` python\r\nfrom myapp.permissions import IsAdminOrIsSelf\r\nfrom rest_framework.decorators import detail_route\r\n\r\nclass UserViewSet(ModelViewSet):\r\n    ...\r\n\r\n    @detail_route(methods=['post'], permission_classes=[IsAdminOrIsSelf], url_name='change-password')\r\n    def set_password(self, request, pk=None):\r\n        ...\r\n```\r\n\r\n\u4e0a\u9762\u7684\u4f8b\u5b50\u73b0\u5728\u5c06\u751f\u6210\u4ee5\u4e0bURL\u6a21\u5f0f\uff1a\r\n\r\n* URL pattern:  `^users/{pk}/set_password/$`  Name: `'user-change-password'`\r\n\r\n\r\n\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528 `url_path` \u548c `url_name` \u53c2\u6570\u3002\r\n\r\n\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u8bf7\u770b [\u89c6\u56fe\u96c6\uff1a\u6807\u8bb0\u989d\u5916\u7684\u8def\u7531\u884c\u4e3a](https://juejin.im/post/5a991807518825558a060a77#heading-3)\u3002\r\n\r\n\r\n## API \u53c2\u8003\r\n\r\n### SimpleRouter\r\n\r\n`SimpleRouter` \u5305\u542b\u6807\u51c6\u7684 `list`\uff0c`create`\uff0c`retrieve`\uff0c`update`\uff0c`partial_update` \u548c `destroy` action\u3002`SimpleRouter` \u8fd8\u652f\u6301\u89c6\u56fe\u96c6\u4f7f\u7528 `@detail_route` \u6216 `@list_route` \u88c5\u9970\u5668\u6807\u8bb0\u5176\u4ed6\u8981\u8def\u7531\u7684\u65b9\u6cd5\u3002\r\n\r\n<table border=\"0.8\">\r\n    <tr><th>URL Style</th><th>HTTP Method</th><th>Action</th><th>URL Name</th></tr>\r\n    <tr><td rowspan=2>{prefix}/</td><td>GET</td><td>list</td><td rowspan=2>{basename}-list</td></tr></tr>\r\n    <tr><td>POST</td><td>create</td></tr>\r\n    <tr><td>{prefix}/{methodname}/</td><td>GET, \u6216\u8005\u7531 `methods` \u53c2\u6570\u6307\u5b9a</td><td>`@list_route` \u88c5\u9970\u7684\u65b9\u6cd5</td><td>{basename}-{methodname}</td></tr>\r\n    <tr><td rowspan=4>{prefix}/{lookup}/</td><td>GET</td><td>retrieve</td><td rowspan=4>{basename}-detail</td></tr></tr>\r\n    <tr><td>PUT</td><td>update</td></tr>\r\n    <tr><td>PATCH</td><td>partial_update</td></tr>\r\n    <tr><td>DELETE</td><td>destroy</td></tr>\r\n    <tr><td>{prefix}/{lookup}/{methodname}/</td><td>GET, \u6216\u8005\u7531 `methods` \u53c2\u6570\u6307\u5b9a</td><td>`@detail_route` \u88c5\u9970\u7684\u65b9\u6cd5</td><td>{basename}-{methodname}</td></tr>\r\n</table>\r\n\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7531 `SimpleRouter` \u521b\u5efa\u7684 URL \u9644\u52a0\u4e86\u5c3e\u90e8\u659c\u6760\u3002\u5728\u5b9e\u4f8b\u5316\u8def\u7531\u5668\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06 `trailing_slash` \u53c2\u6570\u8bbe\u7f6e\u4e3a `False` \u6765\u4fee\u6539\u6b64\u884c\u4e3a\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nrouter = SimpleRouter(trailing_slash=False)\r\n```\r\n\r\n\u5c3e\u90e8\u659c\u6760\u5728 Django \u4e2d\u662f\u5e38\u89c4\u7684\uff0c\u4f46\u5728\u5176\u4ed6\u4e00\u4e9b\u6846\u67b6\uff08\u5982 Rails\uff09\u4e2d\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u3002\u9009\u62e9\u4f7f\u7528\u54ea\u79cd\u98ce\u683c\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u662f\u4e00\u4e2a\u504f\u597d\u95ee\u9898\uff0c\u5c3d\u7ba1\u4e00\u4e9b JavaScript \u6846\u67b6\u53ef\u80fd\u4f1a\u671f\u671b\u7279\u5b9a\u7684\u8def\u7531\u98ce\u683c\u3002\r\n\r\n`SimpleRouter` \u5c06\u5339\u914d\u5305\u542b\u9664\u659c\u6760\u548c\u53e5\u70b9\u5b57\u7b26\u4ee5\u5916\u7684\u4efb\u4f55\u5b57\u7b26\u7684 lookup \u503c\u3002\u5bf9\u4e8e\u66f4\u4e25\u683c\uff08\u6216\u5bbd\u677e\uff09\u7684 lookup pattern\uff0c\u8bf7\u5728\u89c6\u56fe\u96c6\u4e0a\u8bbe\u7f6e `lookup_value_regex` \u5c5e\u6027\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5c06 lookup  \u9650\u5236\u4e3a\u6709\u6548\u7684 UUID\uff1a\r\n\r\n``` python\r\nclass MyModelViewSet(mixins.RetrieveModelMixin, viewsets.GenericViewSet):\r\n    lookup_field = 'my_model_id'\r\n    lookup_value_regex = '[0-9a-f]{32}'\r\n```\r\n\r\n### DefaultRouter\r\n\r\n`DefaultRouter` \u4e0e\u4e0a\u9762\u7684 `SimpleRouter` \u76f8\u4f3c\uff0c\u4f46\u8fd8\u5305\u542b\u4e00\u4e2a\u9ed8\u8ba4\u7684 API \u6839\u89c6\u56fe\uff0c\u8be5\u89c6\u56fe\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u6307\u5411\u6240\u6709\u5217\u8868\u89c6\u56fe\u7684\u8d85\u94fe\u63a5\u7684\u54cd\u5e94\u3002\u5b83\u8fd8\u4e3a\u53ef\u9009\u7684 `.json` \u98ce\u683c\u683c\u5f0f\u540e\u7f00\u751f\u6210\u8def\u7531\u3002\r\n\r\n\r\n<table border=\"0.8\">\r\n    <tr><th>URL Style</th><th>HTTP Method</th><th>Action</th><th>URL Name</th></tr>\r\n    <tr><td>[.format]</td><td>GET</td><td>\u81ea\u52a8\u751f\u6210\u7684\u6839\u89c6\u56fe</td><td>api-root</td></tr></tr>\r\n    <tr><td rowspan=2>{prefix}/[.format]</td><td>GET</td><td>list</td><td rowspan=2>{basename}-list</td></tr></tr>\r\n    <tr><td>POST</td><td>create</td></tr>\r\n    <tr><td>{prefix}/{methodname}/[.format]</td><td>GET, \u6216\u8005\u7531 `methods` \u53c2\u6570\u6307\u5b9a</td><td>`@list_route` \u88c5\u9970\u7684\u65b9\u6cd5</td><td>{basename}-{methodname}</td></tr>\r\n    <tr><td rowspan=4>{prefix}/{lookup}/[.format]</td><td>GET</td><td>retrieve</td><td rowspan=4>{basename}-detail</td></tr></tr>\r\n    <tr><td>PUT</td><td>update</td></tr>\r\n    <tr><td>PATCH</td><td>partial_update</td></tr>\r\n    <tr><td>DELETE</td><td>destroy</td></tr>\r\n    <tr><td>{prefix}/{lookup}/{methodname}/[.format]</td><td>GET, \u6216\u8005\u7531 `methods` \u53c2\u6570\u6307\u5b9a</td><td>`@detail_route` \u88c5\u9970\u7684\u65b9\u6cd5</td><td>{basename}-{methodname}</td></tr>\r\n</table>\r\n\r\n> \u6ce8\u610f\uff1a\u6211\u5728\u4f7f\u7528 3.7.7 \u7248\u672c\u65f6\uff0c\u53d1\u73b0\u8981\u5199\u6210 `{prefix}[.format]/` \u98ce\u683c\u624d\u80fd\u8bbf\u95ee\uff0c`{prefix}/[.format]` \u98ce\u683c\u4f1a\u62a5 404\uff0c\u4e0d\u77e5\u9053\u662f\u6211\u8bbe\u7f6e\u95ee\u9898\u8fd8\u662f\u5b98\u65b9\u66f4\u65b0\u4e86\u3002\r\n\r\n\u4e0e `SimpleRouter` \u4e00\u6837\uff0c\u901a\u8fc7\u5728\u5b9e\u4f8b\u5316 `DefaultRouter` \u65f6\u5c06 `trailing_slash` \u53c2\u6570\u8bbe\u7f6e\u4e3a `False`\uff0c\u53ef\u4ee5\u5220\u9664 URL \u8def\u5f84\u4e0a\u7684\u5c3e\u90e8\u659c\u6760\u3002\r\n\r\n``` python\r\nrouter = DefaultRouter(trailing_slash=False)\r\n```\r\n\r\n\r\n## \u81ea\u5b9a\u4e49\u8def\u7531\r\n\r\n\u81ea\u5b9a\u4e49\u8def\u7531\u5e76\u4e0d\u662f\u4f60\u7ecf\u5e38\u9700\u8981\u505a\u7684\u4e8b\u60c5\uff0c\u4f46\u662f\u5982\u679c\u4f60\u5bf9 API \u7684 URL \u662f\u5982\u4f55\u6784\u5efa\u7684\u6709\u7279\u5b9a\u7684\u8981\u6c42\u7684\u8bdd\uff0c\u5b83\u4f1a\u5f88\u6709\u7528\u3002\u8fd9\u6837\u505a\u53ef\u4ee5\u8ba9\u4f60\u4ee5\u53ef\u91cd\u7528\u7684\u65b9\u5f0f\u5c01\u88c5 URL \u7ed3\u6784\uff0c\u786e\u4fdd\u4f60\u4e0d\u5fc5\u4e3a\u6bcf\u4e2a\u65b0\u89c6\u56fe\u660e\u786e\u7f16\u5199 URL \u6a21\u5f0f\u3002\r\n\r\n\u5b9e\u73b0\u81ea\u5b9a\u4e49\u8def\u7531\u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u5bf9\u73b0\u6709\u8def\u7531\u7c7b\u4e4b\u4e00\u8fdb\u884c\u5b50\u7c7b\u5316\u3002`.routes` \u5c5e\u6027\u7528\u4e8e\u5bf9\u5c06\u6620\u5c04\u5230\u6bcf\u4e2a\u89c6\u56fe\u96c6\u7684 URL \u6a21\u5f0f\u8fdb\u884c\u6a21\u677f\u5316\u3002`.Routes` \u5c5e\u6027\u662f\u4e00\u4e2a `Route` \u5217\u8868\uff08`Route` \u7684\u662f\u4e00\u4e2a namedtuple\uff09\u3002\r\n\r\n`Route` \u547d\u540d\u5143\u7ec4\u7684\u53c2\u6570\uff1a\r\n\r\n**url** \uff1a \u8868\u793a\u8981\u8def\u7531\u7684 URL \u7684\u5b57\u7b26\u4e32\u3002\u53ef\u4ee5\u5305\u542b\u4ee5\u4e0b\u683c\u5f0f\u5b57\u7b26\u4e32\uff1a  \r\n * `{prefix}` - \u8def\u7531\u7684 URL \u524d\u7f00\u3002\r\n * `{lookup}` - \u5339\u914d\u5355\u4e2a\u5b9e\u4f8b\u7684 lookup field\u3002\r\n *  `{trailing_slash}` - \u53ef\u4ee5\u662f '/' \u6216\u7a7a\u5b57\u7b26\u4e32\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e `trailing_slash` \u53c2\u6570\u3002\r\n\r\n**mapping** \uff1a HTTP \u65b9\u6cd5\u540d\u79f0\u4e0e\u89c6\u56fe\u65b9\u6cd5\u7684\u6620\u5c04\r\n\r\n\r\n**name**\uff1a \u7528\u4e8e\u8c03\u7528 `reverse` \u65f6\u7684 URL \u7684\u540d\u79f0\u3002\u53ef\u80fd\u5305\u542b\u4ee5\u4e0b\u683c\u5f0f\u5b57\u7b26\u4e32\uff1a  \r\n* `{basename}` - \u521b\u5efa\u7684 URL \u540d\u79f0\u7684\u57fa\u7840\u3002\r\n\r\n\r\n**initkwargs**\uff1a \u5b9e\u4f8b\u5316\u89c6\u56fe\u65f6\u5e94\u4f20\u9012\u7684\u4efb\u4f55\u5176\u4ed6\u53c2\u6570\u7684\u5b57\u5178\u3002\u6ce8\u610f\uff0c`suffix` \u53c2\u6570\u88ab\u4fdd\u7559\u7528\u4e8e\u6807\u8bc6\u89c6\u56fe\u96c6\u7c7b\u578b\uff0c\u5728\u751f\u6210\u89c6\u56fe\u540d\u79f0\u548c breadcrumb  \u94fe\u63a5\u65f6\u4f7f\u7528\u3002\r\n\r\n\r\n### \u81ea\u5b9a\u4e49\u52a8\u6001\u8def\u7531\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49 `@list_route` \u548c `@detail_route` \u88c5\u9970\u5668\u7684\u8def\u7531\u65b9\u5f0f\u3002\u8981\u8def\u7531\u8fd9\u4e24\u4e2a\u88c5\u9970\u5668\u4e2d\u7684\u4e00\u4e2a\u6216\u4e24\u4e2a\uff0c\u8bf7\u5728 `.routes` \u5217\u8868\u4e2d\u5305\u542b\u4e00\u4e2a `DynamicListRoute` \u548c/\u6216 `DynamicDetailRoute`\uff08\u522b\u5fd8\u4e86\u7c7b\u578b\u662f namedtuple\uff09\u3002\r\n\r\n\r\n`DynamicListRoute` \u548c `DynamicDetailRoute` \u7684\u53c2\u6570\u662f\uff1a  \r\n\r\n**url**\uff1a \u8868\u793a\u8981\u8def\u7531\u7684 URL \u7684\u5b57\u7b26\u4e32\u3002\u53ef\u4ee5\u5305\u542b\u4e0e `Route` \u76f8\u540c\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u8fd8\u63a5\u53d7 `{methodname}` \u548c `{methodnamehyphen}` \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n**name**\uff1a \u7528\u4e8e\u8c03\u7528 `reverse` \u65f6\u7684\u540d\u79f0\u3002\u53ef\u4ee5\u5305\u542b\u4ee5\u4e0b\u683c\u5f0f\u5b57\u7b26\u4e32\uff1a`{basename}` , `{methodname} ` \u548c ` {methodnamehyphen}` \u3002\r\n\r\n**initkwargs**\uff1a \u5b9e\u4f8b\u5316\u89c6\u56fe\u65f6\u5e94\u4f20\u9012\u7684\u4efb\u4f55\u5176\u4ed6\u53c2\u6570\u7684\u5b57\u5178\u3002\r\n\r\n\r\n\r\n### \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\r\n\u4ee5\u4e0b\u793a\u4f8b\u53ea\u4f1a\u8def\u7531 `list` \u548c `retrieve` action\uff0c\u5e76\u4e14\u4e0d\u4f7f\u7528\u5c3e\u90e8\u659c\u6760\u7ea6\u5b9a\u3002\r\n\r\n``` python\r\nfrom rest_framework.routers import Route, DynamicDetailRoute, SimpleRouter\r\n\r\nclass CustomReadOnlyRouter(SimpleRouter):\r\n    \"\"\"\r\n    A router for read-only APIs, which doesn't use trailing slashes.\r\n    \"\"\"\r\n    routes = [\r\n        Route(\r\n            url=r'^{prefix}$',\r\n            mapping={'get': 'list'},\r\n            name='{basename}-list',\r\n            initkwargs={'suffix': 'List'}\r\n        ),\r\n        Route(\r\n            url=r'^{prefix}/{lookup}$',\r\n            mapping={'get': 'retrieve'},\r\n            name='{basename}-detail',\r\n            initkwargs={'suffix': 'Detail'}\r\n        ),\r\n        DynamicDetailRoute(\r\n            url=r'^{prefix}/{lookup}/{methodnamehyphen}$',\r\n            name='{basename}-{methodnamehyphen}',\r\n            initkwargs={}\r\n        )\r\n    ]\r\n```\r\n\u8ba9\u6211\u4eec\u6765\u770b\u770b `CustomReadOnlyRouter` \u4e3a\u4e00\u4e2a\u7b80\u5355\u7684\u89c6\u56fe\u96c6\u751f\u6210\u7684\u8def\u7531\u3002\r\n\r\n`views.py`\uff1a\r\n\r\n``` python\r\nclass UserViewSet(viewsets.ReadOnlyModelViewSet):\r\n    \"\"\"\r\n    A viewset that provides the standard actions\r\n    \"\"\"\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    lookup_field = 'username'\r\n\r\n    @detail_route()\r\n    def group_names(self, request, pk=None):\r\n        \"\"\"\r\n        Returns a list of all the group names that the given\r\n        user belongs to.\r\n        \"\"\"\r\n        user = self.get_object()\r\n        groups = user.groups.all()\r\n        return Response([group.name for group in groups])\r\n```\r\n\r\n`urls.py`\uff1a\r\n\r\n```python\r\nrouter = CustomReadOnlyRouter()\r\nrouter.register('users', UserViewSet)\r\nurlpatterns = router.urls\r\n```\r\n\r\n\u5c06\u751f\u6210\u4ee5\u4e0b\u6620\u5c04...\r\n\r\n\r\n| URL | HTTP Method | Action | URL Name|\r\n|-|-|-|-|\r\n|/users | GET | list | user-list |\r\n|/users/{username} | GET | retrieve| user-detail |\r\n|/users/{username}/group-names | GET | group_names | user-group-names |\r\n\r\n\r\n\u6709\u5173\u8bbe\u7f6e `.routes` \u5c5e\u6027\u7684\u53e6\u4e00\u4e2a\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605 `SimpleRouter` \u7c7b\u7684\u6e90\u4ee3\u7801\u3002\r\n\r\n\r\n### \u81ea\u5b9a\u4e49\u8def\u7531\u5668\u8fdb\u9636\r\n\r\n\u5982\u679c\u60f3\u63d0\u4f9b\u5b8c\u5168\u81ea\u5b9a\u4e49\u7684\u884c\u4e3a\uff0c\u53ef\u4ee5\u7ee7\u627f `BaseRouter` \u5e76\u8986\u76d6 `get_urls(self)` \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u5e94\u68c0\u67e5\u5df2\u6ce8\u518c\u7684\u89c6\u56fe\u96c6\u5e76\u8fd4\u56de\u4e00\u7ec4 URL \u6a21\u5f0f\u3002\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee `self.registry` \u5c5e\u6027\u6765\u68c0\u67e5\u6ce8\u518c\u7684 prefix\uff0cviewset \u548c basename tuples\u3002\r\n\r\n\u4f60\u53ef\u80fd\u8fd8\u60f3\u8986\u76d6 `get_default_base_name\uff08self\uff0cviewset\uff09`\u65b9\u6cd5\uff0c\u6216\u8005\u5728\u5411\u8def\u7531\u6ce8\u518c\u89c6\u56fe\u96c6\u65f6\u59cb\u7ec8\u663e\u5f0f\u8bbe\u7f6e `base_name` \u53c2\u6570\u3002\r\n\r\n\r\n\r\n## \u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5305\r\n\r\n\u4ee5\u4e0b\u662f\u53ef\u7528\u7684\u7b2c\u4e09\u65b9\u5305\u3002\r\n\r\n\r\n### [DRF Nested Routers](https://github.com/alanjds/drf-nested-routers)\r\n\r\n\r\n### [ModelRouter (wq.db.rest)](https://wq.io/wq.db)\r\n\r\n\r\n### [DRF-extensions](https://chibisov.github.io/drf-extensions/docs/)", "md_File": "subject/django-rest-framework-api-guide/routers.md", "create_date": "2020-02-20T13:10:40.764", "order": 6}}, {"model": "subject.chapter", "pk": 161, "fields": {"title": "\u5e8f\u5217\u5316serializers", "topic": 7, "md5": "defe6c6ae2157caf88a9e82a0e4b79ee", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/serializers/)\r\n\r\n## Serializers\r\n\r\n\u5e8f\u5217\u5316\u5668\u5141\u8bb8\u5c06\u8bf8\u5982\u67e5\u8be2\u96c6\u548c\u6a21\u578b\u5b9e\u4f8b\u4e4b\u7c7b\u7684\u590d\u6742\u6570\u636e\u8f6c\u6362\u4e3a\u539f\u751f Python \u6570\u636e\u7c7b\u578b\uff0c\u7136\u540e\u53ef\u4ee5\u5c06\u5b83\u4eec\u8f7b\u677e\u5730\u5448\u73b0\u4e3a `JSON`\uff0c`XML` \u6216\u5176\u4ed6\u5185\u5bb9\u7c7b\u578b\u3002\u5e8f\u5217\u5316\u5668\u8fd8\u63d0\u4f9b\u53cd\u5e8f\u5217\u5316\uff0c\u5728\u9996\u6b21\u9a8c\u8bc1\u4f20\u5165\u6570\u636e\u4e4b\u540e\uff0c\u53ef\u4ee5\u5c06\u89e3\u6790\u7684\u6570\u636e\u8f6c\u6362\u56de\u590d\u6742\u7c7b\u578b\u3002\r\n\r\nREST framework \u4e2d\u7684\u5e8f\u5217\u5316\u7c7b\u4e0e Django \u7684 `Form` \u548c `ModelForm` \u7c7b\u975e\u5e38\u76f8\u4f3c\u3002\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a `Serializer` \u7c7b\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u5f3a\u5927\u7684\u901a\u7528\u65b9\u6cd5\u6765\u63a7\u5236\u54cd\u5e94\u7684\u8f93\u51fa\uff0c\u4ee5\u53ca\u4e00\u4e2a `ModelSerializer` \u7c7b\uff0c\u5b83\u4e3a\u521b\u5efa\u5904\u7406\u6a21\u578b\u5b9e\u4f8b\u548c\u67e5\u8be2\u96c6\u7684\u5e8f\u5217\u5316\u63d0\u4f9b\u4e86\u6709\u6548\u7684\u5feb\u6377\u65b9\u5f0f\u3002\r\n\r\n### \u7533\u660e\u5e8f\u5217\u5316\u7c7b\r\n\r\n\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u5bf9\u8c61\u7528\u4e8e\u793a\u4f8b\uff1a\r\n\r\n``` python\r\nfrom datetime import datetime\r\n\r\nclass Comment(object):\r\n    def __init__(self, email, content, created=None):\r\n        self.email = email\r\n        self.content = content\r\n        self.created = created or datetime.now()\r\n\r\ncomment = Comment(email='leila@example.com', content='foo bar')\r\n```\r\n\r\n\u58f0\u660e\u4e00\u4e2a\u5e8f\u5217\u5316\u7c7b\uff0c\u4f7f\u7528\u5b83\u6765\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u4e0e `Comment` \u5bf9\u8c61\u76f8\u5bf9\u5e94\u7684\u6570\u636e\u3002\r\n\r\n\u58f0\u660e\u4e00\u4e2a\u5e8f\u5217\u5316\u7c7b\u770b\u8d77\u6765\u975e\u5e38\u7c7b\u4f3c\u4e8e\u58f0\u660e\u4e00\u4e2a\u8868\u5355\uff1a\r\n\r\n``` python\r\nfrom rest_framework import serializers\r\n\r\nclass CommentSerializer(serializers.Serializer):\r\n    email = serializers.EmailField()\r\n    content = serializers.CharField(max_length=200)\r\n    created = serializers.DateTimeField()\r\n```\r\n\r\n### \u5e8f\u5217\u5316\u5bf9\u8c61\r\n\r\n\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 `CommentSerializer` \u6765\u5e8f\u5217\u5316\u8bc4\u8bba\u6216\u8bc4\u8bba\u5217\u8868\u3002\u540c\u6837\uff0c\u4f7f\u7528 `Serializer` \u7c7b\u770b\u8d77\u6765\u5f88\u50cf\u4f7f\u7528 `Form` \u7c7b\u3002\r\n\r\n``` python\r\nserializer = CommentSerializer(comment)\r\nserializer.data\r\n# {'email': 'leila@example.com', 'content': 'foo bar', 'created': '2016-01-27T15:17:10.375877'}\r\n```\r\n\r\n\u6b64\u65f6\u5df2\u7ecf\u5c06\u6a21\u578b\u5b9e\u4f8b\u8f6c\u6362\u4e3a Python \u539f\u751f\u6570\u636e\u7c7b\u578b\u3002\u4e3a\u4e86\u5b8c\u6210\u5e8f\u5217\u5316\u8fc7\u7a0b\uff0c\u5c06\u6570\u636e\u6e32\u67d3\u4e3a `json`\u3002\r\n\r\n``` python\r\nfrom rest_framework.renderers import JSONRenderer\r\n\r\njson = JSONRenderer().render(serializer.data)\r\njson\r\n# b'{\"email\":\"leila@example.com\",\"content\":\"foo bar\",\"created\":\"2016-01-27T15:17:10.375877\"}'\r\n```\r\n\r\n\r\n### \u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\r\n\r\n\u53cd\u5e8f\u5217\u5316\u662f\u76f8\u4f3c\u7684\u3002\u9996\u5148\u6211\u4eec\u5c06\u4e00\u4e2a\u6d41\u89e3\u6790\u4e3a Python \u539f\u751f\u6570\u636e\u7c7b\u578b...\r\n\r\n``` python\r\nfrom django.utils.six import BytesIO\r\nfrom rest_framework.parsers import JSONParser\r\n\r\nstream = BytesIO(json)\r\ndata = JSONParser().parse(stream)\r\n```\r\n\r\n...\u7136\u540e\u6211\u4eec\u5c06\u8fd9\u4e9b\u539f\u751f\u6570\u636e\u7c7b\u578b\u6062\u590d\u6210\u901a\u8fc7\u9a8c\u8bc1\u7684\u6570\u636e\u5b57\u5178\u3002\r\n\r\n``` python\r\nserializer = CommentSerializer(data=data)\r\nserializer.is_valid()\r\n# True\r\nserializer.validated_data\r\n# {'content': 'foo bar', 'email': 'leila@example.com', 'created': datetime.datetime(2012, 08, 22, 16, 20, 09, 822243)}\r\n```\r\n\r\n\r\n\r\n\r\n### \u4fdd\u5b58\u5b9e\u4f8b\r\n\r\n\u5982\u679c\u5e0c\u671b\u80fd\u591f\u57fa\u4e8e\u9a8c\u8bc1\u7684\u6570\u636e\u8fd4\u56de\u5b8c\u6574\u7684\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u5219\u9700\u8981\u5b9e\u73b0 `.create()` \u548c `.update()` \u65b9\u6cd5\u4e2d\u7684\u4e00\u4e2a\u6216\u4e24\u4e2a\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass CommentSerializer(serializers.Serializer):\r\n    email = serializers.EmailField()\r\n    content = serializers.CharField(max_length=200)\r\n    created = serializers.DateTimeField()\r\n\r\n    def create(self, validated_data):\r\n        return Comment(**validated_data)\r\n\r\n    def update(self, instance, validated_data):\r\n        instance.email = validated_data.get('email', instance.email)\r\n        instance.content = validated_data.get('content', instance.content)\r\n        instance.created = validated_data.get('created', instance.created)\r\n        return instance\r\n```\r\n\r\n\u5982\u679c\u5bf9\u8c61\u5b9e\u4f8b\u4e0e Django \u6a21\u578b\u76f8\u5bf9\u5e94\uff0c\u8fd8\u9700\u8981\u786e\u4fdd\u8fd9\u4e9b\u65b9\u6cd5\u5c06\u5bf9\u8c61\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u3002\u5982\u679c `Comment` \u662f\u4e00\u4e2a Django \u6a21\u578b\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\n    def create(self, validated_data):\r\n        return Comment.objects.create(**validated_data)\r\n\r\n    def update(self, instance, validated_data):\r\n        instance.email = validated_data.get('email', instance.email)\r\n        instance.content = validated_data.get('content', instance.content)\r\n        instance.created = validated_data.get('created', instance.created)\r\n        instance.save()\r\n        return instance\r\n```\r\n\r\n\u73b0\u5728\uff0c\u5f53\u53cd\u5e8f\u5217\u5316\u6570\u636e\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u7528 `.save()` \u6839\u636e\u9a8c\u8bc1\u7684\u6570\u636e\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\u3002\r\n\r\n``` python\r\ncomment = serializer.save()\r\n```\r\n\r\n\u8c03\u7528 `.save()` \u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u5b9e\u4f8b\u6216\u66f4\u65b0\u73b0\u6709\u5b9e\u4f8b\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u5728\u5b9e\u4f8b\u5316\u5e8f\u5217\u5316\u7c7b\u65f6\u662f\u5426\u4f20\u9012\u4e86\u73b0\u6709\u5b9e\u4f8b\uff1a\r\n\r\n``` python\r\n# .save() will create a new instance.\r\nserializer = CommentSerializer(data=data)\r\n\r\n# .save() will update the existing `comment` instance.\r\nserializer = CommentSerializer(comment, data=data)\r\n```\r\n\r\n`.create()` \u548c `.update()` \u65b9\u6cd5\u90fd\u662f\u53ef\u9009\u7684\u3002\u60a8\u53ef\u4ee5\u90fd\u4e0d\u5b9e\u73b0\uff0c\u6216\u8005\u5b9e\u73b0\u5176\u4e2d\u7684\u4e00\u4e2a\u6216\u4e24\u4e2a\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u4f60\u7684\u5e8f\u5217\u5316\u7c7b\u7684\u7528\u4f8b\u3002\r\n\r\n#### \u5c06\u9644\u52a0\u5c5e\u6027\u4f20\u9012\u7ed9 `.save()`\r\n\r\n\u6709\u65f6\u4f60\u4f1a\u5e0c\u671b\u4f60\u7684\u89c6\u56fe\u4ee3\u7801\u80fd\u591f\u5728\u4fdd\u5b58\u5b9e\u4f8b\u7684\u65f6\u5019\u6ce8\u5165\u989d\u5916\u7684\u6570\u636e\u3002\u8fd9\u4e9b\u9644\u52a0\u6570\u636e\u53ef\u80fd\u5305\u542b\u5f53\u524d\u7528\u6237\uff0c\u5f53\u524d\u65f6\u95f4\u6216\u5176\u4ed6\u4efb\u4f55\u4e0d\u5c5e\u4e8e\u8bf7\u6c42\u6570\u636e\u7684\u4fe1\u606f\u3002\r\n\r\n``` python\r\nserializer.save(owner=request.user)\r\n```\r\n\r\n\u8c03\u7528 `.create()` \u6216 `.update()` \u65f6\uff0c\u4efb\u4f55\u5176\u4ed6\u5173\u952e\u5b57\u53c2\u6570\u90fd\u5c06\u5305\u542b\u5728 `validated_data` \u53c2\u6570\u4e2d\u3002\r\n\r\n#### \u76f4\u63a5\u8986\u76d6 `.save()`\u3002\r\n\r\n\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c`.create()` \u548c `.update()` \u65b9\u6cd5\u540d\u79f0\u53ef\u80fd\u6ca1\u6709\u610f\u4e49\u3002\u4f8b\u5982\uff0c\u5728 \u201c\u8054\u7cfb\u4eba\u8868\u5355\u201d \u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u4e0d\u4f1a\u521b\u5efa\u65b0\u5b9e\u4f8b\uff0c\u800c\u662f\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u6216\u5176\u4ed6\u6d88\u606f\u3002\r\n\r\n\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u9009\u62e9\u76f4\u63a5\u8986\u76d6 `.save()`\uff0c\u56e0\u4e3a\u5b83\u66f4\u5177\u53ef\u8bfb\u6027\u548c\u6709\u610f\u4e49\u6027\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n``` python\r\nclass ContactForm(serializers.Serializer):\r\n    email = serializers.EmailField()\r\n    message = serializers.CharField()\r\n\r\n    def save(self):\r\n        email = self.validated_data['email']\r\n        message = self.validated_data['message']\r\n        send_email(from=email, message=message)\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u5728\u4e0a\u9762\u7684\u60c5\u51b5\u4e0b\uff0c\u5fc5\u987b\u76f4\u63a5\u8bbf\u95ee `serializer .validated_data` \u5c5e\u6027\u3002\r\n\r\n### \u9a8c\u8bc1\r\n\r\n\u5728\u53cd\u5e8f\u5217\u5316\u6570\u636e\u65f6\uff0c\u4f60\u603b\u662f\u9700\u8981\u5728\u5c1d\u8bd5\u8bbf\u95ee\u9a8c\u8bc1\u6570\u636e\u4e4b\u524d\u8c03\u7528 `is_valid()`\uff0c\u6216\u8005\u4fdd\u5b58\u5bf9\u8c61\u5b9e\u4f8b\u3002\u5982\u679c\u53d1\u751f\u4efb\u4f55\u9a8c\u8bc1\u9519\u8bef\uff0c\u90a3\u4e48 `.errors` \u5c5e\u6027\u5c06\u5305\u542b\u4e00\u4e2a\u4ee3\u8868\u9519\u8bef\u6d88\u606f\u7684\u5b57\u5178\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nserializer = CommentSerializer(data={'email': 'foobar', 'content': 'baz'})\r\nserializer.is_valid()\r\n# False\r\nserializer.errors\r\n# {'email': [u'Enter a valid e-mail address.'], 'created': [u'This field is required.']}\r\n```\r\n\r\n\u5b57\u5178\u4e2d\u7684\u6bcf\u4e2a\u952e\u90fd\u662f\u5b57\u6bb5\u540d\u79f0\uff0c\u503c\u662f\u4e0e\u8be5\u5b57\u6bb5\u76f8\u5bf9\u5e94\u7684\u9519\u8bef\u6d88\u606f\uff08\u5b57\u7b26\u4e32\u5217\u8868\uff09\u3002`non_field_errors` \u952e\u4e5f\u53ef\u80fd\u5b58\u5728\uff0c\u5e76\u4f1a\u5217\u51fa\u4efb\u4f55\u5e38\u89c4\u9a8c\u8bc1\u9519\u8bef\u3002\u53ef\u4ee5\u4f7f\u7528 `NON_FIELD_ERRORS_KEY` \uff08\u5728 settings \u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff09\u6765\u5b9a\u5236 `non_field_errors` \u5173\u952e\u5b57\u7684\u540d\u79f0\u3002\r\n\r\n\u53cd\u5e8f\u5217\u5316 item \u5217\u8868\u65f6\uff0c\u9519\u8bef\u5c06\u4f5c\u4e3a\u4ee3\u8868\u6bcf\u4e2a\u53cd\u5e8f\u5217\u5316 item \u7684\u5b57\u5178\u5217\u8868\u8fd4\u56de\u3002\r\n\r\n#### \u6570\u636e\u9a8c\u8bc1\u65f6\u629b\u51fa\u5f02\u5e38\r\n\r\n`.is_valid()` \u65b9\u6cd5\u5e26\u6709\u4e00\u4e2a\u53ef\u9009\u7684 `raise_exception` \u6807\u5fd7\uff0c\u5982\u679c\u5b58\u5728\u9a8c\u8bc1\u9519\u8bef\uff0c\u5c06\u5bfc\u81f4\u5b83\u5f15\u53d1 `serializers.ValidationError` \u5f02\u5e38\u3002\r\n\r\n\r\n\u8fd9\u4e9b\u5f02\u5e38\u7531 REST framework \u63d0\u4f9b\u7684\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u81ea\u52a8\u5904\u7406\uff0c\u5e76\u4e14\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5c06\u8fd4\u56de `HTTP 400 Bad Request`\u3002\r\n\r\n``` python\r\n# Return a 400 response if the data was invalid.\r\nserializer.is_valid(raise_exception=True)\r\n```\r\n\r\n#### \u5b57\u6bb5\u7ea7\u9a8c\u8bc1\r\n\r\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u5411 `Serializer` \u5b50\u7c7b\u6dfb\u52a0 `.validate_<field_name>` \u65b9\u6cd5\u6765\u6307\u5b9a\u81ea\u5b9a\u4e49\u5b57\u6bb5\u7ea7\u9a8c\u8bc1\u3002\u8fd9\u4e9b\u4e0e Django \u8868\u5355\u4e0a\u7684 `.clean_<field_name>` \u65b9\u6cd5\u7c7b\u4f3c\u3002\r\n\r\n\u8fd9\u4e9b\u65b9\u6cd5\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u5c31\u662f\u9700\u8981\u9a8c\u8bc1\u7684\u5b57\u6bb5\u503c\u3002\r\n\r\n\u60a8\u7684 `validate_<field_name>` \u65b9\u6cd5\u5e94\u8fd4\u56de\u9a8c\u8bc1\u503c\u6216\u5f15\u53d1 `serializers.ValidationError`\u3002\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom rest_framework import serializers\r\n\r\nclass BlogPostSerializer(serializers.Serializer):\r\n    title = serializers.CharField(max_length=100)\r\n    content = serializers.CharField()\r\n\r\n    def validate_title(self, value):\r\n        \"\"\"\r\n        Check that the blog post is about Django.\r\n        \"\"\"\r\n        if 'django' not in value.lower():\r\n            raise serializers.ValidationError(\"Blog post is not about Django\")\r\n        return value\r\n```\r\n\r\n> \u6ce8\u610f\uff1a\u5982\u679c\u4f60\u7684\u5e8f\u5217\u5316\u7a0b\u5e8f\u4e2d\u58f0\u660e\u7684 `<field_name>` \u53c2\u6570\u4e3a `required = False` \uff0c\u90a3\u4e48\u5982\u679c\u672a\u5305\u542b\u8be5\u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u6267\u884c\u6b64\u9a8c\u8bc1\u6b65\u9aa4\u3002\r\n\r\n#### \u5bf9\u8c61\u7ea7\u9a8c\u8bc1\r\n\r\n\u5982\u679c\u8981\u5bf9\u591a\u4e2a\u5b57\u6bb5\u8fdb\u884c\u5176\u4ed6\u7684\u9a8c\u8bc1\uff0c\u8bf7\u5c06\u4e00\u4e2a\u540d\u4e3a `.validate()` \u7684\u65b9\u6cd5\u6dfb\u52a0\u5230\u60a8\u7684 `Serializer` \u5b50\u7c7b\u4e2d\u3002\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u5b83\u662f\u4e00\u4e2a\u5b57\u6bb5\u503c\uff08`field`-`value`\uff09\u7684\u5b57\u5178\u3002\u5982\u679c\u6709\u5fc5\u8981\uff0c\u5b83\u5e94\u8be5\u5f15\u53d1\u4e00\u4e2a `ValidationError`\uff0c\u6216\u8005\u53ea\u662f\u8fd4\u56de\u9a8c\u8bc1\u7684\u503c\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom rest_framework import serializers\r\n\r\nclass EventSerializer(serializers.Serializer):\r\n    description = serializers.CharField(max_length=100)\r\n    start = serializers.DateTimeField()\r\n    finish = serializers.DateTimeField()\r\n\r\n    def validate(self, data):\r\n        \"\"\"\r\n        Check that the start is before the stop.\r\n        \"\"\"\r\n        if data['start'] > data['finish']:\r\n            raise serializers.ValidationError(\"finish must occur after start\")\r\n        return data\r\n```\r\n\r\n\r\n#### \u9a8c\u8bc1\u5668\r\n\r\n\u5e8f\u5217\u5316\u5668\u4e0a\u7684\u5404\u4e2a\u5b57\u6bb5\u53ef\u4ee5\u5305\u542b\u9a8c\u8bc1\u5668\uff0c\u65b9\u6cd5\u662f\u5728\u5b57\u6bb5\u5b9e\u4f8b\u4e0a\u58f0\u660e\u5b83\u4eec\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\ndef multiple_of_ten(value):\r\n    if value % 10 != 0:\r\n        raise serializers.ValidationError('Not a multiple of ten')\r\n\r\nclass GameRecord(serializers.Serializer):\r\n    score = IntegerField(validators=[multiple_of_ten])\r\n    ...\r\n```\r\n\r\n\u5e8f\u5217\u5316\u7c7b\u8fd8\u53ef\u4ee5\u5305\u542b\u5e94\u7528\u4e8e\u6574\u4e2a\u5b57\u6bb5\u6570\u636e\u96c6\u7684\u53ef\u91cd\u7528\u9a8c\u8bc1\u5668\u3002\u8fd9\u4e9b\u9a8c\u8bc1\u5668\u662f\u901a\u8fc7\u5728\u5185\u90e8\u7684 `Meta` \u7c7b\u4e2d\u58f0\u660e\u5b83\u4eec\u6765\u5305\u542b\u7684\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nclass EventSerializer(serializers.Serializer):\r\n    name = serializers.CharField()\r\n    room_number = serializers.IntegerField(choices=[101, 102, 103, 201])\r\n    date = serializers.DateField()\r\n\r\n    class Meta:\r\n        # Each room only has one event per day.\r\n        validators = UniqueTogetherValidator(\r\n            queryset=Event.objects.all(),\r\n            fields=['room_number', 'date']\r\n        )\r\n```\r\n\r\n> \u770b\u4e0d\u61c2\u6ca1\u5173\u7cfb\u54e6\uff0c\u66f4\u591a\u5173\u4e8e\u9a8c\u8bc1\u7684\u5185\u5bb9\uff0c\u4ee5\u540e\u8fd8\u4f1a\u8bf4\u5230\u3002\r\n\r\n\r\n### \u8bbf\u95ee\u521d\u59cb\u6570\u636e\u548c\u5b9e\u4f8b\r\n\r\n\u5c06\u521d\u59cb\u5bf9\u8c61\u6216\u67e5\u8be2\u96c6\u4f20\u9012\u7ed9\u5e8f\u5217\u5316\u7c7b\u5b9e\u4f8b\u65f6\uff0c\u8be5\u5bf9\u8c61\u5c06\u4f5c\u4e3a `.instance` \u63d0\u4f9b\u3002\u5982\u679c\u6ca1\u6709\u4f20\u9012\u521d\u59cb\u5bf9\u8c61\uff0c\u5219 `.instance` \u5c5e\u6027\u5c06\u4e3a `None`\u3002\r\n\r\n\u5c06\u6570\u636e\u4f20\u9012\u7ed9\u5e8f\u5217\u5316\u7c7b\u5b9e\u4f8b\u65f6\uff0c\u672a\u4fee\u6539\u7684\u6570\u636e\u5c06\u4f5c\u4e3a `.initial_data` \u63d0\u4f9b\u3002\u5982\u679c data \u5173\u952e\u5b57\u53c2\u6570\u672a\u88ab\u4f20\u9012\uff0c\u90a3\u4e48 `.initial_data` \u5c5e\u6027\u5c06\u4e0d\u5b58\u5728\u3002\r\n\r\n\r\n### \u90e8\u5206\u66f4\u65b0\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5e8f\u5217\u5316\u7a0b\u5e8f\u5fc5\u987b\u4e3a\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u4f20\u9012\u503c\uff0c\u5426\u5219\u4f1a\u5f15\u53d1\u9a8c\u8bc1\u9519\u8bef\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 `partial` \u53c2\u6570\u4ee5\u5141\u8bb8\u90e8\u5206\u66f4\u65b0\u3002\r\n\r\n``` python\r\n# Update `comment` with partial data\r\nserializer = CommentSerializer(comment, data={'content': u'foo bar'}, partial=True)\r\n```\r\n\r\n\r\n### \u5904\u7406\u5d4c\u5957\u5bf9\u8c61\r\n\r\n\u524d\u9762\u7684\u4f8b\u5b50\u9002\u7528\u4e8e\u5904\u7406\u53ea\u5177\u6709\u7b80\u5355\u6570\u636e\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u4f46\u6709\u65f6\u8fd8\u9700\u8981\u80fd\u591f\u8868\u793a\u66f4\u590d\u6742\u7684\u5bf9\u8c61\uff0c\u5176\u4e2d\u5bf9\u8c61\u7684\u67d0\u4e9b\u5c5e\u6027\u53ef\u80fd\u4e0d\u662f\u7b80\u5355\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5982\u5b57\u7b26\u4e32\uff0c\u65e5\u671f\u6216\u6574\u6570\u3002\r\n\r\n`Serializer` \u7c7b\u672c\u8eab\u5c31\u662f\u4e00\u79cd `Field`\uff0c\u53ef\u4ee5\u7528\u6765\u8868\u793a\u4e00\u4e2a\u5bf9\u8c61\u7c7b\u578b\u5d4c\u5957\u5728\u53e6\u4e00\u4e2a\u5bf9\u8c61\u7c7b\u578b\u4e2d\u7684\u5173\u7cfb\u3002\r\n\r\n``` python\r\nclass UserSerializer(serializers.Serializer):\r\n    email = serializers.EmailField()\r\n    username = serializers.CharField(max_length=100)\r\n\r\nclass CommentSerializer(serializers.Serializer):\r\n    user = UserSerializer()\r\n    content = serializers.CharField(max_length=200)\r\n    created = serializers.DateTimeField()\r\n```\r\n\r\n\u5982\u679c\u5d4c\u5957\u5bf9\u8c61\u53ef\u4ee5\u662f `None` \u503c\uff0c\u5219\u5e94\u5c06 `required = False` \u6807\u5fd7\u4f20\u9012\u7ed9\u5d4c\u5957\u7684\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n``` python\r\nclass CommentSerializer(serializers.Serializer):\r\n    user = UserSerializer(required=False)  # May be an anonymous user.\r\n    content = serializers.CharField(max_length=200)\r\n    created = serializers.DateTimeField()\r\n```\r\n\r\n\u540c\u6837\uff0c\u5982\u679c\u5d4c\u5957\u5bf9\u8c61\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u5219\u5e94\u5c06 `many = True` \u6807\u5fd7\u4f20\u9012\u7ed9\u5d4c\u5957\u7684\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n``` python\r\nclass CommentSerializer(serializers.Serializer):\r\n    user = UserSerializer(required=False)\r\n    edits = EditItemSerializer(many=True)  # A nested list of 'edit' items.\r\n    content = serializers.CharField(max_length=200)\r\n    created = serializers.DateTimeField()\r\n```\r\n\r\n### \u53ef\u5199\u5d4c\u5957\u8868\u793a\r\n\r\n\u5728\u5904\u7406\u652f\u6301\u53cd\u5e8f\u5217\u5316\u6570\u636e\u7684\u5d4c\u5957\u8868\u793a\u65f6\uff0c\u5d4c\u5957\u5bf9\u8c61\u7684\u4efb\u4f55\u9519\u8bef\u90fd\u5c06\u5d4c\u5957\u5728\u5d4c\u5957\u5bf9\u8c61\u7684\u5b57\u6bb5\u540d\u79f0\u4e0b\u3002\r\n\r\n``` python\r\nserializer = CommentSerializer(data={'user': {'email': 'foobar', 'username': 'doe'}, 'content': 'baz'})\r\nserializer.is_valid()\r\n# False\r\nserializer.errors\r\n# {'user': {'email': [u'Enter a valid e-mail address.']}, 'created': [u'This field is required.']}\r\n```\r\n\r\n\u540c\u6837\uff0c`.validated_data` \u5c5e\u6027\u5c06\u5305\u542b\u5d4c\u5957\u7684\u6570\u636e\u7ed3\u6784\u3002\r\n\r\n\r\n#### \u4e3a\u5d4c\u5957\u8868\u793a\u4e66\u5199 `.create()` \u65b9\u6cd5\r\n\r\n\u5982\u679c\u4f60\u652f\u6301\u53ef\u5199\u5d4c\u5957\u8868\u793a\uff0c\u5219\u9700\u8981\u7f16\u5199\u5904\u7406\u4fdd\u5b58\u591a\u4e2a\u5bf9\u8c61\u7684 `.create()` \u6216 `.update()` \u65b9\u6cd5\u3002\r\n\r\n\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u5904\u7406\u4f7f\u7528\u5d4c\u5957\u914d\u7f6e\u6587\u4ef6\u5bf9\u8c61\u521b\u5efa\u7528\u6237\u3002\r\n\r\n``` python\r\nclass UserSerializer(serializers.ModelSerializer):\r\n    profile = ProfileSerializer()\r\n\r\n    class Meta:\r\n        model = User\r\n        fields = ('username', 'email', 'profile')\r\n\r\n    def create(self, validated_data):\r\n        profile_data = validated_data.pop('profile')\r\n        user = User.objects.create(**validated_data)\r\n        Profile.objects.create(user=user, **profile_data)\r\n        return user\r\n```\r\n\r\n#### \u4e3a\u5d4c\u5957\u8868\u793a\u4e66\u5199 `.update()` \u65b9\u6cd5\r\n\r\n\u5bf9\u4e8e\u66f4\u65b0\uff0c\u60a8\u9700\u8981\u4ed4\u7ec6\u8003\u8651\u5982\u4f55\u5904\u7406\u5173\u7cfb\u66f4\u65b0\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5173\u7cfb\u7684\u6570\u636e\u662f `None` \u6216\u6ca1\u6709\u63d0\u4f9b\uff0c\u5219\u5e94\u53d1\u751f\u4ee5\u4e0b\u54ea\u79cd\u60c5\u51b5\uff1f\r\n\r\n* \u5728\u6570\u636e\u5e93\u4e2d\u5c06\u5173\u7cfb\u8bbe\u7f6e\u4e3a `NULL`\u3002\r\n* \u5220\u9664\u5173\u8054\u7684\u5b9e\u4f8b\u3002\r\n* \u5ffd\u7565\u6570\u636e\u5e76\u4fdd\u6301\u539f\u6837\u3002\r\n* \u5f15\u53d1\u9a8c\u8bc1\u9519\u8bef\u3002\r\n\r\n\r\n\u4ee5\u4e0b\u662f\u6211\u4eec\u4ee5\u524d\u7684 `UserSerializer` \u7c7b\u4e2d\u7684 `.update()` \u65b9\u6cd5\u7684\u793a\u4f8b\u3002\r\n\r\n``` python\r\n    def update(self, instance, validated_data):\r\n        profile_data = validated_data.pop('profile')\r\n        # Unless the application properly enforces that this field is\r\n        # always set, the follow could raise a `DoesNotExist`, which\r\n        # would need to be handled.\r\n        profile = instance.profile\r\n\r\n        instance.username = validated_data.get('username', instance.username)\r\n        instance.email = validated_data.get('email', instance.email)\r\n        instance.save()\r\n\r\n        profile.is_premium_member = profile_data.get(\r\n            'is_premium_member',\r\n            profile.is_premium_member\r\n        )\r\n        profile.has_support_contract = profile_data.get(\r\n            'has_support_contract',\r\n            profile.has_support_contract\r\n         )\r\n        profile.save()\r\n\r\n        return instance\r\n```\r\n\r\n\u56e0\u4e3a\u5d4c\u5957\u521b\u5efa\u548c\u66f4\u65b0\u7684\u884c\u4e3a\u53ef\u80fd\u4e0d\u660e\u786e\uff0c\u5e76\u4e14\u53ef\u80fd\u9700\u8981\u76f8\u5173\u6a21\u578b\u4e4b\u95f4\u7684\u590d\u6742\u4f9d\u8d56\u5173\u7cfb\uff0c\u6240\u4ee5 REST framework 3 \u8981\u6c42\u4f60\u59cb\u7ec8\u660e\u786e\u5199\u5165\u8fd9\u4e9b\u65b9\u6cd5\u3002\u9ed8\u8ba4\u7684 `ModelSerializer` \u7684 `.create()`\u548c `.update()` \u65b9\u6cd5\u4e0d\u5305\u62ec\u5bf9\u53ef\u5199\u5d4c\u5957\u8868\u793a\u7684\u652f\u6301\u3002\r\n\r\n\u4e0d\u8fc7\uff0c\u6709\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5305\u53ef\u7528\uff0c\u5982\u652f\u6301\u81ea\u52a8\u53ef\u5199\u5d4c\u5957\u8868\u793a\u7684 [DRF Writable Nested](http://www.django-rest-framework.org/api-guide/serializers/#drf-writable-nested)\u3002\r\n\r\n\r\n#### \u5728\u6a21\u578b\u7ba1\u7406\u5668\u7c7b\u4e2d\u4fdd\u5b58\u76f8\u5173\u7684\u5b9e\u4f8b\r\n\r\n\u5728\u5e8f\u5217\u5316\u7c7b\u4e2d\u4fdd\u5b58\u591a\u4e2a\u76f8\u5173\u5b9e\u4f8b\u7684\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u7f16\u5199\u81ea\u5b9a\u4e49\u6a21\u578b\u7ba1\u7406\u5668\u7c7b\u3002\r\n\r\n\u4f8b\u5982\uff0c\u5047\u8bbe\u6211\u4eec\u5e0c\u671b\u786e\u4fdd `User` \u5b9e\u4f8b\u548c `Profile` \u5b9e\u4f8b\u59cb\u7ec8\u4f5c\u4e3a\u4e00\u5bf9\u521b\u5efa\u3002\u6211\u4eec\u53ef\u80fd\u4f1a\u7f16\u5199\u4e00\u4e2a\u7c7b\u4f3c\u4e0b\u9762\u7684\u81ea\u5b9a\u4e49\u7ba1\u7406\u5668\u7c7b\uff1a\r\n\r\n``` python\r\nclass UserManager(models.Manager):\r\n    ...\r\n\r\n    def create(self, username, email, is_premium_member=False, has_support_contract=False):\r\n        user = User(username=username, email=email)\r\n        user.save()\r\n        profile = Profile(\r\n            user=user,\r\n            is_premium_member=is_premium_member,\r\n            has_support_contract=has_support_contract\r\n        )\r\n        profile.save()\r\n        return user\r\n```\r\n\r\n\u6b64\u7ba1\u7406\u5668\u7c7b\u73b0\u5728\u66f4\u597d\u5730\u5c01\u88c5\u4e86\u7528\u6237\u5b9e\u4f8b\u548c\u914d\u7f6e\u6587\u4ef6\u5b9e\u4f8b\u59cb\u7ec8\u5728\u540c\u4e00\u65f6\u95f4\u521b\u5efa\u3002\u73b0\u5728\u53ef\u4ee5\u91cd\u65b0\u7f16\u5199\u5e8f\u5217\u5316\u7c7b\u4e0a\u7684 `.create()`\u65b9\u6cd5\uff0c\u4ee5\u4f7f\u7528\u65b0\u7684\u7ba1\u7406\u7c7b\u65b9\u6cd5\u3002\r\n\r\n``` python\r\ndef create(self, validated_data):\r\n    return User.objects.create(\r\n        username=validated_data['username'],\r\n        email=validated_data['email']\r\n        is_premium_member=validated_data['profile']['is_premium_member']\r\n        has_support_contract=validated_data['profile']['has_support_contract']\r\n    )\r\n```\r\n\r\n\r\n### \u5904\u7406\u591a\u4e2a\u5bf9\u8c61\r\n\r\n`Serializer` \u7c7b\u8fd8\u53ef\u4ee5\u5904\u7406\u5e8f\u5217\u5316\u6216\u53cd\u5e8f\u5217\u5316\u5bf9\u8c61\u5217\u8868\u3002\r\n\r\n#### \u5e8f\u5217\u5316\u591a\u4e2a\u5bf9\u8c61\r\n\r\n\u8981\u5e8f\u5217\u5316\u67e5\u8be2\u96c6\u6216\u5bf9\u8c61\u5217\u8868\u800c\u4e0d\u662f\u5355\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u5728\u5b9e\u4f8b\u5316\u5e8f\u5217\u5316\u7c7b\u65f6\uff0c\u5e94\u8be5\u4f20\u9012 `many=True` \u6807\u5fd7\u3002\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u4f20\u9012\u8981\u5e8f\u5217\u5316\u7684\u67e5\u8be2\u96c6\u6216\u5bf9\u8c61\u5217\u8868\u3002\r\n\r\n``` python\r\nqueryset = Book.objects.all()\r\nserializer = BookSerializer(queryset, many=True)\r\nserializer.data\r\n# [\r\n#     {'id': 0, 'title': 'The electric kool-aid acid test', 'author': 'Tom Wolfe'},\r\n#     {'id': 1, 'title': 'If this is a man', 'author': 'Primo Levi'},\r\n#     {'id': 2, 'title': 'The wind-up bird chronicle', 'author': 'Haruki Murakami'}\r\n# ]\r\n```\r\n\r\n#### \u53cd\u5e8f\u5217\u5316\u591a\u4e2a\u5bf9\u8c61\r\n\r\n\u53cd\u5e8f\u5217\u5316\u591a\u4e2a\u5bf9\u8c61\u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u652f\u6301\u591a\u4e2a\u5bf9\u8c61\u521b\u5efa\uff0c\u4f46\u4e0d\u652f\u6301\u591a\u4e2a\u5bf9\u8c61\u66f4\u65b0\u3002\r\n\r\n\r\n\r\n### \u5305\u542b\u989d\u5916\u7684\u4e0a\u4e0b\u6587\r\n\r\n\u9664\u4e86\u88ab\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u60c5\u51b5\u9700\u8981\u4e3a\u5e8f\u5217\u5316\u7c7b\u63d0\u4f9b\u989d\u5916\u7684\u4e0a\u4e0b\u6587\u3002\u4e00\u79cd\u5e38\u89c1\u7684\u60c5\u51b5\u662f\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u5305\u542b\u8d85\u94fe\u63a5\u5173\u7cfb\u7684\u5e8f\u5217\u5316\u7c7b\uff0c\u5219\u9700\u8981\u5e8f\u5217\u5316\u7c7b\u8bbf\u95ee\u5f53\u524d\u8bf7\u6c42\uff0c\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u6b63\u786e\u751f\u6210\u5b8c\u5168\u9650\u5b9a\u7684URL\u3002\r\n\r\n\u5728\u5b9e\u4f8b\u5316\u5e8f\u5217\u5316\u5bf9\u8c61\u65f6\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012\u4e0a\u4e0b\u6587\u53c2\u6570\u6765\u63d0\u4f9b\u4efb\u610f\u9644\u52a0\u4e0a\u4e0b\u6587\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nserializer = AccountSerializer(account, context={'request': request})\r\nserializer.data\r\n# {'id': 6, 'owner': u'denvercoder9', 'created': datetime.datetime(2013, 2, 12, 09, 44, 56, 678870), 'details': 'http://example.com/accounts/6/details'}\r\n```\r\n\r\n\u901a\u8fc7\u8bbf\u95ee `self.context` \u5c5e\u6027\uff0c\u53ef\u4ee5\u5728\u4efb\u4f55\u5e8f\u5217\u5316\u5bf9\u8c61\u5b57\u6bb5\u903b\u8f91\u4e2d\u4f7f\u7528\u4e0a\u4e0b\u6587\u5b57\u5178\uff0c\u4f8b\u5982\u81ea\u5b9a\u4e49\u7684 `.to_representation()` \u65b9\u6cd5\u3002\r\n\r\n## ModelSerializer\r\n\r\n\u901a\u5e38\u4f60\u4f1a\u60f3\u8981\u5e8f\u5217\u5316\u7c7b\u7d27\u5bc6\u5730\u6620\u5c04\u5230 Django \u6a21\u578b\u5b9a\u4e49\u4e0a\u3002\r\n\r\n`ModelSerializer` \u7c7b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff0c\u53ef\u8ba9\u4f60\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a `Serializer` \u7c7b\uff0c\u5176\u4e2d\u7684\u5b57\u6bb5\u4e0e\u6a21\u578b\u7c7b\u5b57\u6bb5\u5bf9\u5e94\u3002\r\n\r\n**`ModelSerializer` \u7c7b\u4e0e\u5e38\u89c4 `Serializer` \u7c7b\u76f8\u540c\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a**  \r\n* \u5b83\u4f1a\u6839\u636e\u6a21\u578b\u81ea\u52a8\u751f\u6210\u4e00\u7ec4\u5b57\u6bb5\u3002\r\n* \u5b83\u4f1a\u81ea\u52a8\u4e3a\u5e8f\u5217\u5316\u7c7b\u751f\u6210\u9a8c\u8bc1\u5668\uff0c\u4f8b\u5982 unique_together \u9a8c\u8bc1\u5668\u3002\r\n* \u5b83\u5305\u542b `.create()` \u548c `.update()` \u7684\u7b80\u5355\u9ed8\u8ba4\u5b9e\u73b0\u3002\r\n\r\n\u58f0\u660eModelSerializer\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = ('id', 'account_name', 'users', 'created')\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u7c7b\u4e2d\u7684\u6240\u6709\u6a21\u578b\u7c7b\u5b57\u6bb5\u5c06\u88ab\u6620\u5c04\u4e3a\u76f8\u5e94\u7684\u5e8f\u5217\u5316\u7c7b\u5b57\u6bb5\u3002\r\n\r\n\u4efb\u4f55\u5173\u7cfb\uff08\u5982\u6a21\u578b\u4e0a\u7684\u5916\u952e\uff09\u90fd\u5c06\u6620\u5c04\u5230 `PrimaryKeyRelatedField` \u3002\u9664\u975e\u5728\u5e8f\u5217\u5316\u5173\u7cfb\u6587\u6863\u4e2d\u6307\u5b9a\uff0c\u5426\u5219\u9ed8\u8ba4\u4e0d\u5305\u62ec\u53cd\u5411\u5173\u7cfb\u3002\r\n\r\n\r\n\r\n\r\n### \u68c0\u67e5 `ModelSerializer`\r\n\r\n\u5e8f\u5217\u5316\u7c7b\u80fd\u591f\u751f\u6210\u4e00\u4e2a\u8868\u793a\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u8ba9\u4f60\u5145\u5206\u68c0\u67e5\u5176\u5b57\u6bb5\u7684\u72b6\u6001\u3002\u5728\u4f7f\u7528 `ModelSerializer` \u8fdb\u884c\u5de5\u4f5c\u65f6\uff0c\u8fd9\u662f\u7279\u522b\u6709\u7528\u7684\uff0c\u4f60\u9700\u8981\u786e\u5b9a\u5b83\u4e3a\u4f60\u81ea\u52a8\u521b\u5efa\u4e86\u54ea\u4e9b\u5b57\u6bb5\u548c\u9a8c\u8bc1\u5668\u3002\r\n\r\n\u4e3a\u6b64\uff0c\u4f7f\u7528 `python manage.py shell` \u8fdb\u5165 Django shell\uff0c\u7136\u540e\u5bfc\u5165\u5e8f\u5217\u5316\u7c7b\uff0c\u5b9e\u4f8b\u5316\u5b83\u5e76\u6253\u5370\u5bf9\u8c61\u8868\u793a\u5f62\u5f0f...\r\n\r\n``` python\r\n>>> from myapp.serializers import AccountSerializer\r\n>>> serializer = AccountSerializer()\r\n>>> print(repr(serializer))\r\nAccountSerializer():\r\n    id = IntegerField(label='ID', read_only=True)\r\n    name = CharField(allow_blank=True, max_length=100, required=False)\r\n    owner = PrimaryKeyRelatedField(queryset=User.objects.all())\r\n```\r\n\r\n\r\n### \u6307\u5b9a\u8981\u5305\u542b\u7684\u5b57\u6bb5\r\n\r\n\u5982\u679c\u4f60\u53ea\u5e0c\u671b\u5728\u6a21\u578b\u5e8f\u5217\u5316\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u9ed8\u8ba4\u5b57\u6bb5\u7684\u5b50\u96c6\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 `fields` \u6216 `exclude` \u9009\u9879\u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\uff0c\u5c31\u50cf\u4f7f\u7528 `ModelForm` \u4e00\u6837\u3002\u5f3a\u70c8\u5efa\u8bae\u4f60\u663e\u5f0f\u4f7f\u7528 `fields` \u5c5e\u6027\u5e8f\u5217\u5316\u7684\u6240\u6709\u5b57\u6bb5\u3002\u8fd9\u5c06\u4f7f\u4f60\u4e0d\u592a\u53ef\u80fd\u5728\u6a21\u578b\u66f4\u6539\u65f6\u65e0\u610f\u4e2d\u66b4\u9732\u6570\u636e\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = ('id', 'account_name', 'users', 'created')\r\n```\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u5c06 `fields` \u5c5e\u6027\u8bbe\u7f6e\u4e3a\u7279\u6b8a\u503c `'__all__'`\uff0c\u4ee5\u6307\u793a\u5e94\u8be5\u4f7f\u7528\u6a21\u578b\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u3002\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = '__all__'\r\n```\r\n\r\n\r\n\u4f60\u53ef\u4ee5\u5c06 `exclude` \u5c5e\u6027\u8bbe\u7f6e\u4e3a\u4ece\u5e8f\u5217\u5316\u7a0b\u5e8f\u4e2d\u6392\u9664\u7684\u5b57\u6bb5\u5217\u8868\u3002\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        exclude = ('users',)\r\n```\r\n\r\n\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5982\u679c `Account` \u6a21\u578b\u67093\u4e2a\u5b57\u6bb5 `account_name`\uff0c`users` \u548c `created`\uff0c\u5219\u4f1a\u5bfc\u81f4\u5b57\u6bb5 `account_name` \u548c `created` \u88ab\u5e8f\u5217\u5316\u3002\r\n\r\n`fields` \u548c `exclude` \u5c5e\u6027\u4e2d\u7684\u540d\u79f0\u901a\u5e38\u6620\u5c04\u5230\u6a21\u578b\u7c7b\u7684\u6a21\u578b\u5b57\u6bb5\u3002\r\n\r\n\u6216\u8005`fields`\u9009\u9879\u4e2d\u7684\u540d\u79f0\u53ef\u4ee5\u6620\u5c04\u6210\u5c5e\u6027\u6216\u65b9\u6cd5\u3002\u800c\u4e0d\u4f1a\u53d8\u6210\u6a21\u578b\u7c7b\u4e2d\u7684\u53c2\u6570\u3002\r\n\r\n\r\n\u4ece\u7248\u672c 3.3.0 \u5f00\u59cb\uff0c\u5fc5\u987b\u63d0\u4f9b\u5176\u4e2d\u4e00\u4e2a\u5c5e\u6027 `fields` \u6216 `exclude`\u3002\r\n\r\n### \u6307\u5b9a\u5d4c\u5957\u5e8f\u5217\u5316\r\n\r\n\r\n\u9ed8\u8ba4\u7684 `ModelSerializer` \u4f7f\u7528\u4e3b\u952e\u8fdb\u884c\u5173\u8054\uff0c\u4f46\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 `depth` \u9009\u9879\u8f7b\u677e\u751f\u6210\u5d4c\u5957\u8868\u793a\uff08\u81ea\u5173\u8054\uff09\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = ('id', 'account_name', 'users', 'created')\r\n        depth = 1\r\n```\r\n\r\n`depth` \u9009\u9879\u5e94\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u6574\u6570\u503c\uff0c\u8be5\u503c\u6307\u793a\u5728\u8fd8\u539f\u4e3a\u5e73\u9762\u8868\u793a\u4e4b\u524d\u5e94\u8be5\u904d\u5386\u7684\u5173\u8054\u7684\u6df1\u5ea6\u3002\r\n\r\n\r\n\u5982\u679c\u4f60\u60f3\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u7684\u65b9\u5f0f\uff0c\u4f60\u9700\u8981\u81ea\u5df1\u5b9a\u4e49\u5b57\u6bb5\u3002\r\n\r\n\r\n### \u663e\u5f0f\u6307\u5b9a\u5b57\u6bb5\r\n\r\n\u4f60\u53ef\u4ee5\u5c06\u989d\u5916\u7684\u5b57\u6bb5\u6dfb\u52a0\u5230 `ModelSerializer`\uff0c\u6216\u8005\u901a\u8fc7\u5728\u7c7b\u4e0a\u58f0\u660e\u5b57\u6bb5\u6765\u8986\u76d6\u9ed8\u8ba4\u5b57\u6bb5\uff0c\u5c31\u50cf\u4f60\u5bf9 `Serializer` \u7c7b\u6240\u505a\u7684\u90a3\u6837\u3002\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    url = serializers.CharField(source='get_absolute_url', read_only=True)\r\n    groups = serializers.PrimaryKeyRelatedField(many=True)\r\n\r\n    class Meta:\r\n        model = Account\r\n```\r\n\r\n\u989d\u5916\u7684\u5b57\u6bb5\u53ef\u4ee5\u5bf9\u5e94\u4e8e\u6a21\u578b\u4e0a\u7684\u4efb\u4f55\u5c5e\u6027\u6216\u53ef\u8c03\u7528\u7684\u5b57\u6bb5\u3002\r\n\r\n### \u6307\u5b9a\u53ea\u8bfb\u5b57\u6bb5\r\n\r\n\u4f60\u53ef\u80fd\u5e0c\u671b\u5c06\u591a\u4e2a\u5b57\u6bb5\u6307\u5b9a\u4e3a\u53ea\u8bfb\u3002\u4e0d\u8981\u663e\u5f0f\u7ed9\u6bcf\u4e2a\u5b57\u6bb5\u6dfb\u52a0 `read_only = True`\u5c5e\u6027\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5feb\u6377\u65b9\u5f0f Meta \u9009\u9879 `read_only_fields` \u3002\r\n\r\n\u8be5\u9009\u9879\u5e94\u8be5\u662f\u5b57\u6bb5\u540d\u79f0\u7684\u5217\u8868\u6216\u5143\u7ec4\uff0c\u58f0\u660e\u5982\u4e0b\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = ('id', 'account_name', 'users', 'created')\r\n        read_only_fields = ('account_name',)\r\n```\r\n\r\n\u542b\u6709 `editable = False`\u7684\u6a21\u578b\u5b57\u6bb5\uff0c`AutoField` \u5b57\u6bb5\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u6dfb\u52a0\u5230 `read_only_fields` \u9009\u9879\u3002\r\n\r\n\r\n> **\u6ce8\u610f**\uff1a \u6709\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff0c\u53ea\u8bfb\u5b57\u6bb5\u662f\u6a21\u578b\u7ea7\u522b\u7684 `unique_together` \u7ea6\u675f\u7684\u4e00\u90e8\u5206\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e8f\u5217\u5316\u7c7b\u9700\u8981\u9a8c\u8bc1\u7ea6\u675f\u8be5\u5b57\u6bb5\uff0c\u4f46\u4e5f\u4e0d\u80fd\u7531\u7528\u6237\u7f16\u8f91\u3002\r\n\r\n> \u5904\u7406\u8fd9\u4e2a\u95ee\u9898\u7684\u6b63\u786e\u65b9\u6cd5\u662f\u5728\u5e8f\u5217\u5316\u7c7b\u4e2d\u660e\u786e\u6307\u5b9a\u5b57\u6bb5\uff0c\u540c\u65f6\u63d0\u4f9b `read_only = True` \u548c `default = ...` \u5173\u952e\u5b57\u53c2\u6570\u3002\r\n\r\n> \u5176\u4e2d\u4e00\u4e2a\u4f8b\u5b50\u662f\u4e0e\u5f53\u524d\u8ba4\u8bc1 `User` \u7684\u53ea\u8bfb\u5173\u7cfb\uff0c\u5b83\u4e0e\u53e6\u4e00\u4e2a\u6807\u8bc6\u7b26\u662f `unique_together` \u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u4f1a\u50cf\u8fd9\u6837\u58f0\u660e\u7528\u6237\u5b57\u6bb5\uff1a\r\n\r\n``` python\r\nuser = serializers.PrimaryKeyRelatedField(read_only=True, default=serializers.CurrentUserDefault())\r\n```\r\n\r\n> \u5173\u4e8e\u9a8c\u8bc1\u4ee5\u540e\u8fd8\u4f1a\u518d\u8bf4\r\n\r\n### \u5176\u4ed6\u5173\u952e\u5b57\u53c2\u6570\r\n\r\n\u8fd8\u6709\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\u5141\u8bb8\u4f60\u4f7f\u7528 `extra_kwargs` \u9009\u9879\u5728\u5b57\u6bb5\u4e0a\u6307\u5b9a\u4efb\u610f\u9644\u52a0\u5173\u952e\u5b57\u53c2\u6570\u3002\u4e0e `read_only_fields` \u7684\u60c5\u51b5\u4e00\u6837\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u4e0d\u9700\u8981\u5728\u5e8f\u5217\u5316\u7c7b\u4e2d\u663e\u5f0f\u58f0\u660e\u8be5\u5b57\u6bb5\u3002\r\n\r\n\u8be5\u9009\u9879\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5c06\u5b57\u6bb5\u540d\u79f0\u6620\u5c04\u5230\u5173\u952e\u5b57\u53c2\u6570\u5b57\u5178\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass CreateUserSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = User\r\n        fields = ('email', 'username', 'password')\r\n        extra_kwargs = {'password': {'write_only': True}}\r\n\r\n    def create(self, validated_data):\r\n        user = User(\r\n            email=validated_data['email'],\r\n            username=validated_data['username']\r\n        )\r\n        user.set_password(validated_data['password'])\r\n        user.save()\r\n        return user\r\n```\r\n\r\n\r\n\r\n### \u5173\u7cfb\u5b57\u6bb5\r\n\r\n\u5e8f\u5217\u5316\u6a21\u578b\u5b9e\u4f8b\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u591a\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u8868\u793a\u5173\u7cfb\u3002`ModelSerializer` \u7684\u9ed8\u8ba4\u8868\u793a\u662f\u4f7f\u7528\u76f8\u5173\u5b9e\u4f8b\u7684\u4e3b\u952e\u3002\r\n\r\n\u5176\u4ed6\u8868\u793a\u5f62\u5f0f\u5305\u62ec\u4f7f\u7528\u8d85\u94fe\u63a5\u5e8f\u5217\u5316\uff0c\u5e8f\u5217\u5316\u5b8c\u6574\u5d4c\u5957\u8868\u793a\u5f62\u5f0f\u6216\u4f7f\u7528\u81ea\u5b9a\u4e49\u8868\u793a\u5f62\u5f0f\u5e8f\u5217\u5316\u3002\r\n\r\n\r\n### \u81ea\u5b9a\u4e49\u5b57\u6bb5\u6620\u5c04\r\n\r\nModelSerializer \u7c7b\u8fd8\u516c\u5f00\u4e86\u4e00\u4e2a\u53ef\u4ee5\u8986\u76d6\u7684 API\uff0c\u4ee5\u4fbf\u5728\u5b9e\u4f8b\u5316\u5e8f\u5217\u5316\u5bf9\u8c61\u65f6\u66f4\u6539\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u5b57\u6bb5\u3002\r\n\r\n\r\n\u901a\u5e38\uff0c\u5982\u679c `ModelSerializer` \u6ca1\u529e\u6cd5\u751f\u6210\u9ed8\u8ba4\u9700\u8981\u7684\u5b57\u6bb5\uff0c\u90a3\u4e48\u4f60\u5e94\u8be5\u5c06\u5b83\u4eec\u660e\u786e\u5730\u6dfb\u52a0\u5230\u7c7b\u4e2d\uff0c\u6216\u8005\u76f4\u63a5\u4f7f\u7528\u5e38\u89c4\u7684`Serializer` \u7c7b\u3002\u4f46\u662f\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u57fa\u7c7b\uff0c\u4ee5\u5b9a\u4e49\u5982\u4f55\u4e3a\u7ed9\u5b9a\u6a21\u578b\u521b\u5efa\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u5b57\u6bb5\u3002\r\n\r\n\r\n**`.serializer_field_mapping`**\r\n\r\nDjango \u6a21\u578b\u7c7b\u5230 REST framework \u5e8f\u5217\u5316\u7c7b\u7684\u6620\u5c04\u3002\u4f60\u53ef\u4ee5\u91cd\u5199\u6b64\u6620\u5c04\u6765\u66f4\u6539\u5e94\u8be5\u7528\u4e8e\u6bcf\u4e2a\u6a21\u578b\u7c7b\u7684\u9ed8\u8ba4\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n\r\n**`.serializer_related_field`**\r\n\r\n\u8be5\u5c5e\u6027\u5e94\u8be5\u662f\u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u7c7b\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7528\u4e8e\u5173\u7cfb\u5b57\u6bb5\u3002\r\n\r\n\u5bf9\u4e8e `ModelSerializer`\uff0c\u5b83\u9ed8\u8ba4\u4e3a `PrimaryKeyRelatedField`\u3002\r\n\r\n\u5bf9\u4e8e `HyperlinkedModelSerializer`\uff0c\u5b83\u9ed8\u8ba4\u4e3a `serializers.HyperlinkedRelatedField`\u3002\r\n\r\n**`serializer_url_field`**\r\n\r\n\u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u7c7b\uff0c\u5e94\u8be5\u7528\u4e8e\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u4efb\u4f55 `url` \u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u662f `serializers.HyperlinkedIdentityField` \u3002\r\n\r\n\r\n**`serializer_choice_field`**\r\n\r\n\u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u7c7b\uff0c\u5e94\u8be5\u7528\u4e8e\u5e8f\u5217\u5316\u7a0b\u5e8f\u4e2d\u7684\u4efb\u4f55\u9009\u62e9\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u662f `serializers.ChoiceField`\u3002\r\n\r\n\r\n####  field_class \u548c  field_kwargs API\r\n\r\n\u8c03\u7528\u4ee5\u4e0b\u65b9\u6cd5\u6765\u786e\u5b9a\u5e94\u8be5\u81ea\u52a8\u5305\u542b\u5728\u5e8f\u5217\u5316\u7a0b\u5e8f\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\u7684\u7c7b\u548c\u5173\u952e\u5b57\u53c2\u6570\u3002\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u5e94\u8fd4\u56de\u4e24\u4e2a\u5143\u7ec4 `(field_class, field_kwargs)`\u3002\r\n\r\n\r\n\r\n**`.build_standard_field(self, field_name, model_field)`**\r\n\r\n\u8c03\u7528\u4ee5\u751f\u6210\u6620\u5c04\u5230\u6807\u51c6\u6a21\u578b\u5b57\u6bb5\u7684\u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u5b9e\u73b0\u57fa\u4e8e `serializer_field_mapping` \u5c5e\u6027\u8fd4\u56de\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n**`.build_relational_field(self, field_name, relation_info)`**\r\n\r\n\u8c03\u7528\u4ee5\u751f\u6210\u6620\u5c04\u5230\u5173\u7cfb\u6a21\u578b\u5b57\u6bb5\u7684\u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u5b9e\u73b0\u57fa\u4e8e `serializer_relational_field` \u5c5e\u6027\u8fd4\u56de\u4e00\u4e2a\u5e8f\u5217\u5316\u7c7b\u3002 \r\n\r\n`relation_info` \u53c2\u6570\u662f\u4e00\u4e2a\u547d\u540d\u5143\u7ec4\uff0c\u5b83\u5305\u542b `model_field`\uff0c`related_model`\uff0c`to_many`\u548c `has_through_model` \u5c5e\u6027\u3002\r\n\r\n**`.build_nested_field(self, field_name, relation_info, nested_depth)`**\r\n\r\n\u5f53 `depth` \u9009\u9879\u5df2\u8bbe\u7f6e\u65f6\uff0c\u8c03\u7528\u4ee5\u751f\u6210\u6620\u5c04\u5230\u5173\u7cfb\u6a21\u578b\u5b57\u6bb5\u7684\u5e8f\u5217\u5316\u7a0b\u5e8f\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u5b9e\u73b0\u52a8\u6001\u521b\u5efa\u4e00\u4e2a\u57fa\u4e8e `ModelSerializer` \u6216 `HyperlinkedModelSerializer` \u7684\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n`nested_depth` \u5c06\u662f `depth` \u9009\u9879\u7684\u503c\u51cf 1\u3002\r\n\r\n`relation_info` \u53c2\u6570\u662f\u4e00\u4e2a\u547d\u540d\u5143\u7ec4\uff0c\u5b83\u5305\u542b `model_field`\uff0c`related_model`\uff0c`to_many`\u548c `has_through_model` \u5c5e\u6027\u3002\r\n\r\n\r\n**`.build_property_field(self, field_name, model_class)`**\r\n\r\n\u8c03\u7528\u4ee5\u751f\u6210\u6620\u5c04\u5230\u6a21\u578b\u7c7b\u4e0a\u7684\u5c5e\u6027\u6216\u96f6\u53c2\u6570\u65b9\u6cd5\u7684\u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u5b9e\u73b0\u8fd4\u56de\u4e00\u4e2a `ReadOnlyField` \u7c7b\u3002\r\n\r\n\r\n**`.build_url_field(self, field_name, model_class)`**\r\n\r\n\u88ab\u8c03\u7528\u6765\u4e3a\u5e8f\u5217\u5316\u5668\u81ea\u5df1\u7684 `url` \u5b57\u6bb5\u751f\u6210\u4e00\u4e2a\u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u3002\r\n\r\n\u9ed8\u8ba4\u5b9e\u73b0\u8fd4\u56de\u4e00\u4e2a `HyperlinkedIdentityField` \u7c7b\u3002\r\n\r\n\r\n**`.build_unknown_field(self, field_name, model_class)`**\r\n\r\n\u5f53\u5b57\u6bb5\u540d\u79f0\u672a\u6620\u5c04\u5230\u4efb\u4f55\u6a21\u578b\u5b57\u6bb5\u6216\u6a21\u578b\u5c5e\u6027\u65f6\u8c03\u7528\u3002\u9ed8\u8ba4\u5b9e\u73b0\u4f1a\u5f15\u53d1\u9519\u8bef\u3002\u4f46\u662f\u5b50\u7c7b\u53ef\u4ee5\u81ea\u5b9a\u4e49\u8fd9\u79cd\u884c\u4e3a\u3002\r\n\r\n\r\n\r\n## HyperlinkedModelSerializer\r\n\r\n`HyperlinkedModelSerializer` \u7c7b\u4e0e `ModelSerializer` \u7c7b\u76f8\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5b83\u4f7f\u7528\u8d85\u94fe\u63a5\u6765\u8868\u793a\u5173\u7cfb\u800c\u4e0d\u662f\u4e3b\u952e\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5e8f\u5217\u5316\u5668\u5c06\u5305\u542b\u4e00\u4e2a `url` \u5b57\u6bb5\u800c\u4e0d\u662f\u4e3b\u952e\u5b57\u6bb5\u3002\r\n\r\nurl \u5b57\u6bb5\u5c06\u4f7f\u7528 `HyperlinkedIdentityField` \u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u6765\u8868\u793a\uff0c\u5e76\u4e14\u6a21\u578b\u4e0a\u7684\u4efb\u4f55\u5173\u7cfb\u90fd\u5c06\u4f7f\u7528 `HyperlinkedRelatedField` \u5e8f\u5217\u5316\u5668\u5b57\u6bb5\u6765\u8868\u793a\u3002\r\n\r\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u5c06\u4e3b\u952e\u6dfb\u52a0\u5230 `fields` \u9009\u9879\u6765\u660e\u786e\u5305\u542b\u4e3b\u952e\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.HyperlinkedModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = ('url', 'id', 'account_name', 'users', 'created')\r\n```\r\n\r\n\r\n### \u7edd\u5bf9\u548c\u76f8\u5bf9 URL\r\n\r\n\u5728\u5b9e\u4f8b\u5316 `HyperlinkedModelSerializer` \u65f6\uff0c\u5fc5\u987b\u5728\u5e8f\u5217\u5316\u4e0a\u4e0b\u6587\u4e2d\u5305\u542b\u5f53\u524d\u8bf7\u6c42\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nserializer = AccountSerializer(queryset, context={'request': request})\r\n```\r\n\r\n\u8fd9\u6837\u505a\u5c06\u786e\u4fdd\u8d85\u94fe\u63a5\u53ef\u4ee5\u5305\u542b\u9002\u5f53\u7684\u4e3b\u673a\u540d\uff0c\u4ee5\u4fbf\u751f\u6210\u5b8c\u5168\u9650\u5b9a\u7684 URL\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nhttp://api.example.com/accounts/1/\r\n```\r\n\r\n\u800c\u4e0d\u662f\u76f8\u5bf9\u7684 URL\uff0c\u4f8b\u5982\uff1a\r\n\r\n``` python\r\n/accounts/1/\r\n```\r\n\r\n\u5982\u679c\u4f60\u786e\u5b9e\u60f3\u8981\u4f7f\u7528\u76f8\u5bf9 URL\uff0c\u5219\u5e94\u8be5\u5728\u5e8f\u5217\u5316\u4e0a\u4e0b\u6587\u4e2d\u663e\u5f0f\u4f20\u9012 `{'request'\uff1aNone}`\u3002\r\n\r\n\r\n### \u5982\u4f55\u786e\u5b9a\u8d85\u94fe\u63a5\u89c6\u56fe\r\n\r\n\u9700\u8981\u786e\u5b9a\u54ea\u4e9b\u89c6\u56fe\u5e94\u8be5\u7528\u4e8e\u8d85\u94fe\u63a5\u5230\u6a21\u578b\u5b9e\u4f8b\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8d85\u94fe\u63a5\u9884\u671f\u5bf9\u5e94\u4e8e\u4e0e\u6837\u5f0f `'{model_name}-detail'` \u5339\u914d\u7684\u89c6\u56fe\u540d\u79f0\uff0c\u5e76\u901a\u8fc7 `pk` \u5173\u952e\u5b57\u53c2\u6570\u67e5\u627e\u5b9e\u4f8b\u3002\r\n\r\n\u60a8\u53ef\u4ee5\u4f7f\u7528 `extra_kwargs` \u8bbe\u7f6e\u4e2d\u7684 `view_name` \u548c `lookup_field` \u9009\u9879\u8986\u76d6 URL \u5b57\u6bb5\u89c6\u56fe\u540d\u79f0\u548c\u67e5\u627e\u5b57\u6bb5\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.HyperlinkedModelSerializer):\r\n    class Meta:\r\n        model = Account\r\n        fields = ('account_url', 'account_name', 'users', 'created')\r\n        extra_kwargs = {\r\n            'url': {'view_name': 'accounts', 'lookup_field': 'account_name'},\r\n            'users': {'lookup_field': 'username'}\r\n        }\r\n```\r\n\r\n\r\n\u6216\u8005\uff0c\u53ef\u4ee5\u663e\u5f0f\u8bbe\u7f6e\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u5b57\u6bb5\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(serializers.HyperlinkedModelSerializer):\r\n    url = serializers.HyperlinkedIdentityField(\r\n        view_name='accounts',\r\n        lookup_field='slug'\r\n    )\r\n    users = serializers.HyperlinkedRelatedField(\r\n        view_name='user-detail',\r\n        lookup_field='username',\r\n        many=True,\r\n        read_only=True\r\n    )\r\n\r\n    class Meta:\r\n        model = Account\r\n        fields = ('url', 'account_name', 'users', 'created')\r\n```\r\n\r\n> \u63d0\u793a\uff1a\u6b63\u786e\u5730\u5339\u914d\u8d85\u94fe\u63a5\u548c URL conf \u6709\u65f6\u53ef\u80fd\u6709\u70b9\u56f0\u96be\u3002\u6253\u5370 `HyperlinkedModelSerializer` \u5b9e\u4f8b\u7684 `repr` \u662f\u4e00\u79cd\u7279\u522b\u6709\u7528\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u51c6\u786e\u68c0\u67e5\u8fd9\u4e9b\u5173\u7cfb\u9884\u671f\u6620\u5c04\u7684 view name \u548c lookup field\u3002\r\n\r\n\r\n### \u66f4\u6539 URL \u5b57\u6bb5\u540d\u79f0\r\n\r\nURL \u5b57\u6bb5\u7684\u540d\u79f0\u9ed8\u8ba4\u4e3a 'url'\u3002\u53ef\u4ee5\u4f7f\u7528 `URL_FIELD_NAME`  \uff08\u5728 settings \u6587\u4ef6\uff09\u5168\u5c40\u8986\u76d6\u6b64\u8bbe\u7f6e\u3002\r\n\r\n## ListSerializer\r\n\r\n`ListSerializer` \u7c7b\u63d0\u4f9b\u4e86\u4e00\u6b21\u5e8f\u5217\u5316\u548c\u9a8c\u8bc1\u591a\u4e2a\u5bf9\u8c61\u7684\u884c\u4e3a\u3002\u4f60\u901a\u5e38\u4e0d\u9700\u8981\u76f4\u63a5\u4f7f\u7528 `ListSerializer`\uff0c\u800c\u5e94\u8be5\u5728\u5b9e\u4f8b\u5316\u5e8f\u5217\u5316\u7c7b\u65f6\u7b80\u5355\u5730\u4f20\u9012 `many=True`\u3002\r\n\r\n\u5f53\u4e00\u4e2a\u5e8f\u5217\u5316\u7c7b\u88ab\u5b9e\u4f8b\u5316\u5e76\u4e14 `many = True` \u88ab\u4f20\u9012\u65f6\uff0c\u4e00\u4e2a `ListSerializer` \u5b9e\u4f8b\u5c06\u88ab\u521b\u5efa\u3002\u5e8f\u5217\u5316\u7c7b\u6210\u4e3a\u7236\u7ea7 `ListSerializer` \u7684\u5b50\u7ea7\r\n\r\n\u4ee5\u4e0b\u53c2\u6570\u4e5f\u53ef\u4ee5\u4f20\u9012\u7ed9 `ListSerializer` \u5b57\u6bb5\u6216\u4f20\u9012\u4e86 `many = True` \u7684\u5e8f\u5217\u5316\u7c7b\uff1a\r\n\r\n### `allow_empty`\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a `True`\uff0c\u4f46\u5982\u679c\u8981\u7981\u6b62\u5c06\u7a7a\u5217\u8868\u4f5c\u4e3a\u6709\u6548\u8f93\u5165\uff0c\u5219\u53ef\u5c06\u5176\u8bbe\u7f6e\u4e3a `False`\u3002\r\n\r\n\r\n### \u81ea\u5b9a\u4e49 `ListSerializer` \u884c\u4e3a\r\n\r\n\u6709\u51e0\u79cd\u60c5\u51b5\u53ef\u80fd\u9700\u8981\u81ea\u5b9a\u4e49 `ListSerializer` \u884c\u4e3a\u3002\u4f8b\u5982\uff1a  \r\n* \u5e0c\u671b\u63d0\u4f9b\u5bf9\u5217\u8868\u7684\u7279\u5b9a\u9a8c\u8bc1\uff0c\u4f8b\u5982\u68c0\u67e5\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u4e0e\u5217\u8868\u4e2d\u7684\u53e6\u4e00\u4e2a\u5143\u7d20\u4e0d\u51b2\u7a81\u3002\r\n* \u60f3\u8981\u81ea\u5b9a\u4e49\u591a\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\u6216\u66f4\u65b0\u884c\u4e3a\u3002\r\n\r\n\r\n\u5bf9\u4e8e\u8fd9\u4e9b\u60c5\u51b5\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u5e8f\u5217\u5316\u7c7b\u7684 `Meta` \u7c7b\u4e2d\u7684 `list_serializer_class` \u9009\u9879\u6765\u4fee\u6539\u4f20\u9012\u4e86 `many=True` \u65f6\u4f7f\u7528\u7684\u7c7b\u3002\r\n\r\n``` python\r\nclass CustomListSerializer(serializers.ListSerializer):\r\n    ...\r\n\r\nclass CustomSerializer(serializers.Serializer):\r\n    ...\r\n    class Meta:\r\n        list_serializer_class = CustomListSerializer\r\n```\r\n\r\n\r\n#### \u81ea\u5b9a\u4e49\u591a\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\r\n\r\n\u521b\u5efa\u591a\u4e2a\u5bf9\u8c61\u7684\u9ed8\u8ba4\u5b9e\u73b0\u662f\u7b80\u5355\u5730\u4e3a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a item \u8c03\u7528 `.create()`\u3002\u5982\u679c\u8981\u81ea\u5b9a\u4e49\u6b64\u884c\u4e3a\uff0c\u5219\u9700\u8981\u5728\u4f20\u9012 `many=True`\u65f6\u81ea\u5b9a\u4e49 `ListSerializer` \u7c7b\u4e0a\u7684 `.create()`\u65b9\u6cd5\u3002\r\n\r\n``` python\r\nclass BookListSerializer(serializers.ListSerializer):\r\n    def create(self, validated_data):\r\n        books = [Book(**item) for item in validated_data]\r\n        return Book.objects.bulk_create(books)\r\n\r\nclass BookSerializer(serializers.Serializer):\r\n    ...\r\n    class Meta:\r\n        list_serializer_class = BookListSerializer\r\n```\r\n\r\n\r\n#### \u81ea\u5b9a\u4e49\u591a\u4e2a\u5bf9\u8c61\u7684\u66f4\u65b0\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c`ListSerializer` \u7c7b\u4e0d\u652f\u6301\u591a\u5bf9\u8c61\u66f4\u65b0\u3002\u8fd9\u662f\u56e0\u4e3a\u63d2\u5165\u548c\u5220\u9664\u9884\u671f\u7684\u884c\u4e3a\u662f\u4e0d\u660e\u786e\u7684\u3002\r\n\r\n\u4e3a\u4e86\u652f\u6301\u591a\u5bf9\u8c61\u66f4\u65b0\uff0c\u4f60\u9700\u8981\u91cd\u5199 update \u65b9\u6cd5\u3002\u5728\u7f16\u5199\u4f60\u7684\u591a\u5bf9\u8c61\u66f4\u65b0\u4ee3\u7801\u65f6\uff0c\u4e00\u5b9a\u8981\u8bb0\u4f4f\u4ee5\u4e0b\u51e0\u70b9\uff1a  \r\n* \u5982\u4f55\u786e\u5b9a\u5e94\u8be5\u4e3a\u6570\u636e\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a item \u66f4\u65b0\u54ea\u4e2a\u5b9e\u4f8b\uff1f\r\n* \u63d2\u5165\u5e94\u8be5\u5982\u4f55\u5904\u7406\uff1f\u5b83\u4eec\u662f\u65e0\u6548\u7684\uff0c\u8fd8\u662f\u521b\u5efa\u65b0\u5bf9\u8c61\uff1f\r\n* \u5e94\u8be5\u5982\u4f55\u5904\u7406\u5220\u9664\uff1f\u5b83\u4eec\u662f\u5426\u6697\u793a\u4e86\u5bf9\u8c61\u5220\u9664\uff0c\u6216\u8005\u5220\u9664\u4e86\u4e00\u6bb5\u5173\u7cfb\uff1f\u5b83\u4eec\u5e94\u8be5\u88ab\u5ffd\u7565\uff0c\u8fd8\u662f\u65e0\u6548\uff1f\r\n* \u5982\u4f55\u5904\u7406\u6392\u5e8f\uff1f\u6539\u53d8\u4e24\u4e2a item \u7684\u4f4d\u7f6e\u662f\u5426\u610f\u5473\u7740\u72b6\u6001\u7684\u6539\u53d8\u6216\u8005\u88ab\u5ffd\u7565\uff1f\r\n\r\n\r\n\r\n\u4f60\u9700\u8981\u4e3a\u5b9e\u4f8b\u5e8f\u5217\u5316\u7c7b\u6dfb\u52a0\u4e00\u4e2a\u663e\u5f0f `id` \u5b57\u6bb5\u3002\u9ed8\u8ba4\u7684\u9690\u5f0f\u751f\u6210\u7684 `id` \u5b57\u6bb5\u88ab\u6807\u8bb0\u4e3a `read_only`\u3002\u8fd9\u4f1a\u5bfc\u81f4\u5b83\u5728\u66f4\u65b0\u65f6\u88ab\u5220\u9664\u3002\u4e00\u65e6\u4f60\u660e\u786e\u58f0\u660e\u5b83\uff0c\u5b83\u5c06\u5728\u5217\u8868\u5e8f\u5217\u5316\u7c7b\u7684\u66f4\u65b0\u65b9\u6cd5\u4e2d\u53ef\u7528\u3002\r\n\r\n\u4e0b\u9762\u662f\u4f60\u5982\u4f55\u9009\u62e9\u5b9e\u73b0\u591a\u5bf9\u8c61\u66f4\u65b0\u7684\u793a\u4f8b\uff1a\r\n\r\n``` python\r\nclass BookListSerializer(serializers.ListSerializer):\r\n    def update(self, instance, validated_data):\r\n        # Maps for id->instance and id->data item.\r\n        book_mapping = {book.id: book for book in instance}\r\n        data_mapping = {item['id']: item for item in validated_data}\r\n\r\n        # Perform creations and updates.\r\n        ret = []\r\n        for book_id, data in data_mapping.items():\r\n            book = book_mapping.get(book_id, None)\r\n            if book is None:\r\n                ret.append(self.child.create(data))\r\n            else:\r\n                ret.append(self.child.update(book, data))\r\n\r\n        # Perform deletions.\r\n        for book_id, book in book_mapping.items():\r\n            if book_id not in data_mapping:\r\n                book.delete()\r\n\r\n        return ret\r\n\r\nclass BookSerializer(serializers.Serializer):\r\n    # We need to identify elements in the list using their primary key,\r\n    # so use a writable field here, rather than the default which would be read-only.\r\n    id = serializers.IntegerField()\r\n    ...\r\n\r\n    class Meta:\r\n        list_serializer_class = BookListSerializer\r\n```\r\n\r\n\r\n#### \u81ea\u5b9a\u4e49 ListSerializer \u521d\u59cb\u5316\r\n\r\n\u5f53\u5177\u6709 `many=True`\u7684\u5e8f\u5217\u5316\u7c7b\u5b9e\u4f8b\u5316\u65f6\uff0c\u6211\u4eec\u9700\u8981\u786e\u5b9a\u54ea\u4e9b\u53c2\u6570\u548c\u5173\u952e\u5b57\u53c2\u6570\u5e94\u8be5\u4f20\u9012\u7ed9\u5b50\u7ea7 `Serializer`\u7c7b\u548c\u7236\u7ea7 `ListSerializer` \u7c7b\u7684 `.__ init __()` \u65b9\u6cd5\u3002\r\n\r\n\r\n\u9ed8\u8ba4\u7684\u5b9e\u73b0\u662f\u5c06\u6240\u6709\u53c2\u6570\u4f20\u9012\u7ed9\u4e24\u4e2a\u7c7b\uff0c\u9664\u4e86 `validators` \u548c\u4efb\u4f55\u81ea\u5b9a\u4e49\u5173\u952e\u5b57\u53c2\u6570\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u90fd\u5047\u5b9a\u7528\u4e8e\u5b50\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n\u6709\u65f6\u4f60\u53ef\u80fd\u9700\u8981\u660e\u786e\u6307\u5b9a\u5728\u4f20\u9012 `many=True` \u65f6\u5982\u4f55\u5b9e\u4f8b\u5316\u5b50\u7c7b\u548c\u7236\u7c7b\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 `many_init` \u7c7b\u65b9\u6cd5\u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002\r\n\r\n\r\n``` python\r\n    @classmethod\r\n    def many_init(cls, *args, **kwargs):\r\n        # Instantiate the child serializer.\r\n        kwargs['child'] = cls()\r\n        # Instantiate the parent list serializer.\r\n        return CustomListSerializer(*args, **kwargs)\r\n```\r\n\r\n\r\n## BaseSerializer\r\n\r\n`BaseSerializer` \u7c7b\u53ef\u4ee5\u7528\u6765\u65b9\u4fbf\u5730\u652f\u6301\u5176\u4ed6\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u98ce\u683c\u3002\r\n\r\n\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u4e0e `Serializer` \u7c7b\u76f8\u540c\u7684\u57fa\u672c API\uff1a  \r\n* `.data` - \u8fd4\u56de\u4f20\u51fa\u7684\u539f\u59cb\u8868\u793a\u3002\r\n* `.is_valid()` - \u53cd\u5e8f\u5217\u5316\u5e76\u9a8c\u8bc1\u4f20\u5165\u7684\u6570\u636e\u3002\r\n* `.validated_data` - \u8fd4\u56de\u9a8c\u8bc1\u7684\u4f20\u5165\u6570\u636e\u3002\r\n* `.errors` - \u5728\u9a8c\u8bc1\u671f\u95f4\u8fd4\u56de\u9519\u8bef\u3002\r\n* `.save()` - \u5c06\u9a8c\u8bc1\u7684\u6570\u636e\u4fdd\u5b58\u5230\u5bf9\u8c61\u5b9e\u4f8b\u4e2d\u3002\r\n\r\n\u6709\u56db\u79cd\u65b9\u6cd5\u53ef\u4ee5\u88ab\u8986\u76d6\uff0c\u8fd9\u53d6\u51b3\u4e8e\u4f60\u5e0c\u671b\u5e8f\u5217\u5316\u7c7b\u652f\u6301\u7684\u529f\u80fd\uff1a  \r\n* `.to_representation()` - \u91cd\u5199\u6b64\u64cd\u4f5c\u4ee5\u652f\u6301\u5e8f\u5217\u5316\uff0c\u7528\u4e8e\u8bfb\u53d6\u64cd\u4f5c\u3002\r\n* `.to_internal_value()` - \u91cd\u5199\u6b64\u64cd\u4f5c\u4ee5\u652f\u6301\u53cd\u5e8f\u5217\u5316\uff0c\u4ee5\u7528\u4e8e\u5199\u5165\u64cd\u4f5c\u3002\r\n* `.create() \u548c .update()` - \u8986\u76d6\u5176\u4e2d\u4e00\u4e2a\u6216\u4e24\u4e2a\u4ee5\u652f\u6301\u4fdd\u5b58\u5b9e\u4f8b\u3002\r\n\r\n\u56e0\u4e3a\u8fd9\u4e2a\u7c7b\u63d0\u4f9b\u4e86\u4e0e `Serializer` \u7c7b\u76f8\u540c\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u50cf\u73b0\u6709\u7684\u5e38\u89c4 `Serializer`\u6216 `ModelSerializer` \u4e00\u6837\uff0c\u5c06\u5b83\u4e0e\u57fa\u4e8e\u7c7b\u7684\u901a\u7528\u89c6\u56fe\u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n\u552f\u4e00\u4e0d\u540c\u7684\u662f\uff0c`BaseSerializer` \u7c7b\u4e0d\u4f1a\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u751f\u6210 HTML \u8868\u5355\u3002\u8fd9\u662f\u56e0\u4e3a\u5b83\u4eec\u8fd4\u56de\u7684\u6570\u636e\u4e0d\u5305\u542b\u6240\u6709\u7684\u5b57\u6bb5\u4fe1\u606f\uff0c\u8fd9\u4e9b\u5b57\u6bb5\u4fe1\u606f\u5141\u8bb8\u5c06\u6bcf\u4e2a\u5b57\u6bb5\u6e32\u67d3\u4e3a\u5408\u9002\u7684 HTML \u8f93\u5165\u3002\r\n\r\n\r\n### Read-only `BaseSerializer` \u7c7b\r\n\r\n\u8981\u4f7f\u7528 `BaseSerializer` \u7c7b\u5b9e\u73b0\u53ea\u8bfb\u5e8f\u5217\u5316\u7c7b\uff0c\u6211\u4eec\u53ea\u9700\u91cd\u5199 `.to_representation()` \u65b9\u6cd5\u3002\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f7f\u7528\u7b80\u5355\u7684 Django \u6a21\u578b\u7684\u793a\u4f8b\uff1a\r\n\r\n``` python\r\nclass HighScore(models.Model):\r\n    created = models.DateTimeField(auto_now_add=True)\r\n    player_name = models.CharField(max_length=10)\r\n    score = models.IntegerField()\r\n```\r\n\r\n\u521b\u5efa\u7528\u4e8e\u5c06 `HighScore` \u5b9e\u4f8b\u8f6c\u6362\u4e3a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u53ea\u8bfb\u5e8f\u5217\u5316\u7c7b\u975e\u5e38\u7b80\u5355\u3002\r\n\r\n``` python\r\nclass HighScoreSerializer(serializers.BaseSerializer):\r\n    def to_representation(self, obj):\r\n        return {\r\n            'score': obj.score,\r\n            'player_name': obj.player_name\r\n        }\r\n```\r\n\r\n\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u6765\u5e8f\u5217\u5316\u5355\u4e2a `HighScore` \u5b9e\u4f8b\uff1a\r\n\r\n``` python\r\n@api_view(['GET'])\r\ndef high_score(request, pk):\r\n    instance = HighScore.objects.get(pk=pk)\r\n    serializer = HighScoreSerializer(instance)\r\n    return Response(serializer.data)\r\n```\r\n\r\n\u6216\u8005\u7528\u5b83\u6765\u5e8f\u5217\u5316\u591a\u4e2a\u5b9e\u4f8b\uff1a\r\n\r\n``` python\r\n@api_view(['GET'])\r\ndef all_high_scores(request):\r\n    queryset = HighScore.objects.order_by('-score')\r\n    serializer = HighScoreSerializer(queryset, many=True)\r\n    return Response(serializer.data)\r\n```\r\n\r\n### Read-write BaseSerializer \u7c7b\r\n\r\n\u8981\u521b\u5efa\u4e00\u4e2a\u53ef\u8bfb\u5199\u7684\u5e8f\u5217\u5316\u7c7b\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a `.to_internal_value()` \u65b9\u6cd5\u3002\u6b64\u65b9\u6cd5\u8fd4\u56de\u5c06\u7528\u4e8e\u6784\u9020\u5bf9\u8c61\u5b9e\u4f8b\u7684\u9a8c\u8bc1\u503c\uff0c\u5e76\u4e14\u5982\u679c\u63d0\u4f9b\u7684\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u5219\u53ef\u80fd\u5f15\u53d1 `ValidationError` \u3002\r\n\r\n\u4e00\u65e6\u5b9e\u73b0 `.to_internal_value()`\uff0c\u57fa\u672c\u9a8c\u8bc1 API \u5c06\u5728\u5e8f\u5217\u5316\u5668\u4e2d\u53ef\u7528\uff0c\u5e76\u4e14\u4f60\u5c06\u80fd\u591f\u4f7f\u7528 `.is_valid()`\uff0c`.validated_data` \u548c `.errors`\u3002\r\n\r\n\u5982\u679c\u4f60\u8fd8\u60f3\u652f\u6301 `.save()`\uff0c\u5219\u8fd8\u9700\u8981\u5b9e\u73b0 `.create()` \u548c `.update()`\u65b9\u6cd5\u4e2d\u7684\u4e00\u4e2a\u6216\u4e24\u4e2a\u3002\r\n\r\n\r\n\u4ee5\u4e0b\u662f\u6211\u4eec\u4e4b\u524d\u7684 `HighScoreSerializer` \u7684\u4e00\u4e2a\u5b8c\u6574\u793a\u4f8b\uff0c\u8be5\u793a\u4f8b\u5df2\u66f4\u65b0\u4e3a\u652f\u6301\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\u3002\r\n\r\n\r\n``` python\r\nclass HighScoreSerializer(serializers.BaseSerializer):\r\n    def to_internal_value(self, data):\r\n        score = data.get('score')\r\n        player_name = data.get('player_name')\r\n\r\n        # Perform the data validation.\r\n        if not score:\r\n            raise ValidationError({\r\n                'score': 'This field is required.'\r\n            })\r\n        if not player_name:\r\n            raise ValidationError({\r\n                'player_name': 'This field is required.'\r\n            })\r\n        if len(player_name) > 10:\r\n            raise ValidationError({\r\n                'player_name': 'May not be more than 10 characters.'\r\n            })\r\n\r\n        # Return the validated values. This will be available as\r\n        # the `.validated_data` property.\r\n        return {\r\n            'score': int(score),\r\n            'player_name': player_name\r\n        }\r\n\r\n    def to_representation(self, obj):\r\n        return {\r\n            'score': obj.score,\r\n            'player_name': obj.player_name\r\n        }\r\n\r\n    def create(self, validated_data):\r\n        return HighScore.objects.create(**validated_data)\r\n```\r\n\r\n### \u521b\u5efa\u65b0\u7684\u57fa\u7c7b\r\n\r\n\u5982\u679c\u4f60\u5e0c\u671b\u5b9e\u73b0\u65b0\u7684\u6cdb\u578b\u5e8f\u5217\u5316\u7c7b\u6765\u5904\u7406\u7279\u5b9a\u7684\u5e8f\u5217\u5316\u98ce\u683c\uff0c\u6216\u8005\u4e0e\u53ef\u9009\u7684\u5b58\u50a8\u540e\u7aef\u8fdb\u884c\u96c6\u6210\uff0c\u90a3\u4e48 `BaseSerializer` \u7c7b\u4e5f\u5f88\u6709\u7528\u3002\r\n\r\n\u4ee5\u4e0b\u7c7b\u662f\u53ef\u4ee5\u5904\u7406\u5c06\u4efb\u610f\u5bf9\u8c61\u5f3a\u5236\u8f6c\u6362\u4e3a\u57fa\u672c\u8868\u793a\u5f62\u5f0f\u7684\u6cdb\u578b\u5e8f\u5217\u5316\u7c7b\u7684\u793a\u4f8b\u3002\r\n\r\n\r\n``` python\r\nclass ObjectSerializer(serializers.BaseSerializer):\r\n    \"\"\"\r\n    A read-only serializer that coerces arbitrary complex objects\r\n    into primitive representations.\r\n    \"\"\"\r\n    def to_representation(self, obj):\r\n        for attribute_name in dir(obj):\r\n            attribute = getattr(obj, attribute_name)\r\n            if attribute_name('_'):\r\n                # Ignore private attributes.\r\n                pass\r\n            elif hasattr(attribute, '__call__'):\r\n                # Ignore methods and other callables.\r\n                pass\r\n            elif isinstance(attribute, (str, int, bool, float, type(None))):\r\n                # Primitive types can be passed through unmodified.\r\n                output[attribute_name] = attribute\r\n            elif isinstance(attribute, list):\r\n                # Recursively deal with items in lists.\r\n                output[attribute_name] = [\r\n                    self.to_representation(item) for item in attribute\r\n                ]\r\n            elif isinstance(attribute, dict):\r\n                # Recursively deal with items in dictionaries.\r\n                output[attribute_name] = {\r\n                    str(key): self.to_representation(value)\r\n                    for key, value in attribute.items()\r\n                }\r\n            else:\r\n                # Force anything else to its string representation.\r\n                output[attribute_name] = str(attribute)\r\n```\r\n\r\n## Serializer \u4f7f\u7528\u8fdb\u9636\r\n\r\n### \u91cd\u5199\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u884c\u4e3a\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u66f4\u6539\u5e8f\u5217\u5316\u7c7b\u7684\u5e8f\u5217\u5316\u6216\u53cd\u5e8f\u5217\u5316\u884c\u4e3a\uff0c\u53ef\u4ee5\u901a\u8fc7\u8986\u76d6 `.to_representation()` \u6216 `.to_internal_value()` \u65b9\u6cd5\u6765\u5b9e\u73b0\u3002\r\n\r\n\u4ee5\u4e0b\u539f\u56e0\u53ef\u80fd\u9700\u8981\u91cd\u5199\u8fd9\u4e24\u4e2a\u65b9\u6cd5...  \r\n\r\n* \u4e3a\u65b0\u7684\u5e8f\u5217\u5316\u57fa\u7c7b\u6dfb\u52a0\u65b0\u884c\u4e3a\u3002\r\n* \u7a0d\u5fae\u4fee\u6539\u73b0\u6709\u7c7b\u7684\u884c\u4e3a\u3002\r\n* \u63d0\u9ad8\u7ecf\u5e38\u8bbf\u95ee\u7684 API \u7aef\u70b9\u7684\u5e8f\u5217\u5316\u6027\u80fd\uff0c\u4ee5\u4fbf\u8fd4\u56de\u5927\u91cf\u6570\u636e\u3002\r\n\r\n\r\n\u8fd9\u4e9b\u65b9\u6cd5\u7684\u7b7e\u540d\u5982\u4e0b\uff1a\r\n\r\n**`.to_representation(self, obj)`**\r\n\r\n\u63a5\u53d7\u9700\u8981\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u539f\u59cb\u8868\u793a\u3002\u901a\u5e38\u8fd9\u610f\u5473\u7740\u8fd4\u56de\u4e00\u4e2a\u5185\u7f6e Python \u6570\u636e\u7c7b\u578b\u7684\u7ed3\u6784\u3002\u53ef\u4ee5\u5904\u7406\u7684\u786e\u5207\u7c7b\u578b\u53d6\u51b3\u4e8e\u60a8\u4e3a API \u914d\u7f6e\u7684\u6e32\u67d3\u7c7b\u3002\r\n\r\n\u53ef\u80fd\u4f1a\u88ab\u91cd\u5199\u4ee5\u4fbf\u4fee\u6539\u8868\u793a\u98ce\u683c\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\ndef to_representation(self, instance):\r\n    \"\"\"Convert `username` to lowercase.\"\"\"\r\n    ret = super().to_representation(instance)\r\n    ret['username'] = ret['username'].lower()\r\n    return ret\r\n```\r\n\r\n**`.to_internal_value(self, data)`**\r\n\r\n\u5c06\u672a\u9a8c\u8bc1\u7684\u4f20\u5165\u6570\u636e\u4f5c\u4e3a\u8f93\u5165\uff0c\u5e76\u5e94\u8fd4\u56de\u5c06\u4f5c\u4e3a `serializer.validated_data` \u63d0\u4f9b\u7684\u9a8c\u8bc1\u6570\u636e\u3002\u5982\u679c\u5728\u5e8f\u5217\u5316\u7c7b\u4e0a\u8c03\u7528\u4e86 `.save()` \uff0c\u5219\u8fd4\u56de\u503c\u4e5f\u5c06\u4f20\u9012\u7ed9 `.create()` \u6216 `.update()` \u65b9\u6cd5\u3002\r\n\r\n\r\n\u5982\u679c\u9a8c\u8bc1\u5931\u8d25\uff0c\u5219\u8be5\u65b9\u6cd5\u4f1a\u5f15\u53d1 `serializers.ValidationError(errors)`\u3002`errors` \u53c2\u6570\u5e94\u8be5\u662f\u4e00\u4e2a\u7531\u5b57\u6bb5\u540d\u79f0\uff08\u6216 `settings.NON_FIELD_ERRORS_KEY`\uff09\u6620\u5c04\u5230\u9519\u8bef\u6d88\u606f\u5217\u8868\u7684\u5b57\u5178\u3002\u5982\u679c\u4e0d\u9700\u8981\u6539\u53d8\u53cd\u5e8f\u5217\u5316\u884c\u4e3a\uff0c\u800c\u662f\u60f3\u63d0\u4f9b\u5bf9\u8c61\u7ea7\u9a8c\u8bc1\uff0c\u5219\u5efa\u8bae\u6539\u4e3a\u8986\u76d6 `.validate()`\u65b9\u6cd5\u3002\r\n\r\n\r\n\u4f20\u9012\u7ed9\u6b64\u65b9\u6cd5\u7684 `data` \u53c2\u6570\u901a\u5e38\u662f `request.data` \u7684\u503c\uff0c\u56e0\u6b64\u5b83\u63d0\u4f9b\u7684\u6570\u636e\u7c7b\u578b\u5c06\u53d6\u51b3\u4e8e\u4f60\u4e3a API \u914d\u7f6e\u7684\u89e3\u6790\u5668\u7c7b\u3002\r\n\r\n\r\n\r\n### \u7ee7\u627f\u5e8f\u5217\u5316\u7c7b\r\n\r\n\u4e0e Django \u8868\u5355\u7c7b\u4f3c\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f\u6765\u6269\u5c55\u548c\u91cd\u7528\u5e8f\u5217\u5316\u7c7b\u3002\u8fd9\u4f7f\u4f60\u53ef\u4ee5\u5728\u7236\u7c7b\u4e0a\u58f0\u660e\u4e00\u7ec4\u901a\u7528\u7684\u5b57\u6bb5\u6216\u65b9\u6cd5\uff0c\u7136\u540e\u53ef\u4ee5\u5728\u591a\u4e2a\u5e8f\u5217\u5316\u7c7b\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002\u4f8b\u5982\uff0c\r\n\r\n``` python\r\nclass MyBaseSerializer(Serializer):\r\n    my_field = serializers.CharField()\r\n\r\n    def validate_my_field(self):\r\n        ...\r\n\r\nclass MySerializer(MyBaseSerializer):\r\n    ...\r\n```\r\n\r\n\u4e0e Django \u7684 `Model` \u548c `ModelForm` \u7c7b\u4e00\u6837\uff0c\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u5185\u90e8 `Meta` \u7c7b\u4e0d\u4f1a\u4ece\u5176\u7236\u7c7b\u7684\u5185\u90e8 `Meta` \u7c7b\u4e2d\u9690\u5f0f\u7ee7\u627f\u3002\u5982\u679c\u4f60\u60f3\u8ba9 `Meta` \u7c7b\u7ee7\u627f\u7236\u7c7b\uff0c\u5fc5\u987b\u660e\u786e\u7684\u6307\u51fa\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass AccountSerializer(MyBaseSerializer):\r\n    class Meta(MyBaseSerializer.Meta):\r\n        model = Account\r\n```\r\n\r\n\u901a\u5e38\u6211\u4eec\u5efa\u8bae\u4e0d\u8981\u5728\u5185\u90e8\u7684 `Meta` \u7c7b\u4e2d\u4f7f\u7528\u7ee7\u627f\uff0c\u800c\u662f\u663e\u5f0f\u58f0\u660e\u6240\u6709\u9009\u9879\u3002\r\n\r\n### \u52a8\u6001\u4fee\u6539\u5b57\u6bb5\r\n\r\n\u4e00\u65e6\u5e8f\u5217\u5316\u7c7b\u521d\u59cb\u5316\u5b8c\u6bd5\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 `.fields` \u5c5e\u6027\u8bbf\u95ee\u5728\u5e8f\u5217\u5316\u7c7b\u4e2d\u8bbe\u7f6e\u7684\u5b57\u6bb5\u5b57\u5178\u3002\u901a\u8fc7\u8bbf\u95ee\u548c\u4fee\u6539\u8fd9\u4e2a\u5c5e\u6027\u53ef\u4ee5\u8fbe\u5230\u52a8\u6001\u5730\u4fee\u6539\u5e8f\u5217\u5316\u7c7b\u7684\u76ee\u7684\u3002\r\n\r\n\u76f4\u63a5\u4fee\u6539 `fields` \u53c2\u6570\u5141\u8bb8\u4f60\u505a\u4e00\u4e9b\u6709\u8da3\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u5728\u8fd0\u884c\u65f6\u6539\u53d8\u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u53c2\u6570\uff0c\u800c\u4e0d\u662f\u5728\u58f0\u660e\u5e8f\u5217\u5316\u7c7b\u7684\u65f6\u5019\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u80fd\u591f\u8bbe\u7f6e\u5e8f\u5217\u5316\u7c7b\u5728\u521d\u59cb\u5316\u65f6\u5e94\u4f7f\u7528\u54ea\u4e9b\u5b57\u6bb5\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u8fd9\u6837\u4e00\u4e2a\u5e8f\u5217\u5316\u7c7b\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nclass DynamicFieldsModelSerializer(serializers.ModelSerializer):\r\n    \"\"\"\r\n    A ModelSerializer that takes an additional `fields` argument that\r\n    controls which fields should be displayed.\r\n    \"\"\"\r\n\r\n    def __init__(self, *args, **kwargs):\r\n        # Don't pass the 'fields' arg up to the superclass\r\n        fields = kwargs.pop('fields', None)\r\n\r\n        # Instantiate the superclass normally\r\n        super(DynamicFieldsModelSerializer, self).__init__(*args, **kwargs)\r\n\r\n        if fields is not None:\r\n            # Drop any fields that are not specified in the `fields` argument.\r\n            allowed = set(fields)\r\n            existing = set(self.fields)\r\n            for field_name in existing - allowed:\r\n                self.fields.pop(field_name)\r\n```\r\n\r\n\u8fd9\u5c06\u5141\u8bb8\u4f60\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\r\n\r\n``` python\r\n>>> class UserSerializer(DynamicFieldsModelSerializer):\r\n>>>     class Meta:\r\n>>>         model = User\r\n>>>         fields = ('id', 'username', 'email')\r\n>>>\r\n>>> print UserSerializer(user)\r\n{'id': 2, 'username': 'jonwatts', 'email': 'jon@example.com'}\r\n>>>\r\n>>> print UserSerializer(user, fields=('id', 'email'))\r\n{'id': 2, 'email': 'jon@example.com'}\r\n```", "md_File": "subject/django-rest-framework-api-guide/serializers.md", "create_date": "2020-02-20T13:10:40.780", "order": 9}}, {"model": "subject.chapter", "pk": 162, "fields": {"title": "settings", "topic": 7, "md5": "0a12694fd7d6832cad09639644e17906", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/settings/)  \r\n\r\n\r\n# Settings\r\n\r\n> Namespaces are one honking great idea - let's do more of those!\r\n>\r\n> &mdash; [The Zen of Python][cite]\r\n\r\nREST framework \u7684\u914d\u7f6e\u662f\u5728\u540d\u4e3a `REST_FRAMEWORK` \u7684\u5355\u4e2a Django \u8bbe\u7f6e\u4e2d\u7684\u6240\u6709\u547d\u540d\u7a7a\u95f4\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4f60\u7684\u9879\u76ee\u7684 `settings.py` \u6587\u4ef6\u53ef\u80fd\u5305\u542b\u5982\u4e0b\u6240\u793a\u7684\u5185\u5bb9\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_RENDERER_CLASSES': (\r\n        'rest_framework.renderers.JSONRenderer',\r\n    ),\r\n    'DEFAULT_PARSER_CLASSES': (\r\n        'rest_framework.parsers.JSONParser',\r\n    )\r\n}\r\n```\r\n\r\n## \u8bbf\u95ee settings\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u8bbf\u95ee\u9879\u76ee\u4e2d REST framework \u7684 API \u8bbe\u7f6e\u503c\uff0c\u5219\u5e94\u4f7f\u7528 `api_settings` \u5bf9\u8c61\u3002\u4f8b\u5982\u3002\r\n\r\n``` python\r\nfrom rest_framework.settings import api_settings\r\n\r\nprint api_settings.DEFAULT_AUTHENTICATION_CLASSES\r\n```\r\n\r\n`api_settings` \u5bf9\u8c61\u5c06\u68c0\u67e5\u7528\u6237\u5b9a\u4e49\u7684\u8bbe\u7f6e\uff0c\u5426\u5219\u5c06\u56de\u9000\u5230\u9ed8\u8ba4\u503c\u3002\u4efb\u4f55\u4f7f\u7528\u5b57\u7b26\u4e32\u5bfc\u5165\u8def\u5f84\u5f15\u7528\u7c7b\u7684\u8bbe\u7f6e\u90fd\u4f1a\u81ea\u52a8\u5bfc\u5165\u5e76\u8fd4\u56de\u88ab\u5f15\u7528\u7684\u7c7b\uff0c\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\u6587\u5b57\u3002\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## API \u7b56\u7565\u8bbe\u7f6e\r\n\r\n*\u4ee5\u4e0b\u8bbe\u7f6e\u63a7\u5236\u57fa\u672c API \u7b56\u7565\uff0c\u5e76\u5e94\u7528\u4e8e\u6bcf\u4e2a\u57fa\u4e8e `APIView` \u7c7b\u7684\u89c6\u56fe\u6216\u57fa\u4e8e `@api_view` \u51fd\u6570\u7684\u89c6\u56fe\u3002*\r\n\r\n#### DEFAULT_RENDERER_CLASSES\r\n\r\n\u6e32\u67d3\u5668\u7c7b\u7684\u5217\u8868\u6216\u5143\u7ec4\uff0c\u7528\u4e8e\u786e\u5b9a\u8fd4\u56de `Response` \u5bf9\u8c61\u65f6\u53ef\u80fd\u4f7f\u7528\u7684\u9ed8\u8ba4\u6e32\u67d3\u5668\u96c6\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a\r\n\r\n``` python\r\n(\r\n    'rest_framework.renderers.JSONRenderer',\r\n    'rest_framework.renderers.BrowsableAPIRenderer',\r\n)\r\n```\r\n\r\n#### DEFAULT_PARSER_CLASSES\r\n\r\n\u89e3\u6790\u5668\u7c7b\u7684\u5217\u8868\u6216\u5143\u7ec4\uff0c\u7528\u4e8e\u786e\u5b9a\u8bbf\u95ee `request.data` \u5c5e\u6027\u65f6\u4f7f\u7528\u7684\u9ed8\u8ba4\u89e3\u6790\u5668\u96c6\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a\r\n\r\n``` python\r\n(\r\n    'rest_framework.parsers.JSONParser',\r\n    'rest_framework.parsers.FormParser',\r\n    'rest_framework.parsers.MultiPartParser'\r\n)\r\n```\r\n\r\n#### DEFAULT_AUTHENTICATION_CLASSES\r\n\r\n\u8eab\u4efd\u9a8c\u8bc1\u7c7b\u7684\u5217\u8868\u6216\u5143\u7ec4\uff0c\u7528\u4e8e\u786e\u5b9a\u5728\u8bbf\u95ee `request.user` \u6216 `request.auth` \u5c5e\u6027\u65f6\u4f7f\u7528\u7684\u9ed8\u8ba4\u8eab\u4efd\u9a8c\u8bc1\u96c6\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a\r\n\r\n``` python\r\n(\r\n    'rest_framework.authentication.SessionAuthentication',\r\n    'rest_framework.authentication.BasicAuthentication'\r\n)\r\n```\r\n\r\n#### DEFAULT_PERMISSION_CLASSES\r\n\r\n\u6743\u9650\u7c7b\u7684\u5217\u8868\u6216\u5143\u7ec4\uff0c\u7528\u4e8e\u786e\u5b9a\u5728\u89c6\u56fe\u5f00\u59cb\u65f6\u68c0\u67e5\u7684\u9ed8\u8ba4\u6743\u9650\u96c6\u3002\u6743\u9650\u5fc5\u987b\u7531\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u7c7b\u6388\u4e88\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a\r\n\r\n``` python\r\n(\r\n    'rest_framework.permissions.AllowAny',\r\n)\r\n```\r\n\r\n#### DEFAULT_THROTTLE_CLASSES\r\n\r\n\u9650\u6d41\u7c7b\u7684\u5217\u8868\u6216\u5143\u7ec4\uff0c\u7528\u4e8e\u786e\u5b9a\u5728\u89c6\u56fe\u5f00\u59cb\u65f6\u68c0\u67e5\u7684\u9ed8\u8ba4\u9650\u6d41\u7c7b\u96c6\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `()`\r\n\r\n#### DEFAULT_CONTENT_NEGOTIATION_CLASS\r\n\r\n\u5185\u5bb9\u534f\u5546\u7c7b\uff0c\u7528\u4e8e\u786e\u5b9a\u5982\u4f55\u4e3a\u54cd\u5e94\u9009\u62e9\u6e32\u67d3\u5668\uff0c\u5e76\u7ed9\u5b9a\u4f20\u5165\u8bf7\u6c42\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'rest_framework.negotiation.DefaultContentNegotiation'`\r\n\r\n#### DEFAULT_SCHEMA_CLASS\r\n\r\n\u5c06\u7528\u4e8e schema \u751f\u6210\u7684\u89c6\u56fe\u68c0\u67e5\u7c7b\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'rest_framework.schemas.AutoSchema'`\r\n\r\n---\r\n\r\n## Generic view settings\r\n\r\n*\u4ee5\u4e0b\u8bbe\u7f6e\u63a7\u5236\u901a\u7528\u57fa\u4e8e\u7c7b\u7684\u89c6\u56fe\u7684\u884c\u4e3a\u3002*\r\n\r\n\r\n#### DEFAULT_FILTER_BACKENDS\r\n\r\n\u7528\u4e8e\u901a\u7528\u8fc7\u6ee4\u7684\u8fc7\u6ee4\u5668\u540e\u7aef\u7c7b\u5217\u8868\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `None`\uff0c\u5219\u7981\u7528\u901a\u7528\u8fc7\u6ee4\u3002\r\n\r\n#### PAGE_SIZE\r\n\r\n\u7528\u4e8e\u5206\u9875\u7684\u9ed8\u8ba4\u9875\u9762\u5927\u5c0f\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `None`\uff0c\u5219\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7981\u7528\u5206\u9875\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`None`\r\n\r\n### SEARCH_PARAM\r\n\r\n\u67e5\u8be2\u53c2\u6570\u7684\u540d\u79f0\uff0c\u53ef\u7528\u4e8e\u6307\u5b9a `SearchFilter` \u4f7f\u7528\u7684\u641c\u7d22\u8bcd\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`search`\r\n\r\n#### ORDERING_PARAM\r\n\r\n\u6392\u5e8f\u53c2\u6570\u7684\u540d\u79f0\uff0c\u53ef\u7528\u4e8e\u6307\u5b9a `OrderingFilter` \u8fd4\u56de\u7ed3\u679c\u7684\u6392\u5e8f\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`ordering`\r\n\r\n---\r\n\r\n## \u7248\u672c\u63a7\u5236\u8bbe\u7f6e\r\n\r\n#### DEFAULT_VERSION\r\n\r\n\u5f53\u6ca1\u6709\u7248\u672c\u4fe1\u606f\u5b58\u5728\u65f6\uff0c\u9ed8\u8ba4\u7684 `request.version` \u503c\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`None`\r\n\r\n#### ALLOWED_VERSIONS\r\n\r\n\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u6b64\u503c\u5c06\u9650\u5236\u7248\u672c\u63a7\u5236\u65b9\u6848\u53ef\u80fd\u8fd4\u56de\u7684\u7248\u672c\u96c6\u5408\uff0c\u5982\u679c\u63d0\u4f9b\u7684\u7248\u672c\u4e0d\u5728\u6b64\u96c6\u5408\u4e2d\uff0c\u5219\u4f1a\u5f15\u53d1\u9519\u8bef\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`None`\r\n\r\n#### VERSION_PARAM\r\n\r\n\u7528\u4e8e\u7248\u672c\u63a7\u5236\u53c2\u6570\u7684\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\u5a92\u4f53\u7c7b\u578b\u6216 URL \u67e5\u8be2\u53c2\u6570\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'version'`\r\n\r\n---\r\n\r\n## \u8ba4\u8bc1\u8bbe\u7f6e\r\n\r\n*\u4ee5\u4e0b\u8bbe\u7f6e\u63a7\u5236\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u7684\u884c\u4e3a\u3002*\r\n\r\n#### UNAUTHENTICATED_USER\r\n\r\n\u7528\u4e8e\u521d\u59cb\u5316\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u7684 `request.user`\u7684\u7c7b\u3002\uff08\u5982\u679c\u8981\u5b8c\u5168\u5220\u9664\u9a8c\u8bc1\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ece `INSTALLED_APPS` \u4e2d\u9664\u53bb `django.contrib.auth`\uff0c\u5c06 `UNAUTHENTICATED_USER` \u8bbe\u7f6e\u4e3a `None`\u3002\uff09\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `django.contrib.auth.models.AnonymousUser`\r\n\r\n#### UNAUTHENTICATED_TOKEN\r\n\r\n\u7528\u4e8e\u521d\u59cb\u5316\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u7684 `request.auth` \u7684\u7c7b\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`None`\r\n\r\n---\r\n\r\n## \u6d4b\u8bd5\u8bbe\u7f6e\r\n\r\n*\u4ee5\u4e0b\u8bbe\u7f6e\u63a7\u5236 APIRequestFactory \u548c APIClient \u7684\u884c\u4e3a*\r\n\r\n#### TEST_REQUEST_DEFAULT_FORMAT\r\n\r\n\u8fdb\u884c\u6d4b\u8bd5\u8bf7\u6c42\u65f6\u5e94\u4f7f\u7528\u7684\u9ed8\u8ba4\u683c\u5f0f\u3002\r\n\r\n\u8fd9\u5e94\u8be5\u4e0e `TEST_REQUEST_RENDERER_CLASSES` \u8bbe\u7f6e\u4e2d\u7684\u5176\u4e2d\u4e00\u4e2a\u6e32\u67d3\u5668\u7c7b\u7684\u683c\u5f0f\u76f8\u5339\u914d\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `'multipart'`\r\n\r\n#### TEST_REQUEST_RENDERER_CLASSES\r\n\r\n\u6784\u5efa\u6d4b\u8bd5\u8bf7\u6c42\u65f6\u652f\u6301\u7684\u6e32\u67d3\u5668\u7c7b\u3002\r\n\r\n\u6784\u5efa\u6d4b\u8bd5\u8bf7\u6c42\u65f6\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u8fd9\u4e9b\u6e32\u67d3\u5668\u7c7b\u7684\u683c\u5f0f\uff0c\u4f8b\u5982\uff1a`client.post('/users', {'username': 'jamie'}, format='json')`\r\n\r\n\u9ed8\u8ba4\u503c\uff1a\r\n\r\n``` python\r\n(\r\n    'rest_framework.renderers.MultiPartRenderer',\r\n    'rest_framework.renderers.JSONRenderer'\r\n)\r\n```\r\n\r\n---\r\n\r\n## Schema \u751f\u6210\u63a7\u5236\r\n\r\n#### SCHEMA_COERCE_PATH_PK\r\n\r\n\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u5728\u751f\u6210 schema \u8def\u5f84\u53c2\u6570\u65f6\uff0c\u4f1a\u5c06 URL conf \u4e2d\u7684 `'pk'` \u6807\u8bc6\u7b26\u6620\u5c04\u5230\u5b9e\u9645\u5b57\u6bb5\u540d\u79f0\u4e0a\u3002\u901a\u5e38\u8fd9\u5c06\u662f `'id'` \u3002\u7531\u4e8e \u201cprimary key\u201d \u662f\u5b9e\u73b0\u7ec6\u8282\uff0c\u56e0\u6b64\u8fd9\u63d0\u4f9b\u4e86\u66f4\u9002\u5408\u7684\u8868\u793a\uff0c\u800c \u201cidentifier\u201d \u662f\u66f4\u4e00\u822c\u7684\u6982\u5ff5\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`True`\r\n\r\n#### SCHEMA_COERCE_METHOD_NAMES\r\n\r\n\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u7528\u4e8e\u5c06\u5185\u90e8\u89c6\u56fe\u65b9\u6cd5\u540d\u79f0\u6620\u5c04\u5230 schema \u751f\u6210\u4e2d\u4f7f\u7528\u7684\u5916\u90e8\u64cd\u4f5c\u540d\u79f0\u3002\u8fd9\u4f7f\u6211\u4eec\u80fd\u591f\u751f\u6210\u6bd4\u4ee3\u7801\u5e93\u4e2d\u5185\u90e8\u4f7f\u7528\u7684\u540d\u79f0\u66f4\u9002\u5408\u5916\u90e8\u8868\u793a\u7684\u540d\u79f0\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `{'retrieve': 'read', 'destroy': 'delete'}`\r\n\r\n---\r\n\r\n## \u5185\u5bb9\u7c7b\u578b\u63a7\u5236\r\n\r\n#### URL_FORMAT_OVERRIDE\r\n\r\n\u901a\u8fc7\u5728\u8bf7\u6c42 URL \u4e2d\u4f7f\u7528 `format=\u2026` \u67e5\u8be2\u53c2\u6570\uff0c\u53ef\u7528\u4e8e\u8986\u76d6\u9ed8\u8ba4\u5185\u5bb9\u534f\u5546 `Accept` header \u884c\u4e3a\u7684 URL \u53c2\u6570\u7684\u540d\u79f0\u3002\r\n\r\n\u4f8b\u5982\uff1a `http://example.com/organizations/?format=csv`\r\n\r\n\u5982\u679c\u6b64\u8bbe\u7f6e\u7684\u503c\u4e3a `None`\uff0c\u5219 URL \u683c\u5f0f\u8986\u76d6\u5c06\u88ab\u7981\u7528\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `'format'`\r\n\r\n#### FORMAT_SUFFIX_KWARG\r\n\r\nURL conf \u4e2d\u7528\u4e8e\u63d0\u4f9b\u683c\u5f0f\u540e\u7f00\u7684\u53c2\u6570\u540d\u79f0\u3002\u4f7f\u7528 `format_suffix_patterns` \u5305\u542b\u540e\u7f00 URL patterns \u65f6\u5e94\u7528\u6b64\u8bbe\u7f6e\u3002\r\n\r\n\u4f8b\u5982\uff1a`http://example.com/organizations.csv/`\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'format'`\r\n\r\n---\r\n\r\n## \u65e5\u671f\u548c\u65f6\u95f4\u683c\u5f0f\r\n\r\n*\u4ee5\u4e0b\u8bbe\u7f6e\u7528\u4e8e\u63a7\u5236\u5982\u4f55\u5206\u6790\u548c\u6e32\u67d3\u65e5\u671f\u548c\u65f6\u95f4\u8868\u793a\u3002*\r\n\r\n#### DATETIME_FORMAT\r\n\r\n\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7528\u4e8e\u6e32\u67d3 `DateTimeField` \u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u8f93\u51fa\u3002\u5982\u679c\u4e3a `None`\uff0c\u90a3\u4e48 `DateTimeField` \u5e8f\u5217\u5316\u5b57\u6bb5\u5c06\u8fd4\u56de Python `datetime` \u5bf9\u8c61\uff0c\u5e76\u4e14\u65e5\u671f\u65f6\u95f4\u7f16\u7801\u5c06\u7531\u6e32\u67d3\u5668\u51b3\u5b9a\u3002\r\n\r\n\u53ef\u4ee5\u662f `None`\uff0c`'iso-8601'` \u6216 Python strftime \u683c\u5f0f\u5b57\u7b26\u4e32\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'iso-8601'`\r\n\r\n#### DATETIME_INPUT_FORMATS\r\n\r\n\u9ed8\u8ba4\u4f7f\u7528\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u7528\u4e8e\u89e3\u6790 `DateTimeField` \u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u8f93\u5165\u3002\r\n\r\n\u53ef\u4ee5\u662f\u5305\u542b\u5b57\u7b26\u4e32 `'iso-8601'` \u6216 Python strftime \u683c\u5f0f\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `['iso-8601']`\r\n\r\n#### DATE_FORMAT\r\n\r\n\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7528\u4e8e\u6e32\u67d3 `DateField` \u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u8f93\u51fa\u3002\u5982\u679c\u4e3a `None`\uff0c\u90a3\u4e48 `DateField` \u5e8f\u5217\u5316\u5b57\u6bb5\u5c06\u8fd4\u56de Python `date` \u5bf9\u8c61\uff0c\u5e76\u4e14\u65e5\u671f\u7f16\u7801\u5c06\u7531\u6e32\u67d3\u5668\u51b3\u5b9a\u3002\r\n\r\n\u53ef\u4ee5\u662f `None`\uff0c`'iso-8601'` \u6216 Python strftime \u683c\u5f0f\u5b57\u7b26\u4e32\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'iso-8601'`\r\n\r\n#### DATE_INPUT_FORMATS\r\n\r\n\u9ed8\u8ba4\u4f7f\u7528\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u7528\u4e8e\u89e3\u6790 `DateField` \u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u8f93\u5165\u3002\r\n\r\n\u53ef\u4ee5\u662f\u5305\u542b\u5b57\u7b26\u4e32 `'iso-8601'` \u6216 Python strftime \u683c\u5f0f\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`['iso-8601']`\r\n\r\n#### TIME_FORMAT\r\n\r\n\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7528\u4e8e\u6e32\u67d3 `imeField` \u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u8f93\u51fa\u3002\u5982\u679c\u4e3a `None`\uff0c\u90a3\u4e48 `TimeField` \u5e8f\u5217\u5316\u5b57\u6bb5\u5c06\u8fd4\u56de Python `time` \u5bf9\u8c61\uff0c\u5e76\u4e14\u65f6\u95f4\u7f16\u7801\u5c06\u7531\u6e32\u67d3\u5668\u51b3\u5b9a\u3002\r\n\r\n\u53ef\u4ee5\u662f `None`\uff0c`'iso-8601'` \u6216 Python strftime \u683c\u5f0f\u5b57\u7b26\u4e32\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `'iso-8601'`\r\n\r\n#### TIME_INPUT_FORMATS\r\n\r\n\u9ed8\u8ba4\u4f7f\u7528\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u7528\u4e8e\u89e3\u6790 `TimeField` \u5e8f\u5217\u5316\u5b57\u6bb5\u7684\u8f93\u5165\u3002\r\n\r\n\u53ef\u4ee5\u662f\u5305\u542b\u5b57\u7b26\u4e32 `'iso-8601'` \u6216 Python strftime \u683c\u5f0f\u5b57\u7b26\u4e32\u7684\u5217\u8868\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`['iso-8601']`\r\n\r\n---\r\n\r\n## \u7f16\u7801\r\n\r\n#### UNICODE_JSON\r\n\r\n\u8bbe\u7f6e\u4e3a `True` \u65f6\uff0cJSON \u54cd\u5e94\u5c06\u5141\u8bb8 unicode \u5b57\u7b26\u4f5c\u4e3a\u54cd\u5e94\u3002\u4f8b\u5982\uff1a\r\n\r\n```\r\n{\"unicode black star\":\"\u2605\"}\r\n```\r\n\r\n\u5f53\u8bbe\u7f6e\u4e3a `False` \u65f6\uff0cJSON \u54cd\u5e94\u5c06\u8f6c\u4e49\u975eascii\u5b57\u7b26\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n```\r\n{\"unicode black star\":\"\\u2605\"}\r\n```\r\n\r\n\u4e24\u79cd\u6837\u5f0f\u90fd\u7b26\u5408 RFC 4627\uff0c\u5e76\u4e14\u5728\u8bed\u6cd5\u4e0a\u90fd\u662f\u6709\u6548 JSON\u3002\u5728\u68c0\u67e5 API \u54cd\u5e94\u65f6\uff0cunicode \u6837\u5f0f\u66f4\u53d7\u7528\u6237\u6b22\u8fce\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `True`\r\n\r\n#### COMPACT_JSON\r\n\r\n\u5f53\u8bbe\u7f6e\u4e3a `True` \u65f6\uff0cJSON \u54cd\u5e94\u5c06\u8fd4\u56de\u7d27\u51d1\u8868\u793a\uff0c`':'` \u548c `','` \u5b57\u7b26\u4e4b\u540e\u6ca1\u6709\u95f4\u9694\u3002\u4f8b\u5982\uff1a\r\n\r\n```\r\n{\"is_admin\":false,\"email\":\"jane@example\"} \r\n```\r\n\r\n\u5f53\u8bbe\u7f6e\u4e3a `False` \u65f6\uff0cJSON \u54cd\u5e94\u5c06\u8fd4\u56de\u7a0d\u5fae\u66f4\u5197\u957f\u7684\u8868\u793a\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n```\r\n{\"is_admin\": false, \"email\": \"jane@example\"}\r\n```\r\n\r\n\u9ed8\u8ba4\u6837\u5f0f\u662f\u8fd4\u56de\u7f29\u5c0f\u7684\u54cd\u5e94\uff0c\u7b26\u5408 Heroku \u7684 API \u8bbe\u8ba1\u51c6\u5219\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `True`\r\n\r\n#### STRICT_JSON\r\n\r\n\u5f53\u8bbe\u7f6e\u4e3a `True` \u65f6\uff0cJSON \u6e32\u67d3\u548c\u89e3\u6790\u53ea\u4f1a\u9075\u5faa\u8bed\u6cd5\u4e0a\u6709\u6548\u7684 JSON\uff0c\u800c Python \u7684 `json` \u6a21\u5757\u63a5\u53d7\u7684\u6269\u5c55\u6d6e\u70b9\u503c\uff08`nan`\uff0c`inf`\uff0c`-inf`\uff09\u4f1a\u5f15\u53d1\u5f02\u5e38\u3002\u8fd9\u662f\u63a8\u8350\u7684\u8bbe\u7f6e\uff0c\u56e0\u4e3a\u901a\u5e38\u4e0d\u652f\u6301\u8fd9\u4e9b\u503c\u3002\u4f8b\u5982\uff0cJavascript \u7684 `JSON.Parse` \u548c PostgreSQL \u7684 JSON \u6570\u636e\u7c7b\u578b\u90fd\u4e0d\u63a5\u53d7\u8fd9\u4e9b\u503c\u3002\r\n\r\n\u5f53\u8bbe\u7f6e\u4e3a `False` \u65f6\uff0cJSON \u7684\u6e32\u67d3\u548c\u89e3\u6790\u5c06\u662f\u5bbd\u677e\u7684\u3002\u4f46\u662f\uff0c\u8fd9\u4e9b\u503c\u4ecd\u7136\u65e0\u6548\uff0c\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u4e13\u95e8\u5904\u7406\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`True`\r\n\r\n#### COERCE_DECIMAL_TO_STRING\r\n\r\n\u5728\u4e0d\u652f\u6301\u539f\u751f\u5341\u8fdb\u5236\u7c7b\u578b\u7684 API \u8868\u793a\u5f62\u5f0f\u4e2d\u8fd4\u56de\u5c0f\u6570\u5bf9\u8c61\u65f6\uff0c\u901a\u5e38\u6700\u597d\u5c06\u8be5\u503c\u4f5c\u4e3a\u5b57\u7b26\u4e32\u8fd4\u56de\u3002\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e8c\u8fdb\u5236\u6d6e\u70b9\u5b9e\u73b0\u6240\u5e26\u6765\u7684\u7cbe\u5ea6\u635f\u5931\u3002\r\n\r\n\u8bbe\u7f6e\u4e3a `True` \u65f6\uff0c\u5e8f\u5217\u5316 `DecimalField` \u7c7b\u5c06\u8fd4\u56de\u5b57\u7b26\u4e32\u800c\u4e0d\u662f `Decimal` \u5bf9\u8c61\u3002\u8bbe\u7f6e\u4e3a `False` \u65f6\uff0c\u5e8f\u5217\u5316\u5c06\u8fd4\u56de `Decimal` \u5bf9\u8c61\uff0c\u9ed8\u8ba4 JSON \u7f16\u7801\u5668\u5c06\u4f5c\u4e3a\u6d6e\u70b9\u6570\u8fd4\u56de\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `True`\r\n\r\n---\r\n\r\n## View names and descriptions\r\n\r\n*\u4ee5\u4e0b\u8bbe\u7f6e\u7528\u4e8e\u751f\u6210\u89c6\u56fe\u540d\u79f0\u548c\u63cf\u8ff0\uff0c\u5982 `OPTIONS` \u8bf7\u6c42\u7684\u54cd\u5e94\u4e2d\u6240\u4f7f\u7528\u7684\uff0c\u4ee5\u53ca\u53ef\u6d4f\u89c8 API \u4e2d\u4f7f\u7528\u7684\u8bbe\u7f6e\u3002*\r\n\r\n#### VIEW_NAME_FUNCTION\r\n\r\n\u8868\u793a\u751f\u6210\u89c6\u56fe\u540d\u79f0\u65f6\u5e94\u4f7f\u7528\u7684\u51fd\u6570\u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n\u8fd9\u5e94\u8be5\u662f\u4e00\u4e2a\u5177\u6709\u4ee5\u4e0b\u7b7e\u540d\u7684\u51fd\u6570\uff1a\r\n\r\n```  python\r\nview_name(cls, suffix=None)\r\n```\r\n\r\n* `cls`: \u89c6\u56fe\u7c7b\u3002\u901a\u5e38\uff0c\u540d\u79f0\u51fd\u6570\u4f1a\u5728\u751f\u6210\u63cf\u8ff0\u6027\u540d\u79f0\u65f6\u901a\u8fc7\u8bbf\u95ee `cls .__ name__` \u6765\u68c0\u67e5\u7c7b\u7684\u540d\u79f0\u3002\r\n* `suffix`: \u533a\u5206\u89c6\u56fe\u4e2d\u5404\u4e2a\u89c6\u56fe\u65f6\u4f7f\u7528\u7684\u53ef\u9009\u540e\u7f00\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'rest_framework.views.get_view_name'`\r\n\r\n#### VIEW_DESCRIPTION_FUNCTION\r\n\r\n\u8868\u793a\u751f\u6210\u89c6\u56fe\u63cf\u8ff0\u65f6\u5e94\u4f7f\u7528\u7684\u51fd\u6570\u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n\u6b64\u8bbe\u7f6e\u53ef\u4ee5\u66f4\u6539\u4e3a\u652f\u6301\u9664\u9ed8\u8ba4 markdown \u4ee5\u5916\u7684\u6807\u8bb0\u6837\u5f0f\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b83\u652f\u6301\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u8f93\u51fa\u7684\u89c6\u56fe\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u7684 `rst` \u6807\u8bb0\u3002\r\n\r\n\u8fd9\u5e94\u8be5\u662f\u4e00\u4e2a\u5177\u6709\u4ee5\u4e0b\u7b7e\u540d\u7684\u51fd\u6570\uff1a\r\n\r\n``` python\r\nview_description(cls, html=False)\r\n```\r\n\r\n* `cls`: \u89c6\u56fe\u7c7b\u3002\u901a\u5e38\uff0cdescription \u51fd\u6570\u4f1a\u5728\u751f\u6210\u63cf\u8ff0\u65f6\u68c0\u67e5\u7c7b\u7684\u6587\u6863\u5b57\u7b26\u4e32\uff0c\u65b9\u6cd5\u662f\u8bbf\u95ee `cls .__ doc__`\r\n* `html`: \u6307\u793a\u662f\u5426\u9700\u8981 HTML \u8f93\u51fa\u7684\u5e03\u5c14\u503c\u3002\u5728\u53ef\u6d4f\u89c8\u7684 API \u4e2d\u4f7f\u7528\u65f6\u4e3a `true`\uff0c\u5728\u751f\u6210 `OPTIONS` \u54cd\u5e94\u65f6\u4f7f\u7528 `False`\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `'rest_framework.views.get_view_description'`\r\n\r\n## HTML Select \u5b57\u6bb5\u622a\u53d6\r\n\r\n\u7528\u4e8e\u5728\u53ef\u6d4f\u89c8 API \u4e2d\u6e32\u67d3\u5173\u7cfb\u5b57\u6bb5\u7684 select \u5b57\u6bb5\u622a\u53d6\u7684\u5168\u5c40\u8bbe\u7f6e\u3002\r\n\r\n#### HTML_SELECT_CUTOFF\r\n\r\n`html_cutoff` \u503c\u7684\u5168\u5c40\u8bbe\u7f6e\u3002\u5fc5\u987b\u662f\u6574\u6570\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a 1000\r\n\r\n#### HTML_SELECT_CUTOFF_TEXT\r\n\r\n\u4ee3\u8868 `html_cutoff_text` \u5168\u5c40\u8bbe\u7f6e\u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `\"More than {count} items...\"`\r\n\r\n---\r\n\r\n## \u6742\u9879\u8bbe\u7f6e\r\n\r\n#### EXCEPTION_HANDLER\r\n\r\n\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u5728\u8fd4\u56de\u4efb\u4f55\u7ed9\u5b9a\u5f02\u5e38\u7684\u54cd\u5e94\u65f6\u5e94\u4f7f\u7528\u7684\u51fd\u6570\u3002\u5982\u679c\u8be5\u51fd\u6570\u8fd4\u56de `None`\uff0c\u5219\u4f1a\u5f15\u53d1 500 \u9519\u8bef\u3002\r\n\r\n\u6b64\u8bbe\u7f6e\u53ef\u4ee5\u66f4\u6539\u4e3a\u652f\u6301\u9ed8\u8ba4 `{\"detail\": \"Failure...\"}` \u54cd\u5e94\u4ee5\u5916\u7684\u9519\u8bef\u54cd\u5e94\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u63d0\u4f9b API \u54cd\u5e94\uff0c\u5982 `{\"errors\": [{\"message\": \"Failure...\", \"code\": \"\"} ...]}`.\r\n\r\n\u8fd9\u5e94\u8be5\u662f\u4e00\u4e2a\u5177\u6709\u4ee5\u4e0b\u7b7e\u540d\u7684\u51fd\u6570\uff1a\r\n\r\n``` python\r\nexception_handler(exc, context)\r\n```\r\n\r\n* `exc`: \u5f02\u5e38\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `'rest_framework.views.exception_handler'`\r\n\r\n#### NON_FIELD_ERRORS_KEY\r\n\r\n\u8868\u793a\u5e94\u8be5\u7528\u4e8e\u5e8f\u5217\u5316\u9519\u8bef\u7684\u5173\u952e\u5b57\u7684\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u4e0d\u5f15\u7528\u7279\u5b9a\u5b57\u6bb5\uff0c\u800c\u4ee3\u8868\u4e00\u822c\u9519\u8bef\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`'non_field_errors'`\r\n\r\n#### URL_FIELD_NAME\r\n\r\n\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u7528\u4e8e\u7531 `HyperlinkedModelSerializer` \u751f\u6210\u7684 URL \u5b57\u6bb5\u7684\u952e\r\n\r\n\u9ed8\u8ba4\u503c\uff1a `'url'`\r\n\r\n#### NUM_PROXIES\r\n\r\n\u4e00\u4e2a 0 \u6216\u66f4\u5927\u7684\u6574\u6570\uff0c\u53ef\u7528\u4e8e\u6307\u5b9a API \u5728\u540e\u53f0\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7406\u7684\u6570\u91cf\u3002\u8fd9\u5141\u8bb8\u9650\u6d41\u5668\u66f4\u51c6\u786e\u5730\u8bc6\u522b\u5ba2\u6237\u7aef IP \u5730\u5740\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a `None`\uff0c\u90a3\u4e48\u9650\u6d41\u5668\u5c06\u4f7f\u7528\u5bbd\u677e\u7684 IP \u5339\u914d\u65b9\u5f0f\u3002\r\n\r\n\u9ed8\u8ba4\u503c\uff1a`None`\r\n\r\n", "md_File": "subject/django-rest-framework-api-guide/settings.md", "create_date": "2020-02-20T13:10:40.799", "order": 27}}, {"model": "subject.chapter", "pk": 163, "fields": {"title": "schemas", "topic": 7, "md5": "0d73cabb5f8d36ffe336b7d17a3daffb", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/schemas/)  \r\n\r\n\r\n# Schemas\r\n\r\nAPI schema \u662f\u4e00\u4e2a\u975e\u5e38\u6709\u7528\u7684\u5de5\u5177\uff0c\u5b83\u5141\u8bb8\u4e00\u7cfb\u5217\u7528\u4f8b\uff0c\u5305\u62ec\u751f\u6210\u53c2\u8003\u6587\u6863\uff0c\u6216\u8005\u9a71\u52a8\u53ef\u4ee5\u4e0e API \u4ea4\u4e92\u7684\u52a8\u6001\u5ba2\u6237\u7aef\u5e93\u3002\r\n\r\n## \u5b89\u88c5 Core API\r\n\r\n\u4f60\u9700\u8981\u5b89\u88c5 `coreapi` \u8f6f\u4ef6\u5305\u624d\u80fd\u4e3a REST framework \u6dfb\u52a0 schema \u652f\u6301\u3002\r\n\r\n``` bash\r\npip install coreapi\r\n```\r\n\r\n## \u5185\u90e8 schema \u8868\u793a\r\n\r\nREST framework \u4f7f\u7528 Core API \u4ee5\u4fbf\u4ee5\u72ec\u7acb\u4e8e\u683c\u5f0f\u7684\u8868\u793a\u5bf9 schema \u4fe1\u606f\u5efa\u6a21\u3002\u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u88ab\u6e32\u67d3\u6210\u5404\u79cd\u4e0d\u540c\u7684 schema \u683c\u5f0f\uff0c\u6216\u8005\u7528\u4e8e\u751f\u6210 API \u6587\u6863\u3002\r\n\r\n\u5728\u4f7f\u7528 Core API \u65f6\uff0cschema \u8868\u793a\u4e3a `Document`\uff0c\u5b83\u662f\u6709\u5173 API \u4fe1\u606f\u7684\u9876\u7ea7\u5bb9\u5668\u5bf9\u8c61\u3002\u53ef\u7528\u7684 API \u4ea4\u4e92\u4f7f\u7528 `Link` \u5bf9\u8c61\u8868\u793a\u3002\u6bcf\u4e2a\u94fe\u63a5\u90fd\u5305\u542b\u4e00\u4e2a URL\uff0cHTTP \u65b9\u6cd5\uff0c\u5e76\u4e14\u53ef\u80fd\u5305\u542b\u4e00\u4e2a `Field` \u5b9e\u4f8b\u5217\u8868\uff0c\u5b83\u63cf\u8ff0\u4e86 API \u7aef\u70b9\u53ef\u4ee5\u63a5\u53d7\u7684\u4efb\u4f55\u53c2\u6570\u3002`Link` \u548c `Field` \u5b9e\u4f8b\u8fd8\u53ef\u80fd\u5305\u542b\u63cf\u8ff0\uff0c\u5141\u8bb8\u5c06 API schema \u6e32\u67d3\u5230\u7528\u6237\u6587\u6863\u4e2d\u3002\r\n\r\n\u4ee5\u4e0b\u662f\u5305\u542b\u5355\u4e2a\u641c\u7d22\u7aef\u70b9\u7684 API \u8bf4\u660e\u793a\u4f8b\uff1a\r\n\r\n``` python\r\ncoreapi.Document(\r\n    title='Flight Search API',\r\n    url='https://api.example.org/',\r\n    content={\r\n        'search': coreapi.Link(\r\n            url='/search/',\r\n            action='get',\r\n            fields=[\r\n                coreapi.Field(\r\n                    name='from',\r\n                    required=True,\r\n                    location='query',\r\n                    description='City name or airport code.'\r\n                ),\r\n                coreapi.Field(\r\n                    name='to',\r\n                    required=True,\r\n                    location='query',\r\n                    description='City name or airport code.'\r\n                ),\r\n                coreapi.Field(\r\n                    name='date',\r\n                    required=True,\r\n                    location='query',\r\n                    description='Flight date in \"YYYY-MM-DD\" format.'\r\n                )\r\n            ],\r\n            description='Return flight availability and prices.'\r\n        )\r\n    }\r\n)\r\n```\r\n\r\n## Schema \u8f93\u51fa\u683c\u5f0f\r\n\r\n\u4e3a\u4e86\u5448\u73b0\u5728 HTTP \u54cd\u5e94\u4e2d\uff0c\u5fc5\u987b\u5c06\u5185\u90e8\u8868\u793a\u6e32\u67d3\u4e3a\u54cd\u5e94\u4e2d\u4f7f\u7528\u7684\u5b9e\u9645\u5b57\u8282\u3002\r\n\r\nCore JSON \u88ab\u8bbe\u8ba1\u4e3a\u4e0e Core API \u4e00\u8d77\u4f7f\u7528\u7684\u89c4\u8303\u683c\u5f0f\u3002REST framework \u5305\u542b\u7528\u4e8e\u5904\u7406\u6b64\u5a92\u4f53\u7c7b\u578b\u7684\u6e32\u67d3\u5668\u7c7b\uff0c\u8be5\u6e32\u67d3\u5668\u7c7b\u53ef\u7528\u4f5c `renderers.CoreJSONRenderer`\u3002\r\n\r\n### \u5907\u7528 schema \u683c\u5f0f\r\n\r\n\u5176\u4ed6 schema \u683c\u5f0f\uff08\u5982 Open API\uff08\u201cSwagger\u201d\uff09\uff0cJSON HyperSchema \u6216 API Blueprint\uff09\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0\u5904\u7406\u5c06 `Document` \u5b9e\u4f8b\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u8868\u793a\u5f62\u5f0f\u7684\u81ea\u5b9a\u4e49\u6e32\u67d3\u5668\u7c7b\u6765\u652f\u6301\u3002\r\n\r\n\u5982\u679c\u6709\u4e00\u4e2a Core API \u7f16\u89e3\u7801\u5668\u5305\u652f\u6301\u5c06\u7f16\u7801\u683c\u5f0f\u5316\u4e3a\u4f60\u8981\u4f7f\u7528\u7684\u683c\u5f0f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u7f16\u89e3\u7801\u5668\u6765\u5b9e\u73b0\u6e32\u67d3\u5668\u7c7b\u3002\r\n\r\n#### \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4f8b\u5982\uff0c`openapi_codec` \u5305\u63d0\u4f9b\u5bf9 Open API\uff08\u201cSwagger\u201d\uff09\u683c\u5f0f\u7684\u7f16\u7801\u6216\u89e3\u7801\u652f\u6301\uff1a\r\n\r\n``` python\r\nfrom rest_framework import renderers\r\nfrom openapi_codec import OpenAPICodec\r\n\r\nclass SwaggerRenderer(renderers.BaseRenderer):\r\n    media_type = 'application/openapi+json'\r\n    format = 'swagger'\r\n\r\n    def render(self, data, media_type=None, renderer_context=None):\r\n        codec = OpenAPICodec()\r\n        return codec.dump(data)\r\n```\r\n\r\n\r\n\r\n\r\n## Schemas vs \u8d85\u5a92\u4f53\r\n\r\n\u503c\u5f97\u6307\u51fa\u7684\u662f\uff0cCore API \u4e5f\u53ef\u4ee5\u7528\u6765\u6a21\u62df\u8d85\u5a92\u4f53\u54cd\u5e94\uff0c\u5b83\u4e3a API schema \u63d0\u4f9b\u4e86\u53e6\u4e00\u79cd\u4ea4\u4e92\u98ce\u683c\u3002\r\n\r\n\u901a\u8fc7 API schema\uff0c\u6574\u4e2a\u53ef\u7528\u63a5\u53e3\u4f5c\u4e3a\u5355\u4e2a\u7aef\u70b9\u5448\u73b0\u5728\u524d\u7aef\u3002\u7136\u540e\uff0c\u5bf9\u5404\u4e2a API \u7aef\u70b9\u7684\u54cd\u5e94\u901a\u5e38\u4f1a\u4ee5\u666e\u901a\u6570\u636e\u7684\u5f62\u5f0f\u5448\u73b0\uff0c\u800c\u4e0d\u4f1a\u5728\u6bcf\u4e2a\u54cd\u5e94\u4e2d\u5305\u542b\u4efb\u4f55\u8fdb\u4e00\u6b65\u7684\u4ea4\u4e92\u3002\r\n\r\n\u4f7f\u7528\u8d85\u5a92\u4f53\uff0c\u5ba2\u6237\u7aef\u4f1a\u770b\u5230\u5305\u542b\u6570\u636e\u548c\u53ef\u7528\u4ea4\u4e92\u7684\u6587\u6863\u3002\u6bcf\u6b21\u4ea4\u4e92\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u6587\u6863\uff0c\u8be6\u7ec6\u8bf4\u660e\u5f53\u524d\u72b6\u6001\u548c\u53ef\u7528\u4ea4\u4e92\u3002\r\n\r\n\r\n---\r\n\r\n# \u521b\u5efa\u4e00\u4e2a schema\r\n\r\nREST framework \u5305\u542b\u7528\u4e8e\u81ea\u52a8\u751f\u6210 schema \u7684\u529f\u80fd\uff0c\u6216\u8005\u5141\u8bb8\u4f60\u660e\u786e\u6307\u5b9a\u3002\r\n\r\n## \u624b\u52a8 Schema \u89c4\u8303\r\n\r\n\u8981\u624b\u52a8\u6307\u5b9a schema\uff0c\u8bf7\u521b\u5efa\u4e00\u4e2a Core API `Document`\uff0c\u4e0e\u4e0a\u4f8b\u7c7b\u4f3c\u3002\r\n\r\n``` python\r\nschema = coreapi.Document(\r\n    title='Flight Search API',\r\n    content={\r\n        ...\r\n    }\r\n)\r\n```\r\n\r\n\r\n## \u81ea\u52a8 Schema \u751f\u6210\r\n\r\n\u81ea\u52a8 schema \u751f\u6210\u7531 `SchemaGenerator` \u7c7b\u63d0\u4f9b\u3002\r\n\r\n`SchemaGenerator` \u5904\u7406\u8def\u7531 URL pattterns \u5217\u8868\u5e76\u7f16\u8bd1\u9002\u5f53\u7ed3\u6784\u5316\u7684 Core API \u6587\u6863\u3002\r\n\r\n\u57fa\u672c\u7528\u6cd5\u53ea\u662f\u4e3a schema \u63d0\u4f9b\u6807\u9898\u5e76\u8c03\u7528 `get_schema()`\uff1a\r\n\r\n``` python\r\ngenerator = schemas.SchemaGenerator(title='Flight Search API')\r\nschema = generator.get_schema()\r\n```\r\n\r\n## \u6309\u89c6\u56fe schema \u81ea\u5b9a\u4e49\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u67e5\u770b\u81ea\u7701\u662f\u7531\u53ef\u901a\u8fc7 `APIView` \u4e0a\u7684 `schema` \u5c5e\u6027\u8bbf\u95ee\u7684 `AutoSchema` \u5b9e\u4f8b\u6267\u884c\u7684\u3002\u8fd9\u4e3a\u89c6\u56fe\uff0c\u8bf7\u6c42\u65b9\u6cd5\u548c\u8def\u5f84\u63d0\u4f9b\u4e86\u9002\u5f53\u7684 Core API `Link` \u5bf9\u8c61\uff1a\r\n\r\n``` python\r\nauto_schema = view.schema\r\ncoreapi_link = auto_schema.get_link(...)\r\n```\r\n\r\n\uff08\u5728\u7f16\u8bd1\u6a21\u5f0f\u65f6\uff0c`SchemaGenerator` \u4e3a\u6bcf\u4e2a\u89c6\u56fe\uff0c\u5141\u8bb8\u7684\u65b9\u6cd5\u548c\u8def\u5f84\u8c03\u7528 `view.schema.get_link()`\u3002\uff09\r\n\r\n---\r\n\r\n**\u6ce8\u610f**: \u5bf9\u4e8e\u57fa\u672c\u7684 `APIView` \u5b50\u7c7b\uff0c\u9ed8\u8ba4\u5185\u7701\u672c\u8d28\u4e0a\u4ec5\u9650\u4e8e URL kwarg \u8def\u5f84\u53c2\u6570\u3002\u5bf9\u4e8e\u5305\u542b\u6240\u6709\u57fa\u4e8e\u7c7b\u7684\u89c6\u56fe\u7684 `GenericAPIView` \u5b50\u7c7b\uff0c`AutoSchema` \u5c06\u5c1d\u8bd5\u81ea\u7701\u5217\u5316\u5668\uff0c\u5206\u9875\u548c\u8fc7\u6ee4\u5668\u5b57\u6bb5\uff0c\u5e76\u63d0\u4f9b\u66f4\u4e30\u5bcc\u7684\u8def\u5f84\u5b57\u6bb5\u63cf\u8ff0\u3002\uff08\u8fd9\u91cc\u7684\u5173\u952e\u94a9\u5b50\u662f\u76f8\u5173\u7684 `GenericAPIView` \u5c5e\u6027\u548c\u65b9\u6cd5\uff1a`get_serializer`\uff0c`pagination_class`\uff0c`filter_backends` \u7b49\u3002\uff09\r\n\r\n---\r\n\r\n\u8981\u81ea\u5b9a\u4e49 `Link` \u751f\u6210\uff0c\u4f60\u53ef\u4ee5\uff1a\r\n\r\n1\uff09\u4f7f\u7528 `manual_fields` kwarg \u5728\u4f60\u7684\u89c6\u56fe\u4e0a\u5b9e\u4f8b\u5316 `AutoSchema`\uff1a\r\n\r\n``` python\r\nfrom rest_framework.views import APIView\r\nfrom rest_framework.schemas import AutoSchema\r\n\r\nclass CustomView(APIView):\r\n    ...\r\n    schema = AutoSchema(\r\n        manual_fields=[\r\n            coreapi.Field(\"extra_field\", ...),\r\n        ]\r\n    )\r\n```\r\n\r\n\u8fd9\u5141\u8bb8\u6269\u5c55\u6700\u5e38\u89c1\u7684\u60c5\u51b5\u800c\u4e0d\u9700\u8981\u5b50\u7c7b\u5316\u3002\r\n\r\n2\uff09\u63d0\u4f9b\u5177\u6709\u66f4\u590d\u6742\u5b9a\u5236\u7684 `AutoSchema` \u5b50\u7c7b\uff1a\r\n\r\n``` python\r\nfrom rest_framework.views import APIView\r\nfrom rest_framework.schemas import AutoSchema\r\n\r\nclass CustomSchema(AutoSchema):\r\n    def get_link(...):\r\n        # Implement custom introspection here (or in other sub-methods)\r\n\r\nclass CustomView(APIView):\r\n    ...\r\n    schema = CustomSchema()\r\n```\r\n\r\n\u8fd9\u63d0\u4f9b\u4e86\u5bf9\u67e5\u770b\u5185\u7701\u7684\u5b8c\u5168\u63a7\u5236\u3002\r\n\r\n3\uff09\u5728\u4f60\u7684\u89c6\u56fe\u4e0a\u5b9e\u4f8b\u5316 `ManualSchema`\uff0c\u663e\u5f0f\u4e3a\u89c6\u56fe\u63d0\u4f9b Core API `Fields`\uff1a\r\n\r\n``` python\r\nfrom rest_framework.views import APIView\r\nfrom rest_framework.schemas import ManualSchema\r\n\r\nclass CustomView(APIView):\r\n    ...\r\n    schema = ManualSchema(fields=[\r\n        coreapi.Field(\r\n            \"first_field\",\r\n            required=True,\r\n            location=\"path\",\r\n            schema=coreschema.String()\r\n        ),\r\n        coreapi.Field(\r\n            \"second_field\",\r\n            required=True,\r\n            location=\"path\",\r\n            schema=coreschema.String()\r\n        ),\r\n    ])\r\n```\r\n\r\n\u8fd9\u5141\u8bb8\u624b\u52a8\u6307\u5b9a\u67d0\u4e9b\u89c6\u56fe\u7684 schema\uff0c\u540c\u65f6\u5728\u522b\u5904\u4fdd\u6301\u81ea\u52a8\u751f\u6210\u3002\r\n\r\n\u901a\u8fc7\u5c06 `schema` \u8bbe\u7f6e\u4e3a `None`\uff0c\u4f60\u53ef\u4ee5\u7981\u7528\u89c6\u56fe\u7684 schema \u751f\u6210\uff1a\r\n\r\n``` python\r\n    class CustomView(APIView):\r\n        ...\r\n        schema = None  # Will not appear in schema\r\n```\r\n\r\n\r\n\r\n# \u6dfb\u52a0 schema \u89c6\u56fe\r\n\r\n\u6709\u51e0\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u53ef\u4ee5\u5c06 schema \u89c6\u56fe\u6dfb\u52a0\u5230\u4f60\u7684 API \u4e2d\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u4f60\u9700\u8981\u7684\u5185\u5bb9\u3002\r\n\r\n## get_schema_view \u5feb\u6377\u65b9\u5f0f\r\n\r\n\u5728\u4f60\u7684\u9879\u76ee\u4e2d\u5305\u542b schema \u7684\u6700\u7b80\u5355\u65b9\u6cd5\u662f\u4f7f\u7528 `get_schema_view()` \u51fd\u6570\u3002\r\n\r\n``` python\r\nfrom rest_framework.schemas import get_schema_view\r\n\r\nschema_view = get_schema_view(title=\"Server Monitoring API\")\r\n\r\nurlpatterns = [\r\n    url('^$', schema_view),\r\n    ...\r\n]\r\n```\r\n\r\n\u6dfb\u52a0\u89c6\u56fe\u540e\uff0c\u4f60\u5c06\u80fd\u591f\u901a\u8fc7 API \u8bf7\u6c42\u6765\u68c0\u7d22\u81ea\u52a8\u751f\u6210\u7684 schema \u5b9a\u4e49\u3002\r\n\r\n``` python\r\n$ http http://127.0.0.1:8000/ Accept:application/coreapi+json\r\nHTTP/1.0 200 OK\r\nAllow: GET, HEAD, OPTIONS\r\nContent-Type: application/vnd.coreapi+json\r\n\r\n{\r\n    \"_meta\": {\r\n        \"title\": \"Server Monitoring API\"\r\n    },\r\n    \"_type\": \"document\",\r\n    ...\r\n}\r\n```\r\n\r\n`get_schema_view()` \u7684\u53c2\u6570\u662f\uff1a\r\n\r\n#### `title`\r\n\r\n\u53ef\u7528\u4e8e\u4e3a schema \u5b9a\u4e49\u63d0\u4f9b\u63cf\u8ff0\u6027\u6807\u9898\u3002\r\n\r\n#### `url`\r\n\r\n\u53ef\u7528\u4e8e\u4e3a schema  \u4f20\u9012\u89c4\u8303 URL\u3002\r\n\r\n``` python\r\nschema_view = get_schema_view(\r\n    title='Server Monitoring API',\r\n    url='https://www.example.org/api/'\r\n)\r\n```\r\n\r\n#### `urlconf`\r\n\r\n\u8868\u793a\u8981\u4e3a\u5176\u751f\u6210 API schema \u7684 URL conf \u7684\u5bfc\u5165\u8def\u5f84\u7684\u5b57\u7b26\u4e32\u3002\u8fd9\u9ed8\u8ba4\u4e3a Django \u7684 ROOT_URLCONF setting \u7684\u503c\u3002\r\n\r\n``` python\r\nschema_view = get_schema_view(\r\n    title='Server Monitoring API',\r\n    url='https://www.example.org/api/',\r\n    urlconf='myproject.urls'\r\n)\r\n```\r\n\r\n#### `renderer_classes`\r\n\r\n\u53ef\u7528\u4e8e\u4f20\u9012\u6e32\u67d3 API \u6839\u7aef\u70b9\u7684\u6e32\u67d3\u5668\u7c7b\u5217\u8868\u3002\r\n\r\n``` python\r\nfrom rest_framework.schemas import get_schema_view\r\nfrom rest_framework.renderers import CoreJSONRenderer\r\nfrom my_custom_package import APIBlueprintRenderer\r\n\r\nschema_view = get_schema_view(\r\n    title='Server Monitoring API',\r\n    url='https://www.example.org/api/',\r\n    renderer_classes=[CoreJSONRenderer, APIBlueprintRenderer]\r\n)\r\n```\r\n\r\n#### `patterns`\r\n\r\n\u5c06 schema \u5185\u7701\u9650\u5b9a\u4e3a url patterns \u5217\u8868\u3002\u5982\u679c\u4f60\u53ea\u60f3\u5c06 `myproject.api` url \u516c\u5f00\u5728 schema \u4e2d\uff1a\r\n\r\n``` python\r\nschema_url_patterns = [\r\n    url(r'^api/', include('myproject.api.urls')),\r\n]\r\n\r\nschema_view = get_schema_view(\r\n    title='Server Monitoring API',\r\n    url='https://www.example.org/api/',\r\n    patterns=schema_url_patterns,\r\n)\r\n```\r\n\r\n#### `generator_class`\r\n\r\n\u53ef\u7528\u4e8e\u6307\u5b9a\u8981\u4f20\u9012\u7ed9 `SchemaView` \u7684 `SchemaGenerator` \u5b50\u7c7b\u3002\r\n\r\n#### `authentication_classes`\r\n\r\n\u53ef\u7528\u4e8e\u6307\u5b9a\u5c06\u5e94\u7528\u4e8e schema \u7aef\u70b9\u7684\u8ba4\u8bc1\u7c7b\u5217\u8868\u3002\u9ed8\u8ba4\u4e3a `settings.DEFAULT_AUTHENTICATION_CLASSES`\r\n\r\n#### `permission_classes`\r\n\r\n\u53ef\u7528\u4e8e\u6307\u5b9a\u5c06\u5e94\u7528\u4e8e schema \u7aef\u70b9\u7684\u6743\u9650\u7c7b\u5217\u8868\u3002\u9ed8\u8ba4\u4e3a `settings.DEFAULT_PERMISSION_CLASSES`\r\n\r\n\r\n## \u4f7f\u7528\u663e\u5f0f schema \u89c6\u56fe\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u6bd4 `get_schema_view()` \u5feb\u6377\u65b9\u5f0f\u66f4\u591a\u7684\u63a7\u5236\u6743\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 `SchemaGenerator` \u7c7b\u6765\u81ea\u52a8\u751f\u6210 `Document` \u5b9e\u4f8b\uff0c\u5e76\u4ece\u89c6\u56fe\u4e2d\u8fd4\u56de\u8be5\u5b9e\u4f8b\u3002\r\n\r\n\u6b64\u9009\u9879\u4f7f\u4f60\u53ef\u4ee5\u7075\u6d3b\u5730\u8bbe\u7f6e schema \u7aef\u70b9\uff0c\u5e76\u4f7f\u7528\u4f60\u60f3\u8981\u7684\u4efb\u4f55\u884c\u4e3a\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u5c06\u4e0d\u540c\u7684\u6743\u9650\uff0c\u9650\u6d41\u6216\u8eab\u4efd\u9a8c\u8bc1\u7b56\u7565\u5e94\u7528\u4e8e schema \u7aef\u70b9\u3002\r\n\r\n\u4ee5\u4e0b\u662f\u4f7f\u7528 `SchemaGenerator` \u548c\u89c6\u56fe\u4e00\u8d77\u8fd4\u56de schema \u7684\u793a\u4f8b\u3002\r\n\r\n**views.py:**\r\n\r\n``` python\r\nfrom rest_framework.decorators import api_view, renderer_classes\r\nfrom rest_framework import renderers, response, schemas\r\n\r\ngenerator = schemas.SchemaGenerator(title='Bookings API')\r\n\r\n@api_view()\r\n@renderer_classes([renderers.CoreJSONRenderer])\r\ndef schema_view(request):\r\n    schema = generator.get_schema(request)\r\n    return response.Response(schema)\r\n```\r\n\r\n**urls.py:**\r\n\r\n``` python\r\nurlpatterns = [\r\n    url('/', schema_view),\r\n    ...\r\n]\r\n```\r\n\r\n\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684\u7528\u6237\u63d0\u4f9b\u4e0d\u540c\u7684 schema\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u4ed6\u4eec\u62e5\u6709\u7684\u6743\u9650\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u7528\u6765\u786e\u4fdd\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u4ee5\u4e0d\u540c\u7684\u6a21\u5f0f\u5448\u73b0\u7ed9\u5df2\u9a8c\u8bc1\u7684\u8bf7\u6c42\uff0c\u6216\u8005\u786e\u4fdd API \u7684\u4e0d\u540c\u90e8\u5206\u6839\u636e\u89d2\u8272\u5bf9\u4e0d\u540c\u7528\u6237\u53ef\u89c1\u3002\r\n\r\n\u4e3a\u4e86\u5448\u73b0\u4e00\u4e2a schema\uff0c\u5176\u4e2d\u5305\u542b\u7531\u7528\u6237\u6743\u9650\u8fc7\u6ee4\u7684\u7aef\u70b9\uff0c\u4f60\u9700\u8981\u5c06 `request` \u53c2\u6570\u4f20\u9012\u7ed9 `get_schema()` \u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\n@api_view()\r\n@renderer_classes([renderers.CoreJSONRenderer])\r\ndef schema_view(request):\r\n    generator = schemas.SchemaGenerator(title='Bookings API')\r\n    return response.Response(generator.get_schema(request=request))\r\n```\r\n\r\n## \u663e\u5f0f schema \u5b9a\u4e49\r\n\r\n\u81ea\u52a8\u751f\u6210\u65b9\u6cd5\u7684\u66ff\u4ee3\u65b9\u6cd5\u662f\u901a\u8fc7\u5728\u4ee3\u7801\u5e93\u4e2d\u58f0\u660e `Document` \u5bf9\u8c61\u6765\u660e\u786e\u6307\u5b9a API schema \u3002\u8fd9\u6837\u505a\u4f1a\u591a\u4e00\u70b9\u5de5\u4f5c\uff0c\u4f46\u786e\u4fdd\u4f60\u5b8c\u5168\u63a7\u5236 schema \u8868\u793a\u3002\r\n\r\n``` python\r\nimport coreapi\r\nfrom rest_framework.decorators import api_view, renderer_classes\r\nfrom rest_framework import renderers, response\r\n\r\nschema = coreapi.Document(\r\n    title='Bookings API',\r\n    content={\r\n        ...\r\n    }\r\n)\r\n\r\n@api_view()\r\n@renderer_classes([renderers.CoreJSONRenderer])\r\ndef schema_view(request):\r\n    return response.Response(schema)\r\n```\r\n\r\n## \u9759\u6001 schema \u6587\u4ef6\r\n\r\n\u6700\u540e\u7684\u9009\u62e9\u662f\u4f7f\u7528 Core JSON \u6216 Open API \u7b49\u53ef\u7528\u683c\u5f0f\u4e4b\u4e00\u5c06\u4f60\u7684 API schema \u7f16\u5199\u4e3a\u9759\u6001\u6587\u4ef6\u3002\r\n\r\n\u7136\u540e\u4f60\u53ef\u4ee5\uff1a\r\n\r\n* \u5c06\u6a21\u5f0f\u5b9a\u4e49\u5199\u4e3a\u9759\u6001\u6587\u4ef6\uff0c\u5e76\u76f4\u63a5\u63d0\u4f9b\u9759\u6001\u6587\u4ef6\u3002\r\n* \u7f16\u5199\u4e00\u4e2a\u4f7f\u7528 `Core API` \u52a0\u8f7d\u7684 schema \u5b9a\u4e49\uff0c\u7136\u540e\u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u5c06\u5176\u6e32\u67d3\u4e3a\u591a\u79cd\u53ef\u7528\u683c\u5f0f\u4e4b\u4e00\u3002\r\n\r\n---\r\n\r\n# \u4f5c\u4e3a\u6587\u6863\u7684 Schemas\r\n\r\nAPI schemas \u7684\u4e00\u4e2a\u5e38\u89c1\u7528\u6cd5\u662f\u4f7f\u7528\u5b83\u4eec\u6765\u6784\u5efa\u6587\u6863\u9875\u9762\u3002\r\n\r\nREST framework \u4e2d\u7684 schema \u751f\u6210\u4f7f\u7528\u6587\u6863\u5b57\u7b26\u4e32\u6765\u81ea\u52a8\u586b\u5145 schema \u6587\u6863\u4e2d\u7684\u63cf\u8ff0\u3002\r\n\r\n\u8fd9\u4e9b\u63cf\u8ff0\u5c06\u57fa\u4e8e\uff1a\r\n\r\n* \u5bf9\u5e94\u65b9\u6cd5\u7684\u6587\u6863\u5b57\u7b26\u4e32\uff08\u5982\u679c\u5b58\u5728\uff09\u3002\r\n* \u7c7b\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u7684\u547d\u540d\u90e8\u5206\uff0c\u53ef\u4ee5\u662f\u5355\u884c\u6216\u591a\u884c\u3002\r\n* \u7c7b\u6587\u6863\u5b57\u7b26\u4e32\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4e00\u4e2a `APIView`\uff0c\u5e26\u6709\u660e\u786e\u7684\u65b9\u6cd5\u6587\u6863\u5b57\u7b26\u4e32\u3002\r\n\r\n``` python\r\nclass ListUsernames(APIView):\r\n    def get(self, request):\r\n        \"\"\"\r\n        Return a list of all user names in the system.\r\n        \"\"\"\r\n        usernames = [user.username for user in User.objects.all()]\r\n        return Response(usernames)\r\n```\r\n\r\n\u4e00\u4e2a `ViewSet`\uff0c\u5e26\u6709\u4e00\u4e2a\u660e\u786e\u7684 action \u6587\u6863\u5b57\u7b26\u4e32\u3002\r\n\r\n``` python\r\nclass ListUsernames(ViewSet):\r\n    def list(self, request):\r\n        \"\"\"\r\n        Return a list of all user names in the system.\r\n        \"\"\"\r\n        usernames = [user.username for user in User.objects.all()]\r\n        return Response(usernames)\r\n```\r\n\r\n\u7c7b\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u5e26\u6709 action \u7684\u901a\u7528\u89c6\u56fe\uff0c\u4f7f\u7528\u5355\u884c\u6837\u5f0f\u3002\r\n\r\n``` python\r\nclass UserList(generics.ListCreateAPIView):\r\n    \"\"\"\r\n    get: List all the users.\r\n    post: Create a new user.\r\n    \"\"\"\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n    permission_classes = (IsAdminUser,)\r\n```\r\n\r\n\u4f7f\u7528\u591a\u884c\u6837\u5f0f\u7684\u7c7b\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u5e26\u6709 action \u7684\u901a\u7528\u89c6\u56fe\u96c6\u3002\r\n\r\n``` python\r\nclass UserViewSet(viewsets.ModelViewSet):\r\n    \"\"\"\r\n    API endpoint that allows users to be viewed or edited.\r\n\r\n    retrieve:\r\n    Return a user instance.\r\n\r\n    list:\r\n    Return all users, ordered by most recently joined.\r\n    \"\"\"\r\n    queryset = User.objects.all().order_by('-date_joined')\r\n    serializer_class = UserSerializer\r\n```\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## SchemaGenerator\r\n\r\n\u4e00\u4e2a\u904d\u5386\u8def\u7531 URL patterns \u5217\u8868\u7684\u7c7b\uff0c\u4e3a\u6bcf\u4e2a\u89c6\u56fe\u8bf7\u6c42 schema \u5e76\u6574\u7406\u751f\u6210\u7684 CoreAPI \u6587\u6863\u3002\r\n\r\n\u901a\u5e38\u4f60\u4f1a\u7528\u4e00\u4e2a\u53c2\u6570\u5b9e\u4f8b\u5316 `SchemaGenerator`\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\ngenerator = SchemaGenerator(title='Stock Prices API')\r\n```\r\n\r\n\u53c2\u6570\uff1a\r\n\r\n* `title` **\u5fc5\u9700** - API \u7684\u540d\u79f0\u3002\r\n* `url` - API schema \u7684 root URL\u3002\u9664\u975e schema \u5305\u542b\u5728\u8def\u5f84\u524d\u7f00\u4e0b\uff0c\u5426\u5219\u6b64\u9009\u9879\u4e0d\u662f\u5fc5\u9700\u7684\u3002\r\n* `patterns` - \u751f\u6210 schema \u65f6\u8981\u68c0\u67e5\u7684 URL \u5217\u8868\u3002\u9ed8\u8ba4\u4e3a\u9879\u76ee\u7684 URL conf\u3002\r\n* `urlconf` - \u751f\u6210 schema \u65f6\u4f7f\u7528\u7684 URL conf \u6a21\u5757\u540d\u79f0\u3002 \u9ed8\u8ba4\u4e3a `settings.ROOT_URLCONF`.\r\n\r\n### get_schema(self, request)\r\n\r\n\u8fd4\u56de\u8868\u793a API schema \u7684 `coreapi.Document` \u5b9e\u4f8b\u3002\r\n\r\n``` python\r\n@api_view\r\n@renderer_classes([renderers.CoreJSONRenderer])\r\ndef schema_view(request):\r\n    generator = schemas.SchemaGenerator(title='Bookings API')\r\n    return Response(generator.get_schema())\r\n```\r\n\r\n`request` \u53c2\u6570\u662f\u53ef\u9009\u7684\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u5c06\u6bcf\u4e2a\u7528\u6237\u7684\u6743\u9650\u5e94\u7528\u4e8e\u751f\u6210\u7684 schema \uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u8be5\u53c2\u6570\u3002\r\n\r\n### get_links(self, request)\r\n\r\n\u8fd4\u56de\u4e00\u4e2a\u5d4c\u5957\u7684\u5b57\u5178\uff0c\u5176\u4e2d\u5305\u542b\u5728 API schema \u4e2d\u7684\u6240\u6709\u94fe\u63a5\u3002\r\n\r\n\u5982\u679c\u8981\u4fee\u6539\u751f\u6210\u7684 schema \u7684\u7ed3\u6784\uff0c\u91cd\u5199\u8be5\u65b9\u6cd5\u5f88\u5408\u9002\uff0c\u56e0\u4e3a\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u5e03\u5c40\u6784\u5efa\u65b0\u7684\u5b57\u5178\u3002\r\n\r\n\r\n## AutoSchema\r\n\r\n\u4e00\u4e2a\u5904\u7406 schema \u751f\u6210\u7684\u4e2a\u522b\u89c6\u56fe\u5185\u7701\u7684\u7c7b\u3002\r\n\r\n`AutoSchema` \u901a\u8fc7 `schema` \u5c5e\u6027\u9644\u52a0\u5230 `APIView`\u3002\r\n\r\n`AutoSchema` \u6784\u9020\u51fd\u6570\u63a5\u53d7\u4e00\u4e2a\u5173\u952e\u5b57\u53c2\u6570  `manual_fields`\u3002\r\n\r\n**`manual_fields`**: \u5c06\u6dfb\u52a0\u5230\u751f\u6210\u7684\u5b57\u6bb5\u7684 `coreapi.Field` \u5b9e\u4f8b `list`\u3002\u5177\u6709\u5339\u914d\u540d\u79f0\u7684\u751f\u6210\u5b57\u6bb5\u5c06\u88ab\u8986\u76d6\u3002\r\n\r\n``` python\r\nclass CustomView(APIView):\r\n    schema = AutoSchema(manual_fields=[\r\n        coreapi.Field(\r\n            \"my_extra_field\",\r\n            required=True,\r\n            location=\"path\",\r\n            schema=coreschema.String()\r\n        ),\r\n    ])\r\n```\r\n\r\n\u5bf9\u4e8e\u901a\u8fc7\u7ee7\u627f `AutoSchema` \u6765\u81ea\u5b9a\u4e49 schema \u751f\u6210\u3002\r\n\r\n``` python\r\nclass CustomViewSchema(AutoSchema):\r\n    \"\"\"\r\n    Overrides `get_link()` to provide Custom Behavior X\r\n    \"\"\"\r\n\r\n    def get_link(self, path, method, base_url):\r\n        link = super().get_link(path, method, base_url)\r\n        # Do something to customize link here...\r\n        return link\r\n\r\nclass MyView(APIView):\r\n  schema = CustomViewSchema()\r\n```\r\n\r\n\u4ee5\u4e0b\u65b9\u6cd5\u53ef\u8986\u76d6\u3002\r\n\r\n### get_link(self, path, method, base_url)\r\n\r\n\u8fd4\u56de\u4e0e\u7ed9\u5b9a\u89c6\u56fe\u76f8\u5bf9\u5e94\u7684 `coreapi.Link` \u5b9e\u4f8b\u3002\r\n\r\n\u8fd9\u662f\u4e3b\u8981\u7684\u5165\u53e3\u70b9\u3002\u5982\u679c\u4f60\u9700\u8981\u4e3a\u7279\u5b9a\u89c6\u56fe\u63d0\u4f9b\u81ea\u5b9a\u4e49\u884c\u4e3a\uff0c\u5219\u53ef\u4ee5\u8986\u76d6\u6b64\u5185\u5bb9\u3002\r\n\r\n### get_description(self, path, method)\r\n\r\n\u8fd4\u56de\u7528\u4f5c\u94fe\u63a5\u63cf\u8ff0\u7684\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u57fa\u4e8e\u4e0a\u9762\u7684 \u201c\u4f5c\u4e3a\u6587\u6863\u7684 Schemas\u201d action \u4e2d\u63cf\u8ff0\u7684\u89c6\u56fe\u6587\u6863\u5b57\u7b26\u4e32\u3002\r\n\r\n### get_encoding(self, path, method)\r\n\r\n\u4e0e\u7ed9\u5b9a\u89c6\u56fe\u4ea4\u4e92\u65f6\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4ee5\u6307\u5b9a\u4efb\u4f55\u8bf7\u6c42\u4e3b\u4f53\u7684\u7f16\u7801\u3002 \u4f8b\u5982 `'application/json'`\u3002\u53ef\u80fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u7a7a\u767d\u5b57\u7b26\u4e32\uff0c\u4ee5\u4fbf\u67e5\u770b\u4e0d\u9700\u8981\u8bf7\u6c42\u4e3b\u4f53\u7684\u89c6\u56fe\u3002\r\n\r\n### get_path_fields(self, path, method):\r\n\r\n\u8fd4\u56de `coreapi.Link()` \u5b9e\u4f8b\u5217\u8868\u3002\u7528\u4e8e URL \u4e2d\u7684\u6bcf\u4e2a\u8def\u5f84\u53c2\u6570\u3002\r\n\r\n### get_serializer_fields(self, path, method)\r\n\r\n\u8fd4\u56de `coreapi.Link()` \u5b9e\u4f8b\u5217\u8868\u3002\u7528\u4e8e\u89c6\u56fe\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\u3002\r\n\r\n### get_pagination_fields(self, path, method)\r\n\r\n\u8fd4\u56de `coreapi.Link()` \u5b9e\u4f8b\u5217\u8868\uff0c\u8be5\u5217\u8868\u7531 `get_schema_fields()` \u65b9\u6cd5\u8fd4\u56de\u7ed9\u89c6\u56fe\u4f7f\u7528\u7684\u5206\u9875\u7c7b\u3002\r\n\r\n### get_filter_fields(self, path, method)\r\n\r\n\u8fd4\u56de `coreapi.Link()` \u5b9e\u4f8b\u5217\u8868\uff0c\u8be5\u5217\u8868\u662f\u7531\u89c6\u56fe\u6240\u4f7f\u7528\u7684\u8fc7\u6ee4\u5668\u7c7b\u7684 `get_schema_fields()` \u65b9\u6cd5\u8fd4\u56de\u7684\u3002\r\n\r\n### get_manual_fields(self, path, method)\r\n\r\n\u8fd4\u56de `coreapi.Field()` \u5b9e\u4f8b\u5217\u8868\u4ee5\u6dfb\u52a0\u6216\u66ff\u6362\u751f\u6210\u7684\u5b57\u6bb5\u3002\u9ed8\u8ba4\u4e3a\uff08\u53ef\u9009\uff09\u4f20\u9012\u7ed9 `AutoSchema` \u6784\u9020\u51fd\u6570\u7684 `manual_fields`\u3002\r\n\r\n\u53ef\u4ee5\u901a\u8fc7 `path` \u6216 `method` \u8986\u76d6\u81ea\u5b9a\u4e49 manual field\u3002\u4f8b\u5982\uff0c\u6bcf\u4e2a\u65b9\u6cd5\u7684\u8c03\u6574\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\ndef get_manual_fields(self, path, method):\r\n    \"\"\"Example adding per-method fields.\"\"\"\r\n\r\n    extra_fields = []\r\n    if method=='GET':\r\n        extra_fields = # ... list of extra fields for GET ...\r\n    if method=='POST':\r\n        extra_fields = # ... list of extra fields for POST ...\r\n\r\n    manual_fields = super().get_manual_fields(path, method)\r\n    return manual_fields + extra_fields\r\n```\r\n\r\n### update_fields(fields, update_with)\r\n\r\n\u5b9e\u7528\u7684 `staticmethod`\u3002\u5c01\u88c5\u903b\u8f91\u4ee5\u901a\u8fc7 `Field.name` \u6dfb\u52a0\u6216\u66ff\u6362\u5217\u8868\u4e2d\u7684\u5b57\u6bb5\u3002\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6\u4ee5\u8c03\u6574\u66ff\u6362\u6807\u51c6\u3002\r\n\r\n\r\n## ManualSchema\r\n\r\n\u5141\u8bb8\u624b\u52a8\u4e3a schema \u63d0\u4f9b `coreapi.Field` \u5b9e\u4f8b\u7684\u5217\u8868\uff0c\u4ee5\u53ca\u4e00\u4e2a\u53ef\u9009\u7684\u63cf\u8ff0\u3002\r\n\r\n``` python\r\nclass MyView(APIView):\r\n  schema = ManualSchema(fields=[\r\n        coreapi.Field(\r\n            \"first_field\",\r\n            required=True,\r\n            location=\"path\",\r\n            schema=coreschema.String()\r\n        ),\r\n        coreapi.Field(\r\n            \"second_field\",\r\n            required=True,\r\n            location=\"path\",\r\n            schema=coreschema.String()\r\n        ),\r\n    ]\r\n  )\r\n```\r\n\r\n`ManualSchema` \u6784\u9020\u51fd\u6570\u6709\u4e24\u4e2a\u53c2\u6570\uff1a\r\n\r\n**`fields`**: `coreapi.Field` \u5b9e\u4f8b\u5217\u8868\u3002\u5fc5\u9700\u3002\r\n\r\n**`description`**: \u5b57\u7b26\u4e32\u63cf\u8ff0\u3002\u53ef\u9009\u7684\u3002\r\n\r\n\r\n---\r\n\r\n## Core API\r\n\r\n\u672c\u6587\u6863\u7b80\u8981\u4ecb\u7ecd\u4e86\u7528\u4e8e\u8868\u793a API schema \u7684 `coreapi` \u5305\u5185\u7684\u7ec4\u4ef6\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9b\u7c7b\u662f\u4ece `coreapi` \u5305\u5bfc\u5165\u7684\uff0c\u800c\u4e0d\u662f\u4ece `rest_framework` \u5305\u5bfc\u5165\u7684\u3002\r\n\r\n### Document\r\n\r\n\u8868\u793a API schema \u7684\u5bb9\u5668\u3002\r\n\r\n#### `title`\r\n\r\nAPI \u7684\u540d\u79f0\u3002\r\n\r\n#### `url`\r\n\r\nAPI \u7684\u89c4\u8303 URL\u3002\r\n\r\n#### `content`\r\n\r\n\u4e00\u4e2a\u5b57\u5178\uff0c\u5305\u542b schema \u7684 `Link` \u5bf9\u8c61\u3002\r\n\r\n\u4e3a\u4e86\u5411 schema  \u63d0\u4f9b\u66f4\u591a\u7ed3\u6784\uff0c`content` \u5b57\u5178\u53ef\u4ee5\u5d4c\u5957\uff0c\u901a\u5e38\u662f\u4e8c\u5c42\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\ncontent={\r\n    \"bookings\": {\r\n        \"list\": Link(...),\r\n        \"create\": Link(...),\r\n        ...\r\n    },\r\n    \"venues\": {\r\n        \"list\": Link(...),\r\n        ...\r\n    },\r\n    ...\r\n}\r\n```\r\n\r\n### Link\r\n\r\n\u4ee3\u8868\u4e00\u4e2a\u5355\u72ec\u7684 API \u7aef\u70b9\u3002\r\n\r\n#### `url`\r\n\r\n\u7aef\u70b9\u7684 URL\u3002\u53ef\u80fd\u662f\u4e00\u4e2a URI \u6a21\u677f\uff0c\u4f8b\u5982 `/users/{username}/`\u3002\r\n\r\n#### `action`\r\n\r\n\u4e0e\u7aef\u70b9\u5173\u8054\u7684 HTTP \u65b9\u6cd5\u3002\u8bf7\u6ce8\u610f\uff0c\u652f\u6301\u591a\u4e2a HTTP \u65b9\u6cd5\u7684 url \u5e94\u8be5\u5bf9\u5e94\u4e8e\u6bcf\u4e2a HTTP \u65b9\u6cd5\u7684\u5355\u4e2a\u94fe\u63a5\u3002\r\n\r\n#### `fields`\r\n\r\n`Field` \u5b9e\u4f8b\u5217\u8868\uff0c\u63cf\u8ff0\u8f93\u5165\u4e0a\u7684\u53ef\u7528\u53c2\u6570\u3002\r\n\r\n#### `description`\r\n\r\n\u5bf9\u7aef\u70b9\u7684\u542b\u4e49\u548c\u7528\u9014\u7684\u7b80\u77ed\u63cf\u8ff0\u3002\r\n\r\n### Field\r\n\r\n\u8868\u793a\u7ed9\u5b9a API \u7aef\u70b9\u4e0a\u7684\u5355\u4e2a\u8f93\u5165\u53c2\u6570\u3002\r\n\r\n#### `name`\r\n\r\n\u8f93\u5165\u7684\u63cf\u8ff0\u6027\u540d\u79f0\u3002\r\n\r\n#### `required`\r\n\r\nboolean \u503c\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u662f\u5426\u9700\u8981\u5305\u542b\u503c\uff0c\u6216\u8005\u53c2\u6570\u662f\u5426\u53ef\u4ee5\u7701\u7565\u3002\r\n\r\n#### `location`\r\n\r\n\u786e\u5b9a\u5982\u4f55\u5c06\u4fe1\u606f\u7f16\u7801\u5230\u8bf7\u6c42\u4e2d\u3002\u5e94\u8be5\u662f\u4ee5\u4e0b\u5b57\u7b26\u4e32\u4e4b\u4e00\uff1a\r\n\r\n**\"path\"**\r\n\r\n\u5305\u542b\u5728\u6a21\u677f\u5316\u7684 URI \u4e2d\u3002\u4f8b\u5982\uff0c`/products/{product_code}/` \u7684 `url` \u503c\u53ef\u4ee5\u4e0e `\"path\"` \u5b57\u6bb5\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u5904\u7406 URL \u8def\u5f84\u4e2d\u7684 API \u8f93\u5165\uff0c\u4f8b\u5982 `/products/slim-fit-jeans/`\u3002\r\n\r\n\u8fd9\u4e9b\u5b57\u6bb5\u901a\u5e38\u4e0e\u9879\u76ee URL conf \u4e2d\u7684\u547d\u540d\u53c2\u6570\u5bf9\u5e94\u3002\r\n\r\n**\"query\"**\r\n\r\n\u5305\u542b\u4e3a URL \u67e5\u8be2\u53c2\u6570\u3002\u4f8b\u5982 `?search=sale`\u3002\u901a\u5e38\u7528\u4e8e `GET` \u8bf7\u6c42\u3002\r\n\r\n\u8fd9\u4e9b\u5b57\u6bb5\u901a\u5e38\u4e0e\u89c6\u56fe\u4e0a\u7684\u5206\u9875\u548c\u8fc7\u6ee4\u63a7\u4ef6\u76f8\u5bf9\u5e94\u3002\r\n\r\n**\"form\"**\r\n\r\n\u5305\u542b\u5728\u8bf7\u6c42\u6b63\u6587\u4e2d\uff0c\u4f5c\u4e3a JSON \u5bf9\u8c61\u6216 HTML \u8868\u5355\u7684\u5355\u4e2a item\u3002\u4f8b\u5982 `{\"colour\": \"blue\", ...}`\u3002\u901a\u5e38\u7528\u4e8e`POST`\uff0c`PUT` \u548c `PATCH` \u8bf7\u6c42\u3002\u591a\u4e2a `\"form\"` \u5b57\u6bb5\u53ef\u80fd\u5305\u542b\u5728\u5355\u4e2a\u94fe\u63a5\u4e0a\u3002\r\n\r\n\u8fd9\u4e9b\u5b57\u6bb5\u901a\u5e38\u4e0e\u89c6\u56fe\u4e0a\u7684\u5e8f\u5217\u5316\u7c7b\u5b57\u6bb5\u76f8\u5bf9\u5e94\u3002\r\n\r\n**\"body\"**\r\n\r\n\u5305\u542b\u5b8c\u6574\u7684\u8bf7\u6c42\u4e3b\u4f53\u3002\u901a\u5e38\u7528\u4e8e `POST`, `PUT` \u548c `PATCH` \u8bf7\u6c42\u3002\u94fe\u63a5\u4e0a\u4e0d\u5f97\u5b58\u5728\u8d85\u8fc7\u4e00\u4e2a `\"body\"` \u5b57\u6bb5\u3002\u4e0d\u80fd\u4e0e `\"form\"` \u5b57\u6bb5\u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n\u8fd9\u4e9b\u5b57\u6bb5\u901a\u5e38\u5bf9\u5e94\u4e8e\u4f7f\u7528 `ListSerializer`\u6765\u9a8c\u8bc1\u8bf7\u6c42\u8f93\u5165\u6216\u4f7f\u7528\u6587\u4ef6\u4e0a\u8f7d\u7684\u89c6\u56fe\u3002\r\n\r\n#### `encoding`\r\n\r\n**\"application/json\"**\r\n\r\nJSON\u7f16\u7801\u7684\u8bf7\u6c42\u5185\u5bb9\u3002\u5bf9\u5e94\u4e8e\u4f7f\u7528 `JSONParser` \u7684\u89c6\u56fe\u3002\u4ec5\u5728 `Link` \u4e2d\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a `location=\"form\"` \u5b57\u6bb5\u6216\u5355\u4e2a `location=\"body\"` \u5b57\u6bb5\u65f6\u6709\u6548\u3002\r\n\r\n**\"multipart/form-data\"**\r\n\r\nMultipart \u7f16\u7801\u7684\u8bf7\u6c42\u5185\u5bb9\u3002\u5bf9\u5e94\u4e8e\u4f7f\u7528 `MultiPartParser` \u7684\u89c6\u56fe\u3002\u4ec5\u5728 `Link` \u4e2d\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a `location=\"form\"` \u5b57\u6bb5\u65f6\u6709\u6548\u3002\r\n\r\n**\"application/x-www-form-urlencoded\"**\r\n\r\nURL encode \u7684\u8bf7\u6c42\u5185\u5bb9\u3002\u5bf9\u5e94\u4e8e\u4f7f\u7528 `FormParser` \u7684\u89c6\u56fe\u3002\u4ec5\u5728 `Link` \u4e2d\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a `location=\"form\"` \u5b57\u6bb5\u65f6\u6709\u6548\u3002\r\n\r\n**\"application/octet-stream\"**\r\n\r\n\u4e8c\u8fdb\u5236\u4e0a\u4f20\u8bf7\u6c42\u5185\u5bb9\u3002\u5bf9\u5e94\u4e8e\u4f7f\u7528 `FileUploadParser` \u7684\u89c6\u56fe\u3002\u4ec5\u5728 `Link` \u4e2d\u5305\u542b `location=\"body\"` \u5b57\u6bb5\u65f6\u6709\u6548\u3002\r\n\r\n#### `description`\r\n\r\n\u5bf9\u8f93\u5165\u5b57\u6bb5\u7684\u542b\u4e49\u548c\u7528\u9014\u7684\u7b80\u77ed\u63cf\u8ff0\u3002\r\n", "md_File": "subject/django-rest-framework-api-guide/schemas.md", "create_date": "2020-02-20T13:10:40.815", "order": 21}}, {"model": "subject.chapter", "pk": 164, "fields": {"title": "\u72b6\u6001\u7801status-codes", "topic": 7, "md5": "b8995d624bc7fa67172ff19c31dd6420", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/status-codes/)  \r\n\r\n\r\n# \u72b6\u6001\u7801\r\n\r\n\r\n\r\n\u4e0d\u5efa\u8bae\u5728\u4f60\u7684\u54cd\u5e94\u4e2d\u4f7f\u7528\u88f8\u9732\uff08\u76f4\u63a5\u4f7f\u7528\u6570\u5b57\uff09\u7684\u72b6\u6001\u7801\u3002 REST framework \u5305\u542b\u4e00\u7ec4\u547d\u540d\u5e38\u91cf\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b83\u4eec\u4f7f\u4ee3\u7801\u66f4\u52a0\u6e05\u6670\u6613\u8bfb\u3002\r\n\r\n``` python\r\nfrom rest_framework import status\r\nfrom rest_framework.response import Response\r\n\r\ndef empty_view(self):\r\n    content = {'please move along': 'nothing to see here'}\r\n    return Response(content, status=status.HTTP_404_NOT_FOUND)\r\n```\r\n\r\n\u4e0b\u9762\u5217\u51fa\u4e86 `status` \u6a21\u5757\u4e2d\u5305\u542b\u7684\u5168\u90e8 HTTP \u72b6\u6001\u7801\u3002\r\n\r\n\u8be5\u6a21\u5757\u8fd8\u5305\u542b\u4e00\u7ec4\u5e2e\u52a9\u51fd\u6570\uff0c\u7528\u4e8e\u6d4b\u8bd5\u72b6\u6001\u7801\u662f\u5426\u5728\u7ed9\u5b9a\u8303\u56f4\u5185\u3002\r\n\r\n``` python\r\nfrom rest_framework import status\r\nfrom rest_framework.test import APITestCase\r\n\r\nclass ExampleTestCase(APITestCase):\r\n    def test_url_root(self):\r\n        url = reverse('index')\r\n        response = self.client.get(url)\r\n        self.assertTrue(status.is_success(response.status_code))\r\n```\r\n\r\n\r\n## \u4fe1\u606f - 1xx\r\n\r\n\u8fd9\u7c7b\u72b6\u6001\u7801\u8868\u793a\u4e34\u65f6\u54cd\u5e94\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cREST framework \u4e2d\u6ca1\u6709\u4f7f\u7528 1xx \u72b6\u6001\u7801\u3002\r\n\r\n```\r\nHTTP_100_CONTINUE\r\nHTTP_101_SWITCHING_PROTOCOLS \r\n```\r\n\r\n## \u6210\u529f - 2xx\r\n\r\n\u8fd9\u7c7b\u72b6\u6001\u7801\u8868\u660e\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5df2\u88ab\u6210\u529f\u63a5\u6536\uff0c\u7406\u89e3\u548c\u63a5\u53d7\u3002\r\n\r\n```\r\nHTTP_200_OK\r\nHTTP_201_CREATED\r\nHTTP_202_ACCEPTED\r\nHTTP_203_NON_AUTHORITATIVE_INFORMATION\r\nHTTP_204_NO_CONTENT\r\nHTTP_205_RESET_CONTENT\r\nHTTP_206_PARTIAL_CONTENT\r\nHTTP_207_MULTI_STATUS\r\n```\r\n\r\n## \u91cd\u5b9a\u5411 - 3xx\r\n\r\n\u8fd9\u7c7b\u72b6\u6001\u7801\u8868\u660e\u7528\u6237\u4ee3\u7406\u9700\u8981\u91c7\u53d6\u8fdb\u4e00\u6b65\u884c\u52a8\u6765\u5b8c\u6210\u8bf7\u6c42\u3002\r\n\r\n```\r\nHTTP_300_MULTIPLE_CHOICES\r\nHTTP_301_MOVED_PERMANENTLY\r\nHTTP_302_FOUND\r\nHTTP_303_SEE_OTHER\r\nHTTP_304_NOT_MODIFIED\r\nHTTP_305_USE_PROXY\r\nHTTP_306_RESERVED\r\nHTTP_307_TEMPORARY_REDIRECT\r\n```\r\n\r\n## \u5ba2\u6237\u7aef\u9519\u8bef - 4xx\r\n\r\n4xx \u72b6\u6001\u7801\u9002\u7528\u4e8e\u5ba2\u6237\u7aef\u51fa\u73b0\u9519\u8bef\u7684\u60c5\u51b5\u3002\u9664\u4e86\u54cd\u5e94 HEAD \u8bf7\u6c42\u4e4b\u5916\uff0c\u670d\u52a1\u5668\u5e94\u8be5\u5305\u542b\u4e00\u4e2a\u9519\u8bef\u60c5\u51b5\u8bf4\u660e\u7684\u5b9e\u4f53\uff0c\u4ee5\u53ca\u5b83\u662f\u4e34\u65f6\u7684\u8fd8\u662f\u6c38\u4e45\u7684\u3002\r\n\r\n```\r\nHTTP_400_BAD_REQUEST\r\nHTTP_401_UNAUTHORIZED\r\nHTTP_402_PAYMENT_REQUIRED\r\nHTTP_403_FORBIDDEN\r\nHTTP_404_NOT_FOUND\r\nHTTP_405_METHOD_NOT_ALLOWED\r\nHTTP_406_NOT_ACCEPTABLE\r\nHTTP_407_PROXY_AUTHENTICATION_REQUIRED\r\nHTTP_408_REQUEST_TIMEOUT\r\nHTTP_409_CONFLICT\r\nHTTP_410_GONE\r\nHTTP_411_LENGTH_REQUIRED\r\nHTTP_412_PRECONDITION_FAILED\r\nHTTP_413_REQUEST_ENTITY_TOO_LARGE\r\nHTTP_414_REQUEST_URI_TOO_LONG\r\nHTTP_415_UNSUPPORTED_MEDIA_TYPE\r\nHTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE\r\nHTTP_417_EXPECTATION_FAILED\r\nHTTP_422_UNPROCESSABLE_ENTITY\r\nHTTP_423_LOCKED\r\nHTTP_424_FAILED_DEPENDENCY\r\nHTTP_428_PRECONDITION_REQUIRED\r\nHTTP_429_TOO_MANY_REQUESTS\r\nHTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE\r\nHTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS\r\n```\r\n\r\n## \u670d\u52a1\u5668\u9519\u8bef - 5xx\r\n\r\n5xx \u8868\u793a\u670d\u52a1\u5668\u610f\u8bc6\u5230\u5176\u53d1\u751f\u9519\u8bef\u6216\u65e0\u6cd5\u6267\u884c\u8bf7\u6c42\u7684\u60c5\u51b5\u3002\u9664\u4e86\u54cd\u5e94 HEAD \u8bf7\u6c42\u4e4b\u5916\uff0c\u670d\u52a1\u5668\u5e94\u8be5\u5305\u542b\u4e00\u4e2a\u9519\u8bef\u60c5\u51b5\u8bf4\u660e\u7684\u5b9e\u4f53\uff0c\u4ee5\u53ca\u5b83\u662f\u4e34\u65f6\u7684\u8fd8\u662f\u6c38\u4e45\u7684\u3002\r\n\r\n```\r\nHTTP_500_INTERNAL_SERVER_ERROR\r\nHTTP_501_NOT_IMPLEMENTED\r\nHTTP_502_BAD_GATEWAY\r\nHTTP_503_SERVICE_UNAVAILABLE\r\nHTTP_504_GATEWAY_TIMEOUT\r\nHTTP_505_HTTP_VERSION_NOT_SUPPORTED\r\nHTTP_507_INSUFFICIENT_STORAGE\r\nHTTP_511_NETWORK_AUTHENTICATION_REQUIRED\r\n```\r\n\r\n## \u5e2e\u52a9\u51fd\u6570\r\n\r\n\u4ee5\u4e0b\u5e2e\u52a9\u51fd\u6570\u53ef\u7528\u4e8e\u8bc6\u522b\u54cd\u5e94\u4ee3\u7801\u7684\u7c7b\u522b\u3002\r\n\r\n``` python\r\nis_informational()  # 1xx\r\nis_success()        # 2xx\r\nis_redirect()       # 3xx\r\nis_client_error()   # 4xx\r\nis_server_error()   # 5xx\r\n```\r\n", "md_File": "subject/django-rest-framework-api-guide/status-codes.md", "create_date": "2020-02-20T13:10:40.833", "order": 25}}, {"model": "subject.chapter", "pk": 165, "fields": {"title": "\u6d4b\u8bd5testing", "topic": 7, "md5": "c3524184fb6ebfeeb4f0851b87459b2a", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/testing/)  \r\n\r\n\r\n# \u6d4b\u8bd5\r\n\r\n\r\nREST framework \u5305\u542b\u4e00\u4e9b\u6269\u5c55 Django \u73b0\u6709\u6d4b\u8bd5\u6846\u67b6\u7684\u52a9\u624b\u7c7b\uff0c\u5e76\u6539\u8fdb\u5bf9 API \u8bf7\u6c42\u7684\u652f\u6301\u3002\r\n\r\n# APIRequestFactory\r\n\r\n\u6269\u5c55\u4e86 Django \u73b0\u6709\u7684 `RequestFactory` \u7c7b\u3002\r\n\r\n## \u521b\u5efa\u6d4b\u8bd5\u8bf7\u6c42\r\n\r\n`APIRequestFactory` \u7c7b\u652f\u6301\u4e0e Django \u7684\u6807\u51c6 `RequestFactory` \u7c7b\u51e0\u4e4e\u5b8c\u5168\u76f8\u540c\u7684 API\u3002\u8fd9\u610f\u5473\u7740\u6807\u51c6\u7684 `.get()`, `.post()`, `.put()`, `.patch()`, `.delete()`, `.head()` \u548c `.options()` \u65b9\u6cd5\u90fd\u53ef\u7528\u3002\r\n\r\n``` python\r\nfrom rest_framework.test import APIRequestFactory\r\n\r\n# Using the standard RequestFactory API to create a form POST request\r\nfactory = APIRequestFactory()\r\nrequest = factory.post('/notes/', {'title': 'new idea'})\r\n```\r\n\r\n#### \u4f7f\u7528 `format` \u53c2\u6570\r\n\r\n\u521b\u5efa\u8bf7\u6c42\u4e3b\u4f53\uff08\u5982 `post`\uff0c`put` \u548c `patch`\uff09\u7684\u65b9\u6cd5\u5305\u62ec `format` \u53c2\u6570\uff0c\u8fd9\u4f7f\u5f97\u4f7f\u7528\u9664 multipart \u8868\u5355\u6570\u636e\u4ee5\u5916\u7684\u5185\u5bb9\u7c7b\u578b\u751f\u6210\u8bf7\u6c42\u53d8\u5f97\u5bb9\u6613\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\n# Create a JSON POST request\r\nfactory = APIRequestFactory()\r\nrequest = factory.post('/notes/', {'title': 'new idea'}, format='json')\r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ef\u7528\u7684\u683c\u5f0f\u662f `'multipart'` \u548c `'json'` \u3002\u4e3a\u4e86\u4e0e Django \u73b0\u6709\u7684 `RequestFactory` \u517c\u5bb9\uff0c\u9ed8\u8ba4\u683c\u5f0f\u662f `'multipart'`\u3002\r\n\r\n\r\n#### \u663e\u5f0f\u7f16\u7801\u8bf7\u6c42\u4e3b\u4f53\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u663e\u5f0f\u7f16\u7801\u8bf7\u6c42\u6b63\u6587\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e `content_type` \u6807\u5fd7\u6765\u5b8c\u6210\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nrequest = factory.post('/notes/', json.dumps({'title': 'new idea'}), content_type='application/json')\r\n```\r\n\r\n#### PUT \u548c PATCH \u4e0e\u8868\u5355\u6570\u636e\r\n\r\nDjango \u7684 `RequestFactory` \u548c REST framework \u7684 `APIRequestFactory` \u4e4b\u95f4\u503c\u5f97\u6ce8\u610f\u7684\u4e00\u4e2a\u533a\u522b\u662f multipart \u8868\u5355\u6570\u636e\u5c06\u88ab\u7f16\u7801\u4e3a\u9664 `.post()` \u4ee5\u5916\u7684\u65b9\u6cd5\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4f7f\u7528 `APIRequestFactory`\uff0c\u4f60\u53ef\u4ee5\u50cf\u8fd9\u6837\u505a\u4e00\u4e2a\u8868\u5355 PUT \u8bf7\u6c42\uff1a\r\n\r\n``` python\r\nfactory = APIRequestFactory()\r\nrequest = factory.put('/notes/547/', {'title': 'remember to email dave'})\r\n```\r\n\r\n\u4f7f\u7528 Django \u7684 `RequestFactory`\uff0c\u4f60\u9700\u8981\u81ea\u5df1\u663e\u5f0f\u7f16\u7801\u6570\u636e\uff1a\r\n\r\n``` python\r\nfrom django.test.client import encode_multipart, RequestFactory\r\n\r\nfactory = RequestFactory()\r\ndata = {'title': 'remember to email dave'}\r\ncontent = encode_multipart('BoUnDaRyStRiNg', data)\r\ncontent_type = 'multipart/form-data; boundary=BoUnDaRyStRiNg'\r\nrequest = factory.put('/notes/547/', content, content_type=content_type)\r\n```\r\n\r\n## \u5f3a\u5236\u8ba4\u8bc1\r\n\r\n\u5f53\u4f7f\u7528\u8bf7\u6c42\u5de5\u5382\u76f4\u63a5\u6d4b\u8bd5\u89c6\u56fe\u65f6\uff0c\u80fd\u591f\u76f4\u63a5\u9a8c\u8bc1\u8bf7\u6c42\u901a\u5e38\u5f88\u65b9\u4fbf\uff0c\u800c\u4e0d\u5fc5\u6784\u9020\u6b63\u786e\u7684\u9a8c\u8bc1\u51ed\u8bc1\u3002\r\n\r\n\u8981\u5f3a\u5236\u9a8c\u8bc1\u8bf7\u6c42\uff0c\u8bf7\u4f7f\u7528 `force_authenticate()` \u65b9\u6cd5\u3002\r\n\r\n``` python\r\nfrom rest_framework.test import force_authenticate\r\n\r\nfactory = APIRequestFactory()\r\nuser = User.objects.get(username='olivia')\r\nview = AccountDetail.as_view()\r\n\r\n# Make an authenticated request to the view...\r\nrequest = factory.get('/accounts/django-superstars/')\r\nforce_authenticate(request, user=user)\r\nresponse = view(request)\r\n```\r\n\r\n\u8be5\u65b9\u6cd5\u7684\u7b7e\u540d\u662f `force_authenticate(request, user=None, token=None)`\u3002\u8c03\u7528\u65f6\uff0c\u53ef\u4ee5\u8bbe\u7f6e user \u548c token \u4e2d\u7684\u4efb\u4e00\u4e2a\u6216\u4e24\u4e2a\u3002\r\n\r\n\u4f8b\u5982\uff0c\u5f53\u4f7f\u7528\u4ee4\u724c\u5f3a\u884c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u4f60\u53ef\u80fd\u4f1a\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\r\n\r\n``` python\r\nuser = User.objects.get(username='olivia')\r\nrequest = factory.get('/accounts/django-superstars/')\r\nforce_authenticate(request, user=user, token=user.auth_token)\r\n```\r\n\r\n---\r\n\r\n**\u6ce8\u610f**: `force_authenticate` \u76f4\u63a5\u5c06 `request.user` \u8bbe\u7f6e\u4e3a\u5185\u5b58\u4e2d\u7684 `user` \u5b9e\u4f8b\u3002\u5982\u679c\u8de8\u591a\u4e2a\u6d4b\u8bd5\u91cd\u65b0\u4f7f\u7528\u540c\u4e00\u4e2a `user` \u5b9e\u4f8b\u6765\u66f4\u65b0\u5df2\u4fdd\u5b58\u7684 `user` \u72b6\u6001\uff0c\u5219\u53ef\u80fd\u9700\u8981\u5728\u6d4b\u8bd5\u4e4b\u95f4\u8c03\u7528 `refresh_from_db()`\u3002\r\n\r\n---\r\n\r\n**\u6ce8\u610f**: \u4f7f\u7528 `APIRequestFactory` \u65f6\uff0c\u8fd4\u56de\u7684\u5bf9\u8c61\u662f Django \u7684\u6807\u51c6 `HttpRequest`\uff0c\u800c\u4e0d\u662f REST framework \u7684 `Request` \u5bf9\u8c61\uff0c\u53ea\u6709\u5728\u8c03\u7528\u89c6\u56fe\u540e\u624d\u4f1a\u751f\u6210\u8be5\u5bf9\u8c61\u3002\r\n\r\n\u8fd9\u610f\u5473\u7740\u76f4\u63a5\u5728\u8bf7\u6c42\u5bf9\u8c61\u4e0a\u8bbe\u7f6e\u5c5e\u6027\u53ef\u80fd\u5e76\u4e0d\u603b\u662f\u6709\u4f60\u671f\u671b\u7684\u6548\u679c\u3002\u4f8b\u5982\uff0c\u76f4\u63a5\u8bbe\u7f6e `.token` \u5c06\u4e0d\u8d77\u4f5c\u7528\uff0c\u5e76\u4e14\u4ec5\u5728\u4f7f\u7528\u4f1a\u8bdd\u8eab\u4efd\u9a8c\u8bc1\u65f6\u76f4\u63a5\u8bbe\u7f6e `.user` \u624d\u4f1a\u8d77\u4f5c\u7528\u3002\r\n\r\n``` python\r\n# Request will only authenticate if `SessionAuthentication` is in use.\r\nrequest = factory.get('/accounts/django-superstars/')\r\nrequest.user = user\r\nresponse = view(request)\r\n```\r\n\r\n---\r\n\r\n## \u5f3a\u5236 CSRF \u9a8c\u8bc1\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 `APIRequestFactory` \u521b\u5efa\u7684\u8bf7\u6c42\u5728\u4f20\u9012\u7ed9 REST framework \u89c6\u56fe\u65f6\u4e0d\u4f1a\u5e94\u7528 CSRF \u9a8c\u8bc1\u3002\u5982\u679c\u4f60\u9700\u8981\u660e\u786e\u6253\u5f00 CSRF \u9a8c\u8bc1\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u5728\u5b9e\u4f8b\u5316\u5de5\u5382\u65f6\u8bbe\u7f6e `enforce_csrf_checks` \u6807\u5fd7\u6765\u5b9e\u73b0\u3002\r\n\r\n``` python\r\nfactory = APIRequestFactory(enforce_csrf_checks=True)\r\n```\r\n\r\n---\r\n\r\n**\u6ce8\u610f**: \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cDjango \u7684\u6807\u51c6 `RequestFactory` \u4e0d\u9700\u8981\u5305\u542b\u8fd9\u4e2a\u9009\u9879\uff0c\u56e0\u4e3a\u5f53\u4f7f\u7528\u5e38\u89c4\u7684 Django \u65f6\uff0cCSRF \u9a8c\u8bc1\u53d1\u751f\u5728\u4e2d\u95f4\u4ef6\u4e2d\uff0c\u5f53\u76f4\u63a5\u6d4b\u8bd5\u89c6\u56fe\u65f6\u8be5\u4e2d\u95f4\u4ef6\u4e0d\u8fd0\u884c\u3002\u5728\u4f7f\u7528 REST framework \u65f6\uff0cCSRF \u9a8c\u8bc1\u53d1\u751f\u5728\u89c6\u56fe\u5185\uff0c\u56e0\u6b64\u8bf7\u6c42\u5de5\u5382\u9700\u8981\u7981\u7528\u89c6\u56fe\u7ea7 CSRF \u68c0\u67e5\u3002\r\n\r\n---\r\n\r\n# APIClient\r\n\r\n\u6269\u5c55\u4e86 Django \u73b0\u6709\u7684 `Client` \u7c7b\u3002\r\n\r\n## \u53d1\u51fa\u8bf7\u6c42\r\n\r\n`APIClient` \u7c7b\u652f\u6301\u4e0e Django \u6807\u51c6 `Client` \u7c7b\u76f8\u540c\u7684\u8bf7\u6c42\u63a5\u53e3\u3002\u8fd9\u610f\u5473\u7740\u6807\u51c6\u7684 `.get()`, `.post()`, `.put()`, `.patch()`, `.delete()`, `.head()` \u548c `.options()` \u65b9\u6cd5\u90fd\u53ef\u7528\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nfrom rest_framework.test import APIClient\r\n\r\nclient = APIClient()\r\nclient.post('/notes/', {'title': 'new idea'}, format='json')\r\n```\r\n\r\n\r\n## \u8ba4\u8bc1\r\n\r\n#### .login(**kwargs)\r\n\r\n`login` \u65b9\u6cd5\u7684\u529f\u80fd\u4e0e Django \u7684\u5e38\u89c4 `Client` \u7c7b\u4e00\u6837\u3002\u8fd9\u4f7f\u4f60\u53ef\u4ee5\u5bf9\u4efb\u4f55\u5305\u542b `SessionAuthentication` \u7684\u89c6\u56fe\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\r\n\r\n``` python\r\n# Make all requests in the context of a logged in session.\r\nclient = APIClient()\r\nclient.login(username='lauren', password='secret')\r\n```\r\n\r\n\u8981\u767b\u51fa\uff0c\u8bf7\u7167\u5e38\u8c03\u7528 `logout` \u65b9\u6cd5\u3002\r\n\r\n``` python\r\n# Log out\r\nclient.logout()\r\n```\r\n\r\n`login` \u65b9\u6cd5\u9002\u7528\u4e8e\u6d4b\u8bd5\u4f7f\u7528\u4f1a\u8bdd\u8ba4\u8bc1\u7684 API\uff0c\u4f8b\u5982\u5305\u542b AJAX \u4e0e API \u4ea4\u4e92\u7684\u7f51\u7ad9\u3002\r\n\r\n#### .credentials(**kwargs)\r\n\r\n`credentials` \u65b9\u6cd5\u53ef\u7528\u4e8e\u8bbe\u7f6e header\uff0c\u8fd9\u4e9b header \u5c06\u5305\u542b\u5728\u6d4b\u8bd5\u5ba2\u6237\u7aef\u7684\u6240\u6709\u540e\u7eed\u8bf7\u6c42\u4e2d\u3002\r\n\r\n``` python\r\nfrom rest_framework.authtoken.models import Token\r\nfrom rest_framework.test import APIClient\r\n\r\n# Include an appropriate `Authorization:` header on all requests.\r\ntoken = Token.objects.get(user__username='lauren')\r\nclient = APIClient()\r\nclient.credentials(HTTP_AUTHORIZATION='Token ' + token.key)\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u7b2c\u4e8c\u6b21\u8c03\u7528 `credentials` \u4f1a\u8986\u76d6\u4efb\u4f55\u73b0\u6709\u51ed\u8bc1\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u6ca1\u6709\u53c2\u6570\u7684\u65b9\u6cd5\u6765\u53d6\u6d88\u4efb\u4f55\u73b0\u6709\u7684\u51ed\u8bc1\u3002\r\n\r\n``` python\r\n# Stop including any credentials\r\nclient.credentials()\r\n```\r\n\r\n`credentials` \u65b9\u6cd5\u9002\u7528\u4e8e\u6d4b\u8bd5\u9700\u8981\u9a8c\u8bc1 header \u7684 API\uff0c\u4f8b\u5982 basic \u9a8c\u8bc1\uff0cOAuth1 \u548c OAuth2 \u9a8c\u8bc1\u4ee5\u53ca\u7b80\u5355\u4ee4\u724c\u9a8c\u8bc1\u65b9\u6848\u3002\r\n\r\n#### .force_authenticate(user=None, token=None)\r\n\r\n\u6709\u65f6\u4f60\u53ef\u80fd\u60f3\u5b8c\u5168\u7ed5\u8fc7\u8ba4\u8bc1\uff0c\u5f3a\u5236\u6d4b\u8bd5\u5ba2\u6237\u7aef\u7684\u6240\u6709\u8bf7\u6c42\u88ab\u81ea\u52a8\u89c6\u4e3a\u5df2\u8ba4\u8bc1\u3002\r\n\r\n\u5982\u679c\u4f60\u6b63\u5728\u6d4b\u8bd5 API \u4f46\u662f\u4e0d\u60f3\u6784\u5efa\u6709\u6548\u7684\u8eab\u4efd\u9a8c\u8bc1\u51ed\u636e\u4ee5\u8fdb\u884c\u6d4b\u8bd5\u8bf7\u6c42\uff0c\u5219\u8fd9\u53ef\u80fd\u662f\u4e00\u4e2a\u6709\u7528\u7684\u6377\u5f84\u3002\r\n\r\n``` python\r\nuser = User.objects.get(username='lauren')\r\nclient = APIClient()\r\nclient.force_authenticate(user=user)\r\n```\r\n\r\n\u8981\u5bf9\u540e\u7eed\u8bf7\u6c42\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u8bf7\u8c03\u7528 `force_authenticate` \u5c06 user \u548c(\u6216) token \u8bbe\u7f6e\u4e3a `None`\u3002\r\n\r\n``` python\r\nclient.force_authenticate(user=None)\r\n```\r\n\r\n## CSRF \u9a8c\u8bc1\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 `APIClient` \u65f6\u4e0d\u5e94\u7528 CSRF \u9a8c\u8bc1\u3002\u5982\u679c\u4f60\u9700\u8981\u660e\u786e\u542f\u7528 CSRF \u9a8c\u8bc1\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u5728\u5b9e\u4f8b\u5316\u5ba2\u6237\u7aef\u65f6\u8bbe\u7f6e `enforce_csrf_checks` \u6807\u5fd7\u6765\u5b9e\u73b0\u3002\r\n\r\n``` python\r\nclient = APIClient(enforce_csrf_checks=True)\r\n```\r\n\r\n\u50cf\u5f80\u5e38\u4e00\u6837\uff0cCSRF \u9a8c\u8bc1\u5c06\u4ec5\u9002\u7528\u4e8e\u4efb\u4f55\u4f1a\u8bdd\u9a8c\u8bc1\u89c6\u56fe\u3002\u8fd9\u610f\u5473\u7740 CSRF \u9a8c\u8bc1\u53ea\u6709\u5728\u5ba2\u6237\u7aef\u901a\u8fc7\u8c03\u7528 `login()` \u767b\u5f55\u540e\u624d\u4f1a\u53d1\u751f\u3002\r\n\r\n---\r\n\r\n# RequestsClient\r\n\r\nREST framework \u8fd8\u5305\u542b\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u7528\u4e8e\u4f7f\u7528\u6d41\u884c\u7684 Python \u5e93 `requests` \u4e0e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u4ea4\u4e92\u3002 \u8fd9\u53ef\u80fd\u662f\u6709\u7528\u7684\uff0c\u5982\u679c\uff1a\r\n\r\n* \u4f60\u671f\u671b\u4e3b\u8981\u4ece\u53e6\u4e00\u4e2a Python \u670d\u52a1\u4e0e API \u8fdb\u884c\u4ea4\u4e92\uff0c\u5e76\u4e14\u5e0c\u671b\u5728\u4e0e\u5ba2\u6237\u7aef\u76f8\u540c\u7684\u7ea7\u522b\u6d4b\u8bd5\u8be5\u670d\u52a1\u3002\r\n* \u4f60\u5e0c\u671b\u4ee5\u8fd9\u6837\u7684\u65b9\u5f0f\u7f16\u5199\u6d4b\u8bd5\uff0c\u4ee5\u4fbf\u5b83\u4eec\u4e5f\u53ef\u4ee5\u5728\u5206\u6bb5\u6216\u5b9e\u65f6\u73af\u5883\u4e2d\u8fd0\u884c\u3002 \r\n\r\n\u5b83\u66b4\u9732\u4e86\u4e0e\u76f4\u63a5\u4f7f\u7528\u8bf7\u6c42\u4f1a\u8bdd\u5b8c\u5168\u76f8\u540c\u7684\u63a5\u53e3\u3002\r\n\r\n``` python\r\nclient = RequestsClient()\r\nresponse = client.get('http://testserver/users/')\r\nassert response.status_code == 200\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0crequests client \u8981\u6c42\u4f60\u4f20\u9012\u5b8c\u5168\u9650\u5b9a\u7684 URL\u3002\r\n\r\n## `RequestsClient` \u4e0e\u6570\u636e\u5e93\u4e00\u8d77\u5de5\u4f5c\r\n\r\n\u5982\u679c\u4f60\u60f3\u7f16\u5199\u4ec5\u4e0e\u670d\u52a1\u63a5\u53e3\u4ea4\u4e92\u7684\u6d4b\u8bd5\uff0c\u5219 `RequestsClient` \u7c7b\u5f88\u6709\u7528\u3002\u8fd9\u6bd4\u4f7f\u7528\u6807\u51c6\u7684 Django \u6d4b\u8bd5\u5ba2\u6237\u7aef\u8981\u4e25\u683c\u4e00\u4e9b\uff0c\u56e0\u4e3a\u8fd9\u610f\u5473\u7740\u6240\u6709\u7684\u4ea4\u4e92\u5fc5\u987b\u901a\u8fc7 API\u3002\r\n\r\n\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f `RequestsClient`\uff0c\u4f60\u9700\u8981\u786e\u4fdd\u6d4b\u8bd5\u8bbe\u7f6e\u548c\u7ed3\u679c\u65ad\u8a00\u4ee5\u5e38\u89c4 API \u8c03\u7528\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4e0e\u6570\u636e\u5e93\u6a21\u578b\u8fdb\u884c\u4ea4\u4e92\u3002\u4f8b\u5982\uff0c\u4e0d\u662f\u68c0\u67e5 `Customer.objects.count() == 3`\uff0c\u800c\u662f\u5217\u51fa customers \u7aef\u70b9\uff0c\u5e76\u786e\u4fdd\u5b83\u5305\u542b\u4e09\u6761\u8bb0\u5f55\u3002\r\n\r\n## Headers & \u8eab\u4efd\u9a8c\u8bc1\r\n\r\n\u81ea\u5b9a\u4e49 header \u548c\u8eab\u4efd\u9a8c\u8bc1\u51ed\u8bc1\u7684\u63d0\u4f9b\u65b9\u5f0f\u4e0e\u4f7f\u7528\u6807\u51c6 `requests.Session` \u5b9e\u4f8b\u65f6\u7684\u65b9\u5f0f\u76f8\u540c\u3002\r\n\r\n``` python\r\nfrom requests.auth import HTTPBasicAuth\r\n\r\nclient.auth = HTTPBasicAuth('user', 'pass')\r\nclient.headers.update({'x-test': 'true'})\r\n```\r\n\r\n## CSRF\r\n\r\n\u5982\u679c\u4f60\u4f7f\u7528 `SessionAuthentication` \uff0c\u90a3\u4e48\u4f60\u9700\u8981\u4e3a `POST`, `PUT`, `PATCH` \u6216 `DELETE` \u8bf7\u6c42\u5305\u542b\u4e00\u4e2a CSRF \u4ee4\u724c\u3002\r\n\r\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u9075\u5faa\u57fa\u4e8e JavaScript \u7684\u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u76f8\u540c\u6d41\u7a0b\u6765\u5b9e\u73b0\u3002\u9996\u5148\u8fdb\u884c `GET` \u8bf7\u6c42\u4ee5\u83b7\u53d6 CRSF \u4ee4\u724c\uff0c\u7136\u540e\u5728\u4ee5\u4e0b\u8bf7\u6c42\u4e2d\u5448\u73b0\u8be5\u4ee4\u724c\u3002\r\n\r\n\u4f8b\u5982...\r\n\r\n``` python\r\nclient = RequestsClient()\r\n\r\n# Obtain a CSRF token.\r\nresponse = client.get('/homepage/')\r\nassert response.status_code == 200\r\ncsrftoken = response.cookies['csrftoken']\r\n\r\n# Interact with the API.\r\nresponse = client.post('/organisations/', json={\r\n    'name': 'MegaCorp',\r\n    'status': 'active'\r\n}, headers={'X-CSRFToken': csrftoken})\r\nassert response.status_code == 200\r\n```\r\n\r\n## Live tests\r\n\r\n\u4f7f\u7528 `RequestsClient` \u548c `CoreAPIClient` \u53ef\u4ee5\u7f16\u5199\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u8fd0\u884c\u7684\u6d4b\u8bd5\u7528\u4f8b\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u6839\u636e\u6d4b\u8bd5\u670d\u52a1\u5668\u6216\u751f\u4ea7\u73af\u5883\u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b\u3002\r\n\r\n\u4f7f\u7528\u8fd9\u79cd\u98ce\u683c\u6765\u521b\u5efa\u51e0\u4e2a\u6838\u5fc3\u529f\u80fd\u7684\u57fa\u672c\u6d4b\u8bd5\u662f\u9a8c\u8bc1\u4f60\u7684\u5b9e\u65f6\u670d\u52a1\u7684\u6709\u6548\u65b9\u6cd5\u3002\u8fd9\u6837\u505a\u53ef\u80fd\u9700\u8981\u4ed4\u7ec6\u6ce8\u610f\u5b89\u88c5\u548c\u5378\u8f7d\uff08setup and teardown\uff09\uff0c\u4ee5\u786e\u4fdd\u6d4b\u8bd5\u7684\u8fd0\u884c\u65b9\u5f0f\u4e0d\u4f1a\u76f4\u63a5\u5f71\u54cd\u5ba2\u6237\u6570\u636e\u3002\r\n\r\n---\r\n\r\n# CoreAPIClient\r\n\r\nCoreAPIClient \u5141\u8bb8\u4f60\u4f7f\u7528 Python `coreapi` \u5ba2\u6237\u7aef\u5e93\u4e0e\u4f60\u7684 API \u8fdb\u884c\u4ea4\u4e92\u3002\r\n\r\n``` python\r\n# Fetch the API schema\r\nclient = CoreAPIClient()\r\nschema = client.get('http://testserver/schema/')\r\n\r\n# Create a new organisation\r\nparams = {'name': 'MegaCorp', 'status': 'active'}\r\nclient.action(schema, ['organisations', 'create'], params)\r\n\r\n# Ensure that the organisation exists in the listing\r\ndata = client.action(schema, ['organisations', 'list'])\r\nassert(len(data) == 1)\r\nassert(data == [{'name': 'MegaCorp', 'status': 'active'}])\r\n```\r\n\r\n## Headers & \u8eab\u4efd\u9a8c\u8bc1\r\n\r\n\u81ea\u5b9a\u4e49 header \u548c\u8eab\u4efd\u9a8c\u8bc1\u53ef\u4ee5\u4e0e `RequestsClient` \u7c7b\u4f3c\u7684\u65b9\u5f0f\u548c `CoreAPIClient` \u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n``` python\r\nfrom requests.auth import HTTPBasicAuth\r\n\r\nclient = CoreAPIClient()\r\nclient.session.auth = HTTPBasicAuth('user', 'pass')\r\nclient.session.headers.update({'x-test': 'true'})\r\n```\r\n\r\n---\r\n\r\n# API Test cases\r\n\r\nREST framework \u5305\u542b\u4ee5\u4e0b\u6d4b\u8bd5\u7528\u4f8b\u7c7b\uff0c\u5b83\u4eec\u7c7b\u4f3c\u73b0\u6709\u7684 Django \u6d4b\u8bd5\u7528\u4f8b\u7c7b\uff0c\u4f46\u4f7f\u7528 `API\u200b\u200bClient` \u800c\u4e0d\u662f Django \u7684\u9ed8\u8ba4 `Client`\u3002\r\n\r\n* `APISimpleTestCase`\r\n* `APITransactionTestCase`\r\n* `APITestCase`\r\n* `APILiveServerTestCase`\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4f60\u53ef\u4ee5\u50cf\u4f7f\u7528\u5e38\u89c4 Django \u6d4b\u8bd5\u7528\u4f8b\u7c7b\u4e00\u6837\u4f7f\u7528\u4efb\u4f55 REST framework \u7684\u6d4b\u8bd5\u7528\u4f8b\u7c7b\u3002 `self.client` \u5c5e\u6027\u5c06\u662f\u4e00\u4e2a `APIClient` \u5b9e\u4f8b\u3002\r\n\r\n``` python\r\nfrom django.urls import reverse\r\nfrom rest_framework import status\r\nfrom rest_framework.test import APITestCase\r\nfrom myproject.apps.core.models import Account\r\n\r\nclass AccountTests(APITestCase):\r\n    def test_create_account(self):\r\n        \"\"\"\r\n        Ensure we can create a new account object.\r\n        \"\"\"\r\n        url = reverse('account-list')\r\n        data = {'name': 'DabApps'}\r\n        response = self.client.post(url, data, format='json')\r\n        self.assertEqual(response.status_code, status.HTTP_201_CREATED)\r\n        self.assertEqual(Account.objects.count(), 1)\r\n        self.assertEqual(Account.objects.get().name, 'DabApps')\r\n```\r\n\r\n---\r\n\r\n# URLPatternsTestCase\r\n\r\nREST framework \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u4e8e\u9694\u79bb\u6bcf\u4e2a\u7c7b\u7684 `urlpatterns` \u7684\u6d4b\u8bd5\u7528\u4f8b\u7c7b\u3002\u8bf7\u6ce8\u610f\uff0c\u5b83\u7ee7\u627f\u81ea Django \u7684 `SimpleTestCase`\uff0c\u5e76\u4e14\u5f88\u53ef\u80fd\u9700\u8981\u4e0e\u53e6\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u7c7b\u6df7\u5408\u4f7f\u7528\u3002\r\n\r\n## \u4f8b\u5982\r\n\r\n``` python\r\nfrom django.urls import include, path, reverse\r\nfrom rest_framework.test import APITestCase, URLPatternsTestCase\r\n\r\n\r\nclass AccountTests(APITestCase, URLPatternsTestCase):\r\n    urlpatterns = [\r\n        path('api/', include('api.urls')),\r\n    ]\r\n\r\n    def test_create_account(self):\r\n        \"\"\"\r\n        Ensure we can create a new account object.\r\n        \"\"\"\r\n        url = reverse('account-list')\r\n        response = self.client.get(url, format='json')\r\n        self.assertEqual(response.status_code, status.HTTP_200_OK)\r\n        self.assertEqual(len(response.data), 1)\r\n```\r\n\r\n---\r\n\r\n# \u6d4b\u8bd5\u54cd\u5e94\r\n\r\n## \u68c0\u67e5\u54cd\u5e94\u6570\u636e\r\n\r\n\u5728\u68c0\u67e5\u6d4b\u8bd5\u54cd\u5e94\u7684\u6709\u6548\u6027\u65f6\uff0c\u68c0\u67e5\u54cd\u5e94\u7684\u521b\u5efa\u6570\u636e\u901a\u5e38\u6bd4\u8f83\u65b9\u4fbf\uff0c\u800c\u4e0d\u662f\u68c0\u67e5\u5b8c\u5168\u6e32\u67d3\u7684\u54cd\u5e94\u3002\r\n\r\n\u4f8b\u5982\uff0c\u68c0\u67e5 `response.data` \u66f4\u5bb9\u6613\uff1a\r\n\r\n``` python\r\nresponse = self.client.get('/users/4/')\r\nself.assertEqual(response.data, {'id': 4, 'username': 'lauren'})\r\n```\r\n\r\n\u800c\u4e0d\u662f\u68c0\u67e5\u89e3\u6790 `response.content` \u7684\u7ed3\u679c\uff1a\r\n\r\n``` python\r\nresponse = self.client.get('/users/4/')\r\nself.assertEqual(json.loads(response.content), {'id': 4, 'username': 'lauren'})\r\n```\r\n\r\n## \u6e32\u67d3\u54cd\u5e94\r\n\r\n\u5982\u679c\u4f60\u4f7f\u7528 `API\u200b\u200bRequestFactory` \u76f4\u63a5\u6d4b\u8bd5\u89c6\u56fe\uff0c\u5219\u8fd4\u56de\u7684\u54cd\u5e94\u5c06\u4e0d\u4f1a\u6e32\u67d3\uff0c\u56e0\u4e3a\u6a21\u677f\u54cd\u5e94\u7684\u6e32\u67d3\u7531 Django \u7684\u5185\u90e8\u8bf7\u6c42 - \u54cd\u5e94\u5faa\u73af\u6267\u884c\u3002\u4e3a\u4e86\u8bbf\u95ee `response.content`\uff0c\u4f60\u9996\u5148\u9700\u8981\u6e32\u67d3\u54cd\u5e94\u3002\r\n\r\n``` python\r\nview = UserDetail.as_view()\r\nrequest = factory.get('/users/4')\r\nresponse = view(request, pk='4')\r\nresponse.render()  # Cannot access `response.content` without this.\r\nself.assertEqual(response.content, '{\"username\": \"lauren\", \"id\": 4}')\r\n```\r\n\r\n---\r\n\r\n# \u914d\u7f6e\r\n\r\n## \u8bbe\u7f6e\u9ed8\u8ba4\u683c\u5f0f\r\n\r\n\u7528\u4e8e\u521b\u5efa\u6d4b\u8bd5\u8bf7\u6c42\u7684\u9ed8\u8ba4\u683c\u5f0f\u53ef\u4ee5\u4f7f\u7528 `TEST_REQUEST_DEFAULT_FORMAT` setting key \u8fdb\u884c\u8bbe\u7f6e\u3002\u4f8b\u5982\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u603b\u662f\u5bf9\u6d4b\u8bd5\u8bf7\u6c42\u4f7f\u7528 JSON \u800c\u4e0d\u662f\u6807\u51c6\u7684 multipart \u8868\u5355\u8bf7\u6c42\uff0c\u8bf7\u5728 `settings.py` \u6587\u4ef6\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u5185\u5bb9\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    ...\r\n    'TEST_REQUEST_DEFAULT_FORMAT': 'json'\r\n}\r\n```\r\n\r\n## \u8bbe\u7f6e\u53ef\u7528\u7684\u683c\u5f0f\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528\u9664 multipart \u6216 json \u8bf7\u6c42\u4e4b\u5916\u7684\u5176\u4ed6\u65b9\u6cd5\u6765\u6d4b\u8bd5\u8bf7\u6c42\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e `TEST_REQUEST_RENDERER_CLASSES` setting \u6765\u5b8c\u6210\u3002\r\n\r\n\u4f8b\u5982\uff0c\u8981\u5728\u6d4b\u8bd5\u8bf7\u6c42\u4e2d\u6dfb\u52a0\u5bf9 `format ='html'` \u7684\u652f\u6301\uff0c\u60a8\u53ef\u80fd\u5728 `settings.py` \u6587\u4ef6\u4e2d\u6709\u8fd9\u6837\u7684\u5185\u5bb9\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    ...\r\n    'TEST_REQUEST_RENDERER_CLASSES': (\r\n        'rest_framework.renderers.MultiPartRenderer',\r\n        'rest_framework.renderers.JSONRenderer',\r\n        'rest_framework.renderers.TemplateHTMLRenderer'\r\n    )\r\n}\r\n```", "md_File": "subject/django-rest-framework-api-guide/testing.md", "create_date": "2020-02-20T13:10:40.848", "order": 26}}, {"model": "subject.chapter", "pk": 166, "fields": {"title": "\u9650\u6d41throttling", "topic": 7, "md5": "e0cefd8d2079ef803aeeb4d4275abb7e", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/throttling/)  \r\n\r\n# \u9650\u6d41\uff08Throttling\uff09\r\n\r\n\r\n\u9650\u6d41\u4e0e\u6743\u9650\u7c7b\u4f3c\uff0c\u56e0\u4e3a\u5b83\u786e\u5b9a\u662f\u5426\u5e94\u8be5\u6388\u6743\u8bf7\u6c42\u3002 \u9650\u6d41\u9600\u6307\u793a\u4e34\u65f6\u72b6\u6001\uff0c\u5e76\u7528\u4e8e\u63a7\u5236\u5ba2\u6237\u7aef\u53ef\u4ee5\u5bf9API\u8fdb\u884c\u7684\u8bf7\u6c42\u901f\u7387\u3002\r\n\r\n\u4e0e\u6743\u9650\u4e00\u6837\uff0c\u53ef\u80fd\u4f1a\u4f7f\u7528\u591a\u79cd\u9650\u6d41\u65b9\u5f0f\u3002\u4f60\u7684 API \u53ef\u80fd\u5bf9\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u8fdb\u884c\u9650\u6d41\uff0c\u5bf9\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u9650\u6d41\u8f83\u5c11\u3002\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u5bf9 API \u7684\u4e0d\u540c\u90e8\u5206\u4f7f\u7528\u4e0d\u540c\u7684\u9650\u6d41\u7b56\u7565\uff0c\u7531\u4e8e\u67d0\u4e9b\u670d\u52a1\u7279\u522b\u5360\u7528\u8d44\u6e90\uff0c\u4f60\u53ef\u80fd\u60f3\u8981\u4f7f\u7528\u540c\u65f6\u6709\u591a\u79cd\u9650\u6d41\u7b56\u7565\u7684\u53e6\u4e00\u79cd\u65b9\u6848\u3002\r\n\r\n\u5982\u679c\u4f60\u60f3\u8981\u540c\u65f6\u5b9e\u73b0\u7206\u53d1\u9650\u6d41\u7387\u548c\u6301\u7eed\u9650\u6d41\u7387\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u9650\u6d41\u9600\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u5c06\u7528\u6237\u9650\u5236\u4e3a\u6bcf\u5206\u949f\u6700\u591a 60 \u4e2a\u8bf7\u6c42\uff0c\u5e76\u4e14\u6bcf\u5929\u6700\u591a 1000 \u4e2a\u8bf7\u6c42\u3002\r\n\r\n\u9650\u6d41\u9600\u4e0d\u4e00\u5b9a\u53ea\u9650\u5236\u8bf7\u6c42\u9891\u7387\u3002\u4f8b\u5982\uff0c\u5b58\u50a8\u670d\u52a1\u53ef\u80fd\u8fd8\u9700\u8981\u5bf9\u5e26\u5bbd\u8fdb\u884c\u9650\u5236\uff0c\u800c\u4ed8\u8d39\u6570\u636e\u670d\u52a1\u53ef\u80fd\u5e0c\u671b\u5bf9\u6b63\u5728\u8bbf\u95ee\u7684\u67d0\u4e9b\u8bb0\u5f55\u8fdb\u884c\u9650\u5236\u3002\r\n\r\n## \u5982\u4f55\u786e\u5b9a\u9650\u6d41\r\n\r\n\u4e0e\u6743\u9650\u548c\u8eab\u4efd\u9a8c\u8bc1\u4e00\u6837\uff0cREST framework \u4e2d\u7684\u9650\u6d41\u59cb\u7ec8\u5b9a\u4e49\u4e3a\u7c7b\u7684\u5217\u8868\u3002\r\n\r\n\u5728\u8fd0\u884c\u89c6\u56fe\u7684\u4e3b\u4f53\u4e4b\u524d\uff0c\u4f1a\u68c0\u67e5\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u9650\u6d41\u9600\u3002\u5982\u679c\u4efb\u4f55\u9650\u6d41\u68c0\u67e5\u5931\u8d25\uff0c\u5c06\u5f15\u53d1\u4e00\u4e2a `exceptions.Throttled` \u5f02\u5e38\uff0c\u5e76\u4e14\u8be5\u89c6\u56fe\u7684\u4e3b\u4f53\u5c06\u4e0d\u4f1a\u518d\u6267\u884c\u3002\r\n\r\n## \u8bbe\u7f6e\u9650\u6d41\u7b56\u7565\r\n\r\n\u53ef\u4ee5\u4f7f\u7528 `DEFAULT_THROTTLE_CLASSES` \u548c `DEFAULT_THROTTLE_RATES` setting \u5168\u5c40\u8bbe\u7f6e\u9ed8\u8ba4\u9650\u6d41\u7b56\u7565\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_THROTTLE_CLASSES': (\r\n        'rest_framework.throttling.AnonRateThrottle',\r\n        'rest_framework.throttling.UserRateThrottle'\r\n    ),\r\n    'DEFAULT_THROTTLE_RATES': {\r\n        'anon': '100/day',\r\n        'user': '1000/day'\r\n    }\r\n}\r\n```\r\n\r\n`DEFAULT_THROTTLE_RATES` \u4e2d\u4f7f\u7528\u7684\u9891\u7387\u63cf\u8ff0\u53ef\u80fd\u5305\u62ec `second`\uff0c`minute` \uff0c`hour` \u6216 `day` \u4f5c\u4e3a\u9650\u6d41\u671f\u3002\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e `APIView` \u7c7b\u7684\u89c6\u56fe\uff0c\u5728\u6bcf\u4e2a\u89c6\u56fe\u6216\u6bcf\u4e2a\u89c6\u56fe\u96c6\u7684\u57fa\u7840\u4e0a\u8bbe\u7f6e\u9650\u6d41\u7b56\u7565\u3002\r\n\r\n``` python\r\nfrom rest_framework.response import Response\r\nfrom rest_framework.throttling import UserRateThrottle\r\nfrom rest_framework.views import APIView\r\n\r\nclass ExampleView(APIView):\r\n    throttle_classes = (UserRateThrottle,)\r\n\r\n    def get(self, request, format=None):\r\n        content = {\r\n            'status': 'request was permitted'\r\n        }\r\n        return Response(content)\r\n```\r\n\r\n\u6216\u8005\u5728\u57fa\u4e8e `@api_view` \u88c5\u9970\u5668\u7684\u51fd\u6570\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u3002\r\n\r\n``` python\r\n@api_view(['GET'])\r\n@throttle_classes([UserRateThrottle])\r\ndef example_view(request, format=None):\r\n    content = {\r\n        'status': 'request was permitted'\r\n    }\r\n    return Response(content)\r\n```\r\n\r\n## \u5982\u4f55\u8bc6\u522b\u5ba2\u6237\u7aef\r\n\r\n`X-Forwarded-For` HTTP header \u548c `REMOTE_ADDR` WSGI \u53d8\u91cf\u7528\u4e8e\u552f\u4e00\u6807\u8bc6\u7528\u4e8e\u9650\u6d41\u7684\u5ba2\u6237\u7aef IP \u5730\u5740\u3002\u5982\u679c\u5b58\u5728 `X-Forwarded-For` header \uff0c\u5219\u4f1a\u4f7f\u7528\u5b83\uff0c\u5426\u5219\u5c06\u4f7f\u7528 WSGI \u73af\u5883\u4e2d\u7684 `REMOTE_ADDR` \u53d8\u91cf\u7684\u503c\u3002\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u4e25\u683c\u6807\u8bc6\u552f\u4e00\u7684\u5ba2\u6237\u7aef IP \u5730\u5740\uff0c\u5219\u9700\u8981\u5148\u901a\u8fc7\u8bbe\u7f6e `NUM_PROXIES` setting \u6765\u914d\u7f6e API \u8fd0\u884c\u7684\u5e94\u7528\u4ee3\u7406\u7684\u6570\u91cf\u3002\u8be5\u8bbe\u7f6e\u5e94\u8be5\u662f\u4e00\u4e2a\u96f6\u6216\u66f4\u5927\u7684\u6574\u6570\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a\u975e\u96f6\uff0c\u5219\u4e00\u65e6\u4efb\u4f55\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7406 IP \u5730\u5740\u9996\u5148\u88ab\u6392\u9664\uff0c\u5ba2\u6237\u7aef IP \u5c06\u88ab\u6807\u8bc6\u4e3a `X-Forwarded-For` header \u4e2d\u7684\u6700\u540e\u4e00\u4e2a IP \u5730\u5740\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a\u96f6\uff0c\u5219 `REMOTE_ADDR` \u503c\u5c06\u59cb\u7ec8\u7528\u4f5c\u8bc6\u522b IP \u5730\u5740\u3002\r\n\r\n\u91cd\u8981\u7684\u662f\u8981\u7406\u89e3\uff0c\u5982\u679c\u4f60\u914d\u7f6e\u4e86 `NUM_PROXIES` \u8bbe\u7f6e\uff0c\u90a3\u4e48\u5728\u4e00\u4e2a\u552f\u4e00\u7684 NAT \u7684\u7f51\u5173\u540e\u9762\u7684\u6240\u6709\u5ba2\u6237\u7aef\u5c06\u88ab\u5f53\u4f5c\u4e00\u4e2a\u5355\u72ec\u7684\u5ba2\u6237\u673a\u6765\u5bf9\u5f85\u3002\r\n\r\n\u5173\u4e8e `X-Forwarded-For` header \u5982\u4f55\u5de5\u4f5c\u4ee5\u53ca\u8bc6\u522b\u8fdc\u7a0b\u5ba2\u6237\u7aef IP \u7684\u66f4\u591a\u5185\u5bb9\u53ef\u4ee5\u5728[\u8fd9\u91cc\u627e\u5230](http://oxpedia.org/wiki/index.php?title=AppSuite:Grizzly#Multiple_Proxies_in_front_of_the_cluster)\u3002\r\n\r\n## \u8bbe\u7f6e\u7f13\u5b58\r\n\r\nREST framework \u63d0\u4f9b\u7684\u9650\u6d41\u7c7b\u4f7f\u7528 Django \u7684\u7f13\u5b58\u540e\u7aef\u3002\u4f60\u5e94\u8be5\u786e\u4fdd\u4f60\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u9002\u5f53\u7684\u7f13\u5b58 setting \u3002\u5bf9\u4e8e\u7b80\u5355\u7684\u8bbe\u7f6e\uff0c`LocMemCache` \u540e\u7aef\u7684\u9ed8\u8ba4\u503c\u5e94\u8be5\u6ca1\u95ee\u9898\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 [Django \u7684\u7f13\u5b58\u6587\u6863](https://docs.djangoproject.com/en/stable/topics/cache/#setting-up-the-cache)\u3002\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528 `'default'` \u4ee5\u5916\u7684\u7f13\u5b58\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u81ea\u5b9a\u4e49\u9650\u6d41\u7c7b\u5e76\u8bbe\u7f6e `cache` \u5c5e\u6027\u6765\u5b9e\u73b0\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass CustomAnonRateThrottle(AnonRateThrottle):\r\n    cache = get_cache('alternate')\r\n```\r\n\r\n\u60a8\u9700\u8981\u8bb0\u4f4f\u8fd8\u8981\u5728 `'DEFAULT_THROTTLE_CLASSES'` settings key \u4e2d\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u9650\u6d41\u7c7b\uff0c\u6216\u8005\u4f7f\u7528 `throttle_classes` \u89c6\u56fe\u5c5e\u6027\u3002\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## AnonRateThrottle\r\n\r\n`AnonRateThrottle` \u5c06\u6c38\u8fdc\u9650\u5236\u672a\u8ba4\u8bc1\u7684\u7528\u6237\u3002\u901a\u8fc7\u4f20\u5165\u8bf7\u6c42\u7684 IP \u5730\u5740\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u5bc6\u94a5\u6765\u8fdb\u884c\u9650\u5236\u3002\r\n\r\n\u5141\u8bb8\u7684\u8bf7\u6c42\u9891\u7387\u7531\u4ee5\u4e0b\u4e4b\u4e00\u51b3\u5b9a\uff08\u6309\u4f18\u5148\u987a\u5e8f\uff09\u3002\r\n\r\n* \u7c7b\u7684 `rate` \u5c5e\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f `AnonRateThrottle` \u5e76\u8bbe\u7f6e\u5c5e\u6027\u6765\u63d0\u4f9b\u3002\r\n* `DEFAULT_THROTTLE_RATES['anon']` \u8bbe\u7f6e.\r\n\r\n\u5982\u679c\u4f60\u60f3\u9650\u5236\u672a\u77e5\u6765\u6e90\u7684\u8bf7\u6c42\u9891\u7387\uff0c`AnonRateThrottle` \u662f\u5408\u9002\u7684\u3002\r\n\r\n## UserRateThrottle\r\n\r\n`UserRateThrottle` \u901a\u8fc7 API \u5c06\u7528\u6237\u8bf7\u6c42\u9650\u5236\u4e3a\u7ed9\u5b9a\u7684\u8bf7\u6c42\u9891\u7387\u3002\u7528\u6237\u6807\u8bc6\u7528\u4e8e\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u5bc6\u94a5\u6765\u52a0\u4ee5\u9650\u5236\u3002\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8bf7\u6c42\u5c06\u56de\u9000\u5230\u4f7f\u7528\u4f20\u5165\u8bf7\u6c42\u7684 IP \u5730\u5740\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u5bc6\u94a5\u6765\u8fdb\u884c\u9650\u5236\u3002\r\n\r\n\u5141\u8bb8\u7684\u8bf7\u6c42\u9891\u7387\u7531\u4ee5\u4e0b\u4e4b\u4e00\u51b3\u5b9a\uff08\u6309\u4f18\u5148\u987a\u5e8f\uff09\u3002\r\n\r\n* \u7c7b\u7684 `rate` \u5c5e\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f `UserRateThrottle` \u5e76\u8bbe\u7f6e\u5c5e\u6027\u6765\u63d0\u4f9b\u3002\r\n* `DEFAULT_THROTTLE_RATES['user']` \u8bbe\u7f6e.\r\n\r\n\u4e00\u4e2a API \u53ef\u80fd\u540c\u65f6\u5177\u6709\u591a\u4e2a `UserRateThrottles`\u3002\u4e3a\u6b64\uff0c\u8bf7\u7ee7\u627f `UserRateThrottle` \u5e76\u4e3a\u6bcf\u4e2a\u7c7b\u8bbe\u7f6e\u4e00\u4e2a\u552f\u4e00\u7684\u201c\u8303\u56f4\u201d\u3002\r\n\r\n\u4f8b\u5982\uff0c\u591a\u4e2a\u7528\u6237\u9650\u6d41\u7387\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4ee5\u4e0b\u7c7b\u6765\u5b9e\u73b0......\r\n\r\n``` python\r\nclass BurstRateThrottle(UserRateThrottle):\r\n    scope = 'burst'\r\n\r\nclass SustainedRateThrottle(UserRateThrottle):\r\n    scope = 'sustained'\r\n```\r\n\r\n...\u548c\u4ee5\u4e0b\u8bbe\u7f6e\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_THROTTLE_CLASSES': (\r\n        'example.throttles.BurstRateThrottle',\r\n        'example.throttles.SustainedRateThrottle'\r\n    ),\r\n    'DEFAULT_THROTTLE_RATES': {\r\n        'burst': '60/min',\r\n        'sustained': '1000/day'\r\n    }\r\n}\r\n```\r\n\r\n\u5982\u679c\u5e0c\u671b\u5bf9\u6bcf\u4e2a\u7528\u6237\u8fdb\u884c\u7b80\u5355\u7684\u5168\u5c40\u901f\u7387\u9650\u5236\uff0c\u90a3\u4e48 `UserRateThrottle` \u662f\u5408\u9002\u7684\u3002\r\n\r\n## ScopedRateThrottle\r\n\r\n`ScopedRateThrottle` \u7c7b\u53ef\u7528\u4e8e\u9650\u5236\u5bf9 API \u7279\u5b9a\u90e8\u5206\u7684\u8bbf\u95ee\u3002\u53ea\u6709\u5f53\u6b63\u5728\u8bbf\u95ee\u7684\u89c6\u56fe\u5305\u542b `.throttle_scope` \u5c5e\u6027\u65f6\u624d\u4f1a\u5e94\u7528\u6b64\u9650\u5236\u3002\u7136\u540e\u901a\u8fc7\u5c06\u8bf7\u6c42\u7684 \u201c\u8303\u56f4\u201d \u4e0e\u552f\u4e00\u7684\u7528\u6237\u6807\u8bc6\u6216 IP \u5730\u5740\u8fde\u63a5\u8d77\u6765\u5f62\u6210\u552f\u4e00\u7684\u9650\u6d41\u5bc6\u94a5\u3002\r\n\r\n\u5141\u8bb8\u7684\u8bf7\u6c42\u9891\u7387\u7531 `DEFAULT_THROTTLE_RATES` setting \u4f7f\u7528\u8bf7\u6c42 \u201c\u8303\u56f4\u201d \u4e2d\u7684\u4e00\u4e2a\u952e\u786e\u5b9a\u3002\r\n\r\n\u4f8b\u5982\uff0c\u7ed9\u51fa\u4ee5\u4e0b\u89c6\u56fe...\r\n\r\n``` python\r\nclass ContactListView(APIView):\r\n    throttle_scope = 'contacts'\r\n    ...\r\n\r\nclass ContactDetailView(APIView):\r\n    throttle_scope = 'contacts'\r\n    ...\r\n\r\nclass UploadView(APIView):\r\n    throttle_scope = 'uploads'\r\n    ...\r\n```\r\n\r\n...\u548c\u4ee5\u4e0b\u8bbe\u7f6e\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_THROTTLE_CLASSES': (\r\n        'rest_framework.throttling.ScopedRateThrottle',\r\n    ),\r\n    'DEFAULT_THROTTLE_RATES': {\r\n        'contacts': '1000/day',\r\n        'uploads': '20/day'\r\n    }\r\n}\r\n```\r\n\r\n\u7528\u6237\u5bf9 `ContactListView` \u6216 `ContactDetailView` \u7684\u8bf7\u6c42\u5c06\u88ab\u9650\u5236\u4e3a\u6bcf\u5929 1000 \u6b21\u3002\u7528\u6237\u5bf9 `UploadView` \u7684\u8bf7\u6c42\u5c06\u88ab\u9650\u5236\u4e3a\u6bcf\u5929 20 \u6b21\u3002\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u9650\u6d41\r\n\r\n\u8981\u81ea\u5b9a\u4e49\u9650\u6d41\uff0c\u8bf7\u7ee7\u627f `BaseThrottle` \u7c7b\u5e76\u5b9e\u73b0 `.allow_request(self, request, view)` \u65b9\u6cd5\u3002\u5982\u679c\u8bf7\u6c42\u88ab\u5141\u8bb8\uff0c\u8be5\u65b9\u6cd5\u5e94\u8be5\u8fd4\u56de `True`\uff0c\u5426\u5219\u8fd4\u56de `False`\u3002\r\n\r\n\u6216\u8005\uff0c\u4f60\u4e5f\u53ef\u4ee5\u91cd\u5199 `.wait()` \u65b9\u6cd5\u3002\u5982\u679c\u5b9e\u73b0\uff0c`.wait()` \u5e94\u8be5\u8fd4\u56de\u5efa\u8bae\u7684\u79d2\u6570\uff0c\u5728\u5c1d\u8bd5\u4e0b\u4e00\u6b21\u8bf7\u6c42\u4e4b\u524d\u7b49\u5f85\uff0c\u6216\u8005\u8fd4\u56de `None`\u3002\u5982\u679c `.allow_request()` \u5148\u524d\u5df2\u7ecf\u8fd4\u56de `False`\uff0c\u5219\u53ea\u4f1a\u8c03\u7528 `.wait()` \u65b9\u6cd5\u3002\r\n\r\n\u5982\u679c `.wait()` \u65b9\u6cd5\u88ab\u5b9e\u73b0\u5e76\u4e14\u8bf7\u6c42\u53d7\u5230\u9650\u5236\uff0c\u90a3\u4e48 `Retry-After` header \u5c06\u5305\u542b\u5728\u54cd\u5e94\u4e2d\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4ee5\u4e0b\u662f\u9650\u6d41\u7684\u4e00\u4e2a\u793a\u4f8b\uff0c\u968f\u673a\u5730\u63a7\u5236\u6bcf 10 \u6b21\u8bf7\u6c42\u4e2d\u7684 1 \u6b21\u3002\r\n\r\n``` python\r\nimport random\r\n\r\nclass RandomRateThrottle(throttling.BaseThrottle):\r\n    def allow_request(self, request, view):\r\n        return random.randint(1, 10) != 1\r\n```\r\n", "md_File": "subject/django-rest-framework-api-guide/throttling.md", "create_date": "2020-02-20T13:10:40.864", "order": 15}}, {"model": "subject.chapter", "pk": 167, "fields": {"title": "\u9a8c\u8bc1\u5668validators", "topic": 7, "md5": "0b9ceca4ac965b44342c19bac6b55144", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/validators/)  \r\n\r\n\r\n# \u9a8c\u8bc1\u5668\r\n\r\n\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u60a8\u5728 REST framework \u4e2d\u5904\u7406\u9a8c\u8bc1\u65f6\uff0c\u53ea\u9700\u4f9d\u8d56\u9ed8\u8ba4\u7684\u5b57\u6bb5\u9a8c\u8bc1\uff0c\u6216\u8005\u5728\u5e8f\u5217\u5316\u7c7b\u6216\u5b57\u6bb5\u7c7b\u4e0a\u7f16\u5199\u660e\u786e\u7684\u9a8c\u8bc1\u65b9\u6cd5\u3002\r\n\r\n\u4f46\u662f\uff0c\u6709\u65f6\u4f60\u4f1a\u5e0c\u671b\u5c06\u9a8c\u8bc1\u903b\u8f91\u653e\u7f6e\u5230\u53ef\u91cd\u7528\u7ec4\u4ef6\u4e2d\uff0c\u4ee5\u4fbf\u5728\u6574\u4e2a\u4ee3\u7801\u5e93\u4e2d\u8f7b\u677e\u5730\u91cd\u7528\u5b83\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u9a8c\u8bc1\u5668\u51fd\u6570\u548c\u9a8c\u8bc1\u5668\u7c7b\u6765\u5b9e\u73b0\u3002\r\n\r\n## REST framework \u4e2d\u7684\u9a8c\u8bc1\r\n\r\nDjango REST framework \u5e8f\u5217\u5316\u5668\u4e2d\u7684\u9a8c\u8bc1\u4e0e Django `ModelForm` \u7c7b\u4e2d\u9a8c\u8bc1\u7684\u5de5\u4f5c\u65b9\u5f0f\u6709\u70b9\u4e0d\u540c\u3002\r\n\r\n\u4f7f\u7528 `ModelForm`\uff0c\u9a8c\u8bc1\u4e00\u90e8\u5206\u5728\u8868\u5355\u4e0a\u6267\u884c\uff0c\u4e00\u90e8\u5206\u5728\u6a21\u578b\u5b9e\u4f8b\u4e0a\u6267\u884c\u3002\u4f7f\u7528 REST framework \uff0c\u9a8c\u8bc1\u5b8c\u5168\u5728\u5e8f\u5217\u5316\u7c7b\u4e0a\u6267\u884c\u3002\u8fd9\u662f\u6709\u4f18\u52bf\u7684\uff0c\u539f\u56e0\u5982\u4e0b\uff1a\r\n\r\n* \u5b83\u4f7f\u95ee\u9898\u9002\u5f53\u7684\u5206\u79bb\uff0c\u8ba9\u4ee3\u7801\u884c\u4e3a\u53d8\u7684\u66f4\u52a0\u6e05\u6670\u3002\r\n* \u4f7f\u7528\u5feb\u6377\u7684 `ModelSerializer` \u7c7b\u548c\u4f7f\u7528\u663e\u5f0f\u7684 `Serializer` \u7c7b\u53ef\u4ee5\u8f7b\u677e\u5207\u6362\u3002\u4efb\u4f55\u7528\u4e8e `ModelSerializer` \u7684\u9a8c\u8bc1\u884c\u4e3a\u90fd\u5f88\u5bb9\u6613\u590d\u5236\u3002\r\n* \u6253\u5370\u5e8f\u5217\u5316\u7c7b\u5b9e\u4f8b\u7684 `repr` \u5c06\u4f1a\u663e\u793a\u5b83\u5e94\u7528\u7684\u9a8c\u8bc1\u89c4\u5219\u3002\u5728\u6a21\u578b\u5b9e\u4f8b\u4e0a\u6ca1\u6709\u989d\u5916\u7684\u9690\u85cf\u9a8c\u8bc1\u884c\u4e3a\uff08\u56e0\u4e3a\u5168\u5728\u5e8f\u5217\u5316\u7c7b\u4e0a\uff09\u3002\r\n\r\n\u5f53\u4f60\u4f7f\u7528 `ModelSerializer` \u65f6\uff0c\u6240\u6709\u9a8c\u8bc1\u90fd\u4f1a\u81ea\u52a8\u4e3a\u4f60\u5904\u7406\u3002\u5982\u679c\u4f60\u60f3\u8981\u6539\u4e3a\u4f7f\u7528 `Serializer` \u7c7b\uff0c\u90a3\u4e48\u4f60\u9700\u8981\u660e\u786e\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u5219\u3002\r\n\r\n#### \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4f5c\u4e3a REST framework \u5982\u4f55\u4f7f\u7528\u663e\u5f0f\u9a8c\u8bc1\u7684\u793a\u4f8b\uff0c\u6211\u4eec\u5c06\u91c7\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u6a21\u578b\u7c7b\uff0c\u8be5\u7c7b\u5177\u6709\u552f\u4e00\u6027\u7ea6\u675f\u7684\u5b57\u6bb5\u3002\r\n\r\n``` python\r\nclass CustomerReportRecord(models.Model):\r\n    time_raised = models.DateTimeField(default=timezone.now, editable=False)\r\n    reference = models.CharField(unique=True, max_length=20)\r\n    description = models.TextField()\r\n```\r\n\r\n\u4e0b\u9762\u662f\u4e00\u4e2a\u57fa\u672c\u7684 `ModelSerializer` \uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u521b\u5efa\u6216\u66f4\u65b0 `CustomerReportRecord` \u7684\u5b9e\u4f8b\uff1a\r\n\r\n``` python\r\nclass CustomerReportSerializer(serializers.ModelSerializer):\r\n    class Meta:\r\n        model = CustomerReportRecord\r\n```\r\n\r\n\u73b0\u5728\u4f7f\u7528 `manage.py shell` \u6253\u5f00 Django shell\r\n\r\n``` python\r\n>>> from project.example.serializers import CustomerReportSerializer\r\n>>> serializer = CustomerReportSerializer()\r\n>>> print(repr(serializer))\r\nCustomerReportSerializer():\r\n    id = IntegerField(label='ID', read_only=True)\r\n    time_raised = DateTimeField(read_only=True)\r\n    reference = CharField(max_length=20, validators=[<UniqueValidator(queryset=CustomerReportRecord.objects.all())>])\r\n    description = CharField(style={'type': 'textarea'})\r\n```\r\n\r\n\u8fd9\u91cc\u6709\u8da3\u7684\u662f `reference` \u5b57\u6bb5\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u552f\u4e00\u6027\u7ea6\u675f\u7531\u5e8f\u5217\u5316\u5b57\u6bb5\u4e0a\u7684\u9a8c\u8bc1\u5668\u660e\u786e\u6267\u884c\u3002\r\n\r\n\u7531\u4e8e\u8fd9\u79cd\u66f4\u660e\u786e\u7684\u98ce\u683c\uff0cREST framework \u5305\u542b\u4e00\u4e9b\u5728\u6838\u5fc3 Django \u4e2d\u6ca1\u6709\u7684\u9a8c\u8bc1\u5668\u7c7b\u3002\u8fd9\u4e9b\u7c7b\u5728\u4e0b\u9762\u8be6\u7ec6\u8bf4\u660e\u3002\r\n\r\n---\r\n\r\n## UniqueValidator\r\n\r\n\u8be5\u9a8c\u8bc1\u5668\u53ef\u7528\u4e8e\u5728\u6a21\u578b\u5b57\u6bb5\u4e0a\u5f3a\u5236\u5b9e\u65bd `unique=True` \u7ea6\u675f\u3002\u5b83\u9700\u8981\u4e00\u4e2a\u5fc5\u9700\u7684\u53c2\u6570\u548c\u4e00\u4e2a\u53ef\u9009\u7684 `messages` \u53c2\u6570\uff1a\r\n\r\n* `queryset` *\u5fc5\u987b* - \u8fd9\u662f\u9a8c\u8bc1\u552f\u4e00\u6027\u7684\u67e5\u8be2\u96c6\u3002\r\n* `message` - \u9a8c\u8bc1\u5931\u8d25\u65f6\u4f7f\u7528\u7684\u9519\u8bef\u6d88\u606f\u3002\r\n* `lookup` - \u7528\u4e8e\u67e5\u627e\u5df2\u9a8c\u8bc1\u503c\u7684\u73b0\u6709\u5b9e\u4f8b\u3002\u9ed8\u8ba4\u4e3a `'exact'`\u3002\r\n\r\n\u8fd9\u4e2a\u9a8c\u8bc1\u5668\u5e94\u8be5\u5e94\u7528\u4e8e\u5e8f\u5217\u5316\u5b57\u6bb5\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nfrom rest_framework.validators import UniqueValidator\r\n\r\nslug = SlugField(\r\n    max_length=100,\r\n    validators=[UniqueValidator(queryset=BlogPost.objects.all())]\r\n)\r\n```\r\n\r\n## UniqueTogetherValidator\r\n\r\n\u6b64\u9a8c\u8bc1\u5668\u53ef\u7528\u4e8e\u5728\u6a21\u578b\u5b9e\u4f8b\u4e0a\u5f3a\u5236\u5b9e\u65bd `unique_together` \u7ea6\u675f\u3002\u5b83\u6709\u4e24\u4e2a\u5fc5\u9700\u7684\u53c2\u6570\u548c\u4e00\u4e2a\u53ef\u9009\u7684 `messages` \u53c2\u6570\uff1a\r\n\r\n* `queryset` *\u5fc5\u987b* - \u8fd9\u662f\u9a8c\u8bc1\u552f\u4e00\u6027\u7684\u67e5\u8be2\u96c6\u3002\r\n* `fields` *\u5fc5\u987b* - \u4e00\u4e2a\u5b58\u653e\u5b57\u6bb5\u540d\u79f0\u7684\u5217\u8868\u6216\u8005\u5143\u7ec4\uff0c\u8fd9\u4e2a\u96c6\u5408\u5fc5\u987b\u662f\u552f\u4e00\u7684\uff08\u610f\u601d\u662f\u96c6\u5408\u4e2d\u7684\u5b57\u6bb5\u4ee3\u8868\u7684\u4e00\u7ec4\u503c\u4e0d\u80fd\u540c\u65f6\u51fa\u73b0\u5728\u4e24\u6761\u6570\u636e\u4e2d\uff09\u3002\u8fd9\u4e9b\u5b57\u6bb5\u5fc5\u987b\u90fd\u662f\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u5b57\u6bb5\u3002\r\n* `message` - \u9a8c\u8bc1\u5931\u8d25\u65f6\u4f7f\u7528\u7684\u9519\u8bef\u6d88\u606f\u3002\r\n\r\n\u9a8c\u8bc1\u5668\u5e94\u8be5\u5e94\u7528\u4e8e\u5e8f\u5217\u5316\u7c7b\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nfrom rest_framework.validators import UniqueTogetherValidator\r\n\r\nclass ExampleSerializer(serializers.Serializer):\r\n    # ...\r\n    class Meta:\r\n        # ToDo items belong to a parent list, and have an ordering defined\r\n        # by the 'position' field. No two items in a given list may share\r\n        # the same position.\r\n        validators = [\r\n            UniqueTogetherValidator(\r\n                queryset=ToDoItem.objects.all(),\r\n                fields=('list', 'position')\r\n            )\r\n        ]\r\n```\r\n\r\n---\r\n\r\n**\u6ce8\u610f**: `UniqueTogetherValidation` \u7c7b\u603b\u662f\u65bd\u52a0\u4e00\u4e2a\u9690\u5f0f\u7ea6\u675f\uff0c\u5373\u5b83\u6240\u5e94\u7528\u7684\u6240\u6709\u5b57\u6bb5\u90fd\u662f\u6309\u9700\u5904\u7406\u7684\u3002\u5177\u6709 `default` \u503c\u7684\u5b57\u6bb5\u662f\u4e00\u4e2a\u4f8b\u5916\uff0c\u56e0\u4e3a\u5b83\u4eec\u603b\u662f\u63d0\u4f9b\u4e00\u4e2a\u503c\uff0c\u5373\u4f7f\u5728\u7528\u6237\u8f93\u5165\u4e2d\u7701\u7565\u4e86\u8fd9\u4e2a\u503c\u3002\r\n\r\n---\r\n\r\n## UniqueForDateValidator\r\n\r\n## UniqueForMonthValidator\r\n\r\n## UniqueForYearValidator\r\n\r\n\u8fd9\u4e9b\u9a8c\u8bc1\u5668\u53ef\u7528\u4e8e\u5f3a\u5236\u5b9e\u65bd\u6a21\u578b\u5b9e\u4f8b\u4e0a\u7684 `unique_for_date`\uff0c`unique_for_month` \u548c `unique_for_year` \u7ea6\u675f\u3002\u4ed6\u4eec\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a\r\n\r\n* `queryset` *\u5fc5\u987b* - \u8fd9\u662f\u9a8c\u8bc1\u552f\u4e00\u6027\u7684\u67e5\u8be2\u96c6\u3002\r\n* `field` *\u5fc5\u987b* - \u5728\u7ed9\u5b9a\u65e5\u671f\u8303\u56f4\u5185\u9700\u8981\u88ab\u9a8c\u8bc1\u552f\u4e00\u6027\u7684\u5b57\u6bb5\u7684\u540d\u79f0\u3002\u8be5\u5b57\u6bb5\u5fc5\u987b\u662f\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u5b57\u6bb5\u3002\r\n* `date_field` *\u5fc5\u987b* - \u5c06\u7528\u4e8e\u786e\u5b9a\u552f\u4e00\u6027\u7ea6\u675f\u7684\u65e5\u671f\u8303\u56f4\u7684\u5b57\u6bb5\u540d\u79f0\u3002\u8be5\u5b57\u6bb5\u5fc5\u987b\u662f\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684\u5b57\u6bb5\u3002\r\n* `message` - \u9a8c\u8bc1\u5931\u8d25\u65f6\u4f7f\u7528\u7684\u9519\u8bef\u6d88\u606f\u3002\r\n\r\n\u9a8c\u8bc1\u5668\u5e94\u8be5\u5e94\u7528\u4e8e\u5e8f\u5217\u5316\u7c7b\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nfrom rest_framework.validators import UniqueForYearValidator\r\n\r\nclass ExampleSerializer(serializers.Serializer):\r\n    # ...\r\n    class Meta:\r\n        # Blog posts should have a slug that is unique for the current year.\r\n        validators = [\r\n            UniqueForYearValidator(\r\n                queryset=BlogPostItem.objects.all(),\r\n                field='slug',\r\n                date_field='published'\r\n            )\r\n        ]\r\n```\r\n\r\n> \u6211\u89e3\u91ca\u4e0b\uff0c\u4e0a\u9762\u4f8b\u5b50\u7684\u610f\u601d\u662f\uff0c\u5728 `published` \u65e5\u671f\u6240\u5728\u7684\u5e74\u4efd\u4e2d\uff0c`slug` \u5b57\u6bb5\u7684\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u6ce8\u610f\uff0c\u4e0d\u662f\u8981\u548c `published` \u5b8c\u5168\u76f8\u7b49\u7684\u65e5\u671f\uff0c\u800c\u662f\u5e74\u4efd\u76f8\u7b49\u3002`unique_for_date`\uff0c`unique_for_month` \u540c\u7406\u3002\r\n\r\n\r\n\u7528\u4e8e\u9a8c\u8bc1\u7684\u65e5\u671f\u5b57\u6bb5\u5e94\u8be5\u59cb\u7ec8\u5b58\u5728\u4e8e\u5e8f\u5217\u5316\u7c7b\u4e2d\u3002\u4f60\u4e0d\u80fd\u7b80\u5355\u5730\u4f9d\u8d56\u6a21\u578b\u7c7b `default=...`\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u503c\u5728\u9a8c\u8bc1\u8fd0\u884c\u4e4b\u540e\u624d\u4f1a\u751f\u6210\u3002\r\n\r\n\u4f60\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u51e0\u79cd\u6837\u5f0f\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u4f60\u5e0c\u671b API \u5982\u4f55\u5c55\u73b0\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f `ModelSerializer` \uff0c\u53ef\u80fd\u53ea\u9700\u4f9d\u8d56 REST framework \u4e3a\u4f60\u751f\u6210\u7684\u9ed8\u8ba4\u503c\uff0c\u4f46\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f `Serializer` \u6216\u9700\u8981\u66f4\u660e\u786e\u7684\u63a7\u5236\uff0c\u8bf7\u4f7f\u7528\u4e0b\u9762\u6f14\u793a\u7684\u6837\u5f0f\u3002\r\n\r\n#### \u4e0e\u53ef\u5199\u65e5\u671f\u5b57\u6bb5\u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n\u5982\u679c\u4f60\u5e0c\u671b\u65e5\u671f\u5b57\u6bb5\u662f\u53ef\u5199\u7684\uff0c\u552f\u4e00\u503c\u5f97\u6ce8\u610f\u7684\u662f\u4f60\u5e94\u8be5\u786e\u4fdd\u5b83\u59cb\u7ec8\u53ef\u7528\u4e8e\u8f93\u5165\u6570\u636e\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e `default` \u53c2\u6570\u6216\u901a\u8fc7\u8bbe\u7f6e `required=True` \u6765\u5b9e\u73b0\u3002\r\n\r\n``` python\r\npublished = serializers.DateTimeField(required=True)\r\n```\r\n\r\n#### \u4e0e\u53ea\u8bfb\u65e5\u671f\u5b57\u6bb5\u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n\u5982\u679c\u4f60\u5e0c\u671b\u65e5\u671f\u5b57\u6bb5\u53ef\u89c1\uff0c\u4f46\u7528\u6237\u65e0\u6cd5\u7f16\u8f91\uff0c\u8bf7\u8bbe\u7f6e `read_only=True` \u5e76\u53e6\u5916\u8bbe\u7f6e `default=...` \u53c2\u6570\u3002\r\n\r\n``` python\r\npublished = serializers.DateTimeField(read_only=True, default=timezone.now)\r\n```\r\n\r\n\u8be5\u5b57\u6bb5\u5bf9\u7528\u6237\u4e0d\u53ef\u5199\uff0c\u4f46\u9ed8\u8ba4\u503c\u4ecd\u5c06\u4f20\u9012\u7ed9 `validated_data`\u3002\r\n\r\n#### \u4e0e\u9690\u85cf\u7684\u65e5\u671f\u5b57\u6bb5\u4e00\u8d77\u4f7f\u7528\u3002\r\n\r\n\u5982\u679c\u4f60\u5e0c\u671b\u65e5\u671f\u5b57\u6bb5\u5bf9\u7528\u6237\u5b8c\u5168\u9690\u85cf\uff0c\u8bf7\u4f7f\u7528 `HiddenField`\u3002\u8be5\u5b57\u6bb5\u7c7b\u578b\u4e0d\u63a5\u53d7\u7528\u6237\u8f93\u5165\uff0c\u800c\u662f\u59cb\u7ec8\u5c06\u5176\u9ed8\u8ba4\u503c\u8fd4\u56de\u5230\u5e8f\u5217\u5316\u7c7b\u4e2d\u7684 `validated_data`\u3002\r\n\r\n``` python\r\npublished = serializers.HiddenField(default=timezone.now)\r\n```\r\n\r\n---\r\n\r\n**\u6ce8\u610f**: `UniqueFor<Range>Validation` \u7c7b\u603b\u662f\u65bd\u52a0\u4e00\u4e2a\u9690\u5f0f\u7ea6\u675f\uff0c\u5373\u5b83\u6240\u5e94\u7528\u7684\u6240\u6709\u5b57\u6bb5\u90fd\u662f\u6309\u9700\u5904\u7406\u7684\u3002\u5177\u6709 `default` \u503c\u7684\u5b57\u6bb5\u662f\u4e00\u4e2a\u4f8b\u5916\uff0c\u56e0\u4e3a\u5b83\u4eec\u603b\u662f\u63d0\u4f9b\u4e00\u4e2a\u503c\uff0c\u5373\u4f7f\u5728\u7528\u6237\u8f93\u5165\u4e2d\u7701\u7565\u4e86\u8fd9\u4e2a\u503c\u3002\r\n\r\n---\r\n\r\n# Advanced field defaults\r\n\r\n\u5728\u5e8f\u5217\u5316\u7c7b\u7684\u591a\u4e2a\u5b57\u6bb5\u4e2d\u5e94\u7528\u7684\u9a8c\u8bc1\u5668\u6709\u65f6\u4e0d\u9700\u8981\u7531 API \u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\u5b57\u6bb5\u8f93\u5165\uff0c\u4f46\u5b83\u53ef\u4ee5\u7528\u4f5c\u9a8c\u8bc1\u5668\u7684\u8f93\u5165\u3002\r\n\r\n\u6709\u4e24\u79cd\u6a21\u5f0f\u53ef\u80fd\u9700\u8981\u8fd9\u79cd\u9a8c\u8bc1\uff1a\r\n\r\n* \u4f7f\u7528 `HiddenField` \u3002\u8be5\u5b57\u6bb5\u5c06\u51fa\u73b0\u5728 `validated_data` \u4e2d\uff0c\u4f46\u4e0d\u4f1a\u7528\u5728\u5e8f\u5217\u5316\u8f93\u51fa\u8868\u793a\u4e2d\u3002\r\n* \u4f7f\u7528 `read_only=True` \u7684\u6807\u51c6\u5b57\u6bb5\uff0c\u540c\u65f6\u4e5f\u5305\u542b `default=...` \u53c2\u6570\u3002\u8be5\u5b57\u6bb5\u5c06\u7528\u4e8e\u5e8f\u5217\u5316\u8f93\u51fa\u8868\u793a\u4e2d\uff0c\u4f46\u4e0d\u80fd\u7531\u7528\u6237\u76f4\u63a5\u8bbe\u7f6e\u3002\r\n\r\nREST framework \u5305\u542b\u4e00\u4e9b\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u80fd\u6709\u7528\u7684\u9ed8\u8ba4\u503c\u3002\r\n\r\n#### CurrentUserDefault\r\n\r\n\u53ef\u7528\u4e8e\u8868\u793a\u5f53\u524d\u7528\u6237\u7684\u9ed8\u8ba4\u7c7b\u3002\u4e3a\u4e86\u4f7f\u7528\u5b83\uff0c\u5728\u5b9e\u4f8b\u5316\u5e8f\u5217\u5316\u7c7b\u65f6\uff0c`'request'` \u5fc5\u987b\u4f5c\u4e3a\u4e0a\u4e0b\u6587\u5b57\u5178\u7684\u4e00\u90e8\u5206\u63d0\u4f9b\u3002\r\n\r\n``` python\r\nowner = serializers.HiddenField(\r\n    default=serializers.CurrentUserDefault()\r\n)\r\n```\r\n\r\n#### CreateOnlyDefault\r\n\r\n\u53ef\u7528\u4e8e\u5728 create \u64cd\u4f5c\u671f\u95f4\u4ec5\u8bbe\u7f6e\u9ed8\u8ba4\u53c2\u6570\u7684\u9ed8\u8ba4\u7c7b\u3002\u5728 update \u671f\u95f4\uff0c\u8be5\u5b57\u6bb5\u88ab\u7701\u7565\u3002\r\n\r\n\u5b83\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u8fd9\u662f\u5728 create \u64cd\u4f5c\u671f\u95f4\u5e94\u8be5\u4f7f\u7528\u7684\u9ed8\u8ba4\u503c\u6216\u53ef\u8c03\u7528\u53c2\u6570\u3002\r\n\r\n``` python\r\ncreated_at = serializers.DateTimeField(\r\n    read_only=True,\r\n    default=serializers.CreateOnlyDefault(timezone.now)\r\n)\r\n```\r\n\r\n---\r\n\r\n# \u9a8c\u8bc1\u5668\u7684\u9650\u5236\r\n\r\n\u6709\u4e00\u4e9b\u4e0d\u660e\u786e\u7684\u60c5\u51b5\uff0c\u4f60\u9700\u8981\u663e\u793a\u5904\u7406\u9a8c\u8bc1\uff0c\u800c\u4e0d\u662f\u4f9d\u8d56 `ModelSerializer` \u751f\u6210\u7684\u9ed8\u8ba4\u5e8f\u5217\u5316\u7c7b\u3002\r\n\r\n\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u901a\u8fc7\u4e3a\u5e8f\u5217\u5316\u7c7b `Meta.validators` \u5c5e\u6027\u6307\u5b9a\u4e00\u4e2a\u7a7a\u5217\u8868\u6765\u7981\u7528\u81ea\u52a8\u751f\u6210\u7684\u9a8c\u8bc1\u5668\u3002\r\n\r\n## \u53ef\u9009\u5b57\u6bb5\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b \"unique together\" \u9a8c\u8bc1\u5f3a\u5236\u6240\u6709\u5b57\u6bb5\u90fd\u662f `required=True`\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u663e\u5f0f\u5c06 `required=False` \u5e94\u7528\u4e8e\u5176\u4e2d\u4e00\u4e2a\u5b57\u6bb5\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9a8c\u8bc1\u6240\u9700\u7684\u884c\u4e3a\u662f\u4e0d\u660e\u786e\u7684\u3002\r\n\r\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u901a\u5e38\u9700\u8981\u4ece\u5e8f\u5217\u5316\u7c7b\u4e2d\u6392\u9664\u9a8c\u8bc1\u5668\uff0c\u5e76\u4e14\u5728 `.validate()` \u65b9\u6cd5\u4e2d\u6216\u5728\u89c6\u56fe\u4e2d\u663e\u5f0f\u5730\u7f16\u5199\u9a8c\u8bc1\u903b\u8f91\u3002\r\n\r\n\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass BillingRecordSerializer(serializers.ModelSerializer):\r\n    def validate(self, data):\r\n        # Apply custom validation either here, or in the view.\r\n\r\n    class Meta:\r\n        fields = ('client', 'date', 'amount')\r\n        extra_kwargs = {'client': {'required': 'False'}}\r\n        validators = []  # Remove a default \"unique together\" constraint.\r\n```\r\n\r\n## \u66f4\u65b0\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\r\n\r\n\u5c06\u66f4\u65b0\u5e94\u7528\u4e8e\u73b0\u6709\u5b9e\u4f8b\u65f6\uff0c\u552f\u4e00\u6027\u9a8c\u8bc1\u5668\u5c06\u4ece\u552f\u4e00\u6027\u68c0\u67e5\u4e2d\u6392\u9664\u5f53\u524d\u5b9e\u4f8b\u3002\u5f53\u524d\u5b9e\u4f8b\u5728\u552f\u4e00\u6027\u68c0\u67e5\u7684\u4e0a\u4e0b\u6587\u4e2d\u53ef\u7528\uff0c\u56e0\u4e3a\u5b83\u4f5c\u4e3a\u5e8f\u5217\u5316\u7a0b\u5e8f\u4e2d\u7684\u4e00\u4e2a\u5c5e\u6027\u5b58\u5728\uff0c\u6700\u521d\u5728\u5b9e\u4f8b\u5316\u5e8f\u5217\u5316\u7c7b\u65f6\u5df2\u4f7f\u7528 `instance=...` \u4f20\u9012\u3002\r\n\r\n\u5728\u5d4c\u5957\u5e8f\u5217\u5316\u7c7b\u4e0a\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u65f6\uff0c\u65e0\u6cd5\u5e94\u7528\u6b64\u6392\u9664\uff0c\u56e0\u4e3a\u8be5\u5b9e\u4f8b\u4e0d\u53ef\u7528\u3002\r\n\r\n\u4f60\u53ef\u80fd\u53c8\u4e00\u6b21\u9700\u8981\u660e\u786e\u5730\u4ece\u5e8f\u5217\u5316\u7c7b\u4e2d\u79fb\u9664\u9a8c\u8bc1\u5668\uff0c\u5e76\u5c06\u9a8c\u8bc1\u7ea6\u675f\u7684\u4ee3\u7801\u663e\u5f0f\u5199\u5165 `.validate()` \u65b9\u6cd5\u6216\u89c6\u56fe\u4e2d\u3002\r\n\r\n## \u8c03\u8bd5\u590d\u6742\u7684\u6848\u4f8b\r\n\r\n\u5982\u679c\u4f60\u4e0d\u786e\u5b9a `ModelSerializer` \u7c7b\u7684\u9ed8\u8ba4\u884c\u4e3a\uff0c\u90a3\u4e48\u8fd0\u884c `manage.py shell` \u5e76\u6253\u5370\u5e8f\u5217\u5316\u7c7b\u5b9e\u4f8b\u901a\u5e38\u662f\u4e00\u4e2a\u597d\u4e3b\u610f\uff0c\u4ee5\u4fbf\u4f60\u53ef\u4ee5\u68c0\u67e5\u5b83\u81ea\u52a8\u751f\u6210\u7684\u5b57\u6bb5\u548c\u9a8c\u8bc1\u5668\u3002\r\n\r\n``` python\r\n>>> serializer = MyComplexModelSerializer()\r\n>>> print(serializer)\r\nclass MyComplexModelSerializer:\r\n    my_fields = ...\r\n```\r\n\r\n\u8fd8\u8981\u8bb0\u4f4f\uff0c\u5728\u590d\u6742\u60c5\u51b5\u4e0b\uff0c\u660e\u786e\u5b9a\u4e49\u5e8f\u5217\u5316\u7c7b\u901a\u5e38\u4f1a\u66f4\u597d\uff0c\u800c\u4e0d\u662f\u4f9d\u8d56\u9ed8\u8ba4\u7684 `ModelSerializer` \u884c\u4e3a\u3002\u867d\u7136\u8fd9\u6837\u4f1a\u5199\u66f4\u591a\u7684\u4ee3\u7801\uff0c\u4f46\u786e\u4fdd\u4e86\u6700\u7ec8\u7684\u884c\u4e3a\u66f4\u52a0\u900f\u660e\u3002\r\n\r\n---\r\n\r\n# \u7f16\u5199\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u5668\r\n\r\n\u4f60\u53ef\u4ee5\u4f7f\u7528 Django \u73b0\u6709\u7684\u9a8c\u8bc1\u5668\uff0c\u4e5f\u53ef\u4ee5\u7f16\u5199\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u5668\u3002\r\n\r\n## \u57fa\u4e8e\u51fd\u6570\r\n\r\n\u9a8c\u8bc1\u5668\u53ef\u4ee5\u662f\u4efb\u4f55\u53ef\u8c03\u7528\u5bf9\u8c61\uff0c\u5728\u5931\u8d25\u65f6\u5f15\u53d1 `serializers.ValidationError`\u3002\r\n\r\n``` python\r\ndef even_number(value):\r\n    if value % 2 != 0:\r\n        raise serializers.ValidationError('This field must be an even number.')\r\n```\r\n\r\n#### \u5b57\u6bb5\u7ea7\u9a8c\u8bc1\r\n\r\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u5411 `Serializer` \u5b50\u7c7b\u6dfb\u52a0 `.validate_<field_name>`\u65b9\u6cd5\u6765\u6307\u5b9a\u81ea\u5b9a\u4e49\u5b57\u6bb5\u7ea7\u9a8c\u8bc1\u3002\r\n\r\n## \u57fa\u4e8e\u7c7b\r\n\r\n\u8981\u7f16\u5199\u4e00\u4e2a\u57fa\u4e8e\u7c7b\u7684\u9a8c\u8bc1\u5668\uff0c\u8bf7\u4f7f\u7528 `__call__` \u65b9\u6cd5\u3002\u57fa\u4e8e\u7c7b\u7684\u9a8c\u8bc1\u5668\u5f88\u6709\u7528\uff0c\u56e0\u4e3a\u5b83\u4eec\u5141\u8bb8\u53c2\u6570\u5316\u548c\u91cd\u7528\u884c\u4e3a\u3002\r\n\r\n``` python\r\nclass MultipleOf(object):\r\n    def __init__(self, base):\r\n        self.base = base\r\n\r\n    def __call__(self, value):\r\n        if value % self.base != 0:\r\n            message = 'This field must be a multiple of %d.' % self.base\r\n            raise serializers.ValidationError(message)\r\n```\r\n\r\n#### \u4f7f\u7528 `set_context()`\r\n\r\n\u5728\u4e00\u4e9b\u9ad8\u7ea7\u7684\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u80fd\u60f3\u8981\u5728\u9a8c\u8bc1\u5668\u4e2d\u83b7\u53d6\u6b63\u5728\u88ab\u9a8c\u8bc1\u7684\u5e8f\u5217\u5316\u5b57\u6bb5\u3002\u8fd9\u65f6\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728\u57fa\u4e8e\u7c7b\u7684\u9a8c\u8bc1\u5668\u4e0a\u58f0\u660e `set_context` \u65b9\u6cd5\u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002\r\n\r\n``` python\r\ndef set_context(self, serializer_field):\r\n    # Determine if this is an update or a create operation.\r\n    # In `__call__` we can then use that information to modify the validation behavior.\r\n    self.is_update = serializer_field.parent.instance is not None\r\n```", "md_File": "subject/django-rest-framework-api-guide/validators.md", "create_date": "2020-02-20T13:10:41.146", "order": 13}}, {"model": "subject.chapter", "pk": 168, "fields": {"title": "\u7248\u672c\u63a7\u5236versioning", "topic": 7, "md5": "974e5aa5bd33c7c902603169d8b37209", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/versioning/)  \r\n\r\n\r\n\r\n\r\n# \u7248\u672c\u63a7\u5236\r\n\r\nAPI \u7248\u672c\u63a7\u5236\u5141\u8bb8\u4f60\u66f4\u6539\u4e0d\u540c\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u884c\u4e3a\u3002 REST framework \u63d0\u4f9b\u4e86\u8bb8\u591a\u4e0d\u540c\u7684\u7248\u672c\u63a7\u5236\u65b9\u6848\u3002\r\n\r\n\u7248\u672c\u63a7\u5236\u7531\u4f20\u5165\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u51b3\u5b9a\uff0c\u53ef\u80fd\u57fa\u4e8e\u8bf7\u6c42 URL \u6216\u8bf7\u6c42 header\u3002\r\n\r\n\u6709\u51e0\u79cd\u6709\u6548\u7684\u65b9\u6cd5\u6765\u5904\u7406\u7248\u672c\u63a7\u5236\u3002\u975e\u7248\u672c\u5316\u7684\u7cfb\u7edf\u4e5f\u53ef\u80fd\u662f\u5408\u9002\u7684\uff0c\u7279\u522b\u662f\u5982\u679c\u4f60\u6b63\u5728\u4e3a\u8d85\u51fa\u63a7\u5236\u8303\u56f4\u7684\u591a\u4e2a\u5ba2\u6237\u7aef\u7684\u975e\u5e38\u957f\u671f\u7684\u7cfb\u7edf\u8fdb\u884c\u5de5\u7a0b\u8bbe\u8ba1\u3002\r\n\r\n## \u4f7f\u7528 REST framework \u8fdb\u884c\u7248\u672c\u63a7\u5236\r\n\r\n\u5f53\u542f\u7528 API \u7248\u672c\u63a7\u5236\u65f6\uff0c `request.version` \u5c5e\u6027\u5c06\u5305\u542b\u4e00\u4e2a\u5bf9\u5e94\u4e8e\u4f20\u5165\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u7248\u672c\u7684\u5b57\u7b26\u4e32\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7248\u672c\u63a7\u5236\u672a\u542f\u7528\uff0c`request.version` \u5c06\u59cb\u7ec8\u8fd4\u56de `None`\u3002\r\n\r\n#### \u57fa\u4e8e\u7248\u672c\u7684\u53d8\u5316\u884c\u4e3a\r\n\r\n\u5982\u4f55\u6539\u53d8 API \u7684\u884c\u4e3a\u53d6\u51b3\u4e8e\u4f60\uff0c\u4f46\u4f60\u53ef\u80fd\u901a\u5e38\u9700\u8981\u7684\u4e00\u4e2a\u793a\u4f8b\u662f\u5728\u65b0\u7248\u672c\u4e2d\u5207\u6362\u5230\u4e0d\u540c\u7684\u5e8f\u5217\u5316\u6837\u5f0f\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\ndef get_serializer_class(self):\r\n    if self.request.version == 'v1':\r\n        return AccountSerializerVersion1\r\n    return AccountSerializer\r\n```\r\n\r\n#### \u53cd\u5411\u89e3\u6790\u7248\u672c\u5316 API \u7684 URL\r\n\r\nREST framework \u5305\u542b\u7684 `reverse` \u51fd\u6570\u4e0e\u7248\u672c\u63a7\u5236\u65b9\u6848\u76f8\u5173\u8054\u3002\u4f60\u9700\u8981\u786e\u4fdd\u5c06\u5f53\u524d\u8bf7\u6c42\u5305\u542b\u4e3a\u5173\u952e\u5b57\u53c2\u6570\uff0c\u5982\u4e0b\u6240\u793a\u3002\r\n\r\n``` python\r\nfrom rest_framework.reverse import reverse\r\n\r\nreverse('bookings-list', request=request)\r\n```\r\n\r\n\u4e0a\u8ff0\u529f\u80fd\u5c06\u5e94\u7528\u9002\u5408\u8bf7\u6c42\u7248\u672c\u7684\u4efb\u4f55 URL \u8f6c\u6362\u3002\u4f8b\u5982\uff1a\r\n\r\n* \u5982\u679c\u6b63\u5728\u4f7f\u7528 `NamespacedVersioning`\uff0c\u5e76\u4e14 API \u7248\u672c\u4e3a 'v1'\uff0c\u5219\u4f7f\u7528\u7684 URL lookup \u5c06\u4e3a `'v1:bookings-list'`\uff0c\u53ef\u80fd\u4f1a\u89e3\u6790\u4e3a\u50cf `http://example.org/v1/bookings/` \u8fd9\u6837\u7684 URL\u3002\r\n* \u5982\u679c\u6b63\u5728\u4f7f\u7528 `QueryParameterVersioning`\uff0c\u5e76\u4e14 API \u7248\u672c\u4e3a `1.0`\uff0c\u5219\u8fd4\u56de\u7684 URL \u53ef\u80fd\u4e0e `http://example.org/bookings/?version=1.0` \u7c7b\u4f3c\r\n\r\n#### \u7248\u672c\u5316\u7684 API \u548c\u8d85\u94fe\u63a5\u5e8f\u5217\u5316\u7c7b\r\n\r\n\u5c06\u8d85\u94fe\u63a5\u5e8f\u5217\u5316\u6837\u5f0f\u4e0e\u57fa\u4e8e URL \u7684\u7248\u672c\u63a7\u5236\u65b9\u6848\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u8bf7\u786e\u4fdd\u5c06\u8bf7\u6c42\u4f5c\u4e3a\u4e0a\u4e0b\u6587\u5305\u542b\u5728\u5e8f\u5217\u5316\u7c7b\u4e2d\u3002\r\n\r\n``` python\r\ndef get(self, request):\r\n    queryset = Booking.objects.all()\r\n    serializer = BookingsSerializer(queryset, many=True, context={'request': request})\r\n    return Response({'all_bookings': serializer.data})\r\n```\r\n\r\n\u8fd9\u6837\u505a\u5c06\u5141\u8bb8\u4efb\u4f55\u8fd4\u56de\u7684 URL \u5305\u542b\u5408\u9002\u7684\u7248\u672c\u3002\r\n\r\n## \u914d\u7f6e\u7248\u672c\u63a7\u5236\u65b9\u6848\r\n\r\n\u7248\u672c\u63a7\u5236\u65b9\u6848\u7531 `DEFAULT_VERSIONING_CLASS` setting key \u5b9a\u4e49\u3002\r\n\r\n``` python\r\nREST_FRAMEWORK = {\r\n    'DEFAULT_VERSIONING_CLASS': 'rest_framework.versioning.NamespaceVersioning'\r\n}\r\n```\r\n\r\n\u9664\u975e\u660e\u786e\u8bbe\u7f6e\uff0c\u5426\u5219 `DEFAULT_VERSIONING_CLASS` \u7684\u503c\u5c06\u4e3a `None`\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c`request.version` \u5c5e\u6027\u5c06\u59cb\u7ec8\u8fd4\u56de `None`\u3002\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u5728\u5355\u200b\u200b\u4e2a\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u7248\u672c\u63a7\u5236\u65b9\u6848\u3002\u901a\u5e38\uff0c\u60a8\u4e0d\u9700\u8981\u8fd9\u6837\u505a\uff0c\u56e0\u4e3a\u5168\u5c40\u4f7f\u7528\u5355\u4e2a\u7248\u672c\u63a7\u5236\u65b9\u6848\u66f4\u6709\u610f\u4e49\u3002\u5982\u679c\u4f60\u786e\u5b9e\u9700\u8981\u8fd9\u6837\u505a\uff0c\u8bf7\u4f7f\u7528 `versioning_class` \u5c5e\u6027\u3002\r\n\r\n``` python\r\nclass ProfileList(APIView):\r\n    versioning_class = versioning.QueryParameterVersioning\r\n```\r\n\r\n#### \u5176\u4ed6\u7248\u672c\u8bbe\u7f6e\r\n\r\n\u4ee5\u4e0b settings key \u4e5f\u7528\u4e8e\u63a7\u5236\u7248\u672c\u63a7\u5236\uff1a\r\n\r\n* `DEFAULT_VERSION`. \u5f53\u6ca1\u6709\u7248\u672c\u4fe1\u606f\u5b58\u5728\u65f6\uff0c\u7528\u4e8e `request.version` \u7684\u503c\u3002\u9ed8\u8ba4\u4e3a `None`\u3002\r\n* `ALLOWED_VERSIONS`. \u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u6b64\u503c\u5c06\u9650\u5236\u7248\u672c\u63a7\u5236\u65b9\u6848\u53ef\u80fd\u8fd4\u56de\u7684\u7248\u672c\u96c6\uff0c\u5982\u679c\u63d0\u4f9b\u7684\u7248\u672c\u4e0d\u5728\u6b64\u96c6\u4e2d\uff0c\u5219\u4f1a\u5f15\u53d1\u9519\u8bef\u3002\u8bf7\u6ce8\u610f\uff0c\u7528\u4e8e `DEFAULT_VERSION` \u8bbe\u7f6e\u7684\u503c\u59cb\u7ec8\u88ab\u8ba4\u4e3a\u662f `ALLOWED_VERSIONS` \u96c6\u7684\u4e00\u90e8\u5206\uff08\u9664\u975e\u5b83\u662f `None`\uff09\u3002\u9ed8\u8ba4\u4e3a `None`\u3002\r\n* `VERSION_PARAM`. \u5e94\u8be5\u7528\u4e8e\u4efb\u4f55\u7248\u672c\u63a7\u5236\u53c2\u6570\u7684\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982\u5a92\u4f53\u7c7b\u578b\u6216 URL \u67e5\u8be2\u53c2\u6570\u3002\u9ed8\u8ba4\u4e3a `'version'`\u3002\r\n\r\n\u4f60\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49\u81ea\u5df1\u7684\u7248\u672c\u63a7\u5236\u65b9\u6848\u5e76\u4f7f\u7528 `default_version`\uff0c`allowed_versions` \u548c `version_param` \u7c7b\u53d8\u91cf\uff0c\u5728\u6bcf\u4e2a\u89c6\u56fe\u6216\u6bcf\u4e2a\u89c6\u56fe\u96c6\u7684\u57fa\u7840\u4e0a\u8bbe\u7f6e\u7248\u672c\u63a7\u5236\u7c7b\u4ee5\u53ca\u8fd9\u4e09\u4e2a\u503c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u60f3\u4f7f\u7528 `URLPathVersioning`\uff1a\r\n\r\n``` python\r\nfrom rest_framework.versioning import URLPathVersioning\r\nfrom rest_framework.views import APIView\r\n\r\nclass ExampleVersioning(URLPathVersioning):\r\n    default_version = ...\r\n    allowed_versions = ...\r\n    version_param = ...\r\n\r\nclass ExampleView(APIVIew):\r\n    versioning_class = ExampleVersioning\r\n```\r\n\r\n---\r\n\r\n# API \u53c2\u8003\r\n\r\n## AcceptHeaderVersioning\r\n\r\n\u6b64\u65b9\u6848\u8981\u6c42\u5ba2\u6237\u7aef\u5c06\u7248\u672c\u6307\u5b9a\u4e3a `Accept` header \u4e2d\u5a92\u4f53\u7c7b\u578b\u7684\u4e00\u90e8\u5206\u3002\u8be5\u7248\u672c\u4f5c\u4e3a\u5a92\u4f53\u7c7b\u578b\u53c2\u6570\u5305\u542b\u5728\u5185\uff0c\u5b83\u8865\u5145\u4e86\u4e3b\u8981\u5a92\u4f53\u7c7b\u578b\u3002\r\n\r\n\u8fd9\u662f\u4e00\u4e2a\u4f7f\u7528 accept header \u7248\u672c\u98ce\u683c\u7684\u793a\u4f8b HTTP \u8bf7\u6c42\u3002\r\n\r\n```\r\nGET /bookings/ HTTP/1.1\r\nHost: example.com\r\nAccept: application/json; version=1.0\r\n```\r\n\r\n\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u8bf7\u6c42\u4e2d `request.version` \u5c5e\u6027\u5c06\u8fd4\u56de\u5b57\u7b26\u4e32 `'1.0'`\u3002\r\n\r\n\u57fa\u4e8e Accept header \u7684\u7248\u672c\u63a7\u5236\u901a\u5e38\u88ab\u8ba4\u4e3a\u662f\u6700\u4f73\u5b9e\u8df5\uff0c\u5c3d\u7ba1\u5176\u4ed6\u6837\u5f0f\u53ef\u80fd\u66f4\u9002\u5408\u4f60\u7684\u5ba2\u6237\u7aef\u9700\u6c42\u3002\r\n\r\n#### \u4f7f\u7528 accept header \u548c vendor media type\r\n\r\n\u4e25\u683c\u5730\u8bf4\uff0c`json` media type \u4e0d\u80fd\u88ab\u6307\u5b9a\u4e3a\u5305\u542b\u9644\u52a0\u53c2\u6570\u3002\u5982\u679c\u4f60\u6b63\u5728\u6784\u5efa\u7cbe\u5fc3\u6307\u5b9a\u7684\u516c\u5171 API\uff0c\u5219\u53ef\u4ee5\u8003\u8651\u4f7f\u7528vendor media type\u3002\u4e3a\u6b64\uff0c\u8bf7\u5c06\u4f60\u7684\u6e32\u67d3\u5668\u914d\u7f6e\u4e3a\u4f7f\u7528\u57fa\u4e8e JSON \u7684\u6e32\u67d3\u5668\u548c\u81ea\u5b9a\u4e49 media type\uff1a\r\n\r\n``` python\r\nclass BookingsAPIRenderer(JSONRenderer):\r\n    media_type = 'application/vnd.megacorp.bookings+json'\r\n```\r\n\r\n\u5ba2\u6237\u7aef\u8bf7\u6c42\u73b0\u5728\u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff1a\r\n\r\n``` python\r\nGET /bookings/ HTTP/1.1\r\nHost: example.com\r\nAccept: application/vnd.megacorp.bookings+json; version=1.0\r\n```\r\n\r\n## URLPathVersioning\r\n\r\n\u8be5\u65b9\u6848\u8981\u6c42\u5ba2\u6237\u7aef\u5c06\u7248\u672c\u6307\u5b9a\u4e3a URL \u8def\u5f84\u7684\u4e00\u90e8\u5206\u3002\r\n\r\n``` python\r\nGET /v1/bookings/ HTTP/1.1\r\nHost: example.com\r\nAccept: application/json\r\n```\r\n\r\n\u4f60\u7684 URL conf \u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u4e0e `'version'` \u5173\u952e\u5b57\u53c2\u6570\u76f8\u5339\u914d\u7684\u6a21\u5f0f\uff0c\u4ee5\u4fbf\u7248\u672c\u63a7\u5236\u65b9\u6848\u53ef\u4ee5\u4f7f\u7528\u6b64\u4fe1\u606f\u3002\r\n\r\n``` python\r\nurlpatterns = [\r\n    url(\r\n        r'^(?P<version>(v1|v2))/bookings/$',\r\n        bookings_list,\r\n        name='bookings-list'\r\n    ),\r\n    url(\r\n        r'^(?P<version>(v1|v2))/bookings/(?P<pk>[0-9]+)/$',\r\n        bookings_detail,\r\n        name='bookings-detail'\r\n    )\r\n]\r\n```\r\n\r\n## NamespaceVersioning\r\n\r\n\u5bf9\u4e8e\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6848\u4e0e `URLPathVersioning` \u76f8\u540c\u3002\u552f\u4e00\u7684\u533a\u522b\u662f\uff0c\u5b83\u662f\u5982\u4f55\u5728 Django \u5e94\u7528\u7a0b\u5e8f\u4e2d\u914d\u7f6e\u7684\uff0c\u56e0\u4e3a\u5b83\u4f7f\u7528 URL \u547d\u540d\u7a7a\u95f4\u800c\u4e0d\u662f URL \u5173\u952e\u5b57\u53c2\u6570\u3002\r\n\r\n```\r\nGET /v1/something/ HTTP/1.1\r\nHost: example.com\r\nAccept: application/json\r\n```\r\n\r\n\u4f7f\u7528\u6b64\u65b9\u6848\uff0c`request.version` \u5c5e\u6027\u662f\u6839\u636e\u4e0e\u4f20\u5165\u8bf7\u6c42\u8def\u5f84\u5339\u914d\u7684 `namespace` \u786e\u5b9a\u7684\u3002\r\n\r\n\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u7ed9\u51fa\u4e86\u4e00\u7ec4\u89c6\u56fe\u4e24\u4e2a\u4e0d\u540c\u7684\u53ef\u80fd\u7684 URL \u524d\u7f00\uff0c\u6bcf\u4e2a\u524d\u7f00\u5728\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e0b\uff1a\r\n\r\n``` python\r\n# bookings/urls.py\r\nurlpatterns = [\r\n    url(r'^$', bookings_list, name='bookings-list'),\r\n    url(r'^(?P<pk>[0-9]+)/$', bookings_detail, name='bookings-detail')\r\n]\r\n\r\n# urls.py\r\nurlpatterns = [\r\n    url(r'^v1/bookings/', include('bookings.urls', namespace='v1')),\r\n    url(r'^v2/bookings/', include('bookings.urls', namespace='v2'))\r\n]\r\n```\r\n\r\n\u5982\u679c\u4f60\u53ea\u9700\u8981\u7b80\u5355\u7684\u7248\u672c\u63a7\u5236\u65b9\u6848\uff0c\u90a3\u4e48 `URLPathVersioning` \u548c `NamespaceVersioning` \u90fd\u662f\u53ef\u4ee5\u7684\u3002 `URLPathVersioning`\u65b9\u6cd5\u53ef\u80fd\u66f4\u9002\u5408\u4e8e\u5c0f\u578b\u9879\u76ee\uff0c`NamespaceVersioning` \u53ef\u80fd\u66f4\u5bb9\u6613\u7ba1\u7406\u5927\u578b\u9879\u76ee\u3002\r\n\r\n## HostNameVersioning\r\n\r\nhostname \u7248\u672c\u63a7\u5236\u65b9\u6848\u8981\u6c42\u5ba2\u6237\u7aef\u5c06\u8bf7\u6c42\u7684\u7248\u672c\u6307\u5b9a\u4e3a URL \u4e2d hostname \u7684\u4e00\u90e8\u5206\u3002\r\n\r\n\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u5bf9 `http://v1.example.com/bookings/` URL \u7684 HTTP \u8bf7\u6c42\uff1a\r\n\r\n```\r\nGET /bookings/ HTTP/1.1\r\nHost: v1.example.com\r\nAccept: application/json \r\n```\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u5b9e\u73b0\u671f\u671b hostname \u5339\u914d\u8fd9\u4e2a\u7b80\u5355\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a\r\n\r\n```\r\n^([a-zA-Z0-9]+)\\.[a-zA-Z0-9]+\\.[a-zA-Z0-9]+$\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u7b2c\u4e00\u7ec4\u7528\u62ec\u53f7\u62ec\u8d77\u6765\uff0c\u8868\u793a\u8fd9\u662f hostname \u7684\u5339\u914d\u90e8\u5206\u3002\r\n\r\n`HostNameVersioning` \u65b9\u6848\u5728\u8c03\u8bd5\u6a21\u5f0f\u4e0b\u53ef\u80fd\u4f1a\u5f88\u7b28\u62d9\uff0c\u56e0\u4e3a\u4f60\u901a\u5e38\u4f1a\u8bbf\u95ee\u8bf8\u5982 `127.0.0.1` \u7684\u539f\u59cb IP \u5730\u5740\u3002\r\n\r\n\u5982\u679c\u4f60\u6709\u8981\u6c42\u6839\u636e\u7248\u672c\u5c06\u4f20\u5165\u8bf7\u6c42\u8def\u7531\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\uff0c\u90a3\u4e48\u57fa\u4e8e hostname \u7684\u7248\u672c\u63a7\u5236\u5c31\u4f1a\u7279\u522b\u6709\u7528\uff0c\u56e0\u4e3a\u4f60\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684 API \u7248\u672c\u914d\u7f6e\u4e0d\u540c\u7684 DNS \u8bb0\u5f55\u3002\r\n\r\n## QueryParameterVersioning\r\n\r\n\u8be5\u65b9\u6848\u662f\u4e00\u79cd\u7b80\u5355\u7684\u98ce\u683c\uff0c\u5176\u4e2d\u5305\u542b\u7248\u672c\u4f5c\u4e3a URL \u4e2d\u7684\u67e5\u8be2\u53c2\u6570\u3002\u4f8b\u5982\uff1a\r\n\r\n```\r\nGET /something/?version=0.1 HTTP/1.1\r\nHost: example.com\r\nAccept: application/json \r\n```\r\n\r\n---\r\n\r\n# \u81ea\u5b9a\u4e49\u7248\u672c\u63a7\u5236\u65b9\u6848\r\n\r\n\u8981\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7248\u672c\u63a7\u5236\u65b9\u6848\uff0c\u8bf7\u7ee7\u627f `BaseVersioning`\u5e76\u8986\u76d6 `.determine_version` \u65b9\u6cd5\u3002\r\n\r\n## \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u4ee5\u4e0b\u793a\u4f8b\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684 `X-API-Version` header \u6765\u786e\u5b9a\u6240\u8bf7\u6c42\u7684\u7248\u672c\u3002\r\n\r\n``` python\r\nclass XAPIVersionScheme(versioning.BaseVersioning):\r\n    def determine_version(self, request, *args, **kwargs):\r\n        return request.META.get('HTTP_X_API_VERSION', None)\r\n```\r\n\r\n\u5982\u679c\u4f60\u7684\u7248\u672c\u63a7\u5236\u65b9\u6848\u57fa\u4e8e\u8bf7\u6c42 URL\uff0c\u5219\u8fd8\u9700\u8981\u66f4\u6539\u7248\u672c\u5316 URL \u7684\u786e\u5b9a\u65b9\u5f0f\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u4f60\u5e94\u8be5\u91cd\u5199\u7c7b\u7684 `.reverse()`\u65b9\u6cd5\u3002\u6709\u5173\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605\u6e90\u4ee3\u7801\u3002\r\n", "md_File": "subject/django-rest-framework-api-guide/versioning.md", "create_date": "2020-02-20T13:10:41.182", "order": 18}}, {"model": "subject.chapter", "pk": 169, "fields": {"title": "\u89c6\u56fe\u96c6viewsets", "topic": 7, "md5": "0a886266c17c793a290a23c8c49c3e84", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/viewsets/)\r\n\r\n## \u89c6\u56fe\u96c6\r\n\r\n> \u5728\u8def\u7531\u51b3\u5b9a\u4e86\u54ea\u4e2a\u63a7\u5236\u5668\u7528\u4e8e\u8bf7\u6c42\u540e\uff0c\u63a7\u5236\u5668\u8d1f\u8d23\u7406\u89e3\u8bf7\u6c42\u5e76\u4ea7\u751f\u9002\u5f53\u7684\u8f93\u51fa\u3002     \r\n> \u2014 *Ruby on Rails \u6587\u6863*\r\n\r\nDjango REST framework \u5141\u8bb8\u5c06\u4e00\u7ec4\u76f8\u5173\u89c6\u56fe\u7684\u903b\u8f91\u7ec4\u5408\u5230\u4e00\u4e2a\u79f0\u4e3a `ViewSet` \u7684\u7c7b\u4e2d\u3002\u5728\u5176\u4ed6\u6846\u67b6\u4e2d\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u6982\u5ff5\u4e0a\u7c7b\u4f3c\u7684\u5b9e\u73b0\uff0c\u540d\u4e3a \u201cResources\u201d \u6216 \u201cControllers\u201d \u3002\r\n\r\n`ViewSet` \u7c7b\u53ea\u662f\u4e00\u79cd\u57fa\u4e8e\u7c7b\u7684 View\uff0c\u5b83\u4e0d\u63d0\u4f9b\u4efb\u4f55\u5904\u7406\u65b9\u6cd5\uff0c\u5982 `.get()` \u6216 `.post()`\uff0c\u800c\u662f\u63d0\u4f9b\u8bf8\u5982  `.list()` \u548c `.create()` \u4e4b\u7c7b\u7684\u64cd\u4f5c\u3002\r\n\r\n`ViewSet` \u53ea\u5728\u7528 `.as_view()` \u65b9\u6cd5\u7ed1\u5b9a\u5230\u6700\u7ec8\u5316\u89c6\u56fe\u65f6\u505a\u4e00\u4e9b\u76f8\u5e94\u64cd\u4f5c\u3002\r\n\r\n\u901a\u5e38\uff0c\u4e0d\u662f\u5728 urlconf \u4e2d\u7684\u89c6\u56fe\u96c6\u4e2d\u660e\u786e\u6ce8\u518c\u89c6\u56fe\uff0c\u800c\u662f\u4f7f\u7528\u8def\u7531\u5668\u7c7b\u6ce8\u518c\u89c6\u56fe\u96c6\uff0c\u8fd9\u4f1a\u81ea\u52a8\u4e3a\u60a8\u786e\u5b9a urlconf\u3002\r\n\r\n### \u4e3e\u4e2a\u6817\u5b50\r\n\r\n\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684\u89c6\u56fe\u96c6\uff0c\u53ef\u4ee5\u7528\u6765\u5217\u51fa\u6216\u68c0\u7d22\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u7528\u6237\u3002  \r\n\r\n``` python\r\nfrom django.contrib.auth.models import User\r\nfrom django.shortcuts import get_object_or_404\r\nfrom myapps.serializers import UserSerializer\r\nfrom rest_framework import viewsets\r\nfrom rest_framework.response import Response\r\n\r\nclass UserViewSet(viewsets.ViewSet):\r\n\r\n    def list(self, request):\r\n        queryset = User.objects.all()\r\n        serializer = UserSerializer(queryset, many=True)\r\n        return Response(serializer.data)\r\n\r\n    def retrieve(self, request, pk=None):\r\n        queryset = User.objects.all()\r\n        user = get_object_or_404(queryset, pk=pk)\r\n        serializer = UserSerializer(user)\r\n        return Response(serializer.data)\r\n```\r\n\r\n\u5982\u679c\u9700\u8981\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u89c6\u56fe\u96c6\u5408\u6210\u4e24\u4e2a\u5355\u72ec\u7684\u89c6\u56fe\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nuser_list = UserViewSet.as_view({'get': 'list'})\r\nuser_detail = UserViewSet.as_view({'get': 'retrieve'})\r\n```\r\n\r\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4e0d\u4f1a\u8fd9\u6837\u505a\uff0c\u800c\u662f\u7528\u8def\u7531\u5668\u6ce8\u518c\u89c6\u56fe\u96c6\uff0c\u5e76\u5141\u8bb8\u81ea\u52a8\u751f\u6210 urlconf\u3002\r\n\r\n``` python\r\nfrom myapp.views import UserViewSet\r\nfrom rest_framework.routers import DefaultRouter\r\n\r\nrouter = DefaultRouter()\r\nrouter.register(r'users', UserViewSet, base_name='user')\r\nurlpatterns = router.urls\r\n```\r\n\r\n\u4e0d\u7528\u81ea\u5df1\u7f16\u5199\u89c6\u56fe\u96c6\uff0c\u901a\u5e38\u4f7f\u7528\u9ed8\u8ba4\u63d0\u4f9b\u7684\u73b0\u6709\u57fa\u7c7b\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass UserViewSet(viewsets.ModelViewSet):\r\n    \"\"\"\r\n    \u7528\u4e8e\u67e5\u770b\u548c\u7f16\u8f91\u7528\u6237\u5b9e\u4f8b\u7684\u89c6\u56fe\u3002\r\n    \"\"\"\r\n    serializer_class = UserSerializer\r\n    queryset = User.objects.all()\r\n```\r\n\r\n\u4f7f\u7528 `ViewSet` \u7c7b\u6bd4\u4f7f\u7528 View \u7c7b\u6709\u4e24\u4e2a\u4e3b\u8981\u4f18\u70b9\u3002\r\n\r\n * \u91cd\u590d\u7684\u903b\u8f91\u53ef\u4ee5\u5408\u5e76\u6210\u4e00\u4e2a\u7c7b\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6307\u5b9a\u4e00\u6b21\u67e5\u8be2\u96c6\uff0c\u5b83\u5c06\u5728\u591a\u4e2a\u89c6\u56fe\u4e2d\u4f7f\u7528\u3002\r\n * \u901a\u8fc7\u4f7f\u7528 routers\uff0c\u6211\u4eec\u4e0d\u518d\u9700\u8981\u5904\u7406\u81ea\u5df1\u7684 URL \u914d\u7f6e\u3002\r\n\r\n\u8fd9\u4e24\u8005\u5404\u6709\u4f18\u7f3a\u70b9\u3002\u4f7f\u7528\u5e38\u89c4\u89c6\u56fe\u548c URL \u914d\u7f6e\u6587\u4ef6\u66f4\u52a0\u660e\u786e\uff0c\u5e76\u4e3a\u60a8\u63d0\u4f9b\u66f4\u591a\u63a7\u5236\u3002\u5982\u679c\u60f3\u8981\u66f4\u5feb\u901f\u7684\u5f00\u53d1\u51fa\u4e00\u4e2a\u5e94\u7528\uff0c\u6216\u8005\u9700\u8981\u4f7f\u5927\u578b API \u7684 URL \u914d\u7f6e\u59cb\u7ec8\u4fdd\u6301\u4e00\u81f4\uff0c\u89c6\u56fe\u96c6\u4f1a\u975e\u5e38\u6709\u7528\u3002\r\n\r\n### \u64cd\u4f5c\u89c6\u56fe\u96c6\r\n\r\nREST framework \u4e2d\u5305\u542b\u7684\u9ed8\u8ba4 routes  \u5c06\u4e3a\u4e00\u7ec4\u6807\u51c6\u7684  create / retrieve / update / destroy  \u98ce\u683c action \u63d0\u4f9b\u8def\u7531\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\nclass UserViewSet(viewsets.ViewSet):\r\n    \"\"\"\r\n    \u8fd9\u4e9b\u65b9\u6cd5\u5c06\u7531\u8def\u7531\u5668\u8d1f\u8d23\u5904\u7406\u3002\r\n\r\n    \u5982\u679c\u8981\u4f7f\u7528\u540e\u7f00\uff0c\u8bf7\u786e\u4fdd\u52a0\u4e0a `format = None` \u5173\u952e\u5b57\u53c2\u6570\r\n    \"\"\"\r\n\r\n    def list(self, request):\r\n        pass\r\n\r\n    def create(self, request):\r\n        pass\r\n\r\n    def retrieve(self, request, pk=None):\r\n        pass\r\n\r\n    def update(self, request, pk=None):\r\n        pass\r\n\r\n    def partial_update(self, request, pk=None):\r\n        pass\r\n\r\n    def destroy(self, request, pk=None):\r\n        pass\r\n```\r\n\r\n\u5728\u8c03\u5ea6\u671f\u95f4\uff0c\u5f53\u524d action \u7684\u540d\u79f0\u53ef\u4ee5\u901a\u8fc7 `.action` \u5c5e\u6027\u83b7\u5f97\u3002\u60a8\u53ef\u4ee5\u68c0\u67e5 `.action` \u4ee5\u6839\u636e\u5f53\u524d action \u8c03\u6574\u884c\u4e3a\u3002\r\n\r\n\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5c06\u6743\u9650\u9650\u5236\u4e3a\u53ea\u6709 admin \u624d\u80fd\u8bbf\u95ee `list` \u4ee5\u5916\u7684\u5176\u4ed6 action\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\ndef get_permissions(self):\r\n    \"\"\"\r\n    \u5b9e\u4f8b\u5316\u5e76\u8fd4\u56de\u6b64\u89c6\u56fe\u6240\u9700\u7684\u6743\u9650\u5217\u8868\u3002\r\n    \"\"\"\r\n    if self.action == 'list':\r\n        permission_classes = [IsAuthenticated]\r\n    else:\r\n        permission_classes = [IsAdmin]\r\n    return [permission() for permission in permission_classes]\r\n```\r\n\r\n### \u6807\u8bb0\u989d\u5916\u7684\u8def\u7531\u884c\u4e3a\r\n\r\n\u5982\u679c\u9700\u8981\u8def\u7531\u7279\u5b9a\u65b9\u6cd5\uff0c\u5219\u53ef\u4ee5\u7528 `@detail_route` \u6216 `@list_route` \u88c5\u9970\u5668\u8fdb\u884c\u4fee\u9970\u3002\r\n\r\n`@detail_route` \u88c5\u9970\u5668\u5728\u5176 URL \u6a21\u5f0f\u4e2d\u5305\u542b `pk`\uff0c\u7528\u4e8e\u652f\u6301\u9700\u8981\u83b7\u53d6\u5355\u4e2a\u5b9e\u4f8b\u7684\u65b9\u6cd5\u3002`@list_route` \u4fee\u9970\u5668\u9002\u7528\u4e8e\u5728\u5bf9\u8c61\u5217\u8868\u4e0a\u64cd\u4f5c\u7684\u65b9\u6cd5\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n``` python\r\nfrom django.contrib.auth.models import User\r\nfrom rest_framework import status\r\nfrom rest_framework import viewsets\r\nfrom rest_framework.decorators import detail_route, list_route\r\nfrom rest_framework.response import Response\r\nfrom myapp.serializers import UserSerializer, PasswordSerializer\r\n\r\nclass UserViewSet(viewsets.ModelViewSet):\r\n    \"\"\"\r\n    \u63d0\u4f9b\u6807\u51c6\u64cd\u4f5c\u7684\u89c6\u56fe\u96c6\r\n    \"\"\"\r\n    queryset = User.objects.all()\r\n    serializer_class = UserSerializer\r\n\r\n    @detail_route(methods=['post'])\r\n    def set_password(self, request, pk=None):\r\n        user = self.get_object()\r\n        serializer = PasswordSerializer(data=request.data)\r\n        if serializer.is_valid():\r\n            user.set_password(serializer.data['password'])\r\n            user.save()\r\n            return Response({'status': 'password set'})\r\n        else:\r\n            return Response(serializer.errors,\r\n                            status=status.HTTP_400_BAD_REQUEST)\r\n\r\n    @list_route()\r\n    def recent_users(self, request):\r\n        recent_users = User.objects.all().order('-last_login')\r\n\r\n        page = self.paginate_queryset(recent_users)\r\n        if page is not None:\r\n            serializer = self.get_serializer(page, many=True)\r\n            return self.get_paginated_response(serializer.data)\r\n\r\n        serializer = self.get_serializer(recent_users, many=True)\r\n        return Response(serializer.data)\r\n```\r\n\r\n\u53e6\u5916\uff0c\u88c5\u9970\u5668\u53ef\u4ee5\u4e3a\u8def\u7531\u89c6\u56fe\u8bbe\u7f6e\u989d\u5916\u7684\u53c2\u6570\u3002\u4f8b\u5982...\r\n\r\n``` python\r\n    @detail_route(methods=['post'], permission_classes=[IsAdminOrIsSelf])\r\n    def set_password(self, request, pk=None):\r\n       ...\r\n```\r\n\r\n\u8fd9\u4e9b\u88c5\u9970\u5668\u9ed8\u8ba4\u8def\u7531 `GET` \u8bf7\u6c42\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4f7f\u7528 `methods` \u53c2\u6570\u63a5\u53d7\u5176\u4ed6 HTTP \u65b9\u6cd5\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\n    @detail_route(methods=['post', 'delete'])\r\n    def unset_password(self, request, pk=None):\r\n       ...\r\n```\r\n\r\n\u8fd9\u4e24\u4e2a\u65b0\u64cd\u4f5c\u5c06\u5728 urls  `^users/{pk}/set_password/$` \u548c `^users/{pk}/unset_password/$` \u4e0a\u3002\r\n\r\n### action \u8df3\u8f6c\r\n\r\n\u5982\u679c\u4f60\u9700\u8981\u83b7\u53d6 action \u7684 URL \uff0c\u8bf7\u4f7f\u7528 `.reverse_action()` \u65b9\u6cd5\u3002\u8fd9\u662f `.reverse()` \u7684\u4e00\u4e2a\u4fbf\u6377\u5305\u88c5\uff0c\u5b83\u4f1a\u81ea\u52a8\u4f20\u9012\u89c6\u56fe\u7684\u8bf7\u6c42\u5bf9\u8c61\uff0c\u5e76\u5c06 `url_name` \u4e0e `.basename` \u5c5e\u6027\u6302\u63a5\u3002\r\n\r\n\u8bf7\u6ce8\u610f\uff0c`basename` \u662f\u5728 `ViewSet` \u6ce8\u518c\u8fc7\u7a0b\u4e2d\u7531\u8def\u7531\u5668\u63d0\u4f9b\u7684\u3002\u5982\u679c\u60a8\u4e0d\u4f7f\u7528\u8def\u7531\u5668\uff0c\u5219\u5fc5\u987b\u63d0\u4f9b`.as_view()` \u65b9\u6cd5\u7684 `basename` \u53c2\u6570\u3002\r\n\r\n\u4f7f\u7528\u4e0a\u4e00\u8282\u4e2d\u7684\u793a\u4f8b\uff1a\r\n\r\n``` python\r\n>>> view.reverse_action('set-password', args=['1'])\r\n'http://localhost:8000/api/users/1/set_password'\r\n```\r\n\r\n`url_name` \u53c2\u6570\u5e94\u8be5\u4e0e `@list_route` \u548c `@detail_route` \u88c5\u9970\u5668\u7684\u76f8\u540c\u53c2\u6570\u5339\u914d\u3002\u53e6\u5916\uff0c\u8fd9\u53ef\u4ee5\u7528\u6765\u53cd\u8f6c\u9ed8\u8ba4 `list` \u548c `detail` \u8def\u7531\u3002\r\n\r\n\r\n## API \u53c2\u8003\r\n\r\n\r\n### ViewSet\r\n\r\n`ViewSet` \u7c7b\u7ee7\u627f\u81ea `APIView`\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u6807\u51c6\u5c5e\u6027\uff08\u5982 `permission_classes`\uff0c`authentication_classes`\uff09\u6765\u63a7\u5236\u89c6\u56fe\u4e0a\u7684 API \u7b56\u7565\u3002\r\n\r\n`ViewSet` \u7c7b\u4e0d\u63d0\u4f9b\u4efb\u4f55 action \u7684\u5b9e\u73b0\u3002\u4e3a\u4e86\u4f7f\u7528 `ViewSet` \u7c7b\uff0c\u5fc5\u987b\u7ee7\u627f\u8be5\u7c7b\u5e76\u660e\u786e\u5b9a\u4e49 action \u5b9e\u73b0\u3002\r\n\r\n### GenericViewSet\r\n\r\n`GenericViewSet` \u7c7b\u7ee7\u627f\u81ea `GenericAPIView`\uff0c\u5e76\u63d0\u4f9b\u9ed8\u8ba4\u7684 `get_object`\uff0c`get_queryset` \u65b9\u6cd5\u548c\u5176\u4ed6\u901a\u7528\u89c6\u56fe\u57fa\u7840\u884c\u4e3a\uff0c\u4f46\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u5305\u542b\u4efb\u4f55\u64cd\u4f5c\u3002\r\n\r\n\u4e3a\u4e86\u4f7f\u7528 `GenericViewSet` \u7c7b\uff0c\u5fc5\u987b\u7ee7\u627f\u8be5\u7c7b\u5e76\u6df7\u5408\u6240\u9700\u7684 mixin \u7c7b\uff0c\u6216\u660e\u786e\u5b9a\u4e49\u64cd\u4f5c\u5b9e\u73b0\u3002\r\n\r\n### ModelViewSet\r\n\r\n`ModelViewSet` \u7c7b\u7ee7\u627f\u81ea `GenericAPIView`\uff0c\u5e76\u901a\u8fc7\u6df7\u5408\u5404\u79cd mixin \u7c7b\u7684\u884c\u4e3a\u6765\u5305\u542b\u5404\u79cd\u64cd\u4f5c\u7684\u5b9e\u73b0\u3002\r\n\r\n`ModelViewSet` \u63d0\u4f9b\u7684\u64cd\u4f5c\u6709 `.list()` , `.retrieve()` , `.create()` , `.update()` , `.partial_update()`, \u548c `.destroy()` \u3002\r\n\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n\u7531\u4e8e `ModelViewSet` \u7c7b\u7ee7\u627f\u81ea `GenericAPIView`\uff0c\u56e0\u6b64\u901a\u5e38\u9700\u8981\u63d0\u4f9b\u81f3\u5c11 `queryset` \u548c `serializer_class` \u5c5e\u6027\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass AccountViewSet(viewsets.ModelViewSet):\r\n    \"\"\"\r\n    \u7528\u4e8e\u67e5\u770b\u548c\u7f16\u8f91 Account\r\n    \"\"\"\r\n    queryset = Account.objects.all()\r\n    serializer_class = AccountSerializer\r\n    permission_classes = [IsAccountAdminOrReadOnly]\r\n```\r\n\r\n\u8bf7\u6ce8\u610f\uff0c\u60a8\u53ef\u4ee5\u8986\u76d6 `GenericAPIView` \u63d0\u4f9b\u7684\u4efb\u4f55\u6807\u51c6\u5c5e\u6027\u6216\u65b9\u6cd5\u3002\u4f8b\u5982\uff0c\u8981\u52a8\u6001\u786e\u5b9a\u5b83\u5e94\u8be5\u64cd\u4f5c\u7684\u67e5\u8be2\u96c6\u7684`ViewSet`\uff0c\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a\r\n\r\n``` python\r\nclass AccountViewSet(viewsets.ModelViewSet):\r\n    \"\"\"\r\n    A simple ViewSet for viewing and editing the accounts\r\n    associated with the user.\r\n    \"\"\"\r\n    serializer_class = AccountSerializer\r\n    permission_classes = [IsAccountAdminOrReadOnly]\r\n\r\n    def get_queryset(self):\r\n        return self.request.user.accounts.all()\r\n```\r\n\r\n\r\n\u4f46\u8bf7\u6ce8\u610f\uff0c\u4ece `ViewSet` \u4e2d\u5220\u9664 `queryset` \u5c5e\u6027\u540e\uff0c\u4efb\u4f55\u5173\u8054\u7684 router \u5c06\u65e0\u6cd5\u81ea\u52a8\u5bfc\u51fa\u6a21\u578b\u7684 `base_name`\uff0c\u56e0\u6b64\u60a8\u5fc5\u987b\u5c06 `base_name` kwarg \u6307\u5b9a\u4e3a router \u6ce8\u518c\u7684\u4e00\u90e8\u5206\u3002\r\n\r\n\u8fd8\u8981\u6ce8\u610f\uff0c\u867d\u7136\u8fd9\u4e2a\u7c7b\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u5b8c\u6574\u7684  create / list / retrieve / update / destroy  \u64cd\u4f5c\u96c6\uff0c\u4f46\u60a8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u6807\u51c6\u6743\u9650\u7c7b\u6765\u9650\u5236\u53ef\u7528\u64cd\u4f5c\u3002\r\n\r\n\r\n### ReadOnlyModelViewSet\r\n\r\n `ReadOnlyModelViewSet` \u7c7b\u4e5f\u4ece `GenericAPIView` \u7ee7\u627f\u3002\u4e0e `ModelViewSet` \u4e00\u6837\uff0c\u5b83\u4e5f\u5305\u542b\u5404\u79cd\u64cd\u4f5c\u7684\u5b9e\u73b0\uff0c\u4f46\u4e0e `ModelViewSet` \u4e0d\u540c\u7684\u662f\u5b83\u53ea\u63d0\u4f9b \u201c\u53ea\u8bfb\u201d \u64cd\u4f5c\uff0c`.list()` \u548c `.retrieve()`\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n\u4e0e `ModelViewSet` \u4e00\u6837\uff0c\u60a8\u901a\u5e38\u9700\u8981\u63d0\u4f9b\u81f3\u5c11 `queryset` \u548c `serializer_class` \u5c5e\u6027\u3002\u4f8b\u5982\uff1a\r\n\r\n``` python\r\nclass AccountViewSet(viewsets.ReadOnlyModelViewSet):\r\n    \"\"\"\r\n    A simple ViewSet for viewing accounts.\r\n    \"\"\"\r\n    queryset = Account.objects.all()\r\n    serializer_class = AccountSerializer\r\n```\r\n\r\n\u540c\u6837\uff0c\u4e0e `ModelViewSet` \u4e00\u6837\uff0c\u60a8\u53ef\u4ee5\u8986\u76d6`GenericAPIView` \u53ef\u7528\u7684\u4efb\u4f55\u6807\u51c6\u5c5e\u6027\u548c\u65b9\u6cd5\u3002\r\n\r\n\r\n## \u81ea\u5b9a\u4e49\u89c6\u56fe\u96c6\u57fa\u7c7b\r\n\r\n\r\n\u60a8\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u6ca1\u6709\u5b8c\u6574 `ModelViewSet` \u64cd\u4f5c\u96c6\u7684\u81ea\u5b9a\u4e49 `ViewSet` \u7c7b\uff0c\u6216\u5176\u4ed6\u81ea\u5b9a\u4e49\u884c\u4e3a\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n\r\n\u8981\u521b\u5efa\u63d0\u4f9b `create`\uff0c `list` \u548c `retrieve` \u64cd\u4f5c\u7684\u57fa\u672c\u89c6\u56fe\u96c6\u7c7b\uff0c\u8bf7\u4ece `GenericViewSet` \u7ee7\u627f\uff0c\u5e76\u6df7\u5408\uff08mixin \uff09\u6240\u9700\u7684\u64cd\u4f5c\uff1a\r\n\r\n``` python\r\nfrom rest_framework import mixins\r\n\r\nclass CreateListRetrieveViewSet(mixins.CreateModelMixin,\r\n                                mixins.ListModelMixin,\r\n                                mixins.RetrieveModelMixin,\r\n                                viewsets.GenericViewSet):\r\n    \"\"\"\r\n    A viewset that provides `retrieve`, `create`, and `list` actions.\r\n\r\n    To use it, override the class and set the `.queryset` and\r\n    `.serializer_class` attributes.\r\n    \"\"\"\r\n    pass\r\n```\r\n\r\n\u901a\u8fc7\u521b\u5efa\u81ea\u5df1\u7684\u57fa\u672c `ViewSet` \u7c7b\uff0c\u80fd\u591f\u63d0\u4f9b\u53ef\u5728 API \u4e2d\u7684\u591a\u4e2a\u89c6\u56fe\u96c6\u4e2d\u91cd\u7528\u7684\u5e38\u89c1\u884c\u4e3a\u3002", "md_File": "subject/django-rest-framework-api-guide/viewsets.md", "create_date": "2020-02-20T13:10:41.245", "order": 5}}, {"model": "subject.chapter", "pk": 170, "fields": {"title": "\u89c6\u56feviews", "topic": 7, "md5": "59f1caac56a33abd60608c55dba9f281", "md_body": "> [\u5b98\u65b9\u539f\u6587\u94fe\u63a5](http://www.django-rest-framework.org/api-guide/views/)\r\n\r\n## \u57fa\u4e8e\u7c7b\u7684\u89c6\u56fe\r\n\r\nREST framework  \u63d0\u4f9b\u4e86\u4e00\u4e2a `APIView` \u7c7b\uff0c\u5b83\u7ee7\u627f\u4e8e Django \u7684 `View` \u7c7b\u3002\r\n\r\n`APIView` \u7c7b\u4e0e\u4e0d\u540c\u7684 `View` \u7c7b\u6709\u6240\u4e0d\u540c\uff1a  \r\n\r\n* \u4f20\u9012\u7ed9\u5904\u7406\u65b9\u6cd5\u7684 request \u5bf9\u8c61\u662f REST framework \u7684 `Request` \u5b9e\u4f8b\uff0c\u800c\u4e0d\u662f Django \u7684 `HttpRequest` \u5b9e\u4f8b\u3002\r\n* \u5904\u7406\u65b9\u6cd5\u53ef\u80fd\u8fd4\u56de REST framework \u7684 `Response`\uff0c\u800c\u4e0d\u662f Django \u7684 `HttpResponse` \u3002\u8be5\u89c6\u56fe\u5c06\u7ba1\u7406\u5185\u5bb9\u534f\u5546\uff0c\u5e76\u5728\u54cd\u5e94\u4e2d\u8bbe\u7f6e\u6b63\u786e\u7684\u6e32\u67d3\u5668\u3002\r\n* \u4efb\u4f55 `APIException` \u5f02\u5e38\u90fd\u4f1a\u88ab\u6355\u83b7\u5e76\u8fdb\u884c\u9002\u5f53\u7684\u54cd\u5e94\u3002\r\n* \u4f20\u5165\u7684\u8bf7\u6c42\u4f1a\u8fdb\u884c\u8ba4\u8bc1\uff0c\u5728\u8bf7\u6c42\u5206\u6d3e\u7ed9\u5904\u7406\u65b9\u6cd5\u4e4b\u524d\u5c06\u8fdb\u884c\u9002\u5f53\u7684\u6743\u9650\u68c0\u67e5\uff08\u5141\u8bb8\u6216\u9650\u5236\uff09\u3002\r\n\r\n\r\n\u50cf\u5f80\u5e38\u4e00\u6837\uff0c\u4f7f\u7528 `API\u200b\u200bView` \u7c7b\u4e0e\u4f7f\u7528\u5e38\u89c4 `View` \u7c7b\u975e\u5e38\u76f8\u4f3c\uff0c\u4f20\u5165\u7684\u8bf7\u6c42\u88ab\u5206\u6d3e\u5230\u9002\u5f53\u7684\u5904\u7406\u65b9\u6cd5\uff0c\u5982 `.get()` \u6216`.post()`\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u5728\u7c7b\u4e0a\u8bbe\u7f6e\u8bb8\u591a\u5c5e\u6027\uff08AOP\uff09\u3002\r\n\r\n\u4e3e\u4e2a\u6817\u5b50\uff1a\r\n``` python\r\nfrom rest_framework.views import APIView\r\nfrom rest_framework.response import Response\r\nfrom rest_framework import authentication, permissions\r\nfrom django.contrib.auth.models import User\r\n\r\nclass ListUsers(APIView):\r\n    \"\"\"\r\n    \u5217\u51fa\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u7528\u6237\r\n\r\n    * \u9700\u8981 token \u8ba4\u8bc1\u3002\r\n    * \u53ea\u6709 admin \u7528\u6237\u624d\u80fd\u8bbf\u95ee\u6b64\u89c6\u56fe\u3002\r\n    \"\"\"\r\n    authentication_classes = (authentication.TokenAuthentication,)\r\n    permission_classes = (permissions.IsAdminUser,)\r\n\r\n    def get(self, request, format=None):\r\n        \"\"\"\r\n        Return a list of all users.\r\n        \"\"\"\r\n        usernames = [user.username for user in User.objects.all()]\r\n        return Response(usernames)\r\n```\r\n\r\n> \u6ce8\u610f\uff1aREST Framework \u4e2d\u7684 `APIView`\uff0c`GenericAPIView`\uff0c\u5404\u79cd `Mixins` \u548c `Viewsets` \u5305\u542b\u8bb8\u591a\u65b9\u6cd5\u548c\u5c5e\u6027\uff0c\u521a\u5f00\u59cb\u8981\u5168\u90e8\u7406\u89e3\u662f\u6bd4\u8f83\u56f0\u96be\u7684\u3002\u8fd9\u91cc\u9664\u4e86\u6587\u6863\uff0c\u6709\u4e00\u4e2a [Classy Django REST Framework](http://www.cdrf.co/) \u8d44\u6e90\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4ee5\u5728\u7ebf\u6d4f\u89c8\u7684\u53c2\u7167\uff0c\u5305\u542b\u6240\u6709\u5c5e\u6027\u548c\u65b9\u6cd5\u3002\r\n\r\n### API \u7b56\u7565\u5c5e\u6027\uff08policy attributes\uff09\r\n\r\n\u4ee5\u4e0b\u5c5e\u6027\u7528\u4e8e\u589e\u52a0\u6269\u5c55\u89c6\u56fe\u7684\u529f\u80fd\uff0cAOP\u3002\r\n\r\n.renderer_classes  \r\n\u8bbe\u7f6e\u6e32\u67d3\u5668\r\n\r\n.parser_classes  \r\n\u8bbe\u7f6e\u89e3\u6790\u5668\r\n\r\n.authentication_classes  \r\n\u8bbe\u7f6e\u8ba4\u8bc1\u5668\r\n\r\n.throttle_classes\r\n\r\n.permission_classes  \r\n\u8bbe\u7f6e\u6743\u9650\u9a8c\u8bc1\u5668\r\n\r\n.content_negotiation_class\r\n\r\n### API \u7b56\u7565\u5b9e\u4f8b\u65b9\u6cd5\uff08policy instantiation methods\uff09\r\n\r\n\u4ee5\u4e0b\u7b56\u7565\u5b9e\u4f8b\u65b9\u6cd5\u901a\u5e38\u4e0d\u9700\u8981\u6211\u4eec\u91cd\u5199\u3002\r\n\r\n.get_renderers(self)\r\n\r\n.get_parsers(self)\r\n\r\n.get_authenticators(self)\r\n\r\n.get_throttles(self)\r\n\r\n.get_permissions(self)\r\n\r\n.get_content_negotiator(self)\r\n\r\n.get_exception_handler(self)\r\n\r\n\r\n### API \u7b56\u7565\u5b9e\u73b0\u65b9\u6cd5\uff08policy implementation methods\uff09\r\n\r\n\u5728\u5206\u6d3e\u5230\u5904\u7406\u65b9\u6cd5\u4e4b\u524d\u4f1a\u8c03\u7528\u4ee5\u4e0b\u65b9\u6cd5\u3002\r\n\r\n.check_permissions(self, request)\r\n\r\n.check_throttles(self, request)\r\n\r\n.perform_content_negotiation(self, request, force=False)\r\n\r\n\r\n### \u65b9\u6cd5\u8c03\u5ea6\r\n\r\n\u4ee5\u4e0b\u65b9\u6cd5\u7531\u89c6\u56fe\u7684 `.dispatch()` \u65b9\u6cd5\u76f4\u63a5\u8c03\u7528\u3002\u5b83\u4eec\u5728\u8c03\u7528\u5904\u7406\u65b9\u6cd5\uff08`.get()`, `.post()`, `put()`, `patch()` \u548c `.delete()`\uff09\u4e4b\u524d\u6216\u8005\u4e4b\u540e\u88ab\u8c03\u7528\u3002\r\n\r\n**.initial(self, request, \\*args, \\*\\*kwargs)**\r\n\r\n\u7528\u4e8e\u6267\u884c\u5904\u7406\u65b9\u6cd5\u88ab\u8c03\u7528\u4e4b\u524d\u9700\u8981\u7684\u4efb\u4f55\u64cd\u4f5c\u3002\u6b64\u65b9\u6cd5\u7528\u4e8e\u5f3a\u5236\u6267\u884c\u6743\u9650\u548c\u9650\u6d41\uff0c\u5e76\u6267\u884c\u5185\u5bb9\u534f\u5546\u3002\r\n\r\n**.handle_exception(self, exc)**\r\n\r\n\u5904\u7406\u65b9\u6cd5\u629b\u51fa\u7684\u4efb\u4f55\u5f02\u5e38\u90fd\u5c06\u4f20\u9012\u7ed9\u6b64\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a `Response` \u5b9e\u4f8b\uff0c\u6216\u8005\u91cd\u65b0\u5f15\u53d1\u5f02\u5e38\u3002\r\n\r\n\u9ed8\u8ba4\u5b9e\u73b0\u5904\u7406 `rest_framework.exceptions.APIException` \u7684\u4efb\u4f55\u5b50\u7c7b\uff0c\u4ee5\u53ca Django \u7684 `Http404` \u548c`PermissionDenied` \u5f02\u5e38\uff0c\u5e76\u8fd4\u56de\u76f8\u5e94\u7684\u9519\u8bef\u54cd\u5e94\u3002\r\n\r\n\u5982\u679c\u9700\u8981\u81ea\u5b9a\u4e49 API \u8fd4\u56de\u7684\u9519\u8bef\u54cd\u5e94\uff0c\u5e94\u8be5\u91cd\u5199\u6b64\u65b9\u6cd5\u3002\r\n\r\n\r\n**.initialize_request(self, request, \\*args, \\*\\*kwargs)**\r\n\r\n\u786e\u4fdd\u4f20\u9012\u7ed9\u5904\u7406\u65b9\u6cd5\u7684\u8bf7\u6c42\u5bf9\u8c61\u662f `Request` \u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u800c\u4e0d\u662f\u901a\u5e38\u7684 Django `HttpRequest`\u3002\r\n\r\n\u901a\u5e38\u4e0d\u9700\u8981\u91cd\u5199\u6b64\u65b9\u6cd5\u3002\r\n\r\n**.finalize_response(self, request, response, \\*args, \\*\\*kwargs)**\r\n\r\n\u786e\u4fdd\u4ece\u5904\u7406\u65b9\u6cd5\u8fd4\u56de\u7684\u4efb\u4f55 `Response` \u5bf9\u8c61\u5c06\u88ab\u5448\u73b0\u4e3a\u6b63\u786e\u7684\u5185\u5bb9\u7c7b\u578b\uff0c\u8fd9\u7531\u5185\u5bb9\u534f\u5546\u786e\u5b9a\u3002\r\n\r\n\u901a\u5e38\u4e0d\u9700\u8981\u91cd\u5199\u6b64\u65b9\u6cd5\u3002\r\n\r\n\r\n\r\n## \u57fa\u4e8e\u65b9\u6cd5\u7684\u89c6\u56fe\r\n\r\nREST framework \u4e5f\u5141\u8bb8\u4f7f\u7528\u57fa\u4e8e\u51fd\u6570\u7684\u89c6\u56fe\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u5957\u7b80\u5355\u7684\u88c5\u9970\u5668\u6765\u5305\u88c5\u4f60\u7684\u51fd\u6570\u89c6\u56fe\uff0c\u4ee5\u786e\u4fdd\u5b83\u4eec\u63a5\u6536 `Request`\uff08\u800c\u4e0d\u662f Django `HttpRequest`\uff09\u5b9e\u4f8b\u5e76\u5141\u8bb8\u5b83\u4eec\u8fd4\u56de `Response`\uff08\u800c\u4e0d\u662f Django `HttpResponse`\uff09\uff0c\u5e76\u5141\u8bb8\u4f60\u914d\u7f6e\u8be5\u8bf7\u6c42\u7684\u5904\u7406\u65b9\u5f0f\u3002\r\n\r\n### @api_view()\r\n\r\n\u7b7e\u540d\uff1a`@api_view(http_method_names=['GET'])`\r\n\r\n`api_view` \u662f\u4e00\u4e2a\u88c5\u9970\u5668\uff0c\u7528 `http_method_names` \u6765\u8bbe\u7f6e\u89c6\u56fe\u5141\u8bb8\u54cd\u5e94\u7684 HTTP \u65b9\u6cd5\u5217\u8868\uff0c\u4e3e\u4e2a\u6817\u5b50\uff0c\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u89c6\u56fe\uff0c\u624b\u52a8\u8fd4\u56de\u4e00\u4e9b\u6570\u636e\u3002\r\n\r\n``` python\r\nfrom rest_framework.decorators import api_view\r\n\r\n@api_view()\r\ndef hello_world(request):\r\n    return Response({\"message\": \"Hello, world!\"})\r\n```\r\n\r\n\u8be5\u89c6\u56fe\u5c06\u4f7f\u7528 `settings` \u4e2d\u6307\u5b9a\u7684\u9ed8\u8ba4\u6e32\u67d3\u5668\uff0c\u89e3\u6790\u5668\uff0c\u8ba4\u8bc1\u7c7b\u7b49\u3002\r\n\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709 `GET` \u65b9\u6cd5\u4f1a\u88ab\u63a5\u53d7\u3002\u5176\u4ed6\u65b9\u6cd5\u5c06\u4ee5 `\"405 Method Not Allowed\"` \u8fdb\u884c\u54cd\u5e94\u3002\u8981\u6539\u53d8\u8fd9\u79cd\u884c\u4e3a\uff0c\u8bf7\u6307\u5b9a\u89c6\u56fe\u5141\u8bb8\u7684\u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a\r\n\r\n``` python\r\n@api_view(['GET', 'POST'])\r\ndef hello_world(request):\r\n    if request.method == 'POST':\r\n        return Response({\"message\": \"Got some data!\", \"data\": request.data})\r\n    return Response({\"message\": \"Hello, world!\"})\r\n```\r\n\r\n\r\n### API \u7b56\u7565\u88c5\u9970\u5668 (policy decorators)\r\n\r\n\u4e3a\u4e86\u8986\u76d6\u9ed8\u8ba4\u8bbe\u7f6e\uff0cREST framework \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u53ef\u4ee5\u6dfb\u52a0\u5230\u89c6\u56fe\u4e2d\u7684\u9644\u52a0\u88c5\u9970\u5668\u3002\u8fd9\u4e9b\u5fc5\u987b\u5728 `@api_view` \u88c5\u9970\u5668\u4e4b\u540e\uff08\u4e0b\u65b9\uff09\u3002\u4f8b\u5982\uff0c\u8981\u521b\u5efa\u4e00\u4e2a\u4f7f\u7528 `throttle` \u6765\u786e\u4fdd\u5b83\u6bcf\u5929\u53ea\u80fd\u7531\u7279\u5b9a\u7528\u6237\u8c03\u7528\u4e00\u6b21\u7684\u89c6\u56fe\uff0c\u8bf7\u4f7f\u7528 `@throttle_classes` \u88c5\u9970\u5668\uff0c\u4f20\u9012\u4e00\u4e2a `throttle` \u7c7b\u5217\u8868\uff1a\r\n\r\n``` python\r\nfrom rest_framework.decorators import api_view, throttle_classes\r\nfrom rest_framework.throttling import UserRateThrottle\r\n\r\nclass OncePerDayUserThrottle(UserRateThrottle):\r\n        rate = '1/day'\r\n\r\n@api_view(['GET'])\r\n@throttle_classes([OncePerDayUserThrottle])\r\ndef view(request):\r\n    return Response({\"message\": \"Hello for today! See you tomorrow!\"})\r\n```\r\n\r\n\u8fd9\u4e9b\u88c5\u9970\u5668\u5bf9\u5e94\u4e8e `APIView` \u4e0a\u8bbe\u7f6e\u7684\u7b56\u7565\u5c5e\u6027\u3002\r\n\r\n\u53ef\u7528\u7684\u88c5\u9970\u5668\u6709\uff1a\r\n\r\n * `@renderer_classes(...)`\r\n * `@parser_classes(...)`\r\n * `@authentication_classes(...)`\r\n * `@throttle_classes(...)`\r\n * `@permission_classes(...)`\r\n\r\n\r\n\u6bcf\u4e2a\u88c5\u9970\u5668\u90fd\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u5b83\u5fc5\u987b\u662f\u4e00\u4e2a\u7c7b\u5217\u8868\u6216\u8005\u4e00\u4e2a\u7c7b\u5143\u7ec4\u3002\r\n\r\n\r\n### View schema \u88c5\u9970\u5668\r\n\r\n\u8981\u8986\u76d6\u51fd\u6570\u89c6\u56fe\u7684\u9ed8\u8ba4 \u6a21\u5f0f\u751f\u6210\uff08schema generation\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 `@schema` \u88c5\u9970\u5668\u3002\u8fd9\u5fc5\u987b\u5728 `@api_view` \u88c5\u9970\u5668\u4e4b\u540e\uff08\u4e0b\u65b9\uff09\u3002\u4f8b\u5982\uff1a\r\n``` python\r\nfrom rest_framework.decorators import api_view, schema\r\nfrom rest_framework.schemas import AutoSchema\r\n\r\nclass CustomAutoSchema(AutoSchema):\r\n    def get_link(self, path, method, base_url):\r\n        # override view introspection here...\r\n\r\n@api_view(['GET'])\r\n@schema(CustomAutoSchema())\r\ndef view(request):\r\n    return Response({\"message\": \"Hello for today! See you tomorrow!\"})\r\n```\r\n\r\n\u8be5\u88c5\u9970\u5668\u5c06\u91c7\u7528\u4e00\u4e2a `AutoSchema` \u5b9e\u4f8b\uff0c\u4e00\u4e2a `AutoSchema` \u5b50\u7c7b\u5b9e\u4f8b\u6216 `ManualSchema` \u5b9e\u4f8b\uff0c\u5982[ Schemas \u6587\u6863](http://www.django-rest-framework.org/api-guide/schemas/)\uff08\u5148\u653e\u5b98\u94fe\uff09\u4e2d\u6240\u8ff0\u3002\u60a8\u4e5f\u53ef\u4ee5\u4f20 `None` \u4ee5\u4ece \u6a21\u5f0f\u751f\u6210\uff08schema generation\uff09 \u4e2d\u6392\u9664\u89c6\u56fe\u3002\r\n\r\n``` python\r\n@api_view(['GET'])\r\n@schema(None)\r\ndef view(request):\r\n    return Response({\"message\": \"Will not appear in schema!\"})\r\n```\r\n", "md_File": "subject/django-rest-framework-api-guide/views.md", "create_date": "2020-02-20T13:10:41.486", "order": 3}}, {"model": "info.info", "pk": 1, "fields": {"title": "about", "body": "<p>:::&nbsp;hljs-center</p>\r\n\r\n<p><br />\r\n<br />\r\n&nbsp;</p>\r\n\r\n<p>#&nbsp;\u5173\u4e8e\u672c\u7ad9</p>\r\n\r\n<p><br />\r\n<br />\r\n&nbsp;</p>\r\n\r\n<p>:::</p>\r\n\r\n<p><br />\r\n<br />\r\n&nbsp;</p>\r\n\r\n<p>&gt;&nbsp;\u672c\u7ad9\u662f\u7528django\u5f00\u53d1\u7684\u524d\u540e\u7aef\u5206\u79bb\u7684\u535a\u5ba2\uff0c\u57fa\u672c\u6837\u5f0f\u6a21\u4eff\u4e86\u6398\u91d1\u7b49\u7ad9\uff0c\u524d\u7aefvue\u5168\u5bb6\u6876\uff0cui\u6846\u67b6iview\uff0c\u540e\u7aefdrf\u5f00\u53d1api</p>\r\n\r\n<p><br />\r\n<br />\r\n&nbsp;</p>\r\n\r\n<p>:::&nbsp;hljs-center</p>\r\n\r\n<p><br />\r\n<br />\r\n&nbsp;</p>\r\n\r\n<p>&lt;font&nbsp;color=deeppink&nbsp;size=32&nbsp;face=&quot;\u6977\u4f53&quot;&gt;\u5b66\u4e60\u4f7f\u6211\u5feb\u4e50&lt;/font&gt;</p>\r\n\r\n<p>&nbsp;</p>\r\n\r\n<p>&lt;font&nbsp;color=#39b2a4&nbsp;size=32&nbsp;face=&quot;\u6977\u4f53&quot;&gt;\u8fdb\u6b65\u8ba9\u6211\u6109\u60a6&lt;/font&gt;</p>\r\n\r\n<p><br />\r\n<br />\r\n<br />\r\n<br />\r\n&nbsp;</p>\r\n\r\n<p>:::</p>", "body_md": "::: hljs-center\r\n\r\n\r\n\r\n# \u5173\u4e8e\u672c\u7ad9\r\n\r\n\r\n\r\n:::\r\n\r\n\r\n\r\n> \u672c\u7ad9\u662f\u7528django\u5f00\u53d1\u7684\u524d\u540e\u7aef\u5206\u79bb\u7684\u535a\u5ba2\uff0c\u57fa\u672c\u6837\u5f0f\u6a21\u4eff\u4e86\u6398\u91d1\u7b49\u7ad9\uff0c\u524d\u7aefvue\u5168\u5bb6\u6876\uff0cui\u6846\u67b6iview\uff0c\u540e\u7aefdrf\u5f00\u53d1api\r\n\r\n\r\n\r\n::: hljs-center\r\n\r\n\r\n\r\n<font color=deeppink size=32 face=\"\u6977\u4f53\">\u5b66\u4e60\u4f7f\u6211\u5feb\u4e50</font>\r\n\r\n<font color=#39b2a4 size=32 face=\"\u6977\u4f53\">\u8fdb\u6b65\u8ba9\u6211\u6109\u60a6</font>\r\n\r\n\r\n\r\n\r\n\r\n:::", "create_date": "2020-02-08T23:05:46.458", "mod_date": "2020-02-08T23:05:46.458"}}, {"model": "info.info", "pk": 2, "fields": {"title": "version", "body": "", "body_md": "## version 2.0.1\r\n\r\n1. \u8868\u683c\u6587\u5b57\u5927\u5c0f\u56fa\u5b9a\u621012\r\n\r\n2. \u76ee\u5f55\u9ad8\u5ea6\u8bbe\u5b9a\u6210\u5c4f\u5e55\u89c6\u7a97\u768480\uff08vh\uff09\r\n\r\n3. \u5f52\u6863\u529f\u80fd\u9875\u7684\u6807\u7b7e\u589e\u52a0\u76ee\u5f55\u529f\u80fd\r\n\r\n4. reset\u6837\u5f0f\u6539\u53d8\uff08\u53d6\u6d88li\u6837\u5f0fnone\uff09\r\n\r\n\r\n\r\n## version 2.0.2\r\n\r\n1. \u4e0a\u7ebf\u4e86\u77ed\u7f51\u5740\u529f\u80fd\uff08\u76ee\u5f55\\dwz\uff09\r\n\r\n2. \u66f4\u65b0\u4e86\u7f51\u7ad9\u8868\u683cfont-size\r\n\r\n\r\n\r\n## version 2.0.3\r\n\r\n1. \u66f4\u65b0\u4e86 \u9650\u6d41\u7ec4\u4ef6\u548c\u4e2d\u95f4\u4ef6\u9650\u5236requests\u5e93\u722c\u53d6\r\n\r\n## version 2.0.4\r\n\r\n1. \u66f4\u65b0\u4e86moment.js\u7684\u5f15\u7528\u9519\u8bef\u5bfc\u81f4\u7684\u8b66\u544a\r\n\r\n2. \u66f4\u65b0\u4e86\u4e2a\u4eba\u8d44\u6599\u9875\u9762\uff0c\u73b0\u5728\u53ef\u4ee5\u66f4\u65b0\u4e2a\u4eba\u8d44\u6599\u4e86\r\n\r\n## version 3.0.1\r\n1. \u670d\u52a1\u5668\u8fc1\u79fb", "create_date": "2020-02-08T23:08:00.860", "mod_date": "2020-02-08T23:08:00.860"}}, {"model": "info.info", "pk": 3, "fields": {"title": "guide", "body": "", "body_md": "::: hljs-center\r\n\r\n\r\n\r\n# \u4f7f\u7528\u8bf4\u660e\r\n\r\n\r\n\r\n:::\r\n\r\n\r\n\r\n@[toc](\u76ee\u5f55)\r\n\r\n\r\n\r\nMarkdown \u8bed\u6cd5\u7b80\u4ecb\r\n\r\n=============\r\n\r\n> [\u8bed\u6cd5\u8be6\u89e3](http://commonmark.org/help/)\r\n\r\n\r\n\r\n## \u5feb\u6377\u952e\r\n\r\n| key       | keycode  |            \u529f\u80fd            |\r\n| ---------------- | :----------------: | :-----------------------------: |\r\n| F8           | 119 |  \u5f00\u542f/\u5173\u95ed\u5bfc\u822a  |\r\n| F9           | 120   |  \u9884\u89c8/\u7f16\u8f91\u5207\u6362  |\r\n| F10     | 121   | \u5f00\u542f/\u5173\u95ed\u5168\u5c4f |\r\n| F11      | 122   | \u5f00\u542f/\u5173\u95ed\u9605\u8bfb\u6a21\u5f0f |\r\n| F12       | 123   | \u5355\u680f/\u53cc\u680f\u5207\u6362 |\r\n| TAB  | 9  | \u7f29\u8fdb |\r\n| CTRL + S    | 17 + 83 | \u89e6\u53d1\u4fdd\u5b58 |\r\n| CTRL + D    | 17 + 68 | \u5220\u9664\u9009\u4e2d\u884c |\r\n| CTRL + Z    | 17 + 90 | \u4e0a\u4e00\u6b65 |\r\n| CTRL + Y    | 17 + 89 | \u4e0b\u4e00\u6b65 |\r\n| CTRL + BreakSpace    | 17 + 8 | \u6e05\u7a7a\u7f16\u8f91 |\r\n| CTRL + B       | 17 + 66 | **\u52a0\u7c97** |\r\n| CTRL + I | 17 + 73 | *\u659c\u4f53* |\r\n| CTRL + H       | 17 + 72 | # \u6807\u9898 |\r\n| CTRL + 1       | 17 + 97 or 49 | # \u6807\u9898 |\r\n| CTRL + 2       | 17 + 98 or 50 | ## \u6807\u9898 |\r\n| CTRL + 3       | 17 + 99 or 51 | ### \u6807\u9898 |\r\n| CTRL + 4       | 17 + 100 or 52 | #### \u6807\u9898 |\r\n| CTRL + 5       | 17 + 101 or 53 | ##### \u6807\u9898 |\r\n| CTRL + 6       | 17 + 102 or 54 | ###### \u6807\u9898 |\r\n| CTRL + U    | 17 + 85 | ++\u4e0b\u5212\u7ebf++ |\r\n| CTRL + M    | 17 + 77 | ==\u6807\u8bb0== |\r\n| CTRL + Q    | 17 + 81 | > \u5f15\u7528 |\r\n| CTRL + O    | 17 + 79 | 1. \u6709\u5e8f\u5217\u8868 |\r\n| CTRL + L    | 17 + 76 | [\u94fe\u63a5]() |\r\n| CTRL + ALT + S    | 17 + 18 + 83 | ^\u4e0a\u89d2\u6807^ |\r\n| CTRL + ALT + U    | 17 + 18 + 85 | - \u65e0\u5e8f\u5217\u8868 |\r\n| CTRL + ALT + C    | 17 + 18 + 67 | ``` \u4ee3\u7801\u5757 |\r\n| CTRL + ALT + L    | 17 + 18 + 76 | ![\u56fe\u7247\u94fe\u63a5]() |\r\n| CTRL + ALT + T    | 17 + 18 + 84 | \u8868\u683c |\r\n| CTRL + SHIFT + S    | 17 + 16 + 83 | ~\u4e0b\u89d2\u6807~ |\r\n| CTRL + SHIFT + D    | 17 + 16 + 68 | ~~\u4e2d\u5212\u7ebf~~ |\r\n| CTRL + SHIFT + C    | 17 + 16 + 67 | \u5c45\u4e2d |\r\n| CTRL + SHIFT + L    | 17 + 16 + 76 | \u5c45\u5de6 |\r\n| CTRL + SHIFT + R    | 17 + 16 + 82 | \u5c45\u53f3 |\r\n| SHIFT + TAB    | 16 + 9 | \u53d6\u6d88\u7f29\u8fdb |\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n## **\u7c97\u4f53**\r\n\r\n```\r\n\r\n**\u7c97\u4f53**\r\n\r\n__\u7c97\u4f53__\r\n\r\n```\r\n\r\n## *\u659c\u4f53*\r\n\r\n```\r\n\r\n*\u659c\u4f53*\r\n\r\n_\u659c\u4f53_\r\n\r\n```\r\n\r\n## \u6807\u9898\r\n\r\n```\r\n\r\n# \u4e00\u7ea7\u6807\u9898 #\r\n\r\n\u4e00\u7ea7\u6807\u9898\r\n\r\n====\r\n\r\n## \u4e8c\u7ea7\u6807\u9898 ##\r\n\r\n\u4e8c\u7ea7\u6807\u9898\r\n\r\n----\r\n\r\n### \u4e09\u7ea7\u6807\u9898 ###\r\n\r\n#### \u56db\u7ea7\u6807\u9898 ####\r\n\r\n##### \u4e94\u7ea7\u6807\u9898 #####\r\n\r\n###### \u516d\u7ea7\u6807\u9898 ######\r\n\r\n```\r\n\r\n## \u5206\u5272\u7ebf\r\n\r\n```\r\n\r\n***\r\n\r\n---\r\n\r\n```\r\n\r\n****\r\n\r\n## ^\u4e0a^\u89d2~\u4e0b~\u6807\r\n\r\n```\r\n\r\n\u4e0a\u89d2\u6807 x^2^\r\n\r\n\u4e0b\u89d2\u6807 H~2~0\r\n\r\n```\r\n\r\n## ++\u4e0b\u5212\u7ebf++ ~~\u4e2d\u5212\u7ebf~~\r\n\r\n```\r\n\r\n++\u4e0b\u5212\u7ebf++\r\n\r\n~~\u4e2d\u5212\u7ebf~~\r\n\r\n```\r\n\r\n## ==\u6807\u8bb0==\r\n\r\n```\r\n\r\n==\u6807\u8bb0==\r\n\r\n```\r\n\r\n## \u6bb5\u843d\u5f15\u7528\r\n\r\n```\r\n\r\n> \u4e00\u7ea7\r\n\r\n>> \u4e8c\u7ea7\r\n\r\n>>> \u4e09\u7ea7\r\n\r\n...\r\n\r\n```\r\n\r\n\r\n\r\n## \u5217\u8868\r\n\r\n```\r\n\r\n\u6709\u5e8f\u5217\u8868\r\n\r\n1.\r\n\r\n2.\r\n\r\n3.\r\n\r\n...\r\n\r\n\u65e0\u5e8f\u5217\u8868\r\n\r\n-\r\n\r\n-\r\n\r\n...\r\n\r\n```\r\n\r\n\r\n\r\n## \u4efb\u52a1\u5217\u8868\r\n\r\n\r\n\r\n- [x] \u5df2\u5b8c\u6210\u4efb\u52a1\r\n\r\n- [ ] \u672a\u5b8c\u6210\u4efb\u52a1\r\n\r\n\r\n\r\n```\r\n\r\n- [x] \u5df2\u5b8c\u6210\u4efb\u52a1\r\n\r\n- [ ] \u672a\u5b8c\u6210\u4efb\u52a1\r\n\r\n```\r\n\r\n\r\n\r\n## \u94fe\u63a5\r\n\r\n```\r\n\r\n[\u94fe\u63a5](www.baidu.com)\r\n\r\n![\u56fe\u7247\u63cf\u8ff0](http://www.image.com)\r\n\r\n```\r\n\r\n## \u4ee3\u7801\u6bb5\u843d\r\n\r\n\\``` type\r\n\r\n\r\n\r\n\u4ee3\u7801\u6bb5\u843d\r\n\r\n\r\n\r\n\\```\r\n\r\n\r\n\r\n\\` \u4ee3\u7801\u5757 \\`\r\n\r\n\r\n\r\n```c++\r\n\r\nint main()\r\n\r\n{\r\n\r\n    printf(\"hello world!\");\r\n\r\n}\r\n\r\n```\r\n\r\n`code`\r\n\r\n## \u8868\u683c(table)\r\n\r\n```\r\n\r\n| \u6807\u98981 | \u6807\u98982 | \u6807\u98983 |\r\n\r\n| :--  | :--: | ----: |\r\n\r\n| \u5de6\u5bf9\u9f50 | \u5c45\u4e2d | \u53f3\u5bf9\u9f50 |\r\n\r\n| ---------------------- | ------------- | ----------------- |\r\n\r\n```\r\n\r\n| \u6807\u98981 | \u6807\u98982 | \u6807\u98983 |\r\n\r\n| :--  | :--: | ----: |\r\n\r\n| \u5de6\u5bf9\u9f50 | \u5c45\u4e2d | \u53f3\u5bf9\u9f50 |\r\n\r\n| ---------------------- | ------------- | ----------------- |\r\n\r\n## \u811a\u6ce8(footnote)\r\n\r\n```\r\n\r\nhello[^hello]\r\n\r\n```\r\n\r\n\r\n\r\n\u89c1\u5e95\u90e8\u811a\u6ce8[^hello]\r\n\r\n\r\n\r\n[^hello]: \u4e00\u4e2a\u6ce8\u811a\r\n\r\n\r\n\r\n\r\n\r\n## $\\KaTeX$\u516c\u5f0f\r\n\r\n\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u6e32\u67d3\u516c\u5f0f\u4f8b\u5982\uff1a$x_i + y_i = z_i$\u548c$\\sum_{i=1}^n a_i=0$\r\n\r\n\u6211\u4eec\u4e5f\u53ef\u4ee5\u5355\u884c\u6e32\u67d3\r\n\r\n$$\\sum_{i=1}^n a_i=0$$\r\n\r\n\u5177\u4f53\u53ef\u53c2\u7167[katex\u6587\u6863](http://www.intmath.com/cg5/katex-mathjax-comparison.php)\u548c[katex\u652f\u6301\u7684\u51fd\u6570](https://github.com/Khan/KaTeX/wiki/Function-Support-in-KaTeX)\u4ee5\u53ca[latex\u6587\u6863](https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference)\r\n\r\n\r\n\r\n## \u5e03\u5c40\r\n\r\n\r\n\r\n::: hljs-left\r\n\r\n`::: hljs-left`\r\n\r\n`\u5c45\u5de6`\r\n\r\n`:::`\r\n\r\n:::\r\n\r\n\r\n\r\n::: hljs-center\r\n\r\n`::: hljs-center`\r\n\r\n`\u5c45\u4e2d`\r\n\r\n`:::`\r\n\r\n:::\r\n\r\n\r\n\r\n::: hljs-right\r\n\r\n`::: hljs-right`\r\n\r\n`\u5c45\u53f3`\r\n\r\n`:::`\r\n\r\n:::\r\n\r\n\r\n\r\n## \u5b9a\u4e49\r\n\r\n\r\n\r\n\u672f\u8bed\u4e00\r\n\r\n\r\n\r\n:   \u5b9a\u4e49\u4e00\r\n\r\n\r\n\r\n\u5305\u542b\u6709*\u884c\u5185\u6807\u8bb0*\u7684\u672f\u8bed\u4e8c\r\n\r\n\r\n\r\n:   \u5b9a\u4e49\u4e8c\r\n\r\n\r\n\r\n        {\u4e00\u4e9b\u5b9a\u4e49\u4e8c\u7684\u6587\u5b57\u6216\u4ee3\u7801}\r\n\r\n\r\n\r\n    \u5b9a\u4e49\u4e8c\u7684\u7b2c\u4e09\u6bb5\r\n\r\n\r\n\r\n```\r\n\r\n\u672f\u8bed\u4e00\r\n\r\n\r\n\r\n:   \u5b9a\u4e49\u4e00\r\n\r\n\r\n\r\n\u5305\u542b\u6709*\u884c\u5185\u6807\u8bb0*\u7684\u672f\u8bed\u4e8c\r\n\r\n\r\n\r\n:   \u5b9a\u4e49\u4e8c\r\n\r\n\r\n\r\n        {\u4e00\u4e9b\u5b9a\u4e49\u4e8c\u7684\u6587\u5b57\u6216\u4ee3\u7801}\r\n\r\n\r\n\r\n    \u5b9a\u4e49\u4e8c\u7684\u7b2c\u4e09\u6bb5\r\n\r\n\r\n\r\n```\r\n\r\n\r\n\r\n## abbr\r\n\r\n*[HTML]: Hyper Text Markup Language\r\n\r\n*[W3C]:  World Wide Web Consortium\r\n\r\nHTML \u89c4\u8303\u7531 W3C \u7ef4\u62a4\r\n\r\n```\r\n\r\n*[HTML]: Hyper Text Markup Language\r\n\r\n*[W3C]:  World Wide Web Consortium\r\n\r\nHTML \u89c4\u8303\u7531 W3C \u7ef4\u62a4\r\n\r\n```\r\n\r\n\r\n\r\n## \u5b57\u4f53\u989c\u8272 \u80cc\u666f \u6837\u5f0f\r\n\r\n<font face=\"\u9ed1\u4f53\">\u6211\u662f\u9ed1\u4f53\u5b57</font>\r\n\r\n<font face=\"\u5fae\u8f6f\u96c5\u9ed1\">\u6211\u662f\u5fae\u8f6f\u96c5\u9ed1</font>\r\n\r\n<font face=\"STCAIYUN\">\u6211\u662f\u534e\u6587\u5f69\u4e91</font>\r\n\r\n<font color=#0099ff size=7 face=\"\u9ed1\u4f53\">color=#0099ff size=32 face=\"\u9ed1\u4f53\"</font>\r\n\r\n<font color=#00ffff size=72>color=#00ffff</font>\r\n\r\n<font color=gray size=25>color=gray</font>\r\n\r\n```\r\n\r\n<font color=#0099ff size=7 face=\"\u9ed1\u4f53\">color=#0099ff size=32 face=\"\u9ed1\u4f53\"</font>\r\n\r\n```\r\n\r\n\r\n\r\n## \u80cc\u666f\u8272 \u8bbe\u7f6e\r\n\r\n<table><tr><td bgcolor=orange> \u80cc\u666f\u8272\u662f 1 orange</td></tr></table>\r\n\r\n<table><tr><td bgcolor= BlueViolet > \u80cc\u666f\u82722 BlueViolet </td></tr></table>\r\n\r\n\r\n\r\n```\r\n\r\n<table><tr><td bgcolor=orange> \u80cc\u666f\u8272\u662f 1 orange</td></tr></table>\r\n\r\n<table><tr><td bgcolor= BlueViolet > \u80cc\u666f\u82722 BlueViolet </td></tr></table>\r\n\r\n```\r\n\r\n## \u66f4\u6539\u82f1\u6587\u989c\u8272\uff08\u53ea\u5bf9\u82f1\u6587\u6709\u6548\uff09\r\n\r\n\r\n\r\n$\\color{#376956}{cyan-blue}$\r\n\r\n\r\n\r\n```\r\n\r\n$\\color{#376956}{cyan-blue}$\r\n\r\n```", "create_date": "2020-02-08T23:08:23.559", "mod_date": "2020-02-19T16:13:03.759"}}, {"model": "info.info", "pk": 4, "fields": {"title": "recommend", "body": "", "body_md": "::: hljs-center\r\n\r\n\r\n\r\n# \u63a8\u8350\u5b66\u4e60\u7f51\u7ad9\r\n\r\n\r\n\r\n:::\r\n\r\n\r\n\r\n## django\u6587\u6863\u7ffb\u8bd1\r\n\r\n\r\n\r\n- [<font color=red size=3 face=\"\u9ed1\u4f53\">drf-api+django\u6587\u6863</font>](http://drf.jiuyou.info/#/)\r\n\r\n- [django-1.11\u6587\u6863 ](https://yiyibooks.cn/xx/Django_1.11.6/index.html)\r\n\r\n- [djangobuook2.0](http://djangobook.py3k.cn/2.0/)\r\n\r\n- [django\u5b98\u7f512.2](https://docs.djangoproject.com/zh-hans/2.2/)\r\n\r\n- [drf\u5b98\u7f51](https://www.django-rest-framework.org/)\r\n\r\n\r\n\r\n## django\u5b66\u4e60\u535a\u5ba2\r\n\r\n- [\u8ffd\u68a6\u4eba\u7269\u7684\u535a\u5ba2](https://www.zmrenwu.com/)\r\n\r\n- [\u5218\u6c5f\u7684\u4e2a\u4eba\u535a\u5ba2](http://www.liujiangblog.com/)\r\n\r\n- [\u6768\u4ed5\u822a\u7684\u535a\u5ba2](http://yshblog.com/)\r\n\r\n- [\u5927\u6c5f\u72d7python](https://mp.weixin.qq.com/s/x2lM26rrPiUTLYxXI_3PgQ)\r\n\r\n\r\n\r\n## python\u5b66\u4e60\r\n\r\n- [\u5ed6\u96ea\u5cf0python](https://www.liaoxuefeng.com/wiki/1016959663602400)\r\n\r\n- [\u5d14\u5e86\u624d\u7684\u535a\u5ba2](https://cuiqingcai.com/)\r\n\r\n- [Python/Golang Web \u5165\u5751\u6307\u5357](https://python-web-guide.readthedocs.io/zh/latest/index.html#)\r\n\r\n- [\u8bed\u8a00\u5b66\u4e60\u7f51](http://c.biancheng.net/python/)\r\n\r\n## \u7cfb\u7edf\u5b66\u4e60\r\n\r\n- [\u6280\u672f\u9762\u8bd5\u5fc5\u5907\u57fa\u7840\u77e5\u8bc6](https://github.com/CyC2018/CS-Notes?utm_source=gold_browser_extension)\r\n\r\n- [\u4e92\u8054\u7f51 Java \u5de5\u7a0b\u5e08\u8fdb\u9636\u77e5\u8bc6\u5b8c\u5168\u626b\u76f2](https://doocs.github.io/advanced-java/#/?id=%e4%ba%92%e8%81%94%e7%bd%91-java-%e5%b7%a5%e7%a8%8b%e5%b8%88%e8%bf%9b%e9%98%b6%e7%9f%a5%e8%af%86%e5%ae%8c%e5%85%a8%e6%89%ab%e7%9b%b2%c2%a9)\r\n\r\n\r\n\r\n\r\n\r\n## \u524d\u7aefvue\u5b98\u7f51\r\n\r\n- [vuex\u5b98\u7f51](https://vuex.vuejs.org/zh/)\r\n\r\n- [vuerouter\u5b98\u7f51](https://router.vuejs.org/zh/)\r\n\r\n- [vue\u5b98\u7f51](https://cn.vuejs.org/v2/guide/)\r\n\r\n- [iview2.0\u6587\u6863](https://www.iviewui.com/docs/introduce)\r\n\r\n- [axios\u5b98\u7f51](http://www.axios-js.com/docs/)\r\n\r\n\r\n\r\n## \u7b97\u6cd5\r\n\r\n- [\u4e94\u5206\u949f\u7b97\u6cd5](https://www.cxyxiaowu.com/)\r\n\r\n\r\n\r\n## golang\r\n\r\n- [go\u6307\u5357](http://tour.studygolang.com/welcome/1)\r\n\r\n- [golang\u6807\u51c6\u5e93\u4e2d\u6587\u7248](https://studygolang.com/pkgdoc)\r\n\r\n- [golang web\u7f16\u7a0b](https://astaxie.gitbooks.io/build-web-application-with-golang/zh/)\r\n\r\n- [golang\u57fa\u672c\u5e93](https://www.cntofu.com/book/15/index.html)\r\n\r\n- [golang web\u7f16\u7a0b](https://www.cntofu.com/book/16/index.html)\r\n\r\n- [golang google document](https://golang.google.cn/pkg/)\r\n\r\n\r\n\r\n\r\n\r\n## javaScript\r\n\r\n- [MDN:js\u53c2\u8003](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference)", "create_date": "2020-02-08T23:08:40.758", "mod_date": "2020-02-08T23:08:40.758"}}, {"model": "auth.permission", "pk": 1, "fields": {"name": "Can add log entry", "content_type": 1, "codename": "add_logentry"}}, {"model": "auth.permission", "pk": 2, "fields": {"name": "Can change log entry", "content_type": 1, "codename": "change_logentry"}}, {"model": "auth.permission", "pk": 3, "fields": {"name": "Can delete log entry", "content_type": 1, "codename": "delete_logentry"}}, {"model": "auth.permission", "pk": 4, "fields": {"name": "Can view log entry", "content_type": 1, "codename": "view_logentry"}}, {"model": "auth.permission", "pk": 5, "fields": {"name": "Can add permission", "content_type": 2, "codename": "add_permission"}}, {"model": "auth.permission", "pk": 6, "fields": {"name": "Can change permission", "content_type": 2, "codename": "change_permission"}}, {"model": "auth.permission", "pk": 7, "fields": {"name": "Can delete permission", "content_type": 2, "codename": "delete_permission"}}, {"model": "auth.permission", "pk": 8, "fields": {"name": "Can add group", "content_type": 3, "codename": "add_group"}}, {"model": "auth.permission", "pk": 9, "fields": {"name": "Can change group", "content_type": 3, "codename": "change_group"}}, {"model": "auth.permission", "pk": 10, "fields": {"name": "Can delete group", "content_type": 3, "codename": "delete_group"}}, {"model": "auth.permission", "pk": 11, "fields": {"name": "Can view group", "content_type": 3, "codename": "view_group"}}, {"model": "auth.permission", "pk": 12, "fields": {"name": "Can view permission", "content_type": 2, "codename": "view_permission"}}, {"model": "auth.permission", "pk": 13, "fields": {"name": "Can add content type", "content_type": 4, "codename": "add_contenttype"}}, {"model": "auth.permission", "pk": 14, "fields": {"name": "Can change content type", "content_type": 4, "codename": "change_contenttype"}}, {"model": "auth.permission", "pk": 15, "fields": {"name": "Can delete content type", "content_type": 4, "codename": "delete_contenttype"}}, {"model": "auth.permission", "pk": 16, "fields": {"name": "Can view content type", "content_type": 4, "codename": "view_contenttype"}}, {"model": "auth.permission", "pk": 17, "fields": {"name": "Can add session", "content_type": 5, "codename": "add_session"}}, {"model": "auth.permission", "pk": 18, "fields": {"name": "Can change session", "content_type": 5, "codename": "change_session"}}, {"model": "auth.permission", "pk": 19, "fields": {"name": "Can delete session", "content_type": 5, "codename": "delete_session"}}, {"model": "auth.permission", "pk": 20, "fields": {"name": "Can view session", "content_type": 5, "codename": "view_session"}}, {"model": "auth.permission", "pk": 21, "fields": {"name": "Can add \u7528\u6237\u8d26\u6237", "content_type": 6, "codename": "add_userprofile"}}, {"model": "auth.permission", "pk": 22, "fields": {"name": "Can change \u7528\u6237\u8d26\u6237", "content_type": 6, "codename": "change_userprofile"}}, {"model": "auth.permission", "pk": 23, "fields": {"name": "Can delete \u7528\u6237\u8d26\u6237", "content_type": 6, "codename": "delete_userprofile"}}, {"model": "auth.permission", "pk": 24, "fields": {"name": "Can view \u7528\u6237\u8d26\u6237", "content_type": 6, "codename": "view_userprofile"}}, {"model": "auth.permission", "pk": 25, "fields": {"name": "Can add \u5206\u7c7b", "content_type": 7, "codename": "add_category"}}, {"model": "auth.permission", "pk": 26, "fields": {"name": "Can change \u5206\u7c7b", "content_type": 7, "codename": "change_category"}}, {"model": "auth.permission", "pk": 27, "fields": {"name": "Can delete \u5206\u7c7b", "content_type": 7, "codename": "delete_category"}}, {"model": "auth.permission", "pk": 28, "fields": {"name": "Can add \u6587\u7ae0", "content_type": 8, "codename": "add_post"}}, {"model": "auth.permission", "pk": 29, "fields": {"name": "Can change \u6587\u7ae0", "content_type": 8, "codename": "change_post"}}, {"model": "auth.permission", "pk": 30, "fields": {"name": "Can delete \u6587\u7ae0", "content_type": 8, "codename": "delete_post"}}, {"model": "auth.permission", "pk": 31, "fields": {"name": "Can add \u6807\u7b7e", "content_type": 9, "codename": "add_tag"}}, {"model": "auth.permission", "pk": 32, "fields": {"name": "Can change \u6807\u7b7e", "content_type": 9, "codename": "change_tag"}}, {"model": "auth.permission", "pk": 33, "fields": {"name": "Can delete \u6807\u7b7e", "content_type": 9, "codename": "delete_tag"}}, {"model": "auth.permission", "pk": 34, "fields": {"name": "Can view \u5206\u7c7b", "content_type": 7, "codename": "view_category"}}, {"model": "auth.permission", "pk": 35, "fields": {"name": "Can view \u6587\u7ae0", "content_type": 8, "codename": "view_post"}}, {"model": "auth.permission", "pk": 36, "fields": {"name": "Can view \u6807\u7b7e", "content_type": 9, "codename": "view_tag"}}, {"model": "auth.permission", "pk": 37, "fields": {"name": "Can add \u6587\u7ae0\u56fe\u7247", "content_type": 10, "codename": "add_postimg"}}, {"model": "auth.permission", "pk": 38, "fields": {"name": "Can change \u6587\u7ae0\u56fe\u7247", "content_type": 10, "codename": "change_postimg"}}, {"model": "auth.permission", "pk": 39, "fields": {"name": "Can delete \u6587\u7ae0\u56fe\u7247", "content_type": 10, "codename": "delete_postimg"}}, {"model": "auth.permission", "pk": 40, "fields": {"name": "Can view \u6587\u7ae0\u56fe\u7247", "content_type": 10, "codename": "view_postimg"}}, {"model": "auth.permission", "pk": 41, "fields": {"name": "Can add \u7ae0\u8282", "content_type": 11, "codename": "add_chapter"}}, {"model": "auth.permission", "pk": 42, "fields": {"name": "Can change \u7ae0\u8282", "content_type": 11, "codename": "change_chapter"}}, {"model": "auth.permission", "pk": 43, "fields": {"name": "Can delete \u7ae0\u8282", "content_type": 11, "codename": "delete_chapter"}}, {"model": "auth.permission", "pk": 44, "fields": {"name": "Can add \u4e3b\u9898", "content_type": 12, "codename": "add_topic"}}, {"model": "auth.permission", "pk": 45, "fields": {"name": "Can change \u4e3b\u9898", "content_type": 12, "codename": "change_topic"}}, {"model": "auth.permission", "pk": 46, "fields": {"name": "Can delete \u4e3b\u9898", "content_type": 12, "codename": "delete_topic"}}, {"model": "auth.permission", "pk": 47, "fields": {"name": "Can view \u7ae0\u8282", "content_type": 11, "codename": "view_chapter"}}, {"model": "auth.permission", "pk": 48, "fields": {"name": "Can view \u4e3b\u9898", "content_type": 12, "codename": "view_topic"}}, {"model": "auth.permission", "pk": 49, "fields": {"name": "Can add \u7528\u6237\u6536\u85cf", "content_type": 13, "codename": "add_userfav"}}, {"model": "auth.permission", "pk": 50, "fields": {"name": "Can change \u7528\u6237\u6536\u85cf", "content_type": 13, "codename": "change_userfav"}}, {"model": "auth.permission", "pk": 51, "fields": {"name": "Can delete \u7528\u6237\u6536\u85cf", "content_type": 13, "codename": "delete_userfav"}}, {"model": "auth.permission", "pk": 52, "fields": {"name": "Can add \u7528\u6237\u6295\u7968", "content_type": 14, "codename": "add_uservote"}}, {"model": "auth.permission", "pk": 53, "fields": {"name": "Can change \u7528\u6237\u6295\u7968", "content_type": 14, "codename": "change_uservote"}}, {"model": "auth.permission", "pk": 54, "fields": {"name": "Can delete \u7528\u6237\u6295\u7968", "content_type": 14, "codename": "delete_uservote"}}, {"model": "auth.permission", "pk": 55, "fields": {"name": "Can view \u7528\u6237\u6536\u85cf", "content_type": 13, "codename": "view_userfav"}}, {"model": "auth.permission", "pk": 56, "fields": {"name": "Can view \u7528\u6237\u6295\u7968", "content_type": 14, "codename": "view_uservote"}}, {"model": "auth.permission", "pk": 57, "fields": {"name": "Can add \u8bc4\u8bba", "content_type": 15, "codename": "add_comment"}}, {"model": "auth.permission", "pk": 58, "fields": {"name": "Can change \u8bc4\u8bba", "content_type": 15, "codename": "change_comment"}}, {"model": "auth.permission", "pk": 59, "fields": {"name": "Can delete \u8bc4\u8bba", "content_type": 15, "codename": "delete_comment"}}, {"model": "auth.permission", "pk": 60, "fields": {"name": "Can add \u53cd\u9988\u6d88\u606f", "content_type": 16, "codename": "add_message"}}, {"model": "auth.permission", "pk": 61, "fields": {"name": "Can change \u53cd\u9988\u6d88\u606f", "content_type": 16, "codename": "change_message"}}, {"model": "auth.permission", "pk": 62, "fields": {"name": "Can delete \u53cd\u9988\u6d88\u606f", "content_type": 16, "codename": "delete_message"}}, {"model": "auth.permission", "pk": 63, "fields": {"name": "Can view \u8bc4\u8bba", "content_type": 15, "codename": "view_comment"}}, {"model": "auth.permission", "pk": 64, "fields": {"name": "Can view \u53cd\u9988\u6d88\u606f", "content_type": 16, "codename": "view_message"}}, {"model": "auth.permission", "pk": 65, "fields": {"name": "Can add \u4fe1\u606f", "content_type": 17, "codename": "add_info"}}, {"model": "auth.permission", "pk": 66, "fields": {"name": "Can change \u4fe1\u606f", "content_type": 17, "codename": "change_info"}}, {"model": "auth.permission", "pk": 67, "fields": {"name": "Can delete \u4fe1\u606f", "content_type": 17, "codename": "delete_info"}}, {"model": "auth.permission", "pk": 68, "fields": {"name": "Can view \u4fe1\u606f", "content_type": 17, "codename": "view_info"}}, {"model": "auth.permission", "pk": 69, "fields": {"name": "Can add Bookmark", "content_type": 18, "codename": "add_bookmark"}}, {"model": "auth.permission", "pk": 70, "fields": {"name": "Can change Bookmark", "content_type": 18, "codename": "change_bookmark"}}, {"model": "auth.permission", "pk": 71, "fields": {"name": "Can delete Bookmark", "content_type": 18, "codename": "delete_bookmark"}}, {"model": "auth.permission", "pk": 72, "fields": {"name": "Can add User Setting", "content_type": 19, "codename": "add_usersettings"}}, {"model": "auth.permission", "pk": 73, "fields": {"name": "Can change User Setting", "content_type": 19, "codename": "change_usersettings"}}, {"model": "auth.permission", "pk": 74, "fields": {"name": "Can delete User Setting", "content_type": 19, "codename": "delete_usersettings"}}, {"model": "auth.permission", "pk": 75, "fields": {"name": "Can add User Widget", "content_type": 20, "codename": "add_userwidget"}}, {"model": "auth.permission", "pk": 76, "fields": {"name": "Can change User Widget", "content_type": 20, "codename": "change_userwidget"}}, {"model": "auth.permission", "pk": 77, "fields": {"name": "Can delete User Widget", "content_type": 20, "codename": "delete_userwidget"}}, {"model": "auth.permission", "pk": 78, "fields": {"name": "Can add log entry", "content_type": 21, "codename": "add_log"}}, {"model": "auth.permission", "pk": 79, "fields": {"name": "Can change log entry", "content_type": 21, "codename": "change_log"}}, {"model": "auth.permission", "pk": 80, "fields": {"name": "Can delete log entry", "content_type": 21, "codename": "delete_log"}}, {"model": "auth.permission", "pk": 81, "fields": {"name": "Can view Bookmark", "content_type": 18, "codename": "view_bookmark"}}, {"model": "auth.permission", "pk": 82, "fields": {"name": "Can view log entry", "content_type": 21, "codename": "view_log"}}, {"model": "auth.permission", "pk": 83, "fields": {"name": "Can view User Setting", "content_type": 19, "codename": "view_usersettings"}}, {"model": "auth.permission", "pk": 84, "fields": {"name": "Can view User Widget", "content_type": 20, "codename": "view_userwidget"}}, {"model": "auth.permission", "pk": 85, "fields": {"name": "Can add association", "content_type": 22, "codename": "add_association"}}, {"model": "auth.permission", "pk": 86, "fields": {"name": "Can change association", "content_type": 22, "codename": "change_association"}}, {"model": "auth.permission", "pk": 87, "fields": {"name": "Can delete association", "content_type": 22, "codename": "delete_association"}}, {"model": "auth.permission", "pk": 88, "fields": {"name": "Can add code", "content_type": 23, "codename": "add_code"}}, {"model": "auth.permission", "pk": 89, "fields": {"name": "Can change code", "content_type": 23, "codename": "change_code"}}, {"model": "auth.permission", "pk": 90, "fields": {"name": "Can delete code", "content_type": 23, "codename": "delete_code"}}, {"model": "auth.permission", "pk": 91, "fields": {"name": "Can add nonce", "content_type": 24, "codename": "add_nonce"}}, {"model": "auth.permission", "pk": 92, "fields": {"name": "Can change nonce", "content_type": 24, "codename": "change_nonce"}}, {"model": "auth.permission", "pk": 93, "fields": {"name": "Can delete nonce", "content_type": 24, "codename": "delete_nonce"}}, {"model": "auth.permission", "pk": 94, "fields": {"name": "Can add user social auth", "content_type": 25, "codename": "add_usersocialauth"}}, {"model": "auth.permission", "pk": 95, "fields": {"name": "Can change user social auth", "content_type": 25, "codename": "change_usersocialauth"}}, {"model": "auth.permission", "pk": 96, "fields": {"name": "Can delete user social auth", "content_type": 25, "codename": "delete_usersocialauth"}}, {"model": "auth.permission", "pk": 97, "fields": {"name": "Can add partial", "content_type": 26, "codename": "add_partial"}}, {"model": "auth.permission", "pk": 98, "fields": {"name": "Can change partial", "content_type": 26, "codename": "change_partial"}}, {"model": "auth.permission", "pk": 99, "fields": {"name": "Can delete partial", "content_type": 26, "codename": "delete_partial"}}, {"model": "accounts.userprofile", "pk": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "fields": {"password": "pbkdf2_sha256$36000$kidm7GTuEfbx$Dr7YZtDLDU5I8YxamYqpbt3n9kwn2IM0HdAPoyAvKKU=", "last_login": "2020-03-13T03:05:40.776", "is_superuser": true, "username": "heping", "first_name": "", "last_name": "", "is_staff": true, "is_active": true, "date_joined": "2020-02-08T21:09:00", "nickname": "\u6267\u5251\u5c11\u5e74\u6df7\u8ff9\u5e02\u4e95\u4e4b\u95f4", "gender": 1, "address": "\u6c5f\u82cf\u6d77\u95e8", "birth_date": null, "email": "602013597@qq.com", "phone": null, "desc": "\u55ef\u3002\u3002", "avatar": "avatars/heping--4355db/avatar/772e5ca0.jpg", "headline": "\u6c42\u5de5\u4f5c\u3002\u3002", "create_time": "2020-02-08T21:09:04.268", "mod_date": "2020-03-11T04:18:58.047", "answer_count": 0, "articles_count": 0, "follower_count": 0, "following_count": 0, "urltoken": "heping", "groups": [], "user_permissions": []}}, {"model": "accounts.userprofile", "pk": "e4798d2b-e4e5-4abb-bb9e-c47564675878", "fields": {"password": "pbkdf2_sha256$36000$4CG9mMXDFR0F$Cp0+IPSJTGRoXCMWEeGj1DjD9KMcDwYDqCWxaY+oxJo=", "last_login": null, "is_superuser": false, "username": "jack", "first_name": "", "last_name": "", "is_staff": false, "is_active": true, "date_joined": "2020-02-08T16:00:00", "nickname": "\u7b49\u4e0d\u5230\u559c\u6b22\u7684\u4f1e\u5b81\u613f\u6dcb\u96e8", "gender": 1, "address": "\u4e0a\u6d77\u666e\u9640", "birth_date": null, "email": "", "phone": null, "desc": "\u7b49\u4e0d\u5230\u559c\u6b22\u7684\u4f1e\u5b81\u613f\u6dcb\u96e8", "avatar": "avatars/jack--e4798d/avatar/61ffa149.jpg", "headline": "\u6c42\u5de5\u4f5c", "create_time": "2020-02-08T16:00:09.268", "mod_date": "2020-02-20T12:34:08.681", "answer_count": 0, "articles_count": 0, "follower_count": 0, "following_count": 0, "urltoken": "jack", "groups": [], "user_permissions": []}}, {"model": "blog.post", "pk": 1, "fields": {"title": "\u961f\u5217\u4e0e\u6808\u5b9e\u73b0\u95ee\u9898", "body": "<h2><a id=\"__0\"></a>\u961f\u5217\u5b9e\u73b0 \u70ed\u571f\u8c46\u95ee\u9898</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-comment\">## \u961f\u5217</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Queue</span>:</span>                    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self)</span>:</span>         \n        self.items = []         \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">enqueue</span><span class=\"hljs-params\">(self,item)</span>:</span>        \n        self.items.insert(<span class=\"hljs-number\">0</span>,item)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dequeue</span><span class=\"hljs-params\">(self)</span>:</span>              \n        <span class=\"hljs-keyword\">return</span> self.items.pop() \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">is_empty</span><span class=\"hljs-params\">(self)</span>:</span>         \n        <span class=\"hljs-keyword\">return</span> self.items == [] \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">size</span><span class=\"hljs-params\">(self)</span>:</span>             \n        <span class=\"hljs-keyword\">return</span> len(self.items)  \n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hotPotato</span><span class=\"hljs-params\">(namelist, num)</span>:</span>\n    simqueue = Queue()\n    <span class=\"hljs-keyword\">for</span> name <span class=\"hljs-keyword\">in</span> namelist:\n        simqueue.enqueue(name)\n    <span class=\"hljs-keyword\">while</span> simqueue.size() &gt; <span class=\"hljs-number\">1</span>:\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(num):\n            simqueue.enqueue(simqueue.dequeue())\n        simqueue.dequeue()\n    <span class=\"hljs-keyword\">return</span> simqueue.dequeue()\nprint(hotPotato([<span class=\"hljs-string\">\"Bill\"</span>,<span class=\"hljs-string\">\"David\"</span>,<span class=\"hljs-string\">\"Susan\"</span>,<span class=\"hljs-string\">\"Jane\"</span>,<span class=\"hljs-string\">\"Kent\"</span>,<span class=\"hljs-string\">\"Brad\"</span>],<span class=\"hljs-number\">6</span>))\n</code></div></pre>\n<h2><a id=\"__26\"></a>\u6808\u5b9e\u73b0 \u62ec\u53f7\u5339\u914d\u95ee\u9898</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">parChecker</span><span class=\"hljs-params\">(symbolString)</span>:</span>\n    d = {<span class=\"hljs-string\">')'</span>:<span class=\"hljs-string\">'('</span>,<span class=\"hljs-string\">'}'</span>:<span class=\"hljs-string\">'{'</span>,<span class=\"hljs-string\">']'</span>:<span class=\"hljs-string\">'['</span>}\n    s = []\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> symbolString:\n        <span class=\"hljs-keyword\">if</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-string\">'({['</span>:\n            s.append(i)\n        <span class=\"hljs-keyword\">elif</span> s == []:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">False</span>\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">if</span> s[<span class=\"hljs-number\">-1</span>] == d.get(i):\n                s.pop()\n            <span class=\"hljs-keyword\">else</span>:\n                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">False</span>\n    <span class=\"hljs-keyword\">if</span> s == []:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">True</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">False</span>\n    \n</code></div></pre>\n<blockquote>\n<p>\u5b9e\u9645\u4e0a\u8fd9\u6bb5\u793a\u4f8b\u4ee3\u7801\u5e76\u4e0d\u4e25\u8c28</p>\n</blockquote>\n<h2><a id=\"_48\"></a>\u9012\u5f52\u89e3\u51b3\u4efb\u610f\u8fdb\u5236\u8f6c\u6362</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-comment\"># \u9012\u5f52\u89e3\u51b3\u8fdb\u5236\u8f6c\u6362  \u793a\u4f8b\u662f16\u8fdb\u5236</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">tostr</span><span class=\"hljs-params\">(n,base=<span class=\"hljs-number\">16</span>,CString=<span class=\"hljs-string\">'0123456789abcdef'</span>)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> n &lt; base:\n        <span class=\"hljs-keyword\">return</span> CString[n]\n    <span class=\"hljs-keyword\">return</span> tostr(n//base,base)+CString[n%base]\nprint(tostr(<span class=\"hljs-number\">16</span>))  \nprint(tostr(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-string\">'01'</span>))  \n</code></div></pre>\n<blockquote>\n<p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9012\u5f52\u6709\u6808\u9650\u5236max</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-comment\">#\u62a5\u9519\uff1aRecursionError: maximum recursion depth exceeded in comparison</span>\n<span class=\"hljs-keyword\">import</span> sys\nsys.setrecursionlimit(<span class=\"hljs-number\">1500</span>)```\n</code></div></pre>\n</blockquote>\n<p>##\u9012\u5f52\u89e3\u51b3\u6c49\u8bfa\u5854\u95ee\u9898</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">move</span><span class=\"hljs-params\">(n,a,b,c)</span>:</span>  \n    <span class=\"hljs-keyword\">if</span> n==<span class=\"hljs-number\">1</span>:\n\tprint(a,<span class=\"hljs-string\">'--&gt;'</span>,c)\n    <span class=\"hljs-keyword\">else</span>:\n\tmove(n<span class=\"hljs-number\">-1</span>,a,c,b)   \n\tprint(a,<span class=\"hljs-string\">'--&gt;'</span>,c)\n\tmove(n<span class=\"hljs-number\">-1</span>,b,a,c)  \n</code></div></pre>\n<blockquote>\n<p>\u89e3\u51b3\u601d\u8def \u8ffd\u6eaf\u5230\u5e95\uff0c\u5c31\u662f\u2460\u628a\u4e0a\u9762n-1\u4e2a\u76d8\u5b50\u7ecf\u7531\u76ee\u6807\u67f1\u79fb\u52a8\u5230\u4e2d\u95f4\u67f1\u2461\u628a\u6700\u4e0b\u9762\u76d8\u5b50\u4ece\u5f00\u59cb\u67f1\u79fb\u52a8\u5230\u76ee\u6807\u67f1\u2462\u628an-1\u4e2a\u76d8\u5b50\u4ece\u4e2d\u95f4\u67f1\u7ecf\u7531\u5f00\u59cb\u67f1\u79fb\u52a8\u5230\u76ee\u6807\u67f1</p>\n</blockquote>\n<h2><a id=\"_Greedy_Method_76\"></a>\u8d2a\u5fc3\u7b56\u7565 Greedy Method</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">lesscoin</span><span class=\"hljs-params\">(coinlist, change, knownres)</span>:</span>\n    <span class=\"hljs-string\">'''\n    coinlist list :\u786c\u5e01\u9762\u503c\u7b56\u7565\u4f53\u7cfb\n    change   int  :\u9700\u8981\u627e\u96f6\u6570\n\tknownres list :\u8bb0\u5f55\u96f6\u94b1\u8c03\u7528\u60c5\u51b5\n    '''</span>\n    mincoins = change\n    <span class=\"hljs-keyword\">if</span> change <span class=\"hljs-keyword\">in</span> coinlist:\n        knownres[change] = <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>\t\t<span class=\"hljs-comment\"># \u5982\u679c\u96f6\u94b1\u5728\u9762\u503c\u91cc\uff0c\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u76f8\u540c\u9762\u503c\u7684\u786c\u5e01</span>\n    <span class=\"hljs-keyword\">elif</span> knownres[change] &gt; <span class=\"hljs-number\">0</span>:\n        <span class=\"hljs-keyword\">return</span> knownres[change]  <span class=\"hljs-comment\"># \u67e5\u8868\u6210\u529f\uff0c\u76f4\u63a5\u4f7f\u7528\u6700\u4f18\u89e3</span>\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> [j <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> coinlist <span class=\"hljs-keyword\">if</span> j &lt;= change]:  <span class=\"hljs-comment\"># \u5728\u9762\u503c\u6bd4\u96f6\u94b1\u5c0f\u7684\u5217\u8868\u91cc\u5faa\u73af</span>\n            numcoins = <span class=\"hljs-number\">1</span>+lesscoin(coinlist, change-i,\n                                  knownres)  <span class=\"hljs-comment\"># \u53d6\u51fa\u6b64\u65f6\u9762\u503c\uff0c\u96f6\u94b1\u4e2a\u6570+1</span>\n            <span class=\"hljs-keyword\">if</span> numcoins &lt; mincoins:\n                mincoins = numcoins\t\t<span class=\"hljs-comment\"># \u9009\u62e9\u5faa\u73af\u8c03\u7528\u4e4b\u540e\u6700\u5c11\u7684\u786c\u5e01\u6570\u91cf</span>\n                knownres[change] = mincoins\n    <span class=\"hljs-keyword\">return</span> mincoins\n<span class=\"hljs-comment\"># print(lesscoin([1,2,5,10,20,100], 632,[0]*633))</span>\n</code></div></pre>", "body_md": "## \u961f\u5217\u5b9e\u73b0 \u70ed\u571f\u8c46\u95ee\u9898\n```py\n## \u961f\u5217\nclass Queue:                    \n    def __init__(self):         \n        self.items = []         \n    def enqueue(self,item):        \n        self.items.insert(0,item)\n    def dequeue(self):              \n        return self.items.pop() \n    def is_empty(self):         \n        return self.items == [] \n    def size(self):             \n        return len(self.items)  \n\ndef hotPotato(namelist, num):\n    simqueue = Queue()\n    for name in namelist:\n        simqueue.enqueue(name)\n    while simqueue.size() > 1:\n        for i in range(num):\n            simqueue.enqueue(simqueue.dequeue())\n        simqueue.dequeue()\n    return simqueue.dequeue()\nprint(hotPotato([\"Bill\",\"David\",\"Susan\",\"Jane\",\"Kent\",\"Brad\"],6))\n```\n## \u6808\u5b9e\u73b0 \u62ec\u53f7\u5339\u914d\u95ee\u9898\n```py\ndef parChecker(symbolString):\n    d = {')':'(','}':'{',']':'['}\n    s = []\n    for i in symbolString:\n        if i in '({[':\n            s.append(i)\n        elif s == []:\n            return False\n        else:\n            if s[-1] == d.get(i):\n                s.pop()\n            else:\n                return False\n    if s == []:\n        return True\n    return False\n    \n```\n> \u5b9e\u9645\u4e0a\u8fd9\u6bb5\u793a\u4f8b\u4ee3\u7801\u5e76\u4e0d\u4e25\u8c28\n\n## \u9012\u5f52\u89e3\u51b3\u4efb\u610f\u8fdb\u5236\u8f6c\u6362\n```py\n# \u9012\u5f52\u89e3\u51b3\u8fdb\u5236\u8f6c\u6362  \u793a\u4f8b\u662f16\u8fdb\u5236\ndef tostr(n,base=16,CString='0123456789abcdef'):\n    if n < base:\n        return CString[n]\n    return tostr(n//base,base)+CString[n%base]\nprint(tostr(16))  \nprint(tostr(10,2,'01'))  \n```\n> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9012\u5f52\u6709\u6808\u9650\u5236max    \n>```py \n>#\u62a5\u9519\uff1aRecursionError: maximum recursion depth exceeded in comparison\n>import sys\n>sys.setrecursionlimit(1500)```\n\n##\u9012\u5f52\u89e3\u51b3\u6c49\u8bfa\u5854\u95ee\u9898\n```py\ndef move(n,a,b,c):  \n    if n==1:\n\tprint(a,'-->',c)\n    else:\n\tmove(n-1,a,c,b)   \n\tprint(a,'-->',c)\n\tmove(n-1,b,a,c)  \n```\n> \u89e3\u51b3\u601d\u8def \u8ffd\u6eaf\u5230\u5e95\uff0c\u5c31\u662f\u2460\u628a\u4e0a\u9762n-1\u4e2a\u76d8\u5b50\u7ecf\u7531\u76ee\u6807\u67f1\u79fb\u52a8\u5230\u4e2d\u95f4\u67f1\u2461\u628a\u6700\u4e0b\u9762\u76d8\u5b50\u4ece\u5f00\u59cb\u67f1\u79fb\u52a8\u5230\u76ee\u6807\u67f1\u2462\u628an-1\u4e2a\u76d8\u5b50\u4ece\u4e2d\u95f4\u67f1\u7ecf\u7531\u5f00\u59cb\u67f1\u79fb\u52a8\u5230\u76ee\u6807\u67f1\n\n## \u8d2a\u5fc3\u7b56\u7565 Greedy Method\n```py\ndef lesscoin(coinlist, change, knownres):\n    '''\n    coinlist list :\u786c\u5e01\u9762\u503c\u7b56\u7565\u4f53\u7cfb\n    change   int  :\u9700\u8981\u627e\u96f6\u6570\n\tknownres list :\u8bb0\u5f55\u96f6\u94b1\u8c03\u7528\u60c5\u51b5\n    '''\n    mincoins = change\n    if change in coinlist:\n        knownres[change] = 1\n        return 1\t\t# \u5982\u679c\u96f6\u94b1\u5728\u9762\u503c\u91cc\uff0c\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u76f8\u540c\u9762\u503c\u7684\u786c\u5e01\n    elif knownres[change] > 0:\n        return knownres[change]  # \u67e5\u8868\u6210\u529f\uff0c\u76f4\u63a5\u4f7f\u7528\u6700\u4f18\u89e3\n    else:\n        for i in [j for j in coinlist if j <= change]:  # \u5728\u9762\u503c\u6bd4\u96f6\u94b1\u5c0f\u7684\u5217\u8868\u91cc\u5faa\u73af\n            numcoins = 1+lesscoin(coinlist, change-i,\n                                  knownres)  # \u53d6\u51fa\u6b64\u65f6\u9762\u503c\uff0c\u96f6\u94b1\u4e2a\u6570+1\n            if numcoins < mincoins:\n                mincoins = numcoins\t\t# \u9009\u62e9\u5faa\u73af\u8c03\u7528\u4e4b\u540e\u6700\u5c11\u7684\u786c\u5e01\u6570\u91cf\n                knownres[change] = mincoins\n    return mincoins\n# print(lesscoin([1,2,5,10,20,100], 632,[0]*633))\n```", "excerpt": "\u961f\u5217\u5b9e\u73b0 \u70ed\u571f\u8c46\u95ee\u9898\n## \u961f\u5217\nclass Queue:                    \n    def __init__(self):         \n        self.items = []         \n    def enqueue(self,item):       ", "codestyle": "atelier-savanna-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-08T21:12:35.524", "mod_date": "2020-04-07T11:05:13.741", "views_count": 163, "can_comment": true, "comment_count": 0, "upvote_count": 1, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 1, "tags": [1]}}, {"model": "blog.post", "pk": 2, "fields": {"title": "vue-cli4\u8fc1\u79fb\u5168\u914d\u7f6e", "body": "<blockquote>\n<p>\u7b2c\u4e00\u6b21\u521b\u5efa\u7684\u535a\u5ba2\u524d\u7aef\u5355\u9875\u9762\u5e94\u7528\u662f\u7528vue-cli2\u521b\u5efa\u7684\uff0c\u8dcc\u8dcc\u649e\u649e\u5199\u4e86\u5f88\u4e45\uff0c\u4e00\u6b21\u6b21\u7248\u672c\u66f4\u65b0\u8fed\u4ee3\uff0c\u9879\u76ee\u4f18\u5316\uff0c\u8d8a\u6765\u8d8a\u611f\u89c9\u5f88\u591a\u5730\u65b9\u4e0d\u65b9\u4fbf\u3002\u9879\u76ee\u521b\u5efa\u7684\u914d\u7f6e,webpack\u7684\u914d\u7f6e\u7e41\u7410\uff0c\u540e\u7eed\u65b0\u9879\u76ee\u7684\u521b\u5efa\u4e5f\u9700\u8981\u7ecf\u9a8c\u7684\u79ef\u7d2f\uff0c\u6240\u4ee5\u8fd9\u51e0\u5929\u4ecevue-cli2\u5347\u7ea7\u5230vue-cli4\uff0c\u9879\u76ee\u5927\u4f53\u91cd\u6784\uff0c\u5e76\u4e14\u505a\u4e86@v4\u7684\u7248\u672c\u4f18\u5316\uff0c\u8bb0\u5f55\u5728\u6b64\u65b9\u4fbf\u4ee5\u540e\u65b0\u9879\u76ee\u7684\u4f7f\u7528\u3002</p>\n</blockquote>\n<h2><a id=\"vuecli4_2\"></a>vue-cli4\u4ecb\u7ecd</h2>\n<p>vue-cli4\u4e0evue-cli3\u65e0\u592a\u5927\u533a\u522b(vue-cli2\u76f4\u63a5\u8df3\u5230@v4),\u4e0e\u7b2c\u4e00\u4ee3@v2\u533a\u522b\u4e3b\u8981\u5728webpack\u914d\u7f6e\u7684\u79fb\u690d\uff0c\u4ee5\u53caui\u7a97\u53e3\u7684\u52a0\u5165\uff0c\u6253\u5305\u7684\u663e\u793a\u4f18\u5316\uff0c\u53ef\u4ee5\u8bf4\u662f\u5168\u65b9\u9762\u7684\u8fed\u4ee3\u52a0\u5f3a\uff0c\u5e76\u4e14\u5bf9\u4e8e\u9879\u76ee\u7684\u914d\u7f6e\u96c6\u4e2d\u653e\u7f6e\u5728<code>vue.config.js</code>\u91cc,\u7701\u53bb\u989d\u5916\u5b66\u4e60\u6210\u672c\u3002</p>\n<h2><a id=\"_5\"></a>\u5b89\u88c5\u548c\u521b\u5efa\u9879\u76ee</h2>\n<pre><div class=\"hljs\"><code class=\"lang-js\">npm install @vue/cli -g        # \u5168\u5c40\u5b89\u88c5\u811a\u624b\u67b6\nvue create project-name        # \u521b\u5efa\u9879\u76ee\n\n<span class=\"hljs-comment\">// \u8fdb\u5165\u9009\u62e9\u9875\u9762\uff08Please pick a preset\uff09</span>\n<span class=\"hljs-keyword\">default</span>  \u9009\u9879\u6ca1\u600e\u4e48\u7528\u8fc7\uff08\uff09\nManually select features\u81ea\u5b9a\u4e49\u914d\u7f6e\uff08\u6216\u8005\u6709\u4fdd\u5b58\u7684\u9884\u8bbe\u53ef\u4ee5\u76f4\u63a5\u9009\u62e9\uff09\n\u81ea\u5b9a\u4e49\u4e00\u822c\u9009\u62e9\uff08Babel\uff0cvuex\uff0crouter\uff0cscss\uff0c\u8def\u7531\u5f00\u542fhistory mode\uff0c\u6700\u540e\u53ef\u4ee5\u4fdd\u5b58\u6210\u9884\u8bbe\u65b9\u4fbf\u540e\u7ee7\u9879\u76ee\u521b\u5efa\uff09\n\n<span class=\"hljs-comment\">// \u8fd0\u884c\u9879\u76ee npm run serve</span>\n<span class=\"hljs-comment\">// \u6253\u5305\u9879\u76ee npm run build</span>\n\u6253\u5305\u548c\u8fd0\u884c\u547d\u4ee4\u53ef\u4ee5\u5728ui\u7a97\u53e3\u8fd0\u884c\uff0c\u6253\u5305\u754c\u9762\u53ef\u4ee5\u65b9\u4fbf\u9879\u76ee\u4f18\u5316\n</code></div></pre>\n<p>@v4\u521b\u5efa\u9879\u76ee\u76f8\u6bd4@v2\u521b\u5efa\u7684\u7e41\u7410\u547d\u4ee4(<code>vue init ...</code>)\uff0c\u66f4\u7b80\u7565</p>\n<blockquote>\n<p>@v4\u4e5f\u53ef\u4ee5\u672c\u5730\u5f00\u542f\u670d\u52a1\u5668\uff0c\u5728ui\u7a97\u53e3\u5b9e\u73b0\u9879\u76ee\u7684\u521b\u5efa\uff0c\u672c\u5904\u4e0d\u8c08\u3002</p>\n</blockquote>\n<h2><a id=\"_22\"></a>\u9879\u76ee\u914d\u7f6e</h2>\n<blockquote>\n<p>\u76f8\u6bd4@v2\uff0c\u914d\u7f6e\u592a\u65b9\u4fbf\u4e86\u3002\u9996\u5148css\u9884\u7f16\u8bd1\u7684\u5b89\u88c5\uff0c\u53ef\u4ee5\u5728\u9879\u76ee\u521b\u5efa\u7684\u65f6\u5019\u76f4\u63a5\u5b89\u88c5\uff0c<br />\n\u5f00\u53d1\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u7684\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u6839\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\u52a0\u4ee5\u8bbe\u7f6e\uff0cbuild\u548cconfig\u5305\u7684\u76f4\u63a5\u7701\u53bb\uff0c\u8ba9\u4eba\u66f4\u4e13\u6ce8\u4e8e\u9879\u76ee\u7684\u5f00\u53d1\u800c\u975e\u73af\u5883\u7684\u642d\u5efa\u3002</p>\n</blockquote>\n<h3><a id=\"_26\"></a>\u4f9d\u8d56\u5b89\u88c5</h3>\n<p>\u76f8\u6bd4\u547d\u4ee4\u884c\uff0c\u66f4\u559c\u6b22ui\u7a97\u53e3\u64cd\u4f5c\uff08/dependencies\uff09\u53ef\u4ee5\u5b89\u88c5\u8fd0\u884c\u548c\u5f00\u53d1\u4f9d\u8d56\uff08\u6307\u5b9a\u7248\u672c\u53ef\u4ee5\u547d\u4ee4\u884c\u5b89\u88c5\uff0c\u5176\u5b89\u88c5\u7ed3\u679c\u540c\u6837\u663e\u793a\u5728ui\u7a97\u53e3\u663e\u793a\u5217\u8868\u91cc\uff09\uff0c\u5e76\u4e14ui\u7a97\u53e3\u4e5f\u53ef\u4ee5\u5378\u8f7d\u4f9d\u8d56\uff08\u4ee5\u5f80\u5378\u8f7d\u7ecf\u5e38\u5bfc\u81f4\u5176\u4ed6\u4f9d\u8d56\u51fa\u9519\uff0c\u5bfc\u81f4\u9879\u76ee\u4f9d\u8d56\u5d29\u6e83\uff0c\u53ea\u80fd\u91cd\u65b0\u521d\u59cb\u5316\u73af\u5883\u5f00\u53d1\uff09</p>\n<h3><a id=\"_29\"></a>\u9879\u76ee\u5305\u62c6\u5206</h3>\n<p>\u76f8\u6bd4@v2\uff0c\u76f4\u89c2\u663e\u793a\u591a\u4e86\u4e00\u4e2aviews\u76ee\u5f55\uff08\u4e0enuxt\u9879\u76ee\u7684\u8bbe\u8ba1\u76f8\u540c\uff09\uff0c\u5373\u8def\u7531\u5bf9\u5e94\u7684component\u7ec4\u4ef6\uff0c\u653e\u7f6e\u5728views\u91cc\u3002</p>\n<p>assets\u5305\u548cpublic\u5305\u7684\u7684\u533a\u5206\u4f7f\u7528\uff0cassets\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4f1a\u88ab\u6253\u5305\u7f16\u8bd1\uff0cpublic\u5373\u4f20\u7edfstatic\u5305\uff0c\u914d\u7f6e\u5916\u90e8\u5f15\u7528\u7684js\u6216cs\u6587\u4ef6\uff08jQuery\u7b49\uff09\uff0c\u6216\u6bd4\u8f83\u5927\u7684\u56fe\u7247\u6587\u4ef6</p>\n<p>src\u76ee\u5f55\u4e0b\u521b\u5efaservice\u76ee\u5f55\uff0c\u76ee\u5f55\u4e0b\u521b\u5efa\u7f51\u7edc\u8bf7\u6c42\u7684js\u6587\u4ef6</p>\n<h2><a id=\"webpack_36\"></a>\u73af\u5883\u548cwebpack\u914d\u7f6e\u53ca\u4f18\u5316</h2>\n<p>\u73af\u5883\u914d\u7f6e\uff1a\u6839\u76ee\u5f55\u4e0b\u521b\u5efa<code>.env</code>\u6587\u4ef6,\u5176\u4e2d<code>.env.development</code>\u914d\u7f6e\u5f00\u53d1\u73af\u5883\u53d8\u91cf\uff0c<code>.env.production</code>\u653e\u7f6e\u751f\u4ea7\u73af\u5883\u53d8\u91cf<br />\n\u53d8\u91cf\u9700\u8981\u4ee5VUE_APP_*\u683c\u5f0f\uff0c\u5982(<code>VUE_APP_BASE_SITE = https://zhaoheping.com</code>)\u624d\u53ef\u4ee5\u8bfb\u53d6\u4f7f\u7528</p>\n<h3><a id=\"_39\"></a>\u8def\u7531\u61d2\u52a0\u8f7d</h3>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-keyword\">const</span> PostDetail = <span class=\"hljs-function\"><span class=\"hljs-params\">()</span> =&gt;</span> <span class=\"hljs-keyword\">import</span>(<span class=\"hljs-comment\">/* webpackChunkName:'postgroup' */</span> <span class=\"hljs-string\">'@/views/post/PostDetail'</span>);\n</code></div></pre>\n<blockquote>\n<p>\u9700\u8981webpack\u652f\u6301,\u6253\u5305\u65f6\u4f1a\u5bf9\u76f8\u540c\u547d\u540d\u7a7a\u95f4\u7684\u7ec4\u4ef6\u6253\u5305\u5230\u76f8\u540cjs\u6587\u4ef6\u91cc\uff0c\u5728\u5bf9\u5176\u8def\u7531\u8bbf\u95ee\u624d\u4f1a\u52a0\u8f7d\u3002</p>\n</blockquote>\n<h3><a id=\"vueconfigjs_44\"></a>vue.config.js</h3>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-keyword\">const</span> CompressionPlugin = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'compression-webpack-plugin'</span>)\n<span class=\"hljs-comment\">//\u5f15\u5165compression-webpack-plugin\u63d2\u4ef6\uff08\u538b\u7f29js/css\u6587\u4ef6\uff09</span>\n<span class=\"hljs-built_in\">module</span>.exports = {\n    <span class=\"hljs-attr\">productionSourceMap</span>: <span class=\"hljs-literal\">false</span>,    <span class=\"hljs-comment\">//\u5173\u95edsourceMap</span>\n    assetsDir: <span class=\"hljs-string\">'static'</span>,           <span class=\"hljs-comment\">//assets\u6253\u5305\u76ee\u5f55</span>\n    chainWebpack: <span class=\"hljs-function\"><span class=\"hljs-params\">config</span> =&gt;</span> {\n        config.set(<span class=\"hljs-string\">'externals'</span>, {    <span class=\"hljs-comment\">//\u4e0d\u6253\u5305externals\u4e0b\u7684\u5f15\u7528</span>\n            vue: <span class=\"hljs-string\">'Vue'</span>,\n            <span class=\"hljs-attr\">axios</span>: <span class=\"hljs-string\">'axios'</span>,\n            <span class=\"hljs-comment\">// iview: 'iview',</span>\n            <span class=\"hljs-string\">'vue-router'</span>: <span class=\"hljs-string\">'VueRouter'</span>,\n            <span class=\"hljs-attr\">nprogress</span>: <span class=\"hljs-string\">'NProgress'</span>,\n        })\n    },\n    <span class=\"hljs-attr\">configureWebpack</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">config</span> =&gt;</span> {\n        <span class=\"hljs-keyword\">if</span> (process.env.NODE_ENV === <span class=\"hljs-string\">'production'</span>) {\n            <span class=\"hljs-comment\">//\u5173\u95ed\u751f\u4ea7\u6a21\u5f0f\u4e0b\u7684console\u63a7\u5236\u53f0\u6253\u5370</span>\n            config.optimization.minimizer[<span class=\"hljs-number\">0</span>].options.terserOptions.compress.drop_console = <span class=\"hljs-literal\">true</span>\n            <span class=\"hljs-keyword\">return</span> {\n                <span class=\"hljs-attr\">plugins</span>: [\n                    <span class=\"hljs-keyword\">new</span> CompressionPlugin({    <span class=\"hljs-comment\">//CompressionPlugin\u914d\u7f6e\u538b\u7f29</span>\n                        <span class=\"hljs-comment\">// test: /\\.js$|\\.html$|.\\css$/, //\u5339\u914d\u6587\u4ef6\u540d</span>\n                        <span class=\"hljs-comment\">// threshold: 10240,//\u5bf9\u8d85\u8fc710k\u7684\u6570\u636e\u538b\u7f29</span>\n                        <span class=\"hljs-comment\">// deleteOriginalAssets: false //\u4e0d\u5220\u9664\u6e90\u6587\u4ef6</span>\n                        filename: <span class=\"hljs-string\">'[path].gz[query]'</span>,\n                        <span class=\"hljs-attr\">algorithm</span>: <span class=\"hljs-string\">'gzip'</span>,\n                        <span class=\"hljs-attr\">test</span>: <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">RegExp</span>(<span class=\"hljs-string\">'\\\\.('</span> + [<span class=\"hljs-string\">'js'</span>, <span class=\"hljs-string\">'css'</span>].join(<span class=\"hljs-string\">'|'</span>) + <span class=\"hljs-string\">')$'</span>,),\n                        <span class=\"hljs-attr\">threshold</span>: <span class=\"hljs-number\">8192</span>,\n                        <span class=\"hljs-attr\">minRatio</span>: <span class=\"hljs-number\">0.8</span>,\n\n                    })\n                ]\n            }\n        }\n    },\n}\n</code></div></pre>\n<h3><a id=\"mainjs_84\"></a>main.js</h3>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-keyword\">import</span> Vue <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'vue'</span>\n<span class=\"hljs-keyword\">import</span> App <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./App.vue'</span>\n<span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./router'</span>\n<span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./store'</span>\n\nVue.config.productionTip = <span class=\"hljs-literal\">false</span>\n\n<span class=\"hljs-comment\">// \u5f15\u5165mavon-editor</span>\n<span class=\"hljs-keyword\">import</span> mavonEditor <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'mavon-editor'</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'mavon-editor/dist/css/index.css'</span>\n\nVue.use(mavonEditor)\n\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'./assets/css/normalize.css'</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'./assets/css/base.scss'</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">\"./assets/iconfont/iconfont.css\"</span>;\n<span class=\"hljs-keyword\">if</span>(process.env.NODE_ENV ==<span class=\"hljs-string\">'development'</span>){\n    <span class=\"hljs-keyword\">var</span> vConsole = <span class=\"hljs-keyword\">new</span> VConsole();\n    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">'Hello world'</span>);\n}\n<span class=\"hljs-built_in\">console</span>.log(process.env)\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">new</span> Vue({\n    router,\n    store,\n    <span class=\"hljs-attr\">render</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">h</span> =&gt;</span> h(App)\n}).$mount(<span class=\"hljs-string\">'#app'</span>)\n</code></div></pre>\n<h3><a id=\"indexhtml_113\"></a>index.html</h3>\n<pre><div class=\"hljs\"><code class=\"lang-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">\"en\"</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">\"utf-8\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">http-equiv</span>=<span class=\"hljs-string\">\"X-UA-Compatible\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"IE=edge\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"viewport\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"width=device-width,initial-scale=1.0\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"referrer\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"no-referrer\"</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"keywords\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"django drf vue nginx blog \"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"author\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"zhp,602013597@qq.com\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"description\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"zhp blog\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css\"</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"stylesheet\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/vue-router/3.1.3/vue-router.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/axios/0.19.0/axios.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/vConsole/3.3.4/vconsole.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/moment.js/2.24.0/moment.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/moment.js/2.24.0/locale/zh-cn.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/iview/3.5.1/iview.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/iview/3.5.1/styles/iview.css\"</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"stylesheet\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"icon\"</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"&lt;%= BASE_URL %&gt;favicon.ico\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">noscript</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">strong</span>&gt;</span>We're sorry but blog_f doesn't work properly without JavaScript enabled. Please enable it to\n        continue.<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">strong</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">noscript</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"app\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- built files will be auto injected --&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n</code></div></pre>\n<h3><a id=\"packagejson_148\"></a>package.json</h3>\n<pre><div class=\"hljs\"><code class=\"lang-json\">{\n  <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"blog_f\"</span>,\n  <span class=\"hljs-attr\">\"version\"</span>: <span class=\"hljs-string\">\"0.1.0\"</span>,\n  <span class=\"hljs-attr\">\"private\"</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"serve\"</span>: <span class=\"hljs-string\">\"vue-cli-service serve\"</span>,\n    <span class=\"hljs-attr\">\"build\"</span>: <span class=\"hljs-string\">\"vue-cli-service build\"</span>\n  },\n  <span class=\"hljs-attr\">\"dependencies\"</span>: {\n    <span class=\"hljs-attr\">\"axios\"</span>: <span class=\"hljs-string\">\"^0.19.2\"</span>,\n    <span class=\"hljs-attr\">\"core-js\"</span>: <span class=\"hljs-string\">\"^3.4.4\"</span>,\n    <span class=\"hljs-attr\">\"iview\"</span>: <span class=\"hljs-string\">\"^3.5.4\"</span>,\n    <span class=\"hljs-attr\">\"mavon-editor\"</span>: <span class=\"hljs-string\">\"^2.7.7\"</span>,\n    <span class=\"hljs-attr\">\"nprogress\"</span>: <span class=\"hljs-string\">\"^0.2.0\"</span>,\n    <span class=\"hljs-attr\">\"vue\"</span>: <span class=\"hljs-string\">\"^2.6.10\"</span>,\n    <span class=\"hljs-attr\">\"vue-cookies\"</span>: <span class=\"hljs-string\">\"^1.6.1\"</span>,\n    <span class=\"hljs-attr\">\"vue-router\"</span>: <span class=\"hljs-string\">\"^3.1.3\"</span>,\n    <span class=\"hljs-attr\">\"vuex\"</span>: <span class=\"hljs-string\">\"^3.1.2\"</span>\n  },\n  <span class=\"hljs-attr\">\"devDependencies\"</span>: {\n    <span class=\"hljs-attr\">\"@vue/cli-plugin-babel\"</span>: <span class=\"hljs-string\">\"^4.1.0\"</span>,\n    <span class=\"hljs-attr\">\"@vue/cli-plugin-router\"</span>: <span class=\"hljs-string\">\"^4.1.0\"</span>,\n    <span class=\"hljs-attr\">\"@vue/cli-plugin-vuex\"</span>: <span class=\"hljs-string\">\"^4.1.0\"</span>,\n    <span class=\"hljs-attr\">\"@vue/cli-service\"</span>: <span class=\"hljs-string\">\"^4.1.0\"</span>,\n    <span class=\"hljs-attr\">\"compression-webpack-plugin\"</span>: <span class=\"hljs-string\">\"^3.1.0\"</span>,\n    <span class=\"hljs-attr\">\"node-sass\"</span>: <span class=\"hljs-string\">\"^4.12.0\"</span>,\n    <span class=\"hljs-attr\">\"sass-loader\"</span>: <span class=\"hljs-string\">\"^8.0.0\"</span>,\n    <span class=\"hljs-attr\">\"vue-template-compiler\"</span>: <span class=\"hljs-string\">\"^2.6.10\"</span>\n  },\n  <span class=\"hljs-attr\">\"browserslist\"</span>: [\n    <span class=\"hljs-string\">\"&gt; 1%\"</span>,\n    <span class=\"hljs-string\">\"last 2 versions\"</span>\n  ]\n}\n</code></div></pre>\n<h2><a id=\"_186\"></a>\u603b\u7ed3</h2>\n<p>@v2\u2013&gt;@v4\u7684\u8fc1\u79fb\u662f\u5e78\u798f\u7684\uff0c@v4\u7ee7\u627f\u4e86@v2\u539f\u672c\u7684\u4f18\u5316\u914d\u7f6e\uff0c\u5e76\u4e14\u5bf9\u9879\u76ee\u7ed3\u6784\u505a\u4e86\u6700\u5927\u9650\u5ea6\u7684\u4f18\u5316\uff0cui\u7a97\u53e3\u7684\u9879\u76ee\u7ba1\u7406\u5668\uff0c\u975e\u5e38\u9002\u5408\u524d\u7aef\u9879\u76ee\u7efc\u5408\u7ba1\u7406\u53ca\u6253\u5305\u4f18\u5316\uff0c\u7b80\u5316\u540e\u7eed\u9879\u76ee\u7684\u4f9d\u8d56\u5f00\u53d1\u3002</p>", "body_md": "> \u7b2c\u4e00\u6b21\u521b\u5efa\u7684\u535a\u5ba2\u524d\u7aef\u5355\u9875\u9762\u5e94\u7528\u662f\u7528vue-cli2\u521b\u5efa\u7684\uff0c\u8dcc\u8dcc\u649e\u649e\u5199\u4e86\u5f88\u4e45\uff0c\u4e00\u6b21\u6b21\u7248\u672c\u66f4\u65b0\u8fed\u4ee3\uff0c\u9879\u76ee\u4f18\u5316\uff0c\u8d8a\u6765\u8d8a\u611f\u89c9\u5f88\u591a\u5730\u65b9\u4e0d\u65b9\u4fbf\u3002\u9879\u76ee\u521b\u5efa\u7684\u914d\u7f6e,webpack\u7684\u914d\u7f6e\u7e41\u7410\uff0c\u540e\u7eed\u65b0\u9879\u76ee\u7684\u521b\u5efa\u4e5f\u9700\u8981\u7ecf\u9a8c\u7684\u79ef\u7d2f\uff0c\u6240\u4ee5\u8fd9\u51e0\u5929\u4ecevue-cli2\u5347\u7ea7\u5230vue-cli4\uff0c\u9879\u76ee\u5927\u4f53\u91cd\u6784\uff0c\u5e76\u4e14\u505a\u4e86@v4\u7684\u7248\u672c\u4f18\u5316\uff0c\u8bb0\u5f55\u5728\u6b64\u65b9\u4fbf\u4ee5\u540e\u65b0\u9879\u76ee\u7684\u4f7f\u7528\u3002\n\n## vue-cli4\u4ecb\u7ecd\nvue-cli4\u4e0evue-cli3\u65e0\u592a\u5927\u533a\u522b(vue-cli2\u76f4\u63a5\u8df3\u5230@v4),\u4e0e\u7b2c\u4e00\u4ee3@v2\u533a\u522b\u4e3b\u8981\u5728webpack\u914d\u7f6e\u7684\u79fb\u690d\uff0c\u4ee5\u53caui\u7a97\u53e3\u7684\u52a0\u5165\uff0c\u6253\u5305\u7684\u663e\u793a\u4f18\u5316\uff0c\u53ef\u4ee5\u8bf4\u662f\u5168\u65b9\u9762\u7684\u8fed\u4ee3\u52a0\u5f3a\uff0c\u5e76\u4e14\u5bf9\u4e8e\u9879\u76ee\u7684\u914d\u7f6e\u96c6\u4e2d\u653e\u7f6e\u5728`vue.config.js`\u91cc,\u7701\u53bb\u989d\u5916\u5b66\u4e60\u6210\u672c\u3002\n\n## \u5b89\u88c5\u548c\u521b\u5efa\u9879\u76ee\n```js\nnpm install @vue/cli -g        # \u5168\u5c40\u5b89\u88c5\u811a\u624b\u67b6\nvue create project-name        # \u521b\u5efa\u9879\u76ee\n\n// \u8fdb\u5165\u9009\u62e9\u9875\u9762\uff08Please pick a preset\uff09\ndefault  \u9009\u9879\u6ca1\u600e\u4e48\u7528\u8fc7\uff08\uff09\nManually select features\u81ea\u5b9a\u4e49\u914d\u7f6e\uff08\u6216\u8005\u6709\u4fdd\u5b58\u7684\u9884\u8bbe\u53ef\u4ee5\u76f4\u63a5\u9009\u62e9\uff09\n\u81ea\u5b9a\u4e49\u4e00\u822c\u9009\u62e9\uff08Babel\uff0cvuex\uff0crouter\uff0cscss\uff0c\u8def\u7531\u5f00\u542fhistory mode\uff0c\u6700\u540e\u53ef\u4ee5\u4fdd\u5b58\u6210\u9884\u8bbe\u65b9\u4fbf\u540e\u7ee7\u9879\u76ee\u521b\u5efa\uff09\n\n// \u8fd0\u884c\u9879\u76ee npm run serve\n// \u6253\u5305\u9879\u76ee npm run build\n\u6253\u5305\u548c\u8fd0\u884c\u547d\u4ee4\u53ef\u4ee5\u5728ui\u7a97\u53e3\u8fd0\u884c\uff0c\u6253\u5305\u754c\u9762\u53ef\u4ee5\u65b9\u4fbf\u9879\u76ee\u4f18\u5316\n```\n@v4\u521b\u5efa\u9879\u76ee\u76f8\u6bd4@v2\u521b\u5efa\u7684\u7e41\u7410\u547d\u4ee4(`vue init ...`)\uff0c\u66f4\u7b80\u7565\n> @v4\u4e5f\u53ef\u4ee5\u672c\u5730\u5f00\u542f\u670d\u52a1\u5668\uff0c\u5728ui\u7a97\u53e3\u5b9e\u73b0\u9879\u76ee\u7684\u521b\u5efa\uff0c\u672c\u5904\u4e0d\u8c08\u3002\n\n## \u9879\u76ee\u914d\u7f6e\n> \u76f8\u6bd4@v2\uff0c\u914d\u7f6e\u592a\u65b9\u4fbf\u4e86\u3002\u9996\u5148css\u9884\u7f16\u8bd1\u7684\u5b89\u88c5\uff0c\u53ef\u4ee5\u5728\u9879\u76ee\u521b\u5efa\u7684\u65f6\u5019\u76f4\u63a5\u5b89\u88c5\uff0c\n\u5f00\u53d1\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u7684\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u6839\u76ee\u5f55\u4e0b\u521b\u5efa\u6587\u4ef6\u52a0\u4ee5\u8bbe\u7f6e\uff0cbuild\u548cconfig\u5305\u7684\u76f4\u63a5\u7701\u53bb\uff0c\u8ba9\u4eba\u66f4\u4e13\u6ce8\u4e8e\u9879\u76ee\u7684\u5f00\u53d1\u800c\u975e\u73af\u5883\u7684\u642d\u5efa\u3002\n\n### \u4f9d\u8d56\u5b89\u88c5\n\u76f8\u6bd4\u547d\u4ee4\u884c\uff0c\u66f4\u559c\u6b22ui\u7a97\u53e3\u64cd\u4f5c\uff08/dependencies\uff09\u53ef\u4ee5\u5b89\u88c5\u8fd0\u884c\u548c\u5f00\u53d1\u4f9d\u8d56\uff08\u6307\u5b9a\u7248\u672c\u53ef\u4ee5\u547d\u4ee4\u884c\u5b89\u88c5\uff0c\u5176\u5b89\u88c5\u7ed3\u679c\u540c\u6837\u663e\u793a\u5728ui\u7a97\u53e3\u663e\u793a\u5217\u8868\u91cc\uff09\uff0c\u5e76\u4e14ui\u7a97\u53e3\u4e5f\u53ef\u4ee5\u5378\u8f7d\u4f9d\u8d56\uff08\u4ee5\u5f80\u5378\u8f7d\u7ecf\u5e38\u5bfc\u81f4\u5176\u4ed6\u4f9d\u8d56\u51fa\u9519\uff0c\u5bfc\u81f4\u9879\u76ee\u4f9d\u8d56\u5d29\u6e83\uff0c\u53ea\u80fd\u91cd\u65b0\u521d\u59cb\u5316\u73af\u5883\u5f00\u53d1\uff09\n\n### \u9879\u76ee\u5305\u62c6\u5206\n\u76f8\u6bd4@v2\uff0c\u76f4\u89c2\u663e\u793a\u591a\u4e86\u4e00\u4e2aviews\u76ee\u5f55\uff08\u4e0enuxt\u9879\u76ee\u7684\u8bbe\u8ba1\u76f8\u540c\uff09\uff0c\u5373\u8def\u7531\u5bf9\u5e94\u7684component\u7ec4\u4ef6\uff0c\u653e\u7f6e\u5728views\u91cc\u3002\n\nassets\u5305\u548cpublic\u5305\u7684\u7684\u533a\u5206\u4f7f\u7528\uff0cassets\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4f1a\u88ab\u6253\u5305\u7f16\u8bd1\uff0cpublic\u5373\u4f20\u7edfstatic\u5305\uff0c\u914d\u7f6e\u5916\u90e8\u5f15\u7528\u7684js\u6216cs\u6587\u4ef6\uff08jQuery\u7b49\uff09\uff0c\u6216\u6bd4\u8f83\u5927\u7684\u56fe\u7247\u6587\u4ef6\n\nsrc\u76ee\u5f55\u4e0b\u521b\u5efaservice\u76ee\u5f55\uff0c\u76ee\u5f55\u4e0b\u521b\u5efa\u7f51\u7edc\u8bf7\u6c42\u7684js\u6587\u4ef6\n\n## \u73af\u5883\u548cwebpack\u914d\u7f6e\u53ca\u4f18\u5316\n\u73af\u5883\u914d\u7f6e\uff1a\u6839\u76ee\u5f55\u4e0b\u521b\u5efa`.env`\u6587\u4ef6,\u5176\u4e2d`.env.development`\u914d\u7f6e\u5f00\u53d1\u73af\u5883\u53d8\u91cf\uff0c`.env.production`\u653e\u7f6e\u751f\u4ea7\u73af\u5883\u53d8\u91cf\n\u53d8\u91cf\u9700\u8981\u4ee5VUE_APP_*\u683c\u5f0f\uff0c\u5982(`VUE_APP_BASE_SITE = https://zhaoheping.com`)\u624d\u53ef\u4ee5\u8bfb\u53d6\u4f7f\u7528\n### \u8def\u7531\u61d2\u52a0\u8f7d\n```js\nconst PostDetail = () => import(/* webpackChunkName:'postgroup' */ '@/views/post/PostDetail');\n```\n>\u9700\u8981webpack\u652f\u6301,\u6253\u5305\u65f6\u4f1a\u5bf9\u76f8\u540c\u547d\u540d\u7a7a\u95f4\u7684\u7ec4\u4ef6\u6253\u5305\u5230\u76f8\u540cjs\u6587\u4ef6\u91cc\uff0c\u5728\u5bf9\u5176\u8def\u7531\u8bbf\u95ee\u624d\u4f1a\u52a0\u8f7d\u3002\n### vue.config.js\n```js\nconst CompressionPlugin = require('compression-webpack-plugin')\n//\u5f15\u5165compression-webpack-plugin\u63d2\u4ef6\uff08\u538b\u7f29js/css\u6587\u4ef6\uff09\nmodule.exports = {\n    productionSourceMap: false,    //\u5173\u95edsourceMap\n    assetsDir: 'static',           //assets\u6253\u5305\u76ee\u5f55\n    chainWebpack: config => {\n        config.set('externals', {    //\u4e0d\u6253\u5305externals\u4e0b\u7684\u5f15\u7528\n            vue: 'Vue',\n            axios: 'axios',\n            // iview: 'iview',\n            'vue-router': 'VueRouter',\n            nprogress: 'NProgress',\n        })\n    },\n    configureWebpack: config => {\n        if (process.env.NODE_ENV === 'production') {\n            //\u5173\u95ed\u751f\u4ea7\u6a21\u5f0f\u4e0b\u7684console\u63a7\u5236\u53f0\u6253\u5370\n            config.optimization.minimizer[0].options.terserOptions.compress.drop_console = true\n            return {\n                plugins: [\n                    new CompressionPlugin({    //CompressionPlugin\u914d\u7f6e\u538b\u7f29\n                        // test: /\\.js$|\\.html$|.\\css$/, //\u5339\u914d\u6587\u4ef6\u540d\n                        // threshold: 10240,//\u5bf9\u8d85\u8fc710k\u7684\u6570\u636e\u538b\u7f29\n                        // deleteOriginalAssets: false //\u4e0d\u5220\u9664\u6e90\u6587\u4ef6\n                        filename: '[path].gz[query]',\n                        algorithm: 'gzip',\n                        test: new RegExp('\\\\.(' + ['js', 'css'].join('|') + ')$',),\n                        threshold: 8192,\n                        minRatio: 0.8,\n\n                    })\n                ]\n            }\n        }\n    },\n}\n```\n\n### main.js\n```js\nimport Vue from 'vue'\nimport App from './App.vue'\nimport router from './router'\nimport store from './store'\n\nVue.config.productionTip = false\n\n// \u5f15\u5165mavon-editor\nimport mavonEditor from 'mavon-editor'\nimport 'mavon-editor/dist/css/index.css'\n\nVue.use(mavonEditor)\n\nimport './assets/css/normalize.css'\nimport './assets/css/base.scss'\nimport \"./assets/iconfont/iconfont.css\";\nif(process.env.NODE_ENV =='development'){\n    var vConsole = new VConsole();\n    console.log('Hello world');\n}\nconsole.log(process.env)\nexport default new Vue({\n    router,\n    store,\n    render: h => h(App)\n}).$mount('#app')\n```\n### index.html\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n    <meta name=\"referrer\" content=\"no-referrer\"/>\n    <meta name=\"keywords\" content=\"django drf vue nginx blog \">\n    <meta name=\"author\" content=\"zhp,602013597@qq.com\">\n    <meta name=\"description\" content=\"zhp blog\">\n    <script src=\"https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js\"></script>\n    <link href=\"https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css\" rel=\"stylesheet\">\n    <script src=\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"></script>\n    <script src=\"https://cdn.bootcss.com/vue-router/3.1.3/vue-router.min.js\"></script>\n    <script src=\"https://cdn.bootcss.com/axios/0.19.0/axios.min.js\"></script>\n    <script src=\"https://cdn.bootcss.com/vConsole/3.3.4/vconsole.min.js\"></script>\n    <script src=\"https://cdn.bootcss.com/moment.js/2.24.0/moment.min.js\"></script>\n    <script src=\"https://cdn.bootcss.com/moment.js/2.24.0/locale/zh-cn.js\"></script>\n    <script src=\"https://cdn.bootcss.com/iview/3.5.1/iview.min.js\"></script>\n    <link href=\"https://cdn.bootcss.com/iview/3.5.1/styles/iview.css\" rel=\"stylesheet\">\n    <link rel=\"icon\" href=\"<%= BASE_URL %>favicon.ico\">\n    <title></title>\n</head>\n<body>\n<noscript>\n    <strong>We're sorry but blog_f doesn't work properly without JavaScript enabled. Please enable it to\n        continue.</strong>\n</noscript>\n<div id=\"app\"></div>\n<!-- built files will be auto injected -->\n</body>\n</html>\n```\n### package.json\n```json\n{\n  \"name\": \"blog_f\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"serve\": \"vue-cli-service serve\",\n    \"build\": \"vue-cli-service build\"\n  },\n  \"dependencies\": {\n    \"axios\": \"^0.19.2\",\n    \"core-js\": \"^3.4.4\",\n    \"iview\": \"^3.5.4\",\n    \"mavon-editor\": \"^2.7.7\",\n    \"nprogress\": \"^0.2.0\",\n    \"vue\": \"^2.6.10\",\n    \"vue-cookies\": \"^1.6.1\",\n    \"vue-router\": \"^3.1.3\",\n    \"vuex\": \"^3.1.2\"\n  },\n  \"devDependencies\": {\n    \"@vue/cli-plugin-babel\": \"^4.1.0\",\n    \"@vue/cli-plugin-router\": \"^4.1.0\",\n    \"@vue/cli-plugin-vuex\": \"^4.1.0\",\n    \"@vue/cli-service\": \"^4.1.0\",\n    \"compression-webpack-plugin\": \"^3.1.0\",\n    \"node-sass\": \"^4.12.0\",\n    \"sass-loader\": \"^8.0.0\",\n    \"vue-template-compiler\": \"^2.6.10\"\n  },\n  \"browserslist\": [\n    \"> 1%\",\n    \"last 2 versions\"\n  ]\n}\n```\n\n## \u603b\u7ed3\n@v2-->@v4\u7684\u8fc1\u79fb\u662f\u5e78\u798f\u7684\uff0c@v4\u7ee7\u627f\u4e86@v2\u539f\u672c\u7684\u4f18\u5316\u914d\u7f6e\uff0c\u5e76\u4e14\u5bf9\u9879\u76ee\u7ed3\u6784\u505a\u4e86\u6700\u5927\u9650\u5ea6\u7684\u4f18\u5316\uff0cui\u7a97\u53e3\u7684\u9879\u76ee\u7ba1\u7406\u5668\uff0c\u975e\u5e38\u9002\u5408\u524d\u7aef\u9879\u76ee\u7efc\u5408\u7ba1\u7406\u53ca\u6253\u5305\u4f18\u5316\uff0c\u7b80\u5316\u540e\u7eed\u9879\u76ee\u7684\u4f9d\u8d56\u5f00\u53d1\u3002", "excerpt": "\n\u7b2c\u4e00\u6b21\u521b\u5efa\u7684\u535a\u5ba2\u524d\u7aef\u5355\u9875\u9762\u5e94\u7528\u662f\u7528vue-cli2\u521b\u5efa\u7684\uff0c\u8dcc\u8dcc\u649e\u649e\u5199\u4e86\u5f88\u4e45\uff0c\u4e00\u6b21\u6b21\u7248\u672c\u66f4\u65b0\u8fed\u4ee3\uff0c\u9879\u76ee\u4f18\u5316\uff0c\u8d8a\u6765\u8d8a\u611f\u89c9\u5f88\u591a\u5730\u65b9\u4e0d\u65b9\u4fbf\u3002\u9879\u76ee\u521b\u5efa\u7684\u914d\u7f6e,webpack\u7684\u914d\u7f6e\u7e41\u7410\uff0c\u540e\u7eed\u65b0\u9879\u76ee\u7684\u521b\u5efa\u4e5f\u9700\u8981\u7ecf\u9a8c\u7684\u79ef\u7d2f\uff0c\u6240\u4ee5\u8fd9\u51e0\u5929\u4ecevue-cli2\u5347\u7ea7\u5230vue-cli4\uff0c\u9879\u76ee\u5927\u4f53\u91cd\u6784\uff0c\u5e76\u4e14\u505a\u4e86@v4\u7684\u7248\u672c\u4f18\u5316", "codestyle": "atelier-dune-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-16T16:52:49.921", "mod_date": "2020-02-20T12:01:14.652", "views_count": 120, "can_comment": true, "comment_count": 0, "upvote_count": -1, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 4, "tags": [2]}}, {"model": "blog.post", "pk": 3, "fields": {"title": "django\u9879\u76ee\u5728centos7\u7684\u90e8\u7f72", "body": "<blockquote>\n<p>\u4ece\u7b2c\u4e00\u6b21\u8d2d\u4e70\u963f\u91cc\u4e91ecs\u5b66\u751f\u673a\u5230\u73b0\u5728\uff0c\u4ece\u670d\u52a1\u5668\u5230\u671f\u6570\u636e\u8fc1\u79fb\u7531\u4e8e\u6570\u636e\u5e93\u8fc1\u79fb\u95ee\u9898\u4e22\u5931\u6570\u636e\u81f3\u4eca\uff0c\u4e00\u6b21\u6b21\u7684\u90e8\u7f72\u79ef\u7d2f\u7684\u4e00\u4e9b\u4e9b\u5c0f\u5c0f\u7ecf\u9a8c\uff0c\u4e00\u6b21\u6b21\u7684\u722c\u5751\uff0c\u505a\u4e86\u8bb0\u5f55\u4ee5\u5907\u540e\u7eed\u90e8\u7f72\u3002</p>\n</blockquote>\n<h2><a id=\"_1\"></a>\u7528\u6237</h2>\n<pre><code class=\"lang-\">adduser zhp        # \u65b0\u589e\u7528\u6237\npasswd zhp         # \u7528\u6237\u5bc6\u7801(8\u4f4d)\nusermod -aG wheel zhp    # \u8d85\u7ea7\u6743\u9650\nsu - zhp         # \u5207\u6362\u5230\u7528\u6237\n</code></pre>\n<h2><a id=\"_8\"></a>\u66f4\u65b0</h2>\n<pre><code class=\"lang-\">sudo yum update\nsudo yum upgrade\n</code></pre>\n<h2><a id=\"_14\"></a>\u5b89\u88c5\u4f9d\u8d56</h2>\n<pre><code class=\"lang-\">sudo yum install -y openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel\n</code></pre>\n<h2><a id=\"python336_19\"></a>\u5b89\u88c5python3(3.6)</h2>\n<pre><code class=\"lang-\">yum install python36    # \u5b89\u88c5python3.6\u7248\u672c\ncd /usr/bin;ls |grep python        # \u6b64\u65f6\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u5b58\u5728\u53cc\u7248\u672cpy2\u548cpy3\nsudo rm python ;ln -s python3.6 python        # \u66ff\u6362py2\u52303\u7684\u8f6f\u94fe\u63a5\n</code></pre>\n<h2><a id=\"yum_25\"></a>\u5907\u6ce8\uff1ayum\u7684\u517c\u5bb9\u95ee\u9898</h2>\n<blockquote>\n<p>yum\u9ed8\u8ba4\u662fpython2\u64cd\u4f5c\u7684\uff0c\u5b89\u88c5python3\u540e\uff0c\u5982\u679c\u4fee\u6539\u8f6f\u94fe\u63a5\u4f1a\u5bfc\u81f4yum\u8fd0\u884c\u8bed\u6cd5\u95ee\u9898\uff0c<code>sudo vim /usr/bin/yum</code>\u6539\u9996\u884c\u6307\u5411python2(\u4e0d\u6b62\u4e00\u4e2a\u6587\u4ef6\uff0c\u67e5\u770b\u9519\u8befsudo\u66f4\u6539\u53ef\u89e3\u51b3)</p>\n</blockquote>\n<h2><a id=\"hello_world_29\"></a>hello world</h2>\n<blockquote>\n<p>\u5b89\u88c5flask</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-py\">    <span class=\"hljs-comment\"># main.py</span>\n  <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">from</span> flask <span class=\"hljs-keyword\">import</span> Flask\n  <span class=\"hljs-number\">2</span> \n  <span class=\"hljs-number\">3</span> app = Flask(__name__)\n  <span class=\"hljs-number\">4</span> \n  <span class=\"hljs-number\">5</span> @app.route(<span class=\"hljs-string\">'/'</span>)\n  <span class=\"hljs-number\">6</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">index</span><span class=\"hljs-params\">()</span>:</span>\n  <span class=\"hljs-number\">7</span>     print(<span class=\"hljs-string\">'hello world'</span>)\n  <span class=\"hljs-number\">8</span>     <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'&lt;h1&gt;hello world&lt;/h1&gt;'</span>\n  <span class=\"hljs-number\">9</span> \n <span class=\"hljs-number\">10</span> <span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n <span class=\"hljs-number\">11</span>    app.run(host=<span class=\"hljs-string\">'0.0.0.0'</span>,debug=<span class=\"hljs-keyword\">True</span>,port=<span class=\"hljs-number\">80</span>)\n</code></div></pre>\n<blockquote>\n<p>\u542f\u52a8 sudo python main.py,\u6d4f\u89c8\u5668\u8f93\u5165\u57df\u540d\u5c31\u53ef\u4ee5\u770b\u5230hello world\u5566</p>\n</blockquote>\n<h2><a id=\"git_47\"></a>\u5b89\u88c5git</h2>\n<pre><code class=\"lang-\">yum install git\n</code></pre>\n<h2><a id=\"mysql_51\"></a>\u5b89\u88c5mysql</h2>\n<blockquote>\n<p><a href=\"https://www.runoob.com/mysql/mysql-install.html\" target=\"_blank\">linux\u5b89\u88c5mysql</a></p>\n</blockquote>\n<pre><code class=\"lang-\">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm\nrpm -ivh mysql-community-release-el7-5.noarch.rpm\nyum update\nyum install mysql-server\n# \u4ee5\u4e0a\u5b89\u88c5mysql\nchown mysql:mysql -R /var/lib/mysql            # \u6743\u9650\u8bbe\u7f6e\nmysqld --initialize                            # \u521d\u59cb\u5316\nsystemctl start mysqld                         # \u542f\u52a8mysql\nmysqladmin -u root password &quot;new_password&quot;;    # \u8bbe\u7f6e\u5bc6\u7801\n</code></pre>\n<h2><a id=\"redis_64\"></a>\u5b89\u88c5redis</h2>\n<pre><code class=\"lang-\">yum install redis\n# \u542f\u52a8redis\n#service redis start\n# \u505c\u6b62redis\n#service redis stop\n# \u67e5\u770bredis\u8fd0\u884c\u72b6\u6001\n#service redis status\n# \u67e5\u770bredis\u8fdb\u7a0b\n#ps -ef | grep redis\n# \u5f00\u673a\u81ea\u542f\u52a8\nsystemctl enable redis.service\n#\u4f7f\u7528redis\nredis-cli\n</code></pre>\n<h2><a id=\"docker_80\"></a>\u5b89\u88c5docker</h2>\n<pre><code class=\"lang-\"># step 1: \u5b89\u88c5\u5fc5\u8981\u7684\u4e00\u4e9b\u7cfb\u7edf\u5de5\u5177\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n# Step 2: \u6dfb\u52a0\u8f6f\u4ef6\u6e90\u4fe1\u606f\nsudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n# Step 3: \u66f4\u65b0\u5e76\u5b89\u88c5 Docker-CE\nsudo yum makecache fast\nsudo yum -y install docker-ce\n# Step 4: \u5f00\u542fDocker\u670d\u52a1\nsudo service docker start\n</code></pre>\n<h2><a id=\"nginx_93\"></a>\u5b89\u88c5nginx</h2>\n<pre><code class=\"lang-\">sudo yum install epel-release -y\nsudo yum install nginx -y\n# \u542f\u52a8nginx\nsudo systemctl start nginx\n## \u91cd\u542f sudo systemctl restart nginx\n## \u5173\u95ed sudo systemctl stop nginx\n</code></pre>\n<h2><a id=\"nginxgunicorn_103\"></a>\u4f7f\u7528nginx\uff0cgunicorn\u90e8\u7f72\u9879\u76ee</h2>\n<h3><a id=\"gunicorn__104\"></a>gunicorn \u542f\u52a8\u9879\u76ee</h3>\n<pre><code class=\"lang-\">gunicorn blog.wsgi -w 2 -k gthread -b 0.0.0.0:8000 # django\u4f7f\u7528\u9879\u76ee\u7684wsgi\u6a21\u5757\u542f\u52a8\ngunicorn blog:app -w 2 -k gthread -b 0.0.0.0:8000    # flask\u4f7f\u7528\u9879\u76ee\u4e0b\u7684app\u5b9e\u4f8b\u542f\u52a8\n# w\u7ebf\u7a0b\u6570     -k worker-class \u542f\u52a8\u7c7b \u53ef\u9009gevent\uff0c\u5efa\u8bae\u4f7f\u7528gthread -b\u7ed1\u5b9a\u7aef\u53e3\uff0880\u7aef\u53e3\u6253\u4e0d\u5f00\uff0c\u53ef\u90098000\uff09\n# \u547d\u4ee4\u884c\u8f93\u5165\u4ee5\u4e0a\u6307\u4ee4\uff0c\u53ef\u5728\u57df\u540d:8000\u6253\u5f00\u5e94\u7528\n</code></pre>\n<h3><a id=\"nginx_111\"></a>nginx\u914d\u7f6e</h3>\n<pre><code class=\"lang-\">server {\n    charset utf-8;    \n    listen 80;        # \u76d1\u542c80\u7aef\u53e3\n    server_name \u57df\u540d\u586b\u5728\u8fd9 \u591a\u4e2a\u57df\u540d\u7a7a\u683c;\n \n    location /static {\n        alias /home/yangxg/apps/HelloDjango-blog-tutorial/static;\n    }        # alias \u9759\u6001\u6587\u4ef6\u7684\u5b58\u653e\u76ee\u5f55\n \n    location / {\n        proxy_set_header Host $host;\n        proxy_pass http://127.0.0.1:8000;    # \u8f6c\u53d1\uff0cgunicorn\u90e8\u7f72-b\u6b64\u5730\u5740\n    }\n}\n</code></pre>", "body_md": "> \u4ece\u7b2c\u4e00\u6b21\u8d2d\u4e70\u963f\u91cc\u4e91ecs\u5b66\u751f\u673a\u5230\u73b0\u5728\uff0c\u4ece\u670d\u52a1\u5668\u5230\u671f\u6570\u636e\u8fc1\u79fb\u7531\u4e8e\u6570\u636e\u5e93\u8fc1\u79fb\u95ee\u9898\u4e22\u5931\u6570\u636e\u81f3\u4eca\uff0c\u4e00\u6b21\u6b21\u7684\u90e8\u7f72\u79ef\u7d2f\u7684\u4e00\u4e9b\u4e9b\u5c0f\u5c0f\u7ecf\u9a8c\uff0c\u4e00\u6b21\u6b21\u7684\u722c\u5751\uff0c\u505a\u4e86\u8bb0\u5f55\u4ee5\u5907\u540e\u7eed\u90e8\u7f72\u3002\n## \u7528\u6237\n```\nadduser zhp        # \u65b0\u589e\u7528\u6237\npasswd zhp         # \u7528\u6237\u5bc6\u7801(8\u4f4d)\nusermod -aG wheel zhp    # \u8d85\u7ea7\u6743\u9650\nsu - zhp         # \u5207\u6362\u5230\u7528\u6237\n```\n## \u66f4\u65b0 \n```\nsudo yum update\nsudo yum upgrade\n```\n\n## \u5b89\u88c5\u4f9d\u8d56\n```\nsudo yum install -y openssl-devel bzip2-devel expat-devel gdbm-devel readline-devel sqlite-devel\n```\n\n## \u5b89\u88c5python3(3.6)\n```\nyum install python36    # \u5b89\u88c5python3.6\u7248\u672c\ncd /usr/bin;ls |grep python        # \u6b64\u65f6\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u5b58\u5728\u53cc\u7248\u672cpy2\u548cpy3\nsudo rm python ;ln -s python3.6 python        # \u66ff\u6362py2\u52303\u7684\u8f6f\u94fe\u63a5\n```\n## \u5907\u6ce8\uff1ayum\u7684\u517c\u5bb9\u95ee\u9898\n> yum\u9ed8\u8ba4\u662fpython2\u64cd\u4f5c\u7684\uff0c\u5b89\u88c5python3\u540e\uff0c\u5982\u679c\u4fee\u6539\u8f6f\u94fe\u63a5\u4f1a\u5bfc\u81f4yum\u8fd0\u884c\u8bed\u6cd5\u95ee\u9898\uff0c`sudo vim /usr/bin/yum`\u6539\u9996\u884c\u6307\u5411python2(\u4e0d\u6b62\u4e00\u4e2a\u6587\u4ef6\uff0c\u67e5\u770b\u9519\u8befsudo\u66f4\u6539\u53ef\u89e3\u51b3)\n\n\n## hello world\n> \u5b89\u88c5flask\n```py\n    # main.py\n  1 from flask import Flask\n  2 \n  3 app = Flask(__name__)\n  4 \n  5 @app.route('/')\n  6 def index():\n  7     print('hello world')\n  8     return '<h1>hello world</h1>'\n  9 \n 10 if __name__ == \"__main__\":\n 11    app.run(host='0.0.0.0',debug=True,port=80)\n```\n>\u542f\u52a8 sudo python main.py,\u6d4f\u89c8\u5668\u8f93\u5165\u57df\u540d\u5c31\u53ef\u4ee5\u770b\u5230hello world\u5566\n\n## \u5b89\u88c5git\n```\nyum install git\n```\n## \u5b89\u88c5mysql\n> [linux\u5b89\u88c5mysql](https://www.runoob.com/mysql/mysql-install.html)\n```\nwget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm\nrpm -ivh mysql-community-release-el7-5.noarch.rpm\nyum update\nyum install mysql-server\n# \u4ee5\u4e0a\u5b89\u88c5mysql\nchown mysql:mysql -R /var/lib/mysql            # \u6743\u9650\u8bbe\u7f6e\nmysqld --initialize                            # \u521d\u59cb\u5316\nsystemctl start mysqld                         # \u542f\u52a8mysql\nmysqladmin -u root password \"new_password\";    # \u8bbe\u7f6e\u5bc6\u7801\n```\n## \u5b89\u88c5redis\n```\nyum install redis\n# \u542f\u52a8redis\n#service redis start\n# \u505c\u6b62redis\n#service redis stop\n# \u67e5\u770bredis\u8fd0\u884c\u72b6\u6001\n#service redis status\n# \u67e5\u770bredis\u8fdb\u7a0b\n#ps -ef | grep redis\n# \u5f00\u673a\u81ea\u542f\u52a8\nsystemctl enable redis.service\n#\u4f7f\u7528redis\nredis-cli\n```\n## \u5b89\u88c5docker\n```\n# step 1: \u5b89\u88c5\u5fc5\u8981\u7684\u4e00\u4e9b\u7cfb\u7edf\u5de5\u5177\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n# Step 2: \u6dfb\u52a0\u8f6f\u4ef6\u6e90\u4fe1\u606f\nsudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n# Step 3: \u66f4\u65b0\u5e76\u5b89\u88c5 Docker-CE\nsudo yum makecache fast\nsudo yum -y install docker-ce\n# Step 4: \u5f00\u542fDocker\u670d\u52a1\nsudo service docker start\n```\n\n## \u5b89\u88c5nginx\n```\nsudo yum install epel-release -y\nsudo yum install nginx -y\n# \u542f\u52a8nginx\nsudo systemctl start nginx\n## \u91cd\u542f sudo systemctl restart nginx\n## \u5173\u95ed sudo systemctl stop nginx\n```\n\n## \u4f7f\u7528nginx\uff0cgunicorn\u90e8\u7f72\u9879\u76ee\n### gunicorn \u542f\u52a8\u9879\u76ee\n```\ngunicorn blog.wsgi -w 2 -k gthread -b 0.0.0.0:8000 # django\u4f7f\u7528\u9879\u76ee\u7684wsgi\u6a21\u5757\u542f\u52a8\ngunicorn blog:app -w 2 -k gthread -b 0.0.0.0:8000    # flask\u4f7f\u7528\u9879\u76ee\u4e0b\u7684app\u5b9e\u4f8b\u542f\u52a8\n# w\u7ebf\u7a0b\u6570     -k worker-class \u542f\u52a8\u7c7b \u53ef\u9009gevent\uff0c\u5efa\u8bae\u4f7f\u7528gthread -b\u7ed1\u5b9a\u7aef\u53e3\uff0880\u7aef\u53e3\u6253\u4e0d\u5f00\uff0c\u53ef\u90098000\uff09\n# \u547d\u4ee4\u884c\u8f93\u5165\u4ee5\u4e0a\u6307\u4ee4\uff0c\u53ef\u5728\u57df\u540d:8000\u6253\u5f00\u5e94\u7528\n```\n### nginx\u914d\u7f6e\n```\nserver {\n    charset utf-8;    \n    listen 80;        # \u76d1\u542c80\u7aef\u53e3\n    server_name \u57df\u540d\u586b\u5728\u8fd9 \u591a\u4e2a\u57df\u540d\u7a7a\u683c;\n \n    location /static {\n        alias /home/yangxg/apps/HelloDjango-blog-tutorial/static;\n    }        # alias \u9759\u6001\u6587\u4ef6\u7684\u5b58\u653e\u76ee\u5f55\n \n    location / {\n        proxy_set_header Host $host;\n        proxy_pass http://127.0.0.1:8000;    # \u8f6c\u53d1\uff0cgunicorn\u90e8\u7f72-b\u6b64\u5730\u5740\n    }\n}\n```", "excerpt": "\n\u4ece\u7b2c\u4e00\u6b21\u8d2d\u4e70\u963f\u91cc\u4e91ecs\u5b66\u751f\u673a\u5230\u73b0\u5728\uff0c\u4ece\u670d\u52a1\u5668\u5230\u671f\u6570\u636e\u8fc1\u79fb\u7531\u4e8e\u6570\u636e\u5e93\u8fc1\u79fb\u95ee\u9898\u4e22\u5931\u6570\u636e\u81f3\u4eca\uff0c\u4e00\u6b21\u6b21\u7684\u90e8\u7f72\u79ef\u7d2f\u7684\u4e00\u4e9b\u4e9b\u5c0f\u5c0f\u7ecf\u9a8c\uff0c\u4e00\u6b21\u6b21\u7684\u722c\u5751\uff0c\u505a\u4e86\u8bb0\u5f55\u4ee5\u5907\u540e\u7eed\u90e8\u7f72\u3002\n\n\u7528\u6237\nadduser zhp        # \u65b0\u589e\u7528\u6237\npasswd zhp         # \u7528\u6237\u5bc6\u7801(8\u4f4d)\nusermod ", "codestyle": "monokai", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-20T12:25:18.529", "mod_date": "2020-02-20T17:48:38.431", "views_count": 41, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [3]}}, {"model": "blog.post", "pk": 4, "fields": {"title": "\u5b88\u62a4\u8fdb\u7a0b\u5de5\u5177supervisor", "body": "<h2><a id=\"supervisor_0\"></a>supervisor\u7b80\u4ecb</h2>\n<p>Supervisor\u662f\u7528Python\u5f00\u53d1\u7684\u4e00\u4e2aclient/server\u670d\u52a1\uff0c\u662fLinux/Unix\u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u8fdb\u7a0b\u7ba1\u7406\u5de5\u5177\uff0c\u4e0d\u652f\u6301Windows\u7cfb\u7edf\u3002\u5b83\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u76d1\u542c\u3001\u542f\u52a8\u3001\u505c\u6b62\u3001\u91cd\u542f\u4e00\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b\u3002\u7528Supervisor\u7ba1\u7406\u7684\u8fdb\u7a0b\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u610f\u5916\u88ab\u6740\u6b7b\uff0csupervisort\u76d1\u542c\u5230\u8fdb\u7a0b\u6b7b\u540e\uff0c\u4f1a\u81ea\u52a8\u5c06\u5b83\u91cd\u65b0\u62c9\u8d77\uff0c\u5f88\u65b9\u4fbf\u7684\u505a\u5230\u8fdb\u7a0b\u81ea\u52a8\u6062\u590d\u7684\u529f\u80fd\uff0c\u4e0d\u518d\u9700\u8981\u81ea\u5df1\u5199shell\u811a\u672c\u6765\u63a7\u5236\u3002</p>\n<h2><a id=\"_2\"></a>\u5b89\u88c5</h2>\n<p><code>pip install supervisor</code></p>\n<h2><a id=\"_4\"></a>\u914d\u7f6e</h2>\n<p>\u5728linux\u7528\u6237\u6839\u76ee\u5f55\u4e0b\uff08~\uff09\uff08home/username\uff09\u4e0b\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\u5939\uff08etc\uff09</p>\n<pre><code class=\"lang-\">cd ~/etc                                   # etc\u76ee\u5f55\u4e0b\necho_supervisord_conf &gt; supervisord.conf   # \u521b\u5efasupervisor\u57fa\u7840\u914d\u7f6e\u6587\u4ef6\uff0c\u5305\u62ecconf.d\u4e0b\u7684\u914d\u7f6e\u8def\u5f84\nmkdir -p ~/etc/supervisor/conf.d           # \u9879\u76ee\u5355\u72ec\u914d\u7f6e\u76ee\u5f55\nmkdir -p ~/etc/supervisor/var/log          # \u65e5\u5fd7\u76ee\u5f55\n\n# \u914d\u7f6esupervisord.conf\u6587\u4ef6           \n# [unix_http_server]\u677f\u5757\uff0c\u66f4\u6539sock\u6587\u4ef6\u5730\u5740\nfile=/home/zhp/etc/supervisor/var/supervisor.sock\n# [supervisord]\u677f\u5757\nlogfile=/home/zhp/etc/supervisor/var/log/supervisord.log\npidfile=/home/zhp/etc/supervisor/var/supervisord.pid\nuser=zhp\n# [supervisorctl] \u677f\u5757\nserverurl=unix:///home/zhp/etc/supervisor/var/supervisor.sock\n# [include]\u677f\u5757\uff0c\u65b9\u4fbf\u6a21\u5757\u5316\u7ba1\u7406\nfiles = /home/zhp/etc/supervisor/conf.d/*.ini\n</code></pre>\n<p>\u4ee5\u4e0a\u6a21\u5757\u9700\u8981\u53bb\u6389\u6ce8\u91ca<br />\n\u6b64\u65f6\uff0c\u5df2\u7ecf\u914d\u7f6e\u597d\u901a\u7528\u914d\u7f6e\uff0c\u540e\u7eed\u53ef\u4ee5\u5355\u72ec\u5bf9\u9879\u76ee\u8fdb\u884c\u5355\u72ec\u914d\u7f6e</p>\n<h2><a id=\"_26\"></a>\u9879\u76ee\u914d\u7f6e</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-comment\"># ~/etc/supervisor/conf.d/ app01.ini</span>\n[program:app01]\ncommand=pipenv run gunicorn blogproject.wsgi -w <span class=\"hljs-number\">5</span> -k gthread -b <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">8000</span>\ndirectory=/home/zhp/apps/blogproject\nautostart=true\nautorestart=unexpected\nuser=zhp\nstdout_logfile=/home/zhp/etc/supervisor/var/log/blogproject-stdout.log\nstderr_logfile=/home/zhp/etc/supervisor/var/log/blogproject-stderr.log\n</code></div></pre>\n<p>\u4ee5\u4e0a\u914d\u7f6e\u5185\u5bb9</p>\n<pre><code class=\"lang-\">program         \u7a0b\u5e8f\u540d\u79f0\uff0c\u7ec8\u7aef\u63a7\u5236\u65f6\u9700\u8981\u7684\u6807\u8bc6,\u5373\u662fps\u8fdb\u7a0b\u7684\u540d\u5b57\ncommand         \u7a0b\u5e8f\u8fd0\u884c\u7684\u547d\u4ee4\ndirectory       \u547d\u4ee4\u6267\u884c\u7684\u76ee\u5f55\nautostart       \u968f Supervisor \u542f\u52a8\u81ea\u52a8\u542f\u52a8\u8fdb\u7a0b\nautorestart     \u7a0b\u5e8f\u610f\u5916\u9000\u51fa\u662f\u5426\u81ea\u52a8\u91cd\u542f\nuser            \u8fdb\u7a0b\u6267\u884c\u7684\u7528\u6237\u8eab\u4efd\nstderr_logfile  \u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\nstdout_logfile  \u8f93\u51fa\u65e5\u5fd7\u6587\u4ef6\n</code></pre>\n<h2><a id=\"_50\"></a>\u8fdb\u7a0b\u542f\u52a8</h2>\n<ul>\n<li>supervisord -c ~/etc/supervisord.conf  \u5c06\u4ee5\u914d\u7f6e\u6587\u4ef6\u542f\u52a8supervisord\u7ba1\u7406</li>\n</ul>\n<blockquote>\n<p>ps -ef |grep supervisor \u53ef\u4ee5\u770b\u5230\u8fdb\u7a0b\u8868\u793a\u542f\u52a8\u6210\u529f</p>\n</blockquote>\n<h2><a id=\"_55\"></a>\u7ba1\u7406\u5e94\u7528\u8fdb\u7a0b</h2>\n<ul>\n<li>supervisorctl -c ~/etc/supervisord.conf \u542f\u52a8\u7ba1\u7406\u63a7\u5236\u53f0</li>\n</ul>\n<blockquote>\n<p>update \u66f4\u65b0\u914d\u7f6e\u91cd\u65b0\u542f\u52a8<br />\nstatus \u67e5\u770b\u72b6\u6001<br />\nexit \u9000\u51fa</p>\n</blockquote>\n<h2><a id=\"supervisorctl__61\"></a>supervisorctl \u5e38\u7528\u547d\u4ee4</h2>\n<pre><code class=\"lang-\">supervisorctl restart &lt;application name&gt; ;\u91cd\u542f\u6307\u5b9a\u5e94\u7528\nsupervisorctl stop &lt;application name&gt; ;\u505c\u6b62\u6307\u5b9a\u5e94\u7528\nsupervisorctl start &lt;application name&gt; ;\u542f\u52a8\u6307\u5b9a\u5e94\u7528\nsupervisorctl restart all ;\u91cd\u542f\u6240\u6709\u5e94\u7528\nsupervisorctl stop all ;\u505c\u6b62\u6240\u6709\u5e94\u7528\nsupervisorctl start all ;\u542f\u52a8\u6240\u6709\u5e94\u7528\n</code></pre>\n<h2><a id=\"_71\"></a>\u4e00\u822c\u60c5\u51b5\u4e0b\u66f4\u65b0\u4ee3\u7801\u5230\u670d\u52a1\u5668\u547d\u4ee4</h2>\n<pre><code class=\"lang-\">cd projectdir  //\u8fdb\u5165\u5230\u9879\u76ee\u76ee\u5f55\ngit pull       //\u62c9\u53d6\u8fdc\u7a0b\u4ee3\u7801\npipenv run python manage.py collectstatic     //\u6536\u96c6\u9759\u6001\u6587\u4ef6\nsupervisorctl -c ~/etc/supervisord.conf restart projectname   // \u91cd\u542f\u9879\u76ee\n</code></pre>", "body_md": "## supervisor\u7b80\u4ecb\nSupervisor\u662f\u7528Python\u5f00\u53d1\u7684\u4e00\u4e2aclient/server\u670d\u52a1\uff0c\u662fLinux/Unix\u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u8fdb\u7a0b\u7ba1\u7406\u5de5\u5177\uff0c\u4e0d\u652f\u6301Windows\u7cfb\u7edf\u3002\u5b83\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u76d1\u542c\u3001\u542f\u52a8\u3001\u505c\u6b62\u3001\u91cd\u542f\u4e00\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b\u3002\u7528Supervisor\u7ba1\u7406\u7684\u8fdb\u7a0b\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u610f\u5916\u88ab\u6740\u6b7b\uff0csupervisort\u76d1\u542c\u5230\u8fdb\u7a0b\u6b7b\u540e\uff0c\u4f1a\u81ea\u52a8\u5c06\u5b83\u91cd\u65b0\u62c9\u8d77\uff0c\u5f88\u65b9\u4fbf\u7684\u505a\u5230\u8fdb\u7a0b\u81ea\u52a8\u6062\u590d\u7684\u529f\u80fd\uff0c\u4e0d\u518d\u9700\u8981\u81ea\u5df1\u5199shell\u811a\u672c\u6765\u63a7\u5236\u3002\n## \u5b89\u88c5 \n```pip install supervisor```\n## \u914d\u7f6e\n\u5728linux\u7528\u6237\u6839\u76ee\u5f55\u4e0b\uff08~\uff09\uff08home/username\uff09\u4e0b\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\u5939\uff08etc\uff09\n```\ncd ~/etc                                   # etc\u76ee\u5f55\u4e0b\necho_supervisord_conf > supervisord.conf   # \u521b\u5efasupervisor\u57fa\u7840\u914d\u7f6e\u6587\u4ef6\uff0c\u5305\u62ecconf.d\u4e0b\u7684\u914d\u7f6e\u8def\u5f84\nmkdir -p ~/etc/supervisor/conf.d           # \u9879\u76ee\u5355\u72ec\u914d\u7f6e\u76ee\u5f55\nmkdir -p ~/etc/supervisor/var/log          # \u65e5\u5fd7\u76ee\u5f55\n\n# \u914d\u7f6esupervisord.conf\u6587\u4ef6           \n# [unix_http_server]\u677f\u5757\uff0c\u66f4\u6539sock\u6587\u4ef6\u5730\u5740\nfile=/home/zhp/etc/supervisor/var/supervisor.sock\n# [supervisord]\u677f\u5757\nlogfile=/home/zhp/etc/supervisor/var/log/supervisord.log\npidfile=/home/zhp/etc/supervisor/var/supervisord.pid\nuser=zhp\n# [supervisorctl] \u677f\u5757\nserverurl=unix:///home/zhp/etc/supervisor/var/supervisor.sock\n# [include]\u677f\u5757\uff0c\u65b9\u4fbf\u6a21\u5757\u5316\u7ba1\u7406\nfiles = /home/zhp/etc/supervisor/conf.d/*.ini\n```\n\u4ee5\u4e0a\u6a21\u5757\u9700\u8981\u53bb\u6389\u6ce8\u91ca\n\u6b64\u65f6\uff0c\u5df2\u7ecf\u914d\u7f6e\u597d\u901a\u7528\u914d\u7f6e\uff0c\u540e\u7eed\u53ef\u4ee5\u5355\u72ec\u5bf9\u9879\u76ee\u8fdb\u884c\u5355\u72ec\u914d\u7f6e\n## \u9879\u76ee\u914d\u7f6e\n```py\n# ~/etc/supervisor/conf.d/ app01.ini\n[program:app01]\ncommand=pipenv run gunicorn blogproject.wsgi -w 5 -k gthread -b 127.0.0.1:8000\ndirectory=/home/zhp/apps/blogproject\nautostart=true\nautorestart=unexpected\nuser=zhp\nstdout_logfile=/home/zhp/etc/supervisor/var/log/blogproject-stdout.log\nstderr_logfile=/home/zhp/etc/supervisor/var/log/blogproject-stderr.log\n```\n\u4ee5\u4e0a\u914d\u7f6e\u5185\u5bb9\n```\nprogram         \u7a0b\u5e8f\u540d\u79f0\uff0c\u7ec8\u7aef\u63a7\u5236\u65f6\u9700\u8981\u7684\u6807\u8bc6,\u5373\u662fps\u8fdb\u7a0b\u7684\u540d\u5b57\ncommand         \u7a0b\u5e8f\u8fd0\u884c\u7684\u547d\u4ee4\ndirectory       \u547d\u4ee4\u6267\u884c\u7684\u76ee\u5f55\nautostart       \u968f Supervisor \u542f\u52a8\u81ea\u52a8\u542f\u52a8\u8fdb\u7a0b\nautorestart     \u7a0b\u5e8f\u610f\u5916\u9000\u51fa\u662f\u5426\u81ea\u52a8\u91cd\u542f\nuser            \u8fdb\u7a0b\u6267\u884c\u7684\u7528\u6237\u8eab\u4efd\nstderr_logfile  \u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\nstdout_logfile  \u8f93\u51fa\u65e5\u5fd7\u6587\u4ef6\n```\n\n## \u8fdb\u7a0b\u542f\u52a8\n- supervisord -c ~/etc/supervisord.conf  \u5c06\u4ee5\u914d\u7f6e\u6587\u4ef6\u542f\u52a8supervisord\u7ba1\u7406\n\n>ps -ef |grep supervisor \u53ef\u4ee5\u770b\u5230\u8fdb\u7a0b\u8868\u793a\u542f\u52a8\u6210\u529f\n\n## \u7ba1\u7406\u5e94\u7528\u8fdb\u7a0b\n- supervisorctl -c ~/etc/supervisord.conf \u542f\u52a8\u7ba1\u7406\u63a7\u5236\u53f0\n>update \u66f4\u65b0\u914d\u7f6e\u91cd\u65b0\u542f\u52a8 \n> status \u67e5\u770b\u72b6\u6001\n> exit \u9000\u51fa\n\n## supervisorctl \u5e38\u7528\u547d\u4ee4\n```\nsupervisorctl restart <application name> ;\u91cd\u542f\u6307\u5b9a\u5e94\u7528\nsupervisorctl stop <application name> ;\u505c\u6b62\u6307\u5b9a\u5e94\u7528\nsupervisorctl start <application name> ;\u542f\u52a8\u6307\u5b9a\u5e94\u7528\nsupervisorctl restart all ;\u91cd\u542f\u6240\u6709\u5e94\u7528\nsupervisorctl stop all ;\u505c\u6b62\u6240\u6709\u5e94\u7528\nsupervisorctl start all ;\u542f\u52a8\u6240\u6709\u5e94\u7528\n```\n\n## \u4e00\u822c\u60c5\u51b5\u4e0b\u66f4\u65b0\u4ee3\u7801\u5230\u670d\u52a1\u5668\u547d\u4ee4\n```\ncd projectdir  //\u8fdb\u5165\u5230\u9879\u76ee\u76ee\u5f55\ngit pull       //\u62c9\u53d6\u8fdc\u7a0b\u4ee3\u7801\npipenv run python manage.py collectstatic     //\u6536\u96c6\u9759\u6001\u6587\u4ef6\nsupervisorctl -c ~/etc/supervisord.conf restart projectname   // \u91cd\u542f\u9879\u76ee\n```", "excerpt": "supervisor\u7b80\u4ecb\nSupervisor\u662f\u7528Python\u5f00\u53d1\u7684\u4e00\u4e2aclient/server\u670d\u52a1\uff0c\u662fLinux/Unix\u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u8fdb\u7a0b\u7ba1\u7406\u5de5\u5177\uff0c\u4e0d\u652f\u6301Windows\u7cfb\u7edf\u3002\u5b83\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u76d1\u542c\u3001\u542f\u52a8\u3001\u505c\u6b62\u3001\u91cd\u542f\u4e00\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b\u3002\u7528Supervisor\u7ba1\u7406\u7684\u8fdb\u7a0b\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u610f\u5916\u88ab\u6740\u6b7b\uff0csupervi", "codestyle": "arduino-light", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-20T17:47:22.007", "mod_date": "2020-02-20T21:21:23.277", "views_count": 30, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [3]}}, {"model": "blog.post", "pk": 5, "fields": {"title": "\u77ed\u7f51\u5740\u7cfb\u7edf", "body": "<blockquote>\n<p>\u672c\u7ad9\u4eff\u7167<a href=\"https://dwz.cn/\" target=\"_blank\">\u767e\u5ea6\u77ed\u7f51\u5740</a>\u7cfb\u7edf\uff0c\u5b9e\u73b0\u4e86\u90e8\u5206\u529f\u80fd\uff0c\u5730\u5740<a href=\"https://zhaoheping.com/dwz\" target=\"_blank\">\u77ed\u7f51\u5740</a>\uff0c\u5176\u4e2d\u90e8\u5206\u6ca1\u6709\u5b9e\u73b0\u7684\u529f\u80fd\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u548c\u4e00\u6bb5\u65f6\u95f4\u5185\u76f8\u540c\u7f51\u5740\u7684\u540c\u4e00\u77ed\u7f51\u5740\u8f93\u51fa\u3002</p>\n</blockquote>\n<h2><a id=\"_2\"></a>\u77ed\u7f51\u5740\u7c7b\u7684\u521b\u5efa</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ShortUrl</span>:</span>\n    ID_COUNTER = <span class=\"hljs-string\">\"ShortyUrl::id_counter\"</span>\n    URL_HASH = <span class=\"hljs-string\">\"ShortyUrl::url_hash\"</span>\n    CHARCHOICE = tuple(<span class=\"hljs-string\">'abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>)\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, redisdb)</span>:</span>\n        self.redisdb = redisdb    <span class=\"hljs-comment\"># \u521d\u59cb\u5316\u5b9e\u4f8b\uff0c\u53c2\u6570\u662fredis\u6570\u636e\u5e93</span>\n\n<span class=\"hljs-meta\">    @classmethod</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">transto62</span><span class=\"hljs-params\">(cls,num)</span>:</span>        <span class=\"hljs-comment\"># \u7c7b\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u662f\u4e00\u4e2a64\u8fdb\u5236\u8f6c\u5316\u7684\u65b9\u6cd5\uff0c\u7528\u4e8e\u6570\u5b57\u5230\u5b57\u7b26\u4e32\u7684\u8f6c\u6362</span>\n        res = []\n        <span class=\"hljs-keyword\">while</span> num:\n            num, b = divmod(num, <span class=\"hljs-number\">62</span>)\n            res.append(b)\n        res.reverse()\n        r = <span class=\"hljs-string\">''</span>.join(list(map(<span class=\"hljs-keyword\">lambda</span> x: cls.CHARCHOICE[x], res)))\n        <span class=\"hljs-keyword\">return</span> r\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">shorten</span><span class=\"hljs-params\">(self, url,startnum=<span class=\"hljs-number\">10</span>)</span>:</span>\n        getdefault = self.redisdb.get(ShortUrl.ID_COUNTER)\n        <span class=\"hljs-keyword\">if</span> getdefault:\n            new_id = self.redisdb.incr(ShortUrl.ID_COUNTER)\n        <span class=\"hljs-keyword\">else</span>:\n            self.redisdb.set(ShortUrl.ID_COUNTER,startnum)\n            new_id = startnum\n        short_id = ShortUrl.transto62(new_id)\n        self.redisdb.hset(ShortUrl.URL_HASH, short_id,url)\n        <span class=\"hljs-keyword\">return</span> short_id\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">restore</span><span class=\"hljs-params\">(self, short_id)</span>:</span>\n        <span class=\"hljs-string\">\"\"\"\n        \u6839\u636e\u7ed9\u5b9a\u7684\u77ed\u7f51\u5740 ID \uff0c\u8fd4\u56de\u4e0e\u4e4b\u5bf9\u5e94\u7684\u76ee\u6807\u7f51\u5740\u3002\n        \"\"\"</span>\n        <span class=\"hljs-keyword\">return</span> self.redisdb.hget(ShortUrl.URL_HASH, short_id)\n</code></div></pre>\n<h2><a id=\"_40\"></a>\u89c6\u56fe\u51fd\u6570</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-keyword\">from</span> rest_framework <span class=\"hljs-keyword\">import</span> viewsets\n<span class=\"hljs-keyword\">from</span> rest_framework.response <span class=\"hljs-keyword\">import</span> Response\n\n<span class=\"hljs-keyword\">from</span> django_redis <span class=\"hljs-keyword\">import</span> get_redis_connection\n<span class=\"hljs-keyword\">from</span> .utils <span class=\"hljs-keyword\">import</span> ShortUrl\n\ncoon = get_redis_connection(<span class=\"hljs-string\">\"dwz\"</span>)\ns = ShortUrl(coon)\n\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DwzViewset</span><span class=\"hljs-params\">(viewsets.ViewSet)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">create</span><span class=\"hljs-params\">(self, request, *args, **kwargs)</span>:</span>\n        long_url = request.data.get(<span class=\"hljs-string\">'lurl'</span>)\n        ret = {}\n        <span class=\"hljs-keyword\">if</span> long_url:\n            short_url = s.shorten(long_url, <span class=\"hljs-number\">10000000</span>)\n            ret[<span class=\"hljs-string\">'data'</span>] = short_url\n            ret[<span class=\"hljs-string\">'code'</span>] = <span class=\"hljs-number\">1</span>\n            ret[<span class=\"hljs-string\">'msg'</span>] = <span class=\"hljs-string\">'success'</span>\n        <span class=\"hljs-keyword\">else</span>:\n            ret = {\n                <span class=\"hljs-string\">'code'</span>: <span class=\"hljs-number\">0</span>,\n                <span class=\"hljs-string\">'msg'</span>: <span class=\"hljs-string\">'\u53c2\u6570\u9519\u8bef'</span>\n            }\n        <span class=\"hljs-keyword\">return</span> Response(ret)\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">retrieve</span><span class=\"hljs-params\">(self, request, *args, **kwargs)</span>:</span>\n        show_id = kwargs.get(<span class=\"hljs-string\">'pk'</span>)\n        ret = {<span class=\"hljs-string\">'code'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'data'</span>: <span class=\"hljs-keyword\">None</span>,<span class=\"hljs-string\">'msg'</span>:<span class=\"hljs-string\">'\u672a\u67e5\u8be2\u5230\u4fe1\u606f'</span>}\n        <span class=\"hljs-keyword\">try</span>:\n            res = s.restore(show_id)\n            <span class=\"hljs-keyword\">if</span> res:\n                ret = {<span class=\"hljs-string\">'data'</span>: res, <span class=\"hljs-string\">'code'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'msg'</span>: <span class=\"hljs-string\">'success'</span>}\n        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n            ret = {<span class=\"hljs-string\">'code'</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'msg'</span>: <span class=\"hljs-string\">'\u53c2\u6570\u9519\u8bef'</span>}\n\n        <span class=\"hljs-keyword\">return</span> Response(ret)\n</code></div></pre>", "body_md": "> \u672c\u7ad9\u4eff\u7167[\u767e\u5ea6\u77ed\u7f51\u5740](https://dwz.cn/)\u7cfb\u7edf\uff0c\u5b9e\u73b0\u4e86\u90e8\u5206\u529f\u80fd\uff0c\u5730\u5740[\u77ed\u7f51\u5740](https://zhaoheping.com/dwz)\uff0c\u5176\u4e2d\u90e8\u5206\u6ca1\u6709\u5b9e\u73b0\u7684\u529f\u80fd\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u548c\u4e00\u6bb5\u65f6\u95f4\u5185\u76f8\u540c\u7f51\u5740\u7684\u540c\u4e00\u77ed\u7f51\u5740\u8f93\u51fa\u3002\n\n## \u77ed\u7f51\u5740\u7c7b\u7684\u521b\u5efa\n```py\nclass ShortUrl:\n    ID_COUNTER = \"ShortyUrl::id_counter\"\n    URL_HASH = \"ShortyUrl::url_hash\"\n    CHARCHOICE = tuple('abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ')\n\n    def __init__(self, redisdb):\n        self.redisdb = redisdb    # \u521d\u59cb\u5316\u5b9e\u4f8b\uff0c\u53c2\u6570\u662fredis\u6570\u636e\u5e93\n\n    @classmethod\n    def transto62(cls,num):        # \u7c7b\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u662f\u4e00\u4e2a64\u8fdb\u5236\u8f6c\u5316\u7684\u65b9\u6cd5\uff0c\u7528\u4e8e\u6570\u5b57\u5230\u5b57\u7b26\u4e32\u7684\u8f6c\u6362\n        res = []\n        while num:\n            num, b = divmod(num, 62)\n            res.append(b)\n        res.reverse()\n        r = ''.join(list(map(lambda x: cls.CHARCHOICE[x], res)))\n        return r\n\n    def shorten(self, url,startnum=10):\n        getdefault = self.redisdb.get(ShortUrl.ID_COUNTER)\n        if getdefault:\n            new_id = self.redisdb.incr(ShortUrl.ID_COUNTER)\n        else:\n            self.redisdb.set(ShortUrl.ID_COUNTER,startnum)\n            new_id = startnum\n        short_id = ShortUrl.transto62(new_id)\n        self.redisdb.hset(ShortUrl.URL_HASH, short_id,url)\n        return short_id\n\n    def restore(self, short_id):\n        \"\"\"\n        \u6839\u636e\u7ed9\u5b9a\u7684\u77ed\u7f51\u5740 ID \uff0c\u8fd4\u56de\u4e0e\u4e4b\u5bf9\u5e94\u7684\u76ee\u6807\u7f51\u5740\u3002\n        \"\"\"\n        return self.redisdb.hget(ShortUrl.URL_HASH, short_id)\n```\n\n## \u89c6\u56fe\u51fd\u6570\n```py\nfrom rest_framework import viewsets\nfrom rest_framework.response import Response\n\nfrom django_redis import get_redis_connection\nfrom .utils import ShortUrl\n\ncoon = get_redis_connection(\"dwz\")\ns = ShortUrl(coon)\n\n\nclass DwzViewset(viewsets.ViewSet):\n    def create(self, request, *args, **kwargs):\n        long_url = request.data.get('lurl')\n        ret = {}\n        if long_url:\n            short_url = s.shorten(long_url, 10000000)\n            ret['data'] = short_url\n            ret['code'] = 1\n            ret['msg'] = 'success'\n        else:\n            ret = {\n                'code': 0,\n                'msg': '\u53c2\u6570\u9519\u8bef'\n            }\n        return Response(ret)\n\n    def retrieve(self, request, *args, **kwargs):\n        show_id = kwargs.get('pk')\n        ret = {'code': 2, 'data': None,'msg':'\u672a\u67e5\u8be2\u5230\u4fe1\u606f'}\n        try:\n            res = s.restore(show_id)\n            if res:\n                ret = {'data': res, 'code': 1, 'msg': 'success'}\n        except Exception as e:\n            ret = {'code': 0, 'msg': '\u53c2\u6570\u9519\u8bef'}\n\n        return Response(ret)\n```", "excerpt": "\n\u672c\u7ad9\u4eff\u7167\u767e\u5ea6\u77ed\u7f51\u5740\u7cfb\u7edf\uff0c\u5b9e\u73b0\u4e86\u90e8\u5206\u529f\u80fd\uff0c\u5730\u5740\u77ed\u7f51\u5740\uff0c\u5176\u4e2d\u90e8\u5206\u6ca1\u6709\u5b9e\u73b0\u7684\u529f\u80fd\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u548c\u4e00\u6bb5\u65f6\u95f4\u5185\u76f8\u540c\u7f51\u5740\u7684\u540c\u4e00\u77ed\u7f51\u5740\u8f93\u51fa\u3002\n\n\u77ed\u7f51\u5740\u7c7b\u7684\u521b\u5efa\nclass ShortUrl:\n    ID_COUNTER = \"ShortyUrl::id_counter\"\n    URL_HASH = \"Shor", "codestyle": "atelier-lakeside-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-24T18:57:33.465", "mod_date": "2020-02-24T19:00:58.918", "views_count": 4, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [4, 5]}}, {"model": "blog.post", "pk": 6, "fields": {"title": "PythonInterview", "body": "<p><h3>\u76ee\u5f55</h3><ul><li><a href=\"#Python_1\">Python\u8bed\u8a00\u7279\u6027</a></li><ul><li><a href=\"#1_Python_3\">1 Python\u7684\u51fd\u6570\u53c2\u6570\u4f20\u9012</a></li><li><a href=\"#2_Pythonmetaclass_60\">2 Python\u4e2d\u7684\u5143\u7c7b(metaclass)</a></li><li><a href=\"#3_staticmethodclassmethod_64\">3 @staticmethod\u548c@classmethod</a></li><li><a href=\"#4__100\">4 \u7c7b\u53d8\u91cf\u548c\u5b9e\u4f8b\u53d8\u91cf</a></li><li><a href=\"#5_Python_158\">5 Python\u81ea\u7701</a></li><li><a href=\"#6__174\">6 \u5b57\u5178\u63a8\u5bfc\u5f0f</a></li><li><a href=\"#7_Python_182\">7 Python\u4e2d\u5355\u4e0b\u5212\u7ebf\u548c\u53cc\u4e0b\u5212\u7ebf</a></li><li><a href=\"#8_format_211\">8 \u5b57\u7b26\u4e32\u683c\u5f0f\u5316:%\u548c.format</a></li><li><a href=\"#9__234\">9 \u8fed\u4ee3\u5668\u548c\u751f\u6210\u5668</a></li><li><a href=\"#10_args_and_kwargs_254\">10 `*args` and `**kwargs`</a></li><li><a href=\"#11_AOP_307\">11 \u9762\u5411\u5207\u9762\u7f16\u7a0bAOP\u548c\u88c5\u9970\u5668</a></li><li><a href=\"#12__317\">12 \u9e2d\u5b50\u7c7b\u578b</a></li><li><a href=\"#13_Python_329\">13 Python\u4e2d\u91cd\u8f7d</a></li><li><a href=\"#14__346\">14 \u65b0\u5f0f\u7c7b\u548c\u65e7\u5f0f\u7c7b</a></li><li><a href=\"#15___new____init___381\">15 `__new__`\u548c`__init__`\u7684\u533a\u522b</a></li><li><a href=\"#16__394\">16 \u5355\u4f8b\u6a21\u5f0f</a></li><ul><li><a href=\"#1___new___401\">1 \u4f7f\u7528`__new__`\u65b9\u6cd5</a></li><li><a href=\"#2__415\">2 \u5171\u4eab\u5c5e\u6027</a></li><li><a href=\"#3__432\">3 \u88c5\u9970\u5668\u7248\u672c</a></li><li><a href=\"#4_import_448\">4 import\u65b9\u6cd5</a></li></ul><li><a href=\"#17_Python_468\">17 Python\u4e2d\u7684\u4f5c\u7528\u57df</a></li><li><a href=\"#18_GIL_476\">18 GIL\u7ebf\u7a0b\u5168\u5c40\u9501</a></li><li><a href=\"#19__484\">19 \u534f\u7a0b</a></li><li><a href=\"#20__493\">20 \u95ed\u5305</a></li><li><a href=\"#21_lambda_509\">21 lambda\u51fd\u6570</a></li><li><a href=\"#22_Python_516\">22 Python\u51fd\u6570\u5f0f\u7f16\u7a0b</a></li><li><a href=\"#23_Python_548\">23 Python\u91cc\u7684\u62f7\u8d1d</a></li><li><a href=\"#24_Python_575\">24 Python\u5783\u573e\u56de\u6536\u673a\u5236</a></li><ul><li><a href=\"#1__579\">1 \u5f15\u7528\u8ba1\u6570</a></li><li><a href=\"#2__593\">2 \u6807\u8bb0-\u6e05\u9664\u673a\u5236</a></li><li><a href=\"#3__597\">3 \u5206\u4ee3\u6280\u672f</a></li></ul><li><a href=\"#25_PythonList_606\">25 Python\u7684List</a></li><li><a href=\"#26_Pythonis_610\">26 Python\u7684is</a></li><li><a href=\"#27_readreadlinereadlines_614\">27 read,readline\u548creadlines</a></li><li><a href=\"#28_Python23_620\">28 Python2\u548c3\u7684\u533a\u522b</a></li><li><a href=\"#29_super_init_623\">29 super init</a></li><li><a href=\"#30_range_and_xrange_632\">30 range and xrange</a></li></ul><li><a href=\"#_642\">\u64cd\u4f5c\u7cfb\u7edf</a></li><ul><li><a href=\"#1_selectpollepoll_644\">1 select,poll\u548cepoll</a></li><li><a href=\"#2__664\">2 \u8c03\u5ea6\u7b97\u6cd5</a></li><li><a href=\"#3__679\">3 \u6b7b\u9501</a></li><li><a href=\"#4__703\">4 \u7a0b\u5e8f\u7f16\u8bd1\u4e0e\u94fe\u63a5</a></li><ul><li><a href=\"#1__711\">1 \u9884\u5904\u7406</a></li><li><a href=\"#2__722\">2 \u7f16\u8bd1</a></li><li><a href=\"#3__726\">3 \u6c47\u7f16</a></li><li><a href=\"#4__730\">4 \u94fe\u63a5</a></li></ul><li><a href=\"#5__735\">5 \u9759\u6001\u94fe\u63a5\u548c\u52a8\u6001\u94fe\u63a5</a></li><li><a href=\"#6__742\">6 \u865a\u62df\u5185\u5b58\u6280\u672f</a></li><li><a href=\"#7__746\">7 \u5206\u9875\u548c\u5206\u6bb5</a></li><ul><li><a href=\"#_752\">\u5206\u9875\u4e0e\u5206\u6bb5\u7684\u4e3b\u8981\u533a\u522b</a></li></ul><li><a href=\"#8__758\">8 \u9875\u9762\u7f6e\u6362\u7b97\u6cd5</a></li><li><a href=\"#9__765\">9 \u8fb9\u6cbf\u89e6\u53d1\u548c\u6c34\u5e73\u89e6\u53d1</a></li></ul><li><a href=\"#_769\">\u6570\u636e\u5e93</a></li><ul><li><a href=\"#1__771\">1 \u4e8b\u52a1</a></li><li><a href=\"#2__776\">2 \u6570\u636e\u5e93\u7d22\u5f15</a></li><li><a href=\"#3_Redis_784\">3 Redis\u539f\u7406</a></li><ul><li><a href=\"#Redis_786\">Redis\u662f\u4ec0\u4e48\uff1f</a></li><li><a href=\"#Redis_791\">Redis\u6570\u636e\u5e93</a></li><li><a href=\"#Redis_801\">Redis\u7f3a\u70b9</a></li></ul><li><a href=\"#4__807\">4 \u4e50\u89c2\u9501\u548c\u60b2\u89c2\u9501</a></li><li><a href=\"#5_MVCC_815\">5 MVCC</a></li><ul><li><a href=\"#MySQLhttplibcsdnnetbasemysqlinnodbMVCC_820\">[MySQL](http://lib.csdn.net/base/mysql)\u7684innodb\u5f15\u64ce\u662f\u5982\u4f55\u5b9e\u73b0MVCC\u7684</a></li></ul><li><a href=\"#6_MyISAMInnoDB_841\">6 MyISAM\u548cInnoDB</a></li></ul><li><a href=\"#_850\">\u7f51\u7edc</a></li><ul><li><a href=\"#1__852\">1 \u4e09\u6b21\u63e1\u624b</a></li><li><a href=\"#2__858\">2 \u56db\u6b21\u6325\u624b</a></li><li><a href=\"#3_ARP_869\">3 ARP\u534f\u8bae</a></li><li><a href=\"#4_urlliburllib2_873\">4 urllib\u548curllib2\u7684\u533a\u522b</a></li><li><a href=\"#5_PostGet_881\">5 Post\u548cGet</a></li><li><a href=\"#6_CookieSession_890\">6 Cookie\u548cSession</a></li><li><a href=\"#7_apachenginx_900\">7 apache\u548cnginx\u7684\u533a\u522b</a></li><li><a href=\"#8__915\">8 \u7f51\u7ad9\u7528\u6237\u5bc6\u7801\u4fdd\u5b58</a></li><li><a href=\"#9_HTTPHTTPS_922\">9 HTTP\u548cHTTPS</a></li><li><a href=\"#10_XSRFXSS_938\">10 XSRF\u548cXSS</a></li><li><a href=\"#11__Idempotence_945\">11 \u5e42\u7b49 Idempotence</a></li><li><a href=\"#12_RESTfulSOAPRPC_959\">12 RESTful\u67b6\u6784(SOAP,RPC)</a></li><li><a href=\"#13_SOAP_964\">13 SOAP</a></li><li><a href=\"#14_RPC_968\">14 RPC</a></li><li><a href=\"#15_CGIWSGI_976\">15 CGI\u548cWSGI</a></li><li><a href=\"#16__984\">16 \u4e2d\u95f4\u4eba\u653b\u51fb</a></li><li><a href=\"#17_c10k_990\">17 c10k\u95ee\u9898</a></li><li><a href=\"#18_socket_995\">18 socket</a></li><li><a href=\"#19__1001\">19 \u6d4f\u89c8\u5668\u7f13\u5b58</a></li><li><a href=\"#20_HTTP10HTTP11_1007\">20 HTTP1.0\u548cHTTP1.1</a></li><li><a href=\"#21_Ajax_1064\">21 Ajax</a></li></ul><li><a href=\"#NIX_1067\">*NIX</a></li><ul><li><a href=\"#unixIPC_1069\">unix\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f(IPC)</a></li></ul><li><a href=\"#_1081\">\u6570\u636e\u7ed3\u6784</a></li><ul><li><a href=\"#1__1083\">1 \u7ea2\u9ed1\u6811</a></li></ul><li><a href=\"#_1097\">\u7f16\u7a0b\u9898</a></li><ul><li><a href=\"#1__1099\">1 \u53f0\u9636\u95ee\u9898/\u6590\u6ce2\u90a3\u5951</a></li><li><a href=\"#2__1136\">2 \u53d8\u6001\u53f0\u9636\u95ee\u9898</a></li><li><a href=\"#3__1144\">3 \u77e9\u5f62\u8986\u76d6</a></li><li><a href=\"#4__1154\">4 \u6768\u6c0f\u77e9\u9635\u67e5\u627e</a></li><li><a href=\"#5__1180\">5 \u53bb\u9664\u5217\u8868\u4e2d\u7684\u91cd\u590d\u5143\u7d20</a></li><li><a href=\"#6__1219\">6 \u94fe\u8868\u6210\u5bf9\u8c03\u6362</a></li><li><a href=\"#7__1241\">7 \u521b\u5efa\u5b57\u5178\u7684\u65b9\u6cd5</a></li><ul><li><a href=\"#1__1243\">1 \u76f4\u63a5\u521b\u5efa</a></li><li><a href=\"#2__1249\">2 \u5de5\u5382\u65b9\u6cd5</a></li><li><a href=\"#3_fromkeys_1257\">3 fromkeys()\u65b9\u6cd5</a></li></ul><li><a href=\"#8__1266\">8 \u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u5217\u8868</a></li><li><a href=\"#9__1347\">9 \u4ea4\u53c9\u94fe\u8868\u6c42\u4ea4\u70b9</a></li><li><a href=\"#10__1439\">10 \u4e8c\u5206\u67e5\u627e</a></li><li><a href=\"#11__1465\">11 \u5feb\u6392</a></li><li><a href=\"#12__1486\">12 \u627e\u96f6\u95ee\u9898</a></li><li><a href=\"#13__1516\">13 \u5e7f\u5ea6\u904d\u5386\u548c\u6df1\u5ea6\u904d\u5386\u4e8c\u53c9\u6811</a></li><li><a href=\"#14__1521\">14 \u4e8c\u53c9\u6811\u8282\u70b9</a></li><li><a href=\"#15__1535\">15 \u5c42\u6b21\u904d\u5386</a></li><li><a href=\"#16__1547\">16 \u6df1\u5ea6\u904d\u5386</a></li><li><a href=\"#17__1563\">17 \u524d\u4e2d\u540e\u5e8f\u904d\u5386</a></li><li><a href=\"#18__1608\">18 \u6c42\u6700\u5927\u6811\u6df1</a></li><li><a href=\"#19__1617\">19 \u6c42\u4e24\u68f5\u6811\u662f\u5426\u76f8\u540c</a></li><li><a href=\"#20__1629\">20 \u524d\u5e8f\u4e2d\u5e8f\u6c42\u540e\u5e8f</a></li><li><a href=\"#21__1651\">21 \u5355\u94fe\u8868\u9006\u7f6e</a></li><li><a href=\"#22__1683\">22 \u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u662f\u53d8\u4f4d\u8bcd</a></li><li><a href=\"#23__1767\">23 \u52a8\u6001\u89c4\u5212\u95ee\u9898</a></li></ul></ul></p>\n<h1><a id=\"Python_1\"></a>Python\u8bed\u8a00\u7279\u6027</h1>\n<h2><a id=\"1_Python_3\"></a>1 Python\u7684\u51fd\u6570\u53c2\u6570\u4f20\u9012</h2>\n<p>\u770b\u4e24\u4e2a\u4f8b\u5b50:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">a = <span class=\"hljs-number\">1</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fun</span><span class=\"hljs-params\">(a)</span>:</span>\n    a = <span class=\"hljs-number\">2</span>\nfun(a)\n<span class=\"hljs-keyword\">print</span> a  <span class=\"hljs-comment\"># 1</span>\n</code></div></pre>\n<pre><div class=\"hljs\"><code class=\"lang-python\">a = []\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fun</span><span class=\"hljs-params\">(a)</span>:</span>\n    a.append(<span class=\"hljs-number\">1</span>)\nfun(a)\n<span class=\"hljs-keyword\">print</span> a  <span class=\"hljs-comment\"># [1]</span>\n</code></div></pre>\n<p>\u6240\u6709\u7684\u53d8\u91cf\u90fd\u53ef\u4ee5\u7406\u89e3\u662f\u5185\u5b58\u4e2d\u4e00\u4e2a\u5bf9\u8c61\u7684\u201c\u5f15\u7528\u201d\uff0c\u6216\u8005\uff0c\u4e5f\u53ef\u4ee5\u770b\u4f3cc\u4e2dvoid*\u7684\u611f\u89c9\u3002</p>\n<p>\u901a\u8fc7<code>id</code>\u6765\u770b\u5f15\u7528<code>a</code>\u7684\u5185\u5b58\u5730\u5740\u53ef\u4ee5\u6bd4\u8f83\u7406\u89e3\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">a = <span class=\"hljs-number\">1</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fun</span><span class=\"hljs-params\">(a)</span>:</span>\n    <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"func_in\"</span>,id(a)   <span class=\"hljs-comment\"># func_in 41322472</span>\n    a = <span class=\"hljs-number\">2</span>\n    <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"re-point\"</span>,id(a), id(<span class=\"hljs-number\">2</span>)   <span class=\"hljs-comment\"># re-point 41322448 41322448</span>\n<span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"func_out\"</span>,id(a), id(<span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># func_out 41322472 41322472</span>\nfun(a)\n<span class=\"hljs-keyword\">print</span> a  <span class=\"hljs-comment\"># 1</span>\n</code></div></pre>\n<p>\u6ce8\uff1a\u5177\u4f53\u7684\u503c\u5728\u4e0d\u540c\u7535\u8111\u4e0a\u8fd0\u884c\u65f6\u53ef\u80fd\u4e0d\u540c\u3002</p>\n<p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6267\u884c\u5b8c<code>a = 2</code>\u4e4b\u540e\uff0c<code>a</code>\u5f15\u7528\u4e2d\u4fdd\u5b58\u7684\u503c\uff0c\u5373\u5185\u5b58\u5730\u5740\u53d1\u751f\u53d8\u5316\uff0c\u7531\u539f\u6765<code>1</code>\u5bf9\u8c61\u7684\u6240\u5728\u7684\u5730\u5740\u53d8\u6210\u4e86<code>2</code>\u8fd9\u4e2a\u5b9e\u4f53\u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\u3002</p>\n<p>\u800c\u7b2c2\u4e2a\u4f8b\u5b50<code>a</code>\u5f15\u7528\u4fdd\u5b58\u7684\u5185\u5b58\u503c\u5c31\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">a = []\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fun</span><span class=\"hljs-params\">(a)</span>:</span>\n    <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"func_in\"</span>,id(a)  <span class=\"hljs-comment\"># func_in 53629256</span>\n    a.append(<span class=\"hljs-number\">1</span>)\n<span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"func_out\"</span>,id(a)     <span class=\"hljs-comment\"># func_out 53629256</span>\nfun(a)\n<span class=\"hljs-keyword\">print</span> a  <span class=\"hljs-comment\"># [1]</span>\n</code></div></pre>\n<p>\u8fd9\u91cc\u8bb0\u4f4f\u7684\u662f\u7c7b\u578b\u662f\u5c5e\u4e8e\u5bf9\u8c61\u7684\uff0c\u800c\u4e0d\u662f\u53d8\u91cf\u3002\u800c\u5bf9\u8c61\u6709\u4e24\u79cd,\u201c\u53ef\u66f4\u6539\u201d\uff08mutable\uff09\u4e0e\u201c\u4e0d\u53ef\u66f4\u6539\u201d\uff08immutable\uff09\u5bf9\u8c61\u3002\u5728python\u4e2d\uff0cstrings, tuples, \u548cnumbers\u662f\u4e0d\u53ef\u66f4\u6539\u7684\u5bf9\u8c61\uff0c\u800c list, dict, set \u7b49\u5219\u662f\u53ef\u4ee5\u4fee\u6539\u7684\u5bf9\u8c61\u3002(\u8fd9\u5c31\u662f\u8fd9\u4e2a\u95ee\u9898\u7684\u91cd\u70b9)</p>\n<p>\u5f53\u4e00\u4e2a\u5f15\u7528\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u65f6\u5019,\u51fd\u6570\u81ea\u52a8\u590d\u5236\u4e00\u4efd\u5f15\u7528,\u8fd9\u4e2a\u51fd\u6570\u91cc\u7684\u5f15\u7528\u548c\u5916\u8fb9\u7684\u5f15\u7528\u6ca1\u6709\u534a\u6bdb\u5173\u7cfb\u4e86.\u6240\u4ee5\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u91cc\u51fd\u6570\u628a\u5f15\u7528\u6307\u5411\u4e86\u4e00\u4e2a\u4e0d\u53ef\u53d8\u5bf9\u8c61,\u5f53\u51fd\u6570\u8fd4\u56de\u7684\u65f6\u5019,\u5916\u9762\u7684\u5f15\u7528\u6ca1\u534a\u6bdb\u611f\u89c9.\u800c\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u5c31\u4e0d\u4e00\u6837\u4e86,\u51fd\u6570\u5185\u7684\u5f15\u7528\u6307\u5411\u7684\u662f\u53ef\u53d8\u5bf9\u8c61,\u5bf9\u5b83\u7684\u64cd\u4f5c\u5c31\u548c\u5b9a\u4f4d\u4e86\u6307\u9488\u5730\u5740\u4e00\u6837,\u5728\u5185\u5b58\u91cc\u8fdb\u884c\u4fee\u6539.</p>\n<p>\u5982\u679c\u8fd8\u4e0d\u660e\u767d\u7684\u8bdd,\u8fd9\u91cc\u6709\u66f4\u597d\u7684\u89e3\u91ca: http://stackoverflow.com/questions/986006/how-do-i-pass-a-variable-by-reference</p>\n<h2><a id=\"2_Pythonmetaclass_60\"></a>2 Python\u4e2d\u7684\u5143\u7c7b(metaclass)</h2>\n<p>\u8fd9\u4e2a\u975e\u5e38\u7684\u4e0d\u5e38\u7528,\u4f46\u662f\u50cfORM\u8fd9\u79cd\u590d\u6742\u7684\u7ed3\u6784\u8fd8\u662f\u4f1a\u9700\u8981\u7684,\u8be6\u60c5\u8bf7\u770b:http://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python</p>\n<h2><a id=\"3_staticmethodclassmethod_64\"></a>3 @staticmethod\u548c@classmethod</h2>\n<p>Python\u5176\u5b9e\u67093\u4e2a\u65b9\u6cd5,\u5373\u9759\u6001\u65b9\u6cd5(staticmethod),\u7c7b\u65b9\u6cd5(classmethod)\u548c\u5b9e\u4f8b\u65b9\u6cd5,\u5982\u4e0b:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo</span><span class=\"hljs-params\">(x)</span>:</span>\n    <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"executing foo(%s)\"</span>%(x)\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">A</span><span class=\"hljs-params\">(object)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo</span><span class=\"hljs-params\">(self,x)</span>:</span>\n        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"executing foo(%s,%s)\"</span>%(self,x)\n\n<span class=\"hljs-meta\">    @classmethod</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">class_foo</span><span class=\"hljs-params\">(cls,x)</span>:</span>\n        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"executing class_foo(%s,%s)\"</span>%(cls,x)\n\n<span class=\"hljs-meta\">    @staticmethod</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">static_foo</span><span class=\"hljs-params\">(x)</span>:</span>\n        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"executing static_foo(%s)\"</span>%x\n\na=A()\n\n</code></div></pre>\n<p>\u8fd9\u91cc\u5148\u7406\u89e3\u4e0b\u51fd\u6570\u53c2\u6570\u91cc\u9762\u7684self\u548ccls.\u8fd9\u4e2aself\u548ccls\u662f\u5bf9\u7c7b\u6216\u8005\u5b9e\u4f8b\u7684\u7ed1\u5b9a,\u5bf9\u4e8e\u4e00\u822c\u7684\u51fd\u6570\u6765\u8bf4\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u8c03\u7528<code>foo(x)</code>,\u8fd9\u4e2a\u51fd\u6570\u5c31\u662f\u6700\u5e38\u7528\u7684,\u5b83\u7684\u5de5\u4f5c\u8ddf\u4efb\u4f55\u4e1c\u897f(\u7c7b,\u5b9e\u4f8b)\u65e0\u5173.\u5bf9\u4e8e\u5b9e\u4f8b\u65b9\u6cd5,\u6211\u4eec\u77e5\u9053\u5728\u7c7b\u91cc\u6bcf\u6b21\u5b9a\u4e49\u65b9\u6cd5\u7684\u65f6\u5019\u90fd\u9700\u8981\u7ed1\u5b9a\u8fd9\u4e2a\u5b9e\u4f8b,\u5c31\u662f<code>foo(self, x)</code>,\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u505a\u5462?\u56e0\u4e3a\u5b9e\u4f8b\u65b9\u6cd5\u7684\u8c03\u7528\u79bb\u4e0d\u5f00\u5b9e\u4f8b,\u6211\u4eec\u9700\u8981\u628a\u5b9e\u4f8b\u81ea\u5df1\u4f20\u7ed9\u51fd\u6570,\u8c03\u7528\u7684\u65f6\u5019\u662f\u8fd9\u6837\u7684<code>a.foo(x)</code>(\u5176\u5b9e\u662f<code>foo(a, x)</code>).\u7c7b\u65b9\u6cd5\u4e00\u6837,\u53ea\u4e0d\u8fc7\u5b83\u4f20\u9012\u7684\u662f\u7c7b\u800c\u4e0d\u662f\u5b9e\u4f8b,<code>A.class_foo(x)</code>.\u6ce8\u610f\u8fd9\u91cc\u7684self\u548ccls\u53ef\u4ee5\u66ff\u6362\u522b\u7684\u53c2\u6570,\u4f46\u662fpython\u7684\u7ea6\u5b9a\u662f\u8fd9\u4fe9,\u8fd8\u662f\u4e0d\u8981\u6539\u7684\u597d.</p>\n<p>\u5bf9\u4e8e\u9759\u6001\u65b9\u6cd5\u5176\u5b9e\u548c\u666e\u901a\u7684\u65b9\u6cd5\u4e00\u6837,\u4e0d\u9700\u8981\u5bf9\u8c01\u8fdb\u884c\u7ed1\u5b9a,\u552f\u4e00\u7684\u533a\u522b\u662f\u8c03\u7528\u7684\u65f6\u5019\u9700\u8981\u4f7f\u7528<code>a.static_foo(x)</code>\u6216\u8005<code>A.static_foo(x)</code>\u6765\u8c03\u7528.</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\\</th>\n<th style=\"text-align:left\">\u5b9e\u4f8b\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u7c7b\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u9759\u6001\u65b9\u6cd5</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">a = A()</td>\n<td style=\"text-align:left\">a.foo(x)</td>\n<td style=\"text-align:left\">a.class_foo(x)</td>\n<td style=\"text-align:left\">a.static_foo(x)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">A</td>\n<td style=\"text-align:left\">\u4e0d\u53ef\u7528</td>\n<td style=\"text-align:left\">A.class_foo(x)</td>\n<td style=\"text-align:left\">A.static_foo(x)</td>\n</tr>\n</tbody>\n</table>\n<p>\u66f4\u591a\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898:</p>\n<ol>\n<li>http://stackoverflow.com/questions/136097/what-is-the-difference-between-staticmethod-and-classmethod-in-python</li>\n<li>https://realpython.com/blog/python/instance-class-and-static-methods-demystified/</li>\n</ol>\n<h2><a id=\"4__100\"></a>4 \u7c7b\u53d8\u91cf\u548c\u5b9e\u4f8b\u53d8\u91cf</h2>\n<p><strong>\u7c7b\u53d8\u91cf\uff1a</strong></p>\n<blockquote>\n<p>\u200b\t\u662f\u53ef\u5728\u7c7b\u7684\u6240\u6709\u5b9e\u4f8b\u4e4b\u95f4\u5171\u4eab\u7684\u503c\uff08\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4eec\u4e0d\u662f\u5355\u72ec\u5206\u914d\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\u7684\uff09\u3002\u4f8b\u5982\u4e0b\u4f8b\u4e2d\uff0cnum_of_instance \u5c31\u662f\u7c7b\u53d8\u91cf\uff0c\u7528\u4e8e\u8ddf\u8e2a\u5b58\u5728\u7740\u591a\u5c11\u4e2aTest \u7684\u5b9e\u4f8b\u3002</p>\n</blockquote>\n<p><strong>\u5b9e\u4f8b\u53d8\u91cf\uff1a</strong></p>\n<blockquote>\n<p>\u5b9e\u4f8b\u5316\u4e4b\u540e\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5355\u72ec\u62e5\u6709\u7684\u53d8\u91cf\u3002</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Test</span><span class=\"hljs-params\">(object)</span>:</span>  \n    num_of_instance = <span class=\"hljs-number\">0</span>  \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, name)</span>:</span>  \n        self.name = name  \n        Test.num_of_instance += <span class=\"hljs-number\">1</span>  \n  \n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:  \n    <span class=\"hljs-keyword\">print</span> Test.num_of_instance   <span class=\"hljs-comment\"># 0</span>\n    t1 = Test(<span class=\"hljs-string\">'jack'</span>)  \n    <span class=\"hljs-keyword\">print</span> Test.num_of_instance   <span class=\"hljs-comment\"># 1</span>\n    t2 = Test(<span class=\"hljs-string\">'lucy'</span>)  \n    <span class=\"hljs-keyword\">print</span> t1.name , t1.num_of_instance  <span class=\"hljs-comment\"># jack 2</span>\n    <span class=\"hljs-keyword\">print</span> t2.name , t2.num_of_instance  <span class=\"hljs-comment\"># lucy 2</span>\n</code></div></pre>\n<blockquote>\n<p>\u8865\u5145\u7684\u4f8b\u5b50</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Person</span>:</span>\n    name=<span class=\"hljs-string\">\"aaa\"</span>\n\np1=Person()\np2=Person()\np1.name=<span class=\"hljs-string\">\"bbb\"</span>\n<span class=\"hljs-keyword\">print</span> p1.name  <span class=\"hljs-comment\"># bbb</span>\n<span class=\"hljs-keyword\">print</span> p2.name  <span class=\"hljs-comment\"># aaa</span>\n<span class=\"hljs-keyword\">print</span> Person.name  <span class=\"hljs-comment\"># aaa</span>\n</code></div></pre>\n<p>\u8fd9\u91cc<code>p1.name=&quot;bbb&quot;</code>\u662f\u5b9e\u4f8b\u8c03\u7528\u4e86\u7c7b\u53d8\u91cf,\u8fd9\u5176\u5b9e\u548c\u4e0a\u9762\u7b2c\u4e00\u4e2a\u95ee\u9898\u4e00\u6837,\u5c31\u662f\u51fd\u6570\u4f20\u53c2\u7684\u95ee\u9898,<code>p1.name</code>\u4e00\u5f00\u59cb\u662f\u6307\u5411\u7684\u7c7b\u53d8\u91cf<code>name=&quot;aaa&quot;</code>,\u4f46\u662f\u5728\u5b9e\u4f8b\u7684\u4f5c\u7528\u57df\u91cc\u628a\u7c7b\u53d8\u91cf\u7684\u5f15\u7528\u6539\u53d8\u4e86,\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u5b9e\u4f8b\u53d8\u91cf,self.name\u4e0d\u518d\u5f15\u7528Person\u7684\u7c7b\u53d8\u91cfname\u4e86.</p>\n<p>\u53ef\u4ee5\u770b\u770b\u4e0b\u9762\u7684\u4f8b\u5b50:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Person</span>:</span>\n    name=[]\n\np1=Person()\np2=Person()\np1.name.append(<span class=\"hljs-number\">1</span>)\n<span class=\"hljs-keyword\">print</span> p1.name  <span class=\"hljs-comment\"># [1]</span>\n<span class=\"hljs-keyword\">print</span> p2.name  <span class=\"hljs-comment\"># [1]</span>\n<span class=\"hljs-keyword\">print</span> Person.name  <span class=\"hljs-comment\"># [1]</span>\n</code></div></pre>\n<p>\u53c2\u8003:http://stackoverflow.com/questions/6470428/catch-multiple-exceptions-in-one-line-except-block</p>\n<h2><a id=\"5_Python_158\"></a>5 Python\u81ea\u7701</h2>\n<p>\u8fd9\u4e2a\u4e5f\u662fpython\u5f6a\u608d\u7684\u7279\u6027.</p>\n<p>\u81ea\u7701\u5c31\u662f\u9762\u5411\u5bf9\u8c61\u7684\u8bed\u8a00\u6240\u5199\u7684\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6,\u6240\u80fd\u77e5\u9053\u5bf9\u8c61\u7684\u7c7b\u578b.\u7b80\u5355\u4e00\u53e5\u5c31\u662f\u8fd0\u884c\u65f6\u80fd\u591f\u83b7\u5f97\u5bf9\u8c61\u7684\u7c7b\u578b.\u6bd4\u5982type(),dir(),getattr(),hasattr(),isinstance().</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">a = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>]\nb = {<span class=\"hljs-string\">'a'</span>:<span class=\"hljs-number\">1</span>,<span class=\"hljs-string\">'b'</span>:<span class=\"hljs-number\">2</span>,<span class=\"hljs-string\">'c'</span>:<span class=\"hljs-number\">3</span>}\nc = <span class=\"hljs-keyword\">True</span>\n<span class=\"hljs-keyword\">print</span> type(a),type(b),type(c) <span class=\"hljs-comment\"># &lt;type 'list'&gt; &lt;type 'dict'&gt; &lt;type 'bool'&gt;</span>\n<span class=\"hljs-keyword\">print</span> isinstance(a,list)  <span class=\"hljs-comment\"># True</span>\n</code></div></pre>\n<h2><a id=\"6__174\"></a>6 \u5b57\u5178\u63a8\u5bfc\u5f0f</h2>\n<p>\u53ef\u80fd\u4f60\u89c1\u8fc7\u5217\u8868\u63a8\u5bfc\u65f6,\u5374\u6ca1\u6709\u89c1\u8fc7\u5b57\u5178\u63a8\u5bfc\u5f0f,\u57282.7\u4e2d\u624d\u52a0\u5165\u7684:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">d = {key: value <span class=\"hljs-keyword\">for</span> (key, value) <span class=\"hljs-keyword\">in</span> iterable}\n</code></div></pre>\n<h2><a id=\"7_Python_182\"></a>7 Python\u4e2d\u5355\u4e0b\u5212\u7ebf\u548c\u53cc\u4e0b\u5212\u7ebf</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyClass</span><span class=\"hljs-params\">()</span>:</span>\n<span class=\"hljs-meta\">... </span>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self)</span>:</span>\n<span class=\"hljs-meta\">... </span>            self.__superprivate = <span class=\"hljs-string\">\"Hello\"</span>\n<span class=\"hljs-meta\">... </span>            self._semiprivate = <span class=\"hljs-string\">\", world!\"</span>\n...\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>mc = MyClass()\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span><span class=\"hljs-keyword\">print</span> mc.__superprivate\nTraceback (most recent call last):\n  File <span class=\"hljs-string\">\"&lt;stdin&gt;\"</span>, line <span class=\"hljs-number\">1</span>, <span class=\"hljs-keyword\">in</span> &lt;module&gt;\nAttributeError: myClass instance has no attribute <span class=\"hljs-string\">'__superprivate'</span>\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span><span class=\"hljs-keyword\">print</span> mc._semiprivate\n, world!\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span><span class=\"hljs-keyword\">print</span> mc.__dict__\n{<span class=\"hljs-string\">'_MyClass__superprivate'</span>: <span class=\"hljs-string\">'Hello'</span>, <span class=\"hljs-string\">'_semiprivate'</span>: <span class=\"hljs-string\">', world!'</span>}\n</code></div></pre>\n<p><code>__foo__</code>:\u4e00\u79cd\u7ea6\u5b9a,Python\u5185\u90e8\u7684\u540d\u5b57,\u7528\u6765\u533a\u522b\u5176\u4ed6\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u547d\u540d,\u4ee5\u9632\u51b2\u7a81\uff0c\u5c31\u662f\u4f8b\u5982<code>__init__()</code>,<code>__del__()</code>,<code>__call__()</code>\u8fd9\u4e9b\u7279\u6b8a\u65b9\u6cd5</p>\n<p><code>_foo</code>:\u4e00\u79cd\u7ea6\u5b9a,\u7528\u6765\u6307\u5b9a\u53d8\u91cf\u79c1\u6709.\u7a0b\u5e8f\u5458\u7528\u6765\u6307\u5b9a\u79c1\u6709\u53d8\u91cf\u7684\u4e00\u79cd\u65b9\u5f0f.\u4e0d\u80fd\u7528from module import * \u5bfc\u5165\uff0c\u5176\u4ed6\u65b9\u9762\u548c\u516c\u6709\u4e00\u6837\u8bbf\u95ee\uff1b</p>\n<p><code>__foo</code>:\u8fd9\u4e2a\u6709\u771f\u6b63\u7684\u610f\u4e49:\u89e3\u6790\u5668\u7528<code>_classname__foo</code>\u6765\u4ee3\u66ff\u8fd9\u4e2a\u540d\u5b57,\u4ee5\u533a\u522b\u548c\u5176\u4ed6\u7c7b\u76f8\u540c\u7684\u547d\u540d,\u5b83\u65e0\u6cd5\u76f4\u63a5\u50cf\u516c\u6709\u6210\u5458\u4e00\u6837\u968f\u4fbf\u8bbf\u95ee,\u901a\u8fc7\u5bf9\u8c61\u540d._\u7c7b\u540d__xxx\u8fd9\u6837\u7684\u65b9\u5f0f\u53ef\u4ee5\u8bbf\u95ee.</p>\n<p>\u8be6\u60c5\u89c1:http://stackoverflow.com/questions/1301346/the-meaning-of-a-single-and-a-double-underscore-before-an-object-name-in-python</p>\n<p>\u6216\u8005: http://www.zhihu.com/question/19754941</p>\n<h2><a id=\"8_format_211\"></a>8 \u5b57\u7b26\u4e32\u683c\u5f0f\u5316:%\u548c.format</h2>\n<p>.format\u5728\u8bb8\u591a\u65b9\u9762\u770b\u8d77\u6765\u66f4\u4fbf\u5229.\u5bf9\u4e8e<code>%</code>\u6700\u70e6\u4eba\u7684\u662f\u5b83\u65e0\u6cd5\u540c\u65f6\u4f20\u9012\u4e00\u4e2a\u53d8\u91cf\u548c\u5143\u7ec4.\u4f60\u53ef\u80fd\u4f1a\u60f3\u4e0b\u9762\u7684\u4ee3\u7801\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898:</p>\n<pre><code class=\"lang-\">&quot;hi there %s&quot; % name\n</code></pre>\n<p>\u4f46\u662f,\u5982\u679cname\u6070\u597d\u662f(1,2,3),\u5b83\u5c06\u4f1a\u629b\u51fa\u4e00\u4e2aTypeError\u5f02\u5e38.\u4e3a\u4e86\u4fdd\u8bc1\u5b83\u603b\u662f\u6b63\u786e\u7684,\u4f60\u5fc5\u987b\u8fd9\u6837\u505a:</p>\n<pre><code class=\"lang-\">&quot;hi there %s&quot; % (name,)   # \u63d0\u4f9b\u4e00\u4e2a\u5355\u5143\u7d20\u7684\u6570\u7ec4\u800c\u4e0d\u662f\u4e00\u4e2a\u53c2\u6570\n</code></pre>\n<p>\u4f46\u662f\u6709\u70b9\u4e11\u2026format\u5c31\u6ca1\u6709\u8fd9\u4e9b\u95ee\u9898.\u4f60\u7ed9\u7684\u7b2c\u4e8c\u4e2a\u95ee\u9898\u4e5f\u662f\u8fd9\u6837,.format\u597d\u770b\u591a\u4e86.</p>\n<p>\u4f60\u4e3a\u4ec0\u4e48\u4e0d\u7528\u5b83?</p>\n<ul>\n<li>\u4e0d\u77e5\u9053\u5b83(\u5728\u8bfb\u8fd9\u4e2a\u4e4b\u524d)</li>\n<li>\u4e3a\u4e86\u548cPython2.5\u517c\u5bb9(\u8b6c\u5982logging\u5e93\u5efa\u8bae\u4f7f\u7528<code>%</code>(<a href=\"https://github.com/taizilongxu/interview_python/issues/4\" target=\"_blank\">issue #4</a>))</li>\n</ul>\n<p>http://stackoverflow.com/questions/5082452/python-string-formatting-vs-format</p>\n<h2><a id=\"9__234\"></a>9 \u8fed\u4ee3\u5668\u548c\u751f\u6210\u5668</h2>\n<p>\u8fd9\u4e2a\u662fstackoverflow\u91ccpython\u6392\u540d\u7b2c\u4e00\u7684\u95ee\u9898,\u503c\u5f97\u4e00\u770b: http://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do-in-python</p>\n<p>\u8fd9\u662f\u4e2d\u6587\u7248: http://taizilongxu.gitbooks.io/stackoverflow-about-python/content/1/README.html</p>\n<p>\u8fd9\u91cc\u6709\u4e2a\u5173\u4e8e\u751f\u6210\u5668\u7684\u521b\u5efa\u95ee\u9898\u9762\u8bd5\u5b98\u6709\u8003\uff1a<br />\n\u95ee\uff1a  \u5c06\u5217\u8868\u751f\u6210\u5f0f\u4e2d[]\u6539\u6210() \u4e4b\u540e\u6570\u636e\u7ed3\u6784\u662f\u5426\u6539\u53d8\uff1f<br />\n\u7b54\u6848\uff1a\u662f\uff0c\u4ece\u5217\u8868\u53d8\u4e3a\u751f\u6210\u5668</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span>L = [x*x <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">10</span>)]\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>L\n[<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">16</span>, <span class=\"hljs-number\">25</span>, <span class=\"hljs-number\">36</span>, <span class=\"hljs-number\">49</span>, <span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">81</span>]\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>g = (x*x <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">10</span>))\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>g\n&lt;generator object &lt;genexpr&gt; at <span class=\"hljs-number\">0x0000028F8B774200</span>&gt;\n</code></div></pre>\n<p>\u901a\u8fc7\u5217\u8868\u751f\u6210\u5f0f\uff0c\u53ef\u4ee5\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u5217\u8868\u3002\u4f46\u662f\uff0c\u53d7\u5230\u5185\u5b58\u9650\u5236\uff0c\u5217\u8868\u5bb9\u91cf\u80af\u5b9a\u662f\u6709\u9650\u7684\u3002\u800c\u4e14\uff0c\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u767e\u4e07\u5143\u7d20\u7684\u5217\u8868\uff0c\u4e0d\u4ec5\u662f\u5360\u7528\u5f88\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\uff1a\u6211\u4eec\u53ea\u9700\u8981\u8bbf\u95ee\u524d\u9762\u7684\u51e0\u4e2a\u5143\u7d20\uff0c\u540e\u9762\u5927\u90e8\u5206\u5143\u7d20\u6240\u5360\u7684\u7a7a\u95f4\u90fd\u662f\u6d6a\u8d39\u7684\u3002\u56e0\u6b64\uff0c\u6ca1\u6709\u5fc5\u8981\u521b\u5efa\u5b8c\u6574\u7684\u5217\u8868\uff08\u8282\u7701\u5927\u91cf\u5185\u5b58\u7a7a\u95f4\uff09\u3002\u5728Python\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u751f\u6210\u5668\uff1a\u8fb9\u5faa\u73af\uff0c\u8fb9\u8ba1\u7b97\u7684\u673a\u5236\u2014&gt;generator</p>\n<h2><a id=\"10_args_and_kwargs_254\"></a>10 <code>*args</code> and <code>**kwargs</code></h2>\n<p>\u7528<code>*args</code>\u548c<code>**kwargs</code>\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u5e76\u6ca1\u6709\u5f3a\u5236\u4f7f\u7528\u5b83\u4eec.</p>\n<p>\u5f53\u4f60\u4e0d\u786e\u5b9a\u4f60\u7684\u51fd\u6570\u91cc\u5c06\u8981\u4f20\u9012\u591a\u5c11\u53c2\u6570\u65f6\u4f60\u53ef\u4ee5\u7528<code>*args</code>.\u4f8b\u5982,\u5b83\u53ef\u4ee5\u4f20\u9012\u4efb\u610f\u6570\u91cf\u7684\u53c2\u6570:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">print_everything</span><span class=\"hljs-params\">(*args)</span>:</span>\n        <span class=\"hljs-keyword\">for</span> count, thing <span class=\"hljs-keyword\">in</span> enumerate(args):\n<span class=\"hljs-meta\">... </span>        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">'{0}. {1}'</span>.format(count, thing)\n...\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>print_everything(<span class=\"hljs-string\">'apple'</span>, <span class=\"hljs-string\">'banana'</span>, <span class=\"hljs-string\">'cabbage'</span>)\n<span class=\"hljs-number\">0.</span> apple\n<span class=\"hljs-number\">1.</span> banana\n<span class=\"hljs-number\">2.</span> cabbage\n</code></div></pre>\n<p>\u76f8\u4f3c\u7684,<code>**kwargs</code>\u5141\u8bb8\u4f60\u4f7f\u7528\u6ca1\u6709\u4e8b\u5148\u5b9a\u4e49\u7684\u53c2\u6570\u540d:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">table_things</span><span class=\"hljs-params\">(**kwargs)</span>:</span>\n<span class=\"hljs-meta\">... </span>    <span class=\"hljs-keyword\">for</span> name, value <span class=\"hljs-keyword\">in</span> kwargs.items():\n<span class=\"hljs-meta\">... </span>        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">'{0} = {1}'</span>.format(name, value)\n...\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>table_things(apple = <span class=\"hljs-string\">'fruit'</span>, cabbage = <span class=\"hljs-string\">'vegetable'</span>)\ncabbage = vegetable\napple = fruit\n</code></div></pre>\n<p>\u4f60\u4e5f\u53ef\u4ee5\u6df7\u7740\u7528.\u547d\u540d\u53c2\u6570\u9996\u5148\u83b7\u5f97\u53c2\u6570\u503c\u7136\u540e\u6240\u6709\u7684\u5176\u4ed6\u53c2\u6570\u90fd\u4f20\u9012\u7ed9<code>*args</code>\u548c<code>**kwargs</code>.\u547d\u540d\u53c2\u6570\u5728\u5217\u8868\u7684\u6700\u524d\u7aef.\u4f8b\u5982:</p>\n<pre><code class=\"lang-\">def table_things(titlestring, **kwargs)\n</code></pre>\n<p><code>*args</code>\u548c<code>**kwargs</code>\u53ef\u4ee5\u540c\u65f6\u5728\u51fd\u6570\u7684\u5b9a\u4e49\u4e2d,\u4f46\u662f<code>*args</code>\u5fc5\u987b\u5728<code>**kwargs</code>\u524d\u9762.</p>\n<p>\u5f53\u8c03\u7528\u51fd\u6570\u65f6\u4f60\u4e5f\u53ef\u4ee5\u7528<code>*</code>\u548c<code>**</code>\u8bed\u6cd5.\u4f8b\u5982:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">print_three_things</span><span class=\"hljs-params\">(a, b, c)</span>:</span>\n<span class=\"hljs-meta\">... </span>    <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">'a = {0}, b = {1}, c = {2}'</span>.format(a,b,c)\n...\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>mylist = [<span class=\"hljs-string\">'aardvark'</span>, <span class=\"hljs-string\">'baboon'</span>, <span class=\"hljs-string\">'cat'</span>]\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>print_three_things(*mylist)\n\na = aardvark, b = baboon, c = cat\n</code></div></pre>\n<p>\u5c31\u50cf\u4f60\u770b\u5230\u7684\u4e00\u6837,\u5b83\u53ef\u4ee5\u4f20\u9012\u5217\u8868(\u6216\u8005\u5143\u7ec4)\u7684\u6bcf\u4e00\u9879\u5e76\u628a\u5b83\u4eec\u89e3\u5305.\u6ce8\u610f\u5fc5\u987b\u4e0e\u5b83\u4eec\u5728\u51fd\u6570\u91cc\u7684\u53c2\u6570\u76f8\u543b\u5408.\u5f53\u7136,\u4f60\u4e5f\u53ef\u4ee5\u5728\u51fd\u6570\u5b9a\u4e49\u6216\u8005\u51fd\u6570\u8c03\u7528\u65f6\u7528*.</p>\n<p>http://stackoverflow.com/questions/3394835/args-and-kwargs</p>\n<h2><a id=\"11_AOP_307\"></a>11 \u9762\u5411\u5207\u9762\u7f16\u7a0bAOP\u548c\u88c5\u9970\u5668</h2>\n<p>\u8fd9\u4e2aAOP\u4e00\u542c\u8d77\u6765\u6709\u70b9\u61f5,\u540c\u5b66\u9762\u963f\u91cc\u7684\u65f6\u5019\u5c31\u88ab\u95ee\u61f5\u4e86\u2026</p>\n<p>\u88c5\u9970\u5668\u662f\u4e00\u4e2a\u5f88\u8457\u540d\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7ecf\u5e38\u88ab\u7528\u4e8e\u6709\u5207\u9762\u9700\u6c42\u7684\u573a\u666f\uff0c\u8f83\u4e3a\u7ecf\u5178\u7684\u6709\u63d2\u5165\u65e5\u5fd7\u3001\u6027\u80fd\u6d4b\u8bd5\u3001\u4e8b\u52a1\u5904\u7406\u7b49\u3002\u88c5\u9970\u5668\u662f\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u7684\u7edd\u4f73\u8bbe\u8ba1\uff0c\u6709\u4e86\u88c5\u9970\u5668\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u62bd\u79bb\u51fa\u5927\u91cf\u51fd\u6570\u4e2d\u4e0e\u51fd\u6570\u529f\u80fd\u672c\u8eab\u65e0\u5173\u7684\u96f7\u540c\u4ee3\u7801\u5e76\u7ee7\u7eed\u91cd\u7528\u3002\u6982\u62ec\u7684\u8bb2\uff0c<strong>\u88c5\u9970\u5668\u7684\u4f5c\u7528\u5c31\u662f\u4e3a\u5df2\u7ecf\u5b58\u5728\u7684\u5bf9\u8c61\u6dfb\u52a0\u989d\u5916\u7684\u529f\u80fd\u3002</strong></p>\n<p>\u8fd9\u4e2a\u95ee\u9898\u6bd4\u8f83\u5927,\u63a8\u8350: http://stackoverflow.com/questions/739654/how-can-i-make-a-chain-of-function-decorators-in-python</p>\n<p>\u4e2d\u6587: http://taizilongxu.gitbooks.io/stackoverflow-about-python/content/3/README.html</p>\n<h2><a id=\"12__317\"></a>12 \u9e2d\u5b50\u7c7b\u578b</h2>\n<p>\u201c\u5f53\u770b\u5230\u4e00\u53ea\u9e1f\u8d70\u8d77\u6765\u50cf\u9e2d\u5b50\u3001\u6e38\u6cf3\u8d77\u6765\u50cf\u9e2d\u5b50\u3001\u53eb\u8d77\u6765\u4e5f\u50cf\u9e2d\u5b50\uff0c\u90a3\u4e48\u8fd9\u53ea\u9e1f\u5c31\u53ef\u4ee5\u88ab\u79f0\u4e3a\u9e2d\u5b50\u3002\u201d</p>\n<p>\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u5bf9\u8c61\u662f\u4ec0\u4e48\u7c7b\u578b\uff0c\u5230\u5e95\u662f\u4e0d\u662f\u9e2d\u5b50\uff0c\u53ea\u5173\u5fc3\u884c\u4e3a\u3002</p>\n<p>\u6bd4\u5982\u5728python\u4e2d\uff0c\u6709\u5f88\u591afile-like\u7684\u4e1c\u897f\uff0c\u6bd4\u5982StringIO,GzipFile,socket\u3002\u5b83\u4eec\u6709\u5f88\u591a\u76f8\u540c\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u628a\u5b83\u4eec\u5f53\u4f5c\u6587\u4ef6\u4f7f\u7528\u3002</p>\n<p>\u53c8\u6bd4\u5982list.extend()\u65b9\u6cd5\u4e2d,\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u5b83\u7684\u53c2\u6570\u662f\u4e0d\u662flist,\u53ea\u8981\u5b83\u662f\u53ef\u8fed\u4ee3\u7684,\u6240\u4ee5\u5b83\u7684\u53c2\u6570\u53ef\u4ee5\u662flist/tuple/dict/\u5b57\u7b26\u4e32/\u751f\u6210\u5668\u7b49.</p>\n<p>\u9e2d\u5b50\u7c7b\u578b\u5728\u52a8\u6001\u8bed\u8a00\u4e2d\u7ecf\u5e38\u4f7f\u7528\uff0c\u975e\u5e38\u7075\u6d3b\uff0c\u4f7f\u5f97python\u4e0d\u60f3java\u90a3\u6837\u4e13\u95e8\u53bb\u5f04\u4e00\u5927\u5806\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3002</p>\n<h2><a id=\"13_Python_329\"></a>13 Python\u4e2d\u91cd\u8f7d</h2>\n<p>\u5f15\u81ea\u77e5\u4e4e:http://www.zhihu.com/question/20053359</p>\n<p>\u51fd\u6570\u91cd\u8f7d\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898\u3002</p>\n<ol>\n<li>\u53ef\u53d8\u53c2\u6570\u7c7b\u578b\u3002</li>\n<li>\u53ef\u53d8\u53c2\u6570\u4e2a\u6570\u3002</li>\n</ol>\n<p>\u53e6\u5916\uff0c\u4e00\u4e2a\u57fa\u672c\u7684\u8bbe\u8ba1\u539f\u5219\u662f\uff0c\u4ec5\u4ec5\u5f53\u4e24\u4e2a\u51fd\u6570\u9664\u4e86\u53c2\u6570\u7c7b\u578b\u548c\u53c2\u6570\u4e2a\u6570\u4e0d\u540c\u4ee5\u5916\uff0c\u5176\u529f\u80fd\u662f\u5b8c\u5168\u76f8\u540c\u7684\uff0c\u6b64\u65f6\u624d\u4f7f\u7528\u51fd\u6570\u91cd\u8f7d\uff0c\u5982\u679c\u4e24\u4e2a\u51fd\u6570\u7684\u529f\u80fd\u5176\u5b9e\u4e0d\u540c\uff0c\u90a3\u4e48\u4e0d\u5e94\u5f53\u4f7f\u7528\u91cd\u8f7d\uff0c\u800c\u5e94\u5f53\u4f7f\u7528\u4e00\u4e2a\u540d\u5b57\u4e0d\u540c\u7684\u51fd\u6570\u3002</p>\n<p>\u597d\u5427\uff0c\u90a3\u4e48\u5bf9\u4e8e\u60c5\u51b5 1 \uff0c\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u4f46\u662f\u53c2\u6570\u7c7b\u578b\u4e0d\u540c\uff0cpython \u5982\u4f55\u5904\u7406\uff1f\u7b54\u6848\u662f\u6839\u672c\u4e0d\u9700\u8981\u5904\u7406\uff0c\u56e0\u4e3a python \u53ef\u4ee5\u63a5\u53d7\u4efb\u4f55\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5982\u679c\u51fd\u6570\u7684\u529f\u80fd\u76f8\u540c\uff0c\u90a3\u4e48\u4e0d\u540c\u7684\u53c2\u6570\u7c7b\u578b\u5728 python \u4e2d\u5f88\u53ef\u80fd\u662f\u76f8\u540c\u7684\u4ee3\u7801\uff0c\u6ca1\u6709\u5fc5\u8981\u505a\u6210\u4e24\u4e2a\u4e0d\u540c\u51fd\u6570\u3002</p>\n<p>\u90a3\u4e48\u5bf9\u4e8e\u60c5\u51b5 2 \uff0c\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u4f46\u53c2\u6570\u4e2a\u6570\u4e0d\u540c\uff0cpython \u5982\u4f55\u5904\u7406\uff1f\u5927\u5bb6\u77e5\u9053\uff0c\u7b54\u6848\u5c31\u662f\u7f3a\u7701\u53c2\u6570\u3002\u5bf9\u90a3\u4e9b\u7f3a\u5c11\u7684\u53c2\u6570\u8bbe\u5b9a\u4e3a\u7f3a\u7701\u53c2\u6570\u5373\u53ef\u89e3\u51b3\u95ee\u9898\u3002\u56e0\u4e3a\u4f60\u5047\u8bbe\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u90a3\u4e48\u90a3\u4e9b\u7f3a\u5c11\u7684\u53c2\u6570\u7ec8\u5f52\u662f\u9700\u8981\u7528\u7684\u3002</p>\n<p>\u597d\u4e86\uff0c\u9274\u4e8e\u60c5\u51b5 1 \u8ddf \u60c5\u51b5 2 \u90fd\u6709\u4e86\u89e3\u51b3\u65b9\u6848\uff0cpython \u81ea\u7136\u5c31\u4e0d\u9700\u8981\u51fd\u6570\u91cd\u8f7d\u4e86\u3002</p>\n<h2><a id=\"14__346\"></a>14 \u65b0\u5f0f\u7c7b\u548c\u65e7\u5f0f\u7c7b</h2>\n<p>\u8fd9\u4e2a\u9762\u8bd5\u5b98\u95ee\u4e86,\u6211\u8bf4\u4e86\u8001\u534a\u5929,\u4e0d\u77e5\u9053\u4ed6\u95ee\u7684\u771f\u6b63\u610f\u56fe\u662f\u4ec0\u4e48.</p>\n<p><a href=\"http://stackoverflow.com/questions/54867/what-is-the-difference-between-old-style-and-new-style-classes-in-python\" target=\"_blank\">stackoverflow</a></p>\n<p>\u8fd9\u7bc7\u6587\u7ae0\u5f88\u597d\u7684\u4ecb\u7ecd\u4e86\u65b0\u5f0f\u7c7b\u7684\u7279\u6027: http://www.cnblogs.com/btchenguang/archive/2012/09/17/2689146.html</p>\n<p>\u65b0\u5f0f\u7c7b\u5f88\u65e9\u57282.2\u5c31\u51fa\u73b0\u4e86,\u6240\u4ee5\u65e7\u5f0f\u7c7b\u5b8c\u5168\u662f\u517c\u5bb9\u7684\u95ee\u9898,Python3\u91cc\u7684\u7c7b\u5168\u90e8\u90fd\u662f\u65b0\u5f0f\u7c7b.\u8fd9\u91cc\u6709\u4e00\u4e2aMRO\u95ee\u9898\u53ef\u4ee5\u4e86\u89e3\u4e0b(\u65b0\u5f0f\u7c7b\u7ee7\u627f\u662f\u6839\u636eC3\u7b97\u6cd5,\u65e7\u5f0f\u7c7b\u662f\u6df1\u5ea6\u4f18\u5148),&lt;Python\u6838\u5fc3\u7f16\u7a0b&gt;\u91cc\u8bb2\u7684\u4e5f\u5f88\u591a.</p>\n<blockquote>\n<p>\u4e00\u4e2a\u65e7\u5f0f\u7c7b\u7684\u6df1\u5ea6\u4f18\u5148\u7684\u4f8b\u5b50</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">A</span><span class=\"hljs-params\">()</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo1</span><span class=\"hljs-params\">(self)</span>:</span>\n        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"A\"</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">B</span><span class=\"hljs-params\">(A)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo2</span><span class=\"hljs-params\">(self)</span>:</span>\n        <span class=\"hljs-keyword\">pass</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">C</span><span class=\"hljs-params\">(A)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo1</span><span class=\"hljs-params\">(self)</span>:</span>\n        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"C\"</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">D</span><span class=\"hljs-params\">(B, C)</span>:</span>\n    <span class=\"hljs-keyword\">pass</span>\n\nd = D()\nd.foo1()\n\n<span class=\"hljs-comment\"># A</span>\n</code></div></pre>\n<p><strong>\u6309\u7167\u7ecf\u5178\u7c7b\u7684\u67e5\u627e\u987a\u5e8f<code>\u4ece\u5de6\u5230\u53f3\u6df1\u5ea6\u4f18\u5148</code>\u7684\u89c4\u5219\uff0c\u5728\u8bbf\u95ee<code>d.foo1()</code>\u7684\u65f6\u5019,D\u8fd9\u4e2a\u7c7b\u662f\u6ca1\u6709\u7684\u2026\u90a3\u4e48\u5f80\u4e0a\u67e5\u627e,\u5148\u627e\u5230B,\u91cc\u9762\u6ca1\u6709,\u6df1\u5ea6\u4f18\u5148,\u8bbf\u95eeA,\u627e\u5230\u4e86foo1(),\u6240\u4ee5\u8fd9\u65f6\u5019\u8c03\u7528\u7684\u662fA\u7684foo1()\uff0c\u4ece\u800c\u5bfc\u81f4C\u91cd\u5199\u7684foo1()\u88ab\u7ed5\u8fc7</strong></p>\n<h2><a id=\"15___new____init___381\"></a>15 <code>__new__</code>\u548c<code>__init__</code>\u7684\u533a\u522b</h2>\n<p>\u8fd9\u4e2a<code>__new__</code>\u786e\u5b9e\u5f88\u5c11\u89c1\u5230,\u5148\u505a\u4e86\u89e3\u5427.</p>\n<ol>\n<li><code>__new__</code>\u662f\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5,\u800c<code>__init__</code>\u662f\u4e00\u4e2a\u5b9e\u4f8b\u65b9\u6cd5.</li>\n<li><code>__new__</code>\u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e00\u4e2a\u521b\u5efa\u7684\u5b9e\u4f8b,\u800c<code>__init__</code>\u4ec0\u4e48\u90fd\u4e0d\u8fd4\u56de.</li>\n<li>\u53ea\u6709\u5728<code>__new__</code>\u8fd4\u56de\u4e00\u4e2acls\u7684\u5b9e\u4f8b\u65f6\u540e\u9762\u7684<code>__init__</code>\u624d\u80fd\u88ab\u8c03\u7528.</li>\n<li>\u5f53\u521b\u5efa\u4e00\u4e2a\u65b0\u5b9e\u4f8b\u65f6\u8c03\u7528<code>__new__</code>,\u521d\u59cb\u5316\u4e00\u4e2a\u5b9e\u4f8b\u65f6\u7528<code>__init__</code>.</li>\n</ol>\n<p><a href=\"http://stackoverflow.com/questions/674304/pythons-use-of-new-and-init\" target=\"_blank\">stackoverflow</a></p>\n<p>ps: <code>__metaclass__</code>\u662f\u521b\u5efa\u7c7b\u65f6\u8d77\u4f5c\u7528.\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5206\u522b\u4f7f\u7528<code>__metaclass__</code>,<code>__new__</code>\u548c<code>__init__</code>\u6765\u5206\u522b\u5728\u7c7b\u521b\u5efa,\u5b9e\u4f8b\u521b\u5efa\u548c\u5b9e\u4f8b\u521d\u59cb\u5316\u7684\u65f6\u5019\u505a\u4e00\u4e9b\u5c0f\u624b\u811a.</p>\n<h2><a id=\"16__394\"></a>16 \u5355\u4f8b\u6a21\u5f0f</h2>\n<blockquote>\n<p>\u200b\t\u5355\u4f8b\u6a21\u5f0f\u662f\u4e00\u79cd\u5e38\u7528\u7684\u8f6f\u4ef6\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5728\u5b83\u7684\u6838\u5fc3\u7ed3\u6784\u4e2d\u53ea\u5305\u542b\u4e00\u4e2a\u88ab\u79f0\u4e3a\u5355\u4f8b\u7c7b\u7684\u7279\u6b8a\u7c7b\u3002\u901a\u8fc7\u5355\u4f8b\u6a21\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u4e2d\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u800c\u4e14\u8be5\u5b9e\u4f8b\u6613\u4e8e\u5916\u754c\u8bbf\u95ee\uff0c\u4ece\u800c\u65b9\u4fbf\u5bf9\u5b9e\u4f8b\u4e2a\u6570\u7684\u63a7\u5236\u5e76\u8282\u7ea6\u7cfb\u7edf\u8d44\u6e90\u3002\u5982\u679c\u5e0c\u671b\u5728\u7cfb\u7edf\u4e2d\u67d0\u4e2a\u7c7b\u7684\u5bf9\u8c61\u53ea\u80fd\u5b58\u5728\u4e00\u4e2a\uff0c\u5355\u4f8b\u6a21\u5f0f\u662f\u6700\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002</p>\n<p><code>__new__()</code>\u5728<code>__init__()</code>\u4e4b\u524d\u88ab\u8c03\u7528\uff0c\u7528\u4e8e\u751f\u6210\u5b9e\u4f8b\u5bf9\u8c61\u3002\u5229\u7528\u8fd9\u4e2a\u65b9\u6cd5\u548c\u7c7b\u7684\u5c5e\u6027\u7684\u7279\u70b9\u53ef\u4ee5\u5b9e\u73b0\u8bbe\u8ba1\u6a21\u5f0f\u7684\u5355\u4f8b\u6a21\u5f0f\u3002\u5355\u4f8b\u6a21\u5f0f\u662f\u6307\u521b\u5efa\u552f\u4e00\u5bf9\u8c61\uff0c\u5355\u4f8b\u6a21\u5f0f\u8bbe\u8ba1\u7684\u7c7b\u53ea\u80fd\u5b9e\u4f8b<br />\n<strong>\u8fd9\u4e2a\u7edd\u5bf9\u5e38\u8003\u554a.\u7edd\u5bf9\u8981\u8bb0\u4f4f1~2\u4e2a\u65b9\u6cd5,\u5f53\u65f6\u9762\u8bd5\u5b98\u662f\u8ba9\u624b\u5199\u7684.</strong></p>\n</blockquote>\n<h3><a id=\"1___new___401\"></a>1 \u4f7f\u7528<code>__new__</code>\u65b9\u6cd5</h3>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Singleton</span><span class=\"hljs-params\">(object)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__new__</span><span class=\"hljs-params\">(cls, *args, **kw)</span>:</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> hasattr(cls, <span class=\"hljs-string\">'_instance'</span>):\n            orig = super(Singleton, cls)\n            cls._instance = orig.__new__(cls, *args, **kw)\n        <span class=\"hljs-keyword\">return</span> cls._instance\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyClass</span><span class=\"hljs-params\">(Singleton)</span>:</span>\n    a = <span class=\"hljs-number\">1</span>\n</code></div></pre>\n<h3><a id=\"2__415\"></a>2 \u5171\u4eab\u5c5e\u6027</h3>\n<p>\u521b\u5efa\u5b9e\u4f8b\u65f6\u628a\u6240\u6709\u5b9e\u4f8b\u7684<code>__dict__</code>\u6307\u5411\u540c\u4e00\u4e2a\u5b57\u5178,\u8fd9\u6837\u5b83\u4eec\u5177\u6709\u76f8\u540c\u7684\u5c5e\u6027\u548c\u65b9\u6cd5.</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Borg</span><span class=\"hljs-params\">(object)</span>:</span>\n    _state = {}\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__new__</span><span class=\"hljs-params\">(cls, *args, **kw)</span>:</span>\n        ob = super(Borg, cls).__new__(cls, *args, **kw)\n        ob.__dict__ = cls._state\n        <span class=\"hljs-keyword\">return</span> ob\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyClass2</span><span class=\"hljs-params\">(Borg)</span>:</span>\n    a = <span class=\"hljs-number\">1</span>\n</code></div></pre>\n<h3><a id=\"3__432\"></a>3 \u88c5\u9970\u5668\u7248\u672c</h3>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">singleton</span><span class=\"hljs-params\">(cls)</span>:</span>\n    instances = {}\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">getinstance</span><span class=\"hljs-params\">(*args, **kw)</span>:</span>\n        <span class=\"hljs-keyword\">if</span> cls <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> instances:\n            instances[cls] = cls(*args, **kw)\n        <span class=\"hljs-keyword\">return</span> instances[cls]\n    <span class=\"hljs-keyword\">return</span> getinstance\n\n<span class=\"hljs-meta\">@singleton</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyClass</span>:</span>\n  ...\n</code></div></pre>\n<h3><a id=\"4_import_448\"></a>4 import\u65b9\u6cd5</h3>\n<p>\u4f5c\u4e3apython\u7684\u6a21\u5757\u662f\u5929\u7136\u7684\u5355\u4f8b\u6a21\u5f0f</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-comment\"># mysingleton.py</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">My_Singleton</span><span class=\"hljs-params\">(object)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">foo</span><span class=\"hljs-params\">(self)</span>:</span>\n        <span class=\"hljs-keyword\">pass</span>\n\nmy_singleton = My_Singleton()\n\n<span class=\"hljs-comment\"># to use</span>\n<span class=\"hljs-keyword\">from</span> mysingleton <span class=\"hljs-keyword\">import</span> my_singleton\n\nmy_singleton.foo()\n\n</code></div></pre>\n<p><strong><a href=\"http://python.jobbole.com/87294/\" target=\"_blank\">\u5355\u4f8b\u6a21\u5f0f\u4f2f\u4e50\u5728\u7ebf\u8be6\u7ec6\u89e3\u91ca</a></strong></p>\n<h2><a id=\"17_Python_468\"></a>17 Python\u4e2d\u7684\u4f5c\u7528\u57df</h2>\n<p>Python \u4e2d\uff0c\u4e00\u4e2a\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u603b\u662f\u7531\u5728\u4ee3\u7801\u4e2d\u88ab\u8d4b\u503c\u7684\u5730\u65b9\u6240\u51b3\u5b9a\u7684\u3002</p>\n<p>\u5f53 Python \u9047\u5230\u4e00\u4e2a\u53d8\u91cf\u7684\u8bdd\u4ed6\u4f1a\u6309\u7167\u8fd9\u6837\u7684\u987a\u5e8f\u8fdb\u884c\u641c\u7d22\uff1a</p>\n<p>\u672c\u5730\u4f5c\u7528\u57df\uff08Local\uff09\u2192\u5f53\u524d\u4f5c\u7528\u57df\u88ab\u5d4c\u5165\u7684\u672c\u5730\u4f5c\u7528\u57df\uff08Enclosing locals\uff09\u2192\u5168\u5c40/\u6a21\u5757\u4f5c\u7528\u57df\uff08Global\uff09\u2192\u5185\u7f6e\u4f5c\u7528\u57df\uff08Built-in\uff09</p>\n<h2><a id=\"18_GIL_476\"></a>18 GIL\u7ebf\u7a0b\u5168\u5c40\u9501</h2>\n<p>\u7ebf\u7a0b\u5168\u5c40\u9501(Global Interpreter Lock),\u5373Python\u4e3a\u4e86\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u800c\u91c7\u53d6\u7684\u72ec\u7acb\u7ebf\u7a0b\u8fd0\u884c\u7684\u9650\u5236,\u8bf4\u767d\u4e86\u5c31\u662f\u4e00\u4e2a\u6838\u53ea\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u8fd0\u884c\u4e00\u4e2a\u7ebf\u7a0b.<strong>\u5bf9\u4e8eio\u5bc6\u96c6\u578b\u4efb\u52a1\uff0cpython\u7684\u591a\u7ebf\u7a0b\u8d77\u5230\u4f5c\u7528\uff0c\u4f46\u5bf9\u4e8ecpu\u5bc6\u96c6\u578b\u4efb\u52a1\uff0cpython\u7684\u591a\u7ebf\u7a0b\u51e0\u4e4e\u5360\u4e0d\u5230\u4efb\u4f55\u4f18\u52bf\uff0c\u8fd8\u6709\u53ef\u80fd\u56e0\u4e3a\u4e89\u593a\u8d44\u6e90\u800c\u53d8\u6162\u3002</strong></p>\n<p>\u89c1<a href=\"http://www.oschina.net/translate/pythons-hardest-problem\" target=\"_blank\">Python \u6700\u96be\u7684\u95ee\u9898</a></p>\n<p>\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u591a\u8fdb\u7a0b\u548c\u4e0b\u9762\u7684\u534f\u7a0b(\u534f\u7a0b\u4e5f\u53ea\u662f\u5355CPU,\u4f46\u662f\u80fd\u51cf\u5c0f\u5207\u6362\u4ee3\u4ef7\u63d0\u5347\u6027\u80fd).</p>\n<h2><a id=\"19__484\"></a>19 \u534f\u7a0b</h2>\n<p>\u77e5\u4e4e\u88ab\u95ee\u5230\u4e86,\u5475\u5475\u54d2,\u8dea\u4e86</p>\n<p>\u7b80\u5355\u70b9\u8bf4\u534f\u7a0b\u662f\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u5347\u7ea7\u7248,\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u90fd\u9762\u4e34\u7740\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u7684\u5207\u6362\u95ee\u9898\u800c\u8017\u8d39\u8bb8\u591a\u5207\u6362\u65f6\u95f4,\u800c\u534f\u7a0b\u5c31\u662f\u7528\u6237\u81ea\u5df1\u63a7\u5236\u5207\u6362\u7684\u65f6\u673a,\u4e0d\u518d\u9700\u8981\u9677\u5165\u7cfb\u7edf\u7684\u5185\u6838\u6001.</p>\n<p>Python\u91cc\u6700\u5e38\u89c1\u7684yield\u5c31\u662f\u534f\u7a0b\u7684\u601d\u60f3!\u53ef\u4ee5\u67e5\u770b\u7b2c\u4e5d\u4e2a\u95ee\u9898.</p>\n<h2><a id=\"20__493\"></a>20 \u95ed\u5305</h2>\n<p>\u95ed\u5305(closure)\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u91cd\u8981\u7684\u8bed\u6cd5\u7ed3\u6784\u3002\u95ed\u5305\u4e5f\u662f\u4e00\u79cd\u7ec4\u7ec7\u4ee3\u7801\u7684\u7ed3\u6784\uff0c\u5b83\u540c\u6837\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u53ef\u91cd\u590d\u4f7f\u7528\u6027\u3002</p>\n<p>\u5f53\u4e00\u4e2a\u5185\u5d4c\u51fd\u6570\u5f15\u7528\u5176\u5916\u90e8\u4f5c\u4f5c\u7528\u57df\u7684\u53d8\u91cf,\u6211\u4eec\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u95ed\u5305. \u603b\u7ed3\u4e00\u4e0b,\u521b\u5efa\u4e00\u4e2a\u95ed\u5305\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u51e0\u70b9:</p>\n<ol>\n<li>\u5fc5\u987b\u6709\u4e00\u4e2a\u5185\u5d4c\u51fd\u6570</li>\n<li>\u5185\u5d4c\u51fd\u6570\u5fc5\u987b\u5f15\u7528\u5916\u90e8\u51fd\u6570\u4e2d\u7684\u53d8\u91cf</li>\n<li>\u5916\u90e8\u51fd\u6570\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u662f\u5185\u5d4c\u51fd\u6570</li>\n</ol>\n<p>\u611f\u89c9\u95ed\u5305\u8fd8\u662f\u6709\u96be\u5ea6\u7684,\u51e0\u53e5\u8bdd\u662f\u8bf4\u4e0d\u660e\u767d\u7684,\u8fd8\u662f\u67e5\u67e5\u76f8\u5173\u8d44\u6599.</p>\n<p>\u91cd\u70b9\u662f\u51fd\u6570\u8fd0\u884c\u540e\u5e76\u4e0d\u4f1a\u88ab\u64a4\u9500,\u5c31\u50cf16\u9898\u7684instance\u5b57\u5178\u4e00\u6837,\u5f53\u51fd\u6570\u8fd0\u884c\u5b8c\u540e,instance\u5e76\u4e0d\u88ab\u9500\u6bc1,\u800c\u662f\u7ee7\u7eed\u7559\u5728\u5185\u5b58\u7a7a\u95f4\u91cc.\u8fd9\u4e2a\u529f\u80fd\u7c7b\u4f3c\u7c7b\u91cc\u7684\u7c7b\u53d8\u91cf,\u53ea\u4e0d\u8fc7\u8fc1\u79fb\u5230\u4e86\u51fd\u6570\u4e0a.</p>\n<p>\u95ed\u5305\u5c31\u50cf\u4e2a\u7a7a\u5fc3\u7403\u4e00\u6837,\u4f60\u77e5\u9053\u5916\u9762\u548c\u91cc\u9762,\u4f46\u4f60\u4e0d\u77e5\u9053\u4e2d\u95f4\u662f\u4ec0\u4e48\u6837.</p>\n<h2><a id=\"21_lambda_509\"></a>21 lambda\u51fd\u6570</h2>\n<p>\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u533f\u540d\u51fd\u6570,\u4e3a\u4ec0\u4e48\u53eblambda?\u56e0\u4e3a\u548c\u540e\u9762\u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\u6709\u5173.</p>\n<p>\u63a8\u8350: <a href=\"http://www.zhihu.com/question/20125256\" target=\"_blank\">\u77e5\u4e4e</a></p>\n<h2><a id=\"22_Python_516\"></a>22 Python\u51fd\u6570\u5f0f\u7f16\u7a0b</h2>\n<p>\u8fd9\u4e2a\u9700\u8981\u9002\u5f53\u7684\u4e86\u89e3\u4e00\u4e0b\u5427,\u6bd5\u7adf\u51fd\u6570\u5f0f\u7f16\u7a0b\u5728Python\u4e2d\u4e5f\u505a\u4e86\u5f15\u7528.</p>\n<p>\u63a8\u8350: <a href=\"http://coolshell.cn/articles/10822.html\" target=\"_blank\">\u9177\u58f3</a></p>\n<p>python\u4e2d\u51fd\u6570\u5f0f\u7f16\u7a0b\u652f\u6301:</p>\n<p>filter \u51fd\u6570\u7684\u529f\u80fd\u76f8\u5f53\u4e8e\u8fc7\u6ee4\u5668\u3002\u8c03\u7528\u4e00\u4e2a\u5e03\u5c14\u51fd\u6570<code>bool_func</code>\u6765\u8fed\u4ee3\u904d\u5386\u6bcf\u4e2aseq\u4e2d\u7684\u5143\u7d20\uff1b\u8fd4\u56de\u4e00\u4e2a\u4f7f<code>bool_seq</code>\u8fd4\u56de\u503c\u4e3atrue\u7684\u5143\u7d20\u7684\u5e8f\u5217\u3002</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">&gt;&gt;&gt;a = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span>]\n&gt;&gt;&gt;b = filter(<span class=\"hljs-keyword\">lambda</span> x: x &gt; <span class=\"hljs-number\">5</span>, a)\n&gt;&gt;&gt;<span class=\"hljs-keyword\">print</span> b\n&gt;&gt;&gt;[<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span>]\n</code></div></pre>\n<p>map\u51fd\u6570\u662f\u5bf9\u4e00\u4e2a\u5e8f\u5217\u7684\u6bcf\u4e2a\u9879\u4f9d\u6b21\u6267\u884c\u51fd\u6570\uff0c\u4e0b\u9762\u662f\u5bf9\u4e00\u4e2a\u5e8f\u5217\u6bcf\u4e2a\u9879\u90fd\u4e58\u4ee52\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span>a = map(<span class=\"hljs-keyword\">lambda</span> x:x*<span class=\"hljs-number\">2</span>,[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>])\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>list(a)\n[<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">6</span>]\n</code></div></pre>\n<p>reduce\u51fd\u6570\u662f\u5bf9\u4e00\u4e2a\u5e8f\u5217\u7684\u6bcf\u4e2a\u9879\u8fed\u4ee3\u8c03\u7528\u51fd\u6570\uff0c\u4e0b\u9762\u662f\u6c423\u7684\u9636\u4e58\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span>reduce(<span class=\"hljs-keyword\">lambda</span> x,y:x*y,range(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">4</span>))\n<span class=\"hljs-number\">6</span>\n</code></div></pre>\n<h2><a id=\"23_Python_548\"></a>23 Python\u91cc\u7684\u62f7\u8d1d</h2>\n<p>\u5f15\u7528\u548ccopy(),deepcopy()\u7684\u533a\u522b</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-keyword\">import</span> copy\na = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, [<span class=\"hljs-string\">'a'</span>, <span class=\"hljs-string\">'b'</span>]]  <span class=\"hljs-comment\">#\u539f\u59cb\u5bf9\u8c61</span>\n\nb = a  <span class=\"hljs-comment\">#\u8d4b\u503c\uff0c\u4f20\u5bf9\u8c61\u7684\u5f15\u7528</span>\nc = copy.copy(a)  <span class=\"hljs-comment\">#\u5bf9\u8c61\u62f7\u8d1d\uff0c\u6d45\u62f7\u8d1d</span>\nd = copy.deepcopy(a)  <span class=\"hljs-comment\">#\u5bf9\u8c61\u62f7\u8d1d\uff0c\u6df1\u62f7\u8d1d</span>\n\na.append(<span class=\"hljs-number\">5</span>)  <span class=\"hljs-comment\">#\u4fee\u6539\u5bf9\u8c61a</span>\na[<span class=\"hljs-number\">4</span>].append(<span class=\"hljs-string\">'c'</span>)  <span class=\"hljs-comment\">#\u4fee\u6539\u5bf9\u8c61a\u4e2d\u7684['a', 'b']\u6570\u7ec4\u5bf9\u8c61</span>\n\n<span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">'a = '</span>, a\n<span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">'b = '</span>, b\n<span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">'c = '</span>, c\n<span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">'d = '</span>, d\n\n\u8f93\u51fa\u7ed3\u679c\uff1a\na =  [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, [<span class=\"hljs-string\">'a'</span>, <span class=\"hljs-string\">'b'</span>, <span class=\"hljs-string\">'c'</span>], <span class=\"hljs-number\">5</span>]\nb =  [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, [<span class=\"hljs-string\">'a'</span>, <span class=\"hljs-string\">'b'</span>, <span class=\"hljs-string\">'c'</span>], <span class=\"hljs-number\">5</span>]\nc =  [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, [<span class=\"hljs-string\">'a'</span>, <span class=\"hljs-string\">'b'</span>, <span class=\"hljs-string\">'c'</span>]]\nd =  [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, [<span class=\"hljs-string\">'a'</span>, <span class=\"hljs-string\">'b'</span>]]\n</code></div></pre>\n<h2><a id=\"24_Python_575\"></a>24 Python\u5783\u573e\u56de\u6536\u673a\u5236</h2>\n<p>Python GC\u4e3b\u8981\u4f7f\u7528\u5f15\u7528\u8ba1\u6570\uff08reference counting\uff09\u6765\u8ddf\u8e2a\u548c\u56de\u6536\u5783\u573e\u3002\u5728\u5f15\u7528\u8ba1\u6570\u7684\u57fa\u7840\u4e0a\uff0c\u901a\u8fc7\u201c\u6807\u8bb0-\u6e05\u9664\u201d\uff08mark and sweep\uff09\u89e3\u51b3\u5bb9\u5668\u5bf9\u8c61\u53ef\u80fd\u4ea7\u751f\u7684\u5faa\u73af\u5f15\u7528\u95ee\u9898\uff0c\u901a\u8fc7\u201c\u5206\u4ee3\u56de\u6536\u201d\uff08generation collection\uff09\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u65b9\u6cd5\u63d0\u9ad8\u5783\u573e\u56de\u6536\u6548\u7387\u3002</p>\n<h3><a id=\"1__579\"></a>1 \u5f15\u7528\u8ba1\u6570</h3>\n<p>PyObject\u662f\u6bcf\u4e2a\u5bf9\u8c61\u5fc5\u6709\u7684\u5185\u5bb9\uff0c\u5176\u4e2d<code>ob_refcnt</code>\u5c31\u662f\u505a\u4e3a\u5f15\u7528\u8ba1\u6570\u3002\u5f53\u4e00\u4e2a\u5bf9\u8c61\u6709\u65b0\u7684\u5f15\u7528\u65f6\uff0c\u5b83\u7684<code>ob_refcnt</code>\u5c31\u4f1a\u589e\u52a0\uff0c\u5f53\u5f15\u7528\u5b83\u7684\u5bf9\u8c61\u88ab\u5220\u9664\uff0c\u5b83\u7684<code>ob_refcnt</code>\u5c31\u4f1a\u51cf\u5c11.\u5f15\u7528\u8ba1\u6570\u4e3a0\u65f6\uff0c\u8be5\u5bf9\u8c61\u751f\u547d\u5c31\u7ed3\u675f\u4e86\u3002</p>\n<p>\u4f18\u70b9:</p>\n<ol>\n<li>\u7b80\u5355</li>\n<li>\u5b9e\u65f6\u6027</li>\n</ol>\n<p>\u7f3a\u70b9:</p>\n<ol>\n<li>\u7ef4\u62a4\u5f15\u7528\u8ba1\u6570\u6d88\u8017\u8d44\u6e90</li>\n<li>\u5faa\u73af\u5f15\u7528</li>\n</ol>\n<h3><a id=\"2__593\"></a>2 \u6807\u8bb0-\u6e05\u9664\u673a\u5236</h3>\n<p>\u57fa\u672c\u601d\u8def\u662f\u5148\u6309\u9700\u5206\u914d\uff0c\u7b49\u5230\u6ca1\u6709\u7a7a\u95f2\u5185\u5b58\u7684\u65f6\u5019\u4ece\u5bc4\u5b58\u5668\u548c\u7a0b\u5e8f\u6808\u4e0a\u7684\u5f15\u7528\u51fa\u53d1\uff0c\u904d\u5386\u4ee5\u5bf9\u8c61\u4e3a\u8282\u70b9\u3001\u4ee5\u5f15\u7528\u4e3a\u8fb9\u6784\u6210\u7684\u56fe\uff0c\u628a\u6240\u6709\u53ef\u4ee5\u8bbf\u95ee\u5230\u7684\u5bf9\u8c61\u6253\u4e0a\u6807\u8bb0\uff0c\u7136\u540e\u6e05\u626b\u4e00\u904d\u5185\u5b58\u7a7a\u95f4\uff0c\u628a\u6240\u6709\u6ca1\u6807\u8bb0\u7684\u5bf9\u8c61\u91ca\u653e\u3002</p>\n<h3><a id=\"3__597\"></a>3 \u5206\u4ee3\u6280\u672f</h3>\n<p>\u5206\u4ee3\u56de\u6536\u7684\u6574\u4f53\u601d\u60f3\u662f\uff1a\u5c06\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u5185\u5b58\u5757\u6839\u636e\u5176\u5b58\u6d3b\u65f6\u95f4\u5212\u5206\u4e3a\u4e0d\u540c\u7684\u96c6\u5408\uff0c\u6bcf\u4e2a\u96c6\u5408\u5c31\u6210\u4e3a\u4e00\u4e2a\u201c\u4ee3\u201d\uff0c\u5783\u573e\u6536\u96c6\u9891\u7387\u968f\u7740\u201c\u4ee3\u201d\u7684\u5b58\u6d3b\u65f6\u95f4\u7684\u589e\u5927\u800c\u51cf\u5c0f\uff0c\u5b58\u6d3b\u65f6\u95f4\u901a\u5e38\u5229\u7528\u7ecf\u8fc7\u51e0\u6b21\u5783\u573e\u56de\u6536\u6765\u5ea6\u91cf\u3002</p>\n<p>Python\u9ed8\u8ba4\u5b9a\u4e49\u4e86\u4e09\u4ee3\u5bf9\u8c61\u96c6\u5408\uff0c\u7d22\u5f15\u6570\u8d8a\u5927\uff0c\u5bf9\u8c61\u5b58\u6d3b\u65f6\u95f4\u8d8a\u957f\u3002</p>\n<p>\u4e3e\u4f8b\uff1a<br />\n\u5f53\u67d0\u4e9b\u5185\u5b58\u5757M\u7ecf\u8fc7\u4e863\u6b21\u5783\u573e\u6536\u96c6\u7684\u6e05\u6d17\u4e4b\u540e\u8fd8\u5b58\u6d3b\u65f6\uff0c\u6211\u4eec\u5c31\u5c06\u5185\u5b58\u5757M\u5212\u5230\u4e00\u4e2a\u96c6\u5408A\u4e2d\u53bb\uff0c\u800c\u65b0\u5206\u914d\u7684\u5185\u5b58\u90fd\u5212\u5206\u5230\u96c6\u5408B\u4e2d\u53bb\u3002\u5f53\u5783\u573e\u6536\u96c6\u5f00\u59cb\u5de5\u4f5c\u65f6\uff0c\u5927\u591a\u6570\u60c5\u51b5\u90fd\u53ea\u5bf9\u96c6\u5408B\u8fdb\u884c\u5783\u573e\u56de\u6536\uff0c\u800c\u5bf9\u96c6\u5408A\u8fdb\u884c\u5783\u573e\u56de\u6536\u8981\u9694\u76f8\u5f53\u957f\u4e00\u6bb5\u65f6\u95f4\u540e\u624d\u8fdb\u884c\uff0c\u8fd9\u5c31\u4f7f\u5f97\u5783\u573e\u6536\u96c6\u673a\u5236\u9700\u8981\u5904\u7406\u7684\u5185\u5b58\u5c11\u4e86\uff0c\u6548\u7387\u81ea\u7136\u5c31\u63d0\u9ad8\u4e86\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u96c6\u5408B\u4e2d\u7684\u67d0\u4e9b\u5185\u5b58\u5757\u7531\u4e8e\u5b58\u6d3b\u65f6\u95f4\u957f\u800c\u4f1a\u88ab\u8f6c\u79fb\u5230\u96c6\u5408A\u4e2d\uff0c\u5f53\u7136\uff0c\u96c6\u5408A\u4e2d\u5b9e\u9645\u4e0a\u4e5f\u5b58\u5728\u4e00\u4e9b\u5783\u573e\uff0c\u8fd9\u4e9b\u5783\u573e\u7684\u56de\u6536\u4f1a\u56e0\u4e3a\u8fd9\u79cd\u5206\u4ee3\u7684\u673a\u5236\u800c\u88ab\u5ef6\u8fdf\u3002</p>\n<h2><a id=\"25_PythonList_606\"></a>25 Python\u7684List</h2>\n<p>\u63a8\u8350: http://www.jianshu.com/p/J4U6rR</p>\n<h2><a id=\"26_Pythonis_610\"></a>26 Python\u7684is</h2>\n<p>is\u662f\u5bf9\u6bd4\u5730\u5740,==\u662f\u5bf9\u6bd4\u503c</p>\n<h2><a id=\"27_readreadlinereadlines_614\"></a>27 read,readline\u548creadlines</h2>\n<ul>\n<li>read        \u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6</li>\n<li>readline    \u8bfb\u53d6\u4e0b\u4e00\u884c,\u4f7f\u7528\u751f\u6210\u5668\u65b9\u6cd5</li>\n<li>readlines   \u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u5230\u4e00\u4e2a\u8fed\u4ee3\u5668\u4ee5\u4f9b\u6211\u4eec\u904d\u5386</li>\n</ul>\n<h2><a id=\"28_Python23_620\"></a>28 Python2\u548c3\u7684\u533a\u522b</h2>\n<p>\u63a8\u8350\uff1a<a href=\"http://chenqx.github.io/2014/11/10/Key-differences-between-Python-2-7-x-and-Python-3-x/\" target=\"_blank\">Python 2.7.x \u4e0e Python 3.x \u7684\u4e3b\u8981\u5dee\u5f02</a></p>\n<h2><a id=\"29_super_init_623\"></a>29 super init</h2>\n<p>super() lets you avoid referring to the base class explicitly, which can be nice. But the main advantage comes with multiple inheritance, where all sorts of fun stuff can happen. See the standard docs on super if you haven\u2019t already.</p>\n<p>Note that the syntax changed in Python 3.0: you can just say super().<code>__init__</code>() instead of super(ChildB, self).<code>__init__</code>() which IMO is quite a bit nicer.</p>\n<p>http://stackoverflow.com/questions/576169/understanding-python-super-with-init-methods</p>\n<p><a href=\"http://blog.csdn.net/mrlevo520/article/details/51712440\" target=\"_blank\">Python2.7\u4e2d\u7684super\u65b9\u6cd5\u6d45\u89c1</a></p>\n<h2><a id=\"30_range_and_xrange_632\"></a>30 range and xrange</h2>\n<p>\u90fd\u5728\u5faa\u73af\u65f6\u4f7f\u7528\uff0cxrange\u5185\u5b58\u6027\u80fd\u66f4\u597d\u3002<br />\nfor i in range(0, 20):<br />\nfor i in xrange(0, 20):<br />\nWhat is the difference between range and xrange functions in Python 2.X?<br />\nrange creates a list, so if you do range(1, 10000000) it creates a list in memory with 9999999 elements.<br />\nxrange is a sequence object that evaluates lazily.</p>\n<p>http://stackoverflow.com/questions/94935/what-is-the-difference-between-range-and-xrange-functions-in-python-2-x</p>\n<h1><a id=\"_642\"></a>\u64cd\u4f5c\u7cfb\u7edf</h1>\n<h2><a id=\"1_selectpollepoll_644\"></a>1 select,poll\u548cepoll</h2>\n<p>\u5176\u5b9e\u6240\u6709\u7684I/O\u90fd\u662f\u8f6e\u8be2\u7684\u65b9\u6cd5,\u53ea\u4e0d\u8fc7\u5b9e\u73b0\u7684\u5c42\u9762\u4e0d\u540c\u7f62\u4e86.</p>\n<p>\u8fd9\u4e2a\u95ee\u9898\u53ef\u80fd\u6709\u70b9\u6df1\u5165\u4e86,\u4f46\u76f8\u4fe1\u80fd\u56de\u7b54\u51fa\u8fd9\u4e2a\u95ee\u9898\u662f\u5bf9I/O\u591a\u8def\u590d\u7528\u6709\u5f88\u597d\u7684\u4e86\u89e3\u4e86.\u5176\u4e2dtornado\u4f7f\u7528\u7684\u5c31\u662fepoll\u7684.</p>\n<p><a href=\"http://www.cnblogs.com/Anker/p/3265058.html\" target=\"_blank\">selec,poll\u548cepoll\u533a\u522b\u603b\u7ed3</a></p>\n<p>\u57fa\u672c\u4e0aselect\u67093\u4e2a\u7f3a\u70b9:</p>\n<ol>\n<li>\u8fde\u63a5\u6570\u53d7\u9650</li>\n<li>\u67e5\u627e\u914d\u5bf9\u901f\u5ea6\u6162</li>\n<li>\u6570\u636e\u7531\u5185\u6838\u62f7\u8d1d\u5230\u7528\u6237\u6001</li>\n</ol>\n<p>poll\u6539\u5584\u4e86\u7b2c\u4e00\u4e2a\u7f3a\u70b9</p>\n<p>epoll\u6539\u4e86\u4e09\u4e2a\u7f3a\u70b9.</p>\n<p>\u5173\u4e8eepoll\u7684: http://www.cnblogs.com/my_life/articles/3968782.html</p>\n<h2><a id=\"2__664\"></a>2 \u8c03\u5ea6\u7b97\u6cd5</h2>\n<ol>\n<li>\u5148\u6765\u5148\u670d\u52a1(FCFS, First Come First Serve)</li>\n<li>\u77ed\u4f5c\u4e1a\u4f18\u5148(SJF, Shortest Job First)</li>\n<li>\u6700\u9ad8\u4f18\u5148\u6743\u8c03\u5ea6(Priority Scheduling)</li>\n<li>\u65f6\u95f4\u7247\u8f6e\u8f6c(RR, Round Robin)</li>\n<li>\u591a\u7ea7\u53cd\u9988\u961f\u5217\u8c03\u5ea6(multilevel feedback queue scheduling)</li>\n</ol>\n<p>\u5e38\u89c1\u7684\u8c03\u5ea6\u7b97\u6cd5\u603b\u7ed3:http://www.jianshu.com/p/6edf8174c1eb</p>\n<p>\u5b9e\u65f6\u8c03\u5ea6\u7b97\u6cd5:</p>\n<ol>\n<li>\u6700\u65e9\u622a\u81f3\u65f6\u95f4\u4f18\u5148 EDF</li>\n<li>\u6700\u4f4e\u677e\u5f1b\u5ea6\u4f18\u5148 LLF</li>\n</ol>\n<h2><a id=\"3__679\"></a>3 \u6b7b\u9501</h2>\n<p>\u539f\u56e0:</p>\n<ol>\n<li>\u7ade\u4e89\u8d44\u6e90</li>\n<li>\u7a0b\u5e8f\u63a8\u8fdb\u987a\u5e8f\u4e0d\u5f53</li>\n</ol>\n<p>\u5fc5\u8981\u6761\u4ef6:</p>\n<ol>\n<li>\u4e92\u65a5\u6761\u4ef6</li>\n<li>\u8bf7\u6c42\u548c\u4fdd\u6301\u6761\u4ef6</li>\n<li>\u4e0d\u5265\u593a\u6761\u4ef6</li>\n<li>\u73af\u8def\u7b49\u5f85\u6761\u4ef6</li>\n</ol>\n<p>\u5904\u7406\u6b7b\u9501\u57fa\u672c\u65b9\u6cd5:</p>\n<ol>\n<li>\u9884\u9632\u6b7b\u9501(\u6452\u5f03\u96641\u4ee5\u5916\u7684\u6761\u4ef6)</li>\n<li>\u907f\u514d\u6b7b\u9501(\u94f6\u884c\u5bb6\u7b97\u6cd5)</li>\n<li>\u68c0\u6d4b\u6b7b\u9501(\u8d44\u6e90\u5206\u914d\u56fe)</li>\n<li>\u89e3\u9664\u6b7b\u9501\n<ol>\n<li>\u5265\u593a\u8d44\u6e90</li>\n<li>\u64a4\u9500\u8fdb\u7a0b</li>\n</ol>\n</li>\n</ol>\n<p>\u6b7b\u9501\u6982\u5ff5\u5904\u7406\u7b56\u7565\u8be6\u7ec6\u4ecb\u7ecd:https://wizardforcel.gitbooks.io/wangdaokaoyan-os/content/10.html</p>\n<h2><a id=\"4__703\"></a>4 \u7a0b\u5e8f\u7f16\u8bd1\u4e0e\u94fe\u63a5</h2>\n<p>\u63a8\u8350: http://www.ruanyifeng.com/blog/2014/11/compiler.html</p>\n<p>Bulid\u8fc7\u7a0b\u53ef\u4ee5\u5206\u89e3\u4e3a4\u4e2a\u6b65\u9aa4:\u9884\u5904\u7406(Prepressing), \u7f16\u8bd1(Compilation)\u3001\u6c47\u7f16(Assembly)\u3001\u94fe\u63a5(Linking)</p>\n<p>\u4ee5c\u8bed\u8a00\u4e3a\u4f8b:</p>\n<h3><a id=\"1__711\"></a>1 \u9884\u5904\u7406</h3>\n<p>\u9884\u7f16\u8bd1\u8fc7\u7a0b\u4e3b\u8981\u5904\u7406\u90a3\u4e9b\u6e90\u6587\u4ef6\u4e2d\u7684\u4ee5\u201c#\u201d\u5f00\u59cb\u7684\u9884\u7f16\u8bd1\u6307\u4ee4\uff0c\u4e3b\u8981\u5904\u7406\u89c4\u5219\u6709\uff1a</p>\n<ol>\n<li>\u5c06\u6240\u6709\u7684\u201c#define\u201d\u5220\u9664\uff0c\u5e76\u5c55\u5f00\u6240\u7528\u7684\u5b8f\u5b9a\u4e49</li>\n<li>\u5904\u7406\u6240\u6709\u6761\u4ef6\u9884\u7f16\u8bd1\u6307\u4ee4\uff0c\u6bd4\u5982\u201c#if\u201d\u3001\u201c#ifdef\u201d\u3001 \u201c#elif\u201d\u3001\u201c#endif\u201d</li>\n<li>\u5904\u7406\u201c#include\u201d\u9884\u7f16\u8bd1\u6307\u4ee4\uff0c\u5c06\u88ab\u5305\u542b\u7684\u6587\u4ef6\u63d2\u5165\u5230\u8be5\u7f16\u8bd1\u6307\u4ee4\u7684\u4f4d\u7f6e\uff0c\u6ce8\uff1a\u6b64\u8fc7\u7a0b\u662f\u9012\u5f52\u8fdb\u884c\u7684</li>\n<li>\u5220\u9664\u6240\u6709\u6ce8\u91ca</li>\n<li>\u6dfb\u52a0\u884c\u53f7\u548c\u6587\u4ef6\u540d\u6807\u8bc6\uff0c\u4ee5\u4fbf\u4e8e\u7f16\u8bd1\u65f6\u7f16\u8bd1\u5668\u4ea7\u751f\u8c03\u8bd5\u7528\u7684\u884c\u53f7\u4fe1\u606f\u4ee5\u53ca\u7528\u4e8e\u7f16\u8bd1\u65f6\u4ea7\u751f\u7f16\u8bd1\u9519\u8bef\u6216\u8b66\u544a\u65f6\u53ef\u663e\u793a\u884c\u53f7</li>\n<li>\u4fdd\u7559\u6240\u6709\u7684#pragma\u7f16\u8bd1\u5668\u6307\u4ee4\u3002</li>\n</ol>\n<h3><a id=\"2__722\"></a>2 \u7f16\u8bd1</h3>\n<p>\u7f16\u8bd1\u8fc7\u7a0b\u5c31\u662f\u628a\u9884\u5904\u7406\u5b8c\u7684\u6587\u4ef6\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\u3001\u8bed\u4e49\u5206\u6790\u53ca\u4f18\u5316\u540e\u751f\u6210\u76f8\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6574\u4e2a\u7a0b\u5e8f\u6784\u5efa\u7684\u6838\u5fc3\u90e8\u5206\u3002</p>\n<h3><a id=\"3__726\"></a>3 \u6c47\u7f16</h3>\n<p>\u6c47\u7f16\u5668\u662f\u5c06\u6c47\u7f16\u4ee3\u7801\u8f6c\u5316\u6210\u673a\u5668\u53ef\u4ee5\u6267\u884c\u7684\u6307\u4ee4\uff0c\u6bcf\u4e00\u6761\u6c47\u7f16\u8bed\u53e5\u51e0\u4e4e\u90fd\u662f\u4e00\u6761\u673a\u5668\u6307\u4ee4\u3002\u7ecf\u8fc7\u7f16\u8bd1\u3001\u94fe\u63a5\u3001\u6c47\u7f16\u8f93\u51fa\u7684\u6587\u4ef6\u6210\u4e3a\u76ee\u6807\u6587\u4ef6(Object File)</p>\n<h3><a id=\"4__730\"></a>4 \u94fe\u63a5</h3>\n<p>\u94fe\u63a5\u7684\u4e3b\u8981\u5185\u5bb9\u5c31\u662f\u628a\u5404\u4e2a\u6a21\u5757\u4e4b\u95f4\u76f8\u4e92\u5f15\u7528\u7684\u90e8\u5206\u5904\u7406\u597d\uff0c\u4f7f\u5404\u4e2a\u6a21\u5757\u53ef\u4ee5\u6b63\u786e\u7684\u62fc\u63a5\u3002<br />\n\u94fe\u63a5\u7684\u4e3b\u8981\u8fc7\u7a0b\u5305\u5757 \u5730\u5740\u548c\u7a7a\u95f4\u7684\u5206\u914d\uff08Address and Storage Allocation\uff09\u3001\u7b26\u53f7\u51b3\u8bae(Symbol Resolution)\u548c\u91cd\u5b9a\u4f4d(Relocation)\u7b49\u6b65\u9aa4\u3002</p>\n<h2><a id=\"5__735\"></a>5 \u9759\u6001\u94fe\u63a5\u548c\u52a8\u6001\u94fe\u63a5</h2>\n<p>\u9759\u6001\u94fe\u63a5\u65b9\u6cd5\uff1a\u9759\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u8f7d\u5165\u4ee3\u7801\u5c31\u4f1a\u628a\u7a0b\u5e8f\u4f1a\u7528\u5230\u7684\u52a8\u6001\u4ee3\u7801\u6216\u52a8\u6001\u4ee3\u7801\u7684\u5730\u5740\u786e\u5b9a\u4e0b\u6765<br />\n\u9759\u6001\u5e93\u7684\u94fe\u63a5\u53ef\u4ee5\u4f7f\u7528\u9759\u6001\u94fe\u63a5\uff0c\u52a8\u6001\u94fe\u63a5\u5e93\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u94fe\u63a5\u5bfc\u5165\u5e93</p>\n<p>\u52a8\u6001\u94fe\u63a5\u65b9\u6cd5\uff1a\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u7684\u7a0b\u5e8f\u5e76\u4e0d\u5728\u4e00\u5f00\u59cb\u5c31\u5b8c\u6210\u52a8\u6001\u94fe\u63a5\uff0c\u800c\u662f\u76f4\u5230\u771f\u6b63\u8c03\u7528\u52a8\u6001\u5e93\u4ee3\u7801\u65f6\uff0c\u8f7d\u5165\u7a0b\u5e8f\u624d\u8ba1\u7b97(\u88ab\u8c03\u7528\u7684\u90a3\u90e8\u5206)\u52a8\u6001\u4ee3\u7801\u7684\u903b\u8f91\u5730\u5740\uff0c\u7136\u540e\u7b49\u5230\u67d0\u4e2a\u65f6\u5019\uff0c\u7a0b\u5e8f\u53c8\u9700\u8981\u8c03\u7528\u53e6\u5916\u67d0\u5757\u52a8\u6001\u4ee3\u7801\u65f6\uff0c\u8f7d\u5165\u7a0b\u5e8f\u53c8\u53bb\u8ba1\u7b97\u8fd9\u90e8\u5206\u4ee3\u7801\u7684\u903b\u8f91\u5730\u5740\uff0c\u6240\u4ee5\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u7a0b\u5e8f\u521d\u59cb\u5316\u65f6\u95f4\u8f83\u77ed\uff0c\u4f46\u8fd0\u884c\u671f\u95f4\u7684\u6027\u80fd\u6bd4\u4e0d\u4e0a\u9759\u6001\u94fe\u63a5\u7684\u7a0b\u5e8f</p>\n<h2><a id=\"6__742\"></a>6 \u865a\u62df\u5185\u5b58\u6280\u672f</h2>\n<p>\u865a\u62df\u5b58\u50a8\u5668\u662f\u6307\u5177\u6709\u8bf7\u6c42\u8c03\u5165\u529f\u80fd\u548c\u7f6e\u6362\u529f\u80fd,\u80fd\u4ece\u903b\u8f91\u4e0a\u5bf9\u5185\u5b58\u5bb9\u91cf\u52a0\u4ee5\u6269\u5145\u7684\u4e00\u79cd\u5b58\u50a8\u7cfb\u7edf.</p>\n<h2><a id=\"7__746\"></a>7 \u5206\u9875\u548c\u5206\u6bb5</h2>\n<p>\u5206\u9875: \u7528\u6237\u7a0b\u5e8f\u7684\u5730\u5740\u7a7a\u95f4\u88ab\u5212\u5206\u6210\u82e5\u5e72\u56fa\u5b9a\u5927\u5c0f\u7684\u533a\u57df\uff0c\u79f0\u4e3a\u201c\u9875\u201d\uff0c\u76f8\u5e94\u5730\uff0c\u5185\u5b58\u7a7a\u95f4\u5206\u6210\u82e5\u5e72\u4e2a\u7269\u7406\u5757\uff0c\u9875\u548c\u5757\u7684\u5927\u5c0f\u76f8\u7b49\u3002\u53ef\u5c06\u7528\u6237\u7a0b\u5e8f\u7684\u4efb\u4e00\u9875\u653e\u5728\u5185\u5b58\u7684\u4efb\u4e00\u5757\u4e2d\uff0c\u5b9e\u73b0\u4e86\u79bb\u6563\u5206\u914d\u3002</p>\n<p>\u5206\u6bb5: \u5c06\u7528\u6237\u7a0b\u5e8f\u5730\u5740\u7a7a\u95f4\u5206\u6210\u82e5\u5e72\u4e2a\u5927\u5c0f\u4e0d\u7b49\u7684\u6bb5\uff0c\u6bcf\u6bb5\u53ef\u4ee5\u5b9a\u4e49\u4e00\u7ec4\u76f8\u5bf9\u5b8c\u6574\u7684\u903b\u8f91\u4fe1\u606f\u3002\u5b58\u50a8\u5206\u914d\u65f6\uff0c\u4ee5\u6bb5\u4e3a\u5355\u4f4d\uff0c\u6bb5\u4e0e\u6bb5\u5728\u5185\u5b58\u4e2d\u53ef\u4ee5\u4e0d\u76f8\u90bb\u63a5\uff0c\u4e5f\u5b9e\u73b0\u4e86\u79bb\u6563\u5206\u914d\u3002</p>\n<h3><a id=\"_752\"></a>\u5206\u9875\u4e0e\u5206\u6bb5\u7684\u4e3b\u8981\u533a\u522b</h3>\n<ol>\n<li>\u9875\u662f\u4fe1\u606f\u7684\u7269\u7406\u5355\u4f4d,\u5206\u9875\u662f\u4e3a\u4e86\u5b9e\u73b0\u975e\u8fde\u7eed\u5206\u914d,\u4ee5\u4fbf\u89e3\u51b3\u5185\u5b58\u788e\u7247\u95ee\u9898,\u6216\u8005\u8bf4\u5206\u9875\u662f\u7531\u4e8e\u7cfb\u7edf\u7ba1\u7406\u7684\u9700\u8981.\u6bb5\u662f\u4fe1\u606f\u7684\u903b\u8f91\u5355\u4f4d,\u5b83\u542b\u6709\u4e00\u7ec4\u610f\u4e49\u76f8\u5bf9\u5b8c\u6574\u7684\u4fe1\u606f,\u5206\u6bb5\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u597d\u5730\u5b9e\u73b0\u5171\u4eab,\u6ee1\u8db3\u7528\u6237\u7684\u9700\u8981.</li>\n<li>\u9875\u7684\u5927\u5c0f\u56fa\u5b9a,\u7531\u7cfb\u7edf\u786e\u5b9a,\u5c06\u903b\u8f91\u5730\u5740\u5212\u5206\u4e3a\u9875\u53f7\u548c\u9875\u5185\u5730\u5740\u662f\u7531\u673a\u5668\u786c\u4ef6\u5b9e\u73b0\u7684.\u800c\u6bb5\u7684\u957f\u5ea6\u5374\u4e0d\u56fa\u5b9a,\u51b3\u5b9a\u4e8e\u7528\u6237\u6240\u7f16\u5199\u7684\u7a0b\u5e8f,\u901a\u5e38\u7531\u7f16\u8bd1\u7a0b\u5e8f\u5728\u5bf9\u6e90\u7a0b\u5e8f\u8fdb\u884c\u7f16\u8bd1\u65f6\u6839\u636e\u4fe1\u606f\u7684\u6027\u8d28\u6765\u5212\u5206.</li>\n<li>\u5206\u9875\u7684\u4f5c\u4e1a\u5730\u5740\u7a7a\u95f4\u662f\u4e00\u7ef4\u7684.\u5206\u6bb5\u7684\u5730\u5740\u7a7a\u95f4\u662f\u4e8c\u7ef4\u7684.</li>\n</ol>\n<h2><a id=\"8__758\"></a>8 \u9875\u9762\u7f6e\u6362\u7b97\u6cd5</h2>\n<ol>\n<li>\u6700\u4f73\u7f6e\u6362\u7b97\u6cd5OPT:\u4e0d\u53ef\u80fd\u5b9e\u73b0</li>\n<li>\u5148\u8fdb\u5148\u51faFIFO</li>\n<li>\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7b97\u6cd5LRU:\u6700\u8fd1\u4e00\u6bb5\u65f6\u95f4\u91cc\u6700\u4e45\u6ca1\u6709\u4f7f\u7528\u8fc7\u7684\u9875\u9762\u4e88\u4ee5\u7f6e\u6362.</li>\n<li>clock\u7b97\u6cd5</li>\n</ol>\n<h2><a id=\"9__765\"></a>9 \u8fb9\u6cbf\u89e6\u53d1\u548c\u6c34\u5e73\u89e6\u53d1</h2>\n<p>\u8fb9\u7f18\u89e6\u53d1\u662f\u6307\u6bcf\u5f53\u72b6\u6001\u53d8\u5316\u65f6\u53d1\u751f\u4e00\u4e2a io \u4e8b\u4ef6\uff0c\u6761\u4ef6\u89e6\u53d1\u662f\u53ea\u8981\u6ee1\u8db3\u6761\u4ef6\u5c31\u53d1\u751f\u4e00\u4e2a io \u4e8b\u4ef6</p>\n<h1><a id=\"_769\"></a>\u6570\u636e\u5e93</h1>\n<h2><a id=\"1__771\"></a>1 \u4e8b\u52a1</h2>\n<p>\u6570\u636e\u5e93\u4e8b\u52a1(Database Transaction) \uff0c\u662f\u6307\u4f5c\u4e3a\u5355\u4e2a\u903b\u8f91\u5de5\u4f5c\u5355\u5143\u6267\u884c\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u8981\u4e48\u5b8c\u5168\u5730\u6267\u884c\uff0c\u8981\u4e48\u5b8c\u5168\u5730\u4e0d\u6267\u884c\u3002<br />\n\u5f7b\u5e95\u7406\u89e3\u6570\u636e\u5e93\u4e8b\u52a1: http://www.hollischuang.com/archives/898</p>\n<h2><a id=\"2__776\"></a>2 \u6570\u636e\u5e93\u7d22\u5f15</h2>\n<p>\u63a8\u8350: http://tech.meituan.com/mysql-index.html</p>\n<p><a href=\"http://blog.codinglabs.org/articles/theory-of-mysql-index.html\" target=\"_blank\">MySQL\u7d22\u5f15\u80cc\u540e\u7684\u6570\u636e\u7ed3\u6784\u53ca\u7b97\u6cd5\u539f\u7406</a></p>\n<p>\u805a\u96c6\u7d22\u5f15,\u975e\u805a\u96c6\u7d22\u5f15,B-Tree,B+Tree,\u6700\u5de6\u524d\u7f00\u539f\u7406</p>\n<h2><a id=\"3_Redis_784\"></a>3 Redis\u539f\u7406</h2>\n<h3><a id=\"Redis_786\"></a>Redis\u662f\u4ec0\u4e48\uff1f</h3>\n<ol>\n<li>\u662f\u4e00\u4e2a\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684key-value\u5185\u5b58\u6570\u636e\u5e93</li>\n<li>\u901a\u5e38\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5176\u6709\u7740\u4e30\u5bcc\u7684\u6570\u636e\u7ed3\u6784 strings\u3001map\u3001 list\u3001sets\u3001 sorted sets</li>\n</ol>\n<h3><a id=\"Redis_791\"></a>Redis\u6570\u636e\u5e93</h3>\n<blockquote>\n<p>\u200b\t\u901a\u5e38\u5c40\u9650\u70b9\u6765\u8bf4\uff0cRedis\u4e5f\u4ee5\u6d88\u606f\u961f\u5217\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u4f5c\u4e3a\u5185\u5d4c\u7684List\u5b58\u5728\uff0c\u6ee1\u8db3\u5b9e\u65f6\u7684\u9ad8\u5e76\u53d1\u9700\u6c42\u3002\u5728\u4f7f\u7528\u7f13\u5b58\u7684\u65f6\u5019\uff0credis\u6bd4memcached\u5177\u6709\u66f4\u591a\u7684\u4f18\u52bf\uff0c\u5e76\u4e14\u652f\u6301\u66f4\u591a\u7684\u6570\u636e\u7c7b\u578b\uff0c\u628aredis\u5f53\u4f5c\u4e00\u4e2a\u4e2d\u95f4\u5b58\u50a8\u7cfb\u7edf\uff0c\u7528\u6765\u5904\u7406\u9ad8\u5e76\u53d1\u7684\u6570\u636e\u5e93\u64cd\u4f5c</p>\n</blockquote>\n<ul>\n<li>\u901f\u5ea6\u5feb\uff1a\u4f7f\u7528\u6807\u51c6C\u5199\uff0c\u6240\u6709\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\uff0c\u8bfb\u5199\u901f\u5ea6\u5206\u522b\u8fbe\u523010\u4e07/20\u4e07</li>\n<li>\u6301\u4e45\u5316\uff1a\u5bf9\u6570\u636e\u7684\u66f4\u65b0\u91c7\u7528Copy-on-write\u6280\u672f\uff0c\u53ef\u4ee5\u5f02\u6b65\u5730\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\uff0c\u4e3b\u8981\u6709\u4e24\u79cd\u7b56\u7565\uff0c\u4e00\u662f\u6839\u636e\u65f6\u95f4\uff0c\u66f4\u65b0\u6b21\u6570\u7684\u5feb\u7167\uff08save 300 10 \uff09\u4e8c\u662f\u57fa\u4e8e\u8bed\u53e5\u8ffd\u52a0\u65b9\u5f0f(Append-only file\uff0caof)</li>\n<li>\u81ea\u52a8\u64cd\u4f5c\uff1a\u5bf9\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u7684\u64cd\u4f5c\u90fd\u662f\u81ea\u52a8\u7684\uff0c\u5f88\u5b89\u5168</li>\n<li>\u5feb\u901f\u7684\u4e3b\u2013\u4ece\u590d\u5236\uff0c\u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6570\u636e\uff0cSlave\u572821\u79d2\u5373\u5b8c\u6210\u4e86\u5bf9Amazon\u7f51\u7ad910G key set\u7684\u590d\u5236\u3002</li>\n<li>Sharding\u6280\u672f\uff1a \u5f88\u5bb9\u6613\u5c06\u6570\u636e\u5206\u5e03\u5230\u591a\u4e2aRedis\u5b9e\u4f8b\u4e2d\uff0c\u6570\u636e\u5e93\u7684\u6269\u5c55\u662f\u4e2a\u6c38\u6052\u7684\u8bdd\u9898\uff0c\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\uff0c\u4e3b\u8981\u662f\u4ee5\u6dfb\u52a0\u786c\u4ef6\u3001\u4ee5\u5206\u533a\u4e3a\u4e3b\u8981\u6280\u672f\u5f62\u5f0f\u7684\u7eb5\u5411\u6269\u5c55\u89e3\u51b3\u4e86\u5f88\u591a\u7684\u5e94\u7528\u573a\u666f\uff0c\u4f46\u968f\u7740web2.0\u3001\u79fb\u52a8\u4e92\u8054\u7f51\u3001\u4e91\u8ba1\u7b97\u7b49\u5e94\u7528\u7684\u5174\u8d77\uff0c\u8fd9\u79cd\u6269\u5c55\u6a21\u5f0f\u5df2\u7ecf\u4e0d\u592a\u9002\u5408\u4e86\uff0c\u6240\u4ee5\u8fd1\u5e74\u6765\uff0c\u50cf\u91c7\u7528\u4e3b\u4ece\u914d\u7f6e\u3001\u6570\u636e\u5e93\u590d\u5236\u5f62\u5f0f\u7684\uff0cSharding\u8fd9\u79cd\u6280\u672f\u628a\u8d1f\u8f7d\u5206\u5e03\u5230\u591a\u4e2a\u7279\u7406\u8282\u70b9\u4e0a\u53bb\u7684\u6a2a\u5411\u6269\u5c55\u65b9\u5f0f\u7528\u5904\u8d8a\u6765\u8d8a\u591a\u3002</li>\n</ul>\n<h3><a id=\"Redis_801\"></a>Redis\u7f3a\u70b9</h3>\n<ul>\n<li>\u662f\u6570\u636e\u5e93\u5bb9\u91cf\u53d7\u5230\u7269\u7406\u5185\u5b58\u7684\u9650\u5236,\u4e0d\u80fd\u7528\u4f5c\u6d77\u91cf\u6570\u636e\u7684\u9ad8\u6027\u80fd\u8bfb\u5199,\u56e0\u6b64Redis\u9002\u5408\u7684\u573a\u666f\u4e3b\u8981\u5c40\u9650\u5728\u8f83\u5c0f\u6570\u636e\u91cf\u7684\u9ad8\u6027\u80fd\u64cd\u4f5c\u548c\u8fd0\u7b97\u4e0a\u3002</li>\n<li>Redis\u8f83\u96be\u652f\u6301\u5728\u7ebf\u6269\u5bb9\uff0c\u5728\u96c6\u7fa4\u5bb9\u91cf\u8fbe\u5230\u4e0a\u9650\u65f6\u5728\u7ebf\u6269\u5bb9\u4f1a\u53d8\u5f97\u5f88\u590d\u6742\u3002\u4e3a\u907f\u514d\u8fd9\u4e00\u95ee\u9898\uff0c\u8fd0\u7ef4\u4eba\u5458\u5728\u7cfb\u7edf\u4e0a\u7ebf\u65f6\u5fc5\u987b\u786e\u4fdd\u6709\u8db3\u591f\u7684\u7a7a\u95f4\uff0c\u8fd9\u5bf9\u8d44\u6e90\u9020\u6210\u4e86\u5f88\u5927\u7684\u6d6a\u8d39\u3002</li>\n</ul>\n<h2><a id=\"4__807\"></a>4 \u4e50\u89c2\u9501\u548c\u60b2\u89c2\u9501</h2>\n<p>\u60b2\u89c2\u9501\uff1a\u5047\u5b9a\u4f1a\u53d1\u751f\u5e76\u53d1\u51b2\u7a81\uff0c\u5c4f\u853d\u4e00\u5207\u53ef\u80fd\u8fdd\u53cd\u6570\u636e\u5b8c\u6574\u6027\u7684\u64cd\u4f5c</p>\n<p>\u4e50\u89c2\u9501\uff1a\u5047\u8bbe\u4e0d\u4f1a\u53d1\u751f\u5e76\u53d1\u51b2\u7a81\uff0c\u53ea\u5728\u63d0\u4ea4\u64cd\u4f5c\u65f6\u68c0\u67e5\u662f\u5426\u8fdd\u53cd\u6570\u636e\u5b8c\u6574\u6027\u3002</p>\n<p>\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u7684\u5177\u4f53\u533a\u522b: http://www.cnblogs.com/Bob-FD/p/3352216.html</p>\n<h2><a id=\"5_MVCC_815\"></a>5 MVCC</h2>\n<blockquote>\n<p>\u200b\t\u5168\u79f0\u662fMulti-Version Concurrent Control\uff0c\u5373\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff0c\u5728MVCC\u534f\u8bae\u4e0b\uff0c\u6bcf\u4e2a\u8bfb\u64cd\u4f5c\u4f1a\u770b\u5230\u4e00\u4e2a\u4e00\u81f4\u6027\u7684snapshot\uff0c\u5e76\u4e14\u53ef\u4ee5\u5b9e\u73b0\u975e\u963b\u585e\u7684\u8bfb\u3002MVCC\u5141\u8bb8\u6570\u636e\u5177\u6709\u591a\u4e2a\u7248\u672c\uff0c\u8fd9\u4e2a\u7248\u672c\u53ef\u4ee5\u662f\u65f6\u95f4\u6233\u6216\u8005\u662f\u5168\u5c40\u9012\u589e\u7684\u4e8b\u52a1ID\uff0c\u5728\u540c\u4e00\u4e2a\u65f6\u95f4\u70b9\uff0c\u4e0d\u540c\u7684\u4e8b\u52a1\u770b\u5230\u7684\u6570\u636e\u662f\u4e0d\u540c\u7684\u3002</p>\n</blockquote>\n<h3><a id=\"MySQLhttplibcsdnnetbasemysqlinnodbMVCC_820\"></a><a href=\"http://lib.csdn.net/base/mysql\" target=\"_blank\">MySQL</a>\u7684innodb\u5f15\u64ce\u662f\u5982\u4f55\u5b9e\u73b0MVCC\u7684</h3>\n<p>innodb\u4f1a\u4e3a\u6bcf\u4e00\u884c\u6dfb\u52a0\u4e24\u4e2a\u5b57\u6bb5\uff0c\u5206\u522b\u8868\u793a\u8be5\u884c<strong>\u521b\u5efa\u7684\u7248\u672c</strong>\u548c<strong>\u5220\u9664\u7684\u7248\u672c</strong>\uff0c\u586b\u5165\u7684\u662f\u4e8b\u52a1\u7684\u7248\u672c\u53f7\uff0c\u8fd9\u4e2a\u7248\u672c\u53f7\u968f\u7740\u4e8b\u52a1\u7684\u521b\u5efa\u4e0d\u65ad\u9012\u589e\u3002\u5728repeated read\u7684\u9694\u79bb\u7ea7\u522b\uff08<a href=\"http://blog.csdn.net/chosen0ne/article/details/10036775\" target=\"_blank\">\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u8bf7\u770b\u8fd9\u7bc7\u6587\u7ae0</a>\uff09\u4e0b\uff0c\u5177\u4f53\u5404\u79cd\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u5b9e\u73b0\uff1a</p>\n<ul>\n<li>select\uff1a\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u4e2a\u6761\u4ef6innodb\u4f1a\u8fd4\u56de\u8be5\u884c\u6570\u636e\uff1a\n<ul>\n<li>\u8be5\u884c\u7684\u521b\u5efa\u7248\u672c\u53f7\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d\u7248\u672c\u53f7\uff0c\u7528\u4e8e\u4fdd\u8bc1\u5728select\u64cd\u4f5c\u4e4b\u524d\u6240\u6709\u7684\u64cd\u4f5c\u5df2\u7ecf\u6267\u884c\u843d\u5730\u3002</li>\n<li>\u8be5\u884c\u7684\u5220\u9664\u7248\u672c\u53f7\u5927\u4e8e\u5f53\u524d\u7248\u672c\u6216\u8005\u4e3a\u7a7a\u3002\u5220\u9664\u7248\u672c\u53f7\u5927\u4e8e\u5f53\u524d\u7248\u672c\u610f\u5473\u7740\u6709\u4e00\u4e2a\u5e76\u53d1\u4e8b\u52a1\u5c06\u8be5\u884c\u5220\u9664\u4e86\u3002</li>\n</ul>\n</li>\n<li>insert\uff1a\u5c06\u65b0\u63d2\u5165\u7684\u884c\u7684\u521b\u5efa\u7248\u672c\u53f7\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u3002</li>\n<li>delete\uff1a\u5c06\u8981\u5220\u9664\u7684\u884c\u7684\u5220\u9664\u7248\u672c\u53f7\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u3002</li>\n<li>update\uff1a\u4e0d\u6267\u884c\u539f\u5730update\uff0c\u800c\u662f\u8f6c\u6362\u6210insert + delete\u3002\u5c06\u65e7\u884c\u7684\u5220\u9664\u7248\u672c\u53f7\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7248\u672c\u53f7\uff0c\u5e76\u5c06\u65b0\u884cinsert\u540c\u65f6\u8bbe\u7f6e\u521b\u5efa\u7248\u672c\u53f7\u4e3a\u5f53\u524d\u7248\u672c\u53f7\u3002</li>\n</ul>\n<p>\u5176\u4e2d\uff0c\u5199\u64cd\u4f5c\uff08insert\u3001delete\u548cupdate\uff09\u6267\u884c\u65f6\uff0c\u9700\u8981\u5c06\u7cfb\u7edf\u7248\u672c\u53f7\u9012\u589e\u3002</p>\n<p>\u200b\t\u7531\u4e8e\u65e7\u6570\u636e\u5e76\u4e0d\u771f\u6b63\u7684\u5220\u9664\uff0c\u6240\u4ee5\u5fc5\u987b\u5bf9\u8fd9\u4e9b\u6570\u636e\u8fdb\u884c\u6e05\u7406\uff0cinnodb\u4f1a\u5f00\u542f\u4e00\u4e2a\u540e\u53f0\u7ebf\u7a0b\u6267\u884c\u6e05\u7406\u5de5\u4f5c\uff0c\u5177\u4f53\u7684\u89c4\u5219\u662f\u5c06\u5220\u9664\u7248\u672c\u53f7\u5c0f\u4e8e\u5f53\u524d\u7cfb\u7edf\u7248\u672c\u7684\u884c\u5220\u9664\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505apurge\u3002</p>\n<p>\u901a\u8fc7MVCC\u5f88\u597d\u7684\u5b9e\u73b0\u4e86\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u53ef\u4ee5\u8fbe\u5230repeated read\u7ea7\u522b\uff0c\u8981\u5b9e\u73b0serializable\u8fd8\u5fc5\u987b\u52a0\u9501\u3002</p>\n<blockquote>\n<p>\u53c2\u8003\uff1a<a href=\"http://blog.csdn.net/chosen0ne/article/details/18093187\" target=\"_blank\">MVCC\u6d45\u6790</a></p>\n</blockquote>\n<h2><a id=\"6_MyISAMInnoDB_841\"></a>6 MyISAM\u548cInnoDB</h2>\n<p>MyISAM \u9002\u5408\u4e8e\u4e00\u4e9b\u9700\u8981\u5927\u91cf\u67e5\u8be2\u7684\u5e94\u7528\uff0c\u4f46\u5176\u5bf9\u4e8e\u6709\u5927\u91cf\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u5f88\u597d\u3002\u751a\u81f3\u4f60\u53ea\u662f\u9700\u8981update\u4e00\u4e2a\u5b57\u6bb5\uff0c\u6574\u4e2a\u8868\u90fd\u4f1a\u88ab\u9501\u8d77\u6765\uff0c\u800c\u522b\u7684\u8fdb\u7a0b\uff0c\u5c31\u7b97\u662f\u8bfb\u8fdb\u7a0b\u90fd\u65e0\u6cd5\u64cd\u4f5c\u76f4\u5230\u8bfb\u64cd\u4f5c\u5b8c\u6210\u3002\u53e6\u5916\uff0cMyISAM \u5bf9\u4e8e SELECT COUNT(*) \u8fd9\u7c7b\u7684\u8ba1\u7b97\u662f\u8d85\u5feb\u65e0\u6bd4\u7684\u3002</p>\n<p>InnoDB \u7684\u8d8b\u52bf\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u590d\u6742\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u5c0f\u7684\u5e94\u7528\uff0c\u5b83\u4f1a\u6bd4 MyISAM \u8fd8\u6162\u3002\u4ed6\u662f\u5b83\u652f\u6301\u201c\u884c\u9501\u201d \uff0c\u4e8e\u662f\u5728\u5199\u64cd\u4f5c\u6bd4\u8f83\u591a\u7684\u65f6\u5019\uff0c\u4f1a\u66f4\u4f18\u79c0\u3002\u5e76\u4e14\uff0c\u4ed6\u8fd8\u652f\u6301\u66f4\u591a\u7684\u9ad8\u7ea7\u5e94\u7528\uff0c\u6bd4\u5982\uff1a\u4e8b\u52a1\u3002</p>\n<p>mysql \u6570\u636e\u5e93\u5f15\u64ce: http://www.cnblogs.com/0201zcr/p/5296843.html<br />\nMySQL\u5b58\u50a8\u5f15\u64ce\uff0d\uff0dMyISAM\u4e0eInnoDB\u533a\u522b: https://segmentfault.com/a/1190000008227211</p>\n<h1><a id=\"_850\"></a>\u7f51\u7edc</h1>\n<h2><a id=\"1__852\"></a>1 \u4e09\u6b21\u63e1\u624b</h2>\n<ol>\n<li>\u5ba2\u6237\u7aef\u901a\u8fc7\u5411\u670d\u52a1\u5668\u7aef\u53d1\u9001\u4e00\u4e2aSYN\u6765\u521b\u5efa\u4e00\u4e2a\u4e3b\u52a8\u6253\u5f00\uff0c\u4f5c\u4e3a\u4e09\u6b21\u63e1\u624b\u7684\u4e00\u90e8\u5206\u3002\u5ba2\u6237\u7aef\u628a\u8fd9\u6bb5\u8fde\u63a5\u7684\u5e8f\u53f7\u8bbe\u5b9a\u4e3a\u968f\u673a\u6570 A\u3002</li>\n<li>\u670d\u52a1\u5668\u7aef\u5e94\u5f53\u4e3a\u4e00\u4e2a\u5408\u6cd5\u7684SYN\u56de\u9001\u4e00\u4e2aSYN/ACK\u3002ACK \u7684\u786e\u8ba4\u7801\u5e94\u4e3a A+1\uff0cSYN/ACK \u5305\u672c\u8eab\u53c8\u6709\u4e00\u4e2a\u968f\u673a\u5e8f\u53f7 B\u3002</li>\n<li>\u6700\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u53d1\u9001\u4e00\u4e2aACK\u3002\u5f53\u670d\u52a1\u7aef\u53d7\u5230\u8fd9\u4e2aACK\u7684\u65f6\u5019\uff0c\u5c31\u5b8c\u6210\u4e86\u4e09\u8def\u63e1\u624b\uff0c\u5e76\u8fdb\u5165\u4e86\u8fde\u63a5\u521b\u5efa\u72b6\u6001\u3002\u6b64\u65f6\u5305\u5e8f\u53f7\u88ab\u8bbe\u5b9a\u4e3a\u6536\u5230\u7684\u786e\u8ba4\u53f7 A+1\uff0c\u800c\u54cd\u5e94\u5219\u4e3a B+1\u3002</li>\n</ol>\n<h2><a id=\"2__858\"></a>2 \u56db\u6b21\u6325\u624b</h2>\n<p><em>\u6ce8\u610f: \u4e2d\u65ad\u8fde\u63a5\u7aef\u53ef\u4ee5\u662f\u5ba2\u6237\u7aef\uff0c\u4e5f\u53ef\u4ee5\u662f\u670d\u52a1\u5668\u7aef. \u4e0b\u9762\u4ec5\u4ee5\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u4e3e\u4f8b, \u53cd\u4e4b\u4ea6\u7136.</em></p>\n<ol>\n<li>\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u5206\u6bb5, \u5176\u4e2d\u7684 FIN \u6807\u8bb0\u8bbe\u7f6e\u4e3a1. \u5ba2\u6237\u7aef\u8fdb\u5165 FIN-WAIT \u72b6\u6001. \u8be5\u72b6\u6001\u4e0b\u5ba2\u6237\u7aef\u53ea\u63a5\u6536\u6570\u636e, \u4e0d\u518d\u53d1\u9001\u6570\u636e.</li>\n<li>\u670d\u52a1\u5668\u63a5\u6536\u5230\u5e26\u6709 FIN = 1 \u7684\u6570\u636e\u5206\u6bb5, \u53d1\u9001\u5e26\u6709 ACK = 1 \u7684\u5269\u4f59\u6570\u636e\u5206\u6bb5, \u786e\u8ba4\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684 FIN \u4fe1\u606f.</li>\n<li>\u670d\u52a1\u5668\u7b49\u5230\u6240\u6709\u6570\u636e\u4f20\u8f93\u7ed3\u675f, \u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u5e26\u6709 FIN = 1 \u7684\u6570\u636e\u5206\u6bb5, \u5e76\u8fdb\u5165 CLOSE-WAIT \u72b6\u6001, \u7b49\u5f85\u5ba2\u6237\u7aef\u53d1\u6765\u5e26\u6709 ACK = 1 \u7684\u786e\u8ba4\u62a5\u6587.</li>\n<li>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u53d1\u6765\u5e26\u6709 FIN = 1 \u7684\u62a5\u6587, \u8fd4\u56de ACK = 1 \u7684\u62a5\u6587\u786e\u8ba4, \u4e3a\u4e86\u9632\u6b62\u670d\u52a1\u5668\u7aef\u672a\u6536\u5230\u9700\u8981\u91cd\u53d1, \u8fdb\u5165 TIME-WAIT \u72b6\u6001. \u670d\u52a1\u5668\u63a5\u6536\u5230\u62a5\u6587\u540e\u5173\u95ed\u8fde\u63a5. \u5ba2\u6237\u7aef\u7b49\u5f85 2MSL \u540e\u672a\u6536\u5230\u56de\u590d, \u5219\u8ba4\u4e3a\u670d\u52a1\u5668\u6210\u529f\u5173\u95ed, \u5ba2\u6237\u7aef\u5173\u95ed\u8fde\u63a5.</li>\n</ol>\n<p>\u56fe\u89e3: http://blog.csdn.net/whuslei/article/details/6667471</p>\n<h2><a id=\"3_ARP_869\"></a>3 ARP\u534f\u8bae</h2>\n<p>\u5730\u5740\u89e3\u6790\u534f\u8bae(Address Resolution Protocol)\uff0c\u5176\u57fa\u672c\u529f\u80fd\u4e3a\u900f\u8fc7\u76ee\u6807\u8bbe\u5907\u7684IP\u5730\u5740\uff0c\u67e5\u8be2\u76ee\u6807\u7684MAC\u5730\u5740\uff0c\u4ee5\u4fdd\u8bc1\u901a\u4fe1\u7684\u987a\u5229\u8fdb\u884c\u3002\u5b83\u662fIPv4\u7f51\u7edc\u5c42\u5fc5\u4e0d\u53ef\u5c11\u7684\u534f\u8bae\uff0c\u4e0d\u8fc7\u5728IPv6\u4e2d\u5df2\u4e0d\u518d\u9002\u7528\uff0c\u5e76\u88ab\u90bb\u5c45\u53d1\u73b0\u534f\u8bae\uff08NDP\uff09\u6240\u66ff\u4ee3\u3002</p>\n<h2><a id=\"4_urlliburllib2_873\"></a>4 urllib\u548curllib2\u7684\u533a\u522b</h2>\n<p>\u8fd9\u4e2a\u9762\u8bd5\u5b98\u786e\u5b9e\u95ee\u8fc7,\u5f53\u65f6\u7b54\u7684urllib2\u53ef\u4ee5Post\u800curllib\u4e0d\u53ef\u4ee5.</p>\n<ol>\n<li>urllib\u63d0\u4f9burlencode\u65b9\u6cd5\u7528\u6765GET\u67e5\u8be2\u5b57\u7b26\u4e32\u7684\u4ea7\u751f\uff0c\u800curllib2\u6ca1\u6709\u3002\u8fd9\u662f\u4e3a\u4f55urllib\u5e38\u548curllib2\u4e00\u8d77\u4f7f\u7528\u7684\u539f\u56e0\u3002</li>\n<li>urllib2\u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2aRequest\u7c7b\u7684\u5b9e\u4f8b\u6765\u8bbe\u7f6eURL\u8bf7\u6c42\u7684headers\uff0curllib\u4ec5\u53ef\u4ee5\u63a5\u53d7URL\u3002\u8fd9\u610f\u5473\u7740\uff0c\u4f60\u4e0d\u53ef\u4ee5\u4f2a\u88c5\u4f60\u7684User Agent\u5b57\u7b26\u4e32\u7b49\u3002</li>\n</ol>\n<h2><a id=\"5_PostGet_881\"></a>5 Post\u548cGet</h2>\n<p><a href=\"http://www.cnblogs.com/nankezhishi/archive/2012/06/09/getandpost.html\" target=\"_blank\">GET\u548cPOST\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u53ca\u4e3a\u4ec0\u4e48\u7f51\u4e0a\u7684\u591a\u6570\u7b54\u6848\u90fd\u662f\u9519\u7684</a><br />\n<a href=\"https://www.zhihu.com/question/31640769?rf=37401322\" target=\"_blank\">\u77e5\u4e4e\u56de\u7b54</a></p>\n<p>get: <a href=\"http://tools.ietf.org/html/rfc2616#section-9.3\" target=\"_blank\">RFC 2616 - Hypertext Transfer Protocol \u2013 HTTP/1.1</a><br />\npost: <a href=\"http://tools.ietf.org/html/rfc2616#section-9.5\" target=\"_blank\">RFC 2616 - Hypertext Transfer Protocol \u2013 HTTP/1.1</a></p>\n<h2><a id=\"6_CookieSession_890\"></a>6 Cookie\u548cSession</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\">Cookie</th>\n<th style=\"text-align:left\">Session</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">\u50a8\u5b58\u4f4d\u7f6e</td>\n<td style=\"text-align:left\">\u5ba2\u6237\u7aef</td>\n<td style=\"text-align:left\">\u670d\u52a1\u5668\u7aef</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">\u76ee\u7684</td>\n<td style=\"text-align:left\">\u8ddf\u8e2a\u4f1a\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u5b58\u7528\u6237\u504f\u597d\u8bbe\u7f6e\u6216\u8005\u4fdd\u5b58\u7528\u6237\u540d\u5bc6\u7801\u7b49</td>\n<td style=\"text-align:left\">\u8ddf\u8e2a\u4f1a\u8bdd</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">\u5b89\u5168\u6027</td>\n<td style=\"text-align:left\">\u4e0d\u5b89\u5168</td>\n<td style=\"text-align:left\">\u5b89\u5168</td>\n</tr>\n</tbody>\n</table>\n<p>session\u6280\u672f\u662f\u8981\u4f7f\u7528\u5230cookie\u7684\uff0c\u4e4b\u6240\u4ee5\u51fa\u73b0session\u6280\u672f\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5b89\u5168\u3002</p>\n<h2><a id=\"7_apachenginx_900\"></a>7 apache\u548cnginx\u7684\u533a\u522b</h2>\n<p>nginx \u76f8\u5bf9 apache \u7684\u4f18\u70b9\uff1a</p>\n<ul>\n<li>\u8f7b\u91cf\u7ea7\uff0c\u540c\u6837\u8d77web \u670d\u52a1\uff0c\u6bd4apache \u5360\u7528\u66f4\u5c11\u7684\u5185\u5b58\u53ca\u8d44\u6e90</li>\n<li>\u6297\u5e76\u53d1\uff0cnginx \u5904\u7406\u8bf7\u6c42\u662f\u5f02\u6b65\u975e\u963b\u585e\u7684\uff0c\u652f\u6301\u66f4\u591a\u7684\u5e76\u53d1\u8fde\u63a5\uff0c\u800capache \u5219\u662f\u963b\u585e\u578b\u7684\uff0c\u5728\u9ad8\u5e76\u53d1\u4e0bnginx \u80fd\u4fdd\u6301\u4f4e\u8d44\u6e90\u4f4e\u6d88\u8017\u9ad8\u6027\u80fd</li>\n<li>\u914d\u7f6e\u7b80\u6d01</li>\n<li>\u9ad8\u5ea6\u6a21\u5757\u5316\u7684\u8bbe\u8ba1\uff0c\u7f16\u5199\u6a21\u5757\u76f8\u5bf9\u7b80\u5355</li>\n<li>\u793e\u533a\u6d3b\u8dc3</li>\n</ul>\n<p>apache \u76f8\u5bf9nginx \u7684\u4f18\u70b9\uff1a</p>\n<ul>\n<li>rewrite \uff0c\u6bd4nginx \u7684rewrite \u5f3a\u5927</li>\n<li>\u6a21\u5757\u8d85\u591a\uff0c\u57fa\u672c\u60f3\u5230\u7684\u90fd\u53ef\u4ee5\u627e\u5230</li>\n<li>\u5c11bug \uff0cnginx \u7684bug \u76f8\u5bf9\u8f83\u591a</li>\n<li>\u8d85\u7a33\u5b9a</li>\n</ul>\n<h2><a id=\"8__915\"></a>8 \u7f51\u7ad9\u7528\u6237\u5bc6\u7801\u4fdd\u5b58</h2>\n<ol>\n<li>\u660e\u6587\u4fdd\u5b58</li>\n<li>\u660e\u6587hash\u540e\u4fdd\u5b58,\u5982md5</li>\n<li>MD5+Salt\u65b9\u5f0f,\u8fd9\u4e2asalt\u53ef\u4ee5\u968f\u673a</li>\n<li>\u77e5\u4e4e\u4f7f\u7528\u4e86Bcrypy(\u597d\u50cf)\u52a0\u5bc6</li>\n</ol>\n<h2><a id=\"9_HTTPHTTPS_922\"></a>9 HTTP\u548cHTTPS</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u72b6\u6001\u7801</th>\n<th style=\"text-align:left\">\u5b9a\u4e49</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">1xx \u62a5\u544a</td>\n<td style=\"text-align:left\">\u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u7ee7\u7eed\u8fdb\u7a0b</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">2xx \u6210\u529f</td>\n<td style=\"text-align:left\">\u6b65\u9aa4\u6210\u529f\u63a5\u6536\uff0c\u88ab\u7406\u89e3\uff0c\u5e76\u88ab\u63a5\u53d7</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">3xx \u91cd\u5b9a\u5411</td>\n<td style=\"text-align:left\">\u4e3a\u4e86\u5b8c\u6210\u8bf7\u6c42,\u5fc5\u987b\u91c7\u53d6\u8fdb\u4e00\u6b65\u63aa\u65bd</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">4xx \u5ba2\u6237\u7aef\u51fa\u9519</td>\n<td style=\"text-align:left\">\u8bf7\u6c42\u5305\u62ec\u9519\u7684\u987a\u5e8f\u6216\u4e0d\u80fd\u5b8c\u6210</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">5xx \u670d\u52a1\u5668\u51fa\u9519</td>\n<td style=\"text-align:left\">\u670d\u52a1\u5668\u65e0\u6cd5\u5b8c\u6210\u663e\u7136\u6709\u6548\u7684\u8bf7\u6c42</td>\n</tr>\n</tbody>\n</table>\n<p>403: Forbidden<br />\n404: Not Found</p>\n<p>HTTPS\u63e1\u624b,\u5bf9\u79f0\u52a0\u5bc6,\u975e\u5bf9\u79f0\u52a0\u5bc6,TLS/SSL,RSA</p>\n<h2><a id=\"10_XSRFXSS_938\"></a>10 XSRF\u548cXSS</h2>\n<ul>\n<li>CSRF(Cross-site request forgery)\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020</li>\n<li>XSS(Cross Site Scripting)\u8de8\u7ad9\u811a\u672c\u653b\u51fb</li>\n</ul>\n<p>CSRF\u91cd\u70b9\u5728\u8bf7\u6c42,XSS\u91cd\u70b9\u5728\u811a\u672c</p>\n<h2><a id=\"11__Idempotence_945\"></a>11 \u5e42\u7b49 Idempotence</h2>\n<p>HTTP\u65b9\u6cd5\u7684\u5e42\u7b49\u6027\u662f\u6307\u4e00\u6b21\u548c\u591a\u6b21\u8bf7\u6c42\u67d0\u4e00\u4e2a\u8d44\u6e90\u5e94\u8be5\u5177\u6709\u540c\u6837\u7684<strong>\u526f\u4f5c\u7528</strong>\u3002(\u6ce8\u610f\u662f\u526f\u4f5c\u7528)</p>\n<p><code>GET http://www.bank.com/account/123456</code>\uff0c\u4e0d\u4f1a\u6539\u53d8\u8d44\u6e90\u7684\u72b6\u6001\uff0c\u4e0d\u8bba\u8c03\u7528\u4e00\u6b21\u8fd8\u662fN\u6b21\u90fd\u6ca1\u6709\u526f\u4f5c\u7528\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u91cc\u5f3a\u8c03\u7684\u662f\u4e00\u6b21\u548cN\u6b21\u5177\u6709\u76f8\u540c\u7684\u526f\u4f5c\u7528\uff0c\u800c\u4e0d\u662f\u6bcf\u6b21GET\u7684\u7ed3\u679c\u76f8\u540c\u3002<code>GET http://www.news.com/latest-news</code>\u8fd9\u4e2aHTTP\u8bf7\u6c42\u53ef\u80fd\u4f1a\u6bcf\u6b21\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\uff0c\u4f46\u5b83\u672c\u8eab\u5e76\u6ca1\u6709\u4ea7\u751f\u4efb\u4f55\u526f\u4f5c\u7528\uff0c\u56e0\u800c\u662f\u6ee1\u8db3\u5e42\u7b49\u6027\u7684\u3002</p>\n<p>DELETE\u65b9\u6cd5\u7528\u4e8e\u5220\u9664\u8d44\u6e90\uff0c\u6709\u526f\u4f5c\u7528\uff0c\u4f46\u5b83\u5e94\u8be5\u6ee1\u8db3\u5e42\u7b49\u6027\u3002\u6bd4\u5982\uff1a<code>DELETE http://www.forum.com/article/4231</code>\uff0c\u8c03\u7528\u4e00\u6b21\u548cN\u6b21\u5bf9\u7cfb\u7edf\u4ea7\u751f\u7684\u526f\u4f5c\u7528\u662f\u76f8\u540c\u7684\uff0c\u5373\u5220\u6389id\u4e3a4231\u7684\u5e16\u5b50\uff1b\u56e0\u6b64\uff0c\u8c03\u7528\u8005\u53ef\u4ee5\u591a\u6b21\u8c03\u7528\u6216\u5237\u65b0\u9875\u9762\u800c\u4e0d\u5fc5\u62c5\u5fc3\u5f15\u8d77\u9519\u8bef\u3002</p>\n<p>POST\u6240\u5bf9\u5e94\u7684URI\u5e76\u975e\u521b\u5efa\u7684\u8d44\u6e90\u672c\u8eab\uff0c\u800c\u662f\u8d44\u6e90\u7684\u63a5\u6536\u8005\u3002\u6bd4\u5982\uff1a<code>POST http://www.forum.com/articles</code>\u7684\u8bed\u4e49\u662f\u5728<code>http://www.forum.com/articles</code>\u4e0b\u521b\u5efa\u4e00\u7bc7\u5e16\u5b50\uff0cHTTP\u54cd\u5e94\u4e2d\u5e94\u5305\u542b\u5e16\u5b50\u7684\u521b\u5efa\u72b6\u6001\u4ee5\u53ca\u5e16\u5b50\u7684URI\u3002\u4e24\u6b21\u76f8\u540c\u7684POST\u8bf7\u6c42\u4f1a\u5728\u670d\u52a1\u5668\u7aef\u521b\u5efa\u4e24\u4efd\u8d44\u6e90\uff0c\u5b83\u4eec\u5177\u6709\u4e0d\u540c\u7684URI\uff1b\u6240\u4ee5\uff0cPOST\u65b9\u6cd5\u4e0d\u5177\u5907\u5e42\u7b49\u6027\u3002</p>\n<p>PUT\u6240\u5bf9\u5e94\u7684URI\u662f\u8981\u521b\u5efa\u6216\u66f4\u65b0\u7684\u8d44\u6e90\u672c\u8eab\u3002\u6bd4\u5982\uff1a<code>PUT http://www.forum/articles/4231</code>\u7684\u8bed\u4e49\u662f\u521b\u5efa\u6216\u66f4\u65b0ID\u4e3a4231\u7684\u5e16\u5b50\u3002\u5bf9\u540c\u4e00URI\u8fdb\u884c\u591a\u6b21PUT\u7684\u526f\u4f5c\u7528\u548c\u4e00\u6b21PUT\u662f\u76f8\u540c\u7684\uff1b\u56e0\u6b64\uff0cPUT\u65b9\u6cd5\u5177\u6709\u5e42\u7b49\u6027\u3002</p>\n<h2><a id=\"12_RESTfulSOAPRPC_959\"></a>12 RESTful\u67b6\u6784(SOAP,RPC)</h2>\n<p>\u63a8\u8350: http://www.ruanyifeng.com/blog/2011/09/restful.html</p>\n<h2><a id=\"13_SOAP_964\"></a>13 SOAP</h2>\n<p>SOAP\uff08\u539f\u4e3aSimple Object Access Protocol\u7684\u9996\u5b57\u6bcd\u7f29\u5199\uff0c\u5373\u7b80\u5355\u5bf9\u8c61\u8bbf\u95ee\u534f\u8bae\uff09\u662f\u4ea4\u6362\u6570\u636e\u7684\u4e00\u79cd\u534f\u8bae\u89c4\u8303\uff0c\u4f7f\u7528\u5728\u8ba1\u7b97\u673a\u7f51\u7edcWeb\u670d\u52a1\uff08web service\uff09\u4e2d\uff0c\u4ea4\u6362\u5e26\u7ed3\u6784\u4fe1\u606f\u3002SOAP\u4e3a\u4e86\u7b80\u5316\u7f51\u9875\u670d\u52a1\u5668\uff08Web Server\uff09\u4eceXML\u6570\u636e\u5e93\u4e2d\u63d0\u53d6\u6570\u636e\u65f6\uff0c\u8282\u7701\u53bb\u683c\u5f0f\u5316\u9875\u9762\u65f6\u95f4\uff0c\u4ee5\u53ca\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u6309\u7167HTTP\u901a\u4fe1\u534f\u8bae\uff0c\u9075\u4eceXML\u683c\u5f0f\u6267\u884c\u8d44\u6599\u4e92\u6362\uff0c\u4f7f\u5176\u62bd\u8c61\u4e8e\u8bed\u8a00\u5b9e\u73b0\u3001\u5e73\u53f0\u548c\u786c\u4ef6\u3002</p>\n<h2><a id=\"14_RPC_968\"></a>14 RPC</h2>\n<p>RPC\uff08Remote Procedure Call Protocol\uff09\u2014\u2014\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u534f\u8bae\uff0c\u5b83\u662f\u4e00\u79cd\u901a\u8fc7\u7f51\u7edc\u4ece\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7a0b\u5e8f\u4e0a\u8bf7\u6c42\u670d\u52a1\uff0c\u800c\u4e0d\u9700\u8981\u4e86\u89e3\u5e95\u5c42\u7f51\u7edc\u6280\u672f\u7684\u534f\u8bae\u3002RPC\u534f\u8bae\u5047\u5b9a\u67d0\u4e9b\u4f20\u8f93\u534f\u8bae\u7684\u5b58\u5728\uff0c\u5982TCP\u6216UDP\uff0c\u4e3a\u901a\u4fe1\u7a0b\u5e8f\u4e4b\u95f4\u643a\u5e26\u4fe1\u606f\u6570\u636e\u3002\u5728OSI\u7f51\u7edc\u901a\u4fe1\u6a21\u578b\u4e2d\uff0cRPC\u8de8\u8d8a\u4e86\u4f20\u8f93\u5c42\u548c\u5e94\u7528\u5c42\u3002RPC\u4f7f\u5f97\u5f00\u53d1\u5305\u62ec\u7f51\u7edc\u5206\u5e03\u5f0f\u591a\u7a0b\u5e8f\u5728\u5185\u7684\u5e94\u7528\u7a0b\u5e8f\u66f4\u52a0\u5bb9\u6613\u3002</p>\n<p>\u603b\u7ed3:\u670d\u52a1\u63d0\u4f9b\u7684\u4e24\u5927\u6d41\u6d3e.\u4f20\u7edf\u610f\u4e49\u4ee5\u65b9\u6cd5\u8c03\u7528\u4e3a\u5bfc\u5411\u901a\u79f0RPC\u3002\u4e3a\u4e86\u4f01\u4e1aSOA,\u82e5\u5e72\u5382\u5546\u8054\u5408\u63a8\u51fawebservice,\u5236\u5b9a\u4e86wsdl\u63a5\u53e3\u5b9a\u4e49,\u4f20\u8f93soap.\u5f53\u4e92\u8054\u7f51\u65f6\u4ee3,\u81c3\u80bfSOA\u88ab\u7b80\u5316\u4e3ahttp+xml/json.\u4f46\u662f\u7b80\u5316\u51fa\u73b0\u5404\u79cd\u6df7\u4e71\u3002\u4ee5\u8d44\u6e90\u4e3a\u5bfc\u5411,\u4efb\u4f55\u64cd\u4f5c\u65e0\u975e\u662f\u5bf9\u8d44\u6e90\u7684\u589e\u5220\u6539\u67e5\uff0c\u4e8e\u662f\u7edf\u4e00\u7684REST\u51fa\u73b0\u4e86.</p>\n<p>\u8fdb\u5316\u7684\u987a\u5e8f: RPC -&gt; SOAP -&gt; RESTful</p>\n<h2><a id=\"15_CGIWSGI_976\"></a>15 CGI\u548cWSGI</h2>\n<p>CGI\u662f\u901a\u7528\u7f51\u5173\u63a5\u53e3\uff0c\u662f\u8fde\u63a5web\u670d\u52a1\u5668\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u63a5\u53e3\uff0c\u7528\u6237\u901a\u8fc7CGI\u6765\u83b7\u53d6\u52a8\u6001\u6570\u636e\u6216\u6587\u4ef6\u7b49\u3002<br />\nCGI\u7a0b\u5e8f\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7a0b\u5e8f\uff0c\u5b83\u53ef\u4ee5\u7528\u51e0\u4e4e\u6240\u6709\u8bed\u8a00\u6765\u5199\uff0c\u5305\u62ecperl\uff0cc\uff0clua\uff0cpython\u7b49\u7b49\u3002</p>\n<p>WSGI, Web Server Gateway Interface\uff0c\u662fPython\u5e94\u7528\u7a0b\u5e8f\u6216\u6846\u67b6\u548cWeb\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u4e00\u79cd\u63a5\u53e3\uff0cWSGI\u7684\u5176\u4e2d\u4e00\u4e2a\u76ee\u7684\u5c31\u662f\u8ba9\u7528\u6237\u53ef\u4ee5\u7528\u7edf\u4e00\u7684\u8bed\u8a00(Python)\u7f16\u5199\u524d\u540e\u7aef\u3002</p>\n<p>\u5b98\u65b9\u8bf4\u660e\uff1a<a href=\"https://www.python.org/dev/peps/pep-3333/\" target=\"_blank\">PEP-3333</a></p>\n<h2><a id=\"16__984\"></a>16 \u4e2d\u95f4\u4eba\u653b\u51fb</h2>\n<p>\u5728GFW\u91cc\u5c61\u89c1\u4e0d\u9c9c\u7684,\u5475\u5475.</p>\n<p>\u4e2d\u95f4\u4eba\u653b\u51fb\uff08Man-in-the-middle attack\uff0c\u901a\u5e38\u7f29\u5199\u4e3aMITM\uff09\u662f\u6307\u653b\u51fb\u8005\u4e0e\u901a\u8baf\u7684\u4e24\u7aef\u5206\u522b\u521b\u5efa\u72ec\u7acb\u7684\u8054\u7cfb\uff0c\u5e76\u4ea4\u6362\u5176\u6240\u6536\u5230\u7684\u6570\u636e\uff0c\u4f7f\u901a\u8baf\u7684\u4e24\u7aef\u8ba4\u4e3a\u4ed6\u4eec\u6b63\u5728\u901a\u8fc7\u4e00\u4e2a\u79c1\u5bc6\u7684\u8fde\u63a5\u4e0e\u5bf9\u65b9\u76f4\u63a5\u5bf9\u8bdd\uff0c\u4f46\u4e8b\u5b9e\u4e0a\u6574\u4e2a\u4f1a\u8bdd\u90fd\u88ab\u653b\u51fb\u8005\u5b8c\u5168\u63a7\u5236\u3002</p>\n<h2><a id=\"17_c10k_990\"></a>17 c10k\u95ee\u9898</h2>\n<p>\u6240\u8c13c10k\u95ee\u9898\uff0c\u6307\u7684\u662f\u670d\u52a1\u5668\u540c\u65f6\u652f\u6301\u6210\u5343\u4e0a\u4e07\u4e2a\u5ba2\u6237\u7aef\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662fconcurrent 10 000 connection\uff08\u8fd9\u4e5f\u662fc10k\u8fd9\u4e2a\u540d\u5b57\u7684\u7531\u6765\uff09\u3002<br />\n\u63a8\u8350: https://my.oschina.net/xianggao/blog/664275</p>\n<h2><a id=\"18_socket_995\"></a>18 socket</h2>\n<p>\u63a8\u8350: http://www.360doc.com/content/11/0609/15/5482098_122692444.shtml</p>\n<p>Socket=Ip address+ TCP/UDP + port</p>\n<h2><a id=\"19__1001\"></a>19 \u6d4f\u89c8\u5668\u7f13\u5b58</h2>\n<p>\u63a8\u8350: http://www.cnblogs.com/skynet/archive/2012/11/28/2792503.html</p>\n<p>304 Not Modified</p>\n<h2><a id=\"20_HTTP10HTTP11_1007\"></a>20 HTTP1.0\u548cHTTP1.1</h2>\n<p>\u63a8\u8350: http://blog.csdn.net/elifefly/article/details/3964766</p>\n<ol>\n<li>\u8bf7\u6c42\u5934Host\u5b57\u6bb5,\u4e00\u4e2a\u670d\u52a1\u5668\u591a\u4e2a\u7f51\u7ad9</li>\n<li>\u957f\u94fe\u63a5</li>\n<li>\u6587\u4ef6\u65ad\u70b9\u7eed\u4f20</li>\n<li>\u8eab\u4efd\u8ba4\u8bc1,\u72b6\u6001\u7ba1\u7406,Cache\u7f13\u5b58</li>\n</ol>\n<p>HTTP\u8bf7\u6c428\u79cd\u65b9\u6cd5\u4ecb\u7ecd<br />\nHTTP/1.1\u534f\u8bae\u4e2d\u5171\u5b9a\u4e49\u4e868\u79cdHTTP\u8bf7\u6c42\u65b9\u6cd5\uff0cHTTP\u8bf7\u6c42\u65b9\u6cd5\u4e5f\u88ab\u53eb\u505a\u201c\u8bf7\u6c42\u52a8\u4f5c\u201d\uff0c\u4e0d\u540c\u7684\u65b9\u6cd5\u89c4\u5b9a\u4e86\u4e0d\u540c\u7684\u64cd\u4f5c\u6307\u5b9a\u7684\u8d44\u6e90\u65b9\u5f0f\u3002\u670d\u52a1\u7aef\u4e5f\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u8bf7\u6c42\u65b9\u6cd5\u505a\u4e0d\u540c\u7684\u54cd\u5e94\u3002</p>\n<p>GET</p>\n<p>GET\u8bf7\u6c42\u4f1a\u663e\u793a\u8bf7\u6c42\u6307\u5b9a\u7684\u8d44\u6e90\u3002\u4e00\u822c\u6765\u8bf4GET\u65b9\u6cd5\u5e94\u8be5\u53ea\u7528\u4e8e\u6570\u636e\u7684\u8bfb\u53d6\uff0c\u800c\u4e0d\u5e94\u5f53\u7528\u4e8e\u4f1a\u4ea7\u751f\u526f\u4f5c\u7528\u7684\u975e\u5e42\u7b49\u7684\u64cd\u4f5c\u4e2d\u3002</p>\n<p>GET\u4f1a\u65b9\u6cd5\u8bf7\u6c42\u6307\u5b9a\u7684\u9875\u9762\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u54cd\u5e94\u4e3b\u4f53\uff0cGET\u88ab\u8ba4\u4e3a\u662f\u4e0d\u5b89\u5168\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3aGET\u65b9\u6cd5\u4f1a\u88ab\u7f51\u7edc\u8718\u86db\u7b49\u4efb\u610f\u7684\u8bbf\u95ee\u3002</p>\n<p>HEAD</p>\n<p>HEAD\u65b9\u6cd5\u4e0eGET\u65b9\u6cd5\u4e00\u6837\uff0c\u90fd\u662f\u5411\u670d\u52a1\u5668\u53d1\u51fa\u6307\u5b9a\u8d44\u6e90\u7684\u8bf7\u6c42\u3002\u4f46\u662f\uff0c\u670d\u52a1\u5668\u5728\u54cd\u5e94HEAD\u8bf7\u6c42\u65f6\u4e0d\u4f1a\u56de\u4f20\u8d44\u6e90\u7684\u5185\u5bb9\u90e8\u5206\uff0c\u5373\uff1a\u54cd\u5e94\u4e3b\u4f53\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u4f20\u8f93\u5168\u90e8\u5185\u5bb9\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u670d\u52a1\u5668\u7684\u54cd\u5e94\u5934\u4fe1\u606f\u3002HEAD\u65b9\u6cd5\u5e38\u88ab\u7528\u4e8e\u5ba2\u6237\u7aef\u67e5\u770b\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002</p>\n<p>POST</p>\n<p>POST\u8bf7\u6c42\u4f1a \u5411\u6307\u5b9a\u8d44\u6e90\u63d0\u4ea4\u6570\u636e\uff0c\u8bf7\u6c42\u670d\u52a1\u5668\u8fdb\u884c\u5904\u7406\uff0c\u5982\uff1a\u8868\u5355\u6570\u636e\u63d0\u4ea4\u3001\u6587\u4ef6\u4e0a\u4f20\u7b49\uff0c\u8bf7\u6c42\u6570\u636e\u4f1a\u88ab\u5305\u542b\u5728\u8bf7\u6c42\u4f53\u4e2d\u3002POST\u65b9\u6cd5\u662f\u975e\u5e42\u7b49\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u8bf7\u6c42\u53ef\u80fd\u4f1a\u521b\u5efa\u65b0\u7684\u8d44\u6e90\u6216/\u548c\u4fee\u6539\u73b0\u6709\u8d44\u6e90\u3002</p>\n<p>PUT</p>\n<p>PUT\u8bf7\u6c42\u4f1a\u8eab\u5411\u6307\u5b9a\u8d44\u6e90\u4f4d\u7f6e\u4e0a\u4f20\u5176\u6700\u65b0\u5185\u5bb9\uff0cPUT\u65b9\u6cd5\u662f\u5e42\u7b49\u7684\u65b9\u6cd5\u3002\u901a\u8fc7\u8be5\u65b9\u6cd5\u5ba2\u6237\u7aef\u53ef\u4ee5\u5c06\u6307\u5b9a\u8d44\u6e90\u7684\u6700\u65b0\u6570\u636e\u4f20\u9001\u7ed9\u670d\u52a1\u5668\u53d6\u4ee3\u6307\u5b9a\u7684\u8d44\u6e90\u7684\u5185\u5bb9\u3002</p>\n<p>DELETE</p>\n<p>DELETE\u8bf7\u6c42\u7528\u4e8e\u8bf7\u6c42\u670d\u52a1\u5668\u5220\u9664\u6240\u8bf7\u6c42URI\uff08\u7edf\u4e00\u8d44\u6e90\u6807\u8bc6\u7b26\uff0cUniform Resource Identifier\uff09\u6240\u6807\u8bc6\u7684\u8d44\u6e90\u3002DELETE\u8bf7\u6c42\u540e\u6307\u5b9a\u8d44\u6e90\u4f1a\u88ab\u5220\u9664\uff0cDELETE\u65b9\u6cd5\u4e5f\u662f\u5e42\u7b49\u7684\u3002</p>\n<p>CONNECT</p>\n<p>CONNECT\u65b9\u6cd5\u662fHTTP/1.1\u534f\u8bae\u9884\u7559\u7684\uff0c\u80fd\u591f\u5c06\u8fde\u63a5\u6539\u4e3a\u7ba1\u9053\u65b9\u5f0f\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002\u901a\u5e38\u7528\u4e8eSSL\u52a0\u5bc6\u670d\u52a1\u5668\u7684\u94fe\u63a5\u4e0e\u975e\u52a0\u5bc6\u7684HTTP\u4ee3\u7406\u670d\u52a1\u5668\u7684\u901a\u4fe1\u3002</p>\n<p>OPTIONS</p>\n<p>OPTIONS\u8bf7\u6c42\u4e0eHEAD\u7c7b\u4f3c\uff0c\u4e00\u822c\u4e5f\u662f\u7528\u4e8e\u5ba2\u6237\u7aef\u67e5\u770b\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002 \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u8bf7\u6c42\u670d\u52a1\u5668\u8fd4\u56de\u8be5\u8d44\u6e90\u6240\u652f\u6301\u7684\u6240\u6709HTTP\u8bf7\u6c42\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4f1a\u7528\u2019*\u2019\u6765\u4ee3\u66ff\u8d44\u6e90\u540d\u79f0\uff0c\u5411\u670d\u52a1\u5668\u53d1\u9001OPTIONS\u8bf7\u6c42\uff0c\u53ef\u4ee5\u6d4b\u8bd5\u670d\u52a1\u5668\u529f\u80fd\u662f\u5426\u6b63\u5e38\u3002JavaScript\u7684XMLHttpRequest\u5bf9\u8c61\u8fdb\u884cCORS\u8de8\u57df\u8d44\u6e90\u5171\u4eab\u65f6\uff0c\u5c31\u662f\u4f7f\u7528OPTIONS\u65b9\u6cd5\u53d1\u9001\u55c5\u63a2\u8bf7\u6c42\uff0c\u4ee5\u5224\u65ad\u662f\u5426\u6709\u5bf9\u6307\u5b9a\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u3002 \u5141\u8bb8</p>\n<p>TRACE</p>\n<p>TRACE\u8bf7\u6c42\u670d\u52a1\u5668\u56de\u663e\u5176\u6536\u5230\u7684\u8bf7\u6c42\u4fe1\u606f\uff0c\u8be5\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8eHTTP\u8bf7\u6c42\u7684\u6d4b\u8bd5\u6216\u8bca\u65ad\u3002</p>\n<p>HTTP/1.1\u4e4b\u540e\u589e\u52a0\u7684\u65b9\u6cd5</p>\n<p>\u5728HTTP/1.1\u6807\u51c6\u5236\u5b9a\u4e4b\u540e\uff0c\u53c8\u9646\u7eed\u6269\u5c55\u4e86\u4e00\u4e9b\u65b9\u6cd5\u3002\u5176\u4e2d\u4f7f\u7528\u4e2d\u8f83\u591a\u7684\u662f PATCH \u65b9\u6cd5\uff1a</p>\n<p>PATCH</p>\n<p>PATCH\u65b9\u6cd5\u51fa\u73b0\u7684\u8f83\u665a\uff0c\u5b83\u57282010\u5e74\u7684RFC 5789\u6807\u51c6\u4e2d\u88ab\u5b9a\u4e49\u3002PATCH\u8bf7\u6c42\u4e0ePUT\u8bf7\u6c42\u7c7b\u4f3c\uff0c\u540c\u6837\u7528\u4e8e\u8d44\u6e90\u7684\u66f4\u65b0\u3002\u4e8c\u8005\u6709\u4ee5\u4e0b\u4e24\u70b9\u4e0d\u540c\uff1a</p>\n<p>\u4f46PATCH\u4e00\u822c\u7528\u4e8e\u8d44\u6e90\u7684\u90e8\u5206\u66f4\u65b0\uff0c\u800cPUT\u4e00\u822c\u7528\u4e8e\u8d44\u6e90\u7684\u6574\u4f53\u66f4\u65b0\u3002<br />\n\u5f53\u8d44\u6e90\u4e0d\u5b58\u5728\u65f6\uff0cPATCH\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8d44\u6e90\uff0c\u800cPUT\u53ea\u4f1a\u5bf9\u5df2\u5728\u8d44\u6e90\u8fdb\u884c\u66f4\u65b0\u3002</p>\n<h2><a id=\"21_Ajax_1064\"></a>21 Ajax</h2>\n<p>AJAX,Asynchronous JavaScript and XML\uff08\u5f02\u6b65\u7684 JavaScript \u548c XML\uff09, \u662f\u4e0e\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u9875\u9762\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0e\u670d\u52a1\u5668\u4ea4\u6362\u6570\u636e\u5e76\u66f4\u65b0\u90e8\u5206\u7f51\u9875\u7684\u6280\u672f\u3002</p>\n<h1><a id=\"NIX_1067\"></a>*NIX</h1>\n<h2><a id=\"unixIPC_1069\"></a>unix\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f(IPC)</h2>\n<ol>\n<li>\u7ba1\u9053\uff08Pipe\uff09\uff1a\u7ba1\u9053\u53ef\u7528\u4e8e\u5177\u6709\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\uff0c\u5141\u8bb8\u4e00\u4e2a\u8fdb\u7a0b\u548c\u53e6\u4e00\u4e2a\u4e0e\u5b83\u6709\u5171\u540c\u7956\u5148\u7684\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u3002</li>\n<li>\u547d\u540d\u7ba1\u9053\uff08named pipe\uff09\uff1a\u547d\u540d\u7ba1\u9053\u514b\u670d\u4e86\u7ba1\u9053\u6ca1\u6709\u540d\u5b57\u7684\u9650\u5236\uff0c\u56e0\u6b64\uff0c\u9664\u5177\u6709\u7ba1\u9053\u6240\u5177\u6709\u7684\u529f\u80fd\u5916\uff0c\u5b83\u8fd8\u5141\u8bb8\u65e0\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002\u547d\u540d\u7ba1\u9053\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\u3002\u547d\u540d\u7ba1\u9053\u901a\u8fc7\u547d\u4ee4mkfifo\u6216\u7cfb\u7edf\u8c03\u7528mkfifo\u6765\u521b\u5efa\u3002</li>\n<li>\u4fe1\u53f7\uff08Signal\uff09\uff1a\u4fe1\u53f7\u662f\u6bd4\u8f83\u590d\u6742\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u7528\u4e8e\u901a\u77e5\u63a5\u53d7\u8fdb\u7a0b\u6709\u67d0\u79cd\u4e8b\u4ef6\u53d1\u751f\uff0c\u9664\u4e86\u7528\u4e8e\u8fdb\u7a0b\u95f4\u901a\u4fe1\u5916\uff0c\u8fdb\u7a0b\u8fd8\u53ef\u4ee5\u53d1\u9001\u4fe1\u53f7\u7ed9\u8fdb\u7a0b\u672c\u8eab\uff1blinux\u9664\u4e86\u652f\u6301Unix\u65e9\u671f\u4fe1\u53f7\u8bed\u4e49\u51fd\u6570sigal\u5916\uff0c\u8fd8\u652f\u6301\u8bed\u4e49\u7b26\u5408Posix.1\u6807\u51c6\u7684\u4fe1\u53f7\u51fd\u6570sigaction\uff08\u5b9e\u9645\u4e0a\uff0c\u8be5\u51fd\u6570\u662f\u57fa\u4e8eBSD\u7684\uff0cBSD\u4e3a\u4e86\u5b9e\u73b0\u53ef\u9760\u4fe1\u53f7\u673a\u5236\uff0c\u53c8\u80fd\u591f\u7edf\u4e00\u5bf9\u5916\u63a5\u53e3\uff0c\u7528sigaction\u51fd\u6570\u91cd\u65b0\u5b9e\u73b0\u4e86signal\u51fd\u6570\uff09\u3002</li>\n<li>\u6d88\u606f\uff08Message\uff09\u961f\u5217\uff1a\u6d88\u606f\u961f\u5217\u662f\u6d88\u606f\u7684\u94fe\u63a5\u8868\uff0c\u5305\u62ecPosix\u6d88\u606f\u961f\u5217system V\u6d88\u606f\u961f\u5217\u3002\u6709\u8db3\u591f\u6743\u9650\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5411\u961f\u5217\u4e2d\u6dfb\u52a0\u6d88\u606f\uff0c\u88ab\u8d4b\u4e88\u8bfb\u6743\u9650\u7684\u8fdb\u7a0b\u5219\u53ef\u4ee5\u8bfb\u8d70\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002\u6d88\u606f\u961f\u5217\u514b\u670d\u4e86\u4fe1\u53f7\u627f\u8f7d\u4fe1\u606f\u91cf\u5c11\uff0c\u7ba1\u9053\u53ea\u80fd\u627f\u8f7d\u65e0\u683c\u5f0f\u5b57\u8282\u6d41\u4ee5\u53ca\u7f13\u51b2\u533a\u5927\u5c0f\u53d7\u9650\u7b49\u7f3a</li>\n<li>\u5171\u4eab\u5185\u5b58\uff1a\u4f7f\u5f97\u591a\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u540c\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\uff0c\u662f\u6700\u5feb\u7684\u53ef\u7528IPC\u5f62\u5f0f\u3002\u662f\u9488\u5bf9\u5176\u4ed6\u901a\u4fe1\u673a\u5236\u8fd0\u884c\u6548\u7387\u8f83\u4f4e\u800c\u8bbe\u8ba1\u7684\u3002\u5f80\u5f80\u4e0e\u5176\u5b83\u901a\u4fe1\u673a\u5236\uff0c\u5982\u4fe1\u53f7\u91cf\u7ed3\u5408\u4f7f\u7528\uff0c\u6765\u8fbe\u5230\u8fdb\u7a0b\u95f4\u7684\u540c\u6b65\u53ca\u4e92\u65a5\u3002</li>\n<li>\u5185\u5b58\u6620\u5c04\uff08mapped memory\uff09\uff1a\u5185\u5b58\u6620\u5c04\u5141\u8bb8\u4efb\u4f55\u591a\u4e2a\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u6bcf\u4e00\u4e2a\u4f7f\u7528\u8be5\u673a\u5236\u7684\u8fdb\u7a0b\u901a\u8fc7\u628a\u4e00\u4e2a\u5171\u4eab\u7684\u6587\u4ef6\u6620\u5c04\u5230\u81ea\u5df1\u7684\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\u6765\u5b9e\u73b0\u5b83\u3002</li>\n<li>\u4fe1\u53f7\u91cf\uff08semaphore\uff09\uff1a\u4e3b\u8981\u4f5c\u4e3a\u8fdb\u7a0b\u95f4\u4ee5\u53ca\u540c\u4e00\u8fdb\u7a0b\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\u624b\u6bb5\u3002</li>\n<li>\u5957\u63a5\u53e3\uff08Socket\uff09\uff1a\u66f4\u4e3a\u4e00\u822c\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff0c\u53ef\u7528\u4e8e\u4e0d\u540c\u673a\u5668\u4e4b\u95f4\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u8d77\u521d\u662f\u7531Unix\u7cfb\u7edf\u7684BSD\u5206\u652f\u5f00\u53d1\u51fa\u6765\u7684\uff0c\u4f46\u73b0\u5728\u4e00\u822c\u53ef\u4ee5\u79fb\u690d\u5230\u5176\u5b83\u7c7bUnix\u7cfb\u7edf\u4e0a\uff1aLinux\u548cSystem V\u7684\u53d8\u79cd\u90fd\u652f\u6301\u5957\u63a5\u5b57\u3002</li>\n</ol>\n<h1><a id=\"_1081\"></a>\u6570\u636e\u7ed3\u6784</h1>\n<h2><a id=\"1__1083\"></a>1 \u7ea2\u9ed1\u6811</h2>\n<p>\u7ea2\u9ed1\u6811\u4e0eAVL\u7684\u6bd4\u8f83\uff1a</p>\n<p>AVL\u662f\u4e25\u683c\u5e73\u8861\u6811\uff0c\u56e0\u6b64\u5728\u589e\u52a0\u6216\u8005\u5220\u9664\u8282\u70b9\u7684\u65f6\u5019\uff0c\u6839\u636e\u4e0d\u540c\u60c5\u51b5\uff0c\u65cb\u8f6c\u7684\u6b21\u6570\u6bd4\u7ea2\u9ed1\u6811\u8981\u591a\uff1b</p>\n<p>\u7ea2\u9ed1\u662f\u7528\u975e\u4e25\u683c\u7684\u5e73\u8861\u6765\u6362\u53d6\u589e\u5220\u8282\u70b9\u65f6\u5019\u65cb\u8f6c\u6b21\u6570\u7684\u964d\u4f4e\uff1b</p>\n<p>\u6240\u4ee5\u7b80\u5355\u8bf4\uff0c\u5982\u679c\u4f60\u7684\u5e94\u7528\u4e2d\uff0c\u641c\u7d22\u7684\u6b21\u6570\u8fdc\u8fdc\u5927\u4e8e\u63d2\u5165\u548c\u5220\u9664\uff0c\u90a3\u4e48\u9009\u62e9AVL\uff0c\u5982\u679c\u641c\u7d22\uff0c\u63d2\u5165\u5220\u9664\u6b21\u6570\u51e0\u4e4e\u5dee\u4e0d\u591a\uff0c\u5e94\u8be5\u9009\u62e9RB\u3002</p>\n<p>\u7ea2\u9ed1\u6811\u8be6\u89e3: https://xieguanglei.github.io/blog/post/red-black-tree.html</p>\n<p>\u6559\u4f60\u900f\u5f7b\u4e86\u89e3\u7ea2\u9ed1\u6811: https://github.com/julycoding/The-Art-Of-Programming-By-July/blob/master/ebook/zh/03.01.md</p>\n<h1><a id=\"_1097\"></a>\u7f16\u7a0b\u9898</h1>\n<h2><a id=\"1__1099\"></a>1 \u53f0\u9636\u95ee\u9898/\u6590\u6ce2\u90a3\u5951</h2>\n<p>\u4e00\u53ea\u9752\u86d9\u4e00\u6b21\u53ef\u4ee5\u8df3\u4e0a1\u7ea7\u53f0\u9636\uff0c\u4e5f\u53ef\u4ee5\u8df3\u4e0a2\u7ea7\u3002\u6c42\u8be5\u9752\u86d9\u8df3\u4e0a\u4e00\u4e2an\u7ea7\u7684\u53f0\u9636\u603b\u5171\u6709\u591a\u5c11\u79cd\u8df3\u6cd5\u3002</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">fib = <span class=\"hljs-keyword\">lambda</span> n: n <span class=\"hljs-keyword\">if</span> n &lt;= <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">else</span> fib(n - <span class=\"hljs-number\">1</span>) + fib(n - <span class=\"hljs-number\">2</span>)\n</code></div></pre>\n<p>\u7b2c\u4e8c\u79cd\u8bb0\u5fc6\u65b9\u6cd5</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">memo</span><span class=\"hljs-params\">(func)</span>:</span>\n    cache = {}\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">wrap</span><span class=\"hljs-params\">(*args)</span>:</span>\n        <span class=\"hljs-keyword\">if</span> args <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> cache:\n            cache[args] = func(*args)\n        <span class=\"hljs-keyword\">return</span> cache[args]\n    <span class=\"hljs-keyword\">return</span> wrap\n\n\n<span class=\"hljs-meta\">@memo</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fib</span><span class=\"hljs-params\">(i)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> i &lt; <span class=\"hljs-number\">2</span>:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">return</span> fib(i<span class=\"hljs-number\">-1</span>) + fib(i<span class=\"hljs-number\">-2</span>)\n</code></div></pre>\n<p>\u7b2c\u4e09\u79cd\u65b9\u6cd5</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">fib</span><span class=\"hljs-params\">(n)</span>:</span>\n    a, b = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> xrange(n):\n        a, b = b, a + b\n    <span class=\"hljs-keyword\">return</span> b\n</code></div></pre>\n<h2><a id=\"2__1136\"></a>2 \u53d8\u6001\u53f0\u9636\u95ee\u9898</h2>\n<p>\u4e00\u53ea\u9752\u86d9\u4e00\u6b21\u53ef\u4ee5\u8df3\u4e0a1\u7ea7\u53f0\u9636\uff0c\u4e5f\u53ef\u4ee5\u8df3\u4e0a2\u7ea7\u2026\u2026\u5b83\u4e5f\u53ef\u4ee5\u8df3\u4e0an\u7ea7\u3002\u6c42\u8be5\u9752\u86d9\u8df3\u4e0a\u4e00\u4e2an\u7ea7\u7684\u53f0\u9636\u603b\u5171\u6709\u591a\u5c11\u79cd\u8df3\u6cd5\u3002</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">fib = <span class=\"hljs-keyword\">lambda</span> n: n <span class=\"hljs-keyword\">if</span> n &lt; <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-number\">2</span> * fib(n - <span class=\"hljs-number\">1</span>)\n</code></div></pre>\n<h2><a id=\"3__1144\"></a>3 \u77e9\u5f62\u8986\u76d6</h2>\n<p>\u6211\u4eec\u53ef\u4ee5\u7528<code>2*1</code>\u7684\u5c0f\u77e9\u5f62\u6a2a\u7740\u6216\u8005\u7ad6\u7740\u53bb\u8986\u76d6\u66f4\u5927\u7684\u77e9\u5f62\u3002\u8bf7\u95ee\u7528n\u4e2a<code>2*1</code>\u7684\u5c0f\u77e9\u5f62\u65e0\u91cd\u53e0\u5730\u8986\u76d6\u4e00\u4e2a<code>2*n</code>\u7684\u5927\u77e9\u5f62\uff0c\u603b\u5171\u6709\u591a\u5c11\u79cd\u65b9\u6cd5\uff1f</p>\n<blockquote>\n<p>\u7b2c<code>2*n</code>\u4e2a\u77e9\u5f62\u7684\u8986\u76d6\u65b9\u6cd5\u7b49\u4e8e\u7b2c<code>2*(n-1)</code>\u52a0\u4e0a\u7b2c<code>2*(n-2)</code>\u7684\u65b9\u6cd5\u3002</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-python\">f = <span class=\"hljs-keyword\">lambda</span> n: <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">if</span> n &lt; <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">else</span> f(n - <span class=\"hljs-number\">1</span>) + f(n - <span class=\"hljs-number\">2</span>)\n</code></div></pre>\n<h2><a id=\"4__1154\"></a>4 \u6768\u6c0f\u77e9\u9635\u67e5\u627e</h2>\n<p>\u5728\u4e00\u4e2am\u884cn\u5217\u4e8c\u7ef4\u6570\u7ec4\u4e2d\uff0c\u6bcf\u4e00\u884c\u90fd\u6309\u7167\u4ece\u5de6\u5230\u53f3\u9012\u589e\u7684\u987a\u5e8f\u6392\u5e8f\uff0c\u6bcf\u4e00\u5217\u90fd\u6309\u7167\u4ece\u4e0a\u5230\u4e0b\u9012\u589e\u7684\u987a\u5e8f\u6392\u5e8f\u3002\u8bf7\u5b8c\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u8f93\u5165\u8fd9\u6837\u7684\u4e00\u4e2a\u4e8c\u7ef4\u6570\u7ec4\u548c\u4e00\u4e2a\u6574\u6570\uff0c\u5224\u65ad\u6570\u7ec4\u4e2d\u662f\u5426\u542b\u6709\u8be5\u6574\u6570\u3002</p>\n<p>\u4f7f\u7528Step-wise\u7ebf\u6027\u641c\u7d22\u3002</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get_value</span><span class=\"hljs-params\">(l, r, c)</span>:</span>\n    <span class=\"hljs-keyword\">return</span> l[r][c]\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">find</span><span class=\"hljs-params\">(l, x)</span>:</span>\n    m = len(l) - <span class=\"hljs-number\">1</span>\n    n = len(l[<span class=\"hljs-number\">0</span>]) - <span class=\"hljs-number\">1</span>\n    r = <span class=\"hljs-number\">0</span>\n    c = n\n    <span class=\"hljs-keyword\">while</span> c &gt;= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> r &lt;= m:\n        value = get_value(l, r, c)\n        <span class=\"hljs-keyword\">if</span> value == x:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">True</span>\n        <span class=\"hljs-keyword\">elif</span> value &gt; x:\n            c = c - <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-keyword\">elif</span> value &lt; x:\n            r = r + <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">False</span>\n</code></div></pre>\n<h2><a id=\"5__1180\"></a>5 \u53bb\u9664\u5217\u8868\u4e2d\u7684\u91cd\u590d\u5143\u7d20</h2>\n<p>\u7528\u96c6\u5408</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">list(set(l))\n</code></div></pre>\n<p>\u7528\u5b57\u5178</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">l1 = [<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>,<span class=\"hljs-string\">'d'</span>,<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>,<span class=\"hljs-string\">'a'</span>,<span class=\"hljs-string\">'a'</span>]\nl2 = {}.fromkeys(l1).keys()\n<span class=\"hljs-keyword\">print</span> l2\n</code></div></pre>\n<p>\u7528\u5b57\u5178\u5e76\u4fdd\u6301\u987a\u5e8f</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">l1 = [<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>,<span class=\"hljs-string\">'d'</span>,<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>,<span class=\"hljs-string\">'a'</span>,<span class=\"hljs-string\">'a'</span>]\nl2 = list(set(l1))\nl2.sort(key=l1.index)\n<span class=\"hljs-keyword\">print</span> l2\n</code></div></pre>\n<p>\u5217\u8868\u63a8\u5bfc\u5f0f</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">l1 = [<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>,<span class=\"hljs-string\">'d'</span>,<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>,<span class=\"hljs-string\">'a'</span>,<span class=\"hljs-string\">'a'</span>]\nl2 = []\n[l2.append(i) <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> l1 <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> i <span class=\"hljs-keyword\">in</span> l2]\n</code></div></pre>\n<p>sorted\u6392\u5e8f\u5e76\u4e14\u7528\u5217\u8868\u63a8\u5bfc\u5f0f.</p>\n<p>l = [\u2018b\u2019,\u2018c\u2019,\u2018d\u2019,\u2018b\u2019,\u2018c\u2019,\u2018a\u2019,\u2018a\u2019]<br />\n[single.append(i) for i in sorted(l) if i not in single]<br />\nprint single</p>\n<h2><a id=\"6__1219\"></a>6 \u94fe\u8868\u6210\u5bf9\u8c03\u6362</h2>\n<p><code>1-&gt;2-&gt;3-&gt;4</code>\u8f6c\u6362\u6210<code>2-&gt;1-&gt;4-&gt;3</code>.</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ListNode</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, x)</span>:</span>\n        self.val = x\n        self.next = <span class=\"hljs-keyword\">None</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Solution</span>:</span>\n    <span class=\"hljs-comment\"># @param a ListNode</span>\n    <span class=\"hljs-comment\"># @return a ListNode</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">swapPairs</span><span class=\"hljs-params\">(self, head)</span>:</span>\n        <span class=\"hljs-keyword\">if</span> head != <span class=\"hljs-keyword\">None</span> <span class=\"hljs-keyword\">and</span> head.next != <span class=\"hljs-keyword\">None</span>:\n            next = head.next\n            head.next = self.swapPairs(next.next)\n            next.next = head\n            <span class=\"hljs-keyword\">return</span> next\n        <span class=\"hljs-keyword\">return</span> head\n</code></div></pre>\n<h2><a id=\"7__1241\"></a>7 \u521b\u5efa\u5b57\u5178\u7684\u65b9\u6cd5</h2>\n<h3><a id=\"1__1243\"></a>1 \u76f4\u63a5\u521b\u5efa</h3>\n<pre><div class=\"hljs\"><code class=\"lang-python\">dict = {<span class=\"hljs-string\">'name'</span>:<span class=\"hljs-string\">'earth'</span>, <span class=\"hljs-string\">'port'</span>:<span class=\"hljs-string\">'80'</span>}\n</code></div></pre>\n<h3><a id=\"2__1249\"></a>2 \u5de5\u5382\u65b9\u6cd5</h3>\n<pre><div class=\"hljs\"><code class=\"lang-python\">items=[(<span class=\"hljs-string\">'name'</span>,<span class=\"hljs-string\">'earth'</span>),(<span class=\"hljs-string\">'port'</span>,<span class=\"hljs-string\">'80'</span>)]\ndict2=dict(items)\ndict1=dict(([<span class=\"hljs-string\">'name'</span>,<span class=\"hljs-string\">'earth'</span>],[<span class=\"hljs-string\">'port'</span>,<span class=\"hljs-string\">'80'</span>]))\n</code></div></pre>\n<h3><a id=\"3_fromkeys_1257\"></a>3 fromkeys()\u65b9\u6cd5</h3>\n<pre><div class=\"hljs\"><code class=\"lang-python\">dict1={}.fromkeys((<span class=\"hljs-string\">'x'</span>,<span class=\"hljs-string\">'y'</span>),<span class=\"hljs-number\">-1</span>)\ndict={<span class=\"hljs-string\">'x'</span>:<span class=\"hljs-number\">-1</span>,<span class=\"hljs-string\">'y'</span>:<span class=\"hljs-number\">-1</span>}\ndict2={}.fromkeys((<span class=\"hljs-string\">'x'</span>,<span class=\"hljs-string\">'y'</span>))\ndict2={<span class=\"hljs-string\">'x'</span>:<span class=\"hljs-keyword\">None</span>, <span class=\"hljs-string\">'y'</span>:<span class=\"hljs-keyword\">None</span>}\n</code></div></pre>\n<h2><a id=\"8__1266\"></a>8 \u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u5217\u8868</h2>\n<p>\u77e5\u4e4e\u8fdc\u7a0b\u9762\u8bd5\u8981\u6c42\u7f16\u7a0b</p>\n<blockquote>\n<p>\u5c3e\u9012\u5f52</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">_recursion_merge_sort2</span><span class=\"hljs-params\">(l1, l2, tmp)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> len(l1) == <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">or</span> len(l2) == <span class=\"hljs-number\">0</span>:\n        tmp.extend(l1)\n        tmp.extend(l2)\n        <span class=\"hljs-keyword\">return</span> tmp\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-keyword\">if</span> l1[<span class=\"hljs-number\">0</span>] &lt; l2[<span class=\"hljs-number\">0</span>]:\n            tmp.append(l1[<span class=\"hljs-number\">0</span>])\n            <span class=\"hljs-keyword\">del</span> l1[<span class=\"hljs-number\">0</span>]\n        <span class=\"hljs-keyword\">else</span>:\n            tmp.append(l2[<span class=\"hljs-number\">0</span>])\n            <span class=\"hljs-keyword\">del</span> l2[<span class=\"hljs-number\">0</span>]\n        <span class=\"hljs-keyword\">return</span> _recursion_merge_sort2(l1, l2, tmp)\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">recursion_merge_sort2</span><span class=\"hljs-params\">(l1, l2)</span>:</span>\n    <span class=\"hljs-keyword\">return</span> _recursion_merge_sort2(l1, l2, [])\n</code></div></pre>\n<blockquote>\n<p>\u5faa\u73af\u7b97\u6cd5</p>\n</blockquote>\n<p>\u601d\u8def\uff1a</p>\n<p>\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u7a7a\u5217\u8868</p>\n<p>\u6bd4\u8f83\u4e24\u4e2a\u5217\u8868\u7684\u9996\u4e2a\u5143\u7d20</p>\n<p>\u5c0f\u7684\u5c31\u63d2\u5165\u5230\u65b0\u5217\u8868\u91cc</p>\n<p>\u628a\u5df2\u7ecf\u63d2\u5165\u65b0\u5217\u8868\u7684\u5143\u7d20\u4ece\u65e7\u5217\u8868\u5220\u9664</p>\n<p>\u76f4\u5230\u4e24\u4e2a\u65e7\u5217\u8868\u6709\u4e00\u4e2a\u4e3a\u7a7a</p>\n<p>\u518d\u628a\u65e7\u5217\u8868\u52a0\u5230\u65b0\u5217\u8868\u540e\u9762</p>\n<pre><code class=\"lang-pyhton\">def loop_merge_sort(l1, l2):\n    tmp = []\n    while len(l1) &gt; 0 and len(l2) &gt; 0:\n        if l1[0] &lt; l2[0]:\n            tmp.append(l1[0])\n            del l1[0]\n        else:\n            tmp.append(l2[0])\n            del l2[0]\n    tmp.extend(l1)\n    tmp.extend(l2)\n    return tmp\n</code></pre>\n<blockquote>\n<p>pop\u5f39\u51fa</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-Python\">a = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">7</span>]\nb = [<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>]\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">merge_sortedlist</span><span class=\"hljs-params\">(a,b)</span>:</span>\n    c = []\n    <span class=\"hljs-keyword\">while</span> a <span class=\"hljs-keyword\">and</span> b:\n        <span class=\"hljs-keyword\">if</span> a[<span class=\"hljs-number\">0</span>] &gt;= b[<span class=\"hljs-number\">0</span>]:\n            c.append(b.pop(<span class=\"hljs-number\">0</span>))\n        <span class=\"hljs-keyword\">else</span>:\n            c.append(a.pop(<span class=\"hljs-number\">0</span>))\n    <span class=\"hljs-keyword\">while</span> a:\n        c.append(a.pop(<span class=\"hljs-number\">0</span>))\n    <span class=\"hljs-keyword\">while</span> b:\n        c.append(b.pop(<span class=\"hljs-number\">0</span>))\n    <span class=\"hljs-keyword\">return</span> c\n<span class=\"hljs-keyword\">print</span> merge_sortedlist(a,b)\n    \n</code></div></pre>\n<h2><a id=\"9__1347\"></a>9 \u4ea4\u53c9\u94fe\u8868\u6c42\u4ea4\u70b9</h2>\n<blockquote>\n<p>\u5176\u5b9e\u601d\u60f3\u53ef\u4ee5\u6309\u7167\u4ece\u5c3e\u5f00\u59cb\u6bd4\u8f83\u4e24\u4e2a\u94fe\u8868\uff0c\u5982\u679c\u76f8\u4ea4\uff0c\u5219\u4ece\u5c3e\u5f00\u59cb\u5fc5\u7136\u4e00\u81f4\uff0c\u53ea\u8981\u4ece\u5c3e\u5f00\u59cb\u6bd4\u8f83\uff0c\u76f4\u81f3\u4e0d\u4e00\u81f4\u7684\u5730\u65b9\u5373\u4e3a\u4ea4\u53c9\u70b9</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-comment\"># \u4f7f\u7528a,b\u4e24\u4e2alist\u6765\u6a21\u62df\u94fe\u8868\uff0c\u53ef\u4ee5\u770b\u51fa\u4ea4\u53c9\u70b9\u662f 7\u8fd9\u4e2a\u8282\u70b9</span>\na = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">5</span>]\nb = [<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">9</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">5</span>]\n\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">1</span>,min(len(a),len(b))):\n    <span class=\"hljs-keyword\">if</span> i==<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">and</span> (a[<span class=\"hljs-number\">-1</span>] != b[<span class=\"hljs-number\">-1</span>]):\n        <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"No\"</span>\n        <span class=\"hljs-keyword\">break</span>\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-keyword\">if</span> a[-i] != b[-i]:\n            <span class=\"hljs-keyword\">print</span> <span class=\"hljs-string\">\"\u4ea4\u53c9\u8282\u70b9\uff1a\"</span>,a[-i+<span class=\"hljs-number\">1</span>]\n            <span class=\"hljs-keyword\">break</span>\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">pass</span>\n</code></div></pre>\n<blockquote>\n<p>\u53e6\u5916\u4e00\u79cd\u6bd4\u8f83\u6b63\u89c4\u7684\u65b9\u6cd5\uff0c\u6784\u9020\u94fe\u8868\u7c7b</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ListNode</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, x)</span>:</span>\n        self.val = x\n        self.next = <span class=\"hljs-keyword\">None</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">node</span><span class=\"hljs-params\">(l1, l2)</span>:</span>\n    length1, lenth2 = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-comment\"># \u6c42\u4e24\u4e2a\u94fe\u8868\u957f\u5ea6</span>\n    <span class=\"hljs-keyword\">while</span> l1.next:\n        l1 = l1.next\n        length1 += <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">while</span> l2.next:\n        l2 = l2.next\n        length2 += <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-comment\"># \u957f\u7684\u94fe\u8868\u5148\u8d70</span>\n    <span class=\"hljs-keyword\">if</span> length1 &gt; lenth2:\n        <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> range(length1 - length2):\n            l1 = l1.next\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> range(length2 - length1):\n            l2 = l2.next\n    <span class=\"hljs-keyword\">while</span> l1 <span class=\"hljs-keyword\">and</span> l2:\n        <span class=\"hljs-keyword\">if</span> l1.next == l2.next:\n            <span class=\"hljs-keyword\">return</span> l1.next\n        <span class=\"hljs-keyword\">else</span>:\n            l1 = l1.next\n            l2 = l2.next\n</code></div></pre>\n<p>\u4fee\u6539\u4e86\u4e00\u4e0b:</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-comment\">#coding:utf-8</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ListNode</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, x)</span>:</span>\n        self.val = x\n        self.next = <span class=\"hljs-keyword\">None</span>\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">node</span><span class=\"hljs-params\">(l1, l2)</span>:</span>\n    length1, length2 = <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-comment\"># \u6c42\u4e24\u4e2a\u94fe\u8868\u957f\u5ea6</span>\n    <span class=\"hljs-keyword\">while</span> l1.next:\n        l1 = l1.next<span class=\"hljs-comment\">#\u5c3e\u8282\u70b9</span>\n        length1 += <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">while</span> l2.next:\n        l2 = l2.next<span class=\"hljs-comment\">#\u5c3e\u8282\u70b9</span>\n        length2 += <span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-comment\">#\u5982\u679c\u76f8\u4ea4</span>\n    <span class=\"hljs-keyword\">if</span> l1.next == l2.next:\n        <span class=\"hljs-comment\"># \u957f\u7684\u94fe\u8868\u5148\u8d70</span>\n        <span class=\"hljs-keyword\">if</span> length1 &gt; length2:\n            <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> range(length1 - length2):\n                l1 = l1.next\n            <span class=\"hljs-keyword\">return</span> l1<span class=\"hljs-comment\">#\u8fd4\u56de\u4ea4\u70b9</span>\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">for</span> _ <span class=\"hljs-keyword\">in</span> range(length2 - length1):\n                l2 = l2.next\n            <span class=\"hljs-keyword\">return</span> l2<span class=\"hljs-comment\">#\u8fd4\u56de\u4ea4\u70b9</span>\n    <span class=\"hljs-comment\"># \u5982\u679c\u4e0d\u76f8\u4ea4</span>\n    <span class=\"hljs-keyword\">else</span>:\n        <span class=\"hljs-keyword\">return</span>\n</code></div></pre>\n<p>\u601d\u8def: http://humaoli.blog.163.com/blog/static/13346651820141125102125995/</p>\n<h2><a id=\"10__1439\"></a>10 \u4e8c\u5206\u67e5\u627e</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\">\n<span class=\"hljs-comment\">#coding:utf-8</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">binary_search</span><span class=\"hljs-params\">(list, item)</span>:</span>\n    low = <span class=\"hljs-number\">0</span>\n    high = len(list) - <span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">while</span> low &lt;= high:\n        mid = (high - low) / <span class=\"hljs-number\">2</span> + low    <span class=\"hljs-comment\"># \u907f\u514d(high + low) / 2\u6ea2\u51fa</span>\n        guess = list[mid]\n        <span class=\"hljs-keyword\">if</span> guess &gt; item:\n            high = mid - <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-keyword\">elif</span> guess &lt; item:\n            low = mid + <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">return</span> mid\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">None</span>\nmylist = [<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">5</span>,<span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">9</span>]\n<span class=\"hljs-keyword\">print</span> binary_search(mylist, <span class=\"hljs-number\">3</span>)\n\n</code></div></pre>\n<p>\u53c2\u8003: http://blog.csdn.net/u013205877/article/details/76411718</p>\n<h2><a id=\"11__1465\"></a>11 \u5feb\u6392</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-comment\">#coding:utf-8</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span><span class=\"hljs-params\">(list)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> len(list)&lt;<span class=\"hljs-number\">2</span>:\n        <span class=\"hljs-keyword\">return</span> list\n    <span class=\"hljs-keyword\">else</span>:\n        midpivot = list[<span class=\"hljs-number\">0</span>]\n        lessbeforemidpivot = [i <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> list[<span class=\"hljs-number\">1</span>:] <span class=\"hljs-keyword\">if</span> i&lt;=midpivot]\n        biggerafterpivot = [i <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> list[<span class=\"hljs-number\">1</span>:] <span class=\"hljs-keyword\">if</span> i &gt; midpivot]\n        finallylist = quicksort(lessbeforemidpivot)+[midpivot]+quicksort(biggerafterpivot)\n        <span class=\"hljs-keyword\">return</span> finallylist\n\n<span class=\"hljs-keyword\">print</span> quicksort([<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">6</span>,<span class=\"hljs-number\">7</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">5</span>])\n</code></div></pre>\n<blockquote>\n<p>\u66f4\u591a\u6392\u5e8f\u95ee\u9898\u53ef\u89c1\uff1a<a href=\"http://blog.csdn.net/mrlevo520/article/details/77829204\" target=\"_blank\">\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5-\u6392\u5e8f\u7bc7-Python\u63cf\u8ff0</a></p>\n</blockquote>\n<h2><a id=\"12__1486\"></a>12 \u627e\u96f6\u95ee\u9898</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\">\n<span class=\"hljs-comment\">#coding:utf-8</span>\n<span class=\"hljs-comment\">#values\u662f\u786c\u5e01\u7684\u9762\u503cvalues = [ 25, 21, 10, 5, 1]</span>\n<span class=\"hljs-comment\">#valuesCounts   \u94b1\u5e01\u5bf9\u5e94\u7684\u79cd\u7c7b\u6570</span>\n<span class=\"hljs-comment\">#money  \u627e\u51fa\u6765\u7684\u603b\u94b1\u6570</span>\n<span class=\"hljs-comment\">#coinsUsed   \u5bf9\u5e94\u4e8e\u76ee\u524d\u94b1\u5e01\u603b\u6570i\u6240\u4f7f\u7528\u7684\u786c\u5e01\u6570\u76ee</span>\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">coinChange</span><span class=\"hljs-params\">(values,valuesCounts,money,coinsUsed)</span>:</span>\n    <span class=\"hljs-comment\">#\u904d\u5386\u51fa\u4ece1\u5230money\u6240\u6709\u7684\u94b1\u6570\u53ef\u80fd</span>\n    <span class=\"hljs-keyword\">for</span> cents <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">1</span>,money+<span class=\"hljs-number\">1</span>):\n        minCoins = cents\n        <span class=\"hljs-comment\">#\u628a\u6240\u6709\u7684\u786c\u5e01\u9762\u503c\u904d\u5386\u51fa\u6765\u548c\u94b1\u6570\u505a\u5bf9\u6bd4</span>\n        <span class=\"hljs-keyword\">for</span> kind <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">0</span>,valuesCounts):\n            <span class=\"hljs-keyword\">if</span> (values[kind] &lt;= cents):\n                temp = coinsUsed[cents - values[kind]] +<span class=\"hljs-number\">1</span>\n                <span class=\"hljs-keyword\">if</span> (temp &lt; minCoins):\n                    minCoins = temp\n        coinsUsed[cents] = minCoins\n        <span class=\"hljs-keyword\">print</span> (<span class=\"hljs-string\">'\u9762\u503c:{0}\u7684\u6700\u5c11\u786c\u5e01\u4f7f\u7528\u6570\u4e3a:{1}'</span>.format(cents, coinsUsed[cents]))\n\n</code></div></pre>\n<p>\u601d\u8def: http://blog.csdn.net/wdxin1322/article/details/9501163</p>\n<p>\u65b9\u6cd5: http://www.cnblogs.com/ChenxofHit/archive/2011/03/18/1988431.html</p>\n<h2><a id=\"13__1516\"></a>13 \u5e7f\u5ea6\u904d\u5386\u548c\u6df1\u5ea6\u904d\u5386\u4e8c\u53c9\u6811</h2>\n<p>\u7ed9\u5b9a\u4e00\u4e2a\u6570\u7ec4\uff0c\u6784\u5efa\u4e8c\u53c9\u6811\uff0c\u5e76\u4e14\u6309\u5c42\u6b21\u6253\u5370\u8fd9\u4e2a\u4e8c\u53c9\u6811</p>\n<h2><a id=\"14__1521\"></a>14 \u4e8c\u53c9\u6811\u8282\u70b9</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\">\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Node</span><span class=\"hljs-params\">(object)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, data, left=None, right=None)</span>:</span>\n        self.data = data\n        self.left = left\n        self.right = right\n\ntree = Node(<span class=\"hljs-number\">1</span>, Node(<span class=\"hljs-number\">3</span>, Node(<span class=\"hljs-number\">7</span>, Node(<span class=\"hljs-number\">0</span>)), Node(<span class=\"hljs-number\">6</span>)), Node(<span class=\"hljs-number\">2</span>, Node(<span class=\"hljs-number\">5</span>), Node(<span class=\"hljs-number\">4</span>)))\n\n</code></div></pre>\n<h2><a id=\"15__1535\"></a>15 \u5c42\u6b21\u904d\u5386</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\">\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">lookup</span><span class=\"hljs-params\">(root)</span>:</span>\n    row = [root]\n    <span class=\"hljs-keyword\">while</span> row:\n \u00a0 \u00a0 \u00a0 \u00a0print(row)\n \u00a0 \u00a0 \u00a0 \u00a0row = [kid <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> row <span class=\"hljs-keyword\">for</span> kid <span class=\"hljs-keyword\">in</span> (item.left, item.right) <span class=\"hljs-keyword\">if</span> kid]\n\n</code></div></pre>\n<h2><a id=\"16__1547\"></a>16 \u6df1\u5ea6\u904d\u5386</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\">\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">deep</span><span class=\"hljs-params\">(root)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:\n        <span class=\"hljs-keyword\">return</span>\n    <span class=\"hljs-keyword\">print</span> root.data\n    deep(root.left)\n    deep(root.right)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:\n    lookup(tree)\n    deep(tree)\n</code></div></pre>\n<h2><a id=\"17__1563\"></a>17 \u524d\u4e2d\u540e\u5e8f\u904d\u5386</h2>\n<p>\u6df1\u5ea6\u904d\u5386\u6539\u53d8\u987a\u5e8f\u5c31OK\u4e86</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\">\n<span class=\"hljs-comment\">#coding:utf-8</span>\n<span class=\"hljs-comment\">#\u4e8c\u53c9\u6811\u7684\u904d\u5386</span>\n<span class=\"hljs-comment\">#\u7b80\u5355\u7684\u4e8c\u53c9\u6811\u8282\u70b9\u7c7b</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Node</span><span class=\"hljs-params\">(object)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self,value,left,right)</span>:</span>\n        self.value = value\n        self.left = left\n        self.right = right\n\n<span class=\"hljs-comment\">#\u4e2d\u5e8f\u904d\u5386:\u904d\u5386\u5de6\u5b50\u6811,\u8bbf\u95ee\u5f53\u524d\u8282\u70b9,\u904d\u5386\u53f3\u5b50\u6811</span>\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">mid_travelsal</span><span class=\"hljs-params\">(root)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">None</span>:\n        mid_travelsal(root.left)\n    <span class=\"hljs-comment\">#\u8bbf\u95ee\u5f53\u524d\u8282\u70b9</span>\n    print(root.value)\n    <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">None</span>:\n        mid_travelsal(root.right)\n\n<span class=\"hljs-comment\">#\u524d\u5e8f\u904d\u5386:\u8bbf\u95ee\u5f53\u524d\u8282\u70b9,\u904d\u5386\u5de6\u5b50\u6811,\u904d\u5386\u53f3\u5b50\u6811</span>\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">pre_travelsal</span><span class=\"hljs-params\">(root)</span>:</span>\n    <span class=\"hljs-keyword\">print</span> (root.value)\n    <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">None</span>:\n        pre_travelsal(root.left)\n    <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">None</span>:\n        pre_travelsal(root.right)\n\n<span class=\"hljs-comment\">#\u540e\u7eed\u904d\u5386:\u904d\u5386\u5de6\u5b50\u6811,\u904d\u5386\u53f3\u5b50\u6811,\u8bbf\u95ee\u5f53\u524d\u8282\u70b9</span>\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">post_trvelsal</span><span class=\"hljs-params\">(root)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> root.left <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">None</span>:\n        post_trvelsal(root.left)\n    <span class=\"hljs-keyword\">if</span> root.right <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">None</span>:\n        post_trvelsal(root.right)\n    <span class=\"hljs-keyword\">print</span> (root.value)\n\n</code></div></pre>\n<h2><a id=\"18__1608\"></a>18 \u6c42\u6700\u5927\u6811\u6df1</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">maxDepth</span><span class=\"hljs-params\">(root)</span>:</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>\n        <span class=\"hljs-keyword\">return</span> max(maxDepth(root.left), maxDepth(root.right)) + <span class=\"hljs-number\">1</span>\n</code></div></pre>\n<h2><a id=\"19__1617\"></a>19 \u6c42\u4e24\u68f5\u6811\u662f\u5426\u76f8\u540c</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">isSameTree</span><span class=\"hljs-params\">(p, q)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> p == <span class=\"hljs-keyword\">None</span> <span class=\"hljs-keyword\">and</span> q == <span class=\"hljs-keyword\">None</span>:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">True</span>\n    <span class=\"hljs-keyword\">elif</span> p <span class=\"hljs-keyword\">and</span> q :\n        <span class=\"hljs-keyword\">return</span> p.val == q.val <span class=\"hljs-keyword\">and</span> isSameTree(p.left,q.left) <span class=\"hljs-keyword\">and</span> isSameTree(p.right,q.right)\n    <span class=\"hljs-keyword\">else</span> :\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">False</span>\n</code></div></pre>\n<h2><a id=\"20__1629\"></a>20 \u524d\u5e8f\u4e2d\u5e8f\u6c42\u540e\u5e8f</h2>\n<p>\u63a8\u8350: http://blog.csdn.net/hinyunsin/article/details/6315502</p>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">rebuild</span><span class=\"hljs-params\">(pre, center)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> pre:\n        <span class=\"hljs-keyword\">return</span>\n    cur = Node(pre[<span class=\"hljs-number\">0</span>])\n    index = center.index(pre[<span class=\"hljs-number\">0</span>])\n    cur.left = rebuild(pre[<span class=\"hljs-number\">1</span>:index + <span class=\"hljs-number\">1</span>], center[:index])\n    cur.right = rebuild(pre[index + <span class=\"hljs-number\">1</span>:], center[index + <span class=\"hljs-number\">1</span>:])\n    <span class=\"hljs-keyword\">return</span> cur\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">deep</span><span class=\"hljs-params\">(root)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> root:\n        <span class=\"hljs-keyword\">return</span>\n    deep(root.left)\n    deep(root.right)\n    <span class=\"hljs-keyword\">print</span> root.data\n</code></div></pre>\n<h2><a id=\"21__1651\"></a>21 \u5355\u94fe\u8868\u9006\u7f6e</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Node</span><span class=\"hljs-params\">(object)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, data=None, next=None)</span>:</span>\n        self.data = data\n        self.next = next\n\nlink = Node(<span class=\"hljs-number\">1</span>, Node(<span class=\"hljs-number\">2</span>, Node(<span class=\"hljs-number\">3</span>, Node(<span class=\"hljs-number\">4</span>, Node(<span class=\"hljs-number\">5</span>, Node(<span class=\"hljs-number\">6</span>, Node(<span class=\"hljs-number\">7</span>, Node(<span class=\"hljs-number\">8</span>, Node(<span class=\"hljs-number\">9</span>)))))))))\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">rev</span><span class=\"hljs-params\">(link)</span>:</span>\n    pre = link\n    cur = link.next\n    pre.next = <span class=\"hljs-keyword\">None</span>\n    <span class=\"hljs-keyword\">while</span> cur:\n        tmp = cur.next\n        cur.next = pre\n        pre = cur\n        cur = tmp\n    <span class=\"hljs-keyword\">return</span> pre\n\nroot = rev(link)\n<span class=\"hljs-keyword\">while</span> root:\n    <span class=\"hljs-keyword\">print</span> root.data\n    root = root.next\n</code></div></pre>\n<p>\u601d\u8def: http://blog.csdn.net/feliciafay/article/details/6841115</p>\n<p>\u65b9\u6cd5: http://www.xuebuyuan.com/2066385.html?mobile=1</p>\n<h2><a id=\"22__1683\"></a>22 \u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u662f\u53d8\u4f4d\u8bcd</h2>\n<pre><div class=\"hljs\"><code class=\"lang-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Anagram</span>:</span>\n    <span class=\"hljs-string\">\"\"\"\n    @:param s1: The first string\n    @:param s2: The second string\n    @:return true or false\n    \"\"\"</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">Solution1</span><span class=\"hljs-params\">(s1,s2)</span>:</span>\n        alist = list(s2)\n\n        pos1 = <span class=\"hljs-number\">0</span>\n        stillOK = <span class=\"hljs-keyword\">True</span>\n\n        <span class=\"hljs-keyword\">while</span> pos1 &lt; len(s1) <span class=\"hljs-keyword\">and</span> stillOK:\n            pos2 = <span class=\"hljs-number\">0</span>\n            found = <span class=\"hljs-keyword\">False</span>\n            <span class=\"hljs-keyword\">while</span> pos2 &lt; len(alist) <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">not</span> found:\n                <span class=\"hljs-keyword\">if</span> s1[pos1] == alist[pos2]:\n                    found = <span class=\"hljs-keyword\">True</span>\n                <span class=\"hljs-keyword\">else</span>:\n                    pos2 = pos2 + <span class=\"hljs-number\">1</span>\n\n            <span class=\"hljs-keyword\">if</span> found:\n                alist[pos2] = <span class=\"hljs-keyword\">None</span>\n            <span class=\"hljs-keyword\">else</span>:\n                stillOK = <span class=\"hljs-keyword\">False</span>\n\n            pos1 = pos1 + <span class=\"hljs-number\">1</span>\n\n        <span class=\"hljs-keyword\">return</span> stillOK\n\n    print(Solution1(<span class=\"hljs-string\">'abcd'</span>,<span class=\"hljs-string\">'dcba'</span>))\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">Solution2</span><span class=\"hljs-params\">(s1,s2)</span>:</span>\n        alist1 = list(s1)\n        alist2 = list(s2)\n\n        alist1.sort()\n        alist2.sort()\n\n\n        pos = <span class=\"hljs-number\">0</span>\n        matches = <span class=\"hljs-keyword\">True</span>\n\n        <span class=\"hljs-keyword\">while</span> pos &lt; len(s1) <span class=\"hljs-keyword\">and</span> matches:\n            <span class=\"hljs-keyword\">if</span> alist1[pos] == alist2[pos]:\n                pos = pos + <span class=\"hljs-number\">1</span>\n            <span class=\"hljs-keyword\">else</span>:\n                matches = <span class=\"hljs-keyword\">False</span>\n\n        <span class=\"hljs-keyword\">return</span> matches\n\n    print(Solution2(<span class=\"hljs-string\">'abcde'</span>,<span class=\"hljs-string\">'edcbg'</span>))\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">Solution3</span><span class=\"hljs-params\">(s1,s2)</span>:</span>\n        c1 = [<span class=\"hljs-number\">0</span>]*<span class=\"hljs-number\">26</span>\n        c2 = [<span class=\"hljs-number\">0</span>]*<span class=\"hljs-number\">26</span>\n\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(len(s1)):\n            pos = ord(s1[i])-ord(<span class=\"hljs-string\">'a'</span>)\n            c1[pos] = c1[pos] + <span class=\"hljs-number\">1</span>\n\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(len(s2)):\n            pos = ord(s2[i])-ord(<span class=\"hljs-string\">'a'</span>)\n            c2[pos] = c2[pos] + <span class=\"hljs-number\">1</span>\n\n        j = <span class=\"hljs-number\">0</span>\n        stillOK = <span class=\"hljs-keyword\">True</span>\n        <span class=\"hljs-keyword\">while</span> j&lt;<span class=\"hljs-number\">26</span> <span class=\"hljs-keyword\">and</span> stillOK:\n            <span class=\"hljs-keyword\">if</span> c1[j] == c2[j]:\n                j = j + <span class=\"hljs-number\">1</span>\n            <span class=\"hljs-keyword\">else</span>:\n                stillOK = <span class=\"hljs-keyword\">False</span>\n\n        <span class=\"hljs-keyword\">return</span> stillOK\n\n    print(Solution3(<span class=\"hljs-string\">'apple'</span>,<span class=\"hljs-string\">'pleap'</span>))\n</code></div></pre>\n<h2><a id=\"23__1767\"></a>23 \u52a8\u6001\u89c4\u5212\u95ee\u9898</h2>\n<blockquote>\n<p>\u53ef\u53c2\u8003\uff1a<a href=\"http://blog.csdn.net/mrlevo520/article/details/75676160\" target=\"_blank\">\u52a8\u6001\u89c4\u5212(DP)\u7684\u6574\u7406-Python\u63cf\u8ff0</a></p>\n</blockquote>", "body_md": "@[toc](\u76ee\u5f55)\n# Python\u8bed\u8a00\u7279\u6027\n\n## 1 Python\u7684\u51fd\u6570\u53c2\u6570\u4f20\u9012\n\n\u770b\u4e24\u4e2a\u4f8b\u5b50:\n\n```python\na = 1\ndef fun(a):\n    a = 2\nfun(a)\nprint a  # 1\n```\n\n```python\na = []\ndef fun(a):\n    a.append(1)\nfun(a)\nprint a  # [1]\n```\n\n\u6240\u6709\u7684\u53d8\u91cf\u90fd\u53ef\u4ee5\u7406\u89e3\u662f\u5185\u5b58\u4e2d\u4e00\u4e2a\u5bf9\u8c61\u7684\u201c\u5f15\u7528\u201d\uff0c\u6216\u8005\uff0c\u4e5f\u53ef\u4ee5\u770b\u4f3cc\u4e2dvoid*\u7684\u611f\u89c9\u3002\n\n\u901a\u8fc7`id`\u6765\u770b\u5f15\u7528`a`\u7684\u5185\u5b58\u5730\u5740\u53ef\u4ee5\u6bd4\u8f83\u7406\u89e3\uff1a\n\n```python\na = 1\ndef fun(a):\n    print \"func_in\",id(a)   # func_in 41322472\n    a = 2\n    print \"re-point\",id(a), id(2)   # re-point 41322448 41322448\nprint \"func_out\",id(a), id(1)  # func_out 41322472 41322472\nfun(a)\nprint a  # 1\n```\n\n\u6ce8\uff1a\u5177\u4f53\u7684\u503c\u5728\u4e0d\u540c\u7535\u8111\u4e0a\u8fd0\u884c\u65f6\u53ef\u80fd\u4e0d\u540c\u3002\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6267\u884c\u5b8c`a = 2`\u4e4b\u540e\uff0c`a`\u5f15\u7528\u4e2d\u4fdd\u5b58\u7684\u503c\uff0c\u5373\u5185\u5b58\u5730\u5740\u53d1\u751f\u53d8\u5316\uff0c\u7531\u539f\u6765`1`\u5bf9\u8c61\u7684\u6240\u5728\u7684\u5730\u5740\u53d8\u6210\u4e86`2`\u8fd9\u4e2a\u5b9e\u4f53\u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\u3002\n\n\u800c\u7b2c2\u4e2a\u4f8b\u5b50`a`\u5f15\u7528\u4fdd\u5b58\u7684\u5185\u5b58\u503c\u5c31\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff1a\n\n```python\na = []\ndef fun(a):\n    print \"func_in\",id(a)  # func_in 53629256\n    a.append(1)\nprint \"func_out\",id(a)     # func_out 53629256\nfun(a)\nprint a  # [1]\n```\n\n\u8fd9\u91cc\u8bb0\u4f4f\u7684\u662f\u7c7b\u578b\u662f\u5c5e\u4e8e\u5bf9\u8c61\u7684\uff0c\u800c\u4e0d\u662f\u53d8\u91cf\u3002\u800c\u5bf9\u8c61\u6709\u4e24\u79cd,\u201c\u53ef\u66f4\u6539\u201d\uff08mutable\uff09\u4e0e\u201c\u4e0d\u53ef\u66f4\u6539\u201d\uff08immutable\uff09\u5bf9\u8c61\u3002\u5728python\u4e2d\uff0cstrings, tuples, \u548cnumbers\u662f\u4e0d\u53ef\u66f4\u6539\u7684\u5bf9\u8c61\uff0c\u800c list, dict, set \u7b49\u5219\u662f\u53ef\u4ee5\u4fee\u6539\u7684\u5bf9\u8c61\u3002(\u8fd9\u5c31\u662f\u8fd9\u4e2a\u95ee\u9898\u7684\u91cd\u70b9)\n\n\u5f53\u4e00\u4e2a\u5f15\u7528\u4f20\u9012\u7ed9\u51fd\u6570\u7684\u65f6\u5019,\u51fd\u6570\u81ea\u52a8\u590d\u5236\u4e00\u4efd\u5f15\u7528,\u8fd9\u4e2a\u51fd\u6570\u91cc\u7684\u5f15\u7528\u548c\u5916\u8fb9\u7684\u5f15\u7528\u6ca1\u6709\u534a\u6bdb\u5173\u7cfb\u4e86.\u6240\u4ee5\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u91cc\u51fd\u6570\u628a\u5f15\u7528\u6307\u5411\u4e86\u4e00\u4e2a\u4e0d\u53ef\u53d8\u5bf9\u8c61,\u5f53\u51fd\u6570\u8fd4\u56de\u7684\u65f6\u5019,\u5916\u9762\u7684\u5f15\u7528\u6ca1\u534a\u6bdb\u611f\u89c9.\u800c\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u5c31\u4e0d\u4e00\u6837\u4e86,\u51fd\u6570\u5185\u7684\u5f15\u7528\u6307\u5411\u7684\u662f\u53ef\u53d8\u5bf9\u8c61,\u5bf9\u5b83\u7684\u64cd\u4f5c\u5c31\u548c\u5b9a\u4f4d\u4e86\u6307\u9488\u5730\u5740\u4e00\u6837,\u5728\u5185\u5b58\u91cc\u8fdb\u884c\u4fee\u6539.\n\n\u5982\u679c\u8fd8\u4e0d\u660e\u767d\u7684\u8bdd,\u8fd9\u91cc\u6709\u66f4\u597d\u7684\u89e3\u91ca: http://stackoverflow.com/questions/986006/how-do-i-pass-a-variable-by-reference\n\n## 2 Python\u4e2d\u7684\u5143\u7c7b(metaclass)\n\n\u8fd9\u4e2a\u975e\u5e38\u7684\u4e0d\u5e38\u7528,\u4f46\u662f\u50cfORM\u8fd9\u79cd\u590d\u6742\u7684\u7ed3\u6784\u8fd8\u662f\u4f1a\u9700\u8981\u7684,\u8be6\u60c5\u8bf7\u770b:http://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python\n\n## 3 @staticmethod\u548c@classmethod\n\nPython\u5176\u5b9e\u67093\u4e2a\u65b9\u6cd5,\u5373\u9759\u6001\u65b9\u6cd5(staticmethod),\u7c7b\u65b9\u6cd5(classmethod)\u548c\u5b9e\u4f8b\u65b9\u6cd5,\u5982\u4e0b:\n\n```python\ndef foo(x):\n    print \"executing foo(%s)\"%(x)\n\nclass A(object):\n    def foo(self,x):\n        print \"executing foo(%s,%s)\"%(self,x)\n\n    @classmethod\n    def class_foo(cls,x):\n        print \"executing class_foo(%s,%s)\"%(cls,x)\n\n    @staticmethod\n    def static_foo(x):\n        print \"executing static_foo(%s)\"%x\n\na=A()\n\n```\n\n\u8fd9\u91cc\u5148\u7406\u89e3\u4e0b\u51fd\u6570\u53c2\u6570\u91cc\u9762\u7684self\u548ccls.\u8fd9\u4e2aself\u548ccls\u662f\u5bf9\u7c7b\u6216\u8005\u5b9e\u4f8b\u7684\u7ed1\u5b9a,\u5bf9\u4e8e\u4e00\u822c\u7684\u51fd\u6570\u6765\u8bf4\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u8c03\u7528`foo(x)`,\u8fd9\u4e2a\u51fd\u6570\u5c31\u662f\u6700\u5e38\u7528\u7684,\u5b83\u7684\u5de5\u4f5c\u8ddf\u4efb\u4f55\u4e1c\u897f(\u7c7b,\u5b9e\u4f8b)\u65e0\u5173.\u5bf9\u4e8e\u5b9e\u4f8b\u65b9\u6cd5,\u6211\u4eec\u77e5\u9053\u5728\u7c7b\u91cc\u6bcf\u6b21\u5b9a\u4e49\u65b9\u6cd5\u7684\u65f6\u5019\u90fd\u9700\u8981\u7ed1\u5b9a\u8fd9\u4e2a\u5b9e\u4f8b,\u5c31\u662f`foo(self, x)`,\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u505a\u5462?\u56e0\u4e3a\u5b9e\u4f8b\u65b9\u6cd5\u7684\u8c03\u7528\u79bb\u4e0d\u5f00\u5b9e\u4f8b,\u6211\u4eec\u9700\u8981\u628a\u5b9e\u4f8b\u81ea\u5df1\u4f20\u7ed9\u51fd\u6570,\u8c03\u7528\u7684\u65f6\u5019\u662f\u8fd9\u6837\u7684`a.foo(x)`(\u5176\u5b9e\u662f`foo(a, x)`).\u7c7b\u65b9\u6cd5\u4e00\u6837,\u53ea\u4e0d\u8fc7\u5b83\u4f20\u9012\u7684\u662f\u7c7b\u800c\u4e0d\u662f\u5b9e\u4f8b,`A.class_foo(x)`.\u6ce8\u610f\u8fd9\u91cc\u7684self\u548ccls\u53ef\u4ee5\u66ff\u6362\u522b\u7684\u53c2\u6570,\u4f46\u662fpython\u7684\u7ea6\u5b9a\u662f\u8fd9\u4fe9,\u8fd8\u662f\u4e0d\u8981\u6539\u7684\u597d.\n\n\u5bf9\u4e8e\u9759\u6001\u65b9\u6cd5\u5176\u5b9e\u548c\u666e\u901a\u7684\u65b9\u6cd5\u4e00\u6837,\u4e0d\u9700\u8981\u5bf9\u8c01\u8fdb\u884c\u7ed1\u5b9a,\u552f\u4e00\u7684\u533a\u522b\u662f\u8c03\u7528\u7684\u65f6\u5019\u9700\u8981\u4f7f\u7528`a.static_foo(x)`\u6216\u8005`A.static_foo(x)`\u6765\u8c03\u7528.\n\n| \\\\      | \u5b9e\u4f8b\u65b9\u6cd5     | \u7c7b\u65b9\u6cd5            | \u9759\u6001\u65b9\u6cd5            |\n| :------ | :------- | :------------- | :-------------- |\n| a = A() | a.foo(x) | a.class_foo(x) | a.static_foo(x) |\n| A       | \u4e0d\u53ef\u7528      | A.class_foo(x) | A.static_foo(x) |\n\n\u66f4\u591a\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898:\n1. http://stackoverflow.com/questions/136097/what-is-the-difference-between-staticmethod-and-classmethod-in-python\n2. https://realpython.com/blog/python/instance-class-and-static-methods-demystified/\n## 4 \u7c7b\u53d8\u91cf\u548c\u5b9e\u4f8b\u53d8\u91cf\n\n**\u7c7b\u53d8\u91cf\uff1a**\n\n> \u200b\t\u662f\u53ef\u5728\u7c7b\u7684\u6240\u6709\u5b9e\u4f8b\u4e4b\u95f4\u5171\u4eab\u7684\u503c\uff08\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4eec\u4e0d\u662f\u5355\u72ec\u5206\u914d\u7ed9\u6bcf\u4e2a\u5b9e\u4f8b\u7684\uff09\u3002\u4f8b\u5982\u4e0b\u4f8b\u4e2d\uff0cnum_of_instance \u5c31\u662f\u7c7b\u53d8\u91cf\uff0c\u7528\u4e8e\u8ddf\u8e2a\u5b58\u5728\u7740\u591a\u5c11\u4e2aTest \u7684\u5b9e\u4f8b\u3002\n\n**\u5b9e\u4f8b\u53d8\u91cf\uff1a**\n\n> \u5b9e\u4f8b\u5316\u4e4b\u540e\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5355\u72ec\u62e5\u6709\u7684\u53d8\u91cf\u3002\n\n```python\nclass Test(object):  \n    num_of_instance = 0  \n    def __init__(self, name):  \n        self.name = name  \n        Test.num_of_instance += 1  \n  \nif __name__ == '__main__':  \n    print Test.num_of_instance   # 0\n    t1 = Test('jack')  \n    print Test.num_of_instance   # 1\n    t2 = Test('lucy')  \n    print t1.name , t1.num_of_instance  # jack 2\n    print t2.name , t2.num_of_instance  # lucy 2\n```\n\n> \u8865\u5145\u7684\u4f8b\u5b50\n\n```python\nclass Person:\n    name=\"aaa\"\n\np1=Person()\np2=Person()\np1.name=\"bbb\"\nprint p1.name  # bbb\nprint p2.name  # aaa\nprint Person.name  # aaa\n```\n\n\u8fd9\u91cc`p1.name=\"bbb\"`\u662f\u5b9e\u4f8b\u8c03\u7528\u4e86\u7c7b\u53d8\u91cf,\u8fd9\u5176\u5b9e\u548c\u4e0a\u9762\u7b2c\u4e00\u4e2a\u95ee\u9898\u4e00\u6837,\u5c31\u662f\u51fd\u6570\u4f20\u53c2\u7684\u95ee\u9898,`p1.name`\u4e00\u5f00\u59cb\u662f\u6307\u5411\u7684\u7c7b\u53d8\u91cf`name=\"aaa\"`,\u4f46\u662f\u5728\u5b9e\u4f8b\u7684\u4f5c\u7528\u57df\u91cc\u628a\u7c7b\u53d8\u91cf\u7684\u5f15\u7528\u6539\u53d8\u4e86,\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u5b9e\u4f8b\u53d8\u91cf,self.name\u4e0d\u518d\u5f15\u7528Person\u7684\u7c7b\u53d8\u91cfname\u4e86.\n\n\u53ef\u4ee5\u770b\u770b\u4e0b\u9762\u7684\u4f8b\u5b50:\n\n```python\nclass Person:\n    name=[]\n\np1=Person()\np2=Person()\np1.name.append(1)\nprint p1.name  # [1]\nprint p2.name  # [1]\nprint Person.name  # [1]\n```\n\n\u53c2\u8003:http://stackoverflow.com/questions/6470428/catch-multiple-exceptions-in-one-line-except-block\n\n## 5 Python\u81ea\u7701\n\n\u8fd9\u4e2a\u4e5f\u662fpython\u5f6a\u608d\u7684\u7279\u6027.\n\n\u81ea\u7701\u5c31\u662f\u9762\u5411\u5bf9\u8c61\u7684\u8bed\u8a00\u6240\u5199\u7684\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6,\u6240\u80fd\u77e5\u9053\u5bf9\u8c61\u7684\u7c7b\u578b.\u7b80\u5355\u4e00\u53e5\u5c31\u662f\u8fd0\u884c\u65f6\u80fd\u591f\u83b7\u5f97\u5bf9\u8c61\u7684\u7c7b\u578b.\u6bd4\u5982type(),dir(),getattr(),hasattr(),isinstance().\n\n```python\na = [1,2,3]\nb = {'a':1,'b':2,'c':3}\nc = True\nprint type(a),type(b),type(c) # <type 'list'> <type 'dict'> <type 'bool'>\nprint isinstance(a,list)  # True\n```\n\n\n\n## 6 \u5b57\u5178\u63a8\u5bfc\u5f0f\n\n\u53ef\u80fd\u4f60\u89c1\u8fc7\u5217\u8868\u63a8\u5bfc\u65f6,\u5374\u6ca1\u6709\u89c1\u8fc7\u5b57\u5178\u63a8\u5bfc\u5f0f,\u57282.7\u4e2d\u624d\u52a0\u5165\u7684:\n\n```python\nd = {key: value for (key, value) in iterable}\n```\n\n## 7 Python\u4e2d\u5355\u4e0b\u5212\u7ebf\u548c\u53cc\u4e0b\u5212\u7ebf\n\n```python\n>>> class MyClass():\n...     def __init__(self):\n...             self.__superprivate = \"Hello\"\n...             self._semiprivate = \", world!\"\n...\n>>> mc = MyClass()\n>>> print mc.__superprivate\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nAttributeError: myClass instance has no attribute '__superprivate'\n>>> print mc._semiprivate\n, world!\n>>> print mc.__dict__\n{'_MyClass__superprivate': 'Hello', '_semiprivate': ', world!'}\n```\n\n`__foo__`:\u4e00\u79cd\u7ea6\u5b9a,Python\u5185\u90e8\u7684\u540d\u5b57,\u7528\u6765\u533a\u522b\u5176\u4ed6\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u547d\u540d,\u4ee5\u9632\u51b2\u7a81\uff0c\u5c31\u662f\u4f8b\u5982`__init__()`,`__del__()`,`__call__()`\u8fd9\u4e9b\u7279\u6b8a\u65b9\u6cd5\n\n`_foo`:\u4e00\u79cd\u7ea6\u5b9a,\u7528\u6765\u6307\u5b9a\u53d8\u91cf\u79c1\u6709.\u7a0b\u5e8f\u5458\u7528\u6765\u6307\u5b9a\u79c1\u6709\u53d8\u91cf\u7684\u4e00\u79cd\u65b9\u5f0f.\u4e0d\u80fd\u7528from module import * \u5bfc\u5165\uff0c\u5176\u4ed6\u65b9\u9762\u548c\u516c\u6709\u4e00\u6837\u8bbf\u95ee\uff1b\n\n`__foo`:\u8fd9\u4e2a\u6709\u771f\u6b63\u7684\u610f\u4e49:\u89e3\u6790\u5668\u7528`_classname__foo`\u6765\u4ee3\u66ff\u8fd9\u4e2a\u540d\u5b57,\u4ee5\u533a\u522b\u548c\u5176\u4ed6\u7c7b\u76f8\u540c\u7684\u547d\u540d,\u5b83\u65e0\u6cd5\u76f4\u63a5\u50cf\u516c\u6709\u6210\u5458\u4e00\u6837\u968f\u4fbf\u8bbf\u95ee,\u901a\u8fc7\u5bf9\u8c61\u540d._\u7c7b\u540d__xxx\u8fd9\u6837\u7684\u65b9\u5f0f\u53ef\u4ee5\u8bbf\u95ee.\n\n\u8be6\u60c5\u89c1:http://stackoverflow.com/questions/1301346/the-meaning-of-a-single-and-a-double-underscore-before-an-object-name-in-python\n\n\u6216\u8005: http://www.zhihu.com/question/19754941\n\n## 8 \u5b57\u7b26\u4e32\u683c\u5f0f\u5316:%\u548c.format\n\n.format\u5728\u8bb8\u591a\u65b9\u9762\u770b\u8d77\u6765\u66f4\u4fbf\u5229.\u5bf9\u4e8e`%`\u6700\u70e6\u4eba\u7684\u662f\u5b83\u65e0\u6cd5\u540c\u65f6\u4f20\u9012\u4e00\u4e2a\u53d8\u91cf\u548c\u5143\u7ec4.\u4f60\u53ef\u80fd\u4f1a\u60f3\u4e0b\u9762\u7684\u4ee3\u7801\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898:\n\n```\n\"hi there %s\" % name\n```\n\n\u4f46\u662f,\u5982\u679cname\u6070\u597d\u662f(1,2,3),\u5b83\u5c06\u4f1a\u629b\u51fa\u4e00\u4e2aTypeError\u5f02\u5e38.\u4e3a\u4e86\u4fdd\u8bc1\u5b83\u603b\u662f\u6b63\u786e\u7684,\u4f60\u5fc5\u987b\u8fd9\u6837\u505a:\n\n```\n\"hi there %s\" % (name,)   # \u63d0\u4f9b\u4e00\u4e2a\u5355\u5143\u7d20\u7684\u6570\u7ec4\u800c\u4e0d\u662f\u4e00\u4e2a\u53c2\u6570\n```\n\n\u4f46\u662f\u6709\u70b9\u4e11..format\u5c31\u6ca1\u6709\u8fd9\u4e9b\u95ee\u9898.\u4f60\u7ed9\u7684\u7b2c\u4e8c\u4e2a\u95ee\u9898\u4e5f\u662f\u8fd9\u6837,.format\u597d\u770b\u591a\u4e86.\n\n\u4f60\u4e3a\u4ec0\u4e48\u4e0d\u7528\u5b83?\n\n* \u4e0d\u77e5\u9053\u5b83(\u5728\u8bfb\u8fd9\u4e2a\u4e4b\u524d)\n* \u4e3a\u4e86\u548cPython2.5\u517c\u5bb9(\u8b6c\u5982logging\u5e93\u5efa\u8bae\u4f7f\u7528`%`([issue #4](https://github.com/taizilongxu/interview_python/issues/4)))\n\nhttp://stackoverflow.com/questions/5082452/python-string-formatting-vs-format\n\n## 9 \u8fed\u4ee3\u5668\u548c\u751f\u6210\u5668\n\n\u8fd9\u4e2a\u662fstackoverflow\u91ccpython\u6392\u540d\u7b2c\u4e00\u7684\u95ee\u9898,\u503c\u5f97\u4e00\u770b: http://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do-in-python\n\n\u8fd9\u662f\u4e2d\u6587\u7248: http://taizilongxu.gitbooks.io/stackoverflow-about-python/content/1/README.html\n\n\u8fd9\u91cc\u6709\u4e2a\u5173\u4e8e\u751f\u6210\u5668\u7684\u521b\u5efa\u95ee\u9898\u9762\u8bd5\u5b98\u6709\u8003\uff1a\n\u95ee\uff1a  \u5c06\u5217\u8868\u751f\u6210\u5f0f\u4e2d[]\u6539\u6210() \u4e4b\u540e\u6570\u636e\u7ed3\u6784\u662f\u5426\u6539\u53d8\uff1f \n\u7b54\u6848\uff1a\u662f\uff0c\u4ece\u5217\u8868\u53d8\u4e3a\u751f\u6210\u5668\n\n```python\n>>> L = [x*x for x in range(10)]\n>>> L\n[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]\n>>> g = (x*x for x in range(10))\n>>> g\n<generator object <genexpr> at 0x0000028F8B774200>\n```\n\u901a\u8fc7\u5217\u8868\u751f\u6210\u5f0f\uff0c\u53ef\u4ee5\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u5217\u8868\u3002\u4f46\u662f\uff0c\u53d7\u5230\u5185\u5b58\u9650\u5236\uff0c\u5217\u8868\u5bb9\u91cf\u80af\u5b9a\u662f\u6709\u9650\u7684\u3002\u800c\u4e14\uff0c\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u767e\u4e07\u5143\u7d20\u7684\u5217\u8868\uff0c\u4e0d\u4ec5\u662f\u5360\u7528\u5f88\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\uff1a\u6211\u4eec\u53ea\u9700\u8981\u8bbf\u95ee\u524d\u9762\u7684\u51e0\u4e2a\u5143\u7d20\uff0c\u540e\u9762\u5927\u90e8\u5206\u5143\u7d20\u6240\u5360\u7684\u7a7a\u95f4\u90fd\u662f\u6d6a\u8d39\u7684\u3002\u56e0\u6b64\uff0c\u6ca1\u6709\u5fc5\u8981\u521b\u5efa\u5b8c\u6574\u7684\u5217\u8868\uff08\u8282\u7701\u5927\u91cf\u5185\u5b58\u7a7a\u95f4\uff09\u3002\u5728Python\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u751f\u6210\u5668\uff1a\u8fb9\u5faa\u73af\uff0c\u8fb9\u8ba1\u7b97\u7684\u673a\u5236\u2014>generator\n\n## 10 `*args` and `**kwargs`\n\n\u7528`*args`\u548c`**kwargs`\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u5e76\u6ca1\u6709\u5f3a\u5236\u4f7f\u7528\u5b83\u4eec.\n\n\u5f53\u4f60\u4e0d\u786e\u5b9a\u4f60\u7684\u51fd\u6570\u91cc\u5c06\u8981\u4f20\u9012\u591a\u5c11\u53c2\u6570\u65f6\u4f60\u53ef\u4ee5\u7528`*args`.\u4f8b\u5982,\u5b83\u53ef\u4ee5\u4f20\u9012\u4efb\u610f\u6570\u91cf\u7684\u53c2\u6570:\n\n```python\n>>> def print_everything(*args):\n        for count, thing in enumerate(args):\n...         print '{0}. {1}'.format(count, thing)\n...\n>>> print_everything('apple', 'banana', 'cabbage')\n0. apple\n1. banana\n2. cabbage\n```\n\n\u76f8\u4f3c\u7684,`**kwargs`\u5141\u8bb8\u4f60\u4f7f\u7528\u6ca1\u6709\u4e8b\u5148\u5b9a\u4e49\u7684\u53c2\u6570\u540d:\n\n```python\n>>> def table_things(**kwargs):\n...     for name, value in kwargs.items():\n...         print '{0} = {1}'.format(name, value)\n...\n>>> table_things(apple = 'fruit', cabbage = 'vegetable')\ncabbage = vegetable\napple = fruit\n```\n\n\u4f60\u4e5f\u53ef\u4ee5\u6df7\u7740\u7528.\u547d\u540d\u53c2\u6570\u9996\u5148\u83b7\u5f97\u53c2\u6570\u503c\u7136\u540e\u6240\u6709\u7684\u5176\u4ed6\u53c2\u6570\u90fd\u4f20\u9012\u7ed9`*args`\u548c`**kwargs`.\u547d\u540d\u53c2\u6570\u5728\u5217\u8868\u7684\u6700\u524d\u7aef.\u4f8b\u5982:\n\n```\ndef table_things(titlestring, **kwargs)\n```\n\n`*args`\u548c`**kwargs`\u53ef\u4ee5\u540c\u65f6\u5728\u51fd\u6570\u7684\u5b9a\u4e49\u4e2d,\u4f46\u662f`*args`\u5fc5\u987b\u5728`**kwargs`\u524d\u9762.\n\n\u5f53\u8c03\u7528\u51fd\u6570\u65f6\u4f60\u4e5f\u53ef\u4ee5\u7528`*`\u548c`**`\u8bed\u6cd5.\u4f8b\u5982:\n\n```python\n>>> def print_three_things(a, b, c):\n...     print 'a = {0}, b = {1}, c = {2}'.format(a,b,c)\n...\n>>> mylist = ['aardvark', 'baboon', 'cat']\n>>> print_three_things(*mylist)\n\na = aardvark, b = baboon, c = cat\n```\n\n\u5c31\u50cf\u4f60\u770b\u5230\u7684\u4e00\u6837,\u5b83\u53ef\u4ee5\u4f20\u9012\u5217\u8868(\u6216\u8005\u5143\u7ec4)\u7684\u6bcf\u4e00\u9879\u5e76\u628a\u5b83\u4eec\u89e3\u5305.\u6ce8\u610f\u5fc5\u987b\u4e0e\u5b83\u4eec\u5728\u51fd\u6570\u91cc\u7684\u53c2\u6570\u76f8\u543b\u5408.\u5f53\u7136,\u4f60\u4e5f\u53ef\u4ee5\u5728\u51fd\u6570\u5b9a\u4e49\u6216\u8005\u51fd\u6570\u8c03\u7528\u65f6\u7528*.\n\nhttp://stackoverflow.com/questions/3394835/args-and-kwargs\n\n## 11 \u9762\u5411\u5207\u9762\u7f16\u7a0bAOP\u548c\u88c5\u9970\u5668\n\n\u8fd9\u4e2aAOP\u4e00\u542c\u8d77\u6765\u6709\u70b9\u61f5,\u540c\u5b66\u9762\u963f\u91cc\u7684\u65f6\u5019\u5c31\u88ab\u95ee\u61f5\u4e86...\n\n\u88c5\u9970\u5668\u662f\u4e00\u4e2a\u5f88\u8457\u540d\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7ecf\u5e38\u88ab\u7528\u4e8e\u6709\u5207\u9762\u9700\u6c42\u7684\u573a\u666f\uff0c\u8f83\u4e3a\u7ecf\u5178\u7684\u6709\u63d2\u5165\u65e5\u5fd7\u3001\u6027\u80fd\u6d4b\u8bd5\u3001\u4e8b\u52a1\u5904\u7406\u7b49\u3002\u88c5\u9970\u5668\u662f\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u7684\u7edd\u4f73\u8bbe\u8ba1\uff0c\u6709\u4e86\u88c5\u9970\u5668\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u62bd\u79bb\u51fa\u5927\u91cf\u51fd\u6570\u4e2d\u4e0e\u51fd\u6570\u529f\u80fd\u672c\u8eab\u65e0\u5173\u7684\u96f7\u540c\u4ee3\u7801\u5e76\u7ee7\u7eed\u91cd\u7528\u3002\u6982\u62ec\u7684\u8bb2\uff0c**\u88c5\u9970\u5668\u7684\u4f5c\u7528\u5c31\u662f\u4e3a\u5df2\u7ecf\u5b58\u5728\u7684\u5bf9\u8c61\u6dfb\u52a0\u989d\u5916\u7684\u529f\u80fd\u3002**\n\n\u8fd9\u4e2a\u95ee\u9898\u6bd4\u8f83\u5927,\u63a8\u8350: http://stackoverflow.com/questions/739654/how-can-i-make-a-chain-of-function-decorators-in-python\n\n\u4e2d\u6587: http://taizilongxu.gitbooks.io/stackoverflow-about-python/content/3/README.html\n\n## 12 \u9e2d\u5b50\u7c7b\u578b\n\n\u201c\u5f53\u770b\u5230\u4e00\u53ea\u9e1f\u8d70\u8d77\u6765\u50cf\u9e2d\u5b50\u3001\u6e38\u6cf3\u8d77\u6765\u50cf\u9e2d\u5b50\u3001\u53eb\u8d77\u6765\u4e5f\u50cf\u9e2d\u5b50\uff0c\u90a3\u4e48\u8fd9\u53ea\u9e1f\u5c31\u53ef\u4ee5\u88ab\u79f0\u4e3a\u9e2d\u5b50\u3002\u201d\n\n\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u5bf9\u8c61\u662f\u4ec0\u4e48\u7c7b\u578b\uff0c\u5230\u5e95\u662f\u4e0d\u662f\u9e2d\u5b50\uff0c\u53ea\u5173\u5fc3\u884c\u4e3a\u3002\n\n\u6bd4\u5982\u5728python\u4e2d\uff0c\u6709\u5f88\u591afile-like\u7684\u4e1c\u897f\uff0c\u6bd4\u5982StringIO,GzipFile,socket\u3002\u5b83\u4eec\u6709\u5f88\u591a\u76f8\u540c\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u628a\u5b83\u4eec\u5f53\u4f5c\u6587\u4ef6\u4f7f\u7528\u3002\n\n\u53c8\u6bd4\u5982list.extend()\u65b9\u6cd5\u4e2d,\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u5b83\u7684\u53c2\u6570\u662f\u4e0d\u662flist,\u53ea\u8981\u5b83\u662f\u53ef\u8fed\u4ee3\u7684,\u6240\u4ee5\u5b83\u7684\u53c2\u6570\u53ef\u4ee5\u662flist/tuple/dict/\u5b57\u7b26\u4e32/\u751f\u6210\u5668\u7b49.\n\n\u9e2d\u5b50\u7c7b\u578b\u5728\u52a8\u6001\u8bed\u8a00\u4e2d\u7ecf\u5e38\u4f7f\u7528\uff0c\u975e\u5e38\u7075\u6d3b\uff0c\u4f7f\u5f97python\u4e0d\u60f3java\u90a3\u6837\u4e13\u95e8\u53bb\u5f04\u4e00\u5927\u5806\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3002\n\n## 13 Python\u4e2d\u91cd\u8f7d\n\n\u5f15\u81ea\u77e5\u4e4e:http://www.zhihu.com/question/20053359\n\n\u51fd\u6570\u91cd\u8f7d\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898\u3002\n\n1. \u53ef\u53d8\u53c2\u6570\u7c7b\u578b\u3002\n2. \u53ef\u53d8\u53c2\u6570\u4e2a\u6570\u3002\n\n\u53e6\u5916\uff0c\u4e00\u4e2a\u57fa\u672c\u7684\u8bbe\u8ba1\u539f\u5219\u662f\uff0c\u4ec5\u4ec5\u5f53\u4e24\u4e2a\u51fd\u6570\u9664\u4e86\u53c2\u6570\u7c7b\u578b\u548c\u53c2\u6570\u4e2a\u6570\u4e0d\u540c\u4ee5\u5916\uff0c\u5176\u529f\u80fd\u662f\u5b8c\u5168\u76f8\u540c\u7684\uff0c\u6b64\u65f6\u624d\u4f7f\u7528\u51fd\u6570\u91cd\u8f7d\uff0c\u5982\u679c\u4e24\u4e2a\u51fd\u6570\u7684\u529f\u80fd\u5176\u5b9e\u4e0d\u540c\uff0c\u90a3\u4e48\u4e0d\u5e94\u5f53\u4f7f\u7528\u91cd\u8f7d\uff0c\u800c\u5e94\u5f53\u4f7f\u7528\u4e00\u4e2a\u540d\u5b57\u4e0d\u540c\u7684\u51fd\u6570\u3002\n\n\u597d\u5427\uff0c\u90a3\u4e48\u5bf9\u4e8e\u60c5\u51b5 1 \uff0c\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u4f46\u662f\u53c2\u6570\u7c7b\u578b\u4e0d\u540c\uff0cpython \u5982\u4f55\u5904\u7406\uff1f\u7b54\u6848\u662f\u6839\u672c\u4e0d\u9700\u8981\u5904\u7406\uff0c\u56e0\u4e3a python \u53ef\u4ee5\u63a5\u53d7\u4efb\u4f55\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5982\u679c\u51fd\u6570\u7684\u529f\u80fd\u76f8\u540c\uff0c\u90a3\u4e48\u4e0d\u540c\u7684\u53c2\u6570\u7c7b\u578b\u5728 python \u4e2d\u5f88\u53ef\u80fd\u662f\u76f8\u540c\u7684\u4ee3\u7801\uff0c\u6ca1\u6709\u5fc5\u8981\u505a\u6210\u4e24\u4e2a\u4e0d\u540c\u51fd\u6570\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u60c5\u51b5 2 \uff0c\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u4f46\u53c2\u6570\u4e2a\u6570\u4e0d\u540c\uff0cpython \u5982\u4f55\u5904\u7406\uff1f\u5927\u5bb6\u77e5\u9053\uff0c\u7b54\u6848\u5c31\u662f\u7f3a\u7701\u53c2\u6570\u3002\u5bf9\u90a3\u4e9b\u7f3a\u5c11\u7684\u53c2\u6570\u8bbe\u5b9a\u4e3a\u7f3a\u7701\u53c2\u6570\u5373\u53ef\u89e3\u51b3\u95ee\u9898\u3002\u56e0\u4e3a\u4f60\u5047\u8bbe\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u90a3\u4e48\u90a3\u4e9b\u7f3a\u5c11\u7684\u53c2\u6570\u7ec8\u5f52\u662f\u9700\u8981\u7528\u7684\u3002\n\n\u597d\u4e86\uff0c\u9274\u4e8e\u60c5\u51b5 1 \u8ddf \u60c5\u51b5 2 \u90fd\u6709\u4e86\u89e3\u51b3\u65b9\u6848\uff0cpython \u81ea\u7136\u5c31\u4e0d\u9700\u8981\u51fd\u6570\u91cd\u8f7d\u4e86\u3002\n\n## 14 \u65b0\u5f0f\u7c7b\u548c\u65e7\u5f0f\u7c7b\n\n\u8fd9\u4e2a\u9762\u8bd5\u5b98\u95ee\u4e86,\u6211\u8bf4\u4e86\u8001\u534a\u5929,\u4e0d\u77e5\u9053\u4ed6\u95ee\u7684\u771f\u6b63\u610f\u56fe\u662f\u4ec0\u4e48.\n\n[stackoverflow](http://stackoverflow.com/questions/54867/what-is-the-difference-between-old-style-and-new-style-classes-in-python)\n\n\u8fd9\u7bc7\u6587\u7ae0\u5f88\u597d\u7684\u4ecb\u7ecd\u4e86\u65b0\u5f0f\u7c7b\u7684\u7279\u6027: http://www.cnblogs.com/btchenguang/archive/2012/09/17/2689146.html\n\n\u65b0\u5f0f\u7c7b\u5f88\u65e9\u57282.2\u5c31\u51fa\u73b0\u4e86,\u6240\u4ee5\u65e7\u5f0f\u7c7b\u5b8c\u5168\u662f\u517c\u5bb9\u7684\u95ee\u9898,Python3\u91cc\u7684\u7c7b\u5168\u90e8\u90fd\u662f\u65b0\u5f0f\u7c7b.\u8fd9\u91cc\u6709\u4e00\u4e2aMRO\u95ee\u9898\u53ef\u4ee5\u4e86\u89e3\u4e0b(\u65b0\u5f0f\u7c7b\u7ee7\u627f\u662f\u6839\u636eC3\u7b97\u6cd5,\u65e7\u5f0f\u7c7b\u662f\u6df1\u5ea6\u4f18\u5148),<Python\u6838\u5fc3\u7f16\u7a0b>\u91cc\u8bb2\u7684\u4e5f\u5f88\u591a.\n\n> \u4e00\u4e2a\u65e7\u5f0f\u7c7b\u7684\u6df1\u5ea6\u4f18\u5148\u7684\u4f8b\u5b50\n\n```python\nclass A():\n    def foo1(self):\n        print \"A\"\nclass B(A):\n    def foo2(self):\n        pass\nclass C(A):\n    def foo1(self):\n        print \"C\"\nclass D(B, C):\n    pass\n\nd = D()\nd.foo1()\n\n# A\n```\n\n**\u6309\u7167\u7ecf\u5178\u7c7b\u7684\u67e5\u627e\u987a\u5e8f`\u4ece\u5de6\u5230\u53f3\u6df1\u5ea6\u4f18\u5148`\u7684\u89c4\u5219\uff0c\u5728\u8bbf\u95ee`d.foo1()`\u7684\u65f6\u5019,D\u8fd9\u4e2a\u7c7b\u662f\u6ca1\u6709\u7684..\u90a3\u4e48\u5f80\u4e0a\u67e5\u627e,\u5148\u627e\u5230B,\u91cc\u9762\u6ca1\u6709,\u6df1\u5ea6\u4f18\u5148,\u8bbf\u95eeA,\u627e\u5230\u4e86foo1(),\u6240\u4ee5\u8fd9\u65f6\u5019\u8c03\u7528\u7684\u662fA\u7684foo1()\uff0c\u4ece\u800c\u5bfc\u81f4C\u91cd\u5199\u7684foo1()\u88ab\u7ed5\u8fc7**\n\n\n\n## 15 `__new__`\u548c`__init__`\u7684\u533a\u522b\n\n\u8fd9\u4e2a`__new__`\u786e\u5b9e\u5f88\u5c11\u89c1\u5230,\u5148\u505a\u4e86\u89e3\u5427.\n\n1. `__new__`\u662f\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5,\u800c`__init__`\u662f\u4e00\u4e2a\u5b9e\u4f8b\u65b9\u6cd5.\n2. `__new__`\u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e00\u4e2a\u521b\u5efa\u7684\u5b9e\u4f8b,\u800c`__init__`\u4ec0\u4e48\u90fd\u4e0d\u8fd4\u56de.\n3. \u53ea\u6709\u5728`__new__`\u8fd4\u56de\u4e00\u4e2acls\u7684\u5b9e\u4f8b\u65f6\u540e\u9762\u7684`__init__`\u624d\u80fd\u88ab\u8c03\u7528.\n4. \u5f53\u521b\u5efa\u4e00\u4e2a\u65b0\u5b9e\u4f8b\u65f6\u8c03\u7528`__new__`,\u521d\u59cb\u5316\u4e00\u4e2a\u5b9e\u4f8b\u65f6\u7528`__init__`.\n\n[stackoverflow](http://stackoverflow.com/questions/674304/pythons-use-of-new-and-init)\n\nps: `__metaclass__`\u662f\u521b\u5efa\u7c7b\u65f6\u8d77\u4f5c\u7528.\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5206\u522b\u4f7f\u7528`__metaclass__`,`__new__`\u548c`__init__`\u6765\u5206\u522b\u5728\u7c7b\u521b\u5efa,\u5b9e\u4f8b\u521b\u5efa\u548c\u5b9e\u4f8b\u521d\u59cb\u5316\u7684\u65f6\u5019\u505a\u4e00\u4e9b\u5c0f\u624b\u811a.\n\n## 16 \u5355\u4f8b\u6a21\u5f0f\n\n> \u200b\t\u5355\u4f8b\u6a21\u5f0f\u662f\u4e00\u79cd\u5e38\u7528\u7684\u8f6f\u4ef6\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5728\u5b83\u7684\u6838\u5fc3\u7ed3\u6784\u4e2d\u53ea\u5305\u542b\u4e00\u4e2a\u88ab\u79f0\u4e3a\u5355\u4f8b\u7c7b\u7684\u7279\u6b8a\u7c7b\u3002\u901a\u8fc7\u5355\u4f8b\u6a21\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u4e2d\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u800c\u4e14\u8be5\u5b9e\u4f8b\u6613\u4e8e\u5916\u754c\u8bbf\u95ee\uff0c\u4ece\u800c\u65b9\u4fbf\u5bf9\u5b9e\u4f8b\u4e2a\u6570\u7684\u63a7\u5236\u5e76\u8282\u7ea6\u7cfb\u7edf\u8d44\u6e90\u3002\u5982\u679c\u5e0c\u671b\u5728\u7cfb\u7edf\u4e2d\u67d0\u4e2a\u7c7b\u7684\u5bf9\u8c61\u53ea\u80fd\u5b58\u5728\u4e00\u4e2a\uff0c\u5355\u4f8b\u6a21\u5f0f\u662f\u6700\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002\n>\n> `__new__()`\u5728`__init__()`\u4e4b\u524d\u88ab\u8c03\u7528\uff0c\u7528\u4e8e\u751f\u6210\u5b9e\u4f8b\u5bf9\u8c61\u3002\u5229\u7528\u8fd9\u4e2a\u65b9\u6cd5\u548c\u7c7b\u7684\u5c5e\u6027\u7684\u7279\u70b9\u53ef\u4ee5\u5b9e\u73b0\u8bbe\u8ba1\u6a21\u5f0f\u7684\u5355\u4f8b\u6a21\u5f0f\u3002\u5355\u4f8b\u6a21\u5f0f\u662f\u6307\u521b\u5efa\u552f\u4e00\u5bf9\u8c61\uff0c\u5355\u4f8b\u6a21\u5f0f\u8bbe\u8ba1\u7684\u7c7b\u53ea\u80fd\u5b9e\u4f8b\n**\u8fd9\u4e2a\u7edd\u5bf9\u5e38\u8003\u554a.\u7edd\u5bf9\u8981\u8bb0\u4f4f1~2\u4e2a\u65b9\u6cd5,\u5f53\u65f6\u9762\u8bd5\u5b98\u662f\u8ba9\u624b\u5199\u7684.**\n\n### 1 \u4f7f\u7528`__new__`\u65b9\u6cd5\n\n```python\nclass Singleton(object):\n    def __new__(cls, *args, **kw):\n        if not hasattr(cls, '_instance'):\n            orig = super(Singleton, cls)\n            cls._instance = orig.__new__(cls, *args, **kw)\n        return cls._instance\n\nclass MyClass(Singleton):\n    a = 1\n```\n\n### 2 \u5171\u4eab\u5c5e\u6027\n\n\u521b\u5efa\u5b9e\u4f8b\u65f6\u628a\u6240\u6709\u5b9e\u4f8b\u7684`__dict__`\u6307\u5411\u540c\u4e00\u4e2a\u5b57\u5178,\u8fd9\u6837\u5b83\u4eec\u5177\u6709\u76f8\u540c\u7684\u5c5e\u6027\u548c\u65b9\u6cd5.\n\n```python\n\nclass Borg(object):\n    _state = {}\n    def __new__(cls, *args, **kw):\n        ob = super(Borg, cls).__new__(cls, *args, **kw)\n        ob.__dict__ = cls._state\n        return ob\n\nclass MyClass2(Borg):\n    a = 1\n```\n\n### 3 \u88c5\u9970\u5668\u7248\u672c\n\n```python\ndef singleton(cls):\n    instances = {}\n    def getinstance(*args, **kw):\n        if cls not in instances:\n            instances[cls] = cls(*args, **kw)\n        return instances[cls]\n    return getinstance\n\n@singleton\nclass MyClass:\n  ...\n```\n\n### 4 import\u65b9\u6cd5\n\n\u4f5c\u4e3apython\u7684\u6a21\u5757\u662f\u5929\u7136\u7684\u5355\u4f8b\u6a21\u5f0f\n\n```python\n# mysingleton.py\nclass My_Singleton(object):\n    def foo(self):\n        pass\n\nmy_singleton = My_Singleton()\n\n# to use\nfrom mysingleton import my_singleton\n\nmy_singleton.foo()\n\n```\n**[\u5355\u4f8b\u6a21\u5f0f\u4f2f\u4e50\u5728\u7ebf\u8be6\u7ec6\u89e3\u91ca](http://python.jobbole.com/87294/)**\n\n## 17 Python\u4e2d\u7684\u4f5c\u7528\u57df\n\nPython \u4e2d\uff0c\u4e00\u4e2a\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u603b\u662f\u7531\u5728\u4ee3\u7801\u4e2d\u88ab\u8d4b\u503c\u7684\u5730\u65b9\u6240\u51b3\u5b9a\u7684\u3002\n\n\u5f53 Python \u9047\u5230\u4e00\u4e2a\u53d8\u91cf\u7684\u8bdd\u4ed6\u4f1a\u6309\u7167\u8fd9\u6837\u7684\u987a\u5e8f\u8fdb\u884c\u641c\u7d22\uff1a\n\n\u672c\u5730\u4f5c\u7528\u57df\uff08Local\uff09\u2192\u5f53\u524d\u4f5c\u7528\u57df\u88ab\u5d4c\u5165\u7684\u672c\u5730\u4f5c\u7528\u57df\uff08Enclosing locals\uff09\u2192\u5168\u5c40/\u6a21\u5757\u4f5c\u7528\u57df\uff08Global\uff09\u2192\u5185\u7f6e\u4f5c\u7528\u57df\uff08Built-in\uff09\n\n## 18 GIL\u7ebf\u7a0b\u5168\u5c40\u9501\n\n\u7ebf\u7a0b\u5168\u5c40\u9501(Global Interpreter Lock),\u5373Python\u4e3a\u4e86\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u800c\u91c7\u53d6\u7684\u72ec\u7acb\u7ebf\u7a0b\u8fd0\u884c\u7684\u9650\u5236,\u8bf4\u767d\u4e86\u5c31\u662f\u4e00\u4e2a\u6838\u53ea\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u8fd0\u884c\u4e00\u4e2a\u7ebf\u7a0b.**\u5bf9\u4e8eio\u5bc6\u96c6\u578b\u4efb\u52a1\uff0cpython\u7684\u591a\u7ebf\u7a0b\u8d77\u5230\u4f5c\u7528\uff0c\u4f46\u5bf9\u4e8ecpu\u5bc6\u96c6\u578b\u4efb\u52a1\uff0cpython\u7684\u591a\u7ebf\u7a0b\u51e0\u4e4e\u5360\u4e0d\u5230\u4efb\u4f55\u4f18\u52bf\uff0c\u8fd8\u6709\u53ef\u80fd\u56e0\u4e3a\u4e89\u593a\u8d44\u6e90\u800c\u53d8\u6162\u3002**\n\n\u89c1[Python \u6700\u96be\u7684\u95ee\u9898](http://www.oschina.net/translate/pythons-hardest-problem)\n\n\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u591a\u8fdb\u7a0b\u548c\u4e0b\u9762\u7684\u534f\u7a0b(\u534f\u7a0b\u4e5f\u53ea\u662f\u5355CPU,\u4f46\u662f\u80fd\u51cf\u5c0f\u5207\u6362\u4ee3\u4ef7\u63d0\u5347\u6027\u80fd).\n\n## 19 \u534f\u7a0b\n\n\u77e5\u4e4e\u88ab\u95ee\u5230\u4e86,\u5475\u5475\u54d2,\u8dea\u4e86\n\n\u7b80\u5355\u70b9\u8bf4\u534f\u7a0b\u662f\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u5347\u7ea7\u7248,\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u90fd\u9762\u4e34\u7740\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u7684\u5207\u6362\u95ee\u9898\u800c\u8017\u8d39\u8bb8\u591a\u5207\u6362\u65f6\u95f4,\u800c\u534f\u7a0b\u5c31\u662f\u7528\u6237\u81ea\u5df1\u63a7\u5236\u5207\u6362\u7684\u65f6\u673a,\u4e0d\u518d\u9700\u8981\u9677\u5165\u7cfb\u7edf\u7684\u5185\u6838\u6001.\n\nPython\u91cc\u6700\u5e38\u89c1\u7684yield\u5c31\u662f\u534f\u7a0b\u7684\u601d\u60f3!\u53ef\u4ee5\u67e5\u770b\u7b2c\u4e5d\u4e2a\u95ee\u9898.\n\n\n## 20 \u95ed\u5305\n\n\u95ed\u5305(closure)\u662f\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u91cd\u8981\u7684\u8bed\u6cd5\u7ed3\u6784\u3002\u95ed\u5305\u4e5f\u662f\u4e00\u79cd\u7ec4\u7ec7\u4ee3\u7801\u7684\u7ed3\u6784\uff0c\u5b83\u540c\u6837\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u53ef\u91cd\u590d\u4f7f\u7528\u6027\u3002\n\n\u5f53\u4e00\u4e2a\u5185\u5d4c\u51fd\u6570\u5f15\u7528\u5176\u5916\u90e8\u4f5c\u4f5c\u7528\u57df\u7684\u53d8\u91cf,\u6211\u4eec\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u95ed\u5305. \u603b\u7ed3\u4e00\u4e0b,\u521b\u5efa\u4e00\u4e2a\u95ed\u5305\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u51e0\u70b9:\n\n1. \u5fc5\u987b\u6709\u4e00\u4e2a\u5185\u5d4c\u51fd\u6570\n2. \u5185\u5d4c\u51fd\u6570\u5fc5\u987b\u5f15\u7528\u5916\u90e8\u51fd\u6570\u4e2d\u7684\u53d8\u91cf\n3. \u5916\u90e8\u51fd\u6570\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u662f\u5185\u5d4c\u51fd\u6570\n\n\u611f\u89c9\u95ed\u5305\u8fd8\u662f\u6709\u96be\u5ea6\u7684,\u51e0\u53e5\u8bdd\u662f\u8bf4\u4e0d\u660e\u767d\u7684,\u8fd8\u662f\u67e5\u67e5\u76f8\u5173\u8d44\u6599.\n\n\u91cd\u70b9\u662f\u51fd\u6570\u8fd0\u884c\u540e\u5e76\u4e0d\u4f1a\u88ab\u64a4\u9500,\u5c31\u50cf16\u9898\u7684instance\u5b57\u5178\u4e00\u6837,\u5f53\u51fd\u6570\u8fd0\u884c\u5b8c\u540e,instance\u5e76\u4e0d\u88ab\u9500\u6bc1,\u800c\u662f\u7ee7\u7eed\u7559\u5728\u5185\u5b58\u7a7a\u95f4\u91cc.\u8fd9\u4e2a\u529f\u80fd\u7c7b\u4f3c\u7c7b\u91cc\u7684\u7c7b\u53d8\u91cf,\u53ea\u4e0d\u8fc7\u8fc1\u79fb\u5230\u4e86\u51fd\u6570\u4e0a.\n\n\u95ed\u5305\u5c31\u50cf\u4e2a\u7a7a\u5fc3\u7403\u4e00\u6837,\u4f60\u77e5\u9053\u5916\u9762\u548c\u91cc\u9762,\u4f46\u4f60\u4e0d\u77e5\u9053\u4e2d\u95f4\u662f\u4ec0\u4e48\u6837.\n\n## 21 lambda\u51fd\u6570\n\n\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u533f\u540d\u51fd\u6570,\u4e3a\u4ec0\u4e48\u53eblambda?\u56e0\u4e3a\u548c\u540e\u9762\u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\u6709\u5173.\n\n\u63a8\u8350: [\u77e5\u4e4e](http://www.zhihu.com/question/20125256)\n\n\n## 22 Python\u51fd\u6570\u5f0f\u7f16\u7a0b\n\n\u8fd9\u4e2a\u9700\u8981\u9002\u5f53\u7684\u4e86\u89e3\u4e00\u4e0b\u5427,\u6bd5\u7adf\u51fd\u6570\u5f0f\u7f16\u7a0b\u5728Python\u4e2d\u4e5f\u505a\u4e86\u5f15\u7528.\n\n\u63a8\u8350: [\u9177\u58f3](http://coolshell.cn/articles/10822.html)\n\npython\u4e2d\u51fd\u6570\u5f0f\u7f16\u7a0b\u652f\u6301:\n\nfilter \u51fd\u6570\u7684\u529f\u80fd\u76f8\u5f53\u4e8e\u8fc7\u6ee4\u5668\u3002\u8c03\u7528\u4e00\u4e2a\u5e03\u5c14\u51fd\u6570`bool_func`\u6765\u8fed\u4ee3\u904d\u5386\u6bcf\u4e2aseq\u4e2d\u7684\u5143\u7d20\uff1b\u8fd4\u56de\u4e00\u4e2a\u4f7f`bool_seq`\u8fd4\u56de\u503c\u4e3atrue\u7684\u5143\u7d20\u7684\u5e8f\u5217\u3002\n\n```python\n>>>a = [1,2,3,4,5,6,7]\n>>>b = filter(lambda x: x > 5, a)\n>>>print b\n>>>[6,7]\n```\n\nmap\u51fd\u6570\u662f\u5bf9\u4e00\u4e2a\u5e8f\u5217\u7684\u6bcf\u4e2a\u9879\u4f9d\u6b21\u6267\u884c\u51fd\u6570\uff0c\u4e0b\u9762\u662f\u5bf9\u4e00\u4e2a\u5e8f\u5217\u6bcf\u4e2a\u9879\u90fd\u4e58\u4ee52\uff1a\n\n```python\n>>> a = map(lambda x:x*2,[1,2,3])\n>>> list(a)\n[2, 4, 6]\n```\n\nreduce\u51fd\u6570\u662f\u5bf9\u4e00\u4e2a\u5e8f\u5217\u7684\u6bcf\u4e2a\u9879\u8fed\u4ee3\u8c03\u7528\u51fd\u6570\uff0c\u4e0b\u9762\u662f\u6c423\u7684\u9636\u4e58\uff1a\n\n```python\n>>> reduce(lambda x,y:x*y,range(1,4))\n6\n```\n\n## 23 Python\u91cc\u7684\u62f7\u8d1d\n\n\u5f15\u7528\u548ccopy(),deepcopy()\u7684\u533a\u522b\n\n```python\nimport copy\na = [1, 2, 3, 4, ['a', 'b']]  #\u539f\u59cb\u5bf9\u8c61\n\nb = a  #\u8d4b\u503c\uff0c\u4f20\u5bf9\u8c61\u7684\u5f15\u7528\nc = copy.copy(a)  #\u5bf9\u8c61\u62f7\u8d1d\uff0c\u6d45\u62f7\u8d1d\nd = copy.deepcopy(a)  #\u5bf9\u8c61\u62f7\u8d1d\uff0c\u6df1\u62f7\u8d1d\n\na.append(5)  #\u4fee\u6539\u5bf9\u8c61a\na[4].append('c')  #\u4fee\u6539\u5bf9\u8c61a\u4e2d\u7684['a', 'b']\u6570\u7ec4\u5bf9\u8c61\n\nprint 'a = ', a\nprint 'b = ', b\nprint 'c = ', c\nprint 'd = ', d\n\n\u8f93\u51fa\u7ed3\u679c\uff1a\na =  [1, 2, 3, 4, ['a', 'b', 'c'], 5]\nb =  [1, 2, 3, 4, ['a', 'b', 'c'], 5]\nc =  [1, 2, 3, 4, ['a', 'b', 'c']]\nd =  [1, 2, 3, 4, ['a', 'b']]\n```\n\n## 24 Python\u5783\u573e\u56de\u6536\u673a\u5236\n\nPython GC\u4e3b\u8981\u4f7f\u7528\u5f15\u7528\u8ba1\u6570\uff08reference counting\uff09\u6765\u8ddf\u8e2a\u548c\u56de\u6536\u5783\u573e\u3002\u5728\u5f15\u7528\u8ba1\u6570\u7684\u57fa\u7840\u4e0a\uff0c\u901a\u8fc7\u201c\u6807\u8bb0-\u6e05\u9664\u201d\uff08mark and sweep\uff09\u89e3\u51b3\u5bb9\u5668\u5bf9\u8c61\u53ef\u80fd\u4ea7\u751f\u7684\u5faa\u73af\u5f15\u7528\u95ee\u9898\uff0c\u901a\u8fc7\u201c\u5206\u4ee3\u56de\u6536\u201d\uff08generation collection\uff09\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u65b9\u6cd5\u63d0\u9ad8\u5783\u573e\u56de\u6536\u6548\u7387\u3002\n\n### 1 \u5f15\u7528\u8ba1\u6570\n\nPyObject\u662f\u6bcf\u4e2a\u5bf9\u8c61\u5fc5\u6709\u7684\u5185\u5bb9\uff0c\u5176\u4e2d`ob_refcnt`\u5c31\u662f\u505a\u4e3a\u5f15\u7528\u8ba1\u6570\u3002\u5f53\u4e00\u4e2a\u5bf9\u8c61\u6709\u65b0\u7684\u5f15\u7528\u65f6\uff0c\u5b83\u7684`ob_refcnt`\u5c31\u4f1a\u589e\u52a0\uff0c\u5f53\u5f15\u7528\u5b83\u7684\u5bf9\u8c61\u88ab\u5220\u9664\uff0c\u5b83\u7684`ob_refcnt`\u5c31\u4f1a\u51cf\u5c11.\u5f15\u7528\u8ba1\u6570\u4e3a0\u65f6\uff0c\u8be5\u5bf9\u8c61\u751f\u547d\u5c31\u7ed3\u675f\u4e86\u3002\n\n\u4f18\u70b9:\n\n1. \u7b80\u5355\n2. \u5b9e\u65f6\u6027\n\n\u7f3a\u70b9:\n\n1. \u7ef4\u62a4\u5f15\u7528\u8ba1\u6570\u6d88\u8017\u8d44\u6e90\n2. \u5faa\u73af\u5f15\u7528\n\n### 2 \u6807\u8bb0-\u6e05\u9664\u673a\u5236\n\n\u57fa\u672c\u601d\u8def\u662f\u5148\u6309\u9700\u5206\u914d\uff0c\u7b49\u5230\u6ca1\u6709\u7a7a\u95f2\u5185\u5b58\u7684\u65f6\u5019\u4ece\u5bc4\u5b58\u5668\u548c\u7a0b\u5e8f\u6808\u4e0a\u7684\u5f15\u7528\u51fa\u53d1\uff0c\u904d\u5386\u4ee5\u5bf9\u8c61\u4e3a\u8282\u70b9\u3001\u4ee5\u5f15\u7528\u4e3a\u8fb9\u6784\u6210\u7684\u56fe\uff0c\u628a\u6240\u6709\u53ef\u4ee5\u8bbf\u95ee\u5230\u7684\u5bf9\u8c61\u6253\u4e0a\u6807\u8bb0\uff0c\u7136\u540e\u6e05\u626b\u4e00\u904d\u5185\u5b58\u7a7a\u95f4\uff0c\u628a\u6240\u6709\u6ca1\u6807\u8bb0\u7684\u5bf9\u8c61\u91ca\u653e\u3002\n\n### 3 \u5206\u4ee3\u6280\u672f\n\n\u5206\u4ee3\u56de\u6536\u7684\u6574\u4f53\u601d\u60f3\u662f\uff1a\u5c06\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u5185\u5b58\u5757\u6839\u636e\u5176\u5b58\u6d3b\u65f6\u95f4\u5212\u5206\u4e3a\u4e0d\u540c\u7684\u96c6\u5408\uff0c\u6bcf\u4e2a\u96c6\u5408\u5c31\u6210\u4e3a\u4e00\u4e2a\u201c\u4ee3\u201d\uff0c\u5783\u573e\u6536\u96c6\u9891\u7387\u968f\u7740\u201c\u4ee3\u201d\u7684\u5b58\u6d3b\u65f6\u95f4\u7684\u589e\u5927\u800c\u51cf\u5c0f\uff0c\u5b58\u6d3b\u65f6\u95f4\u901a\u5e38\u5229\u7528\u7ecf\u8fc7\u51e0\u6b21\u5783\u573e\u56de\u6536\u6765\u5ea6\u91cf\u3002\n\nPython\u9ed8\u8ba4\u5b9a\u4e49\u4e86\u4e09\u4ee3\u5bf9\u8c61\u96c6\u5408\uff0c\u7d22\u5f15\u6570\u8d8a\u5927\uff0c\u5bf9\u8c61\u5b58\u6d3b\u65f6\u95f4\u8d8a\u957f\u3002\n\n\u4e3e\u4f8b\uff1a\n\u5f53\u67d0\u4e9b\u5185\u5b58\u5757M\u7ecf\u8fc7\u4e863\u6b21\u5783\u573e\u6536\u96c6\u7684\u6e05\u6d17\u4e4b\u540e\u8fd8\u5b58\u6d3b\u65f6\uff0c\u6211\u4eec\u5c31\u5c06\u5185\u5b58\u5757M\u5212\u5230\u4e00\u4e2a\u96c6\u5408A\u4e2d\u53bb\uff0c\u800c\u65b0\u5206\u914d\u7684\u5185\u5b58\u90fd\u5212\u5206\u5230\u96c6\u5408B\u4e2d\u53bb\u3002\u5f53\u5783\u573e\u6536\u96c6\u5f00\u59cb\u5de5\u4f5c\u65f6\uff0c\u5927\u591a\u6570\u60c5\u51b5\u90fd\u53ea\u5bf9\u96c6\u5408B\u8fdb\u884c\u5783\u573e\u56de\u6536\uff0c\u800c\u5bf9\u96c6\u5408A\u8fdb\u884c\u5783\u573e\u56de\u6536\u8981\u9694\u76f8\u5f53\u957f\u4e00\u6bb5\u65f6\u95f4\u540e\u624d\u8fdb\u884c\uff0c\u8fd9\u5c31\u4f7f\u5f97\u5783\u573e\u6536\u96c6\u673a\u5236\u9700\u8981\u5904\u7406\u7684\u5185\u5b58\u5c11\u4e86\uff0c\u6548\u7387\u81ea\u7136\u5c31\u63d0\u9ad8\u4e86\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u96c6\u5408B\u4e2d\u7684\u67d0\u4e9b\u5185\u5b58\u5757\u7531\u4e8e\u5b58\u6d3b\u65f6\u95f4\u957f\u800c\u4f1a\u88ab\u8f6c\u79fb\u5230\u96c6\u5408A\u4e2d\uff0c\u5f53\u7136\uff0c\u96c6\u5408A\u4e2d\u5b9e\u9645\u4e0a\u4e5f\u5b58\u5728\u4e00\u4e9b\u5783\u573e\uff0c\u8fd9\u4e9b\u5783\u573e\u7684\u56de\u6536\u4f1a\u56e0\u4e3a\u8fd9\u79cd\u5206\u4ee3\u7684\u673a\u5236\u800c\u88ab\u5ef6\u8fdf\u3002\n\n## 25 Python\u7684List\n\n\u63a8\u8350: http://www.jianshu.com/p/J4U6rR\n\n## 26 Python\u7684is\n\nis\u662f\u5bf9\u6bd4\u5730\u5740,==\u662f\u5bf9\u6bd4\u503c\n\n## 27 read,readline\u548creadlines\n\n* read        \u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\n* readline    \u8bfb\u53d6\u4e0b\u4e00\u884c,\u4f7f\u7528\u751f\u6210\u5668\u65b9\u6cd5\n* readlines   \u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u5230\u4e00\u4e2a\u8fed\u4ee3\u5668\u4ee5\u4f9b\u6211\u4eec\u904d\u5386\n\n## 28 Python2\u548c3\u7684\u533a\u522b\n\u63a8\u8350\uff1a[Python 2.7.x \u4e0e Python 3.x \u7684\u4e3b\u8981\u5dee\u5f02](http://chenqx.github.io/2014/11/10/Key-differences-between-Python-2-7-x-and-Python-3-x/)\n\n## 29 super init\nsuper() lets you avoid referring to the base class explicitly, which can be nice. But the main advantage comes with multiple inheritance, where all sorts of fun stuff can happen. See the standard docs on super if you haven't already.\n\nNote that the syntax changed in Python 3.0: you can just say super().`__init__`() instead of super(ChildB, self).`__init__`() which IMO is quite a bit nicer.\n\nhttp://stackoverflow.com/questions/576169/understanding-python-super-with-init-methods\n\n[Python2.7\u4e2d\u7684super\u65b9\u6cd5\u6d45\u89c1](http://blog.csdn.net/mrlevo520/article/details/51712440)\n\n## 30 range and xrange\n\u90fd\u5728\u5faa\u73af\u65f6\u4f7f\u7528\uff0cxrange\u5185\u5b58\u6027\u80fd\u66f4\u597d\u3002\nfor i in range(0, 20):\nfor i in xrange(0, 20):\nWhat is the difference between range and xrange functions in Python 2.X?\n range creates a list, so if you do range(1, 10000000) it creates a list in memory with 9999999 elements.\n xrange is a sequence object that evaluates lazily.\n\nhttp://stackoverflow.com/questions/94935/what-is-the-difference-between-range-and-xrange-functions-in-python-2-x\n\n# \u64cd\u4f5c\u7cfb\u7edf\n\n## 1 select,poll\u548cepoll\n\n\u5176\u5b9e\u6240\u6709\u7684I/O\u90fd\u662f\u8f6e\u8be2\u7684\u65b9\u6cd5,\u53ea\u4e0d\u8fc7\u5b9e\u73b0\u7684\u5c42\u9762\u4e0d\u540c\u7f62\u4e86.\n\n\u8fd9\u4e2a\u95ee\u9898\u53ef\u80fd\u6709\u70b9\u6df1\u5165\u4e86,\u4f46\u76f8\u4fe1\u80fd\u56de\u7b54\u51fa\u8fd9\u4e2a\u95ee\u9898\u662f\u5bf9I/O\u591a\u8def\u590d\u7528\u6709\u5f88\u597d\u7684\u4e86\u89e3\u4e86.\u5176\u4e2dtornado\u4f7f\u7528\u7684\u5c31\u662fepoll\u7684.\n\n[selec,poll\u548cepoll\u533a\u522b\u603b\u7ed3](http://www.cnblogs.com/Anker/p/3265058.html)\n\n\u57fa\u672c\u4e0aselect\u67093\u4e2a\u7f3a\u70b9:\n\n1. \u8fde\u63a5\u6570\u53d7\u9650\n2. \u67e5\u627e\u914d\u5bf9\u901f\u5ea6\u6162\n3. \u6570\u636e\u7531\u5185\u6838\u62f7\u8d1d\u5230\u7528\u6237\u6001\n\npoll\u6539\u5584\u4e86\u7b2c\u4e00\u4e2a\u7f3a\u70b9\n\nepoll\u6539\u4e86\u4e09\u4e2a\u7f3a\u70b9.\n\n\u5173\u4e8eepoll\u7684: http://www.cnblogs.com/my_life/articles/3968782.html\n\n## 2 \u8c03\u5ea6\u7b97\u6cd5\n\n1. \u5148\u6765\u5148\u670d\u52a1(FCFS, First Come First Serve)\n2. \u77ed\u4f5c\u4e1a\u4f18\u5148(SJF, Shortest Job First)\n3. \u6700\u9ad8\u4f18\u5148\u6743\u8c03\u5ea6(Priority Scheduling)\n4. \u65f6\u95f4\u7247\u8f6e\u8f6c(RR, Round Robin)\n5. \u591a\u7ea7\u53cd\u9988\u961f\u5217\u8c03\u5ea6(multilevel feedback queue scheduling)\n\n\u5e38\u89c1\u7684\u8c03\u5ea6\u7b97\u6cd5\u603b\u7ed3:http://www.jianshu.com/p/6edf8174c1eb\n\n\u5b9e\u65f6\u8c03\u5ea6\u7b97\u6cd5:\n\n1. \u6700\u65e9\u622a\u81f3\u65f6\u95f4\u4f18\u5148 EDF\n2. \u6700\u4f4e\u677e\u5f1b\u5ea6\u4f18\u5148 LLF\n\n## 3 \u6b7b\u9501\n\u539f\u56e0:\n\n1. \u7ade\u4e89\u8d44\u6e90\n2. \u7a0b\u5e8f\u63a8\u8fdb\u987a\u5e8f\u4e0d\u5f53\n\n\u5fc5\u8981\u6761\u4ef6:\n\n1. \u4e92\u65a5\u6761\u4ef6\n2. \u8bf7\u6c42\u548c\u4fdd\u6301\u6761\u4ef6\n3. \u4e0d\u5265\u593a\u6761\u4ef6\n4. \u73af\u8def\u7b49\u5f85\u6761\u4ef6\n\n\u5904\u7406\u6b7b\u9501\u57fa\u672c\u65b9\u6cd5:\n\n1. \u9884\u9632\u6b7b\u9501(\u6452\u5f03\u96641\u4ee5\u5916\u7684\u6761\u4ef6)\n2. \u907f\u514d\u6b7b\u9501(\u94f6\u884c\u5bb6\u7b97\u6cd5)\n3. \u68c0\u6d4b\u6b7b\u9501(\u8d44\u6e90\u5206\u914d\u56fe)\n4. \u89e3\u9664\u6b7b\u9501\n    1. \u5265\u593a\u8d44\u6e90\n    2. \u64a4\u9500\u8fdb\u7a0b\n\n\u6b7b\u9501\u6982\u5ff5\u5904\u7406\u7b56\u7565\u8be6\u7ec6\u4ecb\u7ecd:https://wizardforcel.gitbooks.io/wangdaokaoyan-os/content/10.html\n\n## 4 \u7a0b\u5e8f\u7f16\u8bd1\u4e0e\u94fe\u63a5\n\n\u63a8\u8350: http://www.ruanyifeng.com/blog/2014/11/compiler.html\n\nBulid\u8fc7\u7a0b\u53ef\u4ee5\u5206\u89e3\u4e3a4\u4e2a\u6b65\u9aa4:\u9884\u5904\u7406(Prepressing), \u7f16\u8bd1(Compilation)\u3001\u6c47\u7f16(Assembly)\u3001\u94fe\u63a5(Linking)\n\n\u4ee5c\u8bed\u8a00\u4e3a\u4f8b:\n\n### 1 \u9884\u5904\u7406\n\n\u9884\u7f16\u8bd1\u8fc7\u7a0b\u4e3b\u8981\u5904\u7406\u90a3\u4e9b\u6e90\u6587\u4ef6\u4e2d\u7684\u4ee5\u201c#\u201d\u5f00\u59cb\u7684\u9884\u7f16\u8bd1\u6307\u4ee4\uff0c\u4e3b\u8981\u5904\u7406\u89c4\u5219\u6709\uff1a\n\n1. \u5c06\u6240\u6709\u7684\u201c#define\u201d\u5220\u9664\uff0c\u5e76\u5c55\u5f00\u6240\u7528\u7684\u5b8f\u5b9a\u4e49\n2. \u5904\u7406\u6240\u6709\u6761\u4ef6\u9884\u7f16\u8bd1\u6307\u4ee4\uff0c\u6bd4\u5982\u201c#if\u201d\u3001\u201c#ifdef\u201d\u3001 \u201c#elif\u201d\u3001\u201c#endif\u201d\n3. \u5904\u7406\u201c#include\u201d\u9884\u7f16\u8bd1\u6307\u4ee4\uff0c\u5c06\u88ab\u5305\u542b\u7684\u6587\u4ef6\u63d2\u5165\u5230\u8be5\u7f16\u8bd1\u6307\u4ee4\u7684\u4f4d\u7f6e\uff0c\u6ce8\uff1a\u6b64\u8fc7\u7a0b\u662f\u9012\u5f52\u8fdb\u884c\u7684\n4. \u5220\u9664\u6240\u6709\u6ce8\u91ca\n5. \u6dfb\u52a0\u884c\u53f7\u548c\u6587\u4ef6\u540d\u6807\u8bc6\uff0c\u4ee5\u4fbf\u4e8e\u7f16\u8bd1\u65f6\u7f16\u8bd1\u5668\u4ea7\u751f\u8c03\u8bd5\u7528\u7684\u884c\u53f7\u4fe1\u606f\u4ee5\u53ca\u7528\u4e8e\u7f16\u8bd1\u65f6\u4ea7\u751f\u7f16\u8bd1\u9519\u8bef\u6216\u8b66\u544a\u65f6\u53ef\u663e\u793a\u884c\u53f7\n6. \u4fdd\u7559\u6240\u6709\u7684#pragma\u7f16\u8bd1\u5668\u6307\u4ee4\u3002\n\n### 2 \u7f16\u8bd1\n\n\u7f16\u8bd1\u8fc7\u7a0b\u5c31\u662f\u628a\u9884\u5904\u7406\u5b8c\u7684\u6587\u4ef6\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\u3001\u8bed\u4e49\u5206\u6790\u53ca\u4f18\u5316\u540e\u751f\u6210\u76f8\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u6587\u4ef6\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6574\u4e2a\u7a0b\u5e8f\u6784\u5efa\u7684\u6838\u5fc3\u90e8\u5206\u3002\n\n### 3 \u6c47\u7f16\n\n\u6c47\u7f16\u5668\u662f\u5c06\u6c47\u7f16\u4ee3\u7801\u8f6c\u5316\u6210\u673a\u5668\u53ef\u4ee5\u6267\u884c\u7684\u6307\u4ee4\uff0c\u6bcf\u4e00\u6761\u6c47\u7f16\u8bed\u53e5\u51e0\u4e4e\u90fd\u662f\u4e00\u6761\u673a\u5668\u6307\u4ee4\u3002\u7ecf\u8fc7\u7f16\u8bd1\u3001\u94fe\u63a5\u3001\u6c47\u7f16\u8f93\u51fa\u7684\u6587\u4ef6\u6210\u4e3a\u76ee\u6807\u6587\u4ef6(Object File)\n\n### 4 \u94fe\u63a5\n\n\u94fe\u63a5\u7684\u4e3b\u8981\u5185\u5bb9\u5c31\u662f\u628a\u5404\u4e2a\u6a21\u5757\u4e4b\u95f4\u76f8\u4e92\u5f15\u7528\u7684\u90e8\u5206\u5904\u7406\u597d\uff0c\u4f7f\u5404\u4e2a\u6a21\u5757\u53ef\u4ee5\u6b63\u786e\u7684\u62fc\u63a5\u3002\n\u94fe\u63a5\u7684\u4e3b\u8981\u8fc7\u7a0b\u5305\u5757 \u5730\u5740\u548c\u7a7a\u95f4\u7684\u5206\u914d\uff08Address and Storage Allocation\uff09\u3001\u7b26\u53f7\u51b3\u8bae(Symbol Resolution)\u548c\u91cd\u5b9a\u4f4d(Relocation)\u7b49\u6b65\u9aa4\u3002\n\n## 5 \u9759\u6001\u94fe\u63a5\u548c\u52a8\u6001\u94fe\u63a5\n\n\u9759\u6001\u94fe\u63a5\u65b9\u6cd5\uff1a\u9759\u6001\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u8f7d\u5165\u4ee3\u7801\u5c31\u4f1a\u628a\u7a0b\u5e8f\u4f1a\u7528\u5230\u7684\u52a8\u6001\u4ee3\u7801\u6216\u52a8\u6001\u4ee3\u7801\u7684\u5730\u5740\u786e\u5b9a\u4e0b\u6765\n\u9759\u6001\u5e93\u7684\u94fe\u63a5\u53ef\u4ee5\u4f7f\u7528\u9759\u6001\u94fe\u63a5\uff0c\u52a8\u6001\u94fe\u63a5\u5e93\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u94fe\u63a5\u5bfc\u5165\u5e93\n\n\u52a8\u6001\u94fe\u63a5\u65b9\u6cd5\uff1a\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u7684\u7a0b\u5e8f\u5e76\u4e0d\u5728\u4e00\u5f00\u59cb\u5c31\u5b8c\u6210\u52a8\u6001\u94fe\u63a5\uff0c\u800c\u662f\u76f4\u5230\u771f\u6b63\u8c03\u7528\u52a8\u6001\u5e93\u4ee3\u7801\u65f6\uff0c\u8f7d\u5165\u7a0b\u5e8f\u624d\u8ba1\u7b97(\u88ab\u8c03\u7528\u7684\u90a3\u90e8\u5206)\u52a8\u6001\u4ee3\u7801\u7684\u903b\u8f91\u5730\u5740\uff0c\u7136\u540e\u7b49\u5230\u67d0\u4e2a\u65f6\u5019\uff0c\u7a0b\u5e8f\u53c8\u9700\u8981\u8c03\u7528\u53e6\u5916\u67d0\u5757\u52a8\u6001\u4ee3\u7801\u65f6\uff0c\u8f7d\u5165\u7a0b\u5e8f\u53c8\u53bb\u8ba1\u7b97\u8fd9\u90e8\u5206\u4ee3\u7801\u7684\u903b\u8f91\u5730\u5740\uff0c\u6240\u4ee5\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u7a0b\u5e8f\u521d\u59cb\u5316\u65f6\u95f4\u8f83\u77ed\uff0c\u4f46\u8fd0\u884c\u671f\u95f4\u7684\u6027\u80fd\u6bd4\u4e0d\u4e0a\u9759\u6001\u94fe\u63a5\u7684\u7a0b\u5e8f\n\n## 6 \u865a\u62df\u5185\u5b58\u6280\u672f\n\n\u865a\u62df\u5b58\u50a8\u5668\u662f\u6307\u5177\u6709\u8bf7\u6c42\u8c03\u5165\u529f\u80fd\u548c\u7f6e\u6362\u529f\u80fd,\u80fd\u4ece\u903b\u8f91\u4e0a\u5bf9\u5185\u5b58\u5bb9\u91cf\u52a0\u4ee5\u6269\u5145\u7684\u4e00\u79cd\u5b58\u50a8\u7cfb\u7edf.\n\n## 7 \u5206\u9875\u548c\u5206\u6bb5\n\n\u5206\u9875: \u7528\u6237\u7a0b\u5e8f\u7684\u5730\u5740\u7a7a\u95f4\u88ab\u5212\u5206\u6210\u82e5\u5e72\u56fa\u5b9a\u5927\u5c0f\u7684\u533a\u57df\uff0c\u79f0\u4e3a\u201c\u9875\u201d\uff0c\u76f8\u5e94\u5730\uff0c\u5185\u5b58\u7a7a\u95f4\u5206\u6210\u82e5\u5e72\u4e2a\u7269\u7406\u5757\uff0c\u9875\u548c\u5757\u7684\u5927\u5c0f\u76f8\u7b49\u3002\u53ef\u5c06\u7528\u6237\u7a0b\u5e8f\u7684\u4efb\u4e00\u9875\u653e\u5728\u5185\u5b58\u7684\u4efb\u4e00\u5757\u4e2d\uff0c\u5b9e\u73b0\u4e86\u79bb\u6563\u5206\u914d\u3002\n\n\u5206\u6bb5: \u5c06\u7528\u6237\u7a0b\u5e8f\u5730\u5740\u7a7a\u95f4\u5206\u6210\u82e5\u5e72\u4e2a\u5927\u5c0f\u4e0d\u7b49\u7684\u6bb5\uff0c\u6bcf\u6bb5\u53ef\u4ee5\u5b9a\u4e49\u4e00\u7ec4\u76f8\u5bf9\u5b8c\u6574\u7684\u903b\u8f91\u4fe1\u606f\u3002\u5b58\u50a8\u5206\u914d\u65f6\uff0c\u4ee5\u6bb5\u4e3a\u5355\u4f4d\uff0c\u6bb5\u4e0e\u6bb5\u5728\u5185\u5b58\u4e2d\u53ef\u4ee5\u4e0d\u76f8\u90bb\u63a5\uff0c\u4e5f\u5b9e\u73b0\u4e86\u79bb\u6563\u5206\u914d\u3002\n\n### \u5206\u9875\u4e0e\u5206\u6bb5\u7684\u4e3b\u8981\u533a\u522b\n\n1. \u9875\u662f\u4fe1\u606f\u7684\u7269\u7406\u5355\u4f4d,\u5206\u9875\u662f\u4e3a\u4e86\u5b9e\u73b0\u975e\u8fde\u7eed\u5206\u914d,\u4ee5\u4fbf\u89e3\u51b3\u5185\u5b58\u788e\u7247\u95ee\u9898,\u6216\u8005\u8bf4\u5206\u9875\u662f\u7531\u4e8e\u7cfb\u7edf\u7ba1\u7406\u7684\u9700\u8981.\u6bb5\u662f\u4fe1\u606f\u7684\u903b\u8f91\u5355\u4f4d,\u5b83\u542b\u6709\u4e00\u7ec4\u610f\u4e49\u76f8\u5bf9\u5b8c\u6574\u7684\u4fe1\u606f,\u5206\u6bb5\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u597d\u5730\u5b9e\u73b0\u5171\u4eab,\u6ee1\u8db3\u7528\u6237\u7684\u9700\u8981.\n2. \u9875\u7684\u5927\u5c0f\u56fa\u5b9a,\u7531\u7cfb\u7edf\u786e\u5b9a,\u5c06\u903b\u8f91\u5730\u5740\u5212\u5206\u4e3a\u9875\u53f7\u548c\u9875\u5185\u5730\u5740\u662f\u7531\u673a\u5668\u786c\u4ef6\u5b9e\u73b0\u7684.\u800c\u6bb5\u7684\u957f\u5ea6\u5374\u4e0d\u56fa\u5b9a,\u51b3\u5b9a\u4e8e\u7528\u6237\u6240\u7f16\u5199\u7684\u7a0b\u5e8f,\u901a\u5e38\u7531\u7f16\u8bd1\u7a0b\u5e8f\u5728\u5bf9\u6e90\u7a0b\u5e8f\u8fdb\u884c\u7f16\u8bd1\u65f6\u6839\u636e\u4fe1\u606f\u7684\u6027\u8d28\u6765\u5212\u5206.\n3. \u5206\u9875\u7684\u4f5c\u4e1a\u5730\u5740\u7a7a\u95f4\u662f\u4e00\u7ef4\u7684.\u5206\u6bb5\u7684\u5730\u5740\u7a7a\u95f4\u662f\u4e8c\u7ef4\u7684.\n\n## 8 \u9875\u9762\u7f6e\u6362\u7b97\u6cd5\n\n1. \u6700\u4f73\u7f6e\u6362\u7b97\u6cd5OPT:\u4e0d\u53ef\u80fd\u5b9e\u73b0\n2. \u5148\u8fdb\u5148\u51faFIFO\n3. \u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7b97\u6cd5LRU:\u6700\u8fd1\u4e00\u6bb5\u65f6\u95f4\u91cc\u6700\u4e45\u6ca1\u6709\u4f7f\u7528\u8fc7\u7684\u9875\u9762\u4e88\u4ee5\u7f6e\u6362.\n4. clock\u7b97\u6cd5\n\n## 9 \u8fb9\u6cbf\u89e6\u53d1\u548c\u6c34\u5e73\u89e6\u53d1\n\n\u8fb9\u7f18\u89e6\u53d1\u662f\u6307\u6bcf\u5f53\u72b6\u6001\u53d8\u5316\u65f6\u53d1\u751f\u4e00\u4e2a io \u4e8b\u4ef6\uff0c\u6761\u4ef6\u89e6\u53d1\u662f\u53ea\u8981\u6ee1\u8db3\u6761\u4ef6\u5c31\u53d1\u751f\u4e00\u4e2a io \u4e8b\u4ef6\n\n# \u6570\u636e\u5e93\n\n## 1 \u4e8b\u52a1\n\n\u6570\u636e\u5e93\u4e8b\u52a1(Database Transaction) \uff0c\u662f\u6307\u4f5c\u4e3a\u5355\u4e2a\u903b\u8f91\u5de5\u4f5c\u5355\u5143\u6267\u884c\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u8981\u4e48\u5b8c\u5168\u5730\u6267\u884c\uff0c\u8981\u4e48\u5b8c\u5168\u5730\u4e0d\u6267\u884c\u3002\n\u5f7b\u5e95\u7406\u89e3\u6570\u636e\u5e93\u4e8b\u52a1: http://www.hollischuang.com/archives/898\n\n## 2 \u6570\u636e\u5e93\u7d22\u5f15\n\n\u63a8\u8350: http://tech.meituan.com/mysql-index.html\n\n[MySQL\u7d22\u5f15\u80cc\u540e\u7684\u6570\u636e\u7ed3\u6784\u53ca\u7b97\u6cd5\u539f\u7406](http://blog.codinglabs.org/articles/theory-of-mysql-index.html)\n\n\u805a\u96c6\u7d22\u5f15,\u975e\u805a\u96c6\u7d22\u5f15,B-Tree,B+Tree,\u6700\u5de6\u524d\u7f00\u539f\u7406\n\n## 3 Redis\u539f\u7406\n\n### Redis\u662f\u4ec0\u4e48\uff1f\n\n1. \u662f\u4e00\u4e2a\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684key-value\u5185\u5b58\u6570\u636e\u5e93 \n2. \u901a\u5e38\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5176\u6709\u7740\u4e30\u5bcc\u7684\u6570\u636e\u7ed3\u6784 strings\u3001map\u3001 list\u3001sets\u3001 sorted sets\n\n### Redis\u6570\u636e\u5e93\n\n> \u200b\t\u901a\u5e38\u5c40\u9650\u70b9\u6765\u8bf4\uff0cRedis\u4e5f\u4ee5\u6d88\u606f\u961f\u5217\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u4f5c\u4e3a\u5185\u5d4c\u7684List\u5b58\u5728\uff0c\u6ee1\u8db3\u5b9e\u65f6\u7684\u9ad8\u5e76\u53d1\u9700\u6c42\u3002\u5728\u4f7f\u7528\u7f13\u5b58\u7684\u65f6\u5019\uff0credis\u6bd4memcached\u5177\u6709\u66f4\u591a\u7684\u4f18\u52bf\uff0c\u5e76\u4e14\u652f\u6301\u66f4\u591a\u7684\u6570\u636e\u7c7b\u578b\uff0c\u628aredis\u5f53\u4f5c\u4e00\u4e2a\u4e2d\u95f4\u5b58\u50a8\u7cfb\u7edf\uff0c\u7528\u6765\u5904\u7406\u9ad8\u5e76\u53d1\u7684\u6570\u636e\u5e93\u64cd\u4f5c\n\n- \u901f\u5ea6\u5feb\uff1a\u4f7f\u7528\u6807\u51c6C\u5199\uff0c\u6240\u6709\u6570\u636e\u90fd\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\uff0c\u8bfb\u5199\u901f\u5ea6\u5206\u522b\u8fbe\u523010\u4e07/20\u4e07 \n- \u6301\u4e45\u5316\uff1a\u5bf9\u6570\u636e\u7684\u66f4\u65b0\u91c7\u7528Copy-on-write\u6280\u672f\uff0c\u53ef\u4ee5\u5f02\u6b65\u5730\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\uff0c\u4e3b\u8981\u6709\u4e24\u79cd\u7b56\u7565\uff0c\u4e00\u662f\u6839\u636e\u65f6\u95f4\uff0c\u66f4\u65b0\u6b21\u6570\u7684\u5feb\u7167\uff08save 300 10 \uff09\u4e8c\u662f\u57fa\u4e8e\u8bed\u53e5\u8ffd\u52a0\u65b9\u5f0f(Append-only file\uff0caof) \n- \u81ea\u52a8\u64cd\u4f5c\uff1a\u5bf9\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u7684\u64cd\u4f5c\u90fd\u662f\u81ea\u52a8\u7684\uff0c\u5f88\u5b89\u5168 \n- \u5feb\u901f\u7684\u4e3b--\u4ece\u590d\u5236\uff0c\u5b98\u65b9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6570\u636e\uff0cSlave\u572821\u79d2\u5373\u5b8c\u6210\u4e86\u5bf9Amazon\u7f51\u7ad910G key set\u7684\u590d\u5236\u3002 \n- Sharding\u6280\u672f\uff1a \u5f88\u5bb9\u6613\u5c06\u6570\u636e\u5206\u5e03\u5230\u591a\u4e2aRedis\u5b9e\u4f8b\u4e2d\uff0c\u6570\u636e\u5e93\u7684\u6269\u5c55\u662f\u4e2a\u6c38\u6052\u7684\u8bdd\u9898\uff0c\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\uff0c\u4e3b\u8981\u662f\u4ee5\u6dfb\u52a0\u786c\u4ef6\u3001\u4ee5\u5206\u533a\u4e3a\u4e3b\u8981\u6280\u672f\u5f62\u5f0f\u7684\u7eb5\u5411\u6269\u5c55\u89e3\u51b3\u4e86\u5f88\u591a\u7684\u5e94\u7528\u573a\u666f\uff0c\u4f46\u968f\u7740web2.0\u3001\u79fb\u52a8\u4e92\u8054\u7f51\u3001\u4e91\u8ba1\u7b97\u7b49\u5e94\u7528\u7684\u5174\u8d77\uff0c\u8fd9\u79cd\u6269\u5c55\u6a21\u5f0f\u5df2\u7ecf\u4e0d\u592a\u9002\u5408\u4e86\uff0c\u6240\u4ee5\u8fd1\u5e74\u6765\uff0c\u50cf\u91c7\u7528\u4e3b\u4ece\u914d\u7f6e\u3001\u6570\u636e\u5e93\u590d\u5236\u5f62\u5f0f\u7684\uff0cSharding\u8fd9\u79cd\u6280\u672f\u628a\u8d1f\u8f7d\u5206\u5e03\u5230\u591a\u4e2a\u7279\u7406\u8282\u70b9\u4e0a\u53bb\u7684\u6a2a\u5411\u6269\u5c55\u65b9\u5f0f\u7528\u5904\u8d8a\u6765\u8d8a\u591a\u3002\n\n### Redis\u7f3a\u70b9\n\n- \u662f\u6570\u636e\u5e93\u5bb9\u91cf\u53d7\u5230\u7269\u7406\u5185\u5b58\u7684\u9650\u5236,\u4e0d\u80fd\u7528\u4f5c\u6d77\u91cf\u6570\u636e\u7684\u9ad8\u6027\u80fd\u8bfb\u5199,\u56e0\u6b64Redis\u9002\u5408\u7684\u573a\u666f\u4e3b\u8981\u5c40\u9650\u5728\u8f83\u5c0f\u6570\u636e\u91cf\u7684\u9ad8\u6027\u80fd\u64cd\u4f5c\u548c\u8fd0\u7b97\u4e0a\u3002\n- Redis\u8f83\u96be\u652f\u6301\u5728\u7ebf\u6269\u5bb9\uff0c\u5728\u96c6\u7fa4\u5bb9\u91cf\u8fbe\u5230\u4e0a\u9650\u65f6\u5728\u7ebf\u6269\u5bb9\u4f1a\u53d8\u5f97\u5f88\u590d\u6742\u3002\u4e3a\u907f\u514d\u8fd9\u4e00\u95ee\u9898\uff0c\u8fd0\u7ef4\u4eba\u5458\u5728\u7cfb\u7edf\u4e0a\u7ebf\u65f6\u5fc5\u987b\u786e\u4fdd\u6709\u8db3\u591f\u7684\u7a7a\u95f4\uff0c\u8fd9\u5bf9\u8d44\u6e90\u9020\u6210\u4e86\u5f88\u5927\u7684\u6d6a\u8d39\u3002\n\n\n## 4 \u4e50\u89c2\u9501\u548c\u60b2\u89c2\u9501\n\n\u60b2\u89c2\u9501\uff1a\u5047\u5b9a\u4f1a\u53d1\u751f\u5e76\u53d1\u51b2\u7a81\uff0c\u5c4f\u853d\u4e00\u5207\u53ef\u80fd\u8fdd\u53cd\u6570\u636e\u5b8c\u6574\u6027\u7684\u64cd\u4f5c\n\n\u4e50\u89c2\u9501\uff1a\u5047\u8bbe\u4e0d\u4f1a\u53d1\u751f\u5e76\u53d1\u51b2\u7a81\uff0c\u53ea\u5728\u63d0\u4ea4\u64cd\u4f5c\u65f6\u68c0\u67e5\u662f\u5426\u8fdd\u53cd\u6570\u636e\u5b8c\u6574\u6027\u3002\n\n\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u7684\u5177\u4f53\u533a\u522b: http://www.cnblogs.com/Bob-FD/p/3352216.html\n\n## 5 MVCC\n\n\n> \u200b\t\u5168\u79f0\u662fMulti-Version Concurrent Control\uff0c\u5373\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff0c\u5728MVCC\u534f\u8bae\u4e0b\uff0c\u6bcf\u4e2a\u8bfb\u64cd\u4f5c\u4f1a\u770b\u5230\u4e00\u4e2a\u4e00\u81f4\u6027\u7684snapshot\uff0c\u5e76\u4e14\u53ef\u4ee5\u5b9e\u73b0\u975e\u963b\u585e\u7684\u8bfb\u3002MVCC\u5141\u8bb8\u6570\u636e\u5177\u6709\u591a\u4e2a\u7248\u672c\uff0c\u8fd9\u4e2a\u7248\u672c\u53ef\u4ee5\u662f\u65f6\u95f4\u6233\u6216\u8005\u662f\u5168\u5c40\u9012\u589e\u7684\u4e8b\u52a1ID\uff0c\u5728\u540c\u4e00\u4e2a\u65f6\u95f4\u70b9\uff0c\u4e0d\u540c\u7684\u4e8b\u52a1\u770b\u5230\u7684\u6570\u636e\u662f\u4e0d\u540c\u7684\u3002\n\n### [MySQL](http://lib.csdn.net/base/mysql)\u7684innodb\u5f15\u64ce\u662f\u5982\u4f55\u5b9e\u73b0MVCC\u7684\n\ninnodb\u4f1a\u4e3a\u6bcf\u4e00\u884c\u6dfb\u52a0\u4e24\u4e2a\u5b57\u6bb5\uff0c\u5206\u522b\u8868\u793a\u8be5\u884c**\u521b\u5efa\u7684\u7248\u672c**\u548c**\u5220\u9664\u7684\u7248\u672c**\uff0c\u586b\u5165\u7684\u662f\u4e8b\u52a1\u7684\u7248\u672c\u53f7\uff0c\u8fd9\u4e2a\u7248\u672c\u53f7\u968f\u7740\u4e8b\u52a1\u7684\u521b\u5efa\u4e0d\u65ad\u9012\u589e\u3002\u5728repeated read\u7684\u9694\u79bb\u7ea7\u522b\uff08[\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u8bf7\u770b\u8fd9\u7bc7\u6587\u7ae0](http://blog.csdn.net/chosen0ne/article/details/10036775)\uff09\u4e0b\uff0c\u5177\u4f53\u5404\u79cd\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u5b9e\u73b0\uff1a\n\n- select\uff1a\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u4e2a\u6761\u4ef6innodb\u4f1a\u8fd4\u56de\u8be5\u884c\u6570\u636e\uff1a\n  - \u8be5\u884c\u7684\u521b\u5efa\u7248\u672c\u53f7\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d\u7248\u672c\u53f7\uff0c\u7528\u4e8e\u4fdd\u8bc1\u5728select\u64cd\u4f5c\u4e4b\u524d\u6240\u6709\u7684\u64cd\u4f5c\u5df2\u7ecf\u6267\u884c\u843d\u5730\u3002\n  - \u8be5\u884c\u7684\u5220\u9664\u7248\u672c\u53f7\u5927\u4e8e\u5f53\u524d\u7248\u672c\u6216\u8005\u4e3a\u7a7a\u3002\u5220\u9664\u7248\u672c\u53f7\u5927\u4e8e\u5f53\u524d\u7248\u672c\u610f\u5473\u7740\u6709\u4e00\u4e2a\u5e76\u53d1\u4e8b\u52a1\u5c06\u8be5\u884c\u5220\u9664\u4e86\u3002\n- insert\uff1a\u5c06\u65b0\u63d2\u5165\u7684\u884c\u7684\u521b\u5efa\u7248\u672c\u53f7\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u3002\n- delete\uff1a\u5c06\u8981\u5220\u9664\u7684\u884c\u7684\u5220\u9664\u7248\u672c\u53f7\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7cfb\u7edf\u7684\u7248\u672c\u53f7\u3002\n- update\uff1a\u4e0d\u6267\u884c\u539f\u5730update\uff0c\u800c\u662f\u8f6c\u6362\u6210insert + delete\u3002\u5c06\u65e7\u884c\u7684\u5220\u9664\u7248\u672c\u53f7\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7248\u672c\u53f7\uff0c\u5e76\u5c06\u65b0\u884cinsert\u540c\u65f6\u8bbe\u7f6e\u521b\u5efa\u7248\u672c\u53f7\u4e3a\u5f53\u524d\u7248\u672c\u53f7\u3002\n\n\u5176\u4e2d\uff0c\u5199\u64cd\u4f5c\uff08insert\u3001delete\u548cupdate\uff09\u6267\u884c\u65f6\uff0c\u9700\u8981\u5c06\u7cfb\u7edf\u7248\u672c\u53f7\u9012\u589e\u3002\n\n\u200b\t\u7531\u4e8e\u65e7\u6570\u636e\u5e76\u4e0d\u771f\u6b63\u7684\u5220\u9664\uff0c\u6240\u4ee5\u5fc5\u987b\u5bf9\u8fd9\u4e9b\u6570\u636e\u8fdb\u884c\u6e05\u7406\uff0cinnodb\u4f1a\u5f00\u542f\u4e00\u4e2a\u540e\u53f0\u7ebf\u7a0b\u6267\u884c\u6e05\u7406\u5de5\u4f5c\uff0c\u5177\u4f53\u7684\u89c4\u5219\u662f\u5c06\u5220\u9664\u7248\u672c\u53f7\u5c0f\u4e8e\u5f53\u524d\u7cfb\u7edf\u7248\u672c\u7684\u884c\u5220\u9664\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505apurge\u3002\n\n\u901a\u8fc7MVCC\u5f88\u597d\u7684\u5b9e\u73b0\u4e86\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u53ef\u4ee5\u8fbe\u5230repeated read\u7ea7\u522b\uff0c\u8981\u5b9e\u73b0serializable\u8fd8\u5fc5\u987b\u52a0\u9501\u3002\n\n>  \u53c2\u8003\uff1a[MVCC\u6d45\u6790](http://blog.csdn.net/chosen0ne/article/details/18093187)\n\n\n\n## 6 MyISAM\u548cInnoDB\n\nMyISAM \u9002\u5408\u4e8e\u4e00\u4e9b\u9700\u8981\u5927\u91cf\u67e5\u8be2\u7684\u5e94\u7528\uff0c\u4f46\u5176\u5bf9\u4e8e\u6709\u5927\u91cf\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u5f88\u597d\u3002\u751a\u81f3\u4f60\u53ea\u662f\u9700\u8981update\u4e00\u4e2a\u5b57\u6bb5\uff0c\u6574\u4e2a\u8868\u90fd\u4f1a\u88ab\u9501\u8d77\u6765\uff0c\u800c\u522b\u7684\u8fdb\u7a0b\uff0c\u5c31\u7b97\u662f\u8bfb\u8fdb\u7a0b\u90fd\u65e0\u6cd5\u64cd\u4f5c\u76f4\u5230\u8bfb\u64cd\u4f5c\u5b8c\u6210\u3002\u53e6\u5916\uff0cMyISAM \u5bf9\u4e8e SELECT COUNT(*) \u8fd9\u7c7b\u7684\u8ba1\u7b97\u662f\u8d85\u5feb\u65e0\u6bd4\u7684\u3002\n\nInnoDB \u7684\u8d8b\u52bf\u4f1a\u662f\u4e00\u4e2a\u975e\u5e38\u590d\u6742\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u5c0f\u7684\u5e94\u7528\uff0c\u5b83\u4f1a\u6bd4 MyISAM \u8fd8\u6162\u3002\u4ed6\u662f\u5b83\u652f\u6301\u201c\u884c\u9501\u201d \uff0c\u4e8e\u662f\u5728\u5199\u64cd\u4f5c\u6bd4\u8f83\u591a\u7684\u65f6\u5019\uff0c\u4f1a\u66f4\u4f18\u79c0\u3002\u5e76\u4e14\uff0c\u4ed6\u8fd8\u652f\u6301\u66f4\u591a\u7684\u9ad8\u7ea7\u5e94\u7528\uff0c\u6bd4\u5982\uff1a\u4e8b\u52a1\u3002\n\nmysql \u6570\u636e\u5e93\u5f15\u64ce: http://www.cnblogs.com/0201zcr/p/5296843.html\nMySQL\u5b58\u50a8\u5f15\u64ce\uff0d\uff0dMyISAM\u4e0eInnoDB\u533a\u522b: https://segmentfault.com/a/1190000008227211\n\n# \u7f51\u7edc\n\n## 1 \u4e09\u6b21\u63e1\u624b\n\n1. \u5ba2\u6237\u7aef\u901a\u8fc7\u5411\u670d\u52a1\u5668\u7aef\u53d1\u9001\u4e00\u4e2aSYN\u6765\u521b\u5efa\u4e00\u4e2a\u4e3b\u52a8\u6253\u5f00\uff0c\u4f5c\u4e3a\u4e09\u6b21\u63e1\u624b\u7684\u4e00\u90e8\u5206\u3002\u5ba2\u6237\u7aef\u628a\u8fd9\u6bb5\u8fde\u63a5\u7684\u5e8f\u53f7\u8bbe\u5b9a\u4e3a\u968f\u673a\u6570 A\u3002\n2. \u670d\u52a1\u5668\u7aef\u5e94\u5f53\u4e3a\u4e00\u4e2a\u5408\u6cd5\u7684SYN\u56de\u9001\u4e00\u4e2aSYN/ACK\u3002ACK \u7684\u786e\u8ba4\u7801\u5e94\u4e3a A+1\uff0cSYN/ACK \u5305\u672c\u8eab\u53c8\u6709\u4e00\u4e2a\u968f\u673a\u5e8f\u53f7 B\u3002\n3. \u6700\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u53d1\u9001\u4e00\u4e2aACK\u3002\u5f53\u670d\u52a1\u7aef\u53d7\u5230\u8fd9\u4e2aACK\u7684\u65f6\u5019\uff0c\u5c31\u5b8c\u6210\u4e86\u4e09\u8def\u63e1\u624b\uff0c\u5e76\u8fdb\u5165\u4e86\u8fde\u63a5\u521b\u5efa\u72b6\u6001\u3002\u6b64\u65f6\u5305\u5e8f\u53f7\u88ab\u8bbe\u5b9a\u4e3a\u6536\u5230\u7684\u786e\u8ba4\u53f7 A+1\uff0c\u800c\u54cd\u5e94\u5219\u4e3a B+1\u3002\n\n## 2 \u56db\u6b21\u6325\u624b\n\n_\u6ce8\u610f: \u4e2d\u65ad\u8fde\u63a5\u7aef\u53ef\u4ee5\u662f\u5ba2\u6237\u7aef\uff0c\u4e5f\u53ef\u4ee5\u662f\u670d\u52a1\u5668\u7aef. \u4e0b\u9762\u4ec5\u4ee5\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u4e3e\u4f8b, \u53cd\u4e4b\u4ea6\u7136._\n\n1. \u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u5206\u6bb5, \u5176\u4e2d\u7684 FIN \u6807\u8bb0\u8bbe\u7f6e\u4e3a1. \u5ba2\u6237\u7aef\u8fdb\u5165 FIN-WAIT \u72b6\u6001. \u8be5\u72b6\u6001\u4e0b\u5ba2\u6237\u7aef\u53ea\u63a5\u6536\u6570\u636e, \u4e0d\u518d\u53d1\u9001\u6570\u636e.\n2. \u670d\u52a1\u5668\u63a5\u6536\u5230\u5e26\u6709 FIN = 1 \u7684\u6570\u636e\u5206\u6bb5, \u53d1\u9001\u5e26\u6709 ACK = 1 \u7684\u5269\u4f59\u6570\u636e\u5206\u6bb5, \u786e\u8ba4\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684 FIN \u4fe1\u606f.\n3. \u670d\u52a1\u5668\u7b49\u5230\u6240\u6709\u6570\u636e\u4f20\u8f93\u7ed3\u675f, \u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u5e26\u6709 FIN = 1 \u7684\u6570\u636e\u5206\u6bb5, \u5e76\u8fdb\u5165 CLOSE-WAIT \u72b6\u6001, \u7b49\u5f85\u5ba2\u6237\u7aef\u53d1\u6765\u5e26\u6709 ACK = 1 \u7684\u786e\u8ba4\u62a5\u6587.\n4. \u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u53d1\u6765\u5e26\u6709 FIN = 1 \u7684\u62a5\u6587, \u8fd4\u56de ACK = 1 \u7684\u62a5\u6587\u786e\u8ba4, \u4e3a\u4e86\u9632\u6b62\u670d\u52a1\u5668\u7aef\u672a\u6536\u5230\u9700\u8981\u91cd\u53d1, \u8fdb\u5165 TIME-WAIT \u72b6\u6001. \u670d\u52a1\u5668\u63a5\u6536\u5230\u62a5\u6587\u540e\u5173\u95ed\u8fde\u63a5. \u5ba2\u6237\u7aef\u7b49\u5f85 2MSL \u540e\u672a\u6536\u5230\u56de\u590d, \u5219\u8ba4\u4e3a\u670d\u52a1\u5668\u6210\u529f\u5173\u95ed, \u5ba2\u6237\u7aef\u5173\u95ed\u8fde\u63a5.\n\n\u56fe\u89e3: http://blog.csdn.net/whuslei/article/details/6667471\n\n## 3 ARP\u534f\u8bae\n\n\u5730\u5740\u89e3\u6790\u534f\u8bae(Address Resolution Protocol)\uff0c\u5176\u57fa\u672c\u529f\u80fd\u4e3a\u900f\u8fc7\u76ee\u6807\u8bbe\u5907\u7684IP\u5730\u5740\uff0c\u67e5\u8be2\u76ee\u6807\u7684MAC\u5730\u5740\uff0c\u4ee5\u4fdd\u8bc1\u901a\u4fe1\u7684\u987a\u5229\u8fdb\u884c\u3002\u5b83\u662fIPv4\u7f51\u7edc\u5c42\u5fc5\u4e0d\u53ef\u5c11\u7684\u534f\u8bae\uff0c\u4e0d\u8fc7\u5728IPv6\u4e2d\u5df2\u4e0d\u518d\u9002\u7528\uff0c\u5e76\u88ab\u90bb\u5c45\u53d1\u73b0\u534f\u8bae\uff08NDP\uff09\u6240\u66ff\u4ee3\u3002\n\n## 4 urllib\u548curllib2\u7684\u533a\u522b\n\n\u8fd9\u4e2a\u9762\u8bd5\u5b98\u786e\u5b9e\u95ee\u8fc7,\u5f53\u65f6\u7b54\u7684urllib2\u53ef\u4ee5Post\u800curllib\u4e0d\u53ef\u4ee5.\n\n1. urllib\u63d0\u4f9burlencode\u65b9\u6cd5\u7528\u6765GET\u67e5\u8be2\u5b57\u7b26\u4e32\u7684\u4ea7\u751f\uff0c\u800curllib2\u6ca1\u6709\u3002\u8fd9\u662f\u4e3a\u4f55urllib\u5e38\u548curllib2\u4e00\u8d77\u4f7f\u7528\u7684\u539f\u56e0\u3002\n2. urllib2\u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2aRequest\u7c7b\u7684\u5b9e\u4f8b\u6765\u8bbe\u7f6eURL\u8bf7\u6c42\u7684headers\uff0curllib\u4ec5\u53ef\u4ee5\u63a5\u53d7URL\u3002\u8fd9\u610f\u5473\u7740\uff0c\u4f60\u4e0d\u53ef\u4ee5\u4f2a\u88c5\u4f60\u7684User Agent\u5b57\u7b26\u4e32\u7b49\u3002\n\n\n## 5 Post\u548cGet\n[GET\u548cPOST\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u53ca\u4e3a\u4ec0\u4e48\u7f51\u4e0a\u7684\u591a\u6570\u7b54\u6848\u90fd\u662f\u9519\u7684](http://www.cnblogs.com/nankezhishi/archive/2012/06/09/getandpost.html)\n[\u77e5\u4e4e\u56de\u7b54](https://www.zhihu.com/question/31640769?rf=37401322)\n\nget: [RFC 2616 - Hypertext Transfer Protocol -- HTTP/1.1](http://tools.ietf.org/html/rfc2616#section-9.3)\npost: [RFC 2616 - Hypertext Transfer Protocol -- HTTP/1.1](http://tools.ietf.org/html/rfc2616#section-9.5)\n\n\n\n## 6 Cookie\u548cSession\n\n|      | Cookie                     | Session |\n| :--- | :------------------------- | :------ |\n| \u50a8\u5b58\u4f4d\u7f6e | \u5ba2\u6237\u7aef                        | \u670d\u52a1\u5668\u7aef    |\n| \u76ee\u7684   | \u8ddf\u8e2a\u4f1a\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u5b58\u7528\u6237\u504f\u597d\u8bbe\u7f6e\u6216\u8005\u4fdd\u5b58\u7528\u6237\u540d\u5bc6\u7801\u7b49 | \u8ddf\u8e2a\u4f1a\u8bdd    |\n| \u5b89\u5168\u6027  | \u4e0d\u5b89\u5168                        | \u5b89\u5168      |\n\nsession\u6280\u672f\u662f\u8981\u4f7f\u7528\u5230cookie\u7684\uff0c\u4e4b\u6240\u4ee5\u51fa\u73b0session\u6280\u672f\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5b89\u5168\u3002\n\n## 7 apache\u548cnginx\u7684\u533a\u522b\n\nnginx \u76f8\u5bf9 apache \u7684\u4f18\u70b9\uff1a\n* \u8f7b\u91cf\u7ea7\uff0c\u540c\u6837\u8d77web \u670d\u52a1\uff0c\u6bd4apache \u5360\u7528\u66f4\u5c11\u7684\u5185\u5b58\u53ca\u8d44\u6e90\n* \u6297\u5e76\u53d1\uff0cnginx \u5904\u7406\u8bf7\u6c42\u662f\u5f02\u6b65\u975e\u963b\u585e\u7684\uff0c\u652f\u6301\u66f4\u591a\u7684\u5e76\u53d1\u8fde\u63a5\uff0c\u800capache \u5219\u662f\u963b\u585e\u578b\u7684\uff0c\u5728\u9ad8\u5e76\u53d1\u4e0bnginx \u80fd\u4fdd\u6301\u4f4e\u8d44\u6e90\u4f4e\u6d88\u8017\u9ad8\u6027\u80fd\n* \u914d\u7f6e\u7b80\u6d01\n* \u9ad8\u5ea6\u6a21\u5757\u5316\u7684\u8bbe\u8ba1\uff0c\u7f16\u5199\u6a21\u5757\u76f8\u5bf9\u7b80\u5355\n* \u793e\u533a\u6d3b\u8dc3\n\napache \u76f8\u5bf9nginx \u7684\u4f18\u70b9\uff1a\n* rewrite \uff0c\u6bd4nginx \u7684rewrite \u5f3a\u5927\n* \u6a21\u5757\u8d85\u591a\uff0c\u57fa\u672c\u60f3\u5230\u7684\u90fd\u53ef\u4ee5\u627e\u5230\n* \u5c11bug \uff0cnginx \u7684bug \u76f8\u5bf9\u8f83\u591a\n* \u8d85\u7a33\u5b9a\n\n## 8 \u7f51\u7ad9\u7528\u6237\u5bc6\u7801\u4fdd\u5b58\n\n1. \u660e\u6587\u4fdd\u5b58\n2. \u660e\u6587hash\u540e\u4fdd\u5b58,\u5982md5\n3. MD5+Salt\u65b9\u5f0f,\u8fd9\u4e2asalt\u53ef\u4ee5\u968f\u673a\n4. \u77e5\u4e4e\u4f7f\u7528\u4e86Bcrypy(\u597d\u50cf)\u52a0\u5bc6\n\n## 9 HTTP\u548cHTTPS\n\n\n| \u72b6\u6001\u7801       | \u5b9a\u4e49               |\n| :-------- | :--------------- |\n| 1xx \u62a5\u544a    | \u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u7ee7\u7eed\u8fdb\u7a0b       |\n| 2xx \u6210\u529f    | \u6b65\u9aa4\u6210\u529f\u63a5\u6536\uff0c\u88ab\u7406\u89e3\uff0c\u5e76\u88ab\u63a5\u53d7  |\n| 3xx \u91cd\u5b9a\u5411   | \u4e3a\u4e86\u5b8c\u6210\u8bf7\u6c42,\u5fc5\u987b\u91c7\u53d6\u8fdb\u4e00\u6b65\u63aa\u65bd |\n| 4xx \u5ba2\u6237\u7aef\u51fa\u9519 | \u8bf7\u6c42\u5305\u62ec\u9519\u7684\u987a\u5e8f\u6216\u4e0d\u80fd\u5b8c\u6210    |\n| 5xx \u670d\u52a1\u5668\u51fa\u9519 | \u670d\u52a1\u5668\u65e0\u6cd5\u5b8c\u6210\u663e\u7136\u6709\u6548\u7684\u8bf7\u6c42   |\n\n403: Forbidden\n404: Not Found\n\nHTTPS\u63e1\u624b,\u5bf9\u79f0\u52a0\u5bc6,\u975e\u5bf9\u79f0\u52a0\u5bc6,TLS/SSL,RSA\n\n## 10 XSRF\u548cXSS\n\n* CSRF(Cross-site request forgery)\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\n* XSS(Cross Site Scripting)\u8de8\u7ad9\u811a\u672c\u653b\u51fb\n\nCSRF\u91cd\u70b9\u5728\u8bf7\u6c42,XSS\u91cd\u70b9\u5728\u811a\u672c\n\n## 11 \u5e42\u7b49 Idempotence\n\nHTTP\u65b9\u6cd5\u7684\u5e42\u7b49\u6027\u662f\u6307\u4e00\u6b21\u548c\u591a\u6b21\u8bf7\u6c42\u67d0\u4e00\u4e2a\u8d44\u6e90\u5e94\u8be5\u5177\u6709\u540c\u6837\u7684**\u526f\u4f5c\u7528**\u3002(\u6ce8\u610f\u662f\u526f\u4f5c\u7528)\n\n`GET http://www.bank.com/account/123456`\uff0c\u4e0d\u4f1a\u6539\u53d8\u8d44\u6e90\u7684\u72b6\u6001\uff0c\u4e0d\u8bba\u8c03\u7528\u4e00\u6b21\u8fd8\u662fN\u6b21\u90fd\u6ca1\u6709\u526f\u4f5c\u7528\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u91cc\u5f3a\u8c03\u7684\u662f\u4e00\u6b21\u548cN\u6b21\u5177\u6709\u76f8\u540c\u7684\u526f\u4f5c\u7528\uff0c\u800c\u4e0d\u662f\u6bcf\u6b21GET\u7684\u7ed3\u679c\u76f8\u540c\u3002`GET http://www.news.com/latest-news`\u8fd9\u4e2aHTTP\u8bf7\u6c42\u53ef\u80fd\u4f1a\u6bcf\u6b21\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\uff0c\u4f46\u5b83\u672c\u8eab\u5e76\u6ca1\u6709\u4ea7\u751f\u4efb\u4f55\u526f\u4f5c\u7528\uff0c\u56e0\u800c\u662f\u6ee1\u8db3\u5e42\u7b49\u6027\u7684\u3002\n\nDELETE\u65b9\u6cd5\u7528\u4e8e\u5220\u9664\u8d44\u6e90\uff0c\u6709\u526f\u4f5c\u7528\uff0c\u4f46\u5b83\u5e94\u8be5\u6ee1\u8db3\u5e42\u7b49\u6027\u3002\u6bd4\u5982\uff1a`DELETE http://www.forum.com/article/4231`\uff0c\u8c03\u7528\u4e00\u6b21\u548cN\u6b21\u5bf9\u7cfb\u7edf\u4ea7\u751f\u7684\u526f\u4f5c\u7528\u662f\u76f8\u540c\u7684\uff0c\u5373\u5220\u6389id\u4e3a4231\u7684\u5e16\u5b50\uff1b\u56e0\u6b64\uff0c\u8c03\u7528\u8005\u53ef\u4ee5\u591a\u6b21\u8c03\u7528\u6216\u5237\u65b0\u9875\u9762\u800c\u4e0d\u5fc5\u62c5\u5fc3\u5f15\u8d77\u9519\u8bef\u3002\n\n\nPOST\u6240\u5bf9\u5e94\u7684URI\u5e76\u975e\u521b\u5efa\u7684\u8d44\u6e90\u672c\u8eab\uff0c\u800c\u662f\u8d44\u6e90\u7684\u63a5\u6536\u8005\u3002\u6bd4\u5982\uff1a`POST http://www.forum.com/articles`\u7684\u8bed\u4e49\u662f\u5728`http://www.forum.com/articles`\u4e0b\u521b\u5efa\u4e00\u7bc7\u5e16\u5b50\uff0cHTTP\u54cd\u5e94\u4e2d\u5e94\u5305\u542b\u5e16\u5b50\u7684\u521b\u5efa\u72b6\u6001\u4ee5\u53ca\u5e16\u5b50\u7684URI\u3002\u4e24\u6b21\u76f8\u540c\u7684POST\u8bf7\u6c42\u4f1a\u5728\u670d\u52a1\u5668\u7aef\u521b\u5efa\u4e24\u4efd\u8d44\u6e90\uff0c\u5b83\u4eec\u5177\u6709\u4e0d\u540c\u7684URI\uff1b\u6240\u4ee5\uff0cPOST\u65b9\u6cd5\u4e0d\u5177\u5907\u5e42\u7b49\u6027\u3002\n\nPUT\u6240\u5bf9\u5e94\u7684URI\u662f\u8981\u521b\u5efa\u6216\u66f4\u65b0\u7684\u8d44\u6e90\u672c\u8eab\u3002\u6bd4\u5982\uff1a`PUT http://www.forum/articles/4231`\u7684\u8bed\u4e49\u662f\u521b\u5efa\u6216\u66f4\u65b0ID\u4e3a4231\u7684\u5e16\u5b50\u3002\u5bf9\u540c\u4e00URI\u8fdb\u884c\u591a\u6b21PUT\u7684\u526f\u4f5c\u7528\u548c\u4e00\u6b21PUT\u662f\u76f8\u540c\u7684\uff1b\u56e0\u6b64\uff0cPUT\u65b9\u6cd5\u5177\u6709\u5e42\u7b49\u6027\u3002\n\n\n## 12 RESTful\u67b6\u6784(SOAP,RPC)\n\n\u63a8\u8350: http://www.ruanyifeng.com/blog/2011/09/restful.html\n\n\n## 13 SOAP\n\nSOAP\uff08\u539f\u4e3aSimple Object Access Protocol\u7684\u9996\u5b57\u6bcd\u7f29\u5199\uff0c\u5373\u7b80\u5355\u5bf9\u8c61\u8bbf\u95ee\u534f\u8bae\uff09\u662f\u4ea4\u6362\u6570\u636e\u7684\u4e00\u79cd\u534f\u8bae\u89c4\u8303\uff0c\u4f7f\u7528\u5728\u8ba1\u7b97\u673a\u7f51\u7edcWeb\u670d\u52a1\uff08web service\uff09\u4e2d\uff0c\u4ea4\u6362\u5e26\u7ed3\u6784\u4fe1\u606f\u3002SOAP\u4e3a\u4e86\u7b80\u5316\u7f51\u9875\u670d\u52a1\u5668\uff08Web Server\uff09\u4eceXML\u6570\u636e\u5e93\u4e2d\u63d0\u53d6\u6570\u636e\u65f6\uff0c\u8282\u7701\u53bb\u683c\u5f0f\u5316\u9875\u9762\u65f6\u95f4\uff0c\u4ee5\u53ca\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u6309\u7167HTTP\u901a\u4fe1\u534f\u8bae\uff0c\u9075\u4eceXML\u683c\u5f0f\u6267\u884c\u8d44\u6599\u4e92\u6362\uff0c\u4f7f\u5176\u62bd\u8c61\u4e8e\u8bed\u8a00\u5b9e\u73b0\u3001\u5e73\u53f0\u548c\u786c\u4ef6\u3002\n\n## 14 RPC\n\nRPC\uff08Remote Procedure Call Protocol\uff09\u2014\u2014\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u534f\u8bae\uff0c\u5b83\u662f\u4e00\u79cd\u901a\u8fc7\u7f51\u7edc\u4ece\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7a0b\u5e8f\u4e0a\u8bf7\u6c42\u670d\u52a1\uff0c\u800c\u4e0d\u9700\u8981\u4e86\u89e3\u5e95\u5c42\u7f51\u7edc\u6280\u672f\u7684\u534f\u8bae\u3002RPC\u534f\u8bae\u5047\u5b9a\u67d0\u4e9b\u4f20\u8f93\u534f\u8bae\u7684\u5b58\u5728\uff0c\u5982TCP\u6216UDP\uff0c\u4e3a\u901a\u4fe1\u7a0b\u5e8f\u4e4b\u95f4\u643a\u5e26\u4fe1\u606f\u6570\u636e\u3002\u5728OSI\u7f51\u7edc\u901a\u4fe1\u6a21\u578b\u4e2d\uff0cRPC\u8de8\u8d8a\u4e86\u4f20\u8f93\u5c42\u548c\u5e94\u7528\u5c42\u3002RPC\u4f7f\u5f97\u5f00\u53d1\u5305\u62ec\u7f51\u7edc\u5206\u5e03\u5f0f\u591a\u7a0b\u5e8f\u5728\u5185\u7684\u5e94\u7528\u7a0b\u5e8f\u66f4\u52a0\u5bb9\u6613\u3002\n\n\u603b\u7ed3:\u670d\u52a1\u63d0\u4f9b\u7684\u4e24\u5927\u6d41\u6d3e.\u4f20\u7edf\u610f\u4e49\u4ee5\u65b9\u6cd5\u8c03\u7528\u4e3a\u5bfc\u5411\u901a\u79f0RPC\u3002\u4e3a\u4e86\u4f01\u4e1aSOA,\u82e5\u5e72\u5382\u5546\u8054\u5408\u63a8\u51fawebservice,\u5236\u5b9a\u4e86wsdl\u63a5\u53e3\u5b9a\u4e49,\u4f20\u8f93soap.\u5f53\u4e92\u8054\u7f51\u65f6\u4ee3,\u81c3\u80bfSOA\u88ab\u7b80\u5316\u4e3ahttp+xml/json.\u4f46\u662f\u7b80\u5316\u51fa\u73b0\u5404\u79cd\u6df7\u4e71\u3002\u4ee5\u8d44\u6e90\u4e3a\u5bfc\u5411,\u4efb\u4f55\u64cd\u4f5c\u65e0\u975e\u662f\u5bf9\u8d44\u6e90\u7684\u589e\u5220\u6539\u67e5\uff0c\u4e8e\u662f\u7edf\u4e00\u7684REST\u51fa\u73b0\u4e86.\n\n\u8fdb\u5316\u7684\u987a\u5e8f: RPC -> SOAP -> RESTful\n\n## 15 CGI\u548cWSGI\nCGI\u662f\u901a\u7528\u7f51\u5173\u63a5\u53e3\uff0c\u662f\u8fde\u63a5web\u670d\u52a1\u5668\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u63a5\u53e3\uff0c\u7528\u6237\u901a\u8fc7CGI\u6765\u83b7\u53d6\u52a8\u6001\u6570\u636e\u6216\u6587\u4ef6\u7b49\u3002\nCGI\u7a0b\u5e8f\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7a0b\u5e8f\uff0c\u5b83\u53ef\u4ee5\u7528\u51e0\u4e4e\u6240\u6709\u8bed\u8a00\u6765\u5199\uff0c\u5305\u62ecperl\uff0cc\uff0clua\uff0cpython\u7b49\u7b49\u3002\n\nWSGI, Web Server Gateway Interface\uff0c\u662fPython\u5e94\u7528\u7a0b\u5e8f\u6216\u6846\u67b6\u548cWeb\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u4e00\u79cd\u63a5\u53e3\uff0cWSGI\u7684\u5176\u4e2d\u4e00\u4e2a\u76ee\u7684\u5c31\u662f\u8ba9\u7528\u6237\u53ef\u4ee5\u7528\u7edf\u4e00\u7684\u8bed\u8a00(Python)\u7f16\u5199\u524d\u540e\u7aef\u3002\n\n\u5b98\u65b9\u8bf4\u660e\uff1a[PEP-3333](https://www.python.org/dev/peps/pep-3333/)\n\n## 16 \u4e2d\u95f4\u4eba\u653b\u51fb\n\n\u5728GFW\u91cc\u5c61\u89c1\u4e0d\u9c9c\u7684,\u5475\u5475.\n\n\u4e2d\u95f4\u4eba\u653b\u51fb\uff08Man-in-the-middle attack\uff0c\u901a\u5e38\u7f29\u5199\u4e3aMITM\uff09\u662f\u6307\u653b\u51fb\u8005\u4e0e\u901a\u8baf\u7684\u4e24\u7aef\u5206\u522b\u521b\u5efa\u72ec\u7acb\u7684\u8054\u7cfb\uff0c\u5e76\u4ea4\u6362\u5176\u6240\u6536\u5230\u7684\u6570\u636e\uff0c\u4f7f\u901a\u8baf\u7684\u4e24\u7aef\u8ba4\u4e3a\u4ed6\u4eec\u6b63\u5728\u901a\u8fc7\u4e00\u4e2a\u79c1\u5bc6\u7684\u8fde\u63a5\u4e0e\u5bf9\u65b9\u76f4\u63a5\u5bf9\u8bdd\uff0c\u4f46\u4e8b\u5b9e\u4e0a\u6574\u4e2a\u4f1a\u8bdd\u90fd\u88ab\u653b\u51fb\u8005\u5b8c\u5168\u63a7\u5236\u3002\n\n## 17 c10k\u95ee\u9898\n\n\u6240\u8c13c10k\u95ee\u9898\uff0c\u6307\u7684\u662f\u670d\u52a1\u5668\u540c\u65f6\u652f\u6301\u6210\u5343\u4e0a\u4e07\u4e2a\u5ba2\u6237\u7aef\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662fconcurrent 10 000 connection\uff08\u8fd9\u4e5f\u662fc10k\u8fd9\u4e2a\u540d\u5b57\u7684\u7531\u6765\uff09\u3002\n\u63a8\u8350: https://my.oschina.net/xianggao/blog/664275\n\n## 18 socket\n\n\u63a8\u8350: http://www.360doc.com/content/11/0609/15/5482098_122692444.shtml\n\nSocket=Ip address+ TCP/UDP + port\n\n## 19 \u6d4f\u89c8\u5668\u7f13\u5b58\n\n\u63a8\u8350: http://www.cnblogs.com/skynet/archive/2012/11/28/2792503.html\n\n304 Not Modified\n\n## 20 HTTP1.0\u548cHTTP1.1\n\n\u63a8\u8350: http://blog.csdn.net/elifefly/article/details/3964766\n\n1. \u8bf7\u6c42\u5934Host\u5b57\u6bb5,\u4e00\u4e2a\u670d\u52a1\u5668\u591a\u4e2a\u7f51\u7ad9\n2. \u957f\u94fe\u63a5\n3. \u6587\u4ef6\u65ad\u70b9\u7eed\u4f20\n4. \u8eab\u4efd\u8ba4\u8bc1,\u72b6\u6001\u7ba1\u7406,Cache\u7f13\u5b58\n\nHTTP\u8bf7\u6c428\u79cd\u65b9\u6cd5\u4ecb\u7ecd \nHTTP/1.1\u534f\u8bae\u4e2d\u5171\u5b9a\u4e49\u4e868\u79cdHTTP\u8bf7\u6c42\u65b9\u6cd5\uff0cHTTP\u8bf7\u6c42\u65b9\u6cd5\u4e5f\u88ab\u53eb\u505a\u201c\u8bf7\u6c42\u52a8\u4f5c\u201d\uff0c\u4e0d\u540c\u7684\u65b9\u6cd5\u89c4\u5b9a\u4e86\u4e0d\u540c\u7684\u64cd\u4f5c\u6307\u5b9a\u7684\u8d44\u6e90\u65b9\u5f0f\u3002\u670d\u52a1\u7aef\u4e5f\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u8bf7\u6c42\u65b9\u6cd5\u505a\u4e0d\u540c\u7684\u54cd\u5e94\u3002\n\nGET\n\nGET\u8bf7\u6c42\u4f1a\u663e\u793a\u8bf7\u6c42\u6307\u5b9a\u7684\u8d44\u6e90\u3002\u4e00\u822c\u6765\u8bf4GET\u65b9\u6cd5\u5e94\u8be5\u53ea\u7528\u4e8e\u6570\u636e\u7684\u8bfb\u53d6\uff0c\u800c\u4e0d\u5e94\u5f53\u7528\u4e8e\u4f1a\u4ea7\u751f\u526f\u4f5c\u7528\u7684\u975e\u5e42\u7b49\u7684\u64cd\u4f5c\u4e2d\u3002\n\nGET\u4f1a\u65b9\u6cd5\u8bf7\u6c42\u6307\u5b9a\u7684\u9875\u9762\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u54cd\u5e94\u4e3b\u4f53\uff0cGET\u88ab\u8ba4\u4e3a\u662f\u4e0d\u5b89\u5168\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3aGET\u65b9\u6cd5\u4f1a\u88ab\u7f51\u7edc\u8718\u86db\u7b49\u4efb\u610f\u7684\u8bbf\u95ee\u3002\n\nHEAD\n\nHEAD\u65b9\u6cd5\u4e0eGET\u65b9\u6cd5\u4e00\u6837\uff0c\u90fd\u662f\u5411\u670d\u52a1\u5668\u53d1\u51fa\u6307\u5b9a\u8d44\u6e90\u7684\u8bf7\u6c42\u3002\u4f46\u662f\uff0c\u670d\u52a1\u5668\u5728\u54cd\u5e94HEAD\u8bf7\u6c42\u65f6\u4e0d\u4f1a\u56de\u4f20\u8d44\u6e90\u7684\u5185\u5bb9\u90e8\u5206\uff0c\u5373\uff1a\u54cd\u5e94\u4e3b\u4f53\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u4f20\u8f93\u5168\u90e8\u5185\u5bb9\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u670d\u52a1\u5668\u7684\u54cd\u5e94\u5934\u4fe1\u606f\u3002HEAD\u65b9\u6cd5\u5e38\u88ab\u7528\u4e8e\u5ba2\u6237\u7aef\u67e5\u770b\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002\n\nPOST\n\nPOST\u8bf7\u6c42\u4f1a \u5411\u6307\u5b9a\u8d44\u6e90\u63d0\u4ea4\u6570\u636e\uff0c\u8bf7\u6c42\u670d\u52a1\u5668\u8fdb\u884c\u5904\u7406\uff0c\u5982\uff1a\u8868\u5355\u6570\u636e\u63d0\u4ea4\u3001\u6587\u4ef6\u4e0a\u4f20\u7b49\uff0c\u8bf7\u6c42\u6570\u636e\u4f1a\u88ab\u5305\u542b\u5728\u8bf7\u6c42\u4f53\u4e2d\u3002POST\u65b9\u6cd5\u662f\u975e\u5e42\u7b49\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u8bf7\u6c42\u53ef\u80fd\u4f1a\u521b\u5efa\u65b0\u7684\u8d44\u6e90\u6216/\u548c\u4fee\u6539\u73b0\u6709\u8d44\u6e90\u3002\n\nPUT\n\nPUT\u8bf7\u6c42\u4f1a\u8eab\u5411\u6307\u5b9a\u8d44\u6e90\u4f4d\u7f6e\u4e0a\u4f20\u5176\u6700\u65b0\u5185\u5bb9\uff0cPUT\u65b9\u6cd5\u662f\u5e42\u7b49\u7684\u65b9\u6cd5\u3002\u901a\u8fc7\u8be5\u65b9\u6cd5\u5ba2\u6237\u7aef\u53ef\u4ee5\u5c06\u6307\u5b9a\u8d44\u6e90\u7684\u6700\u65b0\u6570\u636e\u4f20\u9001\u7ed9\u670d\u52a1\u5668\u53d6\u4ee3\u6307\u5b9a\u7684\u8d44\u6e90\u7684\u5185\u5bb9\u3002\n\nDELETE\n\nDELETE\u8bf7\u6c42\u7528\u4e8e\u8bf7\u6c42\u670d\u52a1\u5668\u5220\u9664\u6240\u8bf7\u6c42URI\uff08\u7edf\u4e00\u8d44\u6e90\u6807\u8bc6\u7b26\uff0cUniform Resource Identifier\uff09\u6240\u6807\u8bc6\u7684\u8d44\u6e90\u3002DELETE\u8bf7\u6c42\u540e\u6307\u5b9a\u8d44\u6e90\u4f1a\u88ab\u5220\u9664\uff0cDELETE\u65b9\u6cd5\u4e5f\u662f\u5e42\u7b49\u7684\u3002\n\nCONNECT\n\nCONNECT\u65b9\u6cd5\u662fHTTP/1.1\u534f\u8bae\u9884\u7559\u7684\uff0c\u80fd\u591f\u5c06\u8fde\u63a5\u6539\u4e3a\u7ba1\u9053\u65b9\u5f0f\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002\u901a\u5e38\u7528\u4e8eSSL\u52a0\u5bc6\u670d\u52a1\u5668\u7684\u94fe\u63a5\u4e0e\u975e\u52a0\u5bc6\u7684HTTP\u4ee3\u7406\u670d\u52a1\u5668\u7684\u901a\u4fe1\u3002\n\nOPTIONS\n\nOPTIONS\u8bf7\u6c42\u4e0eHEAD\u7c7b\u4f3c\uff0c\u4e00\u822c\u4e5f\u662f\u7528\u4e8e\u5ba2\u6237\u7aef\u67e5\u770b\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002 \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u8bf7\u6c42\u670d\u52a1\u5668\u8fd4\u56de\u8be5\u8d44\u6e90\u6240\u652f\u6301\u7684\u6240\u6709HTTP\u8bf7\u6c42\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4f1a\u7528\u2019*\u2019\u6765\u4ee3\u66ff\u8d44\u6e90\u540d\u79f0\uff0c\u5411\u670d\u52a1\u5668\u53d1\u9001OPTIONS\u8bf7\u6c42\uff0c\u53ef\u4ee5\u6d4b\u8bd5\u670d\u52a1\u5668\u529f\u80fd\u662f\u5426\u6b63\u5e38\u3002JavaScript\u7684XMLHttpRequest\u5bf9\u8c61\u8fdb\u884cCORS\u8de8\u57df\u8d44\u6e90\u5171\u4eab\u65f6\uff0c\u5c31\u662f\u4f7f\u7528OPTIONS\u65b9\u6cd5\u53d1\u9001\u55c5\u63a2\u8bf7\u6c42\uff0c\u4ee5\u5224\u65ad\u662f\u5426\u6709\u5bf9\u6307\u5b9a\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u3002 \u5141\u8bb8\n\nTRACE\n\nTRACE\u8bf7\u6c42\u670d\u52a1\u5668\u56de\u663e\u5176\u6536\u5230\u7684\u8bf7\u6c42\u4fe1\u606f\uff0c\u8be5\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8eHTTP\u8bf7\u6c42\u7684\u6d4b\u8bd5\u6216\u8bca\u65ad\u3002\n\nHTTP/1.1\u4e4b\u540e\u589e\u52a0\u7684\u65b9\u6cd5\n\n\u5728HTTP/1.1\u6807\u51c6\u5236\u5b9a\u4e4b\u540e\uff0c\u53c8\u9646\u7eed\u6269\u5c55\u4e86\u4e00\u4e9b\u65b9\u6cd5\u3002\u5176\u4e2d\u4f7f\u7528\u4e2d\u8f83\u591a\u7684\u662f PATCH \u65b9\u6cd5\uff1a\n\nPATCH\n\nPATCH\u65b9\u6cd5\u51fa\u73b0\u7684\u8f83\u665a\uff0c\u5b83\u57282010\u5e74\u7684RFC 5789\u6807\u51c6\u4e2d\u88ab\u5b9a\u4e49\u3002PATCH\u8bf7\u6c42\u4e0ePUT\u8bf7\u6c42\u7c7b\u4f3c\uff0c\u540c\u6837\u7528\u4e8e\u8d44\u6e90\u7684\u66f4\u65b0\u3002\u4e8c\u8005\u6709\u4ee5\u4e0b\u4e24\u70b9\u4e0d\u540c\uff1a\n\n\u4f46PATCH\u4e00\u822c\u7528\u4e8e\u8d44\u6e90\u7684\u90e8\u5206\u66f4\u65b0\uff0c\u800cPUT\u4e00\u822c\u7528\u4e8e\u8d44\u6e90\u7684\u6574\u4f53\u66f4\u65b0\u3002 \n\u5f53\u8d44\u6e90\u4e0d\u5b58\u5728\u65f6\uff0cPATCH\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8d44\u6e90\uff0c\u800cPUT\u53ea\u4f1a\u5bf9\u5df2\u5728\u8d44\u6e90\u8fdb\u884c\u66f4\u65b0\u3002\n\n## 21 Ajax\nAJAX,Asynchronous JavaScript and XML\uff08\u5f02\u6b65\u7684 JavaScript \u548c XML\uff09, \u662f\u4e0e\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u9875\u9762\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0e\u670d\u52a1\u5668\u4ea4\u6362\u6570\u636e\u5e76\u66f4\u65b0\u90e8\u5206\u7f51\u9875\u7684\u6280\u672f\u3002\n\n# *NIX\n\n## unix\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f(IPC)\n\n1. \u7ba1\u9053\uff08Pipe\uff09\uff1a\u7ba1\u9053\u53ef\u7528\u4e8e\u5177\u6709\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\uff0c\u5141\u8bb8\u4e00\u4e2a\u8fdb\u7a0b\u548c\u53e6\u4e00\u4e2a\u4e0e\u5b83\u6709\u5171\u540c\u7956\u5148\u7684\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u3002\n2. \u547d\u540d\u7ba1\u9053\uff08named pipe\uff09\uff1a\u547d\u540d\u7ba1\u9053\u514b\u670d\u4e86\u7ba1\u9053\u6ca1\u6709\u540d\u5b57\u7684\u9650\u5236\uff0c\u56e0\u6b64\uff0c\u9664\u5177\u6709\u7ba1\u9053\u6240\u5177\u6709\u7684\u529f\u80fd\u5916\uff0c\u5b83\u8fd8\u5141\u8bb8\u65e0\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002\u547d\u540d\u7ba1\u9053\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\u3002\u547d\u540d\u7ba1\u9053\u901a\u8fc7\u547d\u4ee4mkfifo\u6216\u7cfb\u7edf\u8c03\u7528mkfifo\u6765\u521b\u5efa\u3002\n3. \u4fe1\u53f7\uff08Signal\uff09\uff1a\u4fe1\u53f7\u662f\u6bd4\u8f83\u590d\u6742\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u7528\u4e8e\u901a\u77e5\u63a5\u53d7\u8fdb\u7a0b\u6709\u67d0\u79cd\u4e8b\u4ef6\u53d1\u751f\uff0c\u9664\u4e86\u7528\u4e8e\u8fdb\u7a0b\u95f4\u901a\u4fe1\u5916\uff0c\u8fdb\u7a0b\u8fd8\u53ef\u4ee5\u53d1\u9001\u4fe1\u53f7\u7ed9\u8fdb\u7a0b\u672c\u8eab\uff1blinux\u9664\u4e86\u652f\u6301Unix\u65e9\u671f\u4fe1\u53f7\u8bed\u4e49\u51fd\u6570sigal\u5916\uff0c\u8fd8\u652f\u6301\u8bed\u4e49\u7b26\u5408Posix.1\u6807\u51c6\u7684\u4fe1\u53f7\u51fd\u6570sigaction\uff08\u5b9e\u9645\u4e0a\uff0c\u8be5\u51fd\u6570\u662f\u57fa\u4e8eBSD\u7684\uff0cBSD\u4e3a\u4e86\u5b9e\u73b0\u53ef\u9760\u4fe1\u53f7\u673a\u5236\uff0c\u53c8\u80fd\u591f\u7edf\u4e00\u5bf9\u5916\u63a5\u53e3\uff0c\u7528sigaction\u51fd\u6570\u91cd\u65b0\u5b9e\u73b0\u4e86signal\u51fd\u6570\uff09\u3002\n4. \u6d88\u606f\uff08Message\uff09\u961f\u5217\uff1a\u6d88\u606f\u961f\u5217\u662f\u6d88\u606f\u7684\u94fe\u63a5\u8868\uff0c\u5305\u62ecPosix\u6d88\u606f\u961f\u5217system V\u6d88\u606f\u961f\u5217\u3002\u6709\u8db3\u591f\u6743\u9650\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5411\u961f\u5217\u4e2d\u6dfb\u52a0\u6d88\u606f\uff0c\u88ab\u8d4b\u4e88\u8bfb\u6743\u9650\u7684\u8fdb\u7a0b\u5219\u53ef\u4ee5\u8bfb\u8d70\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002\u6d88\u606f\u961f\u5217\u514b\u670d\u4e86\u4fe1\u53f7\u627f\u8f7d\u4fe1\u606f\u91cf\u5c11\uff0c\u7ba1\u9053\u53ea\u80fd\u627f\u8f7d\u65e0\u683c\u5f0f\u5b57\u8282\u6d41\u4ee5\u53ca\u7f13\u51b2\u533a\u5927\u5c0f\u53d7\u9650\u7b49\u7f3a\n5. \u5171\u4eab\u5185\u5b58\uff1a\u4f7f\u5f97\u591a\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u540c\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\uff0c\u662f\u6700\u5feb\u7684\u53ef\u7528IPC\u5f62\u5f0f\u3002\u662f\u9488\u5bf9\u5176\u4ed6\u901a\u4fe1\u673a\u5236\u8fd0\u884c\u6548\u7387\u8f83\u4f4e\u800c\u8bbe\u8ba1\u7684\u3002\u5f80\u5f80\u4e0e\u5176\u5b83\u901a\u4fe1\u673a\u5236\uff0c\u5982\u4fe1\u53f7\u91cf\u7ed3\u5408\u4f7f\u7528\uff0c\u6765\u8fbe\u5230\u8fdb\u7a0b\u95f4\u7684\u540c\u6b65\u53ca\u4e92\u65a5\u3002\n6. \u5185\u5b58\u6620\u5c04\uff08mapped memory\uff09\uff1a\u5185\u5b58\u6620\u5c04\u5141\u8bb8\u4efb\u4f55\u591a\u4e2a\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u6bcf\u4e00\u4e2a\u4f7f\u7528\u8be5\u673a\u5236\u7684\u8fdb\u7a0b\u901a\u8fc7\u628a\u4e00\u4e2a\u5171\u4eab\u7684\u6587\u4ef6\u6620\u5c04\u5230\u81ea\u5df1\u7684\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\u6765\u5b9e\u73b0\u5b83\u3002\n7. \u4fe1\u53f7\u91cf\uff08semaphore\uff09\uff1a\u4e3b\u8981\u4f5c\u4e3a\u8fdb\u7a0b\u95f4\u4ee5\u53ca\u540c\u4e00\u8fdb\u7a0b\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\u624b\u6bb5\u3002\n8. \u5957\u63a5\u53e3\uff08Socket\uff09\uff1a\u66f4\u4e3a\u4e00\u822c\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff0c\u53ef\u7528\u4e8e\u4e0d\u540c\u673a\u5668\u4e4b\u95f4\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u8d77\u521d\u662f\u7531Unix\u7cfb\u7edf\u7684BSD\u5206\u652f\u5f00\u53d1\u51fa\u6765\u7684\uff0c\u4f46\u73b0\u5728\u4e00\u822c\u53ef\u4ee5\u79fb\u690d\u5230\u5176\u5b83\u7c7bUnix\u7cfb\u7edf\u4e0a\uff1aLinux\u548cSystem V\u7684\u53d8\u79cd\u90fd\u652f\u6301\u5957\u63a5\u5b57\u3002\n\n\n# \u6570\u636e\u7ed3\u6784\n\n## 1 \u7ea2\u9ed1\u6811\n\n\u7ea2\u9ed1\u6811\u4e0eAVL\u7684\u6bd4\u8f83\uff1a\n\nAVL\u662f\u4e25\u683c\u5e73\u8861\u6811\uff0c\u56e0\u6b64\u5728\u589e\u52a0\u6216\u8005\u5220\u9664\u8282\u70b9\u7684\u65f6\u5019\uff0c\u6839\u636e\u4e0d\u540c\u60c5\u51b5\uff0c\u65cb\u8f6c\u7684\u6b21\u6570\u6bd4\u7ea2\u9ed1\u6811\u8981\u591a\uff1b\n\n\u7ea2\u9ed1\u662f\u7528\u975e\u4e25\u683c\u7684\u5e73\u8861\u6765\u6362\u53d6\u589e\u5220\u8282\u70b9\u65f6\u5019\u65cb\u8f6c\u6b21\u6570\u7684\u964d\u4f4e\uff1b\n\n\u6240\u4ee5\u7b80\u5355\u8bf4\uff0c\u5982\u679c\u4f60\u7684\u5e94\u7528\u4e2d\uff0c\u641c\u7d22\u7684\u6b21\u6570\u8fdc\u8fdc\u5927\u4e8e\u63d2\u5165\u548c\u5220\u9664\uff0c\u90a3\u4e48\u9009\u62e9AVL\uff0c\u5982\u679c\u641c\u7d22\uff0c\u63d2\u5165\u5220\u9664\u6b21\u6570\u51e0\u4e4e\u5dee\u4e0d\u591a\uff0c\u5e94\u8be5\u9009\u62e9RB\u3002\n\n\u7ea2\u9ed1\u6811\u8be6\u89e3: https://xieguanglei.github.io/blog/post/red-black-tree.html\n\n\u6559\u4f60\u900f\u5f7b\u4e86\u89e3\u7ea2\u9ed1\u6811: https://github.com/julycoding/The-Art-Of-Programming-By-July/blob/master/ebook/zh/03.01.md\n\n# \u7f16\u7a0b\u9898\n\n## 1 \u53f0\u9636\u95ee\u9898/\u6590\u6ce2\u90a3\u5951\n\n\u4e00\u53ea\u9752\u86d9\u4e00\u6b21\u53ef\u4ee5\u8df3\u4e0a1\u7ea7\u53f0\u9636\uff0c\u4e5f\u53ef\u4ee5\u8df3\u4e0a2\u7ea7\u3002\u6c42\u8be5\u9752\u86d9\u8df3\u4e0a\u4e00\u4e2an\u7ea7\u7684\u53f0\u9636\u603b\u5171\u6709\u591a\u5c11\u79cd\u8df3\u6cd5\u3002\n\n```python\nfib = lambda n: n if n <= 2 else fib(n - 1) + fib(n - 2)\n```\n\n\u7b2c\u4e8c\u79cd\u8bb0\u5fc6\u65b9\u6cd5\n\n```python\ndef memo(func):\n    cache = {}\n    def wrap(*args):\n        if args not in cache:\n            cache[args] = func(*args)\n        return cache[args]\n    return wrap\n\n\n@memo\ndef fib(i):\n    if i < 2:\n        return 1\n    return fib(i-1) + fib(i-2)\n```\n\n\u7b2c\u4e09\u79cd\u65b9\u6cd5\n\n```python\ndef fib(n):\n    a, b = 0, 1\n    for _ in xrange(n):\n        a, b = b, a + b\n    return b\n```\n\n## 2 \u53d8\u6001\u53f0\u9636\u95ee\u9898\n\n\u4e00\u53ea\u9752\u86d9\u4e00\u6b21\u53ef\u4ee5\u8df3\u4e0a1\u7ea7\u53f0\u9636\uff0c\u4e5f\u53ef\u4ee5\u8df3\u4e0a2\u7ea7\u2026\u2026\u5b83\u4e5f\u53ef\u4ee5\u8df3\u4e0an\u7ea7\u3002\u6c42\u8be5\u9752\u86d9\u8df3\u4e0a\u4e00\u4e2an\u7ea7\u7684\u53f0\u9636\u603b\u5171\u6709\u591a\u5c11\u79cd\u8df3\u6cd5\u3002\n\n```python\nfib = lambda n: n if n < 2 else 2 * fib(n - 1)\n```\n\n## 3 \u77e9\u5f62\u8986\u76d6\n\n\u6211\u4eec\u53ef\u4ee5\u7528`2*1`\u7684\u5c0f\u77e9\u5f62\u6a2a\u7740\u6216\u8005\u7ad6\u7740\u53bb\u8986\u76d6\u66f4\u5927\u7684\u77e9\u5f62\u3002\u8bf7\u95ee\u7528n\u4e2a`2*1`\u7684\u5c0f\u77e9\u5f62\u65e0\u91cd\u53e0\u5730\u8986\u76d6\u4e00\u4e2a`2*n`\u7684\u5927\u77e9\u5f62\uff0c\u603b\u5171\u6709\u591a\u5c11\u79cd\u65b9\u6cd5\uff1f\n\n>\u7b2c`2*n`\u4e2a\u77e9\u5f62\u7684\u8986\u76d6\u65b9\u6cd5\u7b49\u4e8e\u7b2c`2*(n-1)`\u52a0\u4e0a\u7b2c`2*(n-2)`\u7684\u65b9\u6cd5\u3002\n\n```python\nf = lambda n: 1 if n < 2 else f(n - 1) + f(n - 2)\n```\n\n## 4 \u6768\u6c0f\u77e9\u9635\u67e5\u627e\n\n\u5728\u4e00\u4e2am\u884cn\u5217\u4e8c\u7ef4\u6570\u7ec4\u4e2d\uff0c\u6bcf\u4e00\u884c\u90fd\u6309\u7167\u4ece\u5de6\u5230\u53f3\u9012\u589e\u7684\u987a\u5e8f\u6392\u5e8f\uff0c\u6bcf\u4e00\u5217\u90fd\u6309\u7167\u4ece\u4e0a\u5230\u4e0b\u9012\u589e\u7684\u987a\u5e8f\u6392\u5e8f\u3002\u8bf7\u5b8c\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u8f93\u5165\u8fd9\u6837\u7684\u4e00\u4e2a\u4e8c\u7ef4\u6570\u7ec4\u548c\u4e00\u4e2a\u6574\u6570\uff0c\u5224\u65ad\u6570\u7ec4\u4e2d\u662f\u5426\u542b\u6709\u8be5\u6574\u6570\u3002\n\n\u4f7f\u7528Step-wise\u7ebf\u6027\u641c\u7d22\u3002\n\n```python\ndef get_value(l, r, c):\n    return l[r][c]\n\ndef find(l, x):\n    m = len(l) - 1\n    n = len(l[0]) - 1\n    r = 0\n    c = n\n    while c >= 0 and r <= m:\n        value = get_value(l, r, c)\n        if value == x:\n            return True\n        elif value > x:\n            c = c - 1\n        elif value < x:\n            r = r + 1\n    return False\n```\n\n## 5 \u53bb\u9664\u5217\u8868\u4e2d\u7684\u91cd\u590d\u5143\u7d20\n\n\u7528\u96c6\u5408\n\n```python\nlist(set(l))\n```\n\n\u7528\u5b57\u5178\n\n```python\nl1 = ['b','c','d','b','c','a','a']\nl2 = {}.fromkeys(l1).keys()\nprint l2\n```\n\n\u7528\u5b57\u5178\u5e76\u4fdd\u6301\u987a\u5e8f\n\n```python\nl1 = ['b','c','d','b','c','a','a']\nl2 = list(set(l1))\nl2.sort(key=l1.index)\nprint l2\n```\n\n\u5217\u8868\u63a8\u5bfc\u5f0f\n\n```python\nl1 = ['b','c','d','b','c','a','a']\nl2 = []\n[l2.append(i) for i in l1 if not i in l2]\n```\n\nsorted\u6392\u5e8f\u5e76\u4e14\u7528\u5217\u8868\u63a8\u5bfc\u5f0f.\n\nl = ['b','c','d','b','c','a','a']\n[single.append(i) for i in sorted(l) if i not in single]\nprint single\n\n## 6 \u94fe\u8868\u6210\u5bf9\u8c03\u6362\n\n`1->2->3->4`\u8f6c\u6362\u6210`2->1->4->3`.\n\n```python\nclass ListNode:\n    def __init__(self, x):\n        self.val = x\n        self.next = None\n\nclass Solution:\n    # @param a ListNode\n    # @return a ListNode\n    def swapPairs(self, head):\n        if head != None and head.next != None:\n            next = head.next\n            head.next = self.swapPairs(next.next)\n            next.next = head\n            return next\n        return head\n```\n\n## 7 \u521b\u5efa\u5b57\u5178\u7684\u65b9\u6cd5\n\n### 1 \u76f4\u63a5\u521b\u5efa\n\n```python\ndict = {'name':'earth', 'port':'80'}\n```\n\n### 2 \u5de5\u5382\u65b9\u6cd5\n\n```python\nitems=[('name','earth'),('port','80')]\ndict2=dict(items)\ndict1=dict((['name','earth'],['port','80']))\n```\n\n### 3 fromkeys()\u65b9\u6cd5\n\n```python\ndict1={}.fromkeys(('x','y'),-1)\ndict={'x':-1,'y':-1}\ndict2={}.fromkeys(('x','y'))\ndict2={'x':None, 'y':None}\n```\n\n## 8 \u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u5217\u8868\n\n\u77e5\u4e4e\u8fdc\u7a0b\u9762\u8bd5\u8981\u6c42\u7f16\u7a0b\n\n>  \u5c3e\u9012\u5f52\n\n```python\ndef _recursion_merge_sort2(l1, l2, tmp):\n    if len(l1) == 0 or len(l2) == 0:\n        tmp.extend(l1)\n        tmp.extend(l2)\n        return tmp\n    else:\n        if l1[0] < l2[0]:\n            tmp.append(l1[0])\n            del l1[0]\n        else:\n            tmp.append(l2[0])\n            del l2[0]\n        return _recursion_merge_sort2(l1, l2, tmp)\n\ndef recursion_merge_sort2(l1, l2):\n    return _recursion_merge_sort2(l1, l2, [])\n```\n\n>  \u5faa\u73af\u7b97\u6cd5\n\n\u601d\u8def\uff1a\n\n\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u7a7a\u5217\u8868\n\n\u6bd4\u8f83\u4e24\u4e2a\u5217\u8868\u7684\u9996\u4e2a\u5143\u7d20\n\n\u5c0f\u7684\u5c31\u63d2\u5165\u5230\u65b0\u5217\u8868\u91cc\n\n\u628a\u5df2\u7ecf\u63d2\u5165\u65b0\u5217\u8868\u7684\u5143\u7d20\u4ece\u65e7\u5217\u8868\u5220\u9664\n\n\u76f4\u5230\u4e24\u4e2a\u65e7\u5217\u8868\u6709\u4e00\u4e2a\u4e3a\u7a7a\n\n\u518d\u628a\u65e7\u5217\u8868\u52a0\u5230\u65b0\u5217\u8868\u540e\u9762\n\n\n```pyhton\ndef loop_merge_sort(l1, l2):\n    tmp = []\n    while len(l1) > 0 and len(l2) > 0:\n        if l1[0] < l2[0]:\n            tmp.append(l1[0])\n            del l1[0]\n        else:\n            tmp.append(l2[0])\n            del l2[0]\n    tmp.extend(l1)\n    tmp.extend(l2)\n    return tmp\n```\n\n\n> pop\u5f39\u51fa\n\n```Python\na = [1,2,3,7]\nb = [3,4,5]\n\ndef merge_sortedlist(a,b):\n    c = []\n    while a and b:\n        if a[0] >= b[0]:\n            c.append(b.pop(0))\n        else:\n            c.append(a.pop(0))\n    while a:\n        c.append(a.pop(0))\n    while b:\n        c.append(b.pop(0))\n    return c\nprint merge_sortedlist(a,b)\n    \n```\n\n\n## 9 \u4ea4\u53c9\u94fe\u8868\u6c42\u4ea4\u70b9\n\n> \u5176\u5b9e\u601d\u60f3\u53ef\u4ee5\u6309\u7167\u4ece\u5c3e\u5f00\u59cb\u6bd4\u8f83\u4e24\u4e2a\u94fe\u8868\uff0c\u5982\u679c\u76f8\u4ea4\uff0c\u5219\u4ece\u5c3e\u5f00\u59cb\u5fc5\u7136\u4e00\u81f4\uff0c\u53ea\u8981\u4ece\u5c3e\u5f00\u59cb\u6bd4\u8f83\uff0c\u76f4\u81f3\u4e0d\u4e00\u81f4\u7684\u5730\u65b9\u5373\u4e3a\u4ea4\u53c9\u70b9\n\n```python\n# \u4f7f\u7528a,b\u4e24\u4e2alist\u6765\u6a21\u62df\u94fe\u8868\uff0c\u53ef\u4ee5\u770b\u51fa\u4ea4\u53c9\u70b9\u662f 7\u8fd9\u4e2a\u8282\u70b9\na = [1,2,3,7,9,1,5]\nb = [4,5,7,9,1,5]\n\nfor i in range(1,min(len(a),len(b))):\n    if i==1 and (a[-1] != b[-1]):\n        print \"No\"\n        break\n    else:\n        if a[-i] != b[-i]:\n            print \"\u4ea4\u53c9\u8282\u70b9\uff1a\",a[-i+1]\n            break\n        else:\n            pass\n```\n\n> \u53e6\u5916\u4e00\u79cd\u6bd4\u8f83\u6b63\u89c4\u7684\u65b9\u6cd5\uff0c\u6784\u9020\u94fe\u8868\u7c7b\n\n```python\nclass ListNode:\n    def __init__(self, x):\n        self.val = x\n        self.next = None\ndef node(l1, l2):\n    length1, lenth2 = 0, 0\n    # \u6c42\u4e24\u4e2a\u94fe\u8868\u957f\u5ea6\n    while l1.next:\n        l1 = l1.next\n        length1 += 1\n    while l2.next:\n        l2 = l2.next\n        length2 += 1\n    # \u957f\u7684\u94fe\u8868\u5148\u8d70\n    if length1 > lenth2:\n        for _ in range(length1 - length2):\n            l1 = l1.next\n    else:\n        for _ in range(length2 - length1):\n            l2 = l2.next\n    while l1 and l2:\n        if l1.next == l2.next:\n            return l1.next\n        else:\n            l1 = l1.next\n            l2 = l2.next\n```\n\n\u4fee\u6539\u4e86\u4e00\u4e0b:\n\n\n```python\n#coding:utf-8\nclass ListNode:\n    def __init__(self, x):\n        self.val = x\n        self.next = None\n\ndef node(l1, l2):\n    length1, length2 = 0, 0\n    # \u6c42\u4e24\u4e2a\u94fe\u8868\u957f\u5ea6\n    while l1.next:\n        l1 = l1.next#\u5c3e\u8282\u70b9\n        length1 += 1\n    while l2.next:\n        l2 = l2.next#\u5c3e\u8282\u70b9\n        length2 += 1\n\n    #\u5982\u679c\u76f8\u4ea4\n    if l1.next == l2.next:\n        # \u957f\u7684\u94fe\u8868\u5148\u8d70\n        if length1 > length2:\n            for _ in range(length1 - length2):\n                l1 = l1.next\n            return l1#\u8fd4\u56de\u4ea4\u70b9\n        else:\n            for _ in range(length2 - length1):\n                l2 = l2.next\n            return l2#\u8fd4\u56de\u4ea4\u70b9\n    # \u5982\u679c\u4e0d\u76f8\u4ea4\n    else:\n        return\n```\n\n\n\u601d\u8def: http://humaoli.blog.163.com/blog/static/13346651820141125102125995/\n\n\n## 10 \u4e8c\u5206\u67e5\u627e\n\n\n```python\n\n#coding:utf-8\ndef binary_search(list, item):\n    low = 0\n    high = len(list) - 1\n    while low <= high:\n        mid = (high - low) / 2 + low    # \u907f\u514d(high + low) / 2\u6ea2\u51fa\n        guess = list[mid]\n        if guess > item:\n            high = mid - 1\n        elif guess < item:\n            low = mid + 1\n        else:\n            return mid\n    return None\nmylist = [1,3,5,7,9]\nprint binary_search(mylist, 3)\n\n```\n\n\u53c2\u8003: http://blog.csdn.net/u013205877/article/details/76411718\n\n## 11 \u5feb\u6392\n\n```python\n#coding:utf-8\ndef quicksort(list):\n    if len(list)<2:\n        return list\n    else:\n        midpivot = list[0]\n        lessbeforemidpivot = [i for i in list[1:] if i<=midpivot]\n        biggerafterpivot = [i for i in list[1:] if i > midpivot]\n        finallylist = quicksort(lessbeforemidpivot)+[midpivot]+quicksort(biggerafterpivot)\n        return finallylist\n\nprint quicksort([2,4,6,7,1,2,5])\n```\n\n\n>  \u66f4\u591a\u6392\u5e8f\u95ee\u9898\u53ef\u89c1\uff1a[\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5-\u6392\u5e8f\u7bc7-Python\u63cf\u8ff0](http://blog.csdn.net/mrlevo520/article/details/77829204)\n\n\n## 12 \u627e\u96f6\u95ee\u9898\n\n\n```python\n\n#coding:utf-8\n#values\u662f\u786c\u5e01\u7684\u9762\u503cvalues = [ 25, 21, 10, 5, 1]\n#valuesCounts   \u94b1\u5e01\u5bf9\u5e94\u7684\u79cd\u7c7b\u6570\n#money  \u627e\u51fa\u6765\u7684\u603b\u94b1\u6570\n#coinsUsed   \u5bf9\u5e94\u4e8e\u76ee\u524d\u94b1\u5e01\u603b\u6570i\u6240\u4f7f\u7528\u7684\u786c\u5e01\u6570\u76ee\n\ndef coinChange(values,valuesCounts,money,coinsUsed):\n    #\u904d\u5386\u51fa\u4ece1\u5230money\u6240\u6709\u7684\u94b1\u6570\u53ef\u80fd\n    for cents in range(1,money+1):\n        minCoins = cents\n        #\u628a\u6240\u6709\u7684\u786c\u5e01\u9762\u503c\u904d\u5386\u51fa\u6765\u548c\u94b1\u6570\u505a\u5bf9\u6bd4\n        for kind in range(0,valuesCounts):\n            if (values[kind] <= cents):\n                temp = coinsUsed[cents - values[kind]] +1\n                if (temp < minCoins):\n                    minCoins = temp\n        coinsUsed[cents] = minCoins\n        print ('\u9762\u503c:{0}\u7684\u6700\u5c11\u786c\u5e01\u4f7f\u7528\u6570\u4e3a:{1}'.format(cents, coinsUsed[cents]))\n\n```\n\n\u601d\u8def: http://blog.csdn.net/wdxin1322/article/details/9501163\n\n\u65b9\u6cd5: http://www.cnblogs.com/ChenxofHit/archive/2011/03/18/1988431.html\n\n## 13 \u5e7f\u5ea6\u904d\u5386\u548c\u6df1\u5ea6\u904d\u5386\u4e8c\u53c9\u6811\n\n\u7ed9\u5b9a\u4e00\u4e2a\u6570\u7ec4\uff0c\u6784\u5efa\u4e8c\u53c9\u6811\uff0c\u5e76\u4e14\u6309\u5c42\u6b21\u6253\u5370\u8fd9\u4e2a\u4e8c\u53c9\u6811\n\n\n## 14 \u4e8c\u53c9\u6811\u8282\u70b9\n\n```python\n\nclass Node(object):\n    def __init__(self, data, left=None, right=None):\n        self.data = data\n        self.left = left\n        self.right = right\n\ntree = Node(1, Node(3, Node(7, Node(0)), Node(6)), Node(2, Node(5), Node(4)))\n\n```\n\n## 15 \u5c42\u6b21\u904d\u5386\n\n```python\n\ndef lookup(root):\n    row = [root]\n    while row:\n \u00a0 \u00a0 \u00a0 \u00a0print(row)\n \u00a0 \u00a0 \u00a0 \u00a0row = [kid for item in row for kid in (item.left, item.right) if kid]\n\n```\n\n## 16 \u6df1\u5ea6\u904d\u5386\n\n```python\n\ndef deep(root):\n    if not root:\n        return\n    print root.data\n    deep(root.left)\n    deep(root.right)\n\nif __name__ == '__main__':\n    lookup(tree)\n    deep(tree)\n```\n\n## 17 \u524d\u4e2d\u540e\u5e8f\u904d\u5386\n\n\u6df1\u5ea6\u904d\u5386\u6539\u53d8\u987a\u5e8f\u5c31OK\u4e86\n\n```python\n\n#coding:utf-8\n#\u4e8c\u53c9\u6811\u7684\u904d\u5386\n#\u7b80\u5355\u7684\u4e8c\u53c9\u6811\u8282\u70b9\u7c7b\nclass Node(object):\n    def __init__(self,value,left,right):\n        self.value = value\n        self.left = left\n        self.right = right\n\n#\u4e2d\u5e8f\u904d\u5386:\u904d\u5386\u5de6\u5b50\u6811,\u8bbf\u95ee\u5f53\u524d\u8282\u70b9,\u904d\u5386\u53f3\u5b50\u6811\n\ndef mid_travelsal(root):\n    if root.left is not None:\n        mid_travelsal(root.left)\n    #\u8bbf\u95ee\u5f53\u524d\u8282\u70b9\n    print(root.value)\n    if root.right is not None:\n        mid_travelsal(root.right)\n\n#\u524d\u5e8f\u904d\u5386:\u8bbf\u95ee\u5f53\u524d\u8282\u70b9,\u904d\u5386\u5de6\u5b50\u6811,\u904d\u5386\u53f3\u5b50\u6811\n\ndef pre_travelsal(root):\n    print (root.value)\n    if root.left is not None:\n        pre_travelsal(root.left)\n    if root.right is not None:\n        pre_travelsal(root.right)\n\n#\u540e\u7eed\u904d\u5386:\u904d\u5386\u5de6\u5b50\u6811,\u904d\u5386\u53f3\u5b50\u6811,\u8bbf\u95ee\u5f53\u524d\u8282\u70b9\n\ndef post_trvelsal(root):\n    if root.left is not None:\n        post_trvelsal(root.left)\n    if root.right is not None:\n        post_trvelsal(root.right)\n    print (root.value)\n\n```\n\n## 18 \u6c42\u6700\u5927\u6811\u6df1\n\n```python\ndef maxDepth(root):\n        if not root:\n            return 0\n        return max(maxDepth(root.left), maxDepth(root.right)) + 1\n```\n\n## 19 \u6c42\u4e24\u68f5\u6811\u662f\u5426\u76f8\u540c\n\n```python\ndef isSameTree(p, q):\n    if p == None and q == None:\n        return True\n    elif p and q :\n        return p.val == q.val and isSameTree(p.left,q.left) and isSameTree(p.right,q.right)\n    else :\n        return False\n```\n\n## 20 \u524d\u5e8f\u4e2d\u5e8f\u6c42\u540e\u5e8f\n\n\u63a8\u8350: http://blog.csdn.net/hinyunsin/article/details/6315502\n\n```python\ndef rebuild(pre, center):\n    if not pre:\n        return\n    cur = Node(pre[0])\n    index = center.index(pre[0])\n    cur.left = rebuild(pre[1:index + 1], center[:index])\n    cur.right = rebuild(pre[index + 1:], center[index + 1:])\n    return cur\n\ndef deep(root):\n    if not root:\n        return\n    deep(root.left)\n    deep(root.right)\n    print root.data\n```\n\n## 21 \u5355\u94fe\u8868\u9006\u7f6e\n\n```python\nclass Node(object):\n    def __init__(self, data=None, next=None):\n        self.data = data\n        self.next = next\n\nlink = Node(1, Node(2, Node(3, Node(4, Node(5, Node(6, Node(7, Node(8, Node(9)))))))))\n\ndef rev(link):\n    pre = link\n    cur = link.next\n    pre.next = None\n    while cur:\n        tmp = cur.next\n        cur.next = pre\n        pre = cur\n        cur = tmp\n    return pre\n\nroot = rev(link)\nwhile root:\n    print root.data\n    root = root.next\n```\n\n\u601d\u8def: http://blog.csdn.net/feliciafay/article/details/6841115\n\n\u65b9\u6cd5: http://www.xuebuyuan.com/2066385.html?mobile=1\n\n\n## 22 \u4e24\u4e2a\u5b57\u7b26\u4e32\u662f\u5426\u662f\u53d8\u4f4d\u8bcd\n\n```python\nclass Anagram:\n    \"\"\"\n    @:param s1: The first string\n    @:param s2: The second string\n    @:return true or false\n    \"\"\"\n    def Solution1(s1,s2):\n        alist = list(s2)\n\n        pos1 = 0\n        stillOK = True\n\n        while pos1 < len(s1) and stillOK:\n            pos2 = 0\n            found = False\n            while pos2 < len(alist) and not found:\n                if s1[pos1] == alist[pos2]:\n                    found = True\n                else:\n                    pos2 = pos2 + 1\n\n            if found:\n                alist[pos2] = None\n            else:\n                stillOK = False\n\n            pos1 = pos1 + 1\n\n        return stillOK\n\n    print(Solution1('abcd','dcba'))\n\n    def Solution2(s1,s2):\n        alist1 = list(s1)\n        alist2 = list(s2)\n\n        alist1.sort()\n        alist2.sort()\n\n\n        pos = 0\n        matches = True\n\n        while pos < len(s1) and matches:\n            if alist1[pos] == alist2[pos]:\n                pos = pos + 1\n            else:\n                matches = False\n\n        return matches\n\n    print(Solution2('abcde','edcbg'))\n\n    def Solution3(s1,s2):\n        c1 = [0]*26\n        c2 = [0]*26\n\n        for i in range(len(s1)):\n            pos = ord(s1[i])-ord('a')\n            c1[pos] = c1[pos] + 1\n\n        for i in range(len(s2)):\n            pos = ord(s2[i])-ord('a')\n            c2[pos] = c2[pos] + 1\n\n        j = 0\n        stillOK = True\n        while j<26 and stillOK:\n            if c1[j] == c2[j]:\n                j = j + 1\n            else:\n                stillOK = False\n\n        return stillOK\n\n    print(Solution3('apple','pleap'))\n```\n\n\n\n\n## 23 \u52a8\u6001\u89c4\u5212\u95ee\u9898\n\n>  \u53ef\u53c2\u8003\uff1a[\u52a8\u6001\u89c4\u5212(DP)\u7684\u6574\u7406-Python\u63cf\u8ff0](http://blog.csdn.net/mrlevo520/article/details/75676160)", "excerpt": "\u76ee\u5f55Python\u8bed\u8a00\u7279\u60271 Python\u7684\u51fd\u6570\u53c2\u6570\u4f20\u90122 Python\u4e2d\u7684\u5143\u7c7b(metaclass)3 @staticmethod\u548c@classmethod4 \u7c7b\u53d8\u91cf\u548c\u5b9e\u4f8b\u53d8\u91cf5 Python\u81ea\u77016 \u5b57\u5178\u63a8\u5bfc\u5f0f7 Python\u4e2d\u5355\u4e0b\u5212\u7ebf\u548c\u53cc\u4e0b\u5212\u7ebf8 \u5b57\u7b26\u4e32\u683c\u5f0f\u5316:%\u548c.format9 \u8fed\u4ee3\u5668\u548c\u751f\u6210\u5668", "codestyle": "atelier-cave-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-24T18:59:15.661", "mod_date": "2020-02-24T19:00:25.713", "views_count": 13, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 7, "tags": [6]}}, {"model": "blog.post", "pk": 7, "fields": {"title": "windows\u73af\u5883\u5f00\u59cbdjango\u9879\u76ee", "body": "<h2><a id=\"_0\"></a>\u865a\u62df\u73af\u5883\u7ba1\u7406</h2>\n<h3><a id=\"pipenv_1\"></a>\u5b89\u88c5pipenv</h3>\n<blockquote>\n<p>\u7528pipeve\u53d6\u4ee3virtualenv\uff0c\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u7ba1\u7406\u5305\u4f9d\u8d56\u5173\u7cfb\uff0c\u589e\u52a0\u4e86 lock \u6587\u4ef6\uff0c\u80fd\u66f4\u597d\u7684\u9501\u5b9a\u7248\u672c\uff0c<br />\n\u5378\u8f7d\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u81ea\u52a8\u68c0\u67e5\u4f9d\u8d56\u5e93\u662f\u5426\u88ab\u5176\u4ed6\u5305\u4f9d\u8d56\uff0c\u6765\u9009\u62e9\u662f\u5426\u5f7b\u5e95\u5220\u9664\u3002\u3002\u3002</p>\n</blockquote>\n<p><code>pip install pipenv</code></p>\n<h3><a id=\"_9\"></a>\u521d\u59cb\u5316\u865a\u62df\u73af\u5883</h3>\n<pre><code class=\"lang-\"># \u9879\u76ee\u76ee\u5f55\u4e0b(\u5c06\u521b\u5efa\u4e00\u4e2a\u5728Env\u76ee\u5f55\u4e0b\u7684\u7eaf\u51c0\u865a\u62df\u73af\u5883\uff09\npipenv install \n</code></pre>\n<h3><a id=\"pipenv_14\"></a>\u89e3\u51b3pipenv\u5b89\u88c5\u6162\u7684\u95ee\u9898</h3>\n<pre><code class=\"lang-\"># vim Pipfile\nurl = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot;\n</code></pre>\n<h3><a id=\"_20\"></a>\u542f\u52a8\u8fd0\u884c\u865a\u62df\u73af\u5883</h3>\n<pre><code class=\"lang-\"># \u9879\u76ee\u76ee\u5f55\u4e0b\npipenv shell\n</code></pre>\n<h3><a id=\"_26\"></a>\u5b89\u88c5\u4f9d\u8d56\u7684\u5e93</h3>\n<pre><code class=\"lang-\">pipenv install django==1.11.15\n</code></pre>\n<h2><a id=\"_31\"></a>\u7248\u672c\u7ba1\u7406</h2>\n<h3><a id=\"git_32\"></a>\u4f7f\u7528git</h3>\n<blockquote>\n<p>Git\u662f\u76ee\u524d\u4e16\u754c\u4e0a\u6700\u5148\u8fdb\u7684\u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff08\u6ca1\u6709\u4e4b\u4e00\uff09\u3002</p>\n</blockquote>\n<h3><a id=\"_34\"></a>\u672c\u5730\u521d\u59cb\u5316</h3>\n<pre><code class=\"lang-\"># \u9879\u76ee\u6839\u76ee\u5f55\u4e0b(\u521d\u59cb\u5316init\u73af\u5883) \ngit init \n</code></pre>\n<h3><a id=\"_39\"></a>\u8fdc\u7a0b\u7aef\u521b\u5efa\u4ed3\u5e93</h3>\n<blockquote>\n<p>github\u5b98\u7f51\u521b\u5efa\u4e00\u4e2arepository</p>\n</blockquote>\n<h3><a id=\"_41\"></a>\u672c\u5730\u8fde\u63a5\u8fdc\u7a0b\u5e76\u62c9\u53d6\u8fdc\u7a0b\u5e93</h3>\n<pre><code class=\"lang-\">git remote add origin git@github.com:heping945/blogbackend.git\ngit pull origin master --allow-unrelated-histories\n</code></pre>\n<p>\u6b64\u65f6\u672c\u5730\u9879\u76ee\u548c\u8fdc\u7a0b\u4f1a\u521b\u7acb\u8fde\u63a5</p>\n<h3><a id=\"_48\"></a>\u63d0\u4ea4\u4ee3\u7801\u66f4\u65b0\u5230\u8fdc\u7a0b</h3>\n<pre><code class=\"lang-\">git add .\ngit commit -m 'init'\ngit push origin master\n</code></pre>\n<h3><a id=\"git_54\"></a>git\u4f7f\u7528\u2461</h3>\n<h4><a id=\"clone_55\"></a>\u8fdc\u7a0b\u76f4\u63a5\u521b\u5efa\u4ed3\u5e93\u672c\u5730clone</h4>\n<pre><code class=\"lang-\">git clone '\u8fdc\u7a0b\u4ed3\u5e93\u5730\u5740'\n#\u7136\u540e\u672c\u5730\u4fee\u6539\uff0c\u672c\u5730push\ngit push\n</code></pre>\n<h2><a id=\"_62\"></a>\u5b89\u88c5\u672c\u5730\u5e93</h2>\n<pre><code class=\"lang-\">pipenv install djangorestframework\npipenv install django-filter\npipenv install django-cors-headers\npipenv install django-ckeditor\npipenv install social-auth-app-django\npipenv install djangorestframework-jwt\npipenv install django-redis\npipenv install drf-extensions\n\npipenv install pymysql\npipenv install unidecode\npipenv install coreapi\npipenv install Pillow\n\n</code></pre>", "body_md": "## \u865a\u62df\u73af\u5883\u7ba1\u7406\n### \u5b89\u88c5pipenv\n> \u7528pipeve\u53d6\u4ee3virtualenv\uff0c\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u7ba1\u7406\u5305\u4f9d\u8d56\u5173\u7cfb\uff0c\u589e\u52a0\u4e86 lock \u6587\u4ef6\uff0c\u80fd\u66f4\u597d\u7684\u9501\u5b9a\u7248\u672c\uff0c\n\u5378\u8f7d\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u81ea\u52a8\u68c0\u67e5\u4f9d\u8d56\u5e93\u662f\u5426\u88ab\u5176\u4ed6\u5305\u4f9d\u8d56\uff0c\u6765\u9009\u62e9\u662f\u5426\u5f7b\u5e95\u5220\u9664\u3002\u3002\u3002\n\n`\npip install pipenv\n`\n\n### \u521d\u59cb\u5316\u865a\u62df\u73af\u5883\n```\n# \u9879\u76ee\u76ee\u5f55\u4e0b(\u5c06\u521b\u5efa\u4e00\u4e2a\u5728Env\u76ee\u5f55\u4e0b\u7684\u7eaf\u51c0\u865a\u62df\u73af\u5883\uff09\npipenv install \n```\n### \u89e3\u51b3pipenv\u5b89\u88c5\u6162\u7684\u95ee\u9898\n\n```\n# vim Pipfile\nurl = \"https://pypi.tuna.tsinghua.edu.cn/simple/\"\n```\n### \u542f\u52a8\u8fd0\u884c\u865a\u62df\u73af\u5883\n\n```\n# \u9879\u76ee\u76ee\u5f55\u4e0b\npipenv shell\n```\n### \u5b89\u88c5\u4f9d\u8d56\u7684\u5e93\n```\npipenv install django==1.11.15\n```\n\n## \u7248\u672c\u7ba1\u7406\n### \u4f7f\u7528git\n> Git\u662f\u76ee\u524d\u4e16\u754c\u4e0a\u6700\u5148\u8fdb\u7684\u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff08\u6ca1\u6709\u4e4b\u4e00\uff09\u3002\n### \u672c\u5730\u521d\u59cb\u5316\n```\n# \u9879\u76ee\u6839\u76ee\u5f55\u4e0b(\u521d\u59cb\u5316init\u73af\u5883) \ngit init \n```\n### \u8fdc\u7a0b\u7aef\u521b\u5efa\u4ed3\u5e93\n> github\u5b98\u7f51\u521b\u5efa\u4e00\u4e2arepository\n### \u672c\u5730\u8fde\u63a5\u8fdc\u7a0b\u5e76\u62c9\u53d6\u8fdc\u7a0b\u5e93\n```\ngit remote add origin git@github.com:heping945/blogbackend.git\ngit pull origin master --allow-unrelated-histories\n```\n\u6b64\u65f6\u672c\u5730\u9879\u76ee\u548c\u8fdc\u7a0b\u4f1a\u521b\u7acb\u8fde\u63a5\n\n### \u63d0\u4ea4\u4ee3\u7801\u66f4\u65b0\u5230\u8fdc\u7a0b\n```\ngit add .\ngit commit -m 'init'\ngit push origin master\n```\n### git\u4f7f\u7528\u2461\n#### \u8fdc\u7a0b\u76f4\u63a5\u521b\u5efa\u4ed3\u5e93\u672c\u5730clone\n```\ngit clone '\u8fdc\u7a0b\u4ed3\u5e93\u5730\u5740'\n#\u7136\u540e\u672c\u5730\u4fee\u6539\uff0c\u672c\u5730push\ngit push\n```\n\n## \u5b89\u88c5\u672c\u5730\u5e93\n```\npipenv install djangorestframework\npipenv install django-filter\npipenv install django-cors-headers\npipenv install django-ckeditor\npipenv install social-auth-app-django\npipenv install djangorestframework-jwt\npipenv install django-redis\npipenv install drf-extensions\n\npipenv install pymysql\npipenv install unidecode\npipenv install coreapi\npipenv install Pillow\n\n```", "excerpt": "\u865a\u62df\u73af\u5883\u7ba1\u7406\n\u5b89\u88c5pipenv\n\n\u7528pipeve\u53d6\u4ee3virtualenv\uff0c\u63d0\u4f9b\u66f4\u65b9\u4fbf\u7684\u7ba1\u7406\u5305\u4f9d\u8d56\u5173\u7cfb\uff0c\u589e\u52a0\u4e86 lock \u6587\u4ef6\uff0c\u80fd\u66f4\u597d\u7684\u9501\u5b9a\u7248\u672c\uff0c\n\u5378\u8f7d\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u81ea\u52a8\u68c0\u67e5\u4f9d\u8d56\u5e93\u662f\u5426\u88ab\u5176\u4ed6\u5305\u4f9d\u8d56\uff0c\u6765\u9009\u62e9\u662f\u5426\u5f7b\u5e95\u5220\u9664\u3002\u3002\u3002\n\npip install pipenv\n\u521d\u59cb\u5316\u865a\u62df\u73af\u5883\n# \u9879\u76ee\u76ee\u5f55\u4e0b(\u5c06\u521b\u5efa\u4e00", "codestyle": "gruvbox-dark", "reproduce": false, "reproduce_source": "", "create_date": "2020-02-24T19:02:19.958", "mod_date": "2020-02-24T19:02:19.958", "views_count": 16, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 5, "tags": []}}, {"model": "blog.post", "pk": 8, "fields": {"title": "\u8de8\u57df\u7684\u524d\u540e\u7aef\u914d\u7f6e", "body": "<h2><a id=\"_0\"></a>\u4ec0\u4e48\u662f\u8de8\u57df</h2>\n<p>\u51fa\u4e8e\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\u9650\u5236\u3002\u540c\u6e90\u7b56\u7565\uff08Sameoriginpolicy\uff09\u662f\u4e00\u79cd\u7ea6\u5b9a\uff0c\u5b83\u662f\u6d4f\u89c8\u5668\u6700\u6838\u5fc3\u4e5f\u6700\u57fa\u672c\u7684\u5b89\u5168\u529f\u80fd\uff0c\u5982\u679c\u7f3a\u5c11\u4e86\u540c\u6e90\u7b56\u7565\uff0c\u5219\u6d4f\u89c8\u5668\u7684\u6b63\u5e38\u529f\u80fd\u53ef\u80fd\u90fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u53ef\u4ee5\u8bf4Web\u662f\u6784\u5efa\u5728\u540c\u6e90\u7b56\u7565\u57fa\u7840\u4e4b\u4e0a\u7684\uff0c\u6d4f\u89c8\u5668\u53ea\u662f\u9488\u5bf9\u540c\u6e90\u7b56\u7565\u7684\u4e00\u79cd\u5b9e\u73b0\u3002\u540c\u6e90\u7b56\u7565\u4f1a\u963b\u6b62\u4e00\u4e2a\u57df\u7684javascript\u811a\u672c\u548c\u53e6\u5916\u4e00\u4e2a\u57df\u7684\u5185\u5bb9\u8fdb\u884c\u4ea4\u4e92\u3002\u6240\u8c13\u540c\u6e90\uff08\u5373\u6307\u5728\u540c\u4e00\u4e2a\u57df\uff09\u5c31\u662f\u4e24\u4e2a\u9875\u9762\u5177\u6709\u76f8\u540c\u7684\u534f\u8bae\uff08protocol\uff09\uff0c\u4e3b\u673a\uff08host\uff09\u548c\u7aef\u53e3\u53f7\uff08port\uff09</p>\n<blockquote>\n<p>\u5f88\u660e\u663e\u7684\uff0c\u8de8\u57df\u662f\u6d4f\u89c8\u5668\u7684\u9650\u5236\uff0c\u610f\u5373\u4ee3\u7801\u6587\u4ef6\u5bf9\u63a5\u53e3\u7684\u8bbf\u95ee\uff0c\u662f\u6ca1\u6709\u9650\u5236\u7684\uff0c\u5982requests\uff0caxios\u7684\u8bf7\u6c42\uff0c\u800c\u5f53\u672c\u5730\u5f00\u542f\u63a5\u53e3\u540e\uff0c\u5373\u9700\u8981\u5ba2\u6237\u7aef(\u6d4f\u89c8\u5668)\u8bbf\u95ee\u8def\u7531\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u7684\u76f8\u5173\u9650\u5236\u3002</p>\n</blockquote>\n<h2><a id=\"_4\"></a>\u6211\u6240\u4f7f\u7528\u7684\u8de8\u57df\u7684\u89e3\u51b3</h2>\n<p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u672c\u5730\u5f00\u53d1\u7684\u524d\u540e\u7aef\u9879\u76ee\uff0c\u6211\u90fd\u4e60\u60ef\u5728\u540e\u7aef(django)\u505a\u8de8\u57df\uff0cdjango\u7684\u8de8\u57df\u6bd4\u8f83\u7b80\u5355\uff0c\u7528\u7b2c\u4e09\u65b9\u63d2\u4ef6django-cors-headers\u52a0\u4ee5\u914d\u7f6e\u5c31\u884c\uff0c\u800c\u67d0\u4e9b\u7b80\u5355\u7684\u91c7\u7528\u7b2c\u4e09\u65b9api\u7684vue\u524d\u7aef\u9879\u76ee\uff0c\u5728@vue-cli4\u4e0b\u7684<code>vue.config.js</code>\u505a\u8de8\u57df\u914d\u7f6e</p>\n<h2><a id=\"django_7\"></a>django\u914d\u7f6e</h2>\n<p>CORS \u662f\u8de8\u57df\u8d44\u6e90\u5206\u4eab\uff08Cross-Origin Resource Sharing\uff09\u7684\u7f29\u5199\u3002\u5b83\u662f W3C \u6807\u51c6\uff0c\u5c5e\u4e8e\u8de8\u6e90 AJAX \u8bf7\u6c42\u7684\u6839\u672c\u89e3\u51b3\u65b9\u6cd5</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\">$ pipenv install django-cors-headers    <span class=\"hljs-comment\"># \u5b89\u88c5django-cors-headers</span>\n<span class=\"hljs-comment\"># settings.py</span>\nCORS_ORIGIN_ALLOW_ALL = <span class=\"hljs-keyword\">True</span>  <span class=\"hljs-comment\"># \u65b0\u589e\u7684\u8de8\u57df\u8bbf\u95ee\u8bbe\u7f6e</span>\n\nINSTALLED_APPS = [\n    \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\n    <span class=\"hljs-string\">'corsheaders'</span>,  <span class=\"hljs-comment\"># \u65b0\u52a0\u7684\u5e94\u7528</span>\n]\n\nMIDDLEWARE = [\n    <span class=\"hljs-string\">'django.middleware.security.SecurityMiddleware'</span>,\n    <span class=\"hljs-string\">'django.contrib.sessions.middleware.SessionMiddleware'</span>,\n    <span class=\"hljs-string\">'corsheaders.middleware.CorsMiddleware'</span>,  <span class=\"hljs-comment\"># \u65b0\u52a0\u7684\u4e2d\u95f4\u4ef6(\u4f4d\u7f6e)</span>\n    <span class=\"hljs-string\">'django.middleware.common.CommonMiddleware'</span>,\n]\n</code></div></pre>\n<h2><a id=\"vue_28\"></a>vue\u524d\u7aef\u914d\u7f6e\uff08\u5f00\u53d1\u73af\u5883\uff09</h2>\n<p>\u5f53\u8bbf\u95ee\u7b2c\u4e09\u65b9api\u9700\u8981\u8de8\u57df\u9a8c\u8bc1\u65f6\u9700\u8981\u914d\u7f6e</p>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-comment\">// vue.config.js</span>\n<span class=\"hljs-built_in\">module</span>.exports = {\n    \u2026\u2026\u2026\u2026\u2026\u2026\n    devServer: {\n        <span class=\"hljs-attr\">proxy</span>: {\n            <span class=\"hljs-string\">'/g2/'</span>: { <span class=\"hljs-comment\">// \u4ee5/g2/\u4e3a\u5f00\u5934\u7684\u9002\u5408\u8fd9\u4e2a\u89c4\u5219</span>\n                target: <span class=\"hljs-string\">'https://view.inews.qq.com'</span>,    <span class=\"hljs-comment\">// \u57df\u540d</span>\n                secure: <span class=\"hljs-literal\">true</span>,  <span class=\"hljs-comment\">// \u5982\u679c\u662fhttps\u63a5\u53e3\uff0c\u9700\u8981\u914d\u7f6e\u8fd9\u4e2a\u53c2\u6570</span>\n                changeOrigin: <span class=\"hljs-literal\">true</span>,        <span class=\"hljs-comment\">//\u5f00\u542f</span>\n            },\n        }\n    }\n}\n<span class=\"hljs-comment\">// \u4f7f\u7528</span>\n  <span class=\"hljs-keyword\">async</span> initdata() {\n      <span class=\"hljs-keyword\">let</span> data = <span class=\"hljs-keyword\">await</span> Axios.get(<span class=\"hljs-string\">'g2/getOnsInfo?name=disease_h5'</span>)\n      <span class=\"hljs-built_in\">console</span>.log(data)\n          }\n</code></div></pre>\n<p>\u8bbf\u95ee\uff1a<code>http://localhost:8080/g2/getOnsInfo?name=disease_h5</code> --&gt;<code>https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5</code></p>\n<pre><div class=\"hljs\"><code class=\"lang-js\">\u2026\u2026\n<span class=\"hljs-comment\">// \u522b\u540d(\u5f53\u5f88\u591a\u7b2c\u4e09\u65b9\u63a5\u53e3\u65f6\u53ef\u4ee5\u4efb\u610f\u66f4\u6539)</span>\n<span class=\"hljs-string\">'/api'</span>: {\n       <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">'https://view.inews.qq.com'</span>,\n       <span class=\"hljs-comment\">// ws: true,</span>\n       secure: <span class=\"hljs-literal\">true</span>,  <span class=\"hljs-comment\">// \u5982\u679c\u662fhttps\u63a5\u53e3\uff0c\u9700\u8981\u914d\u7f6e\u8fd9\u4e2a\u53c2\u6570</span>\n       changeOrigin: <span class=\"hljs-literal\">true</span>,\n       <span class=\"hljs-string\">\"pathRewrite\"</span>: {<span class=\"hljs-comment\">//\u8def\u5f84\u6539\u5199\u89c4\u5219</span>\n       <span class=\"hljs-string\">\"^/api\"</span>: <span class=\"hljs-string\">\"g2\"</span><span class=\"hljs-comment\">//\u4ee5/proxy/\u4e3a\u5f00\u5934\u7684\u6539\u5199\u4e3a''</span>\n         },\n   },\n</code></div></pre>\n<p>\u8bbf\u95ee\uff1a<code>http://localhost:8080/api/getOnsInfo?name=disease_h5</code> --&gt;<code>https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5</code></p>\n<h2><a id=\"cdn_67\"></a>cdn\u7f51\u7ad9\u5f15\u7528\u7684\u5f3a\u8feb\u75c7\u89e3\u51b3</h2>\n<p>chrome\u6d4f\u89c8\u5668\u51fa\u73b0warning\u63d0\u793a\uff1a</p>\n<pre><code class=\"lang-\">A cookie associated with a cross-site resource at http://v3.bootcss.com/ was set without the `SameSite` attribute. A future release of Chrome will only deliver cookies with cross-site requests if they are set with `SameSite=None` and `Secure`. You can review cookies in developer tools under Application&gt;Storage&gt;Cookies and see more details at https://www.chromestatus.com/feature/5088147346030592 and https://www.chromestatus.com/feature/5633521622188032.\n</code></pre>\n<p>\u524d\u7aef\u5f00\u53d1\u9879\u76ee\u65f6\uff0c\u5f15\u7528cdn\u7f51\u7ad9\u7684js\u6587\u4ef6\u7684\u63d0\u793a\uff0c\u662fchrome\u51fa\u73b0\u7684\u8de8\u57df\u63d0\u793a\uff0c\u8868\u793a\u5bf9\u5f53\u524d\u57df\u540d\u7684\u5f15\u7528\u51fa\u73b0\u4e86\u8de8\u57df(\u8bf7\u6c42\u5934(<code>Sec-Fetch-Site: cross-site</code>))<br />\n\u6b64\u65f6\u53ef\u4ee5\u5982\u4e0b\u914d\u7f6e(\u672c\u5730\u5f00\u542f\u865a\u62df\u670d\u52a1\u5668\u8bbf\u95ee\uff0c\u4f1a\u964d\u4f4e\u901f\u5ea6)\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-comment\">//vue.config.js</span>\n  <span class=\"hljs-string\">'/re'</span>: {\n       <span class=\"hljs-attr\">target</span>: <span class=\"hljs-string\">'https://cdn.bootcss.com'</span>,\n       <span class=\"hljs-attr\">secure</span>: <span class=\"hljs-literal\">true</span>,  <span class=\"hljs-comment\">// \u5982\u679c\u662fhttps\u63a5\u53e3\uff0c\u9700\u8981\u914d\u7f6e\u8fd9\u4e2a\u53c2\u6570</span>\n       ws: <span class=\"hljs-literal\">true</span>,\n       <span class=\"hljs-attr\">changeOrigin</span>: <span class=\"hljs-literal\">true</span>,\n       <span class=\"hljs-string\">\"pathRewrite\"</span>: {<span class=\"hljs-comment\">//\u8def\u5f84\u6539\u5199\u89c4\u5219</span>\n       <span class=\"hljs-string\">\"^/re\"</span>: <span class=\"hljs-string\">\"\"</span><span class=\"hljs-comment\">//\u4ee5/proxy/\u4e3a\u5f00\u5934\u7684\u6539\u5199\u4e3a''</span>\n       },\n}\n</code></div></pre>\n<p>\u4f7f\u7528</p>\n<pre><div class=\"hljs\"><code class=\"lang-html\">// index.html\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"re/axios/0.19.0/axios.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"re/echarts/4.3.0/echarts.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></div></pre>\n<p>\u5b9e\u9645\u4f7f\u7528\uff0c\u4f1a\u5927\u5e45\u964d\u4f4e\u8bf7\u6c42\u901f\u5ea6\uff0c\u6240\u4ee5\u662f\u5f3a\u8feb\u75c7\u7684\u89e3\u51b3\u65b9\u6cd5\u3002</p>", "body_md": "## \u4ec0\u4e48\u662f\u8de8\u57df\n\u51fa\u4e8e\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\u9650\u5236\u3002\u540c\u6e90\u7b56\u7565\uff08Sameoriginpolicy\uff09\u662f\u4e00\u79cd\u7ea6\u5b9a\uff0c\u5b83\u662f\u6d4f\u89c8\u5668\u6700\u6838\u5fc3\u4e5f\u6700\u57fa\u672c\u7684\u5b89\u5168\u529f\u80fd\uff0c\u5982\u679c\u7f3a\u5c11\u4e86\u540c\u6e90\u7b56\u7565\uff0c\u5219\u6d4f\u89c8\u5668\u7684\u6b63\u5e38\u529f\u80fd\u53ef\u80fd\u90fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u53ef\u4ee5\u8bf4Web\u662f\u6784\u5efa\u5728\u540c\u6e90\u7b56\u7565\u57fa\u7840\u4e4b\u4e0a\u7684\uff0c\u6d4f\u89c8\u5668\u53ea\u662f\u9488\u5bf9\u540c\u6e90\u7b56\u7565\u7684\u4e00\u79cd\u5b9e\u73b0\u3002\u540c\u6e90\u7b56\u7565\u4f1a\u963b\u6b62\u4e00\u4e2a\u57df\u7684javascript\u811a\u672c\u548c\u53e6\u5916\u4e00\u4e2a\u57df\u7684\u5185\u5bb9\u8fdb\u884c\u4ea4\u4e92\u3002\u6240\u8c13\u540c\u6e90\uff08\u5373\u6307\u5728\u540c\u4e00\u4e2a\u57df\uff09\u5c31\u662f\u4e24\u4e2a\u9875\u9762\u5177\u6709\u76f8\u540c\u7684\u534f\u8bae\uff08protocol\uff09\uff0c\u4e3b\u673a\uff08host\uff09\u548c\u7aef\u53e3\u53f7\uff08port\uff09\n> \u5f88\u660e\u663e\u7684\uff0c\u8de8\u57df\u662f\u6d4f\u89c8\u5668\u7684\u9650\u5236\uff0c\u610f\u5373\u4ee3\u7801\u6587\u4ef6\u5bf9\u63a5\u53e3\u7684\u8bbf\u95ee\uff0c\u662f\u6ca1\u6709\u9650\u5236\u7684\uff0c\u5982requests\uff0caxios\u7684\u8bf7\u6c42\uff0c\u800c\u5f53\u672c\u5730\u5f00\u542f\u63a5\u53e3\u540e\uff0c\u5373\u9700\u8981\u5ba2\u6237\u7aef(\u6d4f\u89c8\u5668)\u8bbf\u95ee\u8def\u7531\u65f6\uff0c\u624d\u4f1a\u4ea7\u751f\u7684\u76f8\u5173\u9650\u5236\u3002\n\n## \u6211\u6240\u4f7f\u7528\u7684\u8de8\u57df\u7684\u89e3\u51b3\n\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u672c\u5730\u5f00\u53d1\u7684\u524d\u540e\u7aef\u9879\u76ee\uff0c\u6211\u90fd\u4e60\u60ef\u5728\u540e\u7aef(django)\u505a\u8de8\u57df\uff0cdjango\u7684\u8de8\u57df\u6bd4\u8f83\u7b80\u5355\uff0c\u7528\u7b2c\u4e09\u65b9\u63d2\u4ef6django-cors-headers\u52a0\u4ee5\u914d\u7f6e\u5c31\u884c\uff0c\u800c\u67d0\u4e9b\u7b80\u5355\u7684\u91c7\u7528\u7b2c\u4e09\u65b9api\u7684vue\u524d\u7aef\u9879\u76ee\uff0c\u5728@vue-cli4\u4e0b\u7684`vue.config.js`\u505a\u8de8\u57df\u914d\u7f6e\n\n## django\u914d\u7f6e\nCORS \u662f\u8de8\u57df\u8d44\u6e90\u5206\u4eab\uff08Cross-Origin Resource Sharing\uff09\u7684\u7f29\u5199\u3002\u5b83\u662f W3C \u6807\u51c6\uff0c\u5c5e\u4e8e\u8de8\u6e90 AJAX \u8bf7\u6c42\u7684\u6839\u672c\u89e3\u51b3\u65b9\u6cd5\n\n```py\n$ pipenv install django-cors-headers    # \u5b89\u88c5django-cors-headers\n# settings.py\nCORS_ORIGIN_ALLOW_ALL = True  # \u65b0\u589e\u7684\u8de8\u57df\u8bbf\u95ee\u8bbe\u7f6e\n\nINSTALLED_APPS = [\n    \u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\n    'corsheaders',  # \u65b0\u52a0\u7684\u5e94\u7528\n]\n\nMIDDLEWARE = [\n    'django.middleware.security.SecurityMiddleware',\n    'django.contrib.sessions.middleware.SessionMiddleware',\n    'corsheaders.middleware.CorsMiddleware',  # \u65b0\u52a0\u7684\u4e2d\u95f4\u4ef6(\u4f4d\u7f6e)\n    'django.middleware.common.CommonMiddleware',\n]\n```\n\n## vue\u524d\u7aef\u914d\u7f6e\uff08\u5f00\u53d1\u73af\u5883\uff09\n\u5f53\u8bbf\u95ee\u7b2c\u4e09\u65b9api\u9700\u8981\u8de8\u57df\u9a8c\u8bc1\u65f6\u9700\u8981\u914d\u7f6e\n```js\n// vue.config.js\nmodule.exports = {\n    \u2026\u2026\u2026\u2026\u2026\u2026\n    devServer: {\n        proxy: {\n            '/g2/': { // \u4ee5/g2/\u4e3a\u5f00\u5934\u7684\u9002\u5408\u8fd9\u4e2a\u89c4\u5219\n                target: 'https://view.inews.qq.com',    // \u57df\u540d\n                secure: true,  // \u5982\u679c\u662fhttps\u63a5\u53e3\uff0c\u9700\u8981\u914d\u7f6e\u8fd9\u4e2a\u53c2\u6570\n                changeOrigin: true,        //\u5f00\u542f\n            },\n        }\n    }\n}\n// \u4f7f\u7528\n  async initdata() {\n      let data = await Axios.get('g2/getOnsInfo?name=disease_h5')\n      console.log(data)\n          }\n```\n\u8bbf\u95ee\uff1a`http://localhost:8080/g2/getOnsInfo?name=disease_h5` -->`https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5`\n\n```js\n\u2026\u2026\n// \u522b\u540d(\u5f53\u5f88\u591a\u7b2c\u4e09\u65b9\u63a5\u53e3\u65f6\u53ef\u4ee5\u4efb\u610f\u66f4\u6539)\n'/api': {\n       target: 'https://view.inews.qq.com',\n       // ws: true,\n       secure: true,  // \u5982\u679c\u662fhttps\u63a5\u53e3\uff0c\u9700\u8981\u914d\u7f6e\u8fd9\u4e2a\u53c2\u6570\n       changeOrigin: true,\n       \"pathRewrite\": {//\u8def\u5f84\u6539\u5199\u89c4\u5219\n       \"^/api\": \"g2\"//\u4ee5/proxy/\u4e3a\u5f00\u5934\u7684\u6539\u5199\u4e3a''\n         },\n   },\n````\n\u8bbf\u95ee\uff1a`http://localhost:8080/api/getOnsInfo?name=disease_h5` -->`https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5`\n\n## cdn\u7f51\u7ad9\u5f15\u7528\u7684\u5f3a\u8feb\u75c7\u89e3\u51b3\nchrome\u6d4f\u89c8\u5668\u51fa\u73b0warning\u63d0\u793a\uff1a\n```\nA cookie associated with a cross-site resource at http://v3.bootcss.com/ was set without the `SameSite` attribute. A future release of Chrome will only deliver cookies with cross-site requests if they are set with `SameSite=None` and `Secure`. You can review cookies in developer tools under Application>Storage>Cookies and see more details at https://www.chromestatus.com/feature/5088147346030592 and https://www.chromestatus.com/feature/5633521622188032.\n```\n\u524d\u7aef\u5f00\u53d1\u9879\u76ee\u65f6\uff0c\u5f15\u7528cdn\u7f51\u7ad9\u7684js\u6587\u4ef6\u7684\u63d0\u793a\uff0c\u662fchrome\u51fa\u73b0\u7684\u8de8\u57df\u63d0\u793a\uff0c\u8868\u793a\u5bf9\u5f53\u524d\u57df\u540d\u7684\u5f15\u7528\u51fa\u73b0\u4e86\u8de8\u57df(\u8bf7\u6c42\u5934(`Sec-Fetch-Site: cross-site`))\n\u6b64\u65f6\u53ef\u4ee5\u5982\u4e0b\u914d\u7f6e(\u672c\u5730\u5f00\u542f\u865a\u62df\u670d\u52a1\u5668\u8bbf\u95ee\uff0c\u4f1a\u964d\u4f4e\u901f\u5ea6)\uff1a\n```js\n//vue.config.js\n  '/re': {\n       target: 'https://cdn.bootcss.com',\n       secure: true,  // \u5982\u679c\u662fhttps\u63a5\u53e3\uff0c\u9700\u8981\u914d\u7f6e\u8fd9\u4e2a\u53c2\u6570\n       ws: true,\n       changeOrigin: true,\n       \"pathRewrite\": {//\u8def\u5f84\u6539\u5199\u89c4\u5219\n       \"^/re\": \"\"//\u4ee5/proxy/\u4e3a\u5f00\u5934\u7684\u6539\u5199\u4e3a''\n       },\n}\n```\n\u4f7f\u7528\n```html\n// index.html\n    <script src=\"re/axios/0.19.0/axios.min.js\"></script>\n    <script src=\"re/echarts/4.3.0/echarts.min.js\"></script>\n```\n\u5b9e\u9645\u4f7f\u7528\uff0c\u4f1a\u5927\u5e45\u964d\u4f4e\u8bf7\u6c42\u901f\u5ea6\uff0c\u6240\u4ee5\u662f\u5f3a\u8feb\u75c7\u7684\u89e3\u51b3\u65b9\u6cd5\u3002", "excerpt": "\u4ec0\u4e48\u662f\u8de8\u57df\n\u51fa\u4e8e\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\u9650\u5236\u3002\u540c\u6e90\u7b56\u7565\uff08Sameoriginpolicy\uff09\u662f\u4e00\u79cd\u7ea6\u5b9a\uff0c\u5b83\u662f\u6d4f\u89c8\u5668\u6700\u6838\u5fc3\u4e5f\u6700\u57fa\u672c\u7684\u5b89\u5168\u529f\u80fd\uff0c\u5982\u679c\u7f3a\u5c11\u4e86\u540c\u6e90\u7b56\u7565\uff0c\u5219\u6d4f\u89c8\u5668\u7684\u6b63\u5e38\u529f\u80fd\u53ef\u80fd\u90fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u53ef\u4ee5\u8bf4Web\u662f\u6784\u5efa\u5728\u540c\u6e90\u7b56\u7565\u57fa\u7840\u4e4b\u4e0a\u7684\uff0c\u6d4f\u89c8\u5668\u53ea\u662f\u9488\u5bf9\u540c\u6e90\u7b56\u7565\u7684\u4e00\u79cd\u5b9e\u73b0\u3002\u540c\u6e90\u7b56\u7565\u4f1a\u963b\u6b62\u4e00\u4e2a\u57df\u7684javascrip", "codestyle": "atelier-cave-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-02-25T19:57:52.876", "mod_date": "2020-03-08T19:34:21.366", "views_count": 37, "can_comment": true, "comment_count": 0, "upvote_count": -1, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [7]}}, {"model": "blog.post", "pk": 9, "fields": {"title": "vue\u539f\u751f\u76d1\u6d4b\u6eda\u52a8\u7684\u5b9e\u73b0", "body": "<blockquote>\n<p>\u9488\u5bf9\u6eda\u52a8\u6761\u7684\u8bbe\u8ba1\uff0c\u5728\u5f88\u591a\u7f51\u7ad9\u5f88\u591a\u5e94\u7528\u90fd\u6709\u5b9e\u73b0\uff0c\u5982\u8fd4\u56de\u9876\u90e8\uff0c\u6216\u8005\u7c7b\u4f3c\u77e5\u4e4e\u4e3b\u9875\u5934\u90e8tab\u680f\u7684\u5207\u6362\uff0c\u95ee\u9898\u9875\u5411\u4e0b\u6eda\u52a8\u5934\u90e8\u663e\u793a\u95ee\u9898\u4fe1\u606f\uff0c\u5411\u4e0a\u5219\u663e\u793a\u4e3b\u9875\u5934\u90e8\u7684\u529f\u80fd\uff0c\u73b0\u5728\u7684\u67d0\u4e9b\u8bba\u575b\u7f51\u7ad9\u5237\u65b0\u5e16\u5b50\uff0c\u4fbf\u662f\u76d1\u6d4b\u5411\u4e0b\u6eda\u52a8\u52a0\u8f7d\u66f4\u591a\uff0c\u5982\u6b64js\u83b7\u53d6\u6570\u636e\u9875\u65b9\u4fbf\u4e86\u7f51\u7ad9\u7684\u6570\u636e\u8bbf\u95ee\u538b\u529b\u53ca\u5f71\u54cd\u666e\u901a\u722c\u866b\u722c\u53d6\u3002\u6eda\u52a8\u6761\u529f\u80fd\u5b9e\u73b0\u63d2\u4ef6\uff0c\u5982Vuescroll\uff0c\u57fa\u4e8e\u672c\u7ad9\u670d\u52a1\u5668\u7684\u6027\u80fd\uff0c\u4e5f\u662f\u57fa\u4e8e\u5b66\u4e60\u9700\u8981\uff0c\u6240\u4ee5\u624b\u5199\u4e86\u672c\u7ad9\u7684scroll\u529f\u80fd\uff0c\u5982header\u7ec4\u4ef6\uff0c\u9996\u9875postindex\u7ec4\u4ef6\u7b49\u7b49\u3002\u3002\u3002</p>\n</blockquote>\n<h2><a id=\"_4\"></a>\u6eda\u52a8\u6761\u8868\u73b0</h2>\n<p>\u57fa\u672c\u4e0a\uff0c\u76d1\u6d4b\u6eda\u52a8\u6761\u7684\u72b6\u6001\uff0c\u57fa\u4e8e\u6eda\u52a8\u6761\u7684\u4f4d\u7f6e\u3002\u5f53\u7f51\u7ad9\u51fa\u73b0\u8d85\u51fa\u89c6\u53e3\u9ad8\u5ea6\uff0c\u4fbf\u4f1a\u51fa\u73b0\u6eda\u52a8\u6761\uff0c\u5224\u65ad\u6eda\u52a8\u6761\u5411\u4e0a\u5411\u4e0b\uff0c\u4e5f\u662f\u57fa\u4e8e\u67d0\u5f88\u77ed\u65f6\u95f4\u5185\uff0c\u6eda\u52a8\u6761\u7684\u4f4d\u7f6e\u5224\u65ad\u3002</p>\n<h2><a id=\"_10\"></a>\u5e94\u7528\u2460\uff1a\u5230\u5e95\u90e8\u52a0\u8f7d\u66f4\u591a</h2>\n<pre><div class=\"hljs\"><code class=\"lang-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"app\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">v-for</span>=<span class=\"hljs-string\">'i in l'</span>&gt;</span>\n                {{i}}\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n        <span class=\"hljs-keyword\">const</span> vm = <span class=\"hljs-keyword\">new</span> Vue({\n            <span class=\"hljs-attr\">el</span>: <span class=\"hljs-string\">'#app'</span>,\n            data() {\n                <span class=\"hljs-keyword\">return</span> {\n                    <span class=\"hljs-attr\">l</span>: [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>]\n                }\n            },\n            mounted() {\n                <span class=\"hljs-built_in\">window</span>.addEventListener(<span class=\"hljs-string\">'scroll'</span>, <span class=\"hljs-keyword\">this</span>.scrollHander)\n                <span class=\"hljs-comment\">// \u76d1\u89c6\u6eda\u52a8\u4e8b\u4ef6</span>\n            },\n            <span class=\"hljs-attr\">methods</span>: {\n                scrollHander() {\n                    <span class=\"hljs-keyword\">var</span> scr = <span class=\"hljs-built_in\">document</span>.documentElement.scrollTop || <span class=\"hljs-built_in\">document</span>.body.scrollTop; <span class=\"hljs-comment\">// \u5411\u4e0a\u6eda\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u9ad8\u5ea6</span>\n                    <span class=\"hljs-keyword\">var</span> clientHeight = <span class=\"hljs-built_in\">document</span>.documentElement.clientHeight; <span class=\"hljs-comment\">// \u5c4f\u5e55\u9ad8\u5ea6\u4e5f\u5c31\u662f\u5f53\u524d\u8bbe\u5907\u9759\u6001\u4e0b\u4f60\u6240\u770b\u5230\u7684\u89c6\u89c9\u9ad8\u5ea6</span>\n                    <span class=\"hljs-keyword\">var</span> scrHeight = <span class=\"hljs-built_in\">document</span>.documentElement.scrollHeight || <span class=\"hljs-built_in\">document</span>.body.scrollHeight; <span class=\"hljs-comment\">// \u6574\u4e2a\u7f51\u9875\u7684\u5b9e\u9645\u9ad8\u5ea6\uff0c\u517c\u5bb9Pc\u7aef</span>\n                    <span class=\"hljs-keyword\">if</span> (scr + clientHeight + <span class=\"hljs-number\">10</span> &gt;= scrHeight) {\n                        <span class=\"hljs-comment\">//  \u6eda\u5230\u5e95\u90e8</span>\n                        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">this</span>.l.length &lt;<span class=\"hljs-number\">10</span>) {\n                            <span class=\"hljs-keyword\">let</span> lappend = [<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">10</span>]\n                            <span class=\"hljs-keyword\">this</span>.l = <span class=\"hljs-keyword\">this</span>.l.concat(lappend)\n                        }\n                    } <span class=\"hljs-keyword\">else</span> {}\n                },\n            },\n        })\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span>&gt;</span><span class=\"css\">\n        <span class=\"hljs-selector-id\">#app</span> {\n            <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">1200px</span>\n        }\n        <span class=\"hljs-selector-tag\">li</span> {\n            <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">240px</span>;\n        }\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n</code></div></pre>\n<blockquote>\n<p>\u5982\u4e0a\uff0c\u7b80\u5355\u5b9e\u73b0\u4e86\u4e00\u4e2a\u52a0\u8f7d\u66f4\u591a\u7684\u5b9e\u4f8b\u3002\u521d\u59cb\u8fed\u4ee3\u4e00\u4e2a\u5217\u8868\uff0c\u5f53\u6eda\u52a8\u6761\u62d6\u52a8\u5230\u5e95\u90e8\uff08\u6eda\u52a8\u9ad8\u5ea6+\u89c6\u53e3\u9ad8\u5ea6&gt;\u7f51\u9875\u5b9e\u9645\u9ad8\u5ea6\uff09\uff0c\u89e6\u53d1\u4e8b\u4ef6\uff0c\u8bf7\u6c42\u4fe1\u606f\u6539\u53d8\u5217\u8868\uff0c\u8fdb\u884cdom\u66f4\u6539\u3002</p>\n</blockquote>\n<h2><a id=\"header_68\"></a>\u5e94\u7528\u2461\uff1a\u76d1\u6d4b\u5411\u4e0a\u5411\u4e0b\u6eda\u52a8\u5b9e\u73b0header\u5207\u6362</h2>\n<pre><div class=\"hljs\"><code class=\"lang-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"app\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">header</span> <span class=\"hljs-attr\">v-if</span>=<span class=\"hljs-string\">'ifshow'</span>&gt;</span>show<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">header</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n        <span class=\"hljs-keyword\">const</span> vm = <span class=\"hljs-keyword\">new</span> Vue({\n            <span class=\"hljs-attr\">el</span>: <span class=\"hljs-string\">'#app'</span>,\n            data() {\n                <span class=\"hljs-keyword\">return</span> {\n                    <span class=\"hljs-attr\">ifshow</span>: <span class=\"hljs-literal\">true</span>,\n                    <span class=\"hljs-attr\">scrollB</span>: <span class=\"hljs-number\">0</span>,\n                    <span class=\"hljs-attr\">scrollA</span>: <span class=\"hljs-number\">0</span>,\n                }\n            },\n            mounted() {\n                <span class=\"hljs-built_in\">window</span>.addEventListener(<span class=\"hljs-string\">'scroll'</span>, <span class=\"hljs-keyword\">this</span>.scrollHander) <span class=\"hljs-comment\">//\u76d1\u89c6scroll \u6eda\u52a8\u4e8b\u4ef6</span>\n            },\n            <span class=\"hljs-attr\">methods</span>: {\n                scrollHander() {\n                    <span class=\"hljs-keyword\">let</span> scr = <span class=\"hljs-built_in\">document</span>.documentElement.scrollTop || <span class=\"hljs-built_in\">document</span>.body.scrollTop; <span class=\"hljs-comment\">// \u5411\u4e0a\u6eda\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u9ad8\u5ea6</span>\n                    <span class=\"hljs-keyword\">let</span> that = <span class=\"hljs-keyword\">this</span> <span class=\"hljs-comment\">// \u81ea\u6267\u884c\u51fd\u6570\u53ef\u80fd\u6709\u4f5c\u7528\u57df\u95ee\u9898\uff0c\u53ef\u4ee5\u7528es6\u8bed\u6cd5\u4ee3\u66ff</span>\n                    that.scrollB = scr      <span class=\"hljs-comment\">// \u8d4b\u503c\u6bd4\u8f83</span>\n                    <span class=\"hljs-keyword\">if</span> (that.scrollB &gt; <span class=\"hljs-number\">300</span>) {\n                        <span class=\"hljs-comment\">// \u5982\u679c\u6eda\u52a8\u6761\u4f4d\u7f6e\u8d85\u8fc7300</span>\n                        <span class=\"hljs-keyword\">if</span> (that.scrollA &lt;= that.scrollB) { <span class=\"hljs-comment\">//\u4e0b\u6eda</span>\n                            that.ifshow = <span class=\"hljs-literal\">false</span>\n                            <span class=\"hljs-built_in\">console</span>.log(that.scrollA,that.scrollB,<span class=\"hljs-string\">'\u4e0b\u6eda'</span>)\n                        } <span class=\"hljs-keyword\">else</span> { <span class=\"hljs-comment\">//\u4e0a\u6eda</span>\n                            that.ifshow = <span class=\"hljs-literal\">true</span>\n                            <span class=\"hljs-built_in\">console</span>.log(that.scrollA,that.scrollB,<span class=\"hljs-string\">'\u4e0a\u6eda'</span>)\n                        }\n                        setTimeout(<span class=\"hljs-function\"><span class=\"hljs-params\">()</span>=&gt;</span> {\n                            that.scrollA = that.scrollB;\n                        }, <span class=\"hljs-number\">0</span>);\n                    } <span class=\"hljs-keyword\">else</span> {\n                        that.ifshow = <span class=\"hljs-literal\">true</span>\n                    }\n                }\n            },\n        })\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span>&gt;</span><span class=\"css\">\n        <span class=\"hljs-selector-tag\">body</span> {\n            <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">1600px</span>;\n        }\n        <span class=\"hljs-selector-tag\">header</span> {\n            <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">60px</span>;\n            <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;\n            <span class=\"hljs-attribute\">background</span>: orange;\n            <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0.3</span>;\n            <span class=\"hljs-attribute\">position</span>: fixed;\n            <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">text-align</span>: center;\n            <span class=\"hljs-attribute\">font-size</span>:<span class=\"hljs-number\">30px</span>;\n            <span class=\"hljs-attribute\">line-height</span>: <span class=\"hljs-number\">60px</span>;\n        }\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n</code></div></pre>\n<blockquote>\n<p>\u793a\u4f8b\u4e8c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6839\u636e\u6eda\u52a8\u6761\u5373\u65f6\u4f4d\u7f6e\u5224\u65ad\u4e0a\u6eda\u4e0b\u6eda\u7684\u5e94\u7528\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0csetTimeout\u51fd\u6570\u5b9e\u65f6\u66f4\u65b0\u4e0a\u6b21\u4e0e\u6b64\u65f6\u6eda\u52a8\u6761\u4f4d\u7f6e\uff0c\u5224\u65ad\u4e0a\u6eda\u8fd8\u662f\u4e0b\u6eda\uff0c\u4ece\u800cdom\u66f4\u65b0\u53d8\u5316</p>\n</blockquote>\n<h2><a id=\"_143\"></a>\u5e94\u7528\u2462\uff1a\u56de\u5230\u9876\u90e8</h2>\n<pre><div class=\"hljs\"><code class=\"lang-html\"><span class=\"hljs-meta\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"app\"</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">'backtop'</span> <span class=\"hljs-attr\">v-show</span>=<span class=\"hljs-string\">'ifshow'</span> <span class=\"hljs-attr\">title</span>=<span class=\"hljs-string\">\"\u56de\u5230\u9876\u90e8\"</span> @<span class=\"hljs-attr\">click</span>=<span class=\"hljs-string\">'totop'</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n        <span class=\"hljs-keyword\">const</span> vm = <span class=\"hljs-keyword\">new</span> Vue({\n            <span class=\"hljs-attr\">el</span>: <span class=\"hljs-string\">'#app'</span>,\n            data() {\n                <span class=\"hljs-keyword\">return</span> {\n                    <span class=\"hljs-attr\">ifshow</span>: <span class=\"hljs-literal\">false</span>\n                }\n            },\n            mounted() {\n                <span class=\"hljs-built_in\">window</span>.addEventListener(<span class=\"hljs-string\">'scroll'</span>, <span class=\"hljs-keyword\">this</span>.scrollHander) <span class=\"hljs-comment\">//\u76d1\u89c6scroll \u6eda\u52a8\u4e8b\u4ef6</span>\n            },\n            <span class=\"hljs-attr\">methods</span>: {\n                scrollHander() {\n                    <span class=\"hljs-keyword\">let</span> scr = <span class=\"hljs-built_in\">document</span>.documentElement.scrollTop || <span class=\"hljs-built_in\">document</span>.body.scrollTop; <span class=\"hljs-comment\">// \u5411\u4e0a\u6eda\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u9ad8\u5ea6</span>\n                    <span class=\"hljs-keyword\">if</span> (scr &gt; <span class=\"hljs-number\">300</span>) {\n                        <span class=\"hljs-keyword\">this</span>.ifshow = <span class=\"hljs-literal\">true</span>\n                    } <span class=\"hljs-keyword\">else</span> {\n                        <span class=\"hljs-keyword\">this</span>.ifshow = <span class=\"hljs-literal\">false</span>\n                    }\n                },\n                totop(){\n                    scrollTo(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>);\n                }\n            },\n        })\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span>&gt;</span><span class=\"css\">\n        <span class=\"hljs-selector-tag\">body</span> {\n            <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">1600px</span>;\n        }\n        <span class=\"hljs-selector-id\">#backtop</span> {\n            <span class=\"hljs-attribute\">position</span>: fixed;\n            <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">30px</span>;\n            <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">30px</span>;\n            <span class=\"hljs-attribute\">border-radius</span>: <span class=\"hljs-number\">50%</span>;\n            <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#909090</span>;\n            <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">30px</span>;\n            <span class=\"hljs-attribute\">bottom</span>: <span class=\"hljs-number\">50px</span>;\n            <span class=\"hljs-attribute\">cursor</span>: pointer;\n        }\n        <span class=\"hljs-selector-tag\">span</span> {\n            <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-attribute\">overflow</span>: hidden;\n            <span class=\"hljs-attribute\">border</span>: <span class=\"hljs-number\">7px</span> solid transparent;\n            <span class=\"hljs-attribute\">border-bottom-color</span>:black;  \n            <span class=\"hljs-attribute\">bottom</span>: <span class=\"hljs-number\">9px</span>;\n            <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">8px</span>;\n            <span class=\"hljs-attribute\">position</span>: relative;\n        }\n        <span class=\"hljs-selector-id\">#backtop</span><span class=\"hljs-selector-pseudo\">:hover</span> {\n            <span class=\"hljs-attribute\">background</span>: rebeccapurple;\n        }\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n\n</code></div></pre>\n<blockquote>\n<p>\u5982\u4e0a\uff0c\u5199\u4e00\u4e2afixed\u5b9a\u4f4d\u7684\u6309\u94ae\uff0c\u5224\u65ad\u5f53\u6eda\u52a8\u6761\u4f4d\u7f6e\u8d85\u8fc7\u4e00\u5b9a\u9ad8\u5ea6\u663e\u73b0\uff0c\u5229\u7528scrollTo(0,0)\u51fd\u6570\u56de\u5230\u9876\u90e8;</p>\n</blockquote>", "body_md": "> \u9488\u5bf9\u6eda\u52a8\u6761\u7684\u8bbe\u8ba1\uff0c\u5728\u5f88\u591a\u7f51\u7ad9\u5f88\u591a\u5e94\u7528\u90fd\u6709\u5b9e\u73b0\uff0c\u5982\u8fd4\u56de\u9876\u90e8\uff0c\u6216\u8005\u7c7b\u4f3c\u77e5\u4e4e\u4e3b\u9875\u5934\u90e8tab\u680f\u7684\u5207\u6362\uff0c\u95ee\u9898\u9875\u5411\u4e0b\u6eda\u52a8\u5934\u90e8\u663e\u793a\u95ee\u9898\u4fe1\u606f\uff0c\u5411\u4e0a\u5219\u663e\u793a\u4e3b\u9875\u5934\u90e8\u7684\u529f\u80fd\uff0c\u73b0\u5728\u7684\u67d0\u4e9b\u8bba\u575b\u7f51\u7ad9\u5237\u65b0\u5e16\u5b50\uff0c\u4fbf\u662f\u76d1\u6d4b\u5411\u4e0b\u6eda\u52a8\u52a0\u8f7d\u66f4\u591a\uff0c\u5982\u6b64js\u83b7\u53d6\u6570\u636e\u9875\u65b9\u4fbf\u4e86\u7f51\u7ad9\u7684\u6570\u636e\u8bbf\u95ee\u538b\u529b\u53ca\u5f71\u54cd\u666e\u901a\u722c\u866b\u722c\u53d6\u3002\u6eda\u52a8\u6761\u529f\u80fd\u5b9e\u73b0\u63d2\u4ef6\uff0c\u5982Vuescroll\uff0c\u57fa\u4e8e\u672c\u7ad9\u670d\u52a1\u5668\u7684\u6027\u80fd\uff0c\u4e5f\u662f\u57fa\u4e8e\u5b66\u4e60\u9700\u8981\uff0c\u6240\u4ee5\u624b\u5199\u4e86\u672c\u7ad9\u7684scroll\u529f\u80fd\uff0c\u5982header\u7ec4\u4ef6\uff0c\u9996\u9875postindex\u7ec4\u4ef6\u7b49\u7b49\u3002\u3002\u3002\n\n\n\n## \u6eda\u52a8\u6761\u8868\u73b0\n\n\u57fa\u672c\u4e0a\uff0c\u76d1\u6d4b\u6eda\u52a8\u6761\u7684\u72b6\u6001\uff0c\u57fa\u4e8e\u6eda\u52a8\u6761\u7684\u4f4d\u7f6e\u3002\u5f53\u7f51\u7ad9\u51fa\u73b0\u8d85\u51fa\u89c6\u53e3\u9ad8\u5ea6\uff0c\u4fbf\u4f1a\u51fa\u73b0\u6eda\u52a8\u6761\uff0c\u5224\u65ad\u6eda\u52a8\u6761\u5411\u4e0a\u5411\u4e0b\uff0c\u4e5f\u662f\u57fa\u4e8e\u67d0\u5f88\u77ed\u65f6\u95f4\u5185\uff0c\u6eda\u52a8\u6761\u7684\u4f4d\u7f6e\u5224\u65ad\u3002\n\n\n\n## \u5e94\u7528\u2460\uff1a\u5230\u5e95\u90e8\u52a0\u8f7d\u66f4\u591a\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <script src=\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"></script>\n</head>\n<body>\n    <div id=\"app\">\n        <ul>\n            <li v-for='i in l'>\n                {{i}}\n            </li>\n        </ul>\n    </div>\n    <script>\n        const vm = new Vue({\n            el: '#app',\n            data() {\n                return {\n                    l: [1, 2, 3, 4, 5]\n                }\n            },\n            mounted() {\n                window.addEventListener('scroll', this.scrollHander)\n                // \u76d1\u89c6\u6eda\u52a8\u4e8b\u4ef6\n            },\n            methods: {\n                scrollHander() {\n                    var scr = document.documentElement.scrollTop || document.body.scrollTop; // \u5411\u4e0a\u6eda\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u9ad8\u5ea6\n                    var clientHeight = document.documentElement.clientHeight; // \u5c4f\u5e55\u9ad8\u5ea6\u4e5f\u5c31\u662f\u5f53\u524d\u8bbe\u5907\u9759\u6001\u4e0b\u4f60\u6240\u770b\u5230\u7684\u89c6\u89c9\u9ad8\u5ea6\n                    var scrHeight = document.documentElement.scrollHeight || document.body.scrollHeight; // \u6574\u4e2a\u7f51\u9875\u7684\u5b9e\u9645\u9ad8\u5ea6\uff0c\u517c\u5bb9Pc\u7aef\n                    if (scr + clientHeight + 10 >= scrHeight) {\n                        //  \u6eda\u5230\u5e95\u90e8\n                        if (this.l.length <10) {\n                            let lappend = [6, 7, 8, 9, 10]\n                            this.l = this.l.concat(lappend)\n                        }\n                    } else {}\n                },\n            },\n        })\n    </script>\n    <style>\n        #app {\n            height: 1200px\n        }\n        li {\n            height: 240px;\n        }\n    </style>\n</body>\n</html>\n```\n\n> \u5982\u4e0a\uff0c\u7b80\u5355\u5b9e\u73b0\u4e86\u4e00\u4e2a\u52a0\u8f7d\u66f4\u591a\u7684\u5b9e\u4f8b\u3002\u521d\u59cb\u8fed\u4ee3\u4e00\u4e2a\u5217\u8868\uff0c\u5f53\u6eda\u52a8\u6761\u62d6\u52a8\u5230\u5e95\u90e8\uff08\u6eda\u52a8\u9ad8\u5ea6+\u89c6\u53e3\u9ad8\u5ea6>\u7f51\u9875\u5b9e\u9645\u9ad8\u5ea6\uff09\uff0c\u89e6\u53d1\u4e8b\u4ef6\uff0c\u8bf7\u6c42\u4fe1\u606f\u6539\u53d8\u5217\u8868\uff0c\u8fdb\u884cdom\u66f4\u6539\u3002\n\n## \u5e94\u7528\u2461\uff1a\u76d1\u6d4b\u5411\u4e0a\u5411\u4e0b\u6eda\u52a8\u5b9e\u73b0header\u5207\u6362\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <script src=\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"></script>\n</head>\n<body>\n    <div id=\"app\">\n        <header v-if='ifshow'>show</header>\n    </div>\n    <script>\n        const vm = new Vue({\n            el: '#app',\n            data() {\n                return {\n                    ifshow: true,\n                    scrollB: 0,\n                    scrollA: 0,\n                }\n            },\n            mounted() {\n                window.addEventListener('scroll', this.scrollHander) //\u76d1\u89c6scroll \u6eda\u52a8\u4e8b\u4ef6\n            },\n            methods: {\n                scrollHander() {\n                    let scr = document.documentElement.scrollTop || document.body.scrollTop; // \u5411\u4e0a\u6eda\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u9ad8\u5ea6\n                    let that = this // \u81ea\u6267\u884c\u51fd\u6570\u53ef\u80fd\u6709\u4f5c\u7528\u57df\u95ee\u9898\uff0c\u53ef\u4ee5\u7528es6\u8bed\u6cd5\u4ee3\u66ff\n                    that.scrollB = scr      // \u8d4b\u503c\u6bd4\u8f83\n                    if (that.scrollB > 300) {\n                        // \u5982\u679c\u6eda\u52a8\u6761\u4f4d\u7f6e\u8d85\u8fc7300\n                        if (that.scrollA <= that.scrollB) { //\u4e0b\u6eda\n                            that.ifshow = false\n                            console.log(that.scrollA,that.scrollB,'\u4e0b\u6eda')\n                        } else { //\u4e0a\u6eda\n                            that.ifshow = true\n                            console.log(that.scrollA,that.scrollB,'\u4e0a\u6eda')\n                        }\n                        setTimeout(()=> {\n                            that.scrollA = that.scrollB;\n                        }, 0);\n                    } else {\n                        that.ifshow = true\n                    }\n                }\n            },\n        })\n    </script>\n    <style>\n        body {\n            margin: 0 0;\n            padding: 0 0;\n            height: 1600px;\n        }\n        header {\n            height: 60px;\n            width: 100%;\n            background: orange;\n            opacity: 0.3;\n            position: fixed;\n            top: 0;\n            left: 0;\n            text-align: center;\n            font-size:30px;\n            line-height: 60px;\n        }\n    </style>\n</body>\n</html>\n```\n> \u793a\u4f8b\u4e8c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6839\u636e\u6eda\u52a8\u6761\u5373\u65f6\u4f4d\u7f6e\u5224\u65ad\u4e0a\u6eda\u4e0b\u6eda\u7684\u5e94\u7528\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0csetTimeout\u51fd\u6570\u5b9e\u65f6\u66f4\u65b0\u4e0a\u6b21\u4e0e\u6b64\u65f6\u6eda\u52a8\u6761\u4f4d\u7f6e\uff0c\u5224\u65ad\u4e0a\u6eda\u8fd8\u662f\u4e0b\u6eda\uff0c\u4ece\u800cdom\u66f4\u65b0\u53d8\u5316\n\n\n\n## \u5e94\u7528\u2462\uff1a\u56de\u5230\u9876\u90e8\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <script src=\"https://cdn.bootcss.com/vue/2.6.10/vue.min.js\"></script>\n</head>\n<body>\n    <div id=\"app\">\n        <div id='backtop' v-show='ifshow' title=\"\u56de\u5230\u9876\u90e8\" @click='totop'><span></span></div>\n    </div>\n    <script>\n        const vm = new Vue({\n            el: '#app',\n            data() {\n                return {\n                    ifshow: false\n                }\n            },\n            mounted() {\n                window.addEventListener('scroll', this.scrollHander) //\u76d1\u89c6scroll \u6eda\u52a8\u4e8b\u4ef6\n            },\n            methods: {\n                scrollHander() {\n                    let scr = document.documentElement.scrollTop || document.body.scrollTop; // \u5411\u4e0a\u6eda\u52a8\u7684\u90a3\u4e00\u90e8\u5206\u9ad8\u5ea6\n                    if (scr > 300) {\n                        this.ifshow = true\n                    } else {\n                        this.ifshow = false\n                    }\n                },\n                totop(){\n                    scrollTo(0,0);\n                }\n            },\n        })\n    </script>\n    <style>\n        body {\n            margin: 0 0;\n            padding: 0 0;\n            height: 1600px;\n        }\n        #backtop {\n            position: fixed;\n            width: 30px;\n            height: 30px;\n            border-radius: 50%;\n            background: #909090;\n            right: 30px;\n            bottom: 50px;\n            cursor: pointer;\n        }\n        span {\n            width: 0;\n            height: 0;\n            overflow: hidden;\n            border: 7px solid transparent;\n            border-bottom-color:black;  \n            bottom: 9px;\n            left: 8px;\n            position: relative;\n        }\n        #backtop:hover {\n            background: rebeccapurple;\n        }\n    </style>\n</body>\n</html>\n\n```\n\n> \u5982\u4e0a\uff0c\u5199\u4e00\u4e2afixed\u5b9a\u4f4d\u7684\u6309\u94ae\uff0c\u5224\u65ad\u5f53\u6eda\u52a8\u6761\u4f4d\u7f6e\u8d85\u8fc7\u4e00\u5b9a\u9ad8\u5ea6\u663e\u73b0\uff0c\u5229\u7528scrollTo(0,0)\u51fd\u6570\u56de\u5230\u9876\u90e8;", "excerpt": "\n\u9488\u5bf9\u6eda\u52a8\u6761\u7684\u8bbe\u8ba1\uff0c\u5728\u5f88\u591a\u7f51\u7ad9\u5f88\u591a\u5e94\u7528\u90fd\u6709\u5b9e\u73b0\uff0c\u5982\u8fd4\u56de\u9876\u90e8\uff0c\u6216\u8005\u7c7b\u4f3c\u77e5\u4e4e\u4e3b\u9875\u5934\u90e8tab\u680f\u7684\u5207\u6362\uff0c\u95ee\u9898\u9875\u5411\u4e0b\u6eda\u52a8\u5934\u90e8\u663e\u793a\u95ee\u9898\u4fe1\u606f\uff0c\u5411\u4e0a\u5219\u663e\u793a\u4e3b\u9875\u5934\u90e8\u7684\u529f\u80fd\uff0c\u73b0\u5728\u7684\u67d0\u4e9b\u8bba\u575b\u7f51\u7ad9\u5237\u65b0\u5e16\u5b50\uff0c\u4fbf\u662f\u76d1\u6d4b\u5411\u4e0b\u6eda\u52a8\u52a0\u8f7d\u66f4\u591a\uff0c\u5982\u6b64js\u83b7\u53d6\u6570\u636e\u9875\u65b9\u4fbf\u4e86\u7f51\u7ad9\u7684\u6570\u636e\u8bbf\u95ee\u538b\u529b\u53ca\u5f71\u54cd\u666e\u901a\u722c\u866b\u722c\u53d6\u3002\u6eda\u52a8\u6761\u529f\u80fd\u5b9e\u73b0\u63d2\u4ef6\uff0c\u5982Vues", "codestyle": "atelier-cave-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-05T23:53:01.359", "mod_date": "2020-03-05T23:56:30.438", "views_count": 22, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 4, "tags": []}}, {"model": "blog.post", "pk": 11, "fields": {"title": "\u6392\u5e8f\u7b97\u6cd5", "body": "<h2><a id=\"_Bubble_Sort_0\"></a>\u5192\u6ce1\u6392\u5e8f Bubble Sort</h2>\n<blockquote>\n<p>\u5192\u6ce1\u6392\u5e8f\u7684\u539f\u7406\u975e\u5e38\u7b80\u5355\uff0c\u5b83\u91cd\u590d\u5730\u8d70\u8bbf\u8fc7\u8981\u6392\u5e8f\u7684\u6570\u5217\uff0c\u4e00\u6b21\u6bd4\u8f83\u4e24\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u4ed6\u4eec\u7684\u987a\u5e8f\u9519\u8bef\u5c31\u628a\u4ed6\u4eec\u4ea4\u6362\u8fc7\u6765\u3002</p>\n</blockquote>\n<p>\u6b65\u9aa4\uff1a</p>\n<ol>\n<li>\u6bd4\u8f83\u76f8\u90bb\u7684\u5143\u7d20\u3002\u5982\u679c\u7b2c\u4e00\u4e2a\u6bd4\u7b2c\u4e8c\u4e2a\u5927\uff0c\u5c31\u4ea4\u6362\u4ed6\u4eec\u4e24\u4e2a\u3002</li>\n<li>\u5bf9\u7b2c0\u4e2a\u5230\u7b2cn-1\u4e2a\u6570\u636e\u505a\u540c\u6837\u7684\u5de5\u4f5c\u3002\u8fd9\u65f6\uff0c\u6700\u5927\u7684\u6570\u5c31\u201c\u6d6e\u201d\u5230\u4e86\u6570\u7ec4\u6700\u540e\u7684\u4f4d\u7f6e\u4e0a\u3002</li>\n<li>\u9488\u5bf9\u6240\u6709\u7684\u5143\u7d20\u91cd\u590d\u4ee5\u4e0a\u7684\u6b65\u9aa4\uff0c\u9664\u4e86\u6700\u540e\u4e00\u4e2a\u3002</li>\n<li>\u6301\u7eed\u6bcf\u6b21\u5bf9\u8d8a\u6765\u8d8a\u5c11\u7684\u5143\u7d20\u91cd\u590d\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u76f4\u5230\u6ca1\u6709\u4efb\u4f55\u4e00\u5bf9\u6570\u5b57\u9700\u8981\u6bd4\u8f83\u3002</li>\n</ol>\n<p>\u56fe\u89e3\uff1a<br />\n<img src=\"https://user-gold-cdn.xitu.io/2018/12/19/167c4383846a5ede?imageslim\" alt=\"\u5192\u6ce1\u6392\u5e8f\" /></p>\n<p>\u5b9e\u73b0\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">bubble_sort</span><span class=\"hljs-params\">(arr)</span>:</span>\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(len(arr)<span class=\"hljs-number\">-1</span>):    <span class=\"hljs-comment\"># \u5faa\u73af\u6b21\u6570\u4e3a\u957f\u5ea6-1</span>\n        <span class=\"hljs-keyword\">for</span> s <span class=\"hljs-keyword\">in</span> range(len(arr)-i<span class=\"hljs-number\">-1</span>):  <span class=\"hljs-comment\"># \u5185\u5faa\u73af\u4ece\u5916\u5faa\u73af\u7ed3\u675f\u7d22\u5f15\u5f00\u59cb</span>\n            <span class=\"hljs-keyword\">if</span> arr[s] &gt; arr[s+<span class=\"hljs-number\">1</span>]:        <span class=\"hljs-comment\"># \u4ece\u7b2c\u4e00\u4e2a\u5143\u7d20\u5f00\u59cb\u5224\u65ad</span>\n                arr[s], arr[s+<span class=\"hljs-number\">1</span>] = arr[s+<span class=\"hljs-number\">1</span>], arr[s]\n    <span class=\"hljs-keyword\">return</span> arr\n</code></div></pre>\n<h2><a id=\"_Select_Sort_23\"></a>\u9009\u62e9\u6392\u5e8f Select Sort</h2>\n<blockquote>\n<p>\u9996\u5148\uff0c\u627e\u5230\u6570\u7ec4\u4e2d\u6700\u5c0f\u7684\u5143\u7d20\uff0c\u62ce\u51fa\u6765\uff0c\u5c06\u5b83\u548c\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4ea4\u6362\u4f4d\u7f6e\uff0c\u7b2c\u4e8c\u6b65\uff0c\u5728\u5269\u4e0b\u7684\u5143\u7d20\u4e2d\u7ee7\u7eed\u5bfb\u627e\u6700\u5c0f\u7684\u5143\u7d20\uff0c\u62ce\u51fa\u6765\uff0c\u548c\u6570\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4ea4\u6362\u4f4d\u7f6e\uff0c\u5982\u6b64\u5faa\u73af\uff0c\u76f4\u5230\u6574\u4e2a\u6570\u7ec4\u6392\u5e8f\u5b8c\u6210\u3002</p>\n</blockquote>\n<p>\u6b65\u9aa4\uff1a</p>\n<ol>\n<li>\u672a\u6392\u5e8f\u5e8f\u5217\u4e2d\u627e\u5230\u6700\u5c0f\uff08\u5927\uff09\u5143\u7d20\uff0c\u5b58\u653e\u5230\u6392\u5e8f\u5e8f\u5217\u7684\u8d77\u59cb\u4f4d\u7f6e\u30022.</li>\n<li>\u518d\u4ece\u5269\u4f59\u672a\u6392\u5e8f\u5143\u7d20\u4e2d\u7ee7\u7eed\u5bfb\u627e\u6700\u5c0f\uff08\u5927\uff09\u5143\u7d20\uff0c\u7136\u540e\u653e\u5230\u5df2\u6392\u5e8f\u5e8f\u5217\u7684\u672b\u5c3e\u3002</li>\n<li>\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u6240\u6709\u5143\u7d20\u5747\u6392\u5e8f\u5b8c\u6bd5\u3002</li>\n</ol>\n<p>\u56fe\u89e3\uff1a<br />\n<img src=\"https://user-gold-cdn.xitu.io/2019/6/11/16b453956a0991d7?imageslim\" alt=\"\u9009\u62e9\u6392\u5e8f\" /></p>\n<p>\u5b9e\u73b0\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">select_sort</span><span class=\"hljs-params\">(arr)</span>:</span>\n    n = len(arr)\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">0</span>,n<span class=\"hljs-number\">-1</span>):\n        min = i                             <span class=\"hljs-comment\">#\u6700\u5c0f\u5143\u7d20\u4e0b\u6807\u6807\u8bb0</span>\n        <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> range(i+<span class=\"hljs-number\">1</span>,n):\n            <span class=\"hljs-keyword\">if</span> arr[j] &lt; arr[min] :\n                min = j                     <span class=\"hljs-comment\">#\u627e\u5230\u6700\u5c0f\u503c\u7684\u4e0b\u6807</span>\n        arr[min],arr[i] = arr[i],arr[min]   <span class=\"hljs-comment\">#\u4ea4\u6362\u4e24\u8005</span>\n    <span class=\"hljs-keyword\">return</span> arr\n</code></div></pre>\n<h2><a id=\"_Quick_Sort_46\"></a>\u5feb\u901f\u6392\u5e8f Quick Sort</h2>\n<blockquote>\n<p>\u5feb\u901f\u6392\u5e8f\u7684\u6838\u5fc3\u601d\u60f3\u4e5f\u662f\u5206\u6cbb\u6cd5\uff0c\u5206\u800c\u6cbb\u4e4b\u3002\u5b83\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u6bcf\u6b21\u4ece\u5e8f\u5217\u4e2d\u9009\u51fa\u4e00\u4e2a\u57fa\u51c6\u503c\uff0c\u5176\u4ed6\u6570\u4f9d\u6b21\u548c\u57fa\u51c6\u503c\u505a\u6bd4\u8f83\uff0c\u6bd4\u57fa\u51c6\u503c\u5927\u7684\u653e\u53f3\u8fb9\uff0c\u6bd4\u57fa\u51c6\u503c\u5c0f\u7684\u653e\u5de6\u8fb9\uff0c\u7136\u540e\u518d\u5bf9\u5de6\u8fb9\u548c\u53f3\u8fb9\u7684\u4e24\u7ec4\u6570\u5206\u522b\u9009\u51fa\u4e00\u4e2a\u57fa\u51c6\u503c\uff0c\u8fdb\u884c\u540c\u6837\u7684\u6bd4\u8f83\u79fb\u52a8\uff0c\u91cd\u590d\u6b65\u9aa4\uff0c\u76f4\u5230\u6700\u540e\u90fd\u53d8\u6210\u5355\u4e2a\u5143\u7d20\uff0c\u6574\u4e2a\u6570\u7ec4\u5c31\u6210\u4e86\u6709\u5e8f\u7684\u5e8f\u5217\u3002</p>\n</blockquote>\n<p>\u6b65\u9aa4\uff1a</p>\n<ol>\n<li>\u4ece\u6570\u5217\u4e2d\u6311\u51fa\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\u6570\u3002</li>\n<li>\u5206\u533a\u8fc7\u7a0b\uff0c\u5c06\u6bd4\u57fa\u51c6\u6570\u5927\u7684\u653e\u5230\u53f3\u8fb9\uff0c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u5b83\u7684\u6570\u90fd\u653e\u5230\u5de6\u8fb9\u3002</li>\n<li>\u518d\u5bf9\u5de6\u53f3\u533a\u95f4\u9012\u5f52\u6267\u884c\u7b2c\u4e8c\u6b65\uff0c\u76f4\u81f3\u5404\u533a\u95f4\u53ea\u6709\u4e00\u4e2a\u6570\u3002</li>\n</ol>\n<p>\u56fe\u89e3\uff1a<br />\n<img src=\"https://user-gold-cdn.xitu.io/2019/6/11/16b4539663f01105?imageslim\" alt=\"\u5feb\u901f\u6392\u5e8f\" /></p>\n<p>\u5b9e\u73b0\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">quicksort</span><span class=\"hljs-params\">(arr)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> len(arr) &lt;= <span class=\"hljs-number\">1</span>:\n\t<span class=\"hljs-keyword\">return</span> arr\n    <span class=\"hljs-keyword\">else</span>:\n\tpivot  = arr[<span class=\"hljs-number\">0</span>]\n\tless= [i <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> arr[<span class=\"hljs-number\">1</span>:] <span class=\"hljs-keyword\">if</span> i &lt; pivot]\n\tgreater= [i <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> arr[<span class=\"hljs-number\">1</span>:] <span class=\"hljs-keyword\">if</span> i &gt;= pivot]\n\t<span class=\"hljs-keyword\">return</span> quicksort(less) + [pivot] +quicksort(greater)\n</code></div></pre>\n<h2><a id=\"_Insert_Sort_69\"></a>\u63d2\u5165\u6392\u5e8f Insert Sort</h2>\n<blockquote>\n<p>\u5bf9\u4e8e\u6bcf\u4e2a\u672a\u6392\u5e8f\u6570\u636e\uff0c\u5728\u5df2\u6392\u5e8f\u5e8f\u5217\u4e2d\u4ece\u540e\u5411\u524d\u626b\u63cf\uff0c\u627e\u5230\u76f8\u5e94\u4f4d\u7f6e\u5e76\u63d2\u5165\u3002</p>\n</blockquote>\n<p>\u6b65\u9aa4\uff1a</p>\n<ol>\n<li>\u4ece\u7b2c\u4e00\u4e2a\u5143\u7d20\u5f00\u59cb\uff0c\u8be5\u5143\u7d20\u53ef\u4ee5\u8ba4\u4e3a\u5df2\u7ecf\u88ab\u6392\u5e8f\u3002</li>\n<li>\u53d6\u51fa\u4e0b\u4e00\u4e2a\u5143\u7d20\uff0c\u5728\u5df2\u7ecf\u6392\u5e8f\u7684\u5143\u7d20\u5e8f\u5217\u4e2d\u4ece\u540e\u5411\u524d\u626b\u63cf</li>\n<li>\u5982\u679c\u88ab\u626b\u63cf\u7684\u5143\u7d20\uff08\u5df2\u6392\u5e8f\uff09\u5927\u4e8e\u65b0\u5143\u7d20\uff0c\u5c06\u8be5\u5143\u7d20\u540e\u79fb\u4e00\u4f4d</li>\n<li>\u91cd\u590d\u6b65\u9aa43\uff0c\u76f4\u5230\u627e\u5230\u5df2\u6392\u5e8f\u7684\u5143\u7d20\u5c0f\u4e8e\u6216\u8005\u7b49\u4e8e\u65b0\u5143\u7d20\u7684\u4f4d\u7f6e</li>\n<li>\u5c06\u65b0\u5143\u7d20\u63d2\u5165\u5230\u8be5\u4f4d\u7f6e\u540e</li>\n<li>\u91cd\u590d\u6b65\u9aa42~5</li>\n<li></li>\n</ol>\n<p>\u56fe\u89e3\uff1a<br />\n<img src=\"https://user-gold-cdn.xitu.io/2019/6/11/16b45395941bac90?imageslim\" alt=\"\u63d2\u5165\u6392\u5e8f\" /><br />\n\u5b9e\u73b0\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">insert_sort</span><span class=\"hljs-params\">(arr)</span>:</span>\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(<span class=\"hljs-number\">1</span>,len(arr)):         <span class=\"hljs-comment\"># \u5143\u7d20\u4e0b\u6807\uff0c\u5faa\u73aflen-1\u6b21\uff0c\u4ece\u7b2c\u4e8c\u5f20\u724c\u5f00\u59cb\u6bd4\u8f83\u63d2\u5165</span>\n        tmp = arr[i]                    <span class=\"hljs-comment\"># \u9009\u62e9\u7684\u724c</span>\n        j = i<span class=\"hljs-number\">-1</span>                         <span class=\"hljs-comment\"># \u6709\u5e8f\u724c\u5806\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4e0b\u6807\uff08\u9009\u62e9\u724c\u7684\u4e0a\u4e00\u5f20\uff09</span>\n        <span class=\"hljs-keyword\">while</span> j &gt;=<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">and</span> arr[j]&gt;tmp:     <span class=\"hljs-comment\"># \u5982\u679c\u6709\u5e8f\u724c\u5806\u6700\u540e\u4e00\u5f20\u5927\u4e8e\u9009\u62e9\u7684\u724c\uff0c\u5c31\u5411\u540e\u632a\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5faa\u73af\u5f80\u590d</span>\n            arr[j+<span class=\"hljs-number\">1</span>] = arr[j]           <span class=\"hljs-comment\">#    \u76f4\u5230\u9009\u62e9\u7684\u724c\u7684\u524d\u4e00\u5f20\u5c0f\u4e8e\u9009\u62e9\u7684\u724c</span>\n            j-=<span class=\"hljs-number\">1</span>                        <span class=\"hljs-comment\">#    j\u5c0f\u4e8e0\uff0c\u8bf4\u660e\u9009\u62e9\u724c\u6bd4\u6709\u5e8f\u724c\u5806\u6240\u6709\u724c\u5c0f\uff0c\u5df2\u7ecf\u79fb\u52a8\u5230\u6700\u524d\u4f4d\u7f6e</span>\n        arr[j+<span class=\"hljs-number\">1</span>] = tmp\n    <span class=\"hljs-keyword\">return</span> arr\n</code></div></pre>\n<h2><a id=\"_Merge_Sort_94\"></a>\u5f52\u5e76\u6392\u5e8f Merge Sort</h2>\n<blockquote>\n<p>\u5f52\u5e76\u6392\u5e8f\u662f\u5efa\u7acb\u5728\u5f52\u5e76\u64cd\u4f5c\u4e0a\u7684\u4e00\u79cd\u6709\u6548\u7684\u6392\u5e8f\u7b97\u6cd5,\u8be5\u7b97\u6cd5\u662f\u91c7\u7528\u5206\u6cbb\u6cd5\uff08Divide and Conquer\uff09\u7684\u4e00\u4e2a\u975e\u5e38\u5178\u578b\u7684\u5e94\u7528\u3002\u5c06\u5df2\u6709\u5e8f\u7684\u5b50\u5e8f\u5217\u5408\u5e76\uff0c\u5f97\u5230\u5b8c\u5168\u6709\u5e8f\u7684\u5e8f\u5217\uff1b\u5373\u5148\u4f7f\u6bcf\u4e2a\u5b50\u5e8f\u5217\u6709\u5e8f\uff0c\u518d\u4f7f\u5b50\u5e8f\u5217\u6bb5\u95f4\u6709\u5e8f\u3002\u82e5\u5c06\u4e24\u4e2a\u6709\u5e8f\u8868\u5408\u5e76\u6210\u4e00\u4e2a\u6709\u5e8f\u8868\uff0c\u79f0\u4e3a\u4e8c\u8def\u5f52\u5e76\u3002</p>\n</blockquote>\n<p>\u6b65\u9aa4\uff1a</p>\n<ol>\n<li>\u5206\u89e3\uff0c\u4e8c\u5206\u5206\u89e3\u6210\u4e00\u4e2a\u4e2a\u5c0f\u5143\u7d20</li>\n<li>\u4e00\u4e2a\u4e2a\u5c0f\u5143\u7d20\u6392\u5e8f\u6210\u5217\u8868</li>\n<li>\u5217\u8868\u518d\u6392\u5e8f</li>\n</ol>\n<p>\u56fe\u89e3\uff1a<br />\n<img src=\"https://user-gold-cdn.xitu.io/2019/6/11/16b4539610746c9f?imageslim\" alt=\"\u5f52\u5e76\u6392\u5e8f\" /><br />\n\u5b9e\u73b0\uff1a</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">merge</span><span class=\"hljs-params\">(l1, l2)</span>:</span>  <span class=\"hljs-comment\"># \u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u5217\u8868</span>\n    l = []\n    i = j = <span class=\"hljs-number\">0</span>   <span class=\"hljs-comment\"># \u521d\u59cb\u5316\u5217\u8868\u7d22\u5f15</span>\n    <span class=\"hljs-keyword\">while</span> i &lt; len(l1) <span class=\"hljs-keyword\">and</span> j &lt; len(l2):      <span class=\"hljs-comment\"># \u5f53\u4e24\u4e2a\u5217\u8868\u7684\u5143\u7d20\u90fd\u6709\u672a\u52a0\u5165\u5728\u65b0\u5217\u8868\u91cc\u65f6</span>\n        <span class=\"hljs-keyword\">if</span> l1[i] &lt; l2[j]:                   \n            l.append(l1[i])\n            i += <span class=\"hljs-number\">1</span>\n        <span class=\"hljs-keyword\">else</span>:\n            l.append(l2[j])\n            j += <span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-keyword\">while</span> i &lt;len(l1):                       <span class=\"hljs-comment\"># \u4e00\u4e2a\u5217\u8868\u4e3a\u7a7a\uff0c\u53e6\u4e00\u4e2a\u5168\u90e8\u52a0\u5165</span>\n        l.append(l1[i])\n        i+=<span class=\"hljs-number\">1</span>\n    <span class=\"hljs-keyword\">while</span> j &lt;len(l2):\n        l.append(l2[j])\n        j+=<span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-keyword\">return</span> l\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">merge_sort</span><span class=\"hljs-params\">(arr)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> len(arr) &lt;= <span class=\"hljs-number\">1</span>:                       <span class=\"hljs-comment\"># \u5982\u679c\u5217\u8868\u957f\u5ea6\u5c0f\u4e8e\u4e00\uff0c\u8fd4\u56de\u5217\u8868</span>\n        <span class=\"hljs-keyword\">return</span> arr\n    mid = len(arr)//<span class=\"hljs-number\">2</span>                       <span class=\"hljs-comment\"># \u53d6\u4e2d\u95f4\u5143\u7d20\u4e8c\u5206\u5206\u89e3\u6210\u4e24\u4e2a\u5217\u8868</span>\n    left = merge_sort(arr[:mid])            <span class=\"hljs-comment\"># \u9012\u5f52\u5206\u89e3\uff0c\u76f4\u81f3\u5217\u8868\u5206\u6210n\u4e2a\u5143\u7d20</span>\n    right = merge_sort(arr[mid:])\n    <span class=\"hljs-keyword\">return</span> merge(left, right)               <span class=\"hljs-comment\"># \u4f9d\u6b21\u5408\u5e76\u76f4\u81f3\u5408\u6210\u4e00\u4e2a\u5217\u8868</span>\n</code></div></pre>\n<h2><a id=\"_Shell_Sort_134\"></a>\u5e0c\u5c14\u6392\u5e8f Shell Sort</h2>\n<h2><a id=\"_Heap_Sort_136\"></a>\u5806\u6392\u5e8f Heap Sort</h2>\n<h2><a id=\"_Bucket_Sort_138\"></a>\u6876\u6392\u5e8f Bucket Sort</h2>\n<h2><a id=\"_Radix_sort_140\"></a>\u57fa\u6570\u6392\u5e8f Radix sort</h2>", "body_md": "## \u5192\u6ce1\u6392\u5e8f Bubble Sort\n> \u5192\u6ce1\u6392\u5e8f\u7684\u539f\u7406\u975e\u5e38\u7b80\u5355\uff0c\u5b83\u91cd\u590d\u5730\u8d70\u8bbf\u8fc7\u8981\u6392\u5e8f\u7684\u6570\u5217\uff0c\u4e00\u6b21\u6bd4\u8f83\u4e24\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u4ed6\u4eec\u7684\u987a\u5e8f\u9519\u8bef\u5c31\u628a\u4ed6\u4eec\u4ea4\u6362\u8fc7\u6765\u3002\n\n\u6b65\u9aa4\uff1a\n1. \u6bd4\u8f83\u76f8\u90bb\u7684\u5143\u7d20\u3002\u5982\u679c\u7b2c\u4e00\u4e2a\u6bd4\u7b2c\u4e8c\u4e2a\u5927\uff0c\u5c31\u4ea4\u6362\u4ed6\u4eec\u4e24\u4e2a\u3002\n2. \u5bf9\u7b2c0\u4e2a\u5230\u7b2cn-1\u4e2a\u6570\u636e\u505a\u540c\u6837\u7684\u5de5\u4f5c\u3002\u8fd9\u65f6\uff0c\u6700\u5927\u7684\u6570\u5c31\u201c\u6d6e\u201d\u5230\u4e86\u6570\u7ec4\u6700\u540e\u7684\u4f4d\u7f6e\u4e0a\u3002\n3. \u9488\u5bf9\u6240\u6709\u7684\u5143\u7d20\u91cd\u590d\u4ee5\u4e0a\u7684\u6b65\u9aa4\uff0c\u9664\u4e86\u6700\u540e\u4e00\u4e2a\u3002\n4. \u6301\u7eed\u6bcf\u6b21\u5bf9\u8d8a\u6765\u8d8a\u5c11\u7684\u5143\u7d20\u91cd\u590d\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u76f4\u5230\u6ca1\u6709\u4efb\u4f55\u4e00\u5bf9\u6570\u5b57\u9700\u8981\u6bd4\u8f83\u3002\n\n\u56fe\u89e3\uff1a\n![\u5192\u6ce1\u6392\u5e8f](https://user-gold-cdn.xitu.io/2018/12/19/167c4383846a5ede?imageslim)\n\n\n\u5b9e\u73b0\uff1a\n```py\ndef bubble_sort(arr):\n    for i in range(len(arr)-1):    # \u5faa\u73af\u6b21\u6570\u4e3a\u957f\u5ea6-1\n        for s in range(len(arr)-i-1):  # \u5185\u5faa\u73af\u4ece\u5916\u5faa\u73af\u7ed3\u675f\u7d22\u5f15\u5f00\u59cb\n            if arr[s] > arr[s+1]:        # \u4ece\u7b2c\u4e00\u4e2a\u5143\u7d20\u5f00\u59cb\u5224\u65ad\n                arr[s], arr[s+1] = arr[s+1], arr[s]\n    return arr\n```\n\n## \u9009\u62e9\u6392\u5e8f Select Sort\n> \u9996\u5148\uff0c\u627e\u5230\u6570\u7ec4\u4e2d\u6700\u5c0f\u7684\u5143\u7d20\uff0c\u62ce\u51fa\u6765\uff0c\u5c06\u5b83\u548c\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4ea4\u6362\u4f4d\u7f6e\uff0c\u7b2c\u4e8c\u6b65\uff0c\u5728\u5269\u4e0b\u7684\u5143\u7d20\u4e2d\u7ee7\u7eed\u5bfb\u627e\u6700\u5c0f\u7684\u5143\u7d20\uff0c\u62ce\u51fa\u6765\uff0c\u548c\u6570\u7ec4\u7684\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4ea4\u6362\u4f4d\u7f6e\uff0c\u5982\u6b64\u5faa\u73af\uff0c\u76f4\u5230\u6574\u4e2a\u6570\u7ec4\u6392\u5e8f\u5b8c\u6210\u3002\n\n\u6b65\u9aa4\uff1a\n1. \u672a\u6392\u5e8f\u5e8f\u5217\u4e2d\u627e\u5230\u6700\u5c0f\uff08\u5927\uff09\u5143\u7d20\uff0c\u5b58\u653e\u5230\u6392\u5e8f\u5e8f\u5217\u7684\u8d77\u59cb\u4f4d\u7f6e\u30022.\n2. \u518d\u4ece\u5269\u4f59\u672a\u6392\u5e8f\u5143\u7d20\u4e2d\u7ee7\u7eed\u5bfb\u627e\u6700\u5c0f\uff08\u5927\uff09\u5143\u7d20\uff0c\u7136\u540e\u653e\u5230\u5df2\u6392\u5e8f\u5e8f\u5217\u7684\u672b\u5c3e\u3002\n3. \u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u6240\u6709\u5143\u7d20\u5747\u6392\u5e8f\u5b8c\u6bd5\u3002\n\n\u56fe\u89e3\uff1a\n![\u9009\u62e9\u6392\u5e8f](https://user-gold-cdn.xitu.io/2019/6/11/16b453956a0991d7?imageslim)\n\n\u5b9e\u73b0\uff1a\n```py\ndef select_sort(arr):\n    n = len(arr)\n    for i in range(0,n-1):\n        min = i                             #\u6700\u5c0f\u5143\u7d20\u4e0b\u6807\u6807\u8bb0\n        for j in range(i+1,n):\n            if arr[j] < arr[min] :\n                min = j                     #\u627e\u5230\u6700\u5c0f\u503c\u7684\u4e0b\u6807\n        arr[min],arr[i] = arr[i],arr[min]   #\u4ea4\u6362\u4e24\u8005\n    return arr\n```\n## \u5feb\u901f\u6392\u5e8f Quick Sort\n> \u5feb\u901f\u6392\u5e8f\u7684\u6838\u5fc3\u601d\u60f3\u4e5f\u662f\u5206\u6cbb\u6cd5\uff0c\u5206\u800c\u6cbb\u4e4b\u3002\u5b83\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u6bcf\u6b21\u4ece\u5e8f\u5217\u4e2d\u9009\u51fa\u4e00\u4e2a\u57fa\u51c6\u503c\uff0c\u5176\u4ed6\u6570\u4f9d\u6b21\u548c\u57fa\u51c6\u503c\u505a\u6bd4\u8f83\uff0c\u6bd4\u57fa\u51c6\u503c\u5927\u7684\u653e\u53f3\u8fb9\uff0c\u6bd4\u57fa\u51c6\u503c\u5c0f\u7684\u653e\u5de6\u8fb9\uff0c\u7136\u540e\u518d\u5bf9\u5de6\u8fb9\u548c\u53f3\u8fb9\u7684\u4e24\u7ec4\u6570\u5206\u522b\u9009\u51fa\u4e00\u4e2a\u57fa\u51c6\u503c\uff0c\u8fdb\u884c\u540c\u6837\u7684\u6bd4\u8f83\u79fb\u52a8\uff0c\u91cd\u590d\u6b65\u9aa4\uff0c\u76f4\u5230\u6700\u540e\u90fd\u53d8\u6210\u5355\u4e2a\u5143\u7d20\uff0c\u6574\u4e2a\u6570\u7ec4\u5c31\u6210\u4e86\u6709\u5e8f\u7684\u5e8f\u5217\u3002\n\n\u6b65\u9aa4\uff1a\n1. \u4ece\u6570\u5217\u4e2d\u6311\u51fa\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\u6570\u3002\n2. \u5206\u533a\u8fc7\u7a0b\uff0c\u5c06\u6bd4\u57fa\u51c6\u6570\u5927\u7684\u653e\u5230\u53f3\u8fb9\uff0c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u5b83\u7684\u6570\u90fd\u653e\u5230\u5de6\u8fb9\u3002\n3. \u518d\u5bf9\u5de6\u53f3\u533a\u95f4\u9012\u5f52\u6267\u884c\u7b2c\u4e8c\u6b65\uff0c\u76f4\u81f3\u5404\u533a\u95f4\u53ea\u6709\u4e00\u4e2a\u6570\u3002\n\n\u56fe\u89e3\uff1a\n![\u5feb\u901f\u6392\u5e8f](https://user-gold-cdn.xitu.io/2019/6/11/16b4539663f01105?imageslim)\n\n\u5b9e\u73b0\uff1a\n```py\ndef quicksort(arr):\n    if len(arr) <= 1:\n\treturn arr\n    else:\n\tpivot  = arr[0]\n\tless= [i for i in arr[1:] if i < pivot]\n\tgreater= [i for i in arr[1:] if i >= pivot]\n\treturn quicksort(less) + [pivot] +quicksort(greater)\n```\n\n## \u63d2\u5165\u6392\u5e8f Insert Sort\n> \u5bf9\u4e8e\u6bcf\u4e2a\u672a\u6392\u5e8f\u6570\u636e\uff0c\u5728\u5df2\u6392\u5e8f\u5e8f\u5217\u4e2d\u4ece\u540e\u5411\u524d\u626b\u63cf\uff0c\u627e\u5230\u76f8\u5e94\u4f4d\u7f6e\u5e76\u63d2\u5165\u3002\n\n\u6b65\u9aa4\uff1a\n1. \u4ece\u7b2c\u4e00\u4e2a\u5143\u7d20\u5f00\u59cb\uff0c\u8be5\u5143\u7d20\u53ef\u4ee5\u8ba4\u4e3a\u5df2\u7ecf\u88ab\u6392\u5e8f\u3002\n2. \u53d6\u51fa\u4e0b\u4e00\u4e2a\u5143\u7d20\uff0c\u5728\u5df2\u7ecf\u6392\u5e8f\u7684\u5143\u7d20\u5e8f\u5217\u4e2d\u4ece\u540e\u5411\u524d\u626b\u63cf\n3. \u5982\u679c\u88ab\u626b\u63cf\u7684\u5143\u7d20\uff08\u5df2\u6392\u5e8f\uff09\u5927\u4e8e\u65b0\u5143\u7d20\uff0c\u5c06\u8be5\u5143\u7d20\u540e\u79fb\u4e00\u4f4d\n4. \u91cd\u590d\u6b65\u9aa43\uff0c\u76f4\u5230\u627e\u5230\u5df2\u6392\u5e8f\u7684\u5143\u7d20\u5c0f\u4e8e\u6216\u8005\u7b49\u4e8e\u65b0\u5143\u7d20\u7684\u4f4d\u7f6e\n5. \u5c06\u65b0\u5143\u7d20\u63d2\u5165\u5230\u8be5\u4f4d\u7f6e\u540e\n6. \u91cd\u590d\u6b65\u9aa42~5\n7. \n\u56fe\u89e3\uff1a\n![\u63d2\u5165\u6392\u5e8f](https://user-gold-cdn.xitu.io/2019/6/11/16b45395941bac90?imageslim)\n\u5b9e\u73b0\uff1a\n```py\ndef insert_sort(arr):\n    for i in range(1,len(arr)):         # \u5143\u7d20\u4e0b\u6807\uff0c\u5faa\u73aflen-1\u6b21\uff0c\u4ece\u7b2c\u4e8c\u5f20\u724c\u5f00\u59cb\u6bd4\u8f83\u63d2\u5165\n        tmp = arr[i]                    # \u9009\u62e9\u7684\u724c\n        j = i-1                         # \u6709\u5e8f\u724c\u5806\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u4e0b\u6807\uff08\u9009\u62e9\u724c\u7684\u4e0a\u4e00\u5f20\uff09\n        while j >=0 and arr[j]>tmp:     # \u5982\u679c\u6709\u5e8f\u724c\u5806\u6700\u540e\u4e00\u5f20\u5927\u4e8e\u9009\u62e9\u7684\u724c\uff0c\u5c31\u5411\u540e\u632a\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5faa\u73af\u5f80\u590d\n            arr[j+1] = arr[j]           #    \u76f4\u5230\u9009\u62e9\u7684\u724c\u7684\u524d\u4e00\u5f20\u5c0f\u4e8e\u9009\u62e9\u7684\u724c\n            j-=1                        #    j\u5c0f\u4e8e0\uff0c\u8bf4\u660e\u9009\u62e9\u724c\u6bd4\u6709\u5e8f\u724c\u5806\u6240\u6709\u724c\u5c0f\uff0c\u5df2\u7ecf\u79fb\u52a8\u5230\u6700\u524d\u4f4d\u7f6e\n        arr[j+1] = tmp\n    return arr\n```\n## \u5f52\u5e76\u6392\u5e8f Merge Sort\n>\u5f52\u5e76\u6392\u5e8f\u662f\u5efa\u7acb\u5728\u5f52\u5e76\u64cd\u4f5c\u4e0a\u7684\u4e00\u79cd\u6709\u6548\u7684\u6392\u5e8f\u7b97\u6cd5,\u8be5\u7b97\u6cd5\u662f\u91c7\u7528\u5206\u6cbb\u6cd5\uff08Divide and Conquer\uff09\u7684\u4e00\u4e2a\u975e\u5e38\u5178\u578b\u7684\u5e94\u7528\u3002\u5c06\u5df2\u6709\u5e8f\u7684\u5b50\u5e8f\u5217\u5408\u5e76\uff0c\u5f97\u5230\u5b8c\u5168\u6709\u5e8f\u7684\u5e8f\u5217\uff1b\u5373\u5148\u4f7f\u6bcf\u4e2a\u5b50\u5e8f\u5217\u6709\u5e8f\uff0c\u518d\u4f7f\u5b50\u5e8f\u5217\u6bb5\u95f4\u6709\u5e8f\u3002\u82e5\u5c06\u4e24\u4e2a\u6709\u5e8f\u8868\u5408\u5e76\u6210\u4e00\u4e2a\u6709\u5e8f\u8868\uff0c\u79f0\u4e3a\u4e8c\u8def\u5f52\u5e76\u3002\n\n\u6b65\u9aa4\uff1a\n1. \u5206\u89e3\uff0c\u4e8c\u5206\u5206\u89e3\u6210\u4e00\u4e2a\u4e2a\u5c0f\u5143\u7d20\n2. \u4e00\u4e2a\u4e2a\u5c0f\u5143\u7d20\u6392\u5e8f\u6210\u5217\u8868\n3. \u5217\u8868\u518d\u6392\u5e8f\n\n\u56fe\u89e3\uff1a\n![\u5f52\u5e76\u6392\u5e8f](https://user-gold-cdn.xitu.io/2019/6/11/16b4539610746c9f?imageslim)\n\u5b9e\u73b0\uff1a\n```py\ndef merge(l1, l2):  # \u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u5217\u8868\n    l = []\n    i = j = 0   # \u521d\u59cb\u5316\u5217\u8868\u7d22\u5f15\n    while i < len(l1) and j < len(l2):      # \u5f53\u4e24\u4e2a\u5217\u8868\u7684\u5143\u7d20\u90fd\u6709\u672a\u52a0\u5165\u5728\u65b0\u5217\u8868\u91cc\u65f6\n        if l1[i] < l2[j]:                   \n            l.append(l1[i])\n            i += 1\n        else:\n            l.append(l2[j])\n            j += 1\n\n    while i <len(l1):                       # \u4e00\u4e2a\u5217\u8868\u4e3a\u7a7a\uff0c\u53e6\u4e00\u4e2a\u5168\u90e8\u52a0\u5165\n        l.append(l1[i])\n        i+=1\n    while j <len(l2):\n        l.append(l2[j])\n        j+=1\n\n    return l\n\ndef merge_sort(arr):\n    if len(arr) <= 1:                       # \u5982\u679c\u5217\u8868\u957f\u5ea6\u5c0f\u4e8e\u4e00\uff0c\u8fd4\u56de\u5217\u8868\n        return arr\n    mid = len(arr)//2                       # \u53d6\u4e2d\u95f4\u5143\u7d20\u4e8c\u5206\u5206\u89e3\u6210\u4e24\u4e2a\u5217\u8868\n    left = merge_sort(arr[:mid])            # \u9012\u5f52\u5206\u89e3\uff0c\u76f4\u81f3\u5217\u8868\u5206\u6210n\u4e2a\u5143\u7d20\n    right = merge_sort(arr[mid:])\n    return merge(left, right)               # \u4f9d\u6b21\u5408\u5e76\u76f4\u81f3\u5408\u6210\u4e00\u4e2a\u5217\u8868\n```\n## \u5e0c\u5c14\u6392\u5e8f Shell Sort\n\n## \u5806\u6392\u5e8f Heap Sort\n\n## \u6876\u6392\u5e8f Bucket Sort\n\n## \u57fa\u6570\u6392\u5e8f Radix sort", "excerpt": "\u5192\u6ce1\u6392\u5e8f Bubble Sort\n\n\u5192\u6ce1\u6392\u5e8f\u7684\u539f\u7406\u975e\u5e38\u7b80\u5355\uff0c\u5b83\u91cd\u590d\u5730\u8d70\u8bbf\u8fc7\u8981\u6392\u5e8f\u7684\u6570\u5217\uff0c\u4e00\u6b21\u6bd4\u8f83\u4e24\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u4ed6\u4eec\u7684\u987a\u5e8f\u9519\u8bef\u5c31\u628a\u4ed6\u4eec\u4ea4\u6362\u8fc7\u6765\u3002\n\n\u6b65\u9aa4\uff1a\n\n\u6bd4\u8f83\u76f8\u90bb\u7684\u5143\u7d20\u3002\u5982\u679c\u7b2c\u4e00\u4e2a\u6bd4\u7b2c\u4e8c\u4e2a\u5927\uff0c\u5c31\u4ea4\u6362\u4ed6\u4eec\u4e24\u4e2a\u3002\n\u5bf9\u7b2c0\u4e2a\u5230\u7b2cn-1\u4e2a\u6570\u636e\u505a\u540c\u6837\u7684\u5de5\u4f5c\u3002\u8fd9\u65f6\uff0c\u6700\u5927\u7684\u6570\u5c31\u201c\u6d6e\u201d\u5230\u4e86\u6570\u7ec4\u6700\u540e\u7684\u4f4d\u7f6e\u4e0a\u3002\n\u9488\u5bf9", "codestyle": "atelier-dune-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-10T22:51:17.643", "mod_date": "2020-03-12T12:06:04.186", "views_count": 22, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 1, "tags": []}}, {"model": "blog.post", "pk": 12, "fields": {"title": "python\u6570\u636e\u7c7b\u578b\uff08\u4e00\uff09", "body": "<h2><a id=\"string__0\"></a>string \u5b57\u7b26\u4e32</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u5e8f   \u53f7</th>\n<th style=\"text-align:left\">\u65b9\u6cd5\u53ca\u63cf\u8ff0</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-capitalize.html\" target=\"_blank\">capitalize()</a> \u5c06\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u8f6c\u6362\u4e3a\u5927\u5199</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-center.html\" target=\"_blank\">center(width, fillchar)</a> \u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u7684\u5bbd\u5ea6 width \u5c45\u4e2d\u7684\u5b57\u7b26\u4e32\uff0cfillchar \u4e3a\u586b\u5145\u7684\u5b57\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u683c\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-count.html\" target=\"_blank\">count(str, beg= 0,end=len(string))</a> \u8fd4\u56de str \u5728 string \u91cc\u9762\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5982\u679c beg \u6216\u8005 end \u6307\u5b9a\u5219\u8fd4\u56de\u6307\u5b9a\u8303\u56f4\u5185 str \u51fa\u73b0\u7684\u6b21\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-decode.html\" target=\"_blank\">bytes.decode(encoding=\u201cutf-8\u201d, errors=\u201cstrict\u201d)</a> Python3 \u4e2d\u6ca1\u6709 decode \u65b9\u6cd5\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 bytes \u5bf9\u8c61\u7684 decode() \u65b9\u6cd5\u6765\u89e3\u7801\u7ed9\u5b9a\u7684 bytes \u5bf9\u8c61\uff0c\u8fd9\u4e2a bytes \u5bf9\u8c61\u53ef\u4ee5\u7531 str.encode() \u6765\u7f16\u7801\u8fd4\u56de\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">5</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-encode.html\" target=\"_blank\">encode(encoding=\u2018UTF-8\u2019,errors=\u2018strict\u2019)</a> \u4ee5 encoding \u6307\u5b9a\u7684\u7f16\u7801\u683c\u5f0f\u7f16\u7801\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u51fa\u9519\u9ed8\u8ba4\u62a5\u4e00\u4e2aValueError \u7684\u5f02\u5e38\uff0c\u9664\u975e errors \u6307\u5b9a\u7684\u662f\u2019ignore\u2019\u6216\u8005\u2019replace\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">6</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-endswith.html\" target=\"_blank\">endswith(suffix, beg=0, end=len(string))</a> \u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u4ee5 obj \u7ed3\u675f\uff0c\u5982\u679cbeg \u6216\u8005 end \u6307\u5b9a\u5219\u68c0\u67e5\u6307\u5b9a\u7684\u8303\u56f4\u5185\u662f\u5426\u4ee5 obj \u7ed3\u675f\uff0c\u5982\u679c\u662f\uff0c\u8fd4\u56de True,\u5426\u5219\u8fd4\u56de False.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-expandtabs.html\" target=\"_blank\">expandtabs(tabsize=8)</a> \u628a\u5b57\u7b26\u4e32 string \u4e2d\u7684 tab \u7b26\u53f7\u8f6c\u4e3a\u7a7a\u683c\uff0ctab \u7b26\u53f7\u9ed8\u8ba4\u7684\u7a7a\u683c\u6570\u662f 8 \u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-find.html\" target=\"_blank\">find(str, beg=0, end=len(string))</a> \u68c0\u6d4b str \u662f\u5426\u5305\u542b\u5728\u5b57\u7b26\u4e32\u4e2d\uff0c\u5982\u679c\u6307\u5b9a\u8303\u56f4 beg \u548c end \uff0c\u5219\u68c0\u67e5\u662f\u5426\u5305\u542b\u5728\u6307\u5b9a\u8303\u56f4\u5185\uff0c\u5982\u679c\u5305\u542b\u8fd4\u56de\u5f00\u59cb\u7684\u7d22\u5f15\u503c\uff0c\u5426\u5219\u8fd4\u56de-1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-index.html\" target=\"_blank\">index(str, beg=0, end=len(string))</a> \u8ddffind()\u65b9\u6cd5\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u5982\u679cstr\u4e0d\u5728\u5b57\u7b26\u4e32\u4e2d\u4f1a\u62a5\u4e00\u4e2a\u5f02\u5e38.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">10</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-isalnum.html\" target=\"_blank\">isalnum()</a> \u5982\u679c\u5b57\u7b26\u4e32\u81f3\u5c11\u6709\u4e00\u4e2a\u5b57\u7b26\u5e76\u4e14\u6240\u6709\u5b57\u7b26\u90fd\u662f\u5b57\u6bcd\u6216\u6570\u5b57\u5219\u8fd4 \u56de True,\u5426\u5219\u8fd4\u56de False</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">11</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-isalpha.html\" target=\"_blank\">isalpha()</a> \u5982\u679c\u5b57\u7b26\u4e32\u81f3\u5c11\u6709\u4e00\u4e2a\u5b57\u7b26\u5e76\u4e14\u6240\u6709\u5b57\u7b26\u90fd\u662f\u5b57\u6bcd\u5219\u8fd4\u56de True, \u5426\u5219\u8fd4\u56de False</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">12</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-isdigit.html\" target=\"_blank\">isdigit()</a> \u5982\u679c\u5b57\u7b26\u4e32\u53ea\u5305\u542b\u6570\u5b57\u5219\u8fd4\u56de True \u5426\u5219\u8fd4\u56de False\u2026</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">13</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-islower.html\" target=\"_blank\">islower()</a> \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u533a\u5206\u5927\u5c0f\u5199\u7684\u5b57\u7b26\uff0c\u5e76\u4e14\u6240\u6709\u8fd9\u4e9b(\u533a\u5206\u5927\u5c0f\u5199\u7684)\u5b57\u7b26\u90fd\u662f\u5c0f\u5199\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">14</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-isnumeric.html\" target=\"_blank\">isnumeric()</a> \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u53ea\u5305\u542b\u6570\u5b57\u5b57\u7b26\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">15</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-isspace.html\" target=\"_blank\">isspace()</a> \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u53ea\u5305\u542b\u7a7a\u767d\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">16</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-istitle.html\" target=\"_blank\">istitle()</a> \u5982\u679c\u5b57\u7b26\u4e32\u662f\u6807\u9898\u5316\u7684(\u89c1 title())\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">17</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-isupper.html\" target=\"_blank\">isupper()</a> \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u533a\u5206\u5927\u5c0f\u5199\u7684\u5b57\u7b26\uff0c\u5e76\u4e14\u6240\u6709\u8fd9\u4e9b(\u533a\u5206\u5927\u5c0f\u5199\u7684)\u5b57\u7b26\u90fd\u662f\u5927\u5199\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">18</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-join.html\" target=\"_blank\">join(seq)</a> \u4ee5\u6307\u5b9a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u5c06 seq \u4e2d\u6240\u6709\u7684\u5143\u7d20(\u7684\u5b57\u7b26\u4e32\u8868\u793a)\u5408\u5e76\u4e3a\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">19</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-len.html\" target=\"_blank\">len(string)</a> \u8fd4\u56de\u5b57\u7b26\u4e32\u957f\u5ea6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">20</td>\n<td style=\"text-align:left\">[ljust(width<a href=\"https://www.runoob.com/python3/python3-string-ljust.html\" target=\"_blank\">, fillchar])</a> \u8fd4\u56de\u4e00\u4e2a\u539f\u5b57\u7b26\u4e32\u5de6\u5bf9\u9f50,\u5e76\u4f7f\u7528 fillchar \u586b\u5145\u81f3\u957f\u5ea6 width \u7684\u65b0\u5b57\u7b26\u4e32\uff0cfillchar \u9ed8\u8ba4\u4e3a\u7a7a\u683c\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">21</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-lower.html\" target=\"_blank\">lower()</a> \u8f6c\u6362\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u5927\u5199\u5b57\u7b26\u4e3a\u5c0f\u5199.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">22</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-lstrip.html\" target=\"_blank\">lstrip()</a> \u622a\u6389\u5b57\u7b26\u4e32\u5de6\u8fb9\u7684\u7a7a\u683c\u6216\u6307\u5b9a\u5b57\u7b26\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">23</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-maketrans.html\" target=\"_blank\">maketrans()</a> \u521b\u5efa\u5b57\u7b26\u6620\u5c04\u7684\u8f6c\u6362\u8868\uff0c\u5bf9\u4e8e\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\u7684\u6700\u7b80\u5355\u7684\u8c03\u7528\u65b9\u5f0f\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u9700\u8981\u8f6c\u6362\u7684\u5b57\u7b26\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e5f\u662f\u5b57\u7b26\u4e32\u8868\u793a\u8f6c\u6362\u7684\u76ee\u6807\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">24</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-max.html\" target=\"_blank\">max(str)</a> \u8fd4\u56de\u5b57\u7b26\u4e32 str \u4e2d\u6700\u5927\u7684\u5b57\u6bcd\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">25</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-min.html\" target=\"_blank\">min(str)</a> \u8fd4\u56de\u5b57\u7b26\u4e32 str \u4e2d\u6700\u5c0f\u7684\u5b57\u6bcd\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">26</td>\n<td style=\"text-align:left\">[replace(old, new <a href=\"https://www.runoob.com/python3/python3-string-replace.html\" target=\"_blank\">, max])</a> \u628a \u5c06\u5b57\u7b26\u4e32\u4e2d\u7684 str1 \u66ff\u6362\u6210 str2,\u5982\u679c max \u6307\u5b9a\uff0c\u5219\u66ff\u6362\u4e0d\u8d85\u8fc7 max \u6b21\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">27</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-rfind.html\" target=\"_blank\">rfind(str, beg=0,end=len(string))</a> \u7c7b\u4f3c\u4e8e find()\u51fd\u6570\uff0c\u4e0d\u8fc7\u662f\u4ece\u53f3\u8fb9\u5f00\u59cb\u67e5\u627e.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">28</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-rindex.html\" target=\"_blank\">rindex( str, beg=0, end=len(string))</a> \u7c7b\u4f3c\u4e8e index()\uff0c\u4e0d\u8fc7\u662f\u4ece\u53f3\u8fb9\u5f00\u59cb.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">29</td>\n<td style=\"text-align:left\">[rjust(width,<a href=\"https://www.runoob.com/python3/python3-string-rjust.html\" target=\"_blank\">, fillchar])</a> \u8fd4\u56de\u4e00\u4e2a\u539f\u5b57\u7b26\u4e32\u53f3\u5bf9\u9f50,\u5e76\u4f7f\u7528fillchar(\u9ed8\u8ba4\u7a7a\u683c\uff09\u586b\u5145\u81f3\u957f\u5ea6 width \u7684\u65b0\u5b57\u7b26\u4e32</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">30</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-rstrip.html\" target=\"_blank\">rstrip()</a> \u5220\u9664\u5b57\u7b26\u4e32\u5b57\u7b26\u4e32\u672b\u5c3e\u7684\u7a7a\u683c.</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">31</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-split.html\" target=\"_blank\">split(str=&quot;&quot;, num=string.count(str))</a> num=string.count(str)) \u4ee5 str \u4e3a\u5206\u9694\u7b26\u622a\u53d6\u5b57\u7b26\u4e32\uff0c\u5982\u679c num \u6709\u6307\u5b9a\u503c\uff0c\u5219\u4ec5\u622a\u53d6 num+1 \u4e2a\u5b50\u5b57\u7b26\u4e32</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">32</td>\n<td style=\"text-align:left\">[splitlines(<a href=\"https://www.runoob.com/python3/python3-string-splitlines.html\" target=\"_blank\">keepends])</a> \u6309\u7167\u884c(\u2019\\r\u2019, \u2018\\r\\n\u2019, \\n\u2019)\u5206\u9694\uff0c\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5404\u884c\u4f5c\u4e3a\u5143\u7d20\u7684\u5217\u8868\uff0c\u5982\u679c\u53c2\u6570 keepends \u4e3a False\uff0c\u4e0d\u5305\u542b\u6362\u884c\u7b26\uff0c\u5982\u679c\u4e3a True\uff0c\u5219\u4fdd\u7559\u6362\u884c\u7b26\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">33</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-startswith.html\" target=\"_blank\">startswith(substr, beg=0,end=len(string))</a> \u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u662f\u4ee5\u6307\u5b9a\u5b50\u5b57\u7b26\u4e32 substr \u5f00\u5934\uff0c\u662f\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False\u3002\u5982\u679cbeg \u548c end \u6307\u5b9a\u503c\uff0c\u5219\u5728\u6307\u5b9a\u8303\u56f4\u5185\u68c0\u67e5\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">34</td>\n<td style=\"text-align:left\">[strip(<a href=\"https://www.runoob.com/python3/python3-string-strip.html\" target=\"_blank\">chars])</a> \u5728\u5b57\u7b26\u4e32\u4e0a\u6267\u884c lstrip()\u548c rstrip()</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">35</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-swapcase.html\" target=\"_blank\">swapcase()</a> \u5c06\u5b57\u7b26\u4e32\u4e2d\u5927\u5199\u8f6c\u6362\u4e3a\u5c0f\u5199\uff0c\u5c0f\u5199\u8f6c\u6362\u4e3a\u5927\u5199</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">36</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-title.html\" target=\"_blank\">title()</a> \u8fd4\u56de&quot;\u6807\u9898\u5316&quot;\u7684\u5b57\u7b26\u4e32,\u5c31\u662f\u8bf4\u6240\u6709\u5355\u8bcd\u90fd\u662f\u4ee5\u5927\u5199\u5f00\u59cb\uff0c\u5176\u4f59\u5b57\u6bcd\u5747\u4e3a\u5c0f\u5199(\u89c1 istitle())</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">37</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-translate.html\" target=\"_blank\">translate(table, deletechars=&quot;&quot;)</a> \u6839\u636e str \u7ed9\u51fa\u7684\u8868(\u5305\u542b 256 \u4e2a\u5b57\u7b26)\u8f6c\u6362 string \u7684\u5b57\u7b26, \u8981\u8fc7\u6ee4\u6389\u7684\u5b57\u7b26\u653e\u5230 deletechars \u53c2\u6570\u4e2d</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">38</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-upper.html\" target=\"_blank\">upper()</a> \u8f6c\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u5c0f\u5199\u5b57\u6bcd\u4e3a\u5927\u5199</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">39</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-zfill.html\" target=\"_blank\">zfill (width)</a> \u8fd4\u56de\u957f\u5ea6\u4e3a width \u7684\u5b57\u7b26\u4e32\uff0c\u539f\u5b57\u7b26\u4e32\u53f3\u5bf9\u9f50\uff0c\u524d\u9762\u586b\u51450</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">40</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-string-isdecimal.html\" target=\"_blank\">isdecimal()</a> \u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u53ea\u5305\u542b\u5341\u8fdb\u5236\u5b57\u7b26\uff0c\u5982\u679c\u662f\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"int__float__45\"></a>int \u6574\u6570 /float \u6d6e\u70b9\u6570</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u51fd\u6570</th>\n<th style=\"text-align:left\">\u8fd4\u56de\u503c ( \u63cf\u8ff0 )</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-abs.html\" target=\"_blank\">abs(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6570\u5b57\u7684\u7edd\u5bf9\u503c\uff0c\u5982abs(-10) \u8fd4\u56de 10</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-ceil.html\" target=\"_blank\">ceil(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6570\u5b57\u7684\u4e0a\u5165\u6574\u6570\uff0c\u5982math.ceil(4.1) \u8fd4\u56de 5</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">cmp(x, y)</td>\n<td style=\"text-align:left\">\u5982\u679c x &lt; y \u8fd4\u56de -1, \u5982\u679c x == y \u8fd4\u56de 0, \u5982\u679c x &gt; y \u8fd4\u56de 1\u3002 **Python 3 \u5df2\u5e9f\u5f03\uff0c\u4f7f\u7528 (x&gt;y)-(x\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-exp.html\" target=\"_blank\">exp(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56dee\u7684x\u6b21\u5e42(ex),\u5982math.exp(1) \u8fd4\u56de2.718281828459045</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-fabs.html\" target=\"_blank\">fabs(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6570\u5b57\u7684\u7edd\u5bf9\u503c\uff0c\u5982math.fabs(-10) \u8fd4\u56de10.0</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-floor.html\" target=\"_blank\">floor(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6570\u5b57\u7684\u4e0b\u820d\u6574\u6570\uff0c\u5982math.floor(4.9)\u8fd4\u56de 4</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-log.html\" target=\"_blank\">log(x)</a></td>\n<td style=\"text-align:left\">\u5982math.log(math.e)\u8fd4\u56de1.0,math.log(100,10)\u8fd4\u56de2.0</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-log10.html\" target=\"_blank\">log10(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u4ee510\u4e3a\u57fa\u6570\u7684x\u7684\u5bf9\u6570\uff0c\u5982math.log10(100)\u8fd4\u56de 2.0</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-max.html\" target=\"_blank\">max(x1, x2,\u2026)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u7ed9\u5b9a\u53c2\u6570\u7684\u6700\u5927\u503c\uff0c\u53c2\u6570\u53ef\u4ee5\u4e3a\u5e8f\u5217\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-min.html\" target=\"_blank\">min(x1, x2,\u2026)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u7ed9\u5b9a\u53c2\u6570\u7684\u6700\u5c0f\u503c\uff0c\u53c2\u6570\u53ef\u4ee5\u4e3a\u5e8f\u5217\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-modf.html\" target=\"_blank\">modf(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56dex\u7684\u6574\u6570\u90e8\u5206\u4e0e\u5c0f\u6570\u90e8\u5206\uff0c\u4e24\u90e8\u5206\u7684\u6570\u503c\u7b26\u53f7\u4e0ex\u76f8\u540c\uff0c\u6574\u6570\u90e8\u5206\u4ee5\u6d6e\u70b9\u578b\u8868\u793a\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-pow.html\" target=\"_blank\">pow(x, y)</a></td>\n<td style=\"text-align:left\">x**y \u8fd0\u7b97\u540e\u7684\u503c\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">[round(x <a href=\"https://www.runoob.com/python3/python3-func-number-round.html\" target=\"_blank\">,n])</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6d6e\u70b9\u6570x\u7684\u56db\u820d\u4e94\u5165\u503c\uff0c\u5982\u7ed9\u51fan\u503c\uff0c\u5219\u4ee3\u8868\u820d\u5165\u5230\u5c0f\u6570\u70b9\u540e\u7684\u4f4d\u6570\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-func-number-sqrt.html\" target=\"_blank\">sqrt(x)</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6570\u5b57x\u7684\u5e73\u65b9\u6839\u3002</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"bool__62\"></a>bool \u5e03\u5c14\u503c</h2>\n<h2><a id=\"list__63\"></a>list \u5217\u8868</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u5e8f\u53f7</th>\n<th style=\"text-align:left\">\u65b9\u6cd5</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-append.html\" target=\"_blank\">list.append(obj)</a> \u5728\u5217\u8868\u672b\u5c3e\u6dfb\u52a0\u65b0\u7684\u5bf9\u8c61</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-count.html\" target=\"_blank\">list.count(obj)</a> \u7edf\u8ba1\u67d0\u4e2a\u5143\u7d20\u5728\u5217\u8868\u4e2d\u51fa\u73b0\u7684\u6b21\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-extend.html\" target=\"_blank\">list.extend(seq)</a> \u5728\u5217\u8868\u672b\u5c3e\u4e00\u6b21\u6027\u8ffd\u52a0\u53e6\u4e00\u4e2a\u5e8f\u5217\u4e2d\u7684\u591a\u4e2a\u503c\uff08\u7528\u65b0\u5217\u8868\u6269\u5c55\u539f\u6765\u7684\u5217\u8868\uff09</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-index.html\" target=\"_blank\">list.index(obj)</a> \u4ece\u5217\u8868\u4e2d\u627e\u51fa\u67d0\u4e2a\u503c\u7b2c\u4e00\u4e2a\u5339\u914d\u9879\u7684\u7d22\u5f15\u4f4d\u7f6e</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">5</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-insert.html\" target=\"_blank\">list.insert(index, obj)</a> \u5c06\u5bf9\u8c61\u63d2\u5165\u5217\u8868</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">6</td>\n<td style=\"text-align:left\">[list.pop(<a href=\"https://www.runoob.com/python3/python3-att-list-pop.html\" target=\"_blank\">index=-1])</a> \u79fb\u9664\u5217\u8868\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\uff08\u9ed8\u8ba4\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff09\uff0c\u5e76\u4e14\u8fd4\u56de\u8be5\u5143\u7d20\u7684\u503c</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-remove.html\" target=\"_blank\">list.remove(obj)</a> \u79fb\u9664\u5217\u8868\u4e2d\u67d0\u4e2a\u503c\u7684\u7b2c\u4e00\u4e2a\u5339\u914d\u9879</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-reverse.html\" target=\"_blank\">list.reverse()</a> \u53cd\u5411\u5217\u8868\u4e2d\u5143\u7d20</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-sort.html\" target=\"_blank\">list.sort( key=None, reverse=False)</a> \u5bf9\u539f\u5217\u8868\u8fdb\u884c\u6392\u5e8f</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">10</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-clear.html\" target=\"_blank\">list.clear()</a> \u6e05\u7a7a\u5217\u8868</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">11</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-list-copy.html\" target=\"_blank\">list.copy()</a> \u590d\u5236\u5217\u8868</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"tuple__77\"></a>tuple \u5143\u7ec4</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u65b9\u6cd5\u53ca\u63cf\u8ff0</th>\n<th style=\"text-align:left\">\u5b9e\u4f8b</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">len(tuple) \u8ba1\u7b97\u5143\u7ec4\u5143\u7d20\u4e2a\u6570\u3002</td>\n<td style=\"text-align:left\"><code>&gt;&gt;&gt; tuple1 = ('Google', 'Runoob', 'Taobao') &gt;&gt;&gt; len(tuple1) 3 &gt;&gt;&gt;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">max(tuple) \u8fd4\u56de\u5143\u7ec4\u4e2d\u5143\u7d20\u6700\u5927\u503c\u3002</td>\n<td style=\"text-align:left\"><code>&gt;&gt;&gt; tuple2 = ('5', '4', '8') &gt;&gt;&gt; max(tuple2) '8' &gt;&gt;&gt;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">min(tuple) \u8fd4\u56de\u5143\u7ec4\u4e2d\u5143\u7d20\u6700\u5c0f\u503c\u3002</td>\n<td style=\"text-align:left\"><code>&gt;&gt;&gt; tuple2 = ('5', '4', '8') &gt;&gt;&gt; min(tuple2) '4' &gt;&gt;&gt;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">tuple(seq) \u5c06\u5217\u8868\u8f6c\u6362\u4e3a\u5143\u7ec4\u3002</td>\n<td style=\"text-align:left\"><code>&gt;&gt;&gt; list1= ['Google', 'Taobao', 'Runoob', 'Baidu'] &gt;&gt;&gt; tuple1=tuple(list1) &gt;&gt;&gt; tuple1 ('Google', 'Taobao', 'Runoob', 'Baidu')</code></td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"dict__84\"></a>dict \u5b57\u5178</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u5e8f\u53f7</th>\n<th style=\"text-align:left\">\u51fd\u6570\u53ca\u63cf\u8ff0</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-clear.html\" target=\"_blank\">radiansdict.clear()</a> \u5220\u9664\u5b57\u5178\u5185\u6240\u6709\u5143\u7d20</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-copy.html\" target=\"_blank\">radiansdict.copy()</a> \u8fd4\u56de\u4e00\u4e2a\u5b57\u5178\u7684\u6d45\u590d\u5236</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">3</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-fromkeys.html\" target=\"_blank\">radiansdict.fromkeys()</a> \u521b\u5efa\u4e00\u4e2a\u65b0\u5b57\u5178\uff0c\u4ee5\u5e8f\u5217seq\u4e2d\u5143\u7d20\u505a\u5b57\u5178\u7684\u952e\uff0cval\u4e3a\u5b57\u5178\u6240\u6709\u952e\u5bf9\u5e94\u7684\u521d\u59cb\u503c</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-get.html\" target=\"_blank\">radiansdict.get(key, default=None)</a> \u8fd4\u56de\u6307\u5b9a\u952e\u7684\u503c\uff0c\u5982\u679c\u503c\u4e0d\u5728\u5b57\u5178\u4e2d\u8fd4\u56dedefault\u503c</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">5</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-in.html\" target=\"_blank\">key in dict</a> \u5982\u679c\u952e\u5728\u5b57\u5178dict\u91cc\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">6</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-items.html\" target=\"_blank\">radiansdict.items()</a> \u4ee5\u5217\u8868\u8fd4\u56de\u53ef\u904d\u5386\u7684(\u952e, \u503c) \u5143\u7ec4\u6570\u7ec4</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">7</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-keys.html\" target=\"_blank\">radiansdict.keys()</a> \u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 list() \u6765\u8f6c\u6362\u4e3a\u5217\u8868</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-setdefault.html\" target=\"_blank\">radiansdict.setdefault(key, default=None)</a> \u548cget()\u7c7b\u4f3c, \u4f46\u5982\u679c\u952e\u4e0d\u5b58\u5728\u4e8e\u5b57\u5178\u4e2d\uff0c\u5c06\u4f1a\u6dfb\u52a0\u952e\u5e76\u5c06\u503c\u8bbe\u4e3adefault</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">9</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-update.html\" target=\"_blank\">radiansdict.update(dict2)</a> \u628a\u5b57\u5178dict2\u7684\u952e/\u503c\u5bf9\u66f4\u65b0\u5230dict\u91cc</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">10</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-values.html\" target=\"_blank\">radiansdict.values()</a> \u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 list() \u6765\u8f6c\u6362\u4e3a\u5217\u8868</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">11</td>\n<td style=\"text-align:left\">[pop(key<a href=\"https://www.runoob.com/python3/python3-att-dictionary-pop.html\" target=\"_blank\">,default])</a> \u5220\u9664\u5b57\u5178\u7ed9\u5b9a\u952e key \u6240\u5bf9\u5e94\u7684\u503c\uff0c\u8fd4\u56de\u503c\u4e3a\u88ab\u5220\u9664\u7684\u503c\u3002key\u503c\u5fc5\u987b\u7ed9\u51fa\u3002 \u5426\u5219\uff0c\u8fd4\u56dedefault\u503c\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">12</td>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/python3-att-dictionary-popitem.html\" target=\"_blank\">popitem()</a> \u968f\u673a\u8fd4\u56de\u5e76\u5220\u9664\u5b57\u5178\u4e2d\u7684\u6700\u540e\u4e00\u5bf9\u952e\u548c\u503c\u3002</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"set__99\"></a>set \u96c6\u5408</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u63cf\u8ff0</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-add.html\" target=\"_blank\">add()</a></td>\n<td style=\"text-align:left\">\u4e3a\u96c6\u5408\u6dfb\u52a0\u5143\u7d20</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-clear.html\" target=\"_blank\">clear()</a></td>\n<td style=\"text-align:left\">\u79fb\u9664\u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-copy.html\" target=\"_blank\">copy()</a></td>\n<td style=\"text-align:left\">\u62f7\u8d1d\u4e00\u4e2a\u96c6\u5408</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-difference.html\" target=\"_blank\">difference()</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u591a\u4e2a\u96c6\u5408\u7684\u5dee\u96c6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-difference_update.html\" target=\"_blank\">difference_update()</a></td>\n<td style=\"text-align:left\">\u79fb\u9664\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff0c\u8be5\u5143\u7d20\u5728\u6307\u5b9a\u7684\u96c6\u5408\u4e5f\u5b58\u5728\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-discard.html\" target=\"_blank\">discard()</a></td>\n<td style=\"text-align:left\">\u5220\u9664\u96c6\u5408\u4e2d\u6307\u5b9a\u7684\u5143\u7d20</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-intersection.html\" target=\"_blank\">intersection()</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u96c6\u5408\u7684\u4ea4\u96c6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-intersection_update.html\" target=\"_blank\">intersection_update()</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u96c6\u5408\u7684\u4ea4\u96c6\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-isdisjoint.html\" target=\"_blank\">isdisjoint()</a></td>\n<td style=\"text-align:left\">\u5224\u65ad\u4e24\u4e2a\u96c6\u5408\u662f\u5426\u5305\u542b\u76f8\u540c\u7684\u5143\u7d20\uff0c\u5982\u679c\u6ca1\u6709\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-issubset.html\" target=\"_blank\">issubset()</a></td>\n<td style=\"text-align:left\">\u5224\u65ad\u6307\u5b9a\u96c6\u5408\u662f\u5426\u4e3a\u8be5\u65b9\u6cd5\u53c2\u6570\u96c6\u5408\u7684\u5b50\u96c6\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-issuperset.html\" target=\"_blank\">issuperset()</a></td>\n<td style=\"text-align:left\">\u5224\u65ad\u8be5\u65b9\u6cd5\u7684\u53c2\u6570\u96c6\u5408\u662f\u5426\u4e3a\u6307\u5b9a\u96c6\u5408\u7684\u5b50\u96c6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-pop.html\" target=\"_blank\">pop()</a></td>\n<td style=\"text-align:left\">\u968f\u673a\u79fb\u9664\u5143\u7d20</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-remove.html\" target=\"_blank\">remove()</a></td>\n<td style=\"text-align:left\">\u79fb\u9664\u6307\u5b9a\u5143\u7d20</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-symmetric_difference.html\" target=\"_blank\">symmetric_difference()</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u4e24\u4e2a\u96c6\u5408\u4e2d\u4e0d\u91cd\u590d\u7684\u5143\u7d20\u96c6\u5408\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-symmetric_difference_update.html\" target=\"_blank\">symmetric_difference_update()</a></td>\n<td style=\"text-align:left\">\u79fb\u9664\u5f53\u524d\u96c6\u5408\u4e2d\u5728\u53e6\u5916\u4e00\u4e2a\u6307\u5b9a\u96c6\u5408\u76f8\u540c\u7684\u5143\u7d20\uff0c\u5e76\u5c06\u53e6\u5916\u4e00\u4e2a\u6307\u5b9a\u96c6\u5408\u4e2d\u4e0d\u540c\u7684\u5143\u7d20\u63d2\u5165\u5230\u5f53\u524d\u96c6\u5408\u4e2d\u3002</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-union.html\" target=\"_blank\">union()</a></td>\n<td style=\"text-align:left\">\u8fd4\u56de\u4e24\u4e2a\u96c6\u5408\u7684\u5e76\u96c6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><a href=\"https://www.runoob.com/python3/ref-set-update.html\" target=\"_blank\">update()</a></td>\n<td style=\"text-align:left\">\u7ed9\u96c6\u5408\u6dfb\u52a0\u5143\u7d20</td>\n</tr>\n</tbody>\n</table>", "body_md": "## string \u5b57\u7b26\u4e32\n| \u5e8f   \u53f7 | \u65b9\u6cd5\u53ca\u63cf\u8ff0                                                   |\n| :------ | :----------------------------------------------------------- |\n| 1       | [capitalize()](https://www.runoob.com/python3/python3-string-capitalize.html) \u5c06\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u8f6c\u6362\u4e3a\u5927\u5199 |\n| 2       | [center(width, fillchar)](https://www.runoob.com/python3/python3-string-center.html) \u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u7684\u5bbd\u5ea6 width \u5c45\u4e2d\u7684\u5b57\u7b26\u4e32\uff0cfillchar \u4e3a\u586b\u5145\u7684\u5b57\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u683c\u3002 |\n| 3       | [count(str, beg= 0,end=len(string))](https://www.runoob.com/python3/python3-string-count.html) \u8fd4\u56de str \u5728 string \u91cc\u9762\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5982\u679c beg \u6216\u8005 end \u6307\u5b9a\u5219\u8fd4\u56de\u6307\u5b9a\u8303\u56f4\u5185 str \u51fa\u73b0\u7684\u6b21\u6570 |\n| 4       | [bytes.decode(encoding=\"utf-8\", errors=\"strict\")](https://www.runoob.com/python3/python3-string-decode.html) Python3 \u4e2d\u6ca1\u6709 decode \u65b9\u6cd5\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 bytes \u5bf9\u8c61\u7684 decode() \u65b9\u6cd5\u6765\u89e3\u7801\u7ed9\u5b9a\u7684 bytes \u5bf9\u8c61\uff0c\u8fd9\u4e2a bytes \u5bf9\u8c61\u53ef\u4ee5\u7531 str.encode() \u6765\u7f16\u7801\u8fd4\u56de\u3002 |\n| 5       | [encode(encoding='UTF-8',errors='strict')](https://www.runoob.com/python3/python3-string-encode.html) \u4ee5 encoding \u6307\u5b9a\u7684\u7f16\u7801\u683c\u5f0f\u7f16\u7801\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u51fa\u9519\u9ed8\u8ba4\u62a5\u4e00\u4e2aValueError \u7684\u5f02\u5e38\uff0c\u9664\u975e errors \u6307\u5b9a\u7684\u662f'ignore'\u6216\u8005'replace' |\n| 6       | [endswith(suffix, beg=0, end=len(string))](https://www.runoob.com/python3/python3-string-endswith.html) \u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u4ee5 obj \u7ed3\u675f\uff0c\u5982\u679cbeg \u6216\u8005 end \u6307\u5b9a\u5219\u68c0\u67e5\u6307\u5b9a\u7684\u8303\u56f4\u5185\u662f\u5426\u4ee5 obj \u7ed3\u675f\uff0c\u5982\u679c\u662f\uff0c\u8fd4\u56de True,\u5426\u5219\u8fd4\u56de False. |\n| 7       | [expandtabs(tabsize=8)](https://www.runoob.com/python3/python3-string-expandtabs.html) \u628a\u5b57\u7b26\u4e32 string \u4e2d\u7684 tab \u7b26\u53f7\u8f6c\u4e3a\u7a7a\u683c\uff0ctab \u7b26\u53f7\u9ed8\u8ba4\u7684\u7a7a\u683c\u6570\u662f 8 \u3002 |\n| 8       | [find(str, beg=0, end=len(string))](https://www.runoob.com/python3/python3-string-find.html) \u68c0\u6d4b str \u662f\u5426\u5305\u542b\u5728\u5b57\u7b26\u4e32\u4e2d\uff0c\u5982\u679c\u6307\u5b9a\u8303\u56f4 beg \u548c end \uff0c\u5219\u68c0\u67e5\u662f\u5426\u5305\u542b\u5728\u6307\u5b9a\u8303\u56f4\u5185\uff0c\u5982\u679c\u5305\u542b\u8fd4\u56de\u5f00\u59cb\u7684\u7d22\u5f15\u503c\uff0c\u5426\u5219\u8fd4\u56de-1 |\n| 9       | [index(str, beg=0, end=len(string))](https://www.runoob.com/python3/python3-string-index.html) \u8ddffind()\u65b9\u6cd5\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u5982\u679cstr\u4e0d\u5728\u5b57\u7b26\u4e32\u4e2d\u4f1a\u62a5\u4e00\u4e2a\u5f02\u5e38. |\n| 10      | [isalnum()](https://www.runoob.com/python3/python3-string-isalnum.html) \u5982\u679c\u5b57\u7b26\u4e32\u81f3\u5c11\u6709\u4e00\u4e2a\u5b57\u7b26\u5e76\u4e14\u6240\u6709\u5b57\u7b26\u90fd\u662f\u5b57\u6bcd\u6216\u6570\u5b57\u5219\u8fd4 \u56de True,\u5426\u5219\u8fd4\u56de False |\n| 11      | [isalpha()](https://www.runoob.com/python3/python3-string-isalpha.html) \u5982\u679c\u5b57\u7b26\u4e32\u81f3\u5c11\u6709\u4e00\u4e2a\u5b57\u7b26\u5e76\u4e14\u6240\u6709\u5b57\u7b26\u90fd\u662f\u5b57\u6bcd\u5219\u8fd4\u56de True, \u5426\u5219\u8fd4\u56de False |\n| 12      | [isdigit()](https://www.runoob.com/python3/python3-string-isdigit.html) \u5982\u679c\u5b57\u7b26\u4e32\u53ea\u5305\u542b\u6570\u5b57\u5219\u8fd4\u56de True \u5426\u5219\u8fd4\u56de False.. |\n| 13      | [islower()](https://www.runoob.com/python3/python3-string-islower.html) \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u533a\u5206\u5927\u5c0f\u5199\u7684\u5b57\u7b26\uff0c\u5e76\u4e14\u6240\u6709\u8fd9\u4e9b(\u533a\u5206\u5927\u5c0f\u5199\u7684)\u5b57\u7b26\u90fd\u662f\u5c0f\u5199\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False |\n| 14      | [isnumeric()](https://www.runoob.com/python3/python3-string-isnumeric.html) \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u53ea\u5305\u542b\u6570\u5b57\u5b57\u7b26\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False |\n| 15      | [isspace()](https://www.runoob.com/python3/python3-string-isspace.html) \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u53ea\u5305\u542b\u7a7a\u767d\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False. |\n| 16      | [istitle()](https://www.runoob.com/python3/python3-string-istitle.html) \u5982\u679c\u5b57\u7b26\u4e32\u662f\u6807\u9898\u5316\u7684(\u89c1 title())\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False |\n| 17      | [isupper()](https://www.runoob.com/python3/python3-string-isupper.html) \u5982\u679c\u5b57\u7b26\u4e32\u4e2d\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u533a\u5206\u5927\u5c0f\u5199\u7684\u5b57\u7b26\uff0c\u5e76\u4e14\u6240\u6709\u8fd9\u4e9b(\u533a\u5206\u5927\u5c0f\u5199\u7684)\u5b57\u7b26\u90fd\u662f\u5927\u5199\uff0c\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False |\n| 18      | [join(seq)](https://www.runoob.com/python3/python3-string-join.html) \u4ee5\u6307\u5b9a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u5c06 seq \u4e2d\u6240\u6709\u7684\u5143\u7d20(\u7684\u5b57\u7b26\u4e32\u8868\u793a)\u5408\u5e76\u4e3a\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32 |\n| 19      | [len(string)](https://www.runoob.com/python3/python3-string-len.html) \u8fd4\u56de\u5b57\u7b26\u4e32\u957f\u5ea6 |\n| 20      | [ljust(width[, fillchar\\])](https://www.runoob.com/python3/python3-string-ljust.html) \u8fd4\u56de\u4e00\u4e2a\u539f\u5b57\u7b26\u4e32\u5de6\u5bf9\u9f50,\u5e76\u4f7f\u7528 fillchar \u586b\u5145\u81f3\u957f\u5ea6 width \u7684\u65b0\u5b57\u7b26\u4e32\uff0cfillchar \u9ed8\u8ba4\u4e3a\u7a7a\u683c\u3002 |\n| 21      | [lower()](https://www.runoob.com/python3/python3-string-lower.html) \u8f6c\u6362\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u5927\u5199\u5b57\u7b26\u4e3a\u5c0f\u5199. |\n| 22      | [lstrip()](https://www.runoob.com/python3/python3-string-lstrip.html) \u622a\u6389\u5b57\u7b26\u4e32\u5de6\u8fb9\u7684\u7a7a\u683c\u6216\u6307\u5b9a\u5b57\u7b26\u3002 |\n| 23      | [maketrans()](https://www.runoob.com/python3/python3-string-maketrans.html) \u521b\u5efa\u5b57\u7b26\u6620\u5c04\u7684\u8f6c\u6362\u8868\uff0c\u5bf9\u4e8e\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\u7684\u6700\u7b80\u5355\u7684\u8c03\u7528\u65b9\u5f0f\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u9700\u8981\u8f6c\u6362\u7684\u5b57\u7b26\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e5f\u662f\u5b57\u7b26\u4e32\u8868\u793a\u8f6c\u6362\u7684\u76ee\u6807\u3002 |\n| 24      | [max(str)](https://www.runoob.com/python3/python3-string-max.html) \u8fd4\u56de\u5b57\u7b26\u4e32 str \u4e2d\u6700\u5927\u7684\u5b57\u6bcd\u3002 |\n| 25      | [min(str)](https://www.runoob.com/python3/python3-string-min.html) \u8fd4\u56de\u5b57\u7b26\u4e32 str \u4e2d\u6700\u5c0f\u7684\u5b57\u6bcd\u3002 |\n| 26      | [replace(old, new [, max\\])](https://www.runoob.com/python3/python3-string-replace.html) \u628a \u5c06\u5b57\u7b26\u4e32\u4e2d\u7684 str1 \u66ff\u6362\u6210 str2,\u5982\u679c max \u6307\u5b9a\uff0c\u5219\u66ff\u6362\u4e0d\u8d85\u8fc7 max \u6b21\u3002 |\n| 27      | [rfind(str, beg=0,end=len(string))](https://www.runoob.com/python3/python3-string-rfind.html) \u7c7b\u4f3c\u4e8e find()\u51fd\u6570\uff0c\u4e0d\u8fc7\u662f\u4ece\u53f3\u8fb9\u5f00\u59cb\u67e5\u627e. |\n| 28      | [rindex( str, beg=0, end=len(string))](https://www.runoob.com/python3/python3-string-rindex.html) \u7c7b\u4f3c\u4e8e index()\uff0c\u4e0d\u8fc7\u662f\u4ece\u53f3\u8fb9\u5f00\u59cb. |\n| 29      | [rjust(width,[, fillchar\\])](https://www.runoob.com/python3/python3-string-rjust.html) \u8fd4\u56de\u4e00\u4e2a\u539f\u5b57\u7b26\u4e32\u53f3\u5bf9\u9f50,\u5e76\u4f7f\u7528fillchar(\u9ed8\u8ba4\u7a7a\u683c\uff09\u586b\u5145\u81f3\u957f\u5ea6 width \u7684\u65b0\u5b57\u7b26\u4e32 |\n| 30      | [rstrip()](https://www.runoob.com/python3/python3-string-rstrip.html) \u5220\u9664\u5b57\u7b26\u4e32\u5b57\u7b26\u4e32\u672b\u5c3e\u7684\u7a7a\u683c. |\n| 31      | [split(str=\"\", num=string.count(str))](https://www.runoob.com/python3/python3-string-split.html) num=string.count(str)) \u4ee5 str \u4e3a\u5206\u9694\u7b26\u622a\u53d6\u5b57\u7b26\u4e32\uff0c\u5982\u679c num \u6709\u6307\u5b9a\u503c\uff0c\u5219\u4ec5\u622a\u53d6 num+1 \u4e2a\u5b50\u5b57\u7b26\u4e32 |\n| 32      | [splitlines([keepends\\])](https://www.runoob.com/python3/python3-string-splitlines.html) \u6309\u7167\u884c('\\r', '\\r\\n', \\n')\u5206\u9694\uff0c\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5404\u884c\u4f5c\u4e3a\u5143\u7d20\u7684\u5217\u8868\uff0c\u5982\u679c\u53c2\u6570 keepends \u4e3a False\uff0c\u4e0d\u5305\u542b\u6362\u884c\u7b26\uff0c\u5982\u679c\u4e3a True\uff0c\u5219\u4fdd\u7559\u6362\u884c\u7b26\u3002 |\n| 33      | [startswith(substr, beg=0,end=len(string))](https://www.runoob.com/python3/python3-string-startswith.html) \u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u662f\u4ee5\u6307\u5b9a\u5b50\u5b57\u7b26\u4e32 substr \u5f00\u5934\uff0c\u662f\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False\u3002\u5982\u679cbeg \u548c end \u6307\u5b9a\u503c\uff0c\u5219\u5728\u6307\u5b9a\u8303\u56f4\u5185\u68c0\u67e5\u3002 |\n| 34      | [strip([chars\\])](https://www.runoob.com/python3/python3-string-strip.html) \u5728\u5b57\u7b26\u4e32\u4e0a\u6267\u884c lstrip()\u548c rstrip() |\n| 35      | [swapcase()](https://www.runoob.com/python3/python3-string-swapcase.html) \u5c06\u5b57\u7b26\u4e32\u4e2d\u5927\u5199\u8f6c\u6362\u4e3a\u5c0f\u5199\uff0c\u5c0f\u5199\u8f6c\u6362\u4e3a\u5927\u5199 |\n| 36      | [title()](https://www.runoob.com/python3/python3-string-title.html) \u8fd4\u56de\"\u6807\u9898\u5316\"\u7684\u5b57\u7b26\u4e32,\u5c31\u662f\u8bf4\u6240\u6709\u5355\u8bcd\u90fd\u662f\u4ee5\u5927\u5199\u5f00\u59cb\uff0c\u5176\u4f59\u5b57\u6bcd\u5747\u4e3a\u5c0f\u5199(\u89c1 istitle()) |\n| 37      | [translate(table, deletechars=\"\")](https://www.runoob.com/python3/python3-string-translate.html) \u6839\u636e str \u7ed9\u51fa\u7684\u8868(\u5305\u542b 256 \u4e2a\u5b57\u7b26)\u8f6c\u6362 string \u7684\u5b57\u7b26, \u8981\u8fc7\u6ee4\u6389\u7684\u5b57\u7b26\u653e\u5230 deletechars \u53c2\u6570\u4e2d |\n| 38      | [upper()](https://www.runoob.com/python3/python3-string-upper.html) \u8f6c\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u5c0f\u5199\u5b57\u6bcd\u4e3a\u5927\u5199 |\n| 39      | [zfill (width)](https://www.runoob.com/python3/python3-string-zfill.html) \u8fd4\u56de\u957f\u5ea6\u4e3a width \u7684\u5b57\u7b26\u4e32\uff0c\u539f\u5b57\u7b26\u4e32\u53f3\u5bf9\u9f50\uff0c\u524d\u9762\u586b\u51450 |\n| 40      | [isdecimal()](https://www.runoob.com/python3/python3-string-isdecimal.html) \u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u53ea\u5305\u542b\u5341\u8fdb\u5236\u5b57\u7b26\uff0c\u5982\u679c\u662f\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002 |\n\n\n## int \u6574\u6570 /float \u6d6e\u70b9\u6570\n| \u51fd\u6570                                                         | \u8fd4\u56de\u503c ( \u63cf\u8ff0 )                                              |\n| :----------------------------------------------------------- | :----------------------------------------------------------- |\n| [abs(x)](https://www.runoob.com/python3/python3-func-number-abs.html) | \u8fd4\u56de\u6570\u5b57\u7684\u7edd\u5bf9\u503c\uff0c\u5982abs(-10) \u8fd4\u56de 10                         |\n| [ceil(x)](https://www.runoob.com/python3/python3-func-number-ceil.html) | \u8fd4\u56de\u6570\u5b57\u7684\u4e0a\u5165\u6574\u6570\uff0c\u5982math.ceil(4.1) \u8fd4\u56de 5                  |\n| cmp(x, y)                                                    | \u5982\u679c x < y \u8fd4\u56de -1, \u5982\u679c x == y \u8fd4\u56de 0, \u5982\u679c x > y \u8fd4\u56de 1\u3002 **Python 3 \u5df2\u5e9f\u5f03\uff0c\u4f7f\u7528 (x>y)-(x\u3002 |\n| [exp(x)](https://www.runoob.com/python3/python3-func-number-exp.html) | \u8fd4\u56dee\u7684x\u6b21\u5e42(ex),\u5982math.exp(1) \u8fd4\u56de2.718281828459045         |\n| [fabs(x)](https://www.runoob.com/python3/python3-func-number-fabs.html) | \u8fd4\u56de\u6570\u5b57\u7684\u7edd\u5bf9\u503c\uff0c\u5982math.fabs(-10) \u8fd4\u56de10.0                  |\n| [floor(x)](https://www.runoob.com/python3/python3-func-number-floor.html) | \u8fd4\u56de\u6570\u5b57\u7684\u4e0b\u820d\u6574\u6570\uff0c\u5982math.floor(4.9)\u8fd4\u56de 4                  |\n| [log(x)](https://www.runoob.com/python3/python3-func-number-log.html) | \u5982math.log(math.e)\u8fd4\u56de1.0,math.log(100,10)\u8fd4\u56de2.0            |\n| [log10(x)](https://www.runoob.com/python3/python3-func-number-log10.html) | \u8fd4\u56de\u4ee510\u4e3a\u57fa\u6570\u7684x\u7684\u5bf9\u6570\uff0c\u5982math.log10(100)\u8fd4\u56de 2.0           |\n| [max(x1, x2,...)](https://www.runoob.com/python3/python3-func-number-max.html) | \u8fd4\u56de\u7ed9\u5b9a\u53c2\u6570\u7684\u6700\u5927\u503c\uff0c\u53c2\u6570\u53ef\u4ee5\u4e3a\u5e8f\u5217\u3002                       |\n| [min(x1, x2,...)](https://www.runoob.com/python3/python3-func-number-min.html) | \u8fd4\u56de\u7ed9\u5b9a\u53c2\u6570\u7684\u6700\u5c0f\u503c\uff0c\u53c2\u6570\u53ef\u4ee5\u4e3a\u5e8f\u5217\u3002                       |\n| [modf(x)](https://www.runoob.com/python3/python3-func-number-modf.html) | \u8fd4\u56dex\u7684\u6574\u6570\u90e8\u5206\u4e0e\u5c0f\u6570\u90e8\u5206\uff0c\u4e24\u90e8\u5206\u7684\u6570\u503c\u7b26\u53f7\u4e0ex\u76f8\u540c\uff0c\u6574\u6570\u90e8\u5206\u4ee5\u6d6e\u70b9\u578b\u8868\u793a\u3002 |\n| [pow(x, y)](https://www.runoob.com/python3/python3-func-number-pow.html) | x**y \u8fd0\u7b97\u540e\u7684\u503c\u3002                                            |\n| [round(x [,n\\])](https://www.runoob.com/python3/python3-func-number-round.html) | \u8fd4\u56de\u6d6e\u70b9\u6570x\u7684\u56db\u820d\u4e94\u5165\u503c\uff0c\u5982\u7ed9\u51fan\u503c\uff0c\u5219\u4ee3\u8868\u820d\u5165\u5230\u5c0f\u6570\u70b9\u540e\u7684\u4f4d\u6570\u3002 |\n| [sqrt(x)](https://www.runoob.com/python3/python3-func-number-sqrt.html) | \u8fd4\u56de\u6570\u5b57x\u7684\u5e73\u65b9\u6839\u3002                                          |\n## bool \u5e03\u5c14\u503c\n## list \u5217\u8868\n| \u5e8f\u53f7 | \u65b9\u6cd5                                                         |\n| :--- | :----------------------------------------------------------- |\n| 1    | [list.append(obj)](https://www.runoob.com/python3/python3-att-list-append.html) \u5728\u5217\u8868\u672b\u5c3e\u6dfb\u52a0\u65b0\u7684\u5bf9\u8c61 |\n| 2    | [list.count(obj)](https://www.runoob.com/python3/python3-att-list-count.html) \u7edf\u8ba1\u67d0\u4e2a\u5143\u7d20\u5728\u5217\u8868\u4e2d\u51fa\u73b0\u7684\u6b21\u6570 |\n| 3    | [list.extend(seq)](https://www.runoob.com/python3/python3-att-list-extend.html) \u5728\u5217\u8868\u672b\u5c3e\u4e00\u6b21\u6027\u8ffd\u52a0\u53e6\u4e00\u4e2a\u5e8f\u5217\u4e2d\u7684\u591a\u4e2a\u503c\uff08\u7528\u65b0\u5217\u8868\u6269\u5c55\u539f\u6765\u7684\u5217\u8868\uff09 |\n| 4    | [list.index(obj)](https://www.runoob.com/python3/python3-att-list-index.html) \u4ece\u5217\u8868\u4e2d\u627e\u51fa\u67d0\u4e2a\u503c\u7b2c\u4e00\u4e2a\u5339\u914d\u9879\u7684\u7d22\u5f15\u4f4d\u7f6e |\n| 5    | [list.insert(index, obj)](https://www.runoob.com/python3/python3-att-list-insert.html) \u5c06\u5bf9\u8c61\u63d2\u5165\u5217\u8868 |\n| 6    | [list.pop([index=-1\\])](https://www.runoob.com/python3/python3-att-list-pop.html) \u79fb\u9664\u5217\u8868\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\uff08\u9ed8\u8ba4\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff09\uff0c\u5e76\u4e14\u8fd4\u56de\u8be5\u5143\u7d20\u7684\u503c |\n| 7    | [list.remove(obj)](https://www.runoob.com/python3/python3-att-list-remove.html) \u79fb\u9664\u5217\u8868\u4e2d\u67d0\u4e2a\u503c\u7684\u7b2c\u4e00\u4e2a\u5339\u914d\u9879 |\n| 8    | [list.reverse()](https://www.runoob.com/python3/python3-att-list-reverse.html) \u53cd\u5411\u5217\u8868\u4e2d\u5143\u7d20 |\n| 9    | [list.sort( key=None, reverse=False)](https://www.runoob.com/python3/python3-att-list-sort.html) \u5bf9\u539f\u5217\u8868\u8fdb\u884c\u6392\u5e8f |\n| 10   | [list.clear()](https://www.runoob.com/python3/python3-att-list-clear.html) \u6e05\u7a7a\u5217\u8868 |\n| 11   | [list.copy()](https://www.runoob.com/python3/python3-att-list-copy.html) \u590d\u5236\u5217\u8868 |\n## tuple \u5143\u7ec4\n| \u65b9\u6cd5\u53ca\u63cf\u8ff0                        | \u5b9e\u4f8b                                                         |\n| :-------------------------------- | :----------------------------------------------------------- |\n| len(tuple) \u8ba1\u7b97\u5143\u7ec4\u5143\u7d20\u4e2a\u6570\u3002     | `>>> tuple1 = ('Google', 'Runoob', 'Taobao') >>> len(tuple1) 3 >>> ` |\n| max(tuple) \u8fd4\u56de\u5143\u7ec4\u4e2d\u5143\u7d20\u6700\u5927\u503c\u3002 | `>>> tuple2 = ('5', '4', '8') >>> max(tuple2) '8' >>> `      |\n| min(tuple) \u8fd4\u56de\u5143\u7ec4\u4e2d\u5143\u7d20\u6700\u5c0f\u503c\u3002 | `>>> tuple2 = ('5', '4', '8') >>> min(tuple2) '4' >>> `      |\n| tuple(seq) \u5c06\u5217\u8868\u8f6c\u6362\u4e3a\u5143\u7ec4\u3002     | `>>> list1= ['Google', 'Taobao', 'Runoob', 'Baidu'] >>> tuple1=tuple(list1) >>> tuple1 ('Google', 'Taobao', 'Runoob', 'Baidu')` |\n## dict \u5b57\u5178\n| \u5e8f\u53f7 | \u51fd\u6570\u53ca\u63cf\u8ff0                                                   |\n| :--- | :----------------------------------------------------------- |\n| 1    | [radiansdict.clear()](https://www.runoob.com/python3/python3-att-dictionary-clear.html) \u5220\u9664\u5b57\u5178\u5185\u6240\u6709\u5143\u7d20 |\n| 2    | [radiansdict.copy()](https://www.runoob.com/python3/python3-att-dictionary-copy.html) \u8fd4\u56de\u4e00\u4e2a\u5b57\u5178\u7684\u6d45\u590d\u5236 |\n| 3    | [radiansdict.fromkeys()](https://www.runoob.com/python3/python3-att-dictionary-fromkeys.html) \u521b\u5efa\u4e00\u4e2a\u65b0\u5b57\u5178\uff0c\u4ee5\u5e8f\u5217seq\u4e2d\u5143\u7d20\u505a\u5b57\u5178\u7684\u952e\uff0cval\u4e3a\u5b57\u5178\u6240\u6709\u952e\u5bf9\u5e94\u7684\u521d\u59cb\u503c |\n| 4    | [radiansdict.get(key, default=None)](https://www.runoob.com/python3/python3-att-dictionary-get.html) \u8fd4\u56de\u6307\u5b9a\u952e\u7684\u503c\uff0c\u5982\u679c\u503c\u4e0d\u5728\u5b57\u5178\u4e2d\u8fd4\u56dedefault\u503c |\n| 5    | [key in dict](https://www.runoob.com/python3/python3-att-dictionary-in.html) \u5982\u679c\u952e\u5728\u5b57\u5178dict\u91cc\u8fd4\u56detrue\uff0c\u5426\u5219\u8fd4\u56defalse |\n| 6    | [radiansdict.items()](https://www.runoob.com/python3/python3-att-dictionary-items.html) \u4ee5\u5217\u8868\u8fd4\u56de\u53ef\u904d\u5386\u7684(\u952e, \u503c) \u5143\u7ec4\u6570\u7ec4 |\n| 7    | [radiansdict.keys()](https://www.runoob.com/python3/python3-att-dictionary-keys.html) \u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 list() \u6765\u8f6c\u6362\u4e3a\u5217\u8868 |\n| 8    | [radiansdict.setdefault(key, default=None)](https://www.runoob.com/python3/python3-att-dictionary-setdefault.html) \u548cget()\u7c7b\u4f3c, \u4f46\u5982\u679c\u952e\u4e0d\u5b58\u5728\u4e8e\u5b57\u5178\u4e2d\uff0c\u5c06\u4f1a\u6dfb\u52a0\u952e\u5e76\u5c06\u503c\u8bbe\u4e3adefault |\n| 9    | [radiansdict.update(dict2)](https://www.runoob.com/python3/python3-att-dictionary-update.html) \u628a\u5b57\u5178dict2\u7684\u952e/\u503c\u5bf9\u66f4\u65b0\u5230dict\u91cc |\n| 10   | [radiansdict.values()](https://www.runoob.com/python3/python3-att-dictionary-values.html) \u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 list() \u6765\u8f6c\u6362\u4e3a\u5217\u8868 |\n| 11   | [pop(key[,default\\])](https://www.runoob.com/python3/python3-att-dictionary-pop.html) \u5220\u9664\u5b57\u5178\u7ed9\u5b9a\u952e key \u6240\u5bf9\u5e94\u7684\u503c\uff0c\u8fd4\u56de\u503c\u4e3a\u88ab\u5220\u9664\u7684\u503c\u3002key\u503c\u5fc5\u987b\u7ed9\u51fa\u3002 \u5426\u5219\uff0c\u8fd4\u56dedefault\u503c\u3002 |\n| 12   | [popitem()](https://www.runoob.com/python3/python3-att-dictionary-popitem.html) \u968f\u673a\u8fd4\u56de\u5e76\u5220\u9664\u5b57\u5178\u4e2d\u7684\u6700\u540e\u4e00\u5bf9\u952e\u548c\u503c\u3002 |\n## set \u96c6\u5408\n| \u65b9\u6cd5                                                         | \u63cf\u8ff0                                                         |\n| :----------------------------------------------------------- | :----------------------------------------------------------- |\n| [add()](https://www.runoob.com/python3/ref-set-add.html)     | \u4e3a\u96c6\u5408\u6dfb\u52a0\u5143\u7d20                                               |\n| [clear()](https://www.runoob.com/python3/ref-set-clear.html) | \u79fb\u9664\u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20                                         |\n| [copy()](https://www.runoob.com/python3/ref-set-copy.html)   | \u62f7\u8d1d\u4e00\u4e2a\u96c6\u5408                                                 |\n| [difference()](https://www.runoob.com/python3/ref-set-difference.html) | \u8fd4\u56de\u591a\u4e2a\u96c6\u5408\u7684\u5dee\u96c6                                           |\n| [difference_update()](https://www.runoob.com/python3/ref-set-difference_update.html) | \u79fb\u9664\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff0c\u8be5\u5143\u7d20\u5728\u6307\u5b9a\u7684\u96c6\u5408\u4e5f\u5b58\u5728\u3002                 |\n| [discard()](https://www.runoob.com/python3/ref-set-discard.html) | \u5220\u9664\u96c6\u5408\u4e2d\u6307\u5b9a\u7684\u5143\u7d20                                         |\n| [intersection()](https://www.runoob.com/python3/ref-set-intersection.html) | \u8fd4\u56de\u96c6\u5408\u7684\u4ea4\u96c6                                               |\n| [intersection_update()](https://www.runoob.com/python3/ref-set-intersection_update.html) | \u8fd4\u56de\u96c6\u5408\u7684\u4ea4\u96c6\u3002                                             |\n| [isdisjoint()](https://www.runoob.com/python3/ref-set-isdisjoint.html) | \u5224\u65ad\u4e24\u4e2a\u96c6\u5408\u662f\u5426\u5305\u542b\u76f8\u540c\u7684\u5143\u7d20\uff0c\u5982\u679c\u6ca1\u6709\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False\u3002 |\n| [issubset()](https://www.runoob.com/python3/ref-set-issubset.html) | \u5224\u65ad\u6307\u5b9a\u96c6\u5408\u662f\u5426\u4e3a\u8be5\u65b9\u6cd5\u53c2\u6570\u96c6\u5408\u7684\u5b50\u96c6\u3002                     |\n| [issuperset()](https://www.runoob.com/python3/ref-set-issuperset.html) | \u5224\u65ad\u8be5\u65b9\u6cd5\u7684\u53c2\u6570\u96c6\u5408\u662f\u5426\u4e3a\u6307\u5b9a\u96c6\u5408\u7684\u5b50\u96c6                     |\n| [pop()](https://www.runoob.com/python3/ref-set-pop.html)     | \u968f\u673a\u79fb\u9664\u5143\u7d20                                                 |\n| [remove()](https://www.runoob.com/python3/ref-set-remove.html) | \u79fb\u9664\u6307\u5b9a\u5143\u7d20                                                 |\n| [symmetric_difference()](https://www.runoob.com/python3/ref-set-symmetric_difference.html) | \u8fd4\u56de\u4e24\u4e2a\u96c6\u5408\u4e2d\u4e0d\u91cd\u590d\u7684\u5143\u7d20\u96c6\u5408\u3002                             |\n| [symmetric_difference_update()](https://www.runoob.com/python3/ref-set-symmetric_difference_update.html) | \u79fb\u9664\u5f53\u524d\u96c6\u5408\u4e2d\u5728\u53e6\u5916\u4e00\u4e2a\u6307\u5b9a\u96c6\u5408\u76f8\u540c\u7684\u5143\u7d20\uff0c\u5e76\u5c06\u53e6\u5916\u4e00\u4e2a\u6307\u5b9a\u96c6\u5408\u4e2d\u4e0d\u540c\u7684\u5143\u7d20\u63d2\u5165\u5230\u5f53\u524d\u96c6\u5408\u4e2d\u3002 |\n| [union()](https://www.runoob.com/python3/ref-set-union.html) | \u8fd4\u56de\u4e24\u4e2a\u96c6\u5408\u7684\u5e76\u96c6                                           |\n| [update()](https://www.runoob.com/python3/ref-set-update.html) | \u7ed9\u96c6\u5408\u6dfb\u52a0\u5143\u7d20                                               |", "excerpt": "string \u5b57\u7b26\u4e32\n\n\n\n\u5e8f   \u53f7\n\u65b9\u6cd5\u53ca\u63cf\u8ff0\n\n\n\n\n1\ncapitalize() \u5c06\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u8f6c\u6362\u4e3a\u5927\u5199\n\n\n2\ncenter(width, fillchar) \u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u7684\u5bbd\u5ea6 width \u5c45\u4e2d\u7684\u5b57\u7b26\u4e32\uff0cfillchar \u4e3a\u586b\u5145\u7684\u5b57\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u683c\u3002\n\n\n3\ncount(str, ", "codestyle": "atelier-forest-dark", "reproduce": false, "reproduce_source": "", "create_date": "2020-03-10T22:54:17.633", "mod_date": "2020-03-10T22:54:17.633", "views_count": 10, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "e4798d2b-e4e5-4abb-bb9e-c47564675878", "category": 7, "tags": []}}, {"model": "blog.post", "pk": 13, "fields": {"title": "python\u6570\u636e\u7c7b\u578b\uff08\u4e8c\uff09", "body": "<blockquote>\n<p>\u6765\u81ea\u5185\u7f6e\u6a21\u5757collections\u7684\u6570\u636e\u7c7b\u578b</p>\n</blockquote>\n<h2><a id=\"deque__1\"></a>deque \u53cc\u7aef\u961f\u5217</h2>\n<h2><a id=\"namedtuple\t_2\"></a>namedtuple\t\u5177\u540d\u5143\u7ec4</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-keyword\">from</span> collections <span class=\"hljs-keyword\">import</span> namedtuple\n\nPerson = namedtuple(<span class=\"hljs-string\">'Person'</span>,[<span class=\"hljs-string\">'name'</span>,<span class=\"hljs-string\">'age'</span>,<span class=\"hljs-string\">'gender'</span>,<span class=\"hljs-string\">'address'</span>])\n\np = Person(<span class=\"hljs-string\">'zhp'</span>,<span class=\"hljs-number\">25</span>,<span class=\"hljs-string\">'\u7537'</span>,<span class=\"hljs-string\">'\u4e0a\u6d77'</span>)\n\nprint(p)\n<span class=\"hljs-comment\"># Person(name='zhp', age=25, gender='\u7537', address='\u4e0a\u6d77')</span>\nprint(p.gender)\n<span class=\"hljs-comment\"># \u7537</span>\n\n</code></div></pre>\n<blockquote>\n<p>\u4e0d\u901a\u8fc7\u7d22\u5f15 \u800c\u662f\u901a\u8fc7key\u8bbf\u95ee\u5143\u7ec4\u5143\u7d20</p>\n</blockquote>\n<h2><a id=\"defaultdict\t_17\"></a>defaultdict\t\u9ed8\u8ba4\u503c\u5b57\u5178</h2>\n<blockquote>\n<p>\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u66ff\u4ee3dict()[key]\u67e5\u8be2\u4e0d\u5230\u62a5\u9519\u7684\u60c5\u51b5\uff0c\u76f8\u6bd4get\u4e5f\u6709\u81ea\u5df1\u7684\u4f18\u52bf</p>\n</blockquote>\n<h2><a id=\"OrderedDict\t_19\"></a>OrderedDict\t\u6709\u5e8f\u5b57\u5178</h2>\n<blockquote>\n<p>\u9ed8\u8ba4\u5b57\u5178\u662f\u65e0\u5e8f\u7684\uff0c\u6709\u5e8f\u5b57\u5178\u540c\u65f6\u6709\u5e8f+\u50a8\u5b58\u503c\uff0c\u5173\u952e\u53c2\u6570\uff0c\u5173\u952e\u53c2\u6570popitem\u9ed8\u8ba4\u4e3aTrue,\u5220\u9664\u6700\u540e\u4e00\u4e2a\u952e\u503c\u5bf9\uff0cpopitem(last=False)\u53ef\u4ee5\u7528\u4f5clru\u7b97\u6cd5\u5bb9\u5668</p>\n</blockquote>\n<h2><a id=\"ChainMap_21\"></a>ChainMap</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-keyword\">import</span> builtins\npylookup = ChainMap(locals(), globals(), vars(builtins))\n</code></div></pre>\n<blockquote>\n<p>\u5bb9\u7eb3\u591a\u4e2a\u5b57\u5178\u5bf9\u8c61\uff0c\u67e5\u627e\u65f6\u4f9d\u6b21\u67e5\u627e</p>\n<h2><a id=\"Counter\t_28\"></a>Counter\t\u8ba1\u6570\u5b57\u5178</h2>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-meta\">&gt;&gt;&gt; </span>ct = collections.Counter(<span class=\"hljs-string\">'abracadabra'</span>)\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>ct\nCounter({<span class=\"hljs-string\">'a'</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">'b'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'r'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'c'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">1</span>})\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>ct.update(<span class=\"hljs-string\">'aaaaazzz'</span>)\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>ct\nCounter({<span class=\"hljs-string\">'a'</span>: <span class=\"hljs-number\">10</span>, <span class=\"hljs-string\">'z'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'b'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'r'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'c'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'d'</span>: <span class=\"hljs-number\">1</span>})\n<span class=\"hljs-meta\">&gt;&gt;&gt; </span>ct.most_common(<span class=\"hljs-number\">2</span>)\n[(<span class=\"hljs-string\">'a'</span>, <span class=\"hljs-number\">10</span>), (<span class=\"hljs-string\">'z'</span>, <span class=\"hljs-number\">3</span>)]\n</code></div></pre>\n<blockquote>\n<p>Counter\u7c7b\u5b9e\u73b0\u4e86\u5bf9\u53ef\u8fed\u4ee3\u5bf9\u8c61\u7684\u8ba1\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2d\u7684most_common()\u51fd\u6570\u5b9e\u73b0\u4e86\u5bf9\u5176\u4e2d\u6700\u591a\u91cf\u5143\u7d20\u7684\u8fd4\u56de\u5217\u8868<br />\nCounter \u53ef\u4ee5\u5b9e\u73b0\u6587\u7ae0\u5185\u5bb9\u9ad8\u9891\u7387\u8bcd\u7684\u8ba1\u6570</p>\n</blockquote>", "body_md": ">\u6765\u81ea\u5185\u7f6e\u6a21\u5757collections\u7684\u6570\u636e\u7c7b\u578b\n## deque \u53cc\u7aef\u961f\u5217\n## namedtuple\t\u5177\u540d\u5143\u7ec4\n```py\nfrom collections import namedtuple\n\nPerson = namedtuple('Person',['name','age','gender','address'])\n\np = Person('zhp',25,'\u7537','\u4e0a\u6d77')\n\nprint(p)\n# Person(name='zhp', age=25, gender='\u7537', address='\u4e0a\u6d77')\nprint(p.gender)\n# \u7537\n\n```\n> \u4e0d\u901a\u8fc7\u7d22\u5f15 \u800c\u662f\u901a\u8fc7key\u8bbf\u95ee\u5143\u7ec4\u5143\u7d20\n## defaultdict\t\u9ed8\u8ba4\u503c\u5b57\u5178\n>\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u66ff\u4ee3dict()[key]\u67e5\u8be2\u4e0d\u5230\u62a5\u9519\u7684\u60c5\u51b5\uff0c\u76f8\u6bd4get\u4e5f\u6709\u81ea\u5df1\u7684\u4f18\u52bf\n## OrderedDict\t\u6709\u5e8f\u5b57\u5178\n>\u9ed8\u8ba4\u5b57\u5178\u662f\u65e0\u5e8f\u7684\uff0c\u6709\u5e8f\u5b57\u5178\u540c\u65f6\u6709\u5e8f+\u50a8\u5b58\u503c\uff0c\u5173\u952e\u53c2\u6570\uff0c\u5173\u952e\u53c2\u6570popitem\u9ed8\u8ba4\u4e3aTrue,\u5220\u9664\u6700\u540e\u4e00\u4e2a\u952e\u503c\u5bf9\uff0cpopitem(last=False)\u53ef\u4ee5\u7528\u4f5clru\u7b97\u6cd5\u5bb9\u5668\n## ChainMap \n```py\nimport builtins\npylookup = ChainMap(locals(), globals(), vars(builtins))\n```\n>\u5bb9\u7eb3\u591a\u4e2a\u5b57\u5178\u5bf9\u8c61\uff0c\u67e5\u627e\u65f6\u4f9d\u6b21\u67e5\u627e\n>\n>## Counter\t\u8ba1\u6570\u5b57\u5178\n```py\n>>> ct = collections.Counter('abracadabra')\n>>> ct\nCounter({'a': 5, 'b': 2, 'r': 2, 'c': 1, 'd': 1})\n>>> ct.update('aaaaazzz')\n>>> ct\nCounter({'a': 10, 'z': 3, 'b': 2, 'r': 2, 'c': 1, 'd': 1})\n>>> ct.most_common(2)\n[('a', 10), ('z', 3)]\n```\n> Counter\u7c7b\u5b9e\u73b0\u4e86\u5bf9\u53ef\u8fed\u4ee3\u5bf9\u8c61\u7684\u8ba1\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2d\u7684most_common()\u51fd\u6570\u5b9e\u73b0\u4e86\u5bf9\u5176\u4e2d\u6700\u591a\u91cf\u5143\u7d20\u7684\u8fd4\u56de\u5217\u8868\n> Counter \u53ef\u4ee5\u5b9e\u73b0\u6587\u7ae0\u5185\u5bb9\u9ad8\u9891\u7387\u8bcd\u7684\u8ba1\u6570", "excerpt": "\n\u6765\u81ea\u5185\u7f6e\u6a21\u5757collections\u7684\u6570\u636e\u7c7b\u578b\n\ndeque \u53cc\u7aef\u961f\u5217\nnamedtuple\t\u5177\u540d\u5143\u7ec4\nfrom collections import namedtuple\n\nPerson = namedtuple('Person',['name','age','gender','address']", "codestyle": "atelier-sulphurpool-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-10T22:54:54.853", "mod_date": "2020-03-10T22:55:04.910", "views_count": 15, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "e4798d2b-e4e5-4abb-bb9e-c47564675878", "category": 7, "tags": []}}, {"model": "blog.post", "pk": 14, "fields": {"title": "redis\u5e38\u89c1\u9762\u8bd5\u95ee\u9898", "body": "<h3><a id=\"_0\"></a>\u7f13\u5b58\u96ea\u5d29</h3>\n<ul>\n<li>\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29</li>\n</ul>\n<blockquote>\n<p>\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u7f13\u5b58\u4e2d\u6570\u636e\u5927\u6279\u91cf\u5230\u8fc7\u671f\u65f6\u95f4\uff0c\u800c\u67e5\u8be2\u6570\u636e\u91cf\u5de8\u5927\uff0c\u7ed5\u8fc7redis\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\u5f15\u8d77\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\u751a\u81f3\u5b95\u673a\u3002\u548c\u7f13\u5b58\u51fb\u7a7f\u4e0d\u540c\u7684\u662f\uff0c\u7f13\u5b58\u51fb\u7a7f\u6307\u5e76\u53d1\u67e5\u540c\u4e00\u6761\u6570\u636e\uff0c\u7f13\u5b58\u96ea\u5d29\u662f\u4e0d\u540c\u6570\u636e\u90fd\u8fc7\u671f\u4e86\uff0c\u5f88\u591a\u6570\u636e\u90fd\u67e5\u4e0d\u5230\u4ece\u800c\u67e5\u6570\u636e\u5e93\u3002</p>\n</blockquote>\n<ul>\n<li>\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u96ea\u5d29</li>\n</ul>\n<blockquote>\n<ol>\n<li>\u7f13\u5b58\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u968f\u673a\uff0c\u9632\u6b62\u540c\u4e00\u65f6\u95f4\u5927\u91cf\u6570\u636e\u8fc7\u671f\u73b0\u8c61\u53d1\u751f\u3002<br />\n<code>redis.set('key','value',ex='time'+random.random()*10000)</code></li>\n<li>\u5982\u679c\u7f13\u5b58\u6570\u636e\u5e93\u662f\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u5c06\u70ed\u70b9\u6570\u636e\u5747\u5300\u5206\u5e03\u5728\u4e0d\u540c\u641e\u5f97\u7f13\u5b58\u6570\u636e\u5e93\u4e2d\u3002</li>\n<li>\u8bbe\u7f6e\u70ed\u70b9\u6570\u636e\u6c38\u8fdc\u4e0d\u8fc7\u671f\u3002</li>\n<li>\u4f7f\u7528\u5feb\u901f\u5931\u8d25\u7684\u7194\u65ad\u7b56\u7565\uff0c\u51cf\u5c11 DB \u77ac\u95f4\u538b\u529b\uff1b</li>\n<li>\u4f7f\u7528\u4e3b\u4ece\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u6765\u5c3d\u91cf\u4fdd\u8bc1\u7f13\u5b58\u670d\u52a1\u7684\u9ad8\u53ef\u7528</li>\n</ol>\n</blockquote>\n<h3><a id=\"_11\"></a>\u7f13\u5b58\u7a7f\u900f</h3>\n<ul>\n<li>\u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f</li>\n</ul>\n<blockquote>\n<p>\u7f13\u5b58\u7a7f\u900f\u662f\u6307\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u7684\u6570\u636e\uff0c\u800c\u7528\u6237\u4e0d\u65ad\u53d1\u8d77\u8bf7\u6c42\uff0c\u7ed5\u8fc7redis\u91cd\u590d\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5982\u53d1\u8d77\u4e3aid\u4e3a\u201c-1\u201d\u7684\u6570\u636e\u6216id\u4e3a\u7279\u522b\u5927\u4e0d\u5b58\u5728\u7684\u6570\u636e\u3002\u8fd9\u65f6\u7684\u7528\u6237\u5f88\u53ef\u80fd\u662f\u653b\u51fb\u8005\uff0c\u653b\u51fb\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\u3002</p>\n</blockquote>\n<ul>\n<li>\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f</li>\n</ul>\n<blockquote>\n<ol>\n<li>\u63a5\u53e3\u5c42\u589e\u52a0\u6821\u9a8c\uff0c\u5982\u7528\u6237\u9274\u6743\u6821\u9a8c\uff0cid\u505a\u57fa\u7840\u6821\u9a8c\uff0cid&lt;=0\u7684\u76f4\u63a5\u62e6\u622a\uff1b</li>\n<li>\u4ece\u7f13\u5b58\u53d6\u4e0d\u5230\u7684\u6570\u636e\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u53d6\u5230\uff0c\u8fd9\u65f6\u4e5f\u53ef\u4ee5\u5c06key-value\u5bf9\u5199\u4e3akey-null\uff0c\u7f13\u5b58\u6709\u6548\u65f6\u95f4\u53ef\u4ee5\u8bbe\u7f6e\u77ed\u70b9\uff0c\u598230\u79d2\uff08\u8bbe\u7f6e\u592a\u957f\u4f1a\u5bfc\u81f4\u6b63\u5e38\u60c5\u51b5\u4e5f\u6ca1\u6cd5\u4f7f\u7528\uff09\u3002\u8fd9\u6837\u53ef\u4ee5\u9632\u6b62\u653b\u51fb\u7528\u6237\u53cd\u590d\u7528\u540c\u4e00\u4e2aid\u66b4\u529b\u653b\u51fb</li>\n<li>\u4f7f\u7528 BloomFilter \u8fc7\u6ee4\u5668\uff0cBloomFilter \u7684\u7279\u70b9\u662f\u5b58\u5728\u6027\u68c0\u6d4b\uff0c\u5982\u679c BloomFilter \u4e2d\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u6570\u636e\u4e00\u5b9a\u4e0d\u5b58\u5728\uff1b\u5982\u679c BloomFilter \u4e2d\u5b58\u5728\uff0c\u5b9e\u9645\u6570\u636e\u4e5f\u6709\u53ef\u80fd\u4f1a\u4e0d\u5b58\u5728\u3002\u975e\u5e38\u9002\u5408\u89e3\u51b3\u8fd9\u7c7b\u7684\u95ee\u9898\u3002</li>\n</ol>\n</blockquote>\n<h3><a id=\"_19\"></a>\u7f13\u5b58\u51fb\u7a7f</h3>\n<ul>\n<li>\u4ec0\u4e48\u662f\u7f13\u5b58\u51fb\u7a7f</li>\n</ul>\n<blockquote>\n<p>\u7f13\u5b58\u51fb\u7a7f\u662f\u6307\u7f13\u5b58\u4e2d\u6ca1\u6709\u4f46\u6570\u636e\u5e93\u4e2d\u6709\u7684\u6570\u636e\uff08\u4e00\u822c\u662f\u7f13\u5b58\u65f6\u95f4\u5230\u671f\uff09\uff0c\u8fd9\u65f6\u7531\u4e8e\u5e76\u53d1\u7528\u6237\u7279\u522b\u591a\uff0c\u540c\u65f6\u8bfb\u7f13\u5b58\u6ca1\u8bfb\u5230\u6570\u636e\uff0c\u53c8\u540c\u65f6\u53bb\u6570\u636e\u5e93\u53bb\u53d6\u6570\u636e\uff0c\u5f15\u8d77\u6570\u636e\u5e93\u538b\u529b\u77ac\u95f4\u589e\u5927\uff0c\u9020\u6210\u8fc7\u5927\u538b\u529b\u3002\u4e00\u822c\u6307\u5355\u4e00\u7684\u70ed\u70b9\u6570\u636e</p>\n</blockquote>\n<ul>\n<li>\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f</li>\n</ul>\n<blockquote>\n<ol>\n<li>\u53ef\u4ee5\u4f7f\u7528\u4e92\u65a5\u9501\u66f4\u65b0\uff0c\u4fdd\u8bc1\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u9488\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\u4e0d\u4f1a\u5e76\u53d1\u8bf7\u6c42\u5230 DB\uff0c\u51cf\u5c0f DB \u538b\u529b\u3002</li>\n<li>\u4f7f\u7528\u968f\u673a\u9000\u907f\u65b9\u5f0f\uff0c\u5931\u6548\u65f6\u968f\u673a sleep \u4e00\u4e2a\u5f88\u77ed\u7684\u65f6\u95f4\uff0c\u518d\u6b21\u67e5\u8be2\uff0c\u5982\u679c\u5931\u8d25\u518d\u6267\u884c\u66f4\u65b0\u3002</li>\n<li>\u9488\u5bf9\u591a\u4e2a\u70ed\u70b9 key \u540c\u65f6\u5931\u6548\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u5728\u7f13\u5b58\u65f6\u4f7f\u7528\u56fa\u5b9a\u65f6\u95f4\u52a0\u4e0a\u4e00\u4e2a\u5c0f\u7684\u968f\u673a\u6570\uff0c\u907f\u514d\u5927\u91cf\u70ed\u70b9 key \u540c\u4e00\u65f6\u523b\u5931\u6548\u3002</li>\n</ol>\n</blockquote>\n<h3><a id=\"redis_27\"></a>redis\u4e3a\u4ec0\u4e48\u5feb\u901f</h3>\n<ul>\n<li>\u57fa\u4e8e\u5185\u5b58</li>\n<li>\u5355\u7ebf\u7a0b\uff0c\u907f\u514d\u4e0a\u4e0b\u6587\u5207\u6362</li>\n<li>\u6570\u636e\u7ed3\u6784\u4e13\u95e8\u8bbe\u8ba1</li>\n<li>\u4f7f\u7528\u591a\u8defI/O\u590d\u7528\u6a21\u578b\uff0c\u975e\u963b\u585eIO</li>\n<li>\u5e95\u5c42\u6a21\u578b\u4e0d\u540c</li>\n</ul>\n<h3><a id=\"_34\"></a>\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u5e38\u7528\u573a\u666f</h3>\n<h4><a id=\"string_35\"></a>string</h4>\n<ol>\n<li>\u7f13\u5b58</li>\n<li>\u8ba1\u6570\u5668</li>\n<li>\u5171\u4eab\u7528\u6237session</li>\n</ol>\n<h4><a id=\"Hash_39\"></a>Hash</h4>\n<h4><a id=\"list_40\"></a>list</h4>\n<ol>\n<li>\u6d88\u606f\u961f\u5217</li>\n<li>\u5217\u8868\u5c55\u793a\u9875</li>\n</ol>\n<h4><a id=\"set_43\"></a>set</h4>\n<ol>\n<li>\u5171\u540c\u597d\u53cb</li>\n</ol>\n<h4><a id=\"Sorted_Set_45\"></a>Sorted Set</h4>\n<ol>\n<li>\u6392\u884c\u699c</li>\n</ol>\n<h3><a id=\"kvdb_48\"></a>\u7ecf\u5178\u7684kv\uff0cdb\u8bfb\u5199\u65b9\u5f0f</h3>\n<ul>\n<li>\u8bfb\u7684\u65f6\u5019\uff0c\u5148\u8bfb\u7f13\u5b58\uff0c\u7f13\u5b58\u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u8bfb\u6570\u636e\u5e93\uff0c\u7136\u540e\u53d6\u51fa\u6570\u636e\u540e\u653e\u5165\u7f13\u5b58\uff0c\u540c\u65f6\u8fd4\u56de\u54cd\u5e94\u3002</li>\n<li>\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58\u3002</li>\n</ul>\n<h3><a id=\"Redis__Memcached_Redis_52\"></a>Redis \u548c Memcached \u6709\u5565\u533a\u522b\uff0c\u4e3a\u5565\u9009\u62e9Redis\u4f5c\u4e3a\u7f13\u5b58\u4e2d\u95f4\u4ef6\uff1f</h3>\n<ul>\n<li>Redis \u652f\u6301\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff1a</li>\n<li>Redis \u76f8\u6bd4 Memcached \u6765\u8bf4\uff0c\u62e5\u6709\u66f4\u591a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u80fd\u652f\u6301\u66f4\u4e30\u5bcc\u7684\u6570\u636e\u64cd\u4f5c\u3002\u5982\u679c\u9700\u8981\u7f13\u5b58\u80fd\u591f\u652f\u6301\u66f4\u590d\u6742\u7684\u7ed3\u6784\u548c\u64cd\u4f5c\uff0c Redis \u4f1a\u662f\u4e0d\u9519\u7684\u9009\u62e9\u3002</li>\n<li>Redis \u539f\u751f\u652f\u6301\u96c6\u7fa4\u6a21\u5f0f\uff1a</li>\n<li>\u5728 redis3.x \u7248\u672c\u4e2d\uff0c\u4fbf\u80fd\u652f\u6301 Cluster \u6a21\u5f0f\uff0c\u800c Memcached \u6ca1\u6709\u539f\u751f\u7684\u96c6\u7fa4\u6a21\u5f0f\uff0c\u9700\u8981\u4f9d\u9760\u5ba2\u6237\u7aef\u6765\u5b9e\u73b0\u5f80\u96c6\u7fa4\u4e2d\u5206\u7247\u5199\u5165\u6570\u636e\u3002<br />\n\u6027\u80fd\u5bf9\u6bd4\uff1a<br />\n\u7531\u4e8e Redis \u53ea\u4f7f\u7528\u5355\u6838\uff0c\u800c Memcached \u53ef\u4ee5\u4f7f\u7528\u591a\u6838\uff0c\u6240\u4ee5\u5e73\u5747\u6bcf\u4e00\u4e2a\u6838\u4e0a Redis \u5728\u5b58\u50a8\u5c0f\u6570\u636e\u65f6\u6bd4 Memcached \u6027\u80fd\u66f4\u9ad8\u3002\u800c\u5728 100k \u4ee5\u4e0a\u7684\u6570\u636e\u4e2d\uff0cMemcached \u6027\u80fd\u8981\u9ad8\u4e8e Redis\uff0c\u867d\u7136 Redis \u6700\u8fd1\u4e5f\u5728\u5b58\u50a8\u5927\u6570\u636e\u7684\u6027\u80fd\u4e0a\u8fdb\u884c\u4f18\u5316\uff0c\u4f46\u662f\u6bd4\u8d77 Remcached\uff0c\u8fd8\u662f\u7a0d\u6709\u900a\u8272\u3002</li>\n</ul>", "body_md": "### \u7f13\u5b58\u96ea\u5d29\n- \u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\n> \u7f13\u5b58\u96ea\u5d29\u662f\u6307\u7f13\u5b58\u4e2d\u6570\u636e\u5927\u6279\u91cf\u5230\u8fc7\u671f\u65f6\u95f4\uff0c\u800c\u67e5\u8be2\u6570\u636e\u91cf\u5de8\u5927\uff0c\u7ed5\u8fc7redis\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\u5f15\u8d77\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\u751a\u81f3\u5b95\u673a\u3002\u548c\u7f13\u5b58\u51fb\u7a7f\u4e0d\u540c\u7684\u662f\uff0c\u7f13\u5b58\u51fb\u7a7f\u6307\u5e76\u53d1\u67e5\u540c\u4e00\u6761\u6570\u636e\uff0c\u7f13\u5b58\u96ea\u5d29\u662f\u4e0d\u540c\u6570\u636e\u90fd\u8fc7\u671f\u4e86\uff0c\u5f88\u591a\u6570\u636e\u90fd\u67e5\u4e0d\u5230\u4ece\u800c\u67e5\u6570\u636e\u5e93\u3002\n- \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u96ea\u5d29\n>1. \u7f13\u5b58\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u968f\u673a\uff0c\u9632\u6b62\u540c\u4e00\u65f6\u95f4\u5927\u91cf\u6570\u636e\u8fc7\u671f\u73b0\u8c61\u53d1\u751f\u3002\n>\t`redis.set('key','value',ex='time'+random.random()*10000)`\n>2. \u5982\u679c\u7f13\u5b58\u6570\u636e\u5e93\u662f\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u5c06\u70ed\u70b9\u6570\u636e\u5747\u5300\u5206\u5e03\u5728\u4e0d\u540c\u641e\u5f97\u7f13\u5b58\u6570\u636e\u5e93\u4e2d\u3002\n>3. \u8bbe\u7f6e\u70ed\u70b9\u6570\u636e\u6c38\u8fdc\u4e0d\u8fc7\u671f\u3002\n>4. \u4f7f\u7528\u5feb\u901f\u5931\u8d25\u7684\u7194\u65ad\u7b56\u7565\uff0c\u51cf\u5c11 DB \u77ac\u95f4\u538b\u529b\uff1b\n>5. \u4f7f\u7528\u4e3b\u4ece\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u6765\u5c3d\u91cf\u4fdd\u8bc1\u7f13\u5b58\u670d\u52a1\u7684\u9ad8\u53ef\u7528\n\n### \u7f13\u5b58\u7a7f\u900f\n- \u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f\n>\u7f13\u5b58\u7a7f\u900f\u662f\u6307\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u7684\u6570\u636e\uff0c\u800c\u7528\u6237\u4e0d\u65ad\u53d1\u8d77\u8bf7\u6c42\uff0c\u7ed5\u8fc7redis\u91cd\u590d\u8bf7\u6c42\u6570\u636e\u5e93\uff0c\u5982\u53d1\u8d77\u4e3aid\u4e3a\u201c-1\u201d\u7684\u6570\u636e\u6216id\u4e3a\u7279\u522b\u5927\u4e0d\u5b58\u5728\u7684\u6570\u636e\u3002\u8fd9\u65f6\u7684\u7528\u6237\u5f88\u53ef\u80fd\u662f\u653b\u51fb\u8005\uff0c\u653b\u51fb\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\u3002\n- \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\n>1. \u63a5\u53e3\u5c42\u589e\u52a0\u6821\u9a8c\uff0c\u5982\u7528\u6237\u9274\u6743\u6821\u9a8c\uff0cid\u505a\u57fa\u7840\u6821\u9a8c\uff0cid<=0\u7684\u76f4\u63a5\u62e6\u622a\uff1b\n>2. \u4ece\u7f13\u5b58\u53d6\u4e0d\u5230\u7684\u6570\u636e\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u53d6\u5230\uff0c\u8fd9\u65f6\u4e5f\u53ef\u4ee5\u5c06key-value\u5bf9\u5199\u4e3akey-null\uff0c\u7f13\u5b58\u6709\u6548\u65f6\u95f4\u53ef\u4ee5\u8bbe\u7f6e\u77ed\u70b9\uff0c\u598230\u79d2\uff08\u8bbe\u7f6e\u592a\u957f\u4f1a\u5bfc\u81f4\u6b63\u5e38\u60c5\u51b5\u4e5f\u6ca1\u6cd5\u4f7f\u7528\uff09\u3002\u8fd9\u6837\u53ef\u4ee5\u9632\u6b62\u653b\u51fb\u7528\u6237\u53cd\u590d\u7528\u540c\u4e00\u4e2aid\u66b4\u529b\u653b\u51fb\n>3. \u4f7f\u7528 BloomFilter \u8fc7\u6ee4\u5668\uff0cBloomFilter \u7684\u7279\u70b9\u662f\u5b58\u5728\u6027\u68c0\u6d4b\uff0c\u5982\u679c BloomFilter \u4e2d\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u6570\u636e\u4e00\u5b9a\u4e0d\u5b58\u5728\uff1b\u5982\u679c BloomFilter \u4e2d\u5b58\u5728\uff0c\u5b9e\u9645\u6570\u636e\u4e5f\u6709\u53ef\u80fd\u4f1a\u4e0d\u5b58\u5728\u3002\u975e\u5e38\u9002\u5408\u89e3\u51b3\u8fd9\u7c7b\u7684\u95ee\u9898\u3002\n\n### \u7f13\u5b58\u51fb\u7a7f\n- \u4ec0\u4e48\u662f\u7f13\u5b58\u51fb\u7a7f\n>\u7f13\u5b58\u51fb\u7a7f\u662f\u6307\u7f13\u5b58\u4e2d\u6ca1\u6709\u4f46\u6570\u636e\u5e93\u4e2d\u6709\u7684\u6570\u636e\uff08\u4e00\u822c\u662f\u7f13\u5b58\u65f6\u95f4\u5230\u671f\uff09\uff0c\u8fd9\u65f6\u7531\u4e8e\u5e76\u53d1\u7528\u6237\u7279\u522b\u591a\uff0c\u540c\u65f6\u8bfb\u7f13\u5b58\u6ca1\u8bfb\u5230\u6570\u636e\uff0c\u53c8\u540c\u65f6\u53bb\u6570\u636e\u5e93\u53bb\u53d6\u6570\u636e\uff0c\u5f15\u8d77\u6570\u636e\u5e93\u538b\u529b\u77ac\u95f4\u589e\u5927\uff0c\u9020\u6210\u8fc7\u5927\u538b\u529b\u3002\u4e00\u822c\u6307\u5355\u4e00\u7684\u70ed\u70b9\u6570\u636e\n- \u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\n>1. \u53ef\u4ee5\u4f7f\u7528\u4e92\u65a5\u9501\u66f4\u65b0\uff0c\u4fdd\u8bc1\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u9488\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\u4e0d\u4f1a\u5e76\u53d1\u8bf7\u6c42\u5230 DB\uff0c\u51cf\u5c0f DB \u538b\u529b\u3002\n>2. \u4f7f\u7528\u968f\u673a\u9000\u907f\u65b9\u5f0f\uff0c\u5931\u6548\u65f6\u968f\u673a sleep \u4e00\u4e2a\u5f88\u77ed\u7684\u65f6\u95f4\uff0c\u518d\u6b21\u67e5\u8be2\uff0c\u5982\u679c\u5931\u8d25\u518d\u6267\u884c\u66f4\u65b0\u3002\n>3. \u9488\u5bf9\u591a\u4e2a\u70ed\u70b9 key \u540c\u65f6\u5931\u6548\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u5728\u7f13\u5b58\u65f6\u4f7f\u7528\u56fa\u5b9a\u65f6\u95f4\u52a0\u4e0a\u4e00\u4e2a\u5c0f\u7684\u968f\u673a\u6570\uff0c\u907f\u514d\u5927\u91cf\u70ed\u70b9 key \u540c\u4e00\u65f6\u523b\u5931\u6548\u3002\n\n### redis\u4e3a\u4ec0\u4e48\u5feb\u901f\n- \u57fa\u4e8e\u5185\u5b58\n- \u5355\u7ebf\u7a0b\uff0c\u907f\u514d\u4e0a\u4e0b\u6587\u5207\u6362\n- \u6570\u636e\u7ed3\u6784\u4e13\u95e8\u8bbe\u8ba1\n- \u4f7f\u7528\u591a\u8defI/O\u590d\u7528\u6a21\u578b\uff0c\u975e\u963b\u585eIO\n- \u5e95\u5c42\u6a21\u578b\u4e0d\u540c\n\n### \u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u5e38\u7528\u573a\u666f\n#### string\n1. \u7f13\u5b58\n2. \u8ba1\u6570\u5668\n3. \u5171\u4eab\u7528\u6237session\n#### Hash\n#### list\n1. \u6d88\u606f\u961f\u5217\n2. \u5217\u8868\u5c55\u793a\u9875\n#### set\n1. \u5171\u540c\u597d\u53cb\n#### Sorted Set\n1. \u6392\u884c\u699c\n\n### \u7ecf\u5178\u7684kv\uff0cdb\u8bfb\u5199\u65b9\u5f0f\n- \u8bfb\u7684\u65f6\u5019\uff0c\u5148\u8bfb\u7f13\u5b58\uff0c\u7f13\u5b58\u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u8bfb\u6570\u636e\u5e93\uff0c\u7136\u540e\u53d6\u51fa\u6570\u636e\u540e\u653e\u5165\u7f13\u5b58\uff0c\u540c\u65f6\u8fd4\u56de\u54cd\u5e94\u3002\n- \u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58\u3002\n\n### Redis \u548c Memcached \u6709\u5565\u533a\u522b\uff0c\u4e3a\u5565\u9009\u62e9Redis\u4f5c\u4e3a\u7f13\u5b58\u4e2d\u95f4\u4ef6\uff1f\n- Redis \u652f\u6301\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff1a\n- Redis \u76f8\u6bd4 Memcached \u6765\u8bf4\uff0c\u62e5\u6709\u66f4\u591a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u80fd\u652f\u6301\u66f4\u4e30\u5bcc\u7684\u6570\u636e\u64cd\u4f5c\u3002\u5982\u679c\u9700\u8981\u7f13\u5b58\u80fd\u591f\u652f\u6301\u66f4\u590d\u6742\u7684\u7ed3\u6784\u548c\u64cd\u4f5c\uff0c Redis \u4f1a\u662f\u4e0d\u9519\u7684\u9009\u62e9\u3002\n- Redis \u539f\u751f\u652f\u6301\u96c6\u7fa4\u6a21\u5f0f\uff1a\n- \u5728 redis3.x \u7248\u672c\u4e2d\uff0c\u4fbf\u80fd\u652f\u6301 Cluster \u6a21\u5f0f\uff0c\u800c Memcached \u6ca1\u6709\u539f\u751f\u7684\u96c6\u7fa4\u6a21\u5f0f\uff0c\u9700\u8981\u4f9d\u9760\u5ba2\u6237\u7aef\u6765\u5b9e\u73b0\u5f80\u96c6\u7fa4\u4e2d\u5206\u7247\u5199\u5165\u6570\u636e\u3002\n\u6027\u80fd\u5bf9\u6bd4\uff1a\n\u7531\u4e8e Redis \u53ea\u4f7f\u7528\u5355\u6838\uff0c\u800c Memcached \u53ef\u4ee5\u4f7f\u7528\u591a\u6838\uff0c\u6240\u4ee5\u5e73\u5747\u6bcf\u4e00\u4e2a\u6838\u4e0a Redis \u5728\u5b58\u50a8\u5c0f\u6570\u636e\u65f6\u6bd4 Memcached \u6027\u80fd\u66f4\u9ad8\u3002\u800c\u5728 100k \u4ee5\u4e0a\u7684\u6570\u636e\u4e2d\uff0cMemcached \u6027\u80fd\u8981\u9ad8\u4e8e Redis\uff0c\u867d\u7136 Redis \u6700\u8fd1\u4e5f\u5728\u5b58\u50a8\u5927\u6570\u636e\u7684\u6027\u80fd\u4e0a\u8fdb\u884c\u4f18\u5316\uff0c\u4f46\u662f\u6bd4\u8d77 Remcached\uff0c\u8fd8\u662f\u7a0d\u6709\u900a\u8272\u3002", "excerpt": "\u7f13\u5b58\u96ea\u5d29\n\n\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\n\n\n\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u7f13\u5b58\u4e2d\u6570\u636e\u5927\u6279\u91cf\u5230\u8fc7\u671f\u65f6\u95f4\uff0c\u800c\u67e5\u8be2\u6570\u636e\u91cf\u5de8\u5927\uff0c\u7ed5\u8fc7redis\u76f4\u63a5\u8bf7\u6c42\u6570\u636e\u5e93\u5f15\u8d77\u6570\u636e\u5e93\u538b\u529b\u8fc7\u5927\u751a\u81f3\u5b95\u673a\u3002\u548c\u7f13\u5b58\u51fb\u7a7f\u4e0d\u540c\u7684\u662f\uff0c\u7f13\u5b58\u51fb\u7a7f\u6307\u5e76\u53d1\u67e5\u540c\u4e00\u6761\u6570\u636e\uff0c\u7f13\u5b58\u96ea\u5d29\u662f\u4e0d\u540c\u6570\u636e\u90fd\u8fc7\u671f\u4e86\uff0c\u5f88\u591a\u6570\u636e\u90fd\u67e5\u4e0d\u5230\u4ece\u800c\u67e5\u6570\u636e\u5e93\u3002\n\n\n\u5982\u4f55\u89e3\u51b3\u7f13\u5b58\u96ea\u5d29\n\n\n\n\u7f13\u5b58\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4", "codestyle": "monokai", "reproduce": false, "reproduce_source": "", "create_date": "2020-03-10T22:59:07.053", "mod_date": "2020-03-10T22:59:07.053", "views_count": 13, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "e4798d2b-e4e5-4abb-bb9e-c47564675878", "category": 6, "tags": [8]}}, {"model": "blog.post", "pk": 15, "fields": {"title": "Lru\u7b97\u6cd5\uff1a\u7f13\u5b58\u7684\u5b9e\u73b0.", "body": "<h2><a id=\"_Lru_0\"></a>\u4ec0\u4e48\u662f Lru</h2>\n<p>\u6309\u7167\u82f1\u6587\u7684\u76f4\u63a5\u539f\u4e49\u5c31\u662fLeast Recently Used,\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u6cd5\uff0c\u5b83\u662f\u6309\u7167\u4e00\u4e2a\u975e\u5e38\u8457\u540d\u7684\u8ba1\u7b97\u673a\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u7406\u8bba\u5f97\u6765\u7684\uff1a\u6700\u8fd1\u4f7f\u7528\u7684\u9875\u9762\u6570\u636e\u4f1a\u5728\u672a\u6765\u4e00\u6bb5\u65f6\u671f\u5185\u4ecd\u7136\u88ab\u4f7f\u7528,\u5df2\u7ecf\u5f88\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u9875\u9762\u5f88\u6709\u53ef\u80fd\u5728\u672a\u6765\u8f83\u957f\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\u4ecd\u7136\u4e0d\u4f1a\u88ab\u4f7f\u7528\u3002\u57fa\u4e8e\u8fd9\u4e2a\u601d\u60f3,\u4f1a\u5b58\u5728\u4e00\u79cd\u7f13\u5b58\u6dd8\u6c70\u673a\u5236\uff0c\u6bcf\u6b21\u4ece\u5185\u5b58\u4e2d\u627e\u5230\u6700\u4e45\u672a\u4f7f\u7528\u7684\u6570\u636e\u7136\u540e\u7f6e\u6362\u51fa\u6765\uff0c\u4ece\u800c\u5b58\u5165\u65b0\u7684\u6570\u636e\uff01\u5b83\u7684\u4e3b\u8981\u8861\u91cf\u6307\u6807\u662f\u4f7f\u7528\u7684\u65f6\u95f4\uff0c\u9644\u52a0\u6307\u6807\u662f\u4f7f\u7528\u7684\u6b21\u6570\u3002\u5728\u8ba1\u7b97\u673a\u4e2d\u5927\u91cf\u4f7f\u7528\u4e86\u8fd9\u4e2a\u673a\u5236\uff0c\u5b83\u7684\u5408\u7406\u6027\u5728\u4e8e\u4f18\u5148\u7b5b\u9009\u70ed\u70b9\u6570\u636e\uff0c\u6240\u8c13\u70ed\u70b9\u6570\u636e\uff0c\u5c31\u662f\u6700\u8fd1\u6700\u591a\u4f7f\u7528\u7684\u6570\u636e\uff01\u56e0\u4e3a\uff0c\u5229\u7528LRU\u6211\u4eec\u53ef\u4ee5\u89e3\u51b3\u5f88\u591a\u5b9e\u9645\u5f00\u53d1\u4e2d\u7684\u95ee\u9898\uff0c\u5e76\u4e14\u5f88\u7b26\u5408\u4e1a\u52a1\u573a\u666f</p>\n<h2><a id=\"python_3\"></a>python\u5b9e\u73b0</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-keyword\">from</span> collections <span class=\"hljs-keyword\">import</span> OrderedDict\n\n<span class=\"hljs-comment\"># \u57fa\u4e8eOrderedDict\u5b9e\u73b0</span>\n\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">LRUCache</span>:</span>\n    <span class=\"hljs-string\">\"\"\"\n       function:\u5229\u7528collection.OrderedDict\u6570\u636e\u7c7b\u578b\u5b9e\u73b0\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\n                OrderedDict\u6709\u4e2a\u7279\u6b8a\u65b9\u6cd5popitem(Last=False)\u65f6\u5219\u5b9e\u73b0\u961f\u5217\uff0c\u5f39\u51fa\u6700\u5148\u63d2\u5165\u7684\u5143\u7d20\uff0c\n                \u800c\u5f53Last=True\u5219\u5b9e\u73b0\u5806\u6808\u65b9\u6cd5\uff0c\u5f39\u51fa\u7684\u662f\u6700\u8fd1\u63d2\u5165\u7684\u90a3\u4e2a\u5143\u7d20\n                \u5b9e\u73b0\u4e86\u4e24\u4e2a\u65b9\u6cd5\uff1aget(key\uff09\u53d6\u51fa\u952e\u4e2d\u5bf9\u5e94\u7684\u503c\uff0c\u82e5\u6ca1\u6709\u8fd4\u56deNone\n                                set(key, value) \u6839\u636eLRU\u7279\u6027\u6dfb\u52a0\u5143\u7d20\n    \"\"\"</span>\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, size=<span class=\"hljs-number\">5</span>)</span>:</span>\n        self.size = size\n        self.cache = OrderedDict()\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get</span><span class=\"hljs-params\">(self, key)</span>:</span>\n        <span class=\"hljs-comment\"># \u5982\u679c\u67e5\u8be2\u5230key  \u79fb\u9664key\u518d\u8bbe\u7f6e\u5230\u5b57\u5178\u6700\u540e</span>\n        <span class=\"hljs-keyword\">if</span> self.cache.get(key):\n            value = self.cache.pop(key)\n            self.cache[key] = value\n        <span class=\"hljs-keyword\">else</span>:\n            value = <span class=\"hljs-keyword\">None</span>\n        <span class=\"hljs-keyword\">return</span> value\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">set</span><span class=\"hljs-params\">(self, key, value)</span>:</span>\n        <span class=\"hljs-keyword\">if</span> self.cache.get(key):         <span class=\"hljs-comment\"># \u6570\u636e\u5728\u7f13\u5b58\u91cc\uff0c\u76f4\u63a5\u79fb\u9664\u7136\u540e\u653e\u5230\u6700\u65b0\u4f4d\u7f6e</span>\n            self.cache.pop(key)\n            self.cache[key] = value\n        <span class=\"hljs-keyword\">elif</span> self.size == len(self.cache):      <span class=\"hljs-comment\"># \u6570\u636e\u4e0d\u5728\u7f13\u5b58\u91cc\uff0c\u4e14\u7f13\u5b58\u961f\u5217\u5df2\u6ee1\uff0c\u79fb\u9664\u7b2c\u4e00\u4e2a\u6700\u8001\u7684\u6570\u636e</span>\n            self.cache.popitem(last=<span class=\"hljs-keyword\">False</span>)\n            self.cache[key] = value\n        <span class=\"hljs-keyword\">else</span>:\n            self.cache[key] = value\n\n</code></div></pre>\n<p>python3\u5185\u7f6e\u4e86lru\u7b97\u6cd5<br />\n<code>from functools import lru_cache</code></p>", "body_md": "## \u4ec0\u4e48\u662f Lru\n\u6309\u7167\u82f1\u6587\u7684\u76f4\u63a5\u539f\u4e49\u5c31\u662fLeast Recently Used,\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u6cd5\uff0c\u5b83\u662f\u6309\u7167\u4e00\u4e2a\u975e\u5e38\u8457\u540d\u7684\u8ba1\u7b97\u673a\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u7406\u8bba\u5f97\u6765\u7684\uff1a\u6700\u8fd1\u4f7f\u7528\u7684\u9875\u9762\u6570\u636e\u4f1a\u5728\u672a\u6765\u4e00\u6bb5\u65f6\u671f\u5185\u4ecd\u7136\u88ab\u4f7f\u7528,\u5df2\u7ecf\u5f88\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u9875\u9762\u5f88\u6709\u53ef\u80fd\u5728\u672a\u6765\u8f83\u957f\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\u4ecd\u7136\u4e0d\u4f1a\u88ab\u4f7f\u7528\u3002\u57fa\u4e8e\u8fd9\u4e2a\u601d\u60f3,\u4f1a\u5b58\u5728\u4e00\u79cd\u7f13\u5b58\u6dd8\u6c70\u673a\u5236\uff0c\u6bcf\u6b21\u4ece\u5185\u5b58\u4e2d\u627e\u5230\u6700\u4e45\u672a\u4f7f\u7528\u7684\u6570\u636e\u7136\u540e\u7f6e\u6362\u51fa\u6765\uff0c\u4ece\u800c\u5b58\u5165\u65b0\u7684\u6570\u636e\uff01\u5b83\u7684\u4e3b\u8981\u8861\u91cf\u6307\u6807\u662f\u4f7f\u7528\u7684\u65f6\u95f4\uff0c\u9644\u52a0\u6307\u6807\u662f\u4f7f\u7528\u7684\u6b21\u6570\u3002\u5728\u8ba1\u7b97\u673a\u4e2d\u5927\u91cf\u4f7f\u7528\u4e86\u8fd9\u4e2a\u673a\u5236\uff0c\u5b83\u7684\u5408\u7406\u6027\u5728\u4e8e\u4f18\u5148\u7b5b\u9009\u70ed\u70b9\u6570\u636e\uff0c\u6240\u8c13\u70ed\u70b9\u6570\u636e\uff0c\u5c31\u662f\u6700\u8fd1\u6700\u591a\u4f7f\u7528\u7684\u6570\u636e\uff01\u56e0\u4e3a\uff0c\u5229\u7528LRU\u6211\u4eec\u53ef\u4ee5\u89e3\u51b3\u5f88\u591a\u5b9e\u9645\u5f00\u53d1\u4e2d\u7684\u95ee\u9898\uff0c\u5e76\u4e14\u5f88\u7b26\u5408\u4e1a\u52a1\u573a\u666f\n\n## python\u5b9e\u73b0\n```py\nfrom collections import OrderedDict\n\n# \u57fa\u4e8eOrderedDict\u5b9e\u73b0\n\n\nclass LRUCache:\n    \"\"\"\n       function:\u5229\u7528collection.OrderedDict\u6570\u636e\u7c7b\u578b\u5b9e\u73b0\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\n                OrderedDict\u6709\u4e2a\u7279\u6b8a\u65b9\u6cd5popitem(Last=False)\u65f6\u5219\u5b9e\u73b0\u961f\u5217\uff0c\u5f39\u51fa\u6700\u5148\u63d2\u5165\u7684\u5143\u7d20\uff0c\n                \u800c\u5f53Last=True\u5219\u5b9e\u73b0\u5806\u6808\u65b9\u6cd5\uff0c\u5f39\u51fa\u7684\u662f\u6700\u8fd1\u63d2\u5165\u7684\u90a3\u4e2a\u5143\u7d20\n                \u5b9e\u73b0\u4e86\u4e24\u4e2a\u65b9\u6cd5\uff1aget(key\uff09\u53d6\u51fa\u952e\u4e2d\u5bf9\u5e94\u7684\u503c\uff0c\u82e5\u6ca1\u6709\u8fd4\u56deNone\n                                set(key, value) \u6839\u636eLRU\u7279\u6027\u6dfb\u52a0\u5143\u7d20\n    \"\"\"\n\n    def __init__(self, size=5):\n        self.size = size\n        self.cache = OrderedDict()\n\n    def get(self, key):\n        # \u5982\u679c\u67e5\u8be2\u5230key  \u79fb\u9664key\u518d\u8bbe\u7f6e\u5230\u5b57\u5178\u6700\u540e\n        if self.cache.get(key):\n            value = self.cache.pop(key)\n            self.cache[key] = value\n        else:\n            value = None\n        return value\n\n    def set(self, key, value):\n        if self.cache.get(key):         # \u6570\u636e\u5728\u7f13\u5b58\u91cc\uff0c\u76f4\u63a5\u79fb\u9664\u7136\u540e\u653e\u5230\u6700\u65b0\u4f4d\u7f6e\n            self.cache.pop(key)\n            self.cache[key] = value\n        elif self.size == len(self.cache):      # \u6570\u636e\u4e0d\u5728\u7f13\u5b58\u91cc\uff0c\u4e14\u7f13\u5b58\u961f\u5217\u5df2\u6ee1\uff0c\u79fb\u9664\u7b2c\u4e00\u4e2a\u6700\u8001\u7684\u6570\u636e\n            self.cache.popitem(last=False)\n            self.cache[key] = value\n        else:\n            self.cache[key] = value\n\n```\npython3\u5185\u7f6e\u4e86lru\u7b97\u6cd5\n`\nfrom functools import lru_cache\n`", "excerpt": "\u4ec0\u4e48\u662f Lru\n\u6309\u7167\u82f1\u6587\u7684\u76f4\u63a5\u539f\u4e49\u5c31\u662fLeast Recently Used,\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u6cd5\uff0c\u5b83\u662f\u6309\u7167\u4e00\u4e2a\u975e\u5e38\u8457\u540d\u7684\u8ba1\u7b97\u673a\u64cd\u4f5c\u7cfb\u7edf\u57fa\u7840\u7406\u8bba\u5f97\u6765\u7684\uff1a\u6700\u8fd1\u4f7f\u7528\u7684\u9875\u9762\u6570\u636e\u4f1a\u5728\u672a\u6765\u4e00\u6bb5\u65f6\u671f\u5185\u4ecd\u7136\u88ab\u4f7f\u7528,\u5df2\u7ecf\u5f88\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u9875\u9762\u5f88\u6709\u53ef\u80fd\u5728\u672a\u6765\u8f83\u957f\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\u4ecd\u7136\u4e0d\u4f1a\u88ab\u4f7f\u7528\u3002\u57fa\u4e8e\u8fd9\u4e2a\u601d\u60f3,\u4f1a\u5b58\u5728\u4e00\u79cd\u7f13\u5b58\u6dd8\u6c70\u673a\u5236", "codestyle": "atelier-heath-dark", "reproduce": false, "reproduce_source": "", "create_date": "2020-03-11T03:19:53.204", "mod_date": "2020-03-11T03:19:53.204", "views_count": 25, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "e4798d2b-e4e5-4abb-bb9e-c47564675878", "category": 1, "tags": []}}, {"model": "blog.post", "pk": 16, "fields": {"title": "redis\u4f7f\u7528", "body": "<h2><a id=\"pythonredis_0\"></a>python\u64cd\u4f5credis</h2>\n<p>RedisPy\u5e93\u63d0\u4f9b\u4e24\u4e2a\u7c7bRedis\u548cStrictRedis\u6765\u5b9e\u73b0Redis\u7684\u547d\u4ee4\u64cd\u4f5c\u3002</p>\n<blockquote>\n<p>\u6bb5\u843d\u5f15\u7528StrictRedis\u5b9e\u73b0\u4e86\u7edd\u5927\u90e8\u5206\u5b98\u65b9\u7684\u547d\u4ee4\uff0c\u53c2\u6570\u4e5f\u4e00\u4e00\u5bf9\u5e94\uff0c\u6bd4\u5982set()\u65b9\u6cd5\u5c31\u5bf9\u5e94Redis\u547d\u4ee4\u7684set\u65b9\u6cd5\u3002\u800cRedis\u662fStrictRedis\u7684\u5b50\u7c7b\uff0c\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u662f\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u65e7\u7248\u672c\u5e93\u91cc\u7684\u51e0\u4e2a\u65b9\u6cd5\u3002\u4e3a\u4e86\u505a\u517c\u5bb9\uff0c\u5b83\u5c06\u65b9\u6cd5\u505a\u4e86\u6539\u5199\uff0c\u6bd4\u5982lrem()\u65b9\u6cd5\u5c31\u5c06value\u548cnum\u53c2\u6570\u7684\u4f4d\u7f6e\u4e92\u6362\uff0c\u8fd9\u548cRedis\u547d\u4ee4\u884c\u7684\u547d\u4ee4\u53c2\u6570\u4e0d\u4e00\u81f4\u3002</p>\n<blockquote>\n<p>\u5efa\u8bae\u4f7f\u7528StrictRedis</p>\n</blockquote>\n</blockquote>\n<h2><a id=\"redis_8\"></a>\u5b89\u88c5redis</h2>\n<pre><code class=\"lang-\">pipenv install redis\n# django\u5b89\u88c5django-redis\npipenv install django-redis\n</code></pre>\n<h2><a id=\"djangoredis_14\"></a>django\u914d\u7f6eredis\u7f13\u5b58</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\">CACHES = {\n    <span class=\"hljs-string\">\"default\"</span>: {\n        <span class=\"hljs-string\">\"BACKEND\"</span>: <span class=\"hljs-string\">\"django_redis.cache.RedisCache\"</span>,\n        <span class=\"hljs-string\">\"LOCATION\"</span>: <span class=\"hljs-string\">\"redis://127.0.0.1:6379\"</span>,\n        <span class=\"hljs-string\">\"OPTIONS\"</span>: {\n            <span class=\"hljs-string\">\"CLIENT_CLASS\"</span>: <span class=\"hljs-string\">\"django_redis.client.DefaultClient\"</span>,\n            <span class=\"hljs-string\">\"CONNECTION_POOL_KWARGS\"</span>: {<span class=\"hljs-string\">\"max_connections\"</span>: <span class=\"hljs-number\">100</span>},\n        }\n    }\n}\n\n</code></div></pre>\n<h2><a id=\"Redis_29\"></a>\u8fde\u63a5Redis(\u8fde\u63a5\u6c60)</h2>\n<blockquote>\n<p>redis-py\u4f7f\u7528connection pool\u6765\u7ba1\u7406\u5bf9\u4e00\u4e2aredis server\u7684\u6240\u6709\u8fde\u63a5\uff0c\u907f\u514d\u6bcf\u6b21\u5efa\u7acb\u3001\u91ca\u653e\u8fde\u63a5\u7684\u5f00\u9500\u3002\u9ed8\u8ba4\uff0c\u6bcf\u4e2aRedis\u5b9e\u4f8b\u90fd\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u81ea\u5df1\u7684\u8fde\u63a5\u6c60\u3002\u53ef\u4ee5\u76f4\u63a5\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u6c60\uff0c\u7136\u540e\u4f5c\u4e3a\u53c2\u6570Redis\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2aRedis\u5b9e\u4f8b\u5171\u4eab\u4e00\u4e2a\u8fde\u63a5\u6c60\u3002</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-keyword\">import</span> redis\n<span class=\"hljs-comment\"># \u8fde\u63a5\u6c60</span>\npool = redis.ConnectionPool(host=<span class=\"hljs-string\">'localhost'</span>, port=<span class=\"hljs-number\">6379</span>,db=<span class=\"hljs-number\">0</span>, password=<span class=\"hljs-string\">'password'</span>,decode_responses=<span class=\"hljs-keyword\">True</span>,max_connections=<span class=\"hljs-number\">100</span>)\n\nredis = redis.StrictRedis(connection_pool=pool)\n</code></div></pre>\n<h2><a id=\"redis_38\"></a>\u83b7\u5f97\u5f53\u524dredis\u914d\u7f6e</h2>\n<blockquote>\n<p>redis-cli\u547d\u4ee4\u884c<code>CONFIG GET *</code> \u83b7\u5f97\u6240\u6709\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u83b7\u5f97\u5355\u72ec\u914d\u7f6e</p>\n</blockquote>\n<h2><a id=\"_41\"></a>\u952e\u64cd\u4f5c</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">\u65b9\u6cd5</th>\n<th style=\"text-align:center\">\u4f5c\u7528</th>\n<th style=\"text-align:center\">\u53c2\u6570\u8bf4\u660e</th>\n<th style=\"text-align:center\">\u793a\u4f8b</th>\n<th style=\"text-align:center\">\u793a\u4f8b\u8bf4\u660e</th>\n<th style=\"text-align:center\">\u793a\u4f8b\u7ed3\u679c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">exists(name)</td>\n<td style=\"text-align:center\">\u5224\u65ad\u4e00\u4e2a\u952e\u662f\u5426\u5b58\u5728</td>\n<td style=\"text-align:center\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:center\">redis.exists(\u2018name\u2019)</td>\n<td style=\"text-align:center\">\u662f\u5426\u5b58\u5728name\u8fd9\u4e2a\u952e</td>\n<td style=\"text-align:center\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">delete(name)</td>\n<td style=\"text-align:center\">\u5220\u9664\u4e00\u4e2a\u952e</td>\n<td style=\"text-align:center\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:center\">redis.delete(\u2018name\u2019)</td>\n<td style=\"text-align:center\">\u5220\u9664name\u8fd9\u4e2a\u952e</td>\n<td style=\"text-align:center\">1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">type(name)</td>\n<td style=\"text-align:center\">\u5224\u65ad\u952e\u7c7b\u578b</td>\n<td style=\"text-align:center\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:center\">redis.type(\u2018name\u2019)</td>\n<td style=\"text-align:center\">\u5224\u65adname\u8fd9\u4e2a\u952e\u7c7b\u578b</td>\n<td style=\"text-align:center\">b\u2019string\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">keys(pattern)</td>\n<td style=\"text-align:center\">\u83b7\u53d6\u6240\u6709\u7b26\u5408\u89c4\u5219\u7684\u952e</td>\n<td style=\"text-align:center\">pattern\uff1a\u5339\u914d\u89c4\u5219</td>\n<td style=\"text-align:center\">redis.keys(\u2018n*\u2019)</td>\n<td style=\"text-align:center\">\u83b7\u53d6\u6240\u6709\u4ee5n\u5f00\u5934\u7684\u952e</td>\n<td style=\"text-align:center\">[b\u2019name\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">randomkey()</td>\n<td style=\"text-align:center\">\u83b7\u53d6\u968f\u673a\u7684\u4e00\u4e2a\u952e</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">randomkey()</td>\n<td style=\"text-align:center\">\u83b7\u53d6\u968f\u673a\u7684\u4e00\u4e2a\u952e</td>\n<td style=\"text-align:center\">b\u2019name\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">rename(src, dst)</td>\n<td style=\"text-align:center\">\u91cd\u547d\u540d\u952e</td>\n<td style=\"text-align:center\">src\uff1a\u539f\u952e\u540d\uff1bdst\uff1a\u65b0\u952e\u540d</td>\n<td style=\"text-align:center\">redis.rename(\u2018name\u2019, \u2018nickname\u2019)</td>\n<td style=\"text-align:center\">\u5c06name\u91cd\u547d\u540d\u4e3anickname</td>\n<td style=\"text-align:center\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">dbsize()</td>\n<td style=\"text-align:center\">\u83b7\u53d6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u952e\u7684\u6570\u76ee</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">dbsize()</td>\n<td style=\"text-align:center\">\u83b7\u53d6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u952e\u7684\u6570\u76ee</td>\n<td style=\"text-align:center\">100</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">expire(name, time)</td>\n<td style=\"text-align:center\">\u8bbe\u5b9a\u952e\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2</td>\n<td style=\"text-align:center\">name\uff1a\u952e\u540d\uff1btime\uff1a\u79d2\u6570</td>\n<td style=\"text-align:center\">redis.expire(\u2018name\u2019, 2)</td>\n<td style=\"text-align:center\">\u5c06name\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a2\u79d2</td>\n<td style=\"text-align:center\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ttl(name)</td>\n<td style=\"text-align:center\">\u83b7\u53d6\u952e\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c-1\u8868\u793a\u6c38\u4e45\u4e0d\u8fc7\u671f</td>\n<td style=\"text-align:center\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:center\">redis.ttl(\u2018name\u2019)</td>\n<td style=\"text-align:center\">\u83b7\u53d6name\u8fd9\u4e2a\u952e\u7684\u8fc7\u671f\u65f6\u95f4</td>\n<td style=\"text-align:center\">-1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">move(name, db)</td>\n<td style=\"text-align:center\">\u5c06\u952e\u79fb\u52a8\u5230\u5176\u4ed6\u6570\u636e\u5e93</td>\n<td style=\"text-align:center\">name\uff1a\u952e\u540d\uff1bdb\uff1a\u6570\u636e\u5e93\u4ee3\u53f7</td>\n<td style=\"text-align:center\">move(\u2018name\u2019, 2)</td>\n<td style=\"text-align:center\">\u5c06name\u79fb\u52a8\u52302\u53f7\u6570\u636e\u5e93</td>\n<td style=\"text-align:center\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">flushdb()</td>\n<td style=\"text-align:center\">\u5220\u9664\u5f53\u524d\u9009\u62e9\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">flushdb()</td>\n<td style=\"text-align:center\">\u5220\u9664\u5f53\u524d\u9009\u62e9\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e</td>\n<td style=\"text-align:center\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">flushall()</td>\n<td style=\"text-align:center\">\u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">flushall()</td>\n<td style=\"text-align:center\">\u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e</td>\n<td style=\"text-align:center\">True</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"_59\"></a>\u5b57\u7b26\u4e32\u64cd\u4f5c</h2>\n<p>Redis\u652f\u6301\u6700\u57fa\u672c\u7684\u952e\u503c\u5bf9\u5f62\u5f0f\u5b58\u50a8\uff0c\u7528\u6cd5\u603b\u7ed3\u5982\u4e0b\u8868\u6240\u793a\u3002</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u4f5c\u7528</th>\n<th style=\"text-align:left\">\u53c2\u6570\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u7ed3\u679c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">set(name, value)</td>\n<td style=\"text-align:left\">\u7ed9\u6570\u636e\u5e93\u4e2d\u952e\u4e3aname\u7684string\u8d4b\u4e88\u503cvalue</td>\n<td style=\"text-align:left\">name: \u952e\u540d\uff1bvalue: \u503c</td>\n<td style=\"text-align:left\">redis.set(\u2018name\u2019, \u2018Bob\u2019)</td>\n<td style=\"text-align:left\">\u7ed9name\u8fd9\u4e2a\u952e\u7684value\u8d4b\u503c\u4e3aBob</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">get(name)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6570\u636e\u5e93\u4e2d\u952e\u4e3aname\u7684string\u7684value</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.get(\u2018name\u2019)</td>\n<td style=\"text-align:left\">\u8fd4\u56dename\u8fd9\u4e2a\u952e\u7684value</td>\n<td style=\"text-align:left\">b\u2019Bob\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">getset(name, value)</td>\n<td style=\"text-align:left\">\u7ed9\u6570\u636e\u5e93\u4e2d\u952e\u4e3aname\u7684string\u8d4b\u4e88\u503cvalue\u5e76\u8fd4\u56de\u4e0a\u6b21\u7684value</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalue\uff1a\u65b0\u503c</td>\n<td style=\"text-align:left\">redis.getset(\u2018name\u2019, \u2018Mike\u2019)</td>\n<td style=\"text-align:left\">\u8d4b\u503cname\u4e3aMike\u5e76\u5f97\u5230\u4e0a\u6b21\u7684value</td>\n<td style=\"text-align:left\">b\u2019Bob\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">mget(keys, *args)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u591a\u4e2a\u952e\u5bf9\u5e94\u7684value</td>\n<td style=\"text-align:left\">keys\uff1a\u952e\u7684\u5217\u8868</td>\n<td style=\"text-align:left\">redis.mget([\u2018name\u2019, \u2018nickname\u2019])</td>\n<td style=\"text-align:left\">\u8fd4\u56dename\u548cnickname\u7684value</td>\n<td style=\"text-align:left\">[b\u2019Mike\u2019, b\u2019Miker\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">setnx(name, value)</td>\n<td style=\"text-align:left\">\u5982\u679c\u4e0d\u5b58\u5728\u8fd9\u4e2a\u952e\u503c\u5bf9\uff0c\u5219\u66f4\u65b0value\uff0c\u5426\u5219\u4e0d\u53d8</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.setnx(\u2018newname\u2019, \u2018James\u2019)</td>\n<td style=\"text-align:left\">\u5982\u679cnewname\u8fd9\u4e2a\u952e\u4e0d\u5b58\u5728\uff0c\u5219\u8bbe\u7f6e\u503c\u4e3aJames</td>\n<td style=\"text-align:left\">\u7b2c\u4e00\u6b21\u8fd0\u884c\u7ed3\u679c\u662fTrue\uff0c\u7b2c\u4e8c\u6b21\u8fd0\u884c\u7ed3\u679c\u662fFalse</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">setex(name, time, value)</td>\n<td style=\"text-align:left\">\u8bbe\u7f6e\u53ef\u4ee5\u5bf9\u5e94\u7684\u503c\u4e3astring\u7c7b\u578b\u7684value\uff0c\u5e76\u6307\u5b9a\u6b64\u952e\u503c\u5bf9\u5e94\u7684\u6709\u6548\u671f</td>\n<td style=\"text-align:left\">name: \u952e\u540d\uff1btime: \u6709\u6548\u671f\uff1b value\uff1a\u503c</td>\n<td style=\"text-align:left\">redis.setex(\u2018name\u2019, 1, \u2018James\u2019)</td>\n<td style=\"text-align:left\">\u5c06name\u8fd9\u4e2a\u952e\u7684\u503c\u8bbe\u4e3aJames\uff0c\u6709\u6548\u671f\u4e3a1\u79d2</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">setrange(name, offset, value)</td>\n<td style=\"text-align:left\">\u8bbe\u7f6e\u6307\u5b9a\u952e\u7684value\u503c\u7684\u5b50\u5b57\u7b26\u4e32</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1boffset\uff1a\u504f\u79fb\u91cf\uff1bvalue\uff1a\u503c</td>\n<td style=\"text-align:left\">redis.set(\u2018name\u2019, \u2018Hello\u2019) redis.setrange(\u2018name\u2019, 6, \u2018World\u2019)</td>\n<td style=\"text-align:left\">\u8bbe\u7f6ename\u4e3aHello\u5b57\u7b26\u4e32\uff0c\u5e76\u5728index\u4e3a6\u7684\u4f4d\u7f6e\u8865World</td>\n<td style=\"text-align:left\">11\uff0c\u4fee\u6539\u540e\u7684\u5b57\u7b26\u4e32\u957f\u5ea6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">mset(mapping)</td>\n<td style=\"text-align:left\">\u6279\u91cf\u8d4b\u503c</td>\n<td style=\"text-align:left\">mapping\uff1a\u5b57\u5178</td>\n<td style=\"text-align:left\">redis.mset({\u2018name1\u2019: \u2018Durant\u2019, \u2018name2\u2019: \u2018James\u2019})</td>\n<td style=\"text-align:left\">\u5c06name1\u8bbe\u4e3aDurant\uff0cname2\u8bbe\u4e3aJames</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">msetnx(mapping)</td>\n<td style=\"text-align:left\">\u952e\u5747\u4e0d\u5b58\u5728\u65f6\u624d\u6279\u91cf\u8d4b\u503c</td>\n<td style=\"text-align:left\">mapping\uff1a\u5b57\u5178</td>\n<td style=\"text-align:left\">redis.msetnx({\u2018name3\u2019: \u2018Smith\u2019, \u2018name4\u2019: \u2018Curry\u2019})</td>\n<td style=\"text-align:left\">\u5728name3\u548cname4\u5747\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\u624d\u8bbe\u7f6e\u4e8c\u8005\u503c</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">incr(name, amount=1)</td>\n<td style=\"text-align:left\">\u952e\u4e3aname\u7684value\u589e\u503c\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u952e\u4e0d\u5b58\u5728\u5219\u88ab\u521b\u5efa\u5e76\u8bbe\u4e3aamount</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bamount\uff1a\u589e\u957f\u7684\u503c</td>\n<td style=\"text-align:left\">redis.incr(\u2018age\u2019, 1)</td>\n<td style=\"text-align:left\">age\u5bf9\u5e94\u7684\u503c\u589e1\uff0c\u82e5\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u521b\u5efa\u5e76\u8bbe\u7f6e\u4e3a1</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u4fee\u6539\u540e\u7684\u503c</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">decr(name, amount=1)</td>\n<td style=\"text-align:left\">\u952e\u4e3aname\u7684value\u51cf\u503c\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u952e\u4e0d\u5b58\u5728\u5219\u88ab\u521b\u5efa\u5e76\u5c06value\u8bbe\u7f6e\u4e3a-amount</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1b amount\uff1a\u51cf\u5c11\u7684\u503c</td>\n<td style=\"text-align:left\">redis.decr(\u2018age\u2019, 1)</td>\n<td style=\"text-align:left\">age\u5bf9\u5e94\u7684\u503c\u51cf1\uff0c\u82e5\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u521b\u5efa\u5e76\u8bbe\u7f6e\u4e3a-1</td>\n<td style=\"text-align:left\">-1\uff0c\u5373\u4fee\u6539\u540e\u7684\u503c</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">append(key, value)</td>\n<td style=\"text-align:left\">\u952e\u4e3aname\u7684string\u7684\u503c\u9644\u52a0value</td>\n<td style=\"text-align:left\">key\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.append(\u2018nickname\u2019, \u2018OK\u2019)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3anickname\u7684\u503c\u540e\u8ffd\u52a0OK</td>\n<td style=\"text-align:left\">13\uff0c\u5373\u4fee\u6539\u540e\u7684\u5b57\u7b26\u4e32\u957f\u5ea6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">substr(name, start, end=-1)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684string\u7684\u5b50\u4e32</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15\uff0c\u9ed8\u8ba4\u4e3a-1\uff0c\u8868\u793a\u622a\u53d6\u5230\u672b\u5c3e</td>\n<td style=\"text-align:left\">redis.substr(\u2018name\u2019, 1, 4)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u503c\u7684\u5b57\u7b26\u4e32\uff0c\u622a\u53d6\u7d22\u5f15\u4e3a1~4\u7684\u5b57\u7b26</td>\n<td style=\"text-align:left\">b\u2019ello\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">getrange(key, start, end)</td>\n<td style=\"text-align:left\">\u83b7\u53d6\u952e\u7684value\u503c\u4ecestart\u5230end\u7684\u5b50\u5b57\u7b26\u4e32</td>\n<td style=\"text-align:left\">key\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15</td>\n<td style=\"text-align:left\">redis.getrange(\u2018name\u2019, 1, 4)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u503c\u7684\u5b57\u7b26\u4e32\uff0c\u622a\u53d6\u7d22\u5f15\u4e3a1~4\u7684\u5b57\u7b26</td>\n<td style=\"text-align:left\">b\u2019ello\u2019</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"_80\"></a>\u6563\u5217\u64cd\u4f5c</h2>\n<p>Redis\u8fd8\u63d0\u4f9b\u4e86\u6563\u5217\u8868\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6211\u4eec\u53ef\u4ee5\u7528<code>name</code>\u6307\u5b9a\u4e00\u4e2a\u6563\u5217\u8868\u7684\u540d\u79f0\uff0c\u8868\u5185\u5b58\u50a8\u4e86\u5404\u4e2a\u952e\u503c\u5bf9\uff0c\u7528\u6cd5\u603b\u7ed3\u5982\u4e0b\u8868\u6240\u793a\u3002</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u4f5c\u7528</th>\n<th style=\"text-align:left\">\u53c2\u6570\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u7ed3\u679c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">hset(name, key, value)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d\uff1bvalue\uff1a\u6620\u5c04\u952e\u503c</td>\n<td style=\"text-align:left\">hset(\u2018price\u2019, \u2018cake\u2019, 5)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04\u5173\u7cfb\uff0ccake\u7684\u503c\u4e3a5</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u6dfb\u52a0\u7684\u6620\u5c04\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hsetnx(name, key, value)</td>\n<td style=\"text-align:left\">\u5982\u679c\u6620\u5c04\u952e\u540d\u4e0d\u5b58\u5728\uff0c\u5219\u5411\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d\uff1bvalue\uff1a\u6620\u5c04\u952e\u503c</td>\n<td style=\"text-align:left\">hsetnx(\u2018price\u2019, \u2018book\u2019, 6)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04\u5173\u7cfb\uff0cbook\u7684\u503c\u4e3a6</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u6dfb\u52a0\u7684\u6620\u5c04\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hget(name, key)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2dkey\u5bf9\u5e94\u7684\u503c</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d</td>\n<td style=\"text-align:left\">redis.hget(\u2018price\u2019, \u2018cake\u2019)</td>\n<td style=\"text-align:left\">\u83b7\u53d6\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u952e\u540d\u4e3acake\u7684\u503c</td>\n<td style=\"text-align:left\">5</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hmget(name, keys, *args)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u5404\u4e2a\u952e\u5bf9\u5e94\u7684\u503c</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bkeys\uff1a\u6620\u5c04\u952e\u540d\u5217\u8868</td>\n<td style=\"text-align:left\">redis.hmget(\u2018price\u2019, [\u2018apple\u2019, \u2018orange\u2019])</td>\n<td style=\"text-align:left\">\u83b7\u53d6\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2dapple\u548corange\u7684\u503c</td>\n<td style=\"text-align:left\">[b\u20193\u2019, b\u20197\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hmset(name, mapping)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6279\u91cf\u6dfb\u52a0\u6620\u5c04</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bmapping\uff1a\u6620\u5c04\u5b57\u5178</td>\n<td style=\"text-align:left\">redis.hmset(\u2018price\u2019, {\u2018banana\u2019: 2, \u2018pear\u2019: 6})</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u6279\u91cf\u6dfb\u52a0\u6620\u5c04</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hincrby(name, key, amount=1)</td>\n<td style=\"text-align:left\">\u5c06\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6620\u5c04\u7684\u503c\u589e\u52a0amount</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d\uff1bamount\uff1a\u589e\u957f\u91cf</td>\n<td style=\"text-align:left\">redis.hincrby(\u2018price\u2019, \u2018apple\u2019, 3)</td>\n<td style=\"text-align:left\">key\u4e3aprice\u7684\u6563\u5217\u8868\u4e2dapple\u7684\u503c\u589e\u52a03</td>\n<td style=\"text-align:left\">6\uff0c\u4fee\u6539\u540e\u7684\u503c</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hexists(name, key)</td>\n<td style=\"text-align:left\">\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u662f\u5426\u5b58\u5728\u952e\u540d\u4e3a\u952e\u7684\u6620\u5c04</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d</td>\n<td style=\"text-align:left\">redis.hexists(\u2018price\u2019, \u2018banana\u2019)</td>\n<td style=\"text-align:left\">\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2dbanana\u7684\u503c\u662f\u5426\u5b58\u5728</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hdel(name, *keys)</td>\n<td style=\"text-align:left\">\u5728\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\uff0c\u5220\u9664\u952e\u540d\u4e3a\u952e\u7684\u6620\u5c04</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bkeys\uff1a\u6620\u5c04\u952e\u540d</td>\n<td style=\"text-align:left\">redis.hdel(\u2018price\u2019, \u2018banana\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u5220\u9664\u952e\u540d\u4e3abanana\u7684\u6620\u5c04</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hlen(name)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6620\u5c04\u4e2a\u6570</td>\n<td style=\"text-align:left\">name\uff1a \u952e\u540d</td>\n<td style=\"text-align:left\">redis.hlen(\u2018price\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6620\u5c04\u4e2a\u6570</td>\n<td style=\"text-align:left\">6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hkeys(name)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u540d</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.hkeys(\u2018price\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u540d</td>\n<td style=\"text-align:left\">[b\u2019cake\u2019, b\u2019book\u2019, b\u2019banana\u2019, b\u2019pear\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hvals(name)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.hvals(\u2018price\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c</td>\n<td style=\"text-align:left\">[b\u20195\u2019, b\u20196\u2019, b\u20192\u2019, b\u20196\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">hgetall(name)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c\u5bf9</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.hgetall(\u2018price\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c\u5bf9</td>\n<td style=\"text-align:left\">{b\u2019cake\u2019: b\u20195\u2019, b\u2019book\u2019: b\u20196\u2019, b\u2019orange\u2019: b\u20197\u2019, b\u2019pear\u2019: b\u20196\u2019}</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"_99\"></a>\u5217\u8868\u64cd\u4f5c</h2>\n<p>Redis\u8fd8\u63d0\u4f9b\u4e86\u5217\u8868\u5b58\u50a8\uff0c\u5217\u8868\u5185\u7684\u5143\u7d20\u53ef\u4ee5\u91cd\u590d\uff0c\u800c\u4e14\u53ef\u4ee5\u4ece\u4e24\u7aef\u5b58\u50a8\uff0c\u7528\u6cd5\u5982\u4e0b\u8868\u6240\u793a\u3002</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u4f5c\u7528</th>\n<th style=\"text-align:left\">\u53c2\u6570\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u7ed3\u679c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">rpush(name, *values)</td>\n<td style=\"text-align:left\">\u5728\u952e\u4e3aname\u7684\u5217\u8868\u672b\u5c3e\u6dfb\u52a0\u503c\u4e3avalue\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u4f20\u591a\u4e2a</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c</td>\n<td style=\"text-align:left\">redis.rpush(\u2018list\u2019, 1, 2, 3)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3alist\u7684\u5217\u8868\u5c3e\u6dfb\u52a01\u30012\u30013</td>\n<td style=\"text-align:left\">3\uff0c\u5217\u8868\u5927\u5c0f</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">lpush(name, *values)</td>\n<td style=\"text-align:left\">\u5728\u952e\u4e3aname\u7684\u5217\u8868\u5934\u6dfb\u52a0\u503c\u4e3avalue\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u4f20\u591a\u4e2a</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c</td>\n<td style=\"text-align:left\">redis.lpush(\u2018list\u2019, 0)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3alist\u7684\u5217\u8868\u5934\u90e8\u6dfb\u52a00</td>\n<td style=\"text-align:left\">4\uff0c\u5217\u8868\u5927\u5c0f</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">llen(name)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u5217\u8868\u7684\u957f\u5ea6</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.llen(\u2018list\u2019)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3alist\u7684\u5217\u8868\u7684\u957f\u5ea6</td>\n<td style=\"text-align:left\">4</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">lrange(name, start, end)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u5217\u8868\u4e2dstart\u81f3end\u4e4b\u95f4\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15</td>\n<td style=\"text-align:left\">redis.lrange(\u2018list\u2019, 1, 3)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u8d77\u59cb\u7d22\u5f15\u4e3a1\u7ec8\u6b62\u7d22\u5f15\u4e3a3\u7684\u7d22\u5f15\u8303\u56f4\u5bf9\u5e94\u7684\u5217\u8868</td>\n<td style=\"text-align:left\">[b\u20193\u2019, b\u20192\u2019, b\u20191\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ltrim(name, start, end)</td>\n<td style=\"text-align:left\">\u622a\u53d6\u952e\u4e3aname\u7684\u5217\u8868\uff0c\u4fdd\u7559\u7d22\u5f15\u4e3astart\u5230end\u7684\u5185\u5bb9</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15</td>\n<td style=\"text-align:left\">ltrim(\u2018list\u2019, 1, 3)</td>\n<td style=\"text-align:left\">\u4fdd\u7559\u952e\u4e3alist\u7684\u7d22\u5f15\u4e3a1\u52303\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">lindex(name, index)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u5217\u8868\u4e2dindex\u4f4d\u7f6e\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bindex\uff1a\u7d22\u5f15</td>\n<td style=\"text-align:left\">redis.lindex(\u2018list\u2019, 1)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3alist\u7684\u5217\u8868\u7d22\u5f15\u4e3a1\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">b\u20192\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">lset(name, index, value)</td>\n<td style=\"text-align:left\">\u7ed9\u952e\u4e3aname\u7684\u5217\u8868\u4e2dindex\u4f4d\u7f6e\u7684\u5143\u7d20\u8d4b\u503c\uff0c\u8d8a\u754c\u5219\u62a5\u9519</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bindex\uff1a\u7d22\u5f15\u4f4d\u7f6e\uff1bvalue\uff1a\u503c</td>\n<td style=\"text-align:left\">redis.lset(\u2018list\u2019, 1, 5)</td>\n<td style=\"text-align:left\">\u5c06\u952e\u4e3alist\u7684\u5217\u8868\u4e2d\u7d22\u5f15\u4e3a1\u7684\u4f4d\u7f6e\u8d4b\u503c\u4e3a5</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">lrem(name, count, value)</td>\n<td style=\"text-align:left\">\u5220\u9664count\u4e2a\u952e\u7684\u5217\u8868\u4e2d\u503c\u4e3avalue\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bcount\uff1a\u5220\u9664\u4e2a\u6570\uff1bvalue\uff1a\u503c</td>\n<td style=\"text-align:left\">redis.lrem(\u2018list\u2019, 2, 3)</td>\n<td style=\"text-align:left\">\u5c06\u952e\u4e3alist\u7684\u5217\u8868\u5220\u9664\u4e24\u4e2a3</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u5220\u9664\u7684\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">lpop(name)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u5217\u8868\u4e2d\u7684\u9996\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.lpop(\u2018list\u2019)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u540d\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20</td>\n<td style=\"text-align:left\">b\u20195\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">rpop(name)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u5217\u8868\u4e2d\u7684\u5c3e\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.rpop(\u2018list\u2019)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u540d\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20</td>\n<td style=\"text-align:left\">b\u20192\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">blpop(keys, timeout=0)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u540d\u79f0\u5728keys\u4e2d\u7684list\u4e2d\u7684\u9996\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u5217\u8868\u4e3a\u7a7a\uff0c\u5219\u4f1a\u4e00\u76f4\u963b\u585e\u7b49\u5f85</td>\n<td style=\"text-align:left\">keys\uff1a\u952e\u5217\u8868\uff1btimeout\uff1a \u8d85\u65f6\u7b49\u5f85\u65f6\u95f4\uff0c0\u4e3a\u4e00\u76f4\u7b49\u5f85</td>\n<td style=\"text-align:left\">redis.blpop(\u2018list\u2019)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20</td>\n<td style=\"text-align:left\">[b\u20195\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">brpop(keys, timeout=0)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u5217\u8868\u4e2d\u7684\u5c3e\u5143\u7d20\uff0c\u5982\u679clist\u4e3a\u7a7a\uff0c\u5219\u4f1a\u4e00\u76f4\u963b\u585e\u7b49\u5f85</td>\n<td style=\"text-align:left\">keys\uff1a\u952e\u5217\u8868\uff1btimeout\uff1a\u8d85\u65f6\u7b49\u5f85\u65f6\u95f4\uff0c0\u4e3a\u4e00\u76f4\u7b49\u5f85</td>\n<td style=\"text-align:left\">redis.brpop(\u2018list\u2019)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u540d\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20</td>\n<td style=\"text-align:left\">[b\u20192\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">rpoplpush(src, dst)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u5e76\u5220\u9664\u540d\u79f0\u4e3asrc\u7684\u5217\u8868\u7684\u5c3e\u5143\u7d20\uff0c\u5e76\u5c06\u8be5\u5143\u7d20\u6dfb\u52a0\u5230\u540d\u79f0\u4e3adst\u7684\u5217\u8868\u5934\u90e8</td>\n<td style=\"text-align:left\">src\uff1a\u6e90\u5217\u8868\u7684\u952e\uff1bdst\uff1a\u76ee\u6807\u5217\u8868\u7684key</td>\n<td style=\"text-align:left\">redis.rpoplpush(\u2018list\u2019, \u2018list2\u2019)</td>\n<td style=\"text-align:left\">\u5c06\u952e\u4e3alist\u7684\u5217\u8868\u5c3e\u5143\u7d20\u5220\u9664\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u952e\u4e3alist2\u7684\u5217\u8868\u5934\u90e8\uff0c\u7136\u540e\u8fd4\u56de</td>\n<td style=\"text-align:left\">b\u20192\u2019</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"_119\"></a>\u96c6\u5408\u64cd\u4f5c</h2>\n<p>Redis\u8fd8\u63d0\u4f9b\u4e86\u96c6\u5408\u5b58\u50a8\uff0c\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u90fd\u662f\u4e0d\u91cd\u590d\u7684\uff0c\u7528\u6cd5\u5982\u4e0b\u8868\u6240\u793a\u3002</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u4f5c\u7528</th>\n<th style=\"text-align:left\">\u53c2\u6570\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u7ed3\u679c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">sadd(name, *values)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u6dfb\u52a0\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c\uff0c\u53ef\u4e3a\u591a\u4e2a</td>\n<td style=\"text-align:left\">redis.sadd(\u2018tags\u2019, \u2018Book\u2019, \u2018Tea\u2019, \u2018Coffee\u2019)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u6dfb\u52a0Book\u3001Tea\u548cCoffee\u8fd93\u4e2a\u5185\u5bb9</td>\n<td style=\"text-align:left\">3\uff0c\u5373\u63d2\u5165\u7684\u6570\u636e\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">srem(name, *values)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u5220\u9664\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c\uff0c\u53ef\u4e3a\u591a\u4e2a</td>\n<td style=\"text-align:left\">redis.srem(\u2018tags\u2019, \u2018Book\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u5220\u9664Book</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u5220\u9664\u7684\u6570\u636e\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">spop(name)</td>\n<td style=\"text-align:left\">\u968f\u673a\u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.spop(\u2018tags\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u968f\u673a\u5220\u9664\u5e76\u8fd4\u56de\u8be5\u5143\u7d20</td>\n<td style=\"text-align:left\">b\u2019Tea\u2019</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">smove(src, dst, value)</td>\n<td style=\"text-align:left\">\u4ecesrc\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u79fb\u9664\u5143\u7d20\u5e76\u5c06\u5176\u6dfb\u52a0\u5230dst\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d</td>\n<td style=\"text-align:left\">src\uff1a\u6e90\u96c6\u5408\uff1bdst\uff1a\u76ee\u6807\u96c6\u5408\uff1bvalue\uff1a\u5143\u7d20\u503c</td>\n<td style=\"text-align:left\">redis.smove(\u2018tags\u2019, \u2018tags2\u2019, \u2018Coffee\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u5220\u9664\u5143\u7d20Coffee\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u952e\u4e3atags2\u7684\u96c6\u5408</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">scard(name)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.scard(\u2018tags\u2019)</td>\n<td style=\"text-align:left\">\u83b7\u53d6\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570</td>\n<td style=\"text-align:left\">3</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sismember(name, value)</td>\n<td style=\"text-align:left\">\u6d4b\u8bd5member\u662f\u5426\u662f\u952e\u4e3aname\u7684\u96c6\u5408\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u503c</td>\n<td style=\"text-align:left\">redis.sismember(\u2018tags\u2019, \u2018Book\u2019)</td>\n<td style=\"text-align:left\">\u5224\u65adBook\u662f\u5426\u662f\u952e\u4e3atags\u7684\u96c6\u5408\u5143\u7d20</td>\n<td style=\"text-align:left\">True</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sinter(keys, *args)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u952e\u7684\u96c6\u5408\u7684\u4ea4\u96c6</td>\n<td style=\"text-align:left\">keys\uff1a\u952e\u5217\u8868</td>\n<td style=\"text-align:left\">redis.sinter([\u2018tags\u2019, \u2018tags2\u2019])</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u4ea4\u96c6</td>\n<td style=\"text-align:left\">{b\u2019Coffee\u2019}</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sinterstore(dest, keys, *args)</td>\n<td style=\"text-align:left\">\u6c42\u4ea4\u96c6\u5e76\u5c06\u4ea4\u96c6\u4fdd\u5b58\u5230dest\u7684\u96c6\u5408</td>\n<td style=\"text-align:left\">dest\uff1a\u7ed3\u679c\u96c6\u5408\uff1bkeys\uff1a\u952e\u5217\u8868</td>\n<td style=\"text-align:left\">redis.sinterstore(\u2018inttag\u2019, [\u2018tags\u2019, \u2018tags2\u2019])</td>\n<td style=\"text-align:left\">\u6c42\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u5c06\u5176\u4fdd\u5b58\u4e3ainttag</td>\n<td style=\"text-align:left\">1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sunion(keys, *args)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u952e\u7684\u96c6\u5408\u7684\u5e76\u96c6</td>\n<td style=\"text-align:left\">keys\uff1a\u952e\u5217\u8868</td>\n<td style=\"text-align:left\">redis.sunion([\u2018tags\u2019, \u2018tags2\u2019])</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5e76\u96c6</td>\n<td style=\"text-align:left\">{b\u2019Coffee\u2019, b\u2019Book\u2019, b\u2019Pen\u2019}</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sunionstore(dest, keys, *args)</td>\n<td style=\"text-align:left\">\u6c42\u5e76\u96c6\u5e76\u5c06\u5e76\u96c6\u4fdd\u5b58\u5230dest\u7684\u96c6\u5408</td>\n<td style=\"text-align:left\">dest\uff1a\u7ed3\u679c\u96c6\u5408\uff1bkeys\uff1a\u952e\u5217\u8868</td>\n<td style=\"text-align:left\">redis.sunionstore(\u2018inttag\u2019, [\u2018tags\u2019, \u2018tags2\u2019])</td>\n<td style=\"text-align:left\">\u6c42\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5e76\u96c6\u5e76\u5c06\u5176\u4fdd\u5b58\u4e3ainttag</td>\n<td style=\"text-align:left\">3</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sdiff(keys, *args)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u952e\u7684\u96c6\u5408\u7684\u5dee\u96c6</td>\n<td style=\"text-align:left\">keys\uff1a\u952e\u5217\u8868</td>\n<td style=\"text-align:left\">redis.sdiff([\u2018tags\u2019, \u2018tags2\u2019])</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5dee\u96c6</td>\n<td style=\"text-align:left\">{b\u2019Book\u2019, b\u2019Pen\u2019}</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">sdiffstore(dest, keys, *args)</td>\n<td style=\"text-align:left\">\u6c42\u5dee\u96c6\u5e76\u5c06\u5dee\u96c6\u4fdd\u5b58\u5230dest\u96c6\u5408</td>\n<td style=\"text-align:left\">dest\uff1a\u7ed3\u679c\u96c6\u5408\uff1bkeys\uff1a\u952e\u5217\u8868</td>\n<td style=\"text-align:left\">redis.sdiffstore(\u2018inttag\u2019, [\u2018tags\u2019, \u2018tags2\u2019])</td>\n<td style=\"text-align:left\">\u6c42\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5dee\u96c6\u5e76\u5c06\u5176\u4fdd\u5b58\u4e3ainttag`</td>\n<td style=\"text-align:left\">3</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">smembers(name)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.smembers(\u2018tags\u2019)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20</td>\n<td style=\"text-align:left\">{b\u2019Pen\u2019, b\u2019Book\u2019, b\u2019Coffee\u2019}</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">srandmember(name)</td>\n<td style=\"text-align:left\">\u968f\u673a\u8fd4\u56de\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\uff0c\u4f46\u4e0d\u5220\u9664\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u503c</td>\n<td style=\"text-align:left\">redis.srandmember(\u2018tags\u2019)</td>\n<td style=\"text-align:left\">\u968f\u673a\u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"_140\"></a>\u6709\u5e8f\u96c6\u5408\u64cd\u4f5c</h2>\n<p>\u6709\u5e8f\u96c6\u5408\u6bd4\u96c6\u5408\u591a\u4e86\u4e00\u4e2a\u5206\u6570\u5b57\u6bb5\uff0c\u5229\u7528\u5b83\u53ef\u4ee5\u5bf9\u96c6\u5408\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u5176\u7528\u6cd5\u603b\u7ed3\u5982\u4e0b\u8868\u6240\u793a\u3002</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">\u65b9\u6cd5</th>\n<th style=\"text-align:left\">\u4f5c\u7528</th>\n<th style=\"text-align:left\">\u53c2\u6570\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u8bf4\u660e</th>\n<th style=\"text-align:left\">\u793a\u4f8b\u7ed3\u679c</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">zadd(name, *args, **kwargs)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3aname\u7684zset\u4e2d\u6dfb\u52a0\u5143\u7d20member\uff0cscore\u7528\u4e8e\u6392\u5e8f\u3002\u5982\u679c\u8be5\u5143\u7d20\u5b58\u5728\uff0c\u5219\u66f4\u65b0\u5176\u987a\u5e8f</td>\n<td style=\"text-align:left\">name\uff1a \u952e\u540d\uff1bargs\uff1a\u53ef\u53d8\u53c2\u6570</td>\n<td style=\"text-align:left\">redis.zadd(\u2018grade\u2019, 100, \u2018Bob\u2019, 98, \u2018Mike\u2019)</td>\n<td style=\"text-align:left\">\u5411\u952e\u4e3agrade\u7684zset\u4e2d\u6dfb\u52a0Bob\uff08\u5176score\u4e3a100\uff09\uff0c\u5e76\u6dfb\u52a0Mike\uff08\u5176score\u4e3a98\uff09</td>\n<td style=\"text-align:left\">2\uff0c\u5373\u6dfb\u52a0\u7684\u5143\u7d20\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zrem(name, *values)</td>\n<td style=\"text-align:left\">\u5220\u9664\u952e\u4e3aname\u7684zset\u4e2d\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalues\uff1a\u5143\u7d20</td>\n<td style=\"text-align:left\">redis.zrem(\u2018grade\u2019, \u2018Mike\u2019)</td>\n<td style=\"text-align:left\">\u4ece\u952e\u4e3agrade\u7684zset\u4e2d\u5220\u9664Mike</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u5220\u9664\u7684\u5143\u7d20\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zincrby(name, value, amount=1)</td>\n<td style=\"text-align:left\">\u5982\u679c\u5728\u952e\u4e3aname\u7684zset\u4e2d\u5df2\u7ecf\u5b58\u5728\u5143\u7d20value\uff0c\u5219\u5c06\u8be5\u5143\u7d20\u7684score\u589e\u52a0amount\uff1b\u5426\u5219\u5411\u8be5\u96c6\u5408\u4e2d\u6dfb\u52a0\u8be5\u5143\u7d20\uff0c\u5176score\u7684\u503c\u4e3aamount</td>\n<td style=\"text-align:left\">name\uff1akey\u540d\uff1bvalue\uff1a\u5143\u7d20\uff1bamount\uff1a\u589e\u957f\u7684score\u503c</td>\n<td style=\"text-align:left\">redis.zincrby(\u2018grade\u2019, \u2018Bob\u2019, -2)</td>\n<td style=\"text-align:left\">\u952e\u4e3agrade\u7684zset\u4e2dBob\u7684score\u51cf2</td>\n<td style=\"text-align:left\">98.0\uff0c\u5373\u4fee\u6539\u540e\u7684\u503c</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zrank(name, value)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2d\u5143\u7d20\u7684\u6392\u540d\uff0c\u6309score\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u5373\u540d\u6b21</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalue\uff1a\u5143\u7d20\u503c</td>\n<td style=\"text-align:left\">redis.zrank(\u2018grade\u2019, \u2018Amy\u2019)</td>\n<td style=\"text-align:left\">\u5f97\u5230\u952e\u4e3agrade\u7684zset\u4e2dAmy\u7684\u6392\u540d</td>\n<td style=\"text-align:left\">1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zrevrank(name, value)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2d\u5143\u7d20\u7684\u5012\u6570\u6392\u540d\uff08\u6309score\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff09\uff0c\u5373\u540d\u6b21</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bvalue\uff1a\u5143\u7d20\u503c</td>\n<td style=\"text-align:left\">redis.zrevrank(\u2018grade\u2019, \u2018Amy\u2019)</td>\n<td style=\"text-align:left\">\u5f97\u5230\u952e\u4e3agrade\u7684zset\u4e2dAmy\u7684\u5012\u6570\u6392\u540d</td>\n<td style=\"text-align:left\">2</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zrevrange(name, start, end, withscores=False)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684zset\uff08\u6309score\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff09\u4e2dindex\u4ecestart\u5230end\u7684\u6240\u6709\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u503c\uff1bstart\uff1a\u5f00\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ed3\u675f\u7d22\u5f15\uff1bwithscores\uff1a\u662f\u5426\u5e26score</td>\n<td style=\"text-align:left\">redis.zrevrange(\u2018grade\u2019, 0, 3)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3agrade\u7684zset\u4e2d\u524d\u56db\u540d\u5143\u7d20</td>\n<td style=\"text-align:left\">[b\u2019Bob\u2019, b\u2019Mike\u2019, b\u2019Amy\u2019, b\u2019James\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zrangebyscore(name, min, max, start=None, num=None, withscores=False)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2dscore\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4escore\uff1bmax\uff1a\u6700\u9ad8score\uff1b start\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bnum\uff1a\u4e2a\u6570\uff1bwithscores\uff1a\u662f\u5426\u5e26score</td>\n<td style=\"text-align:left\">redis.zrangebyscore(\u2018grade\u2019, 80, 95)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3agrade\u7684zset\u4e2dscore\u572880\u548c95\u4e4b\u95f4\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">[b\u2019Bob\u2019, b\u2019Mike\u2019, b\u2019Amy\u2019, b\u2019James\u2019]</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zcount(name, min, max)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2dscore\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u6570\u91cf</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4escore\uff1bmax\uff1a\u6700\u9ad8score</td>\n<td style=\"text-align:left\">redis.zcount(\u2018grade\u2019, 80, 95)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3agrade\u7684zset\u4e2dscore\u572880\u523095\u7684\u5143\u7d20\u4e2a\u6570</td>\n<td style=\"text-align:left\">2</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zcard(name)</td>\n<td style=\"text-align:left\">\u8fd4\u56de\u952e\u4e3aname\u7684zset\u7684\u5143\u7d20\u4e2a\u6570</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d</td>\n<td style=\"text-align:left\">redis.zcard(\u2018grade\u2019)</td>\n<td style=\"text-align:left\">\u83b7\u53d6\u952e\u4e3agrade\u7684zset\u4e2d\u5143\u7d20\u7684\u4e2a\u6570</td>\n<td style=\"text-align:left\">3</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zremrangebyrank(name, min, max)</td>\n<td style=\"text-align:left\">\u5220\u9664\u952e\u4e3aname\u7684zset\u4e2d\u6392\u540d\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4e\u4f4d\u6b21\uff1bmax\uff1a\u6700\u9ad8\u4f4d\u6b21</td>\n<td style=\"text-align:left\">redis.zremrangebyrank(\u2018grade\u2019, 0, 0)</td>\n<td style=\"text-align:left\">\u5220\u9664\u952e\u4e3agrade\u7684zset\u4e2d\u6392\u540d\u7b2c\u4e00\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u5220\u9664\u7684\u5143\u7d20\u4e2a\u6570</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">zremrangebyscore(name, min, max)</td>\n<td style=\"text-align:left\">\u5220\u9664\u952e\u4e3aname\u7684zset\u4e2dscore\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4escore\uff1bmax\uff1a\u6700\u9ad8score</td>\n<td style=\"text-align:left\">redis.zremrangebyscore(\u2018grade\u2019, 80, 90)</td>\n<td style=\"text-align:left\">\u5220\u9664score\u572880\u523090\u4e4b\u95f4\u7684\u5143\u7d20</td>\n<td style=\"text-align:left\">1\uff0c\u5373\u5220\u9664\u7684\u5143\u7d20\u4e2a\u6570</td>\n</tr>\n</tbody>\n</table>", "body_md": "##  python\u64cd\u4f5credis\n\nRedisPy\u5e93\u63d0\u4f9b\u4e24\u4e2a\u7c7bRedis\u548cStrictRedis\u6765\u5b9e\u73b0Redis\u7684\u547d\u4ee4\u64cd\u4f5c\u3002\n\n> \u6bb5\u843d\u5f15\u7528StrictRedis\u5b9e\u73b0\u4e86\u7edd\u5927\u90e8\u5206\u5b98\u65b9\u7684\u547d\u4ee4\uff0c\u53c2\u6570\u4e5f\u4e00\u4e00\u5bf9\u5e94\uff0c\u6bd4\u5982set()\u65b9\u6cd5\u5c31\u5bf9\u5e94Redis\u547d\u4ee4\u7684set\u65b9\u6cd5\u3002\u800cRedis\u662fStrictRedis\u7684\u5b50\u7c7b\uff0c\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u662f\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u65e7\u7248\u672c\u5e93\u91cc\u7684\u51e0\u4e2a\u65b9\u6cd5\u3002\u4e3a\u4e86\u505a\u517c\u5bb9\uff0c\u5b83\u5c06\u65b9\u6cd5\u505a\u4e86\u6539\u5199\uff0c\u6bd4\u5982lrem()\u65b9\u6cd5\u5c31\u5c06value\u548cnum\u53c2\u6570\u7684\u4f4d\u7f6e\u4e92\u6362\uff0c\u8fd9\u548cRedis\u547d\u4ee4\u884c\u7684\u547d\u4ee4\u53c2\u6570\u4e0d\u4e00\u81f4\u3002\n>\n> >\u5efa\u8bae\u4f7f\u7528StrictRedis\n\n## \u5b89\u88c5redis\n```\npipenv install redis\n# django\u5b89\u88c5django-redis\npipenv install django-redis\n```\n## django\u914d\u7f6eredis\u7f13\u5b58\n```py\nCACHES = {\n    \"default\": {\n        \"BACKEND\": \"django_redis.cache.RedisCache\",\n        \"LOCATION\": \"redis://127.0.0.1:6379\",\n        \"OPTIONS\": {\n            \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\",\n            \"CONNECTION_POOL_KWARGS\": {\"max_connections\": 100},\n        }\n    }\n}\n\n```\n\n## \u8fde\u63a5Redis(\u8fde\u63a5\u6c60)\n> redis-py\u4f7f\u7528connection pool\u6765\u7ba1\u7406\u5bf9\u4e00\u4e2aredis server\u7684\u6240\u6709\u8fde\u63a5\uff0c\u907f\u514d\u6bcf\u6b21\u5efa\u7acb\u3001\u91ca\u653e\u8fde\u63a5\u7684\u5f00\u9500\u3002\u9ed8\u8ba4\uff0c\u6bcf\u4e2aRedis\u5b9e\u4f8b\u90fd\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u81ea\u5df1\u7684\u8fde\u63a5\u6c60\u3002\u53ef\u4ee5\u76f4\u63a5\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u6c60\uff0c\u7136\u540e\u4f5c\u4e3a\u53c2\u6570Redis\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2aRedis\u5b9e\u4f8b\u5171\u4eab\u4e00\u4e2a\u8fde\u63a5\u6c60\u3002\n```py\nimport redis\n# \u8fde\u63a5\u6c60\npool = redis.ConnectionPool(host='localhost', port=6379,db=0, password='password',decode_responses=True,max_connections=100)\n\nredis = redis.StrictRedis(connection_pool=pool)\n```\n## \u83b7\u5f97\u5f53\u524dredis\u914d\u7f6e\n>redis-cli\u547d\u4ee4\u884c`CONFIG GET *` \u83b7\u5f97\u6240\u6709\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u83b7\u5f97\u5355\u72ec\u914d\u7f6e\n\n## \u952e\u64cd\u4f5c\n\n\n|     \u65b9\u6cd5     |        \u4f5c\u7528        |  \u53c2\u6570\u8bf4\u660e  |         \u793a\u4f8b         |      \u793a\u4f8b\u8bf4\u660e      | \u793a\u4f8b\u7ed3\u679c |\n| :----------: | :----------------: | :--------: | :------------------: | :----------------: | :------: |\n| exists(name) | \u5224\u65ad\u4e00\u4e2a\u952e\u662f\u5426\u5b58\u5728 | name\uff1a\u952e\u540d | redis.exists('name') | \u662f\u5426\u5b58\u5728name\u8fd9\u4e2a\u952e |   True   |\n| delete(name)       | \u5220\u9664\u4e00\u4e2a\u952e                                   | name\uff1a\u952e\u540d                 | redis.delete('name')             | \u5220\u9664name\u8fd9\u4e2a\u952e               | 1         |\n| type(name)         | \u5224\u65ad\u952e\u7c7b\u578b                                   | name\uff1a\u952e\u540d                 | redis.type('name')               | \u5224\u65adname\u8fd9\u4e2a\u952e\u7c7b\u578b           | b'string' |\n| keys(pattern)      | \u83b7\u53d6\u6240\u6709\u7b26\u5408\u89c4\u5219\u7684\u952e                         | pattern\uff1a\u5339\u914d\u89c4\u5219          | redis.keys('n*')                 | \u83b7\u53d6\u6240\u6709\u4ee5n\u5f00\u5934\u7684\u952e          | [b'name'] |\n| randomkey()        | \u83b7\u53d6\u968f\u673a\u7684\u4e00\u4e2a\u952e                             |                            | randomkey()                      | \u83b7\u53d6\u968f\u673a\u7684\u4e00\u4e2a\u952e             | b'name'   |\n| rename(src, dst)   | \u91cd\u547d\u540d\u952e                                     | src\uff1a\u539f\u952e\u540d\uff1bdst\uff1a\u65b0\u952e\u540d   | redis.rename('name', 'nickname') | \u5c06name\u91cd\u547d\u540d\u4e3anickname       | True      |\n| dbsize()           | \u83b7\u53d6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u952e\u7684\u6570\u76ee                     |                            | dbsize()                         | \u83b7\u53d6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u952e\u7684\u6570\u76ee     | 100       |\n| expire(name, time) | \u8bbe\u5b9a\u952e\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2                   | name\uff1a\u952e\u540d\uff1btime\uff1a\u79d2\u6570     | redis.expire('name', 2)          | \u5c06name\u952e\u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a2\u79d2  | True      |\n| ttl(name)          | \u83b7\u53d6\u952e\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c-1\u8868\u793a\u6c38\u4e45\u4e0d\u8fc7\u671f | name\uff1a\u952e\u540d                 | redis.ttl('name')                | \u83b7\u53d6name\u8fd9\u4e2a\u952e\u7684\u8fc7\u671f\u65f6\u95f4     | -1        |\n| move(name, db)     | \u5c06\u952e\u79fb\u52a8\u5230\u5176\u4ed6\u6570\u636e\u5e93                         | name\uff1a\u952e\u540d\uff1bdb\uff1a\u6570\u636e\u5e93\u4ee3\u53f7 | move('name', 2)                  | \u5c06name\u79fb\u52a8\u52302\u53f7\u6570\u636e\u5e93        | True      |\n| flushdb()          | \u5220\u9664\u5f53\u524d\u9009\u62e9\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e                 |                            | flushdb()                        | \u5220\u9664\u5f53\u524d\u9009\u62e9\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e | True      |\n| flushall()         | \u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e                     |                            | flushall()                       | \u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e     | True      |\n\n## \u5b57\u7b26\u4e32\u64cd\u4f5c\n\nRedis\u652f\u6301\u6700\u57fa\u672c\u7684\u952e\u503c\u5bf9\u5f62\u5f0f\u5b58\u50a8\uff0c\u7528\u6cd5\u603b\u7ed3\u5982\u4e0b\u8868\u6240\u793a\u3002\n\n| \u65b9\u6cd5                          | \u4f5c\u7528                                                         | \u53c2\u6570\u8bf4\u660e                                                     | \u793a\u4f8b                                                         | \u793a\u4f8b\u8bf4\u660e                                         | \u793a\u4f8b\u7ed3\u679c                                    |\n| :---------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------- | :------------------------------------------ |\n| set(name, value)              | \u7ed9\u6570\u636e\u5e93\u4e2d\u952e\u4e3aname\u7684string\u8d4b\u4e88\u503cvalue                        | name: \u952e\u540d\uff1bvalue: \u503c                                        | redis.set('name', 'Bob')                                     | \u7ed9name\u8fd9\u4e2a\u952e\u7684value\u8d4b\u503c\u4e3aBob                     | True                                        |\n| get(name)                     | \u8fd4\u56de\u6570\u636e\u5e93\u4e2d\u952e\u4e3aname\u7684string\u7684value                          | name\uff1a\u952e\u540d                                                   | redis.get('name')                                            | \u8fd4\u56dename\u8fd9\u4e2a\u952e\u7684value                            | b'Bob'                                      |\n| getset(name, value)           | \u7ed9\u6570\u636e\u5e93\u4e2d\u952e\u4e3aname\u7684string\u8d4b\u4e88\u503cvalue\u5e76\u8fd4\u56de\u4e0a\u6b21\u7684value       | name\uff1a\u952e\u540d\uff1bvalue\uff1a\u65b0\u503c                                      | redis.getset('name', 'Mike')                                 | \u8d4b\u503cname\u4e3aMike\u5e76\u5f97\u5230\u4e0a\u6b21\u7684value                  | b'Bob'                                      |\n| mget(keys, *args)             | \u8fd4\u56de\u591a\u4e2a\u952e\u5bf9\u5e94\u7684value                                        | keys\uff1a\u952e\u7684\u5217\u8868                                               | redis.mget(['name', 'nickname'])                             | \u8fd4\u56dename\u548cnickname\u7684value                        | [b'Mike', b'Miker']                         |\n| setnx(name, value)            | \u5982\u679c\u4e0d\u5b58\u5728\u8fd9\u4e2a\u952e\u503c\u5bf9\uff0c\u5219\u66f4\u65b0value\uff0c\u5426\u5219\u4e0d\u53d8                  | name\uff1a\u952e\u540d                                                   | redis.setnx('newname', 'James')                              | \u5982\u679cnewname\u8fd9\u4e2a\u952e\u4e0d\u5b58\u5728\uff0c\u5219\u8bbe\u7f6e\u503c\u4e3aJames         | \u7b2c\u4e00\u6b21\u8fd0\u884c\u7ed3\u679c\u662fTrue\uff0c\u7b2c\u4e8c\u6b21\u8fd0\u884c\u7ed3\u679c\u662fFalse |\n| setex(name, time, value)      | \u8bbe\u7f6e\u53ef\u4ee5\u5bf9\u5e94\u7684\u503c\u4e3astring\u7c7b\u578b\u7684value\uff0c\u5e76\u6307\u5b9a\u6b64\u952e\u503c\u5bf9\u5e94\u7684\u6709\u6548\u671f | name: \u952e\u540d\uff1btime: \u6709\u6548\u671f\uff1b value\uff1a\u503c                         | redis.setex('name', 1, 'James')                              | \u5c06name\u8fd9\u4e2a\u952e\u7684\u503c\u8bbe\u4e3aJames\uff0c\u6709\u6548\u671f\u4e3a1\u79d2           | True                                        |\n| setrange(name, offset, value) | \u8bbe\u7f6e\u6307\u5b9a\u952e\u7684value\u503c\u7684\u5b50\u5b57\u7b26\u4e32                                | name\uff1a\u952e\u540d\uff1boffset\uff1a\u504f\u79fb\u91cf\uff1bvalue\uff1a\u503c                        | redis.set('name', 'Hello') redis.setrange('name', 6, 'World') | \u8bbe\u7f6ename\u4e3aHello\u5b57\u7b26\u4e32\uff0c\u5e76\u5728index\u4e3a6\u7684\u4f4d\u7f6e\u8865World | 11\uff0c\u4fee\u6539\u540e\u7684\u5b57\u7b26\u4e32\u957f\u5ea6                      |\n| mset(mapping)                 | \u6279\u91cf\u8d4b\u503c                                                     | mapping\uff1a\u5b57\u5178                                                | redis.mset({'name1': 'Durant', 'name2': 'James'})            | \u5c06name1\u8bbe\u4e3aDurant\uff0cname2\u8bbe\u4e3aJames                | True                                        |\n| msetnx(mapping)               | \u952e\u5747\u4e0d\u5b58\u5728\u65f6\u624d\u6279\u91cf\u8d4b\u503c                                       | mapping\uff1a\u5b57\u5178                                                | redis.msetnx({'name3': 'Smith', 'name4': 'Curry'})           | \u5728name3\u548cname4\u5747\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\u624d\u8bbe\u7f6e\u4e8c\u8005\u503c       | True                                        |\n| incr(name, amount=1)          | \u952e\u4e3aname\u7684value\u589e\u503c\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u952e\u4e0d\u5b58\u5728\u5219\u88ab\u521b\u5efa\u5e76\u8bbe\u4e3aamount | name\uff1a\u952e\u540d\uff1bamount\uff1a\u589e\u957f\u7684\u503c                                 | redis.incr('age', 1)                                         | age\u5bf9\u5e94\u7684\u503c\u589e1\uff0c\u82e5\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u521b\u5efa\u5e76\u8bbe\u7f6e\u4e3a1      | 1\uff0c\u5373\u4fee\u6539\u540e\u7684\u503c                             |\n| decr(name, amount=1)          | \u952e\u4e3aname\u7684value\u51cf\u503c\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u952e\u4e0d\u5b58\u5728\u5219\u88ab\u521b\u5efa\u5e76\u5c06value\u8bbe\u7f6e\u4e3a-amount | name\uff1a\u952e\u540d\uff1b amount\uff1a\u51cf\u5c11\u7684\u503c                                | redis.decr('age', 1)                                         | age\u5bf9\u5e94\u7684\u503c\u51cf1\uff0c\u82e5\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u521b\u5efa\u5e76\u8bbe\u7f6e\u4e3a-1     | -1\uff0c\u5373\u4fee\u6539\u540e\u7684\u503c                            |\n| append(key, value)            | \u952e\u4e3aname\u7684string\u7684\u503c\u9644\u52a0value                                | key\uff1a\u952e\u540d                                                    | redis.append('nickname', 'OK')                               | \u5411\u952e\u4e3anickname\u7684\u503c\u540e\u8ffd\u52a0OK                       | 13\uff0c\u5373\u4fee\u6539\u540e\u7684\u5b57\u7b26\u4e32\u957f\u5ea6                    |\n| substr(name, start, end=-1)   | \u8fd4\u56de\u952e\u4e3aname\u7684string\u7684\u5b50\u4e32                                   | name\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15\uff0c\u9ed8\u8ba4\u4e3a-1\uff0c\u8868\u793a\u622a\u53d6\u5230\u672b\u5c3e | redis.substr('name', 1, 4)                                   | \u8fd4\u56de\u952e\u4e3aname\u7684\u503c\u7684\u5b57\u7b26\u4e32\uff0c\u622a\u53d6\u7d22\u5f15\u4e3a1~4\u7684\u5b57\u7b26    | b'ello'                                     |\n| getrange(key, start, end)     | \u83b7\u53d6\u952e\u7684value\u503c\u4ecestart\u5230end\u7684\u5b50\u5b57\u7b26\u4e32                        | key\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15                    | redis.getrange('name', 1, 4)                                 | \u8fd4\u56de\u952e\u4e3aname\u7684\u503c\u7684\u5b57\u7b26\u4e32\uff0c\u622a\u53d6\u7d22\u5f15\u4e3a1~4\u7684\u5b57\u7b26    | b'ello'                                     |\n\n## \u6563\u5217\u64cd\u4f5c\n\nRedis\u8fd8\u63d0\u4f9b\u4e86\u6563\u5217\u8868\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6211\u4eec\u53ef\u4ee5\u7528`name`\u6307\u5b9a\u4e00\u4e2a\u6563\u5217\u8868\u7684\u540d\u79f0\uff0c\u8868\u5185\u5b58\u50a8\u4e86\u5404\u4e2a\u952e\u503c\u5bf9\uff0c\u7528\u6cd5\u603b\u7ed3\u5982\u4e0b\u8868\u6240\u793a\u3002\n\n| \u65b9\u6cd5                         | \u4f5c\u7528                                               | \u53c2\u6570\u8bf4\u660e                                   | \u793a\u4f8b                                           | \u793a\u4f8b\u8bf4\u660e                                       | \u793a\u4f8b\u7ed3\u679c                                                     |\n| :--------------------------- | :------------------------------------------------- | :----------------------------------------- | :--------------------------------------------- | :--------------------------------------------- | :----------------------------------------------------------- |\n| hset(name, key, value)       | \u5411\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04                       | name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d\uff1bvalue\uff1a\u6620\u5c04\u952e\u503c | hset('price', 'cake', 5)                       | \u5411\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04\u5173\u7cfb\uff0ccake\u7684\u503c\u4e3a5 | 1\uff0c\u5373\u6dfb\u52a0\u7684\u6620\u5c04\u4e2a\u6570                                          |\n| hsetnx(name, key, value)     | \u5982\u679c\u6620\u5c04\u952e\u540d\u4e0d\u5b58\u5728\uff0c\u5219\u5411\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04 | name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d\uff1bvalue\uff1a\u6620\u5c04\u952e\u503c | hsetnx('price', 'book', 6)                     | \u5411\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u6dfb\u52a0\u6620\u5c04\u5173\u7cfb\uff0cbook\u7684\u503c\u4e3a6 | 1\uff0c\u5373\u6dfb\u52a0\u7684\u6620\u5c04\u4e2a\u6570                                          |\n| hget(name, key)              | \u8fd4\u56de\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2dkey\u5bf9\u5e94\u7684\u503c                  | name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d                  | redis.hget('price', 'cake')                    | \u83b7\u53d6\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u952e\u540d\u4e3acake\u7684\u503c          | 5                                                            |\n| hmget(name, keys, *args)     | \u8fd4\u56de\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u5404\u4e2a\u952e\u5bf9\u5e94\u7684\u503c               | name\uff1a\u952e\u540d\uff1bkeys\uff1a\u6620\u5c04\u952e\u540d\u5217\u8868             | redis.hmget('price', ['apple', 'orange'])      | \u83b7\u53d6\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2dapple\u548corange\u7684\u503c       | [b'3', b'7']                                                 |\n| hmset(name, mapping)         | \u5411\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6279\u91cf\u6dfb\u52a0\u6620\u5c04                   | name\uff1a\u952e\u540d\uff1bmapping\uff1a\u6620\u5c04\u5b57\u5178              | redis.hmset('price', {'banana': 2, 'pear': 6}) | \u5411\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u6279\u91cf\u6dfb\u52a0\u6620\u5c04              | True                                                         |\n| hincrby(name, key, amount=1) | \u5c06\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u6620\u5c04\u7684\u503c\u589e\u52a0amount             | name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d\uff1bamount\uff1a\u589e\u957f\u91cf  | redis.hincrby('price', 'apple', 3)             | key\u4e3aprice\u7684\u6563\u5217\u8868\u4e2dapple\u7684\u503c\u589e\u52a03             | 6\uff0c\u4fee\u6539\u540e\u7684\u503c                                                |\n| hexists(name, key)           | \u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u662f\u5426\u5b58\u5728\u952e\u540d\u4e3a\u952e\u7684\u6620\u5c04           | name\uff1a\u952e\u540d\uff1bkey\uff1a\u6620\u5c04\u952e\u540d                  | redis.hexists('price', 'banana')               | \u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2dbanana\u7684\u503c\u662f\u5426\u5b58\u5728          | True                                                         |\n| hdel(name, *keys)            | \u5728\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\uff0c\u5220\u9664\u952e\u540d\u4e3a\u952e\u7684\u6620\u5c04           | name\uff1a\u952e\u540d\uff1bkeys\uff1a\u6620\u5c04\u952e\u540d                 | redis.hdel('price', 'banana')                  | \u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u5220\u9664\u952e\u540d\u4e3abanana\u7684\u6620\u5c04    | True                                                         |\n| hlen(name)                   | \u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6620\u5c04\u4e2a\u6570                   | name\uff1a \u952e\u540d                                | redis.hlen('price')                            | \u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6620\u5c04\u4e2a\u6570              | 6                                                            |\n| hkeys(name)                  | \u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u540d               | name\uff1a\u952e\u540d                                 | redis.hkeys('price')                           | \u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u540d          | [b'cake', b'book', b'banana', b'pear']                       |\n| hvals(name)                  | \u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c               | name\uff1a\u952e\u540d                                 | redis.hvals('price')                           | \u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c          | [b'5', b'6', b'2', b'6']                                     |\n| hgetall(name)                | \u4ece\u952e\u4e3aname\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c\u5bf9             | name\uff1a\u952e\u540d                                 | redis.hgetall('price')                         | \u4ece\u952e\u4e3aprice\u7684\u6563\u5217\u8868\u4e2d\u83b7\u53d6\u6240\u6709\u6620\u5c04\u952e\u503c\u5bf9        | {b'cake': b'5', b'book': b'6', b'orange': b'7', b'pear': b'6'} |\n\n##  \u5217\u8868\u64cd\u4f5c\n\nRedis\u8fd8\u63d0\u4f9b\u4e86\u5217\u8868\u5b58\u50a8\uff0c\u5217\u8868\u5185\u7684\u5143\u7d20\u53ef\u4ee5\u91cd\u590d\uff0c\u800c\u4e14\u53ef\u4ee5\u4ece\u4e24\u7aef\u5b58\u50a8\uff0c\u7528\u6cd5\u5982\u4e0b\u8868\u6240\u793a\u3002 \n\n| \u65b9\u6cd5                     | \u4f5c\u7528                                                         | \u53c2\u6570\u8bf4\u660e                                          | \u793a\u4f8b                             | \u793a\u4f8b\u8bf4\u660e                                                     | \u793a\u4f8b\u7ed3\u679c           |\n| :----------------------- | :----------------------------------------------------------- | :------------------------------------------------ | :------------------------------- | :----------------------------------------------------------- | :----------------- |\n| rpush(name, *values)     | \u5728\u952e\u4e3aname\u7684\u5217\u8868\u672b\u5c3e\u6dfb\u52a0\u503c\u4e3avalue\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u4f20\u591a\u4e2a          | name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c                            | redis.rpush('list', 1, 2, 3)     | \u5411\u952e\u4e3alist\u7684\u5217\u8868\u5c3e\u6dfb\u52a01\u30012\u30013                                | 3\uff0c\u5217\u8868\u5927\u5c0f        |\n| lpush(name, *values)     | \u5728\u952e\u4e3aname\u7684\u5217\u8868\u5934\u6dfb\u52a0\u503c\u4e3avalue\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u4f20\u591a\u4e2a            | name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c                            | redis.lpush('list', 0)           | \u5411\u952e\u4e3alist\u7684\u5217\u8868\u5934\u90e8\u6dfb\u52a00                                    | 4\uff0c\u5217\u8868\u5927\u5c0f        |\n| llen(name)               | \u8fd4\u56de\u952e\u4e3aname\u7684\u5217\u8868\u7684\u957f\u5ea6                                     | name\uff1a\u952e\u540d                                        | redis.llen('list')               | \u8fd4\u56de\u952e\u4e3alist\u7684\u5217\u8868\u7684\u957f\u5ea6                                     | 4                  |\n| lrange(name, start, end) | \u8fd4\u56de\u952e\u4e3aname\u7684\u5217\u8868\u4e2dstart\u81f3end\u4e4b\u95f4\u7684\u5143\u7d20                     | name\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15        | redis.lrange('list', 1, 3)       | \u8fd4\u56de\u8d77\u59cb\u7d22\u5f15\u4e3a1\u7ec8\u6b62\u7d22\u5f15\u4e3a3\u7684\u7d22\u5f15\u8303\u56f4\u5bf9\u5e94\u7684\u5217\u8868               | [b'3', b'2', b'1'] |\n| ltrim(name, start, end)  | \u622a\u53d6\u952e\u4e3aname\u7684\u5217\u8868\uff0c\u4fdd\u7559\u7d22\u5f15\u4e3astart\u5230end\u7684\u5185\u5bb9               | name\uff1a\u952e\u540d\uff1bstart\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ec8\u6b62\u7d22\u5f15        | ltrim('list', 1, 3)              | \u4fdd\u7559\u952e\u4e3alist\u7684\u7d22\u5f15\u4e3a1\u52303\u7684\u5143\u7d20                               | True               |\n| lindex(name, index)      | \u8fd4\u56de\u952e\u4e3aname\u7684\u5217\u8868\u4e2dindex\u4f4d\u7f6e\u7684\u5143\u7d20                          | name\uff1a\u952e\u540d\uff1bindex\uff1a\u7d22\u5f15                           | redis.lindex('list', 1)          | \u8fd4\u56de\u952e\u4e3alist\u7684\u5217\u8868\u7d22\u5f15\u4e3a1\u7684\u5143\u7d20                              | b\u20192\u2019               |\n| lset(name, index, value) | \u7ed9\u952e\u4e3aname\u7684\u5217\u8868\u4e2dindex\u4f4d\u7f6e\u7684\u5143\u7d20\u8d4b\u503c\uff0c\u8d8a\u754c\u5219\u62a5\u9519            | name\uff1a\u952e\u540d\uff1bindex\uff1a\u7d22\u5f15\u4f4d\u7f6e\uff1bvalue\uff1a\u503c            | redis.lset('list', 1, 5)         | \u5c06\u952e\u4e3alist\u7684\u5217\u8868\u4e2d\u7d22\u5f15\u4e3a1\u7684\u4f4d\u7f6e\u8d4b\u503c\u4e3a5                       | True               |\n| lrem(name, count, value) | \u5220\u9664count\u4e2a\u952e\u7684\u5217\u8868\u4e2d\u503c\u4e3avalue\u7684\u5143\u7d20                         | name\uff1a\u952e\u540d\uff1bcount\uff1a\u5220\u9664\u4e2a\u6570\uff1bvalue\uff1a\u503c            | redis.lrem('list', 2, 3)         | \u5c06\u952e\u4e3alist\u7684\u5217\u8868\u5220\u9664\u4e24\u4e2a3                                    | 1\uff0c\u5373\u5220\u9664\u7684\u4e2a\u6570    |\n| lpop(name)               | \u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u5217\u8868\u4e2d\u7684\u9996\u5143\u7d20                           | name\uff1a\u952e\u540d                                        | redis.lpop('list')               | \u8fd4\u56de\u5e76\u5220\u9664\u540d\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20                       | b'5'               |\n| rpop(name)               | \u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u5217\u8868\u4e2d\u7684\u5c3e\u5143\u7d20                           | name\uff1a\u952e\u540d                                        | redis.rpop('list')               | \u8fd4\u56de\u5e76\u5220\u9664\u540d\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20                     | b'2'               |\n| blpop(keys, timeout=0)   | \u8fd4\u56de\u5e76\u5220\u9664\u540d\u79f0\u5728keys\u4e2d\u7684list\u4e2d\u7684\u9996\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u5217\u8868\u4e3a\u7a7a\uff0c\u5219\u4f1a\u4e00\u76f4\u963b\u585e\u7b49\u5f85 | keys\uff1a\u952e\u5217\u8868\uff1btimeout\uff1a \u8d85\u65f6\u7b49\u5f85\u65f6\u95f4\uff0c0\u4e3a\u4e00\u76f4\u7b49\u5f85 | redis.blpop('list')              | \u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20                       | [b'5']             |\n| brpop(keys, timeout=0)   | \u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u5217\u8868\u4e2d\u7684\u5c3e\u5143\u7d20\uff0c\u5982\u679clist\u4e3a\u7a7a\uff0c\u5219\u4f1a\u4e00\u76f4\u963b\u585e\u7b49\u5f85 | keys\uff1a\u952e\u5217\u8868\uff1btimeout\uff1a\u8d85\u65f6\u7b49\u5f85\u65f6\u95f4\uff0c0\u4e3a\u4e00\u76f4\u7b49\u5f85  | redis.brpop('list')              | \u8fd4\u56de\u5e76\u5220\u9664\u540d\u4e3alist\u7684\u5217\u8868\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20                     | [b'2']             |\n| rpoplpush(src, dst)      | \u8fd4\u56de\u5e76\u5220\u9664\u540d\u79f0\u4e3asrc\u7684\u5217\u8868\u7684\u5c3e\u5143\u7d20\uff0c\u5e76\u5c06\u8be5\u5143\u7d20\u6dfb\u52a0\u5230\u540d\u79f0\u4e3adst\u7684\u5217\u8868\u5934\u90e8 | src\uff1a\u6e90\u5217\u8868\u7684\u952e\uff1bdst\uff1a\u76ee\u6807\u5217\u8868\u7684key               | redis.rpoplpush('list', 'list2') | \u5c06\u952e\u4e3alist\u7684\u5217\u8868\u5c3e\u5143\u7d20\u5220\u9664\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u952e\u4e3alist2\u7684\u5217\u8868\u5934\u90e8\uff0c\u7136\u540e\u8fd4\u56de | b'2'               |\n\n## \u96c6\u5408\u64cd\u4f5c\n\nRedis\u8fd8\u63d0\u4f9b\u4e86\u96c6\u5408\u5b58\u50a8\uff0c\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u90fd\u662f\u4e0d\u91cd\u590d\u7684\uff0c\u7528\u6cd5\u5982\u4e0b\u8868\u6240\u793a\u3002\n\n| \u65b9\u6cd5                           | \u4f5c\u7528                                                 | \u53c2\u6570\u8bf4\u660e                                  | \u793a\u4f8b                                           | \u793a\u4f8b\u8bf4\u660e                                                    | \u793a\u4f8b\u7ed3\u679c                     |\n| :----------------------------- | :--------------------------------------------------- | :---------------------------------------- | :--------------------------------------------- | :---------------------------------------------------------- | :--------------------------- |\n| sadd(name, *values)            | \u5411\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u6dfb\u52a0\u5143\u7d20                           | name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c\uff0c\u53ef\u4e3a\u591a\u4e2a          | redis.sadd('tags', 'Book', 'Tea', 'Coffee')    | \u5411\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u6dfb\u52a0Book\u3001Tea\u548cCoffee\u8fd93\u4e2a\u5185\u5bb9            | 3\uff0c\u5373\u63d2\u5165\u7684\u6570\u636e\u4e2a\u6570          |\n| srem(name, *values)            | \u4ece\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u5220\u9664\u5143\u7d20                           | name\uff1a\u952e\u540d\uff1bvalues\uff1a\u503c\uff0c\u53ef\u4e3a\u591a\u4e2a          | redis.srem('tags', 'Book')                     | \u4ece\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u5220\u9664Book                                  | 1\uff0c\u5373\u5220\u9664\u7684\u6570\u636e\u4e2a\u6570          |\n| spop(name)                     | \u968f\u673a\u8fd4\u56de\u5e76\u5220\u9664\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20             | name\uff1a\u952e\u540d                                | redis.spop('tags')                             | \u4ece\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u968f\u673a\u5220\u9664\u5e76\u8fd4\u56de\u8be5\u5143\u7d20                      | b'Tea'                       |\n| smove(src, dst, value)         | \u4ecesrc\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u79fb\u9664\u5143\u7d20\u5e76\u5c06\u5176\u6dfb\u52a0\u5230dst\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d | src\uff1a\u6e90\u96c6\u5408\uff1bdst\uff1a\u76ee\u6807\u96c6\u5408\uff1bvalue\uff1a\u5143\u7d20\u503c | redis.smove('tags', 'tags2', 'Coffee')         | \u4ece\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u5220\u9664\u5143\u7d20Coffee\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u952e\u4e3atags2\u7684\u96c6\u5408 | True                         |\n| scard(name)                    | \u8fd4\u56de\u952e\u4e3aname\u7684\u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570                         | name\uff1a\u952e\u540d                                | redis.scard('tags')                            | \u83b7\u53d6\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570                              | 3                            |\n| sismember(name, value)         | \u6d4b\u8bd5member\u662f\u5426\u662f\u952e\u4e3aname\u7684\u96c6\u5408\u7684\u5143\u7d20                 | name\uff1a\u952e\u503c                                | redis.sismember('tags', 'Book')                | \u5224\u65adBook\u662f\u5426\u662f\u952e\u4e3atags\u7684\u96c6\u5408\u5143\u7d20                            | True                         |\n| sinter(keys, *args)            | \u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u952e\u7684\u96c6\u5408\u7684\u4ea4\u96c6                           | keys\uff1a\u952e\u5217\u8868                              | redis.sinter(['tags', 'tags2'])                | \u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u4ea4\u96c6                   | {b'Coffee'}                  |\n| sinterstore(dest, keys, *args) | \u6c42\u4ea4\u96c6\u5e76\u5c06\u4ea4\u96c6\u4fdd\u5b58\u5230dest\u7684\u96c6\u5408                       | dest\uff1a\u7ed3\u679c\u96c6\u5408\uff1bkeys\uff1a\u952e\u5217\u8868              | redis.sinterstore('inttag', ['tags', 'tags2']) | \u6c42\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u5c06\u5176\u4fdd\u5b58\u4e3ainttag   | 1                            |\n| sunion(keys, *args)            | \u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u952e\u7684\u96c6\u5408\u7684\u5e76\u96c6                           | keys\uff1a\u952e\u5217\u8868                              | redis.sunion(['tags', 'tags2'])                | \u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5e76\u96c6                   | {b'Coffee', b'Book', b'Pen'} |\n| sunionstore(dest, keys, *args) | \u6c42\u5e76\u96c6\u5e76\u5c06\u5e76\u96c6\u4fdd\u5b58\u5230dest\u7684\u96c6\u5408                       | dest\uff1a\u7ed3\u679c\u96c6\u5408\uff1bkeys\uff1a\u952e\u5217\u8868              | redis.sunionstore('inttag', ['tags', 'tags2']) | \u6c42\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5e76\u96c6\u5e76\u5c06\u5176\u4fdd\u5b58\u4e3ainttag   | 3                            |\n| sdiff(keys, *args)             | \u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u952e\u7684\u96c6\u5408\u7684\u5dee\u96c6                           | keys\uff1a\u952e\u5217\u8868                              | redis.sdiff(['tags', 'tags2'])                 | \u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5dee\u96c6                   | {b'Book', b'Pen'}            |\n| sdiffstore(dest, keys, *args)  | \u6c42\u5dee\u96c6\u5e76\u5c06\u5dee\u96c6\u4fdd\u5b58\u5230dest\u96c6\u5408                         | dest\uff1a\u7ed3\u679c\u96c6\u5408\uff1bkeys\uff1a\u952e\u5217\u8868              | redis.sdiffstore('inttag', ['tags', 'tags2'])  | \u6c42\u952e\u4e3atags\u7684\u96c6\u5408\u548c\u952e\u4e3atags2\u7684\u96c6\u5408\u7684\u5dee\u96c6\u5e76\u5c06\u5176\u4fdd\u5b58\u4e3ainttag`  | 3                            |\n| smembers(name)                 | \u8fd4\u56de\u952e\u4e3aname\u7684\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20                         | name\uff1a\u952e\u540d                                | redis.smembers('tags')                         | \u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u7684\u6240\u6709\u5143\u7d20                                | {b'Pen', b'Book', b'Coffee'} |\n| srandmember(name)              | \u968f\u673a\u8fd4\u56de\u952e\u4e3aname\u7684\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\uff0c\u4f46\u4e0d\u5220\u9664\u5143\u7d20     | name\uff1a\u952e\u503c                                | redis.srandmember('tags')                      | \u968f\u673a\u8fd4\u56de\u952e\u4e3atags\u7684\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20                          |                              |\n\n## \u6709\u5e8f\u96c6\u5408\u64cd\u4f5c\n\n\u6709\u5e8f\u96c6\u5408\u6bd4\u96c6\u5408\u591a\u4e86\u4e00\u4e2a\u5206\u6570\u5b57\u6bb5\uff0c\u5229\u7528\u5b83\u53ef\u4ee5\u5bf9\u96c6\u5408\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u5176\u7528\u6cd5\u603b\u7ed3\u5982\u4e0b\u8868\u6240\u793a\u3002\n\n| \u65b9\u6cd5                                                         | \u4f5c\u7528                                                         | \u53c2\u6570\u8bf4\u660e                                                     | \u793a\u4f8b                                        | \u793a\u4f8b\u8bf4\u660e                                                     | \u793a\u4f8b\u7ed3\u679c                            |\n| :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :------------------------------------------ | :----------------------------------------------------------- | :---------------------------------- |\n| zadd(name, *args, **kwargs)                                  | \u5411\u952e\u4e3aname\u7684zset\u4e2d\u6dfb\u52a0\u5143\u7d20member\uff0cscore\u7528\u4e8e\u6392\u5e8f\u3002\u5982\u679c\u8be5\u5143\u7d20\u5b58\u5728\uff0c\u5219\u66f4\u65b0\u5176\u987a\u5e8f | name\uff1a \u952e\u540d\uff1bargs\uff1a\u53ef\u53d8\u53c2\u6570                                  | redis.zadd('grade', 100, 'Bob', 98, 'Mike') | \u5411\u952e\u4e3agrade\u7684zset\u4e2d\u6dfb\u52a0Bob\uff08\u5176score\u4e3a100\uff09\uff0c\u5e76\u6dfb\u52a0Mike\uff08\u5176score\u4e3a98\uff09 | 2\uff0c\u5373\u6dfb\u52a0\u7684\u5143\u7d20\u4e2a\u6570                 |\n| zrem(name, *values)                                          | \u5220\u9664\u952e\u4e3aname\u7684zset\u4e2d\u7684\u5143\u7d20                                   | name\uff1a\u952e\u540d\uff1bvalues\uff1a\u5143\u7d20                                     | redis.zrem('grade', 'Mike')                 | \u4ece\u952e\u4e3agrade\u7684zset\u4e2d\u5220\u9664Mike                                  | 1\uff0c\u5373\u5220\u9664\u7684\u5143\u7d20\u4e2a\u6570                 |\n| zincrby(name, value, amount=1)                               | \u5982\u679c\u5728\u952e\u4e3aname\u7684zset\u4e2d\u5df2\u7ecf\u5b58\u5728\u5143\u7d20value\uff0c\u5219\u5c06\u8be5\u5143\u7d20\u7684score\u589e\u52a0amount\uff1b\u5426\u5219\u5411\u8be5\u96c6\u5408\u4e2d\u6dfb\u52a0\u8be5\u5143\u7d20\uff0c\u5176score\u7684\u503c\u4e3aamount | name\uff1akey\u540d\uff1bvalue\uff1a\u5143\u7d20\uff1bamount\uff1a\u589e\u957f\u7684score\u503c              | redis.zincrby('grade', 'Bob', -2)           | \u952e\u4e3agrade\u7684zset\u4e2dBob\u7684score\u51cf2                               | 98.0\uff0c\u5373\u4fee\u6539\u540e\u7684\u503c                  |\n| zrank(name, value)                                           | \u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2d\u5143\u7d20\u7684\u6392\u540d\uff0c\u6309score\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u5373\u540d\u6b21  | name\uff1a\u952e\u540d\uff1bvalue\uff1a\u5143\u7d20\u503c                                    | redis.zrank('grade', 'Amy')                 | \u5f97\u5230\u952e\u4e3agrade\u7684zset\u4e2dAmy\u7684\u6392\u540d                               | 1                                   |\n| zrevrank(name, value)                                        | \u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2d\u5143\u7d20\u7684\u5012\u6570\u6392\u540d\uff08\u6309score\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff09\uff0c\u5373\u540d\u6b21 | name\uff1a\u952e\u540d\uff1bvalue\uff1a\u5143\u7d20\u503c                                    | redis.zrevrank('grade', 'Amy')              | \u5f97\u5230\u952e\u4e3agrade\u7684zset\u4e2dAmy\u7684\u5012\u6570\u6392\u540d                           | 2                                   |\n| zrevrange(name, start, end, withscores=False)                | \u8fd4\u56de\u952e\u4e3aname\u7684zset\uff08\u6309score\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff09\u4e2dindex\u4ecestart\u5230end\u7684\u6240\u6709\u5143\u7d20 | name\uff1a\u952e\u503c\uff1bstart\uff1a\u5f00\u59cb\u7d22\u5f15\uff1bend\uff1a\u7ed3\u675f\u7d22\u5f15\uff1bwithscores\uff1a\u662f\u5426\u5e26score | redis.zrevrange('grade', 0, 3)              | \u8fd4\u56de\u952e\u4e3agrade\u7684zset\u4e2d\u524d\u56db\u540d\u5143\u7d20                              | [b'Bob', b'Mike', b'Amy', b'James'] |\n| zrangebyscore(name, min, max, start=None, num=None, withscores=False) | \u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2dscore\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u5143\u7d20                    | name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4escore\uff1bmax\uff1a\u6700\u9ad8score\uff1b start\uff1a\u8d77\u59cb\u7d22\u5f15\uff1bnum\uff1a\u4e2a\u6570\uff1bwithscores\uff1a\u662f\u5426\u5e26score | redis.zrangebyscore('grade', 80, 95)        | \u8fd4\u56de\u952e\u4e3agrade\u7684zset\u4e2dscore\u572880\u548c95\u4e4b\u95f4\u7684\u5143\u7d20                 | [b'Bob', b'Mike', b'Amy', b'James'] |\n| zcount(name, min, max)                                       | \u8fd4\u56de\u952e\u4e3aname\u7684zset\u4e2dscore\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u6570\u91cf                    | name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4escore\uff1bmax\uff1a\u6700\u9ad8score                   | redis.zcount('grade', 80, 95)               | \u8fd4\u56de\u952e\u4e3agrade\u7684zset\u4e2dscore\u572880\u523095\u7684\u5143\u7d20\u4e2a\u6570                 | 2                                   |\n| zcard(name)                                                  | \u8fd4\u56de\u952e\u4e3aname\u7684zset\u7684\u5143\u7d20\u4e2a\u6570                                 | name\uff1a\u952e\u540d                                                   | redis.zcard('grade')                        | \u83b7\u53d6\u952e\u4e3agrade\u7684zset\u4e2d\u5143\u7d20\u7684\u4e2a\u6570                              | 3                                   |\n| zremrangebyrank(name, min, max)                              | \u5220\u9664\u952e\u4e3aname\u7684zset\u4e2d\u6392\u540d\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u5143\u7d20                     | name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4e\u4f4d\u6b21\uff1bmax\uff1a\u6700\u9ad8\u4f4d\u6b21                     | redis.zremrangebyrank('grade', 0, 0)        | \u5220\u9664\u952e\u4e3agrade\u7684zset\u4e2d\u6392\u540d\u7b2c\u4e00\u7684\u5143\u7d20                          | 1\uff0c\u5373\u5220\u9664\u7684\u5143\u7d20\u4e2a\u6570                 |\n| zremrangebyscore(name, min, max)                             | \u5220\u9664\u952e\u4e3aname\u7684zset\u4e2dscore\u5728\u7ed9\u5b9a\u533a\u95f4\u7684\u5143\u7d20                    | name\uff1a\u952e\u540d\uff1bmin\uff1a\u6700\u4f4escore\uff1bmax\uff1a\u6700\u9ad8score                   | redis.zremrangebyscore('grade', 80, 90)     | \u5220\u9664score\u572880\u523090\u4e4b\u95f4\u7684\u5143\u7d20                                  | 1\uff0c\u5373\u5220\u9664\u7684\u5143\u7d20\u4e2a\u6570                 |", "excerpt": "python\u64cd\u4f5credis\nRedisPy\u5e93\u63d0\u4f9b\u4e24\u4e2a\u7c7bRedis\u548cStrictRedis\u6765\u5b9e\u73b0Redis\u7684\u547d\u4ee4\u64cd\u4f5c\u3002\n\n\u6bb5\u843d\u5f15\u7528StrictRedis\u5b9e\u73b0\u4e86\u7edd\u5927\u90e8\u5206\u5b98\u65b9\u7684\u547d\u4ee4\uff0c\u53c2\u6570\u4e5f\u4e00\u4e00\u5bf9\u5e94\uff0c\u6bd4\u5982set()\u65b9\u6cd5\u5c31\u5bf9\u5e94Redis\u547d\u4ee4\u7684set\u65b9\u6cd5\u3002\u800cRedis\u662fStrictRedis\u7684\u5b50\u7c7b\uff0c\u5b83\u7684\u4e3b\u8981\u529f\u80fd", "codestyle": "atelier-cave-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-12T00:19:27.426", "mod_date": "2020-04-01T02:09:19.639", "views_count": 25, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [8]}}, {"model": "blog.post", "pk": 17, "fields": {"title": "\u5c11\u8d70\u4e00\u70b9\u5f2f\u8def(\u5b66\u4e60\u5f00\u53d1\u8fc7\u7a0bbug\u8bb0\u5f55)", "body": "<h1><a id=\"_0\"></a>\u672a\u89e3\u51b3</h1>\n<h2><a id=\"docker_1\"></a>docker\u955c\u50cf\u65f6\u533a</h2>\n<blockquote>\n<p>\u5982\u4f55\u4f7f\u5bb9\u5668\u5185\u90e8\u65f6\u95f4\u540c\u6b65</p>\n</blockquote>\n<h2><a id=\"aborted_clients_3\"></a>aborted clients</h2>\n<p><code>blog_mysql | 2020-04-04T07:23:18.155398Z 4 [Note] Aborted connection 4 to db: 'db05' user: 'root' host: '172.20.0.4' (Got an error reading communication packets)</code></p>\n<blockquote>\n<hr />\n</blockquote>\n<h1><a id=\"_7\"></a>\u5df2\u89e3\u51b3</h1>\n<h2><a id=\"celery_8\"></a>celery\u5751</h2>\n<blockquote>\n<p>celery \u4f7f\u7528redis\u4f5c\u4e3abroker\u65f6\uff0credis\u7248\u672c\u95ee\u9898\uff0c\u4f1a\u62a5\u9519<code>AttributeError: 'str' object has no attribute 'items'</code>,redis\u7248\u672c\u9700\u8981\u66f4\u6362\u4e3a2.10.6\uff08\u5176\u4ed6\u7248\u672c\u4e0d\u6e05\u695a)\uff0c\u4e2a\u4eba\u9501\u5b9acelery\u7248\u672c\u4e3a3.1.25</p>\n</blockquote>\n<h2><a id=\"__main___is_not_a_package_11\"></a>\u2018<strong>main</strong>\u2019 is not a package\u4ee5\u53ca\u7ea2\u7ebf\u95ee\u9898</h2>\n<p>Error:</p>\n<ul>\n<li>from .xx import  xx    \u4e0d\u53ef\u8fd0\u884c\uff0c \u65e0\u7ea2\u7ebf\uff0c\u53ef\u70b9\u8df3  \uff08xx\u524d\u5e26\u201c.\u201d\uff09</li>\n<li>from xx import  xx    \u53ef\u8fd0\u884c\uff0c \u6709\u7ea2\u7ebf\uff0c\u4e0d\u70b9\u8df3  \uff08xx\u524d\u4e0d\u5e26\u201c.\u201d\uff09</li>\n</ul>\n<p>\u9009\u62e9\u6548\u679c\uff1a</p>\n<ul>\n<li>from xx import  xx     \u53ef\u8fd0\u884c\uff0c \u65e0\u7ea2\u7ebf\uff0c\u53ef\u70b9\u8df3  \uff08xx\u524d\u4e0d\u5e26\u201c.\u201d\uff09</li>\n</ul>\n<p>\u5f15\u5165\u540c\u4e00\u76ee\u5f55\u4e0b\u5176\u4ed6\u6587\u4ef6\u7684\u5c5e\u6027\u65f6\uff0c\u65e0\u8df3\u8f6c\u63d0\u793a<br />\npycharm\u89e3\u51b3\u65b9\u6cd5\uff1a\u9009\u4e2d\u5f53\u524d\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u53f3\u952e\uff0c\u6700\u4e0b\u9762\uff0cMark Directory as\u2013&gt;Source Root</p>\n<h2><a id=\"dockercompose_windowspipenv_install__22\"></a>docker-compose windows\u4e0bpipenv install \u51fa\u9519</h2>\n<blockquote>\n<p>\u4e00\u76f4\u4e71\u7801\u5b89\u88c5\u5931\u8d25\uff0c\u4e91\u670d\u52a1\u5668\u4e0a\u65e0\u95ee\u9898\uff0c\u6700\u540e\u6362\u4e86\u7248\u672c\u95ee\u9898<br />\ndocker-compose\u7248\u672cversion 1.25.2, build 698e2846 \u89e3\u51b3</p>\n</blockquote>", "body_md": "# \u672a\u89e3\u51b3\n## docker\u955c\u50cf\u65f6\u533a\n> \u5982\u4f55\u4f7f\u5bb9\u5668\u5185\u90e8\u65f6\u95f4\u540c\u6b65\n##  aborted clients\n`blog_mysql | 2020-04-04T07:23:18.155398Z 4 [Note] Aborted connection 4 to db: 'db05' user: 'root' host: '172.20.0.4' (Got an error reading communication packets)`\n\n>---\n# \u5df2\u89e3\u51b3\n## celery\u5751\n> celery \u4f7f\u7528redis\u4f5c\u4e3abroker\u65f6\uff0credis\u7248\u672c\u95ee\u9898\uff0c\u4f1a\u62a5\u9519`AttributeError: 'str' object has no attribute 'items'`,redis\u7248\u672c\u9700\u8981\u66f4\u6362\u4e3a2.10.6\uff08\u5176\u4ed6\u7248\u672c\u4e0d\u6e05\u695a)\uff0c\u4e2a\u4eba\u9501\u5b9acelery\u7248\u672c\u4e3a3.1.25\n\n## '__main__' is not a package\u4ee5\u53ca\u7ea2\u7ebf\u95ee\u9898\nError:\n- from .xx import  xx    \u4e0d\u53ef\u8fd0\u884c\uff0c \u65e0\u7ea2\u7ebf\uff0c\u53ef\u70b9\u8df3  \uff08xx\u524d\u5e26\u201c.\u201d\uff09\n- from xx import  xx    \u53ef\u8fd0\u884c\uff0c \u6709\u7ea2\u7ebf\uff0c\u4e0d\u70b9\u8df3  \uff08xx\u524d\u4e0d\u5e26\u201c.\u201d\uff09\n\n\u9009\u62e9\u6548\u679c\uff1a\n- from xx import  xx     \u53ef\u8fd0\u884c\uff0c \u65e0\u7ea2\u7ebf\uff0c\u53ef\u70b9\u8df3  \uff08xx\u524d\u4e0d\u5e26\u201c.\u201d\uff09\n\n\u5f15\u5165\u540c\u4e00\u76ee\u5f55\u4e0b\u5176\u4ed6\u6587\u4ef6\u7684\u5c5e\u6027\u65f6\uff0c\u65e0\u8df3\u8f6c\u63d0\u793a\npycharm\u89e3\u51b3\u65b9\u6cd5\uff1a\u9009\u4e2d\u5f53\u524d\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u53f3\u952e\uff0c\u6700\u4e0b\u9762\uff0cMark Directory as-->Source Root\n\n## docker-compose windows\u4e0bpipenv install \u51fa\u9519\n> \u4e00\u76f4\u4e71\u7801\u5b89\u88c5\u5931\u8d25\uff0c\u4e91\u670d\u52a1\u5668\u4e0a\u65e0\u95ee\u9898\uff0c\u6700\u540e\u6362\u4e86\u7248\u672c\u95ee\u9898\ndocker-compose\u7248\u672cversion 1.25.2, build 698e2846 \u89e3\u51b3", "excerpt": "\u672a\u89e3\u51b3\ndocker\u955c\u50cf\u65f6\u533a\n\n\u5982\u4f55\u4f7f\u5bb9\u5668\u5185\u90e8\u65f6\u95f4\u540c\u6b65\n\naborted clients\nblog_mysql | 2020-04-04T07:23:18.155398Z 4 [Note] Aborted connection 4 to db: 'db05' user: 'root' host: '", "codestyle": "atelier-dune-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-12T00:26:02.174", "mod_date": "2020-04-04T18:28:57.408", "views_count": 45, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [9]}}, {"model": "blog.post", "pk": 18, "fields": {"title": "\u4efb\u52a1\u8c03\u5ea6\u5229\u5668\uff1aCelery", "body": "<h2><a id=\"Celery__0\"></a>Celery \u662f\u4ec0\u4e48\uff1f</h2>\n<p>Celery \u662fPython\u8bed\u8a00\u5b9e\u73b0\u7684\u5206\u5e03\u5f0f\u961f\u5217\u670d\u52a1\uff0c\u9664\u4e86\u652f\u6301\u5373\u65f6\u4efb\u52a1\uff0c\u8fd8\u652f\u6301\u5b9a\u65f6\u4efb\u52a1\uff0cCelery \u67095\u4e2a\u6838\u5fc3\u89d2\u8272\u3002</p>\n<ul>\n<li>Task<br />\n\u4efb\u52a1(Task)\u5c31\u662f\u4f60\u8981\u505a\u7684\u4e8b\u60c5\uff0c\u4f8b\u5982\u4e00\u4e2a\u6ce8\u518c\u6d41\u7a0b\u91cc\u9762\u6709\u5f88\u591a\u4efb\u52a1\uff0c\u7ed9\u7528\u6237\u53d1\u9a8c\u8bc1\u90ae\u4ef6\u5c31\u662f\u4e00\u4e2a\u4efb\u52a1\uff0c\u8fd9\u79cd\u8017\u65f6\u7684\u4efb\u52a1\u5c31\u53ef\u4ee5\u4ea4\u7ed9Celery\u53bb\u5904\u7406\uff0c\u8fd8\u6709\u4e00\u79cd\u4efb\u52a1\u662f\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bd4\u5982\u6bcf\u5929\u5b9a\u65f6\u7edf\u8ba1\u7f51\u7ad9\u7684\u6ce8\u518c\u4eba\u6570\uff0c\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u4ea4\u7ed9Celery\u5468\u671f\u6027\u7684\u5904\u7406\u3002</li>\n<li>Broker<br />\nBroker \u7684\u4e2d\u6587\u610f\u601d\u662f\u7ecf\u7eaa\u4eba\uff0c\u6307\u4e3a\u5e02\u573a\u4e0a\u4e70\u5356\u53cc\u65b9\u63d0\u4f9b\u4e2d\u4ecb\u670d\u52a1\u7684\u4eba\u3002\u5728Celery\u4e2d\u8fd9\u4e2a\u89d2\u8272\u76f8\u5f53\u4e8e\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u961f\u5217\uff0c\u4ecb\u4e8e\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u7ecf\u7eaa\u4eba\u3002\u4f8b\u5982\u4e00\u4e2aWeb\u7cfb\u7edf\u4e2d\uff0c\u751f\u4ea7\u8005\u662f\u4e3b\u7a0b\u5e8f\uff0c\u5b83\u751f\u4ea7\u4efb\u52a1\uff0c\u5c06\u4efb\u52a1\u53d1\u9001\u7ed9 Broker\uff0c\u6d88\u8d39\u8005\u662f Worker\uff0c\u662f\u4e13\u95e8\u7528\u4e8e\u6267\u884c\u4efb\u52a1\u7684\u540e\u53f0\u670d\u52a1\u3002Celery\u672c\u8eab\u4e0d\u63d0\u4f9b\u961f\u5217\u670d\u52a1\uff0c\u4e00\u822c\u7528Redis\u6216\u8005RabbitMQ\u6765\u5b9e\u73b0\u961f\u5217\u670d\u52a1\u3002</li>\n<li>Worker<br />\nWorker \u5c31\u662f\u90a3\u4e2a\u4e00\u76f4\u5728\u540e\u53f0\u6267\u884c\u4efb\u52a1\u7684\u4eba\uff0c\u4e5f\u6210\u4e3a\u4efb\u52a1\u7684\u6d88\u8d39\u8005\uff0c\u5b83\u4f1a\u5b9e\u65f6\u5730\u76d1\u63a7\u961f\u5217\u4e2d\u6709\u6ca1\u6709\u4efb\u52a1\uff0c\u5982\u679c\u6709\u5c31\u7acb\u5373\u53d6\u51fa\u6765\u6267\u884c\u3002</li>\n<li>Beat<br />\nBeat \u662f\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u8c03\u5ea6\u5668\uff0c\u5b83\u4f1a\u6839\u636e\u914d\u7f6e\u5b9a\u65f6\u5c06\u4efb\u52a1\u53d1\u9001\u7ed9 Broker\uff0c\u7b49\u5f85 Worker \u6765\u6d88\u8d39\u3002</li>\n<li>Backend<br />\nBackend \u7528\u4e8e\u4fdd\u5b58\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\uff0c\u6bcf\u4e2a\u4efb\u52a1\u90fd\u6709\u8fd4\u56de\u503c\uff0c\u6bd4\u5982\u53d1\u9001\u90ae\u4ef6\u7684\u670d\u52a1\u4f1a\u544a\u8bc9\u6211\u4eec\u6709\u6ca1\u6709\u53d1\u9001\u6210\u529f\uff0c\u8fd9\u4e2a\u7ed3\u679c\u5c31\u662f\u5b58\u5728Backend\u4e2d\uff0c\u5f53\u7136\u6211\u4eec\u5e76\u4e0d\u603b\u662f\u8981\u5173\u5fc3\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\u3002</li>\n</ul>\n<p><img src=\"https://user-gold-cdn.xitu.io/2018/10/10/1665e8ee8b12546a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1\" alt=\"\u79fb\u52a8\u7aef\u663e\u793a\u6709\u95ee\u9898\u54c8\" /></p>\n<h2><a id=\"_22\"></a>\u5b89\u88c5</h2>\n<p><code>pipenv install celery</code></p>\n<blockquote>\n<p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0ccelery\u4f7f\u7528redis\u4f5c\u4e3abroker\u65f6\uff0c\u76ee\u524d\u6ce8\u610f\u5230\u7684\u662f@3\u7248\u672credis\u4f1a\u51fa\u73b0\u9519\u8bef\uff0c\u6240\u4ee5\u6307\u5b9a\u5b89\u88c5\u524d\u4e00\u4ee3\u7248\u672c\uff08\u59822.10.6\uff09</p>\n</blockquote>\n<h2><a id=\"_27\"></a>\u8d77\u6b65</h2>\n<ol>\n<li>\u5f15\u5165celery</li>\n</ol>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n\napp = Celery(<span class=\"hljs-string\">'tasks'</span>, broker=<span class=\"hljs-string\">'redis://127.0.0.1/7'</span>,backend=<span class=\"hljs-string\">'redis://127.0.0.1/8'</span>)\n</code></div></pre>\n<ol start=\"2\">\n<li>\u901a\u8fc7\u88c5\u9970\u5668\u4f7f\u666e\u901a\u4efb\u52a1\u53d8\u6210\u5f02\u6b65\u4efb\u52a1</li>\n</ol>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-meta\">@app.task</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">add</span><span class=\"hljs-params\">(x,y)</span>:</span>\n    <span class=\"hljs-keyword\">return</span> x+y\n</code></div></pre>\n<ol start=\"3\">\n<li>\u542f\u52a8Worker<br />\n\u547d\u4ee4\u884c\u542f\u52a8<br />\n<code>celery -A tasks worker --loglevel=info</code></li>\n</ol>\n<blockquote>\n<p>tasks \u662f\u6587\u4ef6\u540d\u79f0\u975ecelery\u5b9e\u4f8b\u540d\u79f0</p>\n</blockquote>\n<ol start=\"4\">\n<li>\u4efb\u52a1\u8c03\u7528</li>\n</ol>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-comment\"># run.py</span>\n<span class=\"hljs-keyword\">from</span> tasks <span class=\"hljs-keyword\">import</span> add\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">calc</span><span class=\"hljs-params\">()</span>:</span>\n    <span class=\"hljs-keyword\">import</span> time\n    start = time.time()\n    print(<span class=\"hljs-string\">'\u51c6\u5907\u505a\u4e00\u4ef6\u4e8b'</span>)\n    add.delay(<span class=\"hljs-number\">100</span>,<span class=\"hljs-number\">200</span>)\n    print(<span class=\"hljs-string\">\"\u8ba9celery-redis\u6392\u961f\u53bb\u505a\u4e86\"</span>)\n    print(<span class=\"hljs-string\">\"\u8017\u65f6\uff1a%s \u79d2 \"</span> % (time.time() - start))\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:\n    calc()\n</code></div></pre>\n<p>\u8fd0\u884c\u51fd\u6570\u8c03\u7528\uff0c\u6b64\u65f6\u9047\u5230\u5f02\u6b65\u4efb\u52a1add\u4f1a\u653e\u5f03\u7b49\u5f85\uff0c\u76f4\u63a5\u7ee7\u7eed\u540e\u7eed\u4efb\u52a1\uff0cadd\u4efb\u52a1\u589e\u52a0\u5230\u6d88\u606f\u961f\u5217\u6d88\u8d39</p>", "body_md": "## Celery \u662f\u4ec0\u4e48\uff1f\nCelery \u662fPython\u8bed\u8a00\u5b9e\u73b0\u7684\u5206\u5e03\u5f0f\u961f\u5217\u670d\u52a1\uff0c\u9664\u4e86\u652f\u6301\u5373\u65f6\u4efb\u52a1\uff0c\u8fd8\u652f\u6301\u5b9a\u65f6\u4efb\u52a1\uff0cCelery \u67095\u4e2a\u6838\u5fc3\u89d2\u8272\u3002\n* Task\n\u4efb\u52a1(Task)\u5c31\u662f\u4f60\u8981\u505a\u7684\u4e8b\u60c5\uff0c\u4f8b\u5982\u4e00\u4e2a\u6ce8\u518c\u6d41\u7a0b\u91cc\u9762\u6709\u5f88\u591a\u4efb\u52a1\uff0c\u7ed9\u7528\u6237\u53d1\u9a8c\u8bc1\u90ae\u4ef6\u5c31\u662f\u4e00\u4e2a\u4efb\u52a1\uff0c\u8fd9\u79cd\u8017\u65f6\u7684\u4efb\u52a1\u5c31\u53ef\u4ee5\u4ea4\u7ed9Celery\u53bb\u5904\u7406\uff0c\u8fd8\u6709\u4e00\u79cd\u4efb\u52a1\u662f\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bd4\u5982\u6bcf\u5929\u5b9a\u65f6\u7edf\u8ba1\u7f51\u7ad9\u7684\u6ce8\u518c\u4eba\u6570\uff0c\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u4ea4\u7ed9Celery\u5468\u671f\u6027\u7684\u5904\u7406\u3002\n* Broker\nBroker \u7684\u4e2d\u6587\u610f\u601d\u662f\u7ecf\u7eaa\u4eba\uff0c\u6307\u4e3a\u5e02\u573a\u4e0a\u4e70\u5356\u53cc\u65b9\u63d0\u4f9b\u4e2d\u4ecb\u670d\u52a1\u7684\u4eba\u3002\u5728Celery\u4e2d\u8fd9\u4e2a\u89d2\u8272\u76f8\u5f53\u4e8e\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u961f\u5217\uff0c\u4ecb\u4e8e\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u7ecf\u7eaa\u4eba\u3002\u4f8b\u5982\u4e00\u4e2aWeb\u7cfb\u7edf\u4e2d\uff0c\u751f\u4ea7\u8005\u662f\u4e3b\u7a0b\u5e8f\uff0c\u5b83\u751f\u4ea7\u4efb\u52a1\uff0c\u5c06\u4efb\u52a1\u53d1\u9001\u7ed9 Broker\uff0c\u6d88\u8d39\u8005\u662f Worker\uff0c\u662f\u4e13\u95e8\u7528\u4e8e\u6267\u884c\u4efb\u52a1\u7684\u540e\u53f0\u670d\u52a1\u3002Celery\u672c\u8eab\u4e0d\u63d0\u4f9b\u961f\u5217\u670d\u52a1\uff0c\u4e00\u822c\u7528Redis\u6216\u8005RabbitMQ\u6765\u5b9e\u73b0\u961f\u5217\u670d\u52a1\u3002\n* Worker\nWorker \u5c31\u662f\u90a3\u4e2a\u4e00\u76f4\u5728\u540e\u53f0\u6267\u884c\u4efb\u52a1\u7684\u4eba\uff0c\u4e5f\u6210\u4e3a\u4efb\u52a1\u7684\u6d88\u8d39\u8005\uff0c\u5b83\u4f1a\u5b9e\u65f6\u5730\u76d1\u63a7\u961f\u5217\u4e2d\u6709\u6ca1\u6709\u4efb\u52a1\uff0c\u5982\u679c\u6709\u5c31\u7acb\u5373\u53d6\u51fa\u6765\u6267\u884c\u3002\n* Beat\nBeat \u662f\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u8c03\u5ea6\u5668\uff0c\u5b83\u4f1a\u6839\u636e\u914d\u7f6e\u5b9a\u65f6\u5c06\u4efb\u52a1\u53d1\u9001\u7ed9 Broker\uff0c\u7b49\u5f85 Worker \u6765\u6d88\u8d39\u3002\n* Backend\nBackend \u7528\u4e8e\u4fdd\u5b58\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\uff0c\u6bcf\u4e2a\u4efb\u52a1\u90fd\u6709\u8fd4\u56de\u503c\uff0c\u6bd4\u5982\u53d1\u9001\u90ae\u4ef6\u7684\u670d\u52a1\u4f1a\u544a\u8bc9\u6211\u4eec\u6709\u6ca1\u6709\u53d1\u9001\u6210\u529f\uff0c\u8fd9\u4e2a\u7ed3\u679c\u5c31\u662f\u5b58\u5728Backend\u4e2d\uff0c\u5f53\u7136\u6211\u4eec\u5e76\u4e0d\u603b\u662f\u8981\u5173\u5fc3\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\u3002\n\n\n\n\n\n![\u79fb\u52a8\u7aef\u663e\u793a\u6709\u95ee\u9898\u54c8](https://user-gold-cdn.xitu.io/2018/10/10/1665e8ee8b12546a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)\n\n\n\n\n## \u5b89\u88c5\n\n```pipenv install celery```\n> \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0ccelery\u4f7f\u7528redis\u4f5c\u4e3abroker\u65f6\uff0c\u76ee\u524d\u6ce8\u610f\u5230\u7684\u662f@3\u7248\u672credis\u4f1a\u51fa\u73b0\u9519\u8bef\uff0c\u6240\u4ee5\u6307\u5b9a\u5b89\u88c5\u524d\u4e00\u4ee3\u7248\u672c\uff08\u59822.10.6\uff09\n\n## \u8d77\u6b65\n\n1. \u5f15\u5165celery\n```py\nfrom celery import Celery\n\napp = Celery('tasks', broker='redis://127.0.0.1/7',backend='redis://127.0.0.1/8')\n```\n2. \u901a\u8fc7\u88c5\u9970\u5668\u4f7f\u666e\u901a\u4efb\u52a1\u53d8\u6210\u5f02\u6b65\u4efb\u52a1\n```py\n@app.task\ndef add(x,y):\n    return x+y\n```\n3. \u542f\u52a8Worker\n\u547d\u4ee4\u884c\u542f\u52a8\n`celery -A tasks worker --loglevel=info`\n> tasks \u662f\u6587\u4ef6\u540d\u79f0\u975ecelery\u5b9e\u4f8b\u540d\u79f0\n\n4. \u4efb\u52a1\u8c03\u7528\n```py\n# run.py\nfrom tasks import add\n\ndef calc():\n    import time\n    start = time.time()\n    print('\u51c6\u5907\u505a\u4e00\u4ef6\u4e8b')\n    add.delay(100,200)\n    print(\"\u8ba9celery-redis\u6392\u961f\u53bb\u505a\u4e86\")\n    print(\"\u8017\u65f6\uff1a%s \u79d2 \" % (time.time() - start))\n\nif __name__ == '__main__':\n    calc()\n``` \n\u8fd0\u884c\u51fd\u6570\u8c03\u7528\uff0c\u6b64\u65f6\u9047\u5230\u5f02\u6b65\u4efb\u52a1add\u4f1a\u653e\u5f03\u7b49\u5f85\uff0c\u76f4\u63a5\u7ee7\u7eed\u540e\u7eed\u4efb\u52a1\uff0cadd\u4efb\u52a1\u589e\u52a0\u5230\u6d88\u606f\u961f\u5217\u6d88\u8d39", "excerpt": "Celery \u662f\u4ec0\u4e48\uff1f\nCelery \u662fPython\u8bed\u8a00\u5b9e\u73b0\u7684\u5206\u5e03\u5f0f\u961f\u5217\u670d\u52a1\uff0c\u9664\u4e86\u652f\u6301\u5373\u65f6\u4efb\u52a1\uff0c\u8fd8\u652f\u6301\u5b9a\u65f6\u4efb\u52a1\uff0cCelery \u67095\u4e2a\u6838\u5fc3\u89d2\u8272\u3002\n\nTask\n\u4efb\u52a1(Task)\u5c31\u662f\u4f60\u8981\u505a\u7684\u4e8b\u60c5\uff0c\u4f8b\u5982\u4e00\u4e2a\u6ce8\u518c\u6d41\u7a0b\u91cc\u9762\u6709\u5f88\u591a\u4efb\u52a1\uff0c\u7ed9\u7528\u6237\u53d1\u9a8c\u8bc1\u90ae\u4ef6\u5c31\u662f\u4e00\u4e2a\u4efb\u52a1\uff0c\u8fd9\u79cd\u8017\u65f6\u7684\u4efb\u52a1\u5c31\u53ef\u4ee5\u4ea4\u7ed9Celery\u53bb\u5904\u7406\uff0c\u8fd8\u6709", "codestyle": "atelier-plateau-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-12T02:35:37.185", "mod_date": "2020-03-27T22:02:03.111", "views_count": 109, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [8]}}, {"model": "blog.post", "pk": 19, "fields": {"title": "django\u524d\u540e\u7aef\u5206\u79bb\u83b7\u5f97ip", "body": "<blockquote>\n<p>\u524d\u540e\u7aef\u5206\u79bb\u4e4b\u540e\uff0c\u91c7\u7528nginx\u4f5c\u4e3a\u9759\u6001\u670d\u52a1\u5668\uff0c\u5e76\u901a\u8fc7\u53cd\u5411\u4ee3\u7406\u7684\u65b9\u5f0f\u5b9e\u73b0\u63a5\u53e3\u8de8\u57df\u7684\u65b9\u5f0f\uff0c\u5728\u964d\u4f4e\u5f00\u53d1\u6210\u672c\u7684\u540c\u65f6\u4e5f\u5e26\u6765\u4e86\u8bf8\u591a\u95ee\u9898\uff0c\u4f8b\u5982\u5ba2\u6237\u7aef\u771f\u5b9eIP\u7684\u83b7\u53d6\u3002</p>\n</blockquote>\n<h2><a id=\"_2\"></a>\u540e\u7aef\u914d\u7f6e</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-comment\"># mildlle</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SetRemoteAddrFromForwardedFor</span><span class=\"hljs-params\">(MiddlewareMixin)</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">process_request</span><span class=\"hljs-params\">(self, request)</span>:</span>\n        instance = IpRecord(iplog)\n        ip = request.META.get(<span class=\"hljs-string\">'HTTP_X_REAL_IP'</span>, <span class=\"hljs-string\">''</span>)\n        <span class=\"hljs-keyword\">if</span> ip:\n            instance.set(ip)\n<span class=\"hljs-comment\"># ip\u8bb0\u5f55\u7c7b</span>\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> date\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IpRecord</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, ipdb)</span>:</span>\n        self.ipdb = ipdb\n\n    <span class=\"hljs-comment\"># \u96c6\u5408\u64cd\u4f5c\uff0c\u952e\u4e3a\u5f53\u5929\u65e5\u671f\uff0c\u503c\u4e3aip\u5730\u5740</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">set</span><span class=\"hljs-params\">(self, ip, prefix=<span class=\"hljs-string\">'IP::'</span>)</span>:</span>\n        key = <span class=\"hljs-string\">f'<span class=\"hljs-subst\">{prefix}</span><span class=\"hljs-subst\">{str(date.today())}</span>'</span>\n        self.ipdb.sadd(key, ip)\n\n    <span class=\"hljs-comment\"># \u83b7\u5f97\u5f53\u5929ip</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">get</span><span class=\"hljs-params\">(self,prefix=<span class=\"hljs-string\">'IP::'</span>)</span>:</span>\n        key = <span class=\"hljs-string\">f'<span class=\"hljs-subst\">{prefix}</span><span class=\"hljs-subst\">{str(date.today())}</span>'</span>\n        <span class=\"hljs-keyword\">return</span> self.ipdb.smembers(key)\n<span class=\"hljs-comment\"># \u67e5\u8be2ip</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">AdminGetIPViewset</span><span class=\"hljs-params\">(viewsets.ViewSet)</span>:</span>\n    permission_classes = (IsAdminUser,)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">list</span><span class=\"hljs-params\">(self, request, **kwargs)</span>:</span>\n        iplog = IpRecord(ip)\n        iplist = iplog.get()\n        <span class=\"hljs-keyword\">if</span> iplist:\n            data = {\n                <span class=\"hljs-string\">'result'</span>:iplist,\n                <span class=\"hljs-string\">'msg'</span>:<span class=\"hljs-string\">'success'</span>,\n                <span class=\"hljs-string\">'code'</span>:<span class=\"hljs-string\">'1000'</span>\n            }\n        <span class=\"hljs-keyword\">else</span>:\n            data = {\n                <span class=\"hljs-string\">'result'</span>: [],\n                <span class=\"hljs-string\">'msg'</span>: <span class=\"hljs-string\">'failer no data'</span>,\n                <span class=\"hljs-string\">'code'</span>: <span class=\"hljs-string\">'1004'</span>\n            }\n        <span class=\"hljs-keyword\">return</span> Response(data)\n</code></div></pre>\n<h2><a id=\"nginx_48\"></a>nginx\u914d\u7f6e</h2>\n<p>nginx\u914d\u7f6e\u4f5c\u4e3a\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u540e\uff0c\u8bbf\u95ee\u5355\u9875\u9762\u5e94\u7528\u65f6\uff0cnginx\u670d\u52a1\u5668\u672c\u5730\u8bbf\u95ee\u540e\u7aefapi\u63a5\u53e3\uff0c\u6b64\u65f6\u4f20\u7edf\u7684\u4e24\u4e2a\u8bf7\u6c42\u5934<code>HTTP_X_FORWARDED_FOR</code>\u548c<code>REMOTE_ADDR</code>\u5747\u65e0\u6cd5\u83b7\u5f97\u6709\u6548\u7684\u771f\u5b9eip\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728nginx\u91cc\u914d\u7f6e</p>\n<pre><code class=\"lang-\">        location   /api/v1/ {\n                proxy_set_header Host $host;\n                proxy_pass http://127.0.0.1:8000;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Real-Port $remote_port;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n</code></pre>\n<p>\u6b64\u65f6\u53ef\u4ee5\u5728request.Meta[\u2018X-Real-IP\u2019]\u83b7\u5f97\u771f\u5b9eip</p>", "body_md": "> \u524d\u540e\u7aef\u5206\u79bb\u4e4b\u540e\uff0c\u91c7\u7528nginx\u4f5c\u4e3a\u9759\u6001\u670d\u52a1\u5668\uff0c\u5e76\u901a\u8fc7\u53cd\u5411\u4ee3\u7406\u7684\u65b9\u5f0f\u5b9e\u73b0\u63a5\u53e3\u8de8\u57df\u7684\u65b9\u5f0f\uff0c\u5728\u964d\u4f4e\u5f00\u53d1\u6210\u672c\u7684\u540c\u65f6\u4e5f\u5e26\u6765\u4e86\u8bf8\u591a\u95ee\u9898\uff0c\u4f8b\u5982\u5ba2\u6237\u7aef\u771f\u5b9eIP\u7684\u83b7\u53d6\u3002\n\n## \u540e\u7aef\u914d\u7f6e\n```py\n# mildlle\nclass SetRemoteAddrFromForwardedFor(MiddlewareMixin):\n    def process_request(self, request):\n        instance = IpRecord(iplog)\n        ip = request.META.get('HTTP_X_REAL_IP', '')\n        if ip:\n            instance.set(ip)\n# ip\u8bb0\u5f55\u7c7b\nfrom datetime import date\n\nclass IpRecord:\n    def __init__(self, ipdb):\n        self.ipdb = ipdb\n\n    # \u96c6\u5408\u64cd\u4f5c\uff0c\u952e\u4e3a\u5f53\u5929\u65e5\u671f\uff0c\u503c\u4e3aip\u5730\u5740\n    def set(self, ip, prefix='IP::'):\n        key = f'{prefix}{str(date.today())}'\n        self.ipdb.sadd(key, ip)\n\n    # \u83b7\u5f97\u5f53\u5929ip\n    def get(self,prefix='IP::'):\n        key = f'{prefix}{str(date.today())}'\n        return self.ipdb.smembers(key)\n# \u67e5\u8be2ip\nclass AdminGetIPViewset(viewsets.ViewSet):\n    permission_classes = (IsAdminUser,)\n    def list(self, request, **kwargs):\n        iplog = IpRecord(ip)\n        iplist = iplog.get()\n        if iplist:\n            data = {\n                'result':iplist,\n                'msg':'success',\n                'code':'1000'\n            }\n        else:\n            data = {\n                'result': [],\n                'msg': 'failer no data',\n                'code': '1004'\n            }\n        return Response(data)\n```\n\n## nginx\u914d\u7f6e\nnginx\u914d\u7f6e\u4f5c\u4e3a\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u540e\uff0c\u8bbf\u95ee\u5355\u9875\u9762\u5e94\u7528\u65f6\uff0cnginx\u670d\u52a1\u5668\u672c\u5730\u8bbf\u95ee\u540e\u7aefapi\u63a5\u53e3\uff0c\u6b64\u65f6\u4f20\u7edf\u7684\u4e24\u4e2a\u8bf7\u6c42\u5934`HTTP_X_FORWARDED_FOR`\u548c`REMOTE_ADDR`\u5747\u65e0\u6cd5\u83b7\u5f97\u6709\u6548\u7684\u771f\u5b9eip\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728nginx\u91cc\u914d\u7f6e\n\n```\n        location   /api/v1/ {\n                proxy_set_header Host $host;\n                proxy_pass http://127.0.0.1:8000;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Real-Port $remote_port;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n```\n\n\u6b64\u65f6\u53ef\u4ee5\u5728request.Meta['X-Real-IP']\u83b7\u5f97\u771f\u5b9eip", "excerpt": "\n\u524d\u540e\u7aef\u5206\u79bb\u4e4b\u540e\uff0c\u91c7\u7528nginx\u4f5c\u4e3a\u9759\u6001\u670d\u52a1\u5668\uff0c\u5e76\u901a\u8fc7\u53cd\u5411\u4ee3\u7406\u7684\u65b9\u5f0f\u5b9e\u73b0\u63a5\u53e3\u8de8\u57df\u7684\u65b9\u5f0f\uff0c\u5728\u964d\u4f4e\u5f00\u53d1\u6210\u672c\u7684\u540c\u65f6\u4e5f\u5e26\u6765\u4e86\u8bf8\u591a\u95ee\u9898\uff0c\u4f8b\u5982\u5ba2\u6237\u7aef\u771f\u5b9eIP\u7684\u83b7\u53d6\u3002\n\n\u540e\u7aef\u914d\u7f6e\n# mildlle\nclass SetRemoteAddrFromForwardedFor(MiddlewareMixin):\n   ", "codestyle": "dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-17T00:40:06.498", "mod_date": "2020-03-20T10:30:01.836", "views_count": 38, "can_comment": true, "comment_count": 0, "upvote_count": 1, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [11]}}, {"model": "blog.post", "pk": 20, "fields": {"title": "leetcode\u987a\u5e8f\u89e3\u9898\uff08\u4e00\uff09", "body": "<h2><a id=\"1_twosum_0\"></a>1. \u4e24\u6570\u4e4b\u548c(two-sum)</h2>\n<blockquote>\n<p>\u7ed9\u5b9a\u4e00\u4e2a\u6574\u6570\u6570\u7ec4 nums\u00a0\u548c\u4e00\u4e2a\u76ee\u6807\u503c target\uff0c\u8bf7\u4f60\u5728\u8be5\u6570\u7ec4\u4e2d\u627e\u51fa\u548c\u4e3a\u76ee\u6807\u503c\u7684\u90a3\u00a0\u4e24\u4e2a\u00a0\u6574\u6570\uff0c\u5e76\u8fd4\u56de\u4ed6\u4eec\u7684\u6570\u7ec4\u4e0b\u6807\u3002<br />\n\u4f60\u53ef\u4ee5\u5047\u8bbe\u6bcf\u79cd\u8f93\u5165\u53ea\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u7b54\u6848\u3002\u4f46\u662f\uff0c\u4f60\u4e0d\u80fd\u91cd\u590d\u5229\u7528\u8fd9\u4e2a\u6570\u7ec4\u4e2d\u540c\u6837\u7684\u5143\u7d20\u3002</p>\n</blockquote>\n<p><a href=\"https://leetcode-cn.com/problems/two-sum/\" target=\"_blank\">\u793a\u4f8b\uff1a</a></p>\n<pre><code class=\"lang-\">\u7ed9\u5b9a nums = [2, 7, 11, 15], target = 9\n\n\u56e0\u4e3a nums[0] + nums[1] = 2 + 7 = 9\n\u6240\u4ee5\u8fd4\u56de [0, 1]\n</code></pre>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(nums,target)</span>:</span>\n    d ={}\n    <span class=\"hljs-keyword\">for</span> index,num <span class=\"hljs-keyword\">in</span> enumerate(nums):\n        <span class=\"hljs-keyword\">if</span> target-num <span class=\"hljs-keyword\">in</span> d:\n            <span class=\"hljs-keyword\">return</span> [d[target-num],index]\n        d[num] = index\n</code></div></pre>\n<h2><a id=\"2_addtwonumbers_20\"></a>2. \u4e24\u6570\u76f8\u52a0(add-two-numbers)</h2>\n<blockquote>\n<p>\u7ed9\u51fa\u4e24\u4e2a\u00a0\u975e\u7a7a \u7684\u94fe\u8868\u7528\u6765\u8868\u793a\u4e24\u4e2a\u975e\u8d1f\u7684\u6574\u6570\u3002\u5176\u4e2d\uff0c\u5b83\u4eec\u5404\u81ea\u7684\u4f4d\u6570\u662f\u6309\u7167\u00a0\u9006\u5e8f\u00a0\u7684\u65b9\u5f0f\u5b58\u50a8\u7684\uff0c\u5e76\u4e14\u5b83\u4eec\u7684\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u5b58\u50a8\u00a0\u4e00\u4f4d\u00a0\u6570\u5b57\u3002<br />\n\u5982\u679c\uff0c\u6211\u4eec\u5c06\u8fd9\u4e24\u4e2a\u6570\u76f8\u52a0\u8d77\u6765\uff0c\u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u94fe\u8868\u6765\u8868\u793a\u5b83\u4eec\u7684\u548c\u3002<br />\n\u60a8\u53ef\u4ee5\u5047\u8bbe\u9664\u4e86\u6570\u5b57 0 \u4e4b\u5916\uff0c\u8fd9\u4e24\u4e2a\u6570\u90fd\u4e0d\u4f1a\u4ee5 0\u00a0\u5f00\u5934\u3002</p>\n</blockquote>\n<p><a href=\"https://leetcode-cn.com/problems/add-two-numbers/\" target=\"_blank\">\u793a\u4f8b\uff1a</a></p>\n<pre><code class=\"lang-\">\u8f93\u5165\uff1a(2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)\n\u8f93\u51fa\uff1a7 -&gt; 0 -&gt; 8\n\u539f\u56e0\uff1a342 + 465 = 807\n</code></pre>", "body_md": "## 1. \u4e24\u6570\u4e4b\u548c(two-sum)\n>\u7ed9\u5b9a\u4e00\u4e2a\u6574\u6570\u6570\u7ec4 nums\u00a0\u548c\u4e00\u4e2a\u76ee\u6807\u503c target\uff0c\u8bf7\u4f60\u5728\u8be5\u6570\u7ec4\u4e2d\u627e\u51fa\u548c\u4e3a\u76ee\u6807\u503c\u7684\u90a3\u00a0\u4e24\u4e2a\u00a0\u6574\u6570\uff0c\u5e76\u8fd4\u56de\u4ed6\u4eec\u7684\u6570\u7ec4\u4e0b\u6807\u3002\n>\u4f60\u53ef\u4ee5\u5047\u8bbe\u6bcf\u79cd\u8f93\u5165\u53ea\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u7b54\u6848\u3002\u4f46\u662f\uff0c\u4f60\u4e0d\u80fd\u91cd\u590d\u5229\u7528\u8fd9\u4e2a\u6570\u7ec4\u4e2d\u540c\u6837\u7684\u5143\u7d20\u3002\n\n[\u793a\u4f8b\uff1a](https://leetcode-cn.com/problems/two-sum/)\n```\n\u7ed9\u5b9a nums = [2, 7, 11, 15], target = 9\n\n\u56e0\u4e3a nums[0] + nums[1] = 2 + 7 = 9\n\u6240\u4ee5\u8fd4\u56de [0, 1]\n```\n```py\ndef main(nums,target):\n    d ={}\n    for index,num in enumerate(nums):\n        if target-num in d:\n            return [d[target-num],index]\n        d[num] = index\n```\n\n## 2. \u4e24\u6570\u76f8\u52a0(add-two-numbers)\n>\u7ed9\u51fa\u4e24\u4e2a\u00a0\u975e\u7a7a \u7684\u94fe\u8868\u7528\u6765\u8868\u793a\u4e24\u4e2a\u975e\u8d1f\u7684\u6574\u6570\u3002\u5176\u4e2d\uff0c\u5b83\u4eec\u5404\u81ea\u7684\u4f4d\u6570\u662f\u6309\u7167\u00a0\u9006\u5e8f\u00a0\u7684\u65b9\u5f0f\u5b58\u50a8\u7684\uff0c\u5e76\u4e14\u5b83\u4eec\u7684\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u5b58\u50a8\u00a0\u4e00\u4f4d\u00a0\u6570\u5b57\u3002\n\u5982\u679c\uff0c\u6211\u4eec\u5c06\u8fd9\u4e24\u4e2a\u6570\u76f8\u52a0\u8d77\u6765\uff0c\u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u94fe\u8868\u6765\u8868\u793a\u5b83\u4eec\u7684\u548c\u3002\n\u60a8\u53ef\u4ee5\u5047\u8bbe\u9664\u4e86\u6570\u5b57 0 \u4e4b\u5916\uff0c\u8fd9\u4e24\u4e2a\u6570\u90fd\u4e0d\u4f1a\u4ee5 0\u00a0\u5f00\u5934\u3002\n\n[\u793a\u4f8b\uff1a](https://leetcode-cn.com/problems/add-two-numbers/)\n```\n\u8f93\u5165\uff1a(2 -> 4 -> 3) + (5 -> 6 -> 4)\n\u8f93\u51fa\uff1a7 -> 0 -> 8\n\u539f\u56e0\uff1a342 + 465 = 807\n```", "excerpt": "1. \u4e24\u6570\u4e4b\u548c(two-sum)\n\n\u7ed9\u5b9a\u4e00\u4e2a\u6574\u6570\u6570\u7ec4 nums\u00a0\u548c\u4e00\u4e2a\u76ee\u6807\u503c target\uff0c\u8bf7\u4f60\u5728\u8be5\u6570\u7ec4\u4e2d\u627e\u51fa\u548c\u4e3a\u76ee\u6807\u503c\u7684\u90a3\u00a0\u4e24\u4e2a\u00a0\u6574\u6570\uff0c\u5e76\u8fd4\u56de\u4ed6\u4eec\u7684\u6570\u7ec4\u4e0b\u6807\u3002\n\u4f60\u53ef\u4ee5\u5047\u8bbe\u6bcf\u79cd\u8f93\u5165\u53ea\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u7b54\u6848\u3002\u4f46\u662f\uff0c\u4f60\u4e0d\u80fd\u91cd\u590d\u5229\u7528\u8fd9\u4e2a\u6570\u7ec4\u4e2d\u540c\u6837\u7684\u5143\u7d20\u3002\n\n\u793a\u4f8b\uff1a\n\u7ed9\u5b9a nums = [2, 7, 11, 15]", "codestyle": "atelier-plateau-dark", "reproduce": false, "reproduce_source": "", "create_date": "2020-03-18T10:10:02.062", "mod_date": "2020-03-18T10:10:02.062", "views_count": 9, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 1, "tags": [12]}}, {"model": "blog.post", "pk": 21, "fields": {"title": "Notes", "body": "<h2><a id=\"_0\"></a>\u751f\u6210\u6307\u5b9a\u4f4d\u6570\u968f\u673a\u5b57\u7b26</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">import</span> string\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">generatevifcode</span><span class=\"hljs-params\">(n=<span class=\"hljs-number\">6</span>)</span>:</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">''</span>.join(random.sample(string.ascii_letters+string.digits,n))\n</code></div></pre>\n<blockquote>\n<p>string\u6a21\u5757\u5e2e\u52a9\u7b80\u5316\u751f\u6210\u82f1\u6587\u5b57\u7b26(\u5927\uff0c\u5c0f\u5199)\u548c\u6570\u5b57</p>\n</blockquote>", "body_md": "## \u751f\u6210\u6307\u5b9a\u4f4d\u6570\u968f\u673a\u5b57\u7b26\n```py\nimport random\nimport string\ndef generatevifcode(n=6):\n    return ''.join(random.sample(string.ascii_letters+string.digits,n))\n```\n> string\u6a21\u5757\u5e2e\u52a9\u7b80\u5316\u751f\u6210\u82f1\u6587\u5b57\u7b26(\u5927\uff0c\u5c0f\u5199)\u548c\u6570\u5b57", "excerpt": "\u751f\u6210\u6307\u5b9a\u4f4d\u6570\u968f\u673a\u5b57\u7b26\nimport random\nimport string\ndef generatevifcode(n=6):\n    return ''.join(random.sample(string.ascii_letters+string.digits,n))\n\n\nstring\u6a21\u5757\u5e2e\u52a9\u7b80", "codestyle": "gruvbox-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-21T23:28:22.189", "mod_date": "2020-03-21T23:28:34.164", "views_count": 12, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 7, "tags": []}}, {"model": "blog.post", "pk": 22, "fields": {"title": "Docker", "body": "<h2><a id=\"_0\"></a>\u5b89\u88c5</h2>\n<p><code>yum install -y yum-utils \\ device-mapper-persistent-data \\ lvm2</code></p>\n<blockquote>\n<p>\u5b89\u88c5\u652f\u6301\u5426\u5219\u4f1a\u5b89\u88c5\u65e7\u7248\u672c</p>\n</blockquote>\n<p><code>yum install docker</code></p>\n<h3><a id=\"_9\"></a>\u8bbe\u7f6e\u4e0b\u8f7d\u6e90</h3>\n<p><code>vim /etc/docker/daemon.json</code></p>\n<pre><div class=\"hljs\"><code class=\"lang-json\">{\n    <span class=\"hljs-attr\">\"registry-mirrors\"</span>: [\n        <span class=\"hljs-string\">\"http://hub-mirror.c.163.com\"</span>,\n        <span class=\"hljs-string\">\"https://registry.docker-cn.com\"</span>\n    ]\n}\n</code></div></pre>\n<h3><a id=\"docker_20\"></a>\u5f00\u542f/\u91cd\u542fdocker\u670d\u52a1</h3>\n<pre><code class=\"lang-\">systemctl start/restart docker\n</code></pre>\n<h3><a id=\"docker_25\"></a>\u67e5\u770bdocker\u670d\u52a1</h3>\n<p><code>ps -aux |grep docker</code></p>\n<h3><a id=\"_28\"></a>\u5f00\u673a\u542f\u52a8</h3>\n<p><code>sudo systemctl enable docker</code></p>\n<h3><a id=\"_31\"></a>\u67e5\u770b\u7248\u672c</h3>\n<p><code>docker version</code></p>\n<blockquote>\n<p>\u5982\u679c\u53ea\u51fa\u73b0\u4e00\u4e2aclient\u7248\u672c\u6ca1\u51fa\u73b0server\u7248\u672c\uff0c\u8bf7\u91cd\u542fdocker\u6216\u8005\u6dfb\u52a0\u6743\u9650sudo</p>\n</blockquote>\n<h3><a id=\"docker_35\"></a>\u67e5\u770bdocker\u4fe1\u606f</h3>\n<p><code>docker info</code></p>\n<h3><a id=\"centos_38\"></a>\u5b89\u88c5\u5f00\u542f\u4e00\u4e2acentos</h3>\n<p><code>docker run -i -t centos /bin/bash</code></p>\n<blockquote>\n<p>\u8fdc\u7a0b\u4e0b\u8f7d\u4e00\u4e2acentos\u670d\u52a1\uff0cexit\u9000\u51fa</p>\n</blockquote>\n<h2><a id=\"_images_42\"></a>\u955c\u50cf images</h2>\n<p><img src=\"http://zhaoheping.com/media/postserver/img/20200323010207-314.png\" alt=\"image.png\" /></p>\n<blockquote>\n<p>\u5982\u679c\u8fdb\u884c\u5f62\u8c61\u7684\u8868\u8ff0\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 Docker \u955c\u50cf\u7406\u89e3\u4e3a\u5305\u542b\u5e94\u7528\u7a0b\u5e8f\u4ee5\u53ca\u5176\u76f8\u5173\u4f9d\u8d56\u7684\u4e00\u4e2a\u57fa\u7840\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728 Docker \u5bb9\u5668\u542f\u52a8\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u88ab\u7528\u4e8e\u521b\u5efa\u5bb9\u5668\u7684\u8fd0\u884c\u73af\u5883\u3002</p>\n</blockquote>\n<ul>\n<li>\u67e5\u770b\u955c\u50cf <code>docker images</code></li>\n</ul>\n<h3><a id=\"_48\"></a>\u955c\u50cf\u547d\u4ee4</h3>\n<blockquote>\n<p>\u67e5\u770b\u6240\u6709\u955c\u50cf\u547d\u4ee4 <code>docker image -h</code></p>\n</blockquote>\n<ul>\n<li>\u62c9\u53d6\u955c\u50cf <code>docker image pull imagename</code></li>\n<li>\u67e5\u770b\u955c\u50cf <code>docker image inspect imagename</code></li>\n<li>\u5220\u9664\u955c\u50cf <code>docker image rm imagename</code>\uff08\u9700\u8981\u6ca1\u6709\u5bb9\u5668\u4f7f\u7528\u7684\u955c\u50cf\uff09</li>\n</ul>\n<h3><a id=\"_54\"></a>\u955c\u50cf\u547d\u540d</h3>\n<ul>\n<li><strong>username</strong>:\u4e3b\u8981\u7528\u4e8e\u8bc6\u522b\u4e0a\u4f20\u955c\u50cf\u7684\u4e0d\u540c\u7528\u6237\uff0c\u4e0e GitHub \u4e2d\u7684\u7528\u6237\u7a7a\u95f4\u7c7b\u4f3c</li>\n<li><strong>repository</strong>\uff1a\u4e3b\u8981\u7528\u4e8e\u8bc6\u522b\u8fdb\u884c\u7684\u5185\u5bb9\uff0c\u5f62\u6210\u5bf9\u955c\u50cf\u7684\u8868\u610f\u63cf\u8ff0\u3002</li>\n<li><strong>tag</strong>\uff1a\u4e3b\u8981\u7528\u6237\u8868\u793a\u955c\u50cf\u7684\u7248\u672c\uff0c\u65b9\u4fbf\u533a\u5206\u8fdb\u884c\u5185\u5bb9\u7684\u4e0d\u540c\u7ec6\u8282</li>\n</ul>\n<h3><a id=\"_59\"></a>\u4ece\u955c\u50cf\u4ed3\u5e93\u83b7\u5f97\u955c\u50cf\uff0c\u7ba1\u7406\u955c\u50cf</h3>\n<ul>\n<li>\u83b7\u53d6\u955c\u50cf\uff1a<code>sudo docker pull ubuntu</code></li>\n<li>\u6307\u5b9a\u7248\u672c\uff1a <code>docker pull nginx:1.12</code></li>\n</ul>\n<p>Docker Hub \u7684\u5730\u5740\u662f\uff1a<a href=\"https://hub.docker.com/\" target=\"_blank\">https://hub.docker.com/</a></p>\n<p>\u5728 Docker Hub \u7684\u641c\u7d22\u7ed3\u679c\u4e2d\uff0c\u6709\u51e0\u9879\u5173\u952e\u7684\u4fe1\u606f\u6709\u52a9\u4e8e\u6211\u4eec\u9009\u62e9\u5408\u9002\u7684\u955c\u50cf\uff1a</p>\n<ul>\n<li><strong>OFFICIAL</strong> \u4ee3\u8868\u955c\u50cf\u4e3a Docker \u5b98\u65b9\u63d0\u4f9b\u548c\u7ef4\u62a4\uff0c\u76f8\u5bf9\u6765\u8bf4\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u8f83\u9ad8</li>\n<li><strong>STARS</strong> \u4ee3\u8868\u955c\u50cf\u7684\u5173\u6ce8\u4eba\u6570\uff0c\u8fd9\u7c7b\u4f3c GitHub \u7684 Stars\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u70ed\u5ea6</li>\n<li><strong>PULLS</strong> \u4ee3\u8868\u955c\u50cf\u88ab\u62c9\u53d6\u7684\u6b21\u6570\uff0c\u57fa\u672c\u4e0a\u80fd\u591f\u8868\u793a\u955c\u50cf\u88ab\u4f7f\u7528\u7684\u9891\u5ea6</li>\n</ul>\n<ul>\n<li>\u641c\u7d22\u955c\u50cf <code>docker search imagename</code></li>\n<li>\u67e5\u770b\u955c\u50cf\u8be6\u7ec6\u4fe1\u606f <code>docker inspect imagename</code></li>\n<li>\u5220\u9664\u955c\u50cf <code>docker rmi ubuntu:latest</code></li>\n<li>save/load \u672c\u5730\u4fdd\u5b58/\u5bfc\u5165\u955c\u50cf</li>\n</ul>\n<h2><a id=\"_76\"></a>\u8fd0\u884c\u548c\u7ba1\u7406\u5bb9\u5668</h2>\n<p><img src=\"http://zhaoheping.com/media/postserver/img/20200323005935-859.png\" alt=\"\u4e0b\u8f7d.png\" /><br />\n<img src=\"http://zhaoheping.com/media/postserver/img/20200323021639-804.png\" alt=\"containermanage.png\" /></p>\n<ul>\n<li>\u521b\u5efa\u5bb9\u5668 <code>docker create nginx:1.12</code></li>\n<li>\u914d\u7f6e\u5bb9\u5668\u522b\u540d <code>sudo docker create --name nginx nginx:1.12</code></li>\n<li>\u542f\u52a8\u5bb9\u5668 <code>sudo docker start nginx</code></li>\n<li>\u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668 <code>sudo docker run -itd --name nginx nginx:1.12</code></li>\n</ul>\n<blockquote>\n<p>\u2013name \u914d\u7f6e\u522b\u540d</p>\n</blockquote>\n<ul>\n<li>\u8fdb\u5165\u5bb9\u5668  <code>docker attach containername</code>  (\u6b64\u5bb9\u5668\u9700\u8981\u5728\u8fd0\u884c)</li>\n<li>\u8fdb\u5165\u5bb9\u5668  <code>docker exec -it containername bash/csh</code></li>\n<li>\u9000\u51fa\u5bb9\u5668 \u2018ctrl+q+p\u2019\uff08\u53ef\u4ee5\u4e0d\u7ed3\u675f\u5bb9\u5668\u9000\u51fa\uff09</li>\n<li>\u67e5\u770b\u5bb9\u5668 <code>docker ps -a</code></li>\n</ul>\n<blockquote>\n<p><strong>STATUS</strong> \u6307\u4ee3\u5bb9\u5668\u8fd0\u884c\u72b6\u6001  <strong>Created</strong> \u610f\u6307\u521b\u5efa\u5c1a\u672a\u542f\u52a8\u8fc7\uff1b**Up [ Time ]**\u8868\u793a\u8fd0\u884c\u4e2d\uff0ctime\u8868\u8fd0\u884c\u65f6\u95f4\uff1b<strong>Exited ([ Code ]) [ Time ]</strong> \u8868\u793a\u8fd0\u884c\u7ed3\u675f\uff0ccode\u7ed3\u675f\u7801\uff0ctime\u7ed3\u675f\u5230\u73b0\u5728\u65f6\u95f4</p>\n</blockquote>\n<ul>\n<li>\u505c\u6b62\u5bb9\u5668  <code>docker stop nginx</code></li>\n<li>\u5220\u9664\u5bb9\u5668 <code>docker rm nginx</code></li>\n<li>\u8fdb\u5165\u5bb9\u5668 <code>sudo docker exec nginx more /etc/hostname</code></li>\n<li>\u8fdb\u5165\u5bb9\u5668\u4f2a\u7ec8\u7aef <code>docker container exec -it containername bash/csh/sh</code></li>\n</ul>\n<h3><a id=\"_95\"></a>\u67e5\u770b\u5bb9\u5668\u72b6\u6001</h3>\n<ul>\n<li>\u65e5\u5fd7 <code>docker logs containerid</code></li>\n<li>pid <code>docker top containerid</code></li>\n</ul>\n<h3><a id=\"_99\"></a>\u5bf9\u5bb9\u5668\u8fdb\u884c\u76f4\u63a5\u64cd\u4f5c</h3>\n<p><code>docker exec 04 cat /usr/share/nginx/html/index.html</code> \u67e5\u770b\u6587\u4ef6\u5939</p>\n<blockquote>\n<p>\u53ea\u8bfb\u4e0d\u53ef\u5199\uff1avi touch\u7b49\u64cd\u4f5c\u65e0\u6548\u679c<br />\n<code>docker exec -it 04 sh</code> \u8fdb\u5165\u5bb9\u5668</p>\n</blockquote>\n<h3><a id=\"_104\"></a>\u66f4\u65b0\u5bb9\u5668\u914d\u7f6e</h3>\n<ol>\n<li><code>docker container update --restart=always containername</code></li>\n<li>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff081.\u6682\u505c\u5bb9\u56682.\u66f4\u6539\u914d\u7f6e\u6587\u4ef6\uff08/var/lib/docker/containers/\u5bb9\u5668id\uff09\uff09hostconfig.json</li>\n</ol>\n<h2><a id=\"volume_109\"></a>\u6570\u636e\u5377volume</h2>\n<blockquote>\n<p>\u9ed8\u8ba4\u8def\u5f84 <code>/var/lib/docker/volumes/</code></p>\n</blockquote>\n<h5><a id=\"Tmpfs_Mountvolume_112\"></a>\u4e09\u79cd\u6302\u8f7d\u65b9\u5f0f\uff1aTmpfs Mount\uff1a\u5bb9\u5668\u5220\u9664\u6570\u636e\u6d88\u5931\uff1bvolume\uff1a\u5728\u9ed8\u8ba4\u8def\u5f84\u4e0b\u7684\u6570\u636e\u5377\u6302\u8f7d\uff08\u63a8\u8350\uff09\uff1b\u6587\u4ef6\u76ee\u5f55\u6302\u8f7d\uff1a\u7edd\u5bf9\u8def\u5f84\u6302\u8f7d</h5>\n<ul>\n<li>\u521b\u5efa create</li>\n<li>\u4fe1\u606f inspect</li>\n<li>\u5217\u8868 ls</li>\n<li>\u6e05\u9664\u672a\u4f7f\u7528 prume</li>\n<li>\u5220\u9664 rm</li>\n</ul>\n<h3><a id=\"_118\"></a>\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377</h3>\n<p><code>docker volume create nginxv</code></p>\n<h3><a id=\"nginx_120\"></a>\u5f00\u542f\u4e00\u4e2a\u6302\u8f7d\u6570\u636e\u5377\u7684nginx</h3>\n<p><code>docker run -itd --name nginx -p 88:80 --mount src=nginx,dst=/usr/share/nginx/html nginx</code><br />\n\u6548\u679c\u548c\u4e0b\u76f8\u540c\uff1a<br />\n<code>docker run -itd --name nginx -p 88:80 -v nginx:/usr/share/nginx/html heping945/nginx1.17</code></p>\n<blockquote>\n<p>\u5728\u7edd\u5bf9\u8def\u5f84\u4e0b\u6302\u8f7d\uff08\u4f1a\u5728\u6839\u76ee\u5f55\u4e0b\u521b\u5efa/webapp/html\u4e0b\u6302\u8f7d\uff09:\u6587\u4ef6\u6302\u8f7d\u975e\u6570\u636e\u5377<br />\n<code>docker run -d --name nginx -v /webapp/html:/usr/share/nginx/html nginx</code><br />\n<mark>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u505a\u6587\u4ef6\u6620\u5c04\u65f6\uff0c\u672c\u5730\u76ee\u5f55\u9700\u8981\u6709\u76f8\u5173\u6587\u4ef6\uff0c\u5982nginx\u7684\u6620\u5c04/var/share/nginx/html \u76ee\u5f55\u4e0b\u7684index.html\u9700\u8981\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u5b58\u5728</mark><br />\n<code>docker run -itd --name nginxx -p 88:80 -v /home/zhp/ng:/usr/share/nginx/html fc1d</code></p>\n</blockquote>\n<h3><a id=\"windows__128\"></a>windows \u4e0a\u7684\u76ee\u5f55\u6302\u8f7d</h3>\n<p><code>docker run -itd --name nginx -p 90:80 -v /f/dockerdir/nginx/:/usr/share/nginx/html fc1d</code><br />\ndocker-desktop\u8981\u8bbe\u7f6e\u5171\u4eab\u76d8\uff0c\u7136\u540e\u53ef\u4ee5/\u5171\u4eab\u76d8/\u76ee\u5f55\u6302\u8f7d</p>\n<h3><a id=\"mysql_131\"></a>\u5f00\u542f\u4e00\u4e2amysql</h3>\n<p><code>docker run -itd --name blogmysql --mount src=mysqlv,dst=/var/lib/mysql -e MYSQL_ROOT_PASSWORD=setpassword mysql --character-set-server=utf8</code></p>\n<blockquote>\n<p>\u8bbe\u7f6e\u4e86mysql\u5bc6\u7801\uff0c\u8bbe\u7f6e\u4e86\u6570\u636e\u5377\uff0c\u8bbe\u7f6e\u4e86\u5b57\u7b26\u96c6</p>\n</blockquote>\n<h2><a id=\"Dockerfile_135\"></a>Dockerfile</h2>\n<p><img src=\"http://zhaoheping.com/media/postserver/img/20200323192405-267.png\" alt=\"dockerfile.png\" /></p>\n<ul>\n<li>\n<p>FROM\uff1a\u57fa\u7840\u955c\u50cf\uff0c\u5f53\u524d\u65b0\u955c\u50cf\u662f\u57fa\u4e8e\u54ea\u4e2a\u955c\u50cf\u7684</p>\n</li>\n<li>\n<p>MAINTAINER\uff1a\u955c\u50cf\u7ef4\u62a4\u8005\u7684\u59d3\u540d\u548c\u90ae\u7bb1\u5730\u5740</p>\n</li>\n<li>\n<p>RUN\uff1a\u5bb9\u5668\u6784\u5efa\u65f6\u9700\u8981\u8fd0\u884c\u7684\u547d\u4ee4</p>\n</li>\n<li>\n<p>EXPOSE\uff1a\u5f53\u524d\u5bb9\u5668\u5bf9\u5916\u66b4\u9732\u51fa\u7684\u7aef\u53e3</p>\n</li>\n<li>\n<p>WORKDIR\uff1a\u6307\u5b9a\u5728\u521b\u5efa\u5bb9\u5668\u540e\uff0c\u7ec8\u7aef\u9ed8\u8ba4\u767b\u9646\u7684\u8fdb\u6765\u5de5\u4f5c\u76ee\u5f55\uff0c\u4e00\u4e2a\u843d\u811a\u70b9</p>\n</li>\n<li>\n<p>ENV\uff1a\u7528\u6765\u5728\u6784\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf</p>\n</li>\n<li>\n<p>ADD\uff1a\u5c06\u5bbf\u4e3b\u673a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u62f7\u8d1d\u8fdb\u955c\u50cf\u4e14 ADD \u547d\u4ee4\u4f1a\u81ea\u52a8\u5904\u7406 URL \u548c\u89e3\u538b tar \u538b\u7f29\u5305</p>\n</li>\n<li>\n<p>COPY\uff1a\u7c7b\u4f3c ADD\uff0c\u62f7\u8d1d\u6587\u4ef6\u548c\u76ee\u5f55\u5230\u955c\u50cf\u4e2d\u3002\uff08COPY src dest \u6216 COPY [\u201csrc\u201d,\u201cdest\u201d]\uff09</p>\n</li>\n<li>\n<p>VOLUME\uff1a\u5bb9\u5668\u6570\u636e\u5377\uff0c\u7528\u4e8e\u6570\u636e\u4fdd\u5b58\u548c\u6301\u4e45\u5316\u5de5\u4f5c</p>\n</li>\n<li>\n<p>CMD\uff1a\u6307\u5b9a\u4e00\u4e2a\u5bb9\u5668\u542f\u52a8\u65f6\u8981\u8fd0\u884c\u7684\u547d\u4ee4\uff0cDockerfile \u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a CMD \u6307\u4ee4\uff0c\u4f46\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u751f\u6548\uff0cCMD \u4f1a\u88ab docker run \u4e4b\u540e\u7684\u53c2\u6570\u66ff\u6362</p>\n</li>\n<li>\n<p>ENTRYPOINT\uff1a\u6307\u5b9a\u4e00\u4e2a\u5bb9\u5668\u542f\u52a8\u65f6\u8981\u8fd0\u884c\u7684\u547d\u4ee4\uff0cENTRYPOINT \u7684\u76ee\u7684\u548c CMD \u4e00\u6837\uff0c\u90fd\u662f\u5728\u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u7a0b\u5e8f\u53ca\u53c2\u6570</p>\n</li>\n<li>\n<p>ONBUILD\uff1a\u5f53\u6784\u5efa\u4e00\u4e2a\u88ab\u7ee7\u627f\u7684 Dockerfile \u65f6\u8fd0\u884c\u547d\u4ee4\uff0c\u7236\u955c\u50cf\u5728\u88ab\u5b50\u7ee7\u627f\u540e\u7236\u955c\u50cf\u7684 onbuild \u88ab\u89e6\u53d1</p>\n</li>\n</ul>\n<h3><a id=\"_162\"></a>\u6784\u5efa</h3>\n<p><code>docker build -f mydockerfile -t blog:v1 .</code></p>\n<ul>\n<li>-f  Dockerfile\u8def\u5f84</li>\n<li>-t  \u5bb9\u5668\u540d\u79f0\u53ef\u5e26\u7248\u672c</li>\n<li>.   \u8def\u5f84</li>\n</ul>", "body_md": "## \u5b89\u88c5\n`\nyum install -y yum-utils \\\n  device-mapper-persistent-data \\\n  lvm2\n`\n> \u5b89\u88c5\u652f\u6301\u5426\u5219\u4f1a\u5b89\u88c5\u65e7\u7248\u672c\n\n`yum install docker`\n### \u8bbe\u7f6e\u4e0b\u8f7d\u6e90\n`vim /etc/docker/daemon.json`\n```json\n{\n    \"registry-mirrors\": [\n        \"http://hub-mirror.c.163.com\",\n        \"https://registry.docker-cn.com\"\n    ]\n}\n```\n\n###  \u5f00\u542f/\u91cd\u542fdocker\u670d\u52a1\n```\nsystemctl start/restart docker\n```\n\n###  \u67e5\u770bdocker\u670d\u52a1\n`ps -aux |grep docker`\n\n### \u5f00\u673a\u542f\u52a8\n`sudo systemctl enable docker`\n\n### \u67e5\u770b\u7248\u672c\n`docker version`\n> \u5982\u679c\u53ea\u51fa\u73b0\u4e00\u4e2aclient\u7248\u672c\u6ca1\u51fa\u73b0server\u7248\u672c\uff0c\u8bf7\u91cd\u542fdocker\u6216\u8005\u6dfb\u52a0\u6743\u9650sudo\n\n### \u67e5\u770bdocker\u4fe1\u606f\n`docker info`\n\n### \u5b89\u88c5\u5f00\u542f\u4e00\u4e2acentos\n`docker run -i -t centos /bin/bash`\n> \u8fdc\u7a0b\u4e0b\u8f7d\u4e00\u4e2acentos\u670d\u52a1\uff0cexit\u9000\u51fa\n\n## \u955c\u50cf images\n![image.png](http://zhaoheping.com/media/postserver/img/20200323010207-314.png)\n\n> \u5982\u679c\u8fdb\u884c\u5f62\u8c61\u7684\u8868\u8ff0\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 Docker \u955c\u50cf\u7406\u89e3\u4e3a\u5305\u542b\u5e94\u7528\u7a0b\u5e8f\u4ee5\u53ca\u5176\u76f8\u5173\u4f9d\u8d56\u7684\u4e00\u4e2a\u57fa\u7840\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728 Docker \u5bb9\u5668\u542f\u52a8\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\u88ab\u7528\u4e8e\u521b\u5efa\u5bb9\u5668\u7684\u8fd0\u884c\u73af\u5883\u3002\n- \u67e5\u770b\u955c\u50cf `docker images`\n\n### \u955c\u50cf\u547d\u4ee4\n> \u67e5\u770b\u6240\u6709\u955c\u50cf\u547d\u4ee4 `docker image -h`\n- \u62c9\u53d6\u955c\u50cf `docker image pull imagename`\n- \u67e5\u770b\u955c\u50cf `docker image inspect imagename`\n- \u5220\u9664\u955c\u50cf `docker image rm imagename`\uff08\u9700\u8981\u6ca1\u6709\u5bb9\u5668\u4f7f\u7528\u7684\u955c\u50cf\uff09\n\n### \u955c\u50cf\u547d\u540d\n- **username**:\u4e3b\u8981\u7528\u4e8e\u8bc6\u522b\u4e0a\u4f20\u955c\u50cf\u7684\u4e0d\u540c\u7528\u6237\uff0c\u4e0e GitHub \u4e2d\u7684\u7528\u6237\u7a7a\u95f4\u7c7b\u4f3c\n- **repository**\uff1a\u4e3b\u8981\u7528\u4e8e\u8bc6\u522b\u8fdb\u884c\u7684\u5185\u5bb9\uff0c\u5f62\u6210\u5bf9\u955c\u50cf\u7684\u8868\u610f\u63cf\u8ff0\u3002\n-   **tag**\uff1a\u4e3b\u8981\u7528\u6237\u8868\u793a\u955c\u50cf\u7684\u7248\u672c\uff0c\u65b9\u4fbf\u533a\u5206\u8fdb\u884c\u5185\u5bb9\u7684\u4e0d\u540c\u7ec6\u8282\n\n### \u4ece\u955c\u50cf\u4ed3\u5e93\u83b7\u5f97\u955c\u50cf\uff0c\u7ba1\u7406\u955c\u50cf\n- \u83b7\u53d6\u955c\u50cf\uff1a`sudo docker pull ubuntu`\n- \u6307\u5b9a\u7248\u672c\uff1a `docker pull nginx:1.12`\n\nDocker Hub \u7684\u5730\u5740\u662f\uff1a[https://hub.docker.com/](https://hub.docker.com/)\n\n\u5728 Docker Hub \u7684\u641c\u7d22\u7ed3\u679c\u4e2d\uff0c\u6709\u51e0\u9879\u5173\u952e\u7684\u4fe1\u606f\u6709\u52a9\u4e8e\u6211\u4eec\u9009\u62e9\u5408\u9002\u7684\u955c\u50cf\uff1a\n\n*   **OFFICIAL** \u4ee3\u8868\u955c\u50cf\u4e3a Docker \u5b98\u65b9\u63d0\u4f9b\u548c\u7ef4\u62a4\uff0c\u76f8\u5bf9\u6765\u8bf4\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6027\u8f83\u9ad8\n*   **STARS** \u4ee3\u8868\u955c\u50cf\u7684\u5173\u6ce8\u4eba\u6570\uff0c\u8fd9\u7c7b\u4f3c GitHub \u7684 Stars\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u70ed\u5ea6\n*   **PULLS** \u4ee3\u8868\u955c\u50cf\u88ab\u62c9\u53d6\u7684\u6b21\u6570\uff0c\u57fa\u672c\u4e0a\u80fd\u591f\u8868\u793a\u955c\u50cf\u88ab\u4f7f\u7528\u7684\u9891\u5ea6\n\n- \u641c\u7d22\u955c\u50cf `docker search imagename` \n- \u67e5\u770b\u955c\u50cf\u8be6\u7ec6\u4fe1\u606f `docker inspect imagename`\n- \u5220\u9664\u955c\u50cf `docker rmi ubuntu:latest`\n- save/load \u672c\u5730\u4fdd\u5b58/\u5bfc\u5165\u955c\u50cf\n\n## \u8fd0\u884c\u548c\u7ba1\u7406\u5bb9\u5668\n![\u4e0b\u8f7d.png](http://zhaoheping.com/media/postserver/img/20200323005935-859.png)\n![containermanage.png](http://zhaoheping.com/media/postserver/img/20200323021639-804.png)\n\n- \u521b\u5efa\u5bb9\u5668 `docker create nginx:1.12`\n- \u914d\u7f6e\u5bb9\u5668\u522b\u540d `sudo docker create --name nginx nginx:1.12`\n- \u542f\u52a8\u5bb9\u5668 `sudo docker start nginx`\n- \u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668 `sudo docker run -itd --name nginx  nginx:1.12`\n> --name \u914d\u7f6e\u522b\u540d \n- \u8fdb\u5165\u5bb9\u5668  `docker attach containername `  (\u6b64\u5bb9\u5668\u9700\u8981\u5728\u8fd0\u884c)\n- \u8fdb\u5165\u5bb9\u5668  `docker exec -it containername bash/csh`\n- \u9000\u51fa\u5bb9\u5668 'ctrl+q+p'\uff08\u53ef\u4ee5\u4e0d\u7ed3\u675f\u5bb9\u5668\u9000\u51fa\uff09\n- \u67e5\u770b\u5bb9\u5668 `docker ps -a`\n> **STATUS** \u6307\u4ee3\u5bb9\u5668\u8fd0\u884c\u72b6\u6001  **Created** \u610f\u6307\u521b\u5efa\u5c1a\u672a\u542f\u52a8\u8fc7\uff1b**Up \\[ Time \\]**\u8868\u793a\u8fd0\u884c\u4e2d\uff0ctime\u8868\u8fd0\u884c\u65f6\u95f4\uff1b**Exited (\\[ Code \\]) \\[ Time \\]** \u8868\u793a\u8fd0\u884c\u7ed3\u675f\uff0ccode\u7ed3\u675f\u7801\uff0ctime\u7ed3\u675f\u5230\u73b0\u5728\u65f6\u95f4\n\n- \u505c\u6b62\u5bb9\u5668  `docker stop nginx`\n- \u5220\u9664\u5bb9\u5668 ` docker rm nginx`\n- \u8fdb\u5165\u5bb9\u5668 `sudo docker exec nginx more /etc/hostname`\n- \u8fdb\u5165\u5bb9\u5668\u4f2a\u7ec8\u7aef `docker container exec -it containername bash/csh/sh`\n### \u67e5\u770b\u5bb9\u5668\u72b6\u6001\n- \u65e5\u5fd7 `docker logs containerid`\n- pid `docker top containerid`\n\n### \u5bf9\u5bb9\u5668\u8fdb\u884c\u76f4\u63a5\u64cd\u4f5c\n`docker exec 04 cat /usr/share/nginx/html/index.html` \u67e5\u770b\u6587\u4ef6\u5939\n> \u53ea\u8bfb\u4e0d\u53ef\u5199\uff1avi touch\u7b49\u64cd\u4f5c\u65e0\u6548\u679c\n`docker exec -it 04 sh ` \u8fdb\u5165\u5bb9\u5668\n\n### \u66f4\u65b0\u5bb9\u5668\u914d\u7f6e\n1.  `docker container update --restart=always containername`\n2.  \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff081.\u6682\u505c\u5bb9\u56682.\u66f4\u6539\u914d\u7f6e\u6587\u4ef6\uff08/var/lib/docker/containers/\u5bb9\u5668id\uff09\uff09hostconfig.json\n\n\n## \u6570\u636e\u5377volume\n> \u9ed8\u8ba4\u8def\u5f84 `/var/lib/docker/volumes/\n`\n##### \u4e09\u79cd\u6302\u8f7d\u65b9\u5f0f\uff1aTmpfs Mount\uff1a\u5bb9\u5668\u5220\u9664\u6570\u636e\u6d88\u5931\uff1bvolume\uff1a\u5728\u9ed8\u8ba4\u8def\u5f84\u4e0b\u7684\u6570\u636e\u5377\u6302\u8f7d\uff08\u63a8\u8350\uff09\uff1b\u6587\u4ef6\u76ee\u5f55\u6302\u8f7d\uff1a\u7edd\u5bf9\u8def\u5f84\u6302\u8f7d\n- \u521b\u5efa create\n- \u4fe1\u606f inspect\n- \u5217\u8868 ls\n- \u6e05\u9664\u672a\u4f7f\u7528 prume\n- \u5220\u9664 rm\n### \u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377\n`docker volume create nginxv`\n### \u5f00\u542f\u4e00\u4e2a\u6302\u8f7d\u6570\u636e\u5377\u7684nginx\n`docker run -itd --name nginx -p 88:80 --mount src=nginx,dst=/usr/share/nginx/html  nginx`\n\u6548\u679c\u548c\u4e0b\u76f8\u540c\uff1a\n`docker run -itd --name nginx -p 88:80 -v nginx:/usr/share/nginx/html heping945/nginx1.17`\n> \u5728\u7edd\u5bf9\u8def\u5f84\u4e0b\u6302\u8f7d\uff08\u4f1a\u5728\u6839\u76ee\u5f55\u4e0b\u521b\u5efa/webapp/html\u4e0b\u6302\u8f7d\uff09:\u6587\u4ef6\u6302\u8f7d\u975e\u6570\u636e\u5377\n`docker run -d --name nginx -v /webapp/html:/usr/share/nginx/html nginx`\n> ==\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u505a\u6587\u4ef6\u6620\u5c04\u65f6\uff0c\u672c\u5730\u76ee\u5f55\u9700\u8981\u6709\u76f8\u5173\u6587\u4ef6\uff0c\u5982nginx\u7684\u6620\u5c04/var/share/nginx/html \u76ee\u5f55\u4e0b\u7684index.html\u9700\u8981\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u5b58\u5728==\n`docker run -itd --name nginxx -p 88:80 -v /home/zhp/ng:/usr/share/nginx/html fc1d`\n### windows \u4e0a\u7684\u76ee\u5f55\u6302\u8f7d\n`docker run -itd --name nginx -p 90:80 -v /f/dockerdir/nginx/:/usr/share/nginx/html fc1d`\ndocker-desktop\u8981\u8bbe\u7f6e\u5171\u4eab\u76d8\uff0c\u7136\u540e\u53ef\u4ee5/\u5171\u4eab\u76d8/\u76ee\u5f55\u6302\u8f7d\n### \u5f00\u542f\u4e00\u4e2amysql\n`docker run -itd --name blogmysql --mount src=mysqlv,dst=/var/lib/mysql -e MYSQL_ROOT_PASSWORD=setpassword mysql --character-set-server=utf8`\n> \u8bbe\u7f6e\u4e86mysql\u5bc6\u7801\uff0c\u8bbe\u7f6e\u4e86\u6570\u636e\u5377\uff0c\u8bbe\u7f6e\u4e86\u5b57\u7b26\u96c6\n\n## Dockerfile\n![dockerfile.png](http://zhaoheping.com/media/postserver/img/20200323192405-267.png)\n\n- FROM\uff1a\u57fa\u7840\u955c\u50cf\uff0c\u5f53\u524d\u65b0\u955c\u50cf\u662f\u57fa\u4e8e\u54ea\u4e2a\u955c\u50cf\u7684\n\n- MAINTAINER\uff1a\u955c\u50cf\u7ef4\u62a4\u8005\u7684\u59d3\u540d\u548c\u90ae\u7bb1\u5730\u5740\n\n- RUN\uff1a\u5bb9\u5668\u6784\u5efa\u65f6\u9700\u8981\u8fd0\u884c\u7684\u547d\u4ee4\n\n- EXPOSE\uff1a\u5f53\u524d\u5bb9\u5668\u5bf9\u5916\u66b4\u9732\u51fa\u7684\u7aef\u53e3\n\n- WORKDIR\uff1a\u6307\u5b9a\u5728\u521b\u5efa\u5bb9\u5668\u540e\uff0c\u7ec8\u7aef\u9ed8\u8ba4\u767b\u9646\u7684\u8fdb\u6765\u5de5\u4f5c\u76ee\u5f55\uff0c\u4e00\u4e2a\u843d\u811a\u70b9\n\n- ENV\uff1a\u7528\u6765\u5728\u6784\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\n\n- ADD\uff1a\u5c06\u5bbf\u4e3b\u673a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u62f7\u8d1d\u8fdb\u955c\u50cf\u4e14 ADD \u547d\u4ee4\u4f1a\u81ea\u52a8\u5904\u7406 URL \u548c\u89e3\u538b tar \u538b\u7f29\u5305\n\n- COPY\uff1a\u7c7b\u4f3c ADD\uff0c\u62f7\u8d1d\u6587\u4ef6\u548c\u76ee\u5f55\u5230\u955c\u50cf\u4e2d\u3002\uff08COPY src dest \u6216 COPY [\"src\",\"dest\"]\uff09\n\n- VOLUME\uff1a\u5bb9\u5668\u6570\u636e\u5377\uff0c\u7528\u4e8e\u6570\u636e\u4fdd\u5b58\u548c\u6301\u4e45\u5316\u5de5\u4f5c\n\n- CMD\uff1a\u6307\u5b9a\u4e00\u4e2a\u5bb9\u5668\u542f\u52a8\u65f6\u8981\u8fd0\u884c\u7684\u547d\u4ee4\uff0cDockerfile \u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a CMD \u6307\u4ee4\uff0c\u4f46\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u751f\u6548\uff0cCMD \u4f1a\u88ab docker run \u4e4b\u540e\u7684\u53c2\u6570\u66ff\u6362\n\n- ENTRYPOINT\uff1a\u6307\u5b9a\u4e00\u4e2a\u5bb9\u5668\u542f\u52a8\u65f6\u8981\u8fd0\u884c\u7684\u547d\u4ee4\uff0cENTRYPOINT \u7684\u76ee\u7684\u548c CMD \u4e00\u6837\uff0c\u90fd\u662f\u5728\u6307\u5b9a\u5bb9\u5668\u542f\u52a8\u7a0b\u5e8f\u53ca\u53c2\u6570\n\n- ONBUILD\uff1a\u5f53\u6784\u5efa\u4e00\u4e2a\u88ab\u7ee7\u627f\u7684 Dockerfile \u65f6\u8fd0\u884c\u547d\u4ee4\uff0c\u7236\u955c\u50cf\u5728\u88ab\u5b50\u7ee7\u627f\u540e\u7236\u955c\u50cf\u7684 onbuild \u88ab\u89e6\u53d1\n\n### \u6784\u5efa\n\n`docker build -f mydockerfile -t blog:v1 .`\n- -f  Dockerfile\u8def\u5f84\n- -t  \u5bb9\u5668\u540d\u79f0\u53ef\u5e26\u7248\u672c\n- .   \u8def\u5f84", "excerpt": "\u5b89\u88c5\nyum install -y yum-utils \\ device-mapper-persistent-data \\ lvm2\n\n\u5b89\u88c5\u652f\u6301\u5426\u5219\u4f1a\u5b89\u88c5\u65e7\u7248\u672c\n\nyum install docker\n\u8bbe\u7f6e\u4e0b\u8f7d\u6e90\nvim /etc/docker/daemon.json\n{\n    \"registry", "codestyle": "atelier-plateau-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-22T11:57:38.157", "mod_date": "2020-03-31T17:59:12.544", "views_count": 136, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [13]}}, {"model": "blog.post", "pk": 24, "fields": {"title": "Docker\u955c\u50cf\u5236\u4f5c\u548c\u4f7f\u7528\u4e0edocker-compose", "body": "<blockquote>\n<p>docker\u62c9\u53d6\u4e00\u4e2acentos\u57fa\u672c\u7248\u955c\u50cf\u65f6\uff0c\u53d1\u73b0\u5f88\u591a\u547d\u4ee4\u6ca1\u6709\uff0c\u6240\u4ee5\u4ece\u5934\u5f00\u59cb\u90e8\u7f72\u8fd0\u884c\u73af\u5883</p>\n</blockquote>\n<h2><a id=\"rpm_1\"></a>rpm</h2>\n<pre><code class=\"lang-\">rpm -ivh name.rpm ##\u5b89\u88c5\u8f6f\u4ef6 -v\u663e\u793a\u8fc7\u7a0b -h\u6307\u5b9a\u52a0\u5bc6\u65b9\u5f0f\u4e3ahash\nrpm -e name ##\u5378\u8f7d\u8f6f\u4ef6\nrpm -ql name ##\u67e5\u770b\u8f6f\u4ef6\u751f\u6210\u7684\u6587\u4ef6\nrpm -qlp name.rpm ##\u67e5\u8be2\u8f6f\u4ef6\u5b89\u88c5\u540e\u4f1a\u751f\u6210\u4ec0\u4e48\u6587\u4ef6\nrpm -qa |grep wps //\u8fc7\u6ee4\u6389wps\nrpm -pq name.rpm ##\u67e5\u8be2\u8f6f\u4ef6\u5305\u5b89\u88c5\u540e\u7684\u540d\u5b57\nrpm -ivh name.rpm --force ##\u5f3a\u5236\u5b89\u88c5\uff0c\u4f46\u662f\u4e0d\u80fd\u5ffd\u7565\u4f9d\u8d56\u6027\nrpm -ivh name.rpm --nodeps ##\u5ffd\u7565\u8f6f\u4ef6\u7684\u4f9d\u8d56\u6027\u5e76\u4e14\u5f3a\u5236\u5b89\u88c5\nrpm -qi name ##\u67e5\u770b\u8f6f\u4ef6\u7684\u4fe1\u606f\nrpm -qp name.rpm --scripts ##\u68c0\u6d4b\u8f6f\u4ef6\u5728\u5b89\u88c5\u6216\u5378\u8f7d\u8fc7\u7a0b\u4e2d\u6267\u884c\u7684\u52a8\u4f5c\n</code></pre>\n<h2><a id=\"_15\"></a>\u62f7\u8d1d\u672c\u5730\u6587\u4ef6\u5230\u5bb9\u5668</h2>\n<ol>\n<li><code>docker ps -a</code> \u83b7\u5f97containername</li>\n<li><code>docker inspect -f '{{.ID}}' containername</code>\u83b7\u5f97\u5bb9\u5668\u957fid</li>\n<li><code>docker cp D:\\ChromeDownloads\\yum-metadata-parser-1.1.4-10.el7.x86_64.rpm 6d7319d80a5321bd48ddfe2c3c847c77a12c43d7e0707d65a591892f7f363787:/download</code> \u62f7\u8d1d\u672c\u5730\u6587\u4ef6\u8def\u5f84\u5230\u5bb9\u5668id:\u8def\u5f84</li>\n</ol>\n<h2><a id=\"_20\"></a>\u62c9\u53d6\u57fa\u7840\u955c\u50cf</h2>\n<p>\u627e\u4e86\u5f88\u4e45\uff0c\u7ec8\u4e8e\u627e\u5230\u4e00\u4e2a\u652f\u6301pillow\u7684\u955c\u50cf\uff0c\u800c\u4e14\u8fd8\u662falpine-centos\u7248\u672c\u7684\uff0c\u5566\u5566\u5566\u3002<br />\n<code>docker pull lgatica/python-alpine</code><br />\n\u76f4\u63a5\u6700\u65b0\u7248\uff0c\u867d\u7136python\u7248\u672c\u6709\u70b9\u8001\uff0c\u4f46\u662f\u591f\u4e86\u9996\u5148\u5347\u7ea7pip</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\">pip install --upgrade pip -i https://pypi.douban.com/simple\n</code></div></pre>\n<p>\u5b89\u88c5pipenv</p>\n<pre><div class=\"hljs\"><code class=\"lang-py\">pip install pipenv -i https://pypi.douban.com/simple\n</code></div></pre>\n<h2><a id=\"apk_33\"></a>\u4f7f\u7528apk\u5b89\u88c5</h2>\n<pre><code class=\"lang-\">vi etc/apk/repositories # \u4fee\u6539\u4e0b\u8f7d\u6e90\n# \u66ff\u6362\u6210\u963f\u91cc\u6e90\nhttp://mirrors.aliyun.com/alpine/v3.8/main/\nhttp://mirrors.aliyun.com/alpine/v3.8/community/\n# \u5b89\u88c5git\napk add git\n</code></pre>\n<h2><a id=\"push_43\"></a>\u5236\u4f5c\u955c\u50cf\u5e76push</h2>\n<h3><a id=\"commit_44\"></a>commit</h3>\n<p><code>docker commit -m 'second commit' -a 'pinge' c6 heping945/py-git</code></p>\n<ul>\n<li>commit \u63d0\u4ea4</li>\n<li>-m \u7c7b\u4f3cgit commit\u4fe1\u606f</li>\n<li>-a \u4f5c\u8005</li>\n<li>c6  container-id</li>\n<li>heping945/py-git    docker\u7528\u6237\u540d/\u955c\u50cf\u4ed3\u5e93\u540d\u79f0\uff0c\u5176\u4e2dtag\u9ed8\u8ba4\u4e3alatest</li>\n<li>heping945/py-git:v1    docker\u7528\u6237\u540d/\u955c\u50cf\u4ed3\u5e93\u540d\u79f0:\u7248\u672cv1</li>\n</ul>\n<h3><a id=\"_53\"></a>\u955c\u50cf\u91cd\u547d\u540d</h3>\n<p>docker  tag  \u955c\u50cfid  \u4ed3\u5e93\uff1a\u6807\u7b7e<br />\n<code>docker tag image_id heping945/nginx</code></p>\n<h3><a id=\"push_57\"></a>push</h3>\n<p><code>docker push heping945/py-git</code></p>\n<h2><a id=\"WindowsDesktop_62\"></a>\u4f7f\u7528WindowsDesktop</h2>\n<h3><a id=\"_63\"></a>\u5b89\u88c5</h3>\n<blockquote>\n<p>DockerDesktop\u5728win10\u5bb6\u5ead\u7248\u5b89\u88c5\u9700\u8981\u5f00\u542fHyper-V,\u540c\u65f6\u9700\u8981\u5bb9\u5668\u652f\u6301</p>\n</blockquote>\n<pre><div class=\"hljs\"><code class=\"lang-bat\"># docker.bat\n<span class=\"hljs-built_in\">pushd</span> \"%~dp0\"\n<span class=\"hljs-built_in\">dir</span> /b <span class=\"hljs-variable\">%SystemRoot%</span>\\servicing\\Packages\\*containers*.mum &gt;containers.txt\n<span class=\"hljs-keyword\">for</span> /f <span class=\"hljs-variable\">%%i</span> <span class=\"hljs-keyword\">in</span> ('<span class=\"hljs-built_in\">findstr</span> /i . containers.txt <span class=\"hljs-number\">2</span>^&gt;<span class=\"hljs-built_in\">nul</span>') <span class=\"hljs-keyword\">do</span> dism /online /norestart /add-package:\"<span class=\"hljs-variable\">%SystemRoot%</span>\\servicing\\Packages\\<span class=\"hljs-variable\">%%i</span>\"\n<span class=\"hljs-built_in\">del</span> containers.txt\nDism /online /enable-feature /featurename:Containers -All /LimitAccess /ALL\n<span class=\"hljs-built_in\">pause</span>\n</code></div></pre>\n<p>\u7ba1\u7406\u5458\u6a21\u5f0f\u8fd0\u884c\uff0c\u9700\u8981\u5f88\u957f\u65f6\u95f4\u5b89\u88c5\uff0c\u7ed3\u675f\u4f1a\u63d0\u793a\u91cd\u542f\uff0c\u7136\u540e\u91cd\u542f\u8fdb\u884cDockerDesktop\u5b89\u88c5</p>\n<h3><a id=\"docker_76\"></a>\u767b\u5f55docker</h3>\n<p><code>docker login</code>\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u6210\u529f\u63d0\u793aLogin Succeeded\uff0c\u5f80\u540e\u53ef\u4ee5\u672c\u5730\u63d0\u4ea4\u955c\u50cf</p>\n<h2><a id=\"_79\"></a>\u955c\u50cf\u8fc1\u79fb</h2>\n<p><code>docker save -o ./py-git.tar heping945/py-git</code></p>\n<blockquote>\n<p>\u6253\u5305\u6210.tar\u6587\u4ef6</p>\n</blockquote>\n<h2><a id=\"_82\"></a>\u955c\u50cf\u8f7d\u5165</h2>\n<p><code>docker load -i py-git.tar</code></p>\n<blockquote>\n<p>\u8f7d\u5165\u6210\u955c\u50cf</p>\n</blockquote>\n<h2><a id=\"link_86\"></a>link</h2>\n<p>\u5f53\u4f7f\u7528web\u9879\u76ee\u65f6\uff0c\u57fa\u672c\u4e0a\u90fd\u4f1a\u8fde\u63a5redis\uff0cmysql\u6570\u636e\u5e93\u7b49\uff0c\u7531\u4e8e\u5bb9\u5668\u5316\uff0chost\u548cport\u90fd\u4f1a\u4e0d\u540c\uff0c\u6240\u4ee5\u9700\u8981\u81ea\u5df1\u8bbe\u7f6e</p>\n<h3><a id=\"inspecthost_90\"></a>\u901a\u8fc7inspect\u83b7\u5f97host</h3>\n<ul>\n<li>`docker inspect -f \u2018{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\u2019 containerid``</li>\n</ul>\n<blockquote>\n<p>\u83b7\u5f97redis/mysql\u7684\u66b4\u9732host\uff0c\u7136\u540e\u5728\u9879\u76ee\u91cc\u7684host\u91cc\u8bbe\u7f6e</p>\n</blockquote>\n<h3><a id=\"link_95\"></a>link\u522b\u540d\u8fde\u63a5</h3>\n<ul>\n<li><code>docker run -itd --name py2 --link redis:redis heping945/python36</code></li>\n</ul>\n<blockquote>\n<p>\u2013link redis:redis \u7b2c\u4e00\u4e2aredis\u662f\u53e6\u5916\u5bb9\u5668\u7684\u522b\u540d\uff08\u2013name\uff09\u7b2c\u4e8c\u4e2aredis\u662f\u9879\u76ee\u91cc\u5f15\u5165\u7684host\u7684\u522b\u540d:<br />\n<code>conn = StrictRedis(host='redis')</code></p>\n</blockquote>\n<h2><a id=\"dockercompose_101\"></a>docker-compose</h2>\n<ul>\n<li>\n<p>docker-compose ps \u67e5\u770b\u5f53\u524d\u6709\u54ea\u4e9b\u5bb9\u5668\uff08docker-compose.yml \u6240\u5728\u6587\u4ef6\u5939\u4e0b\u6267\u884c\uff09</p>\n</li>\n<li>\n<p>docker-compose config\u00a0 -q\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u9a8c\u8bc1\uff08docker-compose.yml\uff09\u6587\u4ef6\u914d\u7f6e\uff0c\u5f53\u914d\u7f6e\u6b63\u786e\u65f6\uff0c\u4e0d\u8f93\u51fa\u4efb\u4f55\u5185\u5bb9\uff0c\u5f53\u6587\u4ef6\u914d\u7f6e\u9519\u8bef\uff0c\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\u3002</p>\n</li>\n<li>\n<p>docker-compose restart nginx\u00a0 \u91cd\u65b0\u542f\u52a8nginx\u670d\u52a1\u7684\u5bb9\u5668\uff08\u6ce8\u610f\u662f \u7f16\u6392\u6587\u4ef6\u4e2d\u7684service\uff09</p>\n</li>\n<li>\n<p>docker-compose logs nginx\u00a0 \u00a0 \u67e5\u770bnginx\u7684\u65e5\u5fd7</p>\n</li>\n<li>\n<p>docker-compose logs -f nginx\u00a0 \u00a0 \u00a0 \u67e5\u770bnginx\u7684\u5b9e\u65f6\u65e5\u5fd7</p>\n</li>\n<li>\n<p>docker-compose up\u00a0      \u8fd0\u884c(-d \u540e\u53f0)</p>\n</li>\n<li>\n<p>docker-compose down    \u505c\u6b62\u5e76\u5220\u9664</p>\n</li>\n<li>\n<p>docker-compose exec nginx bash\u00a0 \u8fdb\u5165nginx\u670d\u52a1\u4e0b\u5bb9\u5668</p>\n</li>\n<li>\n<p>docker-compose exec --index=1 nginx bash\u00a0\u8fdb\u5165nginx\u670d\u52a1\u4e0b\u5bb9\u5668 \u591a\u53f0 \u9700\u8981\u52a0\u53c2\u6570\u00a0--index=xxx</p>\n</li>\n</ul>\n<blockquote>\n<p>\u4ee5\u4e0aup/build/down\u90fd\u662f\u9ed8\u8ba4\u5728docker-compose.yml\u6587\u4ef6\u76ee\u5f55\u4e0b\u8fd0\u884c\uff0c\u5176\u4ed6\u540d\u79f0.yml\u6587\u4ef6\u9700\u8981<code>-f xxx.yml</code>\u6307\u793a</p>\n</blockquote>", "body_md": "> docker\u62c9\u53d6\u4e00\u4e2acentos\u57fa\u672c\u7248\u955c\u50cf\u65f6\uff0c\u53d1\u73b0\u5f88\u591a\u547d\u4ee4\u6ca1\u6709\uff0c\u6240\u4ee5\u4ece\u5934\u5f00\u59cb\u90e8\u7f72\u8fd0\u884c\u73af\u5883\n## rpm\n```\nrpm -ivh name.rpm ##\u5b89\u88c5\u8f6f\u4ef6 -v\u663e\u793a\u8fc7\u7a0b -h\u6307\u5b9a\u52a0\u5bc6\u65b9\u5f0f\u4e3ahash\nrpm -e name ##\u5378\u8f7d\u8f6f\u4ef6\nrpm -ql name ##\u67e5\u770b\u8f6f\u4ef6\u751f\u6210\u7684\u6587\u4ef6\nrpm -qlp name.rpm ##\u67e5\u8be2\u8f6f\u4ef6\u5b89\u88c5\u540e\u4f1a\u751f\u6210\u4ec0\u4e48\u6587\u4ef6\nrpm -qa |grep wps //\u8fc7\u6ee4\u6389wps\nrpm -pq name.rpm ##\u67e5\u8be2\u8f6f\u4ef6\u5305\u5b89\u88c5\u540e\u7684\u540d\u5b57\nrpm -ivh name.rpm --force ##\u5f3a\u5236\u5b89\u88c5\uff0c\u4f46\u662f\u4e0d\u80fd\u5ffd\u7565\u4f9d\u8d56\u6027\nrpm -ivh name.rpm --nodeps ##\u5ffd\u7565\u8f6f\u4ef6\u7684\u4f9d\u8d56\u6027\u5e76\u4e14\u5f3a\u5236\u5b89\u88c5\nrpm -qi name ##\u67e5\u770b\u8f6f\u4ef6\u7684\u4fe1\u606f\nrpm -qp name.rpm --scripts ##\u68c0\u6d4b\u8f6f\u4ef6\u5728\u5b89\u88c5\u6216\u5378\u8f7d\u8fc7\u7a0b\u4e2d\u6267\u884c\u7684\u52a8\u4f5c\n```\n\n## \u62f7\u8d1d\u672c\u5730\u6587\u4ef6\u5230\u5bb9\u5668\n1. `docker ps -a` \u83b7\u5f97containername\n2. `docker inspect -f '{{.ID}}' containername`\u83b7\u5f97\u5bb9\u5668\u957fid\n3. `docker cp D:\\ChromeDownloads\\yum-metadata-parser-1.1.4-10.el7.x86_64.rpm 6d7319d80a5321bd48ddfe2c3c847c77a12c43d7e0707d65a591892f7f363787:/download` \u62f7\u8d1d\u672c\u5730\u6587\u4ef6\u8def\u5f84\u5230\u5bb9\u5668id:\u8def\u5f84\n\n## \u62c9\u53d6\u57fa\u7840\u955c\u50cf\n\u627e\u4e86\u5f88\u4e45\uff0c\u7ec8\u4e8e\u627e\u5230\u4e00\u4e2a\u652f\u6301pillow\u7684\u955c\u50cf\uff0c\u800c\u4e14\u8fd8\u662falpine-centos\u7248\u672c\u7684\uff0c\u5566\u5566\u5566\u3002\n`docker pull lgatica/python-alpine\n`\n\u76f4\u63a5\u6700\u65b0\u7248\uff0c\u867d\u7136python\u7248\u672c\u6709\u70b9\u8001\uff0c\u4f46\u662f\u591f\u4e86\u9996\u5148\u5347\u7ea7pip\n``` py\npip install --upgrade pip -i https://pypi.douban.com/simple\n```\n\u5b89\u88c5pipenv\n``` py\npip install pipenv -i https://pypi.douban.com/simple\n```\n\n## \u4f7f\u7528apk\u5b89\u88c5\n```\nvi etc/apk/repositories # \u4fee\u6539\u4e0b\u8f7d\u6e90\n# \u66ff\u6362\u6210\u963f\u91cc\u6e90\nhttp://mirrors.aliyun.com/alpine/v3.8/main/\nhttp://mirrors.aliyun.com/alpine/v3.8/community/\n# \u5b89\u88c5git\napk add git\n```\n\n## \u5236\u4f5c\u955c\u50cf\u5e76push\n### commit\n`docker commit -m 'second commit' -a 'pinge' c6 heping945/py-git`\n- commit \u63d0\u4ea4\n- -m \u7c7b\u4f3cgit commit\u4fe1\u606f\n- -a \u4f5c\u8005\n- c6  container-id\n- heping945/py-git    docker\u7528\u6237\u540d/\u955c\u50cf\u4ed3\u5e93\u540d\u79f0\uff0c\u5176\u4e2dtag\u9ed8\u8ba4\u4e3alatest\n- heping945/py-git:v1    docker\u7528\u6237\u540d/\u955c\u50cf\u4ed3\u5e93\u540d\u79f0:\u7248\u672cv1\n\n### \u955c\u50cf\u91cd\u547d\u540d\ndocker  tag  \u955c\u50cfid  \u4ed3\u5e93\uff1a\u6807\u7b7e\n`docker tag image_id heping945/nginx`\n\n### push\n`docker push heping945/py-git`\n\n\n\n## \u4f7f\u7528WindowsDesktop\n### \u5b89\u88c5\n> DockerDesktop\u5728win10\u5bb6\u5ead\u7248\u5b89\u88c5\u9700\u8981\u5f00\u542fHyper-V,\u540c\u65f6\u9700\u8981\u5bb9\u5668\u652f\u6301\n```bat\n# docker.bat\npushd \"%~dp0\"\ndir /b %SystemRoot%\\servicing\\Packages\\*containers*.mum >containers.txt\nfor /f %%i in ('findstr /i . containers.txt 2^>nul') do dism /online /norestart /add-package:\"%SystemRoot%\\servicing\\Packages\\%%i\"\ndel containers.txt\nDism /online /enable-feature /featurename:Containers -All /LimitAccess /ALL\npause\n```\n\u7ba1\u7406\u5458\u6a21\u5f0f\u8fd0\u884c\uff0c\u9700\u8981\u5f88\u957f\u65f6\u95f4\u5b89\u88c5\uff0c\u7ed3\u675f\u4f1a\u63d0\u793a\u91cd\u542f\uff0c\u7136\u540e\u91cd\u542f\u8fdb\u884cDockerDesktop\u5b89\u88c5\n\n### \u767b\u5f55docker\n`docker login`\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u6210\u529f\u63d0\u793aLogin Succeeded\uff0c\u5f80\u540e\u53ef\u4ee5\u672c\u5730\u63d0\u4ea4\u955c\u50cf\n\n## \u955c\u50cf\u8fc1\u79fb\n`docker save -o ./py-git.tar  heping945/py-git`\n> \u6253\u5305\u6210.tar\u6587\u4ef6\n## \u955c\u50cf\u8f7d\u5165\n`docker load -i py-git.tar`\n> \u8f7d\u5165\u6210\u955c\u50cf\n\n## link\n\n\u5f53\u4f7f\u7528web\u9879\u76ee\u65f6\uff0c\u57fa\u672c\u4e0a\u90fd\u4f1a\u8fde\u63a5redis\uff0cmysql\u6570\u636e\u5e93\u7b49\uff0c\u7531\u4e8e\u5bb9\u5668\u5316\uff0chost\u548cport\u90fd\u4f1a\u4e0d\u540c\uff0c\u6240\u4ee5\u9700\u8981\u81ea\u5df1\u8bbe\u7f6e\n\n### \u901a\u8fc7inspect\u83b7\u5f97host\n\n- `docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' containerid``\n> \u83b7\u5f97redis/mysql\u7684\u66b4\u9732host\uff0c\u7136\u540e\u5728\u9879\u76ee\u91cc\u7684host\u91cc\u8bbe\u7f6e\n\n### link\u522b\u540d\u8fde\u63a5\n- `docker run -itd --name py2 --link redis:redis heping945/python36`\n> --link redis:redis \u7b2c\u4e00\u4e2aredis\u662f\u53e6\u5916\u5bb9\u5668\u7684\u522b\u540d\uff08--name\uff09\u7b2c\u4e8c\u4e2aredis\u662f\u9879\u76ee\u91cc\u5f15\u5165\u7684host\u7684\u522b\u540d:\n `conn = StrictRedis(host='redis')`\n\n\n## docker-compose\n\n- docker-compose ps \u67e5\u770b\u5f53\u524d\u6709\u54ea\u4e9b\u5bb9\u5668\uff08docker-compose.yml \u6240\u5728\u6587\u4ef6\u5939\u4e0b\u6267\u884c\uff09\n\n- docker-compose config\u00a0 -q\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u9a8c\u8bc1\uff08docker-compose.yml\uff09\u6587\u4ef6\u914d\u7f6e\uff0c\u5f53\u914d\u7f6e\u6b63\u786e\u65f6\uff0c\u4e0d\u8f93\u51fa\u4efb\u4f55\u5185\u5bb9\uff0c\u5f53\u6587\u4ef6\u914d\u7f6e\u9519\u8bef\uff0c\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\u3002\n\n- docker-compose restart nginx\u00a0 \u91cd\u65b0\u542f\u52a8nginx\u670d\u52a1\u7684\u5bb9\u5668\uff08\u6ce8\u610f\u662f \u7f16\u6392\u6587\u4ef6\u4e2d\u7684service\uff09\n\n- docker-compose logs nginx\u00a0 \u00a0 \u67e5\u770bnginx\u7684\u65e5\u5fd7\u00a0\n\n- docker-compose logs -f nginx\u00a0 \u00a0 \u00a0 \u67e5\u770bnginx\u7684\u5b9e\u65f6\u65e5\u5fd7\n\n- docker-compose up\u00a0      \u8fd0\u884c(-d \u540e\u53f0)\n\n- docker-compose down    \u505c\u6b62\u5e76\u5220\u9664\n\n- docker-compose exec nginx bash\u00a0 \u8fdb\u5165nginx\u670d\u52a1\u4e0b\u5bb9\u5668\n\n- docker-compose exec --index=1 nginx bash\u00a0\u8fdb\u5165nginx\u670d\u52a1\u4e0b\u5bb9\u5668 \u591a\u53f0 \u9700\u8981\u52a0\u53c2\u6570\u00a0--index=xxx\n> \u4ee5\u4e0aup/build/down\u90fd\u662f\u9ed8\u8ba4\u5728docker-compose.yml\u6587\u4ef6\u76ee\u5f55\u4e0b\u8fd0\u884c\uff0c\u5176\u4ed6\u540d\u79f0.yml\u6587\u4ef6\u9700\u8981`-f xxx.yml`\u6307\u793a", "excerpt": "\ndocker\u62c9\u53d6\u4e00\u4e2acentos\u57fa\u672c\u7248\u955c\u50cf\u65f6\uff0c\u53d1\u73b0\u5f88\u591a\u547d\u4ee4\u6ca1\u6709\uff0c\u6240\u4ee5\u4ece\u5934\u5f00\u59cb\u90e8\u7f72\u8fd0\u884c\u73af\u5883\n\nrpm\nrpm -ivh name.rpm ##\u5b89\u88c5\u8f6f\u4ef6 -v\u663e\u793a\u8fc7\u7a0b -h\u6307\u5b9a\u52a0\u5bc6\u65b9\u5f0f\u4e3ahash\nrpm -e name ##\u5378\u8f7d\u8f6f\u4ef6\nrpm -ql name ##\u67e5\u770b\u8f6f\u4ef6\u751f\u6210\u7684\u6587\u4ef6\nrpm -qlp ", "codestyle": "monokai", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-24T15:18:24.129", "mod_date": "2020-04-03T18:22:32.746", "views_count": 111, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [13]}}, {"model": "blog.post", "pk": 26, "fields": {"title": "Docker\u9879\u76ee\u6784\u5efa", "body": "<h2><a id=\"Docker_0\"></a>Docker\u955c\u50cf\u9009\u62e9</h2>\n<ul>\n<li>nginx : <a href=\"https://hub.docker.com/repository/docker/heping945/nginx\" target=\"_blank\">heping945/nginx</a></li>\n<li>python: <a href=\"https://hub.docker.com/repository/docker/heping945/python36/general\" target=\"_blank\">heping945/python36</a></li>\n<li>redis: <a href=\"https://hub.docker.com/repository/docker/heping945/nginx\" target=\"_blank\">heping945/nginx</a></li>\n<li>mysql</li>\n</ul>\n<h2><a id=\"_6\"></a>\u4f7f\u7528\u963f\u91cc\u4e91\u5bb9\u5668\u955c\u50cf\u670d\u52a1</h2>\n<ul>\n<li>login\uff1a<code>docker login --username=602013597@qq.com registry.cn-hangzhou.aliyuncs.com</code></li>\n<li>tag:<code>docker tag fc1d34a69a5d registry.cn-hangzhou.aliyuncs.com/pinge945/nginx</code></li>\n</ul>\n<blockquote>\n<p>\u5176\u4e2d fc1d34a69a5d \u662fimage_id nginx \u662fimagename:image:tag</p>\n</blockquote>\n<ul>\n<li>push:<code>docker push registry.cn-hangzhou.aliyuncs.com/pinge945/nginx</code></li>\n<li>pull:<code>docker pull registry.cn-hangzhou.aliyuncs.com/pinge945/nginx</code></li>\n</ul>\n<h2><a id=\"django_13\"></a>\u542f\u52a8\u4e00\u4e2a\u6700\u7b80\u5355\u7684django\u9879\u76ee</h2>", "body_md": "## Docker\u955c\u50cf\u9009\u62e9\n- nginx : [heping945/nginx](https://hub.docker.com/repository/docker/heping945/nginx)\n- python: [heping945/python36](https://hub.docker.com/repository/docker/heping945/python36/general)\n- redis: [heping945/nginx](https://hub.docker.com/repository/docker/heping945/nginx)\n- mysql\n\n## \u4f7f\u7528\u963f\u91cc\u4e91\u5bb9\u5668\u955c\u50cf\u670d\u52a1\n- login\uff1a`docker login --username=602013597@qq.com registry.cn-hangzhou.aliyuncs.com`\n- tag:` docker tag fc1d34a69a5d registry.cn-hangzhou.aliyuncs.com/pinge945/nginx`\n> \u5176\u4e2d fc1d34a69a5d \u662fimage_id nginx \u662fimagename:image:tag\n- push:`docker push registry.cn-hangzhou.aliyuncs.com/pinge945/nginx`\n- pull:`docker pull registry.cn-hangzhou.aliyuncs.com/pinge945/nginx`\n\n## \u542f\u52a8\u4e00\u4e2a\u6700\u7b80\u5355\u7684django\u9879\u76ee", "excerpt": "Docker\u955c\u50cf\u9009\u62e9\n\nnginx : heping945/nginx\npython: heping945/python36\nredis: heping945/nginx\nmysql\n\n\u4f7f\u7528\u963f\u91cc\u4e91\u5bb9\u5668\u955c\u50cf\u670d\u52a1\n\nlogin\uff1adocker login --username=602013597@qq.c", "codestyle": "monokai", "reproduce": false, "reproduce_source": null, "create_date": "2020-03-31T00:32:50.369", "mod_date": "2020-04-01T14:40:57.338", "views_count": 60, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 6, "tags": [13]}}, {"model": "blog.post", "pk": 27, "fields": {"title": "python\u9b54\u6cd5\u65b9\u6cd5", "body": "<h1><a id=\"_0\"></a>\u5e38\u7528\u9b54\u672f\u65b9\u6cd5</h1>\n<hr />\n<blockquote>\n<p>\u9b54\u672f\u65b9\u6cd5\u5c31\u662f\u4e00\u4e2a\u7c7b\u7684\u7279\u6b8a\u65b9\u6cd5\uff0c\u548c\u666e\u901a\u65b9\u6cd5\u552f\u4e00\u7684\u4e0d\u540c\u65f6\uff0c\u666e\u901a\u65b9\u6cd5\u9700\u8981\u8c03\u7528\uff01\u800c\u9b54\u672f\u65b9\u6cd5\u7531\u7cfb\u7edf\u81ea\u52a8\u8c03\u7528\u3002</p>\n</blockquote>\n<p>1.<code>__init__</code></p>\n<pre><code class=\"lang-\">\u521d\u59cb\u5316\u9b54\u672f\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a\uff1a\u521d\u59cb\u5316\u5bf9\u8c61\u65f6\u89e6\u53d1\uff08\u4e0d\u662f\u5b9e\u4f8b\u5316\u89e6\u53d1\uff0c\u4f46\u662f\u548c\u5b9e\u4f8b\u5316\u5728\u4e00\u4e2a\u64cd\u4f5c\u4e2d\uff09\n\u53c2\u6570\uff1a\u81f3\u5c11\u6709\u4e00\u4e2aself\uff0c\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u4f5c\u7528\uff1a\u521d\u59cb\u5316\u5bf9\u8c61\u7684\u6210\u5458\n</code></pre>\n<p>2.<code>__new__</code></p>\n<pre><code class=\"lang-\">\u5b9e\u4f8b\u5316\u9b54\u672f\u65b9\u6cd5  \u7c7b\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a\uff1a \u5728\u5b9e\u4f8b\u5316\u5bf9\u8c61\u65f6\u89e6\u53d1\n\u53c2\u6570\uff1a\u81f3\u5c11\u4e00\u4e2acls \u63a5\u6536\u5f53\u524d\u7c7b\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\n\u4f5c\u7528\uff1a\u5b9e\u4f8b\u5316\u5bf9\u8c61\n\u6ce8\u610f\uff1a\u5b9e\u4f8b\u5316\u5bf9\u8c61\u662fObject\u7c7b\u5e95\u5c42\u5b9e\u73b0\uff0c\u5176\u4ed6\u7c7b\u7ee7\u627f\u4e86Object\u7684__new__\u624d\u80fd\u591f\u5b9e\u73b0\u5b9e\u4f8b\u5316\u5bf9\u8c61\u3002\n\u6ca1\u4e8b\u522b\u78b0\u8fd9\u4e2a\u9b54\u672f\u65b9\u6cd5\uff0c\u5148\u89e6\u53d1__new__\u624d\u4f1a\u89e6\u53d1__init__ \n</code></pre>\n<p>3.<code>__del__</code></p>\n<pre><code class=\"lang-\">\u6790\u6784\u9b54\u672f\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a\uff1a\u5f53\u5bf9\u8c61\u6ca1\u6709\u7528\uff08\u6ca1\u6709\u4efb\u4f55\u53d8\u91cf\u5f15\u7528\uff09\u7684\u65f6\u5019\u88ab\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself \n\u8fd4\u56de\u503c\uff1a\u65e0\n\u4f5c\u7528\uff1a\u5728\u9500\u6bc1\u5bf9\u8c61\u65f6\u56de\u6536\u8d44\u6e90\n\u6ce8\u610f\uff1adel\u4e0d\u4e00\u5b9a\u4f1a\u89e6\u53d1\u5f53\u524d\u65b9\u6cd5\uff0c\u53ea\u6709\u5f53\u524d\u5bf9\u8c61\u6ca1\u6709\u4efb\u4f55\u53d8\u91cf\u5f15\u7528\u65f6\u624d\u4f1a\u89e6\u53d1\n</code></pre>\n<p>4.<code>__call__</code></p>\n<pre><code class=\"lang-\">\u8c03\u7528\u5bf9\u8c61\u7684\u9b54\u672f\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a:\u5c06\u5bf9\u8c61\u5f53\u4f5c\u51fd\u6570\u8c03\u7528\u65f6\u89e6\u53d1,\u65b9\u5f0f\uff1a \u5bf9\u8c61()\n\u53c2\u6570:\u81f3\u5c11\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\uff0c\u5176\u4f59\u6839\u636e\u8c03\u7528\u65f6\u53c2\u6570\u51b3\u5b9a\n\u8fd4\u56de\u503c\uff1a\u6839\u636e\u60c5\u51b5\u800c\u5b9a\n\u4f5c\u7528\uff1a\u53ef\u4ee5\u5c06\u590d\u6742\u7684\u6b65\u9aa4\u8fdb\u884c\u5408\u5e76\u64cd\u4f5c\uff0c\u51cf\u5c11\u8c03\u7528\u7684\u6b65\u9aa4\uff0c\u65b9\u4fbf\u4f7f\u7528\n\u6ce8\u610f\uff1a\u65e0\n</code></pre>\n<p>5.<code>__len__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u4f7f\u7528len(\u5bf9\u8c61) \u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2a\u53c2\u6570self\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u4e00\u4e2a\u6574\u578b\n\u4f5c\u7528\uff1a\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u68c0\u6d4b\u5bf9\u8c61\u6210\u5458\u4e2a\u6570\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u4efb\u610f\u64cd\u4f5c\n\u6ce8\u610f\uff1a\u8fd4\u56de\u503c\u5fc5\u987b\u5fc5\u987b\u662f\u6574\u6570\uff0c\u5426\u5219\u8bed\u6cd5\u62a5\u9519\uff0c\u53e6\u5916\u8be5\u8981\u6c42\u662f\u683c\u5f0f\u8981\u6c42\u3002\n</code></pre>\n<p>6.<code>__str__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a:\u4f7f\u7528print(\u5bf9\u8c61)\u6216\u8005str(\u5bf9\u8c61)\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\n\u4f5c\u7528\uff1aprint\uff08\u5bf9\u8c61\u65f6\uff09\u8fdb\u884c\u64cd\u4f5c\uff0c\u5f97\u5230\u5b57\u7b26\u4e32\uff0c\u901a\u5e38\u7528\u4e8e\u5feb\u6377\u64cd\u4f5c\n\u6ce8\u610f\uff1a\u65e0\n</code></pre>\n<p>7.<code>__repr__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a:\u5728\u4f7f\u7528repr(\u5bf9\u8c61)\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\n\u4f5c\u7528\uff1a\u5c06\u5bf9\u8c61\u8f6c\u4f7f\u7528repr\u5316\u4e3a\u5b57\u7b26\u4e32\u65f6\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5feb\u6377\u64cd\u4f5c\n</code></pre>\n<p>8.<code>__bool__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a: \u4f7f\u7528bool(\u5bf9\u8c61)\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u5e03\u5c14\u503c\n\u4f5c\u7528\uff1a\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u51b3\u5b9a\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u5feb\u6377\u65b9\u5f0f\u4f7f\u7528\n\u6ce8\u610f:\u4ec5\u9002\u5408\u4e8e\u8fd4\u56de\u5e03\u5c14\u503c\u7684\u64cd\u4f5c\n</code></pre>\n<p>9.<code>__format__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u4f7f\u7528\u5b57\u7b26\u4e32.format(\u5bf9\u8c61)\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\uff0c\u4e00\u4e2a\u53c2\u6570\u63a5\u6536format\u7684{}\u4e2d\u7684\u683c\u5f0f\uff0c\u4f8b\u5982:&gt;5\n\u8fd4\u56de\u503c:\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\n\u4f5c\u7528\uff1a\u8bbe\u7f6e\u5bf9\u8c61\u53ef\u4ee5\u4f5c\u4e3aformat\u7684\u53c2\u6570\uff0c\u5e76\u4e14\u81ea\u5b9a\u4e49\u5bf9\u8c61\u683c\u5f0f\u5316\u7684\u89c4\u5219\n\u6ce8\u610f\uff1a\u65e0\n</code></pre>\n<h1><a id=\"_99\"></a>\u63cf\u8ff0\u7b26\u76f8\u5173\u7684\u9b54\u672f\u65b9\u6cd5</h1>\n<hr />\n<p>1.<code>__get__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u5728\u83b7\u53d6\u6307\u5b9a\u63cf\u8ff0\u7b26\u64cd\u4f5c\u7684\u6210\u5458\u5c5e\u6027\u7684\u503c\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a1\u63cf\u8ff0\u7b26\u5bf9\u8c61\u672c\u8eab\uff0c2\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5c5e\u6027\u6240\u5728\u7684\u5bf9\u8c61\uff0c\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5bf9\u8c61\u7684\u7c7b\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u6709\uff0c\u4e0d\u7136\u65e0\u6cd5\u83b7\u53d6\u76f8\u5e94\u5c5e\u6027\u503c\n\u6ce8\u610f\uff1a\u4ec5\u5728\u63cf\u8ff0\u7b26\u4e2d\u4f7f\u7528\n</code></pre>\n<p>2.<code>__set__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u5728\u8bbe\u7f6e\u6216\u8005\u6dfb\u52a0\u6307\u5b9a\u63cf\u8ff0\u7b26\u64cd\u4f5c\u7684\u6210\u5458\u5c5e\u6027\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a1\u63cf\u8ff0\u7b26\u5bf9\u8c61\u672c\u8eab\uff0c2\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5c5e\u6027\u6240\u5728\u7684\u5bf9\u8c61,3\u8981\u8bbe\u7f6e\u7684\u503c\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u6ce8\u610f\uff1a\u4ec5\u5728\u63cf\u8ff0\u7b26\u4e2d\u4f7f\u7528\n</code></pre>\n<p>3.<code>__delete__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u5728\u5220\u9664\u6307\u5b9a\u63cf\u8ff0\u7b26\u64cd\u4f5c\u7684\u6210\u5458\u5c5e\u6027\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a1\u63cf\u8ff0\u7b26\u5bf9\u8c61\u672c\u8eab\uff0c2\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5c5e\u6027\u6240\u5728\u7684\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u6ce8\u610f\uff1a\u4ec5\u5728\u63cf\u8ff0\u7b26\u4e2d\u4f7f\u7528\n</code></pre>\n<h1><a id=\"_130\"></a>\u4e0e\u5c5e\u6027\u64cd\u4f5c\u76f8\u5173\u7684\u9b54\u672f\u65b9\u6cd5</h1>\n<hr />\n<p>1.<code>__getattr__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u83b7\u53d6\u4e0d\u5b58\u5728\u7684\u5bf9\u8c61\u6210\u5458\u65f6\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2a\u662f\u63a5\u6536\u5f53\u524d\u5bf9\u8c61\u7684self\uff0c\u4e00\u4e2a\u662f\u83b7\u53d6\u6210\u5458\u540d\u79f0\u7684\u5b57\u7b26\u4e32\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u6709\u503c\n\u4f5c\u7528:\u4e3a\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\u8bbe\u7f6e\u503c\n\u6ce8\u610f\uff1agetattribute\u65e0\u8bba\u4f55\u65f6\u90fd\u4f1a\u5728getattr\u4e4b\u524d\u89e6\u53d1\uff0c\u89e6\u53d1\u4e86getattribute\u5c31\u4e0d\u4f1a\u5728\u89e6\u53d1getattr\u4e86\n</code></pre>\n<p>2.<code>__setattr__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a:\u8bbe\u7f6e\u5bf9\u8c61\u6210\u5458\u503c\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570:1\u4e2a\u5f53\u524d\u5bf9\u8c61\u7684self,\u4e00\u4e2a\u662f\u8981\u8bbe\u7f6e\u7684\u6210\u5458\u540d\u79f0\u5b57\u7b26\u4e32,\u4e00\u4e2a\u662f\u8981\u8bbe\u7f6e\u7684\u503c\n\u8fd4\u56de\u503c:\u65e0 \u8fc7\u7a0b\u64cd\u4f5c\n\u4f5c\u7528:\u63a5\u7ba1\u8bbe\u7f6e\u64cd\u4f5c,\u53ef\u4ee5\u5728\u8bbe\u7f6e\u524d\u4e4b\u524d\u8fdb\u884c\u5224\u65ad\u9a8c\u8bc1\u7b49\u884c\u4e3a\n\u6ce8\u610f:\u5728\u5f53\u524d\u65b9\u6cd5\u4e2d\u65e0\u6cd5\u4f7f\u7528\u6210\u5458=\u503c\u7684\u65b9\u5f0f\u76f4\u63a5\u8bbe\u7f6e\u6210\u5458\uff0c\u5426\u5219\u4f1a\u65e0\u9650\u9012\u5f52\uff0c\u5fc5\u987b\u501f\u52a9object\u7684\u8bbe\u7f6e\u65b9\u6cd5\u6765\u5b8c\u6210\n\nobject.__setattr__\uff08\u53c2\u65701\uff0c\u53c2\u65702\uff0c\u53c2\u65703\uff09\n</code></pre>\n<p>3.<code>__delattr__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u5220\u9664\u5bf9\u8c61\u6210\u5458\u65f6\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2a\u5f53\u524d\u5bf9\u8c61\u7684self\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u4f5c\u7528:\u53ef\u4ee5\u5728\u5220\u9664\u6210\u5458\u65f6\u8fdb\u884c\u9a8c\u8bc1\u3002\n</code></pre>\n<p>4.<code>__getattribute__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1a\u4f7f\u7528\u5bf9\u8c61\u6210\u5458\u65f6\u89e6\u53d1\uff0c\u65e0\u8bba\u6210\u5458\u662f\u5426\u5b58\u5728\n\u53c2\u6570\uff1a1\u4e2a\u63a5\u6536\u5f53\u524d\u5bf9\u8c61self\uff0c\u4e00\u4e2a\u662f\u83b7\u53d6\u7684\u6210\u5458\u7684\u540d\u79f0\u5b57\u7b26\u4e32\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u6709\n\u4f5c\u7528\uff1a\u5728\u5177\u6709\u5c01\u88c5\u64cd\u4f5c\uff08\u79c1\u6709\u5316\u65f6\uff09\uff0c\u4e3a\u7a0b\u5e8f\u5f00\u90e8\u5206\u8bbf\u95ee\u6743\u9650\u4f7f\u7528\n</code></pre>\n<p>5.<code>__dir__</code></p>\n<pre><code class=\"lang-\">\u89e6\u53d1\u65f6\u673a\uff1adir\uff08\u5bf9\u8c61\uff09\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570:1\u4e2a\u63a5\u6536\u5f53\u524d\u5bf9\u8c61self\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u4e3a\u5e8f\u5217\u7c7b\u578b\uff08\u5217\u8868\uff0c\u5143\u7ec4\uff0c\u96c6\u5408\u7b49\uff0c\uff09\n\u4f5c\u7528\uff1a\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6210\u5458\u5217\u8868\u7684\u8fd4\u56de\u503c\n</code></pre>\n<h1><a id=\"_183\"></a>\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h1>\n<hr />\n<h2><a id=\"_187\"></a>\u6bd4\u8f83\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h2>\n<hr />\n<p>1.<code>__lt__</code></p>\n<pre><code class=\"lang-\">\u683c\u5f0f\uff1a\n    def __lt__(self,other):\n   \t  return \u6570\u636e\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5c0f\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5c0f\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax &lt; y \u8c03\u7528 x.lt(y)\n</code></pre>\n<p>2.<code>__le__</code></p>\n<pre><code class=\"lang-\">\u683c\u5f0f\uff1a\n    def __le__(self):\n         return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5c0f\u4e8e\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5c0f\u4e8e\u7b49\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax &lt;= y \u8c03\u7528 x.le(y)\n</code></pre>\n<p>3.<code>__gt__</code></p>\n<pre><code class=\"lang-\">\u683c\u5f0f\uff1a\n    def __gt__(self):\n       return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5927\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5927\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax &gt; y \u8c03\u7528 x.gt(y)\n</code></pre>\n<p>4.<code>__ge__</code></p>\n<pre><code class=\"lang-\">\u683c\u5f0f\uff1a\n    def __ge__(self):\n       return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5927\u4e8e\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5927\u4e8e\u7b49\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax &gt;= y \u8c03\u7528 x.ge(y)\n</code></pre>\n<p>5.<code>__eq__</code></p>\n<pre><code class=\"lang-\">\u683c\u5f0f\uff1a\n    def __eq__(self):\n        return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5927\u4e8e\u7b49\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax == y \u8c03\u7528 x.eq(y)\n</code></pre>\n<p>6.<code>__ne__</code></p>\n<pre><code class=\"lang-\">\u683c\u5f0f\uff1a\n    def __ne__(self):\n        return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u4e0d\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u4e0d\u7b49\u53f7\u7684\u884c\u4e3a\uff1ax != y \u8c03\u7528 x.ne(y)\n</code></pre>\n<h2><a id=\"_274\"></a>\u7b97\u672f\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h2>\n<hr />\n<pre><code class=\"lang-\">__add__(self, other)           \u5b9a\u4e49\u52a0\u6cd5\u7684\u884c\u4e3a\uff1a+\n__sub__(self, other)           \u5b9a\u4e49\u51cf\u6cd5\u7684\u884c\u4e3a\uff1a-\n__mul__(self, other)           \u5b9a\u4e49\u4e58\u6cd5\u7684\u884c\u4e3a\uff1a*\n__truediv__(self, other)       \u5b9a\u4e49\u771f\u9664\u6cd5\u7684\u884c\u4e3a\uff1a/\n__floordiv__(self, other)      \u5b9a\u4e49\u6574\u6570\u9664\u6cd5\u7684\u884c\u4e3a\uff1a//\n__mod__(self, other)           \u5b9a\u4e49\u53d6\u6a21\u7b97\u6cd5\u7684\u884c\u4e3a\uff1a%\n__divmod__(self, other)        \u5b9a\u4e49\u5f53\u88ab divmod() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\n__pow__(self, other[, modulo]) \u5b9a\u4e49\u5f53\u88ab power() \u8c03\u7528\u6216 ** \u8fd0\u7b97\u65f6\u7684\u884c\u4e3a\n__lshift__(self, other)        \u5b9a\u4e49\u6309\u4f4d\u5de6\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a&lt;&lt;\n__rshift__(self, other)        \u5b9a\u4e49\u6309\u4f4d\u53f3\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a&gt;&gt;\n__and__(self, other)           \u5b9a\u4e49\u6309\u4f4d\u4e0e\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a&amp;\n__xor__(self, other)           \u5b9a\u4e49\u6309\u4f4d\u5f02\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a^\n__or__(self, other)            \u5b9a\u4e49\u6309\u4f4d\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a|\n</code></pre>\n<h2><a id=\"_294\"></a>\u53cd\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h2>\n<hr />\n<pre><code class=\"lang-\">__radd__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rsub__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rmul__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rtruediv__(self, other)  \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rfloordiv__(self, other) \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rmod__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rdivmod__(self, other)   \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rpow__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rlshift__(self, other)   \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rrshift__(self, other)   \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rand__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rxor__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__ror__(self, other)       \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n</code></pre>\n<h2><a id=\"_314\"></a>\u8d4b\u503c\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h2>\n<hr />\n<pre><code class=\"lang-\">__iadd__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u52a0\u6cd5\u7684\u884c\u4e3a\uff1a+=\n__isub__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u51cf\u6cd5\u7684\u884c\u4e3a\uff1a-=\n__imul__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u4e58\u6cd5\u7684\u884c\u4e3a\uff1a=\n__itruediv__(self, other)         \u5b9a\u4e49\u8d4b\u503c\u771f\u9664\u6cd5\u7684\u884c\u4e3a\uff1a/=\n__ifloordiv__(self, other)        \u5b9a\u4e49\u8d4b\u503c\u6574\u6570\u9664\u6cd5\u7684\u884c\u4e3a\uff1a//=\n__imod__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u53d6\u6a21\u7b97\u6cd5\u7684\u884c\u4e3a\uff1a%=\n__ipow__(self, other[, modulo])   \u5b9a\u4e49\u8d4b\u503c\u5e42\u8fd0\u7b97\u7684\u884c\u4e3a\uff1a**=\n__ilshift__(self, other)          \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u5de6\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a&lt;&lt;=\n__irshift__(self, other)          \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u53f3\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a&gt;&gt;=\n__iand__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u4e0e\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a&amp;=\n__ixor__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u5f02\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a^=\n__ior__(self, other)              \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a|=\n</code></pre>\n<h2><a id=\"_333\"></a>\u4e00\u5143\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h2>\n<hr />\n<pre><code class=\"lang-\">__pos__(self)      \u5b9a\u4e49\u6b63\u53f7\u7684\u884c\u4e3a\uff1a+x\n__neg__(self)      \u5b9a\u4e49\u8d1f\u53f7\u7684\u884c\u4e3a\uff1a-x\n__abs__(self)      \u5b9a\u4e49\u5f53\u88ab abs() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\n__invert__(self)   \u5b9a\u4e49\u6309\u4f4d\u6c42\u53cd\u7684\u884c\u4e3a\uff1a~x\n</code></pre>\n<h2><a id=\"_344\"></a>\u7c7b\u578b\u8f6c\u6362\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h2>\n<hr />\n<pre><code class=\"lang-\">__complex__(self)      \u5b9a\u4e49\u5f53\u88ab complex() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__int__(self)          \u5b9a\u4e49\u5f53\u88ab int() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__float__(self)        \u5b9a\u4e49\u5f53\u88ab float() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__round__(self[, n])   \u5b9a\u4e49\u5f53\u88ab round() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__index(self)__        1. \u5f53\u5bf9\u8c61\u662f\u88ab\u5e94\u7528\u5728\u5207\u7247\u8868\u8fbe\u5f0f\u4e2d\u65f6\uff0c\u5b9e\u73b0\u6574\u5f62\u5f3a\u5236\u8f6c\u6362\n                       2. \u5982\u679c\u4f60\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53ef\u80fd\u5728\u5207\u7247\u65f6\u7528\u5230\u7684\u5b9a\u5236\u7684\u6570\u503c\u578b,\u4f60\u5e94\u8be5\u5b9a\u4e49 index\n                       3. \u5982\u679c index \u88ab\u5b9a\u4e49\uff0c\u5219 int \u4e5f\u9700\u8981\u88ab\u5b9a\u4e49\uff0c\u4e14\u8fd4\u56de\u76f8\u540c\u7684\u503c\n</code></pre>\n<h2><a id=\"with_358\"></a>\u4e0a\u4e0b\u6587\u7ba1\u7406\u76f8\u5173\u9b54\u672f\u65b9\u6cd5(with)</h2>\n<hr />\n<p><code>__enter__</code> \u548c <code>__exit__</code></p>\n<pre><code class=\"lang-\">__enter__(self)\n    1. \u5b9a\u4e49\u5f53\u4f7f\u7528 with \u8bed\u53e5\u65f6\u7684\u521d\u59cb\u5316\u884c\u4e3a\n    2. enter \u7684\u8fd4\u56de\u503c\u88ab with \u8bed\u53e5\u7684\u76ee\u6807\u6216\u8005 as \u540e\u7684\u540d\u5b57\u7ed1\u5b9a\n\n__exit__(self, exctype, excvalue, traceback)\n    1. \u5b9a\u4e49\u5f53\u4e00\u4e2a\u4ee3\u7801\u5757\u88ab\u6267\u884c\u6216\u8005\u7ec8\u6b62\u540e\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u5e94\u8be5\u505a\u4ec0\u4e48\n    2. \u4e00\u822c\u88ab\u7528\u6765\u5904\u7406\u5f02\u5e38\uff0c\u6e05\u9664\u5de5\u4f5c\u6216\u8005\u505a\u4e00\u4e9b\u4ee3\u7801\u5757\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u7684\u65e5\u5e38\u5de5\u4f5c\n</code></pre>\n<h2><a id=\"_374\"></a>\u5bb9\u5668\u7c7b\u578b\u76f8\u5173\u9b54\u672f\u65b9\u6cd5</h2>\n<hr />\n<pre><code class=\"lang-\">__len__(self)                  \u5b9a\u4e49\u5f53\u88ab len() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u8fd4\u56de\u5bb9\u5668\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\uff09\n__getitem__(self, key)         \u5b9a\u4e49\u83b7\u53d6\u5bb9\u5668\u4e2d\u6307\u5b9a\u5143\u7d20\u7684\u884c\u4e3a\uff0c\u76f8\u5f53\u4e8e self[key]\n__setitem__(self, key, value)  \u5b9a\u4e49\u8bbe\u7f6e\u5bb9\u5668\u4e2d\u6307\u5b9a\u5143\u7d20\u7684\u884c\u4e3a\uff0c\u76f8\u5f53\u4e8e self[key] = value\n__delitem__(self, key)         \u5b9a\u4e49\u5220\u9664\u5bb9\u5668\u4e2d\u6307\u5b9a\u5143\u7d20\u7684\u884c\u4e3a\uff0c\u76f8\u5f53\u4e8e del self[key]\n__iter__(self)                 \u5b9a\u4e49\u5f53\u8fed\u4ee3\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u7684\u884c\u4e3a\n__reversed__(self)             \u5b9a\u4e49\u5f53\u88ab reversed() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\n__contains__(self, item)       \u5b9a\u4e49\u5f53\u4f7f\u7528\u6210\u5458\u6d4b\u8bd5\u8fd0\u7b97\u7b26\uff08in \u6216 not in\uff09\u65f6\u7684\u884c\u4e3a\n</code></pre>", "body_md": "# \u5e38\u7528\u9b54\u672f\u65b9\u6cd5\n\n------\n\n> \u9b54\u672f\u65b9\u6cd5\u5c31\u662f\u4e00\u4e2a\u7c7b\u7684\u7279\u6b8a\u65b9\u6cd5\uff0c\u548c\u666e\u901a\u65b9\u6cd5\u552f\u4e00\u7684\u4e0d\u540c\u65f6\uff0c\u666e\u901a\u65b9\u6cd5\u9700\u8981\u8c03\u7528\uff01\u800c\u9b54\u672f\u65b9\u6cd5\u7531\u7cfb\u7edf\u81ea\u52a8\u8c03\u7528\u3002\n\n1.`__init__`\n\n```\n\u521d\u59cb\u5316\u9b54\u672f\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a\uff1a\u521d\u59cb\u5316\u5bf9\u8c61\u65f6\u89e6\u53d1\uff08\u4e0d\u662f\u5b9e\u4f8b\u5316\u89e6\u53d1\uff0c\u4f46\u662f\u548c\u5b9e\u4f8b\u5316\u5728\u4e00\u4e2a\u64cd\u4f5c\u4e2d\uff09\n\u53c2\u6570\uff1a\u81f3\u5c11\u6709\u4e00\u4e2aself\uff0c\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u4f5c\u7528\uff1a\u521d\u59cb\u5316\u5bf9\u8c61\u7684\u6210\u5458\n```\n\n2.`__new__`\n\n```\n\u5b9e\u4f8b\u5316\u9b54\u672f\u65b9\u6cd5  \u7c7b\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a\uff1a \u5728\u5b9e\u4f8b\u5316\u5bf9\u8c61\u65f6\u89e6\u53d1\n\u53c2\u6570\uff1a\u81f3\u5c11\u4e00\u4e2acls \u63a5\u6536\u5f53\u524d\u7c7b\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\n\u4f5c\u7528\uff1a\u5b9e\u4f8b\u5316\u5bf9\u8c61\n\u6ce8\u610f\uff1a\u5b9e\u4f8b\u5316\u5bf9\u8c61\u662fObject\u7c7b\u5e95\u5c42\u5b9e\u73b0\uff0c\u5176\u4ed6\u7c7b\u7ee7\u627f\u4e86Object\u7684__new__\u624d\u80fd\u591f\u5b9e\u73b0\u5b9e\u4f8b\u5316\u5bf9\u8c61\u3002\n\u6ca1\u4e8b\u522b\u78b0\u8fd9\u4e2a\u9b54\u672f\u65b9\u6cd5\uff0c\u5148\u89e6\u53d1__new__\u624d\u4f1a\u89e6\u53d1__init__ \n```\n\n3.`__del__`\n\n```\n\u6790\u6784\u9b54\u672f\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a\uff1a\u5f53\u5bf9\u8c61\u6ca1\u6709\u7528\uff08\u6ca1\u6709\u4efb\u4f55\u53d8\u91cf\u5f15\u7528\uff09\u7684\u65f6\u5019\u88ab\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself \n\u8fd4\u56de\u503c\uff1a\u65e0\n\u4f5c\u7528\uff1a\u5728\u9500\u6bc1\u5bf9\u8c61\u65f6\u56de\u6536\u8d44\u6e90\n\u6ce8\u610f\uff1adel\u4e0d\u4e00\u5b9a\u4f1a\u89e6\u53d1\u5f53\u524d\u65b9\u6cd5\uff0c\u53ea\u6709\u5f53\u524d\u5bf9\u8c61\u6ca1\u6709\u4efb\u4f55\u53d8\u91cf\u5f15\u7528\u65f6\u624d\u4f1a\u89e6\u53d1\n```\n\n4.`__call__`\n\n```\n\u8c03\u7528\u5bf9\u8c61\u7684\u9b54\u672f\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a:\u5c06\u5bf9\u8c61\u5f53\u4f5c\u51fd\u6570\u8c03\u7528\u65f6\u89e6\u53d1,\u65b9\u5f0f\uff1a \u5bf9\u8c61()\n\u53c2\u6570:\u81f3\u5c11\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\uff0c\u5176\u4f59\u6839\u636e\u8c03\u7528\u65f6\u53c2\u6570\u51b3\u5b9a\n\u8fd4\u56de\u503c\uff1a\u6839\u636e\u60c5\u51b5\u800c\u5b9a\n\u4f5c\u7528\uff1a\u53ef\u4ee5\u5c06\u590d\u6742\u7684\u6b65\u9aa4\u8fdb\u884c\u5408\u5e76\u64cd\u4f5c\uff0c\u51cf\u5c11\u8c03\u7528\u7684\u6b65\u9aa4\uff0c\u65b9\u4fbf\u4f7f\u7528\n\u6ce8\u610f\uff1a\u65e0\n```\n\n5.`__len__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u4f7f\u7528len(\u5bf9\u8c61) \u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2a\u53c2\u6570self\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u4e00\u4e2a\u6574\u578b\n\u4f5c\u7528\uff1a\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u68c0\u6d4b\u5bf9\u8c61\u6210\u5458\u4e2a\u6570\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u4efb\u610f\u64cd\u4f5c\n\u6ce8\u610f\uff1a\u8fd4\u56de\u503c\u5fc5\u987b\u5fc5\u987b\u662f\u6574\u6570\uff0c\u5426\u5219\u8bed\u6cd5\u62a5\u9519\uff0c\u53e6\u5916\u8be5\u8981\u6c42\u662f\u683c\u5f0f\u8981\u6c42\u3002\n```\n\n6.`__str__`\n\n```\n\u89e6\u53d1\u65f6\u673a:\u4f7f\u7528print(\u5bf9\u8c61)\u6216\u8005str(\u5bf9\u8c61)\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\n\u4f5c\u7528\uff1aprint\uff08\u5bf9\u8c61\u65f6\uff09\u8fdb\u884c\u64cd\u4f5c\uff0c\u5f97\u5230\u5b57\u7b26\u4e32\uff0c\u901a\u5e38\u7528\u4e8e\u5feb\u6377\u64cd\u4f5c\n\u6ce8\u610f\uff1a\u65e0\n```\n\n7.`__repr__`\n\n```\n\u89e6\u53d1\u65f6\u673a:\u5728\u4f7f\u7528repr(\u5bf9\u8c61)\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\n\u4f5c\u7528\uff1a\u5c06\u5bf9\u8c61\u8f6c\u4f7f\u7528repr\u5316\u4e3a\u5b57\u7b26\u4e32\u65f6\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5feb\u6377\u64cd\u4f5c\n```\n\n8.`__bool__`\n\n```\n\u89e6\u53d1\u65f6\u673a: \u4f7f\u7528bool(\u5bf9\u8c61)\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u662f\u5e03\u5c14\u503c\n\u4f5c\u7528\uff1a\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u51b3\u5b9a\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u5feb\u6377\u65b9\u5f0f\u4f7f\u7528\n\u6ce8\u610f:\u4ec5\u9002\u5408\u4e8e\u8fd4\u56de\u5e03\u5c14\u503c\u7684\u64cd\u4f5c\n```\n\n9.`__format__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u4f7f\u7528\u5b57\u7b26\u4e32.format(\u5bf9\u8c61)\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2aself\u63a5\u6536\u5bf9\u8c61\uff0c\u4e00\u4e2a\u53c2\u6570\u63a5\u6536format\u7684{}\u4e2d\u7684\u683c\u5f0f\uff0c\u4f8b\u5982:>5\n\u8fd4\u56de\u503c:\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\n\u4f5c\u7528\uff1a\u8bbe\u7f6e\u5bf9\u8c61\u53ef\u4ee5\u4f5c\u4e3aformat\u7684\u53c2\u6570\uff0c\u5e76\u4e14\u81ea\u5b9a\u4e49\u5bf9\u8c61\u683c\u5f0f\u5316\u7684\u89c4\u5219\n\u6ce8\u610f\uff1a\u65e0\n```\n\n# \u63cf\u8ff0\u7b26\u76f8\u5173\u7684\u9b54\u672f\u65b9\u6cd5\n\n------\n\n1.`__get__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u5728\u83b7\u53d6\u6307\u5b9a\u63cf\u8ff0\u7b26\u64cd\u4f5c\u7684\u6210\u5458\u5c5e\u6027\u7684\u503c\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a1\u63cf\u8ff0\u7b26\u5bf9\u8c61\u672c\u8eab\uff0c2\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5c5e\u6027\u6240\u5728\u7684\u5bf9\u8c61\uff0c\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5bf9\u8c61\u7684\u7c7b\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u6709\uff0c\u4e0d\u7136\u65e0\u6cd5\u83b7\u53d6\u76f8\u5e94\u5c5e\u6027\u503c\n\u6ce8\u610f\uff1a\u4ec5\u5728\u63cf\u8ff0\u7b26\u4e2d\u4f7f\u7528\n```\n\n2.`__set__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u5728\u8bbe\u7f6e\u6216\u8005\u6dfb\u52a0\u6307\u5b9a\u63cf\u8ff0\u7b26\u64cd\u4f5c\u7684\u6210\u5458\u5c5e\u6027\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a1\u63cf\u8ff0\u7b26\u5bf9\u8c61\u672c\u8eab\uff0c2\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5c5e\u6027\u6240\u5728\u7684\u5bf9\u8c61,3\u8981\u8bbe\u7f6e\u7684\u503c\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u6ce8\u610f\uff1a\u4ec5\u5728\u63cf\u8ff0\u7b26\u4e2d\u4f7f\u7528\n```\n\n3.`__delete__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u5728\u5220\u9664\u6307\u5b9a\u63cf\u8ff0\u7b26\u64cd\u4f5c\u7684\u6210\u5458\u5c5e\u6027\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570\uff1a1\u63cf\u8ff0\u7b26\u5bf9\u8c61\u672c\u8eab\uff0c2\u63cf\u8ff0\u7b26\u63cf\u8ff0\u7684\u5c5e\u6027\u6240\u5728\u7684\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u6ce8\u610f\uff1a\u4ec5\u5728\u63cf\u8ff0\u7b26\u4e2d\u4f7f\u7528\n```\n\n# \u4e0e\u5c5e\u6027\u64cd\u4f5c\u76f8\u5173\u7684\u9b54\u672f\u65b9\u6cd5\n\n------\n\n1.`__getattr__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u83b7\u53d6\u4e0d\u5b58\u5728\u7684\u5bf9\u8c61\u6210\u5458\u65f6\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2a\u662f\u63a5\u6536\u5f53\u524d\u5bf9\u8c61\u7684self\uff0c\u4e00\u4e2a\u662f\u83b7\u53d6\u6210\u5458\u540d\u79f0\u7684\u5b57\u7b26\u4e32\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u6709\u503c\n\u4f5c\u7528:\u4e3a\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\u8bbe\u7f6e\u503c\n\u6ce8\u610f\uff1agetattribute\u65e0\u8bba\u4f55\u65f6\u90fd\u4f1a\u5728getattr\u4e4b\u524d\u89e6\u53d1\uff0c\u89e6\u53d1\u4e86getattribute\u5c31\u4e0d\u4f1a\u5728\u89e6\u53d1getattr\u4e86\n```\n\n2.`__setattr__`\n\n```\n\u89e6\u53d1\u65f6\u673a:\u8bbe\u7f6e\u5bf9\u8c61\u6210\u5458\u503c\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570:1\u4e2a\u5f53\u524d\u5bf9\u8c61\u7684self,\u4e00\u4e2a\u662f\u8981\u8bbe\u7f6e\u7684\u6210\u5458\u540d\u79f0\u5b57\u7b26\u4e32,\u4e00\u4e2a\u662f\u8981\u8bbe\u7f6e\u7684\u503c\n\u8fd4\u56de\u503c:\u65e0 \u8fc7\u7a0b\u64cd\u4f5c\n\u4f5c\u7528:\u63a5\u7ba1\u8bbe\u7f6e\u64cd\u4f5c,\u53ef\u4ee5\u5728\u8bbe\u7f6e\u524d\u4e4b\u524d\u8fdb\u884c\u5224\u65ad\u9a8c\u8bc1\u7b49\u884c\u4e3a\n\u6ce8\u610f:\u5728\u5f53\u524d\u65b9\u6cd5\u4e2d\u65e0\u6cd5\u4f7f\u7528\u6210\u5458=\u503c\u7684\u65b9\u5f0f\u76f4\u63a5\u8bbe\u7f6e\u6210\u5458\uff0c\u5426\u5219\u4f1a\u65e0\u9650\u9012\u5f52\uff0c\u5fc5\u987b\u501f\u52a9object\u7684\u8bbe\u7f6e\u65b9\u6cd5\u6765\u5b8c\u6210\n\nobject.__setattr__\uff08\u53c2\u65701\uff0c\u53c2\u65702\uff0c\u53c2\u65703\uff09\n```\n\n3.`__delattr__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u5220\u9664\u5bf9\u8c61\u6210\u5458\u65f6\u89e6\u53d1\n\u53c2\u6570\uff1a\u4e00\u4e2a\u5f53\u524d\u5bf9\u8c61\u7684self\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u4f5c\u7528:\u53ef\u4ee5\u5728\u5220\u9664\u6210\u5458\u65f6\u8fdb\u884c\u9a8c\u8bc1\u3002\n```\n\n4.`__getattribute__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1a\u4f7f\u7528\u5bf9\u8c61\u6210\u5458\u65f6\u89e6\u53d1\uff0c\u65e0\u8bba\u6210\u5458\u662f\u5426\u5b58\u5728\n\u53c2\u6570\uff1a1\u4e2a\u63a5\u6536\u5f53\u524d\u5bf9\u8c61self\uff0c\u4e00\u4e2a\u662f\u83b7\u53d6\u7684\u6210\u5458\u7684\u540d\u79f0\u5b57\u7b26\u4e32\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u6709\n\u4f5c\u7528\uff1a\u5728\u5177\u6709\u5c01\u88c5\u64cd\u4f5c\uff08\u79c1\u6709\u5316\u65f6\uff09\uff0c\u4e3a\u7a0b\u5e8f\u5f00\u90e8\u5206\u8bbf\u95ee\u6743\u9650\u4f7f\u7528\n```\n\n5.`__dir__`\n\n```\n\u89e6\u53d1\u65f6\u673a\uff1adir\uff08\u5bf9\u8c61\uff09\u7684\u65f6\u5019\u89e6\u53d1\n\u53c2\u6570:1\u4e2a\u63a5\u6536\u5f53\u524d\u5bf9\u8c61self\n\u8fd4\u56de\u503c\uff1a\u5fc5\u987b\u4e3a\u5e8f\u5217\u7c7b\u578b\uff08\u5217\u8868\uff0c\u5143\u7ec4\uff0c\u96c6\u5408\u7b49\uff0c\uff09\n\u4f5c\u7528\uff1a\u53ef\u4ee5\u81ea\u5b9a\u4e49\u6210\u5458\u5217\u8868\u7684\u8fd4\u56de\u503c\n```\n\n# \u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5\n\n------\n\n## \u6bd4\u8f83\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5\n\n------\n\n1.`__lt__`\n\n```\n\u683c\u5f0f\uff1a\n    def __lt__(self,other):\n   \t  return \u6570\u636e\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5c0f\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5c0f\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax < y \u8c03\u7528 x.lt(y)\n```\n\n2.`__le__`\n\n```\n\u683c\u5f0f\uff1a\n    def __le__(self):\n         return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5c0f\u4e8e\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5c0f\u4e8e\u7b49\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax <= y \u8c03\u7528 x.le(y)\n```\n\n3.`__gt__`\n\n```\n\u683c\u5f0f\uff1a\n    def __gt__(self):\n       return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5927\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5927\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax > y \u8c03\u7528 x.gt(y)\n```\n\n4.`__ge__`\n\n```\n\u683c\u5f0f\uff1a\n    def __ge__(self):\n       return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u5927\u4e8e\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5927\u4e8e\u7b49\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax >= y \u8c03\u7528 x.ge(y)\n```\n\n5.`__eq__`\n\n```\n\u683c\u5f0f\uff1a\n    def __eq__(self):\n        return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u5927\u4e8e\u7b49\u4e8e\u53f7\u7684\u884c\u4e3a\uff1ax == y \u8c03\u7528 x.eq(y)\n```\n\n6.`__ne__`\n\n```\n\u683c\u5f0f\uff1a\n    def __ne__(self):\n        return bool\n\n\u7279\u5f81\uff1a\n    \u89e6\u53d1\u65f6\u673a\uff1a\u8fdb\u884c\u4e0d\u7b49\u4e8e\u5224\u65ad\u65f6\u81ea\u52a8\u89e6\u53d1\n    \u53c2\u6570\uff1a2\u4e2a\u53c2\u6570\u7b2c\u4e00\u4e2a\u662fself\uff0c\u7b2c\u4e8c\u4e2a\u5224\u65ad\u7684\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\n    \u8fd4\u56de\u503c\uff1a\u8fd4\u56de\u503c\u53ef\u4ee5\u4efb\u610f\u7c7b\u578b\uff0c\u63a8\u8350\u5e03\u5c14\u503c\n    \u4f5c\u7528\uff1a\u5b9a\u4e49\u4e0d\u7b49\u53f7\u7684\u884c\u4e3a\uff1ax != y \u8c03\u7528 x.ne(y)\n```\n\n## \u7b97\u672f\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5\n\n------\n\n```\n__add__(self, other)           \u5b9a\u4e49\u52a0\u6cd5\u7684\u884c\u4e3a\uff1a+\n__sub__(self, other)           \u5b9a\u4e49\u51cf\u6cd5\u7684\u884c\u4e3a\uff1a-\n__mul__(self, other)           \u5b9a\u4e49\u4e58\u6cd5\u7684\u884c\u4e3a\uff1a*\n__truediv__(self, other)       \u5b9a\u4e49\u771f\u9664\u6cd5\u7684\u884c\u4e3a\uff1a/\n__floordiv__(self, other)      \u5b9a\u4e49\u6574\u6570\u9664\u6cd5\u7684\u884c\u4e3a\uff1a//\n__mod__(self, other)           \u5b9a\u4e49\u53d6\u6a21\u7b97\u6cd5\u7684\u884c\u4e3a\uff1a%\n__divmod__(self, other)        \u5b9a\u4e49\u5f53\u88ab divmod() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\n__pow__(self, other[, modulo]) \u5b9a\u4e49\u5f53\u88ab power() \u8c03\u7528\u6216 ** \u8fd0\u7b97\u65f6\u7684\u884c\u4e3a\n__lshift__(self, other)        \u5b9a\u4e49\u6309\u4f4d\u5de6\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a<<\n__rshift__(self, other)        \u5b9a\u4e49\u6309\u4f4d\u53f3\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a>>\n__and__(self, other)           \u5b9a\u4e49\u6309\u4f4d\u4e0e\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a&\n__xor__(self, other)           \u5b9a\u4e49\u6309\u4f4d\u5f02\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a^\n__or__(self, other)            \u5b9a\u4e49\u6309\u4f4d\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a|\n```\n\n## \u53cd\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5\n\n------\n\n```\n__radd__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rsub__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rmul__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rtruediv__(self, other)  \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rfloordiv__(self, other) \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rmod__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rdivmod__(self, other)   \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rpow__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rlshift__(self, other)   \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rrshift__(self, other)   \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rand__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__rxor__(self, other)      \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n__ror__(self, other)       \u4e0e\u4e0a\u65b9\u76f8\u540c\uff0c\u5f53\u5de6\u64cd\u4f5c\u6570\u4e0d\u652f\u6301\u76f8\u5e94\u7684\u64cd\u4f5c\u65f6\u88ab\u8c03\u7528\n```\n\n## \u8d4b\u503c\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5\n\n------\n\n```\n__iadd__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u52a0\u6cd5\u7684\u884c\u4e3a\uff1a+=\n__isub__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u51cf\u6cd5\u7684\u884c\u4e3a\uff1a-=\n__imul__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u4e58\u6cd5\u7684\u884c\u4e3a\uff1a=\n__itruediv__(self, other)         \u5b9a\u4e49\u8d4b\u503c\u771f\u9664\u6cd5\u7684\u884c\u4e3a\uff1a/=\n__ifloordiv__(self, other)        \u5b9a\u4e49\u8d4b\u503c\u6574\u6570\u9664\u6cd5\u7684\u884c\u4e3a\uff1a//=\n__imod__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u53d6\u6a21\u7b97\u6cd5\u7684\u884c\u4e3a\uff1a%=\n__ipow__(self, other[, modulo])   \u5b9a\u4e49\u8d4b\u503c\u5e42\u8fd0\u7b97\u7684\u884c\u4e3a\uff1a**=\n__ilshift__(self, other)          \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u5de6\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a<<=\n__irshift__(self, other)          \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u53f3\u79fb\u4f4d\u7684\u884c\u4e3a\uff1a>>=\n__iand__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u4e0e\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a&=\n__ixor__(self, other)             \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u5f02\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a^=\n__ior__(self, other)              \u5b9a\u4e49\u8d4b\u503c\u6309\u4f4d\u6216\u64cd\u4f5c\u7684\u884c\u4e3a\uff1a|=\n```\n\n## \u4e00\u5143\u8fd0\u7b97\u76f8\u5173\u9b54\u672f\u65b9\u6cd5\n\n------\n\n```\n__pos__(self)      \u5b9a\u4e49\u6b63\u53f7\u7684\u884c\u4e3a\uff1a+x\n__neg__(self)      \u5b9a\u4e49\u8d1f\u53f7\u7684\u884c\u4e3a\uff1a-x\n__abs__(self)      \u5b9a\u4e49\u5f53\u88ab abs() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\n__invert__(self)   \u5b9a\u4e49\u6309\u4f4d\u6c42\u53cd\u7684\u884c\u4e3a\uff1a~x\n```\n\n## \u7c7b\u578b\u8f6c\u6362\u76f8\u5173\u9b54\u672f\u65b9\u6cd5 \n\n------\n\n```\n__complex__(self)      \u5b9a\u4e49\u5f53\u88ab complex() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__int__(self)          \u5b9a\u4e49\u5f53\u88ab int() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__float__(self)        \u5b9a\u4e49\u5f53\u88ab float() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__round__(self[, n])   \u5b9a\u4e49\u5f53\u88ab round() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u9700\u8981\u8fd4\u56de\u6070\u5f53\u7684\u503c\uff09\n__index(self)__        1. \u5f53\u5bf9\u8c61\u662f\u88ab\u5e94\u7528\u5728\u5207\u7247\u8868\u8fbe\u5f0f\u4e2d\u65f6\uff0c\u5b9e\u73b0\u6574\u5f62\u5f3a\u5236\u8f6c\u6362\n                       2. \u5982\u679c\u4f60\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53ef\u80fd\u5728\u5207\u7247\u65f6\u7528\u5230\u7684\u5b9a\u5236\u7684\u6570\u503c\u578b,\u4f60\u5e94\u8be5\u5b9a\u4e49 index\n                       3. \u5982\u679c index \u88ab\u5b9a\u4e49\uff0c\u5219 int \u4e5f\u9700\u8981\u88ab\u5b9a\u4e49\uff0c\u4e14\u8fd4\u56de\u76f8\u540c\u7684\u503c\n```\n\n## \u4e0a\u4e0b\u6587\u7ba1\u7406\u76f8\u5173\u9b54\u672f\u65b9\u6cd5(with)\n\n------\n\n`__enter__` \u548c `__exit__`\n\n```\n__enter__(self)\n    1. \u5b9a\u4e49\u5f53\u4f7f\u7528 with \u8bed\u53e5\u65f6\u7684\u521d\u59cb\u5316\u884c\u4e3a\n    2. enter \u7684\u8fd4\u56de\u503c\u88ab with \u8bed\u53e5\u7684\u76ee\u6807\u6216\u8005 as \u540e\u7684\u540d\u5b57\u7ed1\u5b9a\n\n__exit__(self, exctype, excvalue, traceback)\n    1. \u5b9a\u4e49\u5f53\u4e00\u4e2a\u4ee3\u7801\u5757\u88ab\u6267\u884c\u6216\u8005\u7ec8\u6b62\u540e\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u5e94\u8be5\u505a\u4ec0\u4e48\n    2. \u4e00\u822c\u88ab\u7528\u6765\u5904\u7406\u5f02\u5e38\uff0c\u6e05\u9664\u5de5\u4f5c\u6216\u8005\u505a\u4e00\u4e9b\u4ee3\u7801\u5757\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u7684\u65e5\u5e38\u5de5\u4f5c\n```\n\n## \u5bb9\u5668\u7c7b\u578b\u76f8\u5173\u9b54\u672f\u65b9\u6cd5\n\n------\n\n```\n__len__(self)                  \u5b9a\u4e49\u5f53\u88ab len() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\uff08\u8fd4\u56de\u5bb9\u5668\u4e2d\u5143\u7d20\u7684\u4e2a\u6570\uff09\n__getitem__(self, key)         \u5b9a\u4e49\u83b7\u53d6\u5bb9\u5668\u4e2d\u6307\u5b9a\u5143\u7d20\u7684\u884c\u4e3a\uff0c\u76f8\u5f53\u4e8e self[key]\n__setitem__(self, key, value)  \u5b9a\u4e49\u8bbe\u7f6e\u5bb9\u5668\u4e2d\u6307\u5b9a\u5143\u7d20\u7684\u884c\u4e3a\uff0c\u76f8\u5f53\u4e8e self[key] = value\n__delitem__(self, key)         \u5b9a\u4e49\u5220\u9664\u5bb9\u5668\u4e2d\u6307\u5b9a\u5143\u7d20\u7684\u884c\u4e3a\uff0c\u76f8\u5f53\u4e8e del self[key]\n__iter__(self)                 \u5b9a\u4e49\u5f53\u8fed\u4ee3\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u7684\u884c\u4e3a\n__reversed__(self)             \u5b9a\u4e49\u5f53\u88ab reversed() \u8c03\u7528\u65f6\u7684\u884c\u4e3a\n__contains__(self, item)       \u5b9a\u4e49\u5f53\u4f7f\u7528\u6210\u5458\u6d4b\u8bd5\u8fd0\u7b97\u7b26\uff08in \u6216 not in\uff09\u65f6\u7684\u884c\u4e3a\n```", "excerpt": "\u5e38\u7528\u9b54\u672f\u65b9\u6cd5\n\n\n\u9b54\u672f\u65b9\u6cd5\u5c31\u662f\u4e00\u4e2a\u7c7b\u7684\u7279\u6b8a\u65b9\u6cd5\uff0c\u548c\u666e\u901a\u65b9\u6cd5\u552f\u4e00\u7684\u4e0d\u540c\u65f6\uff0c\u666e\u901a\u65b9\u6cd5\u9700\u8981\u8c03\u7528\uff01\u800c\u9b54\u672f\u65b9\u6cd5\u7531\u7cfb\u7edf\u81ea\u52a8\u8c03\u7528\u3002\n\n1.__init__\n\u521d\u59cb\u5316\u9b54\u672f\u65b9\u6cd5\n\u89e6\u53d1\u65f6\u673a\uff1a\u521d\u59cb\u5316\u5bf9\u8c61\u65f6\u89e6\u53d1\uff08\u4e0d\u662f\u5b9e\u4f8b\u5316\u89e6\u53d1\uff0c\u4f46\u662f\u548c\u5b9e\u4f8b\u5316\u5728\u4e00\u4e2a\u64cd\u4f5c\u4e2d\uff09\n\u53c2\u6570\uff1a\u81f3\u5c11\u6709\u4e00\u4e2aself\uff0c\u63a5\u6536\u5bf9\u8c61\n\u8fd4\u56de\u503c\uff1a\u65e0\n\u4f5c\u7528\uff1a\u521d\u59cb\u5316\u5bf9\u8c61\u7684\u6210\u5458", "codestyle": "atelier-lakeside-dark", "reproduce": false, "reproduce_source": "", "create_date": "2020-04-06T14:14:51.146", "mod_date": "2020-04-06T14:14:51.147", "views_count": 6, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 7, "tags": []}}, {"model": "blog.post", "pk": 28, "fields": {"title": "\u94fe\u8868\u4e0e\u4e8c\u53c9\u6811\u7684\u521b\u5efa\u4e0e\u904d\u5386", "body": "<h2><a id=\"___0\"></a>\u5355\u94fe\u8868 \u7684\u521b\u5efa \u4e0e\u904d\u5386</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Node</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self,data=None)</span>:</span>\n        self.data = data\n        self.next = <span class=\"hljs-keyword\">None</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Linklist</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self,li:list,methods=<span class=\"hljs-string\">'HEAD'</span>)</span>:</span>\n        self.head = <span class=\"hljs-keyword\">None</span>\n        self.tail = <span class=\"hljs-keyword\">None</span>\n        <span class=\"hljs-keyword\">if</span> methods.upper() == <span class=\"hljs-string\">'HEAD'</span>:\n            self._create_linklist_head(li)\n        <span class=\"hljs-keyword\">elif</span> methods.upper() == <span class=\"hljs-string\">'TAIL'</span>:\n            self._create_linklist_tail(li)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">raise</span> ValueError(<span class=\"hljs-string\">f'methods:<span class=\"hljs-subst\">{methods}</span>\u4e0d\u662f\u4e00\u4e2a\u5efa\u8bae\u7684\u503c,\u5efa\u8bae\u503c\uff08HEAD,TAIL\uff09'</span>)\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">_create_linklist_head</span><span class=\"hljs-params\">(self,li)</span>:</span>      <span class=\"hljs-comment\"># \u5934\u63d2\u6cd5</span>\n        self.head = Node(<span class=\"hljs-number\">0</span>)\n        <span class=\"hljs-keyword\">for</span> v <span class=\"hljs-keyword\">in</span> li:\n            p = Node(v)\n            p.next = self.head.next         <span class=\"hljs-comment\"># \u5982\u4f55\u89e3\u91ca\uff08head\u7684next\u662f1\uff0c\u73b0\u5728\u63d2\u5165\u8282\u70b92\uff0c\u6307\u793a\uff09</span>\n            self.head.next = p              <span class=\"hljs-comment\"># \uff082\u7684next\u4e5f\u662f1\uff0c\u66ff\u4ee3head\u7684next\u53d8\u62102\uff09</span>\n            self.head.data+=<span class=\"hljs-number\">1</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">_create_linklist_tail</span><span class=\"hljs-params\">(self,li)</span>:</span>      <span class=\"hljs-comment\"># \u5c3e\u63d2\u6cd5</span>\n        self.head = Node(<span class=\"hljs-number\">0</span>)\n        self.tail = self.head       \n        <span class=\"hljs-keyword\">for</span> v <span class=\"hljs-keyword\">in</span> li:\n            p = Node(v)\n            self.tail.next = p              <span class=\"hljs-comment\"># head\u7684next\u662ftail\uff0c\u63d2\u5165\u540e,next\u53d8\u6210tail</span>\n            self.tail = p\n            self.head.data+=<span class=\"hljs-number\">1</span>\n<span class=\"hljs-meta\">    @property</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">show_linklist</span><span class=\"hljs-params\">(self)</span>:</span>\n        n = self.head.next\n        <span class=\"hljs-keyword\">while</span> n:\n            <span class=\"hljs-keyword\">yield</span> n.data\n            n = n.next\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__len__</span><span class=\"hljs-params\">(self)</span>:</span>\n        <span class=\"hljs-keyword\">return</span> self.head.data\n</code></div></pre>\n<h2><a id=\"_45\"></a>\u589e\u5220\u6539\u67e5</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Node</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self,val=None)</span>:</span>\n        self.val = val\n        self.next = <span class=\"hljs-keyword\">None</span>\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">LinkList</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self)</span>:</span>\n        self.head = <span class=\"hljs-keyword\">None</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">hadd</span><span class=\"hljs-params\">(self,val)</span>:</span>     <span class=\"hljs-comment\"># \u5934\u63d2\u6cd5</span>\n        n = Node(val)\n        n.next = self.head \n        self.head = n\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">tadd</span><span class=\"hljs-params\">(self,val)</span>:</span>     <span class=\"hljs-comment\"># \u5c3e\u63d2\u6cd5</span>\n        t = Node(val)\n        <span class=\"hljs-keyword\">if</span> self.head == <span class=\"hljs-keyword\">None</span>:\n            self.head = t\n            <span class=\"hljs-keyword\">return</span>  \n        pre = <span class=\"hljs-keyword\">None</span>\n        cur = self.head\n        <span class=\"hljs-keyword\">while</span> cur:\n            pre = cur\n            cur = cur.next \n        pre.next = t\n        \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">search</span><span class=\"hljs-params\">(self,val)</span>:</span>\n        <span class=\"hljs-keyword\">while</span> self.head:\n            <span class=\"hljs-keyword\">if</span> self.head.val == val:\n                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">True</span>\n            self.head = self.head.next\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">False</span>\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">insert</span><span class=\"hljs-params\">(self,pos,val)</span>:</span>\n        <span class=\"hljs-keyword\">try</span>:            <span class=\"hljs-comment\">#pos \u5927\u4e8e0\u5c0f\u4e8esize</span>\n            n = Node(val)\n            cur = self.head\n            pre = <span class=\"hljs-keyword\">None</span>\n            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> range(pos):\n                pre = cur\n                cur = cur.next\n            pre.next = n\n            n.next = cur\n        <span class=\"hljs-keyword\">except</span>:\n            <span class=\"hljs-keyword\">pass</span>\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">remove</span><span class=\"hljs-params\">(self,val)</span>:</span>\n        n = Node(val)\n        cur = self.head\n        pre = <span class=\"hljs-keyword\">None</span>\n        <span class=\"hljs-keyword\">if</span> cur.val == val:\n            self.head = cur.next\n            <span class=\"hljs-keyword\">return</span> \n        <span class=\"hljs-keyword\">while</span> cur:\n            <span class=\"hljs-keyword\">if</span> cur.val == val:\n                pre.next = cur.next\n                <span class=\"hljs-keyword\">return</span> \n            pre = cur\n            cur = cur.next\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverse</span><span class=\"hljs-params\">(self)</span>:</span>\n        cur = self.head\n        pre = <span class=\"hljs-keyword\">None</span>\n        n = cur.next\n        <span class=\"hljs-keyword\">while</span> cur:    \n            cur.next = pre\n            pre = cur\n            cur = n\n            <span class=\"hljs-keyword\">if</span> cur:\n                n = cur.next\n        self.head = pre\n    <span class=\"hljs-comment\"># \u7b80\u6d01\u7248 reverse</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">reverse</span><span class=\"hljs-params\">(self)</span>:</span>\n        cur = self.head\n        pre = <span class=\"hljs-keyword\">None</span>\n        <span class=\"hljs-keyword\">while</span> cur:\n            cur.next,pre,cur = pre,cur,cur.next\n\n        self.head = pre\n\n<span class=\"hljs-meta\">    @property</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">all</span><span class=\"hljs-params\">(self)</span>:</span>\n        cur = self.head\n        <span class=\"hljs-keyword\">while</span> cur:\n            <span class=\"hljs-keyword\">yield</span> cur.val\n            cur = cur.next\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">is_empty</span><span class=\"hljs-params\">(self)</span>:</span>\n        <span class=\"hljs-keyword\">return</span> self.head == <span class=\"hljs-keyword\">None</span>\n    \n<span class=\"hljs-meta\">    @property</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">size</span><span class=\"hljs-params\">(self)</span>:</span>\n        count = <span class=\"hljs-number\">0</span>\n        cur = self.head\n        <span class=\"hljs-keyword\">while</span> cur:\n            count+=<span class=\"hljs-number\">1</span>\n            cur = cur.next\n        <span class=\"hljs-keyword\">return</span> count\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__len__</span><span class=\"hljs-params\">(self)</span>:</span>\n        <span class=\"hljs-keyword\">return</span> self.size\n</code></div></pre>\n<h2><a id=\"_148\"></a>\u4e8c\u53c9\u6811\u7684\u5e7f\u5ea6\u4e0e\u6df1\u5ea6\u4f18\u5148\u904d\u5386</h2>\n<pre><div class=\"hljs\"><code class=\"lang-py\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BiTreeNode</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span><span class=\"hljs-params\">(self, data=None)</span>:</span>\n        self.data = data\n        self.left = <span class=\"hljs-keyword\">None</span>\n        self.right = <span class=\"hljs-keyword\">None</span>\n\n<span class=\"hljs-comment\"># \u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff08\u524d\uff09</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">dfs</span><span class=\"hljs-params\">(root)</span>:</span>\n    <span class=\"hljs-keyword\">if</span> root:\n        print(root.data)\n        dfs(root.left)\n        dfs(root.right)\n\n<span class=\"hljs-comment\"># \u5e7f\u5ea6\u4f18\u5148\u904d\u5386</span>\n\n<span class=\"hljs-keyword\">from</span> collections <span class=\"hljs-keyword\">import</span> deque\n\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">bfs</span><span class=\"hljs-params\">(root)</span>:</span>\n    q = deque()                     <span class=\"hljs-comment\"># \u5b9e\u4f8b\u5316\u4e00\u4e2aqueue</span>\n    q.append(root)                  <span class=\"hljs-comment\"># \u6839\u8282\u70b9\u63a5\u5165\u961f\u5217</span>\n    <span class=\"hljs-keyword\">while</span> len(q) &gt; <span class=\"hljs-number\">0</span>:               <span class=\"hljs-comment\"># \u961f\u5217\u6709\u5143\u7d20</span>\n        x = q.popleft()             <span class=\"hljs-comment\"># \u5f39\u51fa\u6839\u8282\u70b9\uff0c\u6253\u5370\u8282\u70b9\u7684\u503c</span>\n        print(x.data)               \n        <span class=\"hljs-keyword\">if</span> x.left:                  <span class=\"hljs-comment\"># \u5224\u65ad\u8282\u70b9\u662f\u5426\u6709\u5de6\u53f3\u5b50\u8282\u70b9</span>\n            q.append(x.left)        <span class=\"hljs-comment\"># \u6709\u7684\u8bdd\u52a0\u5165\u961f\u5217\uff0c\u7ee7\u7eed\u5f39\u51fa\u6253\u5370</span>\n        <span class=\"hljs-keyword\">if</span> x.right:         \n            q.append(x.right)\n</code></div></pre>", "body_md": "## \u5355\u94fe\u8868 \u7684\u521b\u5efa \u4e0e\u904d\u5386\n\n```py\nclass Node:\n    def __init__(self,data=None):\n        self.data = data\n        self.next = None\n\nclass Linklist:\n    def __init__(self,li:list,methods='HEAD'):\n        self.head = None\n        self.tail = None\n        if methods.upper() == 'HEAD':\n            self._create_linklist_head(li)\n        elif methods.upper() == 'TAIL':\n            self._create_linklist_tail(li)\n        else:\n            raise ValueError(f'methods:{methods}\u4e0d\u662f\u4e00\u4e2a\u5efa\u8bae\u7684\u503c,\u5efa\u8bae\u503c\uff08HEAD,TAIL\uff09')\n\n    def _create_linklist_head(self,li):      # \u5934\u63d2\u6cd5\n        self.head = Node(0)\n        for v in li:\n            p = Node(v)\n            p.next = self.head.next         # \u5982\u4f55\u89e3\u91ca\uff08head\u7684next\u662f1\uff0c\u73b0\u5728\u63d2\u5165\u8282\u70b92\uff0c\u6307\u793a\uff09\n            self.head.next = p              # \uff082\u7684next\u4e5f\u662f1\uff0c\u66ff\u4ee3head\u7684next\u53d8\u62102\uff09\n            self.head.data+=1\n    def _create_linklist_tail(self,li):      # \u5c3e\u63d2\u6cd5\n        self.head = Node(0)\n        self.tail = self.head       \n        for v in li:\n            p = Node(v)\n            self.tail.next = p              # head\u7684next\u662ftail\uff0c\u63d2\u5165\u540e,next\u53d8\u6210tail\n            self.tail = p\n            self.head.data+=1\n    @property\n    def show_linklist(self):\n        n = self.head.next\n        while n:\n            yield n.data\n            n = n.next\n\n    def __len__(self):\n        return self.head.data\n```\n\n## \u589e\u5220\u6539\u67e5\n```py\nclass Node:\n    def __init__(self,val=None):\n        self.val = val\n        self.next = None\nclass LinkList:\n    def __init__(self):\n        self.head = None\n    def hadd(self,val):     # \u5934\u63d2\u6cd5\n        n = Node(val)\n        n.next = self.head \n        self.head = n\n\n    def tadd(self,val):     # \u5c3e\u63d2\u6cd5\n        t = Node(val)\n        if self.head == None:\n            self.head = t\n            return  \n        pre = None\n        cur = self.head\n        while cur:\n            pre = cur\n            cur = cur.next \n        pre.next = t\n        \n    def search(self,val):\n        while self.head:\n            if self.head.val == val:\n                return True\n            self.head = self.head.next\n        return False\n\n    def insert(self,pos,val):\n        try:            #pos \u5927\u4e8e0\u5c0f\u4e8esize\n            n = Node(val)\n            cur = self.head\n            pre = None\n            for i in range(pos):\n                pre = cur\n                cur = cur.next\n            pre.next = n\n            n.next = cur\n        except:\n            pass\n    \n    def remove(self,val):\n        n = Node(val)\n        cur = self.head\n        pre = None\n        if cur.val == val:\n            self.head = cur.next\n            return \n        while cur:\n            if cur.val == val:\n                pre.next = cur.next\n                return \n            pre = cur\n            cur = cur.next\n\n    def reverse(self):\n        cur = self.head\n        pre = None\n        n = cur.next\n        while cur:    \n            cur.next = pre\n            pre = cur\n            cur = n\n            if cur:\n                n = cur.next\n        self.head = pre\n    # \u7b80\u6d01\u7248 reverse\n    def reverse(self):\n        cur = self.head\n        pre = None\n        while cur:\n            cur.next,pre,cur = pre,cur,cur.next\n\n        self.head = pre\n\n    @property\n    def all(self):\n        cur = self.head\n        while cur:\n            yield cur.val\n            cur = cur.next\n\n    def is_empty(self):\n        return self.head == None\n    \n    @property\n    def size(self):\n        count = 0\n        cur = self.head\n        while cur:\n            count+=1\n            cur = cur.next\n        return count\n    \n    def __len__(self):\n        return self.size\n```\n\n## \u4e8c\u53c9\u6811\u7684\u5e7f\u5ea6\u4e0e\u6df1\u5ea6\u4f18\u5148\u904d\u5386\n\n```py\nclass BiTreeNode:\n    def __init__(self, data=None):\n        self.data = data\n        self.left = None\n        self.right = None\n\n# \u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff08\u524d\uff09\ndef dfs(root):\n    if root:\n        print(root.data)\n        dfs(root.left)\n        dfs(root.right)\n\n# \u5e7f\u5ea6\u4f18\u5148\u904d\u5386\n\nfrom collections import deque\n\n\ndef bfs(root):\n    q = deque()                     # \u5b9e\u4f8b\u5316\u4e00\u4e2aqueue\n    q.append(root)                  # \u6839\u8282\u70b9\u63a5\u5165\u961f\u5217\n    while len(q) > 0:               # \u961f\u5217\u6709\u5143\u7d20\n        x = q.popleft()             # \u5f39\u51fa\u6839\u8282\u70b9\uff0c\u6253\u5370\u8282\u70b9\u7684\u503c\n        print(x.data)               \n        if x.left:                  # \u5224\u65ad\u8282\u70b9\u662f\u5426\u6709\u5de6\u53f3\u5b50\u8282\u70b9\n            q.append(x.left)        # \u6709\u7684\u8bdd\u52a0\u5165\u961f\u5217\uff0c\u7ee7\u7eed\u5f39\u51fa\u6253\u5370\n        if x.right:         \n            q.append(x.right)\n```", "excerpt": "\u5355\u94fe\u8868 \u7684\u521b\u5efa \u4e0e\u904d\u5386\nclass Node:\n    def __init__(self,data=None):\n        self.data = data\n        self.next = None\n\nclass Linklist:\n    def __init__(self,li:", "codestyle": "atelier-plateau-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-04-06T15:18:33.729", "mod_date": "2020-04-07T18:22:13.684", "views_count": 31, "can_comment": true, "comment_count": 0, "upvote_count": -1, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 1, "tags": []}}, {"model": "blog.post", "pk": 29, "fields": {"title": "iView-admin\u89e3\u6784", "body": "<blockquote>\n<p>iView\u5b98\u7f51\u63a8\u51fa\u7684\u8fd9\u4e2aadmin\u540e\u53f0\uff0c\u5b9e\u8bdd\u662f\u5f88\u559c\u6b22\u7684\uff0c\u5728\u5b66\u4e60\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u9488\u5bf9\u4e2a\u6027\u5316\u7684\u5b9a\u5236\uff0c\u4ee5\u53ca\u8bed\u8a00\u7684\u5b66\u4e60\uff0c\u4ee3\u7801\u7684\u89c4\u8303\u5927\u6709\u76ca\u5904\u3002\u4e86\u89e3\u4e86\u5f88\u591a\u81ea\u5df1\u5199\u524d\u7aef\u65f6\u770b\u8d77\u6765\u5f88\u4e11\u964b\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u9488\u5bf9\u9879\u76ee\u4ee3\u7801\uff0c\u89e3\u6784\u5206\u6790\u3002</p>\n</blockquote>\n<h2><a id=\"_1\"></a>\u9879\u76ee\u7ed3\u6784</h2>\n<pre><code class=\"lang-\">.\n\u251c\u2500\u2500 config  \u5f00\u53d1\u76f8\u5173\u914d\u7f6e\n\u251c\u2500\u2500 public  \u6253\u5305\u6240\u9700\u9759\u6001\u8d44\u6e90\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 api  AJAX\u8bf7\u6c42\n    \u2514\u2500\u2500 assets  \u9879\u76ee\u9759\u6001\u8d44\u6e90\n        \u251c\u2500\u2500 icons  \u81ea\u5b9a\u4e49\u56fe\u6807\u8d44\u6e90\n        \u2514\u2500\u2500 images  \u56fe\u7247\u8d44\u6e90\n    \u251c\u2500\u2500 components  \u4e1a\u52a1\u7ec4\u4ef6\n    \u251c\u2500\u2500 config  \u9879\u76ee\u8fd0\u884c\u914d\u7f6e\n    \u251c\u2500\u2500 directive  \u81ea\u5b9a\u4e49\u6307\u4ee4\n    \u251c\u2500\u2500 libs  \u5c01\u88c5\u5de5\u5177\u51fd\u6570\n    \u251c\u2500\u2500 locale  \u591a\u8bed\u8a00\u6587\u4ef6\n    \u251c\u2500\u2500 mock  mock\u6a21\u62df\u6570\u636e\n    \u251c\u2500\u2500 router  \u8def\u7531\u914d\u7f6e\n    \u251c\u2500\u2500 store  Vuex\u914d\u7f6e\n    \u251c\u2500\u2500 view  \u9875\u9762\u6587\u4ef6\n    \u2514\u2500\u2500 tests  \u6d4b\u8bd5\u76f8\u5173\n</code></pre>\n<h3><a id=\"vueconfigjs_23\"></a>vue.config.js</h3>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-keyword\">const</span> path = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'path'</span>)\n\n<span class=\"hljs-keyword\">const</span> resolve = <span class=\"hljs-function\"><span class=\"hljs-params\">dir</span> =&gt;</span> {\n  <span class=\"hljs-keyword\">return</span> path.join(__dirname, dir)\n}\n\n<span class=\"hljs-keyword\">const</span> BASE_URL = process.env.NODE_ENV === <span class=\"hljs-string\">'production'</span>\n  ? <span class=\"hljs-string\">'/'</span>\n  : <span class=\"hljs-string\">'/'</span>\n\n<span class=\"hljs-built_in\">module</span>.exports = {\n  <span class=\"hljs-attr\">publicPath</span>: BASE_URL,\n  <span class=\"hljs-attr\">chainWebpack</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">config</span> =&gt;</span> {\n    config.resolve.alias\n      .set(<span class=\"hljs-string\">'@'</span>, resolve(<span class=\"hljs-string\">'src'</span>)) <span class=\"hljs-comment\">// key,value\u81ea\u884c\u5b9a\u4e49\uff0c\u6bd4\u5982.set('@@', resolve('src/components'))</span>\n      .set(<span class=\"hljs-string\">'_c'</span>, resolve(<span class=\"hljs-string\">'src/components'</span>));\n  },\n\n  <span class=\"hljs-comment\">// \u8bbe\u4e3afalse\u6253\u5305\u65f6\u4e0d\u751f\u6210.map\u6587\u4ef6</span>\n  productionSourceMap: <span class=\"hljs-literal\">false</span>\n}\n</code></div></pre>\n<p>\u9879\u76eevue.config.js\u7684webpack\u914d\u7f6e\u57fa\u672c\u53ea\u914d\u7f6e\u4e86\u5bf9\u76ee\u5f55\u5f15\u5165\u7684\u5feb\u6377\u89e3\u6790</p>\n<h3><a id=\"packagejson_48\"></a>package.json</h3>\n<pre><div class=\"hljs\"><code class=\"lang-json\">{\n  <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"iview-admin\"</span>,\n  <span class=\"hljs-attr\">\"version\"</span>: <span class=\"hljs-string\">\"2.0.0\"</span>,\n  <span class=\"hljs-attr\">\"author\"</span>: <span class=\"hljs-string\">\"Lison&lt;lison16new@163.com&gt;\"</span>,\n  <span class=\"hljs-attr\">\"private\"</span>: <span class=\"hljs-literal\">false</span>,\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"serve\"</span>: <span class=\"hljs-string\">\"vue-cli-service serve --open\"</span>,\n    <span class=\"hljs-attr\">\"build\"</span>: <span class=\"hljs-string\">\"vue-cli-service build\"</span>,\n    <span class=\"hljs-attr\">\"lint\"</span>: <span class=\"hljs-string\">\"vue-cli-service lint\"</span>,\n    <span class=\"hljs-attr\">\"test:unit\"</span>: <span class=\"hljs-string\">\"vue-cli-service test:unit\"</span>,\n    <span class=\"hljs-attr\">\"test:e2e\"</span>: <span class=\"hljs-string\">\"vue-cli-service test:e2e\"</span>\n  },\n  <span class=\"hljs-attr\">\"dependencies\"</span>: {\n    <span class=\"hljs-attr\">\"axios\"</span>: <span class=\"hljs-string\">\"^0.18.0\"</span>,\n    <span class=\"hljs-attr\">\"clipboard\"</span>: <span class=\"hljs-string\">\"^2.0.0\"</span>,\n    <span class=\"hljs-attr\">\"codemirror\"</span>: <span class=\"hljs-string\">\"^5.38.0\"</span>,\n    <span class=\"hljs-attr\">\"countup\"</span>: <span class=\"hljs-string\">\"^1.8.2\"</span>,\n    <span class=\"hljs-attr\">\"cropperjs\"</span>: <span class=\"hljs-string\">\"^1.2.2\"</span>,\n    <span class=\"hljs-attr\">\"dayjs\"</span>: <span class=\"hljs-string\">\"^1.7.7\"</span>,\n    <span class=\"hljs-attr\">\"echarts\"</span>: <span class=\"hljs-string\">\"^4.0.4\"</span>,\n    <span class=\"hljs-attr\">\"html2canvas\"</span>: <span class=\"hljs-string\">\"^1.0.0-alpha.12\"</span>,\n    <span class=\"hljs-attr\">\"iview\"</span>: <span class=\"hljs-string\">\"^3.2.2\"</span>,\n    <span class=\"hljs-attr\">\"iview-area\"</span>: <span class=\"hljs-string\">\"^1.5.17\"</span>,\n    <span class=\"hljs-attr\">\"js-cookie\"</span>: <span class=\"hljs-string\">\"^2.2.0\"</span>,\n    <span class=\"hljs-attr\">\"simplemde\"</span>: <span class=\"hljs-string\">\"^1.11.2\"</span>,\n    <span class=\"hljs-attr\">\"sortablejs\"</span>: <span class=\"hljs-string\">\"^1.7.0\"</span>,\n    <span class=\"hljs-attr\">\"tree-table-vue\"</span>: <span class=\"hljs-string\">\"^1.1.0\"</span>,\n    <span class=\"hljs-attr\">\"v-org-tree\"</span>: <span class=\"hljs-string\">\"^1.0.6\"</span>,\n    <span class=\"hljs-attr\">\"vue\"</span>: <span class=\"hljs-string\">\"^2.5.10\"</span>,\n    <span class=\"hljs-attr\">\"vue-i18n\"</span>: <span class=\"hljs-string\">\"^7.8.0\"</span>,\n    <span class=\"hljs-attr\">\"vue-router\"</span>: <span class=\"hljs-string\">\"^3.0.1\"</span>,\n    <span class=\"hljs-attr\">\"vuedraggable\"</span>: <span class=\"hljs-string\">\"^2.16.0\"</span>,\n    <span class=\"hljs-attr\">\"vuex\"</span>: <span class=\"hljs-string\">\"^3.0.1\"</span>,\n    <span class=\"hljs-attr\">\"wangeditor\"</span>: <span class=\"hljs-string\">\"^3.1.1\"</span>,\n    <span class=\"hljs-attr\">\"xlsx\"</span>: <span class=\"hljs-string\">\"^0.13.3\"</span>\n  },\n  <span class=\"hljs-attr\">\"devDependencies\"</span>: {\n    <span class=\"hljs-attr\">\"@vue/cli-plugin-babel\"</span>: <span class=\"hljs-string\">\"^3.0.1\"</span>,\n    <span class=\"hljs-attr\">\"@vue/cli-plugin-eslint\"</span>: <span class=\"hljs-string\">\"^3.0.1\"</span>,\n    <span class=\"hljs-attr\">\"@vue/cli-plugin-unit-mocha\"</span>: <span class=\"hljs-string\">\"^3.0.1\"</span>,\n    <span class=\"hljs-attr\">\"@vue/cli-service\"</span>: <span class=\"hljs-string\">\"^3.0.1\"</span>,\n    <span class=\"hljs-attr\">\"@vue/eslint-config-standard\"</span>: <span class=\"hljs-string\">\"^3.0.0-beta.10\"</span>,\n    <span class=\"hljs-attr\">\"@vue/test-utils\"</span>: <span class=\"hljs-string\">\"^1.0.0-beta.10\"</span>,\n    <span class=\"hljs-attr\">\"chai\"</span>: <span class=\"hljs-string\">\"^4.1.2\"</span>,\n    <span class=\"hljs-attr\">\"eslint-plugin-cypress\"</span>: <span class=\"hljs-string\">\"^2.0.1\"</span>,\n    <span class=\"hljs-attr\">\"less\"</span>: <span class=\"hljs-string\">\"^2.7.3\"</span>,\n    <span class=\"hljs-attr\">\"less-loader\"</span>: <span class=\"hljs-string\">\"^4.0.5\"</span>,\n    <span class=\"hljs-attr\">\"lint-staged\"</span>: <span class=\"hljs-string\">\"^6.0.0\"</span>,\n    <span class=\"hljs-attr\">\"mockjs\"</span>: <span class=\"hljs-string\">\"^1.0.1-beta3\"</span>,\n    <span class=\"hljs-attr\">\"vue-template-compiler\"</span>: <span class=\"hljs-string\">\"^2.5.13\"</span>\n  },\n  <span class=\"hljs-attr\">\"browserslist\"</span>: [\n    <span class=\"hljs-string\">\"&gt; 1%\"</span>,\n    <span class=\"hljs-string\">\"last 2 versions\"</span>,\n    <span class=\"hljs-string\">\"not ie &lt;= 8\"</span>\n  ],\n  <span class=\"hljs-attr\">\"gitHooks\"</span>: {\n    <span class=\"hljs-attr\">\"pre-commit\"</span>: <span class=\"hljs-string\">\"lint-staged\"</span>\n  },\n  <span class=\"hljs-attr\">\"lint-staged\"</span>: {\n    <span class=\"hljs-attr\">\"*.js\"</span>: [\n      <span class=\"hljs-string\">\"vue-cli-service lint\"</span>,\n      <span class=\"hljs-string\">\"git add\"</span>\n    ],\n    <span class=\"hljs-attr\">\"*.vue\"</span>: [\n      <span class=\"hljs-string\">\"vue-cli-service lint\"</span>,\n      <span class=\"hljs-string\">\"git add\"</span>\n    ]\n  }\n}\n</code></div></pre>\n<p>\u4e8e\u6211\u800c\u8a00\uff0c\u6d4b\u8bd5\u53ca\u4ee3\u7801\u68c0\u6d4b\u652f\u6301\u5e76\u4e0d\u9700\u8981\uff0c\u5f88\u591a\u4e2a\u4eba\u5b9a\u5236\u5316\u5f00\u53d1\u65f6\u53ef\u4ee5\u7701\u7565\uff0c\u5bcc\u6587\u672c\u7b49\u5176\u4ed6\u63d2\u4ef6\u4e5f\u662f\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u672c\u5730create\u65b0\u9879\u76ee\u65f6\uff0c\u539f\u672c\u9879\u76ee\u7684less-loader\u7684mixin\u9700\u8981\u6307\u5b9a\u7248\u672c\uff0c\u5426\u5219\u51fa\u9519\uff0c\u5378\u8f7d\u539f\u7248\u672cless\u548cless-loader\uff0c\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u5982\u4e0a\u3002</p>\n<h2><a id=\"_123\"></a>\u914d\u7f6e</h2>\n<p>\u4ee5\u4e0b\u662f\u9879\u76ee\u8d44\u6e90\u76ee\u5f55\u914d\u7f6e</p>\n<h3><a id=\"mainjs_125\"></a>main.js</h3>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-comment\">// The Vue build version to load with the `import` command</span>\n<span class=\"hljs-comment\">// (runtime-only or standalone) has been set in webpack.base.conf with an alias.</span>\n<span class=\"hljs-keyword\">import</span> Vue <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'vue'</span>\n<span class=\"hljs-keyword\">import</span> App <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./App'</span>\n<span class=\"hljs-keyword\">import</span> router <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./router'</span>\n<span class=\"hljs-keyword\">import</span> store <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./store'</span>\n<span class=\"hljs-keyword\">import</span> iView <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'iview'</span>\n<span class=\"hljs-keyword\">import</span> i18n <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@/locale'</span>              <span class=\"hljs-comment\">//\u672c\u5730\u5316</span>\n<span class=\"hljs-keyword\">import</span> config <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@/config'</span>            <span class=\"hljs-comment\">//\u914d\u7f6e</span>\n<span class=\"hljs-keyword\">import</span> importDirective <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@/directive'</span>    <span class=\"hljs-comment\">//\u6307\u4ee4</span>\n<span class=\"hljs-keyword\">import</span> { directive <span class=\"hljs-keyword\">as</span> clickOutside } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'v-click-outside-x'</span>  <span class=\"hljs-comment\">//\u7ed3\u6784(es6)</span>\n<span class=\"hljs-keyword\">import</span> installPlugin <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@/plugin'</span>     <span class=\"hljs-comment\">//\u9519\u8bef\u65e5\u5fd7\u4fe1\u606f\u7684\u63d2\u4ef6</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'./index.less'</span>            <span class=\"hljs-comment\">//index.less(\u4e3b\u8981iview\u6837\u5f0f\u548csidebar\u7684\u4e3b\u9898)</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'@/assets/icons/iconfont.css'</span>    <span class=\"hljs-comment\">//\u56fe\u6807</span>\n<span class=\"hljs-keyword\">import</span> TreeTable <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'tree-table-vue'</span>  <span class=\"hljs-comment\">// \u6811\u72b6\u8868\u683c</span>\n<span class=\"hljs-keyword\">import</span> VOrgTree <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'v-org-tree'</span>       <span class=\"hljs-comment\">// \u7ec4\u7ec7\u7ed3\u6784\u6811</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'v-org-tree/dist/v-org-tree.css'</span>\n<span class=\"hljs-comment\">// \u5b9e\u9645\u6253\u5305\u65f6\u5e94\u8be5\u4e0d\u5f15\u5165mock</span>\n<span class=\"hljs-comment\">/* eslint-disable */</span>\n<span class=\"hljs-keyword\">if</span> (process.env.NODE_ENV !== <span class=\"hljs-string\">'production'</span>) <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'@/mock'</span>)\n\nVue.use(iView, {\n  <span class=\"hljs-attr\">i18n</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">key, value</span>) =&gt;</span> i18n.t(key, value)\n})\nVue.use(TreeTable)\nVue.use(VOrgTree)\n\ninstallPlugin(Vue)        <span class=\"hljs-comment\">// \u6ce8\u518cadmin\u5185\u7f6e\u63d2\u4ef6</span>\nVue.config.productionTip = <span class=\"hljs-literal\">false</span>\nVue.prototype.$config = config    <span class=\"hljs-comment\">//\u6ce8\u518c\u5168\u5c40$config</span>\n\nimportDirective(Vue)        <span class=\"hljs-comment\">// \u6307\u4ee4\u6ce8\u518c</span>\nVue.directive(<span class=\"hljs-string\">'clickOutside'</span>, clickOutside)\n\n<span class=\"hljs-comment\">/* eslint-disable no-new */</span>\n<span class=\"hljs-keyword\">new</span> Vue({\n  <span class=\"hljs-attr\">el</span>: <span class=\"hljs-string\">'#app'</span>,\n  router,\n  i18n,\n  store,\n  <span class=\"hljs-attr\">render</span>: <span class=\"hljs-function\"><span class=\"hljs-params\">h</span> =&gt;</span> h(App)\n})\n</code></div></pre>\n<blockquote>\n<p>iView-admin\u7684\u9879\u76ee\u5165\u53e3\u6587\u4ef6main.js\u8fd8\u662f\u6bd4\u8f83\u6e05\u695a\u7684\uff0c\u76f8\u6bd4\u6211\u7684\u4e71\u4e03\u516b\u7cdf\uff0c\u5f88\u6709\u793a\u8303\u610f\u4e49\u4e86\u3002<br />\nmain.js\u5f15\u5165\u4e86\u56fd\u9645\u5316\uff1b\u5168\u5c40\u6ce8\u518c\u4e86config\uff0c\u6307\u4ee4\u548c\u63d2\u4ef6\uff0c\u8fd8\u6709\u5f15\u5165\u4e86\u4e24\u4e2a\u7ec4\u4ef6\u9700\u8981\u7684\u5e93\uff0c\u5f88\u6e05\u695a\u76f4\u63a5</p>\n</blockquote>\n<h3><a id=\"configindexjs_172\"></a>config/index.js</h3>\n<pre><div class=\"hljs\"><code class=\"lang-js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n  <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">'iView-admin'</span>,        <span class=\"hljs-comment\">//doc-title\u524d\u7f00\uff0c\u6211\u4e0d\u559c\u6b22\u8fd9\u4e2a\u914d\u7f6e</span>\n  cookieExpires: <span class=\"hljs-number\">1</span>,        <span class=\"hljs-comment\">// token\u5728Cookie\u4e2d\u5b58\u50a8\u7684\u5929\u6570\uff0c\u9ed8\u8ba41\u5929</span>\n  useI18n: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-comment\">//\u9ed8\u8ba4false,\u5982\u679c\u4e0d\u4f7f\u7528\uff0c\u5219\u9700\u8981\u5728\u8def\u7531\u4e2d\u7ed9\u9700\u8981\u5728\u83dc\u5355\u4e2d\u5c55\u793a\u7684\u8def\u7531\u8bbe\u7f6emeta: {title: 'xxx'}</span>\n  baseUrl: {\n    <span class=\"hljs-attr\">dev</span>: <span class=\"hljs-string\">'https://www.easy-mock.com/mock/5add9213ce4d0e69998a6f51/iview-admin/'</span>,\n    <span class=\"hljs-attr\">pro</span>: <span class=\"hljs-string\">'https://produce.com'</span>\n  },        <span class=\"hljs-comment\">// \u5f00\u53d1\u548c\u751f\u4ea7\u6a21\u5f0f\u7684baseurl\uff0c\u6211\u4e0d\u559c\u6b22\u8fd9\u4e2a\u914d\u7f6e</span>\n  homeName: <span class=\"hljs-string\">'home'</span>,    <span class=\"hljs-comment\">//\u9ed8\u8ba4\u6253\u5f00\u7684\u9996\u9875\u7684\u8def\u7531name\u503c\uff0c\u9ed8\u8ba4\u4e3ahome</span>\n  plugin: {\n    <span class=\"hljs-string\">'error-store'</span>: {\n      <span class=\"hljs-attr\">showInHeader</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-comment\">// \u8bbe\u4e3afalse\u540e\u4e0d\u4f1a\u5728\u9876\u90e8\u663e\u793a\u9519\u8bef\u65e5\u5fd7\u5fbd\u6807</span>\n      developmentOff: <span class=\"hljs-literal\">true</span> <span class=\"hljs-comment\">// \u8bbe\u4e3atrue\u540e\u5728\u5f00\u53d1\u73af\u5883\u4e0d\u4f1a\u6536\u96c6\u9519\u8bef\u4fe1\u606f\uff0c\u65b9\u4fbf\u5f00\u53d1\u4e2d\u6392\u67e5\u9519\u8bef</span>\n    }\n  }            <span class=\"hljs-comment\">//\u9700\u8981\u52a0\u8f7d\u7684\u63d2\u4ef6</span>\n}\n</code></div></pre>\n<blockquote>\n<p>\u5168\u5c40\u914d\u7f6e\uff0c\u5176\u4e2d\u7684title\u914d\u7f6e\u5728lib/utils.js\u91cc\u7684\u524d\u7f00title\uff0c\u6211\u4e0d\u559c\u6b22\uff0c\u4e2a\u4eba\u5b9a\u5236\u7684\u8bdd\u4f1a\u53d6\u6d88\uff1bbaseurl\uff0c\u9879\u76ee\u7684\u5f00\u53d1\u548c\u751f\u4ea7\u73af\u5883\u6ca1\u6709@v4\u7684<code>.env.development</code>\u7684\u5168\u5c40\u53d8\u91cf\u65b9\u4fbf\uff0c\u6240\u4ee5\u4e2a\u4eba\u5efa\u8bae\u53d6\u6d88\u3002\u8fd9\u4e2aconfig\u6700\u65b9\u4fbf\u7684\u662f\uff0c\u5728main.js\u5168\u5c40\u914d\u7f6e\uff0c\u7136\u540e$config.\u53d8\u91cf\u540d\u76f4\u63a5\u5f15\u5165</p>\n</blockquote>\n<h3><a id=\"router_192\"></a>router</h3>", "body_md": "> iView\u5b98\u7f51\u63a8\u51fa\u7684\u8fd9\u4e2aadmin\u540e\u53f0\uff0c\u5b9e\u8bdd\u662f\u5f88\u559c\u6b22\u7684\uff0c\u5728\u5b66\u4e60\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u9488\u5bf9\u4e2a\u6027\u5316\u7684\u5b9a\u5236\uff0c\u4ee5\u53ca\u8bed\u8a00\u7684\u5b66\u4e60\uff0c\u4ee3\u7801\u7684\u89c4\u8303\u5927\u6709\u76ca\u5904\u3002\u4e86\u89e3\u4e86\u5f88\u591a\u81ea\u5df1\u5199\u524d\u7aef\u65f6\u770b\u8d77\u6765\u5f88\u4e11\u964b\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u9488\u5bf9\u9879\u76ee\u4ee3\u7801\uff0c\u89e3\u6784\u5206\u6790\u3002\n## \u9879\u76ee\u7ed3\u6784\n\n```\n.\n\u251c\u2500\u2500 config  \u5f00\u53d1\u76f8\u5173\u914d\u7f6e\n\u251c\u2500\u2500 public  \u6253\u5305\u6240\u9700\u9759\u6001\u8d44\u6e90\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 api  AJAX\u8bf7\u6c42\n    \u2514\u2500\u2500 assets  \u9879\u76ee\u9759\u6001\u8d44\u6e90\n        \u251c\u2500\u2500 icons  \u81ea\u5b9a\u4e49\u56fe\u6807\u8d44\u6e90\n        \u2514\u2500\u2500 images  \u56fe\u7247\u8d44\u6e90\n    \u251c\u2500\u2500 components  \u4e1a\u52a1\u7ec4\u4ef6\n    \u251c\u2500\u2500 config  \u9879\u76ee\u8fd0\u884c\u914d\u7f6e\n    \u251c\u2500\u2500 directive  \u81ea\u5b9a\u4e49\u6307\u4ee4\n    \u251c\u2500\u2500 libs  \u5c01\u88c5\u5de5\u5177\u51fd\u6570\n    \u251c\u2500\u2500 locale  \u591a\u8bed\u8a00\u6587\u4ef6\n    \u251c\u2500\u2500 mock  mock\u6a21\u62df\u6570\u636e\n    \u251c\u2500\u2500 router  \u8def\u7531\u914d\u7f6e\n    \u251c\u2500\u2500 store  Vuex\u914d\u7f6e\n    \u251c\u2500\u2500 view  \u9875\u9762\u6587\u4ef6\n    \u2514\u2500\u2500 tests  \u6d4b\u8bd5\u76f8\u5173\n```\n### vue.config.js\n```js\nconst path = require('path')\n\nconst resolve = dir => {\n  return path.join(__dirname, dir)\n}\n\nconst BASE_URL = process.env.NODE_ENV === 'production'\n  ? '/'\n  : '/'\n\nmodule.exports = {\n  publicPath: BASE_URL,\n  chainWebpack: config => {\n    config.resolve.alias\n      .set('@', resolve('src')) // key,value\u81ea\u884c\u5b9a\u4e49\uff0c\u6bd4\u5982.set('@@', resolve('src/components'))\n      .set('_c', resolve('src/components'));\n  },\n\n  // \u8bbe\u4e3afalse\u6253\u5305\u65f6\u4e0d\u751f\u6210.map\u6587\u4ef6\n  productionSourceMap: false\n}\n```\n\u9879\u76eevue.config.js\u7684webpack\u914d\u7f6e\u57fa\u672c\u53ea\u914d\u7f6e\u4e86\u5bf9\u76ee\u5f55\u5f15\u5165\u7684\u5feb\u6377\u89e3\u6790\n### package.json\n```json\n{\n  \"name\": \"iview-admin\",\n  \"version\": \"2.0.0\",\n  \"author\": \"Lison<lison16new@163.com>\",\n  \"private\": false,\n  \"scripts\": {\n    \"serve\": \"vue-cli-service serve --open\",\n    \"build\": \"vue-cli-service build\",\n    \"lint\": \"vue-cli-service lint\",\n    \"test:unit\": \"vue-cli-service test:unit\",\n    \"test:e2e\": \"vue-cli-service test:e2e\"\n  },\n  \"dependencies\": {\n    \"axios\": \"^0.18.0\",\n    \"clipboard\": \"^2.0.0\",\n    \"codemirror\": \"^5.38.0\",\n    \"countup\": \"^1.8.2\",\n    \"cropperjs\": \"^1.2.2\",\n    \"dayjs\": \"^1.7.7\",\n    \"echarts\": \"^4.0.4\",\n    \"html2canvas\": \"^1.0.0-alpha.12\",\n    \"iview\": \"^3.2.2\",\n    \"iview-area\": \"^1.5.17\",\n    \"js-cookie\": \"^2.2.0\",\n    \"simplemde\": \"^1.11.2\",\n    \"sortablejs\": \"^1.7.0\",\n    \"tree-table-vue\": \"^1.1.0\",\n    \"v-org-tree\": \"^1.0.6\",\n    \"vue\": \"^2.5.10\",\n    \"vue-i18n\": \"^7.8.0\",\n    \"vue-router\": \"^3.0.1\",\n    \"vuedraggable\": \"^2.16.0\",\n    \"vuex\": \"^3.0.1\",\n    \"wangeditor\": \"^3.1.1\",\n    \"xlsx\": \"^0.13.3\"\n  },\n  \"devDependencies\": {\n    \"@vue/cli-plugin-babel\": \"^3.0.1\",\n    \"@vue/cli-plugin-eslint\": \"^3.0.1\",\n    \"@vue/cli-plugin-unit-mocha\": \"^3.0.1\",\n    \"@vue/cli-service\": \"^3.0.1\",\n    \"@vue/eslint-config-standard\": \"^3.0.0-beta.10\",\n    \"@vue/test-utils\": \"^1.0.0-beta.10\",\n    \"chai\": \"^4.1.2\",\n    \"eslint-plugin-cypress\": \"^2.0.1\",\n    \"less\": \"^2.7.3\",\n    \"less-loader\": \"^4.0.5\",\n    \"lint-staged\": \"^6.0.0\",\n    \"mockjs\": \"^1.0.1-beta3\",\n    \"vue-template-compiler\": \"^2.5.13\"\n  },\n  \"browserslist\": [\n    \"> 1%\",\n    \"last 2 versions\",\n    \"not ie <= 8\"\n  ],\n  \"gitHooks\": {\n    \"pre-commit\": \"lint-staged\"\n  },\n  \"lint-staged\": {\n    \"*.js\": [\n      \"vue-cli-service lint\",\n      \"git add\"\n    ],\n    \"*.vue\": [\n      \"vue-cli-service lint\",\n      \"git add\"\n    ]\n  }\n}\n```\n\u4e8e\u6211\u800c\u8a00\uff0c\u6d4b\u8bd5\u53ca\u4ee3\u7801\u68c0\u6d4b\u652f\u6301\u5e76\u4e0d\u9700\u8981\uff0c\u5f88\u591a\u4e2a\u4eba\u5b9a\u5236\u5316\u5f00\u53d1\u65f6\u53ef\u4ee5\u7701\u7565\uff0c\u5bcc\u6587\u672c\u7b49\u5176\u4ed6\u63d2\u4ef6\u4e5f\u662f\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u672c\u5730create\u65b0\u9879\u76ee\u65f6\uff0c\u539f\u672c\u9879\u76ee\u7684less-loader\u7684mixin\u9700\u8981\u6307\u5b9a\u7248\u672c\uff0c\u5426\u5219\u51fa\u9519\uff0c\u5378\u8f7d\u539f\u7248\u672cless\u548cless-loader\uff0c\u5b89\u88c5\u6307\u5b9a\u7248\u672c\u5982\u4e0a\u3002\n\n## \u914d\u7f6e\n\u4ee5\u4e0b\u662f\u9879\u76ee\u8d44\u6e90\u76ee\u5f55\u914d\u7f6e\n### main.js\n```js\n// The Vue build version to load with the `import` command\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\nimport Vue from 'vue'\nimport App from './App'\nimport router from './router'\nimport store from './store'\nimport iView from 'iview'\nimport i18n from '@/locale'              //\u672c\u5730\u5316\nimport config from '@/config'            //\u914d\u7f6e\nimport importDirective from '@/directive'    //\u6307\u4ee4\nimport { directive as clickOutside } from 'v-click-outside-x'  //\u7ed3\u6784(es6)\nimport installPlugin from '@/plugin'     //\u9519\u8bef\u65e5\u5fd7\u4fe1\u606f\u7684\u63d2\u4ef6\nimport './index.less'            //index.less(\u4e3b\u8981iview\u6837\u5f0f\u548csidebar\u7684\u4e3b\u9898)\nimport '@/assets/icons/iconfont.css'    //\u56fe\u6807\nimport TreeTable from 'tree-table-vue'  // \u6811\u72b6\u8868\u683c\nimport VOrgTree from 'v-org-tree'       // \u7ec4\u7ec7\u7ed3\u6784\u6811\nimport 'v-org-tree/dist/v-org-tree.css'\n// \u5b9e\u9645\u6253\u5305\u65f6\u5e94\u8be5\u4e0d\u5f15\u5165mock\n/* eslint-disable */\nif (process.env.NODE_ENV !== 'production') require('@/mock')\n\nVue.use(iView, {\n  i18n: (key, value) => i18n.t(key, value)\n})\nVue.use(TreeTable)\nVue.use(VOrgTree)\n\ninstallPlugin(Vue)        // \u6ce8\u518cadmin\u5185\u7f6e\u63d2\u4ef6\nVue.config.productionTip = false\nVue.prototype.$config = config    //\u6ce8\u518c\u5168\u5c40$config\n\nimportDirective(Vue)        // \u6307\u4ee4\u6ce8\u518c\nVue.directive('clickOutside', clickOutside)\n\n/* eslint-disable no-new */\nnew Vue({\n  el: '#app',\n  router,\n  i18n,\n  store,\n  render: h => h(App)\n})\n```\n> iView-admin\u7684\u9879\u76ee\u5165\u53e3\u6587\u4ef6main.js\u8fd8\u662f\u6bd4\u8f83\u6e05\u695a\u7684\uff0c\u76f8\u6bd4\u6211\u7684\u4e71\u4e03\u516b\u7cdf\uff0c\u5f88\u6709\u793a\u8303\u610f\u4e49\u4e86\u3002\nmain.js\u5f15\u5165\u4e86\u56fd\u9645\u5316\uff1b\u5168\u5c40\u6ce8\u518c\u4e86config\uff0c\u6307\u4ee4\u548c\u63d2\u4ef6\uff0c\u8fd8\u6709\u5f15\u5165\u4e86\u4e24\u4e2a\u7ec4\u4ef6\u9700\u8981\u7684\u5e93\uff0c\u5f88\u6e05\u695a\u76f4\u63a5\n### config/index.js\n```js\nexport default {\n  title: 'iView-admin',        //doc-title\u524d\u7f00\uff0c\u6211\u4e0d\u559c\u6b22\u8fd9\u4e2a\u914d\u7f6e\n  cookieExpires: 1,        // token\u5728Cookie\u4e2d\u5b58\u50a8\u7684\u5929\u6570\uff0c\u9ed8\u8ba41\u5929\n  useI18n: true, //\u9ed8\u8ba4false,\u5982\u679c\u4e0d\u4f7f\u7528\uff0c\u5219\u9700\u8981\u5728\u8def\u7531\u4e2d\u7ed9\u9700\u8981\u5728\u83dc\u5355\u4e2d\u5c55\u793a\u7684\u8def\u7531\u8bbe\u7f6emeta: {title: 'xxx'}\n  baseUrl: {\n    dev: 'https://www.easy-mock.com/mock/5add9213ce4d0e69998a6f51/iview-admin/',\n    pro: 'https://produce.com'\n  },        // \u5f00\u53d1\u548c\u751f\u4ea7\u6a21\u5f0f\u7684baseurl\uff0c\u6211\u4e0d\u559c\u6b22\u8fd9\u4e2a\u914d\u7f6e\n  homeName: 'home',    //\u9ed8\u8ba4\u6253\u5f00\u7684\u9996\u9875\u7684\u8def\u7531name\u503c\uff0c\u9ed8\u8ba4\u4e3ahome\n  plugin: {\n    'error-store': {\n      showInHeader: true, // \u8bbe\u4e3afalse\u540e\u4e0d\u4f1a\u5728\u9876\u90e8\u663e\u793a\u9519\u8bef\u65e5\u5fd7\u5fbd\u6807\n      developmentOff: true // \u8bbe\u4e3atrue\u540e\u5728\u5f00\u53d1\u73af\u5883\u4e0d\u4f1a\u6536\u96c6\u9519\u8bef\u4fe1\u606f\uff0c\u65b9\u4fbf\u5f00\u53d1\u4e2d\u6392\u67e5\u9519\u8bef\n    }\n  }            //\u9700\u8981\u52a0\u8f7d\u7684\u63d2\u4ef6\n}\n```\n> \u5168\u5c40\u914d\u7f6e\uff0c\u5176\u4e2d\u7684title\u914d\u7f6e\u5728lib/utils.js\u91cc\u7684\u524d\u7f00title\uff0c\u6211\u4e0d\u559c\u6b22\uff0c\u4e2a\u4eba\u5b9a\u5236\u7684\u8bdd\u4f1a\u53d6\u6d88\uff1bbaseurl\uff0c\u9879\u76ee\u7684\u5f00\u53d1\u548c\u751f\u4ea7\u73af\u5883\u6ca1\u6709@v4\u7684`.env.development`\u7684\u5168\u5c40\u53d8\u91cf\u65b9\u4fbf\uff0c\u6240\u4ee5\u4e2a\u4eba\u5efa\u8bae\u53d6\u6d88\u3002\u8fd9\u4e2aconfig\u6700\u65b9\u4fbf\u7684\u662f\uff0c\u5728main.js\u5168\u5c40\u914d\u7f6e\uff0c\u7136\u540e$config.\u53d8\u91cf\u540d\u76f4\u63a5\u5f15\u5165\n### router", "excerpt": "\niView\u5b98\u7f51\u63a8\u51fa\u7684\u8fd9\u4e2aadmin\u540e\u53f0\uff0c\u5b9e\u8bdd\u662f\u5f88\u559c\u6b22\u7684\uff0c\u5728\u5b66\u4e60\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u9488\u5bf9\u4e2a\u6027\u5316\u7684\u5b9a\u5236\uff0c\u4ee5\u53ca\u8bed\u8a00\u7684\u5b66\u4e60\uff0c\u4ee3\u7801\u7684\u89c4\u8303\u5927\u6709\u76ca\u5904\u3002\u4e86\u89e3\u4e86\u5f88\u591a\u81ea\u5df1\u5199\u524d\u7aef\u65f6\u770b\u8d77\u6765\u5f88\u4e11\u964b\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u9488\u5bf9\u9879\u76ee\u4ee3\u7801\uff0c\u89e3\u6784\u5206\u6790\u3002\n\n\u9879\u76ee\u7ed3\u6784\n.\n\u251c\u2500\u2500 config  \u5f00\u53d1\u76f8\u5173\u914d\u7f6e\n\u251c\u2500\u2500 public  \u6253\u5305\u6240\u9700\u9759\u6001\u8d44\u6e90\n\u2514", "codestyle": "atelier-cave-dark", "reproduce": false, "reproduce_source": null, "create_date": "2020-04-09T20:27:24.275", "mod_date": "2020-04-10T01:31:06.123", "views_count": 28, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 4, "tags": []}}, {"model": "blog.post", "pk": 30, "fields": {"title": "vue\u57fa\u7840slot", "body": "<h1><a id=\"_slot_0\"></a>\u5355\u4e2a slot</h1>\n<h3><a id=\"_2\"></a>\u5b50\u7ec4\u4ef6\u65e0\u5185\u5bb9</h3>\n<pre><div class=\"hljs\"><code class=\"lang-html\"><span class=\"hljs-comment\">&lt;!-- \u7236\u7ec4\u4ef6template  \u5b50\u7ec4\u4ef6\u5185\u65e0\u5185\u5bb9 --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"content\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">child</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">child</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- \u5b50\u7ec4\u4ef6\u6a21\u677f --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"slot\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span>&gt;</span>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span>&gt;</span>\n    \u53ea\u6709\u5728\u6ca1\u6709\u8981\u5206\u53d1\u7684\u5185\u5bb9\u65f6\u624d\u663e\u793a\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- \u6e32\u67d3\u7ed3\u679c --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"content\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span>&gt;</span>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n  \u53ea\u6709\u5728\u6ca1\u6709\u8981\u5206\u53d1\u7684\u5185\u5bb9\u65f6\u624d\u663e\u793a\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n</code></div></pre>\n<h3><a id=\"_25\"></a>\u5b50\u7ec4\u4ef6\u6709\u5185\u5bb9</h3>\n<pre><div class=\"hljs\"><code class=\"lang-html\"><span class=\"hljs-comment\">&lt;!-- \u7236\u7ec4\u4ef6template  \u5b50\u7ec4\u4ef6\u5185\u6709\u5185\u5bb9 --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"content\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">child</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>\u8fd9\u662f\u4e00\u4e9b\u521d\u59cb\u5185\u5bb9<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>\u8fd9\u662f\u66f4\u591a\u7684\u521d\u59cb\u5185\u5bb9<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">child</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- \u5b50\u7ec4\u4ef6\u6a21\u677f --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"slot\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span>&gt;</span>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span>&gt;</span>\n    \u53ea\u6709\u5728\u6ca1\u6709\u8981\u5206\u53d1\u7684\u5185\u5bb9\u65f6\u624d\u663e\u793a\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- \u6e32\u67d3\u7ed3\u679c --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"content\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span>&gt;</span>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>\u8fd9\u662f\u4e00\u4e9b\u521d\u59cb\u5185\u5bb9<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>\u8fd9\u662f\u66f4\u591a\u7684\u521d\u59cb\u5185\u5bb9<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n</code></div></pre>\n<h1><a id=\"_slot_52\"></a>\u5177\u540d slot</h1>\n<pre><div class=\"hljs\"><code class=\"lang-html\"><span class=\"hljs-comment\">&lt;!-- \u5b50\u7ec4\u4ef6\u5e38\u7528\u4e09\u6bb5\u5f0f --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"slot\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">header</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"header\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">header</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">main</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span>&gt;</span>\u7236\u7ec4\u4ef6\u6ca1\u5185\u5bb9\u65f6\u663e\u793a\u6211<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">main</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">footer</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">slot</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"footer\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">slot</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">footer</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- \u7236\u7ec4\u4ef6 --&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"content\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">child</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">\"header\"</span>&gt;</span>\u8fd9\u91cc\u662f\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n    \u8fd9\u91cc\u662f\u5e38\u89c4\u5185\u5bb9\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h5</span> <span class=\"hljs-attr\">slot</span>=<span class=\"hljs-string\">\"footer\"</span>&gt;</span>\u8fd9\u91cc\u662f\u5c3e\u90e8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h5</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">child</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n\n<span class=\"hljs-comment\">&lt;!-- \u6e32\u67d3\u7ed3\u679c --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"content\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">header</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h2</span>&gt;</span>\u8fd9\u91cc\u662f\u6807\u9898<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h2</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">header</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">main</span>&gt;</span>\n    \u8fd9\u91cc\u662f\u5e38\u89c4\u5185\u5bb9\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">main</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">footer</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h5</span>&gt;</span>\u8fd9\u91cc\u662f\u5c3e\u90e8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h5</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">footer</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n</code></div></pre>", "body_md": "# \u5355\u4e2a slot\n\n### \u5b50\u7ec4\u4ef6\u65e0\u5185\u5bb9\n\n```html\n<!-- \u7236\u7ec4\u4ef6template  \u5b50\u7ec4\u4ef6\u5185\u65e0\u5185\u5bb9 -->\n<div id=\"content\">\n  <h1>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898</h1>\n  <child> </child>\n</div>\n<!-- \u5b50\u7ec4\u4ef6\u6a21\u677f -->\n<div id=\"slot\">\n  <h2>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898</h2>\n  <slot>\n    \u53ea\u6709\u5728\u6ca1\u6709\u8981\u5206\u53d1\u7684\u5185\u5bb9\u65f6\u624d\u663e\u793a\n  </slot>\n</div>\n<!-- \u6e32\u67d3\u7ed3\u679c -->\n<div id=\"content\">\n  <h1>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898</h1>\n  <h2>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898</h2>\n  \u53ea\u6709\u5728\u6ca1\u6709\u8981\u5206\u53d1\u7684\u5185\u5bb9\u65f6\u624d\u663e\u793a\n</div>\n```\n\n### \u5b50\u7ec4\u4ef6\u6709\u5185\u5bb9\n\n```html\n<!-- \u7236\u7ec4\u4ef6template  \u5b50\u7ec4\u4ef6\u5185\u6709\u5185\u5bb9 -->\n<div id=\"content\">\n  <h1>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898</h1>\n  <child>\n    <p>\u8fd9\u662f\u4e00\u4e9b\u521d\u59cb\u5185\u5bb9</p>\n    <p>\u8fd9\u662f\u66f4\u591a\u7684\u521d\u59cb\u5185\u5bb9</p>\n  </child>\n</div>\n<!-- \u5b50\u7ec4\u4ef6\u6a21\u677f -->\n<div id=\"slot\">\n  <h2>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898</h2>\n  <slot>\n    \u53ea\u6709\u5728\u6ca1\u6709\u8981\u5206\u53d1\u7684\u5185\u5bb9\u65f6\u624d\u663e\u793a\n  </slot>\n</div>\n<!-- \u6e32\u67d3\u7ed3\u679c -->\n<div id=\"content\">\n  <h1>\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898</h1>\n  <h2>\u6211\u662fsss\u7ec4\u4ef6\u7684\u6807\u9898</h2>\n  <p>\u8fd9\u662f\u4e00\u4e9b\u521d\u59cb\u5185\u5bb9</p>\n  <p>\u8fd9\u662f\u66f4\u591a\u7684\u521d\u59cb\u5185\u5bb9</p>\n</div>\n```\n\n# \u5177\u540d slot\n\n```html\n<!-- \u5b50\u7ec4\u4ef6\u5e38\u7528\u4e09\u6bb5\u5f0f -->\n<div id=\"slot\">\n  <header>\n    <slot name=\"header\"></slot>\n  </header>\n  <main>\n    <slot>\u7236\u7ec4\u4ef6\u6ca1\u5185\u5bb9\u65f6\u663e\u793a\u6211</slot>\n  </main>\n  <footer>\n    <slot name=\"footer\"></slot>\n  </footer>\n</div>\n<!-- \u7236\u7ec4\u4ef6 -->\n\n<div class=\"content\">\n  <child>\n    <h2 slot=\"header\">\u8fd9\u91cc\u662f\u6807\u9898</h2>\n    \u8fd9\u91cc\u662f\u5e38\u89c4\u5185\u5bb9\n    <h5 slot=\"footer\">\u8fd9\u91cc\u662f\u5c3e\u90e8</h5>\n  </child>\n</div>\n\n<!-- \u6e32\u67d3\u7ed3\u679c -->\n<div class=\"content\">\n  <header>\n    <h2>\u8fd9\u91cc\u662f\u6807\u9898</h2>\n  </header>\n  <main>\n    \u8fd9\u91cc\u662f\u5e38\u89c4\u5185\u5bb9\n  </main>\n  <footer>\n    <h5>\u8fd9\u91cc\u662f\u5c3e\u90e8</h5>\n  </footer>\n</div>\n```", "excerpt": "\u5355\u4e2a slot\n\u5b50\u7ec4\u4ef6\u65e0\u5185\u5bb9\n&lt;!-- \u7236\u7ec4\u4ef6template  \u5b50\u7ec4\u4ef6\u5185\u65e0\u5185\u5bb9 --&gt;\n&lt;div id=\"content\"&gt;\n  &lt;h1&gt;\u6211\u662fContent\u7ec4\u4ef6\u7684\u6807\u9898&lt;/h1&gt;\n  &lt;child&gt; &lt;/child&gt;\n&lt;/", "codestyle": "monokai", "reproduce": false, "reproduce_source": "", "create_date": "2020-04-10T19:04:39.603", "mod_date": "2020-04-10T19:04:39.603", "views_count": 2, "can_comment": true, "comment_count": 0, "upvote_count": 0, "ifshow": true, "author": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "category": 4, "tags": []}}, {"model": "operation.userfav", "pk": 5, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 1, "add_time": "2020-02-16T16:10:38.241"}}, {"model": "operation.userfav", "pk": 50, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 2, "add_time": "2020-02-19T16:08:10.330"}}, {"model": "operation.userfav", "pk": 53, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 3, "add_time": "2020-02-20T14:46:15.593"}}, {"model": "operation.userfav", "pk": 55, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 8, "add_time": "2020-03-05T23:32:37.555"}}, {"model": "operation.userfav", "pk": 63, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 9, "add_time": "2020-03-16T22:00:38.322"}}, {"model": "operation.userfav", "pk": 73, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 24, "add_time": "2020-03-26T11:50:46.865"}}, {"model": "operation.userfav", "pk": 74, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 11, "add_time": "2020-03-30T21:12:29.567"}}, {"model": "operation.userfav", "pk": 80, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 28, "add_time": "2020-04-09T19:16:11.523"}}, {"model": "operation.uservote", "pk": 1, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 1, "vote": 1, "add_time": "2020-02-09T02:14:03.278"}}, {"model": "operation.uservote", "pk": 2, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 2, "vote": 2, "add_time": "2020-02-16T19:48:08.573"}}, {"model": "operation.uservote", "pk": 3, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 8, "vote": 2, "add_time": "2020-03-05T23:32:39.438"}}, {"model": "operation.uservote", "pk": 5, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 18, "vote": 0, "add_time": "2020-03-13T21:21:04.424"}}, {"model": "operation.uservote", "pk": 6, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 19, "vote": 1, "add_time": "2020-03-18T10:06:12.583"}}, {"model": "operation.uservote", "pk": 7, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 22, "vote": 0, "add_time": "2020-03-23T14:58:14.421"}}, {"model": "operation.uservote", "pk": 8, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 24, "vote": 0, "add_time": "2020-03-26T11:50:45.193"}}, {"model": "operation.uservote", "pk": 9, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "post": 28, "vote": 2, "add_time": "2020-04-09T19:16:00.813"}}, {"model": "xadmin.usersettings", "pk": 1, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "key": "dashboard:home:pos", "value": ""}}, {"model": "xadmin.usersettings", "pk": 2, "fields": {"user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "key": "site-theme", "value": "/static/xadmin/css/themes/bootstrap-theme.css"}}, {"model": "xadmin.log", "pk": 1, "fields": {"action_time": "2020-02-08T21:11:16.962", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "1", "object_repr": "\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 2, "fields": {"action_time": "2020-02-08T21:11:42.171", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 9, "object_id": "1", "object_repr": "\u961f\u5217", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 3, "fields": {"action_time": "2020-02-08T23:05:46.459", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 17, "object_id": "1", "object_repr": "about", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 4, "fields": {"action_time": "2020-02-08T23:08:00.861", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 17, "object_id": "2", "object_repr": "version", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 5, "fields": {"action_time": "2020-02-08T23:08:23.560", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 17, "object_id": "3", "object_repr": "guide", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 6, "fields": {"action_time": "2020-02-08T23:08:40.759", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 17, "object_id": "4", "object_repr": "recommend", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 7, "fields": {"action_time": "2020-02-09T02:10:24.941", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 6, "object_id": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "object_repr": "heping", "action_flag": "change", "message": "\u4fee\u6539 last_login \u548c avatar"}}, {"model": "xadmin.log", "pk": 8, "fields": {"action_time": "2020-02-16T03:54:57.491", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "1", "object_repr": "\u8fdb\u9636\u4e4b\u8def1.0", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 9, "fields": {"action_time": "2020-02-16T03:57:21.081", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "1", "object_repr": "\u8fdb\u9636\u4e4b\u8def1.0", "action_flag": "change", "message": "\u4fee\u6539 urltag"}}, {"model": "xadmin.log", "pk": 10, "fields": {"action_time": "2020-02-16T03:59:46.454", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "1", "object_repr": "\u8fdb\u9636\u4e4b\u8def1.0", "action_flag": "change", "message": "\u4fee\u6539 ifshow"}}, {"model": "xadmin.log", "pk": 11, "fields": {"action_time": "2020-02-16T04:00:34.416", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "1", "object_repr": "\u8fdb\u9636\u4e4b\u8def1.0", "action_flag": "change", "message": "\u4fee\u6539 ifshow"}}, {"model": "xadmin.log", "pk": 12, "fields": {"action_time": "2020-02-16T19:02:42.153", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": null, "object_id": null, "object_repr": "", "action_flag": "delete", "message": "\u6279\u91cf\u5220\u9664 2 \u4e2a \u6587\u7ae0\u56fe\u7247"}}, {"model": "xadmin.log", "pk": 13, "fields": {"action_time": "2020-02-17T02:47:14.727", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "2", "object_repr": "\u524d\u7aef", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 14, "fields": {"action_time": "2020-02-17T02:47:29.903", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "3", "object_repr": "javascript", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 15, "fields": {"action_time": "2020-02-17T02:47:36.531", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "4", "object_repr": "vue", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 16, "fields": {"action_time": "2020-02-17T02:47:49.569", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "4", "object_repr": "vue", "action_flag": "change", "message": "\u4fee\u6539 parent_category"}}, {"model": "xadmin.log", "pk": 17, "fields": {"action_time": "2020-02-17T02:47:57.065", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "3", "object_repr": "javascript", "action_flag": "change", "message": "\u4fee\u6539 parent_category"}}, {"model": "xadmin.log", "pk": 18, "fields": {"action_time": "2020-02-17T14:33:30.004", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "1", "object_repr": "\u8fdb\u9636\u4e4b\u8def1.0", "action_flag": "change", "message": "\u4fee\u6539 codestyle"}}, {"model": "xadmin.log", "pk": 19, "fields": {"action_time": "2020-02-18T02:40:21.670", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "2", "object_repr": "Redis \u6df1\u5ea6\u5386\u9669", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 20, "fields": {"action_time": "2020-02-18T03:42:31.278", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "2", "object_repr": "Redis \u6df1\u5ea6\u5386\u9669", "action_flag": "change", "message": "\u6ca1\u6709\u5b57\u6bb5\u88ab\u4fee\u6539\u3002"}}, {"model": "xadmin.log", "pk": 21, "fields": {"action_time": "2020-02-18T21:12:08.713", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "2", "object_repr": "Redis \u6df1\u5ea6\u5386\u9669", "action_flag": "change", "message": "\u4fee\u6539 reproduce \u548c codestyle"}}, {"model": "xadmin.log", "pk": 22, "fields": {"action_time": "2020-02-18T21:16:57.619", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "3", "object_repr": "\u5f00\u53d1\u8005\u5fc5\u5907\u7684 Docker \u5b9e\u8df5\u6307\u5357", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 23, "fields": {"action_time": "2020-02-18T21:23:18.551", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "4", "object_repr": "\u6df1\u5165\u7406\u89e3 RPC : \u57fa\u4e8e Python \u81ea\u5efa\u5206\u5e03\u5f0f\u9ad8\u5e76\u53d1 RPC \u670d\u52a1", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 24, "fields": {"action_time": "2020-02-18T21:34:27.038", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "5", "object_repr": "Vue.js \u7ec4\u4ef6\u7cbe\u8bb2", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 25, "fields": {"action_time": "2020-02-18T21:35:46.110", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "6", "object_repr": "\u57fa\u4e8e Go \u8bed\u8a00\u6784\u5efa\u4f01\u4e1a\u7ea7\u7684 RESTful API \u670d\u52a1", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 26, "fields": {"action_time": "2020-02-19T16:02:00.390", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": null, "object_id": null, "object_repr": "", "action_flag": "delete", "message": "\u6279\u91cf\u5220\u9664 1 \u4e2a \u53cd\u9988\u6d88\u606f"}}, {"model": "xadmin.log", "pk": 27, "fields": {"action_time": "2020-02-19T16:13:03.760", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 17, "object_id": "3", "object_repr": "guide", "action_flag": "change", "message": "\u4fee\u6539 body_md"}}, {"model": "xadmin.log", "pk": 28, "fields": {"action_time": "2020-02-20T12:34:08.683", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 6, "object_id": "e4798d2b-e4e5-4abb-bb9e-c47564675878", "object_repr": "jack", "action_flag": "change", "message": "\u4fee\u6539 avatar"}}, {"model": "xadmin.log", "pk": 29, "fields": {"action_time": "2020-02-20T13:09:06.261", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "7", "object_repr": "django-rest-framework-api-guide", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 30, "fields": {"action_time": "2020-02-20T14:11:37.986", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "7", "object_repr": "django-rest-framework-api-guide", "action_flag": "change", "message": "\u4fee\u6539 codestyle"}}, {"model": "xadmin.log", "pk": 31, "fields": {"action_time": "2020-02-20T14:45:34.038", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "7", "object_repr": "django-rest-framework-api-guide", "action_flag": "change", "message": "\u4fee\u6539 codestyle"}}, {"model": "xadmin.log", "pk": 32, "fields": {"action_time": "2020-02-20T14:52:04.601", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "2", "object_repr": "Redis \u6df1\u5ea6\u5386\u9669", "action_flag": "change", "message": "\u4fee\u6539 ifshow"}}, {"model": "xadmin.log", "pk": 33, "fields": {"action_time": "2020-02-20T17:47:35.153", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "5", "object_repr": "django", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 34, "fields": {"action_time": "2020-02-20T17:47:41.016", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "6", "object_repr": "\u540e\u7aef", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 35, "fields": {"action_time": "2020-02-20T17:47:47.480", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "5", "object_repr": "django", "action_flag": "change", "message": "\u4fee\u6539 parent_category"}}, {"model": "xadmin.log", "pk": 36, "fields": {"action_time": "2020-02-20T17:48:00.187", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "7", "object_repr": "python", "action_flag": "create", "message": "\u5df2\u6dfb\u52a0\u3002"}}, {"model": "xadmin.log", "pk": 37, "fields": {"action_time": "2020-02-20T17:48:05.251", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "7", "object_repr": "python", "action_flag": "change", "message": "\u4fee\u6539 parent_category"}}, {"model": "xadmin.log", "pk": 38, "fields": {"action_time": "2020-02-20T17:48:09.810", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 7, "object_id": "5", "object_repr": "django", "action_flag": "change", "message": "\u4fee\u6539 parent_category"}}, {"model": "xadmin.log", "pk": 39, "fields": {"action_time": "2020-03-13T03:06:06.975", "user": "4355db9a-f0e6-4407-bc98-fec13d2be2ff", "ip_addr": "127.0.0.1", "content_type": 12, "object_id": "2", "object_repr": "Redis \u6df1\u5ea6\u5386\u9669", "action_flag": "change", "message": "\u4fee\u6539 ifshow"}}]